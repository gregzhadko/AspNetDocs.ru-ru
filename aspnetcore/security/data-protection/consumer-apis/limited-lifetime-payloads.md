---
title: Ограничение времени существования защищенных полезных данных в ASP.NET Core
author: rick-anderson
description: Узнайте, как ограничение времени существования защищенных полезных данных, с помощью API защиты данных ASP.NET Core.
ms.author: riande
ms.date: 10/14/2016
uid: security/data-protection/consumer-apis/limited-lifetime-payloads
ms.openlocfilehash: 8dc3b856ec67477ec8ae777749c9bf3107eb4eda
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/01/2019
ms.locfileid: "57039591"
---
# <a name="limit-the-lifetime-of-protected-payloads-in-aspnet-core"></a>Ограничение времени существования защищенных полезных данных в ASP.NET Core

Существуют сценарии, где разработчик приложения хочет создать защищенных полезных данных, срок действия истекает через определенный период времени. Например защищенных полезных данных может представлять маркер сброса пароля, который должен быть допустимы, только на один час. Определенно возможно для разработчика, может создавать свои собственные формат полезных данных, который содержит внедренные срок действия, и опытным разработчикам может потребоваться сделать в любом случае, но для большинства разработчиков управление этих сроков действия может увеличиваться утомительно.

Чтобы облегчить эту задачу для аудитории разработчиков, пакет [Microsoft.AspNetCore.DataProtection.Extensions](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection.Extensions/) содержит API для служебных программ для создания полезных данных, которые автоматически истекает после заданного периода времени. Эти API-интерфейсы зависания за пределами класса `ITimeLimitedDataProtector` типа.

## <a name="api-usage"></a>Использование API

`ITimeLimitedDataProtector` Интерфейс является основной интерфейс для защиты и снятии с него защиты полезных данных с ограниченным сроком / автоматическим истечением срока действия. Для создания экземпляра `ITimeLimitedDataProtector`, необходимо сначала экземпляр обычного [IDataProtector](xref:security/data-protection/consumer-apis/overview) создан с помощью определенной цели. Один раз `IDataProtector` экземпляр доступен, вызовите `IDataProtector.ToTimeLimitedDataProtector` метод расширения для получения предохранитель с возможностями истечения срока действия.

`ITimeLimitedDataProtector` предоставляет следующие методы поверхность и расширения API:

* CreateProtector (строка назначения): ITimeLimitedDataProtector - этот API, сходного с существующим `IDataProtectionProvider.CreateProtector` тем, что он может использоваться для создания [цели цепочки](xref:security/data-protection/consumer-apis/purpose-strings) из предохранитель корневой с ограниченным сроком действия.

* Защита (byte [] открытого текста, срок действия DateTimeOffset): byte]

* Защита (открытого текста byte [], время существования TimeSpan): byte]

* Защита (byte [] открытого текста): byte]

* Защита (текстовая строка, DateTimeOffset истечения срока действия): строка

* Защита (открытого текста строки, время существования TimeSpan): строка

* Защита (текстовая строка): строка

Помимо основных `Protect` методы, которые принимают только открытого текста, существуют новые перегрузки, которые разрешается указывать дату окончания срока действия полезных данных. Дату истечения срока действия может быть указан как абсолютная Дата (через `DateTimeOffset`) или как относительное время (из текущей системы времени через `TimeSpan`). При вызове перегрузки, которая не принимает срок действия, полезных данных считается никогда не истекает.

* Снять защиту (byte [] protectedData, out DateTimeOffset истечения срока действия): byte]

* Снять защиту (protectedData byte []): byte]

* Снять защиту (out DateTimeOffset истечения срока действия, protectedData строка): строка

* Снять защиту (строка protectedData): строка

`Unprotect` Методы возвращают исходные незащищенные данные. Если полезные данные, пока еще не истек, абсолютный срок действия возвращается как Необязательный выходной параметр вместе с исходной незащищенные данные. Если истек срок действия полезных данных всех перегруженных версий метода Unprotect вызовет CryptographicException.

>[!WARNING]
> Не рекомендуется использовать эти API-интерфейсы для защиты полезных данных, требующих долгосрочного или неопределенное сохраняемости. «Я допускается для защищенных полезных данных будет невозможно восстановить после месяца?» можно использовать в качестве хорошее проверенное правило; Если ответ не затем разработчики могут попробовать альтернативные интерфейсы API.

Приведенный ниже пример использует [пути кода не DI](xref:security/data-protection/configuration/non-di-scenarios) для создания экземпляра система защиты данных. Для выполнения этого образца, убедитесь, что сначала добавили ссылку на пакет Microsoft.AspNetCore.DataProtection.Extensions.

[!code-csharp[](limited-lifetime-payloads/samples/limitedlifetimepayloads.cs)]
