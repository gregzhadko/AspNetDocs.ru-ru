---
title: Добавление контроллера в приложение MVC ASP.NET Core
author: rick-anderson
description: Узнайте, как добавить контроллер в простое приложение ASP.NET Core MVC.
ms.author: riande
ms.date: 02/28/2017
uid: tutorials/first-mvc-app/adding-controller
ms.openlocfilehash: bbb7b06e2c9c63f44cb7f7a8ee63bffa1e316b3e
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/01/2019
ms.locfileid: "57040721"
---
# <a name="add-a-controller-to-an-aspnet-core-mvc-app"></a>Добавление контроллера в приложение MVC ASP.NET Core

Автор: [Рик Андерсон](https://twitter.com/RickAndMSFT) (Rick Anderson)

Модель архитектуры MVC разделяет приложение на три основных компонента: **M**odel (модель), **V**iew (представление) и **C**ontroller (контроллер). С помощью модели MVC можно создавать приложения, которые удобнее тестировать и обновлять по сравнению с традиционными монолитными приложениями. Приложения на основе модели MVC содержат следующее:

* **Модели**: классы, представляющие данные в приложении. Классы модели используют логику проверки, которая позволяет применять бизнес-правила к этим данным. Как правило, объекты модели извлекают и сохраняют состояние модели в базе данных. В этом руководстве модель `Movie` извлекает сведения о фильмах из базы данных и передает их в представление или обновляет. Обновленные данные записываются в базу данных.

* **Представления**: компоненты, которые формируют пользовательский интерфейс приложения. Как правило, в пользовательском интерфейсе отображаются данные модели.

* **Контроллеры**: классы, которые обрабатывают запросы браузера. Они извлекают данные модели и вызывают шаблоны представлений, которые возвращают ответ. В приложении MVC представление служит только для отображения информации. Обработку введенных данных, формирование ответа и взаимодействие с пользователем обеспечивает контроллер. Например, контроллер обрабатывает данные маршрута и значения строки запроса, после чего передает эти значения в модель. Модель может использовать эти значения для выполнения запросов к базе данных. Например, `https://localhost:1234/Home/About` содержит данные маршрута для `Home` (контроллер) и метода действия `About` (вызывает контроллер home). `https://localhost:1234/Movies/Edit/5` — это запрос на редактирование фильма с идентификатором 5 с использованием контроллера movie. Данные маршрута описаны далее в этом руководстве.

Модель MVC позволяет создавать приложения, которые разделяют различные аспекты (логика ввода, бизнес-логика и логика пользовательского интерфейса), обеспечивая при этом слабые взаимозависимости между этими элементами. Модель определяет, в каком месте приложения будет располагаться логика разных видов. Логика пользовательского интерфейса относится к представлению. Логика ввода относится к контроллеру. Бизнес-логика размещается в модели. Подобное разделение позволяет эффективно справляться с трудностями при построении приложения, поскольку оно дает возможность работать одновременно с одним аспектом реализации, не затрагивая при этом код других. Например, вы можете изменять код представления независимо от кода бизнес-логики.

Эти понятия подробно рассматриваются в данной серии руководств и наглядно демонстрируются при построении приложения movie. Проект MVC содержит папки для *контроллеров* и *представлений*.

## <a name="add-a-controller"></a>Добавление контроллера

<!-- VS -------------------------->
# <a name="visual-studiotabvisual-studio"></a>[Visual Studio](#tab/visual-studio)

* В **обозревателе решений** щелкните правой кнопкой мыши **Контроллеры > Добавить > Контроллер**
  ![Контекстное меню](adding-controller/_static/add_controller.png).

* В диалоговом окне **Добавление шаблона** выберите **Контроллер MVC — пустой**.

  ![Добавьте контроллер MVC и присвойте ему имя.](adding-controller/_static/ac.png)

* В **диалоговом окне "Добавить пустой контроллер MVC"** введите **HelloWorldController** и выберите **Добавить**.

<!-- Code -------------------------->
# <a name="visual-studio-codetabvisual-studio-code"></a>[Visual Studio Code.](#tab/visual-studio-code)

Щелкните значок **обозревателя**, а затем правой кнопкой мыши щелкните **Контроллеры > Новый файл** и назовите новый файл *HelloWorldController.cs*.

  ![Контекстное меню](~/tutorials/first-mvc-app-xplat/adding-controller/_static/new_file.png)

<!-- Mac -------------------------->
# <a name="visual-studio-for-mactabvisual-studio-mac"></a>[Visual Studio для Mac](#tab/visual-studio-mac)

В **обозревателе решений** щелкните правой кнопкой мыши **Контроллеры > Добавить > Новый файл**.
![Контекстное меню](~/tutorials/first-mvc-app-mac/adding-controller/_static/add_controller.png)

Выберите **ASP.NET Core** и **Класс контроллера MVC**.

Присвойте контроллеру имя **HelloWorldController**.

![Добавьте контроллер MVC и присвойте ему имя.](~/tutorials/first-mvc-app-mac/adding-controller/_static/ac.png)

---
<!-- End of VS tabs -->

Замените содержимое файла *Controllers/HelloWorldController.cs* следующим:

[!code-csharp[](~/tutorials/first-mvc-app/start-mvc/sample/MvcMovie/Controllers/HelloWorldController.cs?name=snippet_1)]

Каждый метод `public` в контроллере вызывается как конечная точка HTTP. В приведенном выше примере оба метода возвращают строку. Обратите внимание на комментарии, предшествующие каждому методу.

Конечная точка HTTP — это адресуемый URL в веб-приложении, такой как `https://localhost:5001/HelloWorld`, который объединяет в себе используемый протокол (`HTTPS`), сетевое расположение сервера с TCP-портом (`localhost:5001`), а также целевой URI (`HelloWorld`).

В первом комментарии указано, что этот метод [HTTP GET](https://www.w3schools.com/tags/ref_httpmethods.asp) вызывается путем добавления `/HelloWorld/` к базовому URL-адресу. Во втором комментарии указано, что этот метод [HTTP GET](http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html) вызывается путем добавления `/HelloWorld/Welcome/` к URL-адресу. Далее в этом руководстве используется механизм формирования шаблонов для создания методов `HTTP POST`, которые обновляют данные.

Запустите приложение в режиме без отладки и добавьте "HelloWorld" к пути в адресной строке. Метод `Index` возвращает строку.

![Окно браузера, в котором отображается ответ "This is my default action" (Это действие по умолчанию)](~/tutorials/first-mvc-app/adding-controller/_static/hell1.png)

MVC вызывает классы контроллера (и методы действия в них) в зависимости от входящего URL-адреса. [Логика маршрутизации URL-адресов](xref:mvc/controllers/routing), используемая моделью MVC по умолчанию, определяет вызываемый код на основе формата следующего вида:

`/[Controller]/[ActionName]/[Parameters]`

Формат маршрутизации задается в методе `Configure` в файле *Startup.cs*.

[!code-csharp[](~/tutorials/first-mvc-app/start-mvc/sample/MvcMovie/Startup.cs?name=snippet_1&highlight=5)]

<!-- 
Add link to explain lambda.
Remove link for simplified tutorial.
-->

Если при переходе к приложению не указаны сегменты URL-адреса, по умолчанию устанавливаются контроллер Home и метод Index, которые заданы в выделенной выше строке шаблона.

Первый сегмент URL-адреса определяет класс контроллера, который будет выполняться. Таким образом, `localhost:xxxx/HelloWorld` сопоставляется с классом `HelloWorldController`. Вторая часть сегмента URL-адреса определяет метод действия для класса. Таким образом, `localhost:xxxx/HelloWorld/Index` выполняет метод `Index` класса `HelloWorldController`. Обратите внимание, что в этом случае достаточно перейти по адресу `localhost:xxxx/HelloWorld`, а метод `Index` вызывается по умолчанию. Это связано с тем, что если имя вызываемого метода не задано явно, для контроллера по умолчанию вызывается метод `Index`. В третьей части сегмента URL-адреса (`id`) указываются данные маршрута. Данные маршрута описаны далее в этом руководстве.

Перейдите по адресу `https://localhost:xxxx/HelloWorld/Welcome`. Метод `Welcome` запускается и возвращает строку `This is the Welcome action method...`. Для этого URL-адреса заданы контроллер `HelloWorld` и метод действия `Welcome`. Часть URL-адреса `[Parameters]` на данный момент еще не использовалась.

![Окно браузера, в котором отображается ответ "This is the Welcome action method" (Это метод действия Welcome)](~/tutorials/first-mvc-app/adding-controller/_static/welcome.png)

Измените код, чтобы передать сведения о параметрах из URL-адреса в контроллер. Например, `/HelloWorld/Welcome?name=Rick&numtimes=4`. Измените метод `Welcome`, включив два параметра, как показано в следующем коде.

[!code-csharp[](~/tutorials/first-mvc-app/start-mvc/sample/MvcMovie/Controllers/HelloWorldController.cs?name=snippet_2)]

Предыдущий код:

* Использует функцию необязательного параметра C#, указывая, что параметр `numTimes` по умолчанию принимает значение 1, если ему не было передано значение. <!-- remove for simplified -->
* Использует `HtmlEncoder.Default.Encode` для защиты приложения от злонамеренного ввода данных (JavaScript).
* Использует [интерполированные строки](/dotnet/articles/csharp/language-reference/keywords/interpolated-strings) в `$"Hello {name}, NumTimes is: {numTimes}"`. <!-- remove for simplified -->

Запустите приложение и перейдите по адресу:

   `https://localhost:xxxx/HelloWorld/Welcome?name=Rick&numtimes=4`

(Замените xxxx на номер порта.) Вы можете попробовать различные значения `name` и `numtimes` в URL-адресе. Система [привязки модели](xref:mvc/models/model-binding) MVC автоматически сопоставляет именованные параметры из строк запроса в адресной строке с параметрами метода. Дополнительные сведения см. в разделе [Привязка модели](xref:mvc/models/model-binding).

![Окно браузера, в котором отображается ответ Hello Rick (Привет, Rick); NumTimes= 4](~/tutorials/first-mvc-app/adding-controller/_static/rick4.png)

На показанном выше рисунке сегмент URL-адреса (`Parameters`) не используется, а параметры `name` и `numTimes` передаются как [строки запроса](https://wikipedia.org/wiki/Query_string). Вопросительный знак (`?`) в приведенном выше URL-адресе используется в качестве разделителя, после которого указываются строки запроса. Символ `&` разделяет строки запроса.

Замените метод `Welcome` следующим кодом:

[!code-csharp[](~/tutorials/first-mvc-app/start-mvc/sample/MvcMovie/Controllers/HelloWorldController.cs?name=snippet_3)]

Запустите приложение и введите следующий URL-адрес: `https://localhost:xxx/HelloWorld/Welcome/3?name=Rick`

На этот раз третий сегмент URL-адреса сопоставляется с параметром маршрута `id`. Метод `Welcome` содержит параметр `id`, который сопоставляется с шаблоном URL-адреса в методе `MapRoute`. Завершающий символ `?` (в `id?`) указывает, что параметр `id` является необязательным.

[!code-csharp[](~/tutorials/first-mvc-app/start-mvc/sample/MvcMovie/Startup.cs?name=snippet_1&highlight=5)]

В этих примерах контроллер реализует работу представления и контроллера в модели MVC. Контроллер возвращает HTML напрямую. Как правило, это не требуется, поскольку в этом случае заметно усложняется написание и поддержка кода. Вместо этого обычно используется отдельный файл шаблона представления Razor для создания HTML-ответа. Это будет показано в следующем руководстве.


> [!div class="step-by-step"]
> [Назад](start-mvc.md)
> [Вперед](adding-view.md)
