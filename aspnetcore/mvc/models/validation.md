---
title: Проверка модели в ASP.NET Core MVC
author: tdykstra
description: Сведения о проверке модели в ASP.NET Core MVC
ms.author: riande
ms.custom: mvc
ms.date: 01/14/2019
uid: mvc/models/validation
ms.openlocfilehash: ca7ee54b8e6b6ae5091b0cb133e448ad9c04da8f
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/01/2019
ms.locfileid: "57049071"
---
# <a name="model-validation-in-aspnet-core-mvc"></a><span data-ttu-id="7b042-103">Проверка модели в ASP.NET Core MVC</span><span class="sxs-lookup"><span data-stu-id="7b042-103">Model validation in ASP.NET Core MVC</span></span>

<span data-ttu-id="7b042-104">Автор: [Рэйчел Аппель](https://github.com/rachelappel) (Rachel Appel)</span><span class="sxs-lookup"><span data-stu-id="7b042-104">By [Rachel Appel](https://github.com/rachelappel)</span></span>

## <a name="introduction-to-model-validation"></a><span data-ttu-id="7b042-105">Общие сведения о проверке модели</span><span class="sxs-lookup"><span data-stu-id="7b042-105">Introduction to model validation</span></span>

<span data-ttu-id="7b042-106">Перед сохранением данных в базе данных приложение должно проверить их.</span><span class="sxs-lookup"><span data-stu-id="7b042-106">Before an app stores data in a database, the app must validate the data.</span></span> <span data-ttu-id="7b042-107">Данные должны быть проверены на наличие возможных угроз безопасности, правильность форматирования по типу и размеру и соответствие правилам.</span><span class="sxs-lookup"><span data-stu-id="7b042-107">Data must be checked for potential security threats, verified that it's appropriately formatted by type and size, and it must conform to your rules.</span></span> <span data-ttu-id="7b042-108">Проверка необходима, хотя она может быть избыточной, а ее реализация трудоемкой.</span><span class="sxs-lookup"><span data-stu-id="7b042-108">Validation is necessary although it can be redundant and tedious to implement.</span></span> <span data-ttu-id="7b042-109">В MVC проверка производится как в клиенте, так и на сервере.</span><span class="sxs-lookup"><span data-stu-id="7b042-109">In MVC, validation happens on both the client and server.</span></span>

<span data-ttu-id="7b042-110">К счастью, в .NET проверка абстрагирована с помощью атрибутов проверки.</span><span class="sxs-lookup"><span data-stu-id="7b042-110">Fortunately, .NET has abstracted validation into validation attributes.</span></span> <span data-ttu-id="7b042-111">Они содержат код проверки, что сокращает объем кода, который необходимо написать.</span><span class="sxs-lookup"><span data-stu-id="7b042-111">These attributes contain validation code, thereby reducing the amount of code you must write.</span></span>

<span data-ttu-id="7b042-112">В ASP.NET Core 2.2 и более поздних версиях среда выполнения ASP.NET Core игнорирует проверки (пропускает), если может определить, что графу данной модели они не требуются.</span><span class="sxs-lookup"><span data-stu-id="7b042-112">In ASP.NET Core 2.2 and later, the ASP.NET Core runtime short-circuits (skips) validation if it can determine that a given model graph doesn't require validation.</span></span> <span data-ttu-id="7b042-113">Пропуск проверки может обеспечить значительное повышение производительности при проверке моделей, которые невозможно проверить или у которых нет связанных проверяющих элементов.</span><span class="sxs-lookup"><span data-stu-id="7b042-113">Skipping validation can provide significant performance improvements when validating models that cannot or do not have any associated validators.</span></span> <span data-ttu-id="7b042-114">Проверка пропускается для объектов, таких как коллекции примитивов (`byte[]`, `string[]`, `Dictionary<string, string>` и другие) или сложные графы объектов без проверяющих элементов.</span><span class="sxs-lookup"><span data-stu-id="7b042-114">The skipped validation includes objects such as collections of primitives (`byte[]`, `string[]`, `Dictionary<string, string>`, etc.), or complex object graphs without any validators.</span></span>

<span data-ttu-id="7b042-115">[Просмотреть или скачать образец с GitHub](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/models/validation/sample).</span><span class="sxs-lookup"><span data-stu-id="7b042-115">[View or download sample from GitHub](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/models/validation/sample).</span></span>

## <a name="validation-attributes"></a><span data-ttu-id="7b042-116">Атрибуты проверки</span><span class="sxs-lookup"><span data-stu-id="7b042-116">Validation Attributes</span></span>

<span data-ttu-id="7b042-117">Атрибуты проверки — это способ настройки проверки модели таким образом, чтобы она по существу была похожа на проверку полей в таблицах базы данных.</span><span class="sxs-lookup"><span data-stu-id="7b042-117">Validation attributes are a way to configure model validation so it's similar conceptually to validation on fields in database tables.</span></span> <span data-ttu-id="7b042-118">Сюда входят ограничения, например назначение типов данных или обязательных полей.</span><span class="sxs-lookup"><span data-stu-id="7b042-118">This includes constraints such as assigning data types or required fields.</span></span> <span data-ttu-id="7b042-119">Другие виды проверок включают в себя применение шаблонов к данным, таких как шаблоны кредитной карты, номера телефона или адреса электронной почты, для реализации бизнес-правил.</span><span class="sxs-lookup"><span data-stu-id="7b042-119">Other types of validation include applying patterns to data to enforce business rules, such as a credit card, phone number, or email address.</span></span> <span data-ttu-id="7b042-120">Атрибуты проверки значительно упрощают применение таких требований.</span><span class="sxs-lookup"><span data-stu-id="7b042-120">Validation attributes make enforcing these requirements much simpler and easier to use.</span></span>

<span data-ttu-id="7b042-121">Атрибуты проверки указываются на уровне свойств.</span><span class="sxs-lookup"><span data-stu-id="7b042-121">Validation attributes are specified at the property level:</span></span> 

```csharp
[Required]
public string MyProperty { get; set; }
```

<span data-ttu-id="7b042-122">Ниже приведена аннотированная модель `Movie` из приложения, которое сохраняет сведения о фильмах и телепередачах.</span><span class="sxs-lookup"><span data-stu-id="7b042-122">Below is an annotated `Movie` model from an app that stores information about movies and TV shows.</span></span> <span data-ttu-id="7b042-123">Большинство свойств являются обязательными, а к некоторым строковым свойствам предъявляются требования к длине.</span><span class="sxs-lookup"><span data-stu-id="7b042-123">Most of the properties are required and several string properties have length requirements.</span></span> <span data-ttu-id="7b042-124">Кроме того, для свойства `Price` действует ограничение в виде числового диапазона (от 0 до 999,99 долл.), а также применяется пользовательский атрибут проверки.</span><span class="sxs-lookup"><span data-stu-id="7b042-124">Additionally, there's a numeric range restriction in place for the `Price` property from 0 to $999.99, along with a custom validation attribute.</span></span>

[!code-csharp[](validation/sample/Movie.cs?range=6-29)]

<span data-ttu-id="7b042-125">Ознакомление с моделью позволяет понять правила в отношении данных в приложении, что упрощает работу с кодом.</span><span class="sxs-lookup"><span data-stu-id="7b042-125">Simply reading through the model reveals the rules about data for this app, making it easier to maintain the code.</span></span> <span data-ttu-id="7b042-126">Ниже приведен ряд популярных встроенных атрибутов проверки.</span><span class="sxs-lookup"><span data-stu-id="7b042-126">Below are several popular built-in validation attributes:</span></span>

* <span data-ttu-id="7b042-127">`[CreditCard]`: проверяет, имеет ли свойство формат кредитной карты.</span><span class="sxs-lookup"><span data-stu-id="7b042-127">`[CreditCard]`: Validates the property has a credit card format.</span></span>

* <span data-ttu-id="7b042-128">`[Compare]`: проверяет, совпадают ли два свойства модели.</span><span class="sxs-lookup"><span data-stu-id="7b042-128">`[Compare]`: Validates two properties in a model match.</span></span>

* <span data-ttu-id="7b042-129">`[EmailAddress]`: проверяет, имеет ли свойство формат адреса электронной почты.</span><span class="sxs-lookup"><span data-stu-id="7b042-129">`[EmailAddress]`: Validates the property has an email format.</span></span>

* <span data-ttu-id="7b042-130">`[Phone]`: проверяет, имеет ли свойство формат номера телефона.</span><span class="sxs-lookup"><span data-stu-id="7b042-130">`[Phone]`: Validates the property has a telephone format.</span></span>

* <span data-ttu-id="7b042-131">`[Range]`: проверяет, находится ли значение свойства в указанном диапазоне.</span><span class="sxs-lookup"><span data-stu-id="7b042-131">`[Range]`: Validates the property value falls within the given range.</span></span>

* <span data-ttu-id="7b042-132">`[RegularExpression]`: проверяет, соответствуют ли данные указанному регулярному выражению.</span><span class="sxs-lookup"><span data-stu-id="7b042-132">`[RegularExpression]`: Validates that the data matches the specified regular expression.</span></span>

* <span data-ttu-id="7b042-133">`[Required]`: делает свойство обязательным.</span><span class="sxs-lookup"><span data-stu-id="7b042-133">`[Required]`: Makes a property required.</span></span>

* <span data-ttu-id="7b042-134">`[StringLength]`: проверяет, не превышает ли длина строкового свойства заданное максимальное значение.</span><span class="sxs-lookup"><span data-stu-id="7b042-134">`[StringLength]`: Validates that a string property has at most the given maximum length.</span></span>

* <span data-ttu-id="7b042-135">`[Url]`: проверяет, имеет ли свойство формат URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="7b042-135">`[Url]`: Validates the property has a URL format.</span></span>

<span data-ttu-id="7b042-136">MVC поддерживает любые атрибуты, производные от `ValidationAttribute`, в целях проверки.</span><span class="sxs-lookup"><span data-stu-id="7b042-136">MVC supports any attribute that derives from `ValidationAttribute` for validation purposes.</span></span> <span data-ttu-id="7b042-137">Многие полезные атрибуты проверки можно найти в пространстве имен [System.ComponentModel.DataAnnotations](/dotnet/api/system.componentmodel.dataannotations).</span><span class="sxs-lookup"><span data-stu-id="7b042-137">Many useful validation attributes can be found in the [System.ComponentModel.DataAnnotations](/dotnet/api/system.componentmodel.dataannotations) namespace.</span></span>

<span data-ttu-id="7b042-138">Возможны ситуации, когда возможностей, предоставляемых встроенными атрибутами, недостаточно.</span><span class="sxs-lookup"><span data-stu-id="7b042-138">There may be instances where you need more features than built-in attributes provide.</span></span> <span data-ttu-id="7b042-139">В таких случаях можно создать пользовательские атрибуты проверки, производные от `ValidationAttribute`, или изменить модель так, чтобы она реализовывала интерфейс `IValidatableObject`.</span><span class="sxs-lookup"><span data-stu-id="7b042-139">For those times, you can create custom validation attributes by deriving from `ValidationAttribute` or changing your model to implement `IValidatableObject`.</span></span>

## <a name="notes-on-the-use-of-the-required-attribute"></a><span data-ttu-id="7b042-140">Примечания об использовании атрибута Required</span><span class="sxs-lookup"><span data-stu-id="7b042-140">Notes on the use of the Required attribute</span></span>

<span data-ttu-id="7b042-141">[Типы значений](/dotnet/csharp/language-reference/keywords/value-types), не допускающие значение null (например, `decimal`, `int`, `float` и `DateTime`), являются обязательными и не требуют атрибута `Required`.</span><span class="sxs-lookup"><span data-stu-id="7b042-141">Non-nullable [value types](/dotnet/csharp/language-reference/keywords/value-types) (such as `decimal`, `int`, `float`, and `DateTime`) are inherently required and don't need the `Required` attribute.</span></span> <span data-ttu-id="7b042-142">Приложение не выполняет проверок на стороне сервера для не допускающих значения NULL типов, которые помечены как `Required`.</span><span class="sxs-lookup"><span data-stu-id="7b042-142">The app performs no server-side validation checks for non-nullable types that are marked `Required`.</span></span>

<span data-ttu-id="7b042-143">Привязка модели MVC, которая не связана с проверкой и атрибутами проверки, отклоняет отправленные поля формы, если они содержат пустое значение или пробел для типа, не допускающего значение NULL.</span><span class="sxs-lookup"><span data-stu-id="7b042-143">MVC model binding, which isn't concerned with validation and validation attributes, rejects a form field submission containing a missing value or whitespace for a non-nullable type.</span></span> <span data-ttu-id="7b042-144">Если целевое свойство не имеет атрибута `BindRequired`, привязка модели игнорирует отсутствие данных для типов, не допускающих значения NULL, когда поле формы отсутствует во входящих данных формы.</span><span class="sxs-lookup"><span data-stu-id="7b042-144">In the absence of a `BindRequired` attribute on the target property, model binding ignores missing data for non-nullable types, where the form field is absent from the incoming form data.</span></span>

<span data-ttu-id="7b042-145">[Атрибут BindRequired](/dotnet/api/microsoft.aspnetcore.mvc.modelbinding.bindrequiredattribute) (также см. раздел <xref:mvc/models/model-binding#customize-model-binding-behavior-with-attributes>) обеспечивает полноту ввода данных формы.</span><span class="sxs-lookup"><span data-stu-id="7b042-145">The [BindRequired attribute](/dotnet/api/microsoft.aspnetcore.mvc.modelbinding.bindrequiredattribute) (also see <xref:mvc/models/model-binding#customize-model-binding-behavior-with-attributes>) is useful to ensure form data is complete.</span></span> <span data-ttu-id="7b042-146">Если он применяется к свойству, система привязки модели требует наличия значения у этого свойства.</span><span class="sxs-lookup"><span data-stu-id="7b042-146">When applied to a property, the model binding system requires a value for that property.</span></span> <span data-ttu-id="7b042-147">Если он применяется к типу, система привязки модели требует наличия значений у всех свойств этого типа.</span><span class="sxs-lookup"><span data-stu-id="7b042-147">When applied to a type, the model binding system requires values for all of the properties of that type.</span></span>

<span data-ttu-id="7b042-148">Если вы используете [тип Nullable\<T>](/dotnet/csharp/programming-guide/nullable-types/) (например, `decimal?` или `System.Nullable<decimal>`) и помечаете его как `Required`, проверка проводится на стороне сервера так, как если бы свойство было стандартным типом, допускающим значение NULL (например, `string`).</span><span class="sxs-lookup"><span data-stu-id="7b042-148">When you use a [Nullable\<T> type](/dotnet/csharp/programming-guide/nullable-types/) (for example, `decimal?` or `System.Nullable<decimal>`) and mark it `Required`, a server-side validation check is performed as if the property were a standard nullable type (for example, a `string`).</span></span>

<span data-ttu-id="7b042-149">Проверка на стороне клиента требует значения для поля формы, соответствующего свойству модели, которой помечено как `Required`, и для не допускающего значения NULL свойства, которое не помечено как `Required`.</span><span class="sxs-lookup"><span data-stu-id="7b042-149">Client-side validation requires a value for a form field that corresponds to a model property that you've marked `Required` and for a non-nullable type property that you haven't marked `Required`.</span></span> <span data-ttu-id="7b042-150">Атрибут `Required` можно использовать для управления сообщением об ошибке проверки на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="7b042-150">`Required` can be used to control the client-side validation error message.</span></span>

::: moniker range=">= aspnetcore-2.1"

## <a name="top-level-node-validation"></a><span data-ttu-id="7b042-151">Проверка узлов верхнего уровня</span><span class="sxs-lookup"><span data-stu-id="7b042-151">Top-level node validation</span></span>

<span data-ttu-id="7b042-152">Узлы верхнего уровня содержат:</span><span class="sxs-lookup"><span data-stu-id="7b042-152">Top-level nodes include:</span></span>

* <span data-ttu-id="7b042-153">параметры действия;</span><span class="sxs-lookup"><span data-stu-id="7b042-153">Action parameters</span></span>
* <span data-ttu-id="7b042-154">свойства контроллера;</span><span class="sxs-lookup"><span data-stu-id="7b042-154">Controller properties</span></span>
* <span data-ttu-id="7b042-155">параметры обработчика страниц;</span><span class="sxs-lookup"><span data-stu-id="7b042-155">Page handler parameters</span></span>
* <span data-ttu-id="7b042-156">свойства страничной модели.</span><span class="sxs-lookup"><span data-stu-id="7b042-156">Page model properties</span></span>

<span data-ttu-id="7b042-157">Проверка привязанных к модели узлов верхнего уровня осуществляется наряду с проверкой свойств модели.</span><span class="sxs-lookup"><span data-stu-id="7b042-157">Model-bound top-level nodes are validated in addition to validating model properties.</span></span> <span data-ttu-id="7b042-158">В следующем примере, взятом из примера приложения, метод `VerifyPhone` использует класс <xref:System.ComponentModel.DataAnnotations.RegularExpressionAttribute> для проверки данных пользователя в поле "Phone" (Номер телефона) в форме.</span><span class="sxs-lookup"><span data-stu-id="7b042-158">In the following example from the sample app, the `VerifyPhone` method uses the <xref:System.ComponentModel.DataAnnotations.RegularExpressionAttribute> to validate the user data in the Phone field of a form:</span></span>

[!code-csharp[](validation/sample/UsersController.cs?name=snippet_VerifyPhone)]

<span data-ttu-id="7b042-159">Узлы верхнего уровня могут применять класс <xref:Microsoft.AspNetCore.Mvc.ModelBinding.BindRequiredAttribute> с атрибутами проверки.</span><span class="sxs-lookup"><span data-stu-id="7b042-159">Top-level nodes can use <xref:Microsoft.AspNetCore.Mvc.ModelBinding.BindRequiredAttribute> with validation attributes.</span></span> <span data-ttu-id="7b042-160">В следующем примере, взятом из примера приложения, метод `CheckAge` указывает, что при отправке формы параметр `age` должен быть привязан из строки запроса.</span><span class="sxs-lookup"><span data-stu-id="7b042-160">In the following example from the sample app, the `CheckAge` method specifies that the `age` parameter must be bound from the query string when the form is submitted:</span></span>

[!code-csharp[](validation/sample/UsersController.cs?name=snippet_CheckAge)]

<span data-ttu-id="7b042-161">На странице "Check Age" (Проверка возраста) (*CheckAge.cshtml*) находятся две формы.</span><span class="sxs-lookup"><span data-stu-id="7b042-161">In the Check Age page (*CheckAge.cshtml*), there are two forms.</span></span> <span data-ttu-id="7b042-162">Первая форма отправляет значение `Age`, равное `99`, в виде строки запроса: `https://localhost:5001/Users/CheckAge?Age=99`.</span><span class="sxs-lookup"><span data-stu-id="7b042-162">The first form submits an `Age` value of `99` as a query string: `https://localhost:5001/Users/CheckAge?Age=99`.</span></span>

<span data-ttu-id="7b042-163">Если из строки запроса отправлен параметр `age` в правильном формате, форма проходит проверку.</span><span class="sxs-lookup"><span data-stu-id="7b042-163">When a properly formatted `age` parameter from the query string is submitted, the form validates.</span></span>

<span data-ttu-id="7b042-164">Вторая форма на странице "Check Age" (Проверка возраста) отправляет значение `Age` в теле запроса, и проверка завершается сбоем.</span><span class="sxs-lookup"><span data-stu-id="7b042-164">The second form on the Check Age page submits the `Age` value in the body of the request, and validation fails.</span></span> <span data-ttu-id="7b042-165">Ошибка привязки связана с тем, что параметр `age` должен поступать из строки запроса.</span><span class="sxs-lookup"><span data-stu-id="7b042-165">Binding fails because the `age` parameter must come from a query string.</span></span>

<span data-ttu-id="7b042-166">Проверка включена по умолчанию и управляется свойством <xref:Microsoft.AspNetCore.Mvc.MvcOptions.AllowValidatingTopLevelNodes*> класса <xref:Microsoft.AspNetCore.Mvc.MvcOptions>.</span><span class="sxs-lookup"><span data-stu-id="7b042-166">Validation is enabled by default and controlled by the <xref:Microsoft.AspNetCore.Mvc.MvcOptions.AllowValidatingTopLevelNodes*> property of <xref:Microsoft.AspNetCore.Mvc.MvcOptions>.</span></span> <span data-ttu-id="7b042-167">Чтобы отключить проверку узлов верхнего уровня, в параметрах MVC (`Startup.ConfigureServices`) задайте свойству `AllowValidatingTopLevelNodes` значение `false`.</span><span class="sxs-lookup"><span data-stu-id="7b042-167">To disable top-level node validation, set `AllowValidatingTopLevelNodes` to `false` in MVC options (`Startup.ConfigureServices`):</span></span>

[!code-csharp[](validation/sample_snapshot/Startup.cs?name=snippet_AddMvc&highlight=4)]

::: moniker-end

## <a name="model-state"></a><span data-ttu-id="7b042-168">Состояние модели</span><span class="sxs-lookup"><span data-stu-id="7b042-168">Model State</span></span>

<span data-ttu-id="7b042-169">Состояние модели представляет ошибки проверки в переданных значениях HTML-формы.</span><span class="sxs-lookup"><span data-stu-id="7b042-169">Model state represents validation errors in submitted HTML form values.</span></span>

<span data-ttu-id="7b042-170">MVC будет продолжать проверять поля, пока не достигнет максимального числа ошибок (по умолчанию 200).</span><span class="sxs-lookup"><span data-stu-id="7b042-170">MVC will continue validating fields until it reaches the maximum number of errors (200 by default).</span></span> <span data-ttu-id="7b042-171">Это число можно изменить с помощью следующего кода в `Startup.ConfigureServices`:</span><span class="sxs-lookup"><span data-stu-id="7b042-171">You can configure this number with the following code in `Startup.ConfigureServices`:</span></span>

[!code-csharp[](validation/sample/Startup.cs?name=snippet_MaxModelValidationErrors)]

## <a name="handle-model-state-errors"></a><span data-ttu-id="7b042-172">Обработка ошибок состояния модели</span><span class="sxs-lookup"><span data-stu-id="7b042-172">Handle Model State errors</span></span>

<span data-ttu-id="7b042-173">Проверка модели проводится перед выполнением действия контроллера.</span><span class="sxs-lookup"><span data-stu-id="7b042-173">Model validation occurs before the execution of a controller action.</span></span> <span data-ttu-id="7b042-174">Действие отвечает за проверку `ModelState.IsValid` и реагирует соответствующим образом.</span><span class="sxs-lookup"><span data-stu-id="7b042-174">It's the action's responsibility to inspect `ModelState.IsValid` and react appropriately.</span></span> <span data-ttu-id="7b042-175">Во многих случаях правильной реакцией является возврат ответа об ошибке, который в идеале должен содержать сведения о причине непройденной проверки модели.</span><span class="sxs-lookup"><span data-stu-id="7b042-175">In many cases, the appropriate reaction is to return an error response, ideally detailing the reason why model validation failed.</span></span>

::: moniker range=">= aspnetcore-2.1"

<span data-ttu-id="7b042-176">Когда `ModelState.IsValid` принимает значение `false` в контроллерах веб-API, использующих атрибут `[ApiController]`, возвращается автоматический отклик HTTP 400, содержащий подробные сведения о проблеме.</span><span class="sxs-lookup"><span data-stu-id="7b042-176">When `ModelState.IsValid` evaluates to `false` in web API controllers using the `[ApiController]` attribute, an automatic HTTP 400 response containing issue details is returned.</span></span> <span data-ttu-id="7b042-177">Дополнительные сведения см. в разделе [Автоматические отклики HTTP 400](xref:web-api/index#automatic-http-400-responses).</span><span class="sxs-lookup"><span data-stu-id="7b042-177">For more information, see [Automatic HTTP 400 responses](xref:web-api/index#automatic-http-400-responses).</span></span>

::: moniker-end

<span data-ttu-id="7b042-178">В некоторых приложениях соблюдается стандартное соглашение об обработке ошибок проверки модели. В этом случае подходящим местом для реализации такой политики может быть фильтр.</span><span class="sxs-lookup"><span data-stu-id="7b042-178">Some apps will choose to follow a standard convention for dealing with model validation errors, in which case a filter may be an appropriate place to implement such a policy.</span></span> <span data-ttu-id="7b042-179">Следует проверить, как выполняются действия при допустимых и недопустимых состояниях модели.</span><span class="sxs-lookup"><span data-stu-id="7b042-179">You should test how your actions behave with valid and invalid model states.</span></span>

## <a name="manual-validation"></a><span data-ttu-id="7b042-180">Проверка вручную</span><span class="sxs-lookup"><span data-stu-id="7b042-180">Manual validation</span></span>

<span data-ttu-id="7b042-181">После выполнения привязки и проверки модели может потребоваться повторить некоторые части этого процесса.</span><span class="sxs-lookup"><span data-stu-id="7b042-181">After model binding and validation are complete, you may want to repeat parts of it.</span></span> <span data-ttu-id="7b042-182">Например, пользователь мог ввести текст в поле, требующем целочисленного значения, или необходимо вычислить значение для свойства модели.</span><span class="sxs-lookup"><span data-stu-id="7b042-182">For example, a user may have entered text in a field expecting an integer, or you may need to compute a value for a model's property.</span></span>

<span data-ttu-id="7b042-183">В этом случае может потребоваться выполнить проверку вручную.</span><span class="sxs-lookup"><span data-stu-id="7b042-183">You may need to run validation manually.</span></span> <span data-ttu-id="7b042-184">Для этого вызовите метод `TryValidateModel`, как показано ниже.</span><span class="sxs-lookup"><span data-stu-id="7b042-184">To do so, call the `TryValidateModel` method, as shown here:</span></span>

[!code-csharp[](validation/sample/MoviesController.cs?name=snippet_TryValidateModel)]

## <a name="custom-validation"></a><span data-ttu-id="7b042-185">Пользовательская проверка</span><span class="sxs-lookup"><span data-stu-id="7b042-185">Custom validation</span></span>

<span data-ttu-id="7b042-186">Атрибуты проверки удовлетворяют большинство потребностей.</span><span class="sxs-lookup"><span data-stu-id="7b042-186">Validation attributes work for most validation needs.</span></span> <span data-ttu-id="7b042-187">Однако некоторые правила проверки могут быть характерны только для вашей организации.</span><span class="sxs-lookup"><span data-stu-id="7b042-187">However, some validation rules are specific to your business.</span></span> <span data-ttu-id="7b042-188">Ваши правила могут не относиться к стандартным способам проверки данных, таким как настройка поля как обязательного или обеспечение вхождения его значения в определенный диапазон.</span><span class="sxs-lookup"><span data-stu-id="7b042-188">Your rules might not be common data validation techniques such as ensuring a field is required or that it conforms to a range of values.</span></span> <span data-ttu-id="7b042-189">В таких ситуациях отличным решением являются пользовательские атрибуты проверки.</span><span class="sxs-lookup"><span data-stu-id="7b042-189">For these scenarios, custom validation attributes are a great solution.</span></span> <span data-ttu-id="7b042-190">Создать собственные атрибуты проверки в MVC легко.</span><span class="sxs-lookup"><span data-stu-id="7b042-190">Creating your own custom validation attributes in MVC is easy.</span></span> <span data-ttu-id="7b042-191">Просто создайте атрибут, производный от `ValidationAttribute`, и переопределите метод `IsValid`.</span><span class="sxs-lookup"><span data-stu-id="7b042-191">Just inherit from the `ValidationAttribute`, and override the `IsValid` method.</span></span> <span data-ttu-id="7b042-192">Метод `IsValid` принимает два параметра: объект с именем *value* и объект `ValidationContext` с именем *validationContext*.</span><span class="sxs-lookup"><span data-stu-id="7b042-192">The `IsValid` method accepts two parameters, the first is an object named *value* and the second is a `ValidationContext` object named *validationContext*.</span></span> <span data-ttu-id="7b042-193">Объект *Value* ссылается на фактическое значение поля, которое проверяет пользовательский атрибут проверки.</span><span class="sxs-lookup"><span data-stu-id="7b042-193">*Value* refers to the actual value from the field that your custom validator is validating.</span></span>

<span data-ttu-id="7b042-194">Согласно бизнес-правилу, в приведенном ниже примере пользователи не могут выбирать жанр *Classic* (Классическое) для фильмов, вышедших после 1960 года.</span><span class="sxs-lookup"><span data-stu-id="7b042-194">In the following sample, a business rule states that users may not set the genre to *Classic* for a movie released after 1960.</span></span> <span data-ttu-id="7b042-195">Атрибут `[ClassicMovie]` сначала проверяет жанр, а затем, если он имеет значение Classic, проверяет дату выхода: позднее ли она 1960 года.</span><span class="sxs-lookup"><span data-stu-id="7b042-195">The `[ClassicMovie]` attribute checks the genre first, and if it's a classic, then it checks the release date to see that it's later than 1960.</span></span> <span data-ttu-id="7b042-196">Если фильм вышел после 1960 года, проверка завершается неудачно.</span><span class="sxs-lookup"><span data-stu-id="7b042-196">If it's released after 1960, validation fails.</span></span> <span data-ttu-id="7b042-197">Атрибут принимает целочисленный параметр, представляющий год, который можно использовать для проверки данных.</span><span class="sxs-lookup"><span data-stu-id="7b042-197">The attribute accepts an integer parameter representing the year that you can use to validate data.</span></span> <span data-ttu-id="7b042-198">Значение параметра можно получать в конструкторе атрибута, как показано ниже.</span><span class="sxs-lookup"><span data-stu-id="7b042-198">You can capture the value of the parameter in the attribute's constructor, as shown here:</span></span>

[!code-csharp[](validation/sample/ClassicMovieAttribute.cs?name=snippet_ClassicMovieAttribute)]

<span data-ttu-id="7b042-199">Приведенная выше переменная `movie` представляет объект `Movie`, который содержит проверяемые данные из переданной формы.</span><span class="sxs-lookup"><span data-stu-id="7b042-199">The `movie` variable above represents a `Movie` object that contains the data from the form submission to validate.</span></span> <span data-ttu-id="7b042-200">В этом случае код проверки проверяет дату и жанр в методе `IsValid` класса `ClassicMovieAttribute` согласно правилам.</span><span class="sxs-lookup"><span data-stu-id="7b042-200">In this case, the validation code checks the date and genre in the `IsValid` method of the `ClassicMovieAttribute` class as per the rules.</span></span> <span data-ttu-id="7b042-201">После успешной проверки `IsValid` возвращает код `ValidationResult.Success`.</span><span class="sxs-lookup"><span data-stu-id="7b042-201">Upon successful validation ,`IsValid` returns a `ValidationResult.Success` code.</span></span> <span data-ttu-id="7b042-202">Если проверка завершается неудачно, возвращается `ValidationResult` с сообщением об ошибке:</span><span class="sxs-lookup"><span data-stu-id="7b042-202">When validation fails, a `ValidationResult` with an error message is returned:</span></span>

[!code-csharp[](validation/sample/ClassicMovieAttribute.cs?name=snippet_GetErrorMessage)]

<span data-ttu-id="7b042-203">Когда пользователь изменяет поле `Genre` и отправляет форму, метод `IsValid` атрибута `ClassicMovieAttribute` проверяет, является ли фильм классическим.</span><span class="sxs-lookup"><span data-stu-id="7b042-203">When a user modifies the `Genre` field and submits the form, the `IsValid` method of the `ClassicMovieAttribute` will verify whether the movie is a classic.</span></span> <span data-ttu-id="7b042-204">Как и в случае с любым встроенным атрибутом, атрибут `ClassicMovieAttribute` следует применять к свойству, например `ReleaseDate`, для проведения проверки, как показано в предыдущем примере кода.</span><span class="sxs-lookup"><span data-stu-id="7b042-204">Like any built-in attribute, apply the `ClassicMovieAttribute` to a property such as `ReleaseDate` to ensure validation happens, as shown in the previous code sample.</span></span> <span data-ttu-id="7b042-205">Так как этот пример работает только с типами `Movie`, лучше использовать интерфейс `IValidatableObject`, как описано в следующем абзаце.</span><span class="sxs-lookup"><span data-stu-id="7b042-205">Since the example works only with `Movie` types, a better option is to use `IValidatableObject` as shown in the following paragraph.</span></span>

<span data-ttu-id="7b042-206">Кроме того, этот же код можно добавить в модель, реализовав метод `Validate` интерфейса `IValidatableObject`.</span><span class="sxs-lookup"><span data-stu-id="7b042-206">Alternatively, this same code could be placed in the model by implementing the `Validate` method on the `IValidatableObject` interface.</span></span> <span data-ttu-id="7b042-207">Пользовательские атрибуты проверки хорошо подходят для проверки отдельных свойств, но для реализации проверки на уровне класса можно реализовать интерфейс `IValidatableObject`.</span><span class="sxs-lookup"><span data-stu-id="7b042-207">While custom validation attributes work well for validating individual properties, implementing `IValidatableObject` can be used to implement class-level validation:</span></span>

[!code-csharp[](validation/sample/MovieIValidatable.cs?name=snippet&highlight=1,26-34)]

## <a name="client-side-validation"></a><span data-ttu-id="7b042-208">Проверка на стороне клиента</span><span class="sxs-lookup"><span data-stu-id="7b042-208">Client side validation</span></span>

<span data-ttu-id="7b042-209">Проверка на стороне клиента очень удобна для пользователей.</span><span class="sxs-lookup"><span data-stu-id="7b042-209">Client side validation is a great convenience for users.</span></span> <span data-ttu-id="7b042-210">Она экономит время, которое в противном случае тратилось бы на круговой путь к серверу.</span><span class="sxs-lookup"><span data-stu-id="7b042-210">It saves time they would otherwise spend waiting for a round trip to the server.</span></span> <span data-ttu-id="7b042-211">С точки зрения бизнеса, даже доли секунды, умножаемые в сотни раз каждый день, позволяют значительно сократить расходуемое время, деньги и усилия.</span><span class="sxs-lookup"><span data-stu-id="7b042-211">In business terms, even a few fractions of seconds multiplied hundreds of times each day adds up to be a lot of time, expense, and frustration.</span></span> <span data-ttu-id="7b042-212">Простая и немедленная проверка позволяет пользователям работать эффективнее и повышает точность входных и выходных данных.</span><span class="sxs-lookup"><span data-stu-id="7b042-212">Straightforward and immediate validation enables users to work more efficiently and produce better quality input and output.</span></span>

<span data-ttu-id="7b042-213">Для проверки на стороне клиента необходимо иметь представление с правильными ссылками на скрипты JavaScript, как показано ниже.</span><span class="sxs-lookup"><span data-stu-id="7b042-213">You must have a view with the proper JavaScript script references in place for client-side validation to work as you see here.</span></span>

[!code-cshtml[](validation/sample/Views/Shared/_Layout.cshtml?name=snippet_ScriptTag)]

[!code-cshtml[](validation/sample/Views/Shared/_ValidationScriptsPartial.cshtml)]

<span data-ttu-id="7b042-214">Скрипт [ненавязчивой проверки jQuery](https://github.com/aspnet/jquery-validation-unobtrusive) — это настраиваемая интерфейсная библиотека Майкрософт, которая основана на популярном подключаемом модуле [jQuery Validate](https://jqueryvalidation.org/).</span><span class="sxs-lookup"><span data-stu-id="7b042-214">The [jQuery Unobtrusive Validation](https://github.com/aspnet/jquery-validation-unobtrusive) script is a custom Microsoft front-end library that builds on the popular [jQuery Validate](https://jqueryvalidation.org/) plugin.</span></span> <span data-ttu-id="7b042-215">Без скрипта ненавязчивой проверки jQuery одну и ту же логику проверки приходилось бы реализовывать в двух местах: в атрибутах проверки для свойств модели на стороне сервера, а затем еще раз в скриптах на стороне клиента (примеры метода [`validate()`](https://jqueryvalidation.org/validate/) jQuery Validate демонстрируют, насколько сложным это может быть).</span><span class="sxs-lookup"><span data-stu-id="7b042-215">Without jQuery Unobtrusive Validation, you would have to code the same validation logic in two places: once in the server side validation attributes on model properties, and then again in client side scripts (the examples for jQuery Validate's [`validate()`](https://jqueryvalidation.org/validate/) method shows how complex this could become).</span></span> <span data-ttu-id="7b042-216">Вместо этого [вспомогательные функции тегов](xref:mvc/views/tag-helpers/intro) и [вспомогательные функции HTML](xref:mvc/views/overview) платформы MVC могут использовать атрибуты проверки и метаданные типов из свойств модели для обработки [атрибутов данных](http://w3c.github.io/html/dom.html#embedding-custom-non-visible-data-with-the-data-attributes) HTML 5 в элементах форм, требующих проверки.</span><span class="sxs-lookup"><span data-stu-id="7b042-216">Instead, MVC's [Tag Helpers](xref:mvc/views/tag-helpers/intro) and [HTML helpers](xref:mvc/views/overview) are able to use the validation attributes and type metadata from model properties to render HTML 5 [data- attributes](http://w3c.github.io/html/dom.html#embedding-custom-non-visible-data-with-the-data-attributes) in the form elements that need validation.</span></span> <span data-ttu-id="7b042-217">MVC создает атрибуты `data-` как для встроенных, так и для пользовательских атрибутов.</span><span class="sxs-lookup"><span data-stu-id="7b042-217">MVC generates the `data-` attributes for both built-in and custom attributes.</span></span> <span data-ttu-id="7b042-218">Затем скрипт ненавязчивой проверки jQuery анализирует эти атрибуты `data-` и передает логику в подключаемый модуль jQuery Validate, по сути копируя логику проверки на стороне сервера в клиент.</span><span class="sxs-lookup"><span data-stu-id="7b042-218">jQuery Unobtrusive Validation then parses the `data-` attributes and passes the logic to jQuery Validate, effectively "copying" the server side validation logic to the client.</span></span> <span data-ttu-id="7b042-219">Ошибки проверки могут выводиться в клиенте с помощью соответствующих вспомогательных функций тегов, как показано ниже.</span><span class="sxs-lookup"><span data-stu-id="7b042-219">You can display validation errors on the client using the relevant tag helpers as shown here:</span></span>

[!code-cshtml[](validation/sample/Views/Movies/Create.cshtml?name=snippet_ReleaseDate&highlight=4-5)]

<span data-ttu-id="7b042-220">Приведенные выше вспомогательные функции тегов обрабатывают представленный ниже код HTML.</span><span class="sxs-lookup"><span data-stu-id="7b042-220">The tag helpers above render the HTML below.</span></span> <span data-ttu-id="7b042-221">Обратите внимание на то, что атрибуты `data-` в выходных данных HTML соответствуют атрибутам проверки для свойства `ReleaseDate`.</span><span class="sxs-lookup"><span data-stu-id="7b042-221">Notice that the `data-` attributes in the HTML output correspond to the validation attributes for the `ReleaseDate` property.</span></span> <span data-ttu-id="7b042-222">Приведенный ниже атрибут `data-val-required` содержит сообщение об ошибке, которое выводится, если пользователь не заполнил поле даты выхода.</span><span class="sxs-lookup"><span data-stu-id="7b042-222">The `data-val-required` attribute below contains an error message to display if the user doesn't fill in the release date field.</span></span> <span data-ttu-id="7b042-223">Скрипт ненавязчивой проверки jQuery передает это значение в метод [`required()`](https://jqueryvalidation.org/required-method/) подключаемого модуля jQuery Validate, который затем выводит это сообщение в соответствующем элементе **\<span>**.</span><span class="sxs-lookup"><span data-stu-id="7b042-223">jQuery Unobtrusive Validation passes this value to the jQuery Validate [`required()`](https://jqueryvalidation.org/required-method/) method, which then displays that message in the accompanying **\<span>** element.</span></span>

```html
<form action="/Movies/Create" method="post">
    <div class="form-horizontal">
        <h4>Movie</h4>
        <div class="text-danger"></div>
        <div class="form-group">
            <label class="col-md-2 control-label" for="ReleaseDate">ReleaseDate</label>
            <div class="col-md-10">
                <input class="form-control" type="datetime"
                data-val="true" data-val-required="The ReleaseDate field is required."
                id="ReleaseDate" name="ReleaseDate" value="" />
                <span class="text-danger field-validation-valid"
                data-valmsg-for="ReleaseDate" data-valmsg-replace="true"></span>
            </div>
        </div>
    </div>
</form>
```

<span data-ttu-id="7b042-224">Проверка на стороне клиента не позволяет отправлять форму, пока ее данные не будут допустимыми.</span><span class="sxs-lookup"><span data-stu-id="7b042-224">Client-side validation prevents submission until the form is valid.</span></span> <span data-ttu-id="7b042-225">При нажатии кнопки "Отправить" выполняется код JavaScript, который либо отправляет форму, либо выводит сообщения об ошибках.</span><span class="sxs-lookup"><span data-stu-id="7b042-225">The Submit button runs JavaScript that either submits the form or displays error messages.</span></span>

<span data-ttu-id="7b042-226">MVC определяет значения атрибутов типа на основе типа данных .NET свойства, который может быть переопределен с помощью атрибутов `[DataType]`.</span><span class="sxs-lookup"><span data-stu-id="7b042-226">MVC determines type attribute values based on the .NET data type of a property, possibly overridden using `[DataType]` attributes.</span></span> <span data-ttu-id="7b042-227">Базовый атрибут `[DataType]` не выполняет реальную проверку на стороне сервера.</span><span class="sxs-lookup"><span data-stu-id="7b042-227">The base `[DataType]` attribute does no real server-side validation.</span></span> <span data-ttu-id="7b042-228">Браузеры выбирают свои сообщения об ошибках и выводят их предпочтительным способом, однако пакет ненавязчивой проверки jQuery может переопределять эти сообщения и отображать их единообразно.</span><span class="sxs-lookup"><span data-stu-id="7b042-228">Browsers choose their own error messages and display those errors as they wish, however the jQuery Validation Unobtrusive package can override the messages and display them consistently with others.</span></span> <span data-ttu-id="7b042-229">Это особенно очевидно проявляется, когда пользователи применяют подклассы `[DataType]`, такие как `[EmailAddress]`.</span><span class="sxs-lookup"><span data-stu-id="7b042-229">This happens most obviously when users apply `[DataType]` subclasses such as `[EmailAddress]`.</span></span>

### <a name="add-validation-to-dynamic-forms"></a><span data-ttu-id="7b042-230">Добавление проверки к динамическим формам</span><span class="sxs-lookup"><span data-stu-id="7b042-230">Add Validation to Dynamic Forms</span></span>

<span data-ttu-id="7b042-231">Так как скрипт ненавязчивой проверки jQuery передает логику и параметры проверки в подключаемый модуль jQuery Validate при первой загрузке страницы, динамически создаваемые формы не подвергаются проверке автоматически.</span><span class="sxs-lookup"><span data-stu-id="7b042-231">Because jQuery Unobtrusive Validation passes validation logic and parameters to jQuery Validate when the page first loads, dynamically generated forms won't automatically exhibit validation.</span></span> <span data-ttu-id="7b042-232">Необходимо указать, что скрипт ненавязчивой проверки jQuery должен анализировать динамическую форму сразу после ее создания.</span><span class="sxs-lookup"><span data-stu-id="7b042-232">Instead, you must tell jQuery Unobtrusive Validation to parse the dynamic form immediately after creating it.</span></span> <span data-ttu-id="7b042-233">Например, приведенный ниже код показывает, как можно настроить проверку на стороне клиента для формы, добавленной посредством AJAX.</span><span class="sxs-lookup"><span data-stu-id="7b042-233">For example, the code below shows how you might set up client side validation on a form added via AJAX.</span></span>

```js
$.get({
    url: "https://url/that/returns/a/form",
    dataType: "html",
    error: function(jqXHR, textStatus, errorThrown) {
        alert(textStatus + ": Couldn't add form. " + errorThrown);
    },
    success: function(newFormHTML) {
        var container = document.getElementById("form-container");
        container.insertAdjacentHTML("beforeend", newFormHTML);
        var forms = container.getElementsByTagName("form");
        var newForm = forms[forms.length - 1];
        $.validator.unobtrusive.parse(newForm);
    }
})
```

<span data-ttu-id="7b042-234">Метод `$.validator.unobtrusive.parse()` принимает селектор jQuery в качестве единственного аргумента.</span><span class="sxs-lookup"><span data-stu-id="7b042-234">The `$.validator.unobtrusive.parse()` method accepts a jQuery selector for its one argument.</span></span> <span data-ttu-id="7b042-235">Этот метод предписывает скрипту ненавязчивой проверки jQuery анализировать атрибуты `data-` форм в этом селекторе.</span><span class="sxs-lookup"><span data-stu-id="7b042-235">This method tells jQuery Unobtrusive Validation to parse the `data-` attributes of forms within that selector.</span></span> <span data-ttu-id="7b042-236">Значения этих атрибутов затем передаются в подключаемый модуль jQuery Validate для применения к форме требуемых правил проверки на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="7b042-236">The values of those attributes are then passed to the jQuery Validate plugin so that the form exhibits the desired client side validation rules.</span></span>

### <a name="add-validation-to-dynamic-controls"></a><span data-ttu-id="7b042-237">Добавление проверки к динамическим элементам управления</span><span class="sxs-lookup"><span data-stu-id="7b042-237">Add Validation to Dynamic Controls</span></span>

<span data-ttu-id="7b042-238">Вы также можете обновлять правила проверки для формы при динамическом создании отдельных элементов управления, таких как `<input/>` и `<select/>`.</span><span class="sxs-lookup"><span data-stu-id="7b042-238">You can also update the validation rules on a form when individual controls, such as `<input/>`s and `<select/>`s, are dynamically generated.</span></span> <span data-ttu-id="7b042-239">Селекторы для этих элементов нельзя передавать в метод `parse()` напрямую, так как содержащая форма уже проанализирована и не обновится.</span><span class="sxs-lookup"><span data-stu-id="7b042-239">You cannot pass selectors for these elements to the `parse()` method directly because the surrounding form has already been parsed and won't update.</span></span> <span data-ttu-id="7b042-240">Вместо этого нужно сначала удалить имеющиеся данные проверки, а затем повторно проанализировать всю форму, как показано ниже.</span><span class="sxs-lookup"><span data-stu-id="7b042-240">Instead, you first remove the existing validation data, then reparse the entire form, as shown below:</span></span>

```js
$.get({
    url: "https://url/that/returns/a/control",
    dataType: "html",
    error: function(jqXHR, textStatus, errorThrown) {
        alert(textStatus + ": Couldn't add control. " + errorThrown);
    },
    success: function(newInputHTML) {
        var form = document.getElementById("my-form");
        form.insertAdjacentHTML("beforeend", newInputHTML);
        $(form).removeData("validator")    // Added by jQuery Validate
               .removeData("unobtrusiveValidation");   // Added by jQuery Unobtrusive Validation
        $.validator.unobtrusive.parse(form);
    }
})
```

## <a name="iclientmodelvalidator"></a><span data-ttu-id="7b042-241">IClientModelValidator</span><span class="sxs-lookup"><span data-stu-id="7b042-241">IClientModelValidator</span></span>

<span data-ttu-id="7b042-242">Вы можете создать логику на стороне клиента для пользовательского атрибута, и скрипт [ненавязчивой проверки](http://bradwilson.typepad.com/blog/2010/10/mvc3-unobtrusive-validation.html), который создает адаптер для [проверки jquery](http://jqueryvalidation.org/documentation/), будет автоматически выполнять ее в клиенте в рамках проверки.</span><span class="sxs-lookup"><span data-stu-id="7b042-242">You may create client side logic for your custom attribute, and [unobtrusive validation](http://bradwilson.typepad.com/blog/2010/10/mvc3-unobtrusive-validation.html) which creates an adapter to [jquery validation](http://jqueryvalidation.org/documentation/) will execute it on the client for you automatically as part of validation.</span></span> <span data-ttu-id="7b042-243">Сначала нужно определить добавляемые атрибуты data-, реализовав интерфейс `IClientModelValidator`, как показано ниже.</span><span class="sxs-lookup"><span data-stu-id="7b042-243">The first step is to control what data- attributes are added by implementing the `IClientModelValidator` interface as shown here:</span></span>

[!code-csharp[](validation/sample/ClassicMovieAttribute.cs?name=snippet_AddValidation)]

<span data-ttu-id="7b042-244">Атрибуты, реализующие этот интерфейс, могут добавлять атрибуты HTML в создаваемые поля.</span><span class="sxs-lookup"><span data-stu-id="7b042-244">Attributes that implement this interface can add HTML attributes to generated fields.</span></span> <span data-ttu-id="7b042-245">Если изучить выходные данные элемента `ReleaseDate`, то можно обнаружить код HTML, очень похожий на код из предыдущего примера, за тем исключением, что теперь есть атрибут `data-val-classicmovie`, который был определен в методе `AddValidation` интерфейса `IClientModelValidator`.</span><span class="sxs-lookup"><span data-stu-id="7b042-245">Examining the output for the `ReleaseDate` element reveals HTML that's similar to the previous example, except now there's a `data-val-classicmovie` attribute that was defined in the `AddValidation` method of `IClientModelValidator`.</span></span>

```html
<input class="form-control" type="datetime"
    data-val="true"
    data-val-classicmovie="Classic movies must have a release year earlier than 1960."
    data-val-classicmovie-year="1960"
    data-val-required="The ReleaseDate field is required."
    id="ReleaseDate" name="ReleaseDate" value="" />
```

<span data-ttu-id="7b042-246">При ненавязчивой проверке данные из атрибутов `data-` используются для вывода сообщений об ошибках.</span><span class="sxs-lookup"><span data-stu-id="7b042-246">Unobtrusive validation uses the data in the `data-` attributes to display error messages.</span></span> <span data-ttu-id="7b042-247">Однако правила или сообщения неизвестны jQuery, пока вы не добавите их в объект `validator` jQuery.</span><span class="sxs-lookup"><span data-stu-id="7b042-247">However, jQuery doesn't know about rules or messages until you add them to jQuery's `validator` object.</span></span> <span data-ttu-id="7b042-248">Это демонстрируется в следующем примере, который добавляет пользовательский метод проверки клиента `classicmovie` в объект jQuery `validator`.</span><span class="sxs-lookup"><span data-stu-id="7b042-248">This is shown in the following example, which adds a custom `classicmovie` client validation method to the jQuery `validator` object.</span></span> <span data-ttu-id="7b042-249">Объяснение метода `unobtrusive.adapters.add` см. в руководстве по [ненавязчивой клиентской проверке в ASP.NET MVC](http://bradwilson.typepad.com/blog/2010/10/mvc3-unobtrusive-validation.html).</span><span class="sxs-lookup"><span data-stu-id="7b042-249">For an explanation of the `unobtrusive.adapters.add` method, see [Unobtrusive Client Validation in ASP.NET MVC](http://bradwilson.typepad.com/blog/2010/10/mvc3-unobtrusive-validation.html).</span></span>

[!code-javascript[](validation/sample/Views/Movies/Create.cshtml?name=snippet_UnobtrusiveValidation)]

<span data-ttu-id="7b042-250">В приведенном выше коде метод `classicmovie` выполняет на стороне клиента проверку даты выпуска фильма.</span><span class="sxs-lookup"><span data-stu-id="7b042-250">With the preceding code, the `classicmovie` method performs client-side validation on the movie release date.</span></span> <span data-ttu-id="7b042-251">Если этот метод возвращает `false`, отображается сообщение об ошибке.</span><span class="sxs-lookup"><span data-stu-id="7b042-251">The error message displays if the method returns `false`.</span></span>

## <a name="remote-validation"></a><span data-ttu-id="7b042-252">Удаленная проверка</span><span class="sxs-lookup"><span data-stu-id="7b042-252">Remote validation</span></span>

<span data-ttu-id="7b042-253">Удаленная проверка — это отличная возможность для тех случаев, когда необходимо проверить данные в клиенте, сравнив их с данными на сервере.</span><span class="sxs-lookup"><span data-stu-id="7b042-253">Remote validation is a great feature to use when you need to validate data on the client against data on the server.</span></span> <span data-ttu-id="7b042-254">Например, приложению может потребоваться проверить, используется ли уже адрес электронной почты или имя пользователя, для чего ему необходимо запросить большой объем данных.</span><span class="sxs-lookup"><span data-stu-id="7b042-254">For example, your app may need to verify whether an email or user name is already in use, and it must query a large amount of data to do so.</span></span> <span data-ttu-id="7b042-255">Скачивание больших наборов данных для проверки одного или нескольких полей приводит к чрезмерному потреблению ресурсов.</span><span class="sxs-lookup"><span data-stu-id="7b042-255">Downloading large sets of data for validating one or a few fields consumes too many resources.</span></span> <span data-ttu-id="7b042-256">При этом также возможен несанкционированный доступ к конфиденциальной информации.</span><span class="sxs-lookup"><span data-stu-id="7b042-256">It may also expose sensitive information.</span></span> <span data-ttu-id="7b042-257">Альтернативной является запрос приема-передачи для проверки поля.</span><span class="sxs-lookup"><span data-stu-id="7b042-257">An alternative is to make a round-trip request to validate a field.</span></span>

<span data-ttu-id="7b042-258">Удаленную проверку можно реализовать в два этапа.</span><span class="sxs-lookup"><span data-stu-id="7b042-258">You can implement remote validation in a two step process.</span></span> <span data-ttu-id="7b042-259">Сначала необходимо аннотировать модель атрибутом `[Remote]`.</span><span class="sxs-lookup"><span data-stu-id="7b042-259">First, you must annotate your model with the `[Remote]` attribute.</span></span> <span data-ttu-id="7b042-260">Атрибут `[Remote]` принимает множество перегрузок, с помощью которых можно указывать вызываемый код в коде JavaScript на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="7b042-260">The `[Remote]` attribute accepts multiple overloads you can use to direct client side JavaScript to the appropriate code to call.</span></span> <span data-ttu-id="7b042-261">В приведенном ниже примере указывается метод действия `VerifyEmail` контроллера `Users`.</span><span class="sxs-lookup"><span data-stu-id="7b042-261">The example below points to the `VerifyEmail` action method of the `Users` controller.</span></span>

[!code-csharp[](validation/sample/User.cs?name=snippet_UserEmailProperty)]

<span data-ttu-id="7b042-262">На втором этапе код проверки помещается в соответствующий метод действия, определенный в атрибуте `[Remote]`.</span><span class="sxs-lookup"><span data-stu-id="7b042-262">The second step is putting the validation code in the corresponding action method as defined in the `[Remote]` attribute.</span></span> <span data-ttu-id="7b042-263">В соответствии с документацией по [удаленному](https://jqueryvalidation.org/remote-method/) методу jQuery Validate, ответ сервера должен быть строкой JSON следующих типов:</span><span class="sxs-lookup"><span data-stu-id="7b042-263">According to the jQuery Validate [remote](https://jqueryvalidation.org/remote-method/) method documentation, the server response must be a JSON string that's either:</span></span>

* <span data-ttu-id="7b042-264">`"true"` для допустимых элементов;</span><span class="sxs-lookup"><span data-stu-id="7b042-264">`"true"` for valid elements.</span></span>
* <span data-ttu-id="7b042-265">`"false"`, `undefined` или `null` для недопустимых элементов, если нужно использовать стандартное сообщение об ошибке.</span><span class="sxs-lookup"><span data-stu-id="7b042-265">`"false"`, `undefined`, or `null` for invalid elements, using the default error message.</span></span>

<span data-ttu-id="7b042-266">Если ответ от сервера представляет собой строку (например, `"That name is already taken, try peter123 instead"`), эта строка отображается в качестве пользовательского сообщение об ошибке вместо строки по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="7b042-266">If the server response is a string (for example, `"That name is already taken, try peter123 instead"`), the string is displayed as a custom error message in place of the default string.</span></span>

<span data-ttu-id="7b042-267">Определение метода `VerifyEmail` следует этим правилам, как показано ниже.</span><span class="sxs-lookup"><span data-stu-id="7b042-267">The definition of the `VerifyEmail` method follows these rules, as shown below.</span></span> <span data-ttu-id="7b042-268">Метод возвращает сообщение об ошибке проверки, если адрес электронной почты занят, или `true`, если он свободен, заключая результат в объект `JsonResult`.</span><span class="sxs-lookup"><span data-stu-id="7b042-268">It returns a validation error message if the email is taken, or `true` if the email is free, and wraps the result in a `JsonResult` object.</span></span> <span data-ttu-id="7b042-269">Клиент может затем использовать возвращенное значение для продолжения работы или вывода сообщения об ошибке, если это необходимо.</span><span class="sxs-lookup"><span data-stu-id="7b042-269">The client side can then use the returned value to proceed or display the error if needed.</span></span>

[!code-csharp[](validation/sample/UsersController.cs?name=snippet_VerifyEmail)]

<span data-ttu-id="7b042-270">Теперь, когда пользователь вводит адрес электронной почты, код JavaScript в представлении совершает удаленный вызов, чтобы проверить, занят ли этот адрес. Если да, выводится сообщение об ошибке.</span><span class="sxs-lookup"><span data-stu-id="7b042-270">Now when users enter an email, JavaScript in the view makes a remote call to see if that email has been taken and, if so, displays the error message.</span></span> <span data-ttu-id="7b042-271">В противном случае пользователь может отправить форму обычным образом.</span><span class="sxs-lookup"><span data-stu-id="7b042-271">Otherwise, the user can submit the form as usual.</span></span>

<span data-ttu-id="7b042-272">Свойство `AdditionalFields` атрибута `[Remote]` полезно для проверки сочетаний полей с данными на сервере.</span><span class="sxs-lookup"><span data-stu-id="7b042-272">The `AdditionalFields` property of the `[Remote]` attribute is useful for validating combinations of fields against data on the server.</span></span> <span data-ttu-id="7b042-273">Например, если бы в представленной выше модели `User` было бы два дополнительных свойства `FirstName` и `LastName`, могла бы возникнуть необходимость проверить, нет ли уже пользователя с такой парой имен.</span><span class="sxs-lookup"><span data-stu-id="7b042-273">For example, if the `User` model from above had two additional properties called `FirstName` and `LastName`, you might want to verify that no existing users already have that pair of names.</span></span> <span data-ttu-id="7b042-274">Новые свойства определяются так, как показано ниже.</span><span class="sxs-lookup"><span data-stu-id="7b042-274">You define the new properties as shown in the following code:</span></span>

[!code-csharp[](validation/sample/User.cs?name=snippet_UserNameProperties)]

<span data-ttu-id="7b042-275">Свойству `AdditionalFields` можно было бы явным образом присвоить строки `"FirstName"` и `"LastName"`, однако применение оператора [`nameof`](/dotnet/csharp/language-reference/keywords/nameof) упрощает дальнейший рефакторинг.</span><span class="sxs-lookup"><span data-stu-id="7b042-275">`AdditionalFields` could've been set explicitly to the strings `"FirstName"` and `"LastName"`, but using the [`nameof`](/dotnet/csharp/language-reference/keywords/nameof) operator like this simplifies later refactoring.</span></span> <span data-ttu-id="7b042-276">Метод действия, выполняющий проверку, должен в этом случае принимать два аргумента: один для значения `FirstName`, а другой для значения `LastName`.</span><span class="sxs-lookup"><span data-stu-id="7b042-276">The action method to perform the validation must then accept two arguments, one for the value of `FirstName` and one for the value of `LastName`.</span></span>

[!code-csharp[](validation/sample/UsersController.cs?name=snippet_VerifyName)]

<span data-ttu-id="7b042-277">Теперь, когда пользователь вводит имя и фамилию, JavaScript выполняет указанные ниже действия.</span><span class="sxs-lookup"><span data-stu-id="7b042-277">Now when users enter a first and last name, JavaScript:</span></span>

* <span data-ttu-id="7b042-278">Совершает удаленный вызов, чтобы проверить, не занята ли эта пара имен.</span><span class="sxs-lookup"><span data-stu-id="7b042-278">Makes a remote call to see if that pair of names has been taken.</span></span>
* <span data-ttu-id="7b042-279">Если пара занята, выводится сообщение об ошибке.</span><span class="sxs-lookup"><span data-stu-id="7b042-279">If the pair has been taken, an error message is displayed.</span></span>
* <span data-ttu-id="7b042-280">Если не занята, пользователь может отправить форму.</span><span class="sxs-lookup"><span data-stu-id="7b042-280">If not taken, the user can submit the form.</span></span>

<span data-ttu-id="7b042-281">Если нужно проверить два или несколько дополнительных полей с помощью атрибута `[Remote]`, их следует указывать в виде списка с разделителями-запятыми.</span><span class="sxs-lookup"><span data-stu-id="7b042-281">If you need to validate two or more additional fields with the `[Remote]` attribute, you provide them as a comma-delimited list.</span></span> <span data-ttu-id="7b042-282">Например, чтобы добавить в модель свойство `MiddleName`, задайте атрибут `[Remote]`, как показано в следующем примере кода:</span><span class="sxs-lookup"><span data-stu-id="7b042-282">For example, to add a `MiddleName` property to the model, set the `[Remote]` attribute as shown in the following code:</span></span>

```cs
[Remote(action: "VerifyName", controller: "Users", AdditionalFields = nameof(FirstName) + "," + nameof(LastName))]
public string MiddleName { get; set; }
```

<span data-ttu-id="7b042-283">`AdditionalFields`, как и все аргументы атрибутов, должен представлять собой константное выражение.</span><span class="sxs-lookup"><span data-stu-id="7b042-283">`AdditionalFields`, like all attribute arguments, must be a constant expression.</span></span> <span data-ttu-id="7b042-284">Поэтому нельзя использовать [интерполированную строку](/dotnet/csharp/language-reference/keywords/interpolated-strings) или вызов <xref:System.String.Join*>для инициализации `AdditionalFields`.</span><span class="sxs-lookup"><span data-stu-id="7b042-284">Therefore, you must not use an [interpolated string](/dotnet/csharp/language-reference/keywords/interpolated-strings) or call <xref:System.String.Join*> to initialize `AdditionalFields`.</span></span> <span data-ttu-id="7b042-285">Для каждого дополнительного поля, добавляемого в атрибут `[Remote]`, необходимо добавить еще один аргумент в соответствующий метод действия контроллера.</span><span class="sxs-lookup"><span data-stu-id="7b042-285">For every additional field that you add to the `[Remote]` attribute, you must add another argument to the corresponding controller action method.</span></span>
