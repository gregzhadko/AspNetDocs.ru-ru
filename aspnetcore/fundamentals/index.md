---
title: Основы ASP.NET Core
author: rick-anderson
description: "Познакомьтесь с основными принципами создания приложений ASP.NET\_Core."
ms.author: riande
ms.custom: mvc
ms.date: 02/14/2019
uid: fundamentals/index
---
# <a name="aspnet-core-fundamentals"></a>Основы ASP.NET Core

В этой статье приведен обзор основных тем, связанных с разработкой приложений ASP.NET Core.

## <a name="the-startup-class"></a>Класс Startup

В классе `Startup` делается следующее.

* Настраиваются все службы, необходимые приложению.
* Определяется конвейер обработки запросов.

* Код для настройки (или *регистрации*) служб добавляется в метод `Startup.ConfigureServices`. *Службы* — это компоненты, которые используются в приложении. Например, объект контекста Entity Framework Core является службой.
* Код для настройки конвейера обработки запросов добавляется в метод `Startup.Configure`. Конвейер состоит из ряда компонентов *ПО промежуточного слоя*. Например, это ПО может обрабатывать запросы для статических файлов или перенаправлять HTTP-запросы в HTTPS. Каждый компонент ПО промежуточного слоя выполняет асинхронные операции в `HttpContext`, а затем либо вызывает следующий компонент в конвейере, либо завершает запрос.

::: moniker range=">= aspnetcore-2.0"

Пример класса `Startup`:

[!code-csharp[](index/snapshots/2.x/Startup1.cs?highlight=3,12)]

::: moniker-end

Дополнительные сведения: [Запуск приложения](xref:fundamentals/startup).

## <a name="dependency-injection-services"></a>Введение зависимостей (службы)

ASP.NET Core включает встроенную платформу внедрения зависимостей, позволяющую классам приложения обращаться к настроенным службам. Одним из вариантов получения экземпляра службы в классе является создание конструктора с параметром требуемого типа. Параметр может быть типом службы или интерфейсом. Система внедрения зависимостей предоставляет службу во время выполнения.

::: moniker range=">= aspnetcore-2.0"

Ниже показан класс, который использует внедрение зависимостей для получения объекта контекста Entity Framework Core. Выделенная строка является примером внедрения через конструктор.

[!code-csharp[](index/snapshots/2.x/Index.cshtml.cs?highlight=5)]

::: moniker-end

Несмотря на то, что система внедрения зависимостей является встроенной, она позволяет вам при желании подключать сторонний контейнер с инверсией управления (IoC).

Дополнительные сведения см. в разделе [Введение зависимостей](xref:fundamentals/dependency-injection).

## <a name="middleware"></a>ПО промежуточного слоя

Конвейер обработки запросов состоит из ряда компонентов ПО промежуточного слоя. Каждый компонент выполняет асинхронные операции в `HttpContext`, а затем либо вызывает следующий компонент в конвейере, либо завершает запрос.

По принятому соглашению компонент ПО промежуточного слоя добавляется в конвейер вызовом метода расширения `Use...` в методе `Startup.Configure`. Например, чтобы включить отрисовку статических файлов, вызовите `UseStaticFiles`.

::: moniker range=">= aspnetcore-2.0"

Код настройки конвейера обработки запросов выделен в следующем примере:

[!code-csharp[](index/snapshots/2.x/Startup1.cs?highlight=14-16)]

::: moniker-end

ASP.NET Core включает обширный набор встроенного ПО промежуточного слоя и позволяет вам писать свое собственное.

Дополнительные сведения: [ПО промежуточного слоя](xref:fundamentals/middleware/index).

<a id="host"/>

## <a name="the-host"></a>Узел

Приложение ASP.NET Core создает *узел* при запуске. Узел — это объект, который инкапсулирует все ресурсы приложения:

* Реализация HTTP-сервера
* Компоненты ПО промежуточного слоя
* Ведение журнала
* Внедрение зависимостей
* Параметр Configuration

Основной причиной включения всех взаимозависимых ресурсов приложения в один объект является управление жизненным циклом: контроль запуска и корректного завершения работы приложения.

Код для создания узла находится в `Program.Main` и следует [шаблону построителя](https://wikipedia.org/wiki/Builder_pattern). Для настройки каждого ресурса, входящего в узел, вызываются соответствующие методы. Чтобы свести все компоненты воедино и создать экземпляр объекта узла, вызывается метод построителя.

::: moniker range="<= aspnetcore-2.2"

ASP.NET Core 2.x использует веб-узел (класс `WebHost`) для веб-приложений. Платформа предоставляет методы расширения `CreateDefaultBuilder` для создания узла с часто используемыми параметрами, например:

* Использование [Kestrel](#servers) в качестве веб-сервера и поддержка интеграции с IIS.
* Загрузка конфигурации из файла *appsettings.json*, переменных среды, аргументов командной строки и других источников.
* Отправка выходных данных журнала в поставщики служб консоли и отладки.

::: moniker-end

::: moniker range=">= aspnetcore-2.0 <= aspnetcore-2.2"

Пример кода для создания узла:

[!code-csharp[](index/snapshots/2.x/Program1.cs?highlight=9)]

Дополнительные сведения: [Веб-узел](xref:fundamentals/host/web-host).

::: moniker-end

::: moniker range="> aspnetcore-2.2"

В веб-приложении ASP.NET Core 3.0 можно использовать веб-узел (класс `WebHost`) или универсальный узел (класс `Host`). Универсальный узел является рекомендуемым вариантом, а веб-узел служит для обеспечения обратной совместимости.

Платформа предоставляет методы расширения `CreateDefaultBuilder` и `ConfigureWebHostDefaults` для создания узла с часто используемыми параметрами:

* Использование [Kestrel](#servers) в качестве веб-сервера и поддержка интеграции с IIS.
* Загрузка конфигурации из файлов *appsettings.json* и *appsettings.[имя_среды].json*, переменных среды и аргументов командной строки.
* Отправка выходных данных журнала в поставщики служб консоли и отладки.

Ниже приведен пример кода для создания узла. В нем выделены методы расширения для настройки узла с часто используемыми параметрами.

[!code-csharp[](index/snapshots/3.x/Program1.cs?highlight=9-10)]

Дополнительные сведения: [Универсальный узел](xref:fundamentals/host/generic-host), [Веб-узел](xref:fundamentals/host/web-host).

::: moniker-end

### <a name="advanced-host-scenarios"></a>Сложные сценарии использования узла

::: moniker range=">= aspnetcore-2.1 <= aspnetcore-2.2"

Веб-узел должен содержать реализацию HTTP-сервера, которая не требуется для других типов приложений .NET. Начиная с версии 2.1 универсальный узел (класс `Host`) доступен для любых приложений .NET Core &mdash; не только для приложений ASP.NET Core. Он позволяет использовать перекрестные функции, такие как ведение журнала, внедрение зависимостей, конфигурации и управление жизненным циклом, в других типах приложений. Дополнительные сведения: [Универсальный узел](xref:fundamentals/host/generic-host).

::: moniker-end

::: moniker range="> aspnetcore-2.2"

Универсальный узел доступен для любых приложений .NET Core &mdash; не только для приложений ASP.NET Core. Он позволяет использовать перекрестные функции, такие как ведение журнала, внедрение зависимостей, конфигурации и управление жизненным циклом, в других типах приложений. Дополнительные сведения: [Универсальный узел](xref:fundamentals/host/generic-host).

::: moniker-end

Узел можно также использовать для выполнения фоновых задач. Дополнительные сведения: [Фоновые задачи](xref:fundamentals/host/hosted-services).

## <a name="servers"></a>Серверы

Приложение ASP.NET Core использует реализацию HTTP-сервера для приема HTTP-запросов. Сервер отправляет приложению запросы в виде набора [функций запросов](xref:fundamentals/request-features), объединенных в `HttpContext`.

::: moniker range=">= aspnetcore-2.2"

# <a name="windowstabwindows"></a>[Windows](#tab/windows)

ASP.NET Core предоставляет следующие реализации серверов:

* *Kestrel* — это кроссплатформенный веб-сервер. Он часто запускается в реконфигурации прокси-сервера с помощью [IIS](https://www.iis.net/). В ASP.NET Core 2.0 и более поздних версиях можно использовать Kestrel в роли общедоступного пограничного сервера с прямым доступом через Интернет.
* *HTTP-сервер IIS* — это сервер для Windows, который использует службы IIS. Он позволяет запускать приложение ASP.NET Core и службы IIS в одном процессе.
* *HTTP.sys* — это сервер для Windows, который не используется со службами IIS.

# <a name="macostabmacos"></a>[macOS](#tab/macos)

ASP.NET Core предоставляет реализацию кроссплатформенного сервера *Kestrel*. В ASP.NET Core 2.0 и более поздних версиях можно использовать Kestrel в роли общедоступного пограничного сервера с прямым доступом через Интернет. Он часто запускается в реконфигурации прокси-сервера с помощью [Nginx](https://nginx.org) или [Apache](https://httpd.apache.org/).

# <a name="linuxtablinux"></a>[Linux](#tab/linux)

ASP.NET Core предоставляет реализацию кроссплатформенного сервера *Kestrel*. В ASP.NET Core 2.0 и более поздних версиях можно использовать Kestrel в роли общедоступного пограничного сервера с прямым доступом через Интернет. Он часто запускается в реконфигурации прокси-сервера с помощью [Nginx](https://nginx.org) или [Apache](https://httpd.apache.org/).

---

::: moniker-end

::: moniker range="< aspnetcore-2.2"

# <a name="windowstabwindows"></a>[Windows](#tab/windows)

ASP.NET Core предоставляет следующие реализации серверов:

* *Kestrel* — это кроссплатформенный веб-сервер. Он часто запускается в реконфигурации прокси-сервера с помощью [IIS](https://www.iis.net/). В ASP.NET Core 2.0 и более поздних версиях можно использовать Kestrel в роли общедоступного пограничного сервера с прямым доступом через Интернет.
* *HTTP.sys* — это сервер для Windows, который не используется со службами IIS.

# <a name="macostabmacos"></a>[macOS](#tab/macos)

ASP.NET Core предоставляет реализацию кроссплатформенного сервера *Kestrel*. В ASP.NET Core 2.0 и более поздних версиях можно использовать Kestrel в роли общедоступного пограничного сервера с прямым доступом через Интернет. Он часто запускается в реконфигурации прокси-сервера с помощью [Nginx](https://nginx.org) или [Apache](https://httpd.apache.org/).

# <a name="linuxtablinux"></a>[Linux](#tab/linux)

ASP.NET Core предоставляет реализацию кроссплатформенного сервера *Kestrel*. В ASP.NET Core 2.0 и более поздних версиях можно использовать Kestrel в роли общедоступного пограничного сервера с прямым доступом через Интернет. Он часто запускается в реконфигурации прокси-сервера с помощью [Nginx](http://nginx.org) или [Apache](https://httpd.apache.org/).

---

::: moniker-end

Дополнительные сведения: [Серверы](xref:fundamentals/servers/index).

## <a name="configuration"></a>Параметр Configuration

ASP.NET Core предоставляет платформу конфигурации, которая получает параметры в виде пар "имя-значение" от упорядоченного набора поставщиков конфигурации. Доступны встроенные поставщики конфигурации для различных источников, таких как файлы *JSON*, *XML*, переменные среды и аргументы командной строки. Кроме того, вы можете писать поставщики конфигурации сами.

Например, можно указать, что источником конфигурации являются файл *appsettings.json* и переменные среды. В этом случае при запросе значения *ConnectionString* платформа сначала выполнит поиск в файле *appsettings.json*. Если значение будет найдено не только в нем, но и в переменной среды, приоритет получит значение из переменной среды.

Для управления конфиденциальными данными конфигурации, например паролями, ASP.NET Core предоставляет специальный инструмент [Менеджер секретов](xref:security/app-secrets). Для секретов в рабочей среде рекомендуется использовать [Azure Key Vault](/aspnet/core/security/key-vault-configuration).

Дополнительные сведения см. в разделе [Конфигурация](xref:fundamentals/configuration/index).

## <a name="options"></a>Параметры

Когда это возможно, ASP.NET Core следует *шаблону параметров* для хранения и получения значений конфигурации. Шаблон параметров использует классы для представления групп связанных настроек.

Например, следующий код задает параметры WebSockets:

```csharp
var options = new WebSocketOptions  
{  
   KeepAliveInterval = TimeSpan.FromSeconds(120),  
   ReceiveBufferSize = 4096
};  
app.UseWebSockets(options);
```

Дополнительные сведения: [Параметры](xref:fundamentals/configuration/options).

## <a name="environments"></a>Среды

Среды выполнения, включая среду *разработки*, *промежуточную* и *рабочую* среды, являются ключевыми компонентами ASP.NET Core. Указать среду, в которой запускается приложение, можно с помощью переменной среды `ASPNETCORE_ENVIRONMENT`. ASP.NET Core считывает переменную среды при запуске приложения и сохраняет ее значение в реализации `IHostingEnvironment`. Объект среды можно получить в любом месте приложения при помощи внедрения зависимостей.

::: moniker range=">= aspnetcore-2.0"

В следующем примере кода из класса `Startup` показана настройка приложения для вывода подробных сведений об ошибках исключительно при запуске в среде разработки:

[!code-csharp[](index/snapshots/2.x/Startup2.cs?highlight=3-6)]

::: moniker-end

Дополнительные сведения: [Среды](xref:fundamentals/environments).

## <a name="logging"></a>Ведение журнала

ASP.NET Core поддерживает API ведения журналов, который работает с разными встроенными и сторонними поставщиками. Доступны следующие поставщики:

* Консоль
* Отладка
* Трассировка событий Windows
* Журнал событий Windows
* TraceSource
* Служба приложений Azure
* Azure Application Insights

Записи в журналы можно вносить в любом месте кода приложения. Для этого нужно получить объект `ILogger` из внедрения зависимостей и вызвать методы ведения журналов.

::: moniker range=">= aspnetcore-2.0"

Ниже приведен пример кода, где используется объект `ILogger`. В коде выделены строки внедрения конструктора и вызова методов ведения журналов.

[!code-csharp[](index/snapshots/2.x/TodoController.cs?highlight=5,13,17)]

::: moniker-end

Интерфейс `ILogger` позволяет передавать в поставщик ведения журналов любое количество полей. Как правило, поля используются для создания строки сообщения, но поставщик также может отправлять их в хранилище данных в виде отдельных полей. Благодаря этому поставщики могут реализовывать [семантическое (структурированное) ведение журналов](https://softwareengineering.stackexchange.com/questions/312197/benefits-of-structured-logging-vs-basic-logging).

Дополнительные сведения: [Ведение журналов](xref:fundamentals/logging/index).

## <a name="routing"></a>Маршрутизация

*Маршрут* — это шаблон URL-адреса, сопоставляемый с обработчиком. Обычно обработчик представляет собой страницу Razor, метод действия в контроллере MVC или ПО промежуточного слоя. Маршрутизация ASP.NET Core позволяет контролировать URL-адреса, используемые приложением.

Дополнительные сведения см. в разделе [Маршрутизация](xref:fundamentals/routing).

## <a name="error-handling"></a>Обработка ошибок

ASP.NET Core содержит встроенные функции обработки ошибок, такие как:

* Страница исключений для разработчика
* Настраиваемые страницы ошибок
* Статические страницы с кодами состояния
* Обработка исключений при запуске

Дополнительные сведения: [Обработка ошибок](xref:fundamentals/error-handling).

::: moniker range=">= aspnetcore-2.1"

## <a name="make-http-requests"></a>Создание HTTP-запросов

ASP.NET Core включает реализацию интерфейса `IHttpClientFactory` для создания экземпляров `HttpClient`. Фабрика:

* Центральное расположение для именования и настройки логических экземпляров `HttpClient`. Например, можно зарегистрировать и использовать клиент *github* для доступа к GitHub. Можно зарегистрировать клиент по умолчанию для других целей.
* Поддержка регистрации и связывания в цепочки множества делегирующих обработчиков для создания конвейера ПО промежуточного слоя под исходящие запросы. Этот шаблон похож на входящий конвейер ПО промежуточного слоя в ASP.NET Core. Шаблон предоставляет механизм управления сквозной функциональностью HTTP-запросов, включая кэширование, обработку ошибок, сериализацию и ведение журнала.
* Интеграция с *Polly* — популярной сторонней библиотекой для обработки временных сбоев.
* Управление созданием пулов и временем существования базовых экземпляров `HttpClientMessageHandler` с целью избежать обычных проблем с DNS, которые возникают при управлении временем существования `HttpClient` вручную.
* Настройка параметров ведения журнала (с помощью *ILogger*) для всех запросов, отправляемых через клиентов, созданных фабрикой.

Дополнительные сведения: [HTTP-запросы](xref:fundamentals/http-requests).

::: moniker-end

## <a name="content-root"></a>Корневой каталог содержимого

Корень содержимого — это базовый путь к любому закрытому содержимому, например к файлам Razor, которое используется приложением. По умолчанию корень содержимого является базовым путем исполняемого файла приложения. Альтернативное расположение можно указать при [создании узла](#host).

::: moniker range="<= aspnetcore-2.2"

Дополнительные сведения: [Корень содержимого](xref:fundamentals/host/web-host#content-root).

::: moniker-end

::: moniker range="> aspnetcore-2.2"

Дополнительные сведения: [Корень содержимого](xref:fundamentals/host/generic-host#content-root).

::: moniker-end

## <a name="web-root"></a>Корневой веб-узел

Корневой каталог документов (*webroot*) — это базовый путь к общедоступным статическим ресурсам, включая CSS, JavaScript и файлы изображений. По умолчанию ПО промежуточного слоя статических файлов обслуживает только файлы из корневого каталога документов и его подкаталогов. По умолчанию используется путь *\<корневой каталог содержимого>/wwwroot*. Альтернативное расположение можно задать при [создании узла](#host).

Для указания на корневой каталог файлов Razor (*CSHTML*) используется символ тильды и косой черты `~/`. Пути, начинающиеся с `~/`, называются виртуальными путями.

Дополнительные сведения см. в разделе [Статические файлы](xref:fundamentals/static-files).
