---
title: Непрерывная интеграция и развертывание — DevOps с помощью ASP.NET Core и Azure
author: CamSoper
description: Непрерывная интеграция и развертывание в DevOps с помощью ASP.NET Core и Azure
ms.author: scaddie
ms.date: 10/24/2018
ms.custom: seodec18
uid: azure/devops/cicd
ms.openlocfilehash: e5bddde41291c9573f58d749bbf830de9ea9319d
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/01/2019
ms.locfileid: "57039331"
---
# <a name="continuous-integration-and-deployment"></a>Непрерывная интеграция и развертывание

В предыдущей главе вы создали локальный репозиторий Git для приложения для чтения простого веб-канала. В этой главе будут публиковать этого кода в репозитории GitHub, а также создание конвейере DevOps служб Azure с помощью конвейеров в Azure. Конвейер позволяет непрерывного выполнения сборки и развертывания приложения. Любой фиксации в репозиторий GitHub активирует сборку и развертывание в промежуточный слот веб-приложения Azure.

В этом разделе вы выполните следующие задачи:

* Публикация в код приложения на GitHub
* Отключить развертывание локального репозитория Git
* Создать организацию Azure DevOps
* Создание командного проекта в службах Azure DevOps
* Создание определения построения
* Создать конвейер выпуска
* Зафиксировать изменения в GitHub и автоматически развернуть в Azure
* Изучите Azure конвейеры конвейера

## <a name="publish-the-apps-code-to-github"></a>Публикация в код приложения на GitHub

1. Откройте окно браузера и перейдите к `https://github.com`.
1. Нажмите кнопку **+** раскрывающегося списка в заголовке, а затем выберите **новый репозиторий**:

    ![Параметр новый репозиторий GitHub](media/cicd/github-new-repo.png)

1. Выберите свою учетную запись в **владельца** в раскрывающемся списке и введите *чтения simple потоков* в **имя репозитория** текстового поля.
1. Нажмите кнопку **Создать репозиторий** кнопки.
1. Откройте командную оболочку локального компьютера. Перейдите в каталог, в котором *чтения simple потоков* хранится репозиторий Git.
1. Переименуйте существующий *origin* удаленное подключение к *вышестоящего*. Выполните следующую команду:
    ```console
    git remote rename origin upstream
    ```
1. Добавьте новый *origin* удаленного указывает на копию репозитория на сайте GitHub. Выполните следующую команду:
    ```console
    git remote add origin https://github.com/<GitHub_username>/simple-feed-reader/
    ```
1. Публикация локального репозитория Git на только что созданный репозиторий GitHub. Выполните следующую команду:
    ```console
    git push -u origin master
    ```
1. Откройте окно браузера и перейдите к `https://github.com/<GitHub_username>/simple-feed-reader/`. Проверьте, что ваш код отображается в репозитории GitHub.

## <a name="disconnect-local-git-deployment"></a>Отключить развертывание локального репозитория Git

Удалите локальное развертывание Git, выполнив следующие действия. Конвейеры Azure (службу Azure DevOps) заменяет и расширяет эту функциональность.

1. Откройте [портала Azure](https://portal.azure.com/)и перейдите к *промежуточных (mywebapp\<unique_number\>/промежуточные)* веб-приложения. Веб-приложения можно быстро найти, введя *промежуточных* в поле поиска на портале:

    ![условие поиска для промежуточного веб-приложения](media/cicd/portal-search-box.png)

1. Нажмите кнопку **варианты развертывания**. Появится новая панель. Нажмите кнопку **Disconnect** удалить локальную конфигурацию Git исходного элемента управления, добавленный в предыдущей главе. Подтвердить операцию удаления, щелкнув **Да** кнопки.
1. Перейдите к *mywebapp < unique_number >* службы приложений. Напоминаем поле поиска на портале можно использовать для быстрого поиска в службе приложений.
1. Нажмите кнопку **варианты развертывания**. Появится новая панель. Нажмите кнопку **Disconnect** удалить локальную конфигурацию Git исходного элемента управления, добавленный в предыдущей главе. Подтвердить операцию удаления, щелкнув **Да** кнопки.

## <a name="create-an-azure-devops-organization"></a>Создать организацию Azure DevOps

1. Откройте браузер и перейдите к [страницы создания организации Azure DevOps](https://go.microsoft.com/fwlink/?LinkId=307137).
1. Введите уникальное имя в **выберите запоминающееся имя** textbox для формирования URL-адрес для доступа к вашей организации DevOps в Azure.
1. Выберите **Git** "переключатель", так как код размещается в репозитории GitHub.
1. Нажмите кнопку **Continue** (Продолжить). После короткого ожидания, учетную запись и командный проект с именем *MyFirstProject*, создаются.

    ![Страница создания организации Azure DevOps](media/cicd/vsts-account-creation.png)

1. Откройте по электронной почте подтверждение, указывающее на то, что организации DevOps в Azure и проекта будут готовы к использованию. Нажмите кнопку **запустить проект** кнопки:

    ![Ваш проект кнопка "Пуск"](media/cicd/vsts-start-project.png)

1. Откроется в браузере  *\<account_name\>. visualstudio.com*. Нажмите кнопку *MyFirstProject* ссылку, чтобы приступить к настройке конвейера DevOps проекта.

## <a name="configure-the-azure-pipelines-pipeline"></a>Настройте конвейер конвейеры Azure

Существуют состоит из трех шагов для завершения. Выполнив действия, описанные в следующих трех разделов приводит работы конвейера DevOps.

### <a name="grant-azure-devops-access-to-the-github-repository"></a>Предоставление Azure DevOps доступ к репозиторию GitHub

1. Разверните **или выполнить сборку кода из внешнего репозитория** accordion. Нажмите кнопку **установки сборки** кнопки:

    ![Кнопка настройки сборки](media/cicd/vsts-setup-build.png)

1. Выберите **GitHub** вариант **выбрать источник** раздел:

    ![Выберите источник - GitHub](media/cicd/vsts-select-source.png)

1. Требуется авторизация для доступа к репозиторию GitHub DevOps в Azure. Введите *< GitHub_username > подключение GitHub* в **имя подключения** текстового поля. Пример:

    ![Имя подключения GitHub](media/cicd/vsts-repo-authz.png)

1. Если двухфакторная проверка подлинности будет включен в вашей учетной записи GitHub, личный маркер доступа не требуется. В этом случае щелкните **авторизовать маркер личного доступа GitHub** ссылку. См. в разделе [официальной документации создания маркера личного доступа GitHub](https://help.github.com/articles/creating-a-personal-access-token-for-the-command-line/) для справки. Только *репозитория* требуется область разрешений. В противном случае нажмите **авторизация выполняется с использованием OAuth** кнопки.
1. Когда появится запрос, войдите в учетную запись GitHub. Затем выберите авторизовать для предоставления доступа к вашей организации DevOps в Azure. В случае успешного выполнения создается новая конечная точка службы.
1. Нажмите кнопку с многоточием рядом с полем **репозитория** кнопки. Выберите *< GitHub_username > / чтения simple потоков* репозитория из списка. Нажмите кнопку **выберите** кнопки.
1. Выберите *master* ветвь из **ветвь по умолчанию для сборок вручную и по расписанию** раскрывающегося списка. Нажмите кнопку **Continue** (Продолжить). Откроется страница выбора шаблона.

### <a name="create-the-build-definition"></a>Создание определения сборки

1. На странице выбора шаблона, ввести *ASP.NET Core* в поле поиска:

    ![ASP.NET Core поиска на странице шаблона](media/cicd/vsts-template-selection.png)

1. Результаты поиска шаблона отображаются. Наведите указатель мыши **ASP.NET Core** шаблона и нажмите кнопку **применить** кнопки.
1. **Задачи** появится вкладка определения построения. Перейдите на вкладку **Триггеры** .
1. Проверьте **непрерывной интеграции** поле. В разделе **фильтры ветвей** разделе, убедитесь, что **тип** раскрывающегося списка присваивается *Include*. Задайте **спецификация ветви** раскрывающийся список, чтобы *master*.

    ![Включение параметров непрерывной интеграции](media/cicd/vsts-enable-ci.png)

    Эти параметры предписывают построения для запуска при передаче любое изменение *master* ветвь репозитория GitHub. Непрерывная интеграция тестируется в [фиксации изменений в GitHub и автоматическое развертывание в Azure](#commit-changes-to-github-and-automatically-deploy-to-azure) раздел.

1. Нажмите кнопку **сохранить и поместить в очередь** и выберите **Сохранить** параметр:

    ![Кнопка "Сохранить"](media/cicd/vsts-save-build.png)

1. Появится следующее модальное диалоговое окно:

    ![Сохраните определение сборки - модальное диалоговое окно](media/cicd/vsts-save-modal.png)

    Использовать папку по умолчанию из *\\* и нажмите кнопку **Сохранить** кнопки.

### <a name="create-the-release-pipeline"></a>Создайте конвейер выпусков

1. Нажмите кнопку **выпуски** вкладке командного проекта. Нажмите кнопку **новый конвейер** кнопки.

    ![Вкладка "выпуски" — Кнопка "Создать определение"](media/cicd/vsts-new-release-definition.png)

    Откроется панель выбора шаблона.

1. На странице выбора шаблона, ввести *службы приложений* в поле поиска:

    ![Поле поиска шаблона конвейер выпуска](media/cicd/vsts-release-template-search.png)

1. Результаты поиска шаблона отображаются. Наведите указатель мыши **развертывание службы приложений Azure с помощью слота** шаблона и нажмите кнопку **применить** кнопки. **Конвейера** появится вкладка конвейера выпуска.

    ![Конвейер выпуска вкладку конвейера](media/cicd/vsts-release-definition-pipeline.png)

1. Нажмите кнопку **добавить** кнопку **артефакты** поле. **Добавление артефакта** появится панель:

    ![Конвейер выпуска - артефакта панель добавления](media/cicd/vsts-release-add-artifact.png)

1. Выберите **построения** плитку **типа источника** раздел. Этот тип обеспечивает создание ссылок конвейер выпуска в определение сборки.
1. Выберите *MyFirstProject* из **проекта** раскрывающегося списка.
1. Выберите имя определения построения *MyFirstProject ASP.NET Core-CI*, из **источник (определение сборки)** раскрывающегося списка.
1. Выберите *последнюю* из **версия по умолчанию** раскрывающегося списка. Этот параметр создает артефакты, созданные последним запуском определения построения.
1. Замените текст в **псевдоним источника** textbox с *Drop*.
1. Нажмите кнопку **Добавить**. **Артефакты** разделе обновлений для отображения изменений.
1. Щелкните значок с молнией, чтобы включить непрерывное развертывание на:

    ![Артефакты — значок с изображением молнии. конвейер выпуска](media/cicd/vsts-artifacts-lightning-bolt.png)

    Этот параметр включен развертывание происходит каждый раз, когда становится доступной новая сборка.
1. Объект **триггер непрерывного развертывания** панели справа. Чтобы включить эту функцию, нажмите кнопку переключателя. Это необязательно включить **триггер запроса на включение внесенных изменений**.
1. Нажмите кнопку **добавить** раскрывающееся меню в **фильтры ветви сборки** раздел. Выберите **ветвь по умолчанию определение построения** параметр. Этот фильтр вызывает выпуска для активации только для сборок из репозитория GitHub *master* ветви.
1. Нажмите кнопку **Сохранить**. Нажмите кнопку **ОК** кнопки в итоговом **Сохранить** модальное диалоговое окно.
1. Нажмите кнопку **среду 1** поле. **Среды** панели справа. Изменение *среду 1* текста в **имя среды** textbox для *рабочей*.

   ![Конвейер выпуска - текстовое имя среды](media/cicd/vsts-environment-name-textbox.png)

1. Нажмите кнопку **этапа 1, 2 задачи** ссылку в **рабочей** поле:

    ![Конвейер выпуска - link.png рабочей среды](media/cicd/vsts-production-link.png)

    **Задачи** появится вкладка среды.
1. Нажмите кнопку **развернуть службу приложений Azure для слота** задачи. Его параметры отображаются на панели справа.
1. Выберите подписку Azure, связанные со службой приложений из **подписки Azure** раскрывающегося списка. После выбора нажмите кнопку **Authorize** кнопки.
1. Выберите *веб-приложения* из **тип приложения** раскрывающегося списка.
1. Выберите *mywebapp / < unique_number / >* из **имя службы приложений** раскрывающегося списка.
1. Выберите *AzureTutorial* из **группы ресурсов** раскрывающегося списка.
1. Выберите *промежуточных* из **слот** раскрывающегося списка.
1. Нажмите кнопку **Сохранить**.
1. Наведите указатель на имя конвейера выпуска по умолчанию. Щелкните значок карандаша, чтобы изменить его. Используйте *MyFirstProject-Core-компакт-ДИСК ASP.NET* как имя.

    ![Имя конвейера выпуска](media/cicd/vsts-release-definition-name.png)

1. Нажмите кнопку **Сохранить**.

## <a name="commit-changes-to-github-and-automatically-deploy-to-azure"></a>Зафиксировать изменения в GitHub и автоматически развернуть в Azure

1. Откройте *SimpleFeedReader.sln* в Visual Studio.
1. В обозревателе решений откройте *Pages\Index.cshtml*. Изменение `<h2>Simple Feed Reader - V3</h2>` для `<h2>Simple Feed Reader - V4</h2>`.
1. Нажмите клавишу **Ctrl**+**Shift**+**B** для сборки приложения.
1. Зафиксируйте файл в репозитории GitHub. Использовать **изменения** страницы в Visual Studio *Team Explorer* вкладку или выполнить следующую процедуру с помощью командной оболочки на локальном компьютере:

    ```console
    git commit -a -m "upgraded to V4"
    ```
1. Отправка изменений *master* ветви *origin* удаленный репозиторий GitHub:

    ```console
    git push origin master
    ```

    Фиксация появляется в репозитории GitHub *master* ветви:

    ![Фиксации GitHub в главной ветви](media/cicd/github-commit.png)

    Сборка запускается, поскольку непрерывной интеграции включена в определении сборки **триггеры** вкладке:

    ![включить непрерывную интеграцию](media/cicd/enable-ci.png)

1. Перейдите к **в очереди** вкладке **конвейеры Azure** > **построения** страницы в службах Azure DevOps. Построения в очереди показывает ветви и фиксации, запустившей сборки:

    ![построения в очереди](media/cicd/build-queued.png)

1. После успешного построения, развертывания в Azure. Перейдите к приложению в браузере. Обратите внимание на то, что текст «V4» отображается в заголовке:

    ![обновленное приложение](media/cicd/updated-app-v4.png)

## <a name="examine-the-azure-pipelines-pipeline"></a>Изучите Azure конвейеры конвейера

### <a name="build-definition"></a>Определение сборки

Определение сборки был создан с именем *MyFirstProject ASP.NET Core-CI*. По завершении построения создает *ZIP-файл* файла, включая ресурсы для публикации. Конвейер выпуска развертывает эти ресурсы в Azure.

Определение сборки **задачи** вкладке перечислены отдельных действий. Есть пять задач сборки.

![задачи определения сборки](media/cicd/build-definition-tasks.png)

1. **Восстановление** &mdash; интерфейсов `dotnet restore` команду, чтобы восстановить пакеты NuGet приложения. Пакет по умолчанию канал, используемый является nuget.org.
1. **Построение** &mdash; интерфейсов `dotnet build --configuration release` команду для компиляции в код приложения. Это `--configuration` параметр используется для создания оптимизированной версии кода, который подходит для развертывания в рабочей среде. Изменить *BuildConfiguration* переменных с определением сборки **переменных** вкладку, например, конфигурации отладки при необходимости.
1. **Тест** &mdash; интерфейсов `dotnet test --configuration release --logger trx --results-directory <local_path_on_build_agent>` команду для запуска модульных тестов приложения. Модульные тесты выполняются в рамках любого C# проект сопоставления `**/*Tests/*.csproj` маски. Результаты теста сохраняются в *.trx* файл в расположении, заданном параметром `--results-directory` параметр. Если не все тесты, сборка завершается ошибкой и не был развернут.

    > [!NOTE]
    > Чтобы проверить работу модульные тесты, измените *SimpleFeedReader.Tests\Services\NewsServiceTests.cs* намеренно прервать один из тестов. Например, измените `Assert.True(result.Count > 0);` для `Assert.False(result.Count > 0);` в `Returns_News_Stories_Given_Valid_Uri` метод. Зафиксируйте и отправьте изменения в GitHub. Сборка запускается и завершается сбоем. Состояние конвейера сборки меняется на **сбой**. Снова вернуться изменений, фиксации и отправки. Сборка будет завершена.

1. **Публикация** &mdash; интерфейсов `dotnet publish --configuration release --output <local_path_on_build_agent>` команду, чтобы создать *ZIP-файл* файл с артефактами, которые должны быть развернуты. `--output` Параметр указывает расположение публикации *ZIP-файл* файл. Что расположение задается путем передачи [Предопределенная переменная](/azure/devops/pipelines/build/variables) с именем `$(build.artifactstagingdirectory)`. Эту переменную при развертывании по локальному пути, такие как *c:\agent\_work\1\a*, на агенте построения.
1. **Публикация артефакта** &mdash; Publishes *ZIP-файл* файлы, созданные функцией **публикации** задачи. Задача принимает *ZIP-файл* расположение в качестве параметра, которое предварительно определенных файла `$(build.artifactstagingdirectory)`. *ZIP-файл* опубликован файл в папку с именем *drop*.

Выберите определение сборки **Сводка** ссылку, чтобы просмотреть журнал сборок с определением:

![Снимок экрана: отображение построения определения журнала](media/cicd/build-definition-summary.png)

На соответствующей странице щелкните ссылку, соответствующую уникальный номер:

![Страница сводки определения сборки отображение экрана](media/cicd/build-definition-completed.png)

Отображается сводка этой конкретной сборки. Нажмите кнопку **артефакты** вкладку и обратите внимание, *drop* указана папка, созданного посредством сборки:

![Снимок экрана, показывающий определения артефактов построения - транзитный каталог](media/cicd/build-definition-artifacts.png)

Используйте **загрузить** и **Проводник** ссылки для проверки опубликованного артефакты.

### <a name="release-pipeline"></a>Конвейер выпуска

Конвейер выпуска был создан с именем *MyFirstProject-Core-компакт-ДИСК ASP.NET*:

![Общие сведения о конвейере выпуска отображение экрана](media/cicd/release-definition-overview.png)

Два основных компонента конвейера выпуска **артефакты** и **сред**. При нажатии блока в **артефакты** раздел показывает следующие панели:

![Снимок экрана: отображение выпуска конвейера артефактов](media/cicd/release-definition-artifacts.png)

**Источник (определение сборки)** значение представляет определение сборки, с которым связан этот конвейер выпуска. *ZIP-файл* предоставляется файл, созданный при успешном выполнении определения построения *рабочей* среду для развертывания в Azure. Нажмите кнопку *этапа 1, 2 задачи* ссылку в *рабочей* "среды" для просмотра задач конвейера выпуска:

![Снимок экрана задач конвейер выпуска](media/cicd/release-definition-tasks.png)

Конвейер выпуска состоит из двух задач: *Развертывание службы приложений Azure в слоте* и *управление службе приложений Azure — переключение слотов*. Щелкнув первая задача раскрывает конфигурация следующие задачи:

![Задача развертывания конвейера выпуска отображение экрана](media/cicd/release-definition-task1.png)

Подписка Azure, тип службы, имя веб-приложения, группу ресурсов и слот развертывания определяются в задачи развертывания. **Пакет или папка** содержит текстовое поле *ZIP-файл* путь к файлу, чтобы извлечь и развернуть для *промежуточных* слоте *mywebapp\<уникальный _Число\>*  веб-приложения.

Щелкнув задачу замены слота раскрывает конфигурация следующие задачи:

![Снимок экрана отображение выпуска конвейера слот переключения задач](media/cicd/release-definition-task2.png)

Предоставляются подписки, группы ресурсов, тип службы, имя веб-приложения и сведения о слот развертывания. **Переключить на рабочий слот** будет установлен флажок. Следовательно, биты развертывания *промежуточных* меняются местами слот в рабочую среду.

## <a name="additional-reading"></a>Дополнительные материалы для чтения

* [Создание первого конвейера с помощью Azure Pipelines](/azure/devops/pipelines/get-started-yaml)
* [Проект сборки и .NET Core](/azure/devops/pipelines/languages/dotnet-core)
* [Развертывание веб-приложения с конвейерами Azure](/azure/devops/pipelines/targets/webapp)
