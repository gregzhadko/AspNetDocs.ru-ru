---
title: Развертывание приложения в службе приложений — DevOps с помощью ASP.NET Core и Azure
author: CamSoper
description: Развертывание приложения ASP.NET Core в службе приложений Azure, первым шагом для разработки и операций с ASP.NET Core и Azure.
ms.author: casoper
ms.custom: mvc, seodec18
ms.date: 10/24/2018
uid: azure/devops/deploy-to-app-service
ms.openlocfilehash: 9fe17c9e210d4dda9b74818104fc52a60d4f0077
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/01/2019
ms.locfileid: "57056561"
---
# <a name="deploy-an-app-to-app-service"></a>Развертывание приложения в службе приложений

[Служба приложений Azure](/azure/app-service/) Azure веб-платформы размещения. Развертывание веб-приложения в службе приложений Azure можно сделать вручную или с помощью автоматизированного процесса. В этом разделе руководства рассматриваются методы развертывания, которые могут выполняться вручную или с помощью командной строки скрипта, или запускаются вручную с помощью Visual Studio.

В этом разделе вы будете выполнять следующие задачи:

* Скачайте и созданию примера приложения.
* Создание приложения службы веб-приложение Azure с помощью Azure Cloud Shell.
* Развертывание примера приложения в Azure с помощью Git.
* Развертывание изменений в приложение, с помощью Visual Studio.
* Добавьте промежуточный слот для веб-приложения.
* Развертывание обновления в промежуточном слоте.
* Переключить слоты промежуточной и рабочей.

## <a name="download-and-test-the-app"></a>Скачайте и тестирование приложения

Приложение, используемое в этом руководстве, является предварительно созданные приложения ASP.NET Core, [простой веб-канала чтения](https://github.com/Azure-Samples/simple-feed-reader/). Это приложение Razor Pages, использующий `Microsoft.SyndicationFeed.ReaderWriter` API для получения канал RSS/Atom и отображения элементов новостей из списка.

Вы можете просмотреть код, но важно понимать, что нет ничего особенного в отношении этого приложения. Это просто простое приложение ASP.NET Core для иллюстративных целей.

Из командной оболочки Загрузите код, постройте проект и запустите его следующим образом.

> *Примечание. Пользователи Linux и Mac OS следует внести соответствующие изменения для путей, например, с помощью косой черты (`/`) вместо обратной косой чертой (`\`).*

1. Клонируйте код на папку на локальном компьютере.

    ```console
    git clone https://github.com/Azure-Samples/simple-feed-reader/
    ```

2. Изменить вашу рабочую папку для *чтения simple потоков* папку, которая была создана.

    ```console
    cd .\simple-feed-reader\SimpleFeedReader
    ```

3. Восстановите пакеты и выполните сборку решения.

    ```console
    dotnet build
    ```

4. Запустите приложение.

    ```console
    dotnet run
    ```

    ![Команда dotnet run прошла успешно](./media/deploying-to-app-service/dotnet-run.png)

5. Откройте браузер и перейдите к `http://localhost:5000`. Приложение позволяет введите или вставьте URL-адрес канала синдикации и просмотреть список элементов новостей.

     ![Приложения, отображая содержание RSS-канал](./media/deploying-to-app-service/app-in-browser.png)

6. После проверки правильности работы приложения, выключить его, нажав клавишу **Ctrl**+**C** в командной оболочке.

## <a name="create-the-azure-app-service-web-app"></a>Создание веб-приложения службы приложений Azure

Чтобы развернуть приложение, необходимо создать службу приложений [веб-приложение](/azure/app-service/app-service-web-overview). После создания веб-приложения вы развернете в него с локального компьютера с помощью Git.

1. Войдите в [Azure Cloud Shell](https://shell.azure.com/bash). Примечание. При входе в систему в первый раз Cloud Shell предлагает создать учетную запись хранения для файлов конфигурации. Примите значения по умолчанию или задайте уникальное имя.

2. Используйте Cloud Shell для выполнения следующих действий.

    1. Объявите переменную для хранения имени веб приложения. Имя должно быть уникальным для использования в URL-адрес по умолчанию. С помощью `$RANDOM` функция Bash для создания имени, гарантирующее уникальность и результаты в формате `webappname99999`.

    ```console
    webappname=mywebapp$RANDOM
    ```

    2. Создайте группу ресурсов. Группы ресурсов позволяют объединять ресурсы Azure, которые администрируются как группа.

    ```azure-cli
    az group create --location centralus --name AzureTutorial
    ```

    `az` Команда вызывает [Azure CLI](/cli/azure/). Интерфейс командной строки можно выполнять локально, но использовать его в Cloud Shell экономит время и конфигурации.

    В. Создайте план службы приложений на уровне S1. План службы приложений — это группа веб-приложений, которые совместно используют тот же уровень ценообразования. Уровень на S1 не бесплатные, но это обязательно для функцию промежуточных слотов.

    ```azure-cli
    az appservice plan create --name $webappname --resource-group AzureTutorial --sku S1
    ```

    Г. Создайте ресурс веб-приложения, с помощью плана службы приложений в той же группе ресурсов.

    ```azure-cli
    az webapp create --name $webappname --resource-group AzureTutorial --plan $webappname
    ```

    Д. Настройка учетных данных развертывания. Эти учетные данные развертывания применяются к веб-приложений в вашей подписке. Не используйте специальные символы в имени пользователя.

    ```azure-cli
    az webapp deployment user set --user-name REPLACE_WITH_USER_NAME --password REPLACE_WITH_PASSWORD
    ```

    f. Настройка веб-приложения, чтобы принять развертывание из локального Git и отображения *URL-адрес развертывания Git*. **Запишите этот URL-адрес для ссылки на более поздней версии**.

    ```azure-cli
    echo Git deployment URL: $(az webapp deployment source config-local-git --name $webappname --resource-group AzureTutorial --query url --output tsv)
    ```

    ж. Отображение *веб-приложения URL-адрес*. Найдите этот URL-адрес, чтобы увидеть пустое веб-приложение. **Запишите этот URL-адрес для ссылки на более поздней версии**.

    ```console
    echo Web app URL: http://$webappname.azurewebsites.net
    ```

3. С помощью командной оболочки на локальном компьютере, перейдите к папке проекта веб приложения (например, `.\simple-feed-reader\SimpleFeedReader`). Выполните следующие команды, чтобы настроить Git для отправки в URL-адрес развертывания:

    1. Добавьте URL-адрес удаленного в локальном репозитории.

    ```console
    git remote add azure-prod GIT_DEPLOYMENT_URL
    ```

    2. Push-локальной *master* ветви *azure prod* удаленного элемента *master* ветви.

    ```console
    git push azure-prod master
    ```

    Вам предложат ввести учетные данные развертывания, созданную ранее. Просмотрите выходные данные, в командной оболочке. Azure выполняет сборку приложения ASP.NET Core удаленно.

4. В браузере перейдите к *веб-приложения URL-адрес* и обратите внимание на то, приложение будет собрано и развернуто. Дополнительные изменения можно было зафиксировать в локальном репозитории Git с `git commit`. Эти изменения будут передаваться в Azure с предыдущим `git push` команды.

## <a name="deployment-with-visual-studio"></a>Развертывание с помощью Visual Studio

> *Примечание. Этот раздел относится только к Windows. Пользователи Linux и macOS необходимо внести изменение, описано в шаге 2 ниже. Сохраните файл и зафиксируйте изменения в локальном репозитории с `git commit`. Наконец, отправьте изменения, с помощью `git push`, как показано в первом разделе.*

Приложение уже развернуто в командной оболочке. Давайте использовать интегрированные инструменты Visual Studio для развертывания обновления в приложение. По сути Visual Studio выполняет то же самое, что и средства командной строки, но в знакомый пользовательский Интерфейс Visual Studio.

1. Откройте *SimpleFeedReader.sln* в Visual Studio.
2. В обозревателе решений откройте *Pages\Index.cshtml*. Изменение `<h2>Simple Feed Reader</h2>` для `<h2>Simple Feed Reader - V2</h2>`.
3. Нажмите клавишу **Ctrl**+**Shift**+**B** для сборки приложения.
4. В обозревателе решений щелкните правой кнопкой мыши проект и нажмите кнопку **публикации**.

    ![Снимок экрана, показывающий щелкните правой кнопкой мыши, публикация](./media/deploying-to-app-service/publish.png)
5. Visual Studio можно создать новый ресурс службы приложений, но это обновление будет публиковаться через существующее развертывание. В **выберите целевой объект публикации** диалоговом окне выберите **службы приложений** в списке слева, а затем выберите **выбрать существующее**. Нажмите кнопку **Опубликовать**.
6. В **службы приложений** диалоговом окне подтвердите, что Майкрософт или организационной учетной записи, используемой для создания подписки на Azure в правом верхнем углу. Если это не так, нажмите кнопку раскрывающегося списка и добавьте его.
7. Убедитесь, что правильный Azure **подписки** выбран. Для **представление**выберите **группы ресурсов**. Разверните **AzureTutorial** группу ресурсов, а затем выберите существующее веб-приложение. Нажмите кнопку **ОК**.

    ![Диалоговое окно публикации службы приложений снимок экрана, показывающий](./media/deploying-to-app-service/publish-dialog.png)

Visual Studio создает и развертывает приложение в Azure. Перейдите к URL-адрес приложения. Убедитесь, что `<h2>` изменения элемента в реальном времени.

![Приложение с помощью измененный заголовок](./media/deploying-to-app-service/app-v2.png)

## <a name="deployment-slots"></a>Слоты развертывания

Слоты развертывания поддерживают промежуточного хранения изменений, не влияя на приложения, выполняемого в рабочей среде. После проверки промежуточную версию приложения по качества работы команды можно переключать рабочий и промежуточный слоты. Приложение в промежуточной среде перемещается в рабочую среду, таким образом. Следующие действия создать промежуточный слот, развернуть некоторые изменения в него и переключите промежуточный слот с рабочей среде после проверки.

1. Войдите в [Azure Cloud Shell](https://shell.azure.com/bash), если еще не выполнил вход.
2. Создание промежуточного слота.

    1. Создайте слот развертывания с именем *промежуточных*.

    ```azure-cli
    az webapp deployment slot create --name $webappname --resource-group AzureTutorial --slot staging
    ```

    2. Настройте промежуточный слот, чтобы использовать развертывание из локального Git и get **промежуточных** URL-адрес развертывания. **Запишите этот URL-адрес для ссылки на более поздней версии**.

    ```azure-cli
    echo Git deployment URL for staging: $(az webapp deployment source config-local-git --name $webappname --resource-group AzureTutorial --slot staging --query url --output tsv)
    ```

    В. Отображать URL-адрес промежуточного слота. Перейдите на URL-адрес, чтобы увидеть пустой промежуточный слот. **Запишите этот URL-адрес для ссылки на более поздней версии**.

    ```console
    echo Staging web app URL: http://$webappname-staging.azurewebsites.net
    ```

3. В текстовом редакторе или Visual Studio, измените *Pages/Index.cshtml* еще раз, чтобы `<h2>` считывает элемент `<h2>Simple Feed Reader - V3</h2>` и сохраните файл.

4. Зафиксировать файл в локальном репозитории Git, с помощью **изменения** страницы в Visual Studio *Team Explorer* вкладке или путем ввода следующих с помощью командной оболочки на локальном компьютере:

    ```console
    git commit -a -m "upgraded to V3"
    ```
5. С помощью командной оболочки на локальном компьютере, добавьте URL-адрес промежуточного развертывания в качестве удаленного репозитория Git и отправьте зафиксированные изменения.

    1. Добавьте удаленный URL-адрес для промежуточного хранения в локальном репозитории Git.

    ```console
    git remote add azure-staging <Git_staging_deployment_URL>
    ```

    2. Push-локальной *master* ветви для *azure промежуточной* удаленного элемента *master* ветви.

    ```console
    git push azure-staging master
    ```

    Подождите, пока Azure создает и развертывает приложение.

6. Чтобы убедиться, что V3 был развернут в промежуточном слоте, откройте два окна браузера. В одном окне перейдите к URL исходного веб-приложения. В другом окне перейдите к URL промежуточного веб-приложения. URL-адрес рабочей служит V2 приложения. URL-адрес промежуточной служит V3 приложения.

    ![Снимок экрана: сравнение окно браузера](./media/deploying-to-app-service/ready-to-swap.png)

7. В Cloud Shell переключите промежуточный слот проверен и последующее вверх в рабочей среде.

    ```azure-cli
    az webapp deployment slot swap --name $webappname --resource-group AzureTutorial --slot staging
    ```

8. Проверьте, внесения переключения, обновив окно два браузера.

    ![Сравнение окно браузера после замены](./media/deploying-to-app-service/swapped.png)

## <a name="summary"></a>Сводка

В этом разделе были выполнены следующие задачи:

* Загружаются и построение примера приложения.
* Создать приложение службы веб-приложение Azure с помощью Azure Cloud Shell.
* Развернуть пример приложения в Azure с помощью Git.
* Развернуто изменение приложения с помощью Visual Studio.
* Добавить промежуточный слот для веб-приложения.
* Развернуть обновления в промежуточном слоте.
* Поменять местами промежуточными и рабочими слотами.

В следующем разделе вы узнаете, как создать конвейер DevOps с конвейерами Azure.

## <a name="additional-reading"></a>Дополнительные материалы для чтения

* [Обзор веб-приложений](/azure/app-service/app-service-web-overview)
* [Создание веб-приложения .NET Core с базой данных SQL в службе приложений Azure](/azure/app-service/app-service-web-tutorial-dotnetcore-sqldb)
* [Настройка учетных данных развертывания для службы приложений Azure](/azure/app-service/app-service-deployment-credentials)
* [Настройка промежуточных сред в службе приложений Azure](/azure/app-service/web-sites-staged-publishing)
