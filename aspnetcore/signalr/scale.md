---
title: ASP.NET Core SignalR рабочей среде размещения и масштабирования
author: bradygaster
description: Узнайте, как избежать производительность и масштабирование проблем в приложениях, использующих ASP.NET Core SignalR.
monikerRange: '>= aspnetcore-2.1'
ms.author: bradyg
ms.custom: mvc
ms.date: 11/28/2018
uid: signalr/scale
ms.openlocfilehash: 4ac4509acc89d0091a3757c7cfbc9981614f29ad
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/01/2019
ms.locfileid: "57037741"
---
# <a name="aspnet-core-signalr-hosting-and-scaling"></a>ASP.NET Core SignalR размещения и масштабирования

По [Andrew Stanton медсестра](https://twitter.com/anurse), [Brady Gaster](https://twitter.com/bradygaster), и [том Дайкстра](https://github.com/tdykstra),

В этой статье объясняется, размещения и масштабирования рекомендации для ресурсоемких приложений, использующих ASP.NET Core SignalR.

## <a name="tcp-connection-resources"></a>Ресурсы подключения TCP

Ограничено число параллельных соединений TCP, поддерживаемых веб-сервера. Использовать стандартные HTTP-клиентов *временные* подключений. Эти подключения может быть закрыт, когда клиент переходит в состояние бездействия и открывать позже. С другой стороны, является подключения SignalR *постоянных*. Подключений SignalR открытой, даже если клиент переходит в состояние бездействия. В приложении большим объемом трафика, которое служит большого числа клиентов эти постоянные подключения может привести к серверы нажатия их максимальное число подключений.

Постоянные подключения, также использовать некоторый дополнительный объем памяти, для отслеживания каждого подключения.

Интенсивное использование ресурсов, относящиеся к соединению, с SignalR может повлиять на другие веб-приложений, размещенных на одном сервере. При открытии SignalR и содержит последние доступные подключения TCP, больше нет доступных для их подключений также у других веб-приложений на одном сервере.

Если серверу не хватает подключений, вы увидите ошибки случайных сокета и сброс ошибок подключения. Пример:

```
An attempt was made to access a socket in a way forbidden by its access permissions...
```

Чтобы предотвратить использование ресурсов SignalR причины возникновения ошибок в других веб-приложений, выполните SignalR на разных серверах, чем другие веб-приложений.

Чтобы предотвратить использование ресурсов SignalR приводит к ошибкам в приложении SignalR, горизонтальное масштабирование, чтобы ограничить количество подключений, которые сервер должен обрабатывать.

## <a name="scale-out"></a>Масштабирование

Приложения, использующего SignalR необходимо для отслеживания его подключений, который создает проблемы для фермы серверов. Добавление сервера, и он получает новые подключения, которые не известны другие серверы. Например SignalR на каждом сервере, на следующей схеме не знает, подключений на других серверах. Когда SignalR на одном из серверов хочет отправить сообщение всем клиентам, сообщение проходит только клиентов, подключенных к этому серверу.

![Масштабирование без объединительной панели SignalR](scale/_static/scale-no-backplane.png)

Существуют следующие варианты решения этой проблемы: [служба Azure SignalR](#azure-signalr-service) и [Redis объединительной платы](#redis-backplane).

## <a name="azure-signalr-service"></a>Служба Azure SignalR

Служба Azure SignalR — прокси-сервер, а не на задней панели. Каждый раз, когда клиент инициирует подключение к серверу, чтобы подключиться к службе перенаправляется клиент. Этот процесс показан на следующей схеме:

![Подключения к службе Azure SignalR](scale/_static/azure-signalr-service-one-connection.png)

Результатом является то, что эта служба управляет все подключения клиента, хотя на каждом сервере должно только небольшой постоянного числа подключений к службе, как показано на следующей схеме:

![Клиенты, подключенные к службе, серверов, подключенных к службе](scale/_static/azure-signalr-service-multiple-connections.png)

Такой подход для горизонтального масштабирования имеет несколько преимуществ, в качестве альтернативы объединительной платы Redis:

* Прикрепленные сеансы, также известный как [сходство клиента](/iis/extensions/configuring-application-request-routing-arr/http-load-balancing-using-application-request-routing#step-3---configure-client-affinity), не является обязательным, так как клиенты немедленно перенаправляются в службу Azure SignalR, при подключении.
* SignalR, которые можно развернуть приложение на основе числа отправленных сообщений, хотя служба Azure SignalR автоматически масштабируется для поддержки любого количества подключений. Например возможно, существуют тысячи клиентов, но только если для отправки нескольких сообщений в секунду, SignalR приложения не нужно масштабировать на несколько серверов только для обработки подключений, сами.
* Приложение SignalR не будет использовать подключения значительно больше ресурсов, чем веб-приложения без SignalR.

По этим причинам рекомендуется, чтобы служба Azure SignalR для всех приложений ASP.NET Core SignalR, размещенных в Azure, включая службы приложений, виртуальных машин и контейнеров.

Дополнительные сведения см. в разделе [документации по службе Azure SignalR](/azure/azure-signalr/signalr-overview).

## <a name="redis-backplane"></a>Канал обмена Redis

[Redis](https://redis.io/) представляет собой хранилище ключ значение в памяти, который поддерживает систему обмена сообщениями с помощью модели публикации и подписки. На задней стороне SignalR Redis используется функция pub/sub для перенаправления сообщений к другим серверам. Когда клиент делает подключения, сведения о соединении передается задней панели. Когда сервер хочет отправить сообщение всем клиентам, он отправляет к задней панели. Задняя панель знает всех подключенных клиентов, а какие серверы, они в. Он отправляет сообщение всем клиентам с помощью их соответствующих серверов. Этот процесс показан на следующей схеме:

![Redis объединительной платы, сообщение, отправленное с одного сервера ко всем клиентам](scale/_static/redis-backplane.png)

На задней стороне Redis является рекомендуемым горизонтального масштабирования для приложений, размещенных в вашей собственной инфраструктуры. Служба Azure SignalR не является целесообразным для использования в рабочей среде с локальным приложениям из-за задержки подключения между центре обработки данных и центр обработки данных Azure.

Служба Azure SignalR преимущества, записанные ранее являются недостатки Redis объединительной платы:

* Прикрепленные сеансы, также известный как [сходство клиента](/iis/extensions/configuring-application-request-routing-arr/http-load-balancing-using-application-request-routing#step-3---configure-client-affinity), является обязательным. После запуска подключения на сервере, соединение должен оставаться на этом сервере.
* Приложение SignalR необходимо горизонтальное масштабирование зависят от количества клиентов, даже если несколько сообщения отправляются.
* Приложение SignalR использует соединения значительно больше ресурсов, чем веб-приложения без SignalR.

## <a name="next-steps"></a>Следующие шаги

Дополнительные сведения см. в следующих ресурсах:

* [Документация по службе SignalR Azure](/azure/azure-signalr/signalr-overview)
* [Настройка Redis объединительной платы](xref:signalr/redis-backplane)
