---
title: ASP.NET Core SignalR рабочей среде размещения и масштабирования
author: bradygaster
description: Узнайте, как избежать производительность и масштабирование проблем в приложениях, использующих ASP.NET Core SignalR.
monikerRange: '>= aspnetcore-2.1'
ms.author: bradyg
ms.custom: mvc
ms.date: 11/28/2018
uid: signalr/scale
ms.openlocfilehash: 4ac4509acc89d0091a3757c7cfbc9981614f29ad
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/01/2019
ms.locfileid: "57037741"
---
# <a name="aspnet-core-signalr-hosting-and-scaling"></a><span data-ttu-id="0cbb9-103">ASP.NET Core SignalR размещения и масштабирования</span><span class="sxs-lookup"><span data-stu-id="0cbb9-103">ASP.NET Core SignalR hosting and scaling</span></span>

<span data-ttu-id="0cbb9-104">По [Andrew Stanton медсестра](https://twitter.com/anurse), [Brady Gaster](https://twitter.com/bradygaster), и [том Дайкстра](https://github.com/tdykstra),</span><span class="sxs-lookup"><span data-stu-id="0cbb9-104">By [Andrew Stanton-Nurse](https://twitter.com/anurse), [Brady Gaster](https://twitter.com/bradygaster), and [Tom Dykstra](https://github.com/tdykstra),</span></span>

<span data-ttu-id="0cbb9-105">В этой статье объясняется, размещения и масштабирования рекомендации для ресурсоемких приложений, использующих ASP.NET Core SignalR.</span><span class="sxs-lookup"><span data-stu-id="0cbb9-105">This article explains hosting and scaling considerations for high-traffic apps that use ASP.NET Core SignalR.</span></span>

## <a name="tcp-connection-resources"></a><span data-ttu-id="0cbb9-106">Ресурсы подключения TCP</span><span class="sxs-lookup"><span data-stu-id="0cbb9-106">TCP connection resources</span></span>

<span data-ttu-id="0cbb9-107">Ограничено число параллельных соединений TCP, поддерживаемых веб-сервера.</span><span class="sxs-lookup"><span data-stu-id="0cbb9-107">The number of concurrent TCP connections that a web server can support is limited.</span></span> <span data-ttu-id="0cbb9-108">Использовать стандартные HTTP-клиентов *временные* подключений.</span><span class="sxs-lookup"><span data-stu-id="0cbb9-108">Standard HTTP clients use *ephemeral* connections.</span></span> <span data-ttu-id="0cbb9-109">Эти подключения может быть закрыт, когда клиент переходит в состояние бездействия и открывать позже.</span><span class="sxs-lookup"><span data-stu-id="0cbb9-109">These connections can be closed when the client goes idle and reopened later.</span></span> <span data-ttu-id="0cbb9-110">С другой стороны, является подключения SignalR *постоянных*.</span><span class="sxs-lookup"><span data-stu-id="0cbb9-110">On the other hand, a SignalR connection is *persistent*.</span></span> <span data-ttu-id="0cbb9-111">Подключений SignalR открытой, даже если клиент переходит в состояние бездействия.</span><span class="sxs-lookup"><span data-stu-id="0cbb9-111">SignalR connections stay open even when the client goes idle.</span></span> <span data-ttu-id="0cbb9-112">В приложении большим объемом трафика, которое служит большого числа клиентов эти постоянные подключения может привести к серверы нажатия их максимальное число подключений.</span><span class="sxs-lookup"><span data-stu-id="0cbb9-112">In a high-traffic app that serves many clients, these persistent connections can cause servers to hit their maximum number of connections.</span></span>

<span data-ttu-id="0cbb9-113">Постоянные подключения, также использовать некоторый дополнительный объем памяти, для отслеживания каждого подключения.</span><span class="sxs-lookup"><span data-stu-id="0cbb9-113">Persistent connections also consume some additional memory, to track each connection.</span></span>

<span data-ttu-id="0cbb9-114">Интенсивное использование ресурсов, относящиеся к соединению, с SignalR может повлиять на другие веб-приложений, размещенных на одном сервере.</span><span class="sxs-lookup"><span data-stu-id="0cbb9-114">The heavy use of connection-related resources by SignalR can affect other web apps that are hosted on the same server.</span></span> <span data-ttu-id="0cbb9-115">При открытии SignalR и содержит последние доступные подключения TCP, больше нет доступных для их подключений также у других веб-приложений на одном сервере.</span><span class="sxs-lookup"><span data-stu-id="0cbb9-115">When SignalR opens and holds the last available TCP connections, other web apps on the same server also have no more connections available to them.</span></span>

<span data-ttu-id="0cbb9-116">Если серверу не хватает подключений, вы увидите ошибки случайных сокета и сброс ошибок подключения.</span><span class="sxs-lookup"><span data-stu-id="0cbb9-116">If a server runs out of connections, you'll see random socket errors and connection reset errors.</span></span> <span data-ttu-id="0cbb9-117">Пример:</span><span class="sxs-lookup"><span data-stu-id="0cbb9-117">For example:</span></span>

```
An attempt was made to access a socket in a way forbidden by its access permissions...
```

<span data-ttu-id="0cbb9-118">Чтобы предотвратить использование ресурсов SignalR причины возникновения ошибок в других веб-приложений, выполните SignalR на разных серверах, чем другие веб-приложений.</span><span class="sxs-lookup"><span data-stu-id="0cbb9-118">To keep SignalR resource usage from causing errors in other web apps, run SignalR on different servers than your other web apps.</span></span>

<span data-ttu-id="0cbb9-119">Чтобы предотвратить использование ресурсов SignalR приводит к ошибкам в приложении SignalR, горизонтальное масштабирование, чтобы ограничить количество подключений, которые сервер должен обрабатывать.</span><span class="sxs-lookup"><span data-stu-id="0cbb9-119">To keep SignalR resource usage from causing errors in a SignalR app, scale out to limit the number of connections a server has to handle.</span></span>

## <a name="scale-out"></a><span data-ttu-id="0cbb9-120">Масштабирование</span><span class="sxs-lookup"><span data-stu-id="0cbb9-120">Scale out</span></span>

<span data-ttu-id="0cbb9-121">Приложения, использующего SignalR необходимо для отслеживания его подключений, который создает проблемы для фермы серверов.</span><span class="sxs-lookup"><span data-stu-id="0cbb9-121">An app that uses SignalR needs to keep track of all its connections, which creates problems for a server farm.</span></span> <span data-ttu-id="0cbb9-122">Добавление сервера, и он получает новые подключения, которые не известны другие серверы.</span><span class="sxs-lookup"><span data-stu-id="0cbb9-122">Add a server, and it gets new connections that the other servers don't know about.</span></span> <span data-ttu-id="0cbb9-123">Например SignalR на каждом сервере, на следующей схеме не знает, подключений на других серверах.</span><span class="sxs-lookup"><span data-stu-id="0cbb9-123">For example, SignalR on each server in the following diagram is unaware of the connections on the other servers.</span></span> <span data-ttu-id="0cbb9-124">Когда SignalR на одном из серверов хочет отправить сообщение всем клиентам, сообщение проходит только клиентов, подключенных к этому серверу.</span><span class="sxs-lookup"><span data-stu-id="0cbb9-124">When SignalR on one of the servers wants to send a message to all clients, the message only goes to the clients connected to that server.</span></span>

![Масштабирование без объединительной панели SignalR](scale/_static/scale-no-backplane.png)

<span data-ttu-id="0cbb9-126">Существуют следующие варианты решения этой проблемы: [служба Azure SignalR](#azure-signalr-service) и [Redis объединительной платы](#redis-backplane).</span><span class="sxs-lookup"><span data-stu-id="0cbb9-126">The options for solving this problem are the [Azure SignalR Service](#azure-signalr-service) and [Redis backplane](#redis-backplane).</span></span>

## <a name="azure-signalr-service"></a><span data-ttu-id="0cbb9-127">Служба Azure SignalR</span><span class="sxs-lookup"><span data-stu-id="0cbb9-127">Azure SignalR Service</span></span>

<span data-ttu-id="0cbb9-128">Служба Azure SignalR — прокси-сервер, а не на задней панели.</span><span class="sxs-lookup"><span data-stu-id="0cbb9-128">The Azure SignalR Service is a proxy rather than a backplane.</span></span> <span data-ttu-id="0cbb9-129">Каждый раз, когда клиент инициирует подключение к серверу, чтобы подключиться к службе перенаправляется клиент.</span><span class="sxs-lookup"><span data-stu-id="0cbb9-129">Each time a client initiates a connection to the server, the client is redirected to connect to the service.</span></span> <span data-ttu-id="0cbb9-130">Этот процесс показан на следующей схеме:</span><span class="sxs-lookup"><span data-stu-id="0cbb9-130">That process is illustrated in the following diagram:</span></span>

![Подключения к службе Azure SignalR](scale/_static/azure-signalr-service-one-connection.png)

<span data-ttu-id="0cbb9-132">Результатом является то, что эта служба управляет все подключения клиента, хотя на каждом сервере должно только небольшой постоянного числа подключений к службе, как показано на следующей схеме:</span><span class="sxs-lookup"><span data-stu-id="0cbb9-132">The result is that the service manages all of the client connections, while each server needs only a small constant number of connections to the service, as shown in the following diagram:</span></span>

![Клиенты, подключенные к службе, серверов, подключенных к службе](scale/_static/azure-signalr-service-multiple-connections.png)

<span data-ttu-id="0cbb9-134">Такой подход для горизонтального масштабирования имеет несколько преимуществ, в качестве альтернативы объединительной платы Redis:</span><span class="sxs-lookup"><span data-stu-id="0cbb9-134">This approach to scale-out has several advantages over the Redis backplane alternative:</span></span>

* <span data-ttu-id="0cbb9-135">Прикрепленные сеансы, также известный как [сходство клиента](/iis/extensions/configuring-application-request-routing-arr/http-load-balancing-using-application-request-routing#step-3---configure-client-affinity), не является обязательным, так как клиенты немедленно перенаправляются в службу Azure SignalR, при подключении.</span><span class="sxs-lookup"><span data-stu-id="0cbb9-135">Sticky sessions, also known as [client affinity](/iis/extensions/configuring-application-request-routing-arr/http-load-balancing-using-application-request-routing#step-3---configure-client-affinity), is not required, because clients are immediately redirected to the Azure SignalR Service when they connect.</span></span>
* <span data-ttu-id="0cbb9-136">SignalR, которые можно развернуть приложение на основе числа отправленных сообщений, хотя служба Azure SignalR автоматически масштабируется для поддержки любого количества подключений.</span><span class="sxs-lookup"><span data-stu-id="0cbb9-136">A SignalR app can scale out based on the number of messages sent, while the Azure SignalR Service automatically scales to handle any number of connections.</span></span> <span data-ttu-id="0cbb9-137">Например возможно, существуют тысячи клиентов, но только если для отправки нескольких сообщений в секунду, SignalR приложения не нужно масштабировать на несколько серверов только для обработки подключений, сами.</span><span class="sxs-lookup"><span data-stu-id="0cbb9-137">For example, there could be thousands of clients, but if only a few messages per second are sent, the SignalR app won't need to scale out to multiple servers just to handle the connections themselves.</span></span>
* <span data-ttu-id="0cbb9-138">Приложение SignalR не будет использовать подключения значительно больше ресурсов, чем веб-приложения без SignalR.</span><span class="sxs-lookup"><span data-stu-id="0cbb9-138">A SignalR app won't use significantly more connection resources than a web app without SignalR.</span></span>

<span data-ttu-id="0cbb9-139">По этим причинам рекомендуется, чтобы служба Azure SignalR для всех приложений ASP.NET Core SignalR, размещенных в Azure, включая службы приложений, виртуальных машин и контейнеров.</span><span class="sxs-lookup"><span data-stu-id="0cbb9-139">For these reasons, we recommend the Azure SignalR Service for all ASP.NET Core SignalR apps hosted on Azure, including App Service, VMs, and containers.</span></span>

<span data-ttu-id="0cbb9-140">Дополнительные сведения см. в разделе [документации по службе Azure SignalR](/azure/azure-signalr/signalr-overview).</span><span class="sxs-lookup"><span data-stu-id="0cbb9-140">For more information see the [Azure SignalR Service documentation](/azure/azure-signalr/signalr-overview).</span></span>

## <a name="redis-backplane"></a><span data-ttu-id="0cbb9-141">Канал обмена Redis</span><span class="sxs-lookup"><span data-stu-id="0cbb9-141">Redis backplane</span></span>

<span data-ttu-id="0cbb9-142">[Redis](https://redis.io/) представляет собой хранилище ключ значение в памяти, который поддерживает систему обмена сообщениями с помощью модели публикации и подписки.</span><span class="sxs-lookup"><span data-stu-id="0cbb9-142">[Redis](https://redis.io/) is an in-memory key-value store that supports a messaging system with a publish/subscribe model.</span></span> <span data-ttu-id="0cbb9-143">На задней стороне SignalR Redis используется функция pub/sub для перенаправления сообщений к другим серверам.</span><span class="sxs-lookup"><span data-stu-id="0cbb9-143">The SignalR Redis backplane uses the pub/sub feature to forward messages to other servers.</span></span> <span data-ttu-id="0cbb9-144">Когда клиент делает подключения, сведения о соединении передается задней панели.</span><span class="sxs-lookup"><span data-stu-id="0cbb9-144">When a client makes a connection, the connection information is passed to the backplane.</span></span> <span data-ttu-id="0cbb9-145">Когда сервер хочет отправить сообщение всем клиентам, он отправляет к задней панели.</span><span class="sxs-lookup"><span data-stu-id="0cbb9-145">When a server wants to send a message to all clients, it sends to the backplane.</span></span> <span data-ttu-id="0cbb9-146">Задняя панель знает всех подключенных клиентов, а какие серверы, они в.</span><span class="sxs-lookup"><span data-stu-id="0cbb9-146">The backplane knows all connected clients and which servers they're on.</span></span> <span data-ttu-id="0cbb9-147">Он отправляет сообщение всем клиентам с помощью их соответствующих серверов.</span><span class="sxs-lookup"><span data-stu-id="0cbb9-147">It sends the message to all clients via their respective servers.</span></span> <span data-ttu-id="0cbb9-148">Этот процесс показан на следующей схеме:</span><span class="sxs-lookup"><span data-stu-id="0cbb9-148">This process is illustrated in the following diagram:</span></span>

![Redis объединительной платы, сообщение, отправленное с одного сервера ко всем клиентам](scale/_static/redis-backplane.png)

<span data-ttu-id="0cbb9-150">На задней стороне Redis является рекомендуемым горизонтального масштабирования для приложений, размещенных в вашей собственной инфраструктуры.</span><span class="sxs-lookup"><span data-stu-id="0cbb9-150">The Redis backplane is the recommended scale-out approach for apps hosted on your own infrastructure.</span></span> <span data-ttu-id="0cbb9-151">Служба Azure SignalR не является целесообразным для использования в рабочей среде с локальным приложениям из-за задержки подключения между центре обработки данных и центр обработки данных Azure.</span><span class="sxs-lookup"><span data-stu-id="0cbb9-151">Azure SignalR Service isn't a practical option for production use with on-premises apps due to connection latency between your data center and an Azure data center.</span></span>

<span data-ttu-id="0cbb9-152">Служба Azure SignalR преимущества, записанные ранее являются недостатки Redis объединительной платы:</span><span class="sxs-lookup"><span data-stu-id="0cbb9-152">The Azure SignalR Service advantages noted earlier are disadvantages for the Redis backplane:</span></span>

* <span data-ttu-id="0cbb9-153">Прикрепленные сеансы, также известный как [сходство клиента](/iis/extensions/configuring-application-request-routing-arr/http-load-balancing-using-application-request-routing#step-3---configure-client-affinity), является обязательным.</span><span class="sxs-lookup"><span data-stu-id="0cbb9-153">Sticky sessions, also known as [client affinity](/iis/extensions/configuring-application-request-routing-arr/http-load-balancing-using-application-request-routing#step-3---configure-client-affinity), is required.</span></span> <span data-ttu-id="0cbb9-154">После запуска подключения на сервере, соединение должен оставаться на этом сервере.</span><span class="sxs-lookup"><span data-stu-id="0cbb9-154">Once a connection is initiated on a server, the connection has to stay on that server.</span></span>
* <span data-ttu-id="0cbb9-155">Приложение SignalR необходимо горизонтальное масштабирование зависят от количества клиентов, даже если несколько сообщения отправляются.</span><span class="sxs-lookup"><span data-stu-id="0cbb9-155">A SignalR app must scale out based on number of clients even if few messages are being sent.</span></span>
* <span data-ttu-id="0cbb9-156">Приложение SignalR использует соединения значительно больше ресурсов, чем веб-приложения без SignalR.</span><span class="sxs-lookup"><span data-stu-id="0cbb9-156">A SignalR app uses significantly more connection resources than a web app without SignalR.</span></span>

## <a name="next-steps"></a><span data-ttu-id="0cbb9-157">Следующие шаги</span><span class="sxs-lookup"><span data-stu-id="0cbb9-157">Next steps</span></span>

<span data-ttu-id="0cbb9-158">Дополнительные сведения см. в следующих ресурсах:</span><span class="sxs-lookup"><span data-stu-id="0cbb9-158">For more information, see the following resources:</span></span>

* [<span data-ttu-id="0cbb9-159">Документация по службе SignalR Azure</span><span class="sxs-lookup"><span data-stu-id="0cbb9-159">Azure SignalR Service documentation</span></span>](/azure/azure-signalr/signalr-overview)
* [<span data-ttu-id="0cbb9-160">Настройка Redis объединительной платы</span><span class="sxs-lookup"><span data-stu-id="0cbb9-160">Set up a Redis backplane</span></span>](xref:signalr/redis-backplane)
