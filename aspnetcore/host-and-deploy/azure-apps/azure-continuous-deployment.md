---
title: Непрерывное развертывание ASP.NET Core в Azure с помощью Visual Studio и Git
author: rick-anderson
description: Сведения о создании веб-приложения ASP.NET Core с помощью Visual Studio и его развертывании в службе приложений Azure с использованием Git для непрерывного развертывания.
ms.author: riande
ms.custom: mvc
ms.date: 12/06/2018
uid: host-and-deploy/azure-apps/azure-continuous-deployment
ms.openlocfilehash: e12c2ee0b78db105b431770e8644e7d19d915765
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/01/2019
ms.locfileid: "57052961"
---
# <a name="continuous-deployment-to-azure-with-visual-studio-and-git-with-aspnet-core"></a>Непрерывное развертывание ASP.NET Core в Azure с помощью Visual Studio и Git

Автор: [Эрик Рейтан](https://github.com/Erikre) (Erik Reitan)

[!INCLUDE [Azure App Service Preview Notice](../../includes/azure-apps-preview-notice.md)]

В этом руководстве показано, как создать веб-приложение ASP.NET Core с помощью Visual Studio и развернуть его из Visual Studio в службе приложений Azure, используя непрерывное развертывание.

См. также статью [Create your first pipeline](/azure/devops/pipelines/get-started-yaml) (Создание первого конвейера), в которой объяснятеся, как настроить рабочий процесс непрерывной поставки (CD) для [Службы приложений Azure](/azure/app-service/app-service-web-overview) с помощью служб Azure DevOps. Azure Pipelines (служба, входящая в пакет Azure DevOps Services) упрощает настройку надежного конвейера развертывания с целью публикации обновлений для приложений, размещенных в Службе приложений Azure. Этот конвейер можно настроить на портале Azure для сборки, выполнения тестов, развертывания в промежуточном слоте и последующего развертывания в рабочей среде.

> [!NOTE]
> Для работы с этим руководством требуется учетная запись Microsoft Azure. Чтобы получить учетную запись, [активируйте преимущества подписчика MSDN](https://azure.microsoft.com/pricing/member-offers/credit-for-visual-studio-subscribers/?WT.mc_id=A261C142F) или [зарегистрируйтесь для получения бесплатной версии](https://azure.microsoft.com/free/?WT.mc_id=A261C142F).

## <a name="prerequisites"></a>Предварительные требования

В этом руководстве предполагается, что установлено следующее программное обеспечение:

* [Visual Studio](https://www.visualstudio.com)
* [!INCLUDE [](~/includes/net-core-sdk-download-link.md)]
* [Git](https://git-scm.com/downloads) для Windows.

## <a name="create-an-aspnet-core-web-app"></a>Создание веб-приложения ASP.NET Core

1. Запустите Visual Studio.

1. В меню **Файл** выберите пункт **Создать** > **Проект**.

1. Выберите шаблон проекта **Веб-приложение ASP.NET Core**. Он находится в разделе **Installed** (Установлено) > **Templates** (Шаблоны) > **Visual C#** > **.NET Core**. Задайте для проекта имя `SampleWebAppDemo`. Выберите параметр **Создать репозиторий Git** и нажмите кнопку **ОК**.

   ![Диалоговое окно создания нового проекта](azure-continuous-deployment/_static/01-new-project.png)

1. В диалоговом окне **New ASP.NET Core Project** (Новый проект ASP.NET Core) выберите **пустой** шаблон и щелкните **ОК**.

   ![Диалоговое окно "Создание проекта ASP.NET Core"](azure-continuous-deployment/_static/02-web-site-template.png)

> [!NOTE]
> Последним выпуском .NET Core является версия 2.0.

### <a name="running-the-web-app-locally"></a>Запуск веб-приложения в локальной системе

1. После того как Visual Studio завершит создание приложения, запустите его, выбрав **Отладка** > **Начать отладку**. Вы также можете нажать клавишу **F5**.

   Инициализация Visual Studio и нового приложения может занять некоторое время. По завершении запущенное приложение появится в браузере.

   ![Окно браузера с выполняющимся приложением, в котором выводится сообщение "Hello World!"](azure-continuous-deployment/_static/04-browser-runapp.png)

1. Посмотрев, как работает веб-приложение, закройте браузер и щелкните значок "Остановить отладку" на панели инструментов Visual Studio, чтобы остановить работу приложения.

## <a name="create-a-web-app-in-the-azure-portal"></a>Создание веб-приложения на портале Azure

Ниже приведены инструкции по созданию веб-приложения на портале Azure.

1. Войдите на [портал Azure](https://portal.azure.com).

1. В левом верхнем углу интерфейса портала нажмите **Создать**.

1. Выберите **Интернет и мобильные устройства** > **Веб-приложение**.

   ![Портал Microsoft Azure: Новая кнопка: Интернет и мобильные устройства в Marketplace: Кнопка "Веб-приложение" в разделе "Рекомендуемые приложения"](azure-continuous-deployment/_static/05-azure-newwebapp.png)

1. В колонке **Веб-приложение** в поле **Имя службы приложений** введите уникальное значение.

   ![Колонка "Веб-приложение"](azure-continuous-deployment/_static/06-azure-newappblade.png)

   > [!NOTE]
   > **Имя службы приложений** должно быть уникальным. Портал применяет это правило, если имя указано. Если вы введете другое значение, подставьте его вместо каждого экземпляра имени **SampleWebAppDemo** в этом руководстве.

   Кроме того, в колонке **Веб-приложение** выберите существующее **Расположение или план службы приложений** либо создайте собственный план или расположение. При создании плана необходимо выбрать ценовую категорию, расположение и другие параметры. Дополнительные сведения о планах службы приложений см. в статье [Обзор планов службы приложений Azure](/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview).

1. Выберите **Создать**. Azure подготовит и запустит веб-приложение.

   ![Портал Azure: колонка "Основное" для приложения SampleWebAppDemo01](azure-continuous-deployment/_static/07-azure-webappblade.png)

## <a name="enable-git-publishing-for-the-new-web-app"></a>Включение публикации в Git для нового веб-приложения

Git — это распределенная система управления версиями, с помощью которой можно развернуть веб-приложение службы приложений Azure. Код веб-приложения хранится в локальном репозитории Git и развертывается в Azure путем отправки в удаленный репозиторий.

1. Войдите на [портал Azure](https://portal.azure.com).

1. Щелкните **Службы приложений**, чтобы просмотреть список служб приложений, связанных с подпиской Azure.

1. Выберите веб-приложение, созданное в предыдущем разделе этого руководства.

1. В колонке **Deployment** (Развертывание) выберите **Deployment options** (Параметры развертывания) > **Выбор источника** > **Локальный репозиторий Git**.

   ![Колонка "Параметры": Колонка "Источник развертывания": Колонка "Выбрать источник"](azure-continuous-deployment/_static/deployment-options.png)

1. Нажмите кнопку **ОК**.

1. Если учетные данные развертывания для публикации веб-приложения или другого приложения службы приложений еще не настроены, сделайте это сейчас.

   * Выберите **Параметры** > **Учетные данные развертывания**. Появится колонка **Установка учетных данных развертывания**.
   * Создайте имя пользователя и пароль. Сохраните пароль для дальнейшего использования при настройке Git.
   * Нажмите кнопку **Сохранить**.

1. В колонке **Веб-приложение** выберите **Параметры** > **Свойства**. URL-адрес удаленного репозитория Git, в котором будет развертываться приложение, отображается в поле **URL-адрес GIT**.

1. Скопируйте значение в поле **URL-адрес Git**, так как оно понадобится далее в этом руководстве.

   ![Портал Azure > колонка свойств приложения](azure-continuous-deployment/_static/09-azure-giturl.png)

## <a name="publish-the-web-app-to-azure-app-service"></a>Публикация веб-приложения в Службе приложений Azure

В этом разделе с помощью Visual Studio будет создан локальный репозиторий Git, из которого код будет отправлен в Azure, чтобы развернуть веб-приложение. Для этого потребуется выполнить указанные ниже действия.

* Добавьте параметр удаленного репозитория, используя значение URL-адреса GIT, чтобы развернуть локальный репозиторий в Azure.
* Зафиксируйте изменения, внесенные в проект.
* Отправьте изменения, внесенные в проект, из локального репозитория в удаленный репозиторий в Azure.

1. В **обозревателе решений** щелкните правой кнопкой мыши элемент **Решение "SampleWebAppDemo"** и выберите пункт **Зафиксировать**. Откроется **Team Explorer**.

   ![Вкладка "Подключение" в Team Explorer](azure-continuous-deployment/_static/10-team-explorer.png)

1. В **Team Explorer** щелкните значок **Главная** и выберите **Параметры** > **Параметры репозитория**.

1. В разделе **Удаленные** окна **Параметры репозитория** нажмите кнопку **Добавить**. Откроется диалоговое окно **Добавить удаленный объект**.

1. В качестве **имени** удаленного объекта укажите **Azure-SampleApp**.

1. В поле **Извлечь** укажите **URL-адрес Git**, скопированный ранее на портале Azure. Обратите внимание на то, что этот URL-адрес должен заканчиваться на **.git**.

   ![Диалоговое окно "Изменение удаленного объекта"](azure-continuous-deployment/_static/11-add-remote.png)

   > [!NOTE]
   > Удаленный репозиторий можно также указать в **командном окне**. Для этого откройте **командное окно**, перейдите в каталог проекта и введите команду. Пример
   >
   > `git remote add Azure-SampleApp https://me@sampleapp.scm.azurewebsites.net:443/SampleApp.git`

1. Щелкните значок **Главная** и выберите **Параметры** > **Глобальные параметры**. Убедитесь, что имя и адрес электронной почты заданы. При необходимости щелкните **Обновить**.

1. Выберите **Главная** > **Изменения**, чтобы вернуться к представлению **Изменения**.

1. Введите сообщение о фиксации, например **Начальная отправка № 1**, и щелкните **Зафиксировать**. В результате будет создана локальная *фиксация*.

   ![Вкладка "Подключение" в Team Explorer](azure-continuous-deployment/_static/12-initial-commit.png)

   > [!NOTE]
   > Изменения можно также фиксировать в **командном окне**. Для этого откройте **командное окно**, перейдите в каталог проекта и введите команды Git. Пример
   >
   > `git add .`
   >
   > `git commit -am "Initial Push #1"`

1. Выберите **Главная** > **Синхронизировать** > **Действия** > **Открыть командную строку**. В командной строке откроется каталог проекта.

1. Введите в командном окне следующую команду:

   `git push -u Azure-SampleApp master`

1. Введите пароль из **учетных данных развертывания** в Azure, созданных ранее на портале Azure.

   Эта команда запускает процесс отправки локальных файлов проекта в Azure. Выходные данные приведенной выше команды заканчиваются сообщением о том, что развертывание прошло успешно.

   ```
   remote: Finished successfully.
   remote: Running post deployment command(s)...
   remote: Deployment successful.
   To https://username@samplewebappdemo01.scm.azurewebsites.net:443/SampleWebAppDemo01.git
   * [new branch]      master -> master
   Branch master set up to track remote branch master from Azure-SampleApp.
   ```

   > [!NOTE]
   > Если вам нужно работать над проектом совместно с другими пользователями, возможно, следует отправлять изменения в [GitHub](https://github.com), прежде чем отправлять их в Azure.
 
### <a name="verify-the-active-deployment"></a>Проверка активного развертывания

Убедитесь, что передача веб-приложения из локальной среды в Azure выполнена.

На [портале Azure](https://portal.azure.com) выберите веб-приложение. Выберите **Развертывание** > **Параметры развертывания**.

![Портал Azure: Колонка "Параметры": Колонка "Развертывания", содержащая успешное развертывание](azure-continuous-deployment/_static/13-verify-deployment.png)

## <a name="run-the-app-in-azure"></a>Запуск приложения в Azure

Теперь, когда веб-приложение развертывается в Azure, запустите приложение.

Это можно сделать двумя способами:

* На портале Azure найдите колонку соответствующего веб приложения. Щелкните **Обзор**, чтобы открыть приложение в браузере по умолчанию.
* Откройте браузер и введите URL-адрес веб-приложения. Пример: `http://SampleWebAppDemo.azurewebsites.net`

## <a name="update-the-web-app-and-republish"></a>Обновление и повторная публикация веб-приложения

После внесения изменений в локальный код выполните повторную публикацию.

1. В **обозревателе решений** Visual Studio откройте файл *Startup.cs*.

1. В методе `Configure` измените метод `Response.WriteAsync`, как показано ниже.

   ```csharp
   await context.Response.WriteAsync("Hello World! Deploy to Azure.");
   ```

1. Сохраните изменения в файле *Startup.cs*.

1. В **обозревателе решений** щелкните правой кнопкой мыши элемент **Решение "SampleWebAppDemo"** и выберите пункт **Зафиксировать**. Откроется **Team Explorer**.

1. Введите сообщение о фиксации, например: `Update #2`.

1. Нажмите кнопку **Зафиксировать**, чтобы зафиксировать изменения проекта.

1. Выберите **Главная** > **Синхронизировать** > **Действия** > **Отправить**.

> [!NOTE]
> Изменения можно также отправить в **командном окне**. Для этого откройте **командное окно**, перейдите в каталог проекта и введите команду Git. Пример
> 
> `git push -u Azure-SampleApp master`

## <a name="view-the-updated-web-app-in-azure"></a>Просмотр обновленного веб-приложения в Azure

Чтобы просмотреть обновленное веб-приложение, на портале Azure в колонке веб-приложения выберите **Обзор** или откройте браузер и введите URL-адрес веб-приложения. Пример: `http://SampleWebAppDemo.azurewebsites.net`

## <a name="additional-resources"></a>Дополнительные ресурсы

* [Создание первого конвейера с помощью Azure Pipelines](/azure/devops/pipelines/get-started-yaml)
* [Проект Kudu](https://github.com/projectkudu/kudu/wiki)
* <xref:host-and-deploy/visual-studio-publish-profiles>
