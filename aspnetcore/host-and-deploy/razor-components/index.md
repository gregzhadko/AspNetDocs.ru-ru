---
title: Размещение и развертывание компонентов Razor
author: guardrex
description: 'Узнайте, как производится размещение и развертывание компонентов Razor и приложений Blazor с помощью ASP.NET Core, сетей доставки содержимого (CDN), файловых серверов и страниц GitHub.'
monikerRange: '>= aspnetcore-3.0'
ms.author: riande
ms.custom: mvc
ms.date: 01/29/2019
uid: host-and-deploy/razor-components/index
---
# <a name="host-and-deploy-razor-components"></a>Размещение и развертывание компонентов Razor

Авторы: [Люк Лэтем](https://github.com/guardrex), [Рэйнер Стропек](https://www.timecockpit.com) и [Дэниэл Рот](https://github.com/danroth27)

[!INCLUDE[](~/includes/razor-components-preview-notice.md)]

## <a name="publish-the-app"></a>Публикация приложения

Приложения публикуются для развертывания в конфигурации выпуска при помощи команды [dotnet publish](/dotnet/core/tools/dotnet-publish). Интегрированная среда разработки может обрабатывать выполнение команды `dotnet publish` автоматически с помощью своих встроенных возможностей публикации, поэтому может быть необязательно вручную выполнять команду из командной строки в зависимости от используемых средств разработки.

```console
dotnet publish -c Release
```

`dotnet publish` активирует [восстановление](/dotnet/core/tools/dotnet-restore) зависимостей проекта и проводит [сборку](/dotnet/core/tools/dotnet-build) проекта, прежде чем создавать ресурсы для развертывания. В ходе процесса построения удаляются неиспользуемые методы и сборки, чтобы уменьшить размер скачиваемого приложения и время загрузки. Развертывание создается в папке */bin/Release/&lt;имя целевой платформы&gt;/publish*.

Ресурсы в папке *publish* развертываются на веб-сервере. Развертывание может проводиться вручную или автоматизированно в зависимости от используемых средств разработки.

## <a name="host-configuration-values"></a>Значения конфигурации узла

Приложения на основе компонентов Razor, использующие [модель размещения на сервере](xref:razor-components/hosting-models#server-side-hosting-model), могут принимать [значения конфигурации веб-узла](xref:fundamentals/host/web-host#host-configuration-values).

Приложения Blazor, использующие [модель размещения на стороне клиента](xref:razor-components/hosting-models#client-side-hosting-model), могут принимать следующие значения конфигурации узла в качестве аргументов командной строки во время выполнения в среде разработки.

### <a name="content-root"></a>Корень содержимого

Аргумент `--contentroot` задает абсолютный путь к каталогу, где находятся файлы содержимого приложения.

* Передайте этот аргумент при локальном запуске приложения в командной строке. Перейдите в каталог приложения и выполните следующую команду:

  ```console
  dotnet run --contentroot=/<content-root>
  ```

* Добавьте запись в файл приложения *launchSettings.json* в профиле **IIS Express**. Этот параметр выбирается при выполнении приложения с помощью отладчика Visual Studio и при запуске приложения из командной строки с помощью `dotnet run`.

  ```json
  "commandLineArgs": "--contentroot=/<content-root>"
  ```

* В Visual Studio укажите аргумент в меню **Свойства** > **Отладка** > **Аргументы приложения**. Задание аргумента на странице свойств Visual Studio добавляет его в файл *launchSettings.json*.

  ```console
  --contentroot=/<content-root>
  ```

### <a name="path-base"></a>Базовый путь

Аргумент `--pathbase` задает базовый путь приложения для локального выполнения с некорневым виртуальным путем (в `<base>` тег `href` задан с путем, отличным от `/` для промежуточной и рабочей сред). Дополнительные сведения см. в разделе [Базовый путь приложения](#app-base-path).

> [!IMPORTANT]
> В отличие от пути, заданного через `href` в теге `<base>`, не ставьте косую черту (`/`) при передаче значения аргумента `--pathbase`. Если основной путь приложения задан в теге `<base>` как `<base href="/CoolApp/" />` (включая косую черту в конце), передайте значение аргумента командной строки как `--pathbase=/CoolApp` (без косой черты в конце).

* Передайте этот аргумент при локальном запуске приложения в командной строке. Перейдите в каталог приложения и выполните следующую команду:

  ```console
  dotnet run --pathbase=/<virtual-path>
  ```

* Добавьте запись в файл приложения *launchSettings.json* в профиле **IIS Express**. Этот параметр выбирается при выполнении приложения с помощью отладчика Visual Studio и при запуске приложения из командной строки с помощью `dotnet run`.

  ```json
  "commandLineArgs": "--pathbase=/<virtual-path>"
  ```

* В Visual Studio укажите аргумент в меню **Свойства** > **Отладка** > **Аргументы приложения**. Задание аргумента на странице свойств Visual Studio добавляет его в файл *launchSettings.json*.

  ```console
  --pathbase=/<virtual-path>
  ```

### <a name="urls"></a>URL-адреса

Аргумент `--urls` задает IP-адреса или адреса узлов с портами и протоколами, по которым следует ожидать получения запросов.

* Передайте этот аргумент при локальном запуске приложения в командной строке. Перейдите в каталог приложения и выполните следующую команду:

  ```console
  dotnet run --urls=http://127.0.0.1:0
  ```

* Добавьте запись в файл приложения *launchSettings.json* в профиле **IIS Express**. Этот параметр выбирается при выполнении приложения с помощью отладчика Visual Studio и при запуске приложения из командной строки с помощью `dotnet run`.

  ```json
  "commandLineArgs": "--urls=http://127.0.0.1:0"
  ```

* В Visual Studio укажите аргумент в меню **Свойства** > **Отладка** > **Аргументы приложения**. Задание аргумента на странице свойств Visual Studio добавляет его в файл *launchSettings.json*.

  ```console
  --urls=http://127.0.0.1:0
  ```

## <a name="deploy-a-client-side-blazor-app"></a>Развертывание приложения Blazor на стороне клиента

[Модель размещения на стороне клиента](xref:razor-components/hosting-models#client-side-hosting-model).

* Приложение Blazor, его зависимости и среда выполнения .NET скачиваются в браузере.
* Приложение выполняется непосредственно в потоке пользовательского интерфейса браузера. Используется одна из следующих стратегий:
  * Приложение Blazor обслуживается приложением ASP.NET Core. См. раздел [Размещенное на стороне клиента развертывание Blazor с использованием ASP.NET Core](#client-side-blazor-hosted-deployment-with-aspnet-core).
  * Приложение Blazor помещается на статическом веб-сервере или службе, где .NET не используется, чтобы обслуживать приложение Blazor. См. раздел [Развертывание изолированного приложения Blazor на стороне клиента](#client-side-blazor-standalone-deployment).
  
### <a name="configure-the-linker"></a>Настройка компоновщика

Blazor выполняет компоновку для промежуточного языка (IL) в каждой сборке, чтобы удалить ненужный код из выходных сборок. Вы можете управлять компоновкой в ходе сборки. Дополнительные сведения см. в разделе <xref:host-and-deploy/razor-components/configure-linker>.

### <a name="rewrite-urls-for-correct-routing"></a>Переопределение URL-адресов для маршрутизации

Маршрутизация запросов к компонентам страниц в приложении на стороне клиента не сложнее, чем маршрутизация запросов к приложению, размещенному на стороне сервера. Рассмотрим случай клиентского приложения с двумя страницами:

* **_Main.cshtml_** &ndash; загружается в корне приложения и содержит ссылку на страницу About (`href="About"`).
* **_About.cshtml_** &ndash; — страница со сведениями.

При запросе документа приложения по умолчанию в адресной строке браузера (например, `https://www.contoso.com/`):

1. Браузер отправляет запрос.
1. Возвращается страница по умолчанию; обычно это *index.html*.
1. Страница *index.html* обеспечивает начальную загрузку приложения.
1. Загружается маршрутизатор Blazor; отображается страница Razor Main (*Main.cshtml*).

На странице "Main" выбор ссылки на страницу About загружает страницу About. Выбор ссылки на страницу About работает на клиентском компьютере, так как маршрутизатор Blazor не дает браузеру сделать запрос в Интернете к `www.contoso.com` для `About` и сам передает страницу About. Все запросы внутренних страниц *в пределах клиентского приложения* будут работать так же: Запросы не активируют браузерные запросы к ресурсам, размещенным на сервере в Интернете. Маршрутизатор обрабатывает запросы внутренним образом.

Если запрос `www.contoso.com/About` сделан с помощью адресной строки браузера, он завершится ошибкой. Такого ресурса не существует на интернет-узле приложения, поэтому возвращается ответ *404 не найдено*.

Поскольку браузеры выполняют запросы к интернет-узлам для страниц на стороне клиента, веб-серверам и службам размещения необходимо переопределять все запросы к ресурсам, физически находящимся не на сервере, в случае страницы *index.html*. Когда *index.html* возвращается, маршрутизатор клиентского приложения берет на себя управление и отвечает необходимым ресурсом.

### <a name="app-base-path"></a>Базовый путь приложения

Базовый путь приложения — это корневой путь виртуального приложения на сервере. Например, приложение, которое находится на сервере Contoso в виртуальной папке в `/CoolApp/`, достигается через `https://www.contoso.com/CoolApp` и имеет виртуальный базовый путь `/CoolApp/`. Если установить базовый путь приложения как `CoolApp/`, приложению становится известно, где оно фактически находится на сервере. Приложение может использовать базовый путь приложения для создания URL-адресов относительно корневого каталога приложения из компонента, который не находится в корневом каталоге. Благодаря этому компоненты, которые существуют на разных уровнях структуры каталогов, могут создавать ссылки на другие ресурсы во всех местах приложения. Основной путь приложения также используется для перехвата щелчка гиперссылок, когда `href` целевой объект ссылки находится в пределах URI-пространства базового пути приложения&mdash;; здесь маршрутизатор Blazor отвечает за внутреннюю навигацию.

Во многих сценариях размещения виртуальный серверный путь к приложению является корнем приложения. В таких случаях базовый путь приложения является косой чертой (`<base href="/" />`), что служит конфигурацией по умолчанию для приложения. В других сценариях размещения, таких как страницы GitHub и виртуальные каталоги и дочерние приложения IIS, базовому пути приложения должно быть присвоено значение виртуального серверного пути к приложению. Чтобы задать базовый путь приложения, нужно добавить или обновить тег `<base>` в *index.html* среди тегов элементов `<head>`. Задайте значение атрибута `href` как `<virtual-path>/` (косая черта в конце обязательна), где `<virtual-path>/` — полный корневой путь виртуального приложения на сервере приложения. В приведенном выше примере виртуальный путь имеет значение `CoolApp/`: `<base href="CoolApp/" />`.

Приложение с некорневым виртуальным путем (например, `<base href="CoolApp/" />`) не сможет найти свои ресурсы *при локальном запуске*. Для решения этой проблемы во время локальной разработки и тестирования можно предоставить аргумент *базового пути*, который соответствует значению `href` тега `<base>` во время выполнения.

Для передачи аргумента базового пути с корневым путем (`/`) при локальном запуске приложения выполните следующую команду из каталога приложения:

```console
dotnet run --pathbase=/CoolApp
```

Приложение отвечает локально по `http://localhost:port/CoolApp`.

Дополнительные сведения см. в разделе [Значение конфигурации узла для базового пути](#path-base).

> [!IMPORTANT]
> Если приложение использует [модель размещения на стороне клиента](xref:razor-components/hosting-models#client-side-hosting-model) (на основе шаблона проекта **Blazor**) и размещается как дочернее приложение IIS в приложении ASP.NET Core, очень важно отключить унаследованный обработчик модулей ASP.NET Core или убедиться, что раздел `<handlers>` файла *web.config* корневого (родительского) приложения не унаследован дочерним приложением.
>
> Удалите обработчик в опубликованном файле *web.config* приложения, добавив раздел `<handlers>` в файл:
>
> ```xml
> <handlers>
>   <remove name="aspNetCore" />
> </handlers>
> ```
>
> Кроме того, отключите наследование раздела `<system.webServer>` от корневого (родительского) приложения, задав для элемента `<location>` значение `inheritInChildApplications` как `false`:
>
> ```xml
> <?xml version="1.0" encoding="utf-8"?>
> <configuration>
>  <location path="." inheritInChildApplications="false">
>    <system.webServer>
>      <handlers>
>        <add name="aspNetCore" ... />
>      </handlers>
>      <aspNetCore ... />
>    </system.webServer>
>  </location>
> </configuration>
> ```
>
> Удаление обработчика или отключение наследования производится в дополнение к настройке базового пути приложения, как описано в этом разделе. Задайте базовый путь приложения в файле *index.html* приложения как псевдоним IIS, используемый при настройке дочернего приложения в IIS.

### <a name="client-side-blazor-hosted-deployment-with-aspnet-core"></a>Размещенное на стороне клиента развертывание Blazor с использованием ASP.NET Core

*Размещенное развертывание*  обслуживает клиентское приложение Blazor для браузеров из [приложения ASP.NET Core](xref:index), выполняющегося на сервере.

Приложение Blazor входит в состав приложения ASP.NET Core в публикуемых выходных данных; таким образом, два приложения развертываются вместе. Веб-сервер, позволяющий размещать приложения ASP.NET Core, является обязательным. Для размещенного развертывания Visual Studio включает шаблон проекта **Blazor (с размещением в ASP.NET Core)** (шаблон `blazorhosted` при использовании команды [dotnet new](/dotnet/core/tools/dotnet-new)).

Дополнительные сведения о размещении приложения ASP.NET Core и его развертывании см. в разделе <xref:host-and-deploy/index>.

Сведения о развертывании в службе приложений Azure см. в разделах:

<xref:tutorials/publish-to-azure-webapp-using-vs>  
Сведения о публикации приложения ASP.NET Core в службе приложений Azure с помощью Visual Studio.

### <a name="client-side-blazor-standalone-deployment"></a>Развертывание изолированного приложения Blazor на стороне клиента

*Автономное развертывание* представляет клиентское приложение Blazor как набор статических файлов, которые будут непосредственно запрошены клиентами. Веб-сервер не используется для обслуживания приложения Blazor.

#### <a name="client-side-blazor-standalone-hosting-with-iis"></a>Развертывание изолированного приложения Blazor с помощью IIS

IIS можно использовать как полнофункциональный статический файловый сервер для приложений Blazor. Чтобы настроить IIS для размещения Blazor, см. раздел [Построение статического веб-сайта на IIS](/iis/manage/creating-websites/scenario-build-a-static-website-on-iis).

Опубликованные ресурсы создаются в папке *\\bin\\Release\\&lt;целевая-платформа&gt;\\publish*. Разместить содержимое папки *publish* на веб-сервере или в службе размещения.

**web.config**

При публикации проекта Blazor создается файл *web.config* со следующей конфигурацией IIS:

* Типы MIME заданы для следующих расширений файлов:
  * *\*.dll*: `application/octet-stream`
  * *\*.json*: `application/json`
  * *\*.wasm*: `application/wasm`
  * *\*.woff*: `application/font-woff`
  * *\*.woff2*: `application/font-woff`
* Сжатие HTTP включено для следующих типов MIME:
  * `application/octet-stream`
  * `application/wasm`
* Задаются правила модуля переопределения URL-адресов:
  * Обслуживать вложенный каталог, где находятся статические ресурсы приложения (*&lt;имя-сборки&gt;\\dist\\&lt;запрошенный-путь&gt;*).
  * Создать резервный маршрут одностраничного приложения таким образом, что запросы, не относящиеся к файлам ресурсов, перенаправляются на документ по умолчанию приложения в папке статических ресурсов (*&lt;имя-сборки&gt;\\dist\\index.html*).

**Установка модуля переопределения URL-адресов**

[Модуль переопределения URL-адресов](https://www.iis.net/downloads/microsoft/url-rewrite) нужен, чтобы переопределять URL-адреса. Модуль не установлен по умолчанию и будет недоступен для установки как компонент службы роли веб-сервера (IIS). Модуль необходимо скачать с веб-сайта IIS. Для его установки используйте установщик веб-платформы.

1. Локально перейдите на [страницу скачивания модуля переопределения URL-адресов](https://www.iis.net/downloads/microsoft/url-rewrite#additionalDownloads). В англоязычной версии выберите **WebPI** для скачивания установщика веб-платформы. Для других языков выберите подходящую архитектуру сервера (x86 или x64) для скачивания установщика.
1. Скопируйте установщик на сервер. Запустите установщик. Нажмите кнопку **Установить** и примите условия лицензионного соглашения. Перезагрузка сервера после завершения установки не требуется.

**Настройте веб-сайт**

Установите для веб сайта **физический путь** к папке приложения. Папка содержит:

* Файл *web.config*, который используется службами IIS для настройки веб-сайта, включая необходимые правила перенаправления и типы содержимого файлов.
* Папку статических ресурсов приложения.

**Устранение неполадок**

Если получена *внутренняя ошибка сервера 500* и диспетчер служб IIS порождает ошибки при попытке получить доступ к конфигурации веб сайта, убедитесь, что установлен модуль переопределения URL-адресов. Если модуль не установлен, IIS не может проанализировать файл *web.config*. Это предотвращает загрузку конфигурации веб сайта диспетчером служб IIS и передачу статических файлов Blazor c веб-сайта.

Дополнительные сведения об устранении неполадок развертывания в службах IIS см. в разделе <xref:host-and-deploy/iis/troubleshoot>.

#### <a name="client-side-blazor-standalone-hosting-with-nginx"></a>Развертывание изолированного приложения Blazor с помощью Nginx

Следующий файл *nginx.conf* был упрощен с целью демонстрации настройки Nginx для отправки файла *Index.html* каждый раз, когда не удается найти соответствующий файл на диске.

```
events { }
http {
    server {
        listen 80;

        location / {
            root /usr/share/nginx/html;
            try_files $uri $uri/ /Index.html =404;
        }
    }
}
```

Дополнительные сведения о конфигурации веб-сервера Nginx в рабочей среде см. в разделе [Создание файлов конфигурации NGINX Plus и NGINX](https://docs.nginx.com/nginx/admin-guide/basic-functionality/managing-configuration-files/).

#### <a name="client-side-blazor-standalone-hosting-with-nginx-in-docker"></a>Развертывание изолированного приложения Blazor с помощью Docker

Чтобы разместить Blazor в Docker с помощью Nginx, настройте в Dockerfile образ с Nginx на основе Alpine. Измените Dockerfile, скопировав файл *nginx.config* в контейнер.

Добавьте одну строку в Dockerfile, как показано в следующем примере:

```
FROM nginx:alpine
COPY ./bin/Release/netstandard2.0/publish /usr/share/nginx/html/
COPY nginx.conf /etc/nginx/nginx.conf
```

#### <a name="client-side-blazor-standalone-hosting-with-github-pages"></a>Развертывание изолированного приложения Blazor с помощью страниц GitHub

Чтобы обеспечить переопределение URL-адресов, добавьте файл *404.html* со сценарием, который производит перенаправление на страницу *index.html*. Пример реализации, предоставленный сообществом, см. в разделе [Одностраничные приложения для страниц GitHub](http://spa-github-pages.rafrex.com/) ([rafrex/spa-github-pages на сайте GitHub](https://github.com/rafrex/spa-github-pages#readme)). Пример с использованием подхода сообщества можно увидеть в разделе [blazor-demo/blazor-demo.github.io на сайте GitHub](https://github.com/blazor-demo/blazor-demo.github.io) ([активный сайт](https://blazor-demo.github.io/)).

При использовании сайта проекта вместо сайта организации следует добавить или обновить тег `<base>` в файле *index.html*. Задайте значение атрибута `href` как `<repository-name>/`, где `<repository-name>/` — имя репозитория GitHub.

## <a name="deploy-a-server-side-razor-components-app"></a>Развертывание приложения на основе компонентов Razor на сервере

При использовании [модели размещения на сервере](xref:razor-components/hosting-models#server-side-hosting-model), компоненты Razor работают на сервере в приложении ASP.NET Core. Обновление элементов пользовательского интерфейса, обработка событий и вызовы JavaScript обрабатываются через подключение SignalR.

Приложение входит в состав приложения ASP.NET Core в публикуемых выходных данных; таким образом, два приложения развертываются вместе. Веб-сервер, позволяющий размещать приложения ASP.NET Core, является обязательным. Для развертывания на стороне сервера Visual Studio включает шаблон проекта **Blazor (с размещением на стороне сервера в ASP.NET Core)** (шаблон `blazorserver` при использовании команды [dotnet new](/dotnet/core/tools/dotnet-new)).

<!--

**INSERT: Concerns are the same as publishing an ASP.NET Core SignalR app**

**INSERT: Content on the Azure SignalR Service**

**INSERT: Manually turn on WebSockets support**

-->

При публикации приложения ASP.NET Core приложение на основе компонентов Razor включается в опубликованные выходные данные таким образом, чтобы приложение ASP.NET Core и приложение на основе компонентов Razor могли развертываться вместе. Дополнительные сведения о размещении приложения ASP.NET Core и его развертывании см. в разделе <xref:host-and-deploy/index>.

Сведения о развертывании в службе приложений Azure см. в разделах:

<xref:tutorials/publish-to-azure-webapp-using-vs>  
Сведения о публикации приложения ASP.NET Core в службе приложений Azure с помощью Visual Studio.
