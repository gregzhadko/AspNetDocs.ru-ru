---
uid: mvc/overview/older-versions-1/nerddinner/enable-automated-unit-testing
title: Включение автоматического модульного тестирования | Документация Майкрософт
author: microsoft
description: Шаг 12 показано, как разработать набор автоматических модульных тестов для проверки нашего функционала NerdDinner и которое даст нам уверенность в том, чтобы внести изменения...
ms.author: riande
ms.date: 07/27/2010
ms.assetid: a19ff2ce-3f7e-4358-9a51-a1403da9c63e
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/enable-automated-unit-testing
msc.type: authoredcontent
ms.openlocfilehash: 09a7aa186605a6cce48ee94028425ded957c00d3
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2019
ms.locfileid: "65117355"
---
# <a name="enable-automated-unit-testing"></a><span data-ttu-id="9639f-103">Включение автоматического модульного тестирования</span><span class="sxs-lookup"><span data-stu-id="9639f-103">Enable Automated Unit Testing</span></span>

<span data-ttu-id="9639f-104">по [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="9639f-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="9639f-105">Загрузить PDF-файл</span><span class="sxs-lookup"><span data-stu-id="9639f-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="9639f-106">Это 12 из бесплатной [руководство по использованию приложения «NerdDinner»](introducing-the-nerddinner-tutorial.md) , пошаговое рассмотрение как создать небольшой, но завершить, веб-приложения с помощью ASP.NET MVC 1.</span><span class="sxs-lookup"><span data-stu-id="9639f-106">This is step 12 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="9639f-107">Шаг 12 показано, как разработать набор автоматических модульных тестов для проверки нашего функционала NerdDinner и которое даст нам уверенность, изменения и улучшения в приложение в будущем.</span><span class="sxs-lookup"><span data-stu-id="9639f-107">Step 12 shows how to develop a suite of automated unit tests that verify our NerdDinner functionality, and which will give us the confidence to make changes and improvements to the application in the future.</span></span>
> 
> <span data-ttu-id="9639f-108">Если вы используете ASP.NET MVC 3, рекомендуется следовать [Приступая к работе с MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) или [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) учебники.</span><span class="sxs-lookup"><span data-stu-id="9639f-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>

## <a name="nerddinner-step-12-unit-testing"></a><span data-ttu-id="9639f-109">NerdDinner Step 12: Модульное тестирование</span><span class="sxs-lookup"><span data-stu-id="9639f-109">NerdDinner Step 12: Unit Testing</span></span>

<span data-ttu-id="9639f-110">Давайте разработаем это набор автоматических модульных тестов для проверки нашего функционала NerdDinner и которое даст нам уверенность, изменения и улучшения в приложение в будущем.</span><span class="sxs-lookup"><span data-stu-id="9639f-110">Let's develop a suite of automated unit tests that verify our NerdDinner functionality, and which will give us the confidence to make changes and improvements to the application in the future.</span></span>

### <a name="why-unit-test"></a><span data-ttu-id="9639f-111">Почему модульный тест?</span><span class="sxs-lookup"><span data-stu-id="9639f-111">Why Unit Test?</span></span>

<span data-ttu-id="9639f-112">На диске на работу утром один у вас есть внезапные вспышки вдохновения о приложении, над которым вы работаете из.</span><span class="sxs-lookup"><span data-stu-id="9639f-112">On the drive into work one morning you have a sudden flash of inspiration about an application you are working on.</span></span> <span data-ttu-id="9639f-113">Вы поймете, что изменение можно реализовать, значительно улучшить приложение.</span><span class="sxs-lookup"><span data-stu-id="9639f-113">You realize there is a change you can implement that will make the application dramatically better.</span></span> <span data-ttu-id="9639f-114">Возможно, рефакторинга, который удаляет код, добавляет новый компонент или исправляет ошибку.</span><span class="sxs-lookup"><span data-stu-id="9639f-114">It might be a refactoring that cleans up the code, adds a new feature, or fixes a bug.</span></span>

<span data-ttu-id="9639f-115">На вопрос, вы confronts при приходе на компьютере — «насколько безопасным его, чтобы сделать это улучшение?»</span><span class="sxs-lookup"><span data-stu-id="9639f-115">The question that confronts you when you arrive at your computer is – "how safe is it to make this improvement?"</span></span> <span data-ttu-id="9639f-116">Что делать, если внесение изменений имеет побочные эффекты или что-то нарушает?</span><span class="sxs-lookup"><span data-stu-id="9639f-116">What if making the change has side effects or breaks something?</span></span> <span data-ttu-id="9639f-117">Изменения могут быть простыми и занимает несколько минут для реализации, но что делать, если требуется часов, чтобы вручную протестировать все сценарии работы приложений?</span><span class="sxs-lookup"><span data-stu-id="9639f-117">The change might be simple and only take a few minutes to implement, but what if it takes hours to manually test out all of the application scenarios?</span></span> <span data-ttu-id="9639f-118">Что делать, если вы забудете охватить сценарий и приложение выходит в производство?</span><span class="sxs-lookup"><span data-stu-id="9639f-118">What if you forget to cover a scenario and a broken application goes into production?</span></span> <span data-ttu-id="9639f-119">Делает это улучшение действительно стоит всех?</span><span class="sxs-lookup"><span data-stu-id="9639f-119">Is making this improvement really worth all the effort?</span></span>

<span data-ttu-id="9639f-120">Автоматические модульные тесты обеспечивают средство подстраховки, дающий возможность постоянно Улучшите свои приложения и не стать боится кода, над которым вы работаете.</span><span class="sxs-lookup"><span data-stu-id="9639f-120">Automated unit tests can provide a safety net that enables you to continually enhance your applications, and avoid being afraid of the code you are working on.</span></span> <span data-ttu-id="9639f-121">Выполнив автоматические тесты, быстро убедитесь, что позволяет с уверенностью — программируйте и позволит вам для повышения качества, вы может в противном случае не чувствовать себя комфортно.</span><span class="sxs-lookup"><span data-stu-id="9639f-121">Having automated tests that quickly verify functionality enables you to code with confidence – and empower you to make improvements you might otherwise not have felt comfortable doing.</span></span> <span data-ttu-id="9639f-122">Они также помогают создавать решения, которые являются более простым в обслуживании и имеют большее время - какие приводит к гораздо выше окупаемости инвестиций.</span><span class="sxs-lookup"><span data-stu-id="9639f-122">They also help create solutions that are more maintainable and have a longer lifetime - which leads to a much higher return on investment.</span></span>

<span data-ttu-id="9639f-123">Платформа ASP.NET MVC позволяет простым и естественным функции модульного тестирования приложения.</span><span class="sxs-lookup"><span data-stu-id="9639f-123">The ASP.NET MVC Framework makes it easy and natural to unit test application functionality.</span></span> <span data-ttu-id="9639f-124">Он также позволяет протестировать разработку, управляемую (TDD) рабочий процесс, который позволяет осуществлять разработку на основе основанная на тестировании.</span><span class="sxs-lookup"><span data-stu-id="9639f-124">It also enables a Test Driven Development (TDD) workflow that enables test-first based development.</span></span>

### <a name="nerddinnertests-project"></a><span data-ttu-id="9639f-125">NerdDinner.Tests Project</span><span class="sxs-lookup"><span data-stu-id="9639f-125">NerdDinner.Tests Project</span></span>

<span data-ttu-id="9639f-126">Если мы создали наше приложение NerdDinner в начале работы с этим руководством, мы были будет появляться диалоговое окно с запросом ли нам нужно создать проект модульного теста для перехода вместе с проектом приложения:</span><span class="sxs-lookup"><span data-stu-id="9639f-126">When we created our NerdDinner application at the beginning of this tutorial, we were prompted with a dialog asking whether we wanted to create a unit test project to go along with the application project:</span></span>

![](enable-automated-unit-testing/_static/image1.png)

<span data-ttu-id="9639f-127">«Да, создать проект модульного теста» переключатель выбирается что привело к «NerdDinner.Tests» проекта, добавляемый наше решение сохранена:</span><span class="sxs-lookup"><span data-stu-id="9639f-127">We kept the "Yes, create a unit test project" radio button selected – which resulted in a "NerdDinner.Tests" project being added to our solution:</span></span>

![](enable-automated-unit-testing/_static/image2.png)

<span data-ttu-id="9639f-128">NerdDinner.Tests проект ссылается на сборку проекта приложение NerdDinner и позволяет легко добавлять автоматические тесты, проверьте функциональные возможности приложения его.</span><span class="sxs-lookup"><span data-stu-id="9639f-128">The NerdDinner.Tests project references the NerdDinner application project assembly, and enables us to easily add automated tests to it that verify the application functionality.</span></span>

### <a name="creating-unit-tests-for-our-dinner-model-class"></a><span data-ttu-id="9639f-129">Создание модульных тестов для нашего класса модели Dinner</span><span class="sxs-lookup"><span data-stu-id="9639f-129">Creating Unit Tests for our Dinner Model Class</span></span>

<span data-ttu-id="9639f-130">Давайте добавим некоторые тесты в свой проект NerdDinner.Tests, проверить класс обед, созданную при создании наш слой модели.</span><span class="sxs-lookup"><span data-stu-id="9639f-130">Let's add some tests to our NerdDinner.Tests project that verify the Dinner class we created when we built our model layer.</span></span>

<span data-ttu-id="9639f-131">Мы начнем с создания новой папки в наш проект теста с именем «Моделей», где мы поместим наши тесты, связанные с моделью.</span><span class="sxs-lookup"><span data-stu-id="9639f-131">We'll start by creating a new folder within our test project called "Models" where we'll place our model-related tests.</span></span> <span data-ttu-id="9639f-132">Мы затем папку правой кнопкой мыши и выберите **Add -&gt;новый тест** команды меню.</span><span class="sxs-lookup"><span data-stu-id="9639f-132">We'll then right-click on the folder and choose the **Add-&gt;New Test** menu command.</span></span> <span data-ttu-id="9639f-133">Это приведет к появлению диалогового окна «Добавление нового теста».</span><span class="sxs-lookup"><span data-stu-id="9639f-133">This will bring up the "Add New Test" dialog.</span></span>

<span data-ttu-id="9639f-134">Мы выберем создание «Unit Test» и назовите его «DinnerTest.cs»:</span><span class="sxs-lookup"><span data-stu-id="9639f-134">We'll choose to create a "Unit Test" and name it "DinnerTest.cs":</span></span>

![](enable-automated-unit-testing/_static/image3.png)

<span data-ttu-id="9639f-135">При нажатии кнопки «ОК» Visual Studio будет добавить (и открыть) DinnerTest.cs файл в проект:</span><span class="sxs-lookup"><span data-stu-id="9639f-135">When we click the "ok" button Visual Studio will add (and open) a DinnerTest.cs file to the project:</span></span>

![](enable-automated-unit-testing/_static/image4.png)

<span data-ttu-id="9639f-136">В шаблоне модульного теста по умолчанию Visual Studio имеет множество стереотипного кода внутри него, найти немного запутанным.</span><span class="sxs-lookup"><span data-stu-id="9639f-136">The default Visual Studio unit test template has a bunch of boiler-plate code within it that I find a little messy.</span></span> <span data-ttu-id="9639f-137">Давайте Очистка его должен просто содержать приведенный ниже код:</span><span class="sxs-lookup"><span data-stu-id="9639f-137">Let's clean it up to just contain the code below:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample1.cs)]

<span data-ttu-id="9639f-138">Атрибут [TestClass] на приведенный выше класс DinnerTest определяет его как класс, который будет содержать тесты, а также дополнительный тест инициализации и деинициализации кода.</span><span class="sxs-lookup"><span data-stu-id="9639f-138">The [TestClass] attribute on the DinnerTest class above identifies it as a class that will contain tests, as well as optional test initialization and teardown code.</span></span> <span data-ttu-id="9639f-139">Тесты в ней можно определить путем добавления открытых методов, на которых установлена атрибутом [TestMethod].</span><span class="sxs-lookup"><span data-stu-id="9639f-139">We can define tests within it by adding public methods that have a [TestMethod] attribute on them.</span></span>

<span data-ttu-id="9639f-140">Ниже приведены первое из двух тестов для, мы добавим наш класс ужин.</span><span class="sxs-lookup"><span data-stu-id="9639f-140">Below are the first of two tests we'll add that exercise our Dinner class.</span></span> <span data-ttu-id="9639f-141">Первый тест проверяет, что нашей компании Dinner является недопустимым, если новый Dinner создается без правильно задать все свойства.</span><span class="sxs-lookup"><span data-stu-id="9639f-141">The first test verifies that our Dinner is invalid if a new Dinner is created without all properties being set correctly.</span></span> <span data-ttu-id="9639f-142">Второй тест проверяет действительность нашей компании Dinner при Dinner имеет все свойства, заданные с допустимыми значениями:</span><span class="sxs-lookup"><span data-stu-id="9639f-142">The second test verifies that our Dinner is valid when a Dinner has all properties set with valid values:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample2.cs)]

<span data-ttu-id="9639f-143">Вы заметите выше, явным образом (и отчасти verbose) нашей имен тестов.</span><span class="sxs-lookup"><span data-stu-id="9639f-143">You'll notice above that our test names are very explicit (and somewhat verbose).</span></span> <span data-ttu-id="9639f-144">Мы делаем это, так как мы может оказаться, что создание сотни или тысячи Мелкие тесты, и мы хотим упростить процесс, можно быстро определить назначение и поведение каждого из них (в особенности мы ищем по списку ошибок в средство выполнения тестов).</span><span class="sxs-lookup"><span data-stu-id="9639f-144">We are doing this because we might end up creating hundreds or thousands of small tests, and we want to make it easy to quickly determine the intent and behavior of each of them (especially when we are looking through a list of failures in a test runner).</span></span> <span data-ttu-id="9639f-145">Имена тестов должны называться после функциональные возможности, которые они предназначены для проверки.</span><span class="sxs-lookup"><span data-stu-id="9639f-145">The test names should be named after the functionality they are testing.</span></span> <span data-ttu-id="9639f-146">Выше мы используем «существительное\_следует\_глагол «шаблон именования.</span><span class="sxs-lookup"><span data-stu-id="9639f-146">Above we are using a "Noun\_Should\_Verb" naming pattern.</span></span>

<span data-ttu-id="9639f-147">Мы структурирование тесты с помощью pattern — предназначенную для «Размещение, Act, Assert» тестирование «AAA»:</span><span class="sxs-lookup"><span data-stu-id="9639f-147">We are structuring the tests using the "AAA" testing pattern – which stands for "Arrange, Act, Assert":</span></span>

- <span data-ttu-id="9639f-148">Упорядочите: Единица тестируемой программы установки</span><span class="sxs-lookup"><span data-stu-id="9639f-148">Arrange: Setup the unit being tested</span></span>
- <span data-ttu-id="9639f-149">ACT: Упражнение модульного теста и записать результаты</span><span class="sxs-lookup"><span data-stu-id="9639f-149">Act: Exercise the unit under test and capture results</span></span>
- <span data-ttu-id="9639f-150">Утверждение: Проверьте поведение</span><span class="sxs-lookup"><span data-stu-id="9639f-150">Assert: Verify the behavior</span></span>

<span data-ttu-id="9639f-151">При написании тестов, мы хотим избежать отдельные тесты сделать слишком многое.</span><span class="sxs-lookup"><span data-stu-id="9639f-151">When we write tests we want to avoid having the individual tests do too much.</span></span> <span data-ttu-id="9639f-152">Вместо этого каждый тест следует проверить только единую концепцию (что сделает его гораздо легче определить причину сбоев).</span><span class="sxs-lookup"><span data-stu-id="9639f-152">Instead each test should verify only a single concept (which will make it much easier to pinpoint the cause of failures).</span></span> <span data-ttu-id="9639f-153">Рекомендуется является попробовать и иметь только один assert инструкции для каждого теста.</span><span class="sxs-lookup"><span data-stu-id="9639f-153">A good guideline is to try and only have a single assert statement for each test.</span></span> <span data-ttu-id="9639f-154">При наличии более одного оператора в методе теста контроля, убедитесь, что они все используются для тестирования совпадает с концепцией.</span><span class="sxs-lookup"><span data-stu-id="9639f-154">If you have more than one assert statement in a test method, make sure they are all being used to test the same concept.</span></span> <span data-ttu-id="9639f-155">Если вы сомневаетесь, сделайте еще один тест.</span><span class="sxs-lookup"><span data-stu-id="9639f-155">When in doubt, make another test.</span></span>

### <a name="running-tests"></a><span data-ttu-id="9639f-156">Выполнение тестов</span><span class="sxs-lookup"><span data-stu-id="9639f-156">Running Tests</span></span>

<span data-ttu-id="9639f-157">Visual Studio 2008 Professional (и более поздние версии) включает в себя встроенные тестов, которые можно использовать для выполнения модульных тестов Visual Studio проектов интегрированной среды разработки.</span><span class="sxs-lookup"><span data-stu-id="9639f-157">Visual Studio 2008 Professional (and higher editions) includes a built-in test runner that can be used to run Visual Studio Unit Test projects within the IDE.</span></span> <span data-ttu-id="9639f-158">Мы можем выбрать **Test -&gt;выполнения -&gt;все тесты в решении** меню команды (или нажмите клавиши Ctrl-R, A) для выполнения всех наших модульных тестов.</span><span class="sxs-lookup"><span data-stu-id="9639f-158">We can select the **Test-&gt;Run-&gt;All Tests in Solution** menu command (or type Ctrl R, A) to run all of our unit tests.</span></span> <span data-ttu-id="9639f-159">Или в качестве альтернативы можно поместите курсор внутри конкретного класса или тестового метода и использовать **Test -&gt;выполнения -&gt;тесты в текущем контексте** команды меню (или нажмите клавиши Ctrl-R, T), чтобы выполнить модульных тестов.</span><span class="sxs-lookup"><span data-stu-id="9639f-159">Or alternatively we can position our cursor within a specific test class or test method and use the **Test-&gt;Run-&gt;Tests in Current Context** menu command (or type Ctrl R, T) to run a subset of the unit tests.</span></span>

<span data-ttu-id="9639f-160">Давайте поместите курсор внутри класса DinnerTest и введите «Ctrl R, T» выполнение двух тестов, который мы только что определили.</span><span class="sxs-lookup"><span data-stu-id="9639f-160">Let's position our cursor within the DinnerTest class and type "Ctrl R, T" to run the two tests we just defined.</span></span> <span data-ttu-id="9639f-161">Когда для этого мы окне «Результаты теста» будет отображаться в Visual Studio, и мы увидим результаты тестового выполнения перечисленных в нем:</span><span class="sxs-lookup"><span data-stu-id="9639f-161">When we do this a "Test Results" window will appear within Visual Studio and we'll see the results of our test run listed within it:</span></span>

![](enable-automated-unit-testing/_static/image5.png)

<span data-ttu-id="9639f-162">*Примечание. В окне результатов теста VS не содержит столбца имя класса по умолчанию. Это можно добавить, щелкнув правой кнопкой мыши в окне результатов теста с помощью команды меню Добавить или удалить столбцы.*</span><span class="sxs-lookup"><span data-stu-id="9639f-162">*Note: The VS test results window does not show the Class Name column by default. You can add this by right-clicking within the Test Results window and using the Add/Remove Columns menu command.*</span></span>

<span data-ttu-id="9639f-163">Наши два тесты занимали только доли секунды для выполнения – и как вы можете см. оба они передаются.</span><span class="sxs-lookup"><span data-stu-id="9639f-163">Our two tests took only a fraction of a second to run – and as you can see they both passed.</span></span> <span data-ttu-id="9639f-164">Теперь можно перейти и дополнять их, создав другие тесты, которые проверить конкретное правило проверки, а также рассматриваются два вспомогательных метода - IsUserHost() и IsUserRegistered() —, мы добавили в класс Dinner.</span><span class="sxs-lookup"><span data-stu-id="9639f-164">We can now go on and augment them by creating additional tests that verify specific rule validations, as well as cover the two helper methods - IsUserHost() and IsUserRegistered() – that we added to the Dinner class.</span></span> <span data-ttu-id="9639f-165">Так все эти тесты находятся в месте для класса Dinner сделает его намного легче и безопаснее добавить новые бизнес-правила и проверки к нему в будущем.</span><span class="sxs-lookup"><span data-stu-id="9639f-165">Having all these tests in place for the Dinner class will make it much easier and safer to add new business rules and validations to it in the future.</span></span> <span data-ttu-id="9639f-166">Мы ужином можно добавить логику новые правила и затем в течение нескольких секунд убедиться, что он еще не нарушают любой из наших прежние функции логики.</span><span class="sxs-lookup"><span data-stu-id="9639f-166">We can add our new rule logic to Dinner, and then within seconds verify that it hasn't broken any of our previous logic functionality.</span></span>

<span data-ttu-id="9639f-167">Обратите внимание на то, как с помощью теста описательное имя позволяет быстро понять, что выполняется проверка каждого теста.</span><span class="sxs-lookup"><span data-stu-id="9639f-167">Notice how using a descriptive test name makes it easy to quickly understand what each test is verifying.</span></span> <span data-ttu-id="9639f-168">Я рекомендую использовать **Сервис -&gt;параметры** команды меню, открыв тестирования Сервис -&gt;экран настройки выполнения тестов и проверки «дважды щелкните результат теста неудачных или с неопределенным результатом отображается флажок точки сбоя в тесте».</span><span class="sxs-lookup"><span data-stu-id="9639f-168">I recommend using the **Tools-&gt;Options** menu command, opening the Test Tools-&gt;Test Execution configuration screen, and checking the "Double-clicking a failed or inconclusive unit test result displays the point of failure in the test" checkbox.</span></span> <span data-ttu-id="9639f-169">Это позволит вам дважды щелкните ошибку в окне результатов теста и мгновенного перехода к Сбой утверждения.</span><span class="sxs-lookup"><span data-stu-id="9639f-169">This will allow you to double-click on a failure in the test results window and jump immediately to the assert failure.</span></span>

### <a name="creating-dinnerscontroller-unit-tests"></a><span data-ttu-id="9639f-170">Создание DinnersController модульных тестов</span><span class="sxs-lookup"><span data-stu-id="9639f-170">Creating DinnersController Unit Tests</span></span>

<span data-ttu-id="9639f-171">Теперь создадим несколько модульных тестов, которые проверяют нашего функционала DinnersController.</span><span class="sxs-lookup"><span data-stu-id="9639f-171">Let's now create some unit tests that verify our DinnersController functionality.</span></span> <span data-ttu-id="9639f-172">Мы начнем, щелкнув правой кнопкой папку «Контроллеры», в тестовый проект и затем выберите **Add -&gt;новый тест** команды меню.</span><span class="sxs-lookup"><span data-stu-id="9639f-172">We'll start by right-clicking on the "Controllers" folder within our Test project and then choose the **Add-&gt;New Test** menu command.</span></span> <span data-ttu-id="9639f-173">Мы будем создайте «Unit Test» и назовите его «DinnersControllerTest.cs».</span><span class="sxs-lookup"><span data-stu-id="9639f-173">We'll create a "Unit Test" and name it "DinnersControllerTest.cs".</span></span>

<span data-ttu-id="9639f-174">Мы создадим два метода теста, которые проверяют на метод действия Details() в DinnersController.</span><span class="sxs-lookup"><span data-stu-id="9639f-174">We'll create two test methods that verify the Details() action method on the DinnersController.</span></span> <span data-ttu-id="9639f-175">Первый убедитесь, что представление возвращается при запросе существующие компании Dinner.</span><span class="sxs-lookup"><span data-stu-id="9639f-175">The first will verify that a View is returned when an existing Dinner is requested.</span></span> <span data-ttu-id="9639f-176">Второй убедитесь, что представление «NotFound» возвращается при запросе Dinner несуществующие:</span><span class="sxs-lookup"><span data-stu-id="9639f-176">The second will verify that a "NotFound" view is returned when a non-existent Dinner is requested:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample3.cs)]

<span data-ttu-id="9639f-177">Очистка компилирует код, представленный выше.</span><span class="sxs-lookup"><span data-stu-id="9639f-177">The above code compiles clean.</span></span> <span data-ttu-id="9639f-178">При запуске тестов, однако завершаются с ошибкой:</span><span class="sxs-lookup"><span data-stu-id="9639f-178">When we run the tests, though, they both fail:</span></span>

![](enable-automated-unit-testing/_static/image6.png)

<span data-ttu-id="9639f-179">Если взглянуть на сообщения об ошибках, мы увидим, что причина Тест завершен с ошибкой был так, как наш класс DinnersRepository не удалось соединиться с базой данных.</span><span class="sxs-lookup"><span data-stu-id="9639f-179">If we look at the error messages, we'll see that the reason the tests failed was because our DinnersRepository class was unable to connect to a database.</span></span> <span data-ttu-id="9639f-180">Наше приложение NerdDinner использует строку подключения в локальный файл SQL Server Express, которая находится в разделе \App\_каталог данных NerdDinner проекта приложения.</span><span class="sxs-lookup"><span data-stu-id="9639f-180">Our NerdDinner application is using a connection-string to a local SQL Server Express file which lives under the \App\_Data directory of the NerdDinner application project.</span></span> <span data-ttu-id="9639f-181">Поскольку наш проект NerdDinner.Tests компилируется и выполняется в другой каталог и затем проект приложения, неправильный относительный путь, где нашу строку подключения.</span><span class="sxs-lookup"><span data-stu-id="9639f-181">Because our NerdDinner.Tests project compiles and runs in a different directory then the application project, the relative path location of our connection-string is incorrect.</span></span>

<span data-ttu-id="9639f-182">Мы *удалось* устранить эту проблему путем копирования файла базы данных SQL Express в тестовый проект, а затем добавьте проверки-строку подключения к нему, в файле App.config нашего тестового проекта.</span><span class="sxs-lookup"><span data-stu-id="9639f-182">We *could* fix this by copying the SQL Express database file to our test project, and then add an appropriate test connection-string to it in the App.config of our test project.</span></span> <span data-ttu-id="9639f-183">Это будет вышеуказанные тесты разблокировано и под управлением.</span><span class="sxs-lookup"><span data-stu-id="9639f-183">This would get the above tests unblocked and running.</span></span>

<span data-ttu-id="9639f-184">Модульное тестирование кода, с помощью реальной базе данных, однако предлагает ряд проблем.</span><span class="sxs-lookup"><span data-stu-id="9639f-184">Unit testing code using a real database, though, brings with it a number of challenges.</span></span> <span data-ttu-id="9639f-185">В частности:</span><span class="sxs-lookup"><span data-stu-id="9639f-185">Specifically:</span></span>

- <span data-ttu-id="9639f-186">Он значительно замедляет времени выполнения модульных тестов.</span><span class="sxs-lookup"><span data-stu-id="9639f-186">It significantly slows down the execution time of unit tests.</span></span> <span data-ttu-id="9639f-187">Чем дольше необходимое для выполнения тестов, тем меньше вероятность, вы должны выполнять их часто.</span><span class="sxs-lookup"><span data-stu-id="9639f-187">The longer it takes to run tests, the less likely you are to execute them frequently.</span></span> <span data-ttu-id="9639f-188">Вы в идеале модульные тесты, чтобы иметь возможность запускать в секундах — и должны быть это можно сделать как естественным образом, как компиляции проекта.</span><span class="sxs-lookup"><span data-stu-id="9639f-188">Ideally you want your unit tests to be able to be run in seconds – and have it be something you do as naturally as compiling the project.</span></span>
- <span data-ttu-id="9639f-189">Это усложняет логику установки и очистки в тесты.</span><span class="sxs-lookup"><span data-stu-id="9639f-189">It complicates the setup and cleanup logic within tests.</span></span> <span data-ttu-id="9639f-190">Требуется, чтобы каждый модульный тест был изолированным и независимым от остальных (с помощью побочных эффектов или зависимостей).</span><span class="sxs-lookup"><span data-stu-id="9639f-190">You want each unit test to be isolated and independent of others (with no side effects or dependencies).</span></span> <span data-ttu-id="9639f-191">При работе с реальной базой данных необходимо учитывать состояние и сбрасывать его между тестами.</span><span class="sxs-lookup"><span data-stu-id="9639f-191">When working against a real database you have to be mindful of state and reset it between tests.</span></span>

<span data-ttu-id="9639f-192">Давайте взглянем на шаблон, который называется «внедрение зависимостей», которые могут помочь нам решить эти проблемы и избежать необходимости использовать реальную базу данных с помощью наших тестов.</span><span class="sxs-lookup"><span data-stu-id="9639f-192">Let's look at a design pattern called "dependency injection" that can help us work around these issues and avoid the need to use a real database with our tests.</span></span>

### <a name="dependency-injection"></a><span data-ttu-id="9639f-193">Внедрение зависимостей</span><span class="sxs-lookup"><span data-stu-id="9639f-193">Dependency Injection</span></span>

<span data-ttu-id="9639f-194">Прямо сейчас DinnersController «тесно» к классу DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="9639f-194">Right now DinnersController is tightly "coupled" to the DinnerRepository class.</span></span> <span data-ttu-id="9639f-195">«Соединение» относится к ситуации, где класс явно зависит от другого класса для работы:</span><span class="sxs-lookup"><span data-stu-id="9639f-195">"Coupling" refers to a situation where a class explicitly relies on another class in order to work:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample4.cs)]

<span data-ttu-id="9639f-196">Так как класс DinnerRepository требуется доступ к базе данных, тесно связанных зависимостей в классе DinnersController есть на концах DinnerRepository вверх необходимости мы получили базу данных в порядке для методов действий DinnersController проверяемый.</span><span class="sxs-lookup"><span data-stu-id="9639f-196">Because the DinnerRepository class requires access to a database, the tightly coupled dependency the DinnersController class has on the DinnerRepository ends up requiring us to have a database in order for the DinnersController action methods to be tested.</span></span>

<span data-ttu-id="9639f-197">Можно обойти это, используя шаблон, который называется «внедрение зависимостей» — это подход, где больше не неявного создания зависимостей (например, репозиторий классы, предоставляющие доступ к данным) в классах, которые их используют.</span><span class="sxs-lookup"><span data-stu-id="9639f-197">We can get around this by employing a design pattern called "dependency injection" – which is an approach where dependencies (like repository classes that provide data access) are no longer implicitly created within classes that use them.</span></span> <span data-ttu-id="9639f-198">Вместо этого зависимости можно явно передать класс, который использует их с помощью аргументов конструктора.</span><span class="sxs-lookup"><span data-stu-id="9639f-198">Instead, dependencies can be explicitly passed to the class that uses them using constructor arguments.</span></span> <span data-ttu-id="9639f-199">Если зависимости определяются с помощью интерфейсов, мы получаем гибкость доходить до реализаций «фальшивая» зависимостей для модульного тестирования сценариев.</span><span class="sxs-lookup"><span data-stu-id="9639f-199">If the dependencies are defined using interfaces, we then have the flexibility to pass in "fake" dependency implementations for unit test scenarios.</span></span> <span data-ttu-id="9639f-200">Это позволяет нам создать зависимость относится к тесту реализации, которые фактически не требуется доступ к базе данных.</span><span class="sxs-lookup"><span data-stu-id="9639f-200">This enables us to create test-specific dependency implementations that do not actually require access to a database.</span></span>

<span data-ttu-id="9639f-201">Чтобы увидеть это в действии, давайте внедрения зависимостей с помощью наших DinnersController.</span><span class="sxs-lookup"><span data-stu-id="9639f-201">To see this in action, let's implement dependency injection with our DinnersController.</span></span>

#### <a name="extracting-an-idinnerrepository-interface"></a><span data-ttu-id="9639f-202">Извлечение интерфейса IDinnerRepository</span><span class="sxs-lookup"><span data-stu-id="9639f-202">Extracting an IDinnerRepository interface</span></span>

<span data-ttu-id="9639f-203">Нашим первым этапом является создание новый интерфейс IDinnerRepository, инкапсулирующий наших контроллеров, необходимых для извлечения и обновления ужинов контракт репозитория.</span><span class="sxs-lookup"><span data-stu-id="9639f-203">Our first step will be to create a new IDinnerRepository interface that encapsulates the repository contract our controllers require to retrieve and update Dinners.</span></span>

<span data-ttu-id="9639f-204">Этот интерфейс контракта можно определить вручную, щелкнув правой кнопкой мыши на папку \Models и выбрав **Add -&gt;новый элемент** команды меню и создается с именем IDinnerRepository.cs интерфейс.</span><span class="sxs-lookup"><span data-stu-id="9639f-204">We can define this interface contract manually by right-clicking on the \Models folder, and then choosing the **Add-&gt;New Item** menu command and creating a new interface named IDinnerRepository.cs.</span></span>

<span data-ttu-id="9639f-205">Также мы использовать автоматически рефакторинг средства встроены в Visual Studio Professional (и более поздние версии) для извлечения и создать интерфейс для нас от наших существующий класс DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="9639f-205">Alternatively we can use the refactoring tools built-into Visual Studio Professional (and higher editions) to automatically extract and create an interface for us from our existing DinnerRepository class.</span></span> <span data-ttu-id="9639f-206">Чтобы извлечь этот интерфейс, с помощью VS, просто поместите курсор в текстовом редакторе в классе DinnerRepository и затем щелкните правой кнопкой мыши и выберите **Refactor -&gt;извлечение интерфейса** команды меню:</span><span class="sxs-lookup"><span data-stu-id="9639f-206">To extract this interface using VS, simply position the cursor in the text editor on the DinnerRepository class, and then right-click and choose the **Refactor-&gt;Extract Interface** menu command:</span></span>

![](enable-automated-unit-testing/_static/image7.png)

<span data-ttu-id="9639f-207">Это будет открыть диалоговое окно «Извлечение интерфейса» и запрашивать нами имя интерфейса для создания.</span><span class="sxs-lookup"><span data-stu-id="9639f-207">This will launch the "Extract Interface" dialog and prompt us for the name of the interface to create.</span></span> <span data-ttu-id="9639f-208">Он будет по умолчанию IDinnerRepository и автоматически выбрать все открытые методы в классе DinnerRepository для добавления к интерфейсу:</span><span class="sxs-lookup"><span data-stu-id="9639f-208">It will default to IDinnerRepository and automatically select all public methods on the existing DinnerRepository class to add to the interface:</span></span>

![](enable-automated-unit-testing/_static/image8.png)

<span data-ttu-id="9639f-209">При нажатии кнопки «ОК», Visual Studio добавит новый интерфейс IDinnerRepository в наше приложение:</span><span class="sxs-lookup"><span data-stu-id="9639f-209">When we click the "ok" button, Visual Studio will add a new IDinnerRepository interface to our application:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample5.cs)]

<span data-ttu-id="9639f-210">И наши существующий класс DinnerRepository обновится, чтобы он реализовал интерфейс:</span><span class="sxs-lookup"><span data-stu-id="9639f-210">And our existing DinnerRepository class will be updated so that it implements the interface:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample6.cs)]

#### <a name="updating-dinnerscontroller-to-support-constructor-injection"></a><span data-ttu-id="9639f-211">Обновление DinnersController для поддержки внедрение через конструктор</span><span class="sxs-lookup"><span data-stu-id="9639f-211">Updating DinnersController to support constructor injection</span></span>

<span data-ttu-id="9639f-212">Теперь мы обновим DinnersController класс для использования нового интерфейса.</span><span class="sxs-lookup"><span data-stu-id="9639f-212">We'll now update the DinnersController class to use the new interface.</span></span>

<span data-ttu-id="9639f-213">В настоящее время DinnersController жестко задано таким образом, что его поля «dinnerRepository» всегда является классом DinnerRepository:</span><span class="sxs-lookup"><span data-stu-id="9639f-213">Currently DinnersController is hard-coded such that its "dinnerRepository" field is always a DinnerRepository class:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample7.cs)]

<span data-ttu-id="9639f-214">Мы изменим его, чтобы поле «dinnerRepository» имеет тип IDinnerRepository вместо DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="9639f-214">We'll change it so that the "dinnerRepository" field is of type IDinnerRepository instead of DinnerRepository.</span></span> <span data-ttu-id="9639f-215">Затем мы добавим два общих конструктора DinnersController.</span><span class="sxs-lookup"><span data-stu-id="9639f-215">We'll then add two public DinnersController constructors.</span></span> <span data-ttu-id="9639f-216">Один из конструкторов разрешает IDinnerRepository передается как аргумент.</span><span class="sxs-lookup"><span data-stu-id="9639f-216">One of the constructors allows an IDinnerRepository to be passed as an argument.</span></span> <span data-ttu-id="9639f-217">Второе — конструктор по умолчанию, использующий наших существующей реализации DinnerRepository:</span><span class="sxs-lookup"><span data-stu-id="9639f-217">The other is a default constructor that uses our existing DinnerRepository implementation:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample8.cs)]

<span data-ttu-id="9639f-218">Так как MVC ASP.NET по умолчанию создает классы контроллера, используя конструкторы по умолчанию, наши DinnersController во время выполнения будет продолжать класс DinnerRepository для осуществления доступа к данным.</span><span class="sxs-lookup"><span data-stu-id="9639f-218">Because ASP.NET MVC by default creates controller classes using default constructors, our DinnersController at runtime will continue to use the DinnerRepository class to perform data access.</span></span>

<span data-ttu-id="9639f-219">Теперь мы можем обновить наших модульные тесты, однако для передачи в реализацию repository «фальшивая» обед, с помощью параметра конструктора.</span><span class="sxs-lookup"><span data-stu-id="9639f-219">We can now update our unit tests, though, to pass in a "fake" dinner repository implementation using the parameter constructor.</span></span> <span data-ttu-id="9639f-220">Этот репозиторий «фальшивая» компании dinner не требуется доступ к любой настоящей базе данных и вместо этого образца in-memory данные будут использоваться.</span><span class="sxs-lookup"><span data-stu-id="9639f-220">This "fake" dinner repository will not require access to a real database, and instead will use in-memory sample data.</span></span>

#### <a name="creating-the-fakedinnerrepository-class"></a><span data-ttu-id="9639f-221">Создание класса FakeDinnerRepository</span><span class="sxs-lookup"><span data-stu-id="9639f-221">Creating the FakeDinnerRepository class</span></span>

<span data-ttu-id="9639f-222">Давайте создадим класс FakeDinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="9639f-222">Let's create a FakeDinnerRepository class.</span></span>

<span data-ttu-id="9639f-223">Мы начнем с создания каталога «Fakes» в нашем проекте NerdDinner.Tests и затем добавьте новый класс FakeDinnerRepository к нему (папку правой кнопкой мыши и выберите **Add -&gt;новый класс**):</span><span class="sxs-lookup"><span data-stu-id="9639f-223">We'll begin by creating a "Fakes" directory within our NerdDinner.Tests project and then add a new FakeDinnerRepository class to it (right-click on the folder and choose **Add-&gt;New Class**):</span></span>

![](enable-automated-unit-testing/_static/image9.png)

<span data-ttu-id="9639f-224">Мы обновим код, чтобы класс FakeDinnerRepository реализует интерфейс IDinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="9639f-224">We'll update the code so that the FakeDinnerRepository class implements the IDinnerRepository interface.</span></span> <span data-ttu-id="9639f-225">Затем можно его правой кнопкой мыши и выберите из контекстного меню команду «Реализовать интерфейс IDinnerRepository»:</span><span class="sxs-lookup"><span data-stu-id="9639f-225">We can then right-click on it and choose the "Implement interface IDinnerRepository" context menu command:</span></span>

![](enable-automated-unit-testing/_static/image10.png)

<span data-ttu-id="9639f-226">Это приведет к Visual Studio для автоматического добавления всех членов интерфейса IDinnerRepository к нашему классу FakeDinnerRepository с реализациями «заглушки» по умолчанию:</span><span class="sxs-lookup"><span data-stu-id="9639f-226">This will cause Visual Studio to automatically add all of the IDinnerRepository interface members to our FakeDinnerRepository class with default "stub out" implementations:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample9.cs)]

<span data-ttu-id="9639f-227">Затем можно обновлять реализации работу над список в памяти, что FakeDinnerRepository&lt;Dinner&gt; коллекции, переданного в качестве аргумента конструктора:</span><span class="sxs-lookup"><span data-stu-id="9639f-227">We can then update the FakeDinnerRepository implementation to work off of an in-memory List&lt;Dinner&gt; collection passed to it as a constructor argument:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample10.cs)]

<span data-ttu-id="9639f-228">Теперь у нас есть это фиктивный IDinnerRepository реализация, которая необходима база данных, а вместо этого можно работы за пределами список в памяти объектов, компания Dinner.</span><span class="sxs-lookup"><span data-stu-id="9639f-228">We now have a fake IDinnerRepository implementation that does not require a database, and can instead work off an in-memory list of Dinner objects.</span></span>

#### <a name="using-the-fakedinnerrepository-with-unit-tests"></a><span data-ttu-id="9639f-229">С помощью FakeDinnerRepository с модульными тестами</span><span class="sxs-lookup"><span data-stu-id="9639f-229">Using the FakeDinnerRepository with Unit Tests</span></span>

<span data-ttu-id="9639f-230">Давайте вернемся к DinnersController модульные тесты, которые ранее сбой базы данных был недоступен.</span><span class="sxs-lookup"><span data-stu-id="9639f-230">Let's return to the DinnersController unit tests that failed earlier because the database wasn't available.</span></span> <span data-ttu-id="9639f-231">Позволяет обновлять используемые методы теста FakeDinnerRepository, заполненную данными компании Dinner пример выполняющейся в памяти DinnersController, с помощью следующего кода:</span><span class="sxs-lookup"><span data-stu-id="9639f-231">We can update the test methods to use a FakeDinnerRepository populated with sample in-memory Dinner data to the DinnersController using the code below:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample11.cs)]

<span data-ttu-id="9639f-232">И теперь при запуске этих тестов они оба передайте:</span><span class="sxs-lookup"><span data-stu-id="9639f-232">And now when we run these tests they both pass:</span></span>

![](enable-automated-unit-testing/_static/image11.png)

<span data-ttu-id="9639f-233">Лучше всего они принимают только небольшую часть второй — для запуска и не требуют логику сложной настройки или очистки.</span><span class="sxs-lookup"><span data-stu-id="9639f-233">Best of all, they take only a fraction of a second to run, and do not require any complicated setup/cleanup logic.</span></span> <span data-ttu-id="9639f-234">Мы можем теперь, модульный тест все наши код DinnersController действие метода (включая перечисления, разбиение по страницам, сведения, создание, обновление и удаление) без подведена для подключения к любой настоящей базе данных.</span><span class="sxs-lookup"><span data-stu-id="9639f-234">We can now unit test all of our DinnersController action method code (including listing, paging, details, create, update and delete) without ever needing to connect to a real database.</span></span>

| <span data-ttu-id="9639f-235">**Тема стороне: Платформы внедрения зависимостей**</span><span class="sxs-lookup"><span data-stu-id="9639f-235">**Side Topic: Dependency Injection Frameworks**</span></span> |
| --- |
| <span data-ttu-id="9639f-236">Выполнение внедрения вручную зависимостей (например, превышающие) работает отлично, но становится еще сложнее обслуживать как число зависимостей, и увеличивает компонентов в приложении.</span><span class="sxs-lookup"><span data-stu-id="9639f-236">Performing manual dependency injection (like we are above) works fine, but does become harder to maintain as the number of dependencies and components in an application increases.</span></span> <span data-ttu-id="9639f-237">Для .NET, которая обеспечивает большую гибкость управления зависимостей существует несколько платформы внедрения зависимостей.</span><span class="sxs-lookup"><span data-stu-id="9639f-237">Several dependency injection frameworks exist for .NET that can help provide even more dependency management flexibility.</span></span> <span data-ttu-id="9639f-238">Эти платформы, иногда называют «контейнеры Inversion of Control» (IoC), предоставляют механизмы, позволяющие дополнительный уровень поддержки конфигурации для указания и передачи объектов во время выполнения (чаще всего с помощью внедрения через конструктор зависимостей ).</span><span class="sxs-lookup"><span data-stu-id="9639f-238">These frameworks, also sometimes called "Inversion of Control" (IoC) containers, provide mechanisms that enable an additional level of configuration support for specifying and passing dependencies to objects at runtime (most often using constructor injection).</span></span> <span data-ttu-id="9639f-239">Некоторые из наиболее популярных внедрения зависимостей OSS / include инфраструктур IOC в .NET: AutoFac, Ninject, Spring.NET, StructureMap и Windsor.</span><span class="sxs-lookup"><span data-stu-id="9639f-239">Some of the more popular OSS Dependency Injection / IOC frameworks in .NET include: AutoFac, Ninject, Spring.NET, StructureMap, and Windsor.</span></span> <span data-ttu-id="9639f-240">ASP.NET MVC предоставляет интерфейсы API, позволяющие разработчикам для участия в решение и создание контроллеров и который обеспечивает внедрение зависимостей расширения / инфраструктур IoC полностью интегрированы в рамках данного процесса.</span><span class="sxs-lookup"><span data-stu-id="9639f-240">ASP.NET MVC exposes extensibility APIs that enable developers to participate in the resolution and instantiation of controllers, and which enables Dependency Injection / IoC frameworks to be cleanly integrated within this process.</span></span> <span data-ttu-id="9639f-241">С помощью внедрения Зависимостей и IOC платформы также позволит нам для удаления из наших DinnersController — что бы полностью удалить связь между ним и DinnerRepository конструктор по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="9639f-241">Using a DI/IOC framework would also enable us to remove the default constructor from our DinnersController – which would completely remove the coupling between it and the DinnerRepository.</span></span> <span data-ttu-id="9639f-242">Мы не будем использовать внедрение зависимостей и инфраструктуры IOC с наше приложение NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="9639f-242">We won't be using a dependency injection / IOC framework with our NerdDinner application.</span></span> <span data-ttu-id="9639f-243">Но то, что мы можем рассмотреть в будущем, если NerdDinner базы кода и возможности роста.</span><span class="sxs-lookup"><span data-stu-id="9639f-243">But it is something we could consider for the future if the NerdDinner code-base and capabilities grew.</span></span> |

### <a name="creating-edit-action-unit-tests"></a><span data-ttu-id="9639f-244">Создание модульных тестов изменить действие</span><span class="sxs-lookup"><span data-stu-id="9639f-244">Creating Edit Action Unit Tests</span></span>

<span data-ttu-id="9639f-245">Теперь создадим несколько модульных тестов, которые проверяют DinnersController функциональные возможности редактирования.</span><span class="sxs-lookup"><span data-stu-id="9639f-245">Let's now create some unit tests that verify the Edit functionality of the DinnersController.</span></span> <span data-ttu-id="9639f-246">Мы начнем с проверки HTTP-GET версии наших действие изменения:</span><span class="sxs-lookup"><span data-stu-id="9639f-246">We'll start by testing the HTTP-GET version of our Edit action:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample12.cs)]

<span data-ttu-id="9639f-247">Мы создадим тест, который проверяет, что визуализации представления, поддерживаемый объект DinnerFormViewModel обратно в том случае, когда запрашивается допустимым dinner:</span><span class="sxs-lookup"><span data-stu-id="9639f-247">We'll create a test that verifies that a View backed by a DinnerFormViewModel object is rendered back when a valid dinner is requested:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample13.cs)]

<span data-ttu-id="9639f-248">При запуске теста, но очень скоро найдется что происходит сбой, поскольку при метода Edit обращается к свойству User.Identity.Name выполнить проверку Dinner.IsHostedBy() исключение пустой ссылки.</span><span class="sxs-lookup"><span data-stu-id="9639f-248">When we run the test, though, we'll find that it fails because a null reference exception is thrown when the Edit method accesses the User.Identity.Name property to perform the Dinner.IsHostedBy() check.</span></span>

<span data-ttu-id="9639f-249">Объект User на базовый класс контроллера инкапсулирует сведения о вошедшего в систему пользователя и заполняется платформой ASP.NET MVC, при создании контроллера во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="9639f-249">The User object on the Controller base class encapsulates details about the logged-in user, and is populated by ASP.NET MVC when it creates the controller at runtime.</span></span> <span data-ttu-id="9639f-250">Так как мы тестируем DinnersController за пределами среды веб сервера, объект пользователя не задано (поэтому пустая ссылка на исключение).</span><span class="sxs-lookup"><span data-stu-id="9639f-250">Because we are testing the DinnersController outside of a web-server environment, the User object isn't set (hence the null reference exception).</span></span>

### <a name="mocking-the-useridentityname-property"></a><span data-ttu-id="9639f-251">Макетирование свойство User.Identity.Name</span><span class="sxs-lookup"><span data-stu-id="9639f-251">Mocking the User.Identity.Name property</span></span>

<span data-ttu-id="9639f-252">Инфраструктур макетирования упростить тестирование, благодаря чему мы можем динамически создавать фиктивные версии зависимых объектов, которые поддерживают наших тестов.</span><span class="sxs-lookup"><span data-stu-id="9639f-252">Mocking frameworks make testing easier by enabling us to dynamically create fake versions of dependent objects that support our tests.</span></span> <span data-ttu-id="9639f-253">Например можно использовать инфраструктуру макетирования в наш тест действие редактирования для динамического создания объекта пользователя, наши DinnersController можно использовать для уточняющего запроса имитации имя пользователя.</span><span class="sxs-lookup"><span data-stu-id="9639f-253">For example, we can use a mocking framework in our Edit action test to dynamically create a User object that our DinnersController can use to lookup a simulated username.</span></span> <span data-ttu-id="9639f-254">Это позволит избежать ссылкой на null исключение при запуске нашего теста.</span><span class="sxs-lookup"><span data-stu-id="9639f-254">This will avoid a null reference from being thrown when we run our test.</span></span>

<span data-ttu-id="9639f-255">Существует множество .NET платформы, которые могут использоваться с ASP.NET MVC имитации (список из них здесь вы найдете: [ http://www.mockframeworks.com/ ](http://www.mockframeworks.com/)).</span><span class="sxs-lookup"><span data-stu-id="9639f-255">There are many .NET mocking frameworks that can be used with ASP.NET MVC (you can see a list of them here: [http://www.mockframeworks.com/](http://www.mockframeworks.com/)).</span></span> <span data-ttu-id="9639f-256">Для тестирования наше приложение NerdDinner, мы будем использовать макетирование структуру, называемую «Moq» открытый код, который можно загрузить бесплатно из [ http://www.mockframeworks.com/moq ](http://www.mockframeworks.com/moq).</span><span class="sxs-lookup"><span data-stu-id="9639f-256">For testing our NerdDinner application we'll use an open source mocking framework called "Moq", which can be downloaded for free from [http://www.mockframeworks.com/moq](http://www.mockframeworks.com/moq).</span></span>

<span data-ttu-id="9639f-257">После загрузки, мы добавим ссылку в нашем проекте NerdDinner.Tests Moq.dll сборки:</span><span class="sxs-lookup"><span data-stu-id="9639f-257">Once downloaded, we'll add a reference in our NerdDinner.Tests project to the Moq.dll assembly:</span></span>

![](enable-automated-unit-testing/_static/image12.png)

<span data-ttu-id="9639f-258">Затем мы добавим «CreateDinnersControllerAs(username)» вспомогательный метод для наших тестового класса, который принимает в качестве параметра и что имя пользователя, а затем свойство User.Identity.Name на экземпляре DinnersController «mocks»:</span><span class="sxs-lookup"><span data-stu-id="9639f-258">We'll then add a "CreateDinnersControllerAs(username)" helper method to our test class that takes a username as a parameter, and which then "mocks" the User.Identity.Name property on the DinnersController instance:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample14.cs)]

<span data-ttu-id="9639f-259">Выше мы используем Moq для создания объекта макет, который имитирует объект параметром ControllerContext (который передает в классы контроллера для представления объектов среды выполнения, например пользователя, запроса, ответа и сеанса ASP.NET MVC).</span><span class="sxs-lookup"><span data-stu-id="9639f-259">Above we are using Moq to create a Mock object that fakes a ControllerContext object (which is what ASP.NET MVC passes to Controller classes to expose runtime objects like User, Request, Response, and Session).</span></span> <span data-ttu-id="9639f-260">Мы вызов метода «SetupGet» на макете, чтобы указать, что свойство HttpContext.User.Identity.Name параметром ControllerContext должна возвращать строку имени пользователя, которую мы передали вспомогательный метод.</span><span class="sxs-lookup"><span data-stu-id="9639f-260">We are calling the "SetupGet" method on the Mock to indicate that the HttpContext.User.Identity.Name property on ControllerContext should return the username string we passed to the helper method.</span></span>

<span data-ttu-id="9639f-261">Мы можете создать макет любое количество параметром ControllerContext свойства и методы.</span><span class="sxs-lookup"><span data-stu-id="9639f-261">We can mock any number of ControllerContext properties and methods.</span></span> <span data-ttu-id="9639f-262">В качестве примера я также добавил вызов SetupGet() для свойства Request.IsAuthenticated (которой не нужен для тестов ниже — но что позволяет продемонстрировать, как вы можете создать макет свойства запроса).</span><span class="sxs-lookup"><span data-stu-id="9639f-262">To illustrate this I've also added a SetupGet() call for the Request.IsAuthenticated property (which isn't actually needed for the tests below – but which helps illustrate how you can mock Request properties).</span></span> <span data-ttu-id="9639f-263">Когда Готово мы присвоить экземпляр параметром ControllerContext фиктивного объекта DinnersController, возвращает наших вспомогательный метод.</span><span class="sxs-lookup"><span data-stu-id="9639f-263">When we are done we assign an instance of the ControllerContext mock to the DinnersController our helper method returns.</span></span>

<span data-ttu-id="9639f-264">Теперь можно написать модульные тесты, использующие этот вспомогательный метод для проверки сценариев редактирования с использованием разных пользователей:</span><span class="sxs-lookup"><span data-stu-id="9639f-264">We can now write unit tests that use this helper method to test Edit scenarios involving different users:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample15.cs)]

<span data-ttu-id="9639f-265">И теперь при запуске тестов они передайте:</span><span class="sxs-lookup"><span data-stu-id="9639f-265">And now when we run the tests they pass:</span></span>

![](enable-automated-unit-testing/_static/image13.png)

### <a name="testing-updatemodel-scenarios"></a><span data-ttu-id="9639f-266">UpdateModel() сценариев тестирования</span><span class="sxs-lookup"><span data-stu-id="9639f-266">Testing UpdateModel() scenarios</span></span>

<span data-ttu-id="9639f-267">Мы создали тесты, использующие версию HTTP-GET действие изменения.</span><span class="sxs-lookup"><span data-stu-id="9639f-267">We've created tests that cover the HTTP-GET version of the Edit action.</span></span> <span data-ttu-id="9639f-268">Давайте теперь создадим некоторые тесты, проверяющие версию HTTP-POST действие изменения.</span><span class="sxs-lookup"><span data-stu-id="9639f-268">Let's now create some tests that verify the HTTP-POST version of the Edit action:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample16.cs)]

<span data-ttu-id="9639f-269">Интересный новый сценарий тестирования поддержки с данным методом действия является использование UpdateModel() вспомогательный метод в базовом классе контроллера.</span><span class="sxs-lookup"><span data-stu-id="9639f-269">The interesting new testing scenario for us to support with this action method is its usage of the UpdateModel() helper method on the Controller base class.</span></span> <span data-ttu-id="9639f-270">Мы используем этот вспомогательный метод для привязки значений формы post на наш экземпляр объекта Dinner.</span><span class="sxs-lookup"><span data-stu-id="9639f-270">We are using this helper method to bind form-post values to our Dinner object instance.</span></span>

<span data-ttu-id="9639f-271">Ниже приведены два теста, которые демонстрирует, как мы можем передать форму, передаваемую значения для вспомогательного метода UpdateModel() для использования.</span><span class="sxs-lookup"><span data-stu-id="9639f-271">Below are two tests that demonstrates how we can supply form posted values for the UpdateModel() helper method to use.</span></span> <span data-ttu-id="9639f-272">Мы это сделать, создании и заполнении объекта FormCollection и затем присвоить его свойству «Значение ValueProvider» на контроллере.</span><span class="sxs-lookup"><span data-stu-id="9639f-272">We'll do this by creating and populating a FormCollection object, and then assign it to the "ValueProvider" property on the Controller.</span></span>

<span data-ttu-id="9639f-273">Первый тест проверяет, что на сохранение успешным браузер перенаправляется на действие details.</span><span class="sxs-lookup"><span data-stu-id="9639f-273">The first test verifies that on a successful save the browser is redirected to the details action.</span></span> <span data-ttu-id="9639f-274">Второй тест проверяет, что при отправке недопустимые входные данные действия повторно отображает представление изменения еще раз с сообщением об ошибке.</span><span class="sxs-lookup"><span data-stu-id="9639f-274">The second test verifies that when invalid input is posted the action redisplays the edit view again with an error message.</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample17.cs)]

### <a name="testing-wrap-up"></a><span data-ttu-id="9639f-275">Тестирование заключение</span><span class="sxs-lookup"><span data-stu-id="9639f-275">Testing Wrap-Up</span></span>

<span data-ttu-id="9639f-276">Мы рассмотрели основные понятия, связанные с модульного тестирования классы контроллера.</span><span class="sxs-lookup"><span data-stu-id="9639f-276">We've covered the core concepts involved in unit testing controller classes.</span></span> <span data-ttu-id="9639f-277">Эти методы можно использовать без труда создавать сотни простые тесты, проверяющие работу нашего приложения.</span><span class="sxs-lookup"><span data-stu-id="9639f-277">We can use these techniques to easily create hundreds of simple tests that verify the behavior of our application.</span></span>

<span data-ttu-id="9639f-278">Поскольку наш контроллера и модели тесты не требуют реальную базу данных, они очень быстро и легко запускать.</span><span class="sxs-lookup"><span data-stu-id="9639f-278">Because our controller and model tests do not require a real database, they are extremely fast and easy to run.</span></span> <span data-ttu-id="9639f-279">Мы сможем выполнять сотни автоматических тестов в секундах и немедленно получить обратную связь относительно ли мы внесли Изменение привело к нарушению что-то.</span><span class="sxs-lookup"><span data-stu-id="9639f-279">We'll be able to execute hundreds of automated tests in seconds, and immediately get feedback as to whether a change we made broke something.</span></span> <span data-ttu-id="9639f-280">Это поможет предоставить нам достоверности для непрерывного повышения рефакторинга и уточнить нашего приложения.</span><span class="sxs-lookup"><span data-stu-id="9639f-280">This will help provide us the confidence to continually improve, refactor, and refine our application.</span></span>

<span data-ttu-id="9639f-281">Мы узнали, что тестирование как последний раздел, в этой главе — но не потому, что тестирование — что-то делать в конце процесса разработки!</span><span class="sxs-lookup"><span data-stu-id="9639f-281">We covered testing as the last topic in this chapter – but not because testing is something you should do at the end of a development process!</span></span> <span data-ttu-id="9639f-282">Напротив следует писать автоматические тесты как можно раньше в процессе разработки.</span><span class="sxs-lookup"><span data-stu-id="9639f-282">On the contrary, you should write automated tests as early as possible in your development process.</span></span> <span data-ttu-id="9639f-283">Таким образом, это позволяет получать немедленные отзывы в процессе разработки, помогает продуманным подумать о сценариев вариантов использования приложения и описывает, как разрабатывать приложение с чистой, наложение и увязку в виду.</span><span class="sxs-lookup"><span data-stu-id="9639f-283">Doing so enables you to get immediate feedback as you develop, helps you think thoughtfully about your application's use case scenarios, and guides you to design your application with clean layering and coupling in mind.</span></span>

<span data-ttu-id="9639f-284">Одной из следующих глав в книге будут рассмотрены разработки на основе тестирования (TDD) и способы его использования с ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="9639f-284">A later chapter in the book will discuss Test Driven Development (TDD), and how to use it with ASP.NET MVC.</span></span> <span data-ttu-id="9639f-285">TDD проектируется итеративный правильна сначала тесты, которые удовлетворяют полученный код.</span><span class="sxs-lookup"><span data-stu-id="9639f-285">TDD is an iterative coding practice where you first write the tests that your resulting code will satisfy.</span></span> <span data-ttu-id="9639f-286">В случае TDD каждой функции начните с создания теста, который проверяет функциональные возможности, которые вы собираетесь реализовать.</span><span class="sxs-lookup"><span data-stu-id="9639f-286">With TDD you begin each feature by creating a test that verifies the functionality you are about to implement.</span></span> <span data-ttu-id="9639f-287">Написания модульных тестов помогает сначала необходимо четко понимать, эта функция и как он должен работать.</span><span class="sxs-lookup"><span data-stu-id="9639f-287">Writing the unit test first helps ensure that you clearly understand the feature and how it is supposed to work.</span></span> <span data-ttu-id="9639f-288">Только после записи теста (и вы проверили, что не удается) вы, а затем реализовать проверяет функциональность теста.</span><span class="sxs-lookup"><span data-stu-id="9639f-288">Only after the test is written (and you have verified that it fails) do you then implement the actual functionality the test verifies.</span></span> <span data-ttu-id="9639f-289">Так как вы уже провели времени на размышления о том, как эта функция должна работать в случае использования, будет иметь хорошее представление о требованиях и предоставит оптимальный способ их реализации.</span><span class="sxs-lookup"><span data-stu-id="9639f-289">Because you've already spent time thinking about the use case of how the feature is supposed to work, you will have a better understanding of the requirements and how best to implement them.</span></span> <span data-ttu-id="9639f-290">Когда вы закончите с реализацией, можно повторно запустить тест — и получить немедленный отзыв как для ли эта функция работает правильно.</span><span class="sxs-lookup"><span data-stu-id="9639f-290">When you are done with the implementation you can re-run the test – and get immediate feedback as to whether the feature works correctly.</span></span> <span data-ttu-id="9639f-291">Мы обсудим TDD более в главе 10.</span><span class="sxs-lookup"><span data-stu-id="9639f-291">We'll cover TDD more in Chapter 10.</span></span>

### <a name="next-step"></a><span data-ttu-id="9639f-292">Следующий шаг</span><span class="sxs-lookup"><span data-stu-id="9639f-292">Next Step</span></span>

<span data-ttu-id="9639f-293">Некоторые окончательного переноса по словам комментариев.</span><span class="sxs-lookup"><span data-stu-id="9639f-293">Some final wrap up comments.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="9639f-294">[Назад](use-ajax-to-implement-mapping-scenarios.md)
> [Вперед](nerddinner-wrap-up.md)</span><span class="sxs-lookup"><span data-stu-id="9639f-294">[Previous](use-ajax-to-implement-mapping-scenarios.md)
[Next](nerddinner-wrap-up.md)</span></span>
