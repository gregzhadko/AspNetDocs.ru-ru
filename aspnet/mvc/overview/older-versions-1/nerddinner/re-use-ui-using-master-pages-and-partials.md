---
uid: mvc/overview/older-versions-1/nerddinner/re-use-ui-using-master-pages-and-partials
title: Повторное использование uI с использованием мастер-страниц и частичных спомощьами (ru) Документы Майкрософт
author: rick-anderson
description: В шаге 7 рассматривается способы применения «принципа DRY» в шаблонах представления для устранения дублирования кода, используя шаблоны частичного представления и основные страницы.
ms.author: riande
ms.date: 07/27/2010
ms.assetid: d4243a4a-e91c-4116-9ae0-5c08e5285677
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/re-use-ui-using-master-pages-and-partials
msc.type: authoredcontent
ms.openlocfilehash: f381c4424a9fa0718cd234beeb01ce41bc4ca61e
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2020
ms.locfileid: "81542603"
---
# <a name="re-use-ui-using-master-pages-and-partials"></a>Многократное использование пользовательского интерфейса с помощью эталонных страниц и частичных представлений

[корпорацией Майкрософт](https://github.com/microsoft)

[Скачать PDF](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> Это шаг 7 бесплатно ["NerdDinner" приложение учебник,](introducing-the-nerddinner-tutorial.md) который ходит через как построить небольшой, но полный, веб-приложение с помощью ASP.NET MVC 1.
> 
> Шаг 7 рассматривает способы применения «Принципа DRY» в шаблонах представления для устранения дублирования кода, используя шаблоны частичного представления и основные страницы.
> 
> Если вы используете ASP.NET MVC 3, мы рекомендуем вам следовать [начиная с MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) или [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) учебники.

## <a name="nerddinner-step-7-partials-and-master-pages"></a>NerdDinner Шаг 7: Частичные и мастер-страницы

Один из философий дизайна ASP.NET MVC охватывает является "Не повторяй себя" принцип (обычно называют "DRY"). Конструкция DRY помогает устранить дублирование кода и логики, что в конечном итоге делает приложения более быстрыми в сборке и упрощает обслуживание.

Мы уже видели принцип DRY, применяемый в нескольких наших сценариях NerdDinner. Несколько примеров: наша логика проверки реализована в нашем уровне модели, что позволяет применять ее как на реактуляции, так и в создании сценариев в нашем контроллере; мы повторно используем шаблон представления "NotFound" в методах edit, Details и Delete action; мы используем шаблон именования конвенций с нашими шаблонами представления, который устраняет необходимость явно указывать имя, когда мы называем методом помощи View(); и мы повторно используем класс DinnerFormViewModel как для сценариев действий, так и для отстегивания.

Давайте теперь рассмотрим, как мы можем применить "принцип DRY" в наших шаблонах представления, чтобы исключить дублирование кода и там.

### <a name="re-visiting-our-edit-and-create-view-templates"></a>Повторное посещение наших шаблонов edit and Create View

В настоящее время мы используем два разных шаблона представления - "Edit.aspx" и "Create.aspx" - для отображения нашего uI формы ужина. Быстрое визуальное сравнение из них подчеркивает, насколько они похожи. Ниже приведена форма создания:

![](re-use-ui-using-master-pages-and-partials/_static/image1.png)

А вот как выглядит наша форма «Edit»:

![](re-use-ui-using-master-pages-and-partials/_static/image2.png)

Не так уж много разницы есть? Помимо заголовка и текста заголовка, расположение формы и элементы управления ввода идентичны.

Если мы откроем шаблоны представления "Edit.aspx" и "Create.aspx", мы обнаружим, что они содержат идентичный макет формы и код управления вводами. Это дублирование означает, что мы в конечном итоге того, чтобы внести изменения в два раза в любое время мы вводим или изменить новый ужин собственности - что не хорошо.

### <a name="using-partial-view-templates"></a>Использование шаблонов частичного представления

ASP.NET MVC поддерживает возможность определения шаблонов "частичного представления", которые могут быть использованы для инкапсулирования логики визуализации представления для подчасти страницы. "Частики" предоставляют полезный способ один раз определить логику визуализации представления, а затем повторно использовать ее в нескольких местах в приложении.

Чтобы помочь "DRY-Up" нашему Edit.aspx и Create.aspx view template дублирования, мы можем создать частичное шаблон представления под названием "DinnerForm.ascx", который инкапсулирует расположение формы и входные элементы, общие для обоих. Мы сделаем это, нажав правой нажав на наш /Виды&gt;/ Ужины каталог и выбрав "Добавить- Вид" меню команды:

![](re-use-ui-using-master-pages-and-partials/_static/image3.png)

При этом будет отображаться диалог "Добавить вид". Мы назовем новое представление, которое мы хотим создать "DinnerForm", выберем флажок "Создать частичное представление" в диалоге и укажите, что мы передадим его в классе DinnerFormViewModel:

![](re-use-ui-using-master-pages-and-partials/_static/image4.png)

Когда мы нажмем кнопку "Добавить", Visual Studio создаст новый шаблон представления "DinnerForm.ascx" для нас в каталоге "Просмотры и ужины".

Затем мы можем скопировать/вставить дубликат макетформы / код управления входной связи из нашего шаблона представления Edit.aspx/ Create.aspx в наш новый шаблон частичного представления "DinnerForm.ascx":

[!code-aspx[Main](re-use-ui-using-master-pages-and-partials/samples/sample1.aspx)]

Затем мы можем обновить наши шаблоны edit and Create view, чтобы вызвать частичный шаблон DinnerForm и устранить дублирование формы. Мы можем сделать это, позвонив html.RenderPartial("DinnerForm") в наших шаблонах представления:

##### <a name="createaspx"></a>Создать.aspx

[!code-aspx[Main](re-use-ui-using-master-pages-and-partials/samples/sample2.aspx)]

##### <a name="editaspx"></a>Edit.aspx

[!code-aspx[Main](re-use-ui-using-master-pages-and-partials/samples/sample3.aspx)]

Вы можете явно квалифицировать путь частичного шаблона, который вы хотите при вызове Html.RenderPartial (например: «Виды/Ужины/Ужинформы.ascx»). В нашем приведенном выше коде, однако, мы пользуемся шаблоном именования на основе конвенции в ASP.NET MVC, и просто указывая "DinnerForm" как название частичного рендеринга. Когда мы сделаем это ASP.NET MVC будет выглядеть первым в конференц-каталог представлений (для DinnersController это будет /Виды / Ужины). Если он не найдет частичный шаблон там он будет искать его в /Виды / Общий каталог.

Когда Html.RenderPartial() вызывается только с именем частичного представления, ASP.NET MVC перейдет в частичное представление тех же объектов словаря Модели и ViewData, используемых шаблоном просмотра вызовов. Кроме того, существуют перегруженные версии Html.RenderPartial(), которые позволяют передавать альтернативный объект модели и/или словарь ViewData для частичного использования. Это полезно для сценариев, где требуется только пройти подмножество полной модели/ViewModel.

| **Побочная &lt;тема:&gt; Почему &lt;%&gt;% вместо % % ?** |
| --- |
| Одна из тонких вещей, которые вы могли заметить &lt;с&gt; кодом &lt;выше,&gt; что мы используем % блок вместо % % блок при вызове Html.RenderPartial(). &lt;%&gt; блоки в ASP.NET указывают на то, что разработчик &lt;хочет визуализировать определенное значение (например: %" " Hello" %&gt; будет отображать "Hello"). &lt;Блоки&gt; % вместо этого указывают на то, что разработчик хочет выполнить код, и &lt;что любой отрисованный&gt;вывод внутри них должен быть сделан явно (например: % Response.Write ("Hello") % . Причина, по которой &lt;мы&gt; используем блок % % с нашим кодом Html.RenderPartial, выше, заключается в том, что метод Html.RenderPartial() не возвращает строку, а вместо этого выводит содержимое непосредственно в выходной поток шаблона вызова. Он делает это по причинам эффективности производительности, и таким образом он избегает необходимости создания (потенциально очень большой) временный объект строки. Это снижает использование памяти и улучшает общую пропускную стоимость приложения. Одна из распространенных ошибок при использовании Html.RenderPartial() заключается в том, чтобы &lt;забыть добавить заполнину в конце вызова, когда он находится в пределах % блока.&gt; Например, этот код вызовет ошибку &lt;компилятора: % Html.RenderPartial ("УжинФорм") %&gt; Вам вместо этого нужно написать: &lt;% Html.RenderPartial ("DinnerForm"); %&gt; Это &lt;связано&gt; с тем, что блоки % % являются автономными кодовыми операторами, а при использовании заявлений кода C'а должны быть прекращены с помощью полуколон. |

### <a name="using-partial-view-templates-to-clarify-code"></a>Использование шаблонов частичного представления для уточнения кода

Мы создали шаблон частичного представления "DinnerForm", чтобы избежать дублирования логики визуализации представления в нескольких местах. Это наиболее распространенная причина для создания шаблонов частичного представления.

Иногда все еще имеет смысл создавать частичные представления, даже если они вызываются только в одном месте. Очень сложные шаблоны представления часто становятся гораздо легче читать, когда их логика визуализации представления извлекается и разделена на один или несколько хорошо названных частичных шаблонов.

Например, рассмотрим ниже фрагмент кода из файла Site.master в нашем проекте (который мы рассмотрим в ближайшее время). Код относительно прямолинейный для чтения - отчасти потому, что логика отображения ссылки входа/выхода в правом верхнем правом верхнем экране инкапсулируется в "LogOnUserControl" частично:

[!code-aspx[Main](re-use-ui-using-master-pages-and-partials/samples/sample4.aspx)]

Всякий раз, когда вы окажетесь путать пытается понять HTML / код разметки в представлении-шаблон, рассмотреть вопрос о том, было бы яснее, если некоторые из них были извлечены и рефакторинг в хорошо названные частичные представления.

### <a name="master-pages"></a>Эталонные страницы

В дополнение к поддержке частичных представлений, ASP.NET MVC также поддерживает возможность создания шаблонов "мастер-страницы", которые могут быть использованы для определения общего макета и html верхнего уровня сайта. Элементы управления заполнителя содержимого могут быть добавлены на главную страницу для определения сменных регионов, которые могут быть переопределены или "заполнены" представлениями. Это обеспечивает очень эффективный (и DRY) способ применения общего макета в приложении.

По умолчанию новые ASP.NET проекты MVC автоматически добавляют к ним шаблон главной страницы. Эта главная страница называется "Site.master" и находится в папке «Просмотры»

![](re-use-ui-using-master-pages-and-partials/_static/image5.png)

Файл Site.master по умолчанию выглядит ниже. Он определяет внешний HTML сайта, наряду с меню для навигации в верхней части. Он содержит два сменных элемента управления заполнителем содержимого - один для заголовка, а другой, где основное содержание страницы должно быть заменено:

[!code-aspx[Main](re-use-ui-using-master-pages-and-partials/samples/sample5.aspx)]

Все шаблоны представления, которые мы создали для нашего приложения NerdDinner ("Список", "Подробности", "Edit", "Создать", "NotFound" и т.д.) были основаны на этом шаблоне Site.master. Это указывается через атрибут "MasterPageFile", который был &lt;добавлен по&gt; умолчанию в верхний % - Директива Page % при создании наших представлений с помощью диалога "Add View":

[!code-aspx[Main](re-use-ui-using-master-pages-and-partials/samples/sample6.aspx)]

Это означает, что мы можем изменить содержимое Site.master, а изменения автоматически применяются и использоваться при визуализации любого из наших шаблонов представления.

Давайте обновим наш раздел заголовка Site.master так, чтобы заголовком нашего приложения был "NerdDinner" вместо "My MVC Application". Давайте также обновим наше меню навигации так, чтобы первая вкладка была "Найти ужин" (обрабатывается методом действий Индекса () HomeController), и давайте добавим новую вкладку под названием "Host a Dinner" (обрабатывается методом создания DinnersController()

[!code-aspx[Main](re-use-ui-using-master-pages-and-partials/samples/sample7.aspx)]

Когда мы сохраним файл Site.master и обновим наш браузер, мы увидим, что наши изменения заголовка отображаются во всех представлениях в нашем приложении. Пример:

![](re-use-ui-using-master-pages-and-partials/_static/image6.png)

И с */Ужины / Edit / "ID"* URL:

![](re-use-ui-using-master-pages-and-partials/_static/image7.png)

### <a name="next-step"></a>Следующий шаг

Частичные и мастер-страницы предоставляют очень гибкие варианты, которые позволяют вам чисто организовать представления. Вы обнаружите, что они помогут вам избежать дублирования содержимого представления / кода, и сделать ваши шаблоны представления легче читать и поддерживать.

Давайте вернемся к сценарию листинга, который мы построили ранее, и включим масштабируемую поддержку paging.

> [!div class="step-by-step"]
> [Назад](use-viewdata-and-implement-viewmodel-classes.md)
> [Вперед](implement-efficient-data-paging.md)
