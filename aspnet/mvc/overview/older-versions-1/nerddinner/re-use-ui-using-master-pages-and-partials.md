---
uid: mvc/overview/older-versions-1/nerddinner/re-use-ui-using-master-pages-and-partials
title: Повторное использование пользовательского интерфейса с использованием главных страниц и частичных элементов | Документация Майкрософт
author: microsoft
description: На шаге 7 рассматриваются способы применения принципа "сухой" в наших шаблонах представления для исключения дублирования кода с использованием шаблонов частичного представления и главных страниц.
ms.author: riande
ms.date: 07/27/2010
ms.assetid: d4243a4a-e91c-4116-9ae0-5c08e5285677
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/re-use-ui-using-master-pages-and-partials
msc.type: authoredcontent
ms.openlocfilehash: 0b17cb6ac14b7f187bf1f175097a37907689d46e
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78468726"
---
# <a name="re-use-ui-using-master-pages-and-partials"></a>Многократное использование пользовательского интерфейса с помощью эталонных страниц и частичных представлений

по [Майкрософт](https://github.com/microsoft)

[Скачать в формате PDF](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> Это шаг 7 из бесплатного [учебника по NerdDinner приложению](introducing-the-nerddinner-tutorial.md) , в котором рассматривается создание небольшого, но полного веб-приложения с использованием ASP.NET MVC 1.
> 
> На шаге 7 рассматриваются способы применения принципа "сухой" в наших шаблонах представления для исключения дублирования кода с использованием шаблонов частичного представления и главных страниц.
> 
> Если вы используете ASP.NET MVC 3, мы рекомендуем следовать руководствам по [Начало работы в MVC 3 или в приложении для](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) [музыкального магазина MVC](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) .

## <a name="nerddinner-step-7-partials-and-master-pages"></a>NerdDinner шаг 7. частичные и главные страницы

Одним из принципов проектирования ASP.NET MVC является принцип «не повторять себя» (обычно называется «сухой»). СУХОЙ проект помогает избежать дублирования кода и логики, что в итоге ускоряет создание приложений и упрощает их обслуживание.

Мы уже видели принцип сухой, примененный в некоторых сценариях NerdDinner. Несколько примеров. наша логика проверки реализована на уровне модели, что позволяет применять его как в сценариях редактирования, так и при создании контроллеров. Мы повторно используем шаблон представления "NotFound" во всех методах действия "Изменить", "сведения" и "Удалить". Мы используем шаблон именования соглашений с нашими шаблонами представления, что исключает необходимость явно указывать имя при вызове вспомогательного метода View (); и мы повторно используем класс Диннерформвиевмодел для сценариев действий "Изменить" и "создать".

Теперь рассмотрим способы применения "принципа сухой" в наших шаблонах представления для устранения дублирования кода.

### <a name="re-visiting-our-edit-and-create-view-templates"></a>Повторное посещение шаблонов представления Edit и CREATE

Сейчас мы используем два различных шаблона представления — "Edit. aspx" и "Create. aspx" — для отображения нашего пользовательского интерфейса в форме Dinner. С помощью быстрого визуального сравнения вы узнаете, как они похожи. Ниже показано, как выглядит форма Create.

![](re-use-ui-using-master-pages-and-partials/_static/image1.png)

Вот как выглядит эта форма "Edit":

![](re-use-ui-using-master-pages-and-partials/_static/image2.png)

Есть и другие различия? В отличие от текста заголовка и заголовка, макет формы и элементы управления вводом идентичны.

Если открыть шаблоны представлений "Edit. aspx" и "Create. aspx", мы увидим, что они содержат идентичный макет формы и код элемента управления вводом. Это дублирование означает, что нам приходится вносить изменения дважды в любое время при вводе или изменении нового свойства ужина, что не является хорошим.

### <a name="using-partial-view-templates"></a>Использование шаблонов частичного представления

ASP.NET MVC поддерживает возможность определения шаблонов частичного представления, которые можно использовать для инкапсуляции логики визуализации представления для вложенной части страницы. "Частичные" предоставляют удобный способ определения логики визуализации представления один раз, а затем повторно использовать его в нескольких местах приложения.

Чтобы помочь в создании дубликатов шаблонов представлений Edit. aspx и Create. aspx, можно создать шаблон частичного представления с именем «Диннерформ. ascx», который инкапсулирует макет формы и элементы ввода, общие для обоих. Это можно сделать, щелкнув правой кнопкой мыши наш каталог/Виевс/диннерс и выбрав команду меню Add-&gt;View (добавить в представление):

![](re-use-ui-using-master-pages-and-partials/_static/image3.png)

Отобразится диалоговое окно "Добавление представления". Мы назовем новое представление, которое нужно создать "Диннерформ", установите флажок "создать частичное представление" в диалоговом окне и укажите, что мы передаем его классу Диннерформвиевмодел:

![](re-use-ui-using-master-pages-and-partials/_static/image4.png)

При нажатии кнопки "Добавить" Visual Studio создаст новый шаблон представления "Диннерформ. ascx" для нас в каталоге "\Виевс\диннерс".

Затем можно скопировать или вставить дублирующийся код макета или элемента управления формы Edit. aspx/Create. aspx в наш новый шаблон разделяемого представления "Диннерформ. ascx":

[!code-aspx[Main](re-use-ui-using-master-pages-and-partials/samples/sample1.aspx)]

Затем можно обновить шаблоны представления Edit и CREATE, чтобы вызвать частичный шаблон Диннерформ и исключить дублирование формы. Это можно сделать, вызвав HTML. Рендерпартиал ("Диннерформ") в наших шаблонах представления:

##### <a name="createaspx"></a>Create. aspx

[!code-aspx[Main](re-use-ui-using-master-pages-and-partials/samples/sample2.aspx)]

##### <a name="editaspx"></a>Edit. aspx

[!code-aspx[Main](re-use-ui-using-master-pages-and-partials/samples/sample3.aspx)]

Можно явно указать путь к разделяемому шаблону при вызове HTML. Рендерпартиал (например: ~ views/диннерс/Диннерформ. ascx). Однако в нашем коде мы используем шаблон именования на основе соглашений в ASP.NET MVC и просто указываем "Диннерформ" в качестве имени разделяемого для просмотра. При выполнении этой ASP.NET MVC сначала будет выглядеть в каталоге представлений на основе соглашения (для Диннерсконтроллер это будет/Виевс/диннерс). Если он не находит частичного шаблона, он будет искать его в каталоге/Виевс/Шаред.

Когда метод HTML. Рендерпартиал () вызывается только с именем частичного представления, ASP.NET MVC передается в частичное представление той же модели и объекты словаря ViewData, используемые шаблоном вызывающего представления. Кроме того, существуют перегруженные версии HTML. Рендерпартиал (), которые позволяют передавать альтернативный объект модели и (или) Словарь ViewData для использования в частичном представлении. Это полезно в сценариях, где необходимо передать только подмножество полной модели или ViewModel.

| **Побочный раздел: Зачем &lt;%%&gt; вместо &lt;% =%&gt;?** |
| --- |
| Одной из заметных моментов, которые вы могли заметить с приведенным выше кодом, является использование &lt;%%&gt; вместо блока &lt;% =%&gt; при вызове HTML. Рендерпартиал (). &lt;% =%&gt; блоки в ASP.NET указывают, что разработчик хочет подготовить указанное значение (например: &lt;% = "Hello"%&gt; будет отображать "Hello"). &lt;%%&gt; вместо этого указывают, что разработчик хочет выполнить код, а все отображаемые в них выходные данные должны быть выполнены явно (например: &lt;% Response. Write ("Hello")%&gt;. Причина использования блока &lt;%%&gt; с кодом HTML. Рендерпартиал выше заключается в том, что метод HTML. Рендерпартиал () не возвращает строку и вместо этого выводит содержимое непосредственно в поток вывода шаблона представления. Это делает это для повышения эффективности производительности и позволяет избежать необходимости создания (потенциально очень большой) временного объекта String. Это уменьшает использование памяти и повышает общую пропускную способность приложения. Одной из распространенных ошибок при использовании HTML. Рендерпартиал () является добавление точки с запятой в конце вызова, если оно находится в блоке &lt;%%&gt;. Например, следующий код вызовет ошибку компилятора: &lt;% HTML. Рендерпартиал ("Диннерформ")%&gt; вместо этого необходимо написать: &lt;% HTML. Рендерпартиал ("Диннерформ"); %&gt; это вызвано тем, что &lt;%%&gt; являются автономными операторами кода, а C# при использовании операторов кода необходимо завершать точку с запятой. |

### <a name="using-partial-view-templates-to-clarify-code"></a>Использование шаблонов частичного представления для уточнения кода

Мы создали шаблон частичного представления "Диннерформ", чтобы избежать дублирования логики визуализации представления в нескольких местах. Это наиболее распространенная причина создания шаблонов частичного представления.

Иногда имеет смысл создавать разделяемые представления, даже если они вызываются только в одном месте. Очень сложные шаблоны представлений часто становятся гораздо проще в чтении, когда логика визуализации представления извлекается и разделяется на один или несколько хорошо именованных частичных шаблонов.

Например, рассмотрим приведенный ниже фрагмент кода из файла site. master в нашем проекте (который мы будем смотреть чуть позже). Код относительно прост в чтении – частично, поскольку логика отображения ссылки входа и выхода в верхней правой части экрана инкапсулирована в частично "LogOnUserControl":

[!code-aspx[Main](re-use-ui-using-master-pages-and-partials/samples/sample4.aspx)]

Всякий раз, когда вы обнаружите, что хотите разобраться в разметке HTML/Code в шаблоне представления, подумайте, не было ли ясно, если некоторые из них были извлечены и рефакторингают в виде строго именованных частичных представлений.

### <a name="master-pages"></a>Эталонные страницы

Помимо поддержки частичных представлений, ASP.NET MVC также поддерживает возможность создания шаблонов «эталонной страницы», которые можно использовать для определения общего макета и HTML верхнего уровня сайта. После этого элементы управления заполнителями содержимого можно добавить на главную страницу для обнаружения заменяемых областей, которые можно переопределить или заполнять представлениями. Это обеспечивает очень эффективный (и сухой) способ применения общего макета в приложении.

По умолчанию в новые проекты MVC ASP.NET автоматически добавляется шаблон главной страницы. Эта эталонная страница называется "site. master" и находится в папке \Виевс\шаред\:

![](re-use-ui-using-master-pages-and-partials/_static/image5.png)

Файл Site. master по умолчанию выглядит следующим образом. Он определяет внешний HTML сайта, а также меню для навигации в верхней части. Он содержит два заменяемых заполнителя содержимого — один для заголовка, а другой — для замены основного содержимого страницы:

[!code-aspx[Main](re-use-ui-using-master-pages-and-partials/samples/sample5.aspx)]

Все шаблоны представлений, созданные нами для нашего приложения NerdDinner ("List", "Details", "Edit", "Create", "NotFound" и т. д.), основаны на этом шаблоне site. master. Это указывается с помощью атрибута MasterPageFile, который был добавлен по умолчанию в верхнюю &lt;директиву% @ Page%&gt; при создании наших представлений с помощью диалогового окна "Добавление представления":

[!code-aspx[Main](re-use-ui-using-master-pages-and-partials/samples/sample6.aspx)]

Это означает, что мы можем изменить содержимое site. master и применить изменения автоматически и использовать их при подготовке к просмотру любого из наших шаблонов представления.

Давайте изменим заголовок site. master, чтобы заголовок нашего приложения был «NerdDinner», а не «мое приложение MVC». Также выполним обновление нашего меню навигации, чтобы первая вкладка была «найти обед» (обрабатывается методом действия Index () HomeController), и добавим новую вкладку «Размещение компании Dinner» (которая обрабатывается методом действия Диннерсконтроллер Create ()):

[!code-aspx[Main](re-use-ui-using-master-pages-and-partials/samples/sample7.aspx)]

Когда мы сохраняем файл Site. master и обновляем наш браузер, мы видим, что изменения в заголовке отображаются во всех представлениях приложения. Пример:

![](re-use-ui-using-master-pages-and-partials/_static/image6.png)

И с URL-адресом */диннерс/едит/[ID]* :

![](re-use-ui-using-master-pages-and-partials/_static/image7.png)

### <a name="next-step"></a>Следующий шаг

Частичные и главные страницы предоставляют очень гибкие возможности, позволяющие четко упорядочивать представления. Вы обнаружите, что они помогут избежать дублирования содержимого представления или кода, а также сделать шаблоны представлений более удобными для чтения и сопровождения.

Теперь вернемся к сценарию листинга, созданному ранее, и включите поддержку масштабируемого разбиения по страницам.

> [!div class="step-by-step"]
> [Назад](use-viewdata-and-implement-viewmodel-classes.md)
> [Вперед](implement-efficient-data-paging.md)
