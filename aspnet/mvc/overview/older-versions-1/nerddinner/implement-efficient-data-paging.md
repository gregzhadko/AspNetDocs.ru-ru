---
uid: mvc/overview/older-versions-1/nerddinner/implement-efficient-data-paging
title: Реализация эффективного разбиения данных на страницы | Документация Майкрософт
author: microsoft
description: На шаге 8 показано, как добавить в наш URL-адрес/диннерс поддержку разбиения по страницам, чтобы вместо 1000 тысяч диннерс отображалось 10 предстоящих диннерс в...
ms.author: riande
ms.date: 07/27/2010
ms.assetid: adea836d-dbc2-4005-94ea-53aef09e9e34
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/implement-efficient-data-paging
msc.type: authoredcontent
ms.openlocfilehash: 2d9a0dba381b71755ac626f76d52bc5bcb434447
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78486486"
---
# <a name="implement-efficient-data-paging"></a><span data-ttu-id="9e61f-103">Реализация эффективного разбиения данных по страницам</span><span class="sxs-lookup"><span data-stu-id="9e61f-103">Implement Efficient Data Paging</span></span>

<span data-ttu-id="9e61f-104">по [Майкрософт](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="9e61f-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="9e61f-105">Скачать в формате PDF</span><span class="sxs-lookup"><span data-stu-id="9e61f-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="9e61f-106">Это шаг 8 из бесплатного [учебника по NerdDinner приложению](introducing-the-nerddinner-tutorial.md) , в котором рассматривается создание небольшого, но полного веб-приложения с использованием ASP.NET MVC 1.</span><span class="sxs-lookup"><span data-stu-id="9e61f-106">This is step 8 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="9e61f-107">На шаге 8 показано, как добавить поддержку разбиения по страницам в наш URL-адрес/диннерс, чтобы вместо отображения тысяч диннерс одновременно отображалось 10 предстоящих диннерсов, и позволить конечным пользователям пролистывать и пересылать весь список в удобном для SEO виде.</span><span class="sxs-lookup"><span data-stu-id="9e61f-107">Step 8 shows how to add paging support to our /Dinners URL so that instead of displaying 1000s of dinners at once, we'll only display 10 upcoming dinners at a time - and allow end-users to page back and forward through the entire list in an SEO friendly way.</span></span>
> 
> <span data-ttu-id="9e61f-108">Если вы используете ASP.NET MVC 3, мы рекомендуем следовать руководствам по [Начало работы в MVC 3 или в приложении для](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) [музыкального магазина MVC](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) .</span><span class="sxs-lookup"><span data-stu-id="9e61f-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>

## <a name="nerddinner-step-8-paging-support"></a><span data-ttu-id="9e61f-109">NerdDinner шаг 8. Поддержка разбиения по страницам</span><span class="sxs-lookup"><span data-stu-id="9e61f-109">NerdDinner Step 8: Paging Support</span></span>

<span data-ttu-id="9e61f-110">Если наш сайт будет успешным, у него будут тысячи ближайших диннерс.</span><span class="sxs-lookup"><span data-stu-id="9e61f-110">If our site is successful, it will have thousands of upcoming dinners.</span></span> <span data-ttu-id="9e61f-111">Нам нужно убедиться, что наш интерфейс масштабируется для выполнения всех этих диннерс и позволяет пользователям просматривать их.</span><span class="sxs-lookup"><span data-stu-id="9e61f-111">We need to make sure that our UI scales to handle all of these dinners, and allows users to browse them.</span></span> <span data-ttu-id="9e61f-112">Чтобы включить эту функцию, мы добавим поддержку разбиения по страницам к URL-адресу */диннерс* , чтобы вместо отображения тысяч диннерс одновременно отображалось 10 предстоящих диннерс, и позволить конечным пользователям пролистывать и пересылать по всему списку понятный способ для SEO.</span><span class="sxs-lookup"><span data-stu-id="9e61f-112">To enable this, we'll add paging support to our */Dinners* URL so that instead of displaying 1000s of dinners at once, we'll only display 10 upcoming dinners at a time - and allow end-users to page back and forward through the entire list in an SEO friendly way.</span></span>

### <a name="index-action-method-recap"></a><span data-ttu-id="9e61f-113">Метод действия Index ()</span><span class="sxs-lookup"><span data-stu-id="9e61f-113">Index() Action Method Recap</span></span>

<span data-ttu-id="9e61f-114">В настоящее время метод действия Index () в нашем классе Диннерсконтроллер выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="9e61f-114">The Index() action method within our DinnersController class currently looks like below:</span></span>

[!code-csharp[Main](implement-efficient-data-paging/samples/sample1.cs)]

<span data-ttu-id="9e61f-115">При выполнении запроса к URL-адресу */диннерс* извлекается список всех предстоящих диннерс, а затем отображается список всех их элементов:</span><span class="sxs-lookup"><span data-stu-id="9e61f-115">When a request is made to the */Dinners* URL, it retrieves a list of all upcoming dinners and then renders a listing of all of them out:</span></span>

![](implement-efficient-data-paging/_static/image1.png)

### <a name="understanding-iqueryablelttgt"></a><span data-ttu-id="9e61f-116">Основные сведения о IQueryable&lt;T&gt;</span><span class="sxs-lookup"><span data-stu-id="9e61f-116">Understanding IQueryable&lt;T&gt;</span></span>

<span data-ttu-id="9e61f-117">*Iqueryable&lt;t&gt;* — это интерфейс, который появился с LINQ в составе .NET 3,5.</span><span class="sxs-lookup"><span data-stu-id="9e61f-117">*IQueryable&lt;T&gt;* is an interface that was introduced with LINQ as part of .NET 3.5.</span></span> <span data-ttu-id="9e61f-118">Он обеспечивает мощные сценарии отложенного выполнения, которые можно использовать для реализации поддержки разбиения по страницам.</span><span class="sxs-lookup"><span data-stu-id="9e61f-118">It enables powerful "deferred execution" scenarios that we can take advantage of to implement paging support.</span></span>

<span data-ttu-id="9e61f-119">В нашем Диннеррепоситори мы возвращаем в метод Финдупкомингдиннерс ()&gt;ную последовательность с IQueryable&lt;.</span><span class="sxs-lookup"><span data-stu-id="9e61f-119">In our DinnerRepository we are returning an IQueryable&lt;Dinner&gt; sequence from our FindUpcomingDinners() method:</span></span>

[!code-csharp[Main](implement-efficient-data-paging/samples/sample2.cs)]

<span data-ttu-id="9e61f-120">Объект IQueryable&lt;ужин&gt;, возвращенный методом Финдупкомингдиннерс (), инкапсулирует запрос для получения объектов Dinner из нашей базы данных с помощью LINQ to SQL.</span><span class="sxs-lookup"><span data-stu-id="9e61f-120">The IQueryable&lt;Dinner&gt; object returned by our FindUpcomingDinners() method encapsulates a query to retrieve Dinner objects from our database using LINQ to SQL.</span></span> <span data-ttu-id="9e61f-121">Важно то, что он не будет выполнять запрос к базе данных, пока не предпримет попытку получить доступ к данным в запросе или выполнить итерацию, или пока мы не вызываем метод ToList ().</span><span class="sxs-lookup"><span data-stu-id="9e61f-121">Importantly, it won't execute the query against the database until we attempt to access/iterate over the data in the query, or until we call the ToList() method on it.</span></span> <span data-ttu-id="9e61f-122">Код, вызывающий наш метод Финдупкомингдиннерс (), при необходимости может добавить дополнительные "сцепленные" операции или фильтры к IQueryable&lt;объект&gt; ужин перед выполнением запроса.</span><span class="sxs-lookup"><span data-stu-id="9e61f-122">The code calling our FindUpcomingDinners() method can optionally choose to add additional "chained" operations/filters to the IQueryable&lt;Dinner&gt; object before executing the query.</span></span> <span data-ttu-id="9e61f-123">Затем LINQ to SQL достаточно интеллектуальной, чтобы выполнить Объединенный запрос к базе данных при запросе данных.</span><span class="sxs-lookup"><span data-stu-id="9e61f-123">LINQ to SQL is then smart enough to execute the combined query against the database when the data is requested.</span></span>

<span data-ttu-id="9e61f-124">Чтобы реализовать логику разбиения по страницам, мы можем обновить метод действия Index () Диннерсконтроллер, чтобы он применял дополнительные операторы "Skip" и "Take" к возвращенной последовательностью IQueryable&lt;ужин&gt; перед вызовом метода ToList ().</span><span class="sxs-lookup"><span data-stu-id="9e61f-124">To implement paging logic we can update our DinnersController's Index() action method so that it applies additional "Skip" and "Take" operators to the returned IQueryable&lt;Dinner&gt; sequence before calling ToList() on it:</span></span>

[!code-csharp[Main](implement-efficient-data-paging/samples/sample3.cs)]

<span data-ttu-id="9e61f-125">Приведенный выше код пропускает первые 10 предстоящих диннерс в базе данных, а затем возвращает 20 диннерс.</span><span class="sxs-lookup"><span data-stu-id="9e61f-125">The above code skips over the first 10 upcoming dinners in the database, and then returns back 20 dinners.</span></span> <span data-ttu-id="9e61f-126">LINQ to SQL достаточно разумна для создания оптимизированного SQL-запроса, который выполняет эту пропускную логику в базе данных SQL, а не в Web Server.</span><span class="sxs-lookup"><span data-stu-id="9e61f-126">LINQ to SQL is smart enough to construct an optimized SQL query that performs this skipping logic in the SQL database – and not in the web-server.</span></span> <span data-ttu-id="9e61f-127">Это означает, что даже если у нас есть миллионы предстоящих диннерс в базе данных, в рамках этого запроса будет извлекаться только 10.</span><span class="sxs-lookup"><span data-stu-id="9e61f-127">This means that even if we have millions of upcoming Dinners in the database, only the 10 we want will be retrieved as part of this request (making it efficient and scalable).</span></span>

### <a name="adding-a-page-value-to-the-url"></a><span data-ttu-id="9e61f-128">Добавление значения "Page" к URL-адресу</span><span class="sxs-lookup"><span data-stu-id="9e61f-128">Adding a "page" value to the URL</span></span>

<span data-ttu-id="9e61f-129">Вместо того чтобы жестко программировать конкретный диапазон страниц, мы хотим, чтобы наши URL-адреса включали параметр «Page», указывающий, какой Обедный диапазон запрашивает пользователь.</span><span class="sxs-lookup"><span data-stu-id="9e61f-129">Instead of hard-coding a specific page range, we'll want our URLs to include a "page" parameter that indicates which Dinner range a user is requesting.</span></span>

#### <a name="using-a-querystring-value"></a><span data-ttu-id="9e61f-130">Использование значения строки запроса</span><span class="sxs-lookup"><span data-stu-id="9e61f-130">Using a Querystring value</span></span>

<span data-ttu-id="9e61f-131">В приведенном ниже коде показано, как можно обновить наш метод действия Index () для поддержки параметра QueryString и включения URL-адресов, таких как */диннерс? Page = 2*:</span><span class="sxs-lookup"><span data-stu-id="9e61f-131">The code below demonstrates how we can update our Index() action method to support a querystring parameter and enable URLs like */Dinners?page=2*:</span></span>

[!code-csharp[Main](implement-efficient-data-paging/samples/sample4.cs)]

<span data-ttu-id="9e61f-132">Метод действия Index () выше имеет параметр с именем "Page".</span><span class="sxs-lookup"><span data-stu-id="9e61f-132">The Index() action method above has a parameter named "page".</span></span> <span data-ttu-id="9e61f-133">Параметр объявляется как целое число, допускающее значение null (то есть что int? указывает).</span><span class="sxs-lookup"><span data-stu-id="9e61f-133">The parameter is declared as a nullable integer (that is what int? indicates).</span></span> <span data-ttu-id="9e61f-134">Это означает, что URL-адрес */диннерс? Page = 2* приведет к передаче значения "2" в качестве значения параметра.</span><span class="sxs-lookup"><span data-stu-id="9e61f-134">This means that the */Dinners?page=2* URL will cause a value of "2" to be passed as the parameter value.</span></span> <span data-ttu-id="9e61f-135">URL-адрес */диннерс* (без значения QueryString) приведет к передаче значения NULL.</span><span class="sxs-lookup"><span data-stu-id="9e61f-135">The */Dinners* URL (without a querystring value) will cause a null value to be passed.</span></span>

<span data-ttu-id="9e61f-136">Мы умножаем значение страницы на размер страницы (в данном случае 10 строк), чтобы определить, сколько диннерс пропускается.</span><span class="sxs-lookup"><span data-stu-id="9e61f-136">We are multiplying the page value by the page size (in this case 10 rows) to determine how many dinners to skip over.</span></span> <span data-ttu-id="9e61f-137">Мы используем [ C# оператор "объединения" (??) со значением NULL](https://weblogs.asp.net/scottgu/archive/2007/09/20/the-new-c-null-coalescing-operator-and-using-it-with-linq.aspx) , который полезен при работе с типами, допускающими значение null.</span><span class="sxs-lookup"><span data-stu-id="9e61f-137">We are using the [C# null "coalescing" operator (??)](https://weblogs.asp.net/scottgu/archive/2007/09/20/the-new-c-null-coalescing-operator-and-using-it-with-linq.aspx) which is useful when dealing with nullable types.</span></span> <span data-ttu-id="9e61f-138">Приведенный выше код присваивает странице значение 0, если параметр страницы имеет значение null.</span><span class="sxs-lookup"><span data-stu-id="9e61f-138">The code above assigns page the value of 0 if the page parameter is null.</span></span>

#### <a name="using-embedded-url-values"></a><span data-ttu-id="9e61f-139">Использование внедренных URL-значений</span><span class="sxs-lookup"><span data-stu-id="9e61f-139">Using Embedded URL values</span></span>

<span data-ttu-id="9e61f-140">Альтернативой использованию значения строки запроса является встраивание параметра страницы в фактический URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="9e61f-140">An alternative to using a querystring value would be to embed the page parameter within the actual URL itself.</span></span> <span data-ttu-id="9e61f-141">Например: */Dinners/Page/2* или */Dinners/2*.</span><span class="sxs-lookup"><span data-stu-id="9e61f-141">For example: */Dinners/Page/2* or */Dinners/2*.</span></span> <span data-ttu-id="9e61f-142">ASP.NET MVC включает мощный механизм маршрутизации URL-адресов, который упрощает поддержку таких сценариев.</span><span class="sxs-lookup"><span data-stu-id="9e61f-142">ASP.NET MVC includes a powerful URL routing engine that makes it easy to support scenarios like this.</span></span>

<span data-ttu-id="9e61f-143">Мы можем зарегистрировать пользовательские правила маршрутизации, которые сопоставляют любой входящий URL-адрес или формат URL-адреса с любым классом контроллера или методом действия, который нам нужен.</span><span class="sxs-lookup"><span data-stu-id="9e61f-143">We can register custom routing rules that map any incoming URL or URL format to any controller class or action method we want.</span></span> <span data-ttu-id="9e61f-144">Нам нужно только открыть файл Global. asax в нашем проекте:</span><span class="sxs-lookup"><span data-stu-id="9e61f-144">All we need to-do is to open the Global.asax file within our project:</span></span>

![](implement-efficient-data-paging/_static/image2.png)

<span data-ttu-id="9e61f-145">Затем зарегистрируйте новое правило сопоставления с помощью вспомогательного метода файл MapRoute (), подобно первому вызову маршрутов. Файл MapRoute () ниже:</span><span class="sxs-lookup"><span data-stu-id="9e61f-145">And then register a new mapping rule using the MapRoute() helper method like the first call to routes.MapRoute() below:</span></span>

[!code-csharp[Main](implement-efficient-data-paging/samples/sample5.cs)]

<span data-ttu-id="9e61f-146">Выше мы регистрируем новое правило маршрутизации с именем "Упкомингдиннерс".</span><span class="sxs-lookup"><span data-stu-id="9e61f-146">Above we are registering a new routing rule named "UpcomingDinners".</span></span> <span data-ttu-id="9e61f-147">Мы обозначаем, что он имеет формат URL-адреса "диннерс/Page/{Page}", где {Page} — это значение параметра, внедренное в URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="9e61f-147">We are indicating it has the URL format "Dinners/Page/{page}" – where {page} is a parameter value embedded within the URL.</span></span> <span data-ttu-id="9e61f-148">Третий параметр метода файл MapRoute () указывает, что необходимо сопоставить URL-адреса, соответствующие этому формату, с методом действия Index () в классе Диннерсконтроллер.</span><span class="sxs-lookup"><span data-stu-id="9e61f-148">The third parameter to the MapRoute() method indicates that we should map URLs that match this format to the Index() action method on the DinnersController class.</span></span>

<span data-ttu-id="9e61f-149">Мы можем использовать тот же код индекса (), который мы имели до нашего сценария QueryString, за исключением того, что теперь наш параметр "страница" будет получен из URL-адреса, а не из строки запроса:</span><span class="sxs-lookup"><span data-stu-id="9e61f-149">We can use the exact same Index() code we had before with our Querystring scenario – except now our "page" parameter will come from the URL and not the querystring:</span></span>

[!code-csharp[Main](implement-efficient-data-paging/samples/sample6.cs)]

<span data-ttu-id="9e61f-150">Теперь при запуске приложения и вводе в */диннерс* мы увидим первые 10 предстоящих диннерс:</span><span class="sxs-lookup"><span data-stu-id="9e61f-150">And now when we run the application and type in */Dinners* we'll see the first 10 upcoming dinners:</span></span>

![](implement-efficient-data-paging/_static/image3.png)

<span data-ttu-id="9e61f-151">И при вводе в */Dinners/Page/1* мы увидим следующую страницу диннерс:</span><span class="sxs-lookup"><span data-stu-id="9e61f-151">And when we type in */Dinners/Page/1* we'll see the next page of dinners:</span></span>

![](implement-efficient-data-paging/_static/image4.png)

### <a name="adding-page-navigation-ui"></a><span data-ttu-id="9e61f-152">Добавление пользовательского интерфейса навигации по страницам</span><span class="sxs-lookup"><span data-stu-id="9e61f-152">Adding page navigation UI</span></span>

<span data-ttu-id="9e61f-153">Последним шагом для завершения нашего сценария разбиения на страницы будет реализация пользовательского интерфейса навигации "Next" и "Previous" в нашем шаблоне представления, чтобы пользователи могли легко пропускать данные о обедах.</span><span class="sxs-lookup"><span data-stu-id="9e61f-153">The last step to complete our paging scenario will be to implement "next" and "previous" navigation UI within our view template to enable users to easily skip over the Dinner data.</span></span>

<span data-ttu-id="9e61f-154">Чтобы правильно реализовать эту возможность, необходимо знать общее количество диннерс в базе данных, а также количество страниц данных, на которые она преобразуется.</span><span class="sxs-lookup"><span data-stu-id="9e61f-154">To implement this correctly, we'll need to know the total number of Dinners in the database, as well as how many pages of data this translates to.</span></span> <span data-ttu-id="9e61f-155">Затем необходимо определить, находится ли текущее запрошенное значение "Page" в начале или в конце данных, а также показать или скрыть соответствующий пользовательский интерфейс "назад" и "Далее".</span><span class="sxs-lookup"><span data-stu-id="9e61f-155">We'll then need to calculate whether the currently requested "page" value is at the beginning or end of the data, and show or hide the "previous" and "next" UI accordingly.</span></span> <span data-ttu-id="9e61f-156">Мы можем реализовать эту логику в методе действия Index ().</span><span class="sxs-lookup"><span data-stu-id="9e61f-156">We could implement this logic within our Index() action method.</span></span> <span data-ttu-id="9e61f-157">Кроме того, мы можем добавить вспомогательный класс в наш проект, который инкапсулирует эту логику более повторного использования.</span><span class="sxs-lookup"><span data-stu-id="9e61f-157">Alternatively we can add a helper class to our project that encapsulates this logic in a more re-usable way.</span></span>

<span data-ttu-id="9e61f-158">Ниже приведен простой вспомогательный класс "Пагинатедлист", производный от класса списка&lt;T&gt; коллекции, встроенного в .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="9e61f-158">Below is a simple "PaginatedList" helper class that derives from the List&lt;T&gt; collection class built-into the .NET Framework.</span></span> <span data-ttu-id="9e61f-159">Он реализует повторно используемый класс коллекции, который можно использовать для разбиения любой последовательности данных IQueryable на страницы.</span><span class="sxs-lookup"><span data-stu-id="9e61f-159">It implements a re-usable collection class that can be used to paginate any sequence of IQueryable data.</span></span> <span data-ttu-id="9e61f-160">В нашем приложении NerdDinner он будет работать с IQueryable&lt;&gt;ных результатов, но его можно было бы легко использовать для IQueryable&lt;&gt; продуктов или IQueryable&lt;клиентской&gt; результаты в других сценариях приложения:</span><span class="sxs-lookup"><span data-stu-id="9e61f-160">In our NerdDinner application we'll have it work over IQueryable&lt;Dinner&gt; results, but it could just as easily be used against IQueryable&lt;Product&gt; or IQueryable&lt;Customer&gt; results in other application scenarios:</span></span>

[!code-csharp[Main](implement-efficient-data-paging/samples/sample7.cs)]

<span data-ttu-id="9e61f-161">Обратите внимание на то, как оно вычисляется, а затем предоставляет такие свойства, как "PageIndex", "PageSize", "TotalCount" и "TotalPages".</span><span class="sxs-lookup"><span data-stu-id="9e61f-161">Notice above how it calculates and then exposes properties like "PageIndex", "PageSize", "TotalCount", and "TotalPages".</span></span> <span data-ttu-id="9e61f-162">Он также предоставляет два вспомогательных свойства "Хаспревиауспаже" и "Хаснекстпаже", которые указывают, находится ли страница данных в коллекции в начале или в конце исходной последовательности.</span><span class="sxs-lookup"><span data-stu-id="9e61f-162">It also then exposes two helper properties "HasPreviousPage" and "HasNextPage" that indicate whether the page of data in the collection is at the beginning or end of the original sequence.</span></span> <span data-ttu-id="9e61f-163">Приведенный выше код приведет к запуску двух SQL-запросов — первый способ получить количество от общего числа объектов Dinner (это не возвращает объекты), а затем выполняет инструкцию SELECT COUNT, возвращающую целое число, а вторая — для получения только строк данные, необходимые в нашей базе данных для текущей страницы данных.</span><span class="sxs-lookup"><span data-stu-id="9e61f-163">The above code will cause two SQL queries to be run - the first to retrieve the count of the total number of Dinner objects (this doesn't return the objects – rather it performs a "SELECT COUNT" statement that returns an integer), and the second to retrieve just the rows of data we need from our database for the current page of data.</span></span>

<span data-ttu-id="9e61f-164">Затем можно обновить вспомогательный метод Диннерсконтроллер. index (), чтобы создать Пагинатедлист&lt;ужин&gt; из результата Диннеррепоситори. Финдупкомингдиннерс () и передать его в наш шаблон представления:</span><span class="sxs-lookup"><span data-stu-id="9e61f-164">We can then update our DinnersController.Index() helper method to create a PaginatedList&lt;Dinner&gt; from our DinnerRepository.FindUpcomingDinners() result, and pass it to our view template:</span></span>

[!code-csharp[Main](implement-efficient-data-paging/samples/sample8.cs)]

<span data-ttu-id="9e61f-165">Затем можно обновить шаблон представления \Виевс\диннерс\индекс.аспкс, чтобы он наследовался от СтраницаПредставления&lt;NerdDinner. Helps. Пагинатедлист&lt;ужин&gt;&gt; вместо СтраницаПредставления&lt;IEnumerable&lt;ужин&gt;&gt;, а затем добавьте следующий код в нижнюю часть нашего шаблона представления, чтобы показать или скрыть следующий и предыдущий пользовательский интерфейс навигации:</span><span class="sxs-lookup"><span data-stu-id="9e61f-165">We can then update the \Views\Dinners\Index.aspx view template to inherit from ViewPage&lt;NerdDinner.Helpers.PaginatedList&lt;Dinner&gt;&gt; instead of ViewPage&lt;IEnumerable&lt;Dinner&gt;&gt;, and then add the following code to the bottom of our view-template to show or hide next and previous navigation UI:</span></span>

[!code-aspx[Main](implement-efficient-data-paging/samples/sample9.aspx)]

<span data-ttu-id="9e61f-166">Обратите внимание, что мы используем вспомогательный метод HTML. Раутелинк () для создания гиперссылок.</span><span class="sxs-lookup"><span data-stu-id="9e61f-166">Notice above how we are using the Html.RouteLink() helper method to generate our hyperlinks.</span></span> <span data-ttu-id="9e61f-167">Этот метод аналогичен вспомогательному методу HTML. ActionLink (), который мы использовали ранее.</span><span class="sxs-lookup"><span data-stu-id="9e61f-167">This method is similar to the Html.ActionLink() helper method we've used previously.</span></span> <span data-ttu-id="9e61f-168">Разница заключается в том, что мы создаем URL-адрес с помощью правила маршрутизации "Упкомингдиннерс", которое мы настроили в файле Global. asax.</span><span class="sxs-lookup"><span data-stu-id="9e61f-168">The difference is that we are generating the URL using the "UpcomingDinners" routing rule we setup within our Global.asax file.</span></span> <span data-ttu-id="9e61f-169">Это гарантирует, что мы создадим URL-адреса для нашего метода действия Index (), который имеет следующий формат: */диннерс/Паже/{Паже}* — где значение {Page} — это переменная, которую мы предоставляем выше на основе текущего индекса PageIndex.</span><span class="sxs-lookup"><span data-stu-id="9e61f-169">This ensures that we'll generate URLs to our Index() action method that have the format: */Dinners/Page/{page}* – where the {page} value is a variable we are providing above based on the current PageIndex.</span></span>

<span data-ttu-id="9e61f-170">Теперь при повторном запуске нашего приложения в браузере будет показано 10 диннерс:</span><span class="sxs-lookup"><span data-stu-id="9e61f-170">And now when we run our application again we'll see 10 dinners at a time in our browser:</span></span>

![](implement-efficient-data-paging/_static/image5.png)

<span data-ttu-id="9e61f-171">Кроме того, в нижней части страницы есть &lt;&lt;&lt; и &gt;&gt;&gt;, что позволяет пропускать пересылку и обратную передачу по данным, используя доступные URL-адреса поисковой системы:</span><span class="sxs-lookup"><span data-stu-id="9e61f-171">We also have &lt;&lt;&lt; and &gt;&gt;&gt; navigation UI at the bottom of the page that allows us to skip forwards and backwards over our data using search engine accessible URLs:</span></span>

![](implement-efficient-data-paging/_static/image6.png)

| <span data-ttu-id="9e61f-172">**Боковая Тема: основные сведения о влиянии IQueryable&lt;T&gt;**</span><span class="sxs-lookup"><span data-stu-id="9e61f-172">**Side Topic: Understanding the implications of IQueryable&lt;T&gt;**</span></span> |
| --- |
| <span data-ttu-id="9e61f-173">IQueryable&lt;T&gt; — это очень мощная функция, которая обеспечивает разнообразные интересные сценарии отложенного выполнения (например, запросы на основе разбиения на страницы и композиции).</span><span class="sxs-lookup"><span data-stu-id="9e61f-173">IQueryable&lt;T&gt; is a very powerful feature that enables a variety of interesting deferred execution scenarios (like paging and composition based queries).</span></span> <span data-ttu-id="9e61f-174">Как и в случае с любыми мощными функциями, необходимо соблюдать осторожность при использовании этой функции и убедиться в том, что она не нарушена.</span><span class="sxs-lookup"><span data-stu-id="9e61f-174">As with all powerful features, you want to be careful with how you use it and make sure it is not abused.</span></span> <span data-ttu-id="9e61f-175">Важно понимать, что возврат IQueryable&lt;T&gt; результат из репозитория позволяет вызывать код для добавления в цепочку методов операторов и поэтому участвует в окончательном выполнении запроса.</span><span class="sxs-lookup"><span data-stu-id="9e61f-175">It is important to recognize that returning an IQueryable&lt;T&gt; result from your repository enables calling code to append on chained operator methods to it, and so participate in the ultimate query execution.</span></span> <span data-ttu-id="9e61f-176">Если вы не хотите предоставлять вызывающему коду эту возможность, следует вернуть IList&lt;T&gt; или IEnumerable&lt;T&gt; results, которые содержат результаты уже выполненного запроса.</span><span class="sxs-lookup"><span data-stu-id="9e61f-176">If you do not want to provide calling code this ability, then you should return back IList&lt;T&gt; or IEnumerable&lt;T&gt; results - which contain the results of a query that has already executed.</span></span> <span data-ttu-id="9e61f-177">Для сценариев разбивки на страницы необходимо передать логику разбиения данных на страницы в вызываемом методе репозитория.</span><span class="sxs-lookup"><span data-stu-id="9e61f-177">For pagination scenarios this would require you to push the actual data pagination logic into the repository method being called.</span></span> <span data-ttu-id="9e61f-178">В этом сценарии мы можем обновить наш метод Финдупкомингдиннерс () Finder, чтобы получить сигнатуру, которая либо возвращает Пагинатедлист: Пагинатедлист&lt; ужин&gt; Финдупкомингдиннерс (int pageIndex, int pageSize) {} или вернуть IList&lt;ужин&gt;и использовать параметр "totalCount" для получения общего числа диннерс: IList&lt;ужин&gt; Финдупкомингдиннерс (int pageIndex, int pageSize, out int totalCount) {}</span><span class="sxs-lookup"><span data-stu-id="9e61f-178">In this scenario we might update our FindUpcomingDinners() finder method to have a signature that either returned a PaginatedList: PaginatedList&lt; Dinner&gt; FindUpcomingDinners(int pageIndex, int pageSize) { } Or return back an IList&lt;Dinner&gt;, and use a "totalCount" out param to return the total count of Dinners: IList&lt;Dinner&gt; FindUpcomingDinners(int pageIndex, int pageSize, out int totalCount) { }</span></span> |

### <a name="next-step"></a><span data-ttu-id="9e61f-179">Следующий шаг</span><span class="sxs-lookup"><span data-stu-id="9e61f-179">Next Step</span></span>

<span data-ttu-id="9e61f-180">Теперь рассмотрим, как можно добавить поддержку проверки подлинности и авторизации в наше приложение.</span><span class="sxs-lookup"><span data-stu-id="9e61f-180">Let's now look at how we can add authentication and authorization support to our application.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="9e61f-181">[Назад](re-use-ui-using-master-pages-and-partials.md)
> [Вперед](secure-applications-using-authentication-and-authorization.md)</span><span class="sxs-lookup"><span data-stu-id="9e61f-181">[Previous](re-use-ui-using-master-pages-and-partials.md)
[Next](secure-applications-using-authentication-and-authorization.md)</span></span>
