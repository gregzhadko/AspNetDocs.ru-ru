---
uid: mvc/overview/older-versions-1/nerddinner/secure-applications-using-authentication-and-authorization
title: Защита приложений с помощью проверки подлинности и авторизации | Документация Майкрософт
author: microsoft
description: Шаг 9 показано добавление проверки подлинности и авторизации для защиты наше приложение NerdDinner, так что пользователям нужно зарегистрировать и выполните вход на сайт для создания...
ms.author: riande
ms.date: 07/27/2010
ms.assetid: 9e4d5cac-b071-440c-b044-20b6d0c964fb
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/secure-applications-using-authentication-and-authorization
msc.type: authoredcontent
ms.openlocfilehash: 8d509c5f15bb4d5014e53b8dc2a736454238e72c
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2019
ms.locfileid: "65122229"
---
# <a name="secure-applications-using-authentication-and-authorization"></a>Защита приложений с помощью проверки подлинности и авторизации

по [Microsoft](https://github.com/microsoft)

[Загрузить PDF-файл](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> Это 9 из бесплатной [руководство по использованию приложения «NerdDinner»](introducing-the-nerddinner-tutorial.md) , пошаговое рассмотрение как создать небольшой, но завершить, веб-приложения с помощью ASP.NET MVC 1.
> 
> Шаг 9 показано добавление проверки подлинности и авторизации для защиты наше приложение NerdDinner, так что пользователям нужно зарегистрировать и вход на сайт для создания нового ужинов и только пользователь, который размещается dinner можно изменить позже.
> 
> Если вы используете ASP.NET MVC 3, рекомендуется следовать [Приступая к работе с MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) или [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) учебники.

## <a name="nerddinner-step-9-authentication-and-authorization"></a>NerdDinner Step 9: Аутентификация и авторизация

Сейчас наши NerdDinner приложение предоставляет любой пользователь узле возможность создавать и изменять сведения о любой компании dinner. Давайте изменим это, так что пользователям нужно зарегистрировать и выполните вход на сайт для создания нового ужинов и добавить ограничение, чтобы только пользователь, который размещается на ужин его можно изменить позже.

Для этого мы будем использовать проверку подлинности и авторизации для защиты приложения.

### <a name="understanding-authentication-and-authorization"></a>Основные сведения о проверки подлинности и авторизации

*Проверка подлинности* — это процесс идентификации и проверки удостоверения клиента, доступ к приложению. Проще говоря, это об идентификации «, «конечных пользователей при посещении веб-сайта. ASP.NET поддерживает несколько способов для проверки подлинности пользователей в браузере. Для веб-приложений Интернета наиболее распространенным подходом проверки подлинности используется называется «Проверка подлинности форм». Аутентификация с помощью форм позволяет разработчику создавать HTML-форму входа в приложения, а затем проверять имя пользователя и пароль, которые конечный пользователь отправляет на базу данных или другом хранилище учетных данных пароля. Если комбинация пользователь/пароль указан правильно, разработчик может затем попросите ASP.NET для выдачи зашифрованного файла cookie HTTP для идентификации пользователя для будущих запросов. Мы будем с использованием проверки подлинности форм с наше приложение NerdDinner.

*Авторизация* — это процесс определения, имеет ли текущий пользователь прошел разрешение для доступа к определенного ресурса или URL-адрес или для выполнения некоторых операций. Например, в наше приложение NerdDinner нам понадобятся для авторизации, доступно ли только пользователи, вошедшие в */ужинов/Create* URL-адрес и создайте новый ужинов. Будет также необходимо добавить логику авторизации, чтобы только пользователь, где размещается компании dinner можно изменять его — и запретить изменение доступ всем остальным пользователям.

### <a name="forms-authentication-and-the-accountcontroller"></a>Проверка подлинности форм и AccountController

Шаблон проекта Visual Studio по умолчанию для ASP.NET MVC автоматически включает проверку подлинности форм, при создании новых приложений ASP.NET MVC. Реализация страницы предварительно созданные учетной записи входа также автоматически добавляется проект – что делает его очень легко интегрировать безопасности в пределах сайта.

Страницей Site.master по умолчанию отображается ссылка «Вход» в правой верхней сайта, когда доступ к нему пользователь не прошел проверку подлинности:

![](secure-applications-using-authentication-and-authorization/_static/image1.png)

Щелкнув ссылку «Вход» открывающее для пользователя */учетной записи и входа в систему* URL-адрес:

![](secure-applications-using-authentication-and-authorization/_static/image2.png)

Посетителей, которые еще не зарегистрированы можно сделать, щелкнув ссылку «Зарегистрировать» — которая перенаправит их */учетная запись/Register* URL-адрес, давая возможность введите данные учетной записи:

![](secure-applications-using-authentication-and-authorization/_static/image3.png)

Нажмите кнопку «Зарегистрировать» Создание нового пользователя в систему членства ASP.NET и проверки подлинности пользователя на узел с помощью форм.

Если пользователь не вошедшего в систему, Site.master изменяет верхней правой части страницы для вывода «Добро пожаловать [username]!» сообщение и отображает «выход» ссылку вместо «вход» один. Щелкнув ссылку «Выход» выполняет выход пользователя:

![](secure-applications-using-authentication-and-authorization/_static/image4.png)

К описанным выше возможностям входа, выхода и регистрации реализуется в классе AccountController, который был добавлен в свой проект в Visual Studio при создании проекта. Пользовательский Интерфейс для контроллера AccountController реализуется с помощью шаблонов представлений в каталоге \Views\Account:

![](secure-applications-using-authentication-and-authorization/_static/image5.png)

В классе AccountController используется система проверки подлинности форм ASP.NET для выдачи проверки подлинности зашифрованные файлы cookie и API членства ASP.NET для хранения и проверить имена пользователей и пароли. API членства ASP.NET является расширяемой и включает хранилище учетных данных любой пароль для использования. ASP.NET поставляется с реализациями поставщика встроенные членства, в которых хранятся имени пользователя и пароля в базе данных SQL или в Active Directory.

Мы можем настроить какой поставщик членства, наше приложение NerdDinner следует использовать, при открытии файла «web.config» в корне проекта и найдя &lt;членства&gt; разделе внутри него. Регистрирует поставщика членства SQL web.config по умолчанию, при создании проекта и настраивает его, чтобы использовать строку подключения, с именем «ApplicationServices» для указания расположения базы данных.

Строка подключения «ApplicationServices» по умолчанию (которое указывается в &lt;connectionStrings&gt; раздел файла web.config) настроен на использование SQL Express. Он указывает на базу данных SQL Express с именем «ASPNETDB. MDF» приложения «приложение\_данных» каталог. Если эта база данных не существует в первый раз, когда приложение используется API членства, ASP.NET автоматически создать базу данных и подготовки схемы базы данных соответствующее членство в ней:

![](secure-applications-using-authentication-and-authorization/_static/image6.png)

Если вместо того чтобы использовать SQL Express, мы хотели бы полный экземпляр SQL Server (или подключения к удаленной базе данных), все, что нам потребуется дел — обновление строки подключения «ApplicationServices» в файле web.config и убедитесь, что схема соответствующее членство была добавлена в базу данных, которую он указывает на. Можно запустить «aspnet\_regsql.exe» программы в каталоге \Windows\Microsoft.NET\Framework\v2.0.50727\ для добавления соответствующей схемы для членства и другим службам приложения ASP.NET к базе данных.

### <a name="authorizing-the-dinnerscreate-url-using-the-authorize-filter"></a>Авторизация URL-адрес ужинов/Create, используя фильтр [Authorize]

Избавиться от необходимости писать код для включения безопасной проверки подлинности и учетная запись управления реализацию приложения NerdDinner. Пользователи могут регистрировать новые учетные записи с наши приложения и имя входа/выхода узла.

Теперь мы можно добавить логику авторизации в приложение и использовать состояние проверки подлинности и имя пользователя, количество посетителей для управления, что они могут делать, а на узле. Давайте начнем с добавления логики авторизации к методам действий нашего класса DinnersController «Создать». В частности, это будет требовать пользователей, обращающихся к */ужинов/Create* URL-адрес, необходимо выполнить вход. Если они не вошли в будете перенаправлены их на страницу входа, чтобы они выполняли вход.

Это реализация довольно проста. Нам нужно дел только добавить атрибут [Authorize] фильтр к методам действий наших создать следующим образом:

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample1.cs)]

ASP.NET MVC поддерживает возможность создания «фильтры действий», которые могут использоваться для реализации повторного использования логику, которая может быть декларативно применено к методам действий. Фильтр [Authorize] является одним из встроенных фильтров, предоставляемые платформой ASP.NET MVC, и он позволяет разработчику для декларативного применения правил авторизации для методов действий и классы контроллера.

При применении без параметров (как и выше) фильтр [Authorize] обеспечивает, что имя пользователя, отправившего запрос метода действия необходимо выполнить вход – и он будет автоматически перенаправлен браузер URL-адрес входа, если они не являются. При выполнении этого перенаправления, первоначально запрошенному URL-адрес передается в качестве аргументов строки запроса (например: / учетной записи и входа в систему? ReturnUrl = % 2fDinners % 2fCreate). AccountController затем перенаправляет пользователя обратно к исходному запрошенному URL-адрес после входа.

Фильтр [Authorize] Дополнительно поддерживает возможность задать свойство «Пользователи» или «Роли», которое может использоваться для требуют, что оба пользователя в и в список разрешенных пользователей или член роли безопасности, разрешенных. Например приведенный ниже код позволяет только два конкретных пользователей, «scottgu» и «billg», для доступа к URL-адрес ужинов/Create:

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample2.cs)]

Внедрение определенными именами пользователей внутри кода обычно довольно без поддержки хотя. Лучшим подходом является определение более высокого уровня «роли», код проверяет, а затем для сопоставления пользователей в роли с помощью базы данных или системы active directory (включая фактическое сопоставление список храниться извне из кода). В ASP.NET имеются встроенные роли управления API, а также набор встроенных поставщиков ролей (в том числе шаблоны для SQL и Active Directory), которые могут помочь выполнять сопоставление пользователя или роли. Затем мы может обновить код, чтобы только пользователи в роли конкретного «admin» для доступа к URL-адрес ужинов/Create:

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample3.cs)]

### <a name="using-the-useridentityname-property-when-creating-dinners"></a>С помощью свойства User.Identity.Name при создании ужинов

Мы можем извлечь имя пользователя, вошедшего в систему из запроса, используя свойство User.Identity.Name, предоставляемое в базовом классе контроллера.

Ранее при мы реализации HTTP-POST версию нашего метода действия Create() у нас было жестко свойство «HostedBy» ужин в статическую строку. Мы можете теперь обновить этот код, чтобы вместо этого используйте свойство User.Identity.Name, а также автоматически добавить Подтверждать для имени узла, создание компании Dinner:

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample4.cs)]

Так как мы добавили атрибут [Authorize] в методе Create(), ASP.NET MVC гарантирует, что метод действия выполняется только при посещении ужинов/Create URL-адрес входа пользователя сайт. Таким образом значение свойства User.Identity.Name всегда будет содержать допустимое имя пользователя.

### <a name="using-the-useridentityname-property-when-editing-dinners"></a>С помощью свойства User.Identity.Name при редактировании ужинов

Теперь добавим определенную логику авторизации, которая ограничивает пользователей таким образом, чтобы их можно только изменить свойства ужинов, которые сами по себе при размещении.

Чтобы упростить это, мы будем добавьте вспомогательный метод «IsHostedBy(username)» для нашей компании Dinner (в пределах Dinner.cs разделяемый класс, который мы создали ранее). Этот вспомогательный метод возвращает значение true или false в зависимости от ли введенное имя пользователя соответствует свойство HostedBy ужин и инкапсулирует логику, необходимую для выполнения сравнения строк без учета регистра из них:

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample5.cs)]

Затем добавим атрибут [Authorize] к методам действий Edit() в наш класс DinnersController. Это позволит гарантировать, что пользователь должен войти запрос */Dinners/Edit / [id]* URL-адрес.

Затем можно добавить код к нашей методов Edit, которые использует вспомогательный метод Dinner.IsHostedBy(username) убедиться, что вошедшего в систему пользователя соответствует узла компании Dinner. Если пользователь не является узел, мы отображение вида «InvalidOwner» и прервать запрос. Ниже кода, чтобы сделать это выглядит:

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample6.cs)]

Мы затем щелкните правой кнопкой мыши каталог \Views\Dinners и выберите Add -&gt;просмотреть команды меню, чтобы создать новое представление «InvalidOwner». Мы будем заполнить его с ниже сообщение об ошибке:

[!code-aspx[Main](secure-applications-using-authentication-and-authorization/samples/sample7.aspx)]

И теперь когда пользователь пытается изменить обед, которыми они не владеют, они получат сообщение об ошибке:

![](secure-applications-using-authentication-and-authorization/_static/image7.png)

Мы можно повторить те же действия для Delete() методы действий в рамках нашего контроллера для блокировки разрешений для удаления ужинов также и убедитесь, что его можно удалить только ведущий компании Dinner.

### <a name="showinghiding-edit-and-delete-links"></a>Изменить отображение/скрытие и удаление ссылки

Мы компоновка на изменение и удаление метод действия нашего класса DinnersController из наших сведения о URL-адреса.

![](secure-applications-using-authentication-and-authorization/_static/image8.png)

В настоящее время мы продемонстрируем изменение и удаление ссылки на действия независимо от того посетителя на сведения о URL-адрес узла ужин. Изменим его, чтобы ссылки отображаются только в том случае, если владелец компании dinner посетителя.

Метод действия Details() в наших DinnersController извлекает объект компании Dinner и затем передает его в качестве объекта модели к шаблону представления:

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample8.cs)]

Мы можем обновить представление шаблона условно Показать/скрыть изменение и удаление ссылок с помощью Dinner.IsHostedBy(), вспомогательный метод, например ниже:

[!code-aspx[Main](secure-applications-using-authentication-and-authorization/samples/sample9.aspx)]

#### <a name="next-steps"></a>Следующие шаги

Давайте теперь взглянем на как можно включить пользователям, прошедшим проверку RSVP для ужинов, с помощью AJAX.

> [!div class="step-by-step"]
> [Назад](implement-efficient-data-paging.md)
> [Вперед](use-ajax-to-deliver-dynamic-updates.md)
