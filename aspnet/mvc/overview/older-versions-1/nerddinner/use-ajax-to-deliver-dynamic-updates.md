---
uid: mvc/overview/older-versions-1/nerddinner/use-ajax-to-deliver-dynamic-updates
title: Использование AJAX для доставки динамических обновлений | Документация Майкрософт
author: microsoft
description: На шаге 10 реализована поддержка пользователей, вошедших в систему, в RSVP по интересу к Конференции на обед с использованием подхода на основе AJAX, интегрированного в сведения о обеде...
ms.author: riande
ms.date: 07/27/2010
ms.assetid: 18700815-8e6c-4489-91af-7ea9dab6529e
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/use-ajax-to-deliver-dynamic-updates
msc.type: authoredcontent
ms.openlocfilehash: 3edc02fec546609505b5e085440fa684abe7acd0
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78486312"
---
# <a name="use-ajax-to-deliver-dynamic-updates"></a>Использование AJAX для доставки динамических обновлений

по [Майкрософт](https://github.com/microsoft)

[Скачать в формате PDF](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> Это шаг 10 из бесплатного [учебника по приложению "NerdDinner"](introducing-the-nerddinner-tutorial.md) , в котором рассматривается создание небольшого, но полного веб-приложения с использованием ASP.NET MVC 1.
> 
> На шаге 10 реализована поддержка пользователей, вошедших в систему, в RSVP по интересу к Конференции на обед с использованием подхода на основе AJAX, интегрированного на странице сведений о обеде.
> 
> Если вы используете ASP.NET MVC 3, мы рекомендуем следовать руководствам по [Начало работы в MVC 3 или в приложении для](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) [музыкального магазина MVC](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) .

## <a name="nerddinner-step-10-ajax-enabling-rsvps-accepts"></a>NerdDinner шаг 10. принятие RSVP

Теперь мы реализуем поддержку пользователей, вошедших в систему, в службу RSVP по интересу к Конференции в обеде. Это можно сделать с помощью подхода на основе AJAX, интегрированного на странице сведений о обеде.

### <a name="indicating-whether-the-user-is-rsvpd"></a>Указывает, является ли пользователь RSVP

Пользователи могут посетить URL-адрес */диннерс/детаилс/[ID*], чтобы просмотреть сведения об определенном обеде:

![](use-ajax-to-deliver-dynamic-updates/_static/image1.png)

Метод действия Details () реализуется следующим образом:

[!code-csharp[Main](use-ajax-to-deliver-dynamic-updates/samples/sample1.cs)]

Первым шагом в реализации поддержки RSVP будет Добавление вспомогательного метода "Исусеррегистеред (username)" в наш объект Dinner (в рамках созданного ранее разделяемого класса Dinner.cs). Этот вспомогательный метод возвращает значение true или false в зависимости от того, является ли пользователь RSVP в настоящее время обедом:

[!code-csharp[Main](use-ajax-to-deliver-dynamic-updates/samples/sample2.cs)]

Затем можно добавить следующий код в шаблон представления Details. aspx, чтобы отобразить соответствующее сообщение, указывающее, зарегистрирован ли пользователь или нет для события:

[!code-html[Main](use-ajax-to-deliver-dynamic-updates/samples/sample3.html)]

И теперь, когда пользователь посещает обед, для которого зарегистрировано, он увидит следующее сообщение:

![](use-ajax-to-deliver-dynamic-updates/_static/image2.png)

И когда они посещают обед, они не зарегистрированы для них, они увидят следующее сообщение:

![](use-ajax-to-deliver-dynamic-updates/_static/image3.png)

### <a name="implementing-the-register-action-method"></a>Реализация метода действия Register

Теперь добавим функции, необходимые для предоставления пользователям RSVP на обед со страницы сведений.

Чтобы реализовать это, мы создадим новый класс "Рсвпконтроллер", щелкнув правой кнопкой мыши каталог \Controllers и выбрав команду меню Добавить контроллер&gt;.

Мы реализуем метод действия Register (зарегистрировать) в новом классе Рсвпконтроллер, который принимает идентификатор для компании в качестве аргумента, извлекает соответствующий объект Dinner, проверяет, находится ли вошедший в систему пользователь в списке зарегистрированных для него пользователей, а также если не добавляет для них объект RSVP:

[!code-csharp[Main](use-ajax-to-deliver-dynamic-updates/samples/sample4.cs)]

Обратите внимание, что мы возвращаем простую строку в качестве выходных данных метода действия. Мы могли бы внедрить это сообщение в шаблон представления, но так как это так мало, мы просто используем вспомогательный метод Content () в базовом классе контроллера и возвращаем строковое сообщение, подобное приведенному выше.

### <a name="calling-the-rsvpforevent-action-method-using-ajax"></a>Вызов метода действия Рсвпфоревент с помощью AJAX

Мы будем использовать AJAX для вызова метода действия Register из нашего подробного представления. Реализовать это довольно просто. Сначала мы добавим две ссылки на библиотеку скриптов:

[!code-html[Main](use-ajax-to-deliver-dynamic-updates/samples/sample5.html)]

Первая библиотека ссылается на основную библиотеку сценариев ASP.NET AJAX на стороне клиента. Этот файл приблизительно 24k в размере (сжатый) и содержит основные функциональные возможности AJAX на стороне клиента. Вторая библиотека содержит служебные функции, которые интегрируются с встроенными вспомогательными методами AJAX ASP.NET MVC (которые мы будем использовать вскоре).

Затем можно обновить код шаблона представления, который мы добавили ранее, чтобы вместо вывода сообщения "вы не зарегистрировались для этого события" мы отпустим ссылку, которая при отправке выполняет вызов AJAX, который вызывает наш метод действия Рсвпфоревент на нашем контроллере RSVP. и RSVP:

[!code-aspx[Main](use-ajax-to-deliver-dynamic-updates/samples/sample6.aspx)]

Использованный выше вспомогательный метод Ajax. ActionLink () встроен в ASP.NET MVC и похож на вспомогательный метод HTML. ActionLink (), за исключением того, что вместо выполнения стандартной навигации он выполняет вызов AJAX к методу действия при щелчке ссылки. Выше мы вызываем метод действия Register на контроллере RSVP и передаем Диннерид в качестве параметра ID. Окончательный параметр Ажаксоптионс, который мы передаем, указывает, что мы хотим взять содержимое, возвращенное из метода действия, и обновить HTML &lt;div&gt; на странице, идентификатор которой — "рсвпмсг".

Теперь, когда пользователь переходит на обед, который не зарегистрирован для, он увидит ссылку на RSVP для него:

![](use-ajax-to-deliver-dynamic-updates/_static/image4.png)

Если щелкнуть ссылку "RSVP для этого события", он сделает вызов AJAX методу действия Register на контроллере RSVP, а после завершения он увидит обновленное сообщение, как показано ниже:

![](use-ajax-to-deliver-dynamic-updates/_static/image5.png)

Пропускная способность сети и трафик, задействованные при выполнении этого вызова AJAX, действительно являются легковесными. Когда пользователь щелкает ссылку "RSVP для этого события", к URL-адресу */Dinners/Register/1* , который выглядит следующим образом в сети, выполняется небольшой запрос HTTP POST.

[!code-console[Main](use-ajax-to-deliver-dynamic-updates/samples/sample7.cmd)]

Ответ метода действия Register — это просто:

[!code-console[Main](use-ajax-to-deliver-dynamic-updates/samples/sample8.cmd)]

Этот упрощенный вызов работает быстро и будет работать даже через медленную сеть.

### <a name="adding-a-jquery-animation"></a>Добавление анимации jQuery

Реализованная функциональность AJAX работает хорошо и быстро. Иногда это может произойти быстро, но пользователь может не заметить, что ссылка RSVP заменена новым текстом. Чтобы сделать результат чуть более очевидным, мы можем добавить простую анимацию, чтобы привлечь внимание к сообщению об обновлении.

Шаблон проекта MVC по умолчанию ASP.NET включает jQuery — отличную (и очень популярную) библиотеку JavaScript с открытым исходным кодом, которая также поддерживается корпорацией Майкрософт. jQuery предоставляет ряд функций, включая удобную библиотеку выбора и эффектов HTML DOM.

Чтобы использовать jQuery, сначала добавьте ссылку на скрипт. Так как мы будем использовать jQuery в различных местах сайта, мы добавим ссылку на скрипт в файле главной основной страницы Site. master, чтобы все страницы могли его использовать.

[!code-html[Main](use-ajax-to-deliver-dynamic-updates/samples/sample9.html)]

*Совет. Убедитесь, что установлено исправление JavaScript IntelliSense для VS 2008 с пакетом обновления 1 (SP1), которое обеспечивает расширенную поддержку IntelliSense для файлов JavaScript (включая jQuery). Его можно загрузить с: http://tinyurl.com/vs2008javascripthotfix*

Код, написанный с помощью JQuery, часто использует глобальный метод JavaScript "$ ()", который получает один или несколько HTML-элементов с помощью селектора CSS. Например, *$ ("#rsvpmsg")* выбирает любой HTML-элемент с идентификатором рсвпмсг, а *$ (". что")* выберет все элементы с именем класса CSS "что". Кроме того, можно написать более сложные запросы, например "вернуть все отмеченные переключатели", используя запрос Selector, например: *$ ("input [@type= Radio] [@checked]")* .

После выбора элементов можно вызывать методы для них, чтобы предпринять действия, такие как скрытие: *$ ("#rsvpmsg"). Hide ();*

Для нашего сценария RSVP мы определим простую функцию JavaScript с именем «Аниматерсвпмессаже», которая выбирает «рсвпмсг» &lt;div&gt; и анимируется размер текстового содержимого. Приведенный ниже код запускает маленький текст, а затем приводит к увеличению времени в течение 400 миллисекунд:

[!code-html[Main](use-ajax-to-deliver-dynamic-updates/samples/sample10.html)]

После успешного завершения вызова AJAX можно подключить эту функцию JavaScript, передав ее имя в вспомогательный метод Ajax. ActionLink () (через свойство события Ажаксоптионс "onsuccesss"):

[!code-aspx[Main](use-ajax-to-deliver-dynamic-updates/samples/sample11.aspx)]

Теперь, когда вы щелкнули ссылку "RSVP для этого события" и вызов AJAX завершается успешно, переданное сообщение о содержимом будет анимироваться и увеличиваться:

![](use-ajax-to-deliver-dynamic-updates/_static/image6.png)

Кроме предоставления события "onsuccesss", объект Ажаксоптионс предоставляет события onSuccess, onsuccesss и onSuccess, которые можно обменять (вместе с различными другими свойствами и полезными параметрами).

### <a name="cleanup---refactor-out-a-rsvp-partial-view"></a>Очистка — рефакторинг частичного представления RSVP

Наш шаблон подробного представления начинается очень долго, что сверхурочно сделает его более трудным для понимания. Чтобы помочь улучшить удобочитаемость кода, давайте создадим частичное представление — Рсвпстатус. ascx, которое инкапсулирует весь код представления RSVP для нашей страницы сведений.

Это можно сделать, щелкнув правой кнопкой мыши папку \Виевс\диннерс и выбрав команду меню Добавить-&gt;представление. Мы будем брать объект обеда в качестве строго типизированного ViewModel. Затем можно скопировать и вставить в него содержимое RSVP из нашего представления Details. aspx.

После этого давайте также создадим другое частичное представление — Едитандделетелинкс. ascx, которое инкапсулирует наш код представления ссылок Edit и DELETE. Кроме того, мы будем брать объект ужина в качестве строго типизированного ViewModel, а затем копировать и вставлять в него логику "изменить и удалить" из представления Details. aspx.

Теперь наш шаблон подробного представления может включать два вызова метода HTML. Рендерпартиал () в нижней части:

[!code-aspx[Main](use-ajax-to-deliver-dynamic-updates/samples/sample12.aspx)]

Это делает средство очистки кода недоступным для чтения и сопровождения.

### <a name="next-step"></a>Следующий шаг

Теперь рассмотрим, как можно использовать AJAX еще дальше и добавить в наше приложение поддержку интерактивного сопоставления.

> [!div class="step-by-step"]
> [Назад](secure-applications-using-authentication-and-authorization.md)
> [Вперед](use-ajax-to-implement-mapping-scenarios.md)
