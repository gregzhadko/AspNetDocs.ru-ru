---
uid: mvc/overview/older-versions-1/nerddinner/use-ajax-to-deliver-dynamic-updates
title: Используйте AJAX для предоставления динамических обновлений (ru) Документы Майкрософт
author: rick-anderson
description: Шаг 10 реализует поддержку для зарегистрированных пользователей RSVP их интерес к посещению ужина, используя Ajax основе подхода, интегрированного в деталях ужина ...
ms.author: riande
ms.date: 07/27/2010
ms.assetid: 18700815-8e6c-4489-91af-7ea9dab6529e
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/use-ajax-to-deliver-dynamic-updates
msc.type: authoredcontent
ms.openlocfilehash: 13680b91edc665852fd4af56e4fc79551e6de15e
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2020
ms.locfileid: "81541251"
---
# <a name="use-ajax-to-deliver-dynamic-updates"></a>Использование AJAX для доставки динамических обновлений

[корпорацией Майкрософт](https://github.com/microsoft)

[Скачать PDF](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> Это шаг 10 бесплатно ["NerdDinner" приложение учебник,](introducing-the-nerddinner-tutorial.md) который ходит через как построить небольшой, но полный, веб-приложение с помощью ASP.NET MVC 1.
> 
> Шаг 10 реализует поддержку для зарегистрированных пользователей RSVP их интерес к посещению ужина, используя Ajax основе подхода, интегрированного в странице детали ужина.
> 
> Если вы используете ASP.NET MVC 3, мы рекомендуем вам следовать [начиная с MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) или [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) учебники.

## <a name="nerddinner-step-10-ajax-enabling-rsvps-accepts"></a>NerdDinner Шаг 10: AJAX Включение RSVPs принимает

Теперь давайте реализуем поддержку для зарегистрированных пользователей RSVP их интерес к посещению ужина. Мы включим это с помощью подхода, основанного на AJAX, интегрированном на странице деталей ужина.

### <a name="indicating-whether-the-user-is-rsvpd"></a>Указание того, является ли пользователь RSVP'd

Пользователи могут посетить */Ужины / Подробная информация /* URL-адрес, чтобы увидеть подробную информацию о конкретном ужине:

![](use-ajax-to-deliver-dynamic-updates/_static/image1.png)

Метод действия «Подробности() реализован так:

[!code-csharp[Main](use-ajax-to-deliver-dynamic-updates/samples/sample1.cs)]

Наш первый шаг к реализации поддержки RSVP будет добавить "IsUserRegistered (имя пользователя) " вспомогательный метод для нашего объекта ужин (в пределах Dinner.cs частичного класса мы построили ранее). Этот метод помощника возвращает сярвые или ложные в зависимости от того, является ли пользователь в настоящее время RSVP'd для ужина:

[!code-csharp[Main](use-ajax-to-deliver-dynamic-updates/samples/sample2.cs)]

Затем мы можем добавить следующий код в наш шаблон представления Details.aspx для отображения соответствующего сообщения с указанием того, зарегистрирован пользователь или нет для события:

[!code-html[Main](use-ajax-to-deliver-dynamic-updates/samples/sample3.html)]

И теперь, когда пользователь посещает ужин они зарегистрированы они будут видеть это сообщение:

![](use-ajax-to-deliver-dynamic-updates/_static/image2.png)

И когда они посещают ужин они не зарегистрированы, потому что они увидят ниже сообщение:

![](use-ajax-to-deliver-dynamic-updates/_static/image3.png)

### <a name="implementing-the-register-action-method"></a>Внедрение метода действий в регистрах

Теперь давайте добавим функциональность, необходимую для того, чтобы пользователи могли включить RSVP на ужин со страницы деталей.

Для реализации этого мы создадим новый класс "RSVPController", нажав на каталог&gt;"Контролеры" и выбрав команду меню Add- Controller.

Мы реализуем метод действий «Регистрация» в новом классе RSVPController, который принимает идентификатор для ужина в качестве аргумента, извлекаем соответствующий объект Ужина, проверяем, находится ли в настоящее время в списке пользователей, зарегистрировавшихся для него, и если не добавляет для него объект RSVP:

[!code-csharp[Main](use-ajax-to-deliver-dynamic-updates/samples/sample4.cs)]

Обратите внимание выше, как мы возвращаем простую строку в качестве вывода метода действия. Мы могли бы встроить это сообщение в шаблон представления, но так как оно настолько мало, мы просто используем метод помощника Content () на базовом классе контроллера и вернем строку сообщение, как выше.

### <a name="calling-the-rsvpforevent-action-method-using-ajax"></a>Вызов метода действий RSVPForEvent с помощью AJAX

Мы будем использовать AJAX для использования метода действий Регистра из нашего представления «Подробности». Реализация этого довольно проста. Сначала мы добавим две ссылки на библиотеку сценариев:

[!code-html[Main](use-ajax-to-deliver-dynamic-updates/samples/sample5.html)]

Первая библиотека ссылается на ядро ASP.NET библиотеке сценариев клиентов AJAX. Этот файл приблизительно 24k в размере (сжатого) и содержит основные клиент-стороны AJAX функциональность. Вторая библиотека содержит функции утилиты, которые интегрируются со встроенными методами помощи ASP.NET MVC (которые мы будем использовать в ближайшее время).

Затем мы можем обновить код шаблона представления, который мы добавили ранее, чтобы вместо ввода сообщения "Вы не зарегистрированы для этого события", мы вместо этого отображаем ссылку, которая при нажатии выполняет вызов AJAX, который вызывает наш метод действий RSVPForEvent на нашем контроллере RSVP и RSVPs пользователя:

[!code-aspx[Main](use-ajax-to-deliver-dynamic-updates/samples/sample6.aspx)]

Метод помощника Ajax.ActionLink() используется выше, является встроенным ASP.NET MVC и похож на метод помощника Html.ActionLink() за исключением того, что вместо выполнения стандартной навигации он делает звонок AJAX к методу действия при нажатии ссылки. Выше мы называем "Регистрация" метод действия на контроллере "RSVP" и передачи DinnerID как "id" параметр к нему. Окончательный параметр AjaxOptions, который мы перебираем, указывает на то, &lt;&gt; что мы хотим взять содержимое, возвращенное из метода действия, и обновить элемент HTML div на странице, идентификатор которой является "rsvpmsg".

И теперь, когда пользователь просматривает на обед они не зарегистрированы еще они увидят ссылку на RSVP для него:

![](use-ajax-to-deliver-dynamic-updates/_static/image4.png)

Если они нажимают на ссылку "RSVP для этого события", они вызовут AJAX методдействия Регистра на контроллере RSVP, и когда он завершится, они увидят обновленное сообщение, как ниже:

![](use-ajax-to-deliver-dynamic-updates/_static/image5.png)

Пропускная способность сети и трафик, участвующих при принятии этого вызова AJAX действительно легкий. Когда пользователь нажимает на ссылку "RSVP для этого события", небольшой запрос сети HTTP POST на */Dinners/Register/1* URL, который выглядит ниже на проводе:

[!code-console[Main](use-ajax-to-deliver-dynamic-updates/samples/sample7.cmd)]

И ответ от нашего метода действий Регистра просто:

[!code-console[Main](use-ajax-to-deliver-dynamic-updates/samples/sample8.cmd)]

Этот легкий вызов быстро и будет работать даже над медленной сети.

### <a name="adding-a-jquery-animation"></a>Добавление анимации j'ери

Функциональность AJAX, которая мы реализовали, работает хорошо и быстро. Иногда это может произойти так быстро, однако, что пользователь может не заметить, что ссылка RSVP была заменена новым текстом. Чтобы сделать результат немного более очевидным, мы можем добавить простую анимацию, чтобы привлечь внимание к сообщению об обновлении.

Шаблон проекта MVC ASP.NET по умолчанию включает в себя j'ery – отличную (и очень популярную) библиотеку JavaScript с открытым исходным кодом, которая также поддерживается корпорацией Майкрософт. j's'еry предоставляет ряд функций, в том числе хороший HTML DOM выбор и эффекты библиотеки.

Для использования j'we'ry мы сначала добавим ссылку на сценарий к нему. Поскольку мы будем использовать j'ery в различных местах на нашем сайте, мы добавим ссылку на сценарий в нашем файле Master Master master page, чтобы все страницы могли использовать его.

[!code-html[Main](use-ajax-to-deliver-dynamic-updates/samples/sample9.html)]

*Совет: убедитесь, что вы установили JavaScript intellisense hotfix для VS 2008 SP1, который позволяет более богатую поддержку интеллекта для файлов JavaScript (в том числе j'ery). Вы можете скачать его из:http://tinyurl.com/vs2008javascripthotfix*

Код, написанный с помощью J'ery, часто использует глобальный метод JavaScript «$.)», который извлекает один или несколько HTML элементов с помощью селектора CSS. Например, *$("#rsvpmsg")* выбирает любой html элемент с идом rsvpmsg, в то время как *$("something")* будет выбирать все элементы с "что-то" имя класса CSS. Вы также можете написать более продвинутые запросы, такие как "вернуть все проверенные радиокнопки" с помощью запроса селектора, как: *$("вход"@type(радио)@checked*.

После того как вы выбрали элементы, вы можете вызвать методы на них принять меры, как их сокрытие: *$("#rsvpmsg") скрыть();;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;*

Для нашего сценария RSVP мы определим простую функцию JavaScript под названием "AnimateRSVPMessage", которая выбирает div "rsvpmsg" &lt;&gt; и оживляет размер его текстового содержимого. Ниже код запускает текст небольшой, а затем вызывает его увеличение в течение 400 миллисекунд таймфрейм:

[!code-html[Main](use-ajax-to-deliver-dynamic-updates/samples/sample10.html)]

Затем мы можем просунуть эту функцию JavaScript, которая будет вызвана после того, как наш вызов AJAX успешно завершается, передав свое имя нашему методу помощника Ajax.ActionLink() (через свойство события AjaxOptions "OnSuccess"):

[!code-aspx[Main](use-ajax-to-deliver-dynamic-updates/samples/sample11.aspx)]

И теперь, когда "RSVP для этого события" ссылка нажата и наш вызов AJAX завершаетуспешно, содержание сообщения, отправленного обратно будет анимировать и расти большой:

![](use-ajax-to-deliver-dynamic-updates/_static/image6.png)

Помимо предоставления события «OnSuccess», объект AjaxOptions предоставляет события OnBegin, OnFailure и OnComplete, которые можно обрабатывать (наряду с множеством других свойств и полезных опций).

### <a name="cleanup---refactor-out-a-rsvp-partial-view"></a>Очистка - Рефактор из RSVP Частичное представление

Наш шаблон представления деталей начинает получать немного долго, что сверхурочно сделает его немного сложнее понять. Чтобы улучшить читаемость кода, давайте закончим, создав частичное представление - RSVPStatus.ascx - который инкапсулирует весь код представления RSVP для нашей страницы детали.

Мы можем сделать это, нажав правой кнопкой мыши на&gt;папке «Виды» (Просмотры) и выбрать команду меню Add- View. Мы будем иметь его принять Ужин объект, как его сильно типом ViewModel. Затем мы можем скопировать/ вставить содержимое RSVP из нашего просмотра Details.aspx в него.

После того как мы сделали это, давайте также создать еще один частичный вид - EditAndDeleteLinks.ascx - что инкапсулирует наш код представления ссылки и отсечения. Мы также будем иметь его принять ужин объект, как его сильно типизированных ViewModel, и копировать / вставить логику edit и удалить из нашего Просмотра Details.aspx в него.

Наш шаблон представления деталей может включать в себя только два вызова html.RenderPartial() метода внизу:

[!code-aspx[Main](use-ajax-to-deliver-dynamic-updates/samples/sample12.aspx)]

Это делает код чище для чтения и обслуживания.

### <a name="next-step"></a>Следующий шаг

Давайте теперь рассмотрим, как мы можем использовать AJAX еще дальше и добавить интерактивную поддержку отображения в наше приложение.

> [!div class="step-by-step"]
> [Назад](secure-applications-using-authentication-and-authorization.md)
> [Вперед](use-ajax-to-implement-mapping-scenarios.md)
