---
uid: mvc/overview/older-versions-1/nerddinner/use-ajax-to-deliver-dynamic-updates
title: Использование AJAX для доставки динамических обновлений | Документация Майкрософт
author: microsoft
description: Шаг 10 реализует поддержку вошедшего в систему пользователям RSVP их интерес к конференции обед, с помощью подхода на основе Ajax, интегрируются в подробные сведения о компании dinner...
ms.author: riande
ms.date: 07/27/2010
ms.assetid: 18700815-8e6c-4489-91af-7ea9dab6529e
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/use-ajax-to-deliver-dynamic-updates
msc.type: authoredcontent
ms.openlocfilehash: e902881d3dab6a902cb747a197a32f317d199723
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/01/2019
ms.locfileid: "57025991"
---
<a name="use-ajax-to-deliver-dynamic-updates"></a>Использование AJAX для доставки динамических обновлений
====================
по [Microsoft](https://github.com/microsoft)

[Загрузить PDF-файл](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> Это шаг 10 процедуры бесплатной [руководство по использованию приложения «NerdDinner»](introducing-the-nerddinner-tutorial.md) , пошаговое рассмотрение как создать небольшой, но завершить, веб-приложения с помощью ASP.NET MVC 1.
> 
> Шаг 10 реализует поддержку вошедшего в систему пользователям RSVP их интерес к конференции обед, с помощью подхода на основе Ajax, интегрируются в странице сведений о компании dinner.
> 
> Если вы используете ASP.NET MVC 3, рекомендуется следовать [Приступая к работе с MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) или [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) учебники.


## <a name="nerddinner-step-10-ajax-enabling-rsvps-accepts"></a>NerdDinner Step 10: Принимает AJAX Включение ответов на приглашение

Давайте теперь реализация поддержки для вошедшего в систему пользователям RSVP их интерес к конференции ужин. Мы расширим это с помощью интегрируются в странице сведений о компании dinner подхода на основе AJAX.

### <a name="indicating-whether-the-user-is-rsvpd"></a>Указывающее, является ли RSVP'd пользователя

Пользователи смогут посещать */Dinners/сведения / [идентификатор*] URL-адрес, чтобы просмотреть сведения о примерную стоимость:

![](use-ajax-to-deliver-dynamic-updates/_static/image1.png)

Details(), метод действия реализуется следующим образом:

[!code-csharp[Main](use-ajax-to-deliver-dynamic-updates/samples/sample1.cs)]

Нашим первым этапом для реализации поддержки RSVP будет добавьте вспомогательный метод «IsUserRegistered(username)» для нашей компании Dinner (в пределах Dinner.cs разделяемый класс, который мы создали ранее). Этот вспомогательный метод возвращает значение true или false в зависимости от того, является ли пользователь в настоящее время RSVP'd для компании Dinner:

[!code-csharp[Main](use-ajax-to-deliver-dynamic-updates/samples/sample2.cs)]

Затем мы добавляем следующий код к шаблону представление Details.aspx для отображения соответствующее сообщение, указывающее, зарегистрирован ли пользователь или не для события:

[!code-html[Main](use-ajax-to-deliver-dynamic-updates/samples/sample3.html)]

И теперь при посещении обед, они зарегистрированы для появится это сообщение:

![](use-ajax-to-deliver-dynamic-updates/_static/image2.png)

И при посещении обед, они не зарегистрированы для он увидит следующее сообщение:

![](use-ajax-to-deliver-dynamic-updates/_static/image3.png)

### <a name="implementing-the-register-action-method"></a>Реализация метода Register действия

Теперь добавим функциональные возможности, необходимые, чтобы пользователи RSVP на обед на странице сведений.

Чтобы реализовать это, мы создадим новый класс «RSVPController», щелкнув правой кнопкой мыши каталог \Controllers и выбрав Add -&gt;контроллера меню команды.

Мы реализуем метод действие «Зарегистрировать» в новый класс RSVPController, который принимает идентификатор на ужин в качестве аргумента, извлекает соответствующий объект Dinner, проверяет, вошедшего в систему пользователя находится в списке пользователей, зарегистрированных для него, если не добавляет объект RSVP для них:

[!code-csharp[Main](use-ajax-to-deliver-dynamic-updates/samples/sample4.cs)]

Обратите внимание, как мы возвращается простая строка как выходные данные метода действия. Мы удалось встроенным это сообщение в шаблоне представления —, но так как это настолько малы, просто используем вспомогательный метод Content() на базовый класс контроллера и возвращают строковое сообщение, например выше.

### <a name="calling-the-rsvpforevent-action-method-using-ajax"></a>Вызов метода RSVPForEvent действия, с помощью AJAX

Мы будем использовать AJAX для вызова метода действия Register из нашего представления сведений. Такая реализация довольно проста. Сначала мы добавим две ссылки на библиотеку скрипта:

[!code-html[Main](use-ajax-to-deliver-dynamic-updates/samples/sample5.html)]

Первая библиотека ссылается на основной библиотеки клиентского скрипта ASP.NET AJAX. Этот файл составляет приблизительно 24 КБ в размере (со сжатием) и содержит основные функциональные возможности AJAX на стороне клиента. Второй библиотеки содержит служебные функции, которые интегрируются с ASP.NET MVC встроенные AJAX вспомогательные методы (которые мы будем использовать чуть позже).

Мы можем затем обновление код шаблона представления, реализованной ранее, чтобы вместо выводе сообщение «Вы не зарегистрированы для данного события», мы вместо визуализации ссылки, при отправке выполняет вызов AJAX, вызывает метод действия наших RSVPForEvent в нашем контроллере RSVP и RSVPs пользователя:

[!code-aspx[Main](use-ajax-to-deliver-dynamic-updates/samples/sample6.aspx)]

Вспомогательный метод Ajax.ActionLink() выше встроенных в ASP.NET MVC так же и вспомогательного метода Html.ActionLink() за исключением того, что вместо выполнения стандартный навигационный он осуществляет вызов AJAX на метод действия, при щелчке ссылки. Выше мы вызовом метода действия «Зарегистрировать» на контроллере «RSVP» и передавая DinnerID как параметр «id», к нему. Последний параметр AjaxOptions, мы передаем указывает, что мы хотим получить содержимое, возвращаемое из метода действия и обновите HTML &lt;div&gt; элемента на странице, идентификатор которого — «rsvpmsg».

И теперь когда пользователь переходит на обед они не зарегистрированы для, но он увидит ссылку RSVP для него:

![](use-ajax-to-deliver-dynamic-updates/_static/image4.png)

При переходе по ссылке «RSVP для этого события», они должны быть вызов AJAX на метод действия регистрации на контроллере RSVP, и после ее завершения, он увидит сообщение об обновленных следующее:

![](use-ajax-to-deliver-dynamic-updates/_static/image5.png)

Пропускная способность сети и трафика, задействованные при этом вызов AJAX действительно невелико. Выполняется при нажатии на ссылку «RSVP для этого события», небольшой сетевой запрос HTTP POST для */Dinners/Register/1* URL-адрес, который выглядит как ниже по сети:

[!code-console[Main](use-ajax-to-deliver-dynamic-updates/samples/sample7.cmd)]

И ответ от нашего метода Register действие — это просто:

[!code-console[Main](use-ajax-to-deliver-dynamic-updates/samples/sample8.cmd)]

Этот упрощенный вызов выполняется быстро и будет работать даже по медленной сети.

### <a name="adding-a-jquery-animation"></a>Добавление анимации jQuery

Функциональные возможности AJAX, которые мы реализовали работает правильно и быстро. Иногда это может случиться так быстро, что пользователь не заметить, что ссылка RSVP был заменен новым текстом. Чтобы сделать результат немного очевиднее, мы можем добавить простой анимации для привлечения внимания к сообщению обновления.

По умолчанию шаблон проекта ASP.NET MVC включает в себя jQuery – это библиотека JavaScript высокими показателями (и очень популярным) открытым кодом, который также поддерживается корпорацией Майкрософт. jQuery предоставляет ряд функций, включая выделение и эффекты библиотека HTML DOM неплохо.

Для использования jQuery сначала добавим ссылку сценария на него. Так как мы собираемся использовать jQuery в различных местах в наш сайт, мы добавим ссылку на сценарий в наш файл Site.master главной страницы, чтобы все страницы можно использовать.

[!code-html[Main](use-ajax-to-deliver-dynamic-updates/samples/sample9.html)]

*Совет: Убедитесь, что вы установили исправление JavaScript intellisense для VS 2008 SP1, позволяющий более обширная поддержка intellisense файлы JavaScript (включая jQuery). Его можно загрузить из: http://tinyurl.com/vs2008javascripthotfix*

Код, написанный с помощью JQuery, часто использует глобальный «$ ()» метод JavaScript, который получает один или несколько элементов HTML, с помощью селектора CSS. Например <em>$("#rsvpmsg")</em> выбирает любой HTML-элемент с идентификатором rsvpmsg, хотя <em>$(".something")</em> следует выбрать все элементы с «что-то» CSS имя класса. Можно также написать более сложные запросы, как «return все кнопки установлен переключатель» с помощью селектора запроса как: <em>$("входные данные [@type= radio] [@checked]")</em>.

После выбора элементов, можно вызывать методы на возможность выполнения действий, таких как скрытие их: *$("#rsvpmsg").hide();*

В нашем сценарии RSVP мы определим простой функции JavaScript с именем «AnimateRSVPMessage», который выбирает «rsvpmsg» &lt;div&gt; и анимируется размер его текстовое содержимое. Ниже кода запускает небольшой текст, а затем вызывает его, чтобы увеличить за период времени, 400 миллисекунд:

[!code-html[Main](use-ajax-to-deliver-dynamic-updates/samples/sample10.html)]

Мы можно затем проводной доступ к этой функции JavaScript, вызываемый после успешного выполнения наш вызов AJAX, передав ее имя на наших Ajax.ActionLink() вспомогательный метод (с помощью AjaxOptions «OnSuccess» свойства события):

[!code-aspx[Main](use-ajax-to-deliver-dynamic-updates/samples/sample11.aspx)]

А теперь нажатии ссылки «RSVP для этого события» и наш вызов AJAX успешном завершении, содержимого сообщения, отправленного назад будет анимация и увеличению:

![](use-ajax-to-deliver-dynamic-updates/_static/image6.png)

Помимо «OnSuccess» событие, объект AjaxOptions предоставляет методы OnBegin OnFailure и OnComplete события, которые можно обработать (а также ряд других свойств и полезные параметры).

### <a name="cleanup---refactor-out-a-rsvp-partial-view"></a>Очистка — рефакторинг out RSVP частичного представления

Наши шаблона представления сведений о начинает получить немного long, какие сверхурочные поможет вам чуть сложнее для понимания. Чтобы улучшить читаемость кода, давайте закончить путем создания частичное представление — RSVPStatus.ascx —, инкапсулировать весь код RSVP представление страницы сведений.

Это можно сделать, щелкнув правой кнопкой мыши на папку \Views\Dinners и выбрав Add -&gt;просмотреть команду меню. У нас будет их в качестве его модель представления, строго типизированный объект ужин. Мы можно затем скопируйте и вставьте содержимое RSVP из нашего представления Details.aspx в него.

Как только мы этого также создадим другой частичное представление — EditAndDeleteLinks.ascx - инкапсулируемого наш код представления ссылку Edit и Delete. Кроме того, состоится принимать в качестве его модель представления, строго типизированный объект Dinner, а также копирования и вставки из нашего представления Details.aspx в него логику изменение и удаление.

Подробную информацию просмотреть шаблоны, а затем просто включают два вызова метода Html.RenderPartial() внизу:

[!code-aspx[Main](use-ajax-to-deliver-dynamic-updates/samples/sample12.aspx)]

Это делает код чище, чтение и обслуживание.

### <a name="next-step"></a>Следующий шаг

Давайте теперь взглянем на как можно использовать AJAX еще дальше и добавить поддержку интерактивных топографических к нашему приложению.

> [!div class="step-by-step"]
> [Назад](secure-applications-using-authentication-and-authorization.md)
> [Вперед](use-ajax-to-implement-mapping-scenarios.md)
