---
uid: mvc/overview/older-versions-1/controllers-and-routing/improving-performance-with-output-caching-vb
title: Повышение производительности с помощью выходных данных кэширования (Visual Basic) | Документация Майкрософт
author: microsoft
description: В этом руководстве вы узнаете, как можно значительно повысить производительность веб-приложений ASP.NET MVC, используя преимущества кэширования выходных данных. Вы...
ms.author: riande
ms.date: 01/27/2009
ms.assetid: 0e7b4d85-2c46-4eaf-b6a8-6cd566a67334
msc.legacyurl: /mvc/overview/older-versions-1/controllers-and-routing/improving-performance-with-output-caching-vb
msc.type: authoredcontent
ms.openlocfilehash: 9402d7e053ef11eeefa92d112b05ec255d5ec6f7
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/01/2019
ms.locfileid: "57033671"
---
<a name="improving-performance-with-output-caching-vb"></a>Повышение производительности благодаря кэшированию вывода (VB)
====================
по [Microsoft](https://github.com/microsoft)

> В этом руководстве вы узнаете, как можно значительно повысить производительность веб-приложений ASP.NET MVC, используя преимущества кэширования выходных данных. Вы узнаете, как кэшировать результат, возвращенный из действия контроллера, таким образом, чтобы то же содержимое не должны создаваться каждый раз, новый пользователь вызывает действие.


Этот учебник призван объяснить, как можно значительно повысить производительность приложения ASP.NET MVC, используя преимущества кэша вывода. Кэш вывода позволяет кэшировать содержимое, возвращаемое в результате действия контроллера. Таким образом, то же содержимое не создаваться время каждого вызова те же действия контроллера.

К примеру, представьте себе, что приложения ASP.NET MVC список записей базы данных в представление с именем индекса. Как правило, каждый раз, пользователь вызывает действие контроллера, которое возвращает представление Index, набор записей базы данных должен быть получен из базы данных, выполнив запрос к базе данных.

Если, с другой стороны, можно воспользоваться преимуществами кэша вывода можно избежать, выполнив запрос к базе данных каждый раз, чтобы любой пользователь, вызывающий действие контроллера. Представление можно получить из кэша, а не к повторному созданию из действия контроллера. Кэширование позволяет вам запрещено выполнять избыточное работать на сервере.

#### <a name="enabling-output-caching"></a>Включение кэширования вывода

Кэширование выходных данных, добавив &lt;OutputCache&gt; атрибут действию отдельного контроллера или класс контроллера целиком. Например контроллер в листинге 1 предоставляет действие с именем Index(). Выходные данные действия Index() кэшируется на 10 секунд.

**В листинге 1 — Controllers\HomeController.vb**

[!code-vb[Main](improving-performance-with-output-caching-vb/samples/sample1.vb)]


В бета-версии ASP.NET MVC, кэширование вывода не работает для URL-адресу вида [ http://www.MySite.com/ ](http://www.mysite.com/). Вместо этого необходимо ввести URL-адресу вида [ http://www.MySite.com/Home/Index ](http://www.mysite.com/Home/Index).


В листинге 1 выходные данные действия Index() кэшируется на 10 секунд. При желании можно указать длительность кэширования гораздо больше времени. Например, если вы хотите кэшировать выходные данные действия контроллера за один день затем можно указать длительность кэширования 86 400 секунд (60 секунд \* 60 минут \* 24 часа).

Нет никакой гарантии, что содержимое будет кэшироваться на указанное время. Если ресурсов памяти стать недостаточным, кэш автоматически запускается исключении содержимого.

Контроллер Home в листинге 1 возвращает представление Index в листинге 2. Нет ничего особенного в этом представлении. Представление Index просто отображает текущее время (см. рис. 1).

**В листинге 2 — Views\Home\Index.aspx**

[!code-aspx[Main](improving-performance-with-output-caching-vb/samples/sample2.aspx)]

**Рис. 1 – представление Cached Index**

![clip_image002](improving-performance-with-output-caching-vb/_static/image1.jpg)

Если вы выполняете команду Index() действие несколько раз, введя URL-адрес/Home/Index в адресной строке браузера и нажатии кнопки обновления и перезагрузки в браузере, несколько раз, а также отображается в представлении индекса не изменится на 10 секунд. То же время отображается в том случае, так как представление кэшируется.

Важно понимать, что одинаковое представление кэшируется для всех посетителей вашего приложения. Кто-то вызывает действие Index() получите же кэшированной версии в представление Index. Это означает, что объем работы, веб-сервера необходимо выполнить для обслуживания в представление Index значительно снижаются.

В представлении в листинге 2 происходит с делать что-то очень просто. Представление просто отображает текущее время. Тем не менее вы могли бы так же, как легко кэша представление, которое отображает набор записей в базе данных. В этом случае набор записей в базе данных не нужно извлечь из базы данных каждый раз вызывается действие контроллера, которое возвращает представление. Кэширование может снизить объем работы, которую необходимо выполнять веб-сервер и сервер базы данных.

Не используйте страницы &lt;% @ OutputCache %&gt; директив в представлении MVC. Эта директива размываются по из мира веб-форм и не следует использовать в приложении ASP.NET MVC. 

#### <a name="where-content-is-cached"></a>Где кэширования содержимого

По умолчанию, при использовании &lt;OutputCache&gt; атрибут, содержимое кэшируется в трех местах: веб-сервер, также прокси-серверы и веб-браузера. Можно управлять точно которых содержимое кэшируется, изменив свойство Location &lt;OutputCache&gt; атрибута.

Можно задать свойство Location в любой из следующих значений:

> · Любой
> 
> · Клиент
> 
> · Подчиненные
> 
> · Сервер
> 
> · Нет
> 
> · ServerAndClient


По умолчанию свойство Location любое имеет значение. Тем не менее существуют ситуации, в которых может потребоваться кэша только в браузере, или только на сервере. Например если сведения, которые можно настраивать отдельно для каждого пользователя, затем не следует кэшировать данные на сервере. При отображении различные сведения для разных пользователей следует кэшировать данные только на клиенте.

Например контроллер в листинге 3 предоставляет действие с именем GetName(), который возвращает имя текущего пользователя. Джек входит на веб-сайт и вызывает действие GetName() действие возвращается строка «Hi Jack». Если, как следствие, Jill входит на веб-сайт и вызывает действие GetName() затем она также будет строка «Hi Jack». Строка кэшируется на веб-сервере для всех пользователей, после Джек изначально вызывает действие контроллера.

**Listing 3 – Controllers\BadUserController.vb**

[!code-vb[Main](improving-performance-with-output-caching-vb/samples/sample3.vb)]

Скорее всего контроллер в листинге 3 не работает должным образом. Вы не хотите отображать сообщение «Hi Jack» Jill.

Никогда не следует кэшировать персонализации содержимого в кэше сервера. Тем не менее можно кэшировать персонализации содержимого в кэше браузера для повышения производительности. Если пользователь вызывает одно и то же действие контроллера несколько раз кэшировать содержимое в браузере, затем содержимое можно получить из кэша вместо сервера.

Измененный контроллера в листинге 4 кэширует выходные данные действия GetName(). Тем не менее содержимое кэшируется только в браузере, а не на сервере. Таким образом, когда несколько пользователей вызвать метод GetName(), каждый пользователь получает собственное имя пользователя и имя пользователя не другого пользователя.

**Листинг 4 — Controllers\UserController.vb**

[!code-vb[Main](improving-performance-with-output-caching-vb/samples/sample4.vb)]

Обратите внимание, что &lt;OutputCache&gt; атрибут в листинге 4 включает в себя свойство Location, присвоено значение OutputCacheLocation.Client. &lt;OutputCache&gt; атрибут также включает свойство NoStore. Свойство NoStore используется для информирования прокси-серверы и браузеры, они не следует хранить постоянную копию кэшированного содержимого.

#### <a name="varying-the-output-cache"></a>Изменения кэша вывода

В некоторых случаях вы можете очень одинаковое содержимое различных резервных копий. К примеру, представьте себе, что создается страница «основной/подробности». Главная страница отображает список названий фильмов. Если щелкнуть заголовок, вы получаете сведения для выбранного фрагмента.

Если на странице сведений о кэшировании, затем сведения для этого же фильма отображается независимо от того, какие фрагменты нажатия. Первого фильма, выбранного пользователем первый будет отображаться для всех последующих пользователей.

Эту неполадку можно устранить за счет использования свойства VaryByParam &lt;OutputCache&gt; атрибута. Это свойство позволяет создавать различные кэшированные версии те же содержимое, если параметр формы или изменяется параметр строки запроса.

Например контроллер в листинге 5 предоставляет два действия, с именем Master() и Details(). Это действие Master() возвращает список названий фильмов и Details() действие возвращает подробные сведения о выбранный фильм.

**Listing 5 – Controllers\MoviesController.vb**

[!code-vb[Main](improving-performance-with-output-caching-vb/samples/sample5.vb)]

Действие Master() включает VaryByParam свойство со значением «none». При просмотре вызывается действие, Master() же кэшированная версия образца возвращается. Все параметры формы или строки запроса, параметры игнорируются (см. рис. 2).

**Рис. 2 – Просмотр /Movies/Master**

![clip_image004](improving-performance-with-output-caching-vb/_static/image2.jpg)

**Рис. 3 – в представлении сведений/Movies /**

![clip_image006](improving-performance-with-output-caching-vb/_static/image3.jpg)

Действие Details() включает в себя свойство VaryByParam со значением «Id». Различные значения параметра Id, передаются в действие контроллера, создаются разные кэшированные версии подробного представления.

Это важно понимать, что с помощью свойства VaryByParam приводят кэширование и не меньше. Различные кэшированной версии подробного представления создается для каждой версии идентификатор параметра.

VaryByParam свойству можно присвоить следующие значения:

> \* = Создание различных кэшированной версии каждый раз, когда изменяется форма или параметра строки запроса.
> 
> None = не Создание различных резервных копий
> 
> Точка с запятой список параметров = Создание различных резервных копий, каждый раз, когда любой параметр или запроса формы строку в списке зависит от


#### <a name="creating-a-cache-profile"></a>Создание профиля кэша

В качестве альтернативы для настройки свойств кэша выходных данных, изменив свойства &lt;OutputCache&gt; атрибут, можно создать профиль кэша в файл веб-конфигурации (web.config). Создание профиля кэша в файле конфигурации веб-предлагает ряд важных преимуществ.

Во-первых путем настройки кэширования выводимых данных в файл веб-конфигурации, вы можете управлять способом действий контроллера, для кэширования содержимого в одном централизованном месте. Можно создать один профиль кэша и применить профиль с несколькими контроллеров или действий контроллера.

Во-вторых можно изменить файл веб-конфигурации без перекомпиляции приложения. Если вам нужно отключить кэширование для приложения, которое уже развернуто в рабочей среде, можно просто изменить профили кэша, определенные в файле конфигурации веб. Любые изменения в файл конфигурации веб-будет обнаружен автоматически и применены.

Например &lt;кэширование&gt; раздела веб-конфигурации в листинге 6 определяет профиль кэша с именем Cache1Hour. &lt;Кэширование&gt; раздел должен находиться внутри &lt;system.web&gt; раздел файла веб-конфигурации.

**Листинг 6 – в разделе кэширование для файла web.config**

[!code-xml[Main](improving-performance-with-output-caching-vb/samples/sample6.xml)]

Контроллер в листинге 7 показано, как применять к действию контроллера с помощью профиля Cache1Hour &lt;OutputCache&gt; атрибута.

**Листинг 7 – Controllers\ProfileController.vb**

[!code-vb[Main](improving-performance-with-output-caching-vb/samples/sample7.vb)]

Если вы выполняете команду Index() действию, предоставляемым контроллером в листинге 7 то же время будет возвращаться в течение часа.

#### <a name="summary"></a>Сводка

Кэширование вывода позволяет очень просто метод значительно улучшить производительность ваших приложений ASP.NET MVC. В этом руководстве вы узнали, как использовать &lt;OutputCache&gt; атрибут для кэширования выходных данных действий контроллера. Вы также узнали, как изменить свойства &lt;OutputCache&gt; атрибут, например длительность и VaryByParam свойства для изменения, как содержимое кэшируется. И, наконец вы узнали, как определить профили кэша в файл веб-конфигурации.

> [!div class="step-by-step"]
> [Назад](understanding-action-filters-vb.md)
> [Вперед](adding-dynamic-content-to-a-cached-page-vb.md)
