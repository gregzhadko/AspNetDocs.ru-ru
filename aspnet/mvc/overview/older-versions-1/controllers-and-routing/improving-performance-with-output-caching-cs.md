---
uid: mvc/overview/older-versions-1/controllers-and-routing/improving-performance-with-output-caching-cs
title: Повышение производительности с помощью кэшированияC#вывода () | Документация Майкрософт
author: microsoft
description: В этом руководстве вы узнаете, как можно значительно повысить производительность веб-приложений ASP.NET MVC, используя преимущества кэширования выходных данных. Вы...
ms.author: riande
ms.date: 01/27/2009
ms.assetid: 521c9117-81cd-4d8d-9d96-0256dc7bf50f
msc.legacyurl: /mvc/overview/older-versions-1/controllers-and-routing/improving-performance-with-output-caching-cs
msc.type: authoredcontent
ms.openlocfilehash: 548c5bea2e9cf26e0574e72d2c0ea204dbd90f9c
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78486672"
---
# <a name="improving-performance-with-output-caching-c"></a>Повышение производительности благодаря кэшированию вывода (C#)

по [Майкрософт](https://github.com/microsoft)

> В этом руководстве вы узнаете, как можно значительно повысить производительность веб-приложений ASP.NET MVC, используя преимущества кэширования выходных данных. Вы узнаете, как кэшировать результат, возвращенный действием контроллера, чтобы одно и то же содержимое не создавалось каждый раз при вызове действия новым пользователем.

Цель этого руководства — объяснить, как можно значительно повысить производительность приложения ASP.NET MVC, используя преимущества кэша вывода. Кэш вывода позволяет кэшировать содержимое, возвращенное действием контроллера. Таким образом, не нужно создавать одно и то же содержимое каждый раз, когда вызывается одно и то же действие контроллера.

Представьте, например, что приложение ASP.NET MVC отображает список записей базы данных в представлении с именем index. Как правило, каждый раз, когда пользователь вызывает действие контроллера, возвращающее представление индекса, набор записей базы данных необходимо извлечь из базы данных, выполнив запрос к базе данных.

С другой стороны, если воспользоваться кэшем вывода, то можно избежать выполнения запроса к базе данных при каждом вызове одного и того же действия контроллера. Представление можно извлечь из кэша, а не повторно создавать из действия контроллера. Кэширование позволяет избежать выполнения избыточной работы на сервере.

## <a name="enabling-output-caching"></a>Включение кэширования вывода

Чтобы включить кэширование вывода, добавьте атрибут [OutputCache] к отдельному действию контроллера или ко всему классу контроллера. Например, контроллер в листинге 1 предоставляет действие с именем index (). Выходные данные действия Index () кэшируются в течение 10 секунд.

**Листинг 1 — Controllers\HomeController.cs**

[!code-csharp[Main](improving-performance-with-output-caching-cs/samples/sample1.cs)]

В бета-версиях ASP.NET MVC не работает кэширование выходных данных для URL-адреса, такого как [http://www.MySite.com/](http://www.mysite.com/). Вместо этого необходимо ввести URL-адрес, например [http://www.MySite.com/Home/Index](http://www.mysite.com/Home/Index). 

В листинге 1 выходные данные действия Index () кэшируются в течение 10 секунд. При желании можно указать более длительную продолжительность кэширования. Например, если требуется кэшировать выходные данные действия контроллера в течение одного дня, можно указать длительность кэширования в 86400 секунд (60 секунд \* 60 минут \* 24 часа).

Нет никакой гарантии, что содержимое будет кэшироваться на указанный период времени. Когда ресурсы памяти становятся ненизкими, кэш начинает автоматическое исключение содержимого.

Контроллер Home в листинге 1 возвращает представление индекса в листинге 2. Нет ничего особенного в этом представлении. В представлении индекса просто отображается текущее время (см. рис. 1).

**Листинг 2 — Виевс\хоме\индекс.аспкс**

[!code-aspx[Main](improving-performance-with-output-caching-cs/samples/sample2.aspx)]

**Рис. 1. представление кэшированного индекса**

![clip_image002](improving-performance-with-output-caching-cs/_static/image1.jpg)

Если вы вызываете действие index () несколько раз, введя URL-адрес/Хоме/индекс в адресной строке браузера и нажимая кнопку Обновить/перезагрузить в браузере, то время, отображаемое представлением индекса, не изменится на 10 секунд. Это же время отображается, так как представление кэшируется.

Важно понимать, что одно и то же представление кэшируется для всех, кто посещает ваше приложение. Любой, кто вызывает действие index (), получает ту же кэшированную версию представления индекса. Это означает, что объем работы, которую должен выполнить веб-сервер для обслуживания представления индекса, значительно уменьшился.

Представление в листинге 2 делает что-то очень простое. В представлении просто отображается текущее время. Тем не менее можно легко кэшировать представление, отображающее набор записей базы данных. В этом случае набор записей базы данных не требуется извлекать из базы данных каждый раз, когда вызывается действие контроллера, возвращающее представление. Кэширование может уменьшить объем работы, которую должен выполнять как веб-сервер, так и сервер базы данных.

Не используйте директиву Page &lt;% @ OutputCache%&gt; в представлении MVC. Эта директива суперсовременныеся из мира веб-форм и не должна использоваться в приложении ASP.NET MVC.

## <a name="where-content-is-cached"></a>Где кэшируется содержимое

По умолчанию при использовании атрибута [OutputCache] содержимое кэшируется в трех местах: веб-сервере, прокси-серверах и веб-браузере. Вы можете точно контролировать место кэширования содержимого, изменяя свойство Location атрибута [OutputCache].

Можно задать для свойства Location одно из следующих значений:

> · Всеми
> 
> · Компьютера
> 
> · Подчинен
> 
> · Сервером
> 
> · None
> 
> · серверандклиент

По умолчанию свойство Location имеет значение Any. Однако существуют ситуации, в которых может потребоваться кэширование только в браузере или только на сервере. Например, при кэшировании данных, персонализированных для каждого пользователя, не следует кэшировать данные на сервере. При отображении разных сведений для разных пользователей следует кэшировать данные только на клиенте.

Например, контроллер в листинге 3 предоставляет действие с именем Name (), которое возвращает имя текущего пользователя. Если гнездо входит в систему на веб-сайте и вызывает действие GetString (), то действие возвращает строку «Hi-гнездо». Если, в дальнейшем, Jill входит в систему на веб-сайте и вызывает действие GetString (), то она также получит строку «Hi-гнездо». Строка кэшируется на веб-сервере для всех пользователей после того, как гнездо первоначально вызывает действие контроллера.

**Листинг 3 — Контроллерс\бадусерконтроллер.КС**

[!code-csharp[Main](improving-performance-with-output-caching-cs/samples/sample3.cs)]

Скорее всего, контроллер в листинге 3 не работает нужным образом. Вы не хотите отображать сообщение «Hi» для Jill.

Никогда не следует кэшировать персонализированное содержимое в кэше сервера. Однако для повышения производительности может потребоваться кэширование персонализированного содержимого в кэше браузера. Если содержимое кэшируется в браузере и пользователь вызывает одно и то же действие контроллера несколько раз, то содержимое можно извлечь из кэша браузера, а не сервера.

Измененный контроллер в листинге 4 кэширует выходные данные действия-имени (). Однако содержимое кэшируется только в браузере, а не на сервере. Таким образом, когда несколько пользователей вызывают метод Name (), каждый пользователь получает собственное имя пользователя, а не имя пользователя другого человека.

**Листинг 4 — Контроллерс\усерконтроллер.КС**

[!code-csharp[Main](improving-performance-with-output-caching-cs/samples/sample4.cs)]

Обратите внимание, что атрибут [OutputCache] в листинге 4 содержит свойство Location, установленное в значение Аутпуткачелокатион. Client. Атрибут [OutputCache] также включает свойство «не в хранилище». Свойство "хранимая служба" используется для информирования прокси-серверов и браузера о том, что они не хранят постоянную копию кэшированного содержимого.

## <a name="varying-the-output-cache"></a>Изменение кэша вывода

В некоторых ситуациях могут потребоваться разные кэшированные версии одного и того же содержимого. Предположим, например, что вы создаете страницу «основной/подробности». На главной странице отображается список заголовков фильмов. Если щелкнуть заголовок, то будут получены подробные сведения о выбранном фильме.

При кэшировании страницы сведений сведения о том же фильме будут отображаться независимо от того, какой фильм вы щелкнули. Первый фильм, выбранный первым пользователем, будет отображаться для всех последующих пользователей.

Эту проблему можно устранить, воспользовавшись свойством VaryByParam атрибута [OutputCache]. Это свойство позволяет создавать разные кэшированные версии одного и того же содержимого, если параметр формы или параметр строки запроса различаются.

Например, контроллер в листинге 5 предоставляет два действия с именами Master () и Details (). Действие Master () возвращает список заголовков фильмов, а действие Details () возвращает сведения о выбранном фильме.

**Листинг 5 — Контроллерс\мовиесконтроллер.КС**

[!code-csharp[Main](improving-performance-with-output-caching-cs/samples/sample5.cs)]

Действие Master () включает свойство VaryByParam со значением «None». При вызове действия Master () возвращается та же кэшированная версия главного представления. Все параметры формы или параметры строки запроса игнорируются (см. рис. 2).

**Рис. 2. представление/Мовиес/мастер**

![clip_image004](improving-performance-with-output-caching-cs/_static/image2.jpg)

**Рис. 3 — представление/Мовиес/детаилс**

![clip_image006](improving-performance-with-output-caching-cs/_static/image3.jpg)

Действие Details () включает свойство VaryByParam со значением ID. Если в действие контроллера передаются различные значения параметра ID, создаются разные кэшированные версии представления сведений.

Важно понимать, что использование свойства VaryByParam приводит к большему кэшированию и не меньше. Для каждой другой версии параметра ID создается другая кэшированная версия представления Details.

Для свойства VaryByParam можно задать следующие значения:

> \* = создать другую кэшированную версию всякий раз, когда параметр формы или строки запроса изменяется.
> 
> None = никогда не создавать разные кэшированные версии
> 
> Список параметров точки с запятой: Создание разных кэшированных версий каждый раз, когда любая из параметров формы или строки запроса изменяется

## <a name="creating-a-cache-profile"></a>Создание профиля кэша

В качестве альтернативы настройке свойств кэша вывода путем изменения свойств атрибута [OutputCache] можно создать профиль кэша в файле веб-конфигурации (Web. config). Создание профиля кэша в файле веб-конфигурации обеспечивает ряд важных преимуществ.

Прежде всего, настроив кэширование вывода в файле веб-конфигурации, можно контролировать, как действия контроллера кэшируют содержимое в одном централизованном расположении. Можно создать один профиль кэша и применить профиль к нескольким контроллерам или действиям контроллера.

Во-вторых, можно изменить конфигурационный файл, не выполняя повторную компиляцию приложения. Если необходимо отключить кэширование для приложения, которое уже развернуто в рабочей среде, можно просто изменить профили кэша, определенные в файле веб-конфигурации. Любые изменения в файле веб-конфигурации будут автоматически обнаружены и применены.

Например, раздел &lt;Caching&gt; Web Configuration в листинге 6 определяет профиль кэша с именем Cache1Hour. Раздел &lt;Caching&gt; должен находиться в разделе &lt;System. Web&gt; файла веб-конфигурации.

**Листинг 6. раздел кэширования для Web. config**

[!code-xml[Main](improving-performance-with-output-caching-cs/samples/sample6.xml)]

Контроллер в листинге 7 показывает, как можно применить профиль Cache1Hour к действию контроллера с помощью атрибута [OutputCache].

**Листинг 7 — Контроллерс\профилеконтроллер.КС**

[!code-csharp[Main](improving-performance-with-output-caching-cs/samples/sample7.cs)]

Если вызвать действие index (), предоставляемое контроллером в листинге 7, то то же самое время будет возвращено в течение 1 часа.

## <a name="summary"></a>Сводка

Кэширование выходных данных предоставляет очень простой способ значительно повысить производительность приложений ASP.NET MVC. В этом руководстве вы узнали, как использовать атрибут [OutputCache] для кэширования выходных данных действий контроллера. Вы также узнали, как изменять свойства атрибута [OutputCache], такие как свойства Duration и VaryByParam, чтобы изменить способ кэширования содержимого. Наконец, вы узнали, как определить профили кэша в файле веб-конфигурации.

> [!div class="step-by-step"]
> [Назад](understanding-action-filters-cs.md)
> [Вперед](adding-dynamic-content-to-a-cached-page-cs.md)
