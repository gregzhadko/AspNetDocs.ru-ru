---
uid: mvc/overview/older-versions-1/controllers-and-routing/understanding-action-filters-cs
title: Понимание действий Фильтры (C) Документы Майкрософт
author: rick-anderson
description: Цель этого учебника заключается в том, чтобы объяснить фильтры действий. Фильтр действия — это атрибут, который можно применить к действию контроллера или всему контроллеру...
ms.author: riande
ms.date: 10/16/2008
ms.assetid: a94e4e81-40c1-47b7-8613-126a1a6cc93d
msc.legacyurl: /mvc/overview/older-versions-1/controllers-and-routing/understanding-action-filters-cs
msc.type: authoredcontent
ms.openlocfilehash: 75ba7b1dce280a45cd092de97c464eade5f49838
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2020
ms.locfileid: "81542187"
---
# <a name="understanding-action-filters-c"></a>Общие сведения о фильтрах действий (C#)

[корпорацией Майкрософт](https://github.com/microsoft)

[Скачать PDF](https://download.microsoft.com/download/e/f/3/ef3f2ff6-7424-48f7-bdaa-180ef64c3490/ASPNET_MVC_Tutorial_14_CS.pdf)

> Цель этого учебника заключается в том, чтобы объяснить фильтры действий. Фильтр действия — это атрибут, который можно применить к действию контроллера или всему контроллеру, который изменяет способ выполнения действия.

## <a name="understanding-action-filters"></a>Понимание действий Фильтры

Цель этого учебника заключается в том, чтобы объяснить фильтры действий. Фильтр действия — это атрибут, который можно применить к действию контроллера или всему контроллеру, который изменяет способ выполнения действия. Платформа mVC ASP.NET включает в себя несколько фильтров действия:

- OutputCache - Этот фильтр действия кэши вывод действия контроллера в течение определенного периода времени.
- HandleError - Этот фильтр действий обрабатывает ошибки, поднятые при выполнении действия контроллера.
- Авторизация - Этот фильтр действия позволяет ограничить доступ к определенному пользователю или роли.

Вы также можете создать свои собственные фильтры действий. Например, для реализации пользовательской системы аутентификации может потребоваться создать пользовательский фильтр действий. Или может потребоваться создать фильтр действия, который изменяет данные представления, возвращенные действием контроллера.

В этом учебнике вы узнаете, как создать фильтр действия с нуля. Мы создаем фильтр действия журнала, который регистрирует различные этапы обработки действия в окно Visual Studio Output.

### <a name="using-an-action-filter"></a>Использование фильтра действий

Фильтр действия является атрибутом. Вы можете применить большинство фильтров действий либо к индивидуальному действию контроллера, либо ко всему контроллеру.

Например, контроллер данных в листинге `Index()` 1 предоставляет действие, названное, которое возвращает текущее время. Это действие украшено `OutputCache` фильтром действия. Этот фильтр приводит к тому, что значение, возвращаемые действием, кэшируется в течение 10 секунд.

**Список 1 -`Controllers\DataController.cs`**

[!code-csharp[Main](understanding-action-filters-cs/samples/sample1.cs)]

Если вы неоднократно вызываете `Index()` действие, вводя URL/Data/Index в адресную строку браузера и нажимая кнопку Refresh несколько раз, то вы увидите то же время в течение 10 секунд. Выход `Index()` действия кэшируется в течение 10 секунд (см. рисунок 1).

[![Кэшированное время](understanding-action-filters-cs/_static/image2.png)](understanding-action-filters-cs/_static/image1.png)

**Рисунок 01**: Кэшированное время[(Нажмите, чтобы просмотреть полноразмерное изображение)](understanding-action-filters-cs/_static/image3.png)

В листинге 1 к методу `OutputCache` `Index()` применяется единый фильтр действия – фильтр действия. При необходимости можно применить несколько фильтров действия к тому же действию. Например, можно применить фильтры `OutputCache` `HandleError` действия и действия к тому же действию.

В листинге `OutputCache` 1 фильтр действия `Index()` применяется к действию. Вы также можете применить `DataController` этот атрибут к самому классу. В этом случае результат, возвращенный любым действием, выложенный контроллером, будет кэширован в течение 10 секунд.

### <a name="the-different-types-of-filters"></a>Различные типы фильтров

Платформа mVC ASP.NET поддерживает четыре различных типа фильтров:

1. Фильтры авторизации — `IAuthorizationFilter` Реализация атрибута.
2. Фильтры действий — `IActionFilter` Реализация атрибута.
3. Фильтры результата — `IResultFilter` Реализация атрибута.
4. Фильтры исключений `IExceptionFilter` — Реализация атрибута.

Фильтры выполняются в порядке, указанном выше. Например, фильтры авторизации всегда выполняются до того, как фильтры действий и фильтры исключений всегда выполняются после любого другого типа фильтров.

Фильтры авторизации используются для реализации проверки подлинности и авторизации для действий контроллера. Например, фильтр Authorize является примером фильтра авторизации.

Фильтры действий содержат логику, которая выполняется до и после выполнения действия контроллера. Например, можно использовать фильтр действия для изменения данных представления, которые возвращает действие контроллера.

Фильтры результатов содержат логику, которая выполняется до и после выполнения результата представления. Например, можно изменить результат представления прямо перед тем, как представление будет отображено в браузер.

Фильтры исключений являются последним типом фильтра для запуска. Вы можете использовать фильтр исключения для обработки ошибок, поднятых либо действиями контроллера, либо результатами действий контроллера. Для регистрации ошибок также можно использовать фильтры исключений.

Каждый тип фильтра выполняется в определенном порядке. Если вы хотите контролировать порядок, в котором выполняются фильтры одного и того же типа, можно установить свойство заказа фильтра.

Базовым классом для всех `System.Web.Mvc.FilterAttribute` фильтров действий является класс. Если вы хотите реализовать определенный тип фильтра, то вам нужно создать класс, который наследует от `IAuthorizationFilter` `IActionFilter`базового класса фильтра и реализует один или несколько из , `IResultFilter`, или `IExceptionFilter` интерфейсы.

### <a name="the-base-actionfilterattribute-class"></a>Базовый класс ActionFilterAttribute

Для того, чтобы облегчить для вас реализацию пользовательского фильтра действий, ASP.NET mVC фреймворк включает базовый `ActionFilterAttribute` класс. Этот класс реализует `IActionFilter` интерфейсы и `IResultFilter` наследует `Filter` от класса.

Терминология здесь не совсем последовательна. Технически класс, наследуетший из класса ActionFilterAttribute, является как фильтром действия, так и фильтром результата. Однако в свободном смысле фильтр действия слова используется для обозначения любого типа фильтра в ASP.NET mVC.

Базовый `ActionFilterAttribute` класс имеет следующие методы, которые можно переопределить:

- OnActionExecuting — Этот метод называется до выполнения действия контроллера.
- OnActionExecuted - Этот метод называется после выполнения действия контроллера.
- OnResultExecuting - Этот метод вызывается до выполнения результата действия контроллера.
- OnResultExecuted - Этот метод вызывается после выполнения результата действия контроллера.

В следующем разделе мы увидим, как можно реализовать каждый из этих различных методов.

### <a name="creating-a-log-action-filter"></a>Создание фильтра действий в журнале

Чтобы проиллюстрировать, как можно создать пользовательский фильтр действий, мы создадим пользовательский фильтр действий, который регистрирует этапы обработки действия контроллера в окно Visual Studio Output. Наш `LogActionFilter` содержится в листинге 2.

**Список 2 -`ActionFilters\LogActionFilter.cs`**

[!code-csharp[Main](understanding-action-filters-cs/samples/sample2.cs)]

`OnActionExecuting()`В листинге 2, `OnResultExecuting()`, `OnResultExecuted()` `OnActionExecuted()`и , `Log()` и методы все вызов метода. Имя метода и текущие данные маршрута `Log()` передаются методу. Метод `Log()` записывает сообщение в окно вывода Visual Studio (см. рисунок 2).

[![Запись в окно вывода Visual Studio](understanding-action-filters-cs/_static/image5.png)](understanding-action-filters-cs/_static/image4.png)

**Рисунок 02**: Запись в окно вывода visual Studio ([Нажмите, чтобы просмотреть полноразмерное изображение](understanding-action-filters-cs/_static/image6.png))

Домашний контроллер в листинге 3 иллюстрирует, как можно применить фильтр действий журнала ко всему классу контроллера. Всякий раз, когда любое из действий, `Index()` подвергаемых контроллеру Home, вызывается - либо метод, либо `About()` метод - этапы обработки действия регистрируются в окно Visual Studio Output.

**Список 3 -`Controllers\HomeController.cs`**

[!code-csharp[Main](understanding-action-filters-cs/samples/sample3.cs)]

### <a name="summary"></a>Сводка

В этом учебнике вы познакомились с ASP.NET фильтров действий MVC. Вы узнали о четырех различных типах фильтров: фильтры авторизации, фильтры действий, фильтры результатов и фильтры исключений. Вы также узнали `ActionFilterAttribute` о базовом классе.

Наконец, вы узнали, как реализовать простой фильтр действий. Мы создали фильтр действия журнала, который регистрирует этапы обработки действия контроллера в окно Visual Studio Output.

> [!div class="step-by-step"]
> [Назад](asp-net-mvc-routing-overview-cs.md)
> [Вперед](improving-performance-with-output-caching-cs.md)
