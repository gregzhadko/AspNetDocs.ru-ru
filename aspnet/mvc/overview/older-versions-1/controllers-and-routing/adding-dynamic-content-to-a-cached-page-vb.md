---
uid: mvc/overview/older-versions-1/controllers-and-routing/adding-dynamic-content-to-a-cached-page-vb
title: Добавление динамического содержимого на кэшированные страницы (Visual Basic) | Документация Майкрософт
author: microsoft
description: Узнайте, как сочетать динамическое и кэшированное содержимое, на этой же странице. Подстановка пост-кэша позволяет отображать динамическое содержимое, например o объявления заголовка...
ms.author: riande
ms.date: 01/27/2009
ms.assetid: 68acd884-fb57-4486-a1be-aaa93e380780
msc.legacyurl: /mvc/overview/older-versions-1/controllers-and-routing/adding-dynamic-content-to-a-cached-page-vb
msc.type: authoredcontent
ms.openlocfilehash: 121a3a35c8255f1423d7008930315f76bbb8e8f9
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/01/2019
ms.locfileid: "57053101"
---
<a name="adding-dynamic-content-to-a-cached-page-vb"></a>Добавление динамического содержимого на кэшированные страницы (VB)
====================
по [Microsoft](https://github.com/microsoft)

> Узнайте, как сочетать динамическое и кэшированное содержимое, на этой же странице. Подстановка пост-кэша предоставляет возможность отображения динамического содержимого, например рекламных объявлений или новости, страницы, которая были выведены кэшируются.


Используя преимущества кэширования вывода, можно значительно повысить производительность приложения ASP.NET MVC. Вместо создания заново страницу каждый раз, когда потребуются страницы, страницы могут возникать один раз и кэшируются в памяти для нескольких пользователей.

Но есть проблема. Что делать, если требуется, чтобы отобразить динамическое содержимое на странице? Например представьте, что вы хотите отобразить объявления баннер на странице. Вы не хотите баннеров для кэширования, чтобы каждый пользователь видит те же объявление. Вы бы прибыль таким образом!

К счастью есть простой способ. Вы можете воспользоваться функцией платформы ASP.NET, который вызывается *подстановка после кэширования*. Подстановка пост-кэша позволяет заменить динамического содержимого на странице, которая кэширована в памяти.


Как правило, при выводе кэшировать страницы с помощью &lt;OutputCache&gt; атрибут, страница кэшируется на сервере и клиент (браузер). При использовании Подстановка пост-кэша, страница кэшируется только на сервере.


#### <a name="using-post-cache-substitution"></a>С помощью Подстановка пост-кэша

С помощью Подстановка пост-кэша в два этапа. Во-первых необходимо определить метод, который возвращает строку, представляющую динамическое содержимое, которое будет отображаться в кэшированные страницы. Затем вызывается метод HttpResponse.WriteSubstitution() для вставки динамического содержимого на страницы.

Например, представьте себе, необходимость в случайном порядке показать различные новости в кэшированные страницы. Класс в листинге 1 предоставляет единственный метод, с именем RenderNews(), который случайным образом возвращает один элемент новостей из списка из трех элементов новостей.

**В листинге 1 — Models\News.vb**

[!code-vb[Main](adding-dynamic-content-to-a-cached-page-vb/samples/sample1.vb)]

Чтобы воспользоваться преимуществами Подстановка пост-кэша, можно вызвать метод HttpResponse.WriteSubstitution(). Метод WriteSubstitution() устанавливает код для замены области кэшированных страниц с динамическим содержимым. Метод WriteSubstitution() используется для отображения случайных новостей в представлении в листинге 2.

**В листинге 2 — Views\Home\Index.aspx**

[!code-aspx[Main](adding-dynamic-content-to-a-cached-page-vb/samples/sample2.aspx)]

Метод RenderNews передается методу WriteSubstitution(). Обратите внимание на то, что метод RenderNews не вызывается. Вместо этого ссылка на метод передается WriteSubstitution() с помощью оператора AddressOf.

Представление Index кэшируется. Представление возвращает контроллер в листинге 3. Обратите внимание, что действие Index() снабжен &lt;OutputCache&gt; атрибут, который приводит к смещению представления индекса должен быть помещен в кэш 60 секунд.

**Листинг 3 – Controllers\HomeController.vb**

[!code-vb[Main](adding-dynamic-content-to-a-cached-page-vb/samples/sample3.vb)]

Несмотря на то, что кэшируется в представление Index, различные Новостные случайные элементы отображаются в том случае, при запросе страницы индекса. При запросе страницы Index, время, отображаемое на странице остается неизменным на 60 секунд (см. рис. 1). Тот факт, что время не приводит к изменению доказывает, что страница кэшируется. Тем не менее, содержимое введенному изменении метода — случайное новости – WriteSubstitution() с каждым запросом.

**Рис. 1 – Включение динамического новости в кэшированные страницы**

![clip_image002](adding-dynamic-content-to-a-cached-page-vb/_static/image1.jpg)

#### <a name="using-post-cache-substitution-in-helper-methods"></a>С помощью Подстановка пост-кэша в вспомогательные методы

Для инкапсуляции вызов метода WriteSubstitution() пользовательского вспомогательного метода является более простой способ воспользоваться преимуществами Подстановка пост-кэша. Этот подход проиллюстрирован с помощью вспомогательного метода в листинге 4.

**Листинг 4 — Helpers\AdHelper.vb**

[!code-vb[Main](adding-dynamic-content-to-a-cached-page-vb/samples/sample4.vb)]

Листинг 4 содержит модуль Visual Basic, предоставляет два метода: RenderBanner() и RenderBannerInternal(). Метод RenderBanner() представляет фактический вспомогательный метод. Этот метод расширяет стандартного класса ASP.NET MVC HtmlHelper, что Html.RenderBanner() можно вызвать в представлении так же, как и любой другой вспомогательный метод.

Метод RenderBanner() вызывает метод HttpResponse.WriteSubstitution(), передавая ему RenderBannerInternal() WriteSubsitution() метода.

Метод RenderBannerInternal() — закрытый метод. Этот метод не будет предоставляться как вспомогательный метод. Метод RenderBannerInternal() случайным образом возвращает одно изображение баннера объявления из списка три изображения баннера объявления.

Измененный представление Index в листинге 5 иллюстрирует, как можно использовать вспомогательный метод RenderBanner(). Обратите внимание, что дополнительная &lt;% @ % импорта&gt; директива включается в верхней части представления, чтобы импортировать пространство имен MvcApplication1.Helpers. Если вы не импортируйте это пространство имен, метод RenderBanner() не будет отображаться как метод на свойстве Html.

**В листинге 5 – Views\Home\Index.aspx (с помощью метода RenderBanner())**

[!code-aspx[Main](adding-dynamic-content-to-a-cached-page-vb/samples/sample5.aspx)]

При запросе страницы к просмотру в представлении в листинге 5 разных баннеров отображается с каждым запросом (см. рис. 2). Страница кэшируется, однако, вспомогательный метод RenderBanner() баннеров внедряется динамически.

**Рис. 2 – индекс представления, отображающее случайных баннеров**

![clip_image004](adding-dynamic-content-to-a-cached-page-vb/_static/image2.jpg)

#### <a name="summary"></a>Сводка

Этом руководстве описано, как можно динамически обновлять содержимое в кэшированные страницы. Вы узнали, как использовать метод HttpResponse.WriteSubstitution() для включения динамического содержимого, которые следует вставить в кэшированные страницы. Вы также узнали, как инкапсулировать вызов метода WriteSubstitution() вспомогательный метод HTML.

Преимущества кэширования по возможности — он может иметь значительное влияние на производительность веб-приложений. Как описано в этом руководстве, можно воспользоваться преимуществами кэширования даже в том случае, когда требуется для отображения динамического содержимого на страницы.

> [!div class="step-by-step"]
> [Назад](improving-performance-with-output-caching-vb.md)
> [Вперед](creating-a-controller-vb.md)
