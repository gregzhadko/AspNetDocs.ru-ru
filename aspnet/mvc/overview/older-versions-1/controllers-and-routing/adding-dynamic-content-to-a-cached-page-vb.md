---
uid: mvc/overview/older-versions-1/controllers-and-routing/adding-dynamic-content-to-a-cached-page-vb
title: Добавление динамического содержимого на кэшированную страницу (VB) Документы Майкрософт
author: rick-anderson
description: Узнайте, как смешивать динамическое и кэшированное содержимое на одной странице. Замена посткэша позволяет отображать динамический контент, например баннерную рекламу o. .
ms.author: riande
ms.date: 01/27/2009
ms.assetid: 68acd884-fb57-4486-a1be-aaa93e380780
msc.legacyurl: /mvc/overview/older-versions-1/controllers-and-routing/adding-dynamic-content-to-a-cached-page-vb
msc.type: authoredcontent
ms.openlocfilehash: 1ed022fc560becbd21722b94f2428cf7b32f2635
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2020
ms.locfileid: "81542265"
---
# <a name="adding-dynamic-content-to-a-cached-page-vb"></a>Добавление динамического содержимого на кэшированные страницы (VB)

[корпорацией Майкрософт](https://github.com/microsoft)

> Узнайте, как смешивать динамическое и кэшированное содержимое на одной странице. Замена после кэша позволяет отображать динамический контент, например баннерную рекламу или новостные материалы, на странице, которая была кэширована.

Воспользовавшись преимуществами кэширования вывода, вы можете значительно повысить производительность ASP.NET приложения MVC. Вместо регенерации страницы каждый раз, когда страница запрашивается, страница может быть создана один раз и кэширована в памяти для нескольких пользователей.

Но есть проблема. Что делать, если вам нужно отобразить динамическое содержимое на странице? Например, представьте, что вы хотите отобразить баннерную рекламу на странице. Вы не хотите, чтобы баннерная реклама была кэширована, чтобы каждый пользователь видел одну и ту же самую рекламу. Вы бы не заработать деньги таким образом!

К счастью, есть простое решение. Вы можете воспользоваться функцией ASP.NET инфраструктуры, *называемой после кэш-замены.* Замена посткэша позволяет заменить динамическое содержимое на странице, которая была кэширована в памяти.

Обычно при выводе кэша страницы &lt;с&gt; помощью атрибута OutputCache страница кэшируется как на сервере, так и на клиенте (веб-браузере). При использовании замены после кэша страница кэшируется только на сервере.

#### <a name="using-post-cache-substitution"></a>Использование замены пост-кэша

Использование замены посткэша требует двух этапов. Во-первых, необходимо определить метод, который возвращает строку, представляющую динамическое содержимое, которое необходимо отобразить на кэшированной странице. Далее вы называете метод httpResponse.WriteSubstitution() для впрыскивания динамического содержимого на страницу.

Представьте себе, например, что вы хотите случайным образом отображать различные новости на кэшированной странице. Класс в листинге 1 предоставляет один метод, названный RenderNews(), который случайным образом возвращает один элемент новостей из списка из трех новостей.

**Список 1 - Модели-News.vb**

[!code-vb[Main](adding-dynamic-content-to-a-cached-page-vb/samples/sample1.vb)]

Чтобы воспользоваться преимуществами замены после кэша, вы называете метод httpResponse.WriteSubstitution(). Метод WriteSubstitution() настраивает код для замены области кэшированной страницы динамическим содержимым. Метод WriteSubstitution() используется для отображения случайного элемента новостей в представлении в листинге 2.

**Список 2 - Просмотры »Домашний»Индекс.aspx**

[!code-aspx[Main](adding-dynamic-content-to-a-cached-page-vb/samples/sample2.aspx)]

Метод RenderNews передается методу WriteSubstitution() Обратите внимание, что метод RenderNews не вызывается. Вместо этого ссылка на метод передается WriteSubstitution() с помощью оператора AddressOf.

Представление индекса кэшируется. Представление возвращается контроллером в листинге 3. Обратите внимание, что действие Index() украшено атрибутом &lt;OutputCache,&gt; который приводит к кетизированию представления индекса в течение 60 секунд.

**Список 3 - Контролеры**

[!code-vb[Main](adding-dynamic-content-to-a-cached-page-vb/samples/sample3.vb)]

Даже если представление индекса кэшируется, при запросе страницы Индекса отображаются различные случайные новости. При запросе страницы Индекса время, отображаемые страницей, не изменяется в течение 60 секунд (см. рисунок 1). Тот факт, что время не меняется, доказывает, что страница кэшируется. Тем не менее, содержимое, введенное методом WriteSubstitution() - случайным пунктом новостей - изменяется с каждым запросом.

**Рисунок 1 - Инъекция динамических новостей на кэшированной странице**

![clip_image002](adding-dynamic-content-to-a-cached-page-vb/_static/image1.jpg)

#### <a name="using-post-cache-substitution-in-helper-methods"></a>Использование замены пост-кэша в методах помощника

Более простой способ воспользоваться преимуществами замены после кэша — инкапсулировать вызов на метод WriteSubstitution() в пользовательском методе помощи. Этот подход иллюстрируется методом помощника в листинге 4.

**Список 4 - Помощники AdHelper.vb**

[!code-vb[Main](adding-dynamic-content-to-a-cached-page-vb/samples/sample4.vb)]

Список 4 содержит модуль Visual Basic, который предоставляет два метода: RenderBanner() и RenderBannerInternal(). Метод RenderBanner() представляет собой фактический метод помощника. Этот метод расширяет стандартный ASP.NET класс MVC HtmlHelper, так что вы можете вызвать Html.RenderBanner () в представлении, как и любой другой метод помощника.

Метод RenderBanner () вызывает метод HttpResponse.WriteSubstitution() прохождение метода RenderBannerInternal () методу WriteSubstitution() методу WriteSubstitution() .

Метод RenderBannerInternal () является частным методом. Этот метод не будет подвергаться воздействию в качестве помощника. Метод RenderBannerInternal () случайным образом возвращает одно изображение баннерной рекламы из списка из трех баннерных рекламных изображений.

Измененное представление индекса в листинге 5 иллюстрирует, как можно использовать метод помощника RenderBanner() Обратите внимание, &lt;что дополнительная директива % импортного %&gt; включена в верхней части представления для импорта пространства имен MvcApplication1.Helpers. Если вы забудете импортировать это пространство имен, то метод RenderBanner() не будет отображаться в качестве метода на свойстве Html.

**Список 5 - Просмотры »Home»Index.aspx (с renderBanner() метод)**

[!code-aspx[Main](adding-dynamic-content-to-a-cached-page-vb/samples/sample5.aspx)]

При запросе страницы, отображаемых представлением в листинге 5, с каждым запросом отображается другая баннерная реклама (см. рисунок 2). Страница кэшируется, но баннерная реклама вводится динамически методом помощника RenderBanner()

**Рисунок 2 - Представление индекса, отображающее случайную рекламу баннера**

![clip_image004](adding-dynamic-content-to-a-cached-page-vb/_static/image2.jpg)

#### <a name="summary"></a>Сводка

В этом уроке объясняется, как можно динамически обновлять содержимое на кэшированной странице. Вы узнали, как использовать метод HttpResponse.WriteSubstitution() для включения динамического содержимого в кэшированную страницу. Вы также узнали, как инкапсулировать вызов на метод WriteSubstitution() в методе html-помощника.

Воспользуйтесь кэшированием, когда это возможно - это может иметь огромное влияние на производительность веб-приложений. Как поясняется в этом учебнике, вы можете воспользоваться кэшированием, даже если вам нужно отобразить динамическое содержимое на своих страницах.

> [!div class="step-by-step"]
> [Назад](improving-performance-with-output-caching-vb.md)
> [Вперед](creating-a-controller-vb.md)
