---
uid: mvc/overview/older-versions-1/models-data/validation-with-the-data-annotation-validators-vb
title: Проверка с помощью средств проверки заметок к данным (VB) | Документация Майкрософт
author: microsoft
description: Воспользуйтесь преимуществами связывателя модели заметок к данным для выполнения проверки в приложении ASP.NET MVC. Узнайте, как использовать различные типы проверяющего элемента управления...
ms.author: riande
ms.date: 05/29/2009
ms.assetid: 0d23ff2b-f2ec-434a-be3b-1180beeccba3
msc.legacyurl: /mvc/overview/older-versions-1/models-data/validation-with-the-data-annotation-validators-vb
msc.type: authoredcontent
ms.openlocfilehash: 00150575baabc659f7dd0c07349cde52105f6c8b
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78435942"
---
# <a name="validation-with-the-data-annotation-validators-vb"></a>Проверка с помощью проверяющих элементов управления заметок к данным (VB)

по [Майкрософт](https://github.com/microsoft)

> Воспользуйтесь преимуществами связывателя модели заметок к данным для выполнения проверки в приложении ASP.NET MVC. Узнайте, как использовать различные типы атрибутов проверяющего элемента управления и работать с ними в Microsoft Entity Framework.

В этом руководстве описано, как использовать средства проверки заметок к данным для выполнения проверки в приложении ASP.NET MVC. Преимущество использования средств проверки заметок к данным заключается в том, что они позволяют выполнять проверку просто путем добавления одного или нескольких атрибутов, таких как обязательный или StringLength атрибут, к свойству класса.

Прежде чем можно будет использовать средства проверки заметок к данным, необходимо скачать связыватель модели заметок данных. Вы можете скачать пример привязки модели заметок к данным на веб-сайте CodePlex, щелкнув [здесь](http://aspnet.codeplex.com/Release/ProjectReleases.aspx?ReleaseId=24471).

Важно понимать, что связыватель модели заметок к данным не является официальной частью платформы Microsoft ASP.NET MVC. Хотя связыватель модели заметок данных создан группой Microsoft ASP.NET MVC, корпорация Майкрософт не предлагает официальной поддержки для привязки модели заметок к данным, описанной и используемой в этом руководстве.

## <a name="using-the-data-annotation-model-binder"></a>Использование связывателя модели заметок к данным

Чтобы использовать связыватель модели заметок к данным в приложении MVC ASP.NET, сначала необходимо добавить ссылку на сборку Microsoft. Web. MVC. dll и сборку System. ComponentModel. аннотаций. dll. Выберите пункт меню **проект, добавить ссылку**. Затем перейдите на вкладку **Обзор** и перейдите в расположение, в которое вы скачали (и расzipе) образец привязки модели заметок к данным (см. **рис. 1**).

[![](validation-with-the-data-annotation-validators-vb/_static/image2.png)](validation-with-the-data-annotation-validators-vb/_static/image1.png)

**Рис. 1**. Добавление ссылки на связыватель модели заметок к данным ([щелкните, чтобы просмотреть изображение с полным размером](validation-with-the-data-annotation-validators-vb/_static/image3.png))

Выберите сборку Microsoft. Web. MVC. аннотации. dll и сборку System. ComponentModel. заметок. dll и нажмите кнопку **ОК** .

Сборку System. ComponentModel. аннотаций. dll, входящую в состав .NET Framework с пакетом обновления 1 (SP1), нельзя использовать с связывателем модели заметок данных. Необходимо использовать версию сборки System. ComponentModel. Аннотацияs. dll, входящей в состав образца привязки модели заметок к данным.

Наконец, необходимо зарегистрировать связыватель модели аннотаций в файле Global. asax. Добавьте следующую строку кода в обработчик событий приложения\_Start (), чтобы приложение\_Start () выглядело следующим образом:

[!code-vb[Main](validation-with-the-data-annotation-validators-vb/samples/sample1.vb)]

Эта строка кода регистрирует Датааннотатионсмоделбиндер в качестве связывателя модели по умолчанию для всего приложения ASP.NET MVC.

## <a name="using-the-data-annotation-validator-attributes"></a>Использование атрибутов средства проверки заметок к данным

При использовании связывателя модели заметок данных для выполнения проверки используются атрибуты проверяющего элемента управления. Пространство имен System. ComponentModel. аннотации содержит следующие атрибуты проверяющего элемента управления:

- Range — позволяет проверить, попадает ли значение свойства в указанный диапазон значений.
- RegularExpression — позволяет проверить, соответствует ли значение свойства указанному шаблону регулярного выражения.
- Required — позволяет пометить свойство как обязательное.
- StringLength — позволяет указать максимальную длину для свойства строки.
- Проверка — базовый класс для всех атрибутов проверяющего элемента управления.

> [!NOTE] 
> 
> Если требования проверки не удовлетворяют ни одному из стандартных проверяющих элементов управления, то всегда можно создать настраиваемый атрибут проверяющего элемента управления, наследуя новый атрибут проверяющего элемента управления из базового атрибута проверки.

Класс Product в **листинге 1** показывает, как использовать эти атрибуты проверяющего элемента управления. Свойства Name, Description и UnitPrice помечаются как обязательные. Длина строки в свойстве Name должна быть меньше 10 символов. Наконец, свойство UnitPrice должно соответствовать шаблону регулярного выражения, представляющему денежную сумму.

[!code-vb[Main](validation-with-the-data-annotation-validators-vb/samples/sample2.vb)]

**Листинг 1**. моделс\продукт.ВБ

Класс Product показывает, как использовать один дополнительный атрибут: атрибут DisplayName. Атрибут DisplayName позволяет изменить имя свойства при отображении свойства в сообщении об ошибке. Вместо отображения сообщения об ошибке "поле UnitPrice является обязательным" можно отобразить сообщение об ошибке "поле цены является обязательным".

> [!NOTE] 
> 
> Если необходимо полностью настроить сообщение об ошибке, отображаемое проверяющим элементом управления, можно назначить пользовательское сообщение об ошибке свойству ErrorMessage проверяющего элемента следующим образом: `<Required(ErrorMessage:="This field needs a value!")>`

Вы можете использовать класс Product в **листинге 1** с действием контроллера Create () в **листинге 2**. Это действие контроллера повторно отображает представление создания, когда состояние модели содержит ошибки.

[!code-vb[Main](validation-with-the-data-annotation-validators-vb/samples/sample3.vb)]

**Листинг 2**: контроллерс\продуктконтроллер.ВБ

Наконец, можно создать представление в **листинге 3** , щелкнув правой кнопкой мыши действие создать () и выбрав пункт меню **Добавить представление**. Создайте строго типизированное представление с классом Product в качестве класса модели. Выберите **создать** из раскрывающегося списка Просмотр содержимого (см. **рис. 2**).

[![](validation-with-the-data-annotation-validators-vb/_static/image5.png)](validation-with-the-data-annotation-validators-vb/_static/image4.png)

**Рис. 2**. Добавление представления создания

[!code-aspx[Main](validation-with-the-data-annotation-validators-vb/samples/sample4.aspx)]

**Листинг 3**: виевс\продукт\креате.аспкс

> [!NOTE] 
> 
> Удалите поле идентификатор из формы создать, созданной с помощью команды меню **Добавить представление** . Поскольку поле идентификатор соответствует столбцу идентификаторов, вы не хотите, чтобы пользователи вводили значение этого поля.

Если вы отправите форму для создания продукта и не вводите значения для обязательных полей, отобразятся сообщения об ошибках проверки на **рис. 3** .

[![](validation-with-the-data-annotation-validators-vb/_static/image7.png)](validation-with-the-data-annotation-validators-vb/_static/image6.png)

**Рис. 3**. отсутствие обязательных полей

При вводе недопустимой суммы валюты отображается сообщение об ошибке на **рис. 4** .

[![](validation-with-the-data-annotation-validators-vb/_static/image9.png)](validation-with-the-data-annotation-validators-vb/_static/image8.png)

**Рис. 4**. недопустимая сумма валюты

## <a name="using-data-annotation-validators-with-the-entity-framework"></a>Использование проверяющих элементов управления заметок к данным с Entity Framework

Если вы используете Microsoft Entity Framework для создания классов модели данных, нельзя применить атрибуты проверяющего элемента управления непосредственно к классам. Поскольку Entity Framework Designer создает классы модели, любые изменения, вносимые в классы модели, будут перезаписаны при следующем внесении изменений в конструкторе.

Если вы хотите использовать проверяющие элементы управления с классами, созданными Entity Framework то необходимо создать классы Meta Data. Проверяющие элементы управления применяются к классу Meta Data, а не к фактическому классу.

Например, представьте, что вы создали класс Movie с помощью Entity Framework (см. **рис. 5**). Предположим, что необходимо сделать так, чтобы название фильма и свойства режиссера требовали свойств. В этом случае можно создать разделяемый класс и класс метаданных в **листинге 4**.

[![](validation-with-the-data-annotation-validators-vb/_static/image11.png)](validation-with-the-data-annotation-validators-vb/_static/image10.png)

**Рис. 5**. класс Movie, созданный Entity Framework

[!code-vb[Main](validation-with-the-data-annotation-validators-vb/samples/sample5.vb)]

**Листинг 4**. моделс\мовие.ВБ

Файл в **листинге 4** содержит два класса с именами Movie и мовиеметадата. Класс Movie является разделяемым классом. Он соответствует разделяемому классу, созданному Entity Framework, который содержится в файле модели DOM. Designer. vb.

В настоящее время платформа .NET Framework не поддерживает разделяемые свойства. Таким образом, невозможно применить атрибуты проверяющего элемента управления к свойствам класса Movie, определенного в файле Model. Designer. vb, применив атрибуты проверяющего элемента управления к свойствам класса Movie, определенного в файле в **листинге 4**.

Обратите внимание, что разделяемый класс Movie снабжен атрибутом Метадататипе, который указывает на класс Мовиеметадата. Класс Мовиеметадата содержит свойства прокси-сервера для свойств класса Movie.

Атрибуты проверяющего элемента управления применяются к свойствам класса Мовиеметадата. Свойства Title, режиссер и Датерелеасед помечены как обязательные свойства. Свойству Director должно быть присвоено строковое значение, содержащее менее 5 символов. Наконец, атрибут DisplayName применяется к свойству Датерелеасед для вывода сообщения об ошибке, например "требуется Дата выпуска поля". вместо ошибки "поле Датерелеасед является обязательным".

> [!NOTE] 
> 
> Обратите внимание, что свойства прокси-сервера в классе Мовиеметадата не должны представлять те же типы, что и соответствующие свойства в классе Movie. Например, свойство Director является строковым свойством в классе Movie и свойством объекта в классе Мовиеметадата.

На странице на **рис. 6** показаны сообщения об ошибках, возвращаемые при вводе недопустимых значений свойств фильма.

[![](validation-with-the-data-annotation-validators-vb/_static/image13.png)](validation-with-the-data-annotation-validators-vb/_static/image12.png)

**Рис. 6**. использование проверяющих элементов управления с Entity Framework ([щелкните, чтобы просмотреть изображение с полным размером](validation-with-the-data-annotation-validators-vb/_static/image14.png))

## <a name="summary"></a>Сводка

В этом руководстве вы узнали, как использовать преимущества связывателя модели заметок к данным для выполнения проверки в приложении ASP.NET MVC. Вы узнали, как использовать различные типы атрибутов проверяющего элемента управления, такие как обязательные и StringLength атрибуты. Вы также узнали, как использовать эти атрибуты при работе с Microsoft Entity Framework.

> [!div class="step-by-step"]
> [Назад](validating-with-a-service-layer-vb.md)
