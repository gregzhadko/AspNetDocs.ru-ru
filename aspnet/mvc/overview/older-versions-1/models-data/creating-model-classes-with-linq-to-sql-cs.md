---
uid: mvc/overview/older-versions-1/models-data/creating-model-classes-with-linq-to-sql-cs
title: Создание классов моделей с помощью LINQ to SQLC#() | Документация Майкрософт
author: microsoft
description: Цель этого руководства — объяснить один метод создания классов моделей для приложения ASP.NET MVC. В этом руководстве вы узнаете, как создать модель c...
ms.author: riande
ms.date: 10/07/2008
ms.assetid: f84b4a16-e8bb-49e8-87a0-1832879a3501
msc.legacyurl: /mvc/overview/older-versions-1/models-data/creating-model-classes-with-linq-to-sql-cs
msc.type: authoredcontent
ms.openlocfilehash: c27d1ffac3846fe4bc13b32c2ae91a63b2493126
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78437190"
---
# <a name="creating-model-classes-with-linq-to-sql-c"></a>Создание классов модели в LINQ to SQL (C#)

по [Майкрософт](https://github.com/microsoft)

[Скачать в формате PDF](https://download.microsoft.com/download/1/1/f/11f721aa-d749-4ed7-bb89-a681b68894e6/ASPNET_MVC_Tutorial_10_CS.pdf)

> Цель этого руководства — объяснить один метод создания классов моделей для приложения ASP.NET MVC. В этом руководстве вы узнаете, как создавать классы модели и выполнять доступ к базе данных, используя преимущества Microsoft LINQ to SQL.

Цель этого руководства — объяснить один метод создания классов моделей для приложения ASP.NET MVC. В этом руководстве вы узнаете, как создавать классы модели и выполнять доступ к базе данных, используя преимущества Microsoft LINQ to SQL

В этом руководстве мы создадим простое приложение базы данных фильмов. Начнем с создания приложения базы данных фильмов с самым быстрым и простым способом. Мы выполняем все наши действия по доступу к данным непосредственно из наших действий контроллера.

Далее вы узнаете, как использовать шаблон репозитория. Для использования шаблона репозитория требуется немного больше работы. Однако преимущество этого подхода заключается в том, что он позволяет создавать приложения, которые можно адаптировать к изменению и легко тестировать.

## <a name="what-is-a-model-class"></a>Что такое класс модели?

Модель MVC содержит всю логику приложения, которая не содержится в представлении MVC или контроллере MVC. В частности, модель MVC содержит все бизнес-приложения и логику доступа к данным.

Для реализации логики доступа к данным можно использовать различные технологии. Например, можно создать классы доступа к данным с помощью классов Microsoft Entity Framework, NHibernate, Sonic или ADO.NET.

В этом руководстве я использую LINQ to SQL для запроса и обновления базы данных. LINQ to SQL предоставляет очень простой способ взаимодействия с Microsoft SQL Server базой данных. Однако важно понимать, что платформа ASP.NET MVC не привязана к LINQ to SQL каким-либо образом. ASP.NET MVC совместим с любыми технологиями доступа к данным.

## <a name="create-a-movie-database"></a>Создание базы данных фильмов

В этом учебнике, чтобы продемонстрировать, как можно создавать классы моделей, мы создаем простое приложение базы данных фильмов. Первым шагом является создание новой базы данных. Щелкните правой кнопкой мыши папку данных приложения\_в окне обозреватель решений и выберите пункт меню **Добавить, новый элемент**. Выберите шаблон **базы данных SQL Server** , присвойте ему имя мовиесдб. mdf и нажмите кнопку **Добавить** (см. рис. 1).

[![Добавление новой базы данных SQL Server](creating-model-classes-with-linq-to-sql-cs/_static/image2.png)](creating-model-classes-with-linq-to-sql-cs/_static/image1.png)

**Рис. 01**. Добавление новой базы данных SQL Server ([щелкните, чтобы просмотреть изображение с полным размером](creating-model-classes-with-linq-to-sql-cs/_static/image3.png))

После создания новой базы данных ее можно открыть, дважды щелкнув файл Мовиесдб. mdf в папке App\_Data. Если дважды щелкнуть файл Мовиесдб. mdf, откроется окно обозреватель сервера (см. рис. 2).

Окно обозреватель сервера называется окном обозреватель базы данных при использовании Visual Web Developer.

[![с помощью окна обозреватель сервера](creating-model-classes-with-linq-to-sql-cs/_static/image5.png)](creating-model-classes-with-linq-to-sql-cs/_static/image4.png)

**Рис. 02**. использование окна Обозреватель сервера ([щелкните, чтобы просмотреть изображение с полным размером](creating-model-classes-with-linq-to-sql-cs/_static/image6.png))

Нам нужно добавить в нашу базу данных одну таблицу, которая представляет наши фильмы. Щелкните правой кнопкой мыши папку таблицы и выберите пункт меню **Добавить новую таблицу**. При выборе этого пункта меню открывается конструктор таблиц (см. рис. 3).

[![с помощью окна обозреватель сервера](creating-model-classes-with-linq-to-sql-cs/_static/image8.png)](creating-model-classes-with-linq-to-sql-cs/_static/image7.png)

**Рис. 03**. конструктор таблиц ([щелкните, чтобы просмотреть изображение с полным размером](creating-model-classes-with-linq-to-sql-cs/_static/image9.png))

Необходимо добавить в таблицу базы данных следующие столбцы:

| **Имя столбца** | **Тип данных** | **Разрешить значения NULL** |
| --- | --- | --- |
| Идентификатор | Int | False |
| Title | Nvarchar (200) | False |
| Директор | Nvarchar (50) | False |

Необходимо выполнить два специальных действия в столбце ID. Сначала необходимо пометить столбец ID как первичный ключевой столбец, выбрав столбец в конструктор таблиц и щелкнув значок ключа. LINQ to SQL требует указать столбцы первичного ключа при выполнении операций вставки или обновления базы данных.

Затем необходимо пометить столбец идентификаторов как столбец идентификаторов, назначив значение Yes свойству **Identity** (см. рис. 3). Столбец идентификаторов — это столбец, который автоматически назначается новому номеру при добавлении новой строки данных в таблицу.

## <a name="create-linq-to-sql-classes"></a>Создание классов LINQ to SQL

Наша модель MVC будет содержать LINQ to SQL классы, представляющие таблицу базы данных Тблмовие. Самый простой способ создать эти LINQ to SQL классов — щелкнуть правой кнопкой мыши папку Models, выбрать **Добавить, создать элемент**, выбрать шаблон LINQ to SQL классы, присвоить классам имя Movie. dbml и нажать кнопку **Добавить** (см. рис. 4).

[![создания классов LINQ to SQL](creating-model-classes-with-linq-to-sql-cs/_static/image11.png)](creating-model-classes-with-linq-to-sql-cs/_static/image10.png)

**Рис. 04**. создание классов LINQ to SQL ([щелкните, чтобы просмотреть изображение с полным размером](creating-model-classes-with-linq-to-sql-cs/_static/image12.png))

Сразу после создания LINQ to SQL классов фильмов отображается реляционный конструктор объектов. Таблицы базы данных можно перетащить из окна обозреватель сервера в реляционный конструктор объектов, чтобы создать LINQ to SQL классы, представляющие определенные таблицы базы данных. Необходимо добавить таблицу базы данных Тблмовие на реляционный конструктор объектов (см. рис. 5).

[![с помощью реляционный конструктор объектов](creating-model-classes-with-linq-to-sql-cs/_static/image14.png)](creating-model-classes-with-linq-to-sql-cs/_static/image13.png)

**Рис. 05**. использование Реляционный конструктор объектов ([щелкните, чтобы просмотреть изображение с полным размером](creating-model-classes-with-linq-to-sql-cs/_static/image15.png))

По умолчанию реляционный конструктор объектов создает класс с тем же именем, что и таблица базы данных, которую можно перетащить в конструктор. Однако мы не хотим вызывать наш класс `tblMovie`. Поэтому щелкните имя класса в конструкторе и измените имя класса на Movie.

Наконец, не забудьте нажать кнопку **сохранить** (изображение дискеты), чтобы сохранить LINQ to SQL классы. В противном случае LINQ to SQL классы не будут создаваться реляционный конструктор объектов.

## <a name="using-linq-to-sql-in-a-controller-action"></a>Использование LINQ to SQL в действии контроллера

Теперь, когда у нас есть классы LINQ to SQL, мы можем использовать эти классы для получения данных из базы данных. В этом разделе вы узнаете, как использовать классы LINQ to SQL непосредственно в действии контроллера. Будет отображен список фильмов из таблицы базы данных Тблмовиес в представлении MVC.

Сначала необходимо изменить класс HomeController. Этот класс можно найти в папке Controllers вашего приложения. Измените класс так, чтобы он выглядел как класс в листинге 1.

**Листинг 1 — `Controllers\HomeController.cs`**

[!code-csharp[Main](creating-model-classes-with-linq-to-sql-cs/samples/sample1.cs)]

Действие `Index()` в листинге 1 использует LINQ to SQL класс DataContext (`MovieDataContext`) для представления базы данных `MoviesDB`. Класс `MoveDataContext` был создан реляционный конструктор объектов Visual Studio.

Запрос LINQ выполняется в контексте DataContext для извлечения всех фильмов из таблицы базы данных `tblMovies`. Список фильмов назначается локальной переменной с именем `movies`. Наконец, список фильмов передается в представление через данные представления.

Чтобы показать фильмы, необходимо изменить представление индекса. Представление индекса можно найти в папке `Views\Home\`. Обновите представление индекса так, чтобы оно выглядело как представление в листинге 2.

**Листинг 2 — `Views\Home\Index.aspx`**

[!code-aspx[Main](creating-model-classes-with-linq-to-sql-cs/samples/sample2.aspx)]

Обратите внимание, что измененное представление индекса включает в себя директиву `<%@ import namespace %>` в верхней части представления. Эта директива импортирует `MvcApplication1.Models namespace`. Это пространство имен требуется для работы с `model` классами (в частности, `Movie` класса) в представлении.

Представление в листинге 2 содержит цикл `foreach`, который выполняет итерацию по всем элементам, представленным свойством `ViewData.Model`. Для каждого `movie`отображается значение свойства `Title`.

Обратите внимание, что значение свойства `ViewData.Model` приводится к `IEnumerable`. Это необходимо для прохода по содержимому `ViewData.Model`. Другой вариант — создать строго типизированный `view`. При создании строго типизированного `view`вы приводите свойство `ViewData.Model` к определенному типу в классе кода программной части представления.

Если запустить приложение после изменения класса `HomeController` и представления индекса, будет выведена пустая страница. Вы получите пустую страницу, так как в таблице базы данных `tblMovies` нет записей фильмов.

Чтобы добавить записи в таблицу базы данных `tblMovies`, щелкните правой кнопкой мыши таблицу `tblMovies` базу данных в окне обозреватель сервера (обозреватель базы данных окно в Visual Web Developer) и выберите пункт меню отобразить данные таблицы. Записи `movie` можно вставить с помощью отображенной сетки (см. рис. 6).

[![вставки фильмов](creating-model-classes-with-linq-to-sql-cs/_static/image17.png)](creating-model-classes-with-linq-to-sql-cs/_static/image16.png)

**Рис. 06**. Вставка фильмов ([щелкните, чтобы просмотреть изображение с полным размером](creating-model-classes-with-linq-to-sql-cs/_static/image18.png))

После добавления некоторых записей базы данных в таблицу `tblMovies` и запуска приложения вы увидите страницу на рис. 7. Все записи базы данных фильмов отображаются в маркированном списке.

[![отображения фильмов с представлением индекса](creating-model-classes-with-linq-to-sql-cs/_static/image20.png)](creating-model-classes-with-linq-to-sql-cs/_static/image19.png)

**Рис. 07**. Отображение фильмов с представлением индекса ([щелкните, чтобы просмотреть изображение с полным размером](creating-model-classes-with-linq-to-sql-cs/_static/image21.png))

## <a name="using-the-repository-pattern"></a>Использование шаблона репозитория

В предыдущем разделе мы использовали LINQ to SQL классы непосредственно в действии контроллера. Класс `MovieDataContext` использовался непосредственно в действии контроллера `Index()`. В случае простого приложения ничего неверно. Однако работа непосредственно с LINQ to SQL в классе Controller создает проблемы при необходимости создания более сложного приложения.

Использование LINQ to SQL в классе контроллера затрудняет переключение технологий доступа к данным в будущем. Например, вы можете переключиться с использования Microsoft LINQ to SQL на использование Entity Framework Майкрософт в качестве технологии доступа к данным. В этом случае потребуется переписать все контроллеры, которые обращаются к базе данных в приложении.

Использование LINQ to SQL в классе контроллера также затрудняет создание модульных тестов для приложения. Как правило, при выполнении модульных тестов взаимодействие с базой данных не требуется. Вы хотите использовать модульные тесты для тестирования логики приложения, а не сервера базы данных.

Чтобы создать приложение MVC, которое лучше адаптируется к последующим изменениям и может быть более легко протестировано, следует использовать шаблон репозитория. При использовании шаблона репозитория создается отдельный класс репозитория, который содержит всю логику доступа к базе данных.

При создании класса репозитория создается интерфейс, который представляет все методы, используемые классом репозитория. На контроллерах вы пишете код в интерфейсе, а не в репозитории. Таким образом, вы можете реализовать репозиторий, используя различные технологии доступа к данным в будущем.

Интерфейс в листинге 3 называется `IMovieRepository` и представляет отдельный метод с именем `ListAll()`.

**Листинг 3 — `Models\IMovieRepository.cs`**

[!code-csharp[Main](creating-model-classes-with-linq-to-sql-cs/samples/sample3.cs)]

Класс репозитория в листинге 4 реализует интерфейс `IMovieRepository`. Обратите внимание, что он содержит метод с именем `ListAll()`, соответствующий методу, который требуется интерфейсу `IMovieRepository`.

**Листинг 4 — `Models\MovieRepository.cs`**

[!code-csharp[Main](creating-model-classes-with-linq-to-sql-cs/samples/sample4.cs)]

Наконец, класс `MoviesController` в листинге 5 использует шаблон репозитория. Он больше не использует классы LINQ to SQL напрямую.

**Листинг 5 — `Controllers\MoviesController.cs`**

[!code-csharp[Main](creating-model-classes-with-linq-to-sql-cs/samples/sample5.cs)]

Обратите внимание, что класс `MoviesController` в листинге 5 имеет два конструктора. Первый конструктор, конструктор без параметров, вызывается при запуске приложения. Этот конструктор создает экземпляр класса `MovieRepository` и передает его второму конструктору.

Второй конструктор имеет один параметр: `IMovieRepository` параметр. Этот конструктор просто присваивает значение параметра полю уровня класса с именем `_repository`.

Класс `MoviesController` использует преимущества шаблона разработки программного обеспечения, который называется шаблоном внедрения зависимостей. В частности, используется нечто, именуемое внедрением зависимостей конструктора. Дополнительные сведения об этом шаблоне см. в следующей статье: Фаулер.

[http://martinfowler.com/articles/injection.html](http://martinfowler.com/articles/injection.html)

Обратите внимание, что весь код в классе `MoviesController` (за исключением первого конструктора) взаимодействует с интерфейсом `IMovieRepository`, а не с фактическим классом `MovieRepository`. Код взаимодействует с абстрактным интерфейсом, а не с конкретной реализацией интерфейса.

Если вы хотите изменить технологию доступа к данным, используемую приложением, можно просто реализовать интерфейс `IMovieRepository` с помощью класса, использующего альтернативную технологию доступа к базе данных. Например, можно создать класс `EntityFrameworkMovieRepository` или `SubSonicMovieRepository`. Поскольку класс контроллера запрограммирован на интерфейс, можно передать новую реализацию `IMovieRepository` классу Controller, и класс будет продолжать работать.

Кроме того, если нужно протестировать класс `MoviesController`, можно передать фиктивный класс репозитория фильмов в `HomeController`. Класс `IMovieRepository` можно реализовать с помощью класса, который на самом деле не обращается к базе данных, но содержит все необходимые методы интерфейса `IMovieRepository`. Таким образом, модульное тестирование класса `MoviesController` можно выполнять без фактического доступа к реальной базе данных.

## <a name="summary"></a>Сводка

Цель этого учебника — продемонстрировать, как можно создавать классы модели MVC, используя преимущества Microsoft LINQ to SQL. Мы рассмотрели две стратегии отображения данных базы данных в приложении ASP.NET MVC. Во-первых, мы создали LINQ to SQL классы и использовали классы непосредственно в действии контроллера. Использование классов LINQ to SQL в контроллере позволяет быстро и легко отображать данные базы данных в приложении MVC.

Далее мы проучили немного сложнее, но, несомненно, более тем самым эффективный, путь для отображения данных базы данных. Мы использовали преимущества шаблона репозитория и поместили всю логику доступа к базе данных в отдельный класс репозитория. В нашем контроллере мы написали весь наш код по интерфейсу, а не к конкретному классу. Преимуществом шаблона репозитория является то, что он позволяет нам легко изменять технологии доступа к базе данных в будущем и позволяет нам легко тестировать наши классы контроллеров.

> [!div class="step-by-step"]
> [Назад](creating-model-classes-with-the-entity-framework-cs.md)
> [Вперед](displaying-a-table-of-database-data-cs.md)
