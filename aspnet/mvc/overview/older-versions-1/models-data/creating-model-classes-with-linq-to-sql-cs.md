---
uid: mvc/overview/older-versions-1/models-data/creating-model-classes-with-linq-to-sql-cs
title: Создание типовых классов с помощью LIN- в СЗЛ (СЗ) Документы Майкрософт
author: rick-anderson
description: Цель этого учебника состоит в том, чтобы объяснить один метод создания типов моделей для ASP.NET mVC-приложении. В этом учебнике, вы узнаете, как построить модель c ...
ms.author: riande
ms.date: 10/07/2008
ms.assetid: f84b4a16-e8bb-49e8-87a0-1832879a3501
msc.legacyurl: /mvc/overview/older-versions-1/models-data/creating-model-classes-with-linq-to-sql-cs
msc.type: authoredcontent
ms.openlocfilehash: eac6fec3a4cfd833b810378d946874a246d9a2c3
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2020
ms.locfileid: "81542733"
---
# <a name="creating-model-classes-with-linq-to-sql-c"></a>Создание классов модели в LINQ to SQL (C#)

[корпорацией Майкрософт](https://github.com/microsoft)

[Скачать PDF](https://download.microsoft.com/download/1/1/f/11f721aa-d749-4ed7-bb89-a681b68894e6/ASPNET_MVC_Tutorial_10_CS.pdf)

> Цель этого учебника состоит в том, чтобы объяснить один метод создания типов моделей для ASP.NET mVC-приложении. В этом уроке вы узнаете, как создавать классы моделей и выполнять доступ к базе данных, пользуясь преимуществами Microsoft LIN' для S'L.

Цель этого учебника состоит в том, чтобы объяснить один метод создания типов моделей для ASP.NET mVC-приложении. В этом уроке вы узнаете, как создавать классы моделей и выполнять доступ к базе данных, пользуясь преимуществами Microsoft LIN' для S'L

В этом учебнике мы создаем базовое приложение базы данных Movie. Мы начинаем с создания приложения базы данных Movie самым быстрым и простым способом. Мы выполняем весь наш доступ к данным непосредственно от наших действий контроллера.

Далее вы узнаете, как использовать шаблон репозитория. Использование шаблона репозитория требует немного больше работы. Однако преимущество множества этого шаблона заключается в том, что он позволяет создавать приложения, которые адаптируются к изменениям и могут быть легко протестированы.

## <a name="what-is-a-model-class"></a>Что такое модельный класс?

Модель MVC содержит всю логику приложения, которая не содержится в представлении MVC или контроллере MVC. В частности, модель MVC содержит все ваши бизнес-приложения и логику доступа к данным.

Вы можете использовать различные технологии для реализации логики доступа к данным. Например, можно создать классы доступа к данным с помощью рамочных рамок Сущности Майкрософт, NHibernate, Subsonic или ADO.NET классов.

В этом учебнике я использую LIN'l для запроса и обновления базы данных. Компания «ЛИНЗ» и «СЗЛ» предоставляет вам очень простой метод взаимодействия с базой данных Microsoft S'L Server. Тем не менее, важно понимать, что ASP.NET платформа MVC никоим образом не привязана к LIN-образу и S'L. ASP.NET MVC совместим с любой технологией доступа к данным.

## <a name="create-a-movie-database"></a>Создание базы данных фильмов

В этом уроке , чтобы проиллюстрировать, как можно создавать классы моделей, мы создаем простое приложение базы данных Movie. Первым шагом является создание новой базы данных. Нажмите правой\_кнопкой папку App Data в окне Solution Explorer и выберите опцию меню **Добавить, Новый пункт**. Выберите шаблон **базы данных сервера S'L** Server, назовите его именем MoviesDB.mdf и нажмите кнопку **Добавить** (см. рисунок 1).

[![Добавление новой базы данных серверов S'L](creating-model-classes-with-linq-to-sql-cs/_static/image2.png)](creating-model-classes-with-linq-to-sql-cs/_static/image1.png)

**Рисунок 01**: Добавление новой базы данных серверов S'L[(Нажмите, чтобы просмотреть полноразмерное изображение)](creating-model-classes-with-linq-to-sql-cs/_static/image3.png)

После создания новой базы данных можно открыть базу данных, дважды нажав\_файл MoviesDB.mdf в папке App Data. Двойное нажатие файла MoviesDB.mdf открывает окно Server Explorer (см. рисунок 2).

Окно Server Explorer называется окном Database Explorer при использовании визуального веб-разработчика.

[![Использование окна Server Explorer](creating-model-classes-with-linq-to-sql-cs/_static/image5.png)](creating-model-classes-with-linq-to-sql-cs/_static/image4.png)

**Рисунок 02**: Использование окна Server Explorer[(Нажмите, чтобы просмотреть полноразмерное изображение)](creating-model-classes-with-linq-to-sql-cs/_static/image6.png)

Нам нужно добавить одну таблицу в нашу базу данных, которая представляет наши фильмы. Нажмите правой кнопкой папку Таблицы и выберите вариант меню **Добавить новый стол.** Выбор этой опции меню открывает конструктор таблицы (см. рисунок 3).

[![Использование окна Server Explorer](creating-model-classes-with-linq-to-sql-cs/_static/image8.png)](creating-model-classes-with-linq-to-sql-cs/_static/image7.png)

**Рисунок 03**: Таблица Дизайнер ([Нажмите, чтобы посмотреть полноразмерное изображение](creating-model-classes-with-linq-to-sql-cs/_static/image9.png))

Нам нужно добавить следующие столбцы в таблицу базы данных:

| **Имя столбца** | **Тип данных** | **Разрешить значения NULL** |
| --- | --- | --- |
| Идентификатор | Int | False |
| Title | Нварчар (200) | False |
| Директор | Нварчар (50) | False |

Вы должны сделать две специальные вещи для колонки Id. Во-первых, необходимо отметить столбец Id в качестве основного ключевого столбца, выбрав столбец в таблице Designer и нажав значок ключа. При выполнении вставок или обновлений в базе данных необходимо указать основные ключевые столбцы.

Далее необходимо пометить столбец Id в качестве столбца identity, назначив значение «Да» свойству **Is Identity** (см. рисунок 3). Столбец идентификации — это столбец, который автоматически присваивается новому номеру при добавлении новой строки данных в таблицу.

## <a name="create-linq-to-sql-classes"></a>Создание LIN-класса для классов S'L

Наша модель MVC будет содержать классы LIN' to S'L, представляющие таблицу базы данных tblMovie. Самый простой способ создать эти классы LIN' в S'L — это нажать правой кнопкой кнопку «Модели», выберите **Добавить, новый пункт,** выберите шаблон LIN' для s'L Classes, дать классам название Movie.dbml и нажать кнопку **«Добавить»** (см. рисунок 4).

[![Создание классов LIN-in s-L](creating-model-classes-with-linq-to-sql-cs/_static/image11.png)](creating-model-classes-with-linq-to-sql-cs/_static/image10.png)

**Рисунок 04**: Создание LIN-класса для классов S'L[(Нажмите, чтобы просмотреть полноразмерное изображение)](creating-model-classes-with-linq-to-sql-cs/_static/image12.png)

Сразу же после создания фильма LIN' для классов S'L появляется объектреляальный конструктор. Можно перетащить таблицы баз данных из окна Server Explorer в объектный реляционный конструктор для создания классов LIN'а в S-L, представляющих определенные таблицы баз данных. Нам нужно добавить таблицу базы данных tblMovie на объектрелую реляционную конструктор (см. рисунок 5).

[![Использование объектного реляционный конструктор](creating-model-classes-with-linq-to-sql-cs/_static/image14.png)](creating-model-classes-with-linq-to-sql-cs/_static/image13.png)

**Рисунок 05**: Использование объекта реляционный конструктор ([Нажмите, чтобы посмотреть полноразмерное изображение](creating-model-classes-with-linq-to-sql-cs/_static/image15.png))

По умолчанию объектреляритный конструктор создает класс с тем же именем, что и таблица базы данных, которую вы перетаскиваете на конструктора. Тем не менее, мы не `tblMovie`хотим называть наш класс . Таким образом, нажмите на имя класса в Designer и изменить название класса на фильм.

Наконец, не забудьте нажать кнопку **«Сохранить»** (изображение дискеты), чтобы сохранить LIN-классы для S'L. В противном случае классы LIN's to S'L не будут сгенерированы проектировщиком отношений объектов.

## <a name="using-linq-to-sql-in-a-controller-action"></a>Использование ЛИНЗ для СЗЛ в действии контроллера

Теперь, когда у нас есть классы LIN's to S'L, мы можем использовать эти классы для извлечения данных из базы данных. В этом разделе вы узнаете, как использовать lin'l для классов S'L непосредственно в рамках действия контроллера. Мы подемонстрируем список фильмов из таблицы данных tblMovies в представлении MVC.

Во-первых, нам нужно изменить класс HomeController. Этот класс можно найти в папке контроллеров вашего приложения. Изменение класса, чтобы он выглядел как класс в листинге 1.

**Список 1 -`Controllers\HomeController.cs`**

[!code-csharp[Main](creating-model-classes-with-linq-to-sql-cs/samples/sample1.cs)]

Для `Index()` представления `MoviesDB` базы данных в листинге 1 используется `MovieDataContext`класс LIN' to s'L DataContext (the) для представления базы данных. Класс `MoveDataContext` был создан Visual Studio Объект реляционный конструктор.

Запрос LIN'а выполняется против DataContext для извлечения `tblMovies` всех фильмов из таблицы базы данных. Список фильмов присваивается `movies`локальной переменной с именем. Наконец, список фильмов передается в представление через данные представления.

Для того, чтобы показать фильмы, нам необходимо изменить представление индекса. Представление индекса можно найти `Views\Home\` в папке. Обновите представление индекса так, чтобы оно выглядело как представление в листинге 2.

**Список 2 -`Views\Home\Index.aspx`**

[!code-aspx[Main](creating-model-classes-with-linq-to-sql-cs/samples/sample2.aspx)]

Обратите внимание, что измененное представление индекса содержит директиву `<%@ import namespace %>` в верхней части представления. Эта директива `MvcApplication1.Models namespace`импортирует . Нам нужно это пространство имен, `model` чтобы работать с `Movie` классами - в частности, с классом - в представлении.

Представление в листинге `foreach` 2 содержит цикл, итерирует все элементы, представленные `ViewData.Model` свойством. Значение `Title` свойства отображается для каждого. `movie`

Обратите внимание, что `ViewData.Model` стоимость свойства `IEnumerable`отлита в. Это необходимо для того, чтобы `ViewData.Model`цикл через содержимое . Другой вариант здесь заключается в `view`создании сильно типик . При создании сильно набранного `view`типа `ViewData.Model` вы отбрасываете свойство к определенному типу в классе кода представления.

Если вы запустите приложение `HomeController` после изменения класса и представления индекса, то вы получите пустую страницу. Вы получите пустую страницу, потому что `tblMovies` в таблице базы данных нет записей фильмов.

Чтобы добавить записи `tblMovies` в таблицу базы `tblMovies` данных, нажмите правой кнопкой мыши таблицы базы данных в окне Server Explorer (окно Database Explorer в Visual Web Developer) и выберите вариант меню Show Table Data. Вы можете `movie` вставить записи с помощью сети, которая появляется (см. рисунок 6).

[![Вставка фильмов](creating-model-classes-with-linq-to-sql-cs/_static/image17.png)](creating-model-classes-with-linq-to-sql-cs/_static/image16.png)

**Рисунок 06**: Вставка фильмов[(Нажмите, чтобы посмотреть полноразмерное изображение](creating-model-classes-with-linq-to-sql-cs/_static/image18.png))

После добавления некоторых `tblMovies` записей баз данных в таблицу и запуска приложения вы увидите страницу на рисунке 7. Все записи базы данных фильмов отображаются в списке.

[![Отображение фильмов с представлением индекса](creating-model-classes-with-linq-to-sql-cs/_static/image20.png)](creating-model-classes-with-linq-to-sql-cs/_static/image19.png)

**Рисунок 07**: Отображение фильмов с представлением индекса[(Нажмите, чтобы просмотреть полноразмерное изображение)](creating-model-classes-with-linq-to-sql-cs/_static/image21.png)

## <a name="using-the-repository-pattern"></a>Использование шаблона репозитория

В предыдущем разделе мы использовали lin's для классов S'L непосредственно в рамках действия контроллера. Мы использовали `MovieDataContext` класс непосредственно `Index()` из действия контроллера. Нет ничего плохого в этом в случае простого приложения. Тем не менее, работа непосредственно с LIN'а к S'L в классе контроллера создает проблемы, когда вам нужно построить более сложное приложение.

Использование LIN'а для S'L в классе контроллеров затрудняет переключение технологий доступа к данным в будущем. Например, можно принять решение о переходе от использования Microsoft LIN' к S-L к использованию рамочной программы Сущности Майкрософт в качестве технологии доступа к данным. В этом случае необходимо переписать каждый контроллер, который получает доступ к базе данных в приложении.

Использование LIN's для S'L в классе контроллеров также затрудняет создание модульных тестов для вашего приложения. Обычно при выполнении модульных тестов не требуется взаимодействовать с базой данных. Вы хотите использовать модульные тесты для проверки логики приложения, а не сервера базы данных.

Для того, чтобы создать приложение MVC, которое более адаптируется к будущим изменениям и которое может быть более легко протестировано, следует рассмотреть возможность использования шаблона репозитория. При использовании шаблона репозитория создается отдельный класс репозитория, содержащий всю логику доступа к базе данных.

При создании класса репозитория создается интерфейс, представляющий все методы, используемые классом репозитория. В контроллерах вы пишете свой код против интерфейса, а не для репозитория. Таким образом, в будущем можно реализовать репозиторий с использованием различных технологий доступа к данным.

Интерфейс в листинге `IMovieRepository` 3 назван и представляет `ListAll()`собой единый метод под названием.

**Список 3 -`Models\IMovieRepository.cs`**

[!code-csharp[Main](creating-model-classes-with-linq-to-sql-cs/samples/sample3.cs)]

Класс репозитория в листинге `IMovieRepository` 4 реализует интерфейс. Обратите внимание, что `ListAll()` он содержит метод, названный, который соответствует методу, требуемому интерфейсом. `IMovieRepository`

**Список 4 -`Models\MovieRepository.cs`**

[!code-csharp[Main](creating-model-classes-with-linq-to-sql-cs/samples/sample4.cs)]

Наконец, `MoviesController` класс в листинге 5 использует шаблон репозитория. Он больше не использует LIN'l для непосредственного использования классов S'L.

**Список 5 -`Controllers\MoviesController.cs`**

[!code-csharp[Main](creating-model-classes-with-linq-to-sql-cs/samples/sample5.cs)]

Обратите внимание, что класс в листинге `MoviesController` 5 имеет два конструктора. Первый конструктор, без параметров конструктор, вызывается при запуске приложения. Этот конструктор создает экземпляр `MovieRepository` класса и передает его второму конструктору.

Второй конструктор имеет один параметр: `IMovieRepository` параметр. Этот конструктор просто присваивает значение параметра области `_repository`уровня класса под названием.

Класс `MoviesController` использует шаблон проектирования программного обеспечения, называемый шаблоном инъекций зависимостей. В частности, он использует так называемый инъекций зависимости конструктора. Вы можете прочитать больше об этой модели, прочитав следующую статью Мартина Фаулера:

[http://martinfowler.com/articles/injection.html](http://martinfowler.com/articles/injection.html)

Обратите внимание, что весь `MoviesController` код в классе (за исключением первого `IMovieRepository` конструктора) `MovieRepository` взаимодействует с интерфейсом вместо фактического класса. Код взаимодействует с абстрактным интерфейсом вместо конкретной реализации интерфейса.

Если вы хотите изменить технологию доступа к данным, используемую приложением, то вы можете просто реализовать `IMovieRepository` интерфейс с классом, который использует альтернативную технологию доступа к базе данных. Например, можно создать `EntityFrameworkMovieRepository` класс `SubSonicMovieRepository` или класс. Поскольку класс контроллера запрограммирован на интерфейс, можно `IMovieRepository` передать новую реализацию классу контроллера, и класс будет продолжать работать.

Кроме того, если вы `MoviesController` хотите протестировать класс, то вы можете передать `HomeController`поддельный класс репозитория фильмов в . Вы можете `IMovieRepository` реализовать класс с классом, который на самом деле не имеет `IMovieRepository` доступа к базе данных, но содержит все необходимые методы интерфейса. Таким образом, вы можете `MoviesController` унифицировать класс, фактически не имея доступа к реальной базе данных.

## <a name="summary"></a>Сводка

Цель этого руководства состояла в том, чтобы продемонстрировать, как можно создавать классы моделей MVC, воспользовавшись преимуществами Microsoft LIN' для S'L. Мы рассмотрели две стратегии отображения данных базы данных в ASP.NET mVC-приложении. Во-первых, мы создали lin's для классов S'L и использовали классы непосредственно в рамках действия контроллера. Использование классов LIN's в рамках контроллера позволяет быстро и легко отображать данные базы данных в приложении MVC.

Далее мы исследовали немного более сложный, но определенно более добродетельный путь для отображения данных базы данных. Мы воспользовались шаблоном репозитория и поместили всю логику доступа к базе данных в отдельный класс репозитория. В нашем контроллере, мы написали все наши коды против интерфейса, а не конкретный класс. Преимущество шаблона репозитория заключается в том, что он позволяет нам легко менять технологии доступа к базам данных в будущем, и это позволяет нам легко тестировать наши классы контроллеров.

> [!div class="step-by-step"]
> [Назад](creating-model-classes-with-the-entity-framework-cs.md)
> [Вперед](displaying-a-table-of-database-data-cs.md)
