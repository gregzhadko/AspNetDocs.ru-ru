---
uid: mvc/overview/older-versions-1/models-data/creating-model-classes-with-the-entity-framework-vb
title: Создание классов моделей с помощью Entity Framework (VB) | Документация Майкрософт
author: microsoft
description: В этом руководстве описано, как использовать ASP.NET MVC с Microsoft Entity Framework. Вы узнаете, как с помощью мастера сущностей создать ADO.NET сущность da...
ms.author: riande
ms.date: 01/27/2009
ms.assetid: ff8322c9-12f3-4e24-aba6-a38046b9bb0d
msc.legacyurl: /mvc/overview/older-versions-1/models-data/creating-model-classes-with-the-entity-framework-vb
msc.type: authoredcontent
ms.openlocfilehash: f6c896c6f5f6d898ac6f99d5998fb29cb73bcb10
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78437010"
---
# <a name="creating-model-classes-with-the-entity-framework-vb"></a>Создание классов модели в Entity Framework (VB)

по [Майкрософт](https://github.com/microsoft)

> В этом руководстве описано, как использовать ASP.NET MVC с Microsoft Entity Framework. Вы узнаете, как использовать мастер сущностей для создания EDM ADO.NET. В ходе работы с этим руководством мы создадим веб-приложение, которое показывает, как выбирать, вставлять, обновлять и удалять данные базы данных с помощью Entity Framework.

Цель этого руководства — объяснить, как можно создавать классы доступа к данным с помощью Entity Framework Майкрософт при создании приложения MVC ASP.NET. В этом учебнике отсутствуют знания Entity Framework Майкрософт. По завершении работы с этим руководством вы узнаете, как использовать Entity Framework для выбора, вставки, обновления и удаления записей базы данных.

Microsoft Entity Framework — это средство реляционного сопоставления объектов (O/RM), которое позволяет автоматически создавать слой доступа к данным из базы данных. Entity Framework позволяет избежать утомительной работы по созданию классов доступа к данным вручную.

> [!NOTE] 
> 
> Нет никакого обязательного подключения между ASP.NET MVC и Microsoft Entity Framework. Существует несколько альтернативных вариантов Entity Framework, которые можно использовать с ASP.NET MVC. Например, можно создать классы модели MVC с помощью других средств для работы с/RM, таких как Microsoft LINQ to SQL, NHibernate или компании Sonic.

Чтобы продемонстрировать, как можно использовать Microsoft Entity Framework с ASP.NET MVC, мы создадим простой пример приложения. Мы создадим приложение базы данных фильмов, которое позволяет отображать и изменять записи в базе данных фильмов.

В этом учебнике предполагается, что у вас установлена Visual Studio 2008 или Visual Web Developer 2008 с пакетом обновления 1 (SP1). Для использования Entity Framework требуется пакет обновления 1 (SP1). Вы можете скачать пакет обновления 1 (SP1) для Visual Studio 2008 или Visual Web Developer с пакетом обновления 1 (SP1) по следующему адресу:

> [https://www.asp.net/downloads/](https://www.asp.net/downloads)

## <a name="creating-the-movie-sample-database"></a>Создание образца базы данных фильмов

Приложение базы данных фильмов использует таблицу базы данных с именем Movies, которая содержит следующие столбцы:

| Имя столбца | Тип данных | Разрешить значения NULL? | Первичный ключ? |
| --- | --- | --- | --- |
| Идентификатор | INT | False | True |
| Title | Nvarchar (100) | False | False |
| Директор | Nvarchar (100) | False | False |

Эту таблицу можно добавить в проект MVC ASP.NET, выполнив следующие действия:

1. Щелкните правой кнопкой мыши папку данных приложения\_в окне обозреватель решений и выберите пункт меню **Добавить, новый элемент.**
2. В диалоговом окне **Добавление нового элемента** выберите **SQL Server база данных**, присвойте базе данных имя мовиесдб. mdf и нажмите кнопку **добавить** .
3. Дважды щелкните файл Мовиесдб. mdf, чтобы открыть окно обозреватель сервера/обозреватель базы данных.
4. Разверните подключение к базе данных Мовиесдб. mdf, щелкните правой кнопкой мыши папку таблицы и выберите пункт меню **Добавить новую таблицу**.
5. В конструктор таблиц добавьте столбцы ID, Title и Director.
6. Нажмите кнопку **сохранить** (она содержит значок дискеты), чтобы сохранить новую таблицу с именем movies.

После создания таблицы базы данных фильмов необходимо добавить в нее некоторые образцы данных. Щелкните правой кнопкой мыши таблицу "фильмы" и выберите пункт меню " **отобразить данные таблицы**". В появившейся сетке можно ввести фиктивные данные фильмов.

## <a name="creating-the-adonet-entity-data-model"></a>Создание EDM ADO.NET

Чтобы использовать Entity Framework, необходимо создать EDM. *Мастер EDM* Visual Studio можно использовать для автоматического создания EDM из базы данных.

Выполните следующие действия.

1. Щелкните правой кнопкой мыши папку модели в окне обозреватель решений и выберите пункт меню **Добавить, новый элемент**.
2. В диалоговом окне **Добавление нового элемента** выберите категорию данных (см. рис. 1).
3. Выберите шаблон **EDM ADO.NET** , присвойте EDM имя мовиесдбмодел. edmx и нажмите кнопку **Добавить** . При нажатии кнопки **Добавить** запускается мастер моделей данных.
4. На шаге **Выбор содержимого модели** выберите параметр **создать из базы данных** и нажмите кнопку **Далее** (см. рис. 2).
5. На шаге **Выбор подключения к данным** выберите подключение к базе данных мовиесдб. mdf, введите параметры подключения сущностей имя мовиесдбентитиес и нажмите кнопку **Далее** (см. рис. 3).
6. На шаге **Выбор объектов базы данных** выберите таблицу база данных Movie и нажмите кнопку **Готово** (см. рис. 4).

После выполнения этих действий откроется Конструктор ADO.NET EDM (Entity Designer).

**Рис. 1. Создание нового EDM**

![clip_image002](creating-model-classes-with-the-entity-framework-vb/_static/image1.jpg)

**Рис. 2. шаг «выбор содержимого модели»**

![clip_image004](creating-model-classes-with-the-entity-framework-vb/_static/image2.jpg)

**Рис. 3. Выбор подключения к данным**

![clip_image006](creating-model-classes-with-the-entity-framework-vb/_static/image3.jpg)

**Рис. 4. Выбор объектов базы данных**

![clip_image008](creating-model-classes-with-the-entity-framework-vb/_static/image4.jpg)

## <a name="modifying-the-adonet-entity-data-model"></a>Изменение EDM ADO.NET

После создания EDM можно изменить модель, используя преимущества Entity Designer (см. рис. 5). Вы можете открыть Entity Designer в любое время, дважды щелкнув файл Мовиесдбмодел. EDMX, содержащийся в папке Models в окне обозреватель решений.

**Рис. 5. конструктор EDM ADO.NET**

![clip_image010](creating-model-classes-with-the-entity-framework-vb/_static/image5.jpg)

Например, можно использовать Entity Designer для изменения имен классов, создаваемых мастером данных модели сущностей. Мастер создал новый класс доступа к данным с именем movies. Иными словами, мастер присвоил классу то же имя, что и таблица базы данных. Поскольку этот класс будет использоваться для представления конкретного экземпляра фильма, необходимо переименовать класс из фильмов в Movie.

Если вы хотите переименовать класс сущности, можно дважды щелкнуть имя класса в Entity Designer и ввести новое имя (см. рис. 6). Кроме того, можно изменить имя сущности в окно свойств после выбора сущности в Entity Designer.

**Рис. 6. изменение имени сущности**

![clip_image012](creating-model-classes-with-the-entity-framework-vb/_static/image6.jpg)

Не забудьте сохранить EDM после внесения изменений, нажав кнопку Сохранить (значок гибкого диска). В фоновом режиме Entity Designer создает набор классов Visual Basic .NET. Эти классы можно просмотреть, открыв файл Мовиесдбмодел. Designer. vb в окне обозреватель решений.

Не изменяйте код в файле Designer. vb, так как изменения будут перезаписаны при следующем использовании Entity Designer. Если требуется расширить функциональные возможности классов сущностей, определенных в файле Designer. vb, можно создать *разделяемые классы* в отдельных файлах.

#### <a name="selecting-database-records-with-the-entity-framework"></a>Выбор записей базы данных с Entity Framework

Начнем создание приложения для работы с базой данных фильмов, создав страницу со списком записей фильмов. Контроллер Home в листинге 1 предоставляет действие с именем index (). Действие index () возвращает все записи фильмов из таблицы базы данных фильмов, используя преимущества Entity Framework.

**Листинг 1 — Контроллерс\хомеконтроллер.ВБ**

[!code-vb[Main](creating-model-classes-with-the-entity-framework-vb/samples/sample1.vb)]

Обратите внимание, что контроллер в листинге 1 содержит конструктор. Конструктор инициализирует поле уровня класса с именем \_DB. Поле \_DB представляет сущности базы данных, создаваемые Entity Framework Майкрософт. Поле \_DB является экземпляром класса Мовиесдбентитиес, созданного Entity Designer.

Поле \_DB используется в действии index () для получения записей из таблицы базы данных фильмов. Выражение \_DB. Набор фильмов представляет все записи из таблицы базы данных фильмов. Метод ToList () используется для преобразования набора фильмов в универсальную коллекцию объектов Movie: List (фильм).

Записи фильмов извлекаются с помощью LINQ to Entities. Действие index () в листинге 1 использует *синтаксис метода* LINQ для получения набора записей базы данных. При желании вместо этого можно использовать *синтаксис запросов* LINQ. Следующие две инструкции выполняют одно и то же действие:

[!code-vb[Main](creating-model-classes-with-the-entity-framework-vb/samples/sample2.vb)]

Используйте любой синтаксис LINQ — синтаксис или синтаксис запроса, который наиболее интуитивно понятен. Различия в производительности между двумя подходами не различаются — единственное различие — стиль.

Представление в листинге 2 используется для отображения записей фильмов.

**Листинг 2 — Виевс\хоме\индекс.аспкс**

[!code-aspx[Main](creating-model-classes-with-the-entity-framework-vb/samples/sample3.aspx)]

Представление в листинге 2 содержит цикл **for each** , который выполняет итерацию по каждой записи фильма и отображает значения свойств Title и Director записи фильма. Обратите внимание, что рядом с каждой записью отображается ссылка изменить и удалить. Кроме того, в нижней части представления появится ссылка Добавить фильм (см. рис. 7).

**Рис. 7. представление индекса**

![clip_image014](creating-model-classes-with-the-entity-framework-vb/_static/image7.jpg)

Представление индекса является *типизированным представлением*. Представление индекса содержит &lt;директиву% @ Page%&gt;, включающую атрибут Inherits. Атрибут Inherits приводит свойство ViewData. Model к строго типизированной коллекции списков объектов Movie — списку (Movie).

## <a name="inserting-database-records-with-the-entity-framework"></a>Вставка записей базы данных с Entity Framework

Можно использовать Entity Framework, чтобы упростить вставку новых записей в таблицу базы данных. В листинге 3 содержатся два новых действия, добавленных в класс контроллера Home, которые можно использовать для вставки новых записей в таблицу базы данных фильмов.

**Листинг 3 — Контроллерс\хомеконтроллер.ВБ (Добавление методов)**

[!code-vb[Main](creating-model-classes-with-the-entity-framework-vb/samples/sample4.vb)]

Первое действие Add () просто возвращает представление. Представление содержит форму для добавления новой записи базы данных фильмов (см. рис. 8). При отправке формы вызывается второе действие Add ().

Обратите внимание, что второе действие Add () дополнено атрибутом Акцептвербс. Это действие может быть вызвано только при выполнении операции HTTP POST. Иными словами, это действие можно вызвать только при публикации HTML-формы.

Второе действие Add () создает новый экземпляр класса Entity Framework Movie с помощью метода ASP.NET MVC Трюпдатемодел (). Метод Трюпдатемодел () принимает поля в Формколлектион, передаваемые методу Add (), и присваивает значения этих полей HTML-форм классу Movie.

При использовании Entity Framework, необходимо указать «утвержденный список» свойств при использовании методов TryUpdateModel или UpdateModel для обновления свойств класса сущностей.

Затем действие Add () выполняет простую проверку формы. Действие проверяет, что свойства Title и Director имеют значения. При возникновении ошибки проверки в ModelState добавляется сообщение об ошибке проверки.

Если ошибки проверки отсутствуют, в таблицу фильмов базы данных добавляется новая запись с помощью Entity Framework. Новая запись добавляется в базу данных с помощью следующих двух строк кода:

[!code-vb[Main](creating-model-classes-with-the-entity-framework-vb/samples/sample5.vb)]

Первая строка кода добавляет новую сущность Movie в набор фильмов, отслеживаемых Entity Framework. Вторая строка кода сохраняет все изменения, внесенные в фильмы, отслеживаемые обратно в основную базу данных.

**Рис. 8. Добавление представления**

![clip_image016](creating-model-classes-with-the-entity-framework-vb/_static/image8.jpg)

## <a name="updating-database-records-with-the-entity-framework"></a>Обновление записей базы данных с помощью Entity Framework

Можно выполнить практически тот же подход, чтобы изменить запись базы данных с Entity Framework в качестве подхода, который только что следовало вставить новую запись базы данных. В листинге 4 содержатся два новых действия контроллера с именем Edit (). Первое действие Edit () Возвращает HTML-форму для редактирования записи фильма. Второе действие Edit () пытается обновить базу данных.

**Листинг 4 — Контроллерс\хомеконтроллер.ВБ (методы изменения)**

[!code-vb[Main](creating-model-classes-with-the-entity-framework-vb/samples/sample6.vb)]

Второе действие Edit () начинается с получения записи фильма из базы данных, которая соответствует идентификатору редактируемого фильма. Следующая инструкция LINQ to Entities извлекает первую запись базы данных, которая соответствует определенному идентификатору:

[!code-vb[Main](creating-model-classes-with-the-entity-framework-vb/samples/sample7.vb)]

Затем метод Трюпдатемодел () используется для присвоения значений полей HTML-формы свойствам сущности Movie. Обратите внимание, что предоставляется белый список, указывающий точные свойства для обновления.

Далее необходимо выполнить некоторые простые проверки, чтобы убедиться в том, что в качестве заголовка фильма и свойства режиссера заданы значения. Если в любом из свойств отсутствует значение, то в ModelState и ModelState добавляется сообщение об ошибке проверки. IsValid возвращает значение false.

Наконец, если ошибки проверки отсутствуют, то таблица базы данных фильмов обновляется с учетом изменений путем вызова метода SaveChanges ().

При редактировании записей базы данных необходимо передать идентификатор изменяемой записи в действие контроллера, которое выполняет обновление базы данных. В противном случае действие контроллера не сможет понять, какая запись будет обновлена в базовой базе данных. Представление редактирования, содержащееся в листинге 5, включает в себя скрытое поле формы, представляющее идентификатор редактируемой записи базы данных.

**Листинг 5 — Виевс\хоме\едит.аспкс**

[!code-aspx[Main](creating-model-classes-with-the-entity-framework-vb/samples/sample8.aspx)]

## <a name="deleting-database-records-with-the-entity-framework"></a>Удаление записей базы данных с Entity Framework

Завершающей операцией с базой данных, которую нам нужно справиться с этим руководством, является удаление записей базы данных. Чтобы удалить определенную запись базы данных, можно использовать действие контроллера в листинге 6.

**Листинг 6. \Контроллерс\хомеконтроллер.ВБ (Удаление действия)**

[!code-vb[Main](creating-model-classes-with-the-entity-framework-vb/samples/sample9.vb)]

Действие DELETE () сначала извлекает сущность Movie, которая соответствует идентификатору, переданному действию. Затем фильм удаляется из базы данных путем вызова метода DeleteObject (), за которым следует метод SaveChanges (). Наконец, пользователь перенаправляется обратно в представление индекса.

## <a name="summary"></a>Сводка

Цель этого руководства — продемонстрировать, как можно создавать веб-приложения на основе баз данных, используя преимущества ASP.NET MVC и Microsoft Entity Framework. Вы узнали, как создать приложение, позволяющее выбирать, вставлять, обновлять и удалять записи базы данных.

Сначала мы рассмотрели, как можно использовать мастер EDM для создания EDM в Visual Studio. Далее вы узнаете, как использовать LINQ to Entities для получения набора записей базы данных из таблицы базы данных. Наконец, мы использовали Entity Framework для вставки, обновления и удаления записей базы данных.

> [!div class="step-by-step"]
> [Назад](validation-with-the-data-annotation-validators-cs.md)
> [Вперед](creating-model-classes-with-linq-to-sql-vb.md)
