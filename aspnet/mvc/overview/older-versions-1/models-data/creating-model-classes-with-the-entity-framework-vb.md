---
uid: mvc/overview/older-versions-1/models-data/creating-model-classes-with-the-entity-framework-vb
title: Создание классов модели в Entity Framework (Visual Basic) | Документация Майкрософт
author: microsoft
description: В этом руководстве вы узнаете, как использовать ASP.NET MVC с помощью Microsoft Entity Framework. Вы узнаете, как использовать мастер для создания сущностей ADO.NET Da...
ms.author: riande
ms.date: 01/27/2009
ms.assetid: ff8322c9-12f3-4e24-aba6-a38046b9bb0d
msc.legacyurl: /mvc/overview/older-versions-1/models-data/creating-model-classes-with-the-entity-framework-vb
msc.type: authoredcontent
ms.openlocfilehash: b3c6726c2d08e2e6ac37501f2ab455e427df82bb
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/09/2019
ms.locfileid: "59414060"
---
# <a name="creating-model-classes-with-the-entity-framework-vb"></a>Создание классов модели в Entity Framework (VB)

по [Microsoft](https://github.com/microsoft)

> В этом руководстве вы узнаете, как использовать ASP.NET MVC с помощью Microsoft Entity Framework. Вы узнаете, как использовать мастер для создания модели EDM ADO.NET. В ходе работы с этим руководством мы создаем веб-приложения, демонстрирующий выбор, вставки, обновления и удаления базы данных с помощью Entity Framework.


Чтобы объяснить, как создать классы для доступа к данным с помощью Microsoft Entity Framework, при создании приложения ASP.NET MVC является целью данного учебника. В учебнике предполагается не знакомства с Microsoft Entity Framework. В конце этого учебника будет понять, как с помощью Entity Framework на выбор, вставку, обновление и удаление записей базы данных.

Microsoft Entity Framework является средством, объект реляционного сопоставления (O/RM), которое позволяет автоматически создавать слой доступа к данным из базы данных. Платформа Entity Framework позволяет избежать утомительной работы вручную построения ваши классы доступа к данным.

> [!NOTE] 
> 
> Нет essential подключения между ASP.NET MVC и Entity Framework корпорации Майкрософт. Доступно несколько альтернативных решений на платформу Entity Framework, который можно использовать с ASP.NET MVC. Например можно создать с помощью других средств объектно-реляционное отображение, таких как Microsoft LINQ to SQL, NHibernate и SubSonic классах модели MVC.


Чтобы проиллюстрировать, как можно использовать Microsoft Entity Framework с ASP.NET MVC, мы создадим простой пример приложения. Мы создадим приложение базы данных фильмов, дающий возможность отображения и изменения записей базы данных фильмов.

Этом руководстве предполагается, что Visual Studio 2008 или Visual Web Developer 2008 с пакетом обновления 1. Требуется пакет обновления 1 для использования платформы Entity Framework. Пакет обновления 1 для Visual Studio 2008 или Visual Web Developer с пакетом обновления 1 можно скачать из следующий адрес:

> [https://www.asp.net/downloads/](https://www.asp.net/downloads)


## <a name="creating-the-movie-sample-database"></a>Создание образца базы данных Movie

База данных Movie приложение использует таблицу базы данных, с именем фильмов, который содержит следующие столбцы:

| Имя столбца | Тип данных | Разрешить значения NULL? | Является первичным ключом? |
| --- | --- | --- | --- |
| Идентификатор | int | False | True |
| Заголовок | nvarchar(100) | False | False |
| Директор | nvarchar(100) | False | False |

В этой таблице можно добавить в проект ASP.NET MVC, сделав следующее:

1. Щелкните правой кнопкой мыши приложение\_папка данных в окно обозревателя решений и выберите пункт меню **добавить, новый элемент.**
2. Из **Добавление нового элемента** выберите **базы данных SQL Server**, введите имя MoviesDB.mdf базы данных и нажмите кнопку **добавить** кнопки.
3. Дважды щелкните файл MoviesDB.mdf, чтобы открыть окно Server Explorer/Database Explorer.
4. Развернуть MoviesDB.mdf подключения к базе данных, щелкните правой кнопкой мыши папку «таблицы» и выберите пункт меню **добавить новую таблицу**.
5. В конструкторе таблиц добавьте столбцы Id, Title и директор.
6. Нажмите кнопку **Сохранить** кнопки (он имеет значок дискеты) для сохранения в новую таблицу с именем фильмов.

После создания таблицы базы данных фильмов, следует добавить демонстрационные данные в таблицу. Щелкните правой кнопкой мыши в таблице фильмов и выберите пункт меню **Показать таблицу данных**. В появившейся сетке можно ввести фальшивые о фильме.

## <a name="creating-the-adonet-entity-data-model"></a>Создание модели EDM ADO.NET

Чтобы использовать Entity Framework, необходимо создать модель EDM. Вы можете воспользоваться преимуществами Visual Studio *мастер моделей EDM* для автоматического создания модели EDM из базы данных.

Выполните следующие действия.

1. Щелкните правой кнопкой мыши папку Models в окне обозревателя решений и выберите пункт меню **добавить, новый элемент**.
2. В **Добавление нового элемента** диалоговое окно, выберите категорию Data (см. рис. 1).
3. Выберите **ADO.NET Entity Data Model** шаблон, присвойте имя MoviesDBModel.edmx модели EDM и нажмите кнопку **добавить** кнопки. Щелкнув **добавить** кнопка запускает мастер модели данных.
4. В **Выбор содержимого модели** , выберите нужное значение **создать из базы данных** и нажмите кнопку **Далее** кнопку (см. рис. 2).
5. В **Выбор подключения к данным** шаг, выберите подключение к базе данных MoviesDB.mdf, введите объекты параметров подключения имя MoviesDBEntities и нажмите кнопку **Далее** кнопку (см. рис. 3).
6. В **Choose Your Database Objects** шаг, выберите в таблице базы данных фильмов и нажмите кнопку **Готово** кнопку (см. рис. 4).

После выполнения этих действий, откроется конструктор модели сущностей ADO.NET (конструктор сущностей).

**Рис. 1 – Создание новой модели данных сущности**

![clip_image002](creating-model-classes-with-the-entity-framework-vb/_static/image1.jpg)

**Рис. 2 – выберите шаг содержимое модели**

![clip_image004](creating-model-classes-with-the-entity-framework-vb/_static/image2.jpg)

**Рис. 3 – Выбор подключения базы данных**

![clip_image006](creating-model-classes-with-the-entity-framework-vb/_static/image3.jpg)

**Рис. 4 – Выбор объектов базы данных**

![clip_image008](creating-model-classes-with-the-entity-framework-vb/_static/image4.jpg)

## <a name="modifying-the-adonet-entity-data-model"></a>Изменение модели EDM ADO.NET

После создания модели EDM, можете редактировать модель, используя Entity Designer (см. рис. 5). Конструктор сущностей можно открыть в любое время, дважды щелкнув файл MoviesDBModel.edmx, содержащиеся в папке Models находится в окне обозревателя решений.

**Рис. 5 – конструктор моделей EDM ADO.NET**

![clip_image010](creating-model-classes-with-the-entity-framework-vb/_static/image5.jpg)

Например можно использовать конструктор сущностей для изменения имен классов, которые создает мастер модели EDM. Мастер создал класс доступа к данным с именем фильмов. Другими словами мастер присвоили классу очень совпадает с именем таблицы базы данных. Так как этот класс будет использоваться для представления конкретного экземпляра фильма, нам следует присвоить класс из папки Movies фильм.

Если вы хотите переименовать класс сущностей, можно дважды щелкнуть имя класса в конструкторе сущностей и введите новое имя (см. рис. 6). Кроме того можно изменить имя сущности в окне «Свойства» после выбора сущности в конструкторе сущностей.

**Рис. 6 – изменение имени сущности**

![clip_image012](creating-model-classes-with-the-entity-framework-vb/_static/image6.jpg)

Не забудьте сохранить вашей модели EDM после внесения изменений, нажав кнопку "Сохранить" (значок дискеты). На самом деле конструктор сущностей создает набор классов Visual Basic .NET. Эти классы можно просмотреть, открыв этот файл MoviesDBModel.Designer.vb в окне обозревателя решений.


Не следует изменять код в файле Designer.vb с момента изменения перезаписываются при следующем использовании конструктора сущностей. Если вы хотите расширить функциональные возможности классов сущностей, определенных в файле Designer.vb, то можно создать *разделяемые классы* в отдельные файлы.


#### <a name="selecting-database-records-with-the-entity-framework"></a>Выбор записей базы данных с Entity Framework

Давайте начнем, созданию приложения базы данных фильмов, создав страницу, отображающую список записей фильмов. Контроллер Home в листинге 1 предоставляет действие с именем Index(). Это действие Index() возвращает все записи фильма из таблицы базы данных Movie за счет использования платформы Entity Framework.

**В листинге 1 — Controllers\HomeController.vb**

[!code-vb[Main](creating-model-classes-with-the-entity-framework-vb/samples/sample1.vb)]

Обратите внимание на то, что контроллер в листинге 1 включает конструктор. Конструктор инициализирует поле уровня класса с именем \_db. \_Db поле представляет сущности базы данных, созданные платформой Entity Framework корпорации Майкрософт. \_Db поля является экземпляром класса MoviesDBEntities, который был создан конструктором сущностей.

\_Поле db используется в действии Index() для извлечения записей из таблицы базы данных фильмов. Выражение \_db. MovieSet представляет все записи из таблицы базы данных фильмов. Метод ToList() используется для преобразования в универсальной коллекции объектов Movie набор фильмов: List (Of фильма).

Записи фильма можно получить с помощью LINQ to Entities. Действие Index() в листинге 1 использует LINQ *синтаксис метода* для получения набора записей базы данных. При желании можно использовать LINQ *синтаксис запроса* вместо этого. Следующие две инструкции выполняют те же функции:

[!code-vb[Main](creating-model-classes-with-the-entity-framework-vb/samples/sample2.vb)]

Используйте любой синтаксис LINQ — синтаксис метода или синтаксис запросов — найденной интуитивно. Нет никакой разницы в производительности между двумя подходами – единственное отличие заключается в стиль.

В представлении в листинге 2 используется для отображения записей фильмов.

**В листинге 2 — Views\Home\Index.aspx**

[!code-aspx[Main](creating-model-classes-with-the-entity-framework-vb/samples/sample3.aspx)]

Представление в листинге 2 содержит **для каждого** цикл, который используется для итерации по каждой записи фильма и отображает значения свойств Title и директор запись фильма. Обратите внимание на то, что ссылки на изменение и удаление отображается рядом с каждой записи. Кроме того, ссылки на добавление фильма отображается в нижней части представления (см. рис. 7).

**Рис. 7 – представление Index**

![clip_image014](creating-model-classes-with-the-entity-framework-vb/_static/image7.jpg)

Представление Index является *типизированного представления*. Представление Index имеет &lt;% @ Page %&gt; директива, которая включает в себя атрибут Inherits. Атрибут Inherits приводит ViewData.Model свойство в строго типизированный универсального списка коллекцию объектов Movie — список (фильма).

## <a name="inserting-database-records-with-the-entity-framework"></a>Вставка записей базы данных с Entity Framework

Платформа Entity Framework можно использовать для упрощения вставки новых записей в таблицу базы данных. Листинг 3 содержит два новых действия, добавленные к классу контроллера Home, можно использовать для вставки новых записей в таблице базы данных Movie.

**Листинг 3 – Controllers\HomeController.vb (Добавить методы)**

[!code-vb[Main](creating-model-classes-with-the-entity-framework-vb/samples/sample4.vb)]

Первое действие Add() просто возвращает представление. Представление содержит форму для добавления новой базы данных movie записи (см. рис. 8). При отправке формы вызывается второе действие Add().

Обратите внимание на то, что второе действие Add() дополнен атрибутом AcceptVerbs. Это действие может вызываться только в том случае, при выполнении операции HTTP POST. Другими словами это действие может вызываться только при отправке формы HTML.

Второе действие Add() создает новый экземпляр класса Entity Framework фильмов с помощью метода ASP.NET MVC TryUpdateModel(). Метод TryUpdateModel() принимает поля в FormCollection, передаваемый в метод Add() и присваивает значения этих полей формы HTML класс Movie.


При использовании Entity Framework, необходимо указать «утвержденный список» свойств при использовании методов TryUpdateModel или UpdateModel для обновления свойств класса сущностей.


Затем Add() действие выполняет некоторые проверки простой формы. Действие проверяет, что заголовок и директор свойства имеют значения. Если имеется ошибка проверки, сообщение об ошибке проверки добавляется к ModelState.

Если нет ошибок проверки новой записи фильма добавляется в таблицу базы данных фильмов с помощью платформы Entity Framework. Новая запись добавляется в базу данных с помощью следующих двух строк кода:

[!code-vb[Main](creating-model-classes-with-the-entity-framework-vb/samples/sample5.vb)]

Первая часть кода добавляет новую сущность Movie набор фильмы, отслеживается Entity Framework. Вторая часть кода сохраняет все изменения были внесены в кино, отслеживается в базовой базе данных.

**Рис. 8 – Добавление представления**

![clip_image016](creating-model-classes-with-the-entity-framework-vb/_static/image8.jpg)

## <a name="updating-database-records-with-the-entity-framework"></a>Обновление записей базы данных с Entity Framework

Вы можете следовать практически тот же подход, чтобы изменить запись в базе данных с Entity Framework как подход, который мы только что выполнили для вставки новой записи базы данных. Листинг 4 содержит два новых действия контроллера с именем Edit(). Первое действие Edit() возвращает HTML-формы для редактирования и фильмов. Второе действие Edit() пытается обновить базу данных.

**Листинг 4 — Controllers\HomeController.vb (методов Edit)**

[!code-vb[Main](creating-model-classes-with-the-entity-framework-vb/samples/sample6.vb)]

Второе действие Edit() начинается с получения запись фильма из базы данных, соответствующий идентификатору редактируемого фильма. Следующие LINQ to Entities инструкции извлекает первой записи базы данных, которая совпадает с определенным кодом:

[!code-vb[Main](creating-model-classes-with-the-entity-framework-vb/samples/sample7.vb)]

Затем метод TryUpdateModel() используется для присвоения значений полей формы HTML свойства сущности фильма. Обратите внимание на то, что список разрешений предоставляется для указания точного обновляемые свойства.

Далее чтобы убедиться, что название фильма и директор свойства имеют значения выполняется простой механизм проверки. Если отсутствуют значение любого из этих свойств, затем ModelState добавляется сообщение об ошибке проверки и ModelState.IsValid возвращает значение false.

Наконец при возникновении ошибки проверки не, базовой таблицы базы данных фильмов затем обновляется с любыми изменениями, путем вызова метода SaveChanges().

При редактировании записей базы данных, необходимо передать идентификатор изменяемую запись к действию контроллера, который выполняет обновление базы данных. В противном случае действие контроллера будет неизвестно, какая запись должна быть обновление базовой базы данных. Представления изменения, содержащиеся в листинге 5 включает в себя скрытого поля формы, представляющий идентификатор редактируемой записи в базе данных.

**Listing 5 – Views\Home\Edit.aspx**

[!code-aspx[Main](creating-model-classes-with-the-entity-framework-vb/samples/sample8.aspx)]

## <a name="deleting-database-records-with-the-entity-framework"></a>Удаление записей базы данных с Entity Framework

Операции окончательной базы данных, что нам нужно разбираться в этом руководстве, является удаление записей базы данных. Действие контроллера в листинге 6 можно использовать для удаления записи определенной базы данных.

**В листинге 6--\Controllers\HomeController.vb (действие удаления)**

[!code-vb[Main](creating-model-classes-with-the-entity-framework-vb/samples/sample9.vb)]

Действие Delete() сначала извлекает сущность, которая соответствует идентификатору передается в действие фильма. После этого фильма удаляется из базы данных, вызвав метод DeleteObject (), а затем с помощью метода SaveChanges(). Наконец пользователь перенаправляется обратно в представление Index.

## <a name="summary"></a>Сводка

Цель этого руководства мы хотели продемонстрировать, как можно создавать на основе базы данных веб-приложений, используя преимущества ASP.NET MVC и Entity Framework корпорации Майкрософт. Вы узнали, как создать приложение, которое позволяет выбрать, вставку, обновление и удаление записей базы данных.

Во-первых мы рассмотрели, как можно использовать мастер моделей EDM для создания модели EDM из среды Visual Studio. Далее вы узнаете, как использовать LINQ to Entities для получения набора записей базы данных из таблицы базы данных. Наконец мы использовали Entity Framework для вставки, обновления и удаления записей в базе данных.

> [!div class="step-by-step"]
> [Назад](validation-with-the-data-annotation-validators-cs.md)
> [Вперед](creating-model-classes-with-linq-to-sql-vb.md)
