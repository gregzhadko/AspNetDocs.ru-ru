---
uid: mvc/overview/older-versions-1/models-data/creating-model-classes-with-the-entity-framework-vb
title: Создание классов моделей с помощью Entity Framework (VB) | Документация Майкрософт
author: microsoft
description: В этом руководстве описано, как использовать ASP.NET MVC с Microsoft Entity Framework. Вы узнаете, как с помощью мастера сущностей создать ADO.NET сущность da...
ms.author: riande
ms.date: 01/27/2009
ms.assetid: ff8322c9-12f3-4e24-aba6-a38046b9bb0d
msc.legacyurl: /mvc/overview/older-versions-1/models-data/creating-model-classes-with-the-entity-framework-vb
msc.type: authoredcontent
ms.openlocfilehash: f6c896c6f5f6d898ac6f99d5998fb29cb73bcb10
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78437010"
---
# <a name="creating-model-classes-with-the-entity-framework-vb"></a><span data-ttu-id="f5374-104">Создание классов модели в Entity Framework (VB)</span><span class="sxs-lookup"><span data-stu-id="f5374-104">Creating Model Classes with the Entity Framework (VB)</span></span>

<span data-ttu-id="f5374-105">по [Майкрософт](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="f5374-105">by [Microsoft](https://github.com/microsoft)</span></span>

> <span data-ttu-id="f5374-106">В этом руководстве описано, как использовать ASP.NET MVC с Microsoft Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="f5374-106">In this tutorial, you learn how to use ASP.NET MVC with the Microsoft Entity Framework.</span></span> <span data-ttu-id="f5374-107">Вы узнаете, как использовать мастер сущностей для создания EDM ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="f5374-107">You learn how to use the Entity Wizard to create an ADO.NET Entity Data Model.</span></span> <span data-ttu-id="f5374-108">В ходе работы с этим руководством мы создадим веб-приложение, которое показывает, как выбирать, вставлять, обновлять и удалять данные базы данных с помощью Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="f5374-108">Over the course of this tutorial, we build a web application that illustrates how to select, insert, update, and delete database data by using the Entity Framework.</span></span>

<span data-ttu-id="f5374-109">Цель этого руководства — объяснить, как можно создавать классы доступа к данным с помощью Entity Framework Майкрософт при создании приложения MVC ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="f5374-109">The goal of this tutorial is to explain how you can create data access classes using the Microsoft Entity Framework when building an ASP.NET MVC application.</span></span> <span data-ttu-id="f5374-110">В этом учебнике отсутствуют знания Entity Framework Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="f5374-110">This tutorial assumes no previous knowledge of the Microsoft Entity Framework.</span></span> <span data-ttu-id="f5374-111">По завершении работы с этим руководством вы узнаете, как использовать Entity Framework для выбора, вставки, обновления и удаления записей базы данных.</span><span class="sxs-lookup"><span data-stu-id="f5374-111">By the end of this tutorial, you'll understand how to use the Entity Framework to select, insert, update, and delete database records.</span></span>

<span data-ttu-id="f5374-112">Microsoft Entity Framework — это средство реляционного сопоставления объектов (O/RM), которое позволяет автоматически создавать слой доступа к данным из базы данных.</span><span class="sxs-lookup"><span data-stu-id="f5374-112">The Microsoft Entity Framework is an Object Relational Mapping (O/RM) tool that enables you to generate a data access layer from a database automatically.</span></span> <span data-ttu-id="f5374-113">Entity Framework позволяет избежать утомительной работы по созданию классов доступа к данным вручную.</span><span class="sxs-lookup"><span data-stu-id="f5374-113">The Entity Framework enables you to avoid the tedious work of building your data access classes by hand.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="f5374-114">Нет никакого обязательного подключения между ASP.NET MVC и Microsoft Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="f5374-114">There is no essential connection between ASP.NET MVC and the Microsoft Entity Framework.</span></span> <span data-ttu-id="f5374-115">Существует несколько альтернативных вариантов Entity Framework, которые можно использовать с ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="f5374-115">There are several alternatives to the Entity Framework that you can use with ASP.NET MVC.</span></span> <span data-ttu-id="f5374-116">Например, можно создать классы модели MVC с помощью других средств для работы с/RM, таких как Microsoft LINQ to SQL, NHibernate или компании Sonic.</span><span class="sxs-lookup"><span data-stu-id="f5374-116">For example, you can build your MVC Model classes using other O/RM tools such as Microsoft LINQ to SQL, NHibernate, or SubSonic.</span></span>

<span data-ttu-id="f5374-117">Чтобы продемонстрировать, как можно использовать Microsoft Entity Framework с ASP.NET MVC, мы создадим простой пример приложения.</span><span class="sxs-lookup"><span data-stu-id="f5374-117">In order to illustrate how you can use the Microsoft Entity Framework with ASP.NET MVC, we'll build a simple sample application.</span></span> <span data-ttu-id="f5374-118">Мы создадим приложение базы данных фильмов, которое позволяет отображать и изменять записи в базе данных фильмов.</span><span class="sxs-lookup"><span data-stu-id="f5374-118">We'll create a Movie Database application that enables you to display and edit movie database records.</span></span>

<span data-ttu-id="f5374-119">В этом учебнике предполагается, что у вас установлена Visual Studio 2008 или Visual Web Developer 2008 с пакетом обновления 1 (SP1).</span><span class="sxs-lookup"><span data-stu-id="f5374-119">This tutorial assumes that you have Visual Studio 2008 or Visual Web Developer 2008 with Service Pack 1.</span></span> <span data-ttu-id="f5374-120">Для использования Entity Framework требуется пакет обновления 1 (SP1).</span><span class="sxs-lookup"><span data-stu-id="f5374-120">You need Service Pack 1 in order to use the Entity Framework.</span></span> <span data-ttu-id="f5374-121">Вы можете скачать пакет обновления 1 (SP1) для Visual Studio 2008 или Visual Web Developer с пакетом обновления 1 (SP1) по следующему адресу:</span><span class="sxs-lookup"><span data-stu-id="f5374-121">You can download Visual Studio 2008 Service Pack 1 or Visual Web Developer with Service Pack 1 from the following address:</span></span>

> [https://www.asp.net/downloads/](https://www.asp.net/downloads)

## <a name="creating-the-movie-sample-database"></a><span data-ttu-id="f5374-122">Создание образца базы данных фильмов</span><span class="sxs-lookup"><span data-stu-id="f5374-122">Creating the Movie Sample Database</span></span>

<span data-ttu-id="f5374-123">Приложение базы данных фильмов использует таблицу базы данных с именем Movies, которая содержит следующие столбцы:</span><span class="sxs-lookup"><span data-stu-id="f5374-123">The Movie Database application uses a database table named Movies that contains the following columns:</span></span>

| <span data-ttu-id="f5374-124">Имя столбца</span><span class="sxs-lookup"><span data-stu-id="f5374-124">Column Name</span></span> | <span data-ttu-id="f5374-125">Тип данных</span><span class="sxs-lookup"><span data-stu-id="f5374-125">Data Type</span></span> | <span data-ttu-id="f5374-126">Разрешить значения NULL?</span><span class="sxs-lookup"><span data-stu-id="f5374-126">Allow Nulls?</span></span> | <span data-ttu-id="f5374-127">Первичный ключ?</span><span class="sxs-lookup"><span data-stu-id="f5374-127">Is Primary Key?</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="f5374-128">Идентификатор</span><span class="sxs-lookup"><span data-stu-id="f5374-128">Id</span></span> | <span data-ttu-id="f5374-129">INT</span><span class="sxs-lookup"><span data-stu-id="f5374-129">int</span></span> | <span data-ttu-id="f5374-130">False</span><span class="sxs-lookup"><span data-stu-id="f5374-130">False</span></span> | <span data-ttu-id="f5374-131">True</span><span class="sxs-lookup"><span data-stu-id="f5374-131">True</span></span> |
| <span data-ttu-id="f5374-132">Title</span><span class="sxs-lookup"><span data-stu-id="f5374-132">Title</span></span> | <span data-ttu-id="f5374-133">Nvarchar (100)</span><span class="sxs-lookup"><span data-stu-id="f5374-133">nvarchar(100)</span></span> | <span data-ttu-id="f5374-134">False</span><span class="sxs-lookup"><span data-stu-id="f5374-134">False</span></span> | <span data-ttu-id="f5374-135">False</span><span class="sxs-lookup"><span data-stu-id="f5374-135">False</span></span> |
| <span data-ttu-id="f5374-136">Директор</span><span class="sxs-lookup"><span data-stu-id="f5374-136">Director</span></span> | <span data-ttu-id="f5374-137">Nvarchar (100)</span><span class="sxs-lookup"><span data-stu-id="f5374-137">nvarchar(100)</span></span> | <span data-ttu-id="f5374-138">False</span><span class="sxs-lookup"><span data-stu-id="f5374-138">False</span></span> | <span data-ttu-id="f5374-139">False</span><span class="sxs-lookup"><span data-stu-id="f5374-139">False</span></span> |

<span data-ttu-id="f5374-140">Эту таблицу можно добавить в проект MVC ASP.NET, выполнив следующие действия:</span><span class="sxs-lookup"><span data-stu-id="f5374-140">You can add this table to an ASP.NET MVC project by following these steps:</span></span>

1. <span data-ttu-id="f5374-141">Щелкните правой кнопкой мыши папку данных приложения\_в окне обозреватель решений и выберите пункт меню **Добавить, новый элемент.**</span><span class="sxs-lookup"><span data-stu-id="f5374-141">Right-click the App\_Data folder in the Solution Explorer window and select the menu option **Add, New Item.**</span></span>
2. <span data-ttu-id="f5374-142">В диалоговом окне **Добавление нового элемента** выберите **SQL Server база данных**, присвойте базе данных имя мовиесдб. mdf и нажмите кнопку **добавить** .</span><span class="sxs-lookup"><span data-stu-id="f5374-142">From the **Add New Item** dialog box, select **SQL Server Database**, give the database the name MoviesDB.mdf, and click the **Add** button.</span></span>
3. <span data-ttu-id="f5374-143">Дважды щелкните файл Мовиесдб. mdf, чтобы открыть окно обозреватель сервера/обозреватель базы данных.</span><span class="sxs-lookup"><span data-stu-id="f5374-143">Double-click the MoviesDB.mdf file to open the Server Explorer/Database Explorer window.</span></span>
4. <span data-ttu-id="f5374-144">Разверните подключение к базе данных Мовиесдб. mdf, щелкните правой кнопкой мыши папку таблицы и выберите пункт меню **Добавить новую таблицу**.</span><span class="sxs-lookup"><span data-stu-id="f5374-144">Expand the MoviesDB.mdf database connection, right-click the Tables folder, and select the menu option **Add New Table**.</span></span>
5. <span data-ttu-id="f5374-145">В конструктор таблиц добавьте столбцы ID, Title и Director.</span><span class="sxs-lookup"><span data-stu-id="f5374-145">In the Table Designer, add the Id, Title, and Director columns.</span></span>
6. <span data-ttu-id="f5374-146">Нажмите кнопку **сохранить** (она содержит значок дискеты), чтобы сохранить новую таблицу с именем movies.</span><span class="sxs-lookup"><span data-stu-id="f5374-146">Click the **Save** button (it has the icon of the floppy) to save the new table with the name Movies.</span></span>

<span data-ttu-id="f5374-147">После создания таблицы базы данных фильмов необходимо добавить в нее некоторые образцы данных.</span><span class="sxs-lookup"><span data-stu-id="f5374-147">After you create the Movies database table, you should add some sample data to the table.</span></span> <span data-ttu-id="f5374-148">Щелкните правой кнопкой мыши таблицу "фильмы" и выберите пункт меню " **отобразить данные таблицы**".</span><span class="sxs-lookup"><span data-stu-id="f5374-148">Right-click the Movies table and select the menu option **Show Table Data**.</span></span> <span data-ttu-id="f5374-149">В появившейся сетке можно ввести фиктивные данные фильмов.</span><span class="sxs-lookup"><span data-stu-id="f5374-149">You can enter fake movie data into the grid that appears.</span></span>

## <a name="creating-the-adonet-entity-data-model"></a><span data-ttu-id="f5374-150">Создание EDM ADO.NET</span><span class="sxs-lookup"><span data-stu-id="f5374-150">Creating the ADO.NET Entity Data Model</span></span>

<span data-ttu-id="f5374-151">Чтобы использовать Entity Framework, необходимо создать EDM.</span><span class="sxs-lookup"><span data-stu-id="f5374-151">In order to use the Entity Framework, you need to create an Entity Data Model.</span></span> <span data-ttu-id="f5374-152">*Мастер EDM* Visual Studio можно использовать для автоматического создания EDM из базы данных.</span><span class="sxs-lookup"><span data-stu-id="f5374-152">You can take advantage of the Visual Studio *Entity Data Model Wizard* to generate an Entity Data Model from a database automatically.</span></span>

<span data-ttu-id="f5374-153">Выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="f5374-153">Follow these steps:</span></span>

1. <span data-ttu-id="f5374-154">Щелкните правой кнопкой мыши папку модели в окне обозреватель решений и выберите пункт меню **Добавить, новый элемент**.</span><span class="sxs-lookup"><span data-stu-id="f5374-154">Right-click the Models folder in the Solution Explorer window and select the menu option **Add, New Item**.</span></span>
2. <span data-ttu-id="f5374-155">В диалоговом окне **Добавление нового элемента** выберите категорию данных (см. рис. 1).</span><span class="sxs-lookup"><span data-stu-id="f5374-155">In the **Add New Item** dialog, select the Data category (see Figure 1).</span></span>
3. <span data-ttu-id="f5374-156">Выберите шаблон **EDM ADO.NET** , присвойте EDM имя мовиесдбмодел. edmx и нажмите кнопку **Добавить** .</span><span class="sxs-lookup"><span data-stu-id="f5374-156">Select the **ADO.NET Entity Data Model** template, give the Entity Data Model the name MoviesDBModel.edmx, and click the **Add** button.</span></span> <span data-ttu-id="f5374-157">При нажатии кнопки **Добавить** запускается мастер моделей данных.</span><span class="sxs-lookup"><span data-stu-id="f5374-157">Clicking the **Add** button launches the Data Model Wizard.</span></span>
4. <span data-ttu-id="f5374-158">На шаге **Выбор содержимого модели** выберите параметр **создать из базы данных** и нажмите кнопку **Далее** (см. рис. 2).</span><span class="sxs-lookup"><span data-stu-id="f5374-158">In the **Choose Model Contents** step, choose the **Generate from a database** option and click the **Next** button (see Figure 2).</span></span>
5. <span data-ttu-id="f5374-159">На шаге **Выбор подключения к данным** выберите подключение к базе данных мовиесдб. mdf, введите параметры подключения сущностей имя мовиесдбентитиес и нажмите кнопку **Далее** (см. рис. 3).</span><span class="sxs-lookup"><span data-stu-id="f5374-159">In the **Choose Your Data Connection** step, select the MoviesDB.mdf database connection, enter the entities connection settings name MoviesDBEntities, and click the **Next** button (see Figure 3).</span></span>
6. <span data-ttu-id="f5374-160">На шаге **Выбор объектов базы данных** выберите таблицу база данных Movie и нажмите кнопку **Готово** (см. рис. 4).</span><span class="sxs-lookup"><span data-stu-id="f5374-160">In the **Choose Your Database Objects** step, select the Movie database table and click the **Finish** button (see Figure 4).</span></span>

<span data-ttu-id="f5374-161">После выполнения этих действий откроется Конструктор ADO.NET EDM (Entity Designer).</span><span class="sxs-lookup"><span data-stu-id="f5374-161">After you complete these steps, the ADO.NET Entity Data Model Designer (Entity Designer) opens.</span></span>

<span data-ttu-id="f5374-162">**Рис. 1. Создание нового EDM**</span><span class="sxs-lookup"><span data-stu-id="f5374-162">**Figure 1 – Creating a new Entity Data Model**</span></span>

![clip_image002](creating-model-classes-with-the-entity-framework-vb/_static/image1.jpg)

<span data-ttu-id="f5374-164">**Рис. 2. шаг «выбор содержимого модели»**</span><span class="sxs-lookup"><span data-stu-id="f5374-164">**Figure 2 – Choose Model Contents Step**</span></span>

![clip_image004](creating-model-classes-with-the-entity-framework-vb/_static/image2.jpg)

<span data-ttu-id="f5374-166">**Рис. 3. Выбор подключения к данным**</span><span class="sxs-lookup"><span data-stu-id="f5374-166">**Figure 3 – Choose Your Data Connection**</span></span>

![clip_image006](creating-model-classes-with-the-entity-framework-vb/_static/image3.jpg)

<span data-ttu-id="f5374-168">**Рис. 4. Выбор объектов базы данных**</span><span class="sxs-lookup"><span data-stu-id="f5374-168">**Figure 4 – Choose Your Database Objects**</span></span>

![clip_image008](creating-model-classes-with-the-entity-framework-vb/_static/image4.jpg)

## <a name="modifying-the-adonet-entity-data-model"></a><span data-ttu-id="f5374-170">Изменение EDM ADO.NET</span><span class="sxs-lookup"><span data-stu-id="f5374-170">Modifying the ADO.NET Entity Data Model</span></span>

<span data-ttu-id="f5374-171">После создания EDM можно изменить модель, используя преимущества Entity Designer (см. рис. 5).</span><span class="sxs-lookup"><span data-stu-id="f5374-171">After you create an Entity Data Model, you can modify the model by taking advantage of the Entity Designer (see Figure 5).</span></span> <span data-ttu-id="f5374-172">Вы можете открыть Entity Designer в любое время, дважды щелкнув файл Мовиесдбмодел. EDMX, содержащийся в папке Models в окне обозреватель решений.</span><span class="sxs-lookup"><span data-stu-id="f5374-172">You can open the Entity Designer at any time by double-clicking the MoviesDBModel.edmx file contained in the Models folder within the Solution Explorer window.</span></span>

<span data-ttu-id="f5374-173">**Рис. 5. конструктор EDM ADO.NET**</span><span class="sxs-lookup"><span data-stu-id="f5374-173">**Figure 5 – The ADO.NET Entity Data Model Designer**</span></span>

![clip_image010](creating-model-classes-with-the-entity-framework-vb/_static/image5.jpg)

<span data-ttu-id="f5374-175">Например, можно использовать Entity Designer для изменения имен классов, создаваемых мастером данных модели сущностей.</span><span class="sxs-lookup"><span data-stu-id="f5374-175">For example, you can use the Entity Designer to change the names of the classes that the Entity Model Data Wizard generates.</span></span> <span data-ttu-id="f5374-176">Мастер создал новый класс доступа к данным с именем movies.</span><span class="sxs-lookup"><span data-stu-id="f5374-176">The Wizard created a new data access class named Movies.</span></span> <span data-ttu-id="f5374-177">Иными словами, мастер присвоил классу то же имя, что и таблица базы данных.</span><span class="sxs-lookup"><span data-stu-id="f5374-177">In other words, the Wizard gave the class the very same name as the database table.</span></span> <span data-ttu-id="f5374-178">Поскольку этот класс будет использоваться для представления конкретного экземпляра фильма, необходимо переименовать класс из фильмов в Movie.</span><span class="sxs-lookup"><span data-stu-id="f5374-178">Because we will use this class to represent a particular Movie instance, we should rename the class from Movies to Movie.</span></span>

<span data-ttu-id="f5374-179">Если вы хотите переименовать класс сущности, можно дважды щелкнуть имя класса в Entity Designer и ввести новое имя (см. рис. 6).</span><span class="sxs-lookup"><span data-stu-id="f5374-179">If you want to rename an entity class, you can double-click on the class name in the Entity Designer and enter a new name (see Figure 6).</span></span> <span data-ttu-id="f5374-180">Кроме того, можно изменить имя сущности в окно свойств после выбора сущности в Entity Designer.</span><span class="sxs-lookup"><span data-stu-id="f5374-180">Alternatively, you can change the name of an entity in the Properties window after selecting an entity in the Entity Designer.</span></span>

<span data-ttu-id="f5374-181">**Рис. 6. изменение имени сущности**</span><span class="sxs-lookup"><span data-stu-id="f5374-181">**Figure 6 – Changing an entity name**</span></span>

![clip_image012](creating-model-classes-with-the-entity-framework-vb/_static/image6.jpg)

<span data-ttu-id="f5374-183">Не забудьте сохранить EDM после внесения изменений, нажав кнопку Сохранить (значок гибкого диска).</span><span class="sxs-lookup"><span data-stu-id="f5374-183">Remember to save your Entity Data Model after making a modification by clicking the Save button (the icon of the floppy disk).</span></span> <span data-ttu-id="f5374-184">В фоновом режиме Entity Designer создает набор классов Visual Basic .NET.</span><span class="sxs-lookup"><span data-stu-id="f5374-184">Behind the scenes, the Entity Designer generates a set of Visual Basic .NET classes.</span></span> <span data-ttu-id="f5374-185">Эти классы можно просмотреть, открыв файл Мовиесдбмодел. Designer. vb в окне обозреватель решений.</span><span class="sxs-lookup"><span data-stu-id="f5374-185">You can view these classes by opening the MoviesDBModel.Designer.vb file from the Solution Explorer window.</span></span>

<span data-ttu-id="f5374-186">Не изменяйте код в файле Designer. vb, так как изменения будут перезаписаны при следующем использовании Entity Designer.</span><span class="sxs-lookup"><span data-stu-id="f5374-186">Don't modify the code in the Designer.vb file since your changes will be overwritten the next time you use the Entity Designer.</span></span> <span data-ttu-id="f5374-187">Если требуется расширить функциональные возможности классов сущностей, определенных в файле Designer. vb, можно создать *разделяемые классы* в отдельных файлах.</span><span class="sxs-lookup"><span data-stu-id="f5374-187">If you want to extend the functionality of the entity classes defined in the Designer.vb file then you can create *partial classes* in separate files.</span></span>

#### <a name="selecting-database-records-with-the-entity-framework"></a><span data-ttu-id="f5374-188">Выбор записей базы данных с Entity Framework</span><span class="sxs-lookup"><span data-stu-id="f5374-188">Selecting Database Records with the Entity Framework</span></span>

<span data-ttu-id="f5374-189">Начнем создание приложения для работы с базой данных фильмов, создав страницу со списком записей фильмов.</span><span class="sxs-lookup"><span data-stu-id="f5374-189">Let's start building our Movie Database application by creating a page that displays a list of movie records.</span></span> <span data-ttu-id="f5374-190">Контроллер Home в листинге 1 предоставляет действие с именем index ().</span><span class="sxs-lookup"><span data-stu-id="f5374-190">The Home controller in Listing 1 exposes an action named Index().</span></span> <span data-ttu-id="f5374-191">Действие index () возвращает все записи фильмов из таблицы базы данных фильмов, используя преимущества Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="f5374-191">The Index() action returns all of the movie records from the Movie database table by taking advantage of the Entity Framework.</span></span>

<span data-ttu-id="f5374-192">**Листинг 1 — Контроллерс\хомеконтроллер.ВБ**</span><span class="sxs-lookup"><span data-stu-id="f5374-192">**Listing 1 – Controllers\HomeController.vb**</span></span>

[!code-vb[Main](creating-model-classes-with-the-entity-framework-vb/samples/sample1.vb)]

<span data-ttu-id="f5374-193">Обратите внимание, что контроллер в листинге 1 содержит конструктор.</span><span class="sxs-lookup"><span data-stu-id="f5374-193">Notice that the controller in Listing 1 includes a constructor.</span></span> <span data-ttu-id="f5374-194">Конструктор инициализирует поле уровня класса с именем \_DB.</span><span class="sxs-lookup"><span data-stu-id="f5374-194">The constructor initializes a class-level field named \_db.</span></span> <span data-ttu-id="f5374-195">Поле \_DB представляет сущности базы данных, создаваемые Entity Framework Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="f5374-195">The \_db field represents the database entities generated by the Microsoft Entity Framework.</span></span> <span data-ttu-id="f5374-196">Поле \_DB является экземпляром класса Мовиесдбентитиес, созданного Entity Designer.</span><span class="sxs-lookup"><span data-stu-id="f5374-196">The \_db field is an instance of the MoviesDBEntities class that was generated by the Entity Designer.</span></span>

<span data-ttu-id="f5374-197">Поле \_DB используется в действии index () для получения записей из таблицы базы данных фильмов.</span><span class="sxs-lookup"><span data-stu-id="f5374-197">The \_db field is used within the Index() action to retrieve the records from the Movies database table.</span></span> <span data-ttu-id="f5374-198">Выражение \_DB. Набор фильмов представляет все записи из таблицы базы данных фильмов.</span><span class="sxs-lookup"><span data-stu-id="f5374-198">The expression \_db.MovieSet represents all of the records from the Movies database table.</span></span> <span data-ttu-id="f5374-199">Метод ToList () используется для преобразования набора фильмов в универсальную коллекцию объектов Movie: List (фильм).</span><span class="sxs-lookup"><span data-stu-id="f5374-199">The ToList() method is used to convert the set of movies into a generic collection of Movie objects: List( Of Movie).</span></span>

<span data-ttu-id="f5374-200">Записи фильмов извлекаются с помощью LINQ to Entities.</span><span class="sxs-lookup"><span data-stu-id="f5374-200">The movie records are retrieved with the help of LINQ to Entities.</span></span> <span data-ttu-id="f5374-201">Действие index () в листинге 1 использует *синтаксис метода* LINQ для получения набора записей базы данных.</span><span class="sxs-lookup"><span data-stu-id="f5374-201">The Index() action in Listing 1 uses LINQ *method syntax* to retrieve the set of database records.</span></span> <span data-ttu-id="f5374-202">При желании вместо этого можно использовать *синтаксис запросов* LINQ.</span><span class="sxs-lookup"><span data-stu-id="f5374-202">If you prefer, you can use LINQ *query syntax* instead.</span></span> <span data-ttu-id="f5374-203">Следующие две инструкции выполняют одно и то же действие:</span><span class="sxs-lookup"><span data-stu-id="f5374-203">The following two statements do the very same thing:</span></span>

[!code-vb[Main](creating-model-classes-with-the-entity-framework-vb/samples/sample2.vb)]

<span data-ttu-id="f5374-204">Используйте любой синтаксис LINQ — синтаксис или синтаксис запроса, который наиболее интуитивно понятен.</span><span class="sxs-lookup"><span data-stu-id="f5374-204">Use whichever LINQ syntax – method syntax or query syntax – that you find most intuitive.</span></span> <span data-ttu-id="f5374-205">Различия в производительности между двумя подходами не различаются — единственное различие — стиль.</span><span class="sxs-lookup"><span data-stu-id="f5374-205">There is no difference in performance between the two approaches – the only difference is style.</span></span>

<span data-ttu-id="f5374-206">Представление в листинге 2 используется для отображения записей фильмов.</span><span class="sxs-lookup"><span data-stu-id="f5374-206">The view in Listing 2 is used to display the movie records.</span></span>

<span data-ttu-id="f5374-207">**Листинг 2 — Виевс\хоме\индекс.аспкс**</span><span class="sxs-lookup"><span data-stu-id="f5374-207">**Listing 2 – Views\Home\Index.aspx**</span></span>

[!code-aspx[Main](creating-model-classes-with-the-entity-framework-vb/samples/sample3.aspx)]

<span data-ttu-id="f5374-208">Представление в листинге 2 содержит цикл **for each** , который выполняет итерацию по каждой записи фильма и отображает значения свойств Title и Director записи фильма.</span><span class="sxs-lookup"><span data-stu-id="f5374-208">The view in Listing 2 contains a **For Each** loop that iterates through each movie record and displays the values of the movie record's Title and Director properties.</span></span> <span data-ttu-id="f5374-209">Обратите внимание, что рядом с каждой записью отображается ссылка изменить и удалить.</span><span class="sxs-lookup"><span data-stu-id="f5374-209">Notice that an Edit and Delete link is displayed next to each record.</span></span> <span data-ttu-id="f5374-210">Кроме того, в нижней части представления появится ссылка Добавить фильм (см. рис. 7).</span><span class="sxs-lookup"><span data-stu-id="f5374-210">Furthermore, an Add Movie link appears at the bottom of the view (see Figure 7).</span></span>

<span data-ttu-id="f5374-211">**Рис. 7. представление индекса**</span><span class="sxs-lookup"><span data-stu-id="f5374-211">**Figure 7 – The Index view**</span></span>

![clip_image014](creating-model-classes-with-the-entity-framework-vb/_static/image7.jpg)

<span data-ttu-id="f5374-213">Представление индекса является *типизированным представлением*.</span><span class="sxs-lookup"><span data-stu-id="f5374-213">The Index view is a *typed view*.</span></span> <span data-ttu-id="f5374-214">Представление индекса содержит &lt;директиву% @ Page%&gt;, включающую атрибут Inherits.</span><span class="sxs-lookup"><span data-stu-id="f5374-214">The Index view has a &lt;%@ Page %&gt; directive that includes an Inherits attribute.</span></span> <span data-ttu-id="f5374-215">Атрибут Inherits приводит свойство ViewData. Model к строго типизированной коллекции списков объектов Movie — списку (Movie).</span><span class="sxs-lookup"><span data-stu-id="f5374-215">The Inherits attribute casts the ViewData.Model property to a strongly typed generic List collection of Movie objects – a List(Of Movie).</span></span>

## <a name="inserting-database-records-with-the-entity-framework"></a><span data-ttu-id="f5374-216">Вставка записей базы данных с Entity Framework</span><span class="sxs-lookup"><span data-stu-id="f5374-216">Inserting Database Records with the Entity Framework</span></span>

<span data-ttu-id="f5374-217">Можно использовать Entity Framework, чтобы упростить вставку новых записей в таблицу базы данных.</span><span class="sxs-lookup"><span data-stu-id="f5374-217">You can use the Entity Framework to make it easy to insert new records into a database table.</span></span> <span data-ttu-id="f5374-218">В листинге 3 содержатся два новых действия, добавленных в класс контроллера Home, которые можно использовать для вставки новых записей в таблицу базы данных фильмов.</span><span class="sxs-lookup"><span data-stu-id="f5374-218">Listing 3 contains two new actions added to the Home controller class that you can use to insert new records into the Movie database table.</span></span>

<span data-ttu-id="f5374-219">**Листинг 3 — Контроллерс\хомеконтроллер.ВБ (Добавление методов)**</span><span class="sxs-lookup"><span data-stu-id="f5374-219">**Listing 3 – Controllers\HomeController.vb (Add methods)**</span></span>

[!code-vb[Main](creating-model-classes-with-the-entity-framework-vb/samples/sample4.vb)]

<span data-ttu-id="f5374-220">Первое действие Add () просто возвращает представление.</span><span class="sxs-lookup"><span data-stu-id="f5374-220">The first Add() action simply returns a view.</span></span> <span data-ttu-id="f5374-221">Представление содержит форму для добавления новой записи базы данных фильмов (см. рис. 8).</span><span class="sxs-lookup"><span data-stu-id="f5374-221">The view contains a form for adding a new movie database record (see Figure 8).</span></span> <span data-ttu-id="f5374-222">При отправке формы вызывается второе действие Add ().</span><span class="sxs-lookup"><span data-stu-id="f5374-222">When you submit the form, the second Add() action is invoked.</span></span>

<span data-ttu-id="f5374-223">Обратите внимание, что второе действие Add () дополнено атрибутом Акцептвербс.</span><span class="sxs-lookup"><span data-stu-id="f5374-223">Notice that the second Add() action is decorated with the AcceptVerbs attribute.</span></span> <span data-ttu-id="f5374-224">Это действие может быть вызвано только при выполнении операции HTTP POST.</span><span class="sxs-lookup"><span data-stu-id="f5374-224">This action can be invoked only when performing an HTTP POST operation.</span></span> <span data-ttu-id="f5374-225">Иными словами, это действие можно вызвать только при публикации HTML-формы.</span><span class="sxs-lookup"><span data-stu-id="f5374-225">In other words, this action can only be invoked when posting an HTML form.</span></span>

<span data-ttu-id="f5374-226">Второе действие Add () создает новый экземпляр класса Entity Framework Movie с помощью метода ASP.NET MVC Трюпдатемодел ().</span><span class="sxs-lookup"><span data-stu-id="f5374-226">The second Add() action creates a new instance of the Entity Framework Movie class with the help of the ASP.NET MVC TryUpdateModel() method.</span></span> <span data-ttu-id="f5374-227">Метод Трюпдатемодел () принимает поля в Формколлектион, передаваемые методу Add (), и присваивает значения этих полей HTML-форм классу Movie.</span><span class="sxs-lookup"><span data-stu-id="f5374-227">The TryUpdateModel() method takes the fields in the FormCollection passed to the Add() method and assigns the values of these HTML form fields to the Movie class.</span></span>

<span data-ttu-id="f5374-228">При использовании Entity Framework, необходимо указать «утвержденный список» свойств при использовании методов TryUpdateModel или UpdateModel для обновления свойств класса сущностей.</span><span class="sxs-lookup"><span data-stu-id="f5374-228">When using the Entity Framework, you must supply a "white list" of properties when using the TryUpdateModel or UpdateModel methods to update the properties of an entity class.</span></span>

<span data-ttu-id="f5374-229">Затем действие Add () выполняет простую проверку формы.</span><span class="sxs-lookup"><span data-stu-id="f5374-229">Next, the Add() action performs some simple form validation.</span></span> <span data-ttu-id="f5374-230">Действие проверяет, что свойства Title и Director имеют значения.</span><span class="sxs-lookup"><span data-stu-id="f5374-230">The action verifies that both the Title and Director properties have values.</span></span> <span data-ttu-id="f5374-231">При возникновении ошибки проверки в ModelState добавляется сообщение об ошибке проверки.</span><span class="sxs-lookup"><span data-stu-id="f5374-231">If there is a validation error, then a validation error message is added to ModelState.</span></span>

<span data-ttu-id="f5374-232">Если ошибки проверки отсутствуют, в таблицу фильмов базы данных добавляется новая запись с помощью Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="f5374-232">If there are no validation errors then a new movie record is added to the Movies database table with the help of the Entity Framework.</span></span> <span data-ttu-id="f5374-233">Новая запись добавляется в базу данных с помощью следующих двух строк кода:</span><span class="sxs-lookup"><span data-stu-id="f5374-233">The new record is added to the database with the following two lines of code:</span></span>

[!code-vb[Main](creating-model-classes-with-the-entity-framework-vb/samples/sample5.vb)]

<span data-ttu-id="f5374-234">Первая строка кода добавляет новую сущность Movie в набор фильмов, отслеживаемых Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="f5374-234">The first line of code adds the new Movie entity to the set of movies being tracked by the Entity Framework.</span></span> <span data-ttu-id="f5374-235">Вторая строка кода сохраняет все изменения, внесенные в фильмы, отслеживаемые обратно в основную базу данных.</span><span class="sxs-lookup"><span data-stu-id="f5374-235">The second line of code saves whatever changes have been made to the Movies being tracked back to the underlying database.</span></span>

<span data-ttu-id="f5374-236">**Рис. 8. Добавление представления**</span><span class="sxs-lookup"><span data-stu-id="f5374-236">**Figure 8 – The Add view**</span></span>

![clip_image016](creating-model-classes-with-the-entity-framework-vb/_static/image8.jpg)

## <a name="updating-database-records-with-the-entity-framework"></a><span data-ttu-id="f5374-238">Обновление записей базы данных с помощью Entity Framework</span><span class="sxs-lookup"><span data-stu-id="f5374-238">Updating Database Records with the Entity Framework</span></span>

<span data-ttu-id="f5374-239">Можно выполнить практически тот же подход, чтобы изменить запись базы данных с Entity Framework в качестве подхода, который только что следовало вставить новую запись базы данных.</span><span class="sxs-lookup"><span data-stu-id="f5374-239">You can follow almost the same approach to edit a database record with the Entity Framework as the approach that we just followed to insert a new database record.</span></span> <span data-ttu-id="f5374-240">В листинге 4 содержатся два новых действия контроллера с именем Edit ().</span><span class="sxs-lookup"><span data-stu-id="f5374-240">Listing 4 contains two new controller actions named Edit().</span></span> <span data-ttu-id="f5374-241">Первое действие Edit () Возвращает HTML-форму для редактирования записи фильма.</span><span class="sxs-lookup"><span data-stu-id="f5374-241">The first Edit() action returns an HTML form for editing a movie record.</span></span> <span data-ttu-id="f5374-242">Второе действие Edit () пытается обновить базу данных.</span><span class="sxs-lookup"><span data-stu-id="f5374-242">The second Edit() action attempts to update the database.</span></span>

<span data-ttu-id="f5374-243">**Листинг 4 — Контроллерс\хомеконтроллер.ВБ (методы изменения)**</span><span class="sxs-lookup"><span data-stu-id="f5374-243">**Listing 4 – Controllers\HomeController.vb (Edit methods)**</span></span>

[!code-vb[Main](creating-model-classes-with-the-entity-framework-vb/samples/sample6.vb)]

<span data-ttu-id="f5374-244">Второе действие Edit () начинается с получения записи фильма из базы данных, которая соответствует идентификатору редактируемого фильма.</span><span class="sxs-lookup"><span data-stu-id="f5374-244">The second Edit() action starts by retrieving the Movie record from the database that matches the Id of the movie being edited.</span></span> <span data-ttu-id="f5374-245">Следующая инструкция LINQ to Entities извлекает первую запись базы данных, которая соответствует определенному идентификатору:</span><span class="sxs-lookup"><span data-stu-id="f5374-245">The following LINQ to Entities statement grabs the first database record that matches a particular Id:</span></span>

[!code-vb[Main](creating-model-classes-with-the-entity-framework-vb/samples/sample7.vb)]

<span data-ttu-id="f5374-246">Затем метод Трюпдатемодел () используется для присвоения значений полей HTML-формы свойствам сущности Movie.</span><span class="sxs-lookup"><span data-stu-id="f5374-246">Next, the TryUpdateModel() method is used to assign the values of the HTML form fields to the properties of the movie entity.</span></span> <span data-ttu-id="f5374-247">Обратите внимание, что предоставляется белый список, указывающий точные свойства для обновления.</span><span class="sxs-lookup"><span data-stu-id="f5374-247">Notice that a white list is supplied to specify the exact properties to update.</span></span>

<span data-ttu-id="f5374-248">Далее необходимо выполнить некоторые простые проверки, чтобы убедиться в том, что в качестве заголовка фильма и свойства режиссера заданы значения.</span><span class="sxs-lookup"><span data-stu-id="f5374-248">Next, some simple validation is performed to verify that both the Movie Title and Director properties have values.</span></span> <span data-ttu-id="f5374-249">Если в любом из свойств отсутствует значение, то в ModelState и ModelState добавляется сообщение об ошибке проверки. IsValid возвращает значение false.</span><span class="sxs-lookup"><span data-stu-id="f5374-249">If either property is missing a value, then a validation error message is added to ModelState and ModelState.IsValid returns the value false.</span></span>

<span data-ttu-id="f5374-250">Наконец, если ошибки проверки отсутствуют, то таблица базы данных фильмов обновляется с учетом изменений путем вызова метода SaveChanges ().</span><span class="sxs-lookup"><span data-stu-id="f5374-250">Finally, if there are no validation errors, then the underlying Movies database table is updated with any changes by calling the SaveChanges() method.</span></span>

<span data-ttu-id="f5374-251">При редактировании записей базы данных необходимо передать идентификатор изменяемой записи в действие контроллера, которое выполняет обновление базы данных.</span><span class="sxs-lookup"><span data-stu-id="f5374-251">When editing database records, you need to pass the Id of the record being edited to the controller action that performs the database update.</span></span> <span data-ttu-id="f5374-252">В противном случае действие контроллера не сможет понять, какая запись будет обновлена в базовой базе данных.</span><span class="sxs-lookup"><span data-stu-id="f5374-252">Otherwise, the controller action will not know which record to update in the underlying database.</span></span> <span data-ttu-id="f5374-253">Представление редактирования, содержащееся в листинге 5, включает в себя скрытое поле формы, представляющее идентификатор редактируемой записи базы данных.</span><span class="sxs-lookup"><span data-stu-id="f5374-253">The Edit view, contained in Listing 5, includes a hidden form field that represents the Id of the database record being edited.</span></span>

<span data-ttu-id="f5374-254">**Листинг 5 — Виевс\хоме\едит.аспкс**</span><span class="sxs-lookup"><span data-stu-id="f5374-254">**Listing 5 – Views\Home\Edit.aspx**</span></span>

[!code-aspx[Main](creating-model-classes-with-the-entity-framework-vb/samples/sample8.aspx)]

## <a name="deleting-database-records-with-the-entity-framework"></a><span data-ttu-id="f5374-255">Удаление записей базы данных с Entity Framework</span><span class="sxs-lookup"><span data-stu-id="f5374-255">Deleting Database Records with the Entity Framework</span></span>

<span data-ttu-id="f5374-256">Завершающей операцией с базой данных, которую нам нужно справиться с этим руководством, является удаление записей базы данных.</span><span class="sxs-lookup"><span data-stu-id="f5374-256">The final database operation, which we need to tackle in this tutorial, is deleting database records.</span></span> <span data-ttu-id="f5374-257">Чтобы удалить определенную запись базы данных, можно использовать действие контроллера в листинге 6.</span><span class="sxs-lookup"><span data-stu-id="f5374-257">You can use the controller action in Listing 6 to delete a particular database record.</span></span>

<span data-ttu-id="f5374-258">**Листинг 6. \Контроллерс\хомеконтроллер.ВБ (Удаление действия)**</span><span class="sxs-lookup"><span data-stu-id="f5374-258">**Listing 6 -- \Controllers\HomeController.vb (Delete action)**</span></span>

[!code-vb[Main](creating-model-classes-with-the-entity-framework-vb/samples/sample9.vb)]

<span data-ttu-id="f5374-259">Действие DELETE () сначала извлекает сущность Movie, которая соответствует идентификатору, переданному действию.</span><span class="sxs-lookup"><span data-stu-id="f5374-259">The Delete() action first retrieves the Movie entity that matches the Id passed to the action.</span></span> <span data-ttu-id="f5374-260">Затем фильм удаляется из базы данных путем вызова метода DeleteObject (), за которым следует метод SaveChanges ().</span><span class="sxs-lookup"><span data-stu-id="f5374-260">Next, the movie is deleted from the database by calling the DeleteObject() method followed by the SaveChanges() method.</span></span> <span data-ttu-id="f5374-261">Наконец, пользователь перенаправляется обратно в представление индекса.</span><span class="sxs-lookup"><span data-stu-id="f5374-261">Finally, the user is redirected back to the Index view.</span></span>

## <a name="summary"></a><span data-ttu-id="f5374-262">Сводка</span><span class="sxs-lookup"><span data-stu-id="f5374-262">Summary</span></span>

<span data-ttu-id="f5374-263">Цель этого руководства — продемонстрировать, как можно создавать веб-приложения на основе баз данных, используя преимущества ASP.NET MVC и Microsoft Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="f5374-263">The purpose of this tutorial was to demonstrate how you can build database-driven web applications by taking advantage of ASP.NET MVC and the Microsoft Entity Framework.</span></span> <span data-ttu-id="f5374-264">Вы узнали, как создать приложение, позволяющее выбирать, вставлять, обновлять и удалять записи базы данных.</span><span class="sxs-lookup"><span data-stu-id="f5374-264">You learned how to build an application that enables you to select, insert, update, and delete database records.</span></span>

<span data-ttu-id="f5374-265">Сначала мы рассмотрели, как можно использовать мастер EDM для создания EDM в Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="f5374-265">First, we discussed how you can use the Entity Data Model Wizard to generate an Entity Data Model from within Visual Studio.</span></span> <span data-ttu-id="f5374-266">Далее вы узнаете, как использовать LINQ to Entities для получения набора записей базы данных из таблицы базы данных.</span><span class="sxs-lookup"><span data-stu-id="f5374-266">Next, you learn how to use LINQ to Entities to retrieve a set of database records from a database table.</span></span> <span data-ttu-id="f5374-267">Наконец, мы использовали Entity Framework для вставки, обновления и удаления записей базы данных.</span><span class="sxs-lookup"><span data-stu-id="f5374-267">Finally, we used the Entity Framework to insert, update, and delete database records.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="f5374-268">[Назад](validation-with-the-data-annotation-validators-cs.md)
> [Вперед](creating-model-classes-with-linq-to-sql-vb.md)</span><span class="sxs-lookup"><span data-stu-id="f5374-268">[Previous](validation-with-the-data-annotation-validators-cs.md)
[Next](creating-model-classes-with-linq-to-sql-vb.md)</span></span>
