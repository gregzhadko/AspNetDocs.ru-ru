---
uid: mvc/overview/older-versions-1/models-data/creating-model-classes-with-linq-to-sql-vb
title: Создание классов модели в LINQ to SQL (Visual Basic) | Документация Майкрософт
author: microsoft
description: Этот учебник призван объяснить одним из способов создание классов модели для приложения ASP.NET MVC. В этом руководстве вы узнаете, как для построения модели c...
ms.author: riande
ms.date: 10/07/2008
ms.assetid: a4a25a75-d71f-4509-98b4-df72e748985a
msc.legacyurl: /mvc/overview/older-versions-1/models-data/creating-model-classes-with-linq-to-sql-vb
msc.type: authoredcontent
ms.openlocfilehash: 212287ea384cf54f9eda477e6f706637d10dd54a
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/09/2019
ms.locfileid: "59419903"
---
# <a name="creating-model-classes-with-linq-to-sql-vb"></a>Создание классов модели в LINQ to SQL (VB)

по [Microsoft](https://github.com/microsoft)

[Скачать PDF](http://download.microsoft.com/download/1/1/f/11f721aa-d749-4ed7-bb89-a681b68894e6/ASPNET_MVC_Tutorial_10_VB.pdf)

> Этот учебник призван объяснить одним из способов создание классов модели для приложения ASP.NET MVC. В этом руководстве вы узнаете, как создать классы модели и выполнять доступ к базе данных, используя преимущества Microsoft LINQ to SQL.


Этот учебник призван объяснить одним из способов создание классов модели для приложения ASP.NET MVC. В этом руководстве вы узнаете, как создать классы модели и выполнять доступ к базе данных, используя преимущества Microsoft LINQ to SQL.

В этом руководстве мы создать базовое приложение базы данных фильмов. Мы начнем с создания приложения базы данных Movie в быстрым и простым способом невозможно. Все наши доступ к данным выполнять непосредственно из наших действий контроллера.

Далее вы узнаете, как использовать шаблон репозитория. Чтобы использовать шаблон репозитория требует немного больше работы. Тем не менее, перехода на этот шаблон удобен тем, что она позволяет создавать приложения, для адаптации к изменить и можно легко проверить.

## <a name="what-is-a-model-class"></a>Что такое класс модели?

Модель MVC содержит всю логику приложения, не содержащийся в представлении MVC или контроллер MVC. В частности модель MVC содержит все логики доступа к данным и бизнес-приложения.

Можно использовать множество различных технологий для реализации логики доступа к данным. Например можно создать классы данных доступа с помощью классов Microsoft Entity Framework, NHibernate, Subsonic или ADO.NET.

В данном случае я использую LINQ to SQL для запроса и обновления базы данных. LINQ to SQL предоставляет очень простой метод взаимодействия с базой данных Microsoft SQL Server. Тем не менее важно понимать, что платформа ASP.NET MVC не привязан к LINQ to SQL любым способом. ASP.NET MVC совместим с любой технологии доступа к данным.

## <a name="create-a-movie-database"></a>Создание базы данных Movie

В этом руководстве--Чтобы проиллюстрировать, как создать классы модели — мы создать простое приложение базы данных фильмов. Первым шагом является создание новой базы данных. Щелкните правой кнопкой мыши приложение\_папка данных в окно обозревателя решений и выберите пункт меню **добавить, новый элемент**. Выберите шаблон базы данных SQL Server, присвойте ему имя MoviesDB.mdf и нажмите кнопку **добавить** кнопку (см. рис. 1).


[![Adding новую базу данных SQL Server](creating-model-classes-with-linq-to-sql-vb/_static/image2.png)](creating-model-classes-with-linq-to-sql-vb/_static/image1.png)

**Рис 01**: Добавление новой базы данных SQL Server ([Просмотр полноразмерного изображения](creating-model-classes-with-linq-to-sql-vb/_static/image3.png))


После создания новой базы данных, можно открыть базу данных, дважды щелкнув файл MoviesDB.mdf в приложении\_папку данных. Дважды щелкните файл MoviesDB.mdf открыть окно обозревателя сервера (см. рис. 2).


|   | Окно обозревателя сервера называется окна обозревателя базы данных, при использовании Visual Web Developer. |
|---|----------------------------------------------------------------------------------------------------|
|   |                                                                                                    |

[![Uода окно обозревателя сервера](creating-model-classes-with-linq-to-sql-vb/_static/image5.png)](creating-model-classes-with-linq-to-sql-vb/_static/image4.png)

**Рис. 02**: В окне обозревателя серверов ([Просмотр полноразмерного изображения](creating-model-classes-with-linq-to-sql-vb/_static/image6.png))


Нам нужно добавить одной таблицы к базе данных, представляющий наших фильмов. Щелкните правой кнопкой мыши папку «таблицы» и выберите пункт меню **добавить новую таблицу**. Если выбрать этот пункт меню открывается в конструкторе таблиц (см. рис. 3).


[![Uода окно обозревателя сервера](creating-model-classes-with-linq-to-sql-vb/_static/image8.png)](creating-model-classes-with-linq-to-sql-vb/_static/image7.png)

**Рис 03**: В конструкторе таблиц ([Просмотр полноразмерного изображения](creating-model-classes-with-linq-to-sql-vb/_static/image9.png))


Нам нужно добавить следующие столбцы в нашей таблице базы данных:

| **Имя столбца** | **Тип данных** | **Разрешить значения null** |
| --- | --- | --- |
| Идентификатор | Int | False |
| Заголовок | Nvarchar(200) | False |
| Директор | nvarchar(50) | False |

Необходимо выполнить два специальных действия со столбцом идентификаторов. Во-первых необходимо пометить столбец Id как столбец первичного ключа, выбрав столбец в конструкторе таблиц и щелкнув значок ключа. LINQ to SQL требует указания первичного ключа, при выполнении вставляет или обновляет в базе данных.

Далее необходимо обозначить столбец идентификатора как столбец идентификаторов, следует назначить Да для **Is Identity** свойство (см. рис. 3). Столбец Identity является столбец, который будет назначен новый номер автоматически каждый раз при добавлении новой строки данных в таблицу.

После внесения этих изменений, сохраните таблицу с именем tblMovie. Таблицу можно сохранить, нажав кнопку "Сохранить".

## <a name="create-linq-to-sql-classes"></a>Создание классов LINQ to SQL

Наша модель MVC будет содержать LINQ к SQL классам, представляющим tblMovie таблицы базы данных. Самый простой способ создать эти классы LINQ to SQL — щелкните папку Models правой кнопкой мыши **добавить, новый элемент**выберите LINQ to SQL Classes шаблон, присвойте имя Movie.dbml классы и нажмите кнопку **добавить**кнопку (см. рис. 4).


[![Cается LINQ для классов SQL](creating-model-classes-with-linq-to-sql-vb/_static/image11.png)](creating-model-classes-with-linq-to-sql-vb/_static/image10.png)

**Рис. 04**: Создание LINQ для классов SQL ([Просмотр полноразмерного изображения](creating-model-classes-with-linq-to-sql-vb/_static/image12.png))


Сразу после создания фильма классам LINQ to SQL, откроется реляционный конструктор объектов. Таблицы базы данных можно перетащить из окна обозревателя серверов в реляционный конструктор объектов для создания классов LINQ to SQL, представляющих таблицы конкретной базы данных. Нам нужно добавить таблицу базы данных tblMovie на реляционный конструктор объектов (см. рис. 4).


[![Uода реляционный конструктор объектов](creating-model-classes-with-linq-to-sql-vb/_static/image14.png)](creating-model-classes-with-linq-to-sql-vb/_static/image13.png)

**05 рис**: С помощью реляционного конструктора объектов ([Просмотр полноразмерного изображения](creating-model-classes-with-linq-to-sql-vb/_static/image15.png))


По умолчанию реляционный конструктор объектов создает класс с именем то же самое, что в таблице базы данных, перетащите в конструктор. Тем не менее мы не хотим вызвать tblMovie наш класс. Таким образом щелкните имя класса в конструкторе и измените имя класса для фильмов.

Наконец, не забудьте нажать **Сохранить** кнопку для сохранения LINQ to SQL Classes (изображение дискеты). В противном случае LINQ to SQL Classes не будет создаваться реляционный конструктор объектов.

## <a name="using-linq-to-sql-in-a-controller-action"></a>Использование LINQ to SQL в действие контроллера

Теперь, когда у нас есть наших классов LINQ to SQL, эти классы можно использовать для получения данных из базы данных. В этом разделе вы узнаете, как использовать LINQ для классов SQL непосредственно в действие контроллера. Мы будем отображать список фильмов tblMovies таблицы базы данных в представлении MVC.

Во-первых нам нужно изменить в класс HomeController. Этот класс можно найти в папке Controllers приложения. Измените класс, чтобы он выглядел классу в листинге 1.

**Листинг 1. `Controllers\HomeController.vb`**

[!code-vb[Main](creating-model-classes-with-linq-to-sql-vb/samples/sample1.vb)]

Действие Index() в листинге 1 использует LINQ to SQL DataContext класс (MovieDataContext) для представления MoviesDB базы данных. Класс MoveDataContext созданное Visual Studio реляционный конструктор объектов.

Запрос LINQ выполняется применительно к DataContext для извлечения всех фильмов tblMovies таблицы базы данных. Список фильмов назначается локальной переменной с именем фильмов. Наконец список фильмов передается в представление данных представления.

Чтобы можно было отобразить в кино, мы Далее необходимо изменение представления индекса. Представление индекса, вы можете найти в папке Views\Home\. Обновление представления индекса, чтобы он выглядел подобно представлению в листинге 2.

**Листинг 2. `Views\Home\Index.aspx`**

[!code-aspx[Main](creating-model-classes-with-linq-to-sql-vb/samples/sample2.aspx)]

Обратите внимание, что измененный представление индекса содержит &lt;% @ % импорта пространства имен&gt; директив в верхней части представления. Эта директива импортирует пространство имен MvcApplication1. Мы должны это пространство имен для работы с классами модели — в частности, класс Movie--в представлении.

Представление в листинге 2 содержит For цикла foreach, который используется для итерации по всем элементам, представленный свойством ViewData.Model. Значение свойства Title отображается для каждого фильма.

Обратите внимание на то, что значение свойства ViewData.Model приводится к IEnumerable. Это необходимо, чтобы перебрать содержимое ViewData.Model. Другой вариант — это создать строго типизированное представление. При создании строго типизированное представление, можно привести свойство ViewData.Model для конкретного типа в классе фонового кода представления.

Если вы запустите приложение после внесения изменений в класс HomeController и представления индекса, то вы получите пустую страницу. Вы получите пустую страницу, так как нет записей фильмов в таблице tblMovies базы данных.

Чтобы добавить записи в таблицу базы данных tblMovies, щелкните правой кнопкой мыши таблицу базы данных tblMovies в окне обозревателя серверов (окно обозревателя базы данных в Visual Web Developer) и выберите пункт меню **Показать таблицу данных**. Можно вставлять записи фильма с помощью сетки, который отображается (см. рис. 5).


[![Iфильмы nserting](creating-model-classes-with-linq-to-sql-vb/_static/image17.png)](creating-model-classes-with-linq-to-sql-vb/_static/image16.png)

**Рис 06**: Вставка видео ([Просмотр полноразмерного изображения](creating-model-classes-with-linq-to-sql-vb/_static/image18.png))


После добавления некоторых записей базы данных в таблицу tblMovies и запустите приложение, появится страница, на рис. 7. Все записи базы данных фильмов, отображаются в виде маркированного списка.


[![Dпредставление фильмов isplaying с индексом](creating-model-classes-with-linq-to-sql-vb/_static/image20.png)](creating-model-classes-with-linq-to-sql-vb/_static/image19.png)

**07 рис**: Отображение видео в представлении индекса ([Просмотр полноразмерного изображения](creating-model-classes-with-linq-to-sql-vb/_static/image21.png))


## <a name="using-the-repository-pattern"></a>Чтобы использовать шаблон репозитория

В предыдущем разделе мы использовали LINQ для классов SQL непосредственно в действие контроллера. Мы использовали класс MovieDataContext непосредственно из Index() действия контроллера. Нет ничего плохого таким образом в случае простого приложения. Тем не менее работа напрямую с помощью LINQ to SQL в класс контроллера создает проблемы, когда вам нужно создать более сложное приложение.

С помощью LINQ to SQL в класс контроллера затрудняет для переключения технологии доступа к данным в будущем. Например можно перейти от использования Microsoft LINQ to SQL с помощью Microsoft Entity Framework в качестве вашей технологии доступа к данным. В этом случае необходимо переписать каждый контроллер, который обращается к базе данных в приложении.

С помощью LINQ to SQL в класс контроллера также усложняет задачу создания модульных тестов для приложения. Как правило вы не хотите взаимодействовать с базой данных при выполнении модульных тестов. Вы хотите использовать модульные тесты для тестирования логики приложения и не серверу базы данных.

Для создания приложения MVC более адаптируемым для будущих изменений и который может быть проще тестировать, можно использовать шаблон репозитория. При использовании шаблона репозитория, создается класс отдельный репозиторий, который содержит всю логику доступа к вашей базы данных.

При создании класс репозитория, создается интерфейс, представляющий все методы, используемые классом репозитория. В контроллерах при написании кода для интерфейса, а не репозитории. Таким образом, вы можете реализовать репозиторий, используя технологии доступа к данным различных в будущем.

Интерфейс в листинге 3 называется IMovieRepository и представляет один метод с именем ListAll().

**Листинг 3. `Models\IMovieRepository.vb`**

[!code-vb[Main](creating-model-classes-with-linq-to-sql-vb/samples/sample3.vb)]

Класс репозитория в листинге 4 реализует интерфейс IMovieRepository. Обратите внимание на то, что он содержит метод с именем ListAll(), соответствующий методу, требуемые интерфейсом IMovieRepository.

**Листинг 4. `Models\MovieRepository.vb`**

[!code-vb[Main](creating-model-classes-with-linq-to-sql-vb/samples/sample4.vb)]

Наконец класс MoviesController в листинге 5 использует шаблон репозитория. Она больше не использует LINQ для классов SQL напрямую.

**Листинг 5. `Controllers\MoviesController.vb`**

[!code-vb[Main](creating-model-classes-with-linq-to-sql-vb/samples/sample5.vb)]

Обратите внимание на то, что класс MoviesController в листинге 5 имеет два конструктора. Первый конструктор конструктор без параметров, вызывается в том случае, когда приложение запущено. Этот конструктор создает экземпляр класса MovieRepository и передает его второй конструктор.

Второй конструктор имеет один параметр: параметр IMovieRepository. Этот конструктор просто присваивает значение параметра поле уровня класса с именем \_репозитория.

Класс MoviesController использует преимущества программного обеспечения шаблон, который называется шаблон внедрения зависимостей. В частности она использует так называемую внедрение зависимостей конструктора. Дополнительные сведения об этой модели, ознакомьтесь со следующей статьей по (Martin Fowler):

[http://martinfowler.com/articles/injection.html](http://martinfowler.com/articles/injection.html)

Обратите внимание на то, что весь код в классе MoviesController (за исключением первый конструктор) взаимодействует с интерфейсом IMovieRepository вместо собственно с классом MovieRepository. Код взаимодействует с абстрактный интерфейс вместо конкретную реализацию интерфейса.

Если вы хотите изменить технологии доступа к данным, используемые приложением можно просто реализовать интерфейс IMovieRepository с классом, который использует технологию доступа к альтернативной базы данных. Например можно создать класс EntityFrameworkMovieRepository или SubSonicMovieRepository класс. Так как класс контроллера запрограммированы в интерфейсе, можно передать новую реализацию IMovieRepository класс контроллера и класса будет продолжать работать.

Кроме того Если вы хотите протестировать класс MoviesController, затем можно передать класс репозитория с фиктивными фильма MoviesController. Можно реализовать класс IMovieRepository с классом, который не осуществляет доступ к фактически базы данных, но содержит все необходимые методы интерфейса IMovieRepository. Таким образом, вы можете модульный тест MoviesController класс без фактически обращения к реальной базой данных.

## <a name="summary"></a>Сводка

Цель этого учебника было продемонстрировать, как можно создавать классы модели MVC, используя преимущества Microsoft LINQ to SQL. Мы рассмотрели две стратегии для отображения данных базы данных в приложении ASP.NET MVC. Во-первых мы создали LINQ для классов SQL и используемые классы непосредственно в действие контроллера. Использование LINQ для классов SQL в контроллере позволяет быстро и легко отображать данные базы данных в приложении MVC.

Далее мы изучили немного сложнее, но определенно более эффективный путь для отображения данных базы данных. Мы воспользовались преимуществами шаблона репозитория и поместить все наши логики доступа к базе данных в отдельном репозитории класс. В нашем контроллере мы написали все часть нашего кода на основе интерфейса вместо конкретного класса. Шаблона репозитория удобен тем, что позволяет легко изменять технологий доступа к базе данных в будущем, и это позволяет нам легко тестировать наших классов контроллеров.

> [!div class="step-by-step"]
> [Назад](creating-model-classes-with-the-entity-framework-vb.md)
> [Вперед](displaying-a-table-of-database-data-vb.md)
