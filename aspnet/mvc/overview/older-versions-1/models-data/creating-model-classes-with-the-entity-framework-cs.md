---
uid: mvc/overview/older-versions-1/models-data/creating-model-classes-with-the-entity-framework-cs
title: Создание классов модели в Entity Framework (C#) | Документация Майкрософт
author: microsoft
description: В этом руководстве вы узнаете, как использовать ASP.NET MVC с помощью Microsoft Entity Framework. Вы узнаете, как использовать мастер для создания сущностей ADO.NET Da...
ms.author: riande
ms.date: 01/27/2009
ms.assetid: 61644169-e8b1-45dd-bf96-9c2301b69879
msc.legacyurl: /mvc/overview/older-versions-1/models-data/creating-model-classes-with-the-entity-framework-cs
msc.type: authoredcontent
ms.openlocfilehash: d1cf97a7f1dc9bae2774518cdfc13da48fc7ada2
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/01/2019
ms.locfileid: "57043081"
---
<a name="creating-model-classes-with-the-entity-framework-c"></a><span data-ttu-id="11df4-104">Создание классов модели в Entity Framework (C#)</span><span class="sxs-lookup"><span data-stu-id="11df4-104">Creating Model Classes with the Entity Framework (C#)</span></span>
====================
<span data-ttu-id="11df4-105">по [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="11df4-105">by [Microsoft](https://github.com/microsoft)</span></span>

> <span data-ttu-id="11df4-106">В этом руководстве вы узнаете, как использовать ASP.NET MVC с помощью Microsoft Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="11df4-106">In this tutorial, you learn how to use ASP.NET MVC with the Microsoft Entity Framework.</span></span> <span data-ttu-id="11df4-107">Вы узнаете, как использовать мастер для создания модели EDM ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="11df4-107">You learn how to use the Entity Wizard to create an ADO.NET Entity Data Model.</span></span> <span data-ttu-id="11df4-108">В ходе работы с этим руководством мы создаем веб-приложения, демонстрирующий выбор, вставки, обновления и удаления базы данных с помощью Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="11df4-108">Over the course of this tutorial, we build a web application that illustrates how to select, insert, update, and delete database data by using the Entity Framework.</span></span>


<span data-ttu-id="11df4-109">Чтобы объяснить, как создать классы для доступа к данным с помощью Microsoft Entity Framework, при создании приложения ASP.NET MVC является целью данного учебника.</span><span class="sxs-lookup"><span data-stu-id="11df4-109">The goal of this tutorial is to explain how you can create data access classes using the Microsoft Entity Framework when building an ASP.NET MVC application.</span></span> <span data-ttu-id="11df4-110">В учебнике предполагается не знакомства с Microsoft Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="11df4-110">This tutorial assumes no previous knowledge of the Microsoft Entity Framework.</span></span> <span data-ttu-id="11df4-111">В конце этого учебника будет понять, как с помощью Entity Framework на выбор, вставку, обновление и удаление записей базы данных.</span><span class="sxs-lookup"><span data-stu-id="11df4-111">By the end of this tutorial, you'll understand how to use the Entity Framework to select, insert, update, and delete database records.</span></span>

<span data-ttu-id="11df4-112">Microsoft Entity Framework является средством, объект реляционного сопоставления (O/RM), которое позволяет автоматически создавать слой доступа к данным из базы данных.</span><span class="sxs-lookup"><span data-stu-id="11df4-112">The Microsoft Entity Framework is an Object Relational Mapping (O/RM) tool that enables you to generate a data access layer from a database automatically.</span></span> <span data-ttu-id="11df4-113">Платформа Entity Framework позволяет избежать утомительной работы вручную построения ваши классы доступа к данным.</span><span class="sxs-lookup"><span data-stu-id="11df4-113">The Entity Framework enables you to avoid the tedious work of building your data access classes by hand.</span></span>

<span data-ttu-id="11df4-114">Чтобы проиллюстрировать, как можно использовать Microsoft Entity Framework с ASP.NET MVC, мы создадим простой пример приложения.</span><span class="sxs-lookup"><span data-stu-id="11df4-114">In order to illustrate how you can use the Microsoft Entity Framework with ASP.NET MVC, we'll build a simple sample application.</span></span> <span data-ttu-id="11df4-115">Мы создадим приложение базы данных фильмов, дающий возможность отображения и изменения записей базы данных фильмов.</span><span class="sxs-lookup"><span data-stu-id="11df4-115">We'll create a Movie Database application that enables you to display and edit movie database records.</span></span>

<span data-ttu-id="11df4-116">Этом руководстве предполагается, что Visual Studio 2008 или Visual Web Developer 2008 с пакетом обновления 1.</span><span class="sxs-lookup"><span data-stu-id="11df4-116">This tutorial assumes that you have Visual Studio 2008 or Visual Web Developer 2008 with Service Pack 1.</span></span> <span data-ttu-id="11df4-117">Требуется пакет обновления 1 для использования платформы Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="11df4-117">You need Service Pack 1 in order to use the Entity Framework.</span></span> <span data-ttu-id="11df4-118">Пакет обновления 1 для Visual Studio 2008 или Visual Web Developer с пакетом обновления 1 можно скачать из следующий адрес:</span><span class="sxs-lookup"><span data-stu-id="11df4-118">You can download Visual Studio 2008 Service Pack 1 or Visual Web Developer with Service Pack 1 from the following address:</span></span>

> [https://www.asp.net/downloads/](https://www.asp.net/downloads)


> [!NOTE] 
> 
> <span data-ttu-id="11df4-119">Нет essential подключения между ASP.NET MVC и Entity Framework корпорации Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="11df4-119">There is no essential connection between ASP.NET MVC and the Microsoft Entity Framework.</span></span> <span data-ttu-id="11df4-120">Доступно несколько альтернативных решений на платформу Entity Framework, который можно использовать с ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="11df4-120">There are several alternatives to the Entity Framework that you can use with ASP.NET MVC.</span></span> <span data-ttu-id="11df4-121">Например можно создать с помощью других средств объектно-реляционное отображение, таких как Microsoft LINQ to SQL, NHibernate и SubSonic классах модели MVC.</span><span class="sxs-lookup"><span data-stu-id="11df4-121">For example, you can build your MVC Model classes using other O/RM tools such as Microsoft LINQ to SQL, NHibernate, or SubSonic.</span></span>


## <a name="creating-the-movie-sample-database"></a><span data-ttu-id="11df4-122">Создание образца базы данных Movie</span><span class="sxs-lookup"><span data-stu-id="11df4-122">Creating the Movie Sample Database</span></span>

<span data-ttu-id="11df4-123">База данных Movie приложение использует таблицу базы данных, с именем фильмов, который содержит следующие столбцы:</span><span class="sxs-lookup"><span data-stu-id="11df4-123">The Movie Database application uses a database table named Movies that contains the following columns:</span></span>

| <span data-ttu-id="11df4-124">Имя столбца</span><span class="sxs-lookup"><span data-stu-id="11df4-124">Column Name</span></span> | <span data-ttu-id="11df4-125">Тип данных</span><span class="sxs-lookup"><span data-stu-id="11df4-125">Data Type</span></span> | <span data-ttu-id="11df4-126">Разрешить значения NULL?</span><span class="sxs-lookup"><span data-stu-id="11df4-126">Allow Nulls?</span></span> | <span data-ttu-id="11df4-127">Является первичным ключом?</span><span class="sxs-lookup"><span data-stu-id="11df4-127">Is Primary Key?</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="11df4-128">Идентификатор</span><span class="sxs-lookup"><span data-stu-id="11df4-128">Id</span></span> | <span data-ttu-id="11df4-129">int</span><span class="sxs-lookup"><span data-stu-id="11df4-129">int</span></span> | <span data-ttu-id="11df4-130">False</span><span class="sxs-lookup"><span data-stu-id="11df4-130">False</span></span> | <span data-ttu-id="11df4-131">True</span><span class="sxs-lookup"><span data-stu-id="11df4-131">True</span></span> |
| <span data-ttu-id="11df4-132">Заголовок</span><span class="sxs-lookup"><span data-stu-id="11df4-132">Title</span></span> | <span data-ttu-id="11df4-133">nvarchar(100)</span><span class="sxs-lookup"><span data-stu-id="11df4-133">nvarchar(100)</span></span> | <span data-ttu-id="11df4-134">False</span><span class="sxs-lookup"><span data-stu-id="11df4-134">False</span></span> | <span data-ttu-id="11df4-135">False</span><span class="sxs-lookup"><span data-stu-id="11df4-135">False</span></span> |
| <span data-ttu-id="11df4-136">Директор</span><span class="sxs-lookup"><span data-stu-id="11df4-136">Director</span></span> | <span data-ttu-id="11df4-137">nvarchar(100)</span><span class="sxs-lookup"><span data-stu-id="11df4-137">nvarchar(100)</span></span> | <span data-ttu-id="11df4-138">False</span><span class="sxs-lookup"><span data-stu-id="11df4-138">False</span></span> | <span data-ttu-id="11df4-139">False</span><span class="sxs-lookup"><span data-stu-id="11df4-139">False</span></span> |

<span data-ttu-id="11df4-140">В этой таблице можно добавить в проект ASP.NET MVC, сделав следующее:</span><span class="sxs-lookup"><span data-stu-id="11df4-140">You can add this table to an ASP.NET MVC project by following these steps:</span></span>

1. <span data-ttu-id="11df4-141">Щелкните правой кнопкой мыши приложение\_папка данных в окно обозревателя решений и выберите пункт меню **добавить, новый элемент.**</span><span class="sxs-lookup"><span data-stu-id="11df4-141">Right-click the App\_Data folder in the Solution Explorer window and select the menu option **Add, New Item.**</span></span>
2. <span data-ttu-id="11df4-142">Из **Добавление нового элемента** выберите **базы данных SQL Server**, введите имя MoviesDB.mdf базы данных и нажмите кнопку **добавить** кнопки.</span><span class="sxs-lookup"><span data-stu-id="11df4-142">From the **Add New Item** dialog box, select **SQL Server Database**, give the database the name MoviesDB.mdf, and click the **Add** button.</span></span>
3. <span data-ttu-id="11df4-143">Дважды щелкните файл MoviesDB.mdf, чтобы открыть окно Server Explorer/Database Explorer.</span><span class="sxs-lookup"><span data-stu-id="11df4-143">Double-click the MoviesDB.mdf file to open the Server Explorer/Database Explorer window.</span></span>
4. <span data-ttu-id="11df4-144">Развернуть MoviesDB.mdf подключения к базе данных, щелкните правой кнопкой мыши папку «таблицы» и выберите пункт меню **добавить новую таблицу**.</span><span class="sxs-lookup"><span data-stu-id="11df4-144">Expand the MoviesDB.mdf database connection, right-click the Tables folder, and select the menu option **Add New Table**.</span></span>
5. <span data-ttu-id="11df4-145">В конструкторе таблиц добавьте столбцы Id, Title и директор.</span><span class="sxs-lookup"><span data-stu-id="11df4-145">In the Table Designer, add the Id, Title, and Director columns.</span></span>
6. <span data-ttu-id="11df4-146">Нажмите кнопку **Сохранить** кнопки (он имеет значок дискеты) для сохранения в новую таблицу с именем фильмов.</span><span class="sxs-lookup"><span data-stu-id="11df4-146">Click the **Save** button (it has the icon of the floppy) to save the new table with the name Movies.</span></span>

<span data-ttu-id="11df4-147">После создания таблицы базы данных фильмов, следует добавить демонстрационные данные в таблицу.</span><span class="sxs-lookup"><span data-stu-id="11df4-147">After you create the Movies database table, you should add some sample data to the table.</span></span> <span data-ttu-id="11df4-148">Щелкните правой кнопкой мыши в таблице фильмов и выберите пункт меню **Показать таблицу данных**.</span><span class="sxs-lookup"><span data-stu-id="11df4-148">Right-click the Movies table and select the menu option **Show Table Data**.</span></span> <span data-ttu-id="11df4-149">В появившейся сетке можно ввести фальшивые о фильме.</span><span class="sxs-lookup"><span data-stu-id="11df4-149">You can enter fake movie data into the grid that appears.</span></span>

## <a name="creating-the-adonet-entity-data-model"></a><span data-ttu-id="11df4-150">Создание модели EDM ADO.NET</span><span class="sxs-lookup"><span data-stu-id="11df4-150">Creating the ADO.NET Entity Data Model</span></span>

<span data-ttu-id="11df4-151">Чтобы использовать Entity Framework, необходимо создать модель EDM.</span><span class="sxs-lookup"><span data-stu-id="11df4-151">In order to use the Entity Framework, you need to create an Entity Data Model.</span></span> <span data-ttu-id="11df4-152">Вы можете воспользоваться преимуществами Visual Studio *мастер моделей EDM* для автоматического создания модели EDM из базы данных.</span><span class="sxs-lookup"><span data-stu-id="11df4-152">You can take advantage of the Visual Studio *Entity Data Model Wizard* to generate an Entity Data Model from a database automatically.</span></span>

<span data-ttu-id="11df4-153">Выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="11df4-153">Follow these steps:</span></span>

1. <span data-ttu-id="11df4-154">Щелкните правой кнопкой мыши папку Models в окне обозревателя решений и выберите пункт меню **добавить, новый элемент**.</span><span class="sxs-lookup"><span data-stu-id="11df4-154">Right-click the Models folder in the Solution Explorer window and select the menu option **Add, New Item**.</span></span>
2. <span data-ttu-id="11df4-155">В **Добавление нового элемента** диалоговое окно, выберите категорию Data (см. рис. 1).</span><span class="sxs-lookup"><span data-stu-id="11df4-155">In the **Add New Item** dialog, select the Data category (see Figure 1).</span></span>
3. <span data-ttu-id="11df4-156">Выберите **ADO.NET Entity Data Model** шаблон, присвойте имя MoviesDBModel.edmx модели EDM и нажмите кнопку **добавить** кнопки.</span><span class="sxs-lookup"><span data-stu-id="11df4-156">Select the **ADO.NET Entity Data Model** template, give the Entity Data Model the name MoviesDBModel.edmx, and click the **Add** button.</span></span> <span data-ttu-id="11df4-157">Щелкнув **добавить** кнопка запускает мастер модели данных.</span><span class="sxs-lookup"><span data-stu-id="11df4-157">Clicking the **Add** button launches the Data Model Wizard.</span></span>
4. <span data-ttu-id="11df4-158">В **Выбор содержимого модели** , выберите нужное значение **создать из базы данных** и нажмите кнопку **Далее** кнопку (см. рис. 2).</span><span class="sxs-lookup"><span data-stu-id="11df4-158">In the **Choose Model Contents** step, choose the **Generate from a database** option and click the **Next** button (see Figure 2).</span></span>
5. <span data-ttu-id="11df4-159">В **Выбор подключения к данным** шаг, выберите подключение к базе данных MoviesDB.mdf, введите объекты параметров подключения имя MoviesDBEntities и нажмите кнопку **Далее** кнопку (см. рис. 3).</span><span class="sxs-lookup"><span data-stu-id="11df4-159">In the **Choose Your Data Connection** step, select the MoviesDB.mdf database connection, enter the entities connection settings name MoviesDBEntities, and click the **Next** button (see Figure 3).</span></span>
6. <span data-ttu-id="11df4-160">В **Choose Your Database Objects** шаг, выберите в таблице базы данных фильмов и нажмите кнопку **Готово** кнопку (см. рис. 4).</span><span class="sxs-lookup"><span data-stu-id="11df4-160">In the **Choose Your Database Objects** step, select the Movie database table and click the **Finish** button (see Figure 4).</span></span>

<span data-ttu-id="11df4-161">После выполнения этих действий, откроется конструктор модели сущностей ADO.NET (конструктор сущностей).</span><span class="sxs-lookup"><span data-stu-id="11df4-161">After you complete these steps, the ADO.NET Entity Data Model Designer (Entity Designer) opens.</span></span>

<span data-ttu-id="11df4-162">**Рис. 1 – Создание новой модели данных сущности**</span><span class="sxs-lookup"><span data-stu-id="11df4-162">**Figure 1 – Creating a new Entity Data Model**</span></span>

![clip_image002](creating-model-classes-with-the-entity-framework-cs/_static/image1.jpg)

<span data-ttu-id="11df4-164">**Рис. 2 – выберите шаг содержимое модели**</span><span class="sxs-lookup"><span data-stu-id="11df4-164">**Figure 2 – Choose Model Contents Step**</span></span>

![clip_image004](creating-model-classes-with-the-entity-framework-cs/_static/image2.jpg)

<span data-ttu-id="11df4-166">**Рис. 3 – Выбор подключения базы данных**</span><span class="sxs-lookup"><span data-stu-id="11df4-166">**Figure 3 – Choose Your Data Connection**</span></span>

![clip_image006](creating-model-classes-with-the-entity-framework-cs/_static/image3.jpg)

<span data-ttu-id="11df4-168">**Рис. 4 – Выбор объектов базы данных**</span><span class="sxs-lookup"><span data-stu-id="11df4-168">**Figure 4 – Choose Your Database Objects**</span></span>

![clip_image008](creating-model-classes-with-the-entity-framework-cs/_static/image4.jpg)

#### <a name="modifying-the-adonet-entity-data-model"></a><span data-ttu-id="11df4-170">Изменение модели EDM ADO.NET</span><span class="sxs-lookup"><span data-stu-id="11df4-170">Modifying the ADO.NET Entity Data Model</span></span>

<span data-ttu-id="11df4-171">После создания модели EDM, можете редактировать модель, используя Entity Designer (см. рис. 5).</span><span class="sxs-lookup"><span data-stu-id="11df4-171">After you create an Entity Data Model, you can modify the model by taking advantage of the Entity Designer (see Figure 5).</span></span> <span data-ttu-id="11df4-172">Конструктор сущностей можно открыть в любое время, дважды щелкнув файл MoviesDBModel.edmx, содержащиеся в папке Models находится в окне обозревателя решений.</span><span class="sxs-lookup"><span data-stu-id="11df4-172">You can open the Entity Designer at any time by double-clicking the MoviesDBModel.edmx file contained in the Models folder within the Solution Explorer window.</span></span>

<span data-ttu-id="11df4-173">**Рис. 5 – конструктор моделей EDM ADO.NET**</span><span class="sxs-lookup"><span data-stu-id="11df4-173">**Figure 5 – The ADO.NET Entity Data Model Designer**</span></span>

![clip_image010](creating-model-classes-with-the-entity-framework-cs/_static/image5.jpg)

<span data-ttu-id="11df4-175">Например можно использовать конструктор сущностей для изменения имен классов, которые создает мастер модели EDM.</span><span class="sxs-lookup"><span data-stu-id="11df4-175">For example, you can use the Entity Designer to change the names of the classes that the Entity Model Data Wizard generates.</span></span> <span data-ttu-id="11df4-176">Мастер создал класс доступа к данным с именем фильмов.</span><span class="sxs-lookup"><span data-stu-id="11df4-176">The Wizard created a new data access class named Movies.</span></span> <span data-ttu-id="11df4-177">Другими словами мастер присвоили классу очень совпадает с именем таблицы базы данных.</span><span class="sxs-lookup"><span data-stu-id="11df4-177">In other words, the Wizard gave the class the very same name as the database table.</span></span> <span data-ttu-id="11df4-178">Так как этот класс будет использоваться для представления конкретного экземпляра фильма, нам следует присвоить класс из папки Movies фильм.</span><span class="sxs-lookup"><span data-stu-id="11df4-178">Because we will use this class to represent a particular Movie instance, we should rename the class from Movies to Movie.</span></span>

<span data-ttu-id="11df4-179">Если вы хотите переименовать класс сущностей, можно дважды щелкнуть имя класса в конструкторе сущностей и введите новое имя (см. рис. 6).</span><span class="sxs-lookup"><span data-stu-id="11df4-179">If you want to rename an entity class, you can double-click on the class name in the Entity Designer and enter a new name (see Figure 6).</span></span> <span data-ttu-id="11df4-180">Кроме того можно изменить имя сущности в окне «Свойства» после выбора сущности в конструкторе сущностей.</span><span class="sxs-lookup"><span data-stu-id="11df4-180">Alternatively, you can change the name of an entity in the Properties window after selecting an entity in the Entity Designer.</span></span>

<span data-ttu-id="11df4-181">**Рис. 6 – изменение имени сущности**</span><span class="sxs-lookup"><span data-stu-id="11df4-181">**Figure 6 – Changing an entity name**</span></span>

![clip_image012](creating-model-classes-with-the-entity-framework-cs/_static/image6.jpg)

<span data-ttu-id="11df4-183">Не забудьте сохранить вашей модели EDM после внесения изменений, нажав кнопку "Сохранить" (значок дискеты).</span><span class="sxs-lookup"><span data-stu-id="11df4-183">Remember to save your Entity Data Model after making a modification by clicking the Save button (the icon of the floppy disk).</span></span> <span data-ttu-id="11df4-184">На самом деле конструктор сущностей создает набор классов C#.</span><span class="sxs-lookup"><span data-stu-id="11df4-184">Behind the scenes, the Entity Designer generates a set of C# classes.</span></span> <span data-ttu-id="11df4-185">Эти классы можно просмотреть, открыв этот файл MoviesDBModel.Designer.cs в окне обозревателя решений.</span><span class="sxs-lookup"><span data-stu-id="11df4-185">You can view these classes by opening the MoviesDBModel.Designer.cs file from the Solution Explorer window.</span></span>


<span data-ttu-id="11df4-186">Не следует изменять код в файле Designer.cs с момента изменения перезаписываются при следующем использовании конструктора сущностей.</span><span class="sxs-lookup"><span data-stu-id="11df4-186">Don't modify the code in the Designer.cs file since your changes will be overwritten the next time you use the Entity Designer.</span></span> <span data-ttu-id="11df4-187">Если вы хотите расширить функциональные возможности классов сущностей, определенных в файле Designer.cs, то можно создать *разделяемые классы* в отдельные файлы.</span><span class="sxs-lookup"><span data-stu-id="11df4-187">If you want to extend the functionality of the entity classes defined in the Designer.cs file then you can create *partial classes* in separate files.</span></span>


#### <a name="selecting-database-records-with-the-entity-framework"></a><span data-ttu-id="11df4-188">Выбор записей базы данных с Entity Framework</span><span class="sxs-lookup"><span data-stu-id="11df4-188">Selecting Database Records with the Entity Framework</span></span>

<span data-ttu-id="11df4-189">Давайте начнем, созданию приложения базы данных фильмов, создав страницу, отображающую список записей фильмов.</span><span class="sxs-lookup"><span data-stu-id="11df4-189">Let's start building our Movie Database application by creating a page that displays a list of movie records.</span></span> <span data-ttu-id="11df4-190">Контроллер Home в листинге 1 предоставляет действие с именем Index().</span><span class="sxs-lookup"><span data-stu-id="11df4-190">The Home controller in Listing 1 exposes an action named Index().</span></span> <span data-ttu-id="11df4-191">Это действие Index() возвращает все записи фильма из таблицы базы данных Movie за счет использования платформы Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="11df4-191">The Index() action returns all of the movie records from the Movie database table by taking advantage of the Entity Framework.</span></span>

<span data-ttu-id="11df4-192">**В листинге 1 — Controllers\HomeController.cs**</span><span class="sxs-lookup"><span data-stu-id="11df4-192">**Listing 1 – Controllers\HomeController.cs**</span></span>

[!code-csharp[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample1.cs)]

<span data-ttu-id="11df4-193">Обратите внимание на то, что контроллер в листинге 1 включает конструктор.</span><span class="sxs-lookup"><span data-stu-id="11df4-193">Notice that the controller in Listing 1 includes a constructor.</span></span> <span data-ttu-id="11df4-194">Конструктор инициализирует поле уровня класса с именем \_db.</span><span class="sxs-lookup"><span data-stu-id="11df4-194">The constructor initializes a class-level field named \_db.</span></span> <span data-ttu-id="11df4-195">\_Db поле представляет сущности базы данных, созданные платформой Entity Framework корпорации Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="11df4-195">The \_db field represents the database entities generated by the Microsoft Entity Framework.</span></span> <span data-ttu-id="11df4-196">\_Db поля является экземпляром класса MoviesDBEntities, который был создан конструктором сущностей.</span><span class="sxs-lookup"><span data-stu-id="11df4-196">The \_db field is an instance of the MoviesDBEntities class that was generated by the Entity Designer.</span></span>


<span data-ttu-id="11df4-197">Чтобы использовать класс theMoviesDBEntities в контроллер Home, необходимо импортировать пространство имен MovieEntityApp.Models (*MVCProjectName*. Модели).</span><span class="sxs-lookup"><span data-stu-id="11df4-197">In order to use theMoviesDBEntities class in the Home controller, you must import the MovieEntityApp.Models namespace (*MVCProjectName*.Models).</span></span>


<span data-ttu-id="11df4-198">\_Поле db используется в действии Index() для извлечения записей из таблицы базы данных фильмов.</span><span class="sxs-lookup"><span data-stu-id="11df4-198">The \_db field is used within the Index() action to retrieve the records from the Movies database table.</span></span> <span data-ttu-id="11df4-199">Выражение \_db. MovieSet представляет все записи из таблицы базы данных фильмов.</span><span class="sxs-lookup"><span data-stu-id="11df4-199">The expression \_db.MovieSet represents all of the records from the Movies database table.</span></span> <span data-ttu-id="11df4-200">Метод ToList() используется для преобразования в универсальной коллекции объектов Movie набор фильмов (список&lt;фильма&gt;).</span><span class="sxs-lookup"><span data-stu-id="11df4-200">The ToList() method is used to convert the set of movies into a generic collection of Movie objects (List&lt;Movie&gt;).</span></span>

<span data-ttu-id="11df4-201">Записи фильма можно получить с помощью LINQ to Entities.</span><span class="sxs-lookup"><span data-stu-id="11df4-201">The movie records are retrieved with the help of LINQ to Entities.</span></span> <span data-ttu-id="11df4-202">Действие Index() в листинге 1 использует LINQ *синтаксис метода* для получения набора записей базы данных.</span><span class="sxs-lookup"><span data-stu-id="11df4-202">The Index() action in Listing 1 uses LINQ *method syntax* to retrieve the set of database records.</span></span> <span data-ttu-id="11df4-203">При желании можно использовать LINQ *синтаксис запроса* вместо этого.</span><span class="sxs-lookup"><span data-stu-id="11df4-203">If you prefer, you can use LINQ *query syntax* instead.</span></span> <span data-ttu-id="11df4-204">Следующие две инструкции выполняют те же функции:</span><span class="sxs-lookup"><span data-stu-id="11df4-204">The following two statements do the very same thing:</span></span>

[!code-csharp[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample2.cs)]

<span data-ttu-id="11df4-205">Используйте любой синтаксис LINQ — синтаксис метода или синтаксис запросов — найденной интуитивно.</span><span class="sxs-lookup"><span data-stu-id="11df4-205">Use whichever LINQ syntax – method syntax or query syntax – that you find most intuitive.</span></span> <span data-ttu-id="11df4-206">Нет никакой разницы в производительности между двумя подходами – единственное отличие заключается в стиль.</span><span class="sxs-lookup"><span data-stu-id="11df4-206">There is no difference in performance between the two approaches – the only difference is style.</span></span>

<span data-ttu-id="11df4-207">В представлении в листинге 2 используется для отображения записей фильмов.</span><span class="sxs-lookup"><span data-stu-id="11df4-207">The view in Listing 2 is used to display the movie records.</span></span>

<span data-ttu-id="11df4-208">**В листинге 2 — Views\Home\Index.aspx**</span><span class="sxs-lookup"><span data-stu-id="11df4-208">**Listing 2 – Views\Home\Index.aspx**</span></span>

[!code-aspx[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample3.aspx)]

<span data-ttu-id="11df4-209">Представление в листинге 2 содержит **foreach** цикл, который используется для итерации по каждой записи фильма и отображает значения свойств Title и директор запись фильма.</span><span class="sxs-lookup"><span data-stu-id="11df4-209">The view in Listing 2 contains a **foreach** loop that iterates through each movie record and displays the values of the movie record's Title and Director properties.</span></span> <span data-ttu-id="11df4-210">Обратите внимание на то, что ссылки на изменение и удаление отображается рядом с каждой записи.</span><span class="sxs-lookup"><span data-stu-id="11df4-210">Notice that an Edit and Delete link is displayed next to each record.</span></span> <span data-ttu-id="11df4-211">Кроме того, ссылки на добавление фильма отображается в нижней части представления (см. рис. 7).</span><span class="sxs-lookup"><span data-stu-id="11df4-211">Furthermore, an Add Movie link appears at the bottom of the view (see Figure 7).</span></span>

<span data-ttu-id="11df4-212">**Рис. 7 – представление Index**</span><span class="sxs-lookup"><span data-stu-id="11df4-212">**Figure 7 – The Index view**</span></span>

![clip_image014](creating-model-classes-with-the-entity-framework-cs/_static/image7.jpg)

<span data-ttu-id="11df4-214">Представление Index является *типизированного представления*.</span><span class="sxs-lookup"><span data-stu-id="11df4-214">The Index view is a *typed view*.</span></span> <span data-ttu-id="11df4-215">Включает в себя представление Index &lt;% @ Page %&gt; директиву *Inherits* атрибут, к которому приводятся свойства модели для строго типизированной коллекции универсальный список объектов Movie (список&lt;фильма).</span><span class="sxs-lookup"><span data-stu-id="11df4-215">The Index view includes a &lt;%@ Page %&gt; directive with an *Inherits* attribute that casts the Model property to a strongly typed generic List collection of Movie objects (List&lt;Movie).</span></span>

## <a name="inserting-database-records-with-the-entity-framework"></a><span data-ttu-id="11df4-216">Вставка записей базы данных с Entity Framework</span><span class="sxs-lookup"><span data-stu-id="11df4-216">Inserting Database Records with the Entity Framework</span></span>

<span data-ttu-id="11df4-217">Платформа Entity Framework можно использовать для упрощения вставки новых записей в таблицу базы данных.</span><span class="sxs-lookup"><span data-stu-id="11df4-217">You can use the Entity Framework to make it easy to insert new records into a database table.</span></span> <span data-ttu-id="11df4-218">Листинг 3 содержит два новых действия, добавленные к классу контроллера Home, можно использовать для вставки новых записей в таблице базы данных Movie.</span><span class="sxs-lookup"><span data-stu-id="11df4-218">Listing 3 contains two new actions added to the Home controller class that you can use to insert new records into the Movie database table.</span></span>

<span data-ttu-id="11df4-219">**Листинг 3 – Controllers\HomeController.cs (Добавить методы)**</span><span class="sxs-lookup"><span data-stu-id="11df4-219">**Listing 3 – Controllers\HomeController.cs (Add methods)**</span></span>

[!code-csharp[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample4.cs)]

<span data-ttu-id="11df4-220">Первое действие Add() просто возвращает представление.</span><span class="sxs-lookup"><span data-stu-id="11df4-220">The first Add() action simply returns a view.</span></span> <span data-ttu-id="11df4-221">Представление содержит форму для добавления новой базы данных movie записи (см. рис. 8).</span><span class="sxs-lookup"><span data-stu-id="11df4-221">The view contains a form for adding a new movie database record (see Figure 8).</span></span> <span data-ttu-id="11df4-222">При отправке формы вызывается второе действие Add().</span><span class="sxs-lookup"><span data-stu-id="11df4-222">When you submit the form, the second Add() action is invoked.</span></span>

<span data-ttu-id="11df4-223">Обратите внимание на то, что второе действие Add() дополнен атрибутом AcceptVerbs.</span><span class="sxs-lookup"><span data-stu-id="11df4-223">Notice that the second Add() action is decorated with the AcceptVerbs attribute.</span></span> <span data-ttu-id="11df4-224">Это действие может вызываться только в том случае, при выполнении операции HTTP POST.</span><span class="sxs-lookup"><span data-stu-id="11df4-224">This action can be invoked only when performing an HTTP POST operation.</span></span> <span data-ttu-id="11df4-225">Другими словами это действие может вызываться только при отправке формы HTML.</span><span class="sxs-lookup"><span data-stu-id="11df4-225">In other words, this action can only be invoked when posting an HTML form.</span></span>

<span data-ttu-id="11df4-226">Второе действие Add() создает новый экземпляр класса Entity Framework фильмов с помощью метода ASP.NET MVC TryUpdateModel().</span><span class="sxs-lookup"><span data-stu-id="11df4-226">The second Add() action creates a new instance of the Entity Framework Movie class with the help of the ASP.NET MVC TryUpdateModel() method.</span></span> <span data-ttu-id="11df4-227">Метод TryUpdateModel() принимает поля в FormCollection, передаваемый в метод Add() и присваивает значения этих полей формы HTML класс Movie.</span><span class="sxs-lookup"><span data-stu-id="11df4-227">The TryUpdateModel() method takes the fields in the FormCollection passed to the Add() method and assigns the values of these HTML form fields to the Movie class.</span></span>


<span data-ttu-id="11df4-228">При использовании Entity Framework, необходимо указать «утвержденный список» свойств при использовании методов TryUpdateModel или UpdateModel для обновления свойств класса сущностей.</span><span class="sxs-lookup"><span data-stu-id="11df4-228">When using the Entity Framework, you must supply a "white list" of properties when using the TryUpdateModel or UpdateModel methods to update the properties of an entity class.</span></span>


<span data-ttu-id="11df4-229">Затем Add() действие выполняет некоторые проверки простой формы.</span><span class="sxs-lookup"><span data-stu-id="11df4-229">Next, the Add() action performs some simple form validation.</span></span> <span data-ttu-id="11df4-230">Действие проверяет, что заголовок и директор свойства имеют значения.</span><span class="sxs-lookup"><span data-stu-id="11df4-230">The action verifies that both the Title and Director properties have values.</span></span> <span data-ttu-id="11df4-231">Если имеется ошибка проверки, сообщение об ошибке проверки добавляется к ModelState.</span><span class="sxs-lookup"><span data-stu-id="11df4-231">If there is a validation error, then a validation error message is added to ModelState.</span></span>

<span data-ttu-id="11df4-232">Если нет ошибок проверки новой записи фильма добавляется в таблицу базы данных фильмов с помощью платформы Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="11df4-232">If there are no validation errors then a new movie record is added to the Movies database table with the help of the Entity Framework.</span></span> <span data-ttu-id="11df4-233">Новая запись добавляется в базу данных с помощью следующих двух строк кода:</span><span class="sxs-lookup"><span data-stu-id="11df4-233">The new record is added to the database with the following two lines of code:</span></span>

[!code-csharp[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample5.cs)]

<span data-ttu-id="11df4-234">Первая часть кода добавляет новую сущность Movie набор фильмы, отслеживается Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="11df4-234">The first line of code adds the new Movie entity to the set of movies being tracked by the Entity Framework.</span></span> <span data-ttu-id="11df4-235">Вторая часть кода сохраняет все изменения были внесены в кино, отслеживается в базовой базе данных.</span><span class="sxs-lookup"><span data-stu-id="11df4-235">The second line of code saves whatever changes have been made to the Movies being tracked back to the underlying database.</span></span>

<span data-ttu-id="11df4-236">**Рис. 8 – Добавление представления**</span><span class="sxs-lookup"><span data-stu-id="11df4-236">**Figure 8 – The Add view**</span></span>

![clip_image016](creating-model-classes-with-the-entity-framework-cs/_static/image8.jpg)

#### <a name="updating-database-records-with-the-entity-framework"></a><span data-ttu-id="11df4-238">Обновление записей базы данных с Entity Framework</span><span class="sxs-lookup"><span data-stu-id="11df4-238">Updating Database Records with the Entity Framework</span></span>

<span data-ttu-id="11df4-239">Вы можете следовать практически тот же подход, чтобы изменить запись в базе данных с Entity Framework как подход, который мы только что выполнили для вставки новой записи базы данных.</span><span class="sxs-lookup"><span data-stu-id="11df4-239">You can follow almost the same approach to edit a database record with the Entity Framework as the approach that we just followed to insert a new database record.</span></span> <span data-ttu-id="11df4-240">Листинг 4 содержит два новых действия контроллера с именем Edit().</span><span class="sxs-lookup"><span data-stu-id="11df4-240">Listing 4 contains two new controller actions named Edit().</span></span> <span data-ttu-id="11df4-241">Первое действие Edit() возвращает HTML-формы для редактирования и фильмов.</span><span class="sxs-lookup"><span data-stu-id="11df4-241">The first Edit() action returns an HTML form for editing a movie record.</span></span> <span data-ttu-id="11df4-242">Второе действие Edit() пытается обновить базу данных.</span><span class="sxs-lookup"><span data-stu-id="11df4-242">The second Edit() action attempts to update the database.</span></span>

<span data-ttu-id="11df4-243">**Листинг 4 — Controllers\HomeController.cs (методов Edit)**</span><span class="sxs-lookup"><span data-stu-id="11df4-243">**Listing 4 – Controllers\HomeController.cs (Edit methods)**</span></span>

[!code-csharp[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample6.cs)]

<span data-ttu-id="11df4-244">Второе действие Edit() начинается с получения запись фильма из базы данных, соответствующий идентификатору редактируемого фильма.</span><span class="sxs-lookup"><span data-stu-id="11df4-244">The second Edit() action starts by retrieving the Movie record from the database that matches the Id of the movie being edited.</span></span> <span data-ttu-id="11df4-245">Следующие LINQ to Entities инструкции извлекает первой записи базы данных, которая совпадает с определенным кодом:</span><span class="sxs-lookup"><span data-stu-id="11df4-245">The following LINQ to Entities statement grabs the first database record that matches a particular Id:</span></span>

[!code-csharp[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample7.cs)]

<span data-ttu-id="11df4-246">Затем метод TryUpdateModel() используется для присвоения значений полей формы HTML свойства сущности фильма.</span><span class="sxs-lookup"><span data-stu-id="11df4-246">Next, the TryUpdateModel() method is used to assign the values of the HTML form fields to the properties of the movie entity.</span></span> <span data-ttu-id="11df4-247">Обратите внимание на то, что список разрешений предоставляется для указания точного обновляемые свойства.</span><span class="sxs-lookup"><span data-stu-id="11df4-247">Notice that a white list is supplied to specify the exact properties to update.</span></span>

<span data-ttu-id="11df4-248">Далее чтобы убедиться, что название фильма и директор свойства имеют значения выполняется простой механизм проверки.</span><span class="sxs-lookup"><span data-stu-id="11df4-248">Next, some simple validation is performed to verify that both the Movie Title and Director properties have values.</span></span> <span data-ttu-id="11df4-249">Если отсутствуют значение любого из этих свойств, затем ModelState добавляется сообщение об ошибке проверки и ModelState.IsValid возвращает значение false.</span><span class="sxs-lookup"><span data-stu-id="11df4-249">If either property is missing a value, then a validation error message is added to ModelState and ModelState.IsValid returns the value false.</span></span>

<span data-ttu-id="11df4-250">Наконец при возникновении ошибки проверки не, базовой таблицы базы данных фильмов затем обновляется с любыми изменениями, путем вызова метода SaveChanges().</span><span class="sxs-lookup"><span data-stu-id="11df4-250">Finally, if there are no validation errors, then the underlying Movies database table is updated with any changes by calling the SaveChanges() method.</span></span>

<span data-ttu-id="11df4-251">При редактировании записей базы данных, необходимо передать идентификатор изменяемую запись к действию контроллера, который выполняет обновление базы данных.</span><span class="sxs-lookup"><span data-stu-id="11df4-251">When editing database records, you need to pass the Id of the record being edited to the controller action that performs the database update.</span></span> <span data-ttu-id="11df4-252">В противном случае действие контроллера будет неизвестно, какая запись должна быть обновление базовой базы данных.</span><span class="sxs-lookup"><span data-stu-id="11df4-252">Otherwise, the controller action will not know which record to update in the underlying database.</span></span> <span data-ttu-id="11df4-253">Представления изменения, содержащиеся в листинге 5 включает в себя скрытого поля формы, представляющий идентификатор редактируемой записи в базе данных.</span><span class="sxs-lookup"><span data-stu-id="11df4-253">The Edit view, contained in Listing 5, includes a hidden form field that represents the Id of the database record being edited.</span></span>

<span data-ttu-id="11df4-254">**В листинге 5 – Views\Home\Edit.aspx**</span><span class="sxs-lookup"><span data-stu-id="11df4-254">**Listing 5 – Views\Home\Edit.aspx**</span></span>

[!code-aspx[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample8.aspx)]

## <a name="deleting-database-records-with-the-entity-framework"></a><span data-ttu-id="11df4-255">Удаление записей базы данных с Entity Framework</span><span class="sxs-lookup"><span data-stu-id="11df4-255">Deleting Database Records with the Entity Framework</span></span>

<span data-ttu-id="11df4-256">Операции окончательной базы данных, что нам нужно разбираться в этом руководстве, является удаление записей базы данных.</span><span class="sxs-lookup"><span data-stu-id="11df4-256">The final database operation, which we need to tackle in this tutorial, is deleting database records.</span></span> <span data-ttu-id="11df4-257">Действие контроллера в листинге 6 можно использовать для удаления записи определенной базы данных.</span><span class="sxs-lookup"><span data-stu-id="11df4-257">You can use the controller action in Listing 6 to delete a particular database record.</span></span>

<span data-ttu-id="11df4-258">**В листинге 6--\Controllers\HomeController.cs (действие удаления)**</span><span class="sxs-lookup"><span data-stu-id="11df4-258">**Listing 6 -- \Controllers\HomeController.cs (Delete action)**</span></span>

[!code-csharp[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample9.cs)]

<span data-ttu-id="11df4-259">Действие Delete() сначала извлекает сущность, которая соответствует идентификатору передается в действие фильма.</span><span class="sxs-lookup"><span data-stu-id="11df4-259">The Delete() action first retrieves the Movie entity that matches the Id passed to the action.</span></span> <span data-ttu-id="11df4-260">После этого фильма удаляется из базы данных, вызвав метод DeleteObject (), а затем с помощью метода SaveChanges().</span><span class="sxs-lookup"><span data-stu-id="11df4-260">Next, the movie is deleted from the database by calling the DeleteObject() method followed by the SaveChanges() method.</span></span> <span data-ttu-id="11df4-261">Наконец пользователь перенаправляется обратно в представление Index.</span><span class="sxs-lookup"><span data-stu-id="11df4-261">Finally, the user is redirected back to the Index view.</span></span>

## <a name="summary"></a><span data-ttu-id="11df4-262">Сводка</span><span class="sxs-lookup"><span data-stu-id="11df4-262">Summary</span></span>

<span data-ttu-id="11df4-263">Цель этого руководства мы хотели продемонстрировать, как можно создавать на основе базы данных веб-приложений, используя преимущества ASP.NET MVC и Entity Framework корпорации Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="11df4-263">The purpose of this tutorial was to demonstrate how you can build database-driven web applications by taking advantage of ASP.NET MVC and the Microsoft Entity Framework.</span></span> <span data-ttu-id="11df4-264">Вы узнали, как создать приложение, которое позволяет выбрать, вставку, обновление и удаление записей базы данных.</span><span class="sxs-lookup"><span data-stu-id="11df4-264">You learned how to build an application that enables you to select, insert, update, and delete database records.</span></span>

<span data-ttu-id="11df4-265">Во-первых мы рассмотрели, как можно использовать мастер моделей EDM для создания модели EDM из среды Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="11df4-265">First, we discussed how you can use the Entity Data Model Wizard to generate an Entity Data Model from within Visual Studio.</span></span> <span data-ttu-id="11df4-266">Далее вы узнаете, как использовать LINQ to Entities для получения набора записей базы данных из таблицы базы данных.</span><span class="sxs-lookup"><span data-stu-id="11df4-266">Next, you learn how to use LINQ to Entities to retrieve a set of database records from a database table.</span></span> <span data-ttu-id="11df4-267">Наконец мы использовали Entity Framework для вставки, обновления и удаления записей в базе данных.</span><span class="sxs-lookup"><span data-stu-id="11df4-267">Finally, we used the Entity Framework to insert, update, and delete database records.</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="11df4-268">Вперед</span><span class="sxs-lookup"><span data-stu-id="11df4-268">Next</span></span>](creating-model-classes-with-linq-to-sql-cs.md)
