---
uid: mvc/overview/older-versions-1/models-data/creating-model-classes-with-the-entity-framework-cs
title: Создание типовых классов с помощью рамочной системы entity (C) Документы Майкрософт
author: rick-anderson
description: В этом уроке вы узнаете, как использовать ASP.NET MVC с помощью рамочной программы Корпорации Майкрософт. Вы узнаете, как использовать Entity Мастера для создания ADO.NET Entity Da ...
ms.author: riande
ms.date: 01/27/2009
ms.assetid: 61644169-e8b1-45dd-bf96-9c2301b69879
msc.legacyurl: /mvc/overview/older-versions-1/models-data/creating-model-classes-with-the-entity-framework-cs
msc.type: authoredcontent
ms.openlocfilehash: 716d34167258b1005b25b1cd11bfaa6d80763320
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2020
ms.locfileid: "81542668"
---
# <a name="creating-model-classes-with-the-entity-framework-c"></a><span data-ttu-id="c8804-104">Создание классов модели в Entity Framework (C#)</span><span class="sxs-lookup"><span data-stu-id="c8804-104">Creating Model Classes with the Entity Framework (C#)</span></span>

<span data-ttu-id="c8804-105">[корпорацией Майкрософт](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="c8804-105">by [Microsoft](https://github.com/microsoft)</span></span>

> <span data-ttu-id="c8804-106">В этом уроке вы узнаете, как использовать ASP.NET MVC с помощью рамочной программы Корпорации Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="c8804-106">In this tutorial, you learn how to use ASP.NET MVC with the Microsoft Entity Framework.</span></span> <span data-ttu-id="c8804-107">Вы узнаете, как использовать Мастера Сущности для создания модели данных ADO.NET entity.</span><span class="sxs-lookup"><span data-stu-id="c8804-107">You learn how to use the Entity Wizard to create an ADO.NET Entity Data Model.</span></span> <span data-ttu-id="c8804-108">В течение этого руководства мы создаем веб-приложение, которое иллюстрирует, как выбирать, вставлять, обновлять и удалять данные базы данных с помощью рамочной базы сущности.</span><span class="sxs-lookup"><span data-stu-id="c8804-108">Over the course of this tutorial, we build a web application that illustrates how to select, insert, update, and delete database data by using the Entity Framework.</span></span>

<span data-ttu-id="c8804-109">Цель этого руководства состоит в том, чтобы объяснить, как можно создавать классы доступа к данным с помощью рамочной программы Microsoft Entity при создании ASP.NET приложения MVC.</span><span class="sxs-lookup"><span data-stu-id="c8804-109">The goal of this tutorial is to explain how you can create data access classes using the Microsoft Entity Framework when building an ASP.NET MVC application.</span></span> <span data-ttu-id="c8804-110">Этот учебник не предполагает никаких предыдущих знаний о рамочной системе сущности Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="c8804-110">This tutorial assumes no previous knowledge of the Microsoft Entity Framework.</span></span> <span data-ttu-id="c8804-111">К концу этого урока вы поймете, как использовать рамочную систему сущности для выбора, вставки, обновления и удаления записей баз данных.</span><span class="sxs-lookup"><span data-stu-id="c8804-111">By the end of this tutorial, you'll understand how to use the Entity Framework to select, insert, update, and delete database records.</span></span>

<span data-ttu-id="c8804-112">Рамочная программа Сущности Майкрософт — это инструмент, позволяющий автоматически генерировать слой доступа к данным из базы данных.</span><span class="sxs-lookup"><span data-stu-id="c8804-112">The Microsoft Entity Framework is an Object Relational Mapping (O/RM) tool that enables you to generate a data access layer from a database automatically.</span></span> <span data-ttu-id="c8804-113">Рамки сущности позволяют избежать утомительной работы по созданию классов доступа к данным вручную.</span><span class="sxs-lookup"><span data-stu-id="c8804-113">The Entity Framework enables you to avoid the tedious work of building your data access classes by hand.</span></span>

<span data-ttu-id="c8804-114">Чтобы проиллюстрировать, как можно использовать рамочную систему Корпорации Майкрософт с помощью ASP.NET MVC, мы создам простое примерприложения.</span><span class="sxs-lookup"><span data-stu-id="c8804-114">In order to illustrate how you can use the Microsoft Entity Framework with ASP.NET MVC, we'll build a simple sample application.</span></span> <span data-ttu-id="c8804-115">Мы создадим приложение Movie Database, которое позволит отображать и отсеивать записи базы данных фильмов.</span><span class="sxs-lookup"><span data-stu-id="c8804-115">We'll create a Movie Database application that enables you to display and edit movie database records.</span></span>

<span data-ttu-id="c8804-116">Этот учебник предполагает, что у вас есть Visual Studio 2008 или Visual Web Developer 2008 с сервисным пакетом 1.</span><span class="sxs-lookup"><span data-stu-id="c8804-116">This tutorial assumes that you have Visual Studio 2008 or Visual Web Developer 2008 with Service Pack 1.</span></span> <span data-ttu-id="c8804-117">Для использования рамочной программы Entity вам нужен пакет услуг 1.</span><span class="sxs-lookup"><span data-stu-id="c8804-117">You need Service Pack 1 in order to use the Entity Framework.</span></span> <span data-ttu-id="c8804-118">Вы можете скачать Visual Studio 2008 Service Pack 1 или Visual Web Developer с пакетом услуг 1 со следующего адреса:</span><span class="sxs-lookup"><span data-stu-id="c8804-118">You can download Visual Studio 2008 Service Pack 1 or Visual Web Developer with Service Pack 1 from the following address:</span></span>

> [https://www.asp.net/downloads/](https://www.asp.net/downloads)

> [!NOTE] 
> 
> <span data-ttu-id="c8804-119">Между ASP.NET MVC и рамочной системой корпорации Майкрософт нет существенной связи.</span><span class="sxs-lookup"><span data-stu-id="c8804-119">There is no essential connection between ASP.NET MVC and the Microsoft Entity Framework.</span></span> <span data-ttu-id="c8804-120">Существует несколько альтернатив рамочной системе entity, которую можно использовать с помощью ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="c8804-120">There are several alternatives to the Entity Framework that you can use with ASP.NET MVC.</span></span> <span data-ttu-id="c8804-121">Например, можно создавать классы mVC Model с помощью других инструментов O/RM, таких как Microsoft LIN' для S'L, NHibernate или SubSonic.</span><span class="sxs-lookup"><span data-stu-id="c8804-121">For example, you can build your MVC Model classes using other O/RM tools such as Microsoft LINQ to SQL, NHibernate, or SubSonic.</span></span>

## <a name="creating-the-movie-sample-database"></a><span data-ttu-id="c8804-122">Создание базы данных образцов фильмов</span><span class="sxs-lookup"><span data-stu-id="c8804-122">Creating the Movie Sample Database</span></span>

<span data-ttu-id="c8804-123">Приложение Movie Database использует таблицу базы данных под названием Фильмы, которая содержит следующие столбцы:</span><span class="sxs-lookup"><span data-stu-id="c8804-123">The Movie Database application uses a database table named Movies that contains the following columns:</span></span>

| <span data-ttu-id="c8804-124">Имя столбца</span><span class="sxs-lookup"><span data-stu-id="c8804-124">Column Name</span></span> | <span data-ttu-id="c8804-125">Тип данных</span><span class="sxs-lookup"><span data-stu-id="c8804-125">Data Type</span></span> | <span data-ttu-id="c8804-126">Разрешить Nulls?</span><span class="sxs-lookup"><span data-stu-id="c8804-126">Allow Nulls?</span></span> | <span data-ttu-id="c8804-127">Является ли основной ключ?</span><span class="sxs-lookup"><span data-stu-id="c8804-127">Is Primary Key?</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="c8804-128">Идентификатор</span><span class="sxs-lookup"><span data-stu-id="c8804-128">Id</span></span> | <span data-ttu-id="c8804-129">INT</span><span class="sxs-lookup"><span data-stu-id="c8804-129">int</span></span> | <span data-ttu-id="c8804-130">False</span><span class="sxs-lookup"><span data-stu-id="c8804-130">False</span></span> | <span data-ttu-id="c8804-131">True</span><span class="sxs-lookup"><span data-stu-id="c8804-131">True</span></span> |
| <span data-ttu-id="c8804-132">Title</span><span class="sxs-lookup"><span data-stu-id="c8804-132">Title</span></span> | <span data-ttu-id="c8804-133">nvarchar (100)</span><span class="sxs-lookup"><span data-stu-id="c8804-133">nvarchar(100)</span></span> | <span data-ttu-id="c8804-134">False</span><span class="sxs-lookup"><span data-stu-id="c8804-134">False</span></span> | <span data-ttu-id="c8804-135">False</span><span class="sxs-lookup"><span data-stu-id="c8804-135">False</span></span> |
| <span data-ttu-id="c8804-136">Директор</span><span class="sxs-lookup"><span data-stu-id="c8804-136">Director</span></span> | <span data-ttu-id="c8804-137">nvarchar (100)</span><span class="sxs-lookup"><span data-stu-id="c8804-137">nvarchar(100)</span></span> | <span data-ttu-id="c8804-138">False</span><span class="sxs-lookup"><span data-stu-id="c8804-138">False</span></span> | <span data-ttu-id="c8804-139">False</span><span class="sxs-lookup"><span data-stu-id="c8804-139">False</span></span> |

<span data-ttu-id="c8804-140">Эту таблицу можно добавить в проект MVC ASP.NET, выполнив следующие действия:</span><span class="sxs-lookup"><span data-stu-id="c8804-140">You can add this table to an ASP.NET MVC project by following these steps:</span></span>

1. <span data-ttu-id="c8804-141">Нажмите правой\_папкой App Data в окне Solution Explorer и выберите опцию **«Добавить» —новый пункт.**</span><span class="sxs-lookup"><span data-stu-id="c8804-141">Right-click the App\_Data folder in the Solution Explorer window and select the menu option **Add, New Item.**</span></span>
2. <span data-ttu-id="c8804-142">Из диалогового окна **Добавить новый элемент** выберите **базу данных сервера S'L,** назовите базу данных именем MoviesDB.mdf и нажмите кнопку **«Добавить».**</span><span class="sxs-lookup"><span data-stu-id="c8804-142">From the **Add New Item** dialog box, select **SQL Server Database**, give the database the name MoviesDB.mdf, and click the **Add** button.</span></span>
3. <span data-ttu-id="c8804-143">Дважды щелкните файл MoviesDB.mdf, чтобы открыть окно Server Explorer/Database Explorer.</span><span class="sxs-lookup"><span data-stu-id="c8804-143">Double-click the MoviesDB.mdf file to open the Server Explorer/Database Explorer window.</span></span>
4. <span data-ttu-id="c8804-144">Расширьте подключение к базе данных MoviesDB.mdf, нажмите правой кнопкой мыши папку Таблицы и выберите вариант меню **Добавить новую таблицу.**</span><span class="sxs-lookup"><span data-stu-id="c8804-144">Expand the MoviesDB.mdf database connection, right-click the Tables folder, and select the menu option **Add New Table**.</span></span>
5. <span data-ttu-id="c8804-145">В таблицу Designer добавьте колонки Id, Title и Director.</span><span class="sxs-lookup"><span data-stu-id="c8804-145">In the Table Designer, add the Id, Title, and Director columns.</span></span>
6. <span data-ttu-id="c8804-146">Нажмите кнопку **Сохранить** (она имеет значок дискеты), чтобы сохранить новую таблицу с именем Фильмы.</span><span class="sxs-lookup"><span data-stu-id="c8804-146">Click the **Save** button (it has the icon of the floppy) to save the new table with the name Movies.</span></span>

<span data-ttu-id="c8804-147">После создания таблицы базы данных Movies следует добавить некоторые примеры данных в таблицу.</span><span class="sxs-lookup"><span data-stu-id="c8804-147">After you create the Movies database table, you should add some sample data to the table.</span></span> <span data-ttu-id="c8804-148">Нажмите правой кнопкой мыши таблицы Фильмы и выберите вариант меню **Показать таблицы данных**.</span><span class="sxs-lookup"><span data-stu-id="c8804-148">Right-click the Movies table and select the menu option **Show Table Data**.</span></span> <span data-ttu-id="c8804-149">Вы можете ввести поддельные данные фильма в сетку, которая появляется.</span><span class="sxs-lookup"><span data-stu-id="c8804-149">You can enter fake movie data into the grid that appears.</span></span>

## <a name="creating-the-adonet-entity-data-model"></a><span data-ttu-id="c8804-150">Создание модели данных ADO.NET сущности</span><span class="sxs-lookup"><span data-stu-id="c8804-150">Creating the ADO.NET Entity Data Model</span></span>

<span data-ttu-id="c8804-151">Для использования рамочной системы сущности необходимо создать модель данных сущности.</span><span class="sxs-lookup"><span data-stu-id="c8804-151">In order to use the Entity Framework, you need to create an Entity Data Model.</span></span> <span data-ttu-id="c8804-152">Вы можете воспользоваться visual Studio *Entity Data Model Мастера* для создания модели данных Entity из базы данных автоматически.</span><span class="sxs-lookup"><span data-stu-id="c8804-152">You can take advantage of the Visual Studio *Entity Data Model Wizard* to generate an Entity Data Model from a database automatically.</span></span>

<span data-ttu-id="c8804-153">Выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="c8804-153">Follow these steps:</span></span>

1. <span data-ttu-id="c8804-154">Нажмите правой кнопкой папку Модели в окне Solution Explorer и выберите вариант меню **Добавить, Новый пункт**.</span><span class="sxs-lookup"><span data-stu-id="c8804-154">Right-click the Models folder in the Solution Explorer window and select the menu option **Add, New Item**.</span></span>
2. <span data-ttu-id="c8804-155">В диалоге **Добавить новый элемент** выберите категорию данных (см. рисунок 1).</span><span class="sxs-lookup"><span data-stu-id="c8804-155">In the **Add New Item** dialog, select the Data category (see Figure 1).</span></span>
3. <span data-ttu-id="c8804-156">Выберите шаблон **модели данных ADO.NET Entity,** назовите модель данных сущности на имя MoviesDBModel.edmx и нажмите кнопку **«Добавить».**</span><span class="sxs-lookup"><span data-stu-id="c8804-156">Select the **ADO.NET Entity Data Model** template, give the Entity Data Model the name MoviesDBModel.edmx, and click the **Add** button.</span></span> <span data-ttu-id="c8804-157">Нажатие кнопки **Добавить** запускает мастера модели данных.</span><span class="sxs-lookup"><span data-stu-id="c8804-157">Clicking the **Add** button launches the Data Model Wizard.</span></span>
4. <span data-ttu-id="c8804-158">На этапе **«Выбрать содержимое модели»** выберите **«Создание» из** опции базы данных и нажмите кнопку **«Следующая»** (см. рисунок 2).</span><span class="sxs-lookup"><span data-stu-id="c8804-158">In the **Choose Model Contents** step, choose the **Generate from a database** option and click the **Next** button (see Figure 2).</span></span>
5. <span data-ttu-id="c8804-159">На этапе **«Выберите соединение данных»** выберите соединение базы данных MoviesDB.mdf, введите настройки подключения объектов с именем MoviesDBEntities и нажмите кнопку **«Следующая»** (см. рисунок 3).</span><span class="sxs-lookup"><span data-stu-id="c8804-159">In the **Choose Your Data Connection** step, select the MoviesDB.mdf database connection, enter the entities connection settings name MoviesDBEntities, and click the **Next** button (see Figure 3).</span></span>
6. <span data-ttu-id="c8804-160">На этапе **«Выберите объекты базы данных»** выберите таблицу базы данных Movie и нажмите кнопку **«Завершение»** (см. рисунок 4).</span><span class="sxs-lookup"><span data-stu-id="c8804-160">In the **Choose Your Database Objects** step, select the Movie database table and click the **Finish** button (see Figure 4).</span></span>

<span data-ttu-id="c8804-161">После выполнения этих шагов открывается ADO.NET модельный план-модель данных entity (Entity Data Designer).</span><span class="sxs-lookup"><span data-stu-id="c8804-161">After you complete these steps, the ADO.NET Entity Data Model Designer (Entity Designer) opens.</span></span>

<span data-ttu-id="c8804-162">**Рисунок 1 - Создание новой модели данных сущности**</span><span class="sxs-lookup"><span data-stu-id="c8804-162">**Figure 1 – Creating a new Entity Data Model**</span></span>

![clip_image002](creating-model-classes-with-the-entity-framework-cs/_static/image1.jpg)

<span data-ttu-id="c8804-164">**Рисунок 2 - Выберите модель Содержание Шаг**</span><span class="sxs-lookup"><span data-stu-id="c8804-164">**Figure 2 – Choose Model Contents Step**</span></span>

![clip_image004](creating-model-classes-with-the-entity-framework-cs/_static/image2.jpg)

<span data-ttu-id="c8804-166">**Рисунок 3 - Выберите подключение к данным**</span><span class="sxs-lookup"><span data-stu-id="c8804-166">**Figure 3 – Choose Your Data Connection**</span></span>

![clip_image006](creating-model-classes-with-the-entity-framework-cs/_static/image3.jpg)

<span data-ttu-id="c8804-168">**Рисунок 4 - Выберите объекты базы данных**</span><span class="sxs-lookup"><span data-stu-id="c8804-168">**Figure 4 – Choose Your Database Objects**</span></span>

![clip_image008](creating-model-classes-with-the-entity-framework-cs/_static/image4.jpg)

#### <a name="modifying-the-adonet-entity-data-model"></a><span data-ttu-id="c8804-170">Изменение модели данных ADO.NET сущности</span><span class="sxs-lookup"><span data-stu-id="c8804-170">Modifying the ADO.NET Entity Data Model</span></span>

<span data-ttu-id="c8804-171">После создания модели данных entity можно изменить модель, воспользовавшись преимуществами конструктора сущности (см. рисунок 5).</span><span class="sxs-lookup"><span data-stu-id="c8804-171">After you create an Entity Data Model, you can modify the model by taking advantage of the Entity Designer (see Figure 5).</span></span> <span data-ttu-id="c8804-172">Вы можете открыть Entity Designer в любое время, дважды нажав на файл MoviesDBModel.edmx, содержащийся в папке Модели в окне Solution Explorer.</span><span class="sxs-lookup"><span data-stu-id="c8804-172">You can open the Entity Designer at any time by double-clicking the MoviesDBModel.edmx file contained in the Models folder within the Solution Explorer window.</span></span>

<span data-ttu-id="c8804-173">**Рисунок 5 - ADO.NET модель данных сущности Конструктор**</span><span class="sxs-lookup"><span data-stu-id="c8804-173">**Figure 5 – The ADO.NET Entity Data Model Designer**</span></span>

![clip_image010](creating-model-classes-with-the-entity-framework-cs/_static/image5.jpg)

<span data-ttu-id="c8804-175">Например, можно использовать «Дизайнер сущности» для изменения названий классов, генерируемых Мастером данных модели сущности.</span><span class="sxs-lookup"><span data-stu-id="c8804-175">For example, you can use the Entity Designer to change the names of the classes that the Entity Model Data Wizard generates.</span></span> <span data-ttu-id="c8804-176">Волшебник создал новый класс доступа к данным под названием Movies.</span><span class="sxs-lookup"><span data-stu-id="c8804-176">The Wizard created a new data access class named Movies.</span></span> <span data-ttu-id="c8804-177">Другими словами, Мастер дал классу то же имя, что и таблица баз данных.</span><span class="sxs-lookup"><span data-stu-id="c8804-177">In other words, the Wizard gave the class the very same name as the database table.</span></span> <span data-ttu-id="c8804-178">Поскольку мы будем использовать этот класс для представления конкретного экземпляра Movie, мы должны переименовать класс из фильмов в фильм.</span><span class="sxs-lookup"><span data-stu-id="c8804-178">Because we will use this class to represent a particular Movie instance, we should rename the class from Movies to Movie.</span></span>

<span data-ttu-id="c8804-179">Если вы хотите переименовать класс сущности, можно дважды нажать на имя класса в проектировщике сущности и ввести новое имя (см. рисунок 6).</span><span class="sxs-lookup"><span data-stu-id="c8804-179">If you want to rename an entity class, you can double-click on the class name in the Entity Designer and enter a new name (see Figure 6).</span></span> <span data-ttu-id="c8804-180">Кроме того, можно изменить имя объекта в окне Свойств после выбора сущности в проекте Entity Designer.</span><span class="sxs-lookup"><span data-stu-id="c8804-180">Alternatively, you can change the name of an entity in the Properties window after selecting an entity in the Entity Designer.</span></span>

<span data-ttu-id="c8804-181">**Рисунок 6 - Изменение имени объекта**</span><span class="sxs-lookup"><span data-stu-id="c8804-181">**Figure 6 – Changing an entity name**</span></span>

![clip_image012](creating-model-classes-with-the-entity-framework-cs/_static/image6.jpg)

<span data-ttu-id="c8804-183">Не забудьте сохранить модель данных Entity после внесения изменений, нажав кнопку Сохранить (значок дискеты).</span><span class="sxs-lookup"><span data-stu-id="c8804-183">Remember to save your Entity Data Model after making a modification by clicking the Save button (the icon of the floppy disk).</span></span> <span data-ttu-id="c8804-184">За кулисами, Entity Designer генерирует набор классов C-класса.</span><span class="sxs-lookup"><span data-stu-id="c8804-184">Behind the scenes, the Entity Designer generates a set of C# classes.</span></span> <span data-ttu-id="c8804-185">Вы можете просмотреть эти классы, открыв MoviesDBModel.Designer.cs файл из окна Solution Explorer.</span><span class="sxs-lookup"><span data-stu-id="c8804-185">You can view these classes by opening the MoviesDBModel.Designer.cs file from the Solution Explorer window.</span></span>

<span data-ttu-id="c8804-186">Не изменяйте код в файле Designer.cs, так как ваши изменения будут перезаписаны при следующем использовании Entity Designer.</span><span class="sxs-lookup"><span data-stu-id="c8804-186">Don't modify the code in the Designer.cs file since your changes will be overwritten the next time you use the Entity Designer.</span></span> <span data-ttu-id="c8804-187">Если вы хотите расширить функциональность классов сущности, определенных в Designer.cs файле, то можно создать *частичные классы* в отдельных файлах.</span><span class="sxs-lookup"><span data-stu-id="c8804-187">If you want to extend the functionality of the entity classes defined in the Designer.cs file then you can create *partial classes* in separate files.</span></span>

#### <a name="selecting-database-records-with-the-entity-framework"></a><span data-ttu-id="c8804-188">Выбор записей баз данных с помощью рамочной системы entity</span><span class="sxs-lookup"><span data-stu-id="c8804-188">Selecting Database Records with the Entity Framework</span></span>

<span data-ttu-id="c8804-189">Давайте начнем создавать наше приложение Базы данных фильмов, создав страницу, на которую отображается список записей фильмов.</span><span class="sxs-lookup"><span data-stu-id="c8804-189">Let's start building our Movie Database application by creating a page that displays a list of movie records.</span></span> <span data-ttu-id="c8804-190">Домашний контроллер в листинге 1 предоставляет действие под названием Индекс().</span><span class="sxs-lookup"><span data-stu-id="c8804-190">The Home controller in Listing 1 exposes an action named Index().</span></span> <span data-ttu-id="c8804-191">Действие «Индекс() возвращает все записи фильмов из таблицы базы данных Movie, воспользовавшись рамочным образованием.</span><span class="sxs-lookup"><span data-stu-id="c8804-191">The Index() action returns all of the movie records from the Movie database table by taking advantage of the Entity Framework.</span></span>

<span data-ttu-id="c8804-192">**Список 1 - Контролеры-HomeController.cs**</span><span class="sxs-lookup"><span data-stu-id="c8804-192">**Listing 1 – Controllers\HomeController.cs**</span></span>

[!code-csharp[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample1.cs)]

<span data-ttu-id="c8804-193">Обратите внимание, что контроллер в листинге 1 включает в себя конструктор.</span><span class="sxs-lookup"><span data-stu-id="c8804-193">Notice that the controller in Listing 1 includes a constructor.</span></span> <span data-ttu-id="c8804-194">Конструктор инициализирует поле уровня \_класса под названием db.</span><span class="sxs-lookup"><span data-stu-id="c8804-194">The constructor initializes a class-level field named \_db.</span></span> <span data-ttu-id="c8804-195">Поле \_db представляет сущности баз данных, генерируемые Рамочной системой сущности Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="c8804-195">The \_db field represents the database entities generated by the Microsoft Entity Framework.</span></span> <span data-ttu-id="c8804-196">Поле \_db — это экземпляр класса MoviesDBEntities, который был создан конструктором entity.</span><span class="sxs-lookup"><span data-stu-id="c8804-196">The \_db field is an instance of the MoviesDBEntities class that was generated by the Entity Designer.</span></span>

<span data-ttu-id="c8804-197">Для того, чтобы использовать класс MoviesDBEntities в контроллере Home, необходимо импортировать namespace MovieEntitiesApp.Models *(MVCProjectName*. Модели).</span><span class="sxs-lookup"><span data-stu-id="c8804-197">In order to use theMoviesDBEntities class in the Home controller, you must import the MovieEntityApp.Models namespace (*MVCProjectName*.Models).</span></span>

<span data-ttu-id="c8804-198">Поле \_db используется в действиях Index() для извлечения записей из таблицы базы данных Movies.</span><span class="sxs-lookup"><span data-stu-id="c8804-198">The \_db field is used within the Index() action to retrieve the records from the Movies database table.</span></span> <span data-ttu-id="c8804-199">Выражение \_db. MovieSet представляет все записи из таблицы базы данных Movies.</span><span class="sxs-lookup"><span data-stu-id="c8804-199">The expression \_db.MovieSet represents all of the records from the Movies database table.</span></span> <span data-ttu-id="c8804-200">Метод ToList() используется для преобразования набора фильмов в общую коллекцию объектов Movie (List&lt;Movie).&gt;</span><span class="sxs-lookup"><span data-stu-id="c8804-200">The ToList() method is used to convert the set of movies into a generic collection of Movie objects (List&lt;Movie&gt;).</span></span>

<span data-ttu-id="c8804-201">Записи фильмов извлекаются с помощью LIN'а в образования.</span><span class="sxs-lookup"><span data-stu-id="c8804-201">The movie records are retrieved with the help of LINQ to Entities.</span></span> <span data-ttu-id="c8804-202">Действие Индекса () в листинге 1 использует *синтаксис метода* LIN' для получения набора записей баз данных.</span><span class="sxs-lookup"><span data-stu-id="c8804-202">The Index() action in Listing 1 uses LINQ *method syntax* to retrieve the set of database records.</span></span> <span data-ttu-id="c8804-203">Если вы предпочитаете, вы можете использовать *синтаксис запроса* LIN's вместо этого.</span><span class="sxs-lookup"><span data-stu-id="c8804-203">If you prefer, you can use LINQ *query syntax* instead.</span></span> <span data-ttu-id="c8804-204">Следующие два заявления делают то же самое:</span><span class="sxs-lookup"><span data-stu-id="c8804-204">The following two statements do the very same thing:</span></span>

[!code-csharp[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample2.cs)]

<span data-ttu-id="c8804-205">Используйте какой бы синтаксис LIN' - синтаксис метода или синтаксис запроса - что вы найдете наиболее интуитивно понятным.</span><span class="sxs-lookup"><span data-stu-id="c8804-205">Use whichever LINQ syntax – method syntax or query syntax – that you find most intuitive.</span></span> <span data-ttu-id="c8804-206">Нет никакой разницы в производительности между двумя подходами – с той лишь разницей стиль.</span><span class="sxs-lookup"><span data-stu-id="c8804-206">There is no difference in performance between the two approaches – the only difference is style.</span></span>

<span data-ttu-id="c8804-207">Представление в листинге 2 используется для отображения записей фильмов.</span><span class="sxs-lookup"><span data-stu-id="c8804-207">The view in Listing 2 is used to display the movie records.</span></span>

<span data-ttu-id="c8804-208">**Список 2 - Просмотры »Домашний»Индекс.aspx**</span><span class="sxs-lookup"><span data-stu-id="c8804-208">**Listing 2 – Views\Home\Index.aspx**</span></span>

[!code-aspx[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample3.aspx)]

<span data-ttu-id="c8804-209">Представление в листинге 2 содержит цикл **foreach,** который итерируется через каждую запись фильма и отображает значения свойства названия и директора записи фильма.</span><span class="sxs-lookup"><span data-stu-id="c8804-209">The view in Listing 2 contains a **foreach** loop that iterates through each movie record and displays the values of the movie record's Title and Director properties.</span></span> <span data-ttu-id="c8804-210">Обратите внимание, что ссылка «Отображение и удаление» отображается рядом с каждой записью.</span><span class="sxs-lookup"><span data-stu-id="c8804-210">Notice that an Edit and Delete link is displayed next to each record.</span></span> <span data-ttu-id="c8804-211">Кроме того, в нижней части представления отображается ссылка Add Movie (см. рисунок 7).</span><span class="sxs-lookup"><span data-stu-id="c8804-211">Furthermore, an Add Movie link appears at the bottom of the view (see Figure 7).</span></span>

<span data-ttu-id="c8804-212">**Рисунок 7 - Представление индекса**</span><span class="sxs-lookup"><span data-stu-id="c8804-212">**Figure 7 – The Index view**</span></span>

![clip_image014](creating-model-classes-with-the-entity-framework-cs/_static/image7.jpg)

<span data-ttu-id="c8804-214">Представление индекса — это *набранное представление.*</span><span class="sxs-lookup"><span data-stu-id="c8804-214">The Index view is a *typed view*.</span></span> <span data-ttu-id="c8804-215">Представление индекса &lt;включает&gt; в себя директиву % с атрибутом *Наследуемой страницы,* которая отбрасывает&lt;свойство модели к сильно набранной общей коллекции списков объектов Movie (List Movie).</span><span class="sxs-lookup"><span data-stu-id="c8804-215">The Index view includes a &lt;%@ Page %&gt; directive with an *Inherits* attribute that casts the Model property to a strongly typed generic List collection of Movie objects (List&lt;Movie).</span></span>

## <a name="inserting-database-records-with-the-entity-framework"></a><span data-ttu-id="c8804-216">Вставка записей баз данных с рамочной системой entity</span><span class="sxs-lookup"><span data-stu-id="c8804-216">Inserting Database Records with the Entity Framework</span></span>

<span data-ttu-id="c8804-217">Можно использовать рамочную систему entity, чтобы упростить вставку новых записей в таблицу баз данных.</span><span class="sxs-lookup"><span data-stu-id="c8804-217">You can use the Entity Framework to make it easy to insert new records into a database table.</span></span> <span data-ttu-id="c8804-218">Список 3 содержит два новых действия, добавленные в класс контроллера Home, которые можно использовать для вставки новых записей в таблицу базы данных Movie.</span><span class="sxs-lookup"><span data-stu-id="c8804-218">Listing 3 contains two new actions added to the Home controller class that you can use to insert new records into the Movie database table.</span></span>

<span data-ttu-id="c8804-219">**Список 3 - Контролеры »HomeController.cs (Методы добавления)**</span><span class="sxs-lookup"><span data-stu-id="c8804-219">**Listing 3 – Controllers\HomeController.cs (Add methods)**</span></span>

[!code-csharp[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample4.cs)]

<span data-ttu-id="c8804-220">Первое действие Добавить () просто возвращает представление.</span><span class="sxs-lookup"><span data-stu-id="c8804-220">The first Add() action simply returns a view.</span></span> <span data-ttu-id="c8804-221">Представление содержит форму для добавления новой записи базы данных фильмов (см. рисунок 8).</span><span class="sxs-lookup"><span data-stu-id="c8804-221">The view contains a form for adding a new movie database record (see Figure 8).</span></span> <span data-ttu-id="c8804-222">При отправке формы вызывается действие second Add().</span><span class="sxs-lookup"><span data-stu-id="c8804-222">When you submit the form, the second Add() action is invoked.</span></span>

<span data-ttu-id="c8804-223">Обратите внимание, что второе действие Add() украшено атрибутом AcceptVerbs.</span><span class="sxs-lookup"><span data-stu-id="c8804-223">Notice that the second Add() action is decorated with the AcceptVerbs attribute.</span></span> <span data-ttu-id="c8804-224">Это действие может быть вызвано только при выполнении операции HTTP POST.</span><span class="sxs-lookup"><span data-stu-id="c8804-224">This action can be invoked only when performing an HTTP POST operation.</span></span> <span data-ttu-id="c8804-225">Другими словами, это действие может быть вызвано только при размещении HTML-формы.</span><span class="sxs-lookup"><span data-stu-id="c8804-225">In other words, this action can only be invoked when posting an HTML form.</span></span>

<span data-ttu-id="c8804-226">Второе действие Добавить() создает новый экземпляр класса Entity Framework Movie с помощью метода ASP.NET MVC TryUpdateModel() .</span><span class="sxs-lookup"><span data-stu-id="c8804-226">The second Add() action creates a new instance of the Entity Framework Movie class with the help of the ASP.NET MVC TryUpdateModel() method.</span></span> <span data-ttu-id="c8804-227">Метод TryUpdateModel () принимает поля в FormCollection, передаваемые методу Add() и присваивает значения этих полей HTML форме классу Movie.</span><span class="sxs-lookup"><span data-stu-id="c8804-227">The TryUpdateModel() method takes the fields in the FormCollection passed to the Add() method and assigns the values of these HTML form fields to the Movie class.</span></span>

<span data-ttu-id="c8804-228">При использовании рамочного образования необходимо предоставить «белый список» свойств при использовании методов TryUpdateModel или UpdateModel для обновления свойств класса сущности.</span><span class="sxs-lookup"><span data-stu-id="c8804-228">When using the Entity Framework, you must supply a "white list" of properties when using the TryUpdateModel or UpdateModel methods to update the properties of an entity class.</span></span>

<span data-ttu-id="c8804-229">Далее действие Add() выполняет несколько простых проверки формы.</span><span class="sxs-lookup"><span data-stu-id="c8804-229">Next, the Add() action performs some simple form validation.</span></span> <span data-ttu-id="c8804-230">Действие проверяет, что свойства Title и Директор имеют значения.</span><span class="sxs-lookup"><span data-stu-id="c8804-230">The action verifies that both the Title and Director properties have values.</span></span> <span data-ttu-id="c8804-231">При наличии ошибки проверки в ModelState добавляется сообщение об ошибке проверки.</span><span class="sxs-lookup"><span data-stu-id="c8804-231">If there is a validation error, then a validation error message is added to ModelState.</span></span>

<span data-ttu-id="c8804-232">Если ошибок проверки нет, то новая запись фильма добавляется в таблицу базы данных Movies с помощью Рамочной системы entity.</span><span class="sxs-lookup"><span data-stu-id="c8804-232">If there are no validation errors then a new movie record is added to the Movies database table with the help of the Entity Framework.</span></span> <span data-ttu-id="c8804-233">Новая запись добавляется в базу данных со следующими двумя строками кода:</span><span class="sxs-lookup"><span data-stu-id="c8804-233">The new record is added to the database with the following two lines of code:</span></span>

[!code-csharp[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample5.cs)]

<span data-ttu-id="c8804-234">Первая строка кода добавляет новую сущность Movie в набор фильмов, отслеживаемых Рамочной системой entity.</span><span class="sxs-lookup"><span data-stu-id="c8804-234">The first line of code adds the new Movie entity to the set of movies being tracked by the Entity Framework.</span></span> <span data-ttu-id="c8804-235">Вторая строка кода сохраняет все изменения, внесенные в фильмы, отслеживаемые обратно в базовую базу данных.</span><span class="sxs-lookup"><span data-stu-id="c8804-235">The second line of code saves whatever changes have been made to the Movies being tracked back to the underlying database.</span></span>

<span data-ttu-id="c8804-236">**Рисунок 8 - Представление добавления**</span><span class="sxs-lookup"><span data-stu-id="c8804-236">**Figure 8 – The Add view**</span></span>

![clip_image016](creating-model-classes-with-the-entity-framework-cs/_static/image8.jpg)

#### <a name="updating-database-records-with-the-entity-framework"></a><span data-ttu-id="c8804-238">Обновление записей баз данных с помощью рамочной системы entity</span><span class="sxs-lookup"><span data-stu-id="c8804-238">Updating Database Records with the Entity Framework</span></span>

<span data-ttu-id="c8804-239">Практически тот же подход следует отсылать к записи базы данных в рамках entity, как подход, который мы только что следовали, чтобы вставить новую запись базы данных.</span><span class="sxs-lookup"><span data-stu-id="c8804-239">You can follow almost the same approach to edit a database record with the Entity Framework as the approach that we just followed to insert a new database record.</span></span> <span data-ttu-id="c8804-240">Список 4 содержит два новых действия контроллера под названием Edit().</span><span class="sxs-lookup"><span data-stu-id="c8804-240">Listing 4 contains two new controller actions named Edit().</span></span> <span data-ttu-id="c8804-241">Первое действие Edit() возвращает HTML-форму для редактирования записи фильма.</span><span class="sxs-lookup"><span data-stu-id="c8804-241">The first Edit() action returns an HTML form for editing a movie record.</span></span> <span data-ttu-id="c8804-242">Во втором действии Edit() попытка обновления базы данных.</span><span class="sxs-lookup"><span data-stu-id="c8804-242">The second Edit() action attempts to update the database.</span></span>

<span data-ttu-id="c8804-243">**Список 4 - Контролеры -HomeController.cs (методы отсечения)**</span><span class="sxs-lookup"><span data-stu-id="c8804-243">**Listing 4 – Controllers\HomeController.cs (Edit methods)**</span></span>

[!code-csharp[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample6.cs)]

<span data-ttu-id="c8804-244">Второе действие Edit() начинается с извлечения записи фильма из базы данных, которая соответствует идентификатору отредактированного фильма.</span><span class="sxs-lookup"><span data-stu-id="c8804-244">The second Edit() action starts by retrieving the Movie record from the database that matches the Id of the movie being edited.</span></span> <span data-ttu-id="c8804-245">В следующем заявлении lin'to Entities записи захвата первой записи базы данных, которая соответствует определенному идентификатору:</span><span class="sxs-lookup"><span data-stu-id="c8804-245">The following LINQ to Entities statement grabs the first database record that matches a particular Id:</span></span>

[!code-csharp[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample7.cs)]

<span data-ttu-id="c8804-246">Далее метод TryUpdateModel () используется для присвоения значений полей формы HTML свойствам сущности фильма.</span><span class="sxs-lookup"><span data-stu-id="c8804-246">Next, the TryUpdateModel() method is used to assign the values of the HTML form fields to the properties of the movie entity.</span></span> <span data-ttu-id="c8804-247">Обратите внимание, что белый список поставляется для указания точных свойств для обновления.</span><span class="sxs-lookup"><span data-stu-id="c8804-247">Notice that a white list is supplied to specify the exact properties to update.</span></span>

<span data-ttu-id="c8804-248">Далее выполняется несколько простых проверок, чтобы убедиться, что как название фильма, так и свойства директора имеют значения.</span><span class="sxs-lookup"><span data-stu-id="c8804-248">Next, some simple validation is performed to verify that both the Movie Title and Director properties have values.</span></span> <span data-ttu-id="c8804-249">Если в одном из свойств отсутствует значение, то сообщение об ошибке проверки добавляется в ModelState и ModelState.IsValid возвращает значение ложное.</span><span class="sxs-lookup"><span data-stu-id="c8804-249">If either property is missing a value, then a validation error message is added to ModelState and ModelState.IsValid returns the value false.</span></span>

<span data-ttu-id="c8804-250">Наконец, если ошибок проверки нет, то таблица базы данных Movies обновляется с любыми изменениями, вызывая метод SaveChanges()</span><span class="sxs-lookup"><span data-stu-id="c8804-250">Finally, if there are no validation errors, then the underlying Movies database table is updated with any changes by calling the SaveChanges() method.</span></span>

<span data-ttu-id="c8804-251">При редактировании записей баз данных необходимо передать идентификатор записи, редактируемый, в действие контроллера, выполняя обновление базы данных.</span><span class="sxs-lookup"><span data-stu-id="c8804-251">When editing database records, you need to pass the Id of the record being edited to the controller action that performs the database update.</span></span> <span data-ttu-id="c8804-252">В противном случае действие контроллера не будет знать, какую запись обновить в базовой базе данных.</span><span class="sxs-lookup"><span data-stu-id="c8804-252">Otherwise, the controller action will not know which record to update in the underlying database.</span></span> <span data-ttu-id="c8804-253">Представление «Редактировать», содержащееся в листинге 5, включает в себя скрытое поле формы, представляющее идентификатор редактируемой записи базы данных.</span><span class="sxs-lookup"><span data-stu-id="c8804-253">The Edit view, contained in Listing 5, includes a hidden form field that represents the Id of the database record being edited.</span></span>

<span data-ttu-id="c8804-254">**Список 5 - Просмотры»Home-Edit.aspx**</span><span class="sxs-lookup"><span data-stu-id="c8804-254">**Listing 5 – Views\Home\Edit.aspx**</span></span>

[!code-aspx[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample8.aspx)]

## <a name="deleting-database-records-with-the-entity-framework"></a><span data-ttu-id="c8804-255">Удалять записи баз данных с помощью рамочной системы entity</span><span class="sxs-lookup"><span data-stu-id="c8804-255">Deleting Database Records with the Entity Framework</span></span>

<span data-ttu-id="c8804-256">Окончательная операция базы данных, которую мы должны решить в этом учебнике, это удаляние записей баз данных.</span><span class="sxs-lookup"><span data-stu-id="c8804-256">The final database operation, which we need to tackle in this tutorial, is deleting database records.</span></span> <span data-ttu-id="c8804-257">Вы можете использовать действие контроллера в листинге 6 для удаления определенной записи базы данных.</span><span class="sxs-lookup"><span data-stu-id="c8804-257">You can use the controller action in Listing 6 to delete a particular database record.</span></span>

<span data-ttu-id="c8804-258">**Перечисление 6 -- «Контролеры»HomeController.cs (Удаление действий)**</span><span class="sxs-lookup"><span data-stu-id="c8804-258">**Listing 6 -- \Controllers\HomeController.cs (Delete action)**</span></span>

[!code-csharp[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample9.cs)]

<span data-ttu-id="c8804-259">Действие Delete() сначала получает сущность Movie, которая соответствует идентификатору, передаваемому действию.</span><span class="sxs-lookup"><span data-stu-id="c8804-259">The Delete() action first retrieves the Movie entity that matches the Id passed to the action.</span></span> <span data-ttu-id="c8804-260">Далее фильм удаляется из базы данных, вызывая метод DeleteObject() с последующим методом SaveChanges () .</span><span class="sxs-lookup"><span data-stu-id="c8804-260">Next, the movie is deleted from the database by calling the DeleteObject() method followed by the SaveChanges() method.</span></span> <span data-ttu-id="c8804-261">Наконец, пользователь перенаправляется обратно в представление индекса.</span><span class="sxs-lookup"><span data-stu-id="c8804-261">Finally, the user is redirected back to the Index view.</span></span>

## <a name="summary"></a><span data-ttu-id="c8804-262">Сводка</span><span class="sxs-lookup"><span data-stu-id="c8804-262">Summary</span></span>

<span data-ttu-id="c8804-263">Цель этого руководства состояла в том, чтобы продемонстрировать, как можно создавать веб-приложения на основе баз данных, воспользовавшись преимуществами ASP.NET MVC и рамочной системой корпорации Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="c8804-263">The purpose of this tutorial was to demonstrate how you can build database-driven web applications by taking advantage of ASP.NET MVC and the Microsoft Entity Framework.</span></span> <span data-ttu-id="c8804-264">Вы узнали, как создать приложение, которое позволяет выбирать, вставлять, обновлять и удалять записи баз данных.</span><span class="sxs-lookup"><span data-stu-id="c8804-264">You learned how to build an application that enables you to select, insert, update, and delete database records.</span></span>

<span data-ttu-id="c8804-265">Во-первых, мы обсудили, как можно использовать Мастера модели данных entity для создания модели данных entity из Визуальной студии.</span><span class="sxs-lookup"><span data-stu-id="c8804-265">First, we discussed how you can use the Entity Data Model Wizard to generate an Entity Data Model from within Visual Studio.</span></span> <span data-ttu-id="c8804-266">Далее вы узнаете, как использовать LIN's для создания сущностей для получения набора записей баз данных из таблицы баз данных.</span><span class="sxs-lookup"><span data-stu-id="c8804-266">Next, you learn how to use LINQ to Entities to retrieve a set of database records from a database table.</span></span> <span data-ttu-id="c8804-267">Наконец, мы использовали рамочную систему сущности для вставки, обновления и удаления записей баз данных.</span><span class="sxs-lookup"><span data-stu-id="c8804-267">Finally, we used the Entity Framework to insert, update, and delete database records.</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="c8804-268">Вперед</span><span class="sxs-lookup"><span data-stu-id="c8804-268">Next</span></span>](creating-model-classes-with-linq-to-sql-cs.md)
