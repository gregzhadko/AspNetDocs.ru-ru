---
uid: mvc/overview/older-versions-1/models-data/creating-model-classes-with-the-entity-framework-cs
title: Создание типовых классов с помощью рамочной системы entity (C) Документы Майкрософт
author: rick-anderson
description: В этом уроке вы узнаете, как использовать ASP.NET MVC с помощью рамочной программы Корпорации Майкрософт. Вы узнаете, как использовать Entity Мастера для создания ADO.NET Entity Da ...
ms.author: riande
ms.date: 01/27/2009
ms.assetid: 61644169-e8b1-45dd-bf96-9c2301b69879
msc.legacyurl: /mvc/overview/older-versions-1/models-data/creating-model-classes-with-the-entity-framework-cs
msc.type: authoredcontent
ms.openlocfilehash: 716d34167258b1005b25b1cd11bfaa6d80763320
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2020
ms.locfileid: "81542668"
---
# <a name="creating-model-classes-with-the-entity-framework-c"></a>Создание классов модели в Entity Framework (C#)

[корпорацией Майкрософт](https://github.com/microsoft)

> В этом уроке вы узнаете, как использовать ASP.NET MVC с помощью рамочной программы Корпорации Майкрософт. Вы узнаете, как использовать Мастера Сущности для создания модели данных ADO.NET entity. В течение этого руководства мы создаем веб-приложение, которое иллюстрирует, как выбирать, вставлять, обновлять и удалять данные базы данных с помощью рамочной базы сущности.

Цель этого руководства состоит в том, чтобы объяснить, как можно создавать классы доступа к данным с помощью рамочной программы Microsoft Entity при создании ASP.NET приложения MVC. Этот учебник не предполагает никаких предыдущих знаний о рамочной системе сущности Майкрософт. К концу этого урока вы поймете, как использовать рамочную систему сущности для выбора, вставки, обновления и удаления записей баз данных.

Рамочная программа Сущности Майкрософт — это инструмент, позволяющий автоматически генерировать слой доступа к данным из базы данных. Рамки сущности позволяют избежать утомительной работы по созданию классов доступа к данным вручную.

Чтобы проиллюстрировать, как можно использовать рамочную систему Корпорации Майкрософт с помощью ASP.NET MVC, мы создам простое примерприложения. Мы создадим приложение Movie Database, которое позволит отображать и отсеивать записи базы данных фильмов.

Этот учебник предполагает, что у вас есть Visual Studio 2008 или Visual Web Developer 2008 с сервисным пакетом 1. Для использования рамочной программы Entity вам нужен пакет услуг 1. Вы можете скачать Visual Studio 2008 Service Pack 1 или Visual Web Developer с пакетом услуг 1 со следующего адреса:

> [https://www.asp.net/downloads/](https://www.asp.net/downloads)

> [!NOTE] 
> 
> Между ASP.NET MVC и рамочной системой корпорации Майкрософт нет существенной связи. Существует несколько альтернатив рамочной системе entity, которую можно использовать с помощью ASP.NET MVC. Например, можно создавать классы mVC Model с помощью других инструментов O/RM, таких как Microsoft LIN' для S'L, NHibernate или SubSonic.

## <a name="creating-the-movie-sample-database"></a>Создание базы данных образцов фильмов

Приложение Movie Database использует таблицу базы данных под названием Фильмы, которая содержит следующие столбцы:

| Имя столбца | Тип данных | Разрешить Nulls? | Является ли основной ключ? |
| --- | --- | --- | --- |
| Идентификатор | INT | False | True |
| Title | nvarchar (100) | False | False |
| Директор | nvarchar (100) | False | False |

Эту таблицу можно добавить в проект MVC ASP.NET, выполнив следующие действия:

1. Нажмите правой\_папкой App Data в окне Solution Explorer и выберите опцию **«Добавить» —новый пункт.**
2. Из диалогового окна **Добавить новый элемент** выберите **базу данных сервера S'L,** назовите базу данных именем MoviesDB.mdf и нажмите кнопку **«Добавить».**
3. Дважды щелкните файл MoviesDB.mdf, чтобы открыть окно Server Explorer/Database Explorer.
4. Расширьте подключение к базе данных MoviesDB.mdf, нажмите правой кнопкой мыши папку Таблицы и выберите вариант меню **Добавить новую таблицу.**
5. В таблицу Designer добавьте колонки Id, Title и Director.
6. Нажмите кнопку **Сохранить** (она имеет значок дискеты), чтобы сохранить новую таблицу с именем Фильмы.

После создания таблицы базы данных Movies следует добавить некоторые примеры данных в таблицу. Нажмите правой кнопкой мыши таблицы Фильмы и выберите вариант меню **Показать таблицы данных**. Вы можете ввести поддельные данные фильма в сетку, которая появляется.

## <a name="creating-the-adonet-entity-data-model"></a>Создание модели данных ADO.NET сущности

Для использования рамочной системы сущности необходимо создать модель данных сущности. Вы можете воспользоваться visual Studio *Entity Data Model Мастера* для создания модели данных Entity из базы данных автоматически.

Выполните следующие действия.

1. Нажмите правой кнопкой папку Модели в окне Solution Explorer и выберите вариант меню **Добавить, Новый пункт**.
2. В диалоге **Добавить новый элемент** выберите категорию данных (см. рисунок 1).
3. Выберите шаблон **модели данных ADO.NET Entity,** назовите модель данных сущности на имя MoviesDBModel.edmx и нажмите кнопку **«Добавить».** Нажатие кнопки **Добавить** запускает мастера модели данных.
4. На этапе **«Выбрать содержимое модели»** выберите **«Создание» из** опции базы данных и нажмите кнопку **«Следующая»** (см. рисунок 2).
5. На этапе **«Выберите соединение данных»** выберите соединение базы данных MoviesDB.mdf, введите настройки подключения объектов с именем MoviesDBEntities и нажмите кнопку **«Следующая»** (см. рисунок 3).
6. На этапе **«Выберите объекты базы данных»** выберите таблицу базы данных Movie и нажмите кнопку **«Завершение»** (см. рисунок 4).

После выполнения этих шагов открывается ADO.NET модельный план-модель данных entity (Entity Data Designer).

**Рисунок 1 - Создание новой модели данных сущности**

![clip_image002](creating-model-classes-with-the-entity-framework-cs/_static/image1.jpg)

**Рисунок 2 - Выберите модель Содержание Шаг**

![clip_image004](creating-model-classes-with-the-entity-framework-cs/_static/image2.jpg)

**Рисунок 3 - Выберите подключение к данным**

![clip_image006](creating-model-classes-with-the-entity-framework-cs/_static/image3.jpg)

**Рисунок 4 - Выберите объекты базы данных**

![clip_image008](creating-model-classes-with-the-entity-framework-cs/_static/image4.jpg)

#### <a name="modifying-the-adonet-entity-data-model"></a>Изменение модели данных ADO.NET сущности

После создания модели данных entity можно изменить модель, воспользовавшись преимуществами конструктора сущности (см. рисунок 5). Вы можете открыть Entity Designer в любое время, дважды нажав на файл MoviesDBModel.edmx, содержащийся в папке Модели в окне Solution Explorer.

**Рисунок 5 - ADO.NET модель данных сущности Конструктор**

![clip_image010](creating-model-classes-with-the-entity-framework-cs/_static/image5.jpg)

Например, можно использовать «Дизайнер сущности» для изменения названий классов, генерируемых Мастером данных модели сущности. Волшебник создал новый класс доступа к данным под названием Movies. Другими словами, Мастер дал классу то же имя, что и таблица баз данных. Поскольку мы будем использовать этот класс для представления конкретного экземпляра Movie, мы должны переименовать класс из фильмов в фильм.

Если вы хотите переименовать класс сущности, можно дважды нажать на имя класса в проектировщике сущности и ввести новое имя (см. рисунок 6). Кроме того, можно изменить имя объекта в окне Свойств после выбора сущности в проекте Entity Designer.

**Рисунок 6 - Изменение имени объекта**

![clip_image012](creating-model-classes-with-the-entity-framework-cs/_static/image6.jpg)

Не забудьте сохранить модель данных Entity после внесения изменений, нажав кнопку Сохранить (значок дискеты). За кулисами, Entity Designer генерирует набор классов C-класса. Вы можете просмотреть эти классы, открыв MoviesDBModel.Designer.cs файл из окна Solution Explorer.

Не изменяйте код в файле Designer.cs, так как ваши изменения будут перезаписаны при следующем использовании Entity Designer. Если вы хотите расширить функциональность классов сущности, определенных в Designer.cs файле, то можно создать *частичные классы* в отдельных файлах.

#### <a name="selecting-database-records-with-the-entity-framework"></a>Выбор записей баз данных с помощью рамочной системы entity

Давайте начнем создавать наше приложение Базы данных фильмов, создав страницу, на которую отображается список записей фильмов. Домашний контроллер в листинге 1 предоставляет действие под названием Индекс(). Действие «Индекс() возвращает все записи фильмов из таблицы базы данных Movie, воспользовавшись рамочным образованием.

**Список 1 - Контролеры-HomeController.cs**

[!code-csharp[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample1.cs)]

Обратите внимание, что контроллер в листинге 1 включает в себя конструктор. Конструктор инициализирует поле уровня \_класса под названием db. Поле \_db представляет сущности баз данных, генерируемые Рамочной системой сущности Майкрософт. Поле \_db — это экземпляр класса MoviesDBEntities, который был создан конструктором entity.

Для того, чтобы использовать класс MoviesDBEntities в контроллере Home, необходимо импортировать namespace MovieEntitiesApp.Models *(MVCProjectName*. Модели).

Поле \_db используется в действиях Index() для извлечения записей из таблицы базы данных Movies. Выражение \_db. MovieSet представляет все записи из таблицы базы данных Movies. Метод ToList() используется для преобразования набора фильмов в общую коллекцию объектов Movie (List&lt;Movie).&gt;

Записи фильмов извлекаются с помощью LIN'а в образования. Действие Индекса () в листинге 1 использует *синтаксис метода* LIN' для получения набора записей баз данных. Если вы предпочитаете, вы можете использовать *синтаксис запроса* LIN's вместо этого. Следующие два заявления делают то же самое:

[!code-csharp[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample2.cs)]

Используйте какой бы синтаксис LIN' - синтаксис метода или синтаксис запроса - что вы найдете наиболее интуитивно понятным. Нет никакой разницы в производительности между двумя подходами – с той лишь разницей стиль.

Представление в листинге 2 используется для отображения записей фильмов.

**Список 2 - Просмотры »Домашний»Индекс.aspx**

[!code-aspx[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample3.aspx)]

Представление в листинге 2 содержит цикл **foreach,** который итерируется через каждую запись фильма и отображает значения свойства названия и директора записи фильма. Обратите внимание, что ссылка «Отображение и удаление» отображается рядом с каждой записью. Кроме того, в нижней части представления отображается ссылка Add Movie (см. рисунок 7).

**Рисунок 7 - Представление индекса**

![clip_image014](creating-model-classes-with-the-entity-framework-cs/_static/image7.jpg)

Представление индекса — это *набранное представление.* Представление индекса &lt;включает&gt; в себя директиву % с атрибутом *Наследуемой страницы,* которая отбрасывает&lt;свойство модели к сильно набранной общей коллекции списков объектов Movie (List Movie).

## <a name="inserting-database-records-with-the-entity-framework"></a>Вставка записей баз данных с рамочной системой entity

Можно использовать рамочную систему entity, чтобы упростить вставку новых записей в таблицу баз данных. Список 3 содержит два новых действия, добавленные в класс контроллера Home, которые можно использовать для вставки новых записей в таблицу базы данных Movie.

**Список 3 - Контролеры »HomeController.cs (Методы добавления)**

[!code-csharp[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample4.cs)]

Первое действие Добавить () просто возвращает представление. Представление содержит форму для добавления новой записи базы данных фильмов (см. рисунок 8). При отправке формы вызывается действие second Add().

Обратите внимание, что второе действие Add() украшено атрибутом AcceptVerbs. Это действие может быть вызвано только при выполнении операции HTTP POST. Другими словами, это действие может быть вызвано только при размещении HTML-формы.

Второе действие Добавить() создает новый экземпляр класса Entity Framework Movie с помощью метода ASP.NET MVC TryUpdateModel() . Метод TryUpdateModel () принимает поля в FormCollection, передаваемые методу Add() и присваивает значения этих полей HTML форме классу Movie.

При использовании рамочного образования необходимо предоставить «белый список» свойств при использовании методов TryUpdateModel или UpdateModel для обновления свойств класса сущности.

Далее действие Add() выполняет несколько простых проверки формы. Действие проверяет, что свойства Title и Директор имеют значения. При наличии ошибки проверки в ModelState добавляется сообщение об ошибке проверки.

Если ошибок проверки нет, то новая запись фильма добавляется в таблицу базы данных Movies с помощью Рамочной системы entity. Новая запись добавляется в базу данных со следующими двумя строками кода:

[!code-csharp[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample5.cs)]

Первая строка кода добавляет новую сущность Movie в набор фильмов, отслеживаемых Рамочной системой entity. Вторая строка кода сохраняет все изменения, внесенные в фильмы, отслеживаемые обратно в базовую базу данных.

**Рисунок 8 - Представление добавления**

![clip_image016](creating-model-classes-with-the-entity-framework-cs/_static/image8.jpg)

#### <a name="updating-database-records-with-the-entity-framework"></a>Обновление записей баз данных с помощью рамочной системы entity

Практически тот же подход следует отсылать к записи базы данных в рамках entity, как подход, который мы только что следовали, чтобы вставить новую запись базы данных. Список 4 содержит два новых действия контроллера под названием Edit(). Первое действие Edit() возвращает HTML-форму для редактирования записи фильма. Во втором действии Edit() попытка обновления базы данных.

**Список 4 - Контролеры -HomeController.cs (методы отсечения)**

[!code-csharp[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample6.cs)]

Второе действие Edit() начинается с извлечения записи фильма из базы данных, которая соответствует идентификатору отредактированного фильма. В следующем заявлении lin'to Entities записи захвата первой записи базы данных, которая соответствует определенному идентификатору:

[!code-csharp[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample7.cs)]

Далее метод TryUpdateModel () используется для присвоения значений полей формы HTML свойствам сущности фильма. Обратите внимание, что белый список поставляется для указания точных свойств для обновления.

Далее выполняется несколько простых проверок, чтобы убедиться, что как название фильма, так и свойства директора имеют значения. Если в одном из свойств отсутствует значение, то сообщение об ошибке проверки добавляется в ModelState и ModelState.IsValid возвращает значение ложное.

Наконец, если ошибок проверки нет, то таблица базы данных Movies обновляется с любыми изменениями, вызывая метод SaveChanges()

При редактировании записей баз данных необходимо передать идентификатор записи, редактируемый, в действие контроллера, выполняя обновление базы данных. В противном случае действие контроллера не будет знать, какую запись обновить в базовой базе данных. Представление «Редактировать», содержащееся в листинге 5, включает в себя скрытое поле формы, представляющее идентификатор редактируемой записи базы данных.

**Список 5 - Просмотры»Home-Edit.aspx**

[!code-aspx[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample8.aspx)]

## <a name="deleting-database-records-with-the-entity-framework"></a>Удалять записи баз данных с помощью рамочной системы entity

Окончательная операция базы данных, которую мы должны решить в этом учебнике, это удаляние записей баз данных. Вы можете использовать действие контроллера в листинге 6 для удаления определенной записи базы данных.

**Перечисление 6 -- «Контролеры»HomeController.cs (Удаление действий)**

[!code-csharp[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample9.cs)]

Действие Delete() сначала получает сущность Movie, которая соответствует идентификатору, передаваемому действию. Далее фильм удаляется из базы данных, вызывая метод DeleteObject() с последующим методом SaveChanges () . Наконец, пользователь перенаправляется обратно в представление индекса.

## <a name="summary"></a>Сводка

Цель этого руководства состояла в том, чтобы продемонстрировать, как можно создавать веб-приложения на основе баз данных, воспользовавшись преимуществами ASP.NET MVC и рамочной системой корпорации Майкрософт. Вы узнали, как создать приложение, которое позволяет выбирать, вставлять, обновлять и удалять записи баз данных.

Во-первых, мы обсудили, как можно использовать Мастера модели данных entity для создания модели данных entity из Визуальной студии. Далее вы узнаете, как использовать LIN's для создания сущностей для получения набора записей баз данных из таблицы баз данных. Наконец, мы использовали рамочную систему сущности для вставки, обновления и удаления записей баз данных.

> [!div class="step-by-step"]
> [Вперед](creating-model-classes-with-linq-to-sql-cs.md)
