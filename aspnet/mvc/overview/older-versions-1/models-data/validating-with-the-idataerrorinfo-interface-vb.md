---
uid: mvc/overview/older-versions-1/models-data/validating-with-the-idataerrorinfo-interface-vb
title: Проверка с помощью интерфейса IDataErrorInfo (VB) | Документация Майкрософт
author: StephenWalther
description: Стивен Вальтер показывает, как отобразить пользовательские сообщения об ошибках проверки, реализовав интерфейс IDataErrorInfo в классе модели.
ms.author: riande
ms.date: 03/02/2009
ms.assetid: 3a8a9d9f-82dd-4959-b7c6-960e9ce95df1
msc.legacyurl: /mvc/overview/older-versions-1/models-data/validating-with-the-idataerrorinfo-interface-vb
msc.type: authoredcontent
ms.openlocfilehash: 8ff3adc5db8114dcca2c66d937e1706f0bac0d30
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78436302"
---
# <a name="validating-with-the-idataerrorinfo-interface-vb"></a>Проверка с помощью интерфейса IDataErrorInfo (VB)

по [Стивен Вальтер](https://github.com/StephenWalther)

> Стивен Вальтер показывает, как отобразить пользовательские сообщения об ошибках проверки, реализовав интерфейс IDataErrorInfo в классе модели.

Цель этого учебника — объяснить один подход к выполнению проверки в приложении ASP.NET MVC. Вы узнаете, как предотвратить отправку HTML-формы, не предоставляя значения для обязательных полей формы. В этом руководстве вы узнаете, как выполнить проверку с помощью интерфейса Иеррордатаинфо.

## <a name="assumptions"></a>Предположения

В этом руководстве я буду использовать базу данных Мовиесдб и таблицу фильмов. Эта таблица имеет следующие столбцы.

<a id="0.6_table01"></a>

| **Имя столбца** | **Тип данных** | **Разрешить значения NULL** |
| --- | --- | --- |
| Идентификатор | Int | False |
| Title | Nvarchar (100) | False |
| Директор | Nvarchar (100) | False |
| датерелеасед | Дата и время | False |

В этом руководстве я использую Microsoft Entity Framework для создания классов модели базы данных. Класс Movie, созданный Entity Framework, отображается на рис. 1.

[![сущности «Movie»](validating-with-the-idataerrorinfo-interface-vb/_static/image1.jpg)](validating-with-the-idataerrorinfo-interface-vb/_static/image1.png)

**Рис. 01**. сущность "фильм" ([щелкните, чтобы просмотреть изображение с полным размером](validating-with-the-idataerrorinfo-interface-vb/_static/image2.png))

> [!NOTE] 
> 
> Дополнительные сведения об использовании Entity Framework для создания классов модели базы данных см. в разделе мой учебник, посвященный созданию классов моделей с Entity Framework.

## <a name="the-controller-class"></a>Класс контроллера

Мы используем контроллер Home для вывода списка фильмов и создания новых фильмов. Код для этого класса содержится в листинге 1.

**Листинг 1. Контроллерс\хомеконтроллер.ВБ**

[!code-vb[Main](validating-with-the-idataerrorinfo-interface-vb/samples/sample1.vb)]

Класс контроллера Home в листинге 1 содержит два действия Create (). Первое действие отображает HTML-форму для создания нового фильма. Второе действие Create () выполняет фактическую вставку нового фильма в базу данных. Второе действие Create () вызывается при отправке на сервер формы, отображаемой первым действием Create ().

Обратите внимание, что второе действие Create () содержит следующие строки кода:

[!code-vb[Main](validating-with-the-idataerrorinfo-interface-vb/samples/sample2.vb)]

Свойство IsValid возвращает значение false в случае ошибки проверки. В этом случае повторно отображается представление создания, содержащее HTML-форму для создания фильма.

## <a name="creating-a-partial-class"></a>Создание разделяемого класса

Класс Movie создается Entity Framework. Код для класса Movie можно увидеть, если развернуть файл Мовиесдбмодел. EDMX в окне обозреватель решений и открыть файл Мовиесдбмодел. Designer. vb в редакторе кода (см. рис. 2).

[![кода для сущности «Movie»](validating-with-the-idataerrorinfo-interface-vb/_static/image2.jpg)](validating-with-the-idataerrorinfo-interface-vb/_static/image3.png)

**Рис. 02**. код для сущности Movie ([щелкните, чтобы просмотреть изображение с полным размером](validating-with-the-idataerrorinfo-interface-vb/_static/image4.png))

Класс Movie является разделяемым классом. Это означает, что мы можем добавить еще один разделяемый класс с тем же именем, чтобы расширить функциональные возможности класса Movie. Мы добавим логику проверки к новому разделяемому классу.

Добавьте класс в листинге 2 в папку Models.

**Листинг 2. Моделс\мовие.ВБ**

[!code-vb[Main](validating-with-the-idataerrorinfo-interface-vb/samples/sample3.vb)]

Обратите внимание, что класс в листинге 2 содержит модификатор *partial* . Все методы или свойства, добавляемые в этот класс, становятся частью класса Movie, созданного Entity Framework.

## <a name="adding-onchanging-and-onchanged-partial-methods"></a>Добавление меняющихся и неизменных разделяемых методов

Когда Entity Framework создает класс сущностей, Entity Framework автоматически добавляет разделяемые методы в класс. Entity Framework создает частичные и меняющиеся разделяемые методы, соответствующие каждому свойству класса.

В случае класса Movie Entity Framework создает следующие методы:

- онидчангинг
- онидчанжед
- онтитлечангинг
- онтитлечанжед
- ондиректорчангинг
- ондиректорчанжед
- ондатерелеаседчангинг
- ондатерелеаседчанжед

Метод onchangingd вызывается прямо перед изменением соответствующего свойства. Переданный метод вызывается сразу после изменения свойства.

Можно воспользоваться преимуществами этих разделяемых методов, чтобы добавить логику проверки к классу Movie. Класс фильмов Update в листинге 3 проверяет, назначены ли свойства Title и Director непустыми значениями.

> [!NOTE] 
> 
> Разделяемый метод — это метод, определенный в классе, который не требуется реализовывать. Если не реализовать разделяемый метод, компилятор удаляет сигнатуру метода и все вызовы метода, чтобы не было никаких затрат времени выполнения, связанных с разделяемым методом. В редакторе Visual Studio Code можно добавить разделяемый метод, введя ключевое слово *partial* , за которым следует пробел, чтобы просмотреть список разделяемых элементов для реализации.

**Листинг 3. Моделс\мовие.ВБ**

[!code-vb[Main](validating-with-the-idataerrorinfo-interface-vb/samples/sample4.vb)]

Например, при попытке присвоить свойству Title пустую строку сообщение об ошибке будет назначено словарю с именем \_Errors.

На этом этапе ничто не происходит при присвоении пустой строки свойству Title, и в поле Private \_Errors добавляется ошибка. Нам нужно реализовать интерфейс IDataErrorInfo, чтобы предоставить эти ошибки проверки платформе ASP.NET MVC.

## <a name="implementing-the-idataerrorinfo-interface"></a>Реализация интерфейса IDataErrorInfo

С момента первой версии интерфейс IDataErrorInfo был частью платформы .NET Framework. Этот интерфейс является очень простым интерфейсом:

[!code-vb[Main](validating-with-the-idataerrorinfo-interface-vb/samples/sample5.vb)]

Если класс реализует интерфейс IDataErrorInfo, платформа ASP.NET MVC будет использовать этот интерфейс при создании экземпляра класса. Например, действие "создать" контроллера Home () принимает экземпляр класса Movie:

[!code-vb[Main](validating-with-the-idataerrorinfo-interface-vb/samples/sample6.vb)]

Платформа ASP.NET MVC создает экземпляр фильма, переданный в действие Create () с помощью связывателя модели (DefaultModelBinder). Связыватель модели отвечает за создание экземпляра объекта Movie путем привязки полей HTML-формы к экземпляру объекта Movie.

DefaultModelBinder определяет, реализует ли класс интерфейс IDataErrorInfo. Если класс реализует этот интерфейс, связыватель модели вызывает IDataErrorInfo. Этот индексатор для каждого свойства класса. Если индексатор возвращает сообщение об ошибке, связыватель модели добавляет это сообщение об ошибке в состояние модели автоматически.

DefaultModelBinder также проверяет свойство IDataErrorInfo. Error. Это свойство предназначено для представления ошибок проверки, относящихся к конкретному свойству, связанных с классом. Например, может потребоваться применить правило проверки, которое зависит от значений нескольких свойств класса Movie. В этом случае вы вернете ошибку проверки из свойства Error.

Обновленный класс Movie в листинге 4 реализует интерфейс IDataErrorInfo.

**Листинг 4 — Моделс\мовие.ВБ (реализация IDataErrorInfo)**

[!code-vb[Main](validating-with-the-idataerrorinfo-interface-vb/samples/sample7.vb)]

В листинге 4 свойство индексатора проверяет коллекцию ошибок \_, чтобы проверить, содержит ли он ключ, соответствующий имени свойства, переданного индексатору. Если нет ошибки проверки, связанной со свойством, возвращается пустая строка.

Вам не нужно изменять контроллер Home любым способом использования измененного класса Movie. Страница, показанная на рис. 3, показывает, что происходит, если не введено значение для полей формы Title или Director.

[![автоматическое создание методов действий](validating-with-the-idataerrorinfo-interface-vb/_static/image3.jpg)](validating-with-the-idataerrorinfo-interface-vb/_static/image5.png)

**Рис. 03**. форма с отсутствующими значениями ([щелкните, чтобы просмотреть изображение с полным размером](validating-with-the-idataerrorinfo-interface-vb/_static/image6.png))

Обратите внимание, что значение Датерелеасед проверяется автоматически. Поскольку свойство Датерелеасед не принимает значения NULL, DefaultModelBinder автоматически создает ошибку проверки для этого свойства, если у него нет значения. Если необходимо изменить сообщение об ошибке для свойства Датерелеасед, необходимо создать пользовательский связыватель модели.

## <a name="summary"></a>Сводка

В этом руководстве вы узнали, как использовать интерфейс IDataErrorInfo для создания сообщений об ошибках проверки. Во-первых, мы создали частичный класс Movie, расширяющий функциональные возможности частичного класса Movie, созданного Entity Framework. Далее мы добавили логику проверки к разделяемым методам класса Movie Онтитлечангинг () и Ондиректорчангинг (). Наконец, мы реализовали интерфейс IDataErrorInfo, чтобы предоставить эти сообщения проверки платформе ASP.NET MVC.

> [!div class="step-by-step"]
> [Назад](performing-simple-validation-vb.md)
> [Вперед](validating-with-a-service-layer-vb.md)
