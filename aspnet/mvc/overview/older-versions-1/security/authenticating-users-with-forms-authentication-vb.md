---
uid: mvc/overview/older-versions-1/security/authenticating-users-with-forms-authentication-vb
title: Проверка подлинности пользователей с помощью форм проверки подлинности (Visual Basic) | Документация Майкрософт
author: microsoft
description: Узнайте, как использовать атрибут [Authorize] чтобы защитить паролем определенной страницы в приложении MVC. Вы узнаете, как использовать веб-сайта администрирования слишком...
ms.author: riande
ms.date: 01/27/2009
ms.assetid: 4341f5b1-6fe5-44c5-8b8a-18fa84f80177
msc.legacyurl: /mvc/overview/older-versions-1/security/authenticating-users-with-forms-authentication-vb
msc.type: authoredcontent
ms.openlocfilehash: 0a4e8dc3ce5764c6b2ec59c7e3f507064f8a8cb5
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59422165"
---
# <a name="authenticating-users-with-forms-authentication-vb"></a>Проверка подлинности пользователей с помощью проверки подлинности на основе форм (VB)

по [Microsoft](https://github.com/microsoft)

> Узнайте, как использовать атрибут [Authorize] чтобы защитить паролем определенной страницы в приложении MVC. Вы узнаете, как использовать средство администрирования веб-сайт для создания и управления пользователями и ролями. Вы также узнаете, как настроить, где хранится информация о учетную запись и роль пользователя.


Целью данного руководства является объяснить, как можно использовать формы проверки подлинности пароль защиты представления в приложениях ASP.NET MVC. Вы узнаете, как использовать средство администрирования веб-узла для создания пользователей и ролей. Вы также узнаете, как предотвратить несанкционированный вызов действия контроллера. Наконец вы узнаете, как настроить, где хранятся имена пользователей и пароли.

#### <a name="using-the-web-site-administration-tool"></a>С помощью средства администрирования веб-сайта

Прежде чем мы ничего делать, мы следует начать с создания некоторых пользователей и ролей. Чтобы воспользоваться преимуществами средство администрирования веб-узла Visual Studio 2008 — самый простой способ создания новых пользователей и ролей. Это средство можно запустить, выбрав вариант меню **проекта, Конфигурация ASP.NET**. Кроме того, можно запустить средство администрирования веб-сайта, щелкнув значок (отчасти scary) из молоток, попадание на мир, который отображается в верхней части окна обозревателя решений (см. рис. 1).

**Рис. 1 – Запуск средства администрирования веб-сайта**

![clip_image002[4]](authenticating-users-with-forms-authentication-vb/_static/image1.jpg)

В средстве администрирования веб-сайта создайте новых пользователей и ролей, выбрав вкладку «Безопасность». Нажмите кнопку **создать пользователя** ссылку, чтобы создать нового пользователя с именем Стивен (см. рис. 2). Любой пароль, который вы хотите предоставить пользователю Стивен (например, *секрет*).

**Рис. 2 – Создание нового пользователя**

![clip_image004[4]](authenticating-users-with-forms-authentication-vb/_static/image2.jpg)

Создать новые роли путем включения роли и определения одной или нескольких ролей. Включить роли, щелкнув **включить роли** ссылку. Создайте роль с именем *Администраторы* , щелкнув **Создание и управление ролями** связи (см. рис. 3).

**Рис. 3 – Создание новой роли**

![clip_image006[4]](authenticating-users-with-forms-authentication-vb/_static/image3.jpg)

Наконец, создайте нового пользователя с именем Светлана и свяжите Светлана с роли "Администраторы", щелкнув ссылку Создать пользователя и выбрав пункт Администраторы, при создании Светлана (см. рис. 4).

**Рис. 4 – Добавление пользователя к роли**

![clip_image008[4]](authenticating-users-with-forms-authentication-vb/_static/image4.jpg)

Когда все сказано и сделано, необходимо иметь два новых пользователей, с именем Стивен и света. Вы также должны новую роль с именем администраторов. Светлана является членом роли "Администраторы" и не является Стивен.

#### <a name="requiring-authorization"></a>Требуется выполнять авторизацию

Вы можете потребовать от пользователя пройти проверку подлинности, прежде чем пользователь вызывает действие контроллера, добавив атрибут [Authorize] действие. Атрибут [Authorize] можно применить к действию, отдельного контроллера или этот атрибут можно применить к классу всего контроллера.

Например контроллер в листинге 1 предоставляет действие с именем CompanySecrets(). Поскольку это действие дополнен атрибутом [Authorize], это действие нельзя будет вызываться, если пользователь прошел проверку подлинности.

**В листинге 1 — Controllers\HomeController.vb**

[!code-vb[Main](authenticating-users-with-forms-authentication-vb/samples/sample1.vb)]

Если вызывается действие CompanySecrets(), введя URL-адрес/Home/CompanySecrets в адресной строке браузера и вы не прошедшего проверку пользователя, то вы будете перенаправлены в представление входа автоматически (см. рис. 5).

**Рис. 5 – представление входа**

![clip_image010[4]](authenticating-users-with-forms-authentication-vb/_static/image5.jpg)

Представление входа можно использовать для ввода имени пользователя и пароля. Если вы не зарегистрированного пользователя, а затем щелкнуть **зарегистрировать** ссылку для перехода в регистр представления (см. рис. 6). Представление Register можно использовать для создания учетной записи пользователя.

**Рис. 6 – представление Register**

![clip_image012](authenticating-users-with-forms-authentication-vb/_static/image6.jpg)

После успешного входа, вы увидите CompanySecrets представления (см. рис. 7). По умолчанию будет продолжать войти в систему до закрытия окна браузера.

**Рис. 7 – представление CompanySecrets**

![clip_image014](authenticating-users-with-forms-authentication-vb/_static/image7.jpg)

#### <a name="authorizing-by-user-name-or-user-role"></a>Авторизации по имени пользователя или роли пользователя

Атрибут [Authorize] можно использовать для ограничения доступа к действию контроллера к определенному набору пользователей или определенный набор ролей пользователей. Например измененный контроллер Home в листинге 2 содержит два новых действия с именем StephenSecrets() и AdministratorSecrets().

**В листинге 2 — Controllers\HomeController.vb**

[!code-vb[Main](authenticating-users-with-forms-authentication-vb/samples/sample2.vb)]

Действие StephenSecrets() можно вызвать только пользователь с именем пользователя Стивен. Все остальные пользователи перейдете в представление входа в систему. Свойство пользователей принимает разделенный запятыми список имен учетных записей пользователей.

Действие AdministratorSecrets() можно вызвать только пользователи в роли "Администраторы". Например поскольку Светлана является членом группы "Администраторы", она может вызывать действие AdministratorSecrets(). Все остальные пользователи перейдете в представление входа в систему. Свойства ролей принимает разделенный запятыми список имен ролей.

#### <a name="configuring-authentication"></a>Настройка проверки подлинности

На этом этапе вы можете спросить которых хранятся данные учетной записи и роли пользователя. По умолчанию данные хранятся в базе данных SQL Express (RANU) именованного ASPNETDB.mdf находятся в приложении MVC-приложении\_папку данных. Эта база данных создается платформой ASP.NET автоматически при запуске с помощью членства.

Чтобы увидеть базу данных ASPNETDB.mdf в окне обозревателя решений, необходимо сначала выбрать пункт меню проекта, Показать все файлы.

С помощью базы данных SQL Express по умолчанию подходит в том случае, при разработке приложения. Скорее всего тем не менее, вы не хотите использовать базе данных ASPNETDB.mdf по умолчанию в рабочем приложении. В этом случае можно изменить, где хранятся данные учетной записи пользователя, выполнив следующие действия:

1. Добавьте объекты базы данных служб приложений в производственной базе данных: изменение строки подключения вашего приложения для указания в производственной базе данных

Первым шагом является добавление все необходимые объекты базы данных (таблицы и хранимые процедуры) в производственной базе данных. Самый простой способ добавить эти объекты в новой базе данных, — чтобы воспользоваться преимуществами мастер установки SQL Server ASP.NET (см. рис. 8). Это средство можно запустить, открыв Командная строка Visual Studio 2008 из группы программ Microsoft Visual Studio 2008 и выполнив следующую команду из командной строки:

aspnet\_regsql

**Рис. 8 — ASP.NET мастер установки SQL Server**

![clip_image016](authenticating-users-with-forms-authentication-vb/_static/image8.jpg)

Мастер установки SQL Server ASP.NET позволяет выбрать базу данных SQL Server в сети и установить все объекты базы данных, необходимые для служб приложений ASP.NET. Сервер базы данных не должны находиться на локальном компьютере.

> [!NOTE]
> Если вы не хотите использовать мастер установки SQL Server ASP.NET, можно найти сценарии SQL для добавления объектов базы данных служб приложения в следующей папке:
> 
> 
> C:\Windows\Microsoft.NET\Framework\v2.0.50727


После создания необходимые объекты базы данных, необходимо изменить подключение к базе данных, используемый в приложении MVC. Измените строку подключения ApplicationServices в файл веб-конфигурации (web.config), которое указывает в производственной базе данных. Например измененный в листинге 3 указывает это подключение к базе данных с именем MyProductionDB (исходная строка подключения ApplicationServices был закомментирован).

**Листинг 3 – файл Web.config**

[!code-xml[Main](authenticating-users-with-forms-authentication-vb/samples/sample3.xml)]

#### <a name="configuring-database-permissions"></a>Настройка разрешений базы данных

Если вы используете встроенную безопасность для подключения к базе данных затем необходимо будет добавить правильная учетная запись пользователя Windows в качестве имени входа к базе данных. Правильная учетная запись зависит от того, используете ли вы сервер разработки ASP.NET или IIS как веб-сервере. Соответствующую учетную запись пользователя также зависит от операционной системы.

При использовании ASP.NET Development Server (по умолчанию веб-сервер используется в Visual Studio) приложение выполняется в контексте учетной записи пользователя Windows. В этом случае необходимо добавить учетной записи пользователя Windows в качестве имени входа сервера базы данных.

Кроме того при использовании Internet Information Services затем необходимо добавить учетной записи ASPNET или учетная запись NT AUTHORITY или NETWORK SERVICE в качестве имени входа сервера базы данных. Если вы используете Windows XP, то добавления учетной записи ASPNET как имя для входа в базу данных. Если при использовании более новой операционной системы, такие как Windows Vista или Windows Server 2008, а затем добавьте учетную запись NT AUTHORITY или NETWORK SERVICE в качестве учетной записи базы данных.

Можно добавить новую учетную запись к базе данных с помощью Microsoft SQL Server Management Studio (см. рис. 9).

**Рис. 9 – Создание нового имени входа Microsoft SQL Server**

![clip_image018](authenticating-users-with-forms-authentication-vb/_static/image9.jpg)

После создания имени входа требуется, необходимо сопоставить имя входа пользователя базы данных с ролями нужную базу данных. Дважды щелкните имя входа и выберите вкладку "Сопоставление пользователей". Выберите одну или несколько ролей базы данных служб приложения. Например, чтобы проверять подлинность пользователей, необходимо включить aspnet\_членства\_BasicAccess роли базы данных. Чтобы создать новых пользователей, необходимо включить aspnet\_членства\_FullAccess роли базы данных (см. рис. 10).

**Рис. 10 – Добавление ролей базы данных служб приложений**

![clip_image020](authenticating-users-with-forms-authentication-vb/_static/image10.jpg)

#### <a name="summary"></a>Сводка

В этом руководстве вы узнали, как использовать проверку подлинности форм, при создании приложения ASP.NET MVC. Во-первых вы узнали, как для создания новых пользователей и ролей, используя средство администрирования веб-сайта. Далее вы узнали, как использовать атрибут [Authorize], чтобы запретить неавторизованным пользователям из вызова действий контроллера. Наконец вы узнали, как настроить приложение MVC для хранения пользователя и сведения о роли в рабочей базе данных.

> [!div class="step-by-step"]
> [Назад](preventing-javascript-injection-attacks-cs.md)
> [Вперед](authenticating-users-with-windows-authentication-vb.md)
