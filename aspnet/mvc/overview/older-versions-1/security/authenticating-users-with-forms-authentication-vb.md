---
uid: mvc/overview/older-versions-1/security/authenticating-users-with-forms-authentication-vb
title: Аутентификация пользователей с использованием проверки подлинности с помощью форм (VB) | Документация Майкрософт
author: microsoft
description: Узнайте, как использовать атрибут [авторизовать] для защиты определенных страниц в приложении MVC с помощью пароля. Вы также узнаете, как использовать Администрирование веб-сайтов...
ms.author: riande
ms.date: 01/27/2009
ms.assetid: 4341f5b1-6fe5-44c5-8b8a-18fa84f80177
msc.legacyurl: /mvc/overview/older-versions-1/security/authenticating-users-with-forms-authentication-vb
msc.type: authoredcontent
ms.openlocfilehash: a2c2140631d59a7f8b21aa73613a92ea5c7a91d0
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78498936"
---
# <a name="authenticating-users-with-forms-authentication-vb"></a>Проверка подлинности пользователей с помощью проверки подлинности на основе форм (VB)

по [Майкрософт](https://github.com/microsoft)

> Узнайте, как использовать атрибут [авторизовать] для защиты определенных страниц в приложении MVC с помощью пароля. Вы узнаете, как использовать средство администрирования веб-сайтов для создания пользователей и ролей и управления ими. Вы также узнаете, как настроить место хранения учетной записи пользователя и сведений о ролях.

Цель этого руководства — объяснить, как можно использовать проверку подлинности с помощью форм для защиты представлений в приложениях ASP.NET MVC. Вы узнаете, как использовать средство администрирования веб-сайтов для создания пользователей и ролей. Вы также узнаете, как предотвратить вызов действий контроллера неавторизованными пользователями. Наконец, вы узнаете, как настроить место хранения имен пользователей и паролей.

#### <a name="using-the-web-site-administration-tool"></a>Использование средства администрирования веб-сайта

Прежде чем делать что-то еще, начнем с создания некоторых пользователей и ролей. Самый простой способ создания новых пользователей и ролей — воспользоваться преимуществами средства администрирования веб-сайтов Visual Studio 2008. Это средство можно запустить, выбрав пункт меню **проект, конфигурация ASP.NET**. Кроме того, можно запустить средство администрирования веб-сайта, щелкнув значок (немного страшного) на изображении, который появляется в верхней части окна обозреватель решений (см. рис. 1).

**Рис. 1. Запуск средства администрирования веб-сайтов**

![clip_image002[4]](authenticating-users-with-forms-authentication-vb/_static/image1.jpg)

В средстве администрирования веб-сайта создайте новых пользователей и роли, выбрав вкладку Безопасность. Щелкните ссылку **создать пользователя** , чтобы создать пользователя с именем Стивен (см. рис. 2). Предоставьте пользователю Стивен любой пароль, который вам нужен (например, *секрет*).

**Рис. 2. Создание нового пользователя**

![clip_image004[4]](authenticating-users-with-forms-authentication-vb/_static/image2.jpg)

Новые роли создаются путем первого включения ролей и определения одной или нескольких ролей. Включите роли, щелкнув ссылку **включить роли** . Затем создайте роль с именем *Администраторы* , щелкнув ссылку **Создание ролей или управление ими** (см. рис. 3).

**Рис. 3. Создание новой роли**

![clip_image006[4]](authenticating-users-with-forms-authentication-vb/_static/image3.jpg)

Наконец, создайте нового пользователя с именем Светлана и свяжите Светлана с ролью Администраторы, щелкнув ссылку Создать пользователя и выбрав администраторы при создании Светлана (см. рис. 4).

**Рис. 4. Добавление пользователя к роли**

![clip_image008[4]](authenticating-users-with-forms-authentication-vb/_static/image4.jpg)

Когда все будет сказано и готово, у вас должны быть два новых пользователя с именами Стивен и Светлана. Кроме того, следует создать новую роль с именем Администраторы. Светлана является членом роли "Администраторы", а Стивен — нет.

#### <a name="requiring-authorization"></a>Обязательная авторизация

Можно потребовать проверку подлинности пользователя до того, как пользователь вызовет действие контроллера, добавив атрибут [авторизовать] к действию. Атрибут [авторизовать] можно применить к отдельному действию контроллера или применить этот атрибут ко всему классу контроллера.

Например, контроллер в листинге 1 предоставляет действие с именем Компанисекретс (). Поскольку это действие дополнено атрибутом [авторизовать], это действие не может быть вызвано, если пользователь не прошел проверку подлинности.

**Листинг 1 — Контроллерс\хомеконтроллер.ВБ**

[!code-vb[Main](authenticating-users-with-forms-authentication-vb/samples/sample1.vb)]

Если вы вызываете действие Компанисекретс (), введя URL-адрес/Хоме/компанисекретс в адресной строке браузера, и пользователь не прошел проверку подлинности, вы будете автоматически перенаправлены в представление входа (см. рис. 5).

**Рис. 5 — представление входа**

![clip_image010[4]](authenticating-users-with-forms-authentication-vb/_static/image5.jpg)

Для ввода имени пользователя и пароля можно использовать представление входа. Если вы не являетесь зарегистрированным пользователем, щелкните ссылку Register ( **зарегистрировать** ), чтобы перейти к представлению Register (см. рис. 6). Для создания новой учетной записи пользователя можно использовать представление регистрация.

**Рис. 6. представление регистров**

![clip_image012](authenticating-users-with-forms-authentication-vb/_static/image6.jpg)

После успешного входа можно увидеть представление Компанисекретс (см. рис. 7). По умолчанию вы продолжаете выполнять вход, пока не закроете окно браузера.

**Рис. 7. представление Компанисекретс**

![clip_image014](authenticating-users-with-forms-authentication-vb/_static/image7.jpg)

#### <a name="authorizing-by-user-name-or-user-role"></a>Авторизация по имени пользователя или роли пользователя

Атрибут [авторизовать] можно использовать для ограничения доступа к действию контроллера с определенным набором пользователей или определенным набором ролей пользователей. Например, измененный контроллер Home в листинге 2 содержит два новых действия с именами Стефенсекретс () и Администраторсекретс ().

**Листинг 2 — Контроллерс\хомеконтроллер.ВБ**

[!code-vb[Main](authenticating-users-with-forms-authentication-vb/samples/sample2.vb)]

Только пользователь с именем пользователя Стивен может вызвать действие Стефенсекретс (). Все остальные пользователи перенаправлены в представление входа. Свойство Users принимает разделенный запятыми список имен учетных записей пользователей.

Только пользователи с ролью "Администраторы" могут вызывать действие Администраторсекретс (). Например, поскольку Светлана является членом группы "Администраторы", она может вызвать действие Администраторсекретс (). Все остальные пользователи перенаправлены в представление входа. Свойство Roles принимает разделенный запятыми список имен ролей.

#### <a name="configuring-authentication"></a>Настройка проверки подлинности

На этом этапе может возникнуть вопрос о том, где хранятся учетная запись пользователя и роли. По умолчанию эти сведения хранятся в базе данных SQL Express (RANU) с именем ASPNETDB. mdf, расположенной в папке Application\_Data приложения MVC. Эта база данных автоматически создается платформой ASP.NET, когда вы начинаете использовать членство.

Чтобы просмотреть базу данных ASPNETDB. mdf в окне обозреватель решений, сначала необходимо выбрать проект пункт меню, Показать все файлы.

Использование базы данных SQL Express по умолчанию подходит при разработке приложения. Тем не менее, скорее всего, вы не хотите использовать базу данных ASPNETDB. mdf по умолчанию для рабочего приложения. В этом случае можно изменить место хранения данных учетной записи пользователя, выполнив следующие два действия.

1. Добавление объектов базы данных Службы приложений в рабочую базу данных. Измените строку подключения приложения, чтобы она указывала на рабочую базу данных.

Первым шагом является добавление всех необходимых объектов базы данных (таблиц и хранимых процедур) в рабочую базу данных. Самый простой способ добавить эти объекты в новую базу данных — воспользоваться преимуществами мастера установки ASP.NET SQL Server (см. рис. 8). Это средство можно запустить, открыв командную строку Visual Studio 2008 из группы программ Microsoft Visual Studio 2008 и выполнив следующую команду из командной строки:

ASPNET\_регскл

**Рис. 8 — мастер установки SQL Server ASP.NET**

![clip_image016](authenticating-users-with-forms-authentication-vb/_static/image8.jpg)

Мастер установки SQL Server ASP.NET позволяет выбрать SQL Server базу данных в сети и установить все объекты базы данных, необходимые для служб приложений ASP.NET. Сервер базы данных не должен находиться на локальном компьютере.

> [!NOTE]
> Если вы не хотите использовать мастер установки SQL Server ASP.NET, то можете найти скрипты SQL для добавления объектов базы данных служб приложений в следующую папку:
> 
> 
> C:\Windows\Microsoft.NET\Framework\v2.0.50727

После создания необходимых объектов базы данных необходимо изменить подключение к базе данных, используемое приложением MVC. Измените строку подключения ApplicationServices в файле веб-конфигурации (Web. config), чтобы она указывала на рабочую базу данных. Например, измененное соединение в листинге 3 указывает на базу данных с именем Мипродуктиондб (исходная строка подключения ApplicationServices была добавлена в комментарий).

**Листинг 3 — Web. config**

[!code-xml[Main](authenticating-users-with-forms-authentication-vb/samples/sample3.xml)]

#### <a name="configuring-database-permissions"></a>Настройка разрешений базы данных

Если для подключения к базе данных используется встроенная безопасность, необходимо добавить правильную учетную запись пользователя Windows в качестве имени входа в базу данных. Правильная учетная запись зависит от того, используется ли ASP.NET Development Server или службы IIS в качестве веб-сервера. Правильная учетная запись пользователя также зависит от операционной системы.

Если вы используете ASP.NET Development Server (веб-сервер по умолчанию, используемый в Visual Studio), приложение выполняется в контексте учетной записи пользователя Windows. В этом случае необходимо добавить учетную запись пользователя Windows в качестве имени входа сервера базы данных.

Кроме того, при использовании службы IIS необходимо добавить учетную запись ASPNET или учетную запись "центр NT/СЕТЕВая служба" в качестве имени входа сервера базы данных. Если вы используете Windows XP, добавьте учетную запись ASPNET в качестве имени входа в базу данных. Если вы используете более новую операционную систему, например Windows Vista или Windows Server 2008, добавьте учетную запись службы NT AUTHORITY или NETWORK SERVICE в качестве имени входа в базу данных.

Новую учетную запись пользователя можно добавить в базу данных с помощью Microsoft SQL Server Management Studio (см. рис. 9).

**Рис. 9. Создание нового имени входа Microsoft SQL Server**

![clip_image018](authenticating-users-with-forms-authentication-vb/_static/image9.jpg)

После создания необходимого имени входа необходимо соотнесение имени входа с пользователем базы данных с правильной ролью базы данных. Дважды щелкните имя входа и выберите вкладку Сопоставление пользователей. Выберите одну или несколько ролей базы данных служб приложений. Например, чтобы проверить подлинность пользователей, необходимо включить роль ASPNET\_Membership\_Басикакцесс базы данных. Чтобы создать новых пользователей, необходимо включить роль ASPNET\_Membership\_FullAccess базы данных (см. рис. 10).

**Рис. 10. Добавление Службы приложений ролей базы данных**

![clip_image020](authenticating-users-with-forms-authentication-vb/_static/image10.jpg)

#### <a name="summary"></a>Сводка

В этом руководстве вы узнали, как использовать проверку подлинности с помощью форм при создании приложения ASP.NET MVC. Сначала вы узнали, как создавать новых пользователей и роли, используя преимущества средства администрирования веб-сайта. Далее вы узнали, как использовать атрибут [авторизовать] для предотвращения вызова действий контроллера неавторизованными пользователями. Наконец, вы узнали, как настроить приложение MVC для хранения сведений о пользователях и ролях в рабочей базе данных.

> [!div class="step-by-step"]
> [Назад](preventing-javascript-injection-attacks-cs.md)
> [Вперед](authenticating-users-with-windows-authentication-vb.md)
