---
uid: mvc/overview/older-versions-1/security/authenticating-users-with-forms-authentication-cs
title: Аутентификация пользователей с помощью аутентификации форм (C) Документы Майкрософт
author: rick-anderson
description: Узнайте, как использовать атрибут «Авторизовать» для защиты паролем в приложении MVC. Вы узнаете, как использовать администрацию веб-сайта слишком ...
ms.author: riande
ms.date: 01/27/2009
ms.assetid: 239fd3ca-5630-4b8d-bc4b-2f906b1d3504
msc.legacyurl: /mvc/overview/older-versions-1/security/authenticating-users-with-forms-authentication-cs
msc.type: authoredcontent
ms.openlocfilehash: f14f996c0b3a438647b5d181675457735e473354
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2020
ms.locfileid: "81540978"
---
# <a name="authenticating-users-with-forms-authentication-c"></a>Проверка подлинности пользователей с помощью проверки подлинности на основе форм (C#)

[корпорацией Майкрософт](https://github.com/microsoft)

> Узнайте, как использовать атрибут «Авторизовать» для защиты паролем в приложении MVC. Вы узнаете, как использовать инструмент администрирования веб-узла для создания и управления пользователями и ролями. Вы также узнаете, как настроить, где хранится учетная запись пользователя и информация о роли.

Цель этого руководства состоит в том, чтобы объяснить, как можно использовать проверку подлинности Forms для защиты паролем в ASP.NET приложениях MVC. Вы узнаете, как использовать инструмент администрирования веб-узла для создания пользователей и ролей. Вы также узнаете, как предотвратить несанкционированные пользователи от вызывая действия контроллера. Наконец, вы узнаете, как настроить, где хранятся имена пользователей и пароли.

#### <a name="using-the-web-site-administration-tool"></a>Использование инструмента администрирования веб-сайта

Прежде чем делать что-либо еще, мы должны начать с создания некоторых пользователей и ролей. Самый простой способ создания новых пользователей и ролей, чтобы воспользоваться Visual Studio 2008 Веб-сайт администрации инструмента. Вы можете запустить этот инструмент, выбрав вариант меню **Project, ASP.NET Configuration.** Кроме того, вы можете запустить инструмент администрации веб-сайта, нажав на (несколько страшно) значок молотка удара мира, который появляется в верхней части окна Solution Explorer (см. Рисунок 1).

**Рисунок 1 - Запуск инструмента администрирования веб-сайта**

![clip_image002](authenticating-users-with-forms-authentication-cs/_static/image1.jpg)

В инструменте администрации веб-узла вы создаете новых пользователей и роли, выбирая вкладку безопасности. Нажмите на ссылку **пользователя Create** для создания нового пользователя по имени Стивен (см. рисунок 2). Предоставьте пользователю Stephen любой пароль, который вы хотите (например, *секрет).*

**Рисунок 2 - Создание нового пользователя**

![clip_image004](authenticating-users-with-forms-authentication-cs/_static/image2.jpg)

Вы создаете новые роли, сначала включив роли и определив одну или несколько ролей. Включить роли, нажав на ссылку **ролей Включить.** Затем создайте роль, названную *Администраторами,* нажав ссылку **на роли «Создать или управлять»** (см. рисунок 3).

**Рисунок 3 - Создание новой роли**

![clip_image006](authenticating-users-with-forms-authentication-cs/_static/image3.jpg)

Наконец, создайте нового пользователя по имени Салли и свяжите Салли с ролью администраторов, нажав на ссылку Create User и выбрав администраторов при создании Салли (см. рисунок 4).

**Рисунок 4 - Добавление пользователя к роли**

![clip_image008](authenticating-users-with-forms-authentication-cs/_static/image4.jpg)

Когда все сказано и сделано, вы должны иметь два новых пользователей по имени Стивен и Салли. Вы также должны иметь новую роль под названием Администраторы. Салли является членом роли администраторов и Стивен не является.

#### <a name="requiring-authorization"></a>Требование авторизации

Вы можете потребовать, чтобы пользователь был проверен до того, как пользователь выссылает действие контроллера, добавляя атрибут «Авторизовать» в действие. Вы можете применить атрибут «Authorize» к индивидуальному действию контроллера или применить этот атрибут ко всему классу контроллера.

Например, контроллер в листинге 1 предоставляет действие под названием CompanySecrets(). Поскольку это действие украшено атрибутом «Authorize», это действие не может быть вызвано, если пользователь не проверен.

**Список 1 - Контролеры-HomeController.cs**

[!code-csharp[Main](authenticating-users-with-forms-authentication-cs/samples/sample1.cs)]

Если вы вызываете действие CompanySecrets() путем ввода URL /Home/CompanySecrets в адресной строке вашего браузера, и вы не являетесь аутентифицированным пользователем, то вы будете перенаправлены на представление входа автоматически (см. рисунок 5).

**Рисунок 5 - Вид входа**

![clip_image010](authenticating-users-with-forms-authentication-cs/_static/image5.jpg)

Вы можете использовать представление Login для ввода имени пользователя и пароля. Если вы не являетесь зарегистрированным пользователем, то вы можете нажать на ссылку **регистра** для навигации по представлению Регистра (см. рисунок 6). Для создания новой учетной записи пользователя можно использовать представление Регистра.

**Рисунок 6 - Представление Регистра**

![clip_image012](authenticating-users-with-forms-authentication-cs/_static/image6.jpg)

После успешного входа в систему можно увидеть представление CompanySecrets (см. рисунок 7). По умолчанию вы будете продолжать входить в систему до тех пор, пока не закроете окно браузера.

**Рисунок 7 - Представление CompanySecrets**

![clip_image014](authenticating-users-with-forms-authentication-cs/_static/image7.jpg)

#### <a name="authorizing-by-user-name-or-user-role"></a>Авторизация по имени пользователя или роли пользователя

Вы можете использовать атрибут «Authorize», чтобы ограничить доступ к действию контроллера определенному набору пользователей или определенному набору ролей пользователей. Например, модифицированный контроллер Home в листинге 2 содержит два новых действия под названием StephenSecrets() и AdministratorSecrets().

**Список 2 - Контролеры-HomeController.cs**

[!code-csharp[Main](authenticating-users-with-forms-authentication-cs/samples/sample2.cs)]

Только пользователь с именем пользователя Стивен может вызвать действие StephenSecrets () Все остальные пользователи перенаправляются на представление входа. Свойство пользователей принимает запятую разделенный список имен учетных записей пользователя.

Только пользователи в роли Администратора могут вызывать действия AdministratorSecrets() Например, поскольку Салли является членом группы администраторов, она может вызвать действие AdministratorSecrets() . Все остальные пользователи перенаправляются на представление входа. Свойство Роли принимает запятый разделенный список имен ролей.

#### <a name="configuring-authentication"></a>Настройка аутентификации

На этом этапе может возникнуть вопрос о том, где хранится учетная запись пользователя и информация о роли. По умолчанию информация хранится в базе данных ASPNETDB.mdf( которая хранится в\_папке App Data вашего приложения MVC. Эта база данных генерируется ASP.NET инфраструктурой автоматически, когда вы начинаете использовать членство.

Для того, чтобы увидеть базу данных ASPNETDB.mdf в окне Solution Explorer, сначала необходимо выбрать вариант меню Project, показать все файлы.

При разработке приложения использование базы данных по умолчанию s-L Express является прекрасным. Однако, скорее всего, вы не захотите использовать базу данных ASPNETDB.mdf по умолчанию для производственного приложения. В этом случае вы можете изменить, где хранится информация об учетной записи пользователя, выполнив следующие два шага:

1. Добавление объектов базы данных служб приложений в базу данных производства - Изменение строки подключения приложения, чтобы указать на производственную базу данных

Первым шагом является добавление всех необходимых объектов базы данных (таблиц и сохраненных процедур) в производственную базу данных. Самый простой способ добавить эти объекты в новую базу данных — воспользоваться преимуществами ASP.NET мастером настройки сервера S'L (см. рисунок 8). Вы можете запустить этот инструмент, открыв Visual Studio 2008 Командный запрос от группы программы Microsoft Visual Studio 2008 и выполняя следующую команду из команды запроса:

aspnet\_regsql

**Рисунок 8 - Мастер ASP.NET настройки сервера S'L**

![clip_image016](authenticating-users-with-forms-authentication-cs/_static/image8.jpg)

Мастер ASP.NET настройки сервера S'L позволяет выбрать базу данных сервера S'L в вашей сети и установить все объекты базы данных, требуемые службами ASP.NET приложений. Сервер базы данных не требуется для расположения на локальной машине.

> [!NOTE] 
> 
> Если вы не хотите использовать ASP.NET мастере настройки сервера S'L, то вы можете найти скрипты для добавления объектов базы данных служб приложений в следующую папку:
> 
> > C:»Окна»Microsoft.NET-Framework-v2.0.50727

После создания необходимых объектов базы данных необходимо изменить соединение базы данных, используемое вашим приложением MVC. Измените строку подключения ApplicationServices в файле веб-конфигурации (web.config), чтобы она указала на производственную базу данных. Например, измененное соединение в листинге 3 указывает на базу данных под названием MyProductionDB (оригинальная строка подключения ApplicationServices была прокомментирована).

**Список 3 - Web.config**

[!code-xml[Main](authenticating-users-with-forms-authentication-cs/samples/sample3.xml)]

#### <a name="configuring-database-permissions"></a>Настройка разрешений на базу данных

Если вы используете Integrated Security для подключения к базе данных, то вам нужно будет добавить правильную учетную запись пользователя Windows в качестве входа в базу данных. Правильная учетная запись зависит от того, используете ли вы сервер ASP.NET развития или Интернет-информационные службы в качестве веб-сервера. Правильная учетная запись пользователя также зависит от вашей операционной системы.

Если вы используете ASP.NET Development Server (веб-сервер по умолчанию, используемый Visual Studio), то приложение выполняется в контексте вашей учетной записи пользователя Windows. В этом случае необходимо добавить учетную запись пользователя Windows в качестве входа в систему данных сервера.

Кроме того, если вы используете Информационные службы Интернета, то вам нужно добавить либо учетную запись ASPNET или NT AUTHORITY/NETWORK SERVICE в качестве входа в систему данных сервера. Если вы используете Windows XP, добавьте учетную запись ASPNET в качестве входа в базу данных. Если вы используете более позднюю операционную систему, такую как Windows Vista или Windows Server 2008, добавьте учетную запись NT AUTHORITY/NETWORK SERVICE в качестве входа в базу данных.

Вы можете добавить новую учетную запись пользователя в базу данных с помощью студии управления серверами Microsoft S'L (см. рисунок 9).

**Рисунок 9 - Создание нового входа в систему Microsoft S'L Server**

![clip_image018](authenticating-users-with-forms-authentication-cs/_static/image9.jpg)

После создания необходимого входа необходимо сопоставить логин с пользователем базы данных с правильными ролями базы данных. Дважды щелкните логин и выберите вкладку «Карта пользователя». Например, для проверки подлинности пользователей необходимо включить\_роль\_базы данных aspnet Membership BasicAccess. Для создания новых пользователей необходимо включить роль\_базы\_данных aspnet Membership FullAccess (см. рисунок 10).

**Рисунок 10 - Добавление ролей в базе данных служб приложений**

![clip_image020](authenticating-users-with-forms-authentication-cs/_static/image10.jpg)

#### <a name="summary"></a>Сводка

В этом уроке вы узнали, как использовать проверку подлинности Форм при создании приложения MVC ASP.NET. Во-первых, вы узнали, как создавать новых пользователей и роли, воспользовавшись инструментом администрирования веб-сайта. Затем вы узнали, как использовать атрибут «Authorize» для предотвращения несанкционированных пользователей от использования действий контроллера. Наконец, вы узнали, как настроить приложение MVC для хранения пользовательской и ролевой информации в производственной базе данных.

> [!div class="step-by-step"]
> [Вперед](authenticating-users-with-windows-authentication-cs.md)
