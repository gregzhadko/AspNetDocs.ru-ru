---
uid: mvc/overview/older-versions-1/security/preventing-javascript-injection-attacks-vb
title: Предотвращение атак путем внедрения кода JavaScript (VB) | Документация Майкрософт
author: StephenWalther
description: Предотвращение атак путем внедрения кода JavaScript и атак с использованием межузловых сценариев. В этом руководстве Стивен Вальтер объясняет, как можно легко отменять...
ms.author: riande
ms.date: 08/19/2008
ms.assetid: 9274a72e-34dd-4dae-8452-ed733ae71377
msc.legacyurl: /mvc/overview/older-versions-1/security/preventing-javascript-injection-attacks-vb
msc.type: authoredcontent
ms.openlocfilehash: dfe09085f26c62c566649bc6f570aa25367a0f07
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/28/2019
ms.locfileid: "74594745"
---
# <a name="preventing-javascript-injection-attacks-vb"></a>Предотвращение атак, осуществляемых путем внедрения кода JavaScript (VB)

по [Стивен Вальтер](https://github.com/StephenWalther)

[Загрузить PDF-файл](https://download.microsoft.com/download/8/4/8/84843d8d-1575-426c-bcb5-9d0c42e51416/ASPNET_MVC_Tutorial_06_VB.pdf)

> Предотвращение атак путем внедрения кода JavaScript и атак с использованием межузловых сценариев. В этом руководстве Стивен Вальтер объясняет, как можно легко отвергнуться атакам такого типа с помощью HTML-кодирования содержимого.

Цель этого руководства — объяснить, как можно предотвратить атаки путем внедрения кода JavaScript в приложения ASP.NET MVC. В этом учебнике обсуждаются два подхода к защите веб-сайта от атак путем внедрения кода JavaScript. Вы узнаете, как предотвратить атаки путем внедрения кода JavaScript путем кодирования отображаемых данных. Вы также узнаете, как предотвратить атаки путем внедрения кода JavaScript путем кодирования принимаемых данных.

## <a name="what-is-a-javascript-injection-attack"></a>Что такое атака путем внедрения кода JavaScript?

Всякий раз, когда вы принимаете ввод пользователя и повторно отображаете введенные данные, вы открываете веб-сайт для атак путем внедрения кода JavaScript. Давайте рассмотрим конкретное приложение, открытое для атак путем внедрения кода JavaScript.

Представьте, что вы создали веб-сайт отзывов клиентов (см. рис. 1). Клиенты могут посетить веб-сайт и отправить отзыв о своих впечатлениях с помощью ваших продуктов. Когда клиент отправляет свои отзывы, Отзывы повторно отображаются на странице отзывов.

[Веб-сайт отзывов пользователей ![](preventing-javascript-injection-attacks-vb/_static/image2.png)](preventing-javascript-injection-attacks-vb/_static/image1.png)

**Рис. 01**. веб-сайт отзывов пользователей ([щелкните, чтобы просмотреть изображение с полным размером](preventing-javascript-injection-attacks-vb/_static/image3.png))

На веб-сайте отзывов пользователей используется `controller`, приведенный в листинге 1. Этот `controller` содержит два действия с именами `Index()` и `Create()`.

**Листинг 1 — `HomeController.vb`**

[!code-vb[Main](preventing-javascript-injection-attacks-vb/samples/sample1.vb)]

Метод `Index()` отображает представление `Index`. Этот метод передает все предыдущие отзывы клиентов в представление `Index`, получая отзыв из базы данных (с помощью запроса LINQ to SQL).

Метод `Create()` создает новый элемент отзыва и добавляет его в базу данных. Сообщение, которое клиент вводит в форму, передается методу `Create()` в параметре message. Создается элемент обратной связи, и ему назначается свойство `Message` элемента отзыва. Элемент Feedback отправляется в базу данных с помощью вызова метода `DataContext.SubmitChanges()`. Наконец, посетитель перенаправляется обратно в представление `Index`, где отображается вся обратная связь.

Представление `Index` содержится в листинге 2.

**Листинг 2 — `Index.aspx`**

[!code-aspx[Main](preventing-javascript-injection-attacks-vb/samples/sample2.aspx)]

Представление `Index` содержит два раздела. В верхнем разделе содержится фактическая форма отзывов клиентов. Нижний раздел содержит объект for.. Каждый цикл, который проходит по всем предыдущим элементам отзывов клиентов и отображает свойства Ентридате и Message для каждого элемента отзыва.

Веб-сайт отзывов пользователей — это простой веб-сайт. К сожалению, веб-сайт открыт для атак путем внедрения кода JavaScript.

Представьте, что в форму отзывов клиентов введен следующий текст:

[!code-html[Main](preventing-javascript-injection-attacks-vb/samples/sample3.html)]

Этот текст представляет сценарий JavaScript, который отображает окно сообщения с предупреждением. После того как кто-то отправляет этот сценарий в форму обратной связи, сообщение <em>Boo!</em> будет отображаться при каждом посещении веб-сайта отзывов пользователей в будущем (см. рис. 2).

[![внедрения кода JavaScript](preventing-javascript-injection-attacks-vb/_static/image5.png)](preventing-javascript-injection-attacks-vb/_static/image4.png)

**Рис. 02**. Внедрение JavaScript ([щелкните, чтобы просмотреть изображение с полным размером](preventing-javascript-injection-attacks-vb/_static/image6.png))

Теперь ваш первоначальный ответ на атаки введения JavaScript может быть апаси. Вы можете подумать, что атаки путем внедрения кода JavaScript являются просто типом атаки *«Злоумышленник»* . Вы можете полагать, что никто не может ничего не сделать, выполнив атаку внедрения JavaScript.

К сожалению, злоумышленник может сделать некоторые действительно вредоносные вещи, внедряя JavaScript в веб-сайт. Для выполнения атаки с использованием межсайтовых сценариев (XSS) можно использовать атаку внедрения JavaScript. При атаке с помощью межсайтовых сценариев вы переберете конфиденциальную информацию о пользователе и отправляете их на другой веб-сайт.

Например, злоумышленник может использовать атаку внедрения JavaScript, чтобы украсть значения cookie-файлов браузера от других пользователей. Если конфиденциальная информация, например пароли, номера кредитных карт или номера социального страхования, хранится в файлах cookie браузера, злоумышленник может использовать атаку внедрения JavaScript для кражи этой информации. Или, если пользователь вводит конфиденциальную информацию в поле формы, содержащееся на странице, которая была скомпрометирована с помощью атаки JavaScript, злоумышленник может использовать внедренный JavaScript для получения данных формы и отправки их на другой веб-сайт.

*Будьте страх*. Проведите атаки путем внедрения кода JavaScript серьезно и защитите конфиденциальную информацию пользователя. В следующих двух разделах обсуждаются две методики, которые можно использовать для защиты приложений ASP.NET MVC от атак путем внедрения кода JavaScript.

## <a name="approach-1-html-encode-in-the-view"></a>Подход #1: кодирование HTML в представлении

Одним из простых способов предотвращения атак путем внедрения кода JavaScript является HTML-кодирование любых данных, вводимых пользователями веб-сайта при повторном отображении данных в представлении. Обновленное `Index` представление в листинге 3 соответствует этому подходу.

**Листинг 3 — `Index.aspx` (в кодировке HTML)**

[!code-aspx[Main](preventing-javascript-injection-attacks-vb/samples/sample4.aspx)]

Обратите внимание, что значение `feedback.Message` является HTML-кодированием перед отображением значения с помощью следующего кода:

[!code-aspx[Main](preventing-javascript-injection-attacks-vb/samples/sample5.aspx)]

Что означает HTML-кодирование строки? При кодировании строки в формате HTML опасные символы, такие как `<` и `>`, заменяются ссылками на HTML-сущности, такими как `&lt;` и `&gt;`. Поэтому, когда строка `<script>alert("Boo!")</script>` является HTML-кодировкой, она преобразуется в `&lt;script&gt;alert(&quot;Boo!&quot;)&lt;/script&gt;`. Закодированная строка больше не выполняется как скрипт JavaScript при интерпретации браузером. Вместо этого вы получаете страницу «безобидная» на рис. 3.

[![непораженной атакой JavaScript](preventing-javascript-injection-attacks-vb/_static/image8.png)](preventing-javascript-injection-attacks-vb/_static/image7.png)

**Рис. 03**. Неограниченная атака JavaScript ([щелкните, чтобы просмотреть изображение с полным размером](preventing-javascript-injection-attacks-vb/_static/image9.png))

Обратите внимание, что в представлении `Index` в листинге 3 только значение `feedback.Message` кодируется. Значение `feedback.EntryDate` не кодируется. Вам нужно только кодировать данные, введенные пользователем. Поскольку значение Ентридате было создано в контроллере, вам не нужно кодировать это значение в HTML.

## <a name="approach-2-html-encode-in-the-controller"></a>Подход #2: кодирование HTML в контроллере

Вместо данных кодировки HTML при отображении данных в представлении можно использовать HTML-кодирование данных непосредственно перед отправкой данных в базу данных. Этот второй подход принимается в случае `controller` в листинге 4.

**Листинг 4 — `HomeController.cs` (в кодировке HTML)**

[!code-vb[Main](preventing-javascript-injection-attacks-vb/samples/sample6.vb)]

Обратите внимание, что значение сообщения в формате HTML кодируется до отправки значения в базу данных в рамках действия `Create()`. При повторном отображении сообщения в представлении сообщение кодируется в формате HTML, а любой JavaScript, вставленный в сообщение, не выполняется.

Как правило, следует предпочесть первый подход, рассмотренный в этом учебнике, по этому второму подходу. Проблема с этим вторым подходом заключается в том, что вы подаете данные в кодировке HTML в базе данных. Иными словами, данные базы данных изменялся с забавно выглядящими символами.

Почему это плохо? Если вам когда-либо нужно отобразить данные базы данных не на странице, то возникнут проблемы. Например, вы больше не можете легко отобразить данные в Windows Forms приложении.

## <a name="summary"></a>Сводка

Цель этого руководства — пугают вас о перспективе атаки внедрения JavaScript. В этом учебнике обсуждались два подхода к защите приложений ASP.NET MVC от атак путем внедрения кода JavaScript: можно либо кодировать данные пользователя в формате HTML в представлении, либо закодировать данные в формате HTML в контроллере.

> [!div class="step-by-step"]
> [Назад](authenticating-users-with-windows-authentication-vb.md)
