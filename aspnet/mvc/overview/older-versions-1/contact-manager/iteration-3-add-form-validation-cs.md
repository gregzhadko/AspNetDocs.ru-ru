---
uid: mvc/overview/older-versions-1/contact-manager/iteration-3-add-form-validation-cs
title: 'Итерация #3 - Добавить проверку формы (C) Документы Майкрософт'
author: rick-anderson
description: В третьей итерации мы добавляем базовую проверку формы. Мы не позволяем людям подавать форму без заполнения требуемых полей формы. Мы также проверяем emai...
ms.author: riande
ms.date: 02/20/2009
ms.assetid: 51a0d175-913b-43d8-95e3-840fb96ad1a9
msc.legacyurl: /mvc/overview/older-versions-1/contact-manager/iteration-3-add-form-validation-cs
msc.type: authoredcontent
ms.openlocfilehash: c8442574d4901045f044f53ea12cd8330e8eaaa3
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2020
ms.locfileid: "81542382"
---
# <a name="iteration-3--add-form-validation-c"></a>Итерация 3. Добавление проверки форм (C#)

[корпорацией Майкрософт](https://github.com/microsoft)

[Скачать код](iteration-3-add-form-validation-cs/_static/contactmanager_3_cs1.zip)

> В третьей итерации мы добавляем базовую проверку формы. Мы не позволяем людям подавать форму без заполнения требуемых полей формы. Мы также проверяем адреса электронной почты и номера телефонов.

## <a name="building-a-contact-management-aspnet-mvc-application-c"></a>Создание приложения управления контактами ASP.NET MVC (C)

В этой серии учебников мы создаем все приложение Управления Контактами от начала до конца. Приложение Contact Manager позволяет хранить контактную информацию - имена, номера телефонов и адреса электронной почты - для списка людей.

Мы строим приложение по нескольким итерациям. С каждой итерацией мы постепенно совершенствуем приложение. Цель этого подхода с множественной итерацией состоит в том, чтобы вы могли понять причину каждого изменения.

- Итерация #1 - Создайте приложение. В первой итерации мы создаем Контакт-менеджер самым простым способом. Мы добавляем поддержку для основных операций базы данных: Создание, чтение, обновление и удаление (CRUD).

- Итерация #2 - Сделать приложение хорошо выглядеть. В этой итерации мы улучшаем внешний вид приложения, изменяя страницу по умолчанию ASP.NET MVC просмотра и каскадный стиль листа.

- Итерация #3 - Добавить проверку формы. В третьей итерации мы добавляем базовую проверку формы. Мы не позволяем людям подавать форму без заполнения требуемых полей формы. Мы также проверяем адреса электронной почты и номера телефонов.

- Итерация #4 - Сделать приложение слабо связаны. В этой четвертой итерации мы воспользуемся несколькими шаблонами проектирования программного обеспечения, чтобы упростить обслуживание и изменение приложения Contact Manager. Например, мы рефакторизуем наше приложение, чтобы использовать шаблон репозитория и шаблон инъекций зависимостей.

- Итерация #5 - Создание модульных тестов. В пятой итерации мы упрощаем обслуживание и модификацию нашего приложения путем добавления модульных тестов. Мы издеваемся над нашими классами моделей данных и строим модульные тесты для наших контроллеров и логики проверки.

- Итерация #6 - Использование тест-ориентированной разработки. В этой шестой итерации мы добавляем новую функциональность в наше приложение, написав модульные тесты сначала и написав код против модульных тестов. В этой итерации мы добавляем контактные группы.

- Итерация #7 - Добавить функциональность Ajax. В седьмой итерации мы улучшаем отзывчивость и производительность нашего приложения, добавляя поддержку Ajax.

## <a name="this-iteration"></a>Эта итерация

В этой второй итерации приложения Contact Manager мы добавляем базовую проверку формы. Мы не позволяем людям отправлять контакт без ввода значений для требуемых полей формы. Мы также проверяем номера телефонов и адреса электронной почты (см. рисунок 1).

[![Диалоговое окно New Project (Новый проект)](iteration-3-add-form-validation-cs/_static/image1.jpg)](iteration-3-add-form-validation-cs/_static/image1.png)

**Рисунок 01**: Форма с проверкой ([Нажмите, чтобы просмотреть полноразмерное изображение](iteration-3-add-form-validation-cs/_static/image2.png))

В этой итерации мы добавляем логику проверки непосредственно в действия контроллера. Как правило, это не рекомендуется добавлять проверку в приложение mVC ASP.NET. Лучшим подходом является разместив логику проверки приложения в отдельном [уровне обслуживания.](http://martinfowler.com/eaaCatalog/serviceLayer.html) В следующей итерации мы рефакторинг приложения Контакт-менеджер, чтобы сделать приложение более обслуживаемым.

В этой итерации, чтобы все было просто, мы пишем весь код проверки вручную. Вместо того, чтобы писать код проверки самостоятельно, мы могли бы воспользоваться рамкой проверки. Например, для реализации логики проверки для ASP.NET приложения MVC можно использовать блок приложения проверки корпоративной библиотеки Майкрософт (VAB). Чтобы узнать больше о блоке приложения валидации, см.:

[*http://msdn.microsoft.com/library/dd203099.aspx*](https://msdn.microsoft.com/library/dd203099.aspx)

## <a name="adding-validation-to-the-create-view"></a>Добавление проверки в представление «Создание»

Начнем с добавления логики проверки в представление «Создание». К счастью, поскольку мы создали представление Create с помощью Visual Studio, представление Create уже содержит всю необходимую логику пользовательского интерфейса для отображения сообщений проверки. Представление «Создание» содержится в листинге 1.

**Список 1 - «Просмотры»Контакты»Create.aspx**

[!code-aspx[Main](iteration-3-add-form-validation-cs/samples/sample1.aspx)]

Обратите внимание на вызов на метод помощи Html.ValidationSummary(), который появляется непосредственно над формой HTML. Если есть сообщения об ошибке проверки, то этот метод отображает сообщения проверки в списке.

Кроме того, обратите внимание на вызовы html.ValidationMessage(), которые отображаются рядом с каждым полем формы. Помощник ValidationMessage () отображает индивидуальное сообщение об ошибке проверки. В случае листинга 1 звездочка отображается при наличии ошибки проверки.

Наконец, помощник Html.TextBox() автоматически отображает класс листа Каскадного стиля, когда есть ошибка проверки, связанная с свойством, отображаемым помощником. Помощник Html.TextBox() отображает класс, названный **вхотвочным-валидация-ошибка.**

При создании нового ASP.NET приложения MVC в папке Content автоматически создается лист стиля под названием Site.css. Этот лист стиля содержит следующие определения для классов CSS, связанные с появлением сообщений об ошибках проверки:

[!code-css[Main](iteration-3-add-form-validation-cs/samples/sample2.css)]

Класс field-validation-error используется для стили вывода, отображаемого помощником Html.ValidationMessage() Класс ввода-проверки-ошибки используется для стиля текстового ящика (ввода), отображаемого помощником Html.TextBox() . Класс валидации-резюме-ошибок используется для стиля неупорядоченного списка, отображаемого помощником Html.ValidationSummary() .

> [!NOTE] 
> 
> Можно изменить классы листа стилей, описанные в этом разделе, чтобы настроить внешний вид сообщений об ошибках проверки.

## <a name="adding-validation-logic-to-the-create-action"></a>Добавление логики проверки в действие create

Сейчас в представлении «Создай» никогда не отображается сообщения об ошибке проверки, поскольку мы не написали логику для генерации любых сообщений. Для отображения сообщений об ошибке проверки необходимо добавить сообщения об ошибках в ModelState.

> [!NOTE] 
> 
> Метод UpdateModel() автоматически добавляет сообщения об ошибках в ModelState при ошибке, присваивав значение поля формы свойству. Например, если вы попытаетесь присвоить строку "яблоко" свойству BirthDate, которое принимает значения DateTime, метод UpdateModel() добавляет ошибку в ModelState.

Измененный метод Создания () в листинге 2 содержит новый раздел, который проверяет свойства класса Контакт до ввода нового контакта в базу данных.

**Список 2 - Контроллеры/ContactController.cs (Создание с проверкой)**

[!code-csharp[Main](iteration-3-add-form-validation-cs/samples/sample3.cs)]

Раздел проверки применяет четыре различных правила проверки:

- Свойство FirstName должно иметь длину, превышающее ноль (и оно не может состоять исключительно из пробелов)
- Свойство LastName должно иметь длину, превышающее ноль (и оно не может состоять исключительно из пробелов)
- Если свойство Телефона имеет значение (имеет длину, превышающее 0), то свойство Телефона должно соответствовать обычному выражению.
- Если свойство email имеет значение (имеет длину, превышающее 0), то свойство Email должно соответствовать обычному выражению.

При нарушении правила проверки сообщение об ошибке добавляется в ModelState с помощью метода AddModelError() . При добавлении сообщения в ModelState укажите имя свойства и текст сообщения об ошибке проверки. Это сообщение об ошибке отображается в представлении методами html.ValidationSummary() и Html.ValidationMessage() методы помощника.

После выполнения правил проверки проверяется свойство IsValid ModelState. Свойство IsValid возвращается ложно, когда любые сообщения об ошибке проверки были добавлены в ModelState. Если проверка не удается, форма Create отображается повторно с сообщениями об ошибке.

> [!NOTE] 
> 
> Я получил регулярные выражения для проверки номера телефона и адреса электронной почты из регулярного репозитория выражения на[*http://regexlib.com*](http://regexlib.com)

## <a name="adding-validation-logic-to-the-edit-action"></a>Добавление логики валидации в действие по отдействию

Действие Edit() обновляет Контакт. Действие Edit() должно выполнять точно такую же проверку, как и действие Create() Вместо дублирования одного и того же кода проверки следует рефакторировать контроллер Контакта таким образом, чтобы действия Create() и Edit() называли один и тот же метод проверки.

Измененный класс контроллера контакта содержится в листинге 3. Этот класс имеет новый метод ValidateContact(), который называется как в действиях Create() и Edit().

**Список 3 - Контролеры/КонтактКонтроллер.cs**

[!code-csharp[Main](iteration-3-add-form-validation-cs/samples/sample4.cs)]

## <a name="summary"></a>Сводка

В этой итерации мы добавили базовую проверку формы в наше приложение Contact Manager. Наша логика проверки не позволяет пользователям отправлять новый контакт или редактировать существующий контакт без предоставления значений для свойств FirstName и LastName. Кроме того, пользователи должны предоставить действительные номера телефонов и адреса электронной почты.

В этой итерации мы добавили логику проверки в наше приложение Contact Manager самым простым способом. Однако смешивание нашей логики проверки в логику контроллера создаст нам проблемы в долгосрочной перспективе. Наше приложение будет более трудно поддерживать и изменять с течением времени.

В следующей итерации мы рефакторинг нашей логики проверки и логики доступа к базе данных из наших контроллеров. Мы воспользуемся несколькими принципами проектирования программного обеспечения, чтобы мы могли создать более слабое и более обслуживаемое приложение.

> [!div class="step-by-step"]
> [Назад](iteration-2-make-the-application-look-nice-cs.md)
> [Вперед](iteration-4-make-the-application-loosely-coupled-cs.md)
