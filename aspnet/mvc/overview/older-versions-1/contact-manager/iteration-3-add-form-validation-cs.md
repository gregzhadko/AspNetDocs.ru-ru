---
uid: mvc/overview/older-versions-1/contact-manager/iteration-3-add-form-validation-cs
title: '#3 итерации — Добавление проверки формыC#() | Документация Майкрософт'
author: microsoft
description: В третьей итерации мы добавим проверку базовой формы. Мы запрещаем пользователям отправлять форму, не заполняя обязательные поля формы. Мы также проверяем емаи...
ms.author: riande
ms.date: 02/20/2009
ms.assetid: 51a0d175-913b-43d8-95e3-840fb96ad1a9
msc.legacyurl: /mvc/overview/older-versions-1/contact-manager/iteration-3-add-form-validation-cs
msc.type: authoredcontent
ms.openlocfilehash: af2e86e820f60f0a3d8e3db8f78eba67ef63579a
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78437988"
---
# <a name="iteration-3--add-form-validation-c"></a>#3 итерации — Добавление проверки формыC#()

по [Майкрософт](https://github.com/microsoft)

[Скачать код](iteration-3-add-form-validation-cs/_static/contactmanager_3_cs1.zip)

> В третьей итерации мы добавим проверку базовой формы. Мы запрещаем пользователям отправлять форму, не заполняя обязательные поля формы. Мы также проверяем адреса электронной почты и номера телефонов.

## <a name="building-a-contact-management-aspnet-mvc-application-c"></a>Создание приложения для управления контактами ASP.NET MVCC#()

В этой серии учебников мы создадим все приложение управления контактами от начала до конца. Приложение диспетчера контактов позволяет хранить контактные данные, имена телефонов и адреса электронной почты. список людей.

Мы создаем приложение для нескольких итераций. При каждой итерации мы постепенно улучшаем приложение. Цель этого нескольких итераций — позволить вам понять причину каждого изменения.

- Итерация #1 — Создайте приложение. В первой итерации мы создаем Диспетчер контактов проще всего. Добавлена поддержка основных операций с базой данных: создание, чтение, обновление и удаление (CRUD).

- Итерация #2 — сделайте приложение привлекательным. В этой итерации мы улучшаем внешний вид приложения путем изменения главной страницы ASP.NET представления MVC по умолчанию и каскадной таблицы стилей.

- Итерация #3 — Добавление проверки формы. В третьей итерации мы добавим проверку базовой формы. Мы запрещаем пользователям отправлять форму, не заполняя обязательные поля формы. Мы также проверяем адреса электронной почты и номера телефонов.

- Итерация #4 — сделайте приложение слабо связанным. В этой четвертой итерации мы используем преимущества нескольких шаблонов проектирования программного обеспечения, чтобы упростить обслуживание и изменение приложения Contact Manager. Например, мы выполним рефакторинг нашего приложения для использования шаблона репозитория и шаблона внедрения зависимостей.

- Итерация #5 — Создание модульных тестов. В пятой итерации мы сделаем наше приложение проще в обслуживании и изменении, добавляя модульные тесты. Мы размакетирования наши классы модели данных и создаем модульные тесты для наших контроллеров и логики проверки.

- Итерация #6 — Используйте разработку на основе тестирования. В этой шестой итерации мы добавим новые функции в наше приложение, создав модульные тесты в первую очередь и записав код в модульные тесты. В этой итерации мы добавляем группы контактов.

- Итерация #7 — Добавление функциональности AJAX. В седьмой итерации мы улучшаем скорость реагирования и производительность нашего приложения, добавив поддержку AJAX.

## <a name="this-iteration"></a>Эта итерация

Во второй итерации приложения диспетчера контактов мы добавили обычную проверку форм. Мы запрещаем пользователям отправлять контакт, не вводя значения обязательных полей формы. Мы также проверяем номера телефонов и адреса электронной почты (см. рис. 1).

[![диалоговом окне «Создание проекта»](iteration-3-add-form-validation-cs/_static/image1.jpg)](iteration-3-add-form-validation-cs/_static/image1.png)

**Рис. 01**. форма с проверкой ([щелкните, чтобы просмотреть изображение с полным размером](iteration-3-add-form-validation-cs/_static/image2.png))

В этой итерации мы добавляем логику проверки непосредственно к действиям контроллера. Как правило, это не рекомендуемый способ добавления проверки в приложение ASP.NET MVC. Лучшим подходом является размещение логики проверки приложения в отдельном [слое служб](http://martinfowler.com/eaaCatalog/serviceLayer.html). В следующей итерации мы выполним рефакторинг приложения диспетчера контактов, чтобы сделать приложение более сопровождаемым.

В этой итерации, чтобы не усложнять, мы написали код проверки вручную. Вместо написания кода проверки можно воспользоваться преимуществами платформы проверки. Например, для реализации логики проверки для приложения ASP.NET MVC можно использовать блок приложения проверки корпоративных библиотек (Майкрософт) (ВАБ). Дополнительные сведения о блоке приложения проверки см. в следующих статьях:

[*http://msdn.microsoft.com/library/dd203099.aspx*](https://msdn.microsoft.com/library/dd203099.aspx)

## <a name="adding-validation-to-the-create-view"></a>Добавление проверки в представление создания

Давайте начнем с добавления логики проверки в представление Create. К счастью, поскольку мы создали представление Create с помощью Visual Studio, представление создать уже содержит всю необходимую логику пользовательского интерфейса для отображения сообщений проверки. Представление создания содержится в листинге 1.

**Листинг 1. \Виевс\контакт\креате.аспкс**

[!code-aspx[Main](iteration-3-add-form-validation-cs/samples/sample1.aspx)]

Обратите внимание на вызов вспомогательного метода HTML. ValidationSummary (), который появляется непосредственно над HTML-формой. При наличии сообщений об ошибках проверки этот метод отображает сообщения проверки в маркированном списке.

Кроме того, обратите внимание на вызовы HTML. Валидатионмессаже (), которые появляются рядом с каждым полем формы. В вспомогательном приложении Валидатионмессаже () отображается отдельное сообщение об ошибке проверки. В случае листинга 1 отображается звездочка при ошибке проверки.

Наконец, вспомогательный элемент HTML. TextBox () автоматически подготавливает класс каскадной таблицы стилей при возникновении ошибки проверки, связанной со свойством, отображаемым вспомогательным приложением. Вспомогательный метод HTML. TextBox () подготавливает к просмотру класс с именем **input-Validation-Error**.

При создании нового приложения ASP.NET MVC в папке содержимого автоматически создается таблица стилей с именем site. CSS. Эта таблица стилей содержит следующие определения для классов CSS, связанные с внешним видом сообщений об ошибках проверки.

[!code-css[Main](iteration-3-add-form-validation-cs/samples/sample2.css)]

Класс "поле-Проверка-ошибка" используется для стиля выходных данных, отображаемых вспомогательным приложением HTML. Валидатионмессаже (). Класс input-Validation-Error используется для стиля текстового поля (ввода), отображаемого вспомогательным приложением HTML. TextBox (). Класс "Проверка-сводка-ошибки" используется для стиля неупорядоченного списка, отображаемого вспомогательным приложением HTML. ValidationSummary ().

> [!NOTE] 
> 
> Вы можете изменить классы таблицы стилей, описанные в этом разделе, чтобы настроить внешний вид сообщений об ошибках проверки.

## <a name="adding-validation-logic-to-the-create-action"></a>Добавление логики проверки к действию создания

Сейчас в представлении CREATE не отображаются сообщения об ошибках проверки, так как мы не написали логику для создания сообщений. Чтобы отобразить сообщения об ошибках проверки, необходимо добавить сообщения об ошибках в ModelState.

> [!NOTE] 
> 
> Метод Упдатемодел () добавляет сообщения об ошибках в ModelState автоматически при возникновении ошибки присваивания значения полю формы свойству. Например, при попытке присвоить строке "Apple" свойству ДеньРождения, которое принимает значения DateTime, метод Упдатемодел () добавляет ошибку в ModelState.

Измененный метод Create () в листинге 2 содержит новый раздел, который проверяет свойства класса Contact перед вставкой нового контакта в базу данных.

**Листинг 2. Контроллерс\контактконтроллер.КС (создание с проверкой)**

[!code-csharp[Main](iteration-3-add-form-validation-cs/samples/sample3.cs)]

Раздел Validate обеспечивает соблюдение четырех правил проверки:

- Свойство FirstName должно иметь длину больше нуля (и не может состоять только из пробелов)
- Свойство LastName должно иметь длину больше нуля (и не может состоять только из пробелов)
- Если свойство Phone имеет значение (имеет длину больше 0), свойство Phone должно соответствовать регулярному выражению.
- Если свойство электронной почты имеет значение (имеет длину больше 0), то свойство электронной почты должно соответствовать регулярному выражению.

При нарушении правила проверки в ModelState добавляется сообщение об ошибке с помощью метода Аддмоделеррор (). При добавлении сообщения в ModelState вы предоставляете имя свойства и текст сообщения об ошибке проверки. Это сообщение об ошибке выводится вспомогательными методами HTML. ValidationSummary () и HTML. Валидатионмессаже () в представлении.

После выполнения правил проверки проверяется свойство IsValid параметра ModelState. Свойство IsValid возвращает значение false, если все сообщения об ошибках проверки были добавлены в ModelState. Если проверка завершается неудачно, форма создания отображается повторно с сообщениями об ошибках.

> [!NOTE] 
> 
> Я получил регулярные выражения для проверки номера телефона и адреса электронной почты из репозитория регулярных выражений на [ *http://regexlib.com* ](http://regexlib.com)

## <a name="adding-validation-logic-to-the-edit-action"></a>Добавление логики проверки к действию изменения

Действие Edit () обновляет контакт. Действие Edit () должно выполнять точно такую же проверку, как и действие Create (). Вместо дублирования одного и того же кода проверки необходимо выполнить рефакторинг контроллера связи, чтобы оба действия Create () и Edit () вызывали один и тот же метод проверки.

Измененный класс контактного контроллера содержится в листинге 3. Этот класс содержит новый метод Валидатеконтакт (), который вызывается в действиях Create () и Edit ().

**Листинг 3. Контроллерс\контактконтроллер.КС**

[!code-csharp[Main](iteration-3-add-form-validation-cs/samples/sample4.cs)]

## <a name="summary"></a>Сводка

В этой итерации мы добавили базовую проверку форм в приложение Contact Manager. Наша логика проверки запрещает пользователям отправлять новые контакты или изменять существующие, не указывая значения свойств FirstName и LastName. Кроме того, пользователи должны предоставить допустимые номера телефонов и адреса электронной почты.

В этой итерации мы добавили логику проверки в приложение диспетчера контактов проще всего. Тем не менее, сочетание логики проверки в логике контроллера создает проблемы для нас в долгосрочной перспективе. Наше приложение будет труднее поддерживаться и изменяться со временем.

В следующей итерации мы будем выполнять рефакторинг логики проверки и логики доступа к базе данных из наших контроллеров. Мы будем использовать преимущества нескольких принципов проектирования программного обеспечения для создания более слабо связанных и более сопровождаемых приложений.

> [!div class="step-by-step"]
> [Назад](iteration-2-make-the-application-look-nice-cs.md)
> [Вперед](iteration-4-make-the-application-loosely-coupled-cs.md)
