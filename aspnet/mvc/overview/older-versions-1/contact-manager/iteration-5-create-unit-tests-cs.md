---
uid: mvc/overview/older-versions-1/contact-manager/iteration-5-create-unit-tests-cs
title: 'Итерация #5 – Создание модульных тестов (C#) | Документация Майкрософт'
author: microsoft
description: В пятой итерации мы вам наше приложение проще обслуживании и изменении путем добавления модульных тестов. Мы макетирование наших классов модели данных и создания модульных тестов для o...
ms.author: riande
ms.date: 02/20/2009
ms.assetid: 28ad8f80-b8a5-444e-b478-8b15a846060c
msc.legacyurl: /mvc/overview/older-versions-1/contact-manager/iteration-5-create-unit-tests-cs
msc.type: authoredcontent
ms.openlocfilehash: b2e96c996905bc73698d1c0b11df97d1dd366172
ms.sourcegitcommit: 289e051cc8a90e8f7127e239fda73047bde4de12
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/25/2019
ms.locfileid: "58422172"
---
<a name="iteration-5--create-unit-tests-c"></a><span data-ttu-id="1e872-104">Итерация #5 – Создание модульных тестов (C#)</span><span class="sxs-lookup"><span data-stu-id="1e872-104">Iteration #5 – Create unit tests (C#)</span></span>
====================
<span data-ttu-id="1e872-105">по [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="1e872-105">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="1e872-106">Скачать код</span><span class="sxs-lookup"><span data-stu-id="1e872-106">Download Code</span></span>](iteration-5-create-unit-tests-cs/_static/contactmanager_5_cs1.zip)

> <span data-ttu-id="1e872-107">В пятой итерации мы вам наше приложение проще обслуживании и изменении путем добавления модульных тестов.</span><span class="sxs-lookup"><span data-stu-id="1e872-107">In the fifth iteration, we make our application easier to maintain and modify by adding unit tests.</span></span> <span data-ttu-id="1e872-108">Мы макетирование наших классов модели данных и создания модульных тестов для контроллеров и логику проверки.</span><span class="sxs-lookup"><span data-stu-id="1e872-108">We mock our data model classes and build unit tests for our controllers and validation logic.</span></span>


## <a name="building-a-contact-management-aspnet-mvc-application-c"></a><span data-ttu-id="1e872-109">Создание приложения управления контактами ASP.NET MVC (C#)</span><span class="sxs-lookup"><span data-stu-id="1e872-109">Building a Contact Management ASP.NET MVC Application (C#)</span></span>

<span data-ttu-id="1e872-110">В этой серии руководств мы создаем всего приложения управления контактами от начала до конца.</span><span class="sxs-lookup"><span data-stu-id="1e872-110">In this series of tutorials, we build an entire Contact Management application from start to finish.</span></span> <span data-ttu-id="1e872-111">Приложение диспетчера контактов позволяет хранить контактные данные - имена, номера телефонов и адреса электронной почты — список людей.</span><span class="sxs-lookup"><span data-stu-id="1e872-111">The Contact Manager application enables you to store contact information - names, phone numbers and email addresses - for a list of people.</span></span>

<span data-ttu-id="1e872-112">Мы создаем приложение через несколько итераций.</span><span class="sxs-lookup"><span data-stu-id="1e872-112">We build the application over multiple iterations.</span></span> <span data-ttu-id="1e872-113">С каждой итерацией мы постепенно улучшить приложение.</span><span class="sxs-lookup"><span data-stu-id="1e872-113">With each iteration, we gradually improve the application.</span></span> <span data-ttu-id="1e872-114">Этот подход с несколькими итерации предназначена для того, чтобы можно было понять причину для каждого изменения.</span><span class="sxs-lookup"><span data-stu-id="1e872-114">The goal of this multiple iteration approach is to enable you to understand the reason for each change.</span></span>

- <span data-ttu-id="1e872-115">Итерация #1 - Создание приложения.</span><span class="sxs-lookup"><span data-stu-id="1e872-115">Iteration #1 - Create the application.</span></span> <span data-ttu-id="1e872-116">В первой итерации мы создадим Contact Manager простейшим способом невозможно.</span><span class="sxs-lookup"><span data-stu-id="1e872-116">In the first iteration, we create the Contact Manager in the simplest way possible.</span></span> <span data-ttu-id="1e872-117">Мы добавили поддержку для основных операций базы данных: Создание, чтение, обновление и удаление (CRUD).</span><span class="sxs-lookup"><span data-stu-id="1e872-117">We add support for basic database operations: Create, Read, Update, and Delete (CRUD).</span></span>

- <span data-ttu-id="1e872-118">#2 - итерация приложения красиво выглядеть.</span><span class="sxs-lookup"><span data-stu-id="1e872-118">Iteration #2 - Make the application look nice.</span></span> <span data-ttu-id="1e872-119">В этой итерации мы улучшить внешний вид приложения, изменив значение по умолчанию master страница представления ASP.NET MVC и каскадные таблицы стилей.</span><span class="sxs-lookup"><span data-stu-id="1e872-119">In this iteration, we improve the appearance of the application by modifying the default ASP.NET MVC view master page and cascading style sheet.</span></span>

- <span data-ttu-id="1e872-120">Итерации #3 - Добавление проверки форм.</span><span class="sxs-lookup"><span data-stu-id="1e872-120">Iteration #3 - Add form validation.</span></span> <span data-ttu-id="1e872-121">В третьей итерации мы добавим проверки базовой форме.</span><span class="sxs-lookup"><span data-stu-id="1e872-121">In the third iteration, we add basic form validation.</span></span> <span data-ttu-id="1e872-122">Мы запретить Отправка формы без завершения обязательные поля.</span><span class="sxs-lookup"><span data-stu-id="1e872-122">We prevent people from submitting a form without completing required form fields.</span></span> <span data-ttu-id="1e872-123">Кроме того, мы проверяем, адреса электронной почты и номера телефонов.</span><span class="sxs-lookup"><span data-stu-id="1e872-123">We also validate email addresses and phone numbers.</span></span>

- <span data-ttu-id="1e872-124">Итерация #4 - Создание слабых связей в приложении.</span><span class="sxs-lookup"><span data-stu-id="1e872-124">Iteration #4 - Make the application loosely coupled.</span></span> <span data-ttu-id="1e872-125">В этой четвертой итерации мы воспользоваться преимуществами нескольких шаблонов дизайна программного обеспечения, чтобы упростить обслуживании и изменении приложения диспетчера контактов.</span><span class="sxs-lookup"><span data-stu-id="1e872-125">In this fourth iteration, we take advantage of several software design patterns to make it easier to maintain and modify the Contact Manager application.</span></span> <span data-ttu-id="1e872-126">Например мы выполнили рефакторинг наше приложение, чтобы использовать шаблон репозитория и шаблон внедрения зависимостей.</span><span class="sxs-lookup"><span data-stu-id="1e872-126">For example, we refactor our application to use the Repository pattern and the Dependency Injection pattern.</span></span>

- <span data-ttu-id="1e872-127">Итерации #5 - Создание модульных тестов.</span><span class="sxs-lookup"><span data-stu-id="1e872-127">Iteration #5 - Create unit tests.</span></span> <span data-ttu-id="1e872-128">В пятой итерации мы вам наше приложение проще обслуживании и изменении путем добавления модульных тестов.</span><span class="sxs-lookup"><span data-stu-id="1e872-128">In the fifth iteration, we make our application easier to maintain and modify by adding unit tests.</span></span> <span data-ttu-id="1e872-129">Мы макетирование наших классов модели данных и создания модульных тестов для контроллеров и логику проверки.</span><span class="sxs-lookup"><span data-stu-id="1e872-129">We mock our data model classes and build unit tests for our controllers and validation logic.</span></span>

- <span data-ttu-id="1e872-130">Итерация #6 - использование управляемой тестами разработки.</span><span class="sxs-lookup"><span data-stu-id="1e872-130">Iteration #6 - Use test-driven development.</span></span> <span data-ttu-id="1e872-131">В этой шестой итерации мы добавляем новые функциональные возможности в наше приложение, сначала написание модульных тестов и написании кода в отношении модульные тесты.</span><span class="sxs-lookup"><span data-stu-id="1e872-131">In this sixth iteration, we add new functionality to our application by writing unit tests first and writing code against the unit tests.</span></span> <span data-ttu-id="1e872-132">В этой итерации мы добавляем групп контактов.</span><span class="sxs-lookup"><span data-stu-id="1e872-132">In this iteration, we add contact groups.</span></span>

- <span data-ttu-id="1e872-133">Итерации #7 - Добавление функций Ajax.</span><span class="sxs-lookup"><span data-stu-id="1e872-133">Iteration #7 - Add Ajax functionality.</span></span> <span data-ttu-id="1e872-134">В седьмой итерации мы повысить скорость реагирования и производительность приложения, добавляя поддержку Ajax.</span><span class="sxs-lookup"><span data-stu-id="1e872-134">In the seventh iteration, we improve the responsiveness and performance of our application by adding support for Ajax.</span></span>


## <a name="this-iteration"></a><span data-ttu-id="1e872-135">Эта итерация</span><span class="sxs-lookup"><span data-stu-id="1e872-135">This Iteration</span></span>

<span data-ttu-id="1e872-136">В предыдущих итерациях приложения диспетчера контактов мы оптимизировали обеспечивать более слабую связь компонентов приложения.</span><span class="sxs-lookup"><span data-stu-id="1e872-136">In the previous iteration of the Contact Manager application, we refactored the application to be more loosely coupled.</span></span> <span data-ttu-id="1e872-137">Мы запятыми приложение в различных контроллера, службы и репозитория слои.</span><span class="sxs-lookup"><span data-stu-id="1e872-137">We separated the application into distinct controller, service, and repository layers.</span></span> <span data-ttu-id="1e872-138">Каждый уровень взаимодействует с уровня под ним через интерфейсы.</span><span class="sxs-lookup"><span data-stu-id="1e872-138">Each layer interacts with the layer beneath it through interfaces.</span></span>

<span data-ttu-id="1e872-139">Мы оптимизировали приложение, чтобы сделать приложение проще обслуживать и изменить.</span><span class="sxs-lookup"><span data-stu-id="1e872-139">We refactored the application to make the application easier to maintain and modify.</span></span> <span data-ttu-id="1e872-140">Например если нам нужно использовать новые технологии доступа к данным, мы может просто изменить уровня репозитория не изменяя при этом контроллер или уровня службы.</span><span class="sxs-lookup"><span data-stu-id="1e872-140">For example, if we need to use a new data access technology, we can simply change the repository layer without touching the controller or service layer.</span></span> <span data-ttu-id="1e872-141">Сделав в диспетчере контактов слабо связанный, мы ve сделал приложение более устойчивым к изменить.</span><span class="sxs-lookup"><span data-stu-id="1e872-141">By making the Contact Manager loosely coupled, we ve made the application more resilient to change.</span></span>

<span data-ttu-id="1e872-142">Но что произойдет, если нам нужно добавить новый компонент в приложение диспетчера контактов?</span><span class="sxs-lookup"><span data-stu-id="1e872-142">But, what happens when we need to add a new feature to the Contact Manager application?</span></span> <span data-ttu-id="1e872-143">Или, что происходит, когда мы исправления ошибки?</span><span class="sxs-lookup"><span data-stu-id="1e872-143">Or, what happens when we fix a bug?</span></span> <span data-ttu-id="1e872-144">Жаль, что, но хорошо проверенных суть написания кода является то, что каждый раз, когда touch кода, создать риск появления новых ошибок.</span><span class="sxs-lookup"><span data-stu-id="1e872-144">A sad, but well proven, truth of writing code is that whenever you touch code you create the risk of introducing new bugs.</span></span>

<span data-ttu-id="1e872-145">Например один день нормально, ваш руководитель вас могут попросить добавить новый компонент в диспетчере контактов.</span><span class="sxs-lookup"><span data-stu-id="1e872-145">For example, one fine day, your manager might ask you to add a new feature to the Contact Manager.</span></span> <span data-ttu-id="1e872-146">Она хочет, чтобы добавить поддержку для группы контактов.</span><span class="sxs-lookup"><span data-stu-id="1e872-146">She wants you to add support for Contact Groups.</span></span> <span data-ttu-id="1e872-147">Она хочет, чтобы пользователи могли выполнять разбиение контакты по группам друзей, бизнес-требования, и т. д.</span><span class="sxs-lookup"><span data-stu-id="1e872-147">She wants you to enable users to organize their contacts into groups such as Friends, Business, and so on.</span></span>

<span data-ttu-id="1e872-148">Чтобы реализовать эту новую функцию, необходимо изменить все три уровня приложения диспетчера контактов.</span><span class="sxs-lookup"><span data-stu-id="1e872-148">In order to implement this new feature, you'll need to modify all three layers of the Contact Manager application.</span></span> <span data-ttu-id="1e872-149">Необходимо расширить функциональные возможности контроллеров, уровень служб и хранилище.</span><span class="sxs-lookup"><span data-stu-id="1e872-149">You'll need to add new functionality to the controllers, the service layer, and the repository.</span></span> <span data-ttu-id="1e872-150">Сразу же начать изменять код, вы рискуете нарушений функциональности, работали.</span><span class="sxs-lookup"><span data-stu-id="1e872-150">As soon as you start modifying code, you risk breaking functionality that worked before.</span></span>

<span data-ttu-id="1e872-151">Рефакторинг наше приложение в отдельные слои, как мы делали в предыдущих итерациях, был хорошо.</span><span class="sxs-lookup"><span data-stu-id="1e872-151">Refactoring our application into separate layers, as we did in the previous iteration, was a good thing.</span></span> <span data-ttu-id="1e872-152">Было хорошо, так как она позволяет вносить изменения в всей слои без затрагивания остальной его части приложения.</span><span class="sxs-lookup"><span data-stu-id="1e872-152">It was a good thing because it enables us to make changes to entire layers without touching the rest of the application.</span></span> <span data-ttu-id="1e872-153">Тем не менее если вы хотите сделать проще в обслуживании и изменять код в пределах слоя, необходимо создать модульные тесты для кода.</span><span class="sxs-lookup"><span data-stu-id="1e872-153">However, if you want to make the code within a layer easier to maintain and modify, you need to create unit tests for the code.</span></span>

<span data-ttu-id="1e872-154">Использовании модульного теста для тестирования отдельный блок кода.</span><span class="sxs-lookup"><span data-stu-id="1e872-154">You use a unit test to test an individual unit of code.</span></span> <span data-ttu-id="1e872-155">Эти блоки кода, имеют меньший размер, чем слои всего приложения.</span><span class="sxs-lookup"><span data-stu-id="1e872-155">These units of code are smaller than entire application layers.</span></span> <span data-ttu-id="1e872-156">Как правило использовании модульный тест для проверки ли конкретного метода в коде ведет себя так, предполагается, что.</span><span class="sxs-lookup"><span data-stu-id="1e872-156">Typically, you use a unit test to verify whether a particular method in your code behaves in the way that you expect.</span></span> <span data-ttu-id="1e872-157">Например вы создадите модульный тест для метода CreateContact(), предоставляемых классом ContactManagerService.</span><span class="sxs-lookup"><span data-stu-id="1e872-157">For example, you would create a unit test for the CreateContact() method exposed by the ContactManagerService class.</span></span>

<span data-ttu-id="1e872-158">Модульные тесты на работу приложения, так же, как средство подстраховки.</span><span class="sxs-lookup"><span data-stu-id="1e872-158">The unit tests for an application work just like a safety net.</span></span> <span data-ttu-id="1e872-159">При каждом изменении кода в приложении, можно выполнить набор модульных тестов, чтобы проверить, прерывается ли изменение выполнение существующие функциональные возможности.</span><span class="sxs-lookup"><span data-stu-id="1e872-159">Whenever you modify code in an application, you can run a set of unit tests to check whether the modification breaks existing functionality.</span></span> <span data-ttu-id="1e872-160">Модульные тесты сделать безопасно изменять код.</span><span class="sxs-lookup"><span data-stu-id="1e872-160">Unit tests make your code safe to modify.</span></span> <span data-ttu-id="1e872-161">Модульные тесты весь код в приложении повысить сопротивляемость для изменения.</span><span class="sxs-lookup"><span data-stu-id="1e872-161">Unit tests make all of the code in your application more resilient to change.</span></span>

<span data-ttu-id="1e872-162">В этой итерации мы добавляем модульные тесты в наше приложение диспетчера контактов.</span><span class="sxs-lookup"><span data-stu-id="1e872-162">In this iteration, we add unit tests to our Contact Manager application.</span></span> <span data-ttu-id="1e872-163">Таким образом, в следующей итерации, можно добавить группы контактов для нашего приложения, не беспокоясь о нарушить имеющуюся функциональность.</span><span class="sxs-lookup"><span data-stu-id="1e872-163">That way, in the next iteration, we can add Contact Groups to our application without worrying about breaking existing functionality.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="1e872-164">Существуют различные платформы, включая NUnit и xUnit.net, MbUnit модульного тестирования.</span><span class="sxs-lookup"><span data-stu-id="1e872-164">There are a variety of unit testing frameworks including NUnit, xUnit.net, and MbUnit.</span></span> <span data-ttu-id="1e872-165">В этом руководстве мы используем модульного тестирования в состав Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="1e872-165">In this tutorial, we use the unit testing framework included with Visual Studio.</span></span> <span data-ttu-id="1e872-166">Тем не менее можно легко использовать один из этих альтернативных платформ.</span><span class="sxs-lookup"><span data-stu-id="1e872-166">However, you could just as easily use one of these alternative frameworks.</span></span>


## <a name="what-gets-tested"></a><span data-ttu-id="1e872-167">Что возвращает протестированы</span><span class="sxs-lookup"><span data-stu-id="1e872-167">What Gets Tested</span></span>

<span data-ttu-id="1e872-168">В идеальном мире весь код должен быть охвачен модульными тестами.</span><span class="sxs-lookup"><span data-stu-id="1e872-168">In the perfect world, all of your code would be covered by unit tests.</span></span> <span data-ttu-id="1e872-169">В идеальном мире вы бы идеальное средство подстраховки.</span><span class="sxs-lookup"><span data-stu-id="1e872-169">In the perfect world, you would have the perfect safety net.</span></span> <span data-ttu-id="1e872-170">Будет возможность изменять любую строку кода в приложении и сразу же узнавать, выполнив модульные тесты, ли изменение привело к нарушению существующие функциональные возможности.</span><span class="sxs-lookup"><span data-stu-id="1e872-170">You would be able to modify any line of code in your application and know instantly, by executing your unit tests, whether the change broke existing functionality.</span></span>

<span data-ttu-id="1e872-171">Тем не менее мы кое t реальном времени, в идеальном мире.</span><span class="sxs-lookup"><span data-stu-id="1e872-171">However, we don t live in a perfect world.</span></span> <span data-ttu-id="1e872-172">На практике, при написании модульных тестов вы сосредоточиться на написании тестов для бизнес-логики (например, логика проверки).</span><span class="sxs-lookup"><span data-stu-id="1e872-172">In practice, when writing unit tests, you concentrate on writing tests for your business logic (for example, validation logic).</span></span> <span data-ttu-id="1e872-173">В частности вы *не* написание модульных тестов данных доступ к логику или логику представления.</span><span class="sxs-lookup"><span data-stu-id="1e872-173">In particular, you *do not* write unit tests for your data access logic or your view logic.</span></span>

<span data-ttu-id="1e872-174">Чтобы быть полезным, модульные тесты должны выполняться очень быстро.</span><span class="sxs-lookup"><span data-stu-id="1e872-174">To be useful, unit tests must execute very quickly.</span></span> <span data-ttu-id="1e872-175">Можно легко накапливать сотни или даже тысяч модульных тестов для приложения.</span><span class="sxs-lookup"><span data-stu-id="1e872-175">You easily can accumulate hundreds (or even thousands) of unit tests for an application.</span></span> <span data-ttu-id="1e872-176">Если модульные тесты занять много времени для запуска, а затем, чтобы избежать их выполнения.</span><span class="sxs-lookup"><span data-stu-id="1e872-176">If the unit tests take a long time to run then you'll avoid executing them.</span></span> <span data-ttu-id="1e872-177">Другими словами, долго выполняющиеся модульные тесты являются бесполезными для кодирования изо дня в день.</span><span class="sxs-lookup"><span data-stu-id="1e872-177">In other words, long running unit tests are useless for day to day coding purposes.</span></span>

<span data-ttu-id="1e872-178">По этой причине вы обычно не следует создавать модульные тесты для кода, который взаимодействует с базой данных.</span><span class="sxs-lookup"><span data-stu-id="1e872-178">For this reason, you typically do not write unit tests for code that interacts with a database.</span></span> <span data-ttu-id="1e872-179">Запуске сотен модульных тестов для активной базы данных бы слишком много времени.</span><span class="sxs-lookup"><span data-stu-id="1e872-179">Running hundreds of unit tests against a live database would be too slow.</span></span> <span data-ttu-id="1e872-180">Вместо этого макетирование базы данных и написать код, который взаимодействует с базой данных макетов (мы обсудим макетирование базы данных ниже).</span><span class="sxs-lookup"><span data-stu-id="1e872-180">Instead, you mock your database and write code that interacts with the mock database (we discuss mocking a database below).</span></span>

<span data-ttu-id="1e872-181">По этой же причине вы обычно не следует создавать модульные тесты для представлений.</span><span class="sxs-lookup"><span data-stu-id="1e872-181">For a similar reason, you typically do not write unit tests for views.</span></span> <span data-ttu-id="1e872-182">Чтобы протестировать представления, необходимо развернуть веб-сервера.</span><span class="sxs-lookup"><span data-stu-id="1e872-182">In order to test a view, you must spin up a web server.</span></span> <span data-ttu-id="1e872-183">Так как вращающийся веб-сервер является сравнительно медленным процессом, создание модульных тестов для представления не рекомендуется.</span><span class="sxs-lookup"><span data-stu-id="1e872-183">Because spinning up a web server is a relatively slow process, creating unit tests for your views is not recommended.</span></span>

<span data-ttu-id="1e872-184">Если представление содержит сложная логика затем можно переместить логику в вспомогательные методы.</span><span class="sxs-lookup"><span data-stu-id="1e872-184">If your view contains complicated logic then you should consider moving the logic into Helper methods.</span></span> <span data-ttu-id="1e872-185">Можно написать модульные тесты для вспомогательных методов, которые выполняются не задействовав веб-сервера.</span><span class="sxs-lookup"><span data-stu-id="1e872-185">You can write unit tests for Helper methods that execute without spinning up a web server.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="1e872-186">Хотя написание тестов для логики доступа к данным или логики представления не является хорошей идеей, при написании модульных тестов, эти тесты может быть очень ценным при стандартных функциональных или интеграции тестов.</span><span class="sxs-lookup"><span data-stu-id="1e872-186">While writing tests for data access logic or view logic is not a good idea when writing unit tests, these tests can be very valuable when building functional or integration tests.</span></span>


> [!NOTE] 
> 
> <span data-ttu-id="1e872-187">ASP.NET MVC — это обработчик представлений Web Forms.</span><span class="sxs-lookup"><span data-stu-id="1e872-187">ASP.NET MVC is the Web Forms View Engine.</span></span> <span data-ttu-id="1e872-188">Хотя обработчик представлений Web Forms зависит от веб-сервера, могут быть другие обработчиков представлений.</span><span class="sxs-lookup"><span data-stu-id="1e872-188">While the Web Forms View Engine is dependent on a web server, other view engines might not be.</span></span>


## <a name="using-a-mock-object-framework"></a><span data-ttu-id="1e872-189">С помощью платформы макетов объектов</span><span class="sxs-lookup"><span data-stu-id="1e872-189">Using a Mock Object Framework</span></span>

<span data-ttu-id="1e872-190">При создании модульных тестов, почти всегда необходимо воспользоваться преимуществами платформы макетирование объектов.</span><span class="sxs-lookup"><span data-stu-id="1e872-190">When building unit tests, you almost always need to take advantage of a Mock Object framework.</span></span> <span data-ttu-id="1e872-191">Framework макетирование объектов позволяет создавать макеты и заглушки для классов в приложении.</span><span class="sxs-lookup"><span data-stu-id="1e872-191">A Mock Object framework enables you to create mocks and stubs for the classes in your application.</span></span>

<span data-ttu-id="1e872-192">Например вы используете платформу макетирование объектов, для создания имитационную версию класса репозитория.</span><span class="sxs-lookup"><span data-stu-id="1e872-192">For example, you can use a Mock Object framework to generate a mock version of your repository class.</span></span> <span data-ttu-id="1e872-193">Таким образом, можно использовать класс фиктивного репозитория вместо класса реальные репозитории в модульных тестах.</span><span class="sxs-lookup"><span data-stu-id="1e872-193">That way, you can use the mock repository class instead of the real repository class in your unit tests.</span></span> <span data-ttu-id="1e872-194">С помощью макета репозитория позволяет избежать выполнения кода базы данных при выполнении модульного теста.</span><span class="sxs-lookup"><span data-stu-id="1e872-194">Using the mock repository enables you to avoid executing database code when executing a unit test.</span></span>

<span data-ttu-id="1e872-195">Visual Studio включает платформу макетирование объектов.</span><span class="sxs-lookup"><span data-stu-id="1e872-195">Visual Studio does not include a Mock Object framework.</span></span> <span data-ttu-id="1e872-196">Тем не менее имеются несколько инфраструктур макетирования объект коммерческих с открытым исходным кодом для платформы .NET framework:</span><span class="sxs-lookup"><span data-stu-id="1e872-196">However, there are several commercial and open source Mock Object frameworks available for the .NET framework:</span></span>

1. <span data-ttu-id="1e872-197">MOQ - эта платформа доступна по лицензии BSD открытым исходным кодом.</span><span class="sxs-lookup"><span data-stu-id="1e872-197">Moq - This framework is available under the open source BSD license.</span></span> <span data-ttu-id="1e872-198">Вы можете скачать Moq из [ https://code.google.com/p/moq/ ](https://code.google.com/p/moq/).</span><span class="sxs-lookup"><span data-stu-id="1e872-198">You can download Moq from [https://code.google.com/p/moq/](https://code.google.com/p/moq/).</span></span>
2. <span data-ttu-id="1e872-199">Rhino Mocks — эта платформа доступна по лицензии BSD открытым исходным кодом.</span><span class="sxs-lookup"><span data-stu-id="1e872-199">Rhino Mocks - This framework is available under the open source BSD license.</span></span> <span data-ttu-id="1e872-200">Вы можете скачать Rhino Mocks из [ http://ayende.com/projects/rhino-mocks.aspx ](http://ayende.com/projects/rhino-mocks.aspx).</span><span class="sxs-lookup"><span data-stu-id="1e872-200">You can download Rhino Mocks from [http://ayende.com/projects/rhino-mocks.aspx](http://ayende.com/projects/rhino-mocks.aspx).</span></span>
3. <span data-ttu-id="1e872-201">Typemock Isolator - это коммерческих framework.</span><span class="sxs-lookup"><span data-stu-id="1e872-201">Typemock Isolator - This is a commercial framework.</span></span> <span data-ttu-id="1e872-202">Можно загрузить ознакомительную версию с [ http://www.typemock.com/ ](http://www.typemock.com/).</span><span class="sxs-lookup"><span data-stu-id="1e872-202">You can download a trial version from [http://www.typemock.com/](http://www.typemock.com/).</span></span>

<span data-ttu-id="1e872-203">В этом руководстве, я решил использовать Moq.</span><span class="sxs-lookup"><span data-stu-id="1e872-203">In this tutorial, I decided to use Moq.</span></span> <span data-ttu-id="1e872-204">Тем не менее можно просто использовать Rhino Mocks, или Typemock Isolator, чтобы создать макет объектов для приложения диспетчера контактов.</span><span class="sxs-lookup"><span data-stu-id="1e872-204">However, you could just as easily use Rhino Mocks or Typemock Isolator to create the Mock objects for the Contact Manager application.</span></span>

<span data-ttu-id="1e872-205">Перед использованием Moq, необходимо выполнить следующие действия:</span><span class="sxs-lookup"><span data-stu-id="1e872-205">Before you can use Moq, you need to complete the following steps:</span></span>

1. <span data-ttu-id="1e872-206">.</span><span class="sxs-lookup"><span data-stu-id="1e872-206">.</span></span>
2. <span data-ttu-id="1e872-207">Прежде чем распаковать его загрузки, убедитесь в том, щелкните правой кнопкой мыши файл и нажмите кнопку **Unblock** (см. рис. 1).</span><span class="sxs-lookup"><span data-stu-id="1e872-207">Before you unzip the download, make sure that you right-click the file and click the button labeled **Unblock** (see Figure 1).</span></span>
3. <span data-ttu-id="1e872-208">Распакуйте загрузки.</span><span class="sxs-lookup"><span data-stu-id="1e872-208">Unzip the download.</span></span>
4. <span data-ttu-id="1e872-209">Добавьте ссылку на сборку Moq, щелкнув правой кнопкой мыши папку ссылок в проекте ContactManager.Tests и выбрав **добавить ссылку**.</span><span class="sxs-lookup"><span data-stu-id="1e872-209">Add a reference to the Moq assembly by right-clicking the References folder in the ContactManager.Tests project and selecting **Add Reference**.</span></span> <span data-ttu-id="1e872-210">На вкладке обзора перейдите к папке, куда было распаковано Moq и выберите сборку Moq.dll.</span><span class="sxs-lookup"><span data-stu-id="1e872-210">Under the Browse tab, browse to the folder where you unzipped Moq and select the Moq.dll assembly.</span></span> <span data-ttu-id="1e872-211">Нажмите кнопку **ОК** кнопки.</span><span class="sxs-lookup"><span data-stu-id="1e872-211">Click the **OK** button.</span></span>
5. <span data-ttu-id="1e872-212">После выполнения этих действий, в папке "ссылки" должно выглядеть как на рис. 2.</span><span class="sxs-lookup"><span data-stu-id="1e872-212">After you complete these steps, your References folder should look like Figure 2.</span></span>


<span data-ttu-id="1e872-213">[![Разблокировка Moq](iteration-5-create-unit-tests-cs/_static/image1.jpg)](iteration-5-create-unit-tests-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="1e872-213">[![Unblocking Moq](iteration-5-create-unit-tests-cs/_static/image1.jpg)](iteration-5-create-unit-tests-cs/_static/image1.png)</span></span>

<span data-ttu-id="1e872-214">**Рис 01**: Разблокировка Moq ([Просмотр полноразмерного изображения](iteration-5-create-unit-tests-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="1e872-214">**Figure 01**: Unblocking Moq([Click to view full-size image](iteration-5-create-unit-tests-cs/_static/image2.png))</span></span>


<span data-ttu-id="1e872-215">[![Ссылки после добавления Moq](iteration-5-create-unit-tests-cs/_static/image2.jpg)](iteration-5-create-unit-tests-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="1e872-215">[![References after adding Moq](iteration-5-create-unit-tests-cs/_static/image2.jpg)](iteration-5-create-unit-tests-cs/_static/image3.png)</span></span>

<span data-ttu-id="1e872-216">**Рис. 02**: Ссылки после добавления Moq ([Просмотр полноразмерного изображения](iteration-5-create-unit-tests-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="1e872-216">**Figure 02**: References after adding Moq([Click to view full-size image](iteration-5-create-unit-tests-cs/_static/image4.png))</span></span>


## <a name="creating-unit-tests-for-the-service-layer"></a><span data-ttu-id="1e872-217">Создание модульных тестов для уровня службы</span><span class="sxs-lookup"><span data-stu-id="1e872-217">Creating Unit Tests for the Service Layer</span></span>

<span data-ttu-id="1e872-218">Позвольте s начните с создания набора модульных тестов для наших Contact Manager s уровень прикладного сервиса.</span><span class="sxs-lookup"><span data-stu-id="1e872-218">Let s start by creating a set of unit tests for our Contact Manager application s service layer.</span></span> <span data-ttu-id="1e872-219">Мы будем использовать эти тесты, чтобы проверить логику проверки.</span><span class="sxs-lookup"><span data-stu-id="1e872-219">We'll use these tests to verify our validation logic.</span></span>

<span data-ttu-id="1e872-220">Создайте новую папку с именем моделей в проекте ContactManager.Tests.</span><span class="sxs-lookup"><span data-stu-id="1e872-220">Create a new folder named Models in the ContactManager.Tests project.</span></span> <span data-ttu-id="1e872-221">Затем щелкните папку Models правой кнопкой мыши и выберите **Add, новый тест**.</span><span class="sxs-lookup"><span data-stu-id="1e872-221">Next, right-click the Models folder and select **Add, New Test**.</span></span> <span data-ttu-id="1e872-222">**Добавление нового теста** появляется диалоговое окно, показанное на рис. 3.</span><span class="sxs-lookup"><span data-stu-id="1e872-222">The **Add New Test** dialog shown in Figure 3 appears.</span></span> <span data-ttu-id="1e872-223">Выберите **модульного теста** шаблона и назовите новый тест ContactManagerServiceTest.cs.</span><span class="sxs-lookup"><span data-stu-id="1e872-223">Select the **Unit Test** template and name your new test ContactManagerServiceTest.cs.</span></span> <span data-ttu-id="1e872-224">Нажмите кнопку **ОК** кнопку, чтобы добавить в проект тестирования нового теста.</span><span class="sxs-lookup"><span data-stu-id="1e872-224">Click the **OK** button to add your new test to your Test Project.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="1e872-225">Как правило требуется структура папок проекта теста в соответствии со структурой папок проекта ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="1e872-225">In general, you want the folder structure of your Test Project to match the folder structure of your ASP.NET MVC project.</span></span> <span data-ttu-id="1e872-226">Например вы поместите тесты контроллера в папку Controllers, тесты модели в папке моделей и так далее.</span><span class="sxs-lookup"><span data-stu-id="1e872-226">For example, you place controller tests in a Controllers folder, model tests in a Models folder, and so on.</span></span>


<span data-ttu-id="1e872-227">[![Models\ContactManagerServiceTest.cs](iteration-5-create-unit-tests-cs/_static/image3.jpg)](iteration-5-create-unit-tests-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="1e872-227">[![Models\ContactManagerServiceTest.cs](iteration-5-create-unit-tests-cs/_static/image3.jpg)](iteration-5-create-unit-tests-cs/_static/image5.png)</span></span>

<span data-ttu-id="1e872-228">**Рис 03**: Models\ContactManagerServiceTest.cs ([Просмотр полноразмерного изображения](iteration-5-create-unit-tests-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="1e872-228">**Figure 03**: Models\ContactManagerServiceTest.cs([Click to view full-size image](iteration-5-create-unit-tests-cs/_static/image6.png))</span></span>


<span data-ttu-id="1e872-229">Сначала нам нужно протестировать метод CreateContact(), предоставляемых классом ContactManagerService.</span><span class="sxs-lookup"><span data-stu-id="1e872-229">Initially, we want to test the CreateContact() method exposed by the ContactManagerService class.</span></span> <span data-ttu-id="1e872-230">Мы создадим следующие пять тестов:</span><span class="sxs-lookup"><span data-stu-id="1e872-230">We'll create the following five tests:</span></span>

- <span data-ttu-id="1e872-231">CreateContact() - тесты, CreateContact() возвращает значение true, если допустимый контакт передается в метод.</span><span class="sxs-lookup"><span data-stu-id="1e872-231">CreateContact() - Tests that CreateContact() returns the value true when a valid Contact is passed to the method.</span></span>
- <span data-ttu-id="1e872-232">CreateContactRequiredFirstName() - тесты, что сообщение об ошибке добавляется в состояние модели после контакт с отсутствует имя передается в метод CreateContact().</span><span class="sxs-lookup"><span data-stu-id="1e872-232">CreateContactRequiredFirstName() - Tests that an error message is added to model state when a Contact with a missing first name is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="1e872-233">CreateContactRequiredLastName() - тесты, что сообщение об ошибке добавляется в состояние модели после контакт с отсутствует имя последнего передается в метод CreateContact().</span><span class="sxs-lookup"><span data-stu-id="1e872-233">CreateContactRequiredLastName() - Tests that an error message is added to model state when a Contact with a missing last name is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="1e872-234">CreateContactInvalidPhone() - тесты, что сообщение об ошибке добавляется в состояние модели после контакт с недопустимыми номерами телефонов передается в метод CreateContact().</span><span class="sxs-lookup"><span data-stu-id="1e872-234">CreateContactInvalidPhone() - Tests that an error message is added to model state when a Contact with an invalid phone number is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="1e872-235">CreateContactInvalidEmail() - тесты, что сообщение об ошибке добавляется в состояние модели после контакт с адресом недопустимый адрес электронной почты передается в метод CreateContact()...</span><span class="sxs-lookup"><span data-stu-id="1e872-235">CreateContactInvalidEmail() - Tests that an error message is added to model state when a Contact with an invalid email address is passed to the CreateContact() method..</span></span>

<span data-ttu-id="1e872-236">Первый тест проверяет, что допустимый контакт не создает ошибку проверки.</span><span class="sxs-lookup"><span data-stu-id="1e872-236">The first test verifies that a valid Contact does not generate a validation error.</span></span> <span data-ttu-id="1e872-237">Остальные тесты проверьте все правила проверки.</span><span class="sxs-lookup"><span data-stu-id="1e872-237">The remaining tests check each of the validation rules.</span></span>

<span data-ttu-id="1e872-238">В листинге 1 содержится код для этих тестов.</span><span class="sxs-lookup"><span data-stu-id="1e872-238">The code for these tests is contained in Listing 1.</span></span>

<span data-ttu-id="1e872-239">**В листинге 1 - Models\ContactManagerServiceTest.cs**</span><span class="sxs-lookup"><span data-stu-id="1e872-239">**Listing 1 - Models\ContactManagerServiceTest.cs**</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample1.cs)]


<span data-ttu-id="1e872-240">Так как мы используем класс Contact в листинге 1, нам нужно добавить ссылку на Microsoft Entity Framework тестовый проект.</span><span class="sxs-lookup"><span data-stu-id="1e872-240">Because we use the Contact class in Listing 1, we need to add a reference to the Microsoft Entity Framework to our Test project.</span></span> <span data-ttu-id="1e872-241">Добавьте ссылку на сборку System.Data.Entity.</span><span class="sxs-lookup"><span data-stu-id="1e872-241">Add a reference to the System.Data.Entity assembly.</span></span>


<span data-ttu-id="1e872-242">В листинге 1 содержит метод с именем Initialize(), помеченный атрибутом [TestInitialize].</span><span class="sxs-lookup"><span data-stu-id="1e872-242">Listing 1 contains a method named Initialize() that is decorated with the [TestInitialize] attribute.</span></span> <span data-ttu-id="1e872-243">Этот метод автоматически вызывается перед выполнением каждого из модульных тестов (это называется 5 раз непосредственно перед каждым из модульных тестов).</span><span class="sxs-lookup"><span data-stu-id="1e872-243">This method is called automatically before each of the unit tests is run (it is called 5 times right before each of the unit tests).</span></span> <span data-ttu-id="1e872-244">Метод Initialize() создает макет репозитория со следующей строкой кода:</span><span class="sxs-lookup"><span data-stu-id="1e872-244">The Initialize() method creates a mock repository with the following line of code:</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample2.cs)]

<span data-ttu-id="1e872-245">Эта строка кода использует Moq платформу для создания макета репозитория с помощью интерфейса IContactManagerRepository.</span><span class="sxs-lookup"><span data-stu-id="1e872-245">This line of code uses the Moq framework to generate a mock repository from the IContactManagerRepository interface.</span></span> <span data-ttu-id="1e872-246">Вместо фактического EntityContactManagerRepository фиктивного репозитория используется для предотвращения доступа к базе данных при запуске каждого модульного теста.</span><span class="sxs-lookup"><span data-stu-id="1e872-246">The mock repository is used instead of the actual EntityContactManagerRepository to avoid accessing the database when each unit test is run.</span></span> <span data-ttu-id="1e872-247">Макет репозитория реализует методы интерфейса IContactManagerRepository, но фактически ничего делать t Дон методы.</span><span class="sxs-lookup"><span data-stu-id="1e872-247">The mock repository implements the methods of the IContactManagerRepository interface, but the methods don t actually do anything.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="1e872-248">При использовании Moq framework, нет разницы между \_mockRepository и \_mockRepository.Object.</span><span class="sxs-lookup"><span data-stu-id="1e872-248">When using the Moq framework, there is a distinction between \_mockRepository and \_mockRepository.Object.</span></span> <span data-ttu-id="1e872-249">Первое из них ссылается на макет&lt;IContactManagerRepository&gt; класс, содержащий методы для указания того, как будет вести себя фиктивного репозитория.</span><span class="sxs-lookup"><span data-stu-id="1e872-249">The former refers to the Mock&lt;IContactManagerRepository&gt; class that contains methods for specifying how the mock repository will behave.</span></span> <span data-ttu-id="1e872-250">Последнее относится к фактическое фиктивный репозиторий, который реализует интерфейс IContactManagerRepository.</span><span class="sxs-lookup"><span data-stu-id="1e872-250">The latter refers to the actual mock repository that implements the IContactManagerRepository interface.</span></span>


<span data-ttu-id="1e872-251">При создании экземпляра класса ContactManagerService, фиктивного репозитория используется в метод Initialize().</span><span class="sxs-lookup"><span data-stu-id="1e872-251">The mock repository is used in the Initialize() method when creating an instance of the ContactManagerService class.</span></span> <span data-ttu-id="1e872-252">Все отдельные модульные тесты используют данный экземпляр класса ContactManagerService.</span><span class="sxs-lookup"><span data-stu-id="1e872-252">All of the individual unit tests use this instance of the ContactManagerService class.</span></span>

<span data-ttu-id="1e872-253">В листинге 1 содержит пять методов, которые соответствуют каждому модульных тестов.</span><span class="sxs-lookup"><span data-stu-id="1e872-253">Listing 1 contains five methods that correspond to each of the unit tests.</span></span> <span data-ttu-id="1e872-254">Каждый из этих методов дополнен атрибутом [TestMethod].</span><span class="sxs-lookup"><span data-stu-id="1e872-254">Each of these methods is decorated with the [TestMethod] attribute.</span></span> <span data-ttu-id="1e872-255">При запуске модульных тестов, вызывается любой метод, который имеет этот атрибут.</span><span class="sxs-lookup"><span data-stu-id="1e872-255">When you run the unit tests, any method that has this attribute is called.</span></span> <span data-ttu-id="1e872-256">Другими словами любой метод, помеченный атрибутом [TestMethod] является модульным тестом.</span><span class="sxs-lookup"><span data-stu-id="1e872-256">In other words, any method that is decorated with the [TestMethod] attribute is a unit test.</span></span>

<span data-ttu-id="1e872-257">Первый модульный тест, с именем CreateContact(), проверяет, что вызов CreateContact() возвращает значение true, если допустимый экземпляр на класс Contact передается в метод.</span><span class="sxs-lookup"><span data-stu-id="1e872-257">The first unit test, named CreateContact(), verifies that calling CreateContact() returns the value true when a valid instance of the Contact class is passed to the method.</span></span> <span data-ttu-id="1e872-258">Тест создает экземпляр класса контакта, вызывает метод CreateContact() и проверяет, что CreateContact() возвращает значение true.</span><span class="sxs-lookup"><span data-stu-id="1e872-258">The test creates an instance of the Contact class, calls the CreateContact() method, and verifies that CreateContact() returns the value true.</span></span>

<span data-ttu-id="1e872-259">Остальные тесты убедитесь, что при вызове метода CreateContact() контакте недопустимый затем метод возвращает false и сообщение об ошибке ожидаемый проверки добавляется состояние модели.</span><span class="sxs-lookup"><span data-stu-id="1e872-259">The remaining tests verify that when the CreateContact() method is called with an invalid Contact then the method returns false and the expected validation error message is added to model state.</span></span> <span data-ttu-id="1e872-260">Например тест CreateContactRequiredFirstName() создает экземпляр класса, обратитесь в службу с пустой строкой для его свойства FirstName.</span><span class="sxs-lookup"><span data-stu-id="1e872-260">For example, the CreateContactRequiredFirstName() test creates an instance of the Contact class with an empty string for its FirstName property.</span></span> <span data-ttu-id="1e872-261">Далее CreateContact() был вызван с недопустимым контактом.</span><span class="sxs-lookup"><span data-stu-id="1e872-261">Next, the CreateContact() method is called with the invalid Contact.</span></span> <span data-ttu-id="1e872-262">Наконец можно проверить, что CreateContact() возвращает false, и что состояния модели содержит сообщение об ошибке проверки ожидаемого «требуется имя.»</span><span class="sxs-lookup"><span data-stu-id="1e872-262">Finally, the test verifies that CreateContact() returns false and that model state contains the expected validation error message "First name is required."</span></span>

<span data-ttu-id="1e872-263">Можно выполнять модульные тесты в листинге 1, выбрав параметр меню **теста выполните все тесты в решении (CTRL + R, A)**.</span><span class="sxs-lookup"><span data-stu-id="1e872-263">You can run the unit tests in Listing 1 by selecting the menu option **Test, Run, All Tests in Solution (CTRL+R, A)**.</span></span> <span data-ttu-id="1e872-264">Результаты тестов отображаются в окне результатов теста (см. рис. 4).</span><span class="sxs-lookup"><span data-stu-id="1e872-264">The results of the tests are displayed in the Test Results window (see Figure 4).</span></span>


<span data-ttu-id="1e872-265">[![Результаты теста](iteration-5-create-unit-tests-cs/_static/image4.jpg)](iteration-5-create-unit-tests-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="1e872-265">[![Test Results](iteration-5-create-unit-tests-cs/_static/image4.jpg)](iteration-5-create-unit-tests-cs/_static/image7.png)</span></span>

<span data-ttu-id="1e872-266">**Рис. 04**: Результаты теста ([Просмотр полноразмерного изображения](iteration-5-create-unit-tests-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="1e872-266">**Figure 04**: Test Results ([Click to view full-size image](iteration-5-create-unit-tests-cs/_static/image8.png))</span></span>


## <a name="creating-unit-tests-for-controllers"></a><span data-ttu-id="1e872-267">Создание модульных тестов для контроллеров</span><span class="sxs-lookup"><span data-stu-id="1e872-267">Creating Unit Tests for Controllers</span></span>

<span data-ttu-id="1e872-268">Приложение ASP.NETMVC управления потоком взаимодействия с пользователем.</span><span class="sxs-lookup"><span data-stu-id="1e872-268">ASP.NETMVC application control the flow of user interaction.</span></span> <span data-ttu-id="1e872-269">При тестировании контроллера, необходимо проверить ли контроллер возвращает правой действие результат и представления данных.</span><span class="sxs-lookup"><span data-stu-id="1e872-269">When testing a controller, you want to test whether the controller returns the right action result and view data.</span></span> <span data-ttu-id="1e872-270">Вы также можете проверить ли контроллер взаимодействует с классами модели должным образом.</span><span class="sxs-lookup"><span data-stu-id="1e872-270">You also might want to test whether a controller interacts with model classes in the manner expected.</span></span>

<span data-ttu-id="1e872-271">Например листинге 2 содержит два модульных теста для контроллера контактов Create() метод.</span><span class="sxs-lookup"><span data-stu-id="1e872-271">For example, Listing 2 contains two unit tests for the Contact controller Create() method.</span></span> <span data-ttu-id="1e872-272">Первый модульный тест проверяет, что при Create() методу передается допустимый контакт, а затем метод Create() перенаправляет действие индекса.</span><span class="sxs-lookup"><span data-stu-id="1e872-272">The first unit test verifies that when a valid Contact is passed to the Create() method then the Create() method redirects to the Index action.</span></span> <span data-ttu-id="1e872-273">Другими словами при передаче допустимый контакт, Create() метод должен вернуть RedirectToRouteResult, который представляет действие индекса.</span><span class="sxs-lookup"><span data-stu-id="1e872-273">In other words, when passed a valid Contact, the Create() method should return a RedirectToRouteResult that represents the Index action.</span></span>

<span data-ttu-id="1e872-274">Мы кое t необходимо проверить уровень служб ContactManager, когда мы тестируем на уровне контроллера.</span><span class="sxs-lookup"><span data-stu-id="1e872-274">We don t want to test the ContactManager service layer when we are testing the controller layer.</span></span> <span data-ttu-id="1e872-275">Таким образом мы макетирование слой служб в методе Initialize, следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="1e872-275">Therefore, we mock the service layer with the following code in the Initialize method:</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample3.cs)]

<span data-ttu-id="1e872-276">В модульном тесте CreateValidContact() мы выполняющие имитирование поведения вызова уровня службы CreateContact() метод со следующей строкой кода:</span><span class="sxs-lookup"><span data-stu-id="1e872-276">In the CreateValidContact() unit test, we mock the behavior of calling the service layer CreateContact() method with the following line of code:</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample4.cs)]

<span data-ttu-id="1e872-277">Эта строка кода, приводит к макетов служба ContactManager возвращают значение true, когда вызывается его метод CreateContact().</span><span class="sxs-lookup"><span data-stu-id="1e872-277">This line of code causes the mock ContactManager service to return the value true when its CreateContact() method is called.</span></span> <span data-ttu-id="1e872-278">Путем имитации слой служб, можно проверить поведение нашего контроллера без необходимости выполнения любого кода на уровне служб.</span><span class="sxs-lookup"><span data-stu-id="1e872-278">By mocking the service layer, we can test the behavior of our controller without needing to execute any code in the service layer.</span></span>

<span data-ttu-id="1e872-279">Второй модульный тест проверяет, что действие Create() возвращает представления создания, если методу передается недопустимый контакт.</span><span class="sxs-lookup"><span data-stu-id="1e872-279">The second unit test verifies that the Create() action returns the Create view when an invalid contact is passed to the method.</span></span> <span data-ttu-id="1e872-280">Мы вызывают слой служб CreateContact() метод вернет значение false с помощью следующей строки кода:</span><span class="sxs-lookup"><span data-stu-id="1e872-280">We cause the service layer CreateContact() method to return the value false with the following line of code:</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample5.cs)]

<span data-ttu-id="1e872-281">Если метод Create() ведет себя так, как ожидается, что затем она возвращает представления создания при слой служб возвращает значение false.</span><span class="sxs-lookup"><span data-stu-id="1e872-281">If the Create() method behaves as we expect then it should return the Create view when the service layer returns the value false.</span></span> <span data-ttu-id="1e872-282">Таким образом, контроллер может отобразить сообщений об ошибках проверки в представления создания, и пользователь имеет возможность устранить, недопустимые свойства контакта.</span><span class="sxs-lookup"><span data-stu-id="1e872-282">That way, the controller can display the validation error messages in the Create view and the user has a chance to correct that invalid Contact properties.</span></span>


<span data-ttu-id="1e872-283">Если вы планируете создать модульные тесты для контроллеров, необходимо вернуть имена явное представление из действий контроллера.</span><span class="sxs-lookup"><span data-stu-id="1e872-283">If you plan to build unit tests for your controllers then you need to return explicit view names from your controller actions.</span></span> <span data-ttu-id="1e872-284">Например не дают представления следующим образом:</span><span class="sxs-lookup"><span data-stu-id="1e872-284">For example, do not return a view like this:</span></span>

<span data-ttu-id="1e872-285">Return View();</span><span class="sxs-lookup"><span data-stu-id="1e872-285">return View();</span></span>

<span data-ttu-id="1e872-286">Вместо этого можно возвращайте представление следующим образом:</span><span class="sxs-lookup"><span data-stu-id="1e872-286">Instead, return the view like this:</span></span>

<span data-ttu-id="1e872-287">вернуть View("Create");</span><span class="sxs-lookup"><span data-stu-id="1e872-287">return View("Create");</span></span>

<span data-ttu-id="1e872-288">При отсутствии явной при возврате представления ViewResult.ViewName свойство возвращает пустую строку.</span><span class="sxs-lookup"><span data-stu-id="1e872-288">If you are not explicit when returning a view then the ViewResult.ViewName property returns an empty string.</span></span>


<span data-ttu-id="1e872-289">**В листинге 2 - Controllers\ContactControllerTest.cs**</span><span class="sxs-lookup"><span data-stu-id="1e872-289">**Listing 2 - Controllers\ContactControllerTest.cs**</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample6.cs)]

## <a name="summary"></a><span data-ttu-id="1e872-290">Сводка</span><span class="sxs-lookup"><span data-stu-id="1e872-290">Summary</span></span>

<span data-ttu-id="1e872-291">В этой итерации мы создали модульных тестов для нашего приложения диспетчера контактов.</span><span class="sxs-lookup"><span data-stu-id="1e872-291">In this iteration, we created unit tests for our Contact Manager application.</span></span> <span data-ttu-id="1e872-292">Мы можно выполнять эти модульные тесты в любое время, чтобы убедиться, что наше приложение по-прежнему ведет себя так, как ожидается.</span><span class="sxs-lookup"><span data-stu-id="1e872-292">We can run these unit tests at any time to verify that our application still behaves in the manner that we expect.</span></span> <span data-ttu-id="1e872-293">Модульные тесты действовать как средство подстраховки для нашего приложения, благодаря чему мы можем безопасно изменить наше приложение в будущем.</span><span class="sxs-lookup"><span data-stu-id="1e872-293">The unit tests act as a safety net for our application enabling us to safely modify our application in the future.</span></span>

<span data-ttu-id="1e872-294">Мы создали два набора модульных тестов.</span><span class="sxs-lookup"><span data-stu-id="1e872-294">We created two sets of unit tests.</span></span> <span data-ttu-id="1e872-295">Во-первых мы протестировали наша логика проверки путем создания модульных тестов для наш слой служб.</span><span class="sxs-lookup"><span data-stu-id="1e872-295">First, we tested our validation logic by creating unit tests for our service layer.</span></span> <span data-ttu-id="1e872-296">Далее мы протестировали логику потока управления путем создания модульных тестов для наших слоя контроллера.</span><span class="sxs-lookup"><span data-stu-id="1e872-296">Next, we tested our flow control logic by creating unit tests for our controller layer.</span></span> <span data-ttu-id="1e872-297">При тестировании наш слой служб, мы изолируются наши тесты наших на уровне службы из наших уровня репозитория макетирование наших уровня репозитория.</span><span class="sxs-lookup"><span data-stu-id="1e872-297">When testing our service layer, we isolated our tests for our service layer from our repository layer by mocking our repository layer.</span></span> <span data-ttu-id="1e872-298">При тестировании на уровне контроллера, мы изолированное наши тесты для наших слоя контроллера по макетирование уровня службы.</span><span class="sxs-lookup"><span data-stu-id="1e872-298">When testing the controller layer, we isolated our tests for our controller layer by mocking the service layer.</span></span>

<span data-ttu-id="1e872-299">В следующей итерации мы изменим приложение диспетчера контактов, так, чтобы она поддерживала группы контактов.</span><span class="sxs-lookup"><span data-stu-id="1e872-299">In the next iteration, we modify the Contact Manager application so that it supports Contact Groups.</span></span> <span data-ttu-id="1e872-300">Мы добавим эти новые функции в наше приложение, используя процесс разработки программного обеспечения с именем управляемой тестами разработки.</span><span class="sxs-lookup"><span data-stu-id="1e872-300">We'll add this new functionality to our application using a software design process called test-driven development.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="1e872-301">[Назад](iteration-4-make-the-application-loosely-coupled-cs.md)
> [Вперед](iteration-6-use-test-driven-development-cs.md)</span><span class="sxs-lookup"><span data-stu-id="1e872-301">[Previous](iteration-4-make-the-application-loosely-coupled-cs.md)
[Next](iteration-6-use-test-driven-development-cs.md)</span></span>
