---
uid: mvc/overview/older-versions-1/contact-manager/iteration-5-create-unit-tests-cs
title: 'Итерация #5 - Создание модульных тестов (C) Документы Майкрософт'
author: rick-anderson
description: В пятой итерации мы упрощаем обслуживание и модификацию нашего приложения путем добавления модульных тестов. Мы издеваемся над нашими классами моделей данных и строим модульные тесты для o. .
ms.author: riande
ms.date: 02/20/2009
ms.assetid: 28ad8f80-b8a5-444e-b478-8b15a846060c
msc.legacyurl: /mvc/overview/older-versions-1/contact-manager/iteration-5-create-unit-tests-cs
msc.type: authoredcontent
ms.openlocfilehash: c005a8ffc3b09c126d796f2feb74d402cb784aa2
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2020
ms.locfileid: "81542356"
---
# <a name="iteration-5--create-unit-tests-c"></a><span data-ttu-id="5f9e1-104">Итерация 5. Создание модульных тестов (C#)</span><span class="sxs-lookup"><span data-stu-id="5f9e1-104">Iteration #5 – Create unit tests (C#)</span></span>

<span data-ttu-id="5f9e1-105">[корпорацией Майкрософт](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="5f9e1-105">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="5f9e1-106">Скачать код</span><span class="sxs-lookup"><span data-stu-id="5f9e1-106">Download Code</span></span>](iteration-5-create-unit-tests-cs/_static/contactmanager_5_cs1.zip)

> <span data-ttu-id="5f9e1-107">В пятой итерации мы упрощаем обслуживание и модификацию нашего приложения путем добавления модульных тестов.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-107">In the fifth iteration, we make our application easier to maintain and modify by adding unit tests.</span></span> <span data-ttu-id="5f9e1-108">Мы издеваемся над нашими классами моделей данных и строим модульные тесты для наших контроллеров и логики проверки.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-108">We mock our data model classes and build unit tests for our controllers and validation logic.</span></span>

## <a name="building-a-contact-management-aspnet-mvc-application-c"></a><span data-ttu-id="5f9e1-109">Создание приложения управления контактами ASP.NET MVC (C)</span><span class="sxs-lookup"><span data-stu-id="5f9e1-109">Building a Contact Management ASP.NET MVC Application (C#)</span></span>

<span data-ttu-id="5f9e1-110">В этой серии учебников мы создаем все приложение Управления Контактами от начала до конца.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-110">In this series of tutorials, we build an entire Contact Management application from start to finish.</span></span> <span data-ttu-id="5f9e1-111">Приложение Contact Manager позволяет хранить контактную информацию - имена, номера телефонов и адреса электронной почты - для списка людей.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-111">The Contact Manager application enables you to store contact information - names, phone numbers and email addresses - for a list of people.</span></span>

<span data-ttu-id="5f9e1-112">Мы строим приложение по нескольким итерациям.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-112">We build the application over multiple iterations.</span></span> <span data-ttu-id="5f9e1-113">С каждой итерацией мы постепенно совершенствуем приложение.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-113">With each iteration, we gradually improve the application.</span></span> <span data-ttu-id="5f9e1-114">Цель этого подхода с множественной итерацией состоит в том, чтобы вы могли понять причину каждого изменения.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-114">The goal of this multiple iteration approach is to enable you to understand the reason for each change.</span></span>

- <span data-ttu-id="5f9e1-115">Итерация #1 - Создайте приложение.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-115">Iteration #1 - Create the application.</span></span> <span data-ttu-id="5f9e1-116">В первой итерации мы создаем Контакт-менеджер самым простым способом.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-116">In the first iteration, we create the Contact Manager in the simplest way possible.</span></span> <span data-ttu-id="5f9e1-117">Мы добавляем поддержку для основных операций базы данных: Создание, чтение, обновление и удаление (CRUD).</span><span class="sxs-lookup"><span data-stu-id="5f9e1-117">We add support for basic database operations: Create, Read, Update, and Delete (CRUD).</span></span>

- <span data-ttu-id="5f9e1-118">Итерация #2 - Сделать приложение хорошо выглядеть.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-118">Iteration #2 - Make the application look nice.</span></span> <span data-ttu-id="5f9e1-119">В этой итерации мы улучшаем внешний вид приложения, изменяя страницу по умолчанию ASP.NET MVC просмотра и каскадный стиль листа.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-119">In this iteration, we improve the appearance of the application by modifying the default ASP.NET MVC view master page and cascading style sheet.</span></span>

- <span data-ttu-id="5f9e1-120">Итерация #3 - Добавить проверку формы.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-120">Iteration #3 - Add form validation.</span></span> <span data-ttu-id="5f9e1-121">В третьей итерации мы добавляем базовую проверку формы.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-121">In the third iteration, we add basic form validation.</span></span> <span data-ttu-id="5f9e1-122">Мы не позволяем людям подавать форму без заполнения требуемых полей формы.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-122">We prevent people from submitting a form without completing required form fields.</span></span> <span data-ttu-id="5f9e1-123">Мы также проверяем адреса электронной почты и номера телефонов.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-123">We also validate email addresses and phone numbers.</span></span>

- <span data-ttu-id="5f9e1-124">Итерация #4 - Сделать приложение слабо связаны.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-124">Iteration #4 - Make the application loosely coupled.</span></span> <span data-ttu-id="5f9e1-125">В этой четвертой итерации мы воспользуемся несколькими шаблонами проектирования программного обеспечения, чтобы упростить обслуживание и изменение приложения Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-125">In this fourth iteration, we take advantage of several software design patterns to make it easier to maintain and modify the Contact Manager application.</span></span> <span data-ttu-id="5f9e1-126">Например, мы рефакторизуем наше приложение, чтобы использовать шаблон репозитория и шаблон инъекций зависимостей.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-126">For example, we refactor our application to use the Repository pattern and the Dependency Injection pattern.</span></span>

- <span data-ttu-id="5f9e1-127">Итерация #5 - Создание модульных тестов.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-127">Iteration #5 - Create unit tests.</span></span> <span data-ttu-id="5f9e1-128">В пятой итерации мы упрощаем обслуживание и модификацию нашего приложения путем добавления модульных тестов.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-128">In the fifth iteration, we make our application easier to maintain and modify by adding unit tests.</span></span> <span data-ttu-id="5f9e1-129">Мы издеваемся над нашими классами моделей данных и строим модульные тесты для наших контроллеров и логики проверки.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-129">We mock our data model classes and build unit tests for our controllers and validation logic.</span></span>

- <span data-ttu-id="5f9e1-130">Итерация #6 - Использование тест-ориентированной разработки.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-130">Iteration #6 - Use test-driven development.</span></span> <span data-ttu-id="5f9e1-131">В этой шестой итерации мы добавляем новую функциональность в наше приложение, написав модульные тесты сначала и написав код против модульных тестов.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-131">In this sixth iteration, we add new functionality to our application by writing unit tests first and writing code against the unit tests.</span></span> <span data-ttu-id="5f9e1-132">В этой итерации мы добавляем контактные группы.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-132">In this iteration, we add contact groups.</span></span>

- <span data-ttu-id="5f9e1-133">Итерация #7 - Добавить функциональность Ajax.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-133">Iteration #7 - Add Ajax functionality.</span></span> <span data-ttu-id="5f9e1-134">В седьмой итерации мы улучшаем отзывчивость и производительность нашего приложения, добавляя поддержку Ajax.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-134">In the seventh iteration, we improve the responsiveness and performance of our application by adding support for Ajax.</span></span>

## <a name="this-iteration"></a><span data-ttu-id="5f9e1-135">Эта итерация</span><span class="sxs-lookup"><span data-stu-id="5f9e1-135">This Iteration</span></span>

<span data-ttu-id="5f9e1-136">В предыдущей итерации приложения Contact Manager мы рефакторинг приложения, чтобы быть более свободно связаны.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-136">In the previous iteration of the Contact Manager application, we refactored the application to be more loosely coupled.</span></span> <span data-ttu-id="5f9e1-137">Мы разделили приложение на отдельные слои контроллера, обслуживания и репозитория.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-137">We separated the application into distinct controller, service, and repository layers.</span></span> <span data-ttu-id="5f9e1-138">Каждый слой взаимодействует с слоем под ним через интерфейсы.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-138">Each layer interacts with the layer beneath it through interfaces.</span></span>

<span data-ttu-id="5f9e1-139">Мы рефакторинг приложения, чтобы сделать приложение проще в обслуживании и изменении.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-139">We refactored the application to make the application easier to maintain and modify.</span></span> <span data-ttu-id="5f9e1-140">Например, если нам необходимо использовать новую технологию доступа к данным, мы можем просто изменить слой репозитория, не касаясь контроллера или такого слоя.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-140">For example, if we need to use a new data access technology, we can simply change the repository layer without touching the controller or service layer.</span></span> <span data-ttu-id="5f9e1-141">Делая Контакт-менеджер слабо связаны, мы сделали приложение более устойчивым к изменениям.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-141">By making the Contact Manager loosely coupled, we ve made the application more resilient to change.</span></span>

<span data-ttu-id="5f9e1-142">Но что происходит, когда нам нужно добавить новую функцию в приложение Contact Manager?</span><span class="sxs-lookup"><span data-stu-id="5f9e1-142">But, what happens when we need to add a new feature to the Contact Manager application?</span></span> <span data-ttu-id="5f9e1-143">Или, что происходит, когда мы исправляем ошибку?</span><span class="sxs-lookup"><span data-stu-id="5f9e1-143">Or, what happens when we fix a bug?</span></span> <span data-ttu-id="5f9e1-144">Грустная, но хорошо доказанная истина написания кода заключается в том, что всякий раз, когда вы касаетесь кода, вы создаете риск введения новых ошибок.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-144">A sad, but well proven, truth of writing code is that whenever you touch code you create the risk of introducing new bugs.</span></span>

<span data-ttu-id="5f9e1-145">Например, в один прекрасный день менеджер может попросить вас добавить новую функцию в Контакт-менеджер.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-145">For example, one fine day, your manager might ask you to add a new feature to the Contact Manager.</span></span> <span data-ttu-id="5f9e1-146">Она хочет, чтобы вы добавили поддержку Контактным группам.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-146">She wants you to add support for Contact Groups.</span></span> <span data-ttu-id="5f9e1-147">Она хочет, чтобы вы могли позволить пользователям организовывать свои контакты в такие группы, как Друзья, Бизнес и так далее.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-147">She wants you to enable users to organize their contacts into groups such as Friends, Business, and so on.</span></span>

<span data-ttu-id="5f9e1-148">Для реализации этой новой функции необходимо изменить все три слоя приложения Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-148">In order to implement this new feature, you'll need to modify all three layers of the Contact Manager application.</span></span> <span data-ttu-id="5f9e1-149">Необходимо добавить новую функциональность в контроллеры, уровень обслуживания и репозиторий.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-149">You'll need to add new functionality to the controllers, the service layer, and the repository.</span></span> <span data-ttu-id="5f9e1-150">Как только вы начнете изменять код, вы рискуете взломать функциональность, которая работала раньше.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-150">As soon as you start modifying code, you risk breaking functionality that worked before.</span></span>

<span data-ttu-id="5f9e1-151">Рефакторинг нашего приложения в отдельные слои, как мы это делали в предыдущей итерации, было хорошо.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-151">Refactoring our application into separate layers, as we did in the previous iteration, was a good thing.</span></span> <span data-ttu-id="5f9e1-152">Это было хорошо, потому что это позволяет нам вносить изменения в целые слои, не касаясь остальной части приложения.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-152">It was a good thing because it enables us to make changes to entire layers without touching the rest of the application.</span></span> <span data-ttu-id="5f9e1-153">Однако, если вы хотите упростить обслуживание и изменение кода в слое слоя, необходимо создать модульные тесты для кода.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-153">However, if you want to make the code within a layer easier to maintain and modify, you need to create unit tests for the code.</span></span>

<span data-ttu-id="5f9e1-154">Для тестирования отдельной единицы кода используется модульный тест.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-154">You use a unit test to test an individual unit of code.</span></span> <span data-ttu-id="5f9e1-155">Эти единицы кода меньше, чем целые слои приложений.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-155">These units of code are smaller than entire application layers.</span></span> <span data-ttu-id="5f9e1-156">Как правило, используется модульный тест для проверки того, ведет ли тот или иной метод в коде то, что вы ожидаете.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-156">Typically, you use a unit test to verify whether a particular method in your code behaves in the way that you expect.</span></span> <span data-ttu-id="5f9e1-157">Например, можно создать модульный тест для метода CreateContact(), выставленный классом ContactManagerService.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-157">For example, you would create a unit test for the CreateContact() method exposed by the ContactManagerService class.</span></span>

<span data-ttu-id="5f9e1-158">Модульные тесты для приложения работают так же, как защитная сетка.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-158">The unit tests for an application work just like a safety net.</span></span> <span data-ttu-id="5f9e1-159">Всякий раз, когда вы изменяете код в приложении, вы можете запустить набор модульных тестов, чтобы проверить, нарушает ли изменение существующую функциональность.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-159">Whenever you modify code in an application, you can run a set of unit tests to check whether the modification breaks existing functionality.</span></span> <span data-ttu-id="5f9e1-160">Единие тесты делают ваш код безопасным для изменения.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-160">Unit tests make your code safe to modify.</span></span> <span data-ttu-id="5f9e1-161">Единие тесты делают весь код в приложении более устойчивым к изменениям.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-161">Unit tests make all of the code in your application more resilient to change.</span></span>

<span data-ttu-id="5f9e1-162">В этой итерации мы добавляем модульные тесты в наше приложение Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-162">In this iteration, we add unit tests to our Contact Manager application.</span></span> <span data-ttu-id="5f9e1-163">Таким образом, в следующей итерации мы можем добавить Контактные группы в наше приложение, не беспокоясь о нарушении существующей функциональности.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-163">That way, in the next iteration, we can add Contact Groups to our application without worrying about breaking existing functionality.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="5f9e1-164">Существует множество инфраструктур модульного тестирования, включая NUnit, xUnit.net и MbUnit.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-164">There are a variety of unit testing frameworks including NUnit, xUnit.net, and MbUnit.</span></span> <span data-ttu-id="5f9e1-165">В этом учебнике мы используем платформу модульного тестирования, включенную в Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-165">In this tutorial, we use the unit testing framework included with Visual Studio.</span></span> <span data-ttu-id="5f9e1-166">Тем не менее, вы можете так же легко использовать одну из этих альтернативных инфраструктур.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-166">However, you could just as easily use one of these alternative frameworks.</span></span>

## <a name="what-gets-tested"></a><span data-ttu-id="5f9e1-167">Что проходит тестирование</span><span class="sxs-lookup"><span data-stu-id="5f9e1-167">What Gets Tested</span></span>

<span data-ttu-id="5f9e1-168">В идеальном мире весь ваш код будет покрыт модульными тестами.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-168">In the perfect world, all of your code would be covered by unit tests.</span></span> <span data-ttu-id="5f9e1-169">В идеальном мире, вы бы идеальный сетки безопасности.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-169">In the perfect world, you would have the perfect safety net.</span></span> <span data-ttu-id="5f9e1-170">Вы сможете изменить любую строку кода в приложении и мгновенно узнать, вырабатывая модульные тесты, нарушило ли изменение существующую функциональность.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-170">You would be able to modify any line of code in your application and know instantly, by executing your unit tests, whether the change broke existing functionality.</span></span>

<span data-ttu-id="5f9e1-171">Тем не менее, мы не живем в идеальном мире.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-171">However, we don t live in a perfect world.</span></span> <span data-ttu-id="5f9e1-172">На практике при написании модульных тестов вы концентрируетесь на написании тестов для бизнес-логики (например, логики проверки).</span><span class="sxs-lookup"><span data-stu-id="5f9e1-172">In practice, when writing unit tests, you concentrate on writing tests for your business logic (for example, validation logic).</span></span> <span data-ttu-id="5f9e1-173">В частности, вы *не* пишете модульные тесты для логики доступа к данным или логики представления.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-173">In particular, you *do not* write unit tests for your data access logic or your view logic.</span></span>

<span data-ttu-id="5f9e1-174">Чтобы быть полезным, модульные тесты должны выполняться очень быстро.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-174">To be useful, unit tests must execute very quickly.</span></span> <span data-ttu-id="5f9e1-175">Вы легко можете накопить сотни (или даже тысячи) модульных тестов для приложения.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-175">You easily can accumulate hundreds (or even thousands) of unit tests for an application.</span></span> <span data-ttu-id="5f9e1-176">Если модульные тесты займут много времени, то вы избежите их выполнения.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-176">If the unit tests take a long time to run then you'll avoid executing them.</span></span> <span data-ttu-id="5f9e1-177">Другими словами, длительные модульные тесты бесполезны для повседневных целей кодирования.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-177">In other words, long running unit tests are useless for day to day coding purposes.</span></span>

<span data-ttu-id="5f9e1-178">По этой причине обычно вы не пишете модульные тесты для кода, который взаимодействует с базой данных.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-178">For this reason, you typically do not write unit tests for code that interacts with a database.</span></span> <span data-ttu-id="5f9e1-179">Запуск сотен модульных тестов против живой базы данных будет слишком медленным.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-179">Running hundreds of unit tests against a live database would be too slow.</span></span> <span data-ttu-id="5f9e1-180">Вместо этого вы издеваетесь над базой данных и пишете код, который взаимодействует с базой данных макетов (мы обсуждаем насмешки над базой данных ниже).</span><span class="sxs-lookup"><span data-stu-id="5f9e1-180">Instead, you mock your database and write code that interacts with the mock database (we discuss mocking a database below).</span></span>

<span data-ttu-id="5f9e1-181">По аналогичной причине обычно не записывается модульные тесты для представлений.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-181">For a similar reason, you typically do not write unit tests for views.</span></span> <span data-ttu-id="5f9e1-182">Для проверки представления необходимо раскрутить веб-сервер.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-182">In order to test a view, you must spin up a web server.</span></span> <span data-ttu-id="5f9e1-183">Поскольку закрутка веб-сервера является относительно медленным процессом, создание модульных тестов для ваших представлений не рекомендуется.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-183">Because spinning up a web server is a relatively slow process, creating unit tests for your views is not recommended.</span></span>

<span data-ttu-id="5f9e1-184">Если представление содержит сложную логику, то следует рассмотреть вопрос о перемещении логики в методы Helper.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-184">If your view contains complicated logic then you should consider moving the logic into Helper methods.</span></span> <span data-ttu-id="5f9e1-185">Вы можете написать модульные тесты для методов Helper, которые выполняются без вращения веб-сервера.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-185">You can write unit tests for Helper methods that execute without spinning up a web server.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="5f9e1-186">При написании тестов для логики доступа к данным или логики представления не очень хорошая идея при написании модульных тестов, эти тесты могут быть очень ценными при построении функциональных или интеграционных тестов.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-186">While writing tests for data access logic or view logic is not a good idea when writing unit tests, these tests can be very valuable when building functional or integration tests.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="5f9e1-187">ASP.NET MVC — это движок представления веб-форм.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-187">ASP.NET MVC is the Web Forms View Engine.</span></span> <span data-ttu-id="5f9e1-188">В то время как Web Forms View Engine зависит от веб-сервера, другие двигатели представления могут и не быть.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-188">While the Web Forms View Engine is dependent on a web server, other view engines might not be.</span></span>

## <a name="using-a-mock-object-framework"></a><span data-ttu-id="5f9e1-189">Использование рамочной программы мок-объектов</span><span class="sxs-lookup"><span data-stu-id="5f9e1-189">Using a Mock Object Framework</span></span>

<span data-ttu-id="5f9e1-190">При создании модульных тестов почти всегда необходимо использовать фреймворк Mock Object.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-190">When building unit tests, you almost always need to take advantage of a Mock Object framework.</span></span> <span data-ttu-id="5f9e1-191">Платформа Mock Object позволяет создавать макеты и заглушки для классов в приложении.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-191">A Mock Object framework enables you to create mocks and stubs for the classes in your application.</span></span>

<span data-ttu-id="5f9e1-192">Например, можно использовать платформу Mock Object для создания макетной версии класса репозитория.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-192">For example, you can use a Mock Object framework to generate a mock version of your repository class.</span></span> <span data-ttu-id="5f9e1-193">Таким образом, вы можете использовать класс макетов репозитория вместо реального класса репозитория в модульных тестах.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-193">That way, you can use the mock repository class instead of the real repository class in your unit tests.</span></span> <span data-ttu-id="5f9e1-194">Использование макетного репозитория позволяет избежать выполнения кода базы данных при выполнения модульного теста.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-194">Using the mock repository enables you to avoid executing database code when executing a unit test.</span></span>

<span data-ttu-id="5f9e1-195">Visual Studio не включает в себя платформу Mock Object.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-195">Visual Studio does not include a Mock Object framework.</span></span> <span data-ttu-id="5f9e1-196">Однако для платформы .NET доступно несколько коммерческих и открытых исходных кодов, доступных для платформы .NET:</span><span class="sxs-lookup"><span data-stu-id="5f9e1-196">However, there are several commercial and open source Mock Object frameworks available for the .NET framework:</span></span>

1. <span data-ttu-id="5f9e1-197">Moq - Эта платформа доступна под лицензией BSD с открытым исходным кодом.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-197">Moq - This framework is available under the open source BSD license.</span></span> <span data-ttu-id="5f9e1-198">Вы можете скачать [https://code.google.com/p/moq/](https://code.google.com/p/moq/)Moq от .</span><span class="sxs-lookup"><span data-stu-id="5f9e1-198">You can download Moq from [https://code.google.com/p/moq/](https://code.google.com/p/moq/).</span></span>
2. <span data-ttu-id="5f9e1-199">Rhino Mocks - Эта платформа доступна под лицензией BSD с открытым исходным кодом.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-199">Rhino Mocks - This framework is available under the open source BSD license.</span></span> <span data-ttu-id="5f9e1-200">Вы можете скачать [http://ayende.com/projects/rhino-mocks.aspx](http://ayende.com/projects/rhino-mocks.aspx)Rhino Mocks из .</span><span class="sxs-lookup"><span data-stu-id="5f9e1-200">You can download Rhino Mocks from [http://ayende.com/projects/rhino-mocks.aspx](http://ayende.com/projects/rhino-mocks.aspx).</span></span>
3. <span data-ttu-id="5f9e1-201">Typemock Isolator - Это коммерческая структура.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-201">Typemock Isolator - This is a commercial framework.</span></span> <span data-ttu-id="5f9e1-202">Вы можете скачать [http://www.typemock.com/](http://www.typemock.com/)пробную версию из .</span><span class="sxs-lookup"><span data-stu-id="5f9e1-202">You can download a trial version from [http://www.typemock.com/](http://www.typemock.com/).</span></span>

<span data-ttu-id="5f9e1-203">В этом учебнике, я решил использовать Moq.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-203">In this tutorial, I decided to use Moq.</span></span> <span data-ttu-id="5f9e1-204">Тем не менее, вы можете так же легко использовать Rhino Mocks или Typemock Isolator для создания объектов Mock для приложения Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-204">However, you could just as easily use Rhino Mocks or Typemock Isolator to create the Mock objects for the Contact Manager application.</span></span>

<span data-ttu-id="5f9e1-205">Прежде чем использовать Moq, необходимо выполнить следующие шаги:</span><span class="sxs-lookup"><span data-stu-id="5f9e1-205">Before you can use Moq, you need to complete the following steps:</span></span>

1. <span data-ttu-id="5f9e1-206">.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-206">.</span></span>
2. <span data-ttu-id="5f9e1-207">Перед тем, как распаковать загрузку, убедитесь, что вы правой кнопкой мыши файла и нажмите кнопку помечены **Разблокировать** (см. Рисунок 1).</span><span class="sxs-lookup"><span data-stu-id="5f9e1-207">Before you unzip the download, make sure that you right-click the file and click the button labeled **Unblock** (see Figure 1).</span></span>
3. <span data-ttu-id="5f9e1-208">Unzip загрузки.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-208">Unzip the download.</span></span>
4. <span data-ttu-id="5f9e1-209">Добавьте ссылку на сборку Moq, нажав на папку Ссылки в проекте ContactManager.Tests и выбрав **справку Add.**</span><span class="sxs-lookup"><span data-stu-id="5f9e1-209">Add a reference to the Moq assembly by right-clicking the References folder in the ContactManager.Tests project and selecting **Add Reference**.</span></span> <span data-ttu-id="5f9e1-210">Под вкладкой «Обзор» просмотрите папку, где расстегнули Moq, и выберите сборку Moq.dll.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-210">Under the Browse tab, browse to the folder where you unzipped Moq and select the Moq.dll assembly.</span></span> <span data-ttu-id="5f9e1-211">Нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-211">Click the **OK** button.</span></span>
5. <span data-ttu-id="5f9e1-212">После выполнения этих шагов папка «Ссылки» должна выглядеть как рисунок 2.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-212">After you complete these steps, your References folder should look like Figure 2.</span></span>

<span data-ttu-id="5f9e1-213">[![Разблокирование Moq](iteration-5-create-unit-tests-cs/_static/image1.jpg)](iteration-5-create-unit-tests-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="5f9e1-213">[![Unblocking Moq](iteration-5-create-unit-tests-cs/_static/image1.jpg)](iteration-5-create-unit-tests-cs/_static/image1.png)</span></span>

<span data-ttu-id="5f9e1-214">**Рисунок 01**: Разблокировка Moq[(Нажмите, чтобы посмотреть полноразмерное изображение](iteration-5-create-unit-tests-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="5f9e1-214">**Figure 01**: Unblocking Moq([Click to view full-size image](iteration-5-create-unit-tests-cs/_static/image2.png))</span></span>

<span data-ttu-id="5f9e1-215">[![Ссылки после добавления Moq](iteration-5-create-unit-tests-cs/_static/image2.jpg)](iteration-5-create-unit-tests-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="5f9e1-215">[![References after adding Moq](iteration-5-create-unit-tests-cs/_static/image2.jpg)](iteration-5-create-unit-tests-cs/_static/image3.png)</span></span>

<span data-ttu-id="5f9e1-216">**Рисунок 02**: Ссылки после добавления Moq[(Нажмите, чтобы просмотреть полноразмерное изображение](iteration-5-create-unit-tests-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="5f9e1-216">**Figure 02**: References after adding Moq([Click to view full-size image](iteration-5-create-unit-tests-cs/_static/image4.png))</span></span>

## <a name="creating-unit-tests-for-the-service-layer"></a><span data-ttu-id="5f9e1-217">Создание модульных тестов для уровня обслуживания</span><span class="sxs-lookup"><span data-stu-id="5f9e1-217">Creating Unit Tests for the Service Layer</span></span>

<span data-ttu-id="5f9e1-218">Начнем с создания набора модульных тестов для нашего сервисного слоя приложения Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-218">Let s start by creating a set of unit tests for our Contact Manager application s service layer.</span></span> <span data-ttu-id="5f9e1-219">Мы будем использовать эти тесты для проверки нашей логики проверки.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-219">We'll use these tests to verify our validation logic.</span></span>

<span data-ttu-id="5f9e1-220">Создайте новую папку под названием Модели в проекте ContactManager.Tests.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-220">Create a new folder named Models in the ContactManager.Tests project.</span></span> <span data-ttu-id="5f9e1-221">Далее, правой кнопкой кнопку Модели папку и выберите **Добавить, Новый тест**.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-221">Next, right-click the Models folder and select **Add, New Test**.</span></span> <span data-ttu-id="5f9e1-222">Отображается диалог **Добавить новый тест,** показанный на рисунке 3.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-222">The **Add New Test** dialog shown in Figure 3 appears.</span></span> <span data-ttu-id="5f9e1-223">Выберите шаблон **Unit Test** и назовите свой новый тест ContactManagerServiceTest.cs.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-223">Select the **Unit Test** template and name your new test ContactManagerServiceTest.cs.</span></span> <span data-ttu-id="5f9e1-224">Нажмите кнопку **OK,** чтобы добавить новый тест в тестовый проект.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-224">Click the **OK** button to add your new test to your Test Project.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="5f9e1-225">Как правило, требуется, чтобы структура папок вашего тестового проекта соответствовала структуре папок вашего проекта ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-225">In general, you want the folder structure of your Test Project to match the folder structure of your ASP.NET MVC project.</span></span> <span data-ttu-id="5f9e1-226">Например, вы размещаете тесты контроллеров в папке контроллеров, тесты моделей в папке Модели и так далее.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-226">For example, you place controller tests in a Controllers folder, model tests in a Models folder, and so on.</span></span>

<span data-ttu-id="5f9e1-227">[![Модели-КонтактМенеджерСервисТест.cs](iteration-5-create-unit-tests-cs/_static/image3.jpg)](iteration-5-create-unit-tests-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="5f9e1-227">[![Models\ContactManagerServiceTest.cs](iteration-5-create-unit-tests-cs/_static/image3.jpg)](iteration-5-create-unit-tests-cs/_static/image5.png)</span></span>

<span data-ttu-id="5f9e1-228">**Рисунок 03**: Модели»ContactManagerServiceTest.cs[(Нажмите, чтобы просмотреть полноразмерное изображение](iteration-5-create-unit-tests-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="5f9e1-228">**Figure 03**: Models\ContactManagerServiceTest.cs([Click to view full-size image](iteration-5-create-unit-tests-cs/_static/image6.png))</span></span>

<span data-ttu-id="5f9e1-229">Первоначально мы хотим протестировать метод CreateContact(), выставленный классом ContactManagerService.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-229">Initially, we want to test the CreateContact() method exposed by the ContactManagerService class.</span></span> <span data-ttu-id="5f9e1-230">Мы создадим следующие пять тестов:</span><span class="sxs-lookup"><span data-stu-id="5f9e1-230">We'll create the following five tests:</span></span>

- <span data-ttu-id="5f9e1-231">CreateContact() - Тесты, которые CreateContact() возвращает значение истинное, когда действительный контакт передается методу.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-231">CreateContact() - Tests that CreateContact() returns the value true when a valid Contact is passed to the method.</span></span>
- <span data-ttu-id="5f9e1-232">CreateContactRequiredFirstName() - Тесты добавления сообщения об ошибке в состояние модели при перекаче контакта с отсутствующим именем методу CreateContact().</span><span class="sxs-lookup"><span data-stu-id="5f9e1-232">CreateContactRequiredFirstName() - Tests that an error message is added to model state when a Contact with a missing first name is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="5f9e1-233">CreateContactRequiredLastName() - Тесты добавления сообщения об ошибке в состояние модели при перекаче контакта с отсутствующим и фамилией в метод CreateContact().</span><span class="sxs-lookup"><span data-stu-id="5f9e1-233">CreateContactRequiredLastName() - Tests that an error message is added to model state when a Contact with a missing last name is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="5f9e1-234">CreateContactInvalidPhone() - Тесты, что сообщение об ошибке добавляется в состояние модели, когда контакт с недействительным номером телефона передается методу CreateContact().</span><span class="sxs-lookup"><span data-stu-id="5f9e1-234">CreateContactInvalidPhone() - Tests that an error message is added to model state when a Contact with an invalid phone number is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="5f9e1-235">CreateContactInvalidEmail() - Тесты, что сообщение об ошибке добавляется в состояние модели, когда контакт с недействительным адресом электронной почты передается методу CreateContact() .</span><span class="sxs-lookup"><span data-stu-id="5f9e1-235">CreateContactInvalidEmail() - Tests that an error message is added to model state when a Contact with an invalid email address is passed to the CreateContact() method..</span></span>

<span data-ttu-id="5f9e1-236">Первый тест проверяет, что допустимый Контакт не генерирует ошибку проверки.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-236">The first test verifies that a valid Contact does not generate a validation error.</span></span> <span data-ttu-id="5f9e1-237">Остальные тесты проверяют каждое из правил проверки.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-237">The remaining tests check each of the validation rules.</span></span>

<span data-ttu-id="5f9e1-238">Код для этих тестов содержится в листинге 1.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-238">The code for these tests is contained in Listing 1.</span></span>

<span data-ttu-id="5f9e1-239">**Список 1 - Модели/ContactManagerServiceTest.cs**</span><span class="sxs-lookup"><span data-stu-id="5f9e1-239">**Listing 1 - Models\ContactManagerServiceTest.cs**</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample1.cs)]

<span data-ttu-id="5f9e1-240">Поскольку мы используем класс Контактов в листинге 1, нам необходимо добавить ссылку на рамку сущности Майкрософт к нашему тестовому проекту.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-240">Because we use the Contact class in Listing 1, we need to add a reference to the Microsoft Entity Framework to our Test project.</span></span> <span data-ttu-id="5f9e1-241">Добавьте ссылку на сборку System.Data.Entity.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-241">Add a reference to the System.Data.Entity assembly.</span></span>

<span data-ttu-id="5f9e1-242">Список 1 содержит метод под названием Initialize(), который украшен атрибутом «Test Initialize».</span><span class="sxs-lookup"><span data-stu-id="5f9e1-242">Listing 1 contains a method named Initialize() that is decorated with the [TestInitialize] attribute.</span></span> <span data-ttu-id="5f9e1-243">Этот метод вызывается автоматически перед запуском каждого из модульных тестов (он называется 5 раз прямо перед каждым из модульных тестов).</span><span class="sxs-lookup"><span data-stu-id="5f9e1-243">This method is called automatically before each of the unit tests is run (it is called 5 times right before each of the unit tests).</span></span> <span data-ttu-id="5f9e1-244">Метод Инициализации () создает макет репозитория со следующей строкой кода:</span><span class="sxs-lookup"><span data-stu-id="5f9e1-244">The Initialize() method creates a mock repository with the following line of code:</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample2.cs)]

<span data-ttu-id="5f9e1-245">Эта строка кода использует платформу Moq для создания макетного репозитория из интерфейса IContactManagerRepository.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-245">This line of code uses the Moq framework to generate a mock repository from the IContactManagerRepository interface.</span></span> <span data-ttu-id="5f9e1-246">Макет репозитория используется вместо фактического EntityContactManagerRepository, чтобы избежать доступа к базе данных, когда каждый модульный тест запущен.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-246">The mock repository is used instead of the actual EntityContactManagerRepository to avoid accessing the database when each unit test is run.</span></span> <span data-ttu-id="5f9e1-247">Макет репозитория реализует методы интерфейса IContactManagerRepository, но методы на самом деле не делают ничего.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-247">The mock repository implements the methods of the IContactManagerRepository interface, but the methods don t actually do anything.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="5f9e1-248">При использовании фрекинга Moq \_существует различие между \_mockRepository и mockRepository.Object.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-248">When using the Moq framework, there is a distinction between \_mockRepository and \_mockRepository.Object.</span></span> <span data-ttu-id="5f9e1-249">Первый относится&lt;к классу Mock&gt; IContactManagerRepository, который содержит методы определения того, как будет вести себя макет репозиторий.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-249">The former refers to the Mock&lt;IContactManagerRepository&gt; class that contains methods for specifying how the mock repository will behave.</span></span> <span data-ttu-id="5f9e1-250">Последний относится к фактическому репозиторию макетов, который реализует интерфейс IContactManagerRepository.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-250">The latter refers to the actual mock repository that implements the IContactManagerRepository interface.</span></span>

<span data-ttu-id="5f9e1-251">Макет репозитория используется в методе Инициализации () при создании экземпляра класса ContactManagerService.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-251">The mock repository is used in the Initialize() method when creating an instance of the ContactManagerService class.</span></span> <span data-ttu-id="5f9e1-252">Все отдельные модульные тесты используют этот экземпляр класса ContactManagerService.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-252">All of the individual unit tests use this instance of the ContactManagerService class.</span></span>

<span data-ttu-id="5f9e1-253">Список 1 содержит пять методов, которые соответствуют каждому из модульных тестов.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-253">Listing 1 contains five methods that correspond to each of the unit tests.</span></span> <span data-ttu-id="5f9e1-254">Каждый из этих методов украшен атрибутом «TestMethod».</span><span class="sxs-lookup"><span data-stu-id="5f9e1-254">Each of these methods is decorated with the [TestMethod] attribute.</span></span> <span data-ttu-id="5f9e1-255">При запуске модульных тестов вызывается любой метод, который имеет этот атрибут.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-255">When you run the unit tests, any method that has this attribute is called.</span></span> <span data-ttu-id="5f9e1-256">Другими словами, любой метод, украшенный атрибутом «TestMethod», является модульным тестом.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-256">In other words, any method that is decorated with the [TestMethod] attribute is a unit test.</span></span>

<span data-ttu-id="5f9e1-257">Первый модульный тест, названный CreateContact(, проверяет, что вызов CreateContact() возвращает истинное значение при передаваемых методу допустимого экземпляра класса Контакт.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-257">The first unit test, named CreateContact(), verifies that calling CreateContact() returns the value true when a valid instance of the Contact class is passed to the method.</span></span> <span data-ttu-id="5f9e1-258">Тест создает экземпляр класса Контакт, вызывает метод CreateContact() и проверяет, что CreateContact() возвращает значение истинное.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-258">The test creates an instance of the Contact class, calls the CreateContact() method, and verifies that CreateContact() returns the value true.</span></span>

<span data-ttu-id="5f9e1-259">Остальные тесты проверяют, что при вызове метода CreateContact() с недействительным контактом, затем метод возвращается ложным, и ожидаемое сообщение об ошибке проверки добавляется в состояние модели.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-259">The remaining tests verify that when the CreateContact() method is called with an invalid Contact then the method returns false and the expected validation error message is added to model state.</span></span> <span data-ttu-id="5f9e1-260">Например, тест CreateContactRequiredFirstName() создает экземпляр класса Контакт с пустой строкой для свойства FirstName.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-260">For example, the CreateContactRequiredFirstName() test creates an instance of the Contact class with an empty string for its FirstName property.</span></span> <span data-ttu-id="5f9e1-261">Далее метод CreateContact() вызывается с недействительным контактом.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-261">Next, the CreateContact() method is called with the invalid Contact.</span></span> <span data-ttu-id="5f9e1-262">Наконец, тест проверяет, что CreateContact() возвращает ложно, и что состояние модели содержит ожидаемое сообщение об ошибке проверки "Требуется первое имя".</span><span class="sxs-lookup"><span data-stu-id="5f9e1-262">Finally, the test verifies that CreateContact() returns false and that model state contains the expected validation error message "First name is required."</span></span>

<span data-ttu-id="5f9e1-263">Вы можете запустить модульные тесты в листинге 1, выбрав вариант меню **Тест, Выполнить, Все тесты в решении (CTRL-R, A)**.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-263">You can run the unit tests in Listing 1 by selecting the menu option **Test, Run, All Tests in Solution (CTRL+R, A)**.</span></span> <span data-ttu-id="5f9e1-264">Результаты тестов отображаются в окне результатов тестирования (см. рисунок 4).</span><span class="sxs-lookup"><span data-stu-id="5f9e1-264">The results of the tests are displayed in the Test Results window (see Figure 4).</span></span>

<span data-ttu-id="5f9e1-265">[![Результаты тестирования](iteration-5-create-unit-tests-cs/_static/image4.jpg)](iteration-5-create-unit-tests-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="5f9e1-265">[![Test Results](iteration-5-create-unit-tests-cs/_static/image4.jpg)](iteration-5-create-unit-tests-cs/_static/image7.png)</span></span>

<span data-ttu-id="5f9e1-266">**Рисунок 04**: Результаты испытаний[(Нажмите, чтобы просмотреть полноразмерное изображение)](iteration-5-create-unit-tests-cs/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="5f9e1-266">**Figure 04**: Test Results ([Click to view full-size image](iteration-5-create-unit-tests-cs/_static/image8.png))</span></span>

## <a name="creating-unit-tests-for-controllers"></a><span data-ttu-id="5f9e1-267">Создание модульных тестов для контроллеров</span><span class="sxs-lookup"><span data-stu-id="5f9e1-267">Creating Unit Tests for Controllers</span></span>

<span data-ttu-id="5f9e1-268">Приложение ASP.NETMVC контролирует поток пользовательского взаимодействия.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-268">ASP.NETMVC application control the flow of user interaction.</span></span> <span data-ttu-id="5f9e1-269">При тестировании контроллера необходимо проверить, возвращает ли контроллер нужный результат действия и просматривать данные.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-269">When testing a controller, you want to test whether the controller returns the right action result and view data.</span></span> <span data-ttu-id="5f9e1-270">Также можно проверить, взаимодействует ли контроллер с классами моделей в ожидаемом порядке.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-270">You also might want to test whether a controller interacts with model classes in the manner expected.</span></span>

<span data-ttu-id="5f9e1-271">Например, листинг 2 содержит два модульных теста для метода создания контроллера контакта() .</span><span class="sxs-lookup"><span data-stu-id="5f9e1-271">For example, Listing 2 contains two unit tests for the Contact controller Create() method.</span></span> <span data-ttu-id="5f9e1-272">Первый модульный тест проверяет, что при перекачном контакте в метод «Создание() — метод Create() перенаправляет сявок в действие Индекса.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-272">The first unit test verifies that when a valid Contact is passed to the Create() method then the Create() method redirects to the Index action.</span></span> <span data-ttu-id="5f9e1-273">Другими словами, при пройдении действительного контакта метод Create() должен вернуть RedirectToRouteResult, представляющий действие Индекса.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-273">In other words, when passed a valid Contact, the Create() method should return a RedirectToRouteResult that represents the Index action.</span></span>

<span data-ttu-id="5f9e1-274">Мы не хотим тестировать уровень обслуживания ContactManager при тестировании слоя контроллера.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-274">We don t want to test the ContactManager service layer when we are testing the controller layer.</span></span> <span data-ttu-id="5f9e1-275">Поэтому мы издеваемся над уровнем обслуживания со следующим кодом в методе Инициализации:</span><span class="sxs-lookup"><span data-stu-id="5f9e1-275">Therefore, we mock the service layer with the following code in the Initialize method:</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample3.cs)]

<span data-ttu-id="5f9e1-276">В модульном тесте CreateValidContact() мы издеваемся над поведением вызова метода CreateContact() со следующей строкой кода:</span><span class="sxs-lookup"><span data-stu-id="5f9e1-276">In the CreateValidContact() unit test, we mock the behavior of calling the service layer CreateContact() method with the following line of code:</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample4.cs)]

<span data-ttu-id="5f9e1-277">Эта строка кода заставляет макет службы ContactManager вернуть значение истинное, когда называется его метод CreateContact.)</span><span class="sxs-lookup"><span data-stu-id="5f9e1-277">This line of code causes the mock ContactManager service to return the value true when its CreateContact() method is called.</span></span> <span data-ttu-id="5f9e1-278">Высмеивая уровень обслуживания, мы можем проверить поведение нашего контроллера без необходимости выполнения какого-либо кода в уровне обслуживания.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-278">By mocking the service layer, we can test the behavior of our controller without needing to execute any code in the service layer.</span></span>

<span data-ttu-id="5f9e1-279">Второй модульный тест проверяет, что действие Create() возвращает представление Create при перекачном контакте с недействительным контактом с методом.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-279">The second unit test verifies that the Create() action returns the Create view when an invalid contact is passed to the method.</span></span> <span data-ttu-id="5f9e1-280">Мы заставляют метод CreateContact() создать() метод возврата значения ложным со следующей строкой кода:</span><span class="sxs-lookup"><span data-stu-id="5f9e1-280">We cause the service layer CreateContact() method to return the value false with the following line of code:</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample5.cs)]

<span data-ttu-id="5f9e1-281">Если метод Create() ведет себя так, как мы ожидаем, он должен вернуть представление Create, когда слой службы возвращает ложное значение.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-281">If the Create() method behaves as we expect then it should return the Create view when the service layer returns the value false.</span></span> <span data-ttu-id="5f9e1-282">Таким образом, контроллер может отображать сообщения об ошибке проверки в представлении Create, и у пользователя есть шанс исправить эти недействительные свойства контакта.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-282">That way, the controller can display the validation error messages in the Create view and the user has a chance to correct that invalid Contact properties.</span></span>

<span data-ttu-id="5f9e1-283">Если вы планируете создавать модульные тесты для контроллеров, то вам нужно вернуть явные имена представлений из действий контроллера.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-283">If you plan to build unit tests for your controllers then you need to return explicit view names from your controller actions.</span></span> <span data-ttu-id="5f9e1-284">Например, не возвращайте представление следующим образом:</span><span class="sxs-lookup"><span data-stu-id="5f9e1-284">For example, do not return a view like this:</span></span>

<span data-ttu-id="5f9e1-285">return View();</span><span class="sxs-lookup"><span data-stu-id="5f9e1-285">return View();</span></span>

<span data-ttu-id="5f9e1-286">Вместо этого верните представление следующим образом:</span><span class="sxs-lookup"><span data-stu-id="5f9e1-286">Instead, return the view like this:</span></span>

<span data-ttu-id="5f9e1-287">return View ("Создание");</span><span class="sxs-lookup"><span data-stu-id="5f9e1-287">return View("Create");</span></span>

<span data-ttu-id="5f9e1-288">Если вы не явны при возврате представления, то свойство ViewResult.ViewName возвращает пустую строку.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-288">If you are not explicit when returning a view then the ViewResult.ViewName property returns an empty string.</span></span>

<span data-ttu-id="5f9e1-289">**Список 2 - Контролеры/ContactControllerTest.cs**</span><span class="sxs-lookup"><span data-stu-id="5f9e1-289">**Listing 2 - Controllers\ContactControllerTest.cs**</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample6.cs)]

## <a name="summary"></a><span data-ttu-id="5f9e1-290">Сводка</span><span class="sxs-lookup"><span data-stu-id="5f9e1-290">Summary</span></span>

<span data-ttu-id="5f9e1-291">В этой итерации мы создали модульные тесты для нашего приложения Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-291">In this iteration, we created unit tests for our Contact Manager application.</span></span> <span data-ttu-id="5f9e1-292">Мы можем запустить эти модульные тесты в любое время, чтобы убедиться, что наше приложение по-прежнему ведет себя так, как мы ожидаем.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-292">We can run these unit tests at any time to verify that our application still behaves in the manner that we expect.</span></span> <span data-ttu-id="5f9e1-293">Модульные тесты служат защитной сеткой для нашего приложения, что позволяет нам безопасно изменять наше приложение в будущем.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-293">The unit tests act as a safety net for our application enabling us to safely modify our application in the future.</span></span>

<span data-ttu-id="5f9e1-294">Мы создали два набора модульных тестов.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-294">We created two sets of unit tests.</span></span> <span data-ttu-id="5f9e1-295">Во-первых, мы проверили нашу логику проверки, создав модульные тесты для нашего сервисного слоя.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-295">First, we tested our validation logic by creating unit tests for our service layer.</span></span> <span data-ttu-id="5f9e1-296">Затем мы протестировали логику управления потоком, создав модульные тесты для нашего слоя контроллера.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-296">Next, we tested our flow control logic by creating unit tests for our controller layer.</span></span> <span data-ttu-id="5f9e1-297">При тестировании нашего уровня обслуживания мы изолировали наши тесты для нашего слоя службы от нашего слоя репозитория, насмехаясь над нашим слоем репозитория.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-297">When testing our service layer, we isolated our tests for our service layer from our repository layer by mocking our repository layer.</span></span> <span data-ttu-id="5f9e1-298">При тестировании слоя контроллера мы изолировали наши тесты для нашего слоя контроллера, высмеивая уровень обслуживания.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-298">When testing the controller layer, we isolated our tests for our controller layer by mocking the service layer.</span></span>

<span data-ttu-id="5f9e1-299">В следующей итерации мы модифицировали приложение Contact Manager таким образом, чтобы оно поддерживало Контактные группы.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-299">In the next iteration, we modify the Contact Manager application so that it supports Contact Groups.</span></span> <span data-ttu-id="5f9e1-300">Мы добавим эту новую функциональность в наше приложение, используя процесс разработки программного обеспечения, называемый разработкой, управляемой тестами.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-300">We'll add this new functionality to our application using a software design process called test-driven development.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="5f9e1-301">[Назад](iteration-4-make-the-application-loosely-coupled-cs.md)
> [Вперед](iteration-6-use-test-driven-development-cs.md)</span><span class="sxs-lookup"><span data-stu-id="5f9e1-301">[Previous](iteration-4-make-the-application-loosely-coupled-cs.md)
[Next](iteration-6-use-test-driven-development-cs.md)</span></span>
