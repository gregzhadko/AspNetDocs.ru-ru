---
uid: mvc/overview/older-versions-1/contact-manager/iteration-7-add-ajax-functionality-cs
title: 'Итерация #7 - Добавить функциональность Ajax (C) Документы Майкрософт'
author: rick-anderson
description: В седьмой итерации мы улучшаем отзывчивость и производительность нашего приложения, добавляя поддержку Ajax.
ms.author: riande
ms.date: 02/20/2009
ms.assetid: f1b0809e-8909-444e-b6bb-a5cd1dea3f72
msc.legacyurl: /mvc/overview/older-versions-1/contact-manager/iteration-7-add-ajax-functionality-cs
msc.type: authoredcontent
ms.openlocfilehash: 12d7348382bc55af049567922bd6963970a9421b
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2020
ms.locfileid: "81542317"
---
# <a name="iteration-7--add-ajax-functionality-c"></a><span data-ttu-id="7d1fb-103">Итерация 7. Добавление функций Ajax (C#)</span><span class="sxs-lookup"><span data-stu-id="7d1fb-103">Iteration #7 – Add Ajax functionality (C#)</span></span>

<span data-ttu-id="7d1fb-104">[корпорацией Майкрософт](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="7d1fb-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="7d1fb-105">Скачать код</span><span class="sxs-lookup"><span data-stu-id="7d1fb-105">Download Code</span></span>](iteration-7-add-ajax-functionality-cs/_static/contactmanager_7_cs1.zip)

> <span data-ttu-id="7d1fb-106">В седьмой итерации мы улучшаем отзывчивость и производительность нашего приложения, добавляя поддержку Ajax.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-106">In the seventh iteration, we improve the responsiveness and performance of our application by adding support for Ajax.</span></span>

## <a name="building-a-contact-management-aspnet-mvc-application-c"></a><span data-ttu-id="7d1fb-107">Создание приложения управления контактами ASP.NET MVC (C)</span><span class="sxs-lookup"><span data-stu-id="7d1fb-107">Building a Contact Management ASP.NET MVC Application (C#)</span></span>

<span data-ttu-id="7d1fb-108">В этой серии учебников мы создаем все приложение Управления Контактами от начала до конца.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-108">In this series of tutorials, we build an entire Contact Management application from start to finish.</span></span> <span data-ttu-id="7d1fb-109">Приложение Contact Manager позволяет хранить контактную информацию - имена, номера телефонов и адреса электронной почты - для списка людей.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-109">The Contact Manager application enables you to store contact information - names, phone numbers and email addresses - for a list of people.</span></span>

<span data-ttu-id="7d1fb-110">Мы строим приложение по нескольким итерациям.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-110">We build the application over multiple iterations.</span></span> <span data-ttu-id="7d1fb-111">С каждой итерацией мы постепенно совершенствуем приложение.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-111">With each iteration, we gradually improve the application.</span></span> <span data-ttu-id="7d1fb-112">Цель этого подхода с множественной итерацией состоит в том, чтобы вы могли понять причину каждого изменения.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-112">The goal of this multiple iteration approach is to enable you to understand the reason for each change.</span></span>

- <span data-ttu-id="7d1fb-113">Итерация #1 - Создайте приложение.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-113">Iteration #1 - Create the application.</span></span> <span data-ttu-id="7d1fb-114">В первой итерации мы создаем Контакт-менеджер самым простым способом.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-114">In the first iteration, we create the Contact Manager in the simplest way possible.</span></span> <span data-ttu-id="7d1fb-115">Мы добавляем поддержку для основных операций базы данных: Создание, чтение, обновление и удаление (CRUD).</span><span class="sxs-lookup"><span data-stu-id="7d1fb-115">We add support for basic database operations: Create, Read, Update, and Delete (CRUD).</span></span>

- <span data-ttu-id="7d1fb-116">Итерация #2 - Сделать приложение хорошо выглядеть.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-116">Iteration #2 - Make the application look nice.</span></span> <span data-ttu-id="7d1fb-117">В этой итерации мы улучшаем внешний вид приложения, изменяя страницу по умолчанию ASP.NET MVC просмотра и каскадный стиль листа.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-117">In this iteration, we improve the appearance of the application by modifying the default ASP.NET MVC view master page and cascading style sheet.</span></span>

- <span data-ttu-id="7d1fb-118">Итерация #3 - Добавить проверку формы.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-118">Iteration #3 - Add form validation.</span></span> <span data-ttu-id="7d1fb-119">В третьей итерации мы добавляем базовую проверку формы.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-119">In the third iteration, we add basic form validation.</span></span> <span data-ttu-id="7d1fb-120">Мы не позволяем людям подавать форму без заполнения требуемых полей формы.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-120">We prevent people from submitting a form without completing required form fields.</span></span> <span data-ttu-id="7d1fb-121">Мы также проверяем адреса электронной почты и номера телефонов.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-121">We also validate email addresses and phone numbers.</span></span>

- <span data-ttu-id="7d1fb-122">Итерация #4 - Сделать приложение слабо связаны.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-122">Iteration #4 - Make the application loosely coupled.</span></span> <span data-ttu-id="7d1fb-123">В этой четвертой итерации мы воспользуемся несколькими шаблонами проектирования программного обеспечения, чтобы упростить обслуживание и изменение приложения Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-123">In this fourth iteration, we take advantage of several software design patterns to make it easier to maintain and modify the Contact Manager application.</span></span> <span data-ttu-id="7d1fb-124">Например, мы рефакторизуем наше приложение, чтобы использовать шаблон репозитория и шаблон инъекций зависимостей.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-124">For example, we refactor our application to use the Repository pattern and the Dependency Injection pattern.</span></span>

- <span data-ttu-id="7d1fb-125">Итерация #5 - Создание модульных тестов.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-125">Iteration #5 - Create unit tests.</span></span> <span data-ttu-id="7d1fb-126">В пятой итерации мы упрощаем обслуживание и модификацию нашего приложения путем добавления модульных тестов.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-126">In the fifth iteration, we make our application easier to maintain and modify by adding unit tests.</span></span> <span data-ttu-id="7d1fb-127">Мы издеваемся над нашими классами моделей данных и строим модульные тесты для наших контроллеров и логики проверки.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-127">We mock our data model classes and build unit tests for our controllers and validation logic.</span></span>

- <span data-ttu-id="7d1fb-128">Итерация #6 - Использование тест-ориентированной разработки.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-128">Iteration #6 - Use test-driven development.</span></span> <span data-ttu-id="7d1fb-129">В этой шестой итерации мы добавляем новую функциональность в наше приложение, написав модульные тесты сначала и написав код против модульных тестов.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-129">In this sixth iteration, we add new functionality to our application by writing unit tests first and writing code against the unit tests.</span></span> <span data-ttu-id="7d1fb-130">В этой итерации мы добавляем контактные группы.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-130">In this iteration, we add contact groups.</span></span>

- <span data-ttu-id="7d1fb-131">Итерация #7 - Добавить функциональность Ajax.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-131">Iteration #7 - Add Ajax functionality.</span></span> <span data-ttu-id="7d1fb-132">В седьмой итерации мы улучшаем отзывчивость и производительность нашего приложения, добавляя поддержку Ajax.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-132">In the seventh iteration, we improve the responsiveness and performance of our application by adding support for Ajax.</span></span>

## <a name="this-iteration"></a><span data-ttu-id="7d1fb-133">Эта итерация</span><span class="sxs-lookup"><span data-stu-id="7d1fb-133">This Iteration</span></span>

<span data-ttu-id="7d1fb-134">В этой итерации приложения Contact Manager мы рефакторинг нашего приложения, чтобы использовать Ajax.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-134">In this iteration of the Contact Manager application, we refactor our application to make use of Ajax.</span></span> <span data-ttu-id="7d1fb-135">Воспользовавшись Преимуществами Ajax, мы делаем наше приложение более отзывчивым.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-135">By taking advantage of Ajax, we make our application more responsive.</span></span> <span data-ttu-id="7d1fb-136">Мы можем избежать визуализации всей страницы, когда нам нужно обновить только определенный регион на странице.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-136">We can avoid rendering an entire page when we need to update only a certain region in a page.</span></span>

<span data-ttu-id="7d1fb-137">Мы рефакторинг нашего индекса зрения так, что нам не нужно повторно отображать всю страницу, когда кто-то выбирает новую контактную группу.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-137">We'll refactor our Index view so that we don t need to redisplay the entire page whenever someone selects a new contact group.</span></span> <span data-ttu-id="7d1fb-138">Вместо этого, когда кто-то нажимает на контактную группу, мы просто обновим список контактов и оставим остальную часть страницы в покое.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-138">Instead, when someone clicks a contact group, we'll just update the list of contacts and leave the rest of the page alone.</span></span>

<span data-ttu-id="7d1fb-139">Мы также изменим способ работы нашей ссылки на удаление.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-139">We'll also change the way our delete link works.</span></span> <span data-ttu-id="7d1fb-140">Вместо того, чтобы отображать отдельную страницу подтверждения, мы отображаем диалог подтверждения JavaScript.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-140">Instead of displaying a separate confirmation page, we'll display a JavaScript confirmation dialog.</span></span> <span data-ttu-id="7d1fb-141">Если вы подтверждаете, что хотите удалить контакт, против сервера выполняется операция HTTP DELETE для удаления записи контактов из базы данных.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-141">If you confirm that you want to delete a contact, an HTTP DELETE operation is performed against the server to delete the contact record from the database.</span></span>

<span data-ttu-id="7d1fb-142">Кроме того, мы воспользуемся j'ery, чтобы добавить эффекты анимации в наш индекс ный эффект.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-142">Furthermore, we will take advantage of jQuery to add animation effects to our Index view.</span></span> <span data-ttu-id="7d1fb-143">Мы отобразим анимацию, когда новый список контактов будет извлечен с сервера.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-143">We'll display an animation when the new list of contacts is being fetched from the server.</span></span>

<span data-ttu-id="7d1fb-144">Наконец, мы воспользуемся ASP.NET поддержкой рамок AJAX для управления историей браузера.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-144">Finally, we'll take advantage of the ASP.NET AJAX framework support for managing browser history.</span></span> <span data-ttu-id="7d1fb-145">Мы будем создавать точки истории всякий раз, когда выполняем вызов Ajax для обновления списка контактов.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-145">We'll create history points whenever we perform an Ajax call to update the contact list.</span></span> <span data-ttu-id="7d1fb-146">Таким образом, браузер назад и вперед кнопки будут работать.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-146">That way, the browser backward and forward buttons will work.</span></span>

## <a name="why-use-ajax"></a><span data-ttu-id="7d1fb-147">Зачем использовать Ajax?</span><span class="sxs-lookup"><span data-stu-id="7d1fb-147">Why use Ajax?</span></span>

<span data-ttu-id="7d1fb-148">Использование Ajax имеет много преимуществ.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-148">Using Ajax has many benefits.</span></span> <span data-ttu-id="7d1fb-149">Во-первых, добавление функциональности Ajax в приложение приводит к улучшению пользовательского опыта.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-149">First, adding Ajax functionality to an application results in a better user experience.</span></span> <span data-ttu-id="7d1fb-150">В обычном веб-приложении вся страница должна быть размещена обратно на сервер каждый раз, когда пользователь выполняет действие.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-150">In a normal web application, the entire page must be posted back to the server each and every time a user performs an action.</span></span> <span data-ttu-id="7d1fb-151">Всякий раз, когда вы выполняете действие, браузер блокирует, и пользователь должен ждать, пока вся страница будет извлечена и повторно отображается.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-151">Whenever you perform an action, the browser locks and the user must wait until the entire page is fetched and redisplayed.</span></span>

<span data-ttu-id="7d1fb-152">Это было бы неприемлемым опытом в случае настольного приложения.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-152">This would be an unacceptable experience in the case of a desktop application.</span></span> <span data-ttu-id="7d1fb-153">Но, традиционно, мы жили с этим плохим опытом пользователя в случае веб-приложения, потому что мы не знали, что мы могли бы сделать лучше.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-153">But, traditionally, we lived with this bad user experience in the case of a web application because we did not know that we could do any better.</span></span> <span data-ttu-id="7d1fb-154">Мы думали, что это ограничение веб-приложений, когда, в действительности, это было просто ограничение нашего воображения.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-154">We thought it was a limitation of web applications when, in actuality, it was just a limitation of our imaginations.</span></span>

<span data-ttu-id="7d1fb-155">В приложении Ajax не нужно приостанавливать работу пользователя только для обновления страницы.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-155">In an Ajax application, you don t need to bring the user experience to a halt just to update a page.</span></span> <span data-ttu-id="7d1fb-156">Вместо этого можно выполнить асинхронный запрос в фоновом режиме для обновления страницы.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-156">Instead, you can perform an asynchronous request in the background to update the page.</span></span> <span data-ttu-id="7d1fb-157">Вы не заставите пользователя ждать, пока часть страницы будет обновлена.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-157">You don t force the user to wait while part of the page gets updated.</span></span>

<span data-ttu-id="7d1fb-158">Воспользовавшись преимуществами Ajax, вы также можете повысить производительность приложения.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-158">By taking advantage of Ajax, you also can improve the performance of your application.</span></span> <span data-ttu-id="7d1fb-159">Рассмотрим, как приложение Contact Manager работает прямо сейчас без функциональности Ajax.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-159">Consider how the Contact Manager application works right now without Ajax functionality.</span></span> <span data-ttu-id="7d1fb-160">При нажатии на контактную группу весь представление Индекса должно быть повторно отображено.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-160">When you click a contact group, the entire Index view must be redisplayed.</span></span> <span data-ttu-id="7d1fb-161">Список контактов и список контактных групп должны быть извлечены с сервера базы данных.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-161">The list of contacts and list of contact groups must be retrieved from the database server.</span></span> <span data-ttu-id="7d1fb-162">Все эти данные должны передаваться по проводу от веб-сервера до веб-браузера.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-162">All of this data must be passed across the wire from web server to web browser.</span></span>

<span data-ttu-id="7d1fb-163">Однако после добавления функциональности Ajax в наше приложение мы можем избежать повторного отображения всей страницы, когда пользователь нажимает на контактную группу.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-163">After we add Ajax functionality to our application, however, we can avoid redisplaying the entire page when a user clicks a contact group.</span></span> <span data-ttu-id="7d1fb-164">Нам больше не нужно загоните контактные группы из базы данных.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-164">We no longer need to grab the contact groups from the database.</span></span> <span data-ttu-id="7d1fb-165">Нам также не нужно проталкивать весь вид Индекса по проводу.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-165">We also don t need to push the entire Index view across the wire.</span></span> <span data-ttu-id="7d1fb-166">Воспользовавшись преимуществами Ajax, мы сокращаем объем работы, который должен выполнять наш сервер базы данных, и уменьшаем объем сетевого трафика, требуемого нашим приложением.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-166">By taking advantage of Ajax, we reduce the amount of work that our database server must perform and we reduce the amount of network traffic required by our application.</span></span>

## <a name="don-t-be-afraid-of-ajax"></a><span data-ttu-id="7d1fb-167">Не бойтесь Ajax</span><span class="sxs-lookup"><span data-stu-id="7d1fb-167">Don t be Afraid of Ajax</span></span>

<span data-ttu-id="7d1fb-168">Некоторые разработчики избегают использования Ajax, потому что они беспокоятся о браузерах уровня downlevel.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-168">Some developers avoid using Ajax because they worry about downlevel browsers.</span></span> <span data-ttu-id="7d1fb-169">Они хотят убедиться, что их веб-приложения будут по-прежнему работать при доступе к браузеру, который не поддерживает JavaScript.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-169">They want to make sure that their web applications will still work when accessed by a browser that does not support JavaScript.</span></span> <span data-ttu-id="7d1fb-170">Поскольку Ajax зависит от JavaScript, некоторые разработчики избегают использования Ajax.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-170">Because Ajax depends on JavaScript, some developers avoid using Ajax.</span></span>

<span data-ttu-id="7d1fb-171">Однако, если вы тщательно о том, как вы реализуете Ajax, то вы можете создавать приложения, которые работают как с уровня и низом браузеров.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-171">However, if you are careful about how you implement Ajax then you can build applications that work with both uplevel and downlevel browsers.</span></span> <span data-ttu-id="7d1fb-172">Наше приложение Contact Manager будет работать с браузерами, которые поддерживают JavaScript и браузеры, которые этого не делают.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-172">Our Contact Manager application will work with browsers that support JavaScript and browsers that do not.</span></span>

<span data-ttu-id="7d1fb-173">Если вы используете приложение Contact Manager с браузером, который поддерживает JavaScript, то вы будете иметь лучший пользовательский опыт.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-173">If you use the Contact Manager application with a browser that supports JavaScript then you will have a better user experience.</span></span> <span data-ttu-id="7d1fb-174">Например, при нажатии на контактную группу будет обновлена только область страницы, отображающие контакты.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-174">For example, when you click a contact group, only the region of the page that displays contacts will be updated.</span></span>

<span data-ttu-id="7d1fb-175">Если, с другой стороны, вы используете приложение Contact Manager с браузером, который не поддерживает JavaScript (или что JavaScript отключен), то вы будете иметь немного менее желательным пользовательский опыт.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-175">If, on the other hand, you use the Contact Manager application with a browser that does not support JavaScript (or that has JavaScript disabled) then you will have a slightly less desirable user experience.</span></span> <span data-ttu-id="7d1fb-176">Например, при нажатии на контактную группу все представление Индекса должно быть отправлено обратно в браузер, чтобы отобразить соответствующий список контактов.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-176">For example, when you click a contact group, the entire Index view must be posted back to the browser in order to display the matching list of contacts.</span></span>

## <a name="adding-the-required-javascript-files"></a><span data-ttu-id="7d1fb-177">Добавление требуемых файлов JavaScript</span><span class="sxs-lookup"><span data-stu-id="7d1fb-177">Adding the Required JavaScript Files</span></span>

<span data-ttu-id="7d1fb-178">Для добавления функциональности Ajax в наше приложение нам необходимо использовать три файла JavaScript.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-178">We'll need to use three JavaScript files to add Ajax functionality to our application.</span></span> <span data-ttu-id="7d1fb-179">Все три этих файла включены в папку скриптов нового приложения mVC ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-179">All three of these files are included in the Scripts folder of a new ASP.NET MVC application.</span></span>

<span data-ttu-id="7d1fb-180">Если вы планируете использовать Ajax на нескольких страницах в приложении, то имеет смысл включить необходимые файлы JavaScript в страницу просмотра приложения.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-180">If you plan to use Ajax in multiple pages in your application then it makes sense to include the required JavaScript files in your application s view master page.</span></span> <span data-ttu-id="7d1fb-181">Таким образом, файлы JavaScript будут автоматически включены на всех страницах приложения.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-181">That way, the JavaScript files will be included in all of the pages in your application automatically.</span></span>

<span data-ttu-id="7d1fb-182">Добавьте следующий JavaScript &lt;&gt; включает в головную бирку страницы главной страницы просмотра:</span><span class="sxs-lookup"><span data-stu-id="7d1fb-182">Add the following JavaScript includes inside the &lt;head&gt; tag of your view master page:</span></span>

[!code-html[Main](iteration-7-add-ajax-functionality-cs/samples/sample1.html)]

## <a name="refactoring-the-index-view-to-use-ajax"></a><span data-ttu-id="7d1fb-183">Рефакторинг представления индекса для использования Ajax</span><span class="sxs-lookup"><span data-stu-id="7d1fb-183">Refactoring the Index View to use Ajax</span></span>

<span data-ttu-id="7d1fb-184">Начнем с изменения представления Индекса таким образом, чтобы нажатие на контактную группу обновляло только область представления, отображающего контакты.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-184">Let s start by modifying our Index view so that clicking a contact group only updates the region of the view that displays contacts.</span></span> <span data-ttu-id="7d1fb-185">Красная коробка на рисунке 1 содержит область, которую мы хотим обновить.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-185">The red box in Figure 1 contains the region that we want to update.</span></span>

<span data-ttu-id="7d1fb-186">[![Обновление только контактов](iteration-7-add-ajax-functionality-cs/_static/image1.jpg)](iteration-7-add-ajax-functionality-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="7d1fb-186">[![Updating only contacts](iteration-7-add-ajax-functionality-cs/_static/image1.jpg)](iteration-7-add-ajax-functionality-cs/_static/image1.png)</span></span>

<span data-ttu-id="7d1fb-187">**Рисунок 01**: Обновление только контактов[(Нажмите, чтобы просмотреть полноразмерное изображение](iteration-7-add-ajax-functionality-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="7d1fb-187">**Figure 01**: Updating only contacts([Click to view full-size image](iteration-7-add-ajax-functionality-cs/_static/image2.png))</span></span>

<span data-ttu-id="7d1fb-188">Первый шаг заключается в разделении части представления, которую мы хотим обновить асинхронно, на отдельный частичный (просмотр пользовательского управления).</span><span class="sxs-lookup"><span data-stu-id="7d1fb-188">The first step is to separate the part of the view that we want to update asynchronously into a separate partial (view user control).</span></span> <span data-ttu-id="7d1fb-189">Раздел представления индекса, отображающие таблицу контактов, был перемещен в частичный в листинге 1.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-189">The section of the Index view that displays the table of contacts has been moved into the partial in Listing 1.</span></span>

<span data-ttu-id="7d1fb-190">**Список 1 - Просмотры /Контакт/Контакт-Лист.ascx**</span><span class="sxs-lookup"><span data-stu-id="7d1fb-190">**Listing 1 - Views\Contact\ContactList.ascx**</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample2.aspx)]

<span data-ttu-id="7d1fb-191">Обратите внимание, что частичное в листинге 1 имеет иную модель, чем представление индекса.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-191">Notice that the partial in Listing 1 has a different model than the Index view.</span></span> <span data-ttu-id="7d1fb-192">Атрибут *«Наследуемые»* в&gt; директиве &lt;% означает, что частичное наследство&lt;&gt; от класса ViewUserControl Group.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-192">The *Inherits* attribute in the &lt;%@ Page %&gt; directive specifies that the partial inherits from the ViewUserControl&lt;Group&gt; class.</span></span>

<span data-ttu-id="7d1fb-193">Обновленное представление индекса содержится в листинге 2.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-193">The updated Index view is contained in Listing 2.</span></span>

<span data-ttu-id="7d1fb-194">**Список 2 - Просмотры »Контакт»Индекс.aspx**</span><span class="sxs-lookup"><span data-stu-id="7d1fb-194">**Listing 2 - Views\Contact\Index.aspx**</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample3.aspx)]

<span data-ttu-id="7d1fb-195">Есть две вещи, которые вы должны заметить об обновленном представлении в листинге 2.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-195">There are two things that you should notice about the updated view in Listing 2.</span></span> <span data-ttu-id="7d1fb-196">Во-первых, обратите внимание, что все содержимое, перемещенное в частичное, заменяется вызовом на Html.RenderPartial().</span><span class="sxs-lookup"><span data-stu-id="7d1fb-196">First, notice that all of the content moved into the partial is replaced with a call to Html.RenderPartial().</span></span> <span data-ttu-id="7d1fb-197">Метод Html.RenderPartial() вызывается при первом запросе представления индекса для отображения исходного набора контактов.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-197">The Html.RenderPartial() method is called when the Index view is first requested in order to display the initial set of contacts.</span></span>

<span data-ttu-id="7d1fb-198">Во-вторых, обратите внимание, что Html.ActionLink() используется для отображения контактных групп был заменен на Ajax.ActionLink().</span><span class="sxs-lookup"><span data-stu-id="7d1fb-198">Second, notice that the Html.ActionLink() used to display contact groups has been replaced with an Ajax.ActionLink().</span></span> <span data-ttu-id="7d1fb-199">Ajax.ActionLink () называется со следующими параметрами:</span><span class="sxs-lookup"><span data-stu-id="7d1fb-199">The Ajax.ActionLink() is called with the following parameters:</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample4.aspx)]

<span data-ttu-id="7d1fb-200">Первый параметр представляет текст для отображения для ссылки, второй параметр представляет значения маршрута, а третий параметр представляет параметры Ajax.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-200">The first parameter represents the text to display for the link, the second parameter represents the route values, and the third parameter represents the Ajax options.</span></span> <span data-ttu-id="7d1fb-201">В этом случае мы используем опцию UpdateTargetId &lt;Ajax, чтобы указать на тег HTML div,&gt; который мы хотим обновить после завершения запроса Ajax.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-201">In this case, we use the UpdateTargetId Ajax option to point to the HTML &lt;div&gt; tag that we want to update after the Ajax request completes.</span></span> <span data-ttu-id="7d1fb-202">Мы хотим обновить &lt;&gt; тег div с новым списком контактов.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-202">We want to update the &lt;div&gt; tag with the new list of contacts.</span></span>

<span data-ttu-id="7d1fb-203">Обновленный метод индекса () контроллера контакта содержится в листинге 3.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-203">The updated Index() method of the Contact controller is contained in Listing 3.</span></span>

<span data-ttu-id="7d1fb-204">**Список 3 - Контролеры/ContactController.cs (Метод индекса)**</span><span class="sxs-lookup"><span data-stu-id="7d1fb-204">**Listing 3 - Controllers\ContactController.cs (Index method)**</span></span>

[!code-csharp[Main](iteration-7-add-ajax-functionality-cs/samples/sample5.cs)]

<span data-ttu-id="7d1fb-205">Обновленное действие Индекса () условно возвращает одну из двух вещей.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-205">The updated Index() action conditionally returns one of two things.</span></span> <span data-ttu-id="7d1fb-206">Если действие Index() вызывается запросом Ajax, то контроллер возвращает частичное.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-206">If the Index() action is invoked by an Ajax request then the controller returns a partial.</span></span> <span data-ttu-id="7d1fb-207">В противном случае действие Индекса () возвращает все представление.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-207">Otherwise, the Index() action returns an entire view.</span></span>

<span data-ttu-id="7d1fb-208">Обратите внимание, что действию Index () не нужно возвращать как можно больше данных при вызове запроса Ajax.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-208">Notice that the Index() action does not need to return as much data when invoked by an Ajax request.</span></span> <span data-ttu-id="7d1fb-209">В контексте обычного запроса действие Индекса возвращает список всех контактных групп и выбранной контактной группы.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-209">In the context of a normal request, the Index action returns a list of all of the contact groups and the selected contact group.</span></span> <span data-ttu-id="7d1fb-210">В контексте запроса Ajax действие Index() возвращает только выбранную группу.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-210">In the context of an Ajax request, the Index() action returns only the selected group.</span></span> <span data-ttu-id="7d1fb-211">Ajax означает меньше работы на сервере базы данных.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-211">Ajax means less work on your database server.</span></span>

<span data-ttu-id="7d1fb-212">Наше измененное представление индекса работает в случае браузеров на уровне и уровнен.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-212">Our modified Index view works in the case of both uplevel and downlevel browsers.</span></span> <span data-ttu-id="7d1fb-213">Если вы нажмете контактную группу, и ваш браузер поддерживает JavaScript, то обновляется только область представления, содержащая список контактов.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-213">If you click a contact group, and your browser supports JavaScript, then only the region of the view that contains the list of contacts is updated.</span></span> <span data-ttu-id="7d1fb-214">Если, с другой стороны, ваш браузер не поддерживает JavaScript, то все представление обновляется.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-214">If, on the other hand, your browser does not support JavaScript, then the entire view is updated.</span></span>

<span data-ttu-id="7d1fb-215">У нашего обновленного представления индекса есть одна проблема.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-215">Our updated Index view has one problem.</span></span> <span data-ttu-id="7d1fb-216">При нажатии на контактную группу выбранная группа не выделяется.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-216">When you click a contact group, the selected group is not highlighted.</span></span> <span data-ttu-id="7d1fb-217">Поскольку список групп отображается за пределами региона, который обновляется во время запроса Ajax, правильная группа не выделяется.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-217">Because the list of groups is displayed outside of the region that is updated during an Ajax request, the right group does not get highlighted.</span></span> <span data-ttu-id="7d1fb-218">Мы исправим эту проблему в следующем разделе.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-218">We'll fix this issue in the next section.</span></span>

## <a name="adding-jquery-animation-effects"></a><span data-ttu-id="7d1fb-219">Добавление эффектов анимации j''ry</span><span class="sxs-lookup"><span data-stu-id="7d1fb-219">Adding jQuery Animation Effects</span></span>

<span data-ttu-id="7d1fb-220">Обычно при нажатии на ссылку на веб-странице можно использовать панель прогресса браузера, чтобы определить, активно ли браузер извлечения обновленного содержимого.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-220">Normally, when you click a link in a web page, you can use the browser progress bar to detect whether or not the browser is actively fetching the updated content.</span></span> <span data-ttu-id="7d1fb-221">С другой стороны, при выполнении запроса Ajax в строке прогресса браузера не отображает никакого прогресса.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-221">When performing an Ajax request, on the other hand, the browser progress bar does not show any progress.</span></span> <span data-ttu-id="7d1fb-222">Это может заставить пользователей нервничать.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-222">This can make users nervous.</span></span> <span data-ttu-id="7d1fb-223">Как вы знаете, является ли браузер заморожен?</span><span class="sxs-lookup"><span data-stu-id="7d1fb-223">How do you know whether the browser has frozen?</span></span>

<span data-ttu-id="7d1fb-224">Существует несколько способов, которые можно указать пользователю, что работа выполняется при выполнении запроса Ajax.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-224">There are several ways that you can indicate to a user that work is being performed while performing an Ajax request.</span></span> <span data-ttu-id="7d1fb-225">Один из подходов заключается в отображении простой анимации.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-225">One approach is to display a simple animation.</span></span> <span data-ttu-id="7d1fb-226">Например, можно исчезнуть из региона, когда начинается запрос Ajax, и исчезать в регионе по завершении запроса.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-226">For example, you can fade out a region when an Ajax request begins and fade in the region when the request completes.</span></span>

<span data-ttu-id="7d1fb-227">Для создания анимационных эффектов мы воспользуемся библиотекой j'wery, которая включена в структуру Microsoft ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-227">We'll use the jQuery library which is included with the Microsoft ASP.NET MVC framework, to create the animation effects.</span></span> <span data-ttu-id="7d1fb-228">Обновленное представление индекса содержится в листинге 4.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-228">The updated Index view is contained in Listing 4.</span></span>

<span data-ttu-id="7d1fb-229">**Список 4 - Просмотры »Контакт»Индекс.aspx**</span><span class="sxs-lookup"><span data-stu-id="7d1fb-229">**Listing 4 - Views\Contact\Index.aspx**</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample6.aspx)]

<span data-ttu-id="7d1fb-230">Обратите внимание, что обновленное представление индекса содержит три новые функции JavaScript.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-230">Notice that the updated Index view contains three new JavaScript functions.</span></span> <span data-ttu-id="7d1fb-231">Первые две функции используют j's'query, чтобы исчезнуть и исчезнуть в списке контактов при нажатии на новую контактную группу.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-231">The first two functions use jQuery to fade out and fade in the list of contacts when you click a new contact group.</span></span> <span data-ttu-id="7d1fb-232">Третья функция отображает сообщение об ошибке, когда запрос Ajax приводит к ошибке (например, тайм-аут сети).</span><span class="sxs-lookup"><span data-stu-id="7d1fb-232">The third function displays an error message when an Ajax request results in an error (for example, network timeout).</span></span>

<span data-ttu-id="7d1fb-233">Первая функция также заботится о выделении выбранной группы.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-233">The first function also takes care of highlighting the selected group.</span></span> <span data-ttu-id="7d1fb-234">Выбранный атрибут класса добавляется к родительскому элементу (элементу LI) нажатого элемента.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-234">A class= selected attribute is added to the parent element (the LI element) of the element clicked.</span></span> <span data-ttu-id="7d1fb-235">Опять же, j'c'еry упрощает выбор правильного элемента и добавление класса CSS.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-235">Again, jQuery makes it easy to select the right element and add the CSS class.</span></span>

<span data-ttu-id="7d1fb-236">Эти скрипты привязаны к групповым ссылкам с помощью параметра Ajax.ActionLink() AjaxOptions.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-236">These scripts are tied to the group links with the help of the Ajax.ActionLink() AjaxOptions parameter.</span></span> <span data-ttu-id="7d1fb-237">Обновленный вызов метода Ajax.ActionLink() выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="7d1fb-237">The updated Ajax.ActionLink() method call looks like this:</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample7.aspx)]

## <a name="adding-browser-history-support"></a><span data-ttu-id="7d1fb-238">Добавление поддержки истории браузера</span><span class="sxs-lookup"><span data-stu-id="7d1fb-238">Adding Browser History Support</span></span>

<span data-ttu-id="7d1fb-239">Обычно при нажатии на ссылку для обновления страницы история браузера обновляется.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-239">Normally, when you click a link to update a page, your browser history is updated.</span></span> <span data-ttu-id="7d1fb-240">Таким образом, вы можете нажать кнопку "Назад" браузера, чтобы вернуться назад во времени к предыдущему состоянию страницы.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-240">That way, you can click the browser Back button to move back in time to the previous state of the page.</span></span> <span data-ttu-id="7d1fb-241">Например, если вы нажмете контактную группу «Друзья», а затем нажмете на контактную группу «Бизнес», можно нажать кнопку «Назад» браузера, чтобы перейти к состоянию страницы при выборе контактной группы «Друзья».</span><span class="sxs-lookup"><span data-stu-id="7d1fb-241">For example, if you click the Friends contact group and then click the Business contact group, you can click the browser Back button to navigate back to the state of the page when the Friends contact group was selected.</span></span>

<span data-ttu-id="7d1fb-242">К сожалению, выполнение запроса Ajax не обновляет историю браузера автоматически.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-242">Unfortunately, performing an Ajax request does not update browser history automatically.</span></span> <span data-ttu-id="7d1fb-243">Если вы нажмете контактную группу, и список соответствующих контактов будет извлечен с помощью запроса Ajax, то история браузера не обновляется.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-243">If you click a contact group, and the list of matching contacts is retrieved with an Ajax request, then the browser history is not updated.</span></span> <span data-ttu-id="7d1fb-244">Вы не можете использовать кнопку "Назад" браузера для навигации обратно в контактную группу после выбора новой контактной группы.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-244">You cannot use the browser Back button to navigate back to a contact group after selecting a new contact group.</span></span>

<span data-ttu-id="7d1fb-245">Если вы хотите, чтобы пользователи могли использовать кнопку "Назад" браузера после выполнения запросов Ajax, то вам нужно выполнить немного больше работы.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-245">If you want users to be able to use the browser Back button after performing Ajax requests then you need to perform a little more work.</span></span> <span data-ttu-id="7d1fb-246">Вы должны воспользоваться функциональностью управления историей браузера, построенной в ASP.NET AJAX Framework.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-246">You need to take advantage of the browser history management functionality built in the ASP.NET AJAX Framework.</span></span>

<span data-ttu-id="7d1fb-247">ASP.NET истории браузера AJAX, вам нужно сделать три вещи:</span><span class="sxs-lookup"><span data-stu-id="7d1fb-247">ASP.NET AJAX browser history, you need to do three things:</span></span>

1. <span data-ttu-id="7d1fb-248">Включите историю браузера, установив свойство enableBrowserHistory на истину.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-248">Enable Browser History by setting the enableBrowserHistory property to true.</span></span>
2. <span data-ttu-id="7d1fb-249">Сохранение моментов истории при изменении состояния представления, вызывая метод addHistoryPoint()</span><span class="sxs-lookup"><span data-stu-id="7d1fb-249">Save history points when the state of a view changes by calling the addHistoryPoint() method.</span></span>
3. <span data-ttu-id="7d1fb-250">Восстановить состояние представления при поднятии события навигации.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-250">Reconstruct the state of the view when the navigate event is raised.</span></span>

<span data-ttu-id="7d1fb-251">Обновленное представление индекса содержится в листинге 5.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-251">The updated Index view is contained in Listing 5.</span></span>

<span data-ttu-id="7d1fb-252">**Список 5 - Просмотры »Контакт»Индекс.aspx**</span><span class="sxs-lookup"><span data-stu-id="7d1fb-252">**Listing 5 - Views\Contact\Index.aspx**</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample8.aspx)]

<span data-ttu-id="7d1fb-253">В листинге 5 история браузера включена в функции pageInit() .</span><span class="sxs-lookup"><span data-stu-id="7d1fb-253">In Listing 5, Browser History is enabled in the pageInit() function.</span></span> <span data-ttu-id="7d1fb-254">Функция pageInit() также используется для настройки обработчика событий для события навигации.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-254">The pageInit() function is also used to set up the event handler for the navigate event.</span></span> <span data-ttu-id="7d1fb-255">Событие навигации возникает всякий раз, когда кнопка «Вперед или назад» приводит к изменению состояния страницы.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-255">The navigate event is raised whenever the browser Forward or Back button causes the state of the page to change.</span></span>

<span data-ttu-id="7d1fb-256">Метод BeginContactList() вызывается при нажатии контактной группы.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-256">The beginContactList() method is called when you click a contact group.</span></span> <span data-ttu-id="7d1fb-257">Этот метод создает новую точку истории, вызывая метод addHistoryPoint()</span><span class="sxs-lookup"><span data-stu-id="7d1fb-257">This method creates a new history point by calling the addHistoryPoint() method.</span></span> <span data-ttu-id="7d1fb-258">Идентификатор нажмите контактную группу добавляется в историю.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-258">The id of the contact group clicked is added to history.</span></span>

<span data-ttu-id="7d1fb-259">Идентификатор группы извлекается из атрибута expando на ссылке контактной группы.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-259">The group id is retrieved from an expando attribute on the contact group link.</span></span> <span data-ttu-id="7d1fb-260">Ссылка отображается со следующим вызовом на Ajax.ActionLink().</span><span class="sxs-lookup"><span data-stu-id="7d1fb-260">The link is rendered with the following call to Ajax.ActionLink().</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample9.aspx)]

<span data-ttu-id="7d1fb-261">Последний параметр, передаваемый на Ajax.ActionLink() добавляет атрибут expando, названный groupid, к ссылке (нижний регистр для совместимости XHTML).</span><span class="sxs-lookup"><span data-stu-id="7d1fb-261">The last parameter passed to the Ajax.ActionLink() adds an expando attribute named groupid to the link (lowercase for XHTML compatibility).</span></span>

<span data-ttu-id="7d1fb-262">Когда пользователь направляется в кнопку «Назад» или «Вперед», событие навигации повышается и вызывается метод навигации()</span><span class="sxs-lookup"><span data-stu-id="7d1fb-262">When a user hits the browser Back or Forward button, the navigate event is raised and the navigate() method is called.</span></span> <span data-ttu-id="7d1fb-263">Этот метод обновляет контакты, отображаемые на странице, чтобы соответствовать состоянию страницы, которая соответствует точке истории браузера, передаваемым методу навигации.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-263">This method updates the contacts displayed in the page to match the state of the page that corresponds to the browser history point passed to the navigate method.</span></span>

## <a name="performing-ajax-deletes"></a><span data-ttu-id="7d1fb-264">Выполнение Ajax Удаляет</span><span class="sxs-lookup"><span data-stu-id="7d1fb-264">Performing Ajax Deletes</span></span>

<span data-ttu-id="7d1fb-265">В настоящее время для того, чтобы удалить контакт, необходимо нажать на ссылку Удалить, а затем нажмите кнопку Удалить отображается на странице подтверждения удаления (см. Рисунок 2).</span><span class="sxs-lookup"><span data-stu-id="7d1fb-265">Currently, in order to delete a contact, you need to click on the Delete link and then click the Delete button displayed in the delete confirmation page (see Figure 2).</span></span> <span data-ttu-id="7d1fb-266">Это кажется большим количеством запросов на страницы, чтобы сделать что-то простое, например, удалять запись базы данных.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-266">This seems like a lot of page requests to do something simple like deleting a database record.</span></span>

<span data-ttu-id="7d1fb-267">[![Страница подтверждения удаления](iteration-7-add-ajax-functionality-cs/_static/image2.jpg)](iteration-7-add-ajax-functionality-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="7d1fb-267">[![The delete confirmation page](iteration-7-add-ajax-functionality-cs/_static/image2.jpg)](iteration-7-add-ajax-functionality-cs/_static/image3.png)</span></span>

<span data-ttu-id="7d1fb-268">**Рисунок 02**: Страница подтверждения удаления[(Нажмите, чтобы просмотреть полноразмерное изображение)](iteration-7-add-ajax-functionality-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="7d1fb-268">**Figure 02**: The delete confirmation page([Click to view full-size image](iteration-7-add-ajax-functionality-cs/_static/image4.png))</span></span>

<span data-ttu-id="7d1fb-269">Заманчиво пропустить страницу подтверждения удаления и удалить контакт непосредственно из представления Индекса.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-269">It is tempting to skip the delete confirmation page and delete a contact directly from the Index view.</span></span> <span data-ttu-id="7d1fb-270">Вы должны избегать этого искушения, потому что при таком подходе открывает приложение для дыр в безопасности.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-270">You should avoid this temptation because taking this approach opens your application to security holes.</span></span> <span data-ttu-id="7d1fb-271">Как правило, вы не хотите выполнять операцию HTTP GET при входе в действие, которое изменяет состояние вашего веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-271">In general, you don t want to perform an HTTP GET operation when invoking an action that modifies the state of your web application.</span></span> <span data-ttu-id="7d1fb-272">При выполнении удаления требуется выполнить http POST, или еще лучше, http DELETE операции.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-272">When performing a delete, you want to perform an HTTP POST, or better yet, an HTTP DELETE operation.</span></span>

<span data-ttu-id="7d1fb-273">Ссылка «Удалить» содержится в частичном контактном листе.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-273">The Delete link is contained in the ContactList partial.</span></span> <span data-ttu-id="7d1fb-274">Обновленная версия частичного контакта содержится в листинге 6.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-274">An updated version of the ContactList partial is contained in Listing 6.</span></span>

<span data-ttu-id="7d1fb-275">**Список 6 - Просмотры /Контакт/КонтактЛист.ascx**</span><span class="sxs-lookup"><span data-stu-id="7d1fb-275">**Listing 6 - Views\Contact\ContactList.ascx**</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample10.aspx)]

<span data-ttu-id="7d1fb-276">Ссылка «Удалить» отображается следующим вызовом метода Ajax.ImageActionLink()</span><span class="sxs-lookup"><span data-stu-id="7d1fb-276">The Delete link is rendered with the following call to the Ajax.ImageActionLink() method:</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample11.aspx)]

> [!NOTE] 
> 
> <span data-ttu-id="7d1fb-277">Ajax.ImageActionLink() не является стандартной частью ASP.NET mVC.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-277">The Ajax.ImageActionLink() is not a standard part of the ASP.NET MVC framework.</span></span> <span data-ttu-id="7d1fb-278">Ajax.ImageActionLink() — это пользовательские методы помощи, включенные в проект «Контакт-менеджер».</span><span class="sxs-lookup"><span data-stu-id="7d1fb-278">The Ajax.ImageActionLink() is a custom helper methods included in the Contact Manager project.</span></span>

<span data-ttu-id="7d1fb-279">Параметр AjaxOptions имеет два свойства.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-279">The AjaxOptions parameter has two properties.</span></span> <span data-ttu-id="7d1fb-280">Во-первых, свойство «Подтверждение» используется для отображения диалога о подтверждении JavaScript всплывающих окно.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-280">First, the Confirm property is used to display a popup JavaScript confirmation dialog.</span></span> <span data-ttu-id="7d1fb-281">Во-вторых, свойство HttpMethod используется для выполнения операции HTTP DELETE.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-281">Second, the HttpMethod property is used to perform an HTTP DELETE operation.</span></span>

<span data-ttu-id="7d1fb-282">Список 7 содержит новое действие AjaxDelete(), добавленное в контроллер Контакта.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-282">Listing 7 contains a new AjaxDelete() action that has been added to the Contact controller.</span></span>

<span data-ttu-id="7d1fb-283">**Список 7 - Контролеры-КонтактКонтроллер.cs (AjaxDelete)**</span><span class="sxs-lookup"><span data-stu-id="7d1fb-283">**Listing 7 - Controllers\ContactController.cs (AjaxDelete)**</span></span>

[!code-csharp[Main](iteration-7-add-ajax-functionality-cs/samples/sample12.cs)]

<span data-ttu-id="7d1fb-284">Акция AjaxDelete() украшена атрибутом AcceptVerbs.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-284">The AjaxDelete() action is decorated with an AcceptVerbs attribute.</span></span> <span data-ttu-id="7d1fb-285">Этот атрибут предотвращает вызов действия, за исключением любой операции HTTP, кроме операции HTTP DELETE.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-285">This attribute prevents the action from being invoked except by any HTTP operation other than an HTTP DELETE operation.</span></span> <span data-ttu-id="7d1fb-286">В частности, вы не можете вызвать это действие с HTTP GET.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-286">In particular, you cannot invoke this action with an HTTP GET.</span></span>

<span data-ttu-id="7d1fb-287">После удаления записи базы данных необходимо отобразить обновленный список контактов, который не содержит удаленной записи.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-287">After you delete database record, you need to display the updated list of contacts that does not contain the deleted record.</span></span> <span data-ttu-id="7d1fb-288">Метод AjaxDelete () возвращает Частичное и обновленный список контактов ContactList.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-288">The AjaxDelete() method returns the ContactList partial and the updated list of contacts.</span></span>

## <a name="summary"></a><span data-ttu-id="7d1fb-289">Сводка</span><span class="sxs-lookup"><span data-stu-id="7d1fb-289">Summary</span></span>

<span data-ttu-id="7d1fb-290">В этой итерации мы добавили функциональность Ajax в наше приложение Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-290">In this iteration, we added Ajax functionality to our Contact Manager application.</span></span> <span data-ttu-id="7d1fb-291">Мы использовали Ajax для повышения оперативности и производительности нашего приложения.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-291">We used Ajax to improve the responsiveness and performance of our application.</span></span>

<span data-ttu-id="7d1fb-292">Во-первых, мы рефакторинг представления индекса, так что нажатие контактной группы не обновляет весь вид.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-292">First, we refactored the Index view so that clicking a contact group does not update the entire view.</span></span> <span data-ttu-id="7d1fb-293">Вместо этого нажатие на контактную группу обновляет список контактов только.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-293">Instead, clicking a contact group only updates the list of contacts.</span></span>

<span data-ttu-id="7d1fb-294">Далее, мы использовали j'wery анимационные эффекты, чтобы исчезнуть и исчезают в списке контактов.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-294">Next, we used jQuery animation effects to fade out and fade in the list of contacts.</span></span> <span data-ttu-id="7d1fb-295">Добавление анимации в приложение Ajax может быть использовано для предоставления пользователям приложения эквивалента панели прогресса браузера.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-295">Adding animation to an Ajax application can be used to provide users of the application with the equivalent of a browser progress bar.</span></span>

<span data-ttu-id="7d1fb-296">Мы также добавили поддержку истории браузера в наше приложение Ajax.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-296">We also added browser history support to our Ajax application.</span></span> <span data-ttu-id="7d1fb-297">Мы позволили пользователям нажать кнопки «Назад и вперед» для изменения состояния представления Индекса.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-297">We enabled users to click the browser Back and Forward buttons to change the state of the Index view.</span></span>

<span data-ttu-id="7d1fb-298">Наконец, мы создали ссылку на удаление, которая поддерживает операции HTTP DELETE.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-298">Finally, we created a delete link that supports HTTP DELETE operations.</span></span> <span data-ttu-id="7d1fb-299">Выполняя удаления Ajax, мы позволяем пользователям удалять записи баз данных, не требуя от пользователя запроса дополнительной страницы подтверждения удаления.</span><span class="sxs-lookup"><span data-stu-id="7d1fb-299">By performing Ajax deletes, we enable users to delete database records without requiring the user to request an additional delete confirmation page.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="7d1fb-300">[Назад](iteration-6-use-test-driven-development-cs.md)
> [Вперед](iteration-1-create-the-application-vb.md)</span><span class="sxs-lookup"><span data-stu-id="7d1fb-300">[Previous](iteration-6-use-test-driven-development-cs.md)
[Next](iteration-1-create-the-application-vb.md)</span></span>
