---
uid: mvc/overview/older-versions-1/contact-manager/iteration-1-create-the-application-cs
title: '#1 итерации — создание приложения (C#) | Документация Майкрософт'
author: microsoft
description: 'В первой итерации мы создаем Диспетчер контактов проще всего. Добавлена поддержка основных операций с базой данных: создание, чтение, обновление и D...'
ms.author: riande
ms.date: 02/20/2009
ms.assetid: db0f160b-901c-46d3-865e-7ab6cd4ed68d
msc.legacyurl: /mvc/overview/older-versions-1/contact-manager/iteration-1-create-the-application-cs
msc.type: authoredcontent
ms.openlocfilehash: d3a940308f21a4f87bf80249bd465e8812794f68
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78470268"
---
# <a name="iteration-1--create-the-application-c"></a>#1 итерации — создание приложения (C#)

по [Майкрософт](https://github.com/microsoft)

[Скачать код](iteration-1-create-the-application-cs/_static/contactmanager_1_cs1.zip)

> В первой итерации мы создаем Диспетчер контактов проще всего. Добавлена поддержка основных операций с базой данных: создание, чтение, обновление и удаление (CRUD).

## <a name="building-a-contact-management-aspnet-mvc-application-vb"></a>Создание приложения для управления контактами ASP.NET MVC (VB)

В этой серии учебников мы создадим все приложение управления контактами от начала до конца. Приложение диспетчера контактов позволяет хранить контактные данные, имена телефонов и адреса электронной почты. список людей.

Мы создаем приложение для нескольких итераций. При каждой итерации мы постепенно улучшаем приложение. Цель этого нескольких итераций — позволить вам понять причину каждого изменения.

- Итерация #1 — Создайте приложение. В первой итерации мы создаем Диспетчер контактов проще всего. Добавлена поддержка основных операций с базой данных: создание, чтение, обновление и удаление (CRUD).

- Итерация #2 — сделайте приложение привлекательным. В этой итерации мы улучшаем внешний вид приложения путем изменения главной страницы ASP.NET представления MVC по умолчанию и каскадной таблицы стилей.

- Итерация #3 — Добавление проверки формы. В третьей итерации мы добавим проверку базовой формы. Мы запрещаем пользователям отправлять форму, не заполняя обязательные поля формы. Мы также проверяем адреса электронной почты и номера телефонов.

- Итерация #4 — сделайте приложение слабо связанным. В этой четвертой итерации мы используем преимущества нескольких шаблонов проектирования программного обеспечения, чтобы упростить обслуживание и изменение приложения Contact Manager. Например, мы выполним рефакторинг нашего приложения для использования шаблона репозитория и шаблона внедрения зависимостей.

- Итерация #5 — Создание модульных тестов. В пятой итерации мы сделаем наше приложение проще в обслуживании и изменении, добавляя модульные тесты. Мы размакетирования наши классы модели данных и создаем модульные тесты для наших контроллеров и логики проверки.

- Итерация #6 — Используйте разработку на основе тестирования. В этой шестой итерации мы добавим новые функции в наше приложение, создав модульные тесты в первую очередь и записав код в модульные тесты. В этой итерации мы добавляем группы контактов.

- Итерация #7 — Добавление функциональности AJAX. В седьмой итерации мы улучшаем скорость реагирования и производительность нашего приложения, добавив поддержку AJAX.

## <a name="this-iteration"></a>Эта итерация

В первой итерации мы создаем базовое приложение. Целью является создание диспетчера контактов с самым быстрым и простым способом. В последующих итерациях мы улучшаем структуру приложения.

Приложение диспетчера контактов — это простое приложение, управляемое базой данных. Приложение можно использовать для создания новых контактов, изменения существующих контактов и удаления контактов.

В этой итерации мы выполнили следующие действия:

1. Приложение ASP.NET MVC
2. Создание базы данных для хранения контактов
3. Создание класса модели для нашей базы данных с помощью Entity Framework Майкрософт
4. Создайте действие контроллера и представление, которое позволяет вывести список всех контактов в базе данных.
5. Создание действий контроллера и представление, которое позволяет создать новый контакт в базе данных
6. Создание действий контроллера и представление, позволяющее изменять существующий контакт в базе данных
7. Создание действий контроллера и представление, которое позволяет удалить существующий контакт в базе данных

## <a name="software-prerequisites"></a>Обязательное программное обеспечение

В приложениях ASP.NET MVC необходимо установить Visual Studio 2008 или Visual Web Developer 2008 на компьютере (Visual Web Developer — это бесплатная версия Visual Studio, которая не включает все дополнительные возможности Visual Studio). Вы можете скачать пробную версию Visual Studio 2008 или Visual Web Developer по следующему адресу:

[https://www.asp.net/downloads/essential/](https://www.asp.net/downloads/essential)

> [!NOTE] 
> 
> Для приложений ASP.NET MVC с Visual Web Developer необходимо установить пакет обновления 1 для Visual Web Developer. Без пакета обновления 1 (SP1) нельзя создавать проекты веб-приложений.

Платформа MVC ASP.NET. Платформу ASP.NET MVC можно скачать по следующему адресу:

[https://www.asp.net/mvc](../../../index.md)

В этом руководстве мы используем Microsoft Entity Framework для доступа к базе данных. Entity Framework входит в состав .NET Framework 3,5 с пакетом обновления 1 (SP1). Этот пакет обновления можно загрузить по следующему адресу:

[https://www.microsoft.com/downloads/details.aspx?familyid=ab99342f-5d1a-413d-8319-81da479ab0d7&amp;d исплайланг = EN](https://www.microsoft.com/downloads/details.aspx?familyid=ab99342f-5d1a-413d-8319-81da479ab0d7&amp;displaylang=en)

В качестве альтернативы для выполнения каждой из этих загрузок по одному можно воспользоваться установщиком веб-платформы (Web PI). Веб-устройство Web PI можно загрузить по следующему адресу:

[https://www.asp.net/downloads/essential/](https://www.asp.net/downloads/essential)

## <a name="aspnet-mvc-project"></a>Проект ASP.NET MVC

Проект веб-приложения MVC ASP.NET. Запустите Visual Studio и выберите файл параметров меню **, новый проект**. Откроется диалоговое окно **Новый проект** (см. рис. 1). Выберите тип **веб-** проекта и шаблон **веб-приложения ASP.NET MVC** . Назовите новый проект *ContactManager* и нажмите кнопку ОК.

Убедитесь, что в раскрывающемся списке в правом верхнем углу диалогового окна " **Новый проект** " выбрано .NET Framework 3,5. В противном случае шаблон веб-приложения MVC ASP.NET не будет отображаться.

[![диалоговом окне «Создание проекта»](iteration-1-create-the-application-cs/_static/image1.jpg)](iteration-1-create-the-application-cs/_static/image1.png)

**Рис. 01**. диалоговое окно "новый проект" ([щелкните, чтобы просмотреть изображение с полным размером](iteration-1-create-the-application-cs/_static/image2.png))

ASP.NET MVC Application, откроется диалоговое окно **Создание проекта модульного теста** . Это диалоговое окно можно использовать, чтобы указать, что вы хотите создать проект модульного теста и добавить его в решение при создании приложения ASP.NET MVC. Несмотря на то, что в этой итерации не будут создаваться модульные тесты, следует выбрать параметр **Да, создать проект модульного теста** , так как мы планируем добавить модульные тесты в более позднюю итерацию. Добавление тестового проекта при первом создании нового проекта ASP.NET MVC намного проще, чем Добавление тестового проекта после создания проекта ASP.NET MVC.

> [!NOTE] 
> 
> Поскольку Visual Web Developer не поддерживает тестовые проекты, диалоговое окно Создание проекта модульного теста не появляется при использовании Visual Web Developer.

[![диалоговом окне «Создание проекта»](iteration-1-create-the-application-cs/_static/image2.jpg)](iteration-1-create-the-application-cs/_static/image3.png)

**Рис. 02**. диалоговое окно создания проекта модульного теста ([щелкните, чтобы просмотреть изображение с полным размером](iteration-1-create-the-application-cs/_static/image4.png))

Приложение ASP.NET MVC отображается в окне обозреватель решений Visual Studio (см. рис. 3). Если вы не видите окно обозреватель решений, то можете открыть это окно, выбрав пункт меню **, обозреватель решений**. Обратите внимание, что решение содержит два проекта: проект MVC ASP.NET и тестовый проект. Проект ASP.NET MVC называется ContactManager, а тестовый проект называется ContactManager. Tests.

[![диалоговом окне «Создание проекта»](iteration-1-create-the-application-cs/_static/image3.jpg)](iteration-1-create-the-application-cs/_static/image5.png)

**Рис. 03**. окно Обозреватель решений ([щелкните, чтобы просмотреть изображение с полным размером](iteration-1-create-the-application-cs/_static/image6.png))

## <a name="deleting-the-project-sample-files"></a>Удаление файлов примеров проекта

Шаблон проекта ASP.NET MVC содержит образцы файлов для контроллеров и представлений. Перед созданием нового приложения MVC ASP.NET следует удалить эти файлы. Вы можете удалить файлы и папки в окне обозреватель решений, щелкнув правой кнопкой мыши файл или папку и выбрав пункт меню **Удалить**.

Необходимо удалить следующие файлы из проекта ASP.NET MVC:

- \Controllers\HomeController.cs

- \Views\Home\About.aspx

- \Views\Home\Index.aspx

И необходимо удалить следующий файл из тестового проекта:

\Controllers\HomeControllerTest.cs

## <a name="creating-the-database"></a>Создание базы данных

Приложение диспетчера контактов — это управляемое базой данных веб-приложение. Для хранения контактных данных используется база данных.

Платформа MVC ASP.NET с любой современной базой данных, включая базы данных Microsoft SQL Server, Oracle, MySQL и IBM DB2. В этом руководстве используется база данных Microsoft SQL Server. При установке Visual Studio предоставляется возможность установки Microsoft SQL Server Express, которая является бесплатной версией базы данных Microsoft SQL Server.

Создайте новую базу данных, щелкнув правой кнопкой мыши папку "приложение\_данные" в окне обозреватель решений и выбрав пункт меню **Добавить, новый элемент**. В диалоговом окне **Добавление нового элемента** выберите категорию **данных** и шаблон **базы данных SQL Server** (см. рис. 4). Назовите новую базу данных Контактманажердб. mdf и нажмите кнопку ОК.

[![диалоговом окне «Создание проекта»](iteration-1-create-the-application-cs/_static/image4.jpg)](iteration-1-create-the-application-cs/_static/image7.png)

**Рис. 04**. Создание новой базы данных Microsoft SQL Server Express ([щелкните, чтобы просмотреть изображение с полным размером](iteration-1-create-the-application-cs/_static/image8.png))

После создания новой базы данных она появится в папке приложения\_данные в окне обозреватель решений. Дважды щелкните файл ContactManager. mdf, чтобы открыть окно обозреватель сервера и подключиться к базе данных.

> [!NOTE] 
> 
> Окно обозреватель сервера называется окном обозреватель базы данных в случае Microsoft Visual Web Developer.

Можно использовать окно обозреватель сервера для создания новых объектов базы данных, таких как таблицы базы данных, представления, триггеры и хранимые процедуры. Щелкните правой кнопкой мыши папку таблицы и выберите пункт меню **Добавить новую таблицу**. Появится конструктор таблиц базы данных (см. рис. 5).

[![диалоговом окне «Создание проекта»](iteration-1-create-the-application-cs/_static/image5.jpg)](iteration-1-create-the-application-cs/_static/image9.png)

**Рис. 05**. конструктор таблиц базы данных ([щелкните, чтобы просмотреть изображение с полным размером](iteration-1-create-the-application-cs/_static/image10.png))

Необходимо создать таблицу, содержащую следующие столбцы:

<a id="0.1_table01"></a>

| **Имя столбца** | **Тип данных** | **Разрешить значения NULL** |
| --- | --- | --- |
| Идентификатор | INT | false |
| FirstName | nvarchar(50) | false |
| LastName | nvarchar(50) | false |
| Номер телефона | nvarchar(50) | false |
| Email | nvarchar(255) | false |

Первый столбец, столбец ID, является специальным. Столбец идентификаторов необходимо пометить как столбец идентификаторов и столбец первичного ключа. Чтобы указать, что столбец является столбцом идентификаторов, разверните свойства столбца (см. конец рис. 6) и прокрутите вниз до свойства Спецификация идентификатора. Задайте для свойства **(является идентификатором)** значение **Да**.

Чтобы пометить столбец как первичный ключевой столбец, выберите столбец и нажмите кнопку с значком ключа. После того как столбец помечен как первичный ключевой столбец, рядом со столбцом появится значок ключа (см. рис. 6).

После завершения создания таблицы нажмите кнопку Сохранить (кнопку со значком дискеты), чтобы сохранить новую таблицу. Присвойте новой таблице имя *Contacts*.

После завершения создания таблицы Contacts базы данных необходимо добавить в нее некоторые записи. Щелкните правой кнопкой мыши таблицу Контакты в окне обозреватель сервера и выберите пункт меню **отобразить данные таблицы**. В появившейся сетке введите один или несколько контактов.

## <a name="creating-the-data-model"></a>Создание модели данных

Приложение ASP.NET MVC состоит из моделей, представлений и контроллеров. Начнем с создания класса Model, который представляет таблицу Contacts, созданную в предыдущем разделе.

В этом руководстве мы используем Entity Framework Майкрософт для автоматического создания класса модели из базы данных.

> [!NOTE] 
> 
> Платформа ASP.NET MVC не привязана к Microsoft Entity Framework каким-либо образом. ASP.NET MVC можно использовать с альтернативными технологиями доступа к базам данных, включая NHibernate, LINQ to SQL или ADO.NET.

Чтобы создать классы модели данных, выполните следующие действия.

1. Щелкните правой кнопкой мыши папку модели в окне обозреватель решений и выберите **Добавить, новый элемент**. Откроется диалоговое окно **Добавление нового элемента** (см. рис. 6).
2. Выберите категорию **данных** и шаблон **EDM ADO.NET** . Назовите модель данных *контактманажермодел. EDMX* и нажмите кнопку **Добавить** . Появится мастер EDM (см. рис. 7).
3. На шаге **Выбор содержимого модели** выберите **создать из базы данных** (см. рис. 7).
4. На шаге **Выбор подключения к данным** выберите базу данных контактманажердб. mdf и введите имя *Контактманажердбентитиес* для параметров подключения сущности (см. рис. 8).
5. На шаге **Выбор объектов базы данных** установите флажок помеченные таблицы (см. рис. 9). Модель данных будет включать все таблицы, содержащиеся в базе данных (существует только одна таблица Contacts). Введите *модели*пространства имен. Нажмите кнопку "Готово", чтобы завершить работу мастера.

[![диалоговом окне «Создание проекта»](iteration-1-create-the-application-cs/_static/image6.jpg)](iteration-1-create-the-application-cs/_static/image11.png)

**Рис. 06**. диалоговое окно "Добавление нового элемента" ([щелкните, чтобы просмотреть изображение с полным размером](iteration-1-create-the-application-cs/_static/image12.png))

[![диалоговом окне «Создание проекта»](iteration-1-create-the-application-cs/_static/image7.jpg)](iteration-1-create-the-application-cs/_static/image13.png)

**Рис. 07**. Выбор содержимого модели ([щелкните, чтобы просмотреть изображение с полным размером](iteration-1-create-the-application-cs/_static/image14.png))

[![диалоговом окне «Создание проекта»](iteration-1-create-the-application-cs/_static/image8.jpg)](iteration-1-create-the-application-cs/_static/image15.png)

**Рис. 08**. Выбор подключения к данным ([щелкните, чтобы просмотреть изображение с полным размером](iteration-1-create-the-application-cs/_static/image16.png))

[![диалоговом окне «Создание проекта»](iteration-1-create-the-application-cs/_static/image9.jpg)](iteration-1-create-the-application-cs/_static/image17.png)

**Рис. 09**. Выбор объектов базы данных ([щелкните, чтобы просмотреть изображение с полным размером](iteration-1-create-the-application-cs/_static/image18.png))

После завершения работы мастера EDM откроется конструктор EDM. Конструктор отображает класс, соответствующий каждой модели таблицы. Вы увидите один класс с именем Contacts.

Мастер EDM создает имена классов на основе имен таблиц базы данных. Почти всегда нужно изменять имя класса, созданного мастером. Щелкните правой кнопкой мыши класс Contacts в конструкторе и выберите пункт меню **Переименовать**. Измените имя класса с Contacts (plural) на Contact (единственное). После изменения имени класса класс должен выглядеть примерно так, как показано на рис. 10.

[![диалоговом окне «Создание проекта»](iteration-1-create-the-application-cs/_static/image10.jpg)](iteration-1-create-the-application-cs/_static/image19.png)

**Рис. 10**. класс Contact ([щелкните, чтобы просмотреть изображение с полным размером](iteration-1-create-the-application-cs/_static/image20.png))

На этом этапе мы создали нашу модель базы данных. Мы можем использовать класс Contact для представления определенной записи контакта в нашей базе данных.

## <a name="creating-the-home-controller"></a>Создание контроллера Home

Следующим шагом является создание нашего контроллера Home. Контроллер Home является контроллером по умолчанию, вызванным в приложении MVC ASP.NET.

Создайте класс контроллера Home, щелкнув правой кнопкой мыши папку Controllers в окне обозреватель решений и выбрав пункт меню **Добавить, контроллер** (см. рис. 11). Обратите внимание на флажок **добавить методы действий для сценариев создания, обновления и подробностей**. Убедитесь, что этот флажок установлен, прежде чем нажать кнопку **Добавить** .

[![диалоговом окне «Создание проекта»](iteration-1-create-the-application-cs/_static/image11.jpg)](iteration-1-create-the-application-cs/_static/image21.png)

**Рис. 11**. Добавление контроллера Home ([щелкните, чтобы просмотреть изображение с полным размером](iteration-1-create-the-application-cs/_static/image22.png))

При создании контроллера Home вы получаете класс в листинге 1.

**Листинг 1. Controllers\HomeController.cs**

[!code-csharp[Main](iteration-1-create-the-application-cs/samples/sample1.cs)]

## <a name="listing-the-contacts"></a>Список контактов

Чтобы отобразить записи в таблице базы данных Contacts, необходимо создать действие index () и представление индекса.

Контроллер Home уже содержит действие index (). Необходимо изменить этот метод так, чтобы он выглядел как листинг 2.

**Листинг 2. Controllers\HomeController.cs**

[!code-csharp[Main](iteration-1-create-the-application-cs/samples/sample2.cs)]

Обратите внимание, что класс контроллера Home в листинге 2 содержит закрытое поле с именем \_Entities. Поле \_Entities (сущности) представляет сущности из модели данных. Для взаимодействия с базой данных используется поле \_ные сущности.

Метод Index () возвращает представление, представляющее все контакты из таблицы базы данных Contacts. Выражение \_сущности. Contact. ToList () возвращает список контактов в виде универсального списка.

Теперь, когда мы создали контроллер индекса, необходимо создать представление индекса. Перед созданием представления индекса скомпилируйте приложение, выбрав пункт меню **Сборка, построить решение**. Необходимо всегда компилировать проект перед добавлением представления, чтобы список классов модели отображался в диалоговом окне **Добавление представления** .

Чтобы создать представление индекса, щелкните правой кнопкой мыши метод Index () и выберите пункт меню **Добавить представление** (см. рис. 12). При выборе этого пункта меню открывается диалоговое окно **Добавление представления** (см. рис. 13).

[![диалоговом окне «Создание проекта»](iteration-1-create-the-application-cs/_static/image12.jpg)](iteration-1-create-the-application-cs/_static/image23.png)

**Рис. 12**. Добавление представления индекса ([щелкните, чтобы просмотреть изображение с полным размером](iteration-1-create-the-application-cs/_static/image24.png))

В диалоговом окне **Добавление представления** установите флажок **создать строго типизированное представление**. Выберите класс View Data ContactManager. Models. Contact и просмотрите список содержимое. При выборе этих параметров создается представление, в котором отображается список записей контактов.

[![диалоговом окне «Создание проекта»](iteration-1-create-the-application-cs/_static/image13.jpg)](iteration-1-create-the-application-cs/_static/image25.png)

**Рис. 13**. диалоговое окно добавления представления ([щелкните, чтобы просмотреть изображение с полным размером](iteration-1-create-the-application-cs/_static/image26.png))

При нажатии кнопки **Добавить** создается представление индекса в листинге 3. Обратите внимание на директиву &lt;% @ Page%&gt;, которая отображается в верхней части файла. Представление индекса наследуется от класса СтраницаПредставления&lt;IEnumerable&lt;ContactManager. Models. Contact&gt;&gt;. Иными словами, класс модели в представлении представляет список сущностей Contact.

Текст представления индекса содержит цикл foreach, который выполняет итерацию всех контактов, представленных классом Model. Значение каждого свойства класса Contact отображается в таблице HTML.

**Листинг 3 — Виевс\хоме\индекс.аспкс (без изменений)**

[!code-aspx[Main](iteration-1-create-the-application-cs/samples/sample3.aspx)]

Необходимо внести одно изменение в представление индекса. Так как мы не создаем представление сведений, можно удалить ссылку сведения. Найдите и удалите следующий код из представления индекса:

{ID = элемент. Идентификатор})%&gt;

После изменения представления индекса можно запустить приложение диспетчера контактов. Выберите пункт меню Отладка, начать отладку или просто нажмите клавишу F5. При первом запуске приложения появится диалоговое окно на рис. 14. Выберите параметр **изменить файл Web. config, чтобы включить отладку** , и нажмите кнопку ОК.

[![диалоговом окне «Создание проекта»](iteration-1-create-the-application-cs/_static/image14.jpg)](iteration-1-create-the-application-cs/_static/image27.png)

**Рис. 14**. Включение отладки ([щелкните, чтобы просмотреть изображение с полным размером](iteration-1-create-the-application-cs/_static/image28.png))

По умолчанию возвращается представление индекса. В этом представлении перечислены все данные из таблицы базы данных Contacts (см. рис. 15).

[![диалоговом окне «Создание проекта»](iteration-1-create-the-application-cs/_static/image15.jpg)](iteration-1-create-the-application-cs/_static/image29.png)

**Рис. 15**. представление индекса ([щелкните, чтобы просмотреть изображение с полным размером](iteration-1-create-the-application-cs/_static/image30.png))

Обратите внимание, что представление индекса содержит ссылку создать новый в нижней части представления. В следующем разделе вы узнаете, как создавать новые контакты.

## <a name="creating-new-contacts"></a>Создание новых контактов

Чтобы позволить пользователям создавать новые контакты, необходимо добавить два действия Create () к контроллеру Home. Необходимо создать одно действие Create (), которое возвращает HTML-форму для создания нового контакта. Необходимо создать второе действие Create (), которое выполняет фактическую вставку нового контакта в базу данных.

Новые методы Create (), которые необходимо добавить в контроллер Home, содержатся в листинге 4.

**Листинг 4 — Controllers\HomeController.cs (с методами Create)**

[!code-csharp[Main](iteration-1-create-the-application-cs/samples/sample4.cs)]

Первый метод Create () может быть вызван с помощью метода HTTP GET, а второй метод Create () может быть вызван только запросом HTTP POST. Иными словами, второй метод Create () может быть вызван только при публикации HTML-формы. Первый метод Create () просто возвращает представление, содержащее HTML-форму для создания нового контакта. Второй метод Create () является гораздо более интересным: он добавляет новый контакт в базу данных.

Обратите внимание, что второй метод Create () был изменен для принятия экземпляра класса Contact. Значения формы, опубликованные из HTML-формы, автоматически привязываются к этому классу ASP.NET платформы MVC. Каждое поле формы из формы создания HTML присваивается свойству параметра Contact.

Обратите внимание, что параметр Contact снабжен атрибутом [BIND]. Атрибут [BIND] используется для исключения свойства "идентификатор контакта" из привязки. Поскольку свойство ID представляет свойство Identity, нам не нужно задавать свойство ID.

В теле метода Create () Entity Framework используется для вставки нового контакта в базу данных. Новый контакт добавляется в существующий набор контактов, и вызывается метод SaveChanges (), чтобы вернуть эти изменения в основную базу данных.

Вы можете создать HTML-форму для создания новых контактов, щелкнув правой кнопкой мыши один из двух методов create () и выбрав пункт меню **Добавить представление** (см. рис. 16).

[![диалоговом окне «Создание проекта»](iteration-1-create-the-application-cs/_static/image16.jpg)](iteration-1-create-the-application-cs/_static/image31.png)

**Рис. 16**. Добавление представления создания ([щелкните, чтобы просмотреть изображение с полным размером](iteration-1-create-the-application-cs/_static/image32.png))

В диалоговом окне **Добавление представления** выберите класс **ContactManager. Models. Contact** и параметр **создать** для просмотра содержимого (см. рис. 17). При нажатии кнопки " **Добавить** " автоматически создается представление создания.

[![диалоговом окне «Создание проекта»](iteration-1-create-the-application-cs/_static/image17.jpg)](iteration-1-create-the-application-cs/_static/image33.png)

**Рис. 17**. Просмотр развернутой страницы ([щелкните, чтобы просмотреть изображение с полным размером](iteration-1-create-the-application-cs/_static/image34.png))

Представление создать содержит поля формы для каждого свойства класса Contact. Код для представления создания включается в листинг 5.

**Листинг 5. Виевс\хоме\креате.аспкс**

[!code-aspx[Main](iteration-1-create-the-application-cs/samples/sample5.aspx)]

После изменения методов create () и добавления представления создания можно запустить приложение диспетчера контактов и создать новые контакты. Щелкните ссылку **создать** , которая отображается в представлении индекса, чтобы перейти к представлению создать. Представление показано на рис. 18.

[![диалоговом окне «Создание проекта»](iteration-1-create-the-application-cs/_static/image18.jpg)](iteration-1-create-the-application-cs/_static/image35.png)

**Рис. 18**. представление создания ([щелкните, чтобы просмотреть изображение с полным размером](iteration-1-create-the-application-cs/_static/image36.png))

## <a name="editing-contacts"></a>Изменение контактов

Добавление функциональных возможностей для изменения записи контакта очень похоже на добавление функций для создания новых записей контактов. Сначала необходимо добавить два новых метода изменения в класс контроллера Home. Эти новые методы Edit () содержатся в листинге 6.

**Листинг 6-Controllers\HomeController.cs (с методами Edit)**

[!code-csharp[Main](iteration-1-create-the-application-cs/samples/sample6.cs)]

Первый метод Edit () вызывается операцией HTTP GET. В этот метод передается параметр идентификатора, который представляет идентификатор изменяемой записи контакта. Entity Framework используется для получения контакта, соответствующего идентификатору. Возвращается представление, содержащее HTML-форму для редактирования записи.

Второй метод Edit () выполняет фактическое обновление базы данных. Этот метод принимает экземпляр класса Contact в качестве параметра. Платформа ASP.NET MVC автоматически привязывает поля формы из формы редактирования к этому классу. Обратите внимание, что при редактировании контакта атрибут [BIND] не включается (требуется значение свойства ID).

Entity Framework используется для сохранения измененного контакта в базе данных. Сначала необходимо получить исходный контакт из базы данных. Затем вызывается метод Entity Framework Апплипропертичанжес () для записи изменений контакта. Наконец, вызывается метод Entity Framework SaveChanges () для сохранения изменений в основной базе данных.

Можно создать представление, содержащее форму редактирования, щелкнув правой кнопкой мыши метод Edit () и выбрав пункт меню Добавить представление. В диалоговом окне Добавление представления выберите класс **ContactManager. Models. Contact** и содержимое представления **редактирования** (см. рис. 19).

[![диалоговом окне «Создание проекта»](iteration-1-create-the-application-cs/_static/image19.jpg)](iteration-1-create-the-application-cs/_static/image37.png)

**Рис. 19**. Добавление представления редактирования ([щелкните, чтобы просмотреть изображение с полным размером](iteration-1-create-the-application-cs/_static/image38.png))

При нажатии кнопки Добавить новое представление редактирования создается автоматически. Создаваемая HTML-форма содержит поля, соответствующие каждому свойству класса Contact (см. листинг 7).

**Листинг 7 — Виевс\хоме\едит.аспкс**

[!code-aspx[Main](iteration-1-create-the-application-cs/samples/sample7.aspx)]

## <a name="deleting-contacts"></a>Удаление контактов

Если вы хотите удалить контакты, необходимо добавить два действия Delete () в класс контроллера Home. Первое действие Удалить () отображает форму подтверждения удаления. Второе действие DELETE () выполняет фактическое удаление.

> [!NOTE] 
> 
> Позже, в #7 итерации мы изменим Диспетчер контактов таким образом, чтобы он поддерживал один шаг удаления AJAX.

Два новых метода Delete () содержатся в листинге 8.

**Листинг 8 — Controllers\HomeController.cs (методы DELETE)**

[!code-csharp[Main](iteration-1-create-the-application-cs/samples/sample8.cs)]

Первый метод Delete () Возвращает форму подтверждения удаления записи контакта из базы данных (см. Figure20). Второй метод Delete () выполняет фактическую операцию удаления с базой данных. После получения исходного контакта из базы данных вызываются методы Entity Framework DeleteObject () и SaveChanges () для выполнения удаления базы данных.

[![диалоговом окне «Создание проекта»](iteration-1-create-the-application-cs/_static/image20.jpg)](iteration-1-create-the-application-cs/_static/image39.png)

**Рис. 20**. представление подтверждения удаления ([щелкните, чтобы просмотреть изображение с полным размером](iteration-1-create-the-application-cs/_static/image40.png))

Необходимо изменить представление индекса таким образом, чтобы оно содержало ссылку для удаления записей контактов (см. рис. 21). Необходимо добавить следующий код в ту же ячейку таблицы, которая содержит ссылку Edit:

HTML. ActionLink ({ID = Item. Идентификатор})%&gt;

[![диалоговом окне «Создание проекта»](iteration-1-create-the-application-cs/_static/image21.jpg)](iteration-1-create-the-application-cs/_static/image41.png)

**Рис. 21**. представление индекса с ссылкой для редактирования ([щелкните, чтобы просмотреть изображение с полным размером](iteration-1-create-the-application-cs/_static/image42.png))

Далее необходимо создать представление подтверждения удаления. Щелкните правой кнопкой мыши метод Delete () в классе контроллера Home и выберите пункт меню Добавить представление. Откроется диалоговое окно Добавление представления (см. рис. 22).

В отличие от представления списка, создания и изменения представлений, диалоговое окно Добавление представления не содержит параметр для создания представления удаления. Вместо этого выберите класс данных **ContactManager. Models. Contact** и **пустое** содержимое представления. Если выбрать параметр пустое представление содержимого, то нам потребуется создать представление.

[![диалоговом окне «Создание проекта»](iteration-1-create-the-application-cs/_static/image22.jpg)](iteration-1-create-the-application-cs/_static/image43.png)

**Рис. 22**. Добавление представления подтверждения удаления ([щелкните, чтобы просмотреть изображение с полным размером](iteration-1-create-the-application-cs/_static/image44.png))

Содержимое представления удаления содержится в листинге 9. Это представление содержит форму, которая подтверждает, следует ли удалить конкретный контакт (см. рис. 21).

**Листинг 9. Виевс\хоме\делете.аспкс**

[!code-aspx[Main](iteration-1-create-the-application-cs/samples/sample9.aspx)]

## <a name="changing-the-name-of-the-default-controller"></a>Изменение имени контроллера по умолчанию

Может возникнуть необходимость в том, что имя нашего класса контроллера для работы с контактами называется классом HomeController. Не следует ли контроллеру называться Контактконтроллер?

Эта проблема достаточно проста для исправления. Сначала необходимо выполнить рефакторинг имени контроллера Home. Откройте класс HomeController в редакторе Visual Studio Code, щелкните правой кнопкой мыши имя класса и выберите пункт меню **Рефакторинг, переименовать**. При выборе этого пункта меню открывается диалоговое окно Переименование.

[![диалоговом окне «Создание проекта»](iteration-1-create-the-application-cs/_static/image23.jpg)](iteration-1-create-the-application-cs/_static/image45.png)

**Рис. 23**. рефакторинг имени контроллера ([щелкните, чтобы просмотреть изображение с полным размером](iteration-1-create-the-application-cs/_static/image46.png))

[![диалоговом окне «Создание проекта»](iteration-1-create-the-application-cs/_static/image24.jpg)](iteration-1-create-the-application-cs/_static/image47.png)

**Рис. 24**. Использование диалогового окна переименования ([щелкните, чтобы просмотреть изображение с полным размером](iteration-1-create-the-application-cs/_static/image48.png))

При переименовании класса контроллера Visual Studio также обновит имя папки в папке Views. Visual Studio переименует папку \Виевс\хоме в папку \Виевс\контакт.

После внесения этого изменения приложение больше не будет иметь домашнего контроллера. При запуске приложения вы получите страницу ошибки на рис. 25.

[![диалоговом окне «Создание проекта»](iteration-1-create-the-application-cs/_static/image25.jpg)](iteration-1-create-the-application-cs/_static/image49.png)

**Рис. 25**. отсутствие контроллера по умолчанию ([щелкните, чтобы просмотреть изображение с полным размером](iteration-1-create-the-application-cs/_static/image50.png))

Необходимо обновить маршрут по умолчанию в файле Global. asax, чтобы использовать контроллер контакта вместо контроллера Home. Откройте файл Global. asax и измените контроллер по умолчанию, используемый маршрутом по умолчанию (см. список 10).

**Листинг 10 — Global.asax.cs**

[!code-csharp[Main](iteration-1-create-the-application-cs/samples/sample10.cs)]

После внесения этих изменений Диспетчер контактов будет работать правильно. Теперь он будет использовать класс контроллера контакта в качестве контроллера по умолчанию.

## <a name="summary"></a>Сводка

В этой первой итерации мы создали базовое приложение диспетчера контактов на максимально быстром способе. Мы использовали преимущества Visual Studio для автоматического создания исходного кода для наших контроллеров и представлений. Мы также использовали преимущества Entity Framework для автоматического создания классов моделей баз данных.

Сейчас мы можем перечислить, создавать, изменять и удалять записи контактов с помощью приложения диспетчера контактов. Иными словами, можно выполнять все основные операции с базой данных, необходимые для веб-приложения, управляемого базой данных.

Увы, у нашего приложения есть проблемы. Во-первых, я не думаю, что приложение диспетчера контактов не является самым привлекательным приложением. Это требует некоторой работы по проектированию. В следующей итерации мы рассмотрим, как можно изменить главную страницу представления по умолчанию и каскадную таблицу стилей, чтобы улучшить внешний вид приложения.

Во вторых, мы не реализовали проверку форм. Например, нет ничего препятствовать отправке формы создания контакта, не вводя значения для каких-либо полей формы. Кроме того, можно ввести недопустимые номера телефонов и адреса электронной почты. Мы начнем с проблемы проверки формы в #3 итерации.

Наконец, и самое важное, текущая итерация приложения диспетчера контактов не может быть легко изменена или сохранена. Например, логика доступа к базе данных помогут прямо в действия контроллера. Это означает, что мы не можем изменить код доступа к данным, не изменяя наши контроллеры. В последующих итерациях мы рассмотрим шаблоны разработки программного обеспечения, которые мы можем реализовать, чтобы сделать Диспетчер контактов более устойчивым для изменения.

> [!div class="step-by-step"]
> [Дальше](iteration-2-make-the-application-look-nice-cs.md)
