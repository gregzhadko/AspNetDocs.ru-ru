---
uid: mvc/overview/older-versions-1/contact-manager/iteration-1-create-the-application-cs
title: '#1 итерации - Создайте приложение (C) Документы Майкрософт'
author: rick-anderson
description: 'В первой итерации мы создаем Контакт-менеджер самым простым способом. Мы добавляем поддержку для основных операций базы данных: Создание, Чтение, Обновление и D...'
ms.author: riande
ms.date: 02/20/2009
ms.assetid: db0f160b-901c-46d3-865e-7ab6cd4ed68d
msc.legacyurl: /mvc/overview/older-versions-1/contact-manager/iteration-1-create-the-application-cs
msc.type: authoredcontent
ms.openlocfilehash: ecc3c1201c784e20c6b2601735bee3d4ce721f22
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2020
ms.locfileid: "81542551"
---
# <a name="iteration-1--create-the-application-c"></a>Итерация 1. Создание приложения (C#)

[корпорацией Майкрософт](https://github.com/microsoft)

[Скачать код](iteration-1-create-the-application-cs/_static/contactmanager_1_cs1.zip)

> В первой итерации мы создаем Контакт-менеджер самым простым способом. Мы добавляем поддержку для основных операций базы данных: Создание, чтение, обновление и удаление (CRUD).

## <a name="building-a-contact-management-aspnet-mvc-application-vb"></a>Создание приложения управления контактами ASP.NET MVC (VB)

В этой серии учебников мы создаем все приложение Управления Контактами от начала до конца. Приложение Contact Manager позволяет хранить контактную информацию - имена, номера телефонов и адреса электронной почты - для списка людей.

Мы строим приложение по нескольким итерациям. С каждой итерацией мы постепенно совершенствуем приложение. Цель этого подхода с множественной итерацией состоит в том, чтобы вы могли понять причину каждого изменения.

- Итерация #1 - Создайте приложение. В первой итерации мы создаем Контакт-менеджер самым простым способом. Мы добавляем поддержку для основных операций базы данных: Создание, чтение, обновление и удаление (CRUD).

- Итерация #2 - Сделать приложение хорошо выглядеть. В этой итерации мы улучшаем внешний вид приложения, изменяя страницу по умолчанию ASP.NET MVC просмотра и каскадный стиль листа.

- Итерация #3 - Добавить проверку формы. В третьей итерации мы добавляем базовую проверку формы. Мы не позволяем людям подавать форму без заполнения требуемых полей формы. Мы также проверяем адреса электронной почты и номера телефонов.

- Итерация #4 - Сделать приложение слабо связаны. В этой четвертой итерации мы воспользуемся несколькими шаблонами проектирования программного обеспечения, чтобы упростить обслуживание и изменение приложения Contact Manager. Например, мы рефакторизуем наше приложение, чтобы использовать шаблон репозитория и шаблон инъекций зависимостей.

- Итерация #5 - Создание модульных тестов. В пятой итерации мы упрощаем обслуживание и модификацию нашего приложения путем добавления модульных тестов. Мы издеваемся над нашими классами моделей данных и строим модульные тесты для наших контроллеров и логики проверки.

- Итерация #6 - Использование тест-ориентированной разработки. В этой шестой итерации мы добавляем новую функциональность в наше приложение, написав модульные тесты сначала и написав код против модульных тестов. В этой итерации мы добавляем контактные группы.

- Итерация #7 - Добавить функциональность Ajax. В седьмой итерации мы улучшаем отзывчивость и производительность нашего приложения, добавляя поддержку Ajax.

## <a name="this-iteration"></a>Эта итерация

В этой первой итерации мы создаем базовое приложение. Цель состоит в том, чтобы построить контактный менеджер самым быстрым и простым способом. В более поздних итерациях мы улучшаем дизайн приложения.

Приложение Contact Manager — это базовое приложение, управляемое базой данных. Приложение можно использовать для создания новых контактов, отсечения существующих контактов и удаления контактов.

В этой итерации мы завершаем следующие шаги:

1. ASP.NET приложение MVC
2. Создание базы данных для хранения контактов
3. Создание класса моделей для нашей базы данных с помощью рамочной системы сущности Майкрософт
4. Создайте действие контроллера и представление, которое позволяет нам перечислить все контакты в базе данных
5. Создание действий контроллера и представления, которое позволяет нам создать новый контакт в базе данных
6. Создание действий контроллера и представления, которое позволяет нам отсеивать существующий контакт в базе данных
7. Создание действий контроллера и представления, которое позволяет нам удалить существующий контакт в базе данных

## <a name="software-prerequisites"></a>Обязательное программное обеспечение

В ASP.NET приложенияm MVC, вы должны иметь либо Visual Studio 2008 или Visual Web Developer 2008 установлен на вашем компьютере (Visual Web Developer является бесплатной версией Visual Studio, которая не включает в себя все расширенные функции Visual Studio). Вы можете скачать либо пробную версию Visual Studio 2008, либо Visual Web Developer со следующего адреса:

[https://www.asp.net/downloads/essential/](https://www.asp.net/downloads/essential)

> [!NOTE] 
> 
> Для ASP.NET приложений MVC с visual Web Developer необходимо установить набор служб визуальных веб-разработчиков 1. Без пакета услуг 1 невозможно создавать веб-приложения.

ASP.NET рамки MVC. Вы можете скачать ASP.NET mVC-платформу по следующему адресу:

[https://www.asp.net/mvc](../../../index.md)

В этом уроке мы используем рамочную программу Microsoft Entity для доступа к базе данных. Рамочная программа entity включена в программу .NET Framework 3.5 Service Pack 1. Вы можете скачать этот пакет услуг из следующего места:

[https://www.microsoft.com/downloads/details.aspx?familyid=ab99342f-5d1a-413d-8319-81da479ab0d7&amp;displaylang'en](https://www.microsoft.com/downloads/details.aspx?familyid=ab99342f-5d1a-413d-8319-81da479ab0d7&amp;displaylang=en)

В качестве альтернативы выполнению каждой из этих загрузок по одному, вы можете воспользоваться web Platform Installer (Web PI). Вы можете скачать Web PI со следующего адреса:

[https://www.asp.net/downloads/essential/](https://www.asp.net/downloads/essential)

## <a name="aspnet-mvc-project"></a>проект ASP.NET MVC

ASP.NET проект веб-приложений MVC. Запустите Visual Studio и выберите вариант меню **Файл, Новый проект**. Появляется диалог **нового проекта** (см. рисунок 1). Выберите тип **веб-проекта** и шаблон **веб-приложений ASP.NET MVC.** Назовите свой новый проект *ContactManager* и нажмите кнопку OK.

Убедитесь, что у вас есть .NET Framework 3.5, выбранный из списка выпадающих в верхнем правом верхнем правом направлении диалога **Нового проекта.** В противном случае шаблон веб-приложений ASP.NET MVC MVC не появится.

[![Диалоговое окно New Project (Новый проект)](iteration-1-create-the-application-cs/_static/image1.jpg)](iteration-1-create-the-application-cs/_static/image1.png)

**Рисунок 01**: Новый диалог проекта[(Нажмите, чтобы просмотреть полноразмерное изображение)](iteration-1-create-the-application-cs/_static/image2.png)

ASP.NET приложении MVC отображается диалог проекта **Create Unit Test Project.** Этот диалог можно использовать для указания того, что вы хотите создать и добавить проект модульного теста для вашего решения при создании ASP.NET приложения MVC. Хотя мы не будем создавать модульные тесты в этой итерации, следует выбрать **опцию Да, создать модульный тестовый проект,** поскольку мы планируем добавить модульные тесты в более поздней итерации. Добавление тестового проекта при первом создании нового проекта mVC ASP.NET гораздо проще, чем добавление тестового проекта после создания проекта ASP.NET MVC.

> [!NOTE] 
> 
> Поскольку визуальный веб-разработчик не поддерживает проекты Test, при использовании Visual Web Developer не получается диалог проекта Create Unit Test Project.

[![Диалоговое окно New Project (Новый проект)](iteration-1-create-the-application-cs/_static/image2.jpg)](iteration-1-create-the-application-cs/_static/image3.png)

**Рисунок 02**: Создание группы тестовый проект диалог ([Нажмите, чтобы посмотреть полноразмерное изображение](iteration-1-create-the-application-cs/_static/image4.png))

ASP.NET приложение MVC появляется в окне Visual Studio Solution Explorer (см. рисунок 3). Если вы не видите окно Solution Explorer, то вы можете открыть это окно, выбрав вариант меню **View, Solution Explorer.** Обратите внимание, что решение содержит два проекта: проект ASP.NET MVC и проект Test. Проект ASP.NET MVC называется ContactManager, а тестовый проект называется ContactManager.Tests.

[![Диалоговое окно New Project (Новый проект)](iteration-1-create-the-application-cs/_static/image3.jpg)](iteration-1-create-the-application-cs/_static/image5.png)

**Рисунок 03**: Окно Solution Explorer ([Нажмите, чтобы просмотреть полноразмерное изображение](iteration-1-create-the-application-cs/_static/image6.png))

## <a name="deleting-the-project-sample-files"></a>Удаляние примера файлов проекта

Шаблон проекта ASP.NET MVC включает в себя примерные файлы для контроллеров и представлений. Перед созданием нового приложения mVC ASP.NET следует удалить эти файлы. Вы можете удалить файлы и папки в окне Solution Explorer, нажав правой кнопкой мыши на файл или папку и выбрав вариант меню **Удалить.**

Вам нужно удалить следующие файлы из проекта mVC ASP.NET:

- «Контролеры»HomeController.cs

- «Виды»Домашний»О.Аспк

- «Виды»Домашний индекс.aspx

Кроме того, необходимо удалить следующий файл из проекта Test:

«Контролеры»HomeControllerTest.cs

## <a name="creating-the-database"></a>Создание базы данных

Приложение Contact Manager — это веб-приложение, управляемое базой данных. Мы используем базу данных для хранения контактной информации.

Платформа ASP.NET MVC с любой современной базой данных, включая базы данных Microsoft S'L Server, Oracle, MyS'L и IBM DB2. В этом уроке мы используем базу данных Microsoft S'L Server. При установке Visual Studio вам предоставляется возможность установки Microsoft S'L Server Express, которая является бесплатной версией базы данных Microsoft S'L Server.

Создайте новую базу данных,\_нажав на папку App Data в окне Solution Explorer и выбрав опцию **«Добавить» —новый пункт.** В диалоге **Добавить новый элемент** выберите категорию **данных** и шаблон **базы данных серверов S'L** (см. рисунок 4). Назовите новую базу данных ContactManagerDB.mdf и нажмите кнопку OK.

[![Диалоговое окно New Project (Новый проект)](iteration-1-create-the-application-cs/_static/image4.jpg)](iteration-1-create-the-application-cs/_static/image7.png)

**Рисунок 04**: Создание новой базы данных Microsoft S'L Server Express ([Нажмите, чтобы просмотреть полноразмерное изображение](iteration-1-create-the-application-cs/_static/image8.png))

После создания новой базы данных база\_данных появляется в папке App Data в окне Solution Explorer. Дважды щелкните файл ContactManager.mdf, чтобы открыть окно Server Explorer и подключиться к базе данных.

> [!NOTE] 
> 
> Окно Server Explorer называется окном Database Explorer в случае Microsoft Visual Web Developer.

Окно Server Explorer можно использовать для создания новых объектов базы данных, таких как таблицы баз данных, представления, триггеры и сохраненные процедуры. Нажмите правой кнопкой папку Таблицы и выберите вариант меню **Добавить новый стол.** Отображается конструктор таблицы базы данных (см. рисунок 5).

[![Диалоговое окно New Project (Новый проект)](iteration-1-create-the-application-cs/_static/image5.jpg)](iteration-1-create-the-application-cs/_static/image9.png)

**Рисунок 05**: Дизайнер таблицы базы данных[(Нажмите, чтобы просмотреть полноразмерное изображение)](iteration-1-create-the-application-cs/_static/image10.png)

Нам нужно создать таблицу, содержащую следующие столбцы:

<a id="0.1_table01"></a>

| **Имя столбца** | **Тип данных** | **Разрешить значения NULL** |
| --- | --- | --- |
| Идентификатор | INT | false |
| FirstName | nvarchar(50) | false |
| LastName | nvarchar(50) | false |
| Номер телефона | nvarchar(50) | false |
| Email | nvarchar(255) | false |

Первая колонка, колонка Id, является особенной. Необходимо пометить столбец Id как столбец Identity и столбец Основного ключа. Вы указываете, что столбец — это столбец идентификации, расширяя свойства столбца (смотрите в нижней части рисунка 6) и прокручивая до свойства спецификации идентификации. Установите свойство **(Is Identity)** на значение **Yes.**

Вы помечаете столбец как столбец Основного ключа, выбрав столбец и нажав на кнопку значком ключа. После того, как столбец помечен как столбец основного ключа, рядом с столбцей появляется значок ключа (см. рисунок 6).

После завершения создания таблицы нажмите кнопку «Сохранить» (кнопку с иконкой дискеты), чтобы сохранить новую таблицу. Дайте новой таблице имя *Контакты*.

После завершения создания таблицы базы данных Контактов следует добавить некоторые записи в таблицу. Нажмите правой кнопкой мыши таблицы Контакты в окне Server Explorer и выберите вариант меню **Показать таблицы данных.** Введите один или несколько контактов в появляется сетке.

## <a name="creating-the-data-model"></a>Создание модели данных

Приложение ASP.NET MVC состоит из моделей, представлений и контроллеров. Мы начинаем с создания класса Модели, представляющего таблицу Контактов, созданную в предыдущем разделе.

В этом уроке мы используем рамочную программу Microsoft Entity Для автоматического создания класса моделей из базы данных.

> [!NOTE] 
> 
> Платформа ASP.NET MVC никоим образом не привязана к рамочной системе корпорации Майкрософт. Вы можете использовать ASP.NET MVC с альтернативными технологиями доступа к базе данных, включая NHibernate, LIN- в S'L или ADO.NET.

Выполните следующие действия, чтобы создать классы моделей данных:

1. Нажмите правой кнопкой папку Модели в окне Solution Explorer и выберите **Добавить, Новый пункт**. Появляется диалог **«Добавить новый элемент»** (см. рисунок 6).
2. Выберите категорию **данных** и шаблон **модели ADO.NET данных Entity.** Назовите свою модель данных *ContactManagerModel.edmx* и нажмите кнопку **Добавить.** Появляется мастер модели данных сущности (см. рисунок 7).
3. На этапе **«Выбрать содержимое модели»** выберите **«Создание» из базы данных** (см. рисунок 7).
4. На этапе **«Выберите подключение к данным»** выберите базу данных ContactManagerDB.mdf и введите имя *ContactManagerDBEntities* для настроек соединения entity (см. рисунок 8).
5. На этапе **«Выберите объекты базы данных»** выберите флажок с меткой таблицы (см. рисунок 9). Модель данных будет включать все таблицы, содержащиеся в вашей базе данных (есть только одна, таблица Контактов). Введите *модели*пространства имен. Нажмите кнопку Отделка, чтобы завершить мастера.

[![Диалоговое окно New Project (Новый проект)](iteration-1-create-the-application-cs/_static/image6.jpg)](iteration-1-create-the-application-cs/_static/image11.png)

**Рисунок 06**: Добавить новый элемент диалог ([Нажмите, чтобы посмотреть полноразмерное изображение](iteration-1-create-the-application-cs/_static/image12.png))

[![Диалоговое окно New Project (Новый проект)](iteration-1-create-the-application-cs/_static/image7.jpg)](iteration-1-create-the-application-cs/_static/image13.png)

**Рисунок 07**: Выберите содержимое модели ([Нажмите, чтобы посмотреть полноразмерное изображение](iteration-1-create-the-application-cs/_static/image14.png))

[![Диалоговое окно New Project (Новый проект)](iteration-1-create-the-application-cs/_static/image8.jpg)](iteration-1-create-the-application-cs/_static/image15.png)

**Рисунок 08**: Выберите подключение к данным[(Нажмите, чтобы просмотреть полноразмерное изображение)](iteration-1-create-the-application-cs/_static/image16.png)

[![Диалоговое окно New Project (Новый проект)](iteration-1-create-the-application-cs/_static/image9.jpg)](iteration-1-create-the-application-cs/_static/image17.png)

**Рисунок 09**: Выберите объекты базы данных[(Нажмите, чтобы просмотреть полноразмерное изображение)](iteration-1-create-the-application-cs/_static/image18.png)

После завершения модели модели Entity Мастера появляется модель модели данных entity. Дизайнер отображает класс, соответствующий моделируемой таблице. Вы должны увидеть один класс с названием Контакты.

Мастер модели данных сущности генерирует имена классов на основе имен таблиц баз данных. Почти всегда нужно изменить название класса, генерируемого мастером. Нажмите правой кнопкой мыши класса Контакты в дизайнере и выберите вариант меню **Переименовать.** Измените название класса с Контактов (множественное число) на Контакт (единственное). После изменения имени класса класс должен отображаться как рисунок 10.

[![Диалоговое окно New Project (Новый проект)](iteration-1-create-the-application-cs/_static/image10.jpg)](iteration-1-create-the-application-cs/_static/image19.png)

**Рисунок 10**: Контактный класс[(Нажмите, чтобы посмотреть полноразмерное изображение)](iteration-1-create-the-application-cs/_static/image20.png)

На данный момент мы создали нашу модель базы данных. Мы можем использовать класс Контакт для представления определенной записи контактов в нашей базе данных.

## <a name="creating-the-home-controller"></a>Создание домашнего контроллера

Следующим шагом является создание нашего домашнего контроллера. Домашний контроллер — контроллер по умолчанию, на который ссылается в ASP.NET MVC-приложении.

Создайте класс домашнего контроллера, нажав на папку контроллеров в окне Solution Explorer и выбрав опцию **«Добавить»** (см. рисунок 11). Обратите внимание на флажок с пометкой **Добавление методов для сценариев создания, обновления и деталей.** Убедитесь, что этот флажок проверяется, прежде чем нажать кнопку **Добавить.**

[![Диалоговое окно New Project (Новый проект)](iteration-1-create-the-application-cs/_static/image11.jpg)](iteration-1-create-the-application-cs/_static/image21.png)

**Рисунок 11**: Добавление домашнего контроллера ([Нажмите, чтобы просмотреть полноразмерное изображение](iteration-1-create-the-application-cs/_static/image22.png))

При создании контроллера Home вы получаете класс в листинге 1.

**Список 1 - Контролеры**

[!code-csharp[Main](iteration-1-create-the-application-cs/samples/sample1.cs)]

## <a name="listing-the-contacts"></a>Перечисление контактов

Для отображения записей в таблице базы данных Контактов нам необходимо создать действие Индекса () и представление индекса.

Домашний контроллер уже содержит действие Индекса () Мы должны изменить этот метод так, чтобы он выглядел как листинг 2.

**Список 2 - Контролеры**

[!code-csharp[Main](iteration-1-create-the-application-cs/samples/sample2.cs)]

Обратите внимание, что класс домашнего контроллера \_в листинге 2 содержит частное поле с именем сущностей. Поле \_сущностей представляет сущности из модели данных. Мы используем \_поле сущностей для связи с базой данных.

Метод Индекса () возвращает представление, представляющее все контакты из таблицы базы данных Контактов. Сущности \_выражения. ContactSet.ToList () возвращает список контактов в виде общего списка.

Теперь, когда мы создали контроллер индекса, нам необходимо создать представление индекса. Перед созданием представления индекса составить приложение, выбрав вариант меню **Build, Build Solution.** Перед добавлением представления необходимо всегда компилировать проект, чтобы список классов моделей отображался в диалоге **Add View.**

Представление индекса создается путем нажатия правом нажатия метода Index() и выбора опции **«Добавить вид»** (см. рисунок 12). Выбор этой опции меню открывает диалог **Add View** (см. рисунок 13).

[![Диалоговое окно New Project (Новый проект)](iteration-1-create-the-application-cs/_static/image12.jpg)](iteration-1-create-the-application-cs/_static/image23.png)

**Рисунок 12**: Добавление представления индекса[(Нажмите, чтобы просмотреть полноразмерное изображение)](iteration-1-create-the-application-cs/_static/image24.png)

В диалоге **Add View** проверьте флажок с пометкой Создать **сильно набранное представление.** Выберите класс данных View ContactManager.Models.Contact и список содержимого view. Выбор этих параметров создает представление, отображающее список записей Контактов.

[![Диалоговое окно New Project (Новый проект)](iteration-1-create-the-application-cs/_static/image13.jpg)](iteration-1-create-the-application-cs/_static/image25.png)

**Рисунок 13**: Диалог добавления просмотра[(Нажмите, чтобы просмотреть полноразмерное изображение)](iteration-1-create-the-application-cs/_static/image26.png)

При нажатии кнопки **Добавить** генерируется представление индекса в листинге 3. Обратите &lt;внимание на&gt; директиву % - Page %, которая отображается в верхней части файла. Представление индекса наследует сяречку&lt;из&lt;класса ViewPage&gt; &gt; IEnumerable.Models.Contact.Contact. Другими словами, класс модели в представлении представляет собой список контактных сущностей.

Тело представления индекса содержит цикл foreach, который итерируется через каждый из контактов, представленных классом модели. Значение каждого свойства класса Контакт отображается в таблице HTML.

**Список 3 - Просмотры »Home»Index.aspx (неизменен)**

[!code-aspx[Main](iteration-1-create-the-application-cs/samples/sample3.aspx)]

Нам нужно внести одну модификацию в представление Индекса. Поскольку мы не создаем представление о деталях, мы можем удалить ссылку «Подробности». Найдите и удалите следующий код из представления Индекса:

идиллия. Id)%&gt;

После изменения представления индекса можно запустить приложение «Контакт-менеджер». Выберите вариант меню Отек, Начать отладку или просто нажмите F5. При первом запуске приложения вы получаете диалог на рисунке 14. Выберите опцию **Изменить файл Web.config для включения отладки** и нажмите кнопку OK.

[![Диалоговое окно New Project (Новый проект)](iteration-1-create-the-application-cs/_static/image14.jpg)](iteration-1-create-the-application-cs/_static/image27.png)

**Рисунок 14**: Включение отладки ([Нажмите, чтобы просмотреть полноразмерное изображение)](iteration-1-create-the-application-cs/_static/image28.png)

Представление индекса возвращается по умолчанию. В этом представлении перечислены все данные из таблицы базы данных Контактов (см. рисунок 15).

[![Диалоговое окно New Project (Новый проект)](iteration-1-create-the-application-cs/_static/image15.jpg)](iteration-1-create-the-application-cs/_static/image29.png)

**Рисунок 15**: Представление индекса ([Нажмите, чтобы посмотреть полноразмерное изображение](iteration-1-create-the-application-cs/_static/image30.png))

Обратите внимание, что представление индекса включает в себя ссылку с пометкой Create New в нижней части представления. В следующем разделе вы узнаете, как создавать новые контакты.

## <a name="creating-new-contacts"></a>Создание новых контактов

Чтобы позволить пользователям создавать новые контакты, нам нужно добавить два действия Create() в контроллер Home. Нам нужно создать одно действие Create() которое возвращает форму HTML для создания нового контакта. Нам нужно создать второе действие Create(), которое выполняет фактическую вставку базы данных нового контакта.

Новые методы создания (), которые нам необходимо добавить в контроллер Home, содержатся в листинге 4.

**Список 4 - Контроллеры»HomeController.cs (с методами создания)**

[!code-csharp[Main](iteration-1-create-the-application-cs/samples/sample4.cs)]

Первый метод Create() можно вызывать с помощью HTTP GET, в то время как второй метод Create() может вызываться только HTTP POST. Другими словами, второй метод Create() может быть вызван только при размещении HTML-формы. Первый метод Create() просто возвращает представление, содержащее форму HTML для создания нового контакта. Второй метод Create() гораздо интереснее: он добавляет новый контакт в базу данных.

Обратите внимание, что второй метод Create() был изменен, чтобы принять экземпляр класса Контакт. Значения формы, размещенные в форме HTML, автоматически привязаны к этому классу Контактов ASP.NET платформой MVC. Каждое поле формы из формы HTML Create присваивается свойству параметра Контакт.

Обратите внимание, что параметр Контакта украшен атрибутом «Bind». Атрибут «Bind» используется для исключения свойства Contact Id из связывания. Поскольку свойство Id представляет свойство Identity, мы не хотим устанавливать свойство Id.

В корпусе метода Create() рамочная сущность используется для вставки нового Контакта в базу данных. Новый контакт добавляется к существующему набору контактов, а метод SaveChanges() вызывается, чтобы отодвинуть эти изменения обратно в базовую базу данных.

Вы можете создать форму HTML для создания новых контактов, нажав на любой из двух методов Create() и выбрав вариант меню **Add View** (см. рисунок 16).

[![Диалоговое окно New Project (Новый проект)](iteration-1-create-the-application-cs/_static/image16.jpg)](iteration-1-create-the-application-cs/_static/image31.png)

**Рисунок 16**: Добавление представления «Создание»[(нажмите, чтобы просмотреть полноразмерное изображение)](iteration-1-create-the-application-cs/_static/image32.png)

В диалоге **Add View** выберите класс **ContactManager.Models.Contact** и **опцию «Создание»** для просмотра содержимого (см. рисунок 17). При нажатии кнопки **Добавить** представление Create генерируется автоматически.

[![Диалоговое окно New Project (Новый проект)](iteration-1-create-the-application-cs/_static/image17.jpg)](iteration-1-create-the-application-cs/_static/image33.png)

**Рисунок 17**: Видя страницу взорваться ([Нажмите, чтобы посмотреть полноразмерное изображение](iteration-1-create-the-application-cs/_static/image34.png))

Представление «Создание» содержит поля формы для каждого из свойств класса Контакт. Код для представления «Создание» включен в листинг 5.

**Список 5 - Просмотры »Домашний»Create.aspx**

[!code-aspx[Main](iteration-1-create-the-application-cs/samples/sample5.aspx)]

После изменения методов создания () и добавления представления Create можно запустить приложение Contact Manger и создать новые контакты. Нажмите на новую ссылку **Create,** которая отображается в представлении индекса, чтобы перейти к представлению «Создать». Вы должны увидеть вид на рисунке 18.

[![Диалоговое окно New Project (Новый проект)](iteration-1-create-the-application-cs/_static/image18.jpg)](iteration-1-create-the-application-cs/_static/image35.png)

**Рисунок 18**: Создать представление ([Нажмите, чтобы посмотреть полноразмерное изображение](iteration-1-create-the-application-cs/_static/image36.png))

## <a name="editing-contacts"></a>Редактирование Контактов

Добавление функциональности для редактирования контактной записи очень похоже на добавление функциональности для создания новых контактных записей. Во-первых, нам нужно добавить два новых метода edit в класс контроллера Home. Эти новые методы edit() содержатся в листинге 6.

**Список 6 - Контроллеры»HomeController.cs (с методами отсечения)**

[!code-csharp[Main](iteration-1-create-the-application-cs/samples/sample6.cs)]

Первый метод edit() вызывается операцией HTTP GET. Параметр Id передается этому методу, который представляет идентификатор редактируемой записи контакта. Рамочная сущности используется для получения контакта, который соответствует идентификатору. Возвращается представление, содержащее HTML-форму для редактирования записи.

Второй метод edit() выполняет фактическое обновление базы данных. Этот метод принимает экземпляр класса Контакт в качестве параметра. Рамки ASP.NET MVC автоматически связывают поля формы из формы edit с этим классом. Обратите внимание, что при редактировании контакта не включен атрибут «Bind» (нам нужна стоимость свойства Id).

Рамочная сущности используется для сохранения измененного контакта с базой данных. Исходный контакт должен быть извлечен из базы данных в первую очередь. Далее для записи изменений в Контакте называется метод Entity Framework ApplyPropertyChanges() для записи изменений в Контакте. Наконец, метод Сохранения изменений () entity Framework SaveChanges() призван упорствовать в изменениях в базовой базе данных.

Можно создать представление, содержащее форму edit, при правильном нажатии метода Edit() и выбрав вариант меню Add View. В диалоге Add View выберите класс **ContactManager.Models.Contact** и содержимое представления **«Edit»** (см. рисунок 19).

[![Диалоговое окно New Project (Новый проект)](iteration-1-create-the-application-cs/_static/image19.jpg)](iteration-1-create-the-application-cs/_static/image37.png)

**Рисунок 19**: Добавление видом на отображение[(Нажмите, чтобы просмотреть полноразмерное изображение)](iteration-1-create-the-application-cs/_static/image38.png)

При нажатии кнопки Добавить автоматически генерируется новое представление «Edit». Создаваемый HTML-образный образ содержит поля, соответствующие каждому из свойств класса Контакт (см. список 7).

**Список 7 - Просмотры/Home-Edit.aspx**

[!code-aspx[Main](iteration-1-create-the-application-cs/samples/sample7.aspx)]

## <a name="deleting-contacts"></a>Удалять контакты

Если вы хотите удалить контакты, то вам нужно добавить два действия Delete() в класс домашнего контроллера. В первом действии Delete() отображается форма подтверждения удаления. Второе действие Delete() выполняет фактическое удаление.

> [!NOTE] 
> 
> Позже, в #7 итерации мы модифицировали менеджер контактов таким образом, чтобы он поддерживал удаление одного шага Ajax.

Два новых метода Удаления () содержатся в листинге 8.

**Список 8 - Контролеры-HomeController.cs (Методы удаления)**

[!code-csharp[Main](iteration-1-create-the-application-cs/samples/sample8.cs)]

Первый метод Удаления () возвращает форму подтверждения для удаления записи контакта из базы данных (см. Рисунок20). Второй метод Удаления () выполняет операцию удаления в отношении базы данных. После того, как исходный контакт был извлечен из базы данных, для выполнения удаления базы данных вызываются методы «Удаляй» () ИСФрЕС и SaveChanges () для выполнения удаления базы данных.

[![Диалоговое окно New Project (Новый проект)](iteration-1-create-the-application-cs/_static/image20.jpg)](iteration-1-create-the-application-cs/_static/image39.png)

**Рисунок 20**: Представление подтверждения удаления ([Нажмите, чтобы посмотреть полноразмерное изображение](iteration-1-create-the-application-cs/_static/image40.png))

Нам нужно изменить представление индекса таким образом, чтобы оно содержащее ссылку для удаляния контактных записей (см. рисунок 21). Необходимо добавить следующий код в одну и ту же ячейку таблицы, которая содержит ссылку Edit:

Html.ActionLink( ид.пункт. Id ) %&gt;

[![Диалоговое окно New Project (Новый проект)](iteration-1-create-the-application-cs/_static/image21.jpg)](iteration-1-create-the-application-cs/_static/image41.png)

**Рисунок 21**: Представление индекса с помощью ссылки на edit ([Нажмите, чтобы просмотреть полноразмерное изображение](iteration-1-create-the-application-cs/_static/image42.png))

Далее нам нужно создать представление подтверждения удаления. Нажмите правой кнопкой мыши метод ауда () в классе домашнего контроллера и выберите вариант меню Добавить вид. Отображается диалог «Добавить вид» (см. рисунок 22).

В отличие от представлений «Список, создание и отодвилость», диалог Add View не содержит опции для создания представления «Удалить». Вместо этого выберите класс данных **ContactManager.Models.Contact** и содержимое **пустого** представления. Выбор опции содержимого пустого представления потребует от нас создания представления самостоятельно.

[![Диалоговое окно New Project (Новый проект)](iteration-1-create-the-application-cs/_static/image22.jpg)](iteration-1-create-the-application-cs/_static/image43.png)

**Рисунок 22**: Добавление представления подтверждения удаления ([Нажмите, чтобы просмотреть полноразмерное изображение](iteration-1-create-the-application-cs/_static/image44.png))

Содержание представления «Удалить» содержится в листинге 9. Это представление содержит форму, подтверждая, следует ли исключить конкретный контакт (см. рисунок 21).

**Список 9 - Просмотры »Домашний»Delete.aspx**

[!code-aspx[Main](iteration-1-create-the-application-cs/samples/sample9.aspx)]

## <a name="changing-the-name-of-the-default-controller"></a>Изменение названия контроллера по умолчанию

Вас может беспокоить, что название нашего класса контроллеров для работы с контактами называется классом HomeController. Не должен ли контроллер называться ContactController?

Эту проблему достаточно легко исправить. Во-первых, нам нужно рефакторинг имя контроллера Home. Откройте класс HomeController в редакторе кода Visual Studio, нажмите право на название класса и выберите вариант меню **Refactor, Rename**. Выбор этой опции меню открывает диалог Rename.

[![Диалоговое окно New Project (Новый проект)](iteration-1-create-the-application-cs/_static/image23.jpg)](iteration-1-create-the-application-cs/_static/image45.png)

**Рисунок 23**: Рефакторинг имени контроллера ([Нажмите, чтобы просмотреть полноразмерное изображение](iteration-1-create-the-application-cs/_static/image46.png))

[![Диалоговое окно New Project (Новый проект)](iteration-1-create-the-application-cs/_static/image24.jpg)](iteration-1-create-the-application-cs/_static/image47.png)

**Рисунок 24**: Использование диалога переименовать ([Нажмите, чтобы просмотреть полноразмерное изображение](iteration-1-create-the-application-cs/_static/image48.png))

Если вы переименуете класс контроллера, Visual Studio также обновит название папки в папке Views. Visual Studio переименует папку «Виды» home в папку «Просмотры» Контакт.

После внесения этого изменения в приложении больше не будет иметься домашний контроллер. При запуске приложения вы получите страницу ошибки на рисунке 25.

[![Диалоговое окно New Project (Новый проект)](iteration-1-create-the-application-cs/_static/image25.jpg)](iteration-1-create-the-application-cs/_static/image49.png)

**Рисунок 25**: Нет контроллера по умолчанию ([Нажмите, чтобы посмотреть полноразмерное изображение](iteration-1-create-the-application-cs/_static/image50.png))

Нам нужно обновить маршрут по умолчанию в файле Global.asax, чтобы использовать контроллер Контакта вместо контроллера Home. Откройте файл Global.asax и измените контроллер по умолчанию, используемый маршрутом по умолчанию (см. список 10).

**Список 10 - Global.asax.cs**

[!code-csharp[Main](iteration-1-create-the-application-cs/samples/sample10.cs)]

После внесения этих изменений менеджер контакта будет работать правильно. Теперь он будет использовать класс контроллера контакта в качестве контроллера по умолчанию.

## <a name="summary"></a>Сводка

В этой первой итерации мы создали базовое приложение Contact Manager самым быстрым способом. Мы воспользовались Visual Studio для создания исходного кода для наших контроллеров и представлений автоматически. Мы также воспользовались рамочным образованием для автоматического создания классов моделей баз данных.

В настоящее время мы можем создавать, создавать, отсвапывать и удалять контактные записи с приложением Contact Manager. Другими словами, мы можем выполнять все основные операции базы данных, требуемые веб-приложением, управляемым базой данных.

К сожалению, наше приложение имеет некоторые проблемы. Во-первых, и я стесняюсь признать это, приложение Contact Manager не самое привлекательное приложение. Она нуждается в некоторых проектных работ. В следующей итерации мы рассмотрим, как мы можем изменить страницу просмотра по умолчанию и лист каскадного стиля, чтобы улучшить внешний вид приложения.

Во-вторых, мы не реализовали ни одной проверки формы. Например, ничто не мешает вам отправлять контактную форму Create без ввода значений для любого из полей формы. Кроме того, вы можете ввести недействительные номера телефонов и адреса электронной почты. Мы начинаем решать проблему проверки формы в #3 итерации.

Наконец, и самое главное, текущая итерация приложения Contact Manager не может быть легко изменена или сохранена. Например, логика доступа к базе данных запекается прямо в действиях контроллера. Это означает, что мы не можем изменить наш код доступа к данным без изменения наших контроллеров. В более поздних итерациях мы исследуем шаблоны проектирования программного обеспечения, которые мы можем реализовать, чтобы сделать Contact Manager более устойчивым к изменениям.

> [!div class="step-by-step"]
> [Вперед](iteration-2-make-the-application-look-nice-cs.md)
