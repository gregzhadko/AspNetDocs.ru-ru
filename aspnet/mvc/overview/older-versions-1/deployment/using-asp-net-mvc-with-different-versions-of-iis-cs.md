---
uid: mvc/overview/older-versions-1/deployment/using-asp-net-mvc-with-different-versions-of-iis-cs
title: Использование ASP.NET MVC с разными версиями IIS (C#) | Документация Майкрософт
author: microsoft
description: В этом руководстве описано, как использовать ASP.NET MVC и маршрутизацию URL-адресов с различными версиями службы IIS. Вы узнаете о различных стратегиях...
ms.author: riande
ms.date: 08/19/2008
ms.assetid: b0cf4a34-2c1d-4717-bb54-ff029e722990
msc.legacyurl: /mvc/overview/older-versions-1/deployment/using-asp-net-mvc-with-different-versions-of-iis-cs
msc.type: authoredcontent
ms.openlocfilehash: 3b0a9509c0600f3598fd1218a7b383430548d4c0
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78486528"
---
# <a name="using-aspnet-mvc-with-different-versions-of-iis-c"></a>Использование ASP.NET MVC с разными версиями служб IIS (C#)

по [Майкрософт](https://github.com/microsoft)

> В этом руководстве описано, как использовать ASP.NET MVC и маршрутизацию URL-адресов с различными версиями службы IIS. Вы узнаете о различных стратегиях использования ASP.NET MVC с IIS 7,0 (классический режим), IIS 6,0 и более ранних версий IIS.

Платформа ASP.NET MVC зависит от маршрутизации ASP.NET, которая направляет запросы обозревателя к действиям контроллера. Чтобы воспользоваться преимуществами маршрутизации ASP.NET, может потребоваться выполнить дополнительные действия по настройке веб-сервера. Все зависит от версии службы IIS (IIS) и режима обработки запроса для приложения.

Ниже приведена сводка различных версий IIS.

- IIS 7,0 (интегрированный режим) — не требуется специальная настройка для использования маршрутизации ASP.NET.
- IIS 7,0 (классический режим) — для использования маршрутизации ASP.NET необходимо выполнить специальную настройку.
- IIS 6,0 или ниже — необходимо выполнить специальную настройку для использования маршрутизации ASP.NET.

Последняя версия IIS — версия 7,5 (в Win7). IIS 7 служб IIS входит в состав Windows Server 2008 и VISTA/с пакетом обновления 1 (SP1) и более поздних версий. Кроме того, можно установить IIS 7,0 в любой версии операционной системы Vista, кроме Home Basic (см. [https://technet.microsoft.com/library/cc731179%28WS.10%29.aspx](https://technet.microsoft.com/library/cc731179%28WS.10%29.aspx)).

IIS 7,0 поддерживает два режима обработки запросов. Можно использовать интегрированный режим или классический режим. При использовании IIS 7,0 в интегрированном режиме не нужно выполнять никаких особых действий по настройке. Однако при использовании IIS 7,0 в классическом режиме необходимо выполнить дополнительную настройку.

Microsoft Windows Server 2003 включает в себя IIS 6,0. Невозможно обновить IIS 6,0 до IIS 7,0 при использовании операционной системы Windows Server 2003. При использовании IIS 6,0 необходимо выполнить дополнительные действия по настройке.

Microsoft Windows XP Professional включает в себя IIS 5,1. При использовании IIS 5,1 необходимо выполнить дополнительные действия по настройке.

Наконец, Microsoft Windows 2000 и Microsoft Windows 2000 Professional включают в себя IIS 5,0. При использовании IIS 5,0 необходимо выполнить дополнительные действия по настройке.

## <a name="integrated-versus-classic-mode"></a>Интегрированный и классический режимы

IIS 7,0 может обрабатывать запросы, используя два разных режима обработки запросов: интегрированные и классические. Режим интеграции обеспечивает лучшую производительность и дополнительные функции. Классический режим включен для обеспечения обратной совместимости с более ранними версиями IIS.

Режим обработки запроса определяется пулом приложений. Определить, какой режим обработки используется определенным веб-приложением, можно, определив пул приложений, связанный с приложением. Выполните следующие действия.

1. Запуск диспетчера службы IIS
2. В окне "подключения" выберите приложение.
3. В окне действия щелкните ссылку **Основные параметры** , чтобы открыть диалоговое окно Изменение приложения (см. рис. 1).
4. Запишите выбранный пул приложений.

По умолчанию службы IIS настроены для поддержки двух пулов приложений: **DefaultAppPool** и **классической платформы .NET AppPool**. Если выбран DefaultAppPool, приложение работает в режиме. Если выбрано классическая платформа .NET AppPool, приложение выполняется в классическом режиме обработки запросов.

[![диалоговом окне «Создание проекта»](using-asp-net-mvc-with-different-versions-of-iis-cs/_static/image1.jpg)](using-asp-net-mvc-with-different-versions-of-iis-cs/_static/image1.png)

**Рис. 1**. Определение режима обработки запроса ([щелкните, чтобы просмотреть изображение с полным размером](using-asp-net-mvc-with-different-versions-of-iis-cs/_static/image2.png))

Обратите внимание, что режим обработки запроса можно изменить в диалоговом окне Изменение приложения. Нажмите кнопку Выбрать и измените пул приложений, связанный с приложением. Обратите внимание на наличие проблем совместимости при изменении приложения ASP.NET с классической на интегрированный режим. Дополнительные сведения см. в следующих статьях:

- Обновление ASP.NET 1,1 до IIS 7,0 в Windows Vista и Windows Server 2008 — [https://www.iis.net/learn/application-frameworks/building-and-running-aspnet-applications/upgrading-aspnet-11-to-iis-on-windows-vista-and-windows-server-2008](https://www.iis.net/learn/application-frameworks/building-and-running-aspnet-applications/upgrading-aspnet-11-to-iis-on-windows-vista-and-windows-server-2008)
- Интеграция ASP.NET с IIS 7,0 — [https://www.iis.net/learn/application-frameworks/building-and-running-aspnet-applications/aspnet-integration-with-iis](https://www.iis.net/learn/application-frameworks/building-and-running-aspnet-applications/aspnet-integration-with-iis)

Если приложение ASP.NET использует DefaultAppPool, вам не нужно выполнять дополнительные действия для получения маршрутизации ASP.NET (и, следовательно, ASP.NET MVC) для работы. Однако если приложение ASP.NET настроено для использования классической платформы .NET AppPool, продолжите чтение, вы получите больше работы.

## <a name="using-aspnet-mvc-with-older-versions-of-iis"></a>Использование ASP.NET MVC с более старыми версиями IIS

Если необходимо использовать ASP.NET MVC с более ранней версией IIS, чем IIS 7,0, или же необходимо использовать IIS 7,0 в классическом режиме, у вас есть два варианта. Сначала можно изменить таблицу маршрутов для использования расширений файлов. Например, вместо запроса URL-адреса, такого как/Сторе/детаилс, необходимо запросить URL-адрес, например/Сторе.аспкс/детаилс.

Второй вариант — создать объект, называемый *картой сценариев с подстановочными знаками*. Схема сценариев с подстановочными знаками позволяет сопоставлять каждый запрос с платформой ASP.NET.

Если у вас нет доступа к веб-серверу (например, приложение ASP.NET MVC размещается поставщиком услуг Интернета), необходимо использовать первый вариант. Если вы не хотите изменять внешний вид URL-адресов и у вас есть доступ к веб-серверу, можно использовать второй вариант.

Мы подробно рассмотрим каждый вариант в следующих разделах.

## <a name="adding-extensions-to-the-route-table"></a>Добавление расширений в таблицу маршрутов

Самый простой способ получить ASP.NET маршрутизацию для работы с более старыми версиями IIS — это изменить таблицу маршрутов в файле Global. asax. По умолчанию и неизмененный файл Global. asax в листинге 1 настраивает один маршрут, именуемый маршрутом по умолчанию.

**Листинг 1-Global. asax (без изменений)**

[!code-csharp[Main](using-asp-net-mvc-with-different-versions-of-iis-cs/samples/sample1.cs)]

Маршрут по умолчанию, настроенный в листинге 1, позволяет маршрутизировать URL-адреса, которые выглядят следующим образом:

/хоме/индекс

/Product/Details/3

/Product

К сожалению, более старые версии IIS не будут передавать эти запросы платформе ASP.NET. Таким образом, эти запросы не будут маршрутизироваться к контроллеру. Например, если вы сделаете запрос в браузере для URL-адреса/Хоме/индекс, вы получите страницу ошибки на рис. 2.

[![диалоговом окне «Создание проекта»](using-asp-net-mvc-with-different-versions-of-iis-cs/_static/image2.jpg)](using-asp-net-mvc-with-different-versions-of-iis-cs/_static/image3.png)

**Рис. 2**. получение сообщения об ошибке 404 не найдено ([щелкните, чтобы просмотреть изображение с полным размером](using-asp-net-mvc-with-different-versions-of-iis-cs/_static/image4.png))

Более старые версии служб IIS сопоставляют только определенные запросы к платформе ASP.NET. Запрос должен быть URL-адресом с правильным расширением файла. Например, запрос/Сомепаже.аспкс сопоставляется с платформой ASP.NET. Однако запрос для/Сомепаже.хтм не имеет значение.

Таким образом, чтобы обеспечить работу маршрутизации ASP.NET, необходимо изменить маршрут по умолчанию, чтобы он включал в себя расширение файла, сопоставленное с платформой ASP.NET.

Это делается с помощью скрипта с именем `registermvc.wsf`. Он был включен в выпуск ASP.NET MVC 1 в `C:\Program Files\Microsoft ASP.NET\ASP.NET MVC\Scripts`, но в ASP.NET 2 этот сценарий был перемещен в ASP.NET фьючерсы, доступный по адресу [http://aspnet.codeplex.com/releases/view/39978](http://aspnet.codeplex.com/releases/view/39978).

Выполнение этого скрипта регистрирует новое расширение MVC с IIS. После регистрации расширения MVC можно изменить маршруты в файле Global. asax, чтобы маршруты использовали расширение MVC.

Измененный файл Global. asax в листинге 2 работает со старыми версиями IIS.

**Листинг 2-Global. asax (изменено с помощью расширений)**

[!code-csharp[Main](using-asp-net-mvc-with-different-versions-of-iis-cs/samples/sample2.cs)]

**Важно**. не забудьте снова создать приложение ASP.NET MVC после изменения файла Global. asax.

В листинге 2 есть два важных изменения файла Global. asax. Теперь в Global. asax определены два маршрута. Шаблон URL-адреса для маршрута по умолчанию, первый маршрут, теперь выглядит следующим образом:

{Controller}. MVC/{действие}/{ID}

Добавление расширения MVC изменяет тип файлов, переASP.NETющих модуле маршрутизации. После этого изменения приложение ASP.NET MVC теперь направляет запросы, как в следующем примере:

/хоме.мвк/индекс/

/Product.mvc/Details/3

/продукт.мвк/

Второй маршрут, корневой маршрут, является новым. Этот шаблон URL-адреса для корневого маршрута является пустой строкой. Этот маршрут необходим для сопоставления запросов, выполняемых в корне приложения. Например, корневой маршрут будет соответствовать запросу, который выглядит следующим образом:

[http://www.YourApplication.com/](http://www.YourApplication.com/)

После внесения этих изменений в таблицу маршрутов необходимо убедиться, что все ссылки в приложении совместимы с новыми шаблонами URL-адресов. Иными словами, убедитесь, что все ссылки включают расширение MVC. Если вы используете вспомогательный метод HTML. ActionLink () для создания ссылок, вам не нужно вносить какие-либо изменения.

Вместо использования скрипта регистермвк. WCF можно добавить новое расширение в IIS, сопоставленное с платформой ASP.NET вручную. При добавлении нового расширения вручную убедитесь, что флажок **Проверка наличия файла** не установлен.

## <a name="hosted-server"></a>Размещенный сервер

У вас не всегда есть доступ к веб-серверу. Например, если вы размещаете приложение ASP.NET MVC с помощью поставщика услуг размещения в Интернете, то вам не обязательно иметь доступ к службам IIS.

В этом случае следует использовать одно из существующих расширений файлов, сопоставленных с платформой ASP.NET. Примеры расширений файлов, сопоставленных с ASP.NET, включают расширения ASPX, AXD и ASHX.

Например, измененный файл Global. asax в листинге 3 использует расширение. aspx вместо расширения MVC.

**Листинг 3-Global. asax (изменено с помощью расширений. aspx)**

[!code-csharp[Main](using-asp-net-mvc-with-different-versions-of-iis-cs/samples/sample3.cs)]

Файл Global. asax в листинге 3 совпадает с предыдущим файлом Global. asax, за исключением того факта, что вместо расширения MVC используется расширение. aspx. Для использования расширения. aspx не нужно выполнять никаких настроек на удаленном веб-сервере.

## <a name="creating-a-wildcard-script-map"></a>Создание таблицы сценариев с подстановочными знаками

Если вы не хотите изменять URL-адреса для приложения ASP.NET MVC и у вас есть доступ к веб-серверу, у вас есть дополнительный параметр. Можно создать карту сценариев с подстановочными знаками, которая сопоставляет все запросы к веб-серверу с платформой ASP.NET. Таким образом, можно использовать таблицу маршрутов ASP.NET MVC по умолчанию с IIS 7,0 (в классическом режиме) или IIS 6,0.

Имейте в виду, что этот параметр приводит к тому, что IIS перехватывает все запросы к веб-серверу. Сюда относятся запросы на изображения, классические ASP-страницы и страницы HTML. Поэтому включение схемы сценариев с подстановочными знаками в ASP.NET влияет на производительность.

Вот как можно включить схему сценариев с подстановочными знаками для IIS 7,0:

1. Выбор приложения в окне "подключения"
2. Убедитесь, что выбрано представление " **функции** "
3. Дважды щелкните кнопку " **сопоставления обработчика** "
4. Щелкните ссылку **Добавить таблицу сценариев с подстановочными знаками** (см. рис. 3).
5. Введите путь к файлу ASPNET\_ISAPI. dll (этот путь можно скопировать из схемы сценария PageHandlerFactory).
6. Введите имя MVC
7. Нажмите кнопку " **ОК** "

[![диалоговом окне «Создание проекта»](using-asp-net-mvc-with-different-versions-of-iis-cs/_static/image3.jpg)](using-asp-net-mvc-with-different-versions-of-iis-cs/_static/image5.png)

**Рис. 3**. Создание схемы сценариев с подстановочными знаками с помощью IIS 7,0 ([щелкните, чтобы просмотреть изображение с полным размером](using-asp-net-mvc-with-different-versions-of-iis-cs/_static/image6.png))

Выполните следующие действия, чтобы создать схему сценариев с подстановочными знаками в IIS 6,0.

1. Щелкните веб-сайт правой кнопкой мыши и выберите пункт Свойства.
2. Перейдите на вкладку **домашний каталог** .
3. Нажмите кнопку **конфигурации** .
4. Выберите вкладку **сопоставления** .
5. Нажмите кнопку **Вставить** (см. рис. 4).
6. Вставьте путь к файлу ASPNET\_ISAPI. dll в поле исполняемый файл (этот путь можно скопировать из схемы сценария для ASPX-файлов).
7. Снимите флажок Проверять **, существует ли файл**
8. Нажмите кнопку " **ОК** "

[![диалоговом окне «Создание проекта»](using-asp-net-mvc-with-different-versions-of-iis-cs/_static/image4.jpg)](using-asp-net-mvc-with-different-versions-of-iis-cs/_static/image7.png)

**Рис. 4**. Создание схемы сценариев с подстановочными знаками с помощью IIS 6,0 ([щелкните, чтобы просмотреть изображение с полным размером](using-asp-net-mvc-with-different-versions-of-iis-cs/_static/image8.png))

После включения сопоставления сценариев с подстановочными знаками необходимо изменить таблицу маршрутов в файле Global. asax, чтобы она включала корневой маршрут. В противном случае вы получите страницу ошибки на рис. 5 при выполнении запроса к корневой странице приложения. Вы можете использовать измененный файл Global. asax в листинге 4.

[![диалоговом окне «Создание проекта»](using-asp-net-mvc-with-different-versions-of-iis-cs/_static/image5.jpg)](using-asp-net-mvc-with-different-versions-of-iis-cs/_static/image9.png)

**Рис. 5**. отсутствие ошибки корневого маршрута ([щелкните, чтобы просмотреть изображение с полным размером](using-asp-net-mvc-with-different-versions-of-iis-cs/_static/image10.png))

**Листинг 4-Global. asax (измененный с использованием корневого маршрута)**

[!code-csharp[Main](using-asp-net-mvc-with-different-versions-of-iis-cs/samples/sample4.cs)]

После включения схемы сценариев с подстановочными знаками для IIS 7,0 или IIS 6,0 можно сделать запросы, работающие с таблицей маршрутов по умолчанию, которая выглядит следующим образом:

/

/хоме/индекс

/Product/Details/3

/Product

## <a name="summary"></a>Сводка

Цель этого учебника — объяснить, как можно использовать ASP.NET MVC при использовании более старой версии IIS (или IIS 7,0 в классическом режиме). Мы обсуждали два способа получения ASP.NET маршрутизации для работы с более старыми версиями IIS: измените таблицу маршрутов по умолчанию или создайте карту сценариев с подстановочными знаками.

При первом варианте необходимо изменить URL-адреса, используемые в приложении ASP.NET MVC. Одним из очень значительных преимуществ этого первого варианта является отсутствие необходимости доступа к веб-серверу для изменения таблицы маршрутов. Это означает, что вы можете использовать этот первый вариант даже при размещении приложения ASP.NET MVC в компании, размещенной в Интернете.

Второй вариант — создать карту сценариев с подстановочными знаками. Преимущество этого второго варианта заключается в том, что вам не нужно изменять URL-адреса. Недостаток этого второго варианта заключается в том, что он может повлиять на производительность приложения ASP.NET MVC.

> [!div class="step-by-step"]
> [Дальше](using-asp-net-mvc-with-different-versions-of-iis-vb.md)
