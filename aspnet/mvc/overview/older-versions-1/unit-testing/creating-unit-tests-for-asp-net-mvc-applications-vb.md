---
uid: mvc/overview/older-versions-1/unit-testing/creating-unit-tests-for-asp-net-mvc-applications-vb
title: Создание модульных тестов для приложений ASP.NET MVC (VB) | Документация Майкрософт
author: StephenWalther
description: Узнайте, как создавать модульные тесты для действий контроллера. В этом руководстве Стивен Вальтер демонстрирует, как проверить, возвращает ли действие контроллера парти...
ms.author: riande
ms.date: 08/19/2008
ms.assetid: eb35710d-1d99-44ac-b61f-e50af8cb328a
msc.legacyurl: /mvc/overview/older-versions-1/unit-testing/creating-unit-tests-for-asp-net-mvc-applications-vb
msc.type: authoredcontent
ms.openlocfilehash: 643faddaf6f9cd075131e8e5a9cccb303e355ceb
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78435384"
---
# <a name="creating-unit-tests-for-aspnet-mvc-applications-vb"></a><span data-ttu-id="16f96-104">Создание модульных тестов для приложений ASP.NET MVC (VB)</span><span class="sxs-lookup"><span data-stu-id="16f96-104">Creating Unit Tests for ASP.NET MVC Applications (VB)</span></span>

<span data-ttu-id="16f96-105">по [Стивен Вальтер](https://github.com/StephenWalther)</span><span class="sxs-lookup"><span data-stu-id="16f96-105">by [Stephen Walther](https://github.com/StephenWalther)</span></span>

[<span data-ttu-id="16f96-106">Скачать в формате PDF</span><span class="sxs-lookup"><span data-stu-id="16f96-106">Download PDF</span></span>](https://download.microsoft.com/download/8/4/8/84843d8d-1575-426c-bcb5-9d0c42e51416/ASPNET_MVC_Tutorial_07_VB.pdf)

> <span data-ttu-id="16f96-107">Узнайте, как создавать модульные тесты для действий контроллера.</span><span class="sxs-lookup"><span data-stu-id="16f96-107">Learn how to create unit tests for controller actions.</span></span> <span data-ttu-id="16f96-108">В этом руководстве Стивен Вальтер демонстрирует, как проверить, возвращает ли действие контроллера определенное представление, возвращает определенный набор данных или возвращает другой тип результата действия.</span><span class="sxs-lookup"><span data-stu-id="16f96-108">In this tutorial, Stephen Walther demonstrates how to test whether a controller action returns a particular view, returns a particular set of data, or returns a different type of action result.</span></span>

<span data-ttu-id="16f96-109">Цель этого руководства — продемонстрировать, как можно написать модульные тесты для контроллеров в приложениях ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="16f96-109">The goal of this tutorial is to demonstrate how you can write unit tests for the controllers in your ASP.NET MVC applications.</span></span> <span data-ttu-id="16f96-110">Мы обсудим, как создать три различных типа модульных тестов.</span><span class="sxs-lookup"><span data-stu-id="16f96-110">We discuss how to build three different types of unit tests.</span></span> <span data-ttu-id="16f96-111">Вы узнаете, как протестировать представление, возвращенное действием контроллера, как проверить данные представления, возвращаемые действием контроллера, и как проверить, выполняет ли одно действие контроллера перенаправление к действию второго контроллера.</span><span class="sxs-lookup"><span data-stu-id="16f96-111">You learn how to test the view returned by a controller action, how to test the View Data returned by a controller action, and how to test whether or not one controller action redirects you to a second controller action.</span></span>

## <a name="creating-the-controller-under-test"></a><span data-ttu-id="16f96-112">Создание тестируемого контроллера</span><span class="sxs-lookup"><span data-stu-id="16f96-112">Creating the Controller under Test</span></span>

<span data-ttu-id="16f96-113">Начнем с создания контроллера, который мы планируем тестировать.</span><span class="sxs-lookup"><span data-stu-id="16f96-113">Let's start by creating the controller that we intend to test.</span></span> <span data-ttu-id="16f96-114">Контроллер с именем `ProductController`содержится в листинге 1.</span><span class="sxs-lookup"><span data-stu-id="16f96-114">The controller, named the `ProductController`, is contained in Listing 1.</span></span>

<span data-ttu-id="16f96-115">**Листинг 1 — `ProductController.vb`**</span><span class="sxs-lookup"><span data-stu-id="16f96-115">**Listing 1 – `ProductController.vb`**</span></span>

[!code-vb[Main](creating-unit-tests-for-asp-net-mvc-applications-vb/samples/sample1.vb)]

<span data-ttu-id="16f96-116">`ProductController` содержит два метода действия с именами `Index()` и `Details()`.</span><span class="sxs-lookup"><span data-stu-id="16f96-116">The `ProductController` contains two action methods named `Index()` and `Details()`.</span></span> <span data-ttu-id="16f96-117">Оба метода действия возвращают представление.</span><span class="sxs-lookup"><span data-stu-id="16f96-117">Both action methods return a view.</span></span> <span data-ttu-id="16f96-118">Обратите внимание, что действие `Details()` принимает параметр с именем ID.</span><span class="sxs-lookup"><span data-stu-id="16f96-118">Notice that the `Details()` action accepts a parameter named Id.</span></span>

## <a name="testing-the-view-returned-by-a-controller"></a><span data-ttu-id="16f96-119">Тестирование представления, возвращенного контроллером</span><span class="sxs-lookup"><span data-stu-id="16f96-119">Testing the View returned by a Controller</span></span>

<span data-ttu-id="16f96-120">Представьте, что мы хотим проверить, возвращает ли `ProductController` правильное представление.</span><span class="sxs-lookup"><span data-stu-id="16f96-120">Imagine that we want to test whether or not the `ProductController` returns the right view.</span></span> <span data-ttu-id="16f96-121">Мы хотим убедиться, что при вызове действия `ProductController.Details()` возвращается подробное представление.</span><span class="sxs-lookup"><span data-stu-id="16f96-121">We want to make sure that when the `ProductController.Details()` action is invoked, the Details view is returned.</span></span> <span data-ttu-id="16f96-122">Тестовый класс в листинге 2 содержит модульный тест для проверки представления, возвращаемого действием `ProductController.Details()`.</span><span class="sxs-lookup"><span data-stu-id="16f96-122">The test class in Listing 2 contains a unit test for testing the view returned by the `ProductController.Details()` action.</span></span>

<span data-ttu-id="16f96-123">**Листинг 2 — `ProductControllerTest.vb`**</span><span class="sxs-lookup"><span data-stu-id="16f96-123">**Listing 2 – `ProductControllerTest.vb`**</span></span>

[!code-vb[Main](creating-unit-tests-for-asp-net-mvc-applications-vb/samples/sample2.vb)]

<span data-ttu-id="16f96-124">Класс в листинге 2 содержит метод теста с именем `TestDetailsView()`.</span><span class="sxs-lookup"><span data-stu-id="16f96-124">The class in Listing 2 includes a test method named `TestDetailsView()`.</span></span> <span data-ttu-id="16f96-125">Этот метод содержит три строки кода.</span><span class="sxs-lookup"><span data-stu-id="16f96-125">This method contains three lines of code.</span></span> <span data-ttu-id="16f96-126">В первой строке кода создается новый экземпляр класса `ProductController`.</span><span class="sxs-lookup"><span data-stu-id="16f96-126">The first line of code creates a new instance of the `ProductController` class.</span></span> <span data-ttu-id="16f96-127">Вторая строка кода вызывает метод действия `Details()` контроллера.</span><span class="sxs-lookup"><span data-stu-id="16f96-127">The second line of code invokes the controller's `Details()` action method.</span></span> <span data-ttu-id="16f96-128">Наконец, последняя строка кода проверяет, является ли представление, возвращаемое действием `Details()`, представлением подробностей.</span><span class="sxs-lookup"><span data-stu-id="16f96-128">Finally, the last line of code checks whether or not the view returned by the `Details()` action is the Details view.</span></span>

<span data-ttu-id="16f96-129">Свойство `ViewResult.ViewName` представляет имя представления, возвращаемого контроллером.</span><span class="sxs-lookup"><span data-stu-id="16f96-129">The `ViewResult.ViewName` property represents the name of the view returned by a controller.</span></span> <span data-ttu-id="16f96-130">Одно большое предупреждение о тестировании этого свойства.</span><span class="sxs-lookup"><span data-stu-id="16f96-130">One big warning about testing this property.</span></span> <span data-ttu-id="16f96-131">Контроллер может вернуть представление двумя способами.</span><span class="sxs-lookup"><span data-stu-id="16f96-131">There are two ways that a controller can return a view.</span></span> <span data-ttu-id="16f96-132">Контроллер может явно вернуть представление следующим образом:</span><span class="sxs-lookup"><span data-stu-id="16f96-132">A controller can explicitly return a view like this:</span></span>

[!code-vb[Main](creating-unit-tests-for-asp-net-mvc-applications-vb/samples/sample3.vb)]

<span data-ttu-id="16f96-133">Кроме того, имя представления можно вывести из имени действия контроллера следующим образом:</span><span class="sxs-lookup"><span data-stu-id="16f96-133">Alternatively, the name of the view can be inferred from the name of the controller action like this:</span></span>

[!code-vb[Main](creating-unit-tests-for-asp-net-mvc-applications-vb/samples/sample4.vb)]

<span data-ttu-id="16f96-134">Это действие контроллера также возвращает представление с именем `Details`.</span><span class="sxs-lookup"><span data-stu-id="16f96-134">This controller action also returns a view named `Details`.</span></span> <span data-ttu-id="16f96-135">Однако имя представления выводится из имени действия.</span><span class="sxs-lookup"><span data-stu-id="16f96-135">However, the name of the view is inferred from the action name.</span></span> <span data-ttu-id="16f96-136">Если требуется проверить имя представления, необходимо явно вернуть имя представления из действия контроллера.</span><span class="sxs-lookup"><span data-stu-id="16f96-136">If you want to test the view name, then you must explicitly return the view name from the controller action.</span></span>

<span data-ttu-id="16f96-137">Модульный тест можно запустить в листинге 2, введя сочетание клавиш **CTRL + R, A** или нажав кнопку **запустить все тесты в решении** (см. рис. 1).</span><span class="sxs-lookup"><span data-stu-id="16f96-137">You can run the unit test in Listing 2 by either entering the keyboard combination **Ctrl-R, A** or by clicking the **Run All Tests in Solution** button (see Figure 1).</span></span> <span data-ttu-id="16f96-138">Если тест пройден, вы увидите результаты теста окно на рис. 2.</span><span class="sxs-lookup"><span data-stu-id="16f96-138">If the test passes, you'll see the Test Results window in Figure 2.</span></span>

<span data-ttu-id="16f96-139">[![выполнить все тесты в решении](creating-unit-tests-for-asp-net-mvc-applications-vb/_static/image2.png)](creating-unit-tests-for-asp-net-mvc-applications-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="16f96-139">[![Run All Tests in Solution](creating-unit-tests-for-asp-net-mvc-applications-vb/_static/image2.png)](creating-unit-tests-for-asp-net-mvc-applications-vb/_static/image1.png)</span></span>

<span data-ttu-id="16f96-140">**Рис. 01**. выполнение всех тестов в решении ([щелкните, чтобы просмотреть изображение с полным размером](creating-unit-tests-for-asp-net-mvc-applications-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="16f96-140">**Figure 01**: Run All Tests in Solution ([Click to view full-size image](creating-unit-tests-for-asp-net-mvc-applications-vb/_static/image3.png))</span></span>

<span data-ttu-id="16f96-141">[![успешно.](creating-unit-tests-for-asp-net-mvc-applications-vb/_static/image5.png)](creating-unit-tests-for-asp-net-mvc-applications-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="16f96-141">[![Success!](creating-unit-tests-for-asp-net-mvc-applications-vb/_static/image5.png)](creating-unit-tests-for-asp-net-mvc-applications-vb/_static/image4.png)</span></span>

<span data-ttu-id="16f96-142">**Рис. 02**. успешное завершение!</span><span class="sxs-lookup"><span data-stu-id="16f96-142">**Figure 02**: Success!</span></span> <span data-ttu-id="16f96-143">([Щелкните, чтобы просмотреть изображение с полным размером](creating-unit-tests-for-asp-net-mvc-applications-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="16f96-143">([Click to view full-size image](creating-unit-tests-for-asp-net-mvc-applications-vb/_static/image6.png))</span></span>

## <a name="testing-the-view-data-returned-by-a-controller"></a><span data-ttu-id="16f96-144">Тестирование данных представления, возвращенных контроллером</span><span class="sxs-lookup"><span data-stu-id="16f96-144">Testing the View Data returned by a Controller</span></span>

<span data-ttu-id="16f96-145">Контроллер MVC передает данные в представление, используя нечто, именуемое *`View Data`* .</span><span class="sxs-lookup"><span data-stu-id="16f96-145">An MVC controller passes data to a view by using something called *`View Data`*.</span></span> <span data-ttu-id="16f96-146">Например, представьте, что необходимо отобразить сведения о конкретном продукте при вызове действия `ProductController Details()`.</span><span class="sxs-lookup"><span data-stu-id="16f96-146">For example, imagine that you want to display the details for a particular product when you invoke the `ProductController Details()` action.</span></span> <span data-ttu-id="16f96-147">В этом случае можно создать экземпляр класса `Product` (определенный в модели) и передать его в представление `Details`, используя преимущества `View Data`.</span><span class="sxs-lookup"><span data-stu-id="16f96-147">In that case, you can create an instance of a `Product` class (defined in your model) and pass the instance to the `Details` view by taking advantage of `View Data`.</span></span>

<span data-ttu-id="16f96-148">Измененная `ProductController` в листинге 3 включает обновленное `Details()` действие, возвращающее продукт.</span><span class="sxs-lookup"><span data-stu-id="16f96-148">The modified `ProductController` in Listing 3 includes an updated `Details()` action that returns a Product.</span></span>

<span data-ttu-id="16f96-149">**Листинг 3 — `ProductController.vb`**</span><span class="sxs-lookup"><span data-stu-id="16f96-149">**Listing 3 – `ProductController.vb`**</span></span>

[!code-vb[Main](creating-unit-tests-for-asp-net-mvc-applications-vb/samples/sample5.vb)]

<span data-ttu-id="16f96-150">Во-первых, `Details()` действие создает новый экземпляр класса `Product`, представляющий портативный компьютер.</span><span class="sxs-lookup"><span data-stu-id="16f96-150">First, the `Details()` action creates a new instance of the `Product` class that represents a laptop computer.</span></span> <span data-ttu-id="16f96-151">Затем экземпляр класса `Product` передается в качестве второго параметра методу `View()`.</span><span class="sxs-lookup"><span data-stu-id="16f96-151">Next, the instance of the `Product` class is passed as the second parameter to the `View()` method.</span></span>

<span data-ttu-id="16f96-152">Модульные тесты можно создавать для проверки того, содержатся ли ожидаемые данные в данных представления.</span><span class="sxs-lookup"><span data-stu-id="16f96-152">You can write unit tests to test whether the expected data is contained in view data.</span></span> <span data-ttu-id="16f96-153">Модульный тест в листинге 4 проверяет, возвращается ли продукт, представляющий портативный компьютер, при вызове метода действия `ProductController Details()`.</span><span class="sxs-lookup"><span data-stu-id="16f96-153">The unit test in Listing 4 tests whether or not a Product representing a laptop computer is returned when you call the `ProductController Details()` action method.</span></span>

<span data-ttu-id="16f96-154">**Листинг 4 — `ProductControllerTest.vb`**</span><span class="sxs-lookup"><span data-stu-id="16f96-154">**Listing 4 – `ProductControllerTest.vb`**</span></span>

[!code-vb[Main](creating-unit-tests-for-asp-net-mvc-applications-vb/samples/sample6.vb)]

<span data-ttu-id="16f96-155">В листинге 4 метод `TestDetailsView()` проверяет возвращаемые данные представления, вызывая метод `Details()`.</span><span class="sxs-lookup"><span data-stu-id="16f96-155">In Listing 4, the `TestDetailsView()` method tests the View Data returned by invoking the `Details()` method.</span></span> <span data-ttu-id="16f96-156">`ViewData` предоставляется как свойство на `ViewResult`, возвращаемое путем вызова метода `Details()`.</span><span class="sxs-lookup"><span data-stu-id="16f96-156">The `ViewData` is exposed as a property on the `ViewResult` returned by invoking the `Details()` method.</span></span> <span data-ttu-id="16f96-157">Свойство `ViewData.Model` содержит продукт, переданный в представление.</span><span class="sxs-lookup"><span data-stu-id="16f96-157">The `ViewData.Model` property contains the product passed to the view.</span></span> <span data-ttu-id="16f96-158">Тест просто проверяет наличие имени ноутбука в продукте, содержащемся в данных представления.</span><span class="sxs-lookup"><span data-stu-id="16f96-158">The test simply verifies that the product contained in the View Data has the name Laptop.</span></span>

## <a name="testing-the-action-result-returned-by-a-controller"></a><span data-ttu-id="16f96-159">Проверка результата действия, возвращенного контроллером</span><span class="sxs-lookup"><span data-stu-id="16f96-159">Testing the Action Result returned by a Controller</span></span>

<span data-ttu-id="16f96-160">Более сложное действие контроллера может возвращать различные типы результатов действий в зависимости от значений параметров, переданных в действие контроллера.</span><span class="sxs-lookup"><span data-stu-id="16f96-160">A more complex controller action might return different types of action results depending on the values of the parameters passed to the controller action.</span></span> <span data-ttu-id="16f96-161">Действие контроллера может возвращать разнообразные типы результатов действий, включая `ViewResult`, `RedirectToRouteResult`или `JsonResult`.</span><span class="sxs-lookup"><span data-stu-id="16f96-161">A controller action can return a variety of types of action results including a `ViewResult`, `RedirectToRouteResult`, or `JsonResult`.</span></span>

<span data-ttu-id="16f96-162">Например, измененное действие `Details()` в листинге 5 возвращает представление `Details` при передаче действительного идентификатора продукта в действие.</span><span class="sxs-lookup"><span data-stu-id="16f96-162">For example, the modified `Details()` action in Listing 5 returns the `Details` view when you pass a valid product Id to the action.</span></span> <span data-ttu-id="16f96-163">Если передать недопустимый идентификатор продукта — идентификатор со значением меньше 1, вы будете перенаправлены к действию `Index()`.</span><span class="sxs-lookup"><span data-stu-id="16f96-163">If you pass an invalid product Id -- an Id with a value less than 1 -- then you are redirected to the `Index()` action.</span></span>

<span data-ttu-id="16f96-164">**Листинг 5 — `ProductController.vb`**</span><span class="sxs-lookup"><span data-stu-id="16f96-164">**Listing 5 – `ProductController.vb`**</span></span>

[!code-vb[Main](creating-unit-tests-for-asp-net-mvc-applications-vb/samples/sample7.vb)]

<span data-ttu-id="16f96-165">Поведение `Details()` действия можно проверить с помощью модульного теста в листинге 6.</span><span class="sxs-lookup"><span data-stu-id="16f96-165">You can test the behavior of the `Details()` action with the unit test in Listing 6.</span></span> <span data-ttu-id="16f96-166">Модульный тест в листинге 6 проверяет, что вы перенаправлены в представление `Index`, когда в метод `Details()` передается идентификатор со значением-1.</span><span class="sxs-lookup"><span data-stu-id="16f96-166">The unit test in Listing 6 verifies that you are redirected to the `Index` view when an Id with the value -1 is passed to the `Details()` method.</span></span>

<span data-ttu-id="16f96-167">**Листинг 6 — `ProductControllerTest.vb`**</span><span class="sxs-lookup"><span data-stu-id="16f96-167">**Listing 6 – `ProductControllerTest.vb`**</span></span>

[!code-vb[Main](creating-unit-tests-for-asp-net-mvc-applications-vb/samples/sample8.vb)]

<span data-ttu-id="16f96-168">При вызове метода `RedirectToAction()` в действии контроллера действие контроллера возвращает `RedirectToRouteResult`.</span><span class="sxs-lookup"><span data-stu-id="16f96-168">When you call the `RedirectToAction()` method in a controller action, the controller action returns a `RedirectToRouteResult`.</span></span> <span data-ttu-id="16f96-169">Тест проверяет, будет ли `RedirectToRouteResult` перенаправлять пользователя в действие контроллера с именем `Index`.</span><span class="sxs-lookup"><span data-stu-id="16f96-169">The test checks whether the `RedirectToRouteResult` will redirect the user to a controller action named `Index`.</span></span>

## <a name="summary"></a><span data-ttu-id="16f96-170">Сводка</span><span class="sxs-lookup"><span data-stu-id="16f96-170">Summary</span></span>

<span data-ttu-id="16f96-171">В этом руководстве вы узнали, как создавать модульные тесты для действий контроллера MVC.</span><span class="sxs-lookup"><span data-stu-id="16f96-171">In this tutorial, you learned how to build unit tests for MVC controller actions.</span></span> <span data-ttu-id="16f96-172">Во-первых, вы узнали, как проверить, возвращено ли правильное представление действием контроллера.</span><span class="sxs-lookup"><span data-stu-id="16f96-172">First, you learned how to verify whether the right view is returned by a controller action.</span></span> <span data-ttu-id="16f96-173">Вы узнали, как использовать свойство `ViewResult.ViewName` для проверки имени представления.</span><span class="sxs-lookup"><span data-stu-id="16f96-173">You learned how to use the `ViewResult.ViewName` property to verify the name of a view.</span></span>

<span data-ttu-id="16f96-174">Далее мы рассмотрели, как можно протестировать содержимое `View Data`.</span><span class="sxs-lookup"><span data-stu-id="16f96-174">Next, we examined how you can test the contents of `View Data`.</span></span> <span data-ttu-id="16f96-175">Вы узнали, как проверить, был ли правильный продукт возвращен в `View Data` после вызова действия контроллера.</span><span class="sxs-lookup"><span data-stu-id="16f96-175">You learned how to check whether the right product was returned in `View Data` after calling a controller action.</span></span>

<span data-ttu-id="16f96-176">Наконец, мы рассмотрели, как можно проверить, возвращаются ли различные типы результатов действий из действия контроллера.</span><span class="sxs-lookup"><span data-stu-id="16f96-176">Finally, we discussed how you can test whether different types of action results are returned from a controller action.</span></span> <span data-ttu-id="16f96-177">Вы узнали, как проверить, возвращает ли контроллер `ViewResult` или `RedirectToRouteResult`.</span><span class="sxs-lookup"><span data-stu-id="16f96-177">You learned how to test whether a controller returns a `ViewResult` or a `RedirectToRouteResult`.</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="16f96-178">Назад</span><span class="sxs-lookup"><span data-stu-id="16f96-178">Previous</span></span>](creating-unit-tests-for-asp-net-mvc-applications-cs.md)
