---
uid: mvc/overview/older-versions/getting-started-with-ef-5-using-mvc-4/sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application
title: Сортировка, фильтрация и разбиение на страницы с помощью Entity Framework в приложении ASP.NET MVC (3 из 10) | Документация Майкрософт
author: tdykstra
description: Пример веб-приложения Contoso университета демонстрирует создание приложений ASP.NET MVC 4 с помощью Entity Framework 5 Code First и Visual Studio...
ms.author: riande
ms.date: 07/30/2013
ms.assetid: 8af630e0-fffa-4110-9eca-c96e201b2724
msc.legacyurl: /mvc/overview/older-versions/getting-started-with-ef-5-using-mvc-4/sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application
msc.type: authoredcontent
ms.openlocfilehash: b1ddb70805dcb07fb60eea895ff572c054bde5c6
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/28/2019
ms.locfileid: "74595226"
---
# <a name="sorting-filtering-and-paging-with-the-entity-framework-in-an-aspnet-mvc-application-3-of-10"></a><span data-ttu-id="1ddc4-103">Сортировка, фильтрация и разбиение на страницы с помощью Entity Framework в приложении ASP.NET MVC (3 из 10)</span><span class="sxs-lookup"><span data-stu-id="1ddc4-103">Sorting, Filtering, and Paging with the Entity Framework in an ASP.NET MVC Application (3 of 10)</span></span>

<span data-ttu-id="1ddc4-104">от [Tom Dykstra)](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="1ddc4-104">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

[<span data-ttu-id="1ddc4-105">Скачать завершенный проект</span><span class="sxs-lookup"><span data-stu-id="1ddc4-105">Download Completed Project</span></span>](https://code.msdn.microsoft.com/Getting-Started-with-dd0e2ed8)

> <span data-ttu-id="1ddc4-106">Пример веб-приложения Contoso университета демонстрирует создание приложений ASP.NET MVC 4 с помощью Entity Framework 5 Code First и Visual Studio 2012.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-106">The Contoso University sample web application demonstrates how to create ASP.NET MVC 4 applications using the Entity Framework 5 Code First and Visual Studio 2012.</span></span> <span data-ttu-id="1ddc4-107">Сведения о серии руководств см. в [первом руководстве серии](creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span><span class="sxs-lookup"><span data-stu-id="1ddc4-107">For information about the tutorial series, see [the first tutorial in the series](creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span></span> <span data-ttu-id="1ddc4-108">Вы можете начать серию руководств с начала или [скачать начальный проект для этой главы](building-the-ef5-mvc4-chapter-downloads.md) и начать отсюда.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-108">You can start the tutorial series from the beginning or [download a starter project for this chapter](building-the-ef5-mvc4-chapter-downloads.md) and start here.</span></span>
> 
> > [!NOTE] 
> > 
> > <span data-ttu-id="1ddc4-109">Если проблема не устранена, [Скачайте готовую главу](building-the-ef5-mvc4-chapter-downloads.md) и попытайтесь воспроизвести проблему.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-109">If you run into a problem you can't resolve, [download the completed chapter](building-the-ef5-mvc4-chapter-downloads.md) and try to reproduce your problem.</span></span> <span data-ttu-id="1ddc4-110">Как правило, решение проблемы можно найти, сравнив код с завершенным кодом.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-110">You can generally find the solution to the problem by comparing your code to the completed code.</span></span> <span data-ttu-id="1ddc4-111">Некоторые распространенные ошибки и способы их устранения см. в разделе [ошибки и обходные пути.](advanced-entity-framework-scenarios-for-an-mvc-web-application.md#errors)</span><span class="sxs-lookup"><span data-stu-id="1ddc4-111">For some common errors and how to solve them, see [Errors and Workarounds.](advanced-entity-framework-scenarios-for-an-mvc-web-application.md#errors)</span></span>

<span data-ttu-id="1ddc4-112">В предыдущем руководстве вы реализовали набор веб-страниц для базовых операций CRUD для сущностей `Student`.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-112">In the previous tutorial you implemented a set of web pages for basic CRUD operations for `Student` entities.</span></span> <span data-ttu-id="1ddc4-113">В этом учебнике вы добавите функции сортировки, фильтрации и разбиения на страницы для индекса **учащихся** .</span><span class="sxs-lookup"><span data-stu-id="1ddc4-113">In this tutorial you'll add sorting, filtering, and paging functionality to the **Students** Index page.</span></span> <span data-ttu-id="1ddc4-114">Здесь также описывается создание страницы с простой группировкой.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-114">You'll also create a page that does simple grouping.</span></span>

<span data-ttu-id="1ddc4-115">На следующем рисунке изображен вид страницы после выполнения задания.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-115">The following illustration shows what the page will look like when you're done.</span></span> <span data-ttu-id="1ddc4-116">Заголовки столбцов являются ссылками, при нажатии на которые происходит сортировка по этому столбцу.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-116">The column headings are links that the user can click to sort by that column.</span></span> <span data-ttu-id="1ddc4-117">При повторном нажатии на заголовок происходит переключение между сортировкой по возрастанию и убыванию.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-117">Clicking a column heading repeatedly toggles between ascending and descending sort order.</span></span>

![Students_Index_page_with_paging](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image1.png)

## <a name="add-column-sort-links-to-the-students-index-page"></a><span data-ttu-id="1ddc4-119">Добавление ссылок для сортировки в заголовки столбцов на странице указателя учащихся</span><span class="sxs-lookup"><span data-stu-id="1ddc4-119">Add Column Sort Links to the Students Index Page</span></span>

<span data-ttu-id="1ddc4-120">Чтобы добавить сортировку на страницу индекса учащихся, измените метод `Index` контроллера `Student` и добавьте код в `Student` представление индекса.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-120">To add sorting to the Student Index page, you'll change the `Index` method of the `Student` controller and add code to the `Student` Index view.</span></span>

### <a name="add-sorting-functionality-to-the-index-method"></a><span data-ttu-id="1ddc4-121">Добавление функции сортировки в метод Index</span><span class="sxs-lookup"><span data-stu-id="1ddc4-121">Add Sorting Functionality to the Index Method</span></span>

<span data-ttu-id="1ddc4-122">В *контроллерс\студентконтроллер.КС*замените метод `Index` следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="1ddc4-122">In *Controllers\StudentController.cs*, replace the `Index` method with the following code:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample1.cs)]

<span data-ttu-id="1ddc4-123">Этот код принимает параметр `sortOrder` из строки запроса в URL.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-123">This code receives a `sortOrder` parameter from the query string in the URL.</span></span> <span data-ttu-id="1ddc4-124">Значение строки запроса предоставляется ASP.NET MVC в качестве параметра метода действия.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-124">The query string value is provided by ASP.NET MVC as a parameter to the action method.</span></span> <span data-ttu-id="1ddc4-125">Имя параметра представляет собой строку, состоящую из "Name" или "Date" с возможным добавлением знака подчеркивания и строки "desc" для указания убывающего порядка сортировки.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-125">The parameter will be a string that's either "Name" or "Date", optionally followed by an underscore and the string "desc" to specify descending order.</span></span> <span data-ttu-id="1ddc4-126">По умолчанию используется порядок сортировки по возрастанию.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-126">The default sort order is ascending.</span></span>

<span data-ttu-id="1ddc4-127">При первом запросе страницы Index строка запроса отсутствует.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-127">The first time the Index page is requested, there's no query string.</span></span> <span data-ttu-id="1ddc4-128">Студенты отображаются в возрастающем порядке по `LastName`, который является значением по умолчанию, установленным в операторе `switch`.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-128">The students are displayed in ascending order by `LastName`, which is the default as established by the fall-through case in the `switch` statement.</span></span> <span data-ttu-id="1ddc4-129">Когда пользователь щелкает гиперссылку заголовка столбца, в строку запроса подставляется соответствующее значение параметра `sortOrder`.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-129">When the user clicks a column heading hyperlink, the appropriate `sortOrder` value is provided in the query string.</span></span>

<span data-ttu-id="1ddc4-130">Используются две переменные `ViewBag`, чтобы представление могли настроить гиперссылки заголовка столбца с соответствующими значениями строки запроса:</span><span class="sxs-lookup"><span data-stu-id="1ddc4-130">The two `ViewBag` variables are used so that the view can configure the column heading hyperlinks with the appropriate query string values:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample2.cs)]

<span data-ttu-id="1ddc4-131">Это тернарные условные операторы.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-131">These are ternary statements.</span></span> <span data-ttu-id="1ddc4-132">Первый указывает, что если параметр `sortOrder` имеет значение null или пуст, `ViewBag.NameSortParm` должен иметь значение "Name\_DESC"; в противном случае необходимо установить пустую строку.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-132">The first one specifies that if the `sortOrder` parameter is null or empty, `ViewBag.NameSortParm` should be set to "name\_desc"; otherwise, it should be set to an empty string.</span></span> <span data-ttu-id="1ddc4-133">Следующие два оператора устанавливают гиперссылки в заголовках столбцов в представлении следующим образом:</span><span class="sxs-lookup"><span data-stu-id="1ddc4-133">These two statements enable the view to set the column heading hyperlinks as follows:</span></span>

| <span data-ttu-id="1ddc4-134">Текущий порядок сортировки</span><span class="sxs-lookup"><span data-stu-id="1ddc4-134">Current sort order</span></span> | <span data-ttu-id="1ddc4-135">Гиперссылка "Last Name" (Фамилия)</span><span class="sxs-lookup"><span data-stu-id="1ddc4-135">Last Name Hyperlink</span></span> | <span data-ttu-id="1ddc4-136">Гиперссылка "Date" (Дата)</span><span class="sxs-lookup"><span data-stu-id="1ddc4-136">Date Hyperlink</span></span> |
| --- | --- | --- |
| <span data-ttu-id="1ddc4-137">"Last Name" (Фамилия) по возрастанию</span><span class="sxs-lookup"><span data-stu-id="1ddc4-137">Last Name ascending</span></span> | <span data-ttu-id="1ddc4-138">descending</span><span class="sxs-lookup"><span data-stu-id="1ddc4-138">descending</span></span> | <span data-ttu-id="1ddc4-139">ascending</span><span class="sxs-lookup"><span data-stu-id="1ddc4-139">ascending</span></span> |
| <span data-ttu-id="1ddc4-140">"Last Name" (Фамилия) по убыванию</span><span class="sxs-lookup"><span data-stu-id="1ddc4-140">Last Name descending</span></span> | <span data-ttu-id="1ddc4-141">ascending</span><span class="sxs-lookup"><span data-stu-id="1ddc4-141">ascending</span></span> | <span data-ttu-id="1ddc4-142">ascending</span><span class="sxs-lookup"><span data-stu-id="1ddc4-142">ascending</span></span> |
| <span data-ttu-id="1ddc4-143">"Date" (Дата) по возрастанию</span><span class="sxs-lookup"><span data-stu-id="1ddc4-143">Date ascending</span></span> | <span data-ttu-id="1ddc4-144">ascending</span><span class="sxs-lookup"><span data-stu-id="1ddc4-144">ascending</span></span> | <span data-ttu-id="1ddc4-145">descending</span><span class="sxs-lookup"><span data-stu-id="1ddc4-145">descending</span></span> |
| <span data-ttu-id="1ddc4-146">"Date" (Дата) по убыванию</span><span class="sxs-lookup"><span data-stu-id="1ddc4-146">Date descending</span></span> | <span data-ttu-id="1ddc4-147">ascending</span><span class="sxs-lookup"><span data-stu-id="1ddc4-147">ascending</span></span> | <span data-ttu-id="1ddc4-148">ascending</span><span class="sxs-lookup"><span data-stu-id="1ddc4-148">ascending</span></span> |

<span data-ttu-id="1ddc4-149">Метод использует [LINQ to Entities](https://msdn.microsoft.com/library/bb386964.aspx) , чтобы указать столбец для сортировки.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-149">The method uses [LINQ to Entities](https://msdn.microsoft.com/library/bb386964.aspx) to specify the column to sort by.</span></span> <span data-ttu-id="1ddc4-150">Код создает переменную [IQueryable](https://msdn.microsoft.com/library/bb351562.aspx) перед инструкцией `switch`, изменяет ее в операторе `switch` и вызывает метод `ToList` после оператора `switch`.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-150">The code creates an [IQueryable](https://msdn.microsoft.com/library/bb351562.aspx) variable before the `switch` statement, modifies it in the `switch` statement, and calls the `ToList` method after the `switch` statement.</span></span> <span data-ttu-id="1ddc4-151">После создания и изменения переменных `IQueryable` запрос в базу данных не отправляется.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-151">When you create and modify `IQueryable` variables, no query is sent to the database.</span></span> <span data-ttu-id="1ddc4-152">Запрос не выполняется до тех пор, пока не будет преобразован объект `IQueryable` в коллекцию путем вызова метода, такого как `ToList`.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-152">The query is not executed until you convert the `IQueryable` object into a collection by calling a method such as `ToList`.</span></span> <span data-ttu-id="1ddc4-153">Таким образом, этот код приводит к выполнению одного запроса, который не выполняется до оператора `return View`.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-153">Therefore, this code results in a single query that is not executed until the `return View` statement.</span></span>

### <a name="add-column-heading-hyperlinks-to-the-student-index-view"></a><span data-ttu-id="1ddc4-154">Добавление гиперссылок заголовка столбца в представление индекса учащихся</span><span class="sxs-lookup"><span data-stu-id="1ddc4-154">Add Column Heading Hyperlinks to the Student Index View</span></span>

<span data-ttu-id="1ddc4-155">В *виевс\студент\индекс.кштмл*замените элементы `<tr>` и `<th>` для строки заголовка выделенным кодом:</span><span class="sxs-lookup"><span data-stu-id="1ddc4-155">In *Views\Student\Index.cshtml*, replace the `<tr>` and `<th>` elements for the heading row with the highlighted code:</span></span>

[!code-cshtml[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample3.cshtml?highlight=5-15)]

<span data-ttu-id="1ddc4-156">Этот код использует сведения в свойствах `ViewBag` для настройки гиперссылок с соответствующими значениями строки запроса.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-156">This code uses the information in the `ViewBag` properties to set up hyperlinks with the appropriate query string values.</span></span>

<span data-ttu-id="1ddc4-157">Чтобы проверить, работает ли сортировка, запустите страницу и щелкните заголовки столбцов **Last Name** и **Date регистрации** .</span><span class="sxs-lookup"><span data-stu-id="1ddc4-157">Run the page and click the **Last Name** and **Enrollment Date** column headings to verify that sorting works.</span></span>

![Students_Index_page_with_sort_hyperlinks](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image2.png)

<span data-ttu-id="1ddc4-159">После того как вы щелкните заголовок **Last Name (фамилия** ), учащиеся будут отображаться в порядке убывания фамилий.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-159">After you click the **Last Name** heading, students are displayed in descending last name order.</span></span>

![](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image3.png)

## <a name="add-a-search-box-to-the-students-index-page"></a><span data-ttu-id="1ddc4-160">Добавление поля поиска на страницу индекса учащихся</span><span class="sxs-lookup"><span data-stu-id="1ddc4-160">Add a Search Box to the Students Index Page</span></span>

<span data-ttu-id="1ddc4-161">Для добавления фильтра на страницу указателя учащихся необходимо добавить в представление текстовое поле и кнопку отправки и внести изменения в метод `Index`.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-161">To add filtering to the Students Index page, you'll add a text box and a submit button to the view and make corresponding changes in the `Index` method.</span></span> <span data-ttu-id="1ddc4-162">Текстовое поле необходимо для ввода строки для поиска в полях имени и фамилии.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-162">The text box will let you enter a string to search for in the first name and last name fields.</span></span>

### <a name="add-filtering-functionality-to-the-index-method"></a><span data-ttu-id="1ddc4-163">Добавление функций фильтрации в метод Index</span><span class="sxs-lookup"><span data-stu-id="1ddc4-163">Add Filtering Functionality to the Index Method</span></span>

<span data-ttu-id="1ddc4-164">В *контроллерс\студентконтроллер.КС*замените метод `Index` следующим кодом (изменения выделены):</span><span class="sxs-lookup"><span data-stu-id="1ddc4-164">In *Controllers\StudentController.cs*, replace the `Index` method with the following code (the changes are highlighted):</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample4.cs?highlight=1,7-11)]

<span data-ttu-id="1ddc4-165">Мы добавили в метод `Index` параметр `searchString`.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-165">You've added a `searchString` parameter to the `Index` method.</span></span> <span data-ttu-id="1ddc4-166">Вы также добавили в инструкцию LINQ предложение `where`, которое выбирает только учащихся, чье имя или фамилия содержат строку поиска.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-166">You've also added to the LINQ statement a `where` clause that selects only students whose first name or last name contains the search string.</span></span> <span data-ttu-id="1ddc4-167">Значение строки поиска получено из текстового поля, которое будет добавлено в представление индекса. Инструкция, которая добавляет предложение [WHERE](https://msdn.microsoft.com/library/bb535040.aspx) , выполняется только в том случае, если имеется искомое значение.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-167">The search string value is received from a text box that you'll add to the Index view.The statement that adds the [where](https://msdn.microsoft.com/library/bb535040.aspx) clause is executed only if there's a value to search for.</span></span>

> [!NOTE]
> <span data-ttu-id="1ddc4-168">Во многих случаях один и тот же метод можно вызвать либо в Entity Framework наборе сущностей, либо в виде метода расширения для коллекции в памяти.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-168">In many cases you can call the same method either on an Entity Framework entity set or as an extension method on an in-memory collection.</span></span> <span data-ttu-id="1ddc4-169">Результаты обычно одинаковы, но в некоторых случаях они могут отличаться.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-169">The results are normally the same but in some cases may be different.</span></span> <span data-ttu-id="1ddc4-170">Например, .NET Framework реализация метода `Contains` возвращает все строки, когда в нее передается пустая строка, но поставщик Entity Framework для SQL Server Compact 4,0 возвращает нулевые строки для пустых строк.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-170">For example, the .NET Framework implementation of the `Contains` method returns all rows when you pass an empty string to it, but the Entity Framework provider for SQL Server Compact 4.0 returns zero rows for empty strings.</span></span> <span data-ttu-id="1ddc4-171">Поэтому код в примере (поместив оператор `Where` в инструкцию `if`) гарантирует получение одинаковых результатов для всех версий SQL Server.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-171">Therefore the code in the example (putting the `Where` statement inside an `if` statement) makes sure that you get the same results for all versions of SQL Server.</span></span> <span data-ttu-id="1ddc4-172">Кроме того, .NET Frameworkная реализация метода `Contains` выполняет сравнение с учетом регистра по умолчанию, но Entity Framework SQL Server поставщики выполняют сравнения без учета регистра по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-172">Also, the .NET Framework implementation of the `Contains` method performs a case-sensitive comparison by default, but Entity Framework SQL Server providers perform case-insensitive comparisons by default.</span></span> <span data-ttu-id="1ddc4-173">Таким образом, вызов метода `ToUpper` для проверки явного нечувствительного к регистру регистра гарантирует, что результаты не изменяются при последующем изменении кода для использования репозитория, который вернет коллекцию `IEnumerable` вместо объекта `IQueryable`.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-173">Therefore, calling the `ToUpper` method to make the test explicitly case-insensitive ensures that results do not change when you change the code later to use a repository, which will return an `IEnumerable` collection instead of an `IQueryable` object.</span></span> <span data-ttu-id="1ddc4-174">(При вызове метода `Contains` коллекции `IEnumerable` выполняется реализация .NET Framework; при вызове этого же метода у объекта `IQueryable` выполняется реализация поставщика базы данных.)</span><span class="sxs-lookup"><span data-stu-id="1ddc4-174">(When you call the `Contains` method on an `IEnumerable` collection, you get the .NET Framework implementation; when you call it on an `IQueryable` object, you get the database provider implementation.)</span></span>

### <a name="add-a-search-box-to-the-student-index-view"></a><span data-ttu-id="1ddc4-175">Добавление поля поиска на страницу индекса учащихся</span><span class="sxs-lookup"><span data-stu-id="1ddc4-175">Add a Search Box to the Student Index View</span></span>

<span data-ttu-id="1ddc4-176">В *виевс\студент\индекс.кштмл*Добавьте выделенный код непосредственно перед открывающим тегом `table`, чтобы создать заголовок, текстовое поле и кнопку **поиска** .</span><span class="sxs-lookup"><span data-stu-id="1ddc4-176">In *Views\Student\Index.cshtml*, add the highlighted code immediately before the opening `table` tag in order to create a caption, a text box, and a **Search** button.</span></span>

[!code-cshtml[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample5.cshtml?highlight=5-10)]

<span data-ttu-id="1ddc4-177">Запустите страницу, введите строку поиска и нажмите кнопку **Поиск** , чтобы убедиться, что фильтрация работает.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-177">Run the page, enter a search string, and click **Search** to verify that filtering is working.</span></span>

![Students_Index_page_with_search_box](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image4.png)

<span data-ttu-id="1ddc4-179">Обратите внимание, что URL-адрес не содержит строку поиска "a". Это означает, что если вы заметите эту страницу в закладки, отфильтрованный список не будет получен при использовании закладки.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-179">Notice the URL doesn't contain the "an" search string, which means that if you bookmark this page, you won't get the filtered list when you use the bookmark.</span></span> <span data-ttu-id="1ddc4-180">Вы измените кнопку **поиска** , чтобы в дальнейшем использовать строки запросов для критериев фильтрации.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-180">You'll change the **Search** button to use query strings for filter criteria later in the tutorial.</span></span>

## <a name="add-paging-to-the-students-index-page"></a><span data-ttu-id="1ddc4-181">Добавление разбиения на страницы индекса учащихся</span><span class="sxs-lookup"><span data-stu-id="1ddc4-181">Add Paging to the Students Index Page</span></span>

<span data-ttu-id="1ddc4-182">Чтобы добавить подкачку на страницу индекса учащихся, начните с установки пакета NuGet **пажедлист. MVC** .</span><span class="sxs-lookup"><span data-stu-id="1ddc4-182">To add paging to the Students Index page, you'll start by installing the **PagedList.Mvc** NuGet package.</span></span> <span data-ttu-id="1ddc4-183">Затем вы вносите дополнительные изменения в метод `Index` и добавляете ссылки подкачки в представление `Index`.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-183">Then you'll make additional changes in the `Index` method and add paging links to the `Index` view.</span></span> <span data-ttu-id="1ddc4-184">**Пажедлист. MVC** — это один из многих хороших пакетов разбиения по страницам и сортировки для ASP.NET MVC, и его использование здесь предназначено только в качестве примера, а не в качестве рекомендации по сравнению с другими вариантами.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-184">**PagedList.Mvc** is one of many good paging and sorting packages for ASP.NET MVC, and its use here is intended only as an example, not as a recommendation for it over other options.</span></span> <span data-ttu-id="1ddc4-185">На следующем рисунке показаны ссылки на подкачку.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-185">The following illustration shows the paging links.</span></span>

![Students_index_page_with_paging](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image5.png)

### <a name="install-the-pagedlistmvc-nuget-package"></a><span data-ttu-id="1ddc4-187">Установка пакета NuGet Пажедлист. MVC</span><span class="sxs-lookup"><span data-stu-id="1ddc4-187">Install the PagedList.MVC NuGet Package</span></span>

<span data-ttu-id="1ddc4-188">Пакет NuGet **пажедлист. MVC** автоматически устанавливает пакет **пажедлист** в качестве зависимости.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-188">The NuGet **PagedList.Mvc** package automatically installs the **PagedList** package as a dependency.</span></span> <span data-ttu-id="1ddc4-189">Пакет **пажедлист** устанавливает тип коллекции `PagedList` и методы расширения для коллекций `IQueryable` и `IEnumerable`.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-189">The **PagedList** package installs a `PagedList` collection type and extension methods for `IQueryable` and `IEnumerable` collections.</span></span> <span data-ttu-id="1ddc4-190">Методы расширения создают одну страницу данных в коллекции `PagedList` из `IQueryable` или `IEnumerable`, а коллекция `PagedList` предоставляет несколько свойств и методов, которые упрощают разбиение на страницы.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-190">The extension methods create a single page of data in a `PagedList` collection out of your `IQueryable` or `IEnumerable`, and the `PagedList` collection provides several properties and methods that facilitate paging.</span></span> <span data-ttu-id="1ddc4-191">Пакет **пажедлист. MVC** устанавливает вспомогательный метод разбиения на страницы, который отображает кнопки разбиения на страницы.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-191">The **PagedList.Mvc** package installs a paging helper that displays the paging buttons.</span></span>

<span data-ttu-id="1ddc4-192">В меню **Сервис** выберите **Диспетчер пакетов NuGet** , а затем — **Управление пакетами NuGet для решения**.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-192">From the **Tools** menu, select **NuGet Package Manager** and then **Manage NuGet Packages for Solution**.</span></span>

<span data-ttu-id="1ddc4-193">В диалоговом окне **Управление пакетами NuGet** перейдите на вкладку в **Интернете** слева и в поле поиска введите "с постраничным переходом".</span><span class="sxs-lookup"><span data-stu-id="1ddc4-193">In the **Manage NuGet Packages** dialog box, click the **Online** tab on the left and then enter "paged" in the search box.</span></span> <span data-ttu-id="1ddc4-194">Когда появится пакет **пажедлист. MVC** , нажмите кнопку **установить**.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-194">When you see the **PagedList.Mvc** package, click **Install**.</span></span>

![](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image6.png)

<span data-ttu-id="1ddc4-195">В поле **Выбор проектов** нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-195">In the **Select Projects** box, click **OK**.</span></span>

![](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image7.png)

### <a name="add-paging-functionality-to-the-index-method"></a><span data-ttu-id="1ddc4-196">Добавление функции разбиения по страницам в метод Index</span><span class="sxs-lookup"><span data-stu-id="1ddc4-196">Add Paging Functionality to the Index Method</span></span>

<span data-ttu-id="1ddc4-197">В *контроллерс\студентконтроллер.КС*добавьте оператор `using` для пространства имен `PagedList`.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-197">In *Controllers\StudentController.cs*, add a `using` statement for the `PagedList` namespace:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample6.cs)]

<span data-ttu-id="1ddc4-198">Замените метод `Index` следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="1ddc4-198">Replace the `Index` method with the following code:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample7.cs)]

<span data-ttu-id="1ddc4-199">Этот код добавляет параметр `page`, текущий параметр порядка сортировки и текущий параметр фильтра в сигнатуру метода, как показано ниже:</span><span class="sxs-lookup"><span data-stu-id="1ddc4-199">This code adds a `page` parameter, a current sort order parameter, and a current filter parameter to the method signature, as shown here:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample8.cs)]

<span data-ttu-id="1ddc4-200">При первом отображении страницы или если пользователь еще не нажимал на ссылки сортировки и перелистывания, все параметры будут иметь значение null.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-200">The first time the page is displayed, or if the user hasn't clicked a paging or sorting link, all the parameters will be null.</span></span> <span data-ttu-id="1ddc4-201">Если щелкнуть ссылку на подкачку, то `page` переменная будет содержать номер отображаемой страницы.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-201">If a paging link is clicked, the `page` variable will contain the page number to display.</span></span>

<span data-ttu-id="1ddc4-202">`A ViewBag` свойство предоставляет представление с текущим порядком сортировки, поскольку оно должно быть включено в ссылки разбиения на страницы, чтобы порядок сортировки совпадал с порядком разбиения на страницы:</span><span class="sxs-lookup"><span data-stu-id="1ddc4-202">`A ViewBag` property provides the view with the current sort order, because this must be included in the paging links in order to keep the sort order the same while paging:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample9.cs)]

<span data-ttu-id="1ddc4-203">Другое свойство, `ViewBag.CurrentFilter`, предоставляет представление с текущей строкой фильтра.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-203">Another property, `ViewBag.CurrentFilter`, provides the view with the current filter string.</span></span> <span data-ttu-id="1ddc4-204">Это значение необходимо включить в ссылки для перелистывания, чтобы при смене страницы сохранить настройки фильтра, кроме того, необходимо восстановить значение фильтра в текстовом поле после обновления страницы.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-204">This value must be included in the paging links in order to maintain the filter settings during paging, and it must be restored to the text box when the page is redisplayed.</span></span> <span data-ttu-id="1ddc4-205">Если строка поиска изменяется во время перелистывания, то номер страницы должен быть сброшен на 1, так как с новым фильтром изменится состав отображаемых данных.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-205">If the search string is changed during paging, the page has to be reset to 1, because the new filter can result in different data to display.</span></span> <span data-ttu-id="1ddc4-206">Строка поиска изменяется при вводе значения в текстовое поле и нажатии кнопки Submit (отправить).</span><span class="sxs-lookup"><span data-stu-id="1ddc4-206">The search string is changed when a value is entered in the text box and the submit button is pressed.</span></span> <span data-ttu-id="1ddc4-207">В этом случае параметр `searchString` не равен null.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-207">In that case, the `searchString` parameter is not null.</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample10.cs)]

<span data-ttu-id="1ddc4-208">В конце метода метод расширения `ToPagedList` объекта Students `IQueryable` преобразует запрос учащегося на одну страницу учащихся в типе коллекции, который поддерживает разбиение на страницы.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-208">At the end of the method, the `ToPagedList` extension method on the students `IQueryable` object converts the student query to a single page of students in a collection type that supports paging.</span></span> <span data-ttu-id="1ddc4-209">После этого одна страница учащихся передается в представление:</span><span class="sxs-lookup"><span data-stu-id="1ddc4-209">That single page of students is then passed to the view:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample11.cs)]

<span data-ttu-id="1ddc4-210">Метод `ToPagedList` принимает номер страницы.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-210">The `ToPagedList` method takes a page number.</span></span> <span data-ttu-id="1ddc4-211">Два знака вопроса представляют [оператор объединения со значением NULL](https://msdn.microsoft.com/library/ms173224.aspx).</span><span class="sxs-lookup"><span data-stu-id="1ddc4-211">The two question marks represent the [null-coalescing operator](https://msdn.microsoft.com/library/ms173224.aspx).</span></span> <span data-ttu-id="1ddc4-212">Этот оператор определяет значение по умолчанию для значения null; выражение `(page ?? 1)` возвращает значение переменной `page`, если она имеет значение, и возвращает 1, если переменная `page` имеет значение null.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-212">The null-coalescing operator defines a default value for a nullable type; the expression `(page ?? 1)` means return the value of `page` if it has a value, or return 1 if `page` is null.</span></span>

### <a name="add-paging-links-to-the-student-index-view"></a><span data-ttu-id="1ddc4-213">Добавление ссылок на подкачку в представление индекса учащихся</span><span class="sxs-lookup"><span data-stu-id="1ddc4-213">Add Paging Links to the Student Index View</span></span>

<span data-ttu-id="1ddc4-214">В *виевс\студент\индекс.кштмл*замените существующий код следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="1ddc4-214">In *Views\Student\Index.cshtml*, replace the existing code with the following code:</span></span>

[!code-cshtml[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample12.cshtml?highlight=6,9,14-20,56-58)]

<span data-ttu-id="1ddc4-215">Оператор `@model` в начале страницы указывает на то, что теперь представление принимает объект `PagedList`, а не объект `List`.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-215">The `@model` statement at the top of the page specifies that the view now gets a `PagedList` object instead of a `List` object.</span></span>

<span data-ttu-id="1ddc4-216">Инструкция `using` для `PagedList.Mvc` предоставляет доступ к вспомогательному модулю MVC для кнопок разбиения на страницы.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-216">The `using` statement for `PagedList.Mvc` gives access to the MVC helper for the paging buttons.</span></span>

<span data-ttu-id="1ddc4-217">Код использует перегрузку [бегинформ](https://msdn.microsoft.com/library/system.web.mvc.html.formextensions.beginform(v=vs.108).aspx) , которая позволяет ему указать [форммесод. Get](https://msdn.microsoft.com/library/system.web.mvc.formmethod(v=vs.100).aspx/css).</span><span class="sxs-lookup"><span data-stu-id="1ddc4-217">The code uses an overload of [BeginForm](https://msdn.microsoft.com/library/system.web.mvc.html.formextensions.beginform(v=vs.108).aspx) that allows it to specify [FormMethod.Get](https://msdn.microsoft.com/library/system.web.mvc.formmethod(v=vs.100).aspx/css).</span></span>

[!code-cshtml[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample13.cshtml?highlight=1)]

<span data-ttu-id="1ddc4-218">[Бегинформ](https://msdn.microsoft.com/library/system.web.mvc.html.formextensions.beginform(v=vs.108).aspx) по умолчанию отправляет данные формы с помощью записи, что означает, что параметры передаются в тексте сообщения HTTP, а не в URL-адресе в виде строк запроса.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-218">The default [BeginForm](https://msdn.microsoft.com/library/system.web.mvc.html.formextensions.beginform(v=vs.108).aspx) submits form data with a POST, which means that parameters are passed in the HTTP message body and not in the URL as query strings.</span></span> <span data-ttu-id="1ddc4-219">При указании метода HTTP GET данные формы передаются в URL-адресе в виде строк запроса, что позволяет добавлять URL-адреса в закладки.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-219">When you specify HTTP GET, the form data is passed in the URL as query strings, which enables users to bookmark the URL.</span></span> <span data-ttu-id="1ddc4-220">[Рекомендации консорциума W3C по использованию HTTP Get](http://www.w3.org/2001/tag/doc/whenToUseGet.html) указывают, что следует использовать GET, если действие не приводит к обновлению.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-220">The [W3C guidelines for the use of HTTP GET](http://www.w3.org/2001/tag/doc/whenToUseGet.html) specify that you should use GET when the action does not result in an update.</span></span>

<span data-ttu-id="1ddc4-221">Текстовое поле инициализируется текущей строкой поиска, поэтому при щелчке на новой странице можно увидеть текущую строку поиска.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-221">The text box is initialized with the current search string so when you click a new page you can see the current search string.</span></span>

[!code-cshtml[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample14.cshtml?highlight=1)]

<span data-ttu-id="1ddc4-222">Ссылки в заголовках столбцов передают в контроллер при помощи строки запроса текущее значение строки поиска, чтобы пользователь мог сортировать отфильтрованные данные:</span><span class="sxs-lookup"><span data-stu-id="1ddc4-222">The column header links use the query string to pass the current search string to the controller so that the user can sort within filter results:</span></span>

[!code-cshtml[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample15.cshtml?highlight=1)]

<span data-ttu-id="1ddc4-223">Отобразится текущая страница и общее количество страниц.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-223">The current page and total number of pages are displayed.</span></span>

[!code-cshtml[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample16.cshtml)]

<span data-ttu-id="1ddc4-224">Если нет страниц для отображения, отображается страница 0 из 0.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-224">If there are no pages to display, "Page 0 of 0" is shown.</span></span> <span data-ttu-id="1ddc4-225">(В этом случае номер страницы больше, чем число страниц, поскольку `Model.PageNumber` равно 1, а `Model.PageCount` — 0.)</span><span class="sxs-lookup"><span data-stu-id="1ddc4-225">(In that case the page number is greater than the page count because `Model.PageNumber` is 1, and `Model.PageCount` is 0.)</span></span>

<span data-ttu-id="1ddc4-226">Кнопки разбиения на страницы отображаются `PagedListPager` вспомогательным модулем:</span><span class="sxs-lookup"><span data-stu-id="1ddc4-226">The paging buttons are displayed by the `PagedListPager` helper:</span></span>

[!code-cshtml[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample17.cshtml)]

<span data-ttu-id="1ddc4-227">Модуль поддержки `PagedListPager` предоставляет ряд параметров, которые можно настраивать, включая URL-адреса и стили.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-227">The `PagedListPager` helper provides a number of options that you can customize, including URLs and styling.</span></span> <span data-ttu-id="1ddc4-228">Дополнительные сведения см. в разделе [тройгуде/пажедлист](https://github.com/TroyGoode/PagedList) на сайте GitHub.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-228">For more information, see [TroyGoode / PagedList](https://github.com/TroyGoode/PagedList) on the GitHub site.</span></span>

<span data-ttu-id="1ddc4-229">Запустите страницу.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-229">Run the page.</span></span>

![Students_index_page_with_paging](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image8.png)

<span data-ttu-id="1ddc4-231">Чтобы убедиться, что постраничный просмотр работает, нажимайте кнопки перелистывания при различном порядке сортировки.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-231">Click the paging links in different sort orders to make sure paging works.</span></span> <span data-ttu-id="1ddc4-232">Затем введите строку поиска и повторите перелистывание, чтобы убедиться, что разбиение на страницы работает корректно вместе с сортировкой и фильтрацией.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-232">Then enter a search string and try paging again to verify that paging also works correctly with sorting and filtering.</span></span>

![](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image9.png)

## <a name="create-an-about-page-that-shows-student-statistics"></a><span data-ttu-id="1ddc4-233">Создание страницы "о программе" с отображением статистики учащихся</span><span class="sxs-lookup"><span data-stu-id="1ddc4-233">Create an About Page That Shows Student Statistics</span></span>

<span data-ttu-id="1ddc4-234">На странице со сведениями о веб-сайте университета Contoso вы увидите, сколько учащихся зарегистрировано для каждой даты регистрации.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-234">For the Contoso University website's About page, you'll display how many students have enrolled for each enrollment date.</span></span> <span data-ttu-id="1ddc4-235">Для этого понадобится группировка и выполнение простых расчетов в группах.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-235">This requires grouping and simple calculations on the groups.</span></span> <span data-ttu-id="1ddc4-236">Для выполнения этой задачи нам потребуется следующее:</span><span class="sxs-lookup"><span data-stu-id="1ddc4-236">To accomplish this, you'll do the following:</span></span>

- <span data-ttu-id="1ddc4-237">Создать класс модели представления для данных, которые необходимо передать в представление.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-237">Create a view model class for the data that you need to pass to the view.</span></span>
- <span data-ttu-id="1ddc4-238">Измените метод `About` в контроллере `Home`.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-238">Modify the `About` method in the `Home` controller.</span></span>
- <span data-ttu-id="1ddc4-239">Измените представление `About`.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-239">Modify the `About` view.</span></span>

### <a name="create-the-view-model"></a><span data-ttu-id="1ddc4-240">Создание модели представления</span><span class="sxs-lookup"><span data-stu-id="1ddc4-240">Create the View Model</span></span>

<span data-ttu-id="1ddc4-241">Создайте папку *ViewModels* .</span><span class="sxs-lookup"><span data-stu-id="1ddc4-241">Create a *ViewModels* folder.</span></span> <span data-ttu-id="1ddc4-242">В этой папке добавьте файл класса *EnrollmentDateGroup.CS* и замените существующий код следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="1ddc4-242">In that folder, add a class file *EnrollmentDateGroup.cs* and replace the existing code with the following code:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample18.cs)]

### <a name="modify-the-home-controller"></a><span data-ttu-id="1ddc4-243">Изменение контроллера Home</span><span class="sxs-lookup"><span data-stu-id="1ddc4-243">Modify the Home Controller</span></span>

<span data-ttu-id="1ddc4-244">В *HomeController.CS*добавьте в начало файла следующие инструкции `using`:</span><span class="sxs-lookup"><span data-stu-id="1ddc4-244">In *HomeController.cs*, add the following `using` statements at the top of the file:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample19.cs)]

<span data-ttu-id="1ddc4-245">Добавьте переменную класса для контекста базы данных сразу после открывающей фигурной скобки для класса:</span><span class="sxs-lookup"><span data-stu-id="1ddc4-245">Add a class variable for the database context immediately after the opening curly brace for the class:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample20.cs?highlight=3)]

<span data-ttu-id="1ddc4-246">Замените метод `About` следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="1ddc4-246">Replace the `About` method with the following code:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample21.cs)]

<span data-ttu-id="1ddc4-247">Запрос LINQ группирует записи из таблицы студентов по дате зачисления, вычисляет число записей в каждой группе и сохраняет результаты в коллекцию объектов моделей представления `EnrollmentDateGroup`.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-247">The LINQ statement groups the student entities by enrollment date, calculates the number of entities in each group, and stores the results in a collection of `EnrollmentDateGroup` view model objects.</span></span>

<span data-ttu-id="1ddc4-248">Добавьте метод `Dispose`:</span><span class="sxs-lookup"><span data-stu-id="1ddc4-248">Add a `Dispose` method:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample22.cs)]

### <a name="modify-the-about-view"></a><span data-ttu-id="1ddc4-249">Изменение представления About</span><span class="sxs-lookup"><span data-stu-id="1ddc4-249">Modify the About View</span></span>

<span data-ttu-id="1ddc4-250">Замените код в файле *виевс\хоме\абаут.кштмл* следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="1ddc4-250">Replace the code in the *Views\Home\About.cshtml* file with the following code:</span></span>

[!code-cshtml[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample23.cshtml)]

<span data-ttu-id="1ddc4-251">Запустите приложение и щелкните ссылку **About (о программе** ).</span><span class="sxs-lookup"><span data-stu-id="1ddc4-251">Run the app and click the **About** link.</span></span> <span data-ttu-id="1ddc4-252">Количество зачисленных студентов по дням отображается в таблице.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-252">The count of students for each enrollment date is displayed in a table.</span></span>

![About_page](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image10.png)

## <a name="optional-deploy-the-app-to-windows-azure"></a><span data-ttu-id="1ddc4-254">Необязательно: развертывание приложения в Windows Azure</span><span class="sxs-lookup"><span data-stu-id="1ddc4-254">Optional: Deploy the app to Windows Azure</span></span>

<span data-ttu-id="1ddc4-255">Пока приложение запущено локально в IIS Express на компьютере разработчика.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-255">So far your application has been running locally in IIS Express on your development computer.</span></span> <span data-ttu-id="1ddc4-256">Чтобы сделать его доступным для других пользователей через Интернет, необходимо развернуть его для поставщика услуг размещения веб-сайтов.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-256">To make it available for other people to use over the Internet, you have to deploy it to a web hosting provider.</span></span> <span data-ttu-id="1ddc4-257">В этом необязательном разделе учебника вы развернете его на веб-сайте Windows Azure.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-257">In this optional section of the tutorial you'll deploy it to a Windows Azure Web Site.</span></span>

### <a name="using-code-first-migrations-to-deploy-the-database"></a><span data-ttu-id="1ddc4-258">Развертывание базы данных с помощью Code First Migrations</span><span class="sxs-lookup"><span data-stu-id="1ddc4-258">Using Code First Migrations to Deploy the Database</span></span>

<span data-ttu-id="1ddc4-259">Чтобы развернуть базу данных, используйте Code First Migrations.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-259">To deploy the database you'll use Code First Migrations.</span></span> <span data-ttu-id="1ddc4-260">При создании профиля публикации, который используется для настройки параметров развертывания из Visual Studio, необходимо установить флажок " **выполнить Code First migrations" (выполняется при запуске приложения)** .</span><span class="sxs-lookup"><span data-stu-id="1ddc4-260">When you create the publish profile that you use to configure settings for deploying from Visual Studio, you'll select a check box that is labeled **Execute Code First Migrations (runs on application start)**.</span></span> <span data-ttu-id="1ddc4-261">Этот параметр приводит к тому, что процесс развертывания автоматически настраивает файл *Web. config* приложения на целевом сервере, чтобы Code First использует класс инициализатора `MigrateDatabaseToLatestVersion`.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-261">This setting causes the deployment process to automatically configure the application *Web.config* file on the destination server so that Code First uses the `MigrateDatabaseToLatestVersion` initializer class.</span></span>

<span data-ttu-id="1ddc4-262">Visual Studio не выполняет никаких действий с базой данных в процессе развертывания.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-262">Visual Studio does not do anything with the database during the deployment process.</span></span> <span data-ttu-id="1ddc4-263">Когда развернутое приложение обращается к базе данных в первый раз после развертывания, Code First автоматически создает базу данных или обновляет схему базы данных до последней версии.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-263">When the deployed application accesses the database for the first time after deployment, Code First automatically creates the database or updates the database schema to the latest version.</span></span> <span data-ttu-id="1ddc4-264">Если приложение реализует метод миграции `Seed`, метод выполняется после создания базы данных или обновления схемы.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-264">If the application implements a Migrations `Seed` method, the method runs after the database is created or the schema is updated.</span></span>

<span data-ttu-id="1ddc4-265">При миграции `Seed` метод вставляет проверочные данные.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-265">Your Migrations `Seed` method inserts test data.</span></span> <span data-ttu-id="1ddc4-266">При развертывании в рабочей среде потребуется изменить метод `Seed`, чтобы он вставил только те данные, которые необходимо вставить в рабочую базу данных.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-266">If you were deploying to a production environment, you would have to change the `Seed` method so that it only inserts data that you want to be inserted into your production database.</span></span> <span data-ttu-id="1ddc4-267">Например, в текущей модели данных может возникнуть необходимость в реальных курсах, но вымышленных учащихся в базе данных разработки.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-267">For example, in your current data model you might want to have real courses but fictional students in the development database.</span></span> <span data-ttu-id="1ddc4-268">Вы можете написать `Seed` метод для загрузки в процессе разработки, а затем закомментировать вымышленные учащиеся перед развертыванием в рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-268">You can write a `Seed` method to load both in development, and then comment out the fictional students before you deploy to production.</span></span> <span data-ttu-id="1ddc4-269">Кроме того, можно написать `Seed` метод для загрузки только курсов и ввести вымышленные учащиеся в тестовой базе данных вручную с помощью пользовательского интерфейса приложения.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-269">Or you can write a `Seed` method to load only courses, and enter the fictional students in the test database manually by using the application's UI.</span></span>

### <a name="get-a-windows-azure-account"></a><span data-ttu-id="1ddc4-270">Получение учетной записи Windows Azure</span><span class="sxs-lookup"><span data-stu-id="1ddc4-270">Get a Windows Azure account</span></span>

<span data-ttu-id="1ddc4-271">Вам потребуется учетная запись Windows Azure.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-271">You'll need a Windows Azure account.</span></span> <span data-ttu-id="1ddc4-272">Если у вас ее еще нет, вы можете создать бесплатную пробную учетную запись всего за несколько минут.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-272">If you don't already have one, you can create a free trial account in just a couple of minutes.</span></span> <span data-ttu-id="1ddc4-273">Дополнительные сведения см. в статье [Бесплатная пробная версия Windows Azure](https://azure.microsoft.com/free/?WT.mc_id=A443DD604).</span><span class="sxs-lookup"><span data-stu-id="1ddc4-273">For details, see [Windows Azure Free Trial](https://azure.microsoft.com/free/?WT.mc_id=A443DD604).</span></span>

### <a name="create-a-web-site-and-a-sql-database-in-windows-azure"></a><span data-ttu-id="1ddc4-274">Создание веб-сайта и базы данных SQL в Windows Azure</span><span class="sxs-lookup"><span data-stu-id="1ddc4-274">Create a web site and a SQL database in Windows Azure</span></span>

<span data-ttu-id="1ddc4-275">Веб-сайт Windows Azure будет работать в общей среде размещения. Это означает, что она выполняется на виртуальных машинах, которые являются общими для других клиентов Windows Azure.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-275">Your Windows Azure Web Site will run in a shared hosting environment, which means it runs on virtual machines (VMs) that are shared with other Windows Azure clients.</span></span> <span data-ttu-id="1ddc4-276">Общая среда размещения — это экономичный способ начать работу в облаке.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-276">A shared hosting environment is a low-cost way to get started in the cloud.</span></span> <span data-ttu-id="1ddc4-277">Позже, если веб-трафик увеличится, приложение сможет масштабироваться в соответствии с потребностями, запуская на выделенных виртуальных машинах.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-277">Later, if your web traffic increases, the application can scale to meet the need by running on dedicated VMs.</span></span> <span data-ttu-id="1ddc4-278">Если вам нужна более сложная архитектура, можно выполнить миграцию в облачную службу Windows Azure.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-278">If you need a more complex architecture, you can migrate to a Windows Azure Cloud Service.</span></span> <span data-ttu-id="1ddc4-279">Облачные службы выполняются на выделенных виртуальных машинах, которые можно настроить в соответствии с вашими потребностями.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-279">Cloud services run on dedicated VMs that you can configure according to your needs.</span></span>

<span data-ttu-id="1ddc4-280">База данных SQL Windows Azure — это облачная служба реляционных баз данных, созданная на основе технологий SQL Server.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-280">Windows Azure SQL Database is a cloud-based relational database service that is built on SQL Server technologies.</span></span> <span data-ttu-id="1ddc4-281">Средства и приложения, работающие с SQL Server также работают с базой данных SQL.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-281">Tools and applications that work with SQL Server also work with SQL Database.</span></span>

1. <span data-ttu-id="1ddc4-282">В [портал управления Windows Azure](https://manage.windowsazure.com/)щелкните **веб-сайты** на вкладке слева и нажмите кнопку **создать**.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-282">In the [Windows Azure Management Portal](https://manage.windowsazure.com/), click **Web Sites** in the left tab, and then click **New**.</span></span>

    ![Кнопка "создать" в портал управления](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image11.png)
2. <span data-ttu-id="1ddc4-284">Щелкните **настраиваемое создание**.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-284">Click **CUSTOM CREATE**.</span></span>

    ![Создание с помощью канала связи базы данных в портал управления](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image12.png)

   <span data-ttu-id="1ddc4-286">Откроется **новый веб-сайт — настраиваемый мастер создания** .</span><span class="sxs-lookup"><span data-stu-id="1ddc4-286">The **New Web Site - Custom Create** wizard opens.</span></span>
3. <span data-ttu-id="1ddc4-287">На шаге **новый веб-сайт** мастера введите строку в поле **URL-адрес** , чтобы использовать его в качестве уникального URL-адреса для приложения.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-287">In the **New Web Site** step of the wizard, enter a string in the **URL** box to use as the unique URL for your application.</span></span> <span data-ttu-id="1ddc4-288">Полный URL-адрес будет содержать то, что вы вводите здесь, а также суффикс, который вы видите рядом с текстовым полем.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-288">The complete URL will consist of what you enter here plus the suffix that you see next to the text box.</span></span> <span data-ttu-id="1ddc4-289">На рисунке показан «кону», но этот URL-адрес, вероятно, будет создан, поэтому необходимо выбрать другой.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-289">The illustration shows "ConU", but that URL is probably taken so you will have to choose a different one.</span></span>

    ![Создание с помощью канала связи базы данных в портал управления](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image13.png)
4. <span data-ttu-id="1ddc4-291">В раскрывающемся списке **регион** выберите область, близкую к вам.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-291">In the **Region** drop-down list, choose a region close to you.</span></span> <span data-ttu-id="1ddc4-292">Этот параметр указывает центр обработки данных, в котором будет выполняться веб-сайт.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-292">This setting specifies which data center your web site will run in.</span></span>
5. <span data-ttu-id="1ddc4-293">В раскрывающемся списке **база данных** выберите **создать свободную базу данных SQL объемом 20 МБ**.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-293">In the **Database** drop-down list, choose **Create a free 20 MB SQL database**.</span></span>

    ![](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image14.png)
6. <span data-ttu-id="1ddc4-294">В поле **имя строки подключения к базе данных**введите *SchoolContext*.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-294">In the **DB CONNECTION STRING NAME**, enter *SchoolContext*.</span></span>

    ![](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image15.png)
7. <span data-ttu-id="1ddc4-295">Щелкните стрелку, расположенную справа внизу окна.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-295">Click the arrow that points to the right at the bottom of the box.</span></span> <span data-ttu-id="1ddc4-296">Мастер переходит к шагу **Параметры базы данных** .</span><span class="sxs-lookup"><span data-stu-id="1ddc4-296">The wizard advances to the **Database Settings** step.</span></span>
8. <span data-ttu-id="1ddc4-297">В поле **имя** введите *контосауниверситидб*.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-297">In the **Name** box, enter *ContosoUniversityDB*.</span></span>
9. <span data-ttu-id="1ddc4-298">В поле **сервер** выберите **новый сервер базы данных SQL**.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-298">In the **Server** box, select **New SQL Database server**.</span></span> <span data-ttu-id="1ddc4-299">Кроме того, если ранее был создан сервер, можно выбрать его в раскрывающемся списке.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-299">Alternatively, if you previously created a server, you can select that server from the drop-down list.</span></span>
10. <span data-ttu-id="1ddc4-300">Введите имя для **входа** и **пароль**администратора.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-300">Enter an administrator **LOGIN NAME** and **PASSWORD**.</span></span> <span data-ttu-id="1ddc4-301">Если вы выбрали « **новый сервер базы данных SQL** », введите новое имя и пароль, которые будут использоваться позже при доступе к базе данных.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-301">If you selected **New SQL Database server** you aren't entering an existing name and password here, you're entering a new name and password that you're defining now to use later when you access the database.</span></span> <span data-ttu-id="1ddc4-302">Если вы выбрали ранее созданный сервер, введите учетные данные для этого сервера.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-302">If you selected a server that you created previously, you'll enter credentials for that server.</span></span> <span data-ttu-id="1ddc4-303">В этом учебнике не будет установлен флажок ***Дополнительно*** .</span><span class="sxs-lookup"><span data-stu-id="1ddc4-303">For this tutorial, you won't select the ***Advanced*** check box.</span></span> <span data-ttu-id="1ddc4-304">***Дополнительные*** параметры позволяют задать [Параметры сортировки](https://msdn.microsoft.com/library/aa174903(v=SQL.80).aspx)базы данных.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-304">The ***Advanced*** options enable you to set the database [collation](https://msdn.microsoft.com/library/aa174903(v=SQL.80).aspx).</span></span>
11. <span data-ttu-id="1ddc4-305">Выберите тот же **регион** , который вы выбрали для веб-сайта.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-305">Choose the same **Region** that you chose for the web site.</span></span>
12. <span data-ttu-id="1ddc4-306">Щелкните галочку в правом нижнем углу окна, чтобы указать, что вы завершили работу.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-306">Click the check mark at the bottom right of the box to indicate that you're finished.</span></span>   
  
    ![Шаг "Параметры базы данных" для создания веб-сайта — мастер создания базы данных](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image16.png)  

    <span data-ttu-id="1ddc4-308">На следующем рисунке показано использование существующего SQL Server и имени входа.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-308">The following image shows using an existing SQL Server and Login.</span></span>   
  
    ![Шаг "Параметры базы данных" для создания веб-сайта — мастер создания базы данных](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image17.png)  
  
    <span data-ttu-id="1ddc4-310">Портал управления возвращается на страницу веб-сайтов, а в столбце **состояние** указывается, что сайт создается.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-310">The Management Portal returns to the Web Sites page, and the **Status** column shows that the site is being created.</span></span> <span data-ttu-id="1ddc4-311">Через некоторое время (обычно меньше минуты) в столбце **состояние** указывается, что сайт был успешно создан.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-311">After a while (typically less than a minute), the **Status** column shows that the site was successfully created.</span></span> <span data-ttu-id="1ddc4-312">На панели навигации слева отображается число сайтов в вашей учетной записи рядом со значком **веб-сайтов** , а рядом со значком **базы данных SQL** отображается число баз данных.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-312">In the navigation bar at the left, the number of sites you have in your account appears next to the **Web Sites** icon, and the number of databases appears next to the **SQL Databases** icon.</span></span>

## <a name="deploy-the-application-to-windows-azure"></a><span data-ttu-id="1ddc4-313">Развертывание приложения в Windows Azure</span><span class="sxs-lookup"><span data-stu-id="1ddc4-313">Deploy the application to Windows Azure</span></span>

1. <span data-ttu-id="1ddc4-314">В Visual Studio щелкните правой кнопкой мыши проект в **Обозреватель решений** и выберите в контекстном меню пункт **опубликовать** .</span><span class="sxs-lookup"><span data-stu-id="1ddc4-314">In Visual Studio, right-click the project in **Solution Explorer** and select **Publish** from the context menu.</span></span>  
  
    ![Опубликовать в контекстном меню проекта](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image18.png)
2. <span data-ttu-id="1ddc4-316">На вкладке **профиль** в мастере **публикации веб-сайта** нажмите кнопку **Импорт**.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-316">In the **Profile** tab of the **Publish Web** wizard, click **Import**.</span></span>  
  
    ![Параметры импорта публикации](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image19.png)
3. <span data-ttu-id="1ddc4-318">Если вы ранее не добавили подписку Windows Azure в Visual Studio, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-318">If you have not previously added your Windows Azure subscription in Visual Studio, perform the following steps.</span></span> <span data-ttu-id="1ddc4-319">На этих шагах вы добавите подписку, чтобы в раскрывающемся списке в разделе **Импорт из веб-сайта Windows Azure** содержался ваш веб-сайт.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-319">In these steps you add your subscription so that the drop-down list under **Import from a Windows Azure web site** will include your web site.</span></span>

    <span data-ttu-id="1ddc4-320">1\.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-320">a.</span></span> <span data-ttu-id="1ddc4-321">В диалоговом окне **Импорт профиля публикации** щелкните **Импорт на веб-сайте Windows Azure**, а затем щелкните **Добавить подписку Windows Azure**.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-321">In the **Import Publish Profile** dialog box, click **Import from a Windows Azure web site**, and then click **Add Windows Azure subscription**.</span></span>

    ![Добавить подписку Windows Azure](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image20.png)

    <span data-ttu-id="1ddc4-323">б.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-323">b.</span></span> <span data-ttu-id="1ddc4-324">В диалоговом окне **Импорт подписок Windows Azure** нажмите кнопку **скачать файл подписки**.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-324">In the **Import Windows Azure Subscriptions** dialog box, click **Download subscription file**.</span></span>

    ![Скачать файл подписки](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image21.png)

    <span data-ttu-id="1ddc4-326">в.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-326">c.</span></span> <span data-ttu-id="1ddc4-327">В окне браузера сохраните файл *publishsettings* .</span><span class="sxs-lookup"><span data-stu-id="1ddc4-327">In your browser window, save the *.publishsettings* file.</span></span>

    ![Скачать файл publishsettings](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image22.png)

    > [!WARNING]
    > <span data-ttu-id="1ddc4-329">Безопасность. файл *publishsettings* содержит ваши учетные данные (незакодированные), которые используются для администрирования подписок и служб Windows Azure.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-329">Security - The *publishsettings* file contains your credentials (unencoded) that are used to administer your Windows Azure subscriptions and services.</span></span> <span data-ttu-id="1ddc4-330">Для этого файла рекомендуется временно сохранить его за пределами исходных каталогов (например, в папке *Libraries\Documents* ), а затем удалить его после завершения импорта.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-330">The security best practice for this file is to store it temporarily outside your source directories (for example in the *Libraries\Documents* folder), and then delete it once the import has completed.</span></span> <span data-ttu-id="1ddc4-331">Злонамеренный пользователь, получивший доступ к файлу `.publishsettings`, может изменять, создавать и удалять службы Windows Azure.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-331">A malicious user who gains access to the `.publishsettings` file can edit, create, and delete your Windows Azure services.</span></span>

    <span data-ttu-id="1ddc4-332">.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-332">d.</span></span> <span data-ttu-id="1ddc4-333">В диалоговом окне **Импорт подписок Windows Azure** нажмите кнопку **Обзор** и перейдите к файлу *publishsettings* .</span><span class="sxs-lookup"><span data-stu-id="1ddc4-333">In the **Import Windows Azure Subscriptions** dialog box, click **Browse** and navigate to the *.publishsettings* file.</span></span>

    ![Скачать подписку](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image23.png)

    <span data-ttu-id="1ddc4-335">Д.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-335">e.</span></span> <span data-ttu-id="1ddc4-336">Нажмите кнопку **Импортировать**.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-336">Click **Import**.</span></span>

    ![импорт](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image24.png)
4. <span data-ttu-id="1ddc4-338">В диалоговом окне **Импорт профиля публикации** выберите **Импорт на веб-сайте Windows Azure**, выберите веб-сайт из раскрывающегося списка и нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-338">In the **Import Publish Profile** dialog box, select **Import from a Windows Azure web site**, select your web site from the drop-down list, and then click **OK**.</span></span>  
  
    ![Импорт профиля публикации](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image25.png)
5. <span data-ttu-id="1ddc4-340">На вкладке **Подключение** щелкните **проверить подключение** , чтобы убедиться в правильности параметров.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-340">In the **Connection** tab, click **Validate Connection** to make sure that the settings are correct.</span></span>  
  
    ![Проверить подключение](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image26.png)
6. <span data-ttu-id="1ddc4-342">После проверки соединения рядом с кнопкой **проверить подключение** отображается зеленая галочка.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-342">When the connection has been validated, a green check mark is shown next to the **Validate Connection** button.</span></span> <span data-ttu-id="1ddc4-343">Нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-343">Click **Next**.</span></span>  
  
    ![Успешно проверено подключение](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image27.png)
7. <span data-ttu-id="1ddc4-345">Откройте раскрывающийся список **удаленная строка подключения** в разделе **SchoolContext** и выберите строку подключения для созданной базы данных.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-345">Open the **Remote connection string** drop-down list under **SchoolContext** and select the connection string for the database you created.</span></span>
8. <span data-ttu-id="1ddc4-346">Выберите **выполнить Code First migrations (выполняется при запуске приложения)** .</span><span class="sxs-lookup"><span data-stu-id="1ddc4-346">Select **Execute Code First Migrations (runs on application start)**.</span></span>
9. <span data-ttu-id="1ddc4-347">Снимите флажок **использовать эту строку подключения во время выполнения** для **UserContext (DefaultConnection)** , так как это приложение не использует базу данных членства.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-347">Uncheck **Use this connection string at runtime** for the **UserContext (DefaultConnection)**, since this application is not using the membership database.</span></span>   
  
    ![Вкладка "Параметры"](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image28.png)
10. <span data-ttu-id="1ddc4-349">Нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-349">Click **Next**.</span></span>
11. <span data-ttu-id="1ddc4-350">На вкладке **Предварительный просмотр** нажмите кнопку **начать предварительный просмотр**.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-350">In the **Preview** tab, click **Start Preview**.</span></span>  
  
    ![Кнопка Стартпревиев на вкладке предварительного просмотра](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image29.png)  
  
    <span data-ttu-id="1ddc4-352">На вкладке отображается список файлов, которые будут скопированы на сервер.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-352">The tab displays a list of the files that will be copied to the server.</span></span> <span data-ttu-id="1ddc4-353">Отображение предварительной версии не требуется для публикации приложения, но это полезная функция, о которой следует помнить.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-353">Displaying the preview isn't required to publish the application but is a useful function to be aware of.</span></span> <span data-ttu-id="1ddc4-354">В этом случае вам не нужно ничего делать со списком отображаемых файлов.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-354">In this case, you don't need to do anything with the list of files that is displayed.</span></span> <span data-ttu-id="1ddc4-355">При следующем развертывании этого приложения в этом списке будут отображаться только измененные файлы.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-355">The next time you deploy this application, only the files that have changed will be in this list.</span></span>  
  
    ![Вывод файла Стартпревиев](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image30.png)
12. <span data-ttu-id="1ddc4-357">Нажмите кнопку **Опубликовать**.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-357">Click **Publish**.</span></span>  
    <span data-ttu-id="1ddc4-358">Visual Studio начнет процесс копирования файлов на сервер Windows Azure.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-358">Visual Studio begins the process of copying the files to the Windows Azure server.</span></span>
13. <span data-ttu-id="1ddc4-359">В окне **вывод** отображаются действия по развертыванию, которые были выполнены, и сообщает об успешном завершении развертывания.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-359">The **Output** window shows what deployment actions were taken and reports successful completion of the deployment.</span></span>  
  
    ![Окно вывода с сообщением об успешном развертывании](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image31.png)
14. <span data-ttu-id="1ddc4-361">После успешного развертывания браузер по умолчанию автоматически открывается по URL-адресу развернутого сайта.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-361">Upon successful deployment, the default browser automatically opens to the URL of the deployed web site.</span></span>  
    <span data-ttu-id="1ddc4-362">Созданное приложение теперь выполняется в облаке.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-362">The application you created is now running in the cloud.</span></span> <span data-ttu-id="1ddc4-363">Перейдите на вкладку учащиеся.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-363">Click the Students tab.</span></span>  
  
    ![Students_index_page_with_paging](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image32.png)

<span data-ttu-id="1ddc4-365">На этом этапе база данных *SchoolContext* была создана в базе данных SQL Windows Azure, так как вы выбрали **Execute Code First migrations (выполняется при запуске приложения)** .</span><span class="sxs-lookup"><span data-stu-id="1ddc4-365">At this point your *SchoolContext* database has been created in the Windows Azure SQL Database because you selected **Execute Code First Migrations (runs on app start)**.</span></span> <span data-ttu-id="1ddc4-366">Файл *Web. config* на развернутом веб-сайте был изменен таким образом, чтобы инициализатор [мигратедатабасетолатестверсион](https://msdn.microsoft.com/library/hh829476(v=vs.103).aspx) выполнялся в первый раз, когда код считывает или записывает данные в базе данных (что происходит при выборе вкладки **students** ):</span><span class="sxs-lookup"><span data-stu-id="1ddc4-366">The *Web.config* file in the deployed web site has been changed so that the [MigrateDatabaseToLatestVersion](https://msdn.microsoft.com/library/hh829476(v=vs.103).aspx) initializer would run the first time your code reads or writes data in the database (which happened when you selected the **Students** tab):</span></span>

![](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image33.png)

<span data-ttu-id="1ddc4-367">Процесс развертывания также создал новую строку подключения *(SchoolContext\_датабасепублиш*) для Code First migrations, которая используется для обновления схемы базы данных и заполнения базы данных.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-367">The deployment process also created a new connection string *(SchoolContext\_DatabasePublish*) for Code First Migrations to use for updating the database schema and seeding the database.</span></span>

![Строка подключения Database_Publish](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image34.png)

<span data-ttu-id="1ddc4-369">Строка подключения *DefaultConnection* предназначена для базы данных членства (которая не используется в этом руководстве).</span><span class="sxs-lookup"><span data-stu-id="1ddc4-369">The *DefaultConnection* connection string is for the membership database (which we are not using in this tutorial).</span></span> <span data-ttu-id="1ddc4-370">Строка подключения *SchoolContext* для базы данных ContosoUniversity.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-370">The *SchoolContext* connection string is for the ContosoUniversity database.</span></span>

<span data-ttu-id="1ddc4-371">Развернутая версия файла Web. config можно найти на компьютере в *контосауниверсити\обж\релеасе\паккаже\паккажетмп\веб.конфиг*. Доступ к развернутому файлу *Web. config* можно получить с помощью протокола FTP.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-371">You can find the deployed version of the Web.config file on your own computer in *ContosoUniversity\obj\Release\Package\PackageTmp\Web.config*. You can access the deployed *Web.config* file itself by using FTP.</span></span> <span data-ttu-id="1ddc4-372">Инструкции см. в статье [развертывание кода с помощью Visual Studio в ASP.NET Web Deployment](../../../../web-forms/overview/deployment/visual-studio-web-deployment/deploying-a-code-update.md).</span><span class="sxs-lookup"><span data-stu-id="1ddc4-372">For instructions, see [ASP.NET Web Deployment using Visual Studio: Deploying a Code Update](../../../../web-forms/overview/deployment/visual-studio-web-deployment/deploying-a-code-update.md).</span></span> <span data-ttu-id="1ddc4-373">Следуйте инструкциям, которые начинаются с "для использования средства FTP, требуются три вещи: URL-адрес FTP, имя пользователя и пароль".</span><span class="sxs-lookup"><span data-stu-id="1ddc4-373">Follow the instructions that start with "To use an FTP tool, you need three things: the FTP URL, the user name, and the password."</span></span>

> [!NOTE]
> <span data-ttu-id="1ddc4-374">Веб-приложение не реализует безопасность, поэтому любой пользователь, который найдет URL-адрес, может изменить данные.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-374">The web app doesn't implement security, so anyone who finds the URL can change the data.</span></span> <span data-ttu-id="1ddc4-375">Инструкции по обеспечению безопасности веб-сайта см. в статье [развертывание безопасного приложения MVC ASP.NET с членством, OAuth и база данных SQL на веб-сайте Windows Azure](https://docs.microsoft.com/aspnet/core/security/authorization/secure-data).</span><span class="sxs-lookup"><span data-stu-id="1ddc4-375">For instructions on how to secure the web site, see [Deploy a Secure ASP.NET MVC app with Membership, OAuth, and SQL Database to a Windows Azure Web Site](https://docs.microsoft.com/aspnet/core/security/authorization/secure-data).</span></span> <span data-ttu-id="1ddc4-376">Вы можете запретить другим пользователям использовать сайт с помощью портал управления Windows Azure или **Обозреватель сервера** в Visual Studio, чтобы отключить сайт.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-376">You can prevent other people from using the site by using the Windows Azure Management Portal or **Server Explorer** in Visual Studio to stop the site.</span></span>

![](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image35.png)

## <a name="code-first-initializers"></a><span data-ttu-id="1ddc4-377">Инициализаторы Code First</span><span class="sxs-lookup"><span data-stu-id="1ddc4-377">Code First Initializers</span></span>

<span data-ttu-id="1ddc4-378">В разделе Deployment (развертывание) вы видели используемый инициализатор [мигратедатабасетолатестверсион](https://msdn.microsoft.com/library/hh829476(v=vs.103).aspx) .</span><span class="sxs-lookup"><span data-stu-id="1ddc4-378">In the deployment section you saw the [MigrateDatabaseToLatestVersion](https://msdn.microsoft.com/library/hh829476(v=vs.103).aspx) initializer being used.</span></span> <span data-ttu-id="1ddc4-379">Code First также предоставляет другие инициализаторы, которые можно использовать, включая [CreateDatabaseIfNotExists](https://msdn.microsoft.com/library/gg679221(v=vs.103).aspx) (по умолчанию), [дропкреатедатабасеифмоделчанжес](https://msdn.microsoft.com/library/gg679604(v=VS.103).aspx) и [дропкреатедатабасеалвайс](https://msdn.microsoft.com/library/gg679506(v=VS.103).aspx).</span><span class="sxs-lookup"><span data-stu-id="1ddc4-379">Code First also provides other initializers that you can use, including [CreateDatabaseIfNotExists](https://msdn.microsoft.com/library/gg679221(v=vs.103).aspx) (the default), [DropCreateDatabaseIfModelChanges](https://msdn.microsoft.com/library/gg679604(v=VS.103).aspx) and [DropCreateDatabaseAlways](https://msdn.microsoft.com/library/gg679506(v=VS.103).aspx).</span></span> <span data-ttu-id="1ddc4-380">Инициализатор `DropCreateAlways` может быть полезен при настройке условий для модульных тестов.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-380">The `DropCreateAlways` initializer can be useful for setting up conditions for unit tests.</span></span> <span data-ttu-id="1ddc4-381">Можно также написать собственные инициализаторы, и вы можете вызвать инициализатор явным образом, если вы не хотите ждать, пока приложение не закончит чтение или запись в базу данных.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-381">You can also write your own initializers, and you can call an initializer explicitly if you don't want to wait until the application reads from or writes to the database.</span></span> <span data-ttu-id="1ddc4-382">Подробное описание инициализаторов см. в главе 6 руководства по [программированию Entity Framework: Code First](http://shop.oreilly.com/product/0636920022220.do) от Джулия Лерман и Роуэн Миллер.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-382">For a comprehensive explanation of initializers, see chapter 6 of the book [Programming Entity Framework: Code First](http://shop.oreilly.com/product/0636920022220.do) by Julie Lerman and Rowan Miller.</span></span>

## <a name="summary"></a><span data-ttu-id="1ddc4-383">Сводка</span><span class="sxs-lookup"><span data-stu-id="1ddc4-383">Summary</span></span>

<span data-ttu-id="1ddc4-384">В этом учебнике вы узнали, как создать модель данных и реализовать базовые функции CRUD, сортировки, фильтрации, разбиения на страницы и группировки.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-384">In this tutorial you've seen how to create a data model and implement basic CRUD, sorting, filtering, paging, and grouping functionality.</span></span> <span data-ttu-id="1ddc4-385">В следующем учебном курсе вы начнете изучение более сложных тем, развернув модель данных.</span><span class="sxs-lookup"><span data-stu-id="1ddc4-385">In the next tutorial you'll begin looking at more advanced topics by expanding the data model.</span></span>

<span data-ttu-id="1ddc4-386">Ссылки на другие ресурсы Entity Framework можно найти в [карте содержимого ASP.NET Data Access](../../../../whitepapers/aspnet-data-access-content-map.md).</span><span class="sxs-lookup"><span data-stu-id="1ddc4-386">Links to other Entity Framework resources can be found in the [ASP.NET Data Access Content Map](../../../../whitepapers/aspnet-data-access-content-map.md).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="1ddc4-387">[Назад](implementing-basic-crud-functionality-with-the-entity-framework-in-asp-net-mvc-application.md)
> [Вперед](creating-a-more-complex-data-model-for-an-asp-net-mvc-application.md)</span><span class="sxs-lookup"><span data-stu-id="1ddc4-387">[Previous](implementing-basic-crud-functionality-with-the-entity-framework-in-asp-net-mvc-application.md)
[Next](creating-a-more-complex-data-model-for-an-asp-net-mvc-application.md)</span></span>
