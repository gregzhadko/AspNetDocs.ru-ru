---
uid: mvc/overview/older-versions/mvc-music-store/mvc-music-store-part-7
title: Часть 7. членство и авторизация | Документация Майкрософт
author: jongalloway
description: В этой серии руководств подробно описаны все шаги, предпринятые для создания примера приложения музыкального хранилища ASP.NET MVC. В части 7 рассматривается членство и авторизация.
ms.author: riande
ms.date: 10/13/2010
ms.assetid: c8511ebe-68bc-4240-87c3-d5ced84a3f37
msc.legacyurl: /mvc/overview/older-versions/mvc-music-store/mvc-music-store-part-7
msc.type: authoredcontent
ms.openlocfilehash: a6a1a936e0ea29ea36721ba78f35845401f74c01
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78433470"
---
# <a name="part-7-membership-and-authorization"></a>Часть 7. членство и авторизация

[Джон Гэллоуэй](https://github.com/jongalloway)

> Музыкальное хранилище MVC — это учебное приложение, в котором представлены и объясняются пошаговые инструкции по использованию ASP.NET MVC и Visual Studio для разработки веб-приложений.  
>   
> Музыкальное хранилище MVC — это упрощенная реализация в магазине, которая продает музыкальные альбомы в сети и реализует базовое администрирование сайта, вход пользователя в систему и функции корзины покупок.  
>   
> В этой серии руководств подробно описаны все шаги, предпринятые для создания примера приложения музыкального хранилища ASP.NET MVC. В части 7 рассматривается членство и авторизация.

Наш контроллер Store Manager в настоящее время доступен всем, кто посещает наш сайт. Изменим это значение, чтобы ограничить разрешения администраторам сайта.

## <a name="adding-the-accountcontroller-and-views"></a>Добавление AccountController и представлений

Единственное различие между шаблоном веб-приложения Full ASP.NET MVC 3 и шаблоном веб-приложения ASP.NET MVC 3 заключается в том, что пустой шаблон не включает контроллер учетной записи. Мы добавим контроллер учетной записи, скопировав несколько файлов из нового приложения MVC ASP.NET, созданного из шаблона веб-приложения ASP.NET MVC 3.

Создайте новое приложение ASP.NET MVC с помощью шаблона веб-приложения Full ASP.NET MVC 3 и скопируйте следующие файлы в те же каталоги в нашем проекте:

1. Копирование AccountController.cs в каталоге Controllers
2. Копирование Аккаунтмоделс в каталоге Models
3. Создайте каталог учетных записей внутри каталога views и скопируйте все четыре представления в

Измените пространство имен для классов контроллера и модели, чтобы они начинались с Мвкмусиксторе. Класс AccountController должен использовать пространство имен Мвкмусиксторе. Controllers, а класс Аккаунтмоделс должен использовать пространство имен Мвкмусиксторе. Models.

*Примечание. Эти файлы также доступны в загружаемом файле Мвкмусиксторе-Ассетс. zip, из которого мы скопировали файлы проекта сайта в начале этого руководства. Файлы членства находятся в каталоге Code.*

Обновленное решение должно выглядеть следующим образом:

![](mvc-music-store-part-7/_static/image1.png)

## <a name="adding-an-administrative-user-with-the-aspnet-configuration-site"></a>Добавление пользователя с правами администратора с сайтом конфигурации ASP.NET

Прежде чем требовать авторизацию на нашем веб-сайте, необходимо создать пользователя с доступом. Самый простой способ создать пользователя — использовать встроенный веб-сайт конфигурации ASP.NET.

Запустите веб-сайт конфигурации ASP.NET, щелкнув значок в обозреватель решений.

![](mvc-music-store-part-7/_static/image2.png)

Запустится веб-сайт конфигурации. Щелкните вкладку Безопасность на начальном экране, а затем щелкните ссылку "включить роли" в центре экрана.

![](mvc-music-store-part-7/_static/image3.png)

Щелкните ссылку "создать роли" или "Управление ролями".

![](mvc-music-store-part-7/_static/image4.png)

В качестве имени роли введите "Administrator" и нажмите кнопку Добавить роль.

![](mvc-music-store-part-7/_static/image5.png)

Нажмите кнопку "назад", а затем щелкните ссылку Создать пользователя в левой части.

![](mvc-music-store-part-7/_static/image6.png)

Заполните поля сведений о пользователе слева, используя следующие сведения:

| **Поле** | **Value** |
| --- | --- |
| **Имя пользователя** | Администратор |
| **Пароль** | password123! |
| **Подтвердите пароль** | password123! |
| **Электронная почта** | (любой адрес электронной почты будет работать) |
| **Контрольный вопрос** | (что вам нравится) |
| **Ответ на контрольный вопрос** | (что вам нравится) |

*Примечание. Вы можете использовать любой пароль, который вы хотите. Параметры безопасности пароля по умолчанию должны иметь пароль длиной 7 символов и содержать один символ, отличный от буквенно-цифрового.*

Выберите роль администратора для этого пользователя и нажмите кнопку Создать пользователя.

![](mvc-music-store-part-7/_static/image7.png)

На этом этапе должно отобразиться сообщение о том, что пользователь успешно создан.

![](mvc-music-store-part-7/_static/image8.png)

Теперь окно браузера можно закрыть.

## <a name="role-based-authorization"></a>Авторизация на основе ролей

Теперь можно ограничить доступ к Стореманажерконтроллер с помощью атрибута [авторизовать], указав, что пользователь должен быть в роли администратора для доступа к любому действию контроллера в классе.

[!code-csharp[Main](mvc-music-store-part-7/samples/sample1.cs)]

*Примечание. атрибут [авторизовать] может быть размещен в конкретных методах действия, а также на уровне класса контроллера.*

Теперь при просмотре/Стореманажер открывается диалоговое окно входа в систему:

![](mvc-music-store-part-7/_static/image9.png)

После входа в систему с помощью нашей новой учетной записи администратора мы можем переходить к экрану редактирования альбома, как и раньше.

> [!div class="step-by-step"]
> [Назад](mvc-music-store-part-6.md)
> [Вперед](mvc-music-store-part-8.md)
