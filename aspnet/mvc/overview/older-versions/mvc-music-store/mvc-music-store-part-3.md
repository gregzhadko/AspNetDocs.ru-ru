---
uid: mvc/overview/older-versions/mvc-music-store/mvc-music-store-part-3
title: Часть 3. Views и ViewModels | Документация Майкрософт
author: jongalloway
description: В этой серии руководств описаны все шаги, необходимые для построения примера приложения ASP.NET MVC Music Store. В части 3 описывается Views и ViewModels.
ms.author: riande
ms.date: 04/21/2011
ms.assetid: 94297aa0-1f2d-4d72-bbcb-63f64653e0c0
msc.legacyurl: /mvc/overview/older-versions/mvc-music-store/mvc-music-store-part-3
msc.type: authoredcontent
ms.openlocfilehash: ce866a169e69c0d85fe18ddeccf271f1f235d440
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/09/2019
ms.locfileid: "59381124"
---
# <a name="part-3-views-and-viewmodels"></a>Часть 3. Представления и классы ViewModel

по [Джон Гэллоуэй](https://github.com/jongalloway)

> Store музыки MVC является учебного приложения, которое вводятся и описываются пошаговые использование ASP.NET MVC и Visual Studio для разработки веб-приложений.  
>   
> Store музыки MVC — это реализация хранилища упрощенный пример, который продает музыкальные альбомы через Интернет и реализует базовый сайт администрирования, вход пользователя и корзины для покупок функциональные возможности.  
>   
> В этой серии руководств описаны все шаги, необходимые для построения примера приложения ASP.NET MVC Music Store. В части 3 описывается Views и ViewModels.


Пока мы просто возврат строк из действий контроллера. Это отличный способ получить представление о том, как работают контроллеры, но это не будет способа построения реальных веб-приложения. Мы собираемся требуется более эффективный способ создания HTML-кода обратно в браузерах, посетите наш сайт – один где файлы шаблонов можно использовать для более легко настроить содержимое HTML обратной отправки. Именно это сделать представления.

## <a name="adding-a-view-template"></a>Добавление шаблона представления

Чтобы использовать шаблон представления, мы измените метод Index в HomeController для возврата ActionResult и он возвращал View(), например, ниже:

[!code-csharp[Main](mvc-music-store-part-3/samples/sample1.cs)]

Указанное выше изменение означает, что вместо возвратил строку, вместо этого мы хотим использовать «Представление» для создания результата обратно.

Теперь мы добавим соответствующий шаблон представления для нашего проекта. Для этого мы будем поместите текстовый курсор в методе действия индекса, а затем щелкните правой кнопкой мыши и выберите «Add View». Откроется диалоговое окно Добавление представления:

![](mvc-music-store-part-3/_static/image1.jpg) ![](mvc-music-store-part-3/_static/image1.png)

Диалоговое окно «Добавление представления» позволяет нам быстро и легко создавать файлы шаблонов представления. По умолчанию «Добавление представления» диалоговое окно предварительно заполняет имя шаблона представления для создания, чтобы он соответствовал метод действия, который будет его использовать. Так как мы использовали контекстного меню «Добавление представления» в методе действия Index() наших HomeController, указанном выше диалоговом окне «Добавление представления» имеет «Index» как имя представления, предварительно заданные по умолчанию. Нам не нужно изменить какие-либо из параметров в этом диалоговом окне, поэтому нажмите кнопку «Добавить».

После нажатия кнопки «Добавить», Visual Web Developer создаст новый Index.cshtml, шаблон представления для нас в каталоге \Views\Home, создание папки в том случае, если еще не существует.

![](mvc-music-store-part-3/_static/image2.png)

Имя и расположение файла «Index.cshtml» важна и следует за соглашения об именовании по умолчанию ASP.NET MVC. Имя каталога, \Views\Home, соответствующий контроллер — которого совпадает с именем HomeController. Имя шаблона представления, индекс, соответствующий метод действия контроллера, который будет применяться для отображения представления.

ASP.NET MVC позволяет избежать необходимости явно указывать имя или расположение шаблона представления, когда мы используем это соглашение об именовании, чтобы вернуть представление. Он будет по умолчанию обрабатывать шаблон представления \Views\Home\Index.cshtml при написании кода, например, ниже в нашей HomeController:

[!code-csharp[Main](mvc-music-store-part-3/samples/sample2.cs)]

Visual Web Developer создается и открывается шаблон представления «Index.cshtml», после того как мы щелкнули кнопку «Добавить» в диалоговом окне «Добавление представления». Ниже приведены значения Index.cshtml.

[!code-cshtml[Main](mvc-music-store-part-3/samples/sample3.cshtml)]

Это представление используется синтаксис Razor, который является более лаконичен, чем подсистема просмотра веб-форм, используемых в веб-форм ASP.NET и предыдущих версиях ASP.NET MVC. Подсистема просмотра веб-форм по-прежнему доступен в ASP.NET MVC 3, но многие разработчики считают представлений Razor действительно хорошо подходит разработки ASP.NET MVC.

Первые три строки задание заголовка страницы, с помощью ViewBag.Title. Мы рассмотрим принцип более подробно скоро, но сначала давайте обновления текста заголовка текста и просмотра страницы. Обновление &lt;h2&gt; тег, чтобы сказать «This — на домашней странице», как показано ниже.

[!code-cshtml[Main](mvc-music-store-part-3/samples/sample4.cshtml)]

Выполняется это приложение показывает, что наш новый текст отображается на домашней странице.

![](mvc-music-store-part-3/_static/image3.png)

## <a name="using-a-layout-for-common-site-elements"></a>С помощью макета для общих элементов сайта

У большинства веб-сайтов контента, который совместно используется много страниц: навигации, колонтитулов, изображения логотипа, ссылки на таблицы стилей, и т.д. Подсистема просмотра Razor можно с легкостью управлять с помощью страница с именем \_Layout.cshtml, который автоматически был создан для нас в папке/Views/Shared.

![](mvc-music-store-part-3/_static/image4.png)

Дважды щелкните эту папку, чтобы просмотреть содержимое, которые приведены ниже.

[!code-cshtml[Main](mvc-music-store-part-3/samples/sample5.cshtml)]

Будет отображать содержимое из наших отдельных представлений @RenderBodyкоманды (), а также любого типичного содержимого, мы хотим находиться за пределами, могут добавляться к \_Layout.cshtml разметки. Нам понадобятся Store музыки наших MVC должны быть распространенных заголовок со ссылками наших область домашней страницы и Store на всех страницах на сайте, поэтому мы добавим, к шаблону прямо над этой @RenderBodyоператор ().

[!code-cshtml[Main](mvc-music-store-part-3/samples/sample6.cshtml)]

## <a name="updating-the-stylesheet"></a>Обновление таблицы стилей

Шаблон пустого проекта включает в себя очень упрощенный CSS-файл, включающий только стили, используемые для отображения сообщений проверки. Наши конструктор предоставляет некоторые дополнительные CSS и изображений для определения внешнего вида и поведения, мы добавим в сейчас.

Обновленный файл CSS и изображения включаются в каталоге содержимого MvcMusicStore Assets.zip, доступный в [MVC-музыка-Store](https://github.com/evilDave/MVC-Music-Store). Мы выберите оба из них в обозревателе Windows и перетащить их в папку содержимого наше решение в Visual Web Developer, как показано ниже:

![](mvc-music-store-part-3/_static/image5.png)

Вам будет предложено подтвердить, следует ли перезаписать существующий файл Site.css. Нажмите "Да".

![](mvc-music-store-part-3/_static/image6.png)

В папку содержимого приложения теперь будет выглядеть следующим образом:

![](mvc-music-store-part-3/_static/image7.png)

Теперь давайте запустите приложение и увидеть, как изменения будут выглядеть на домашней странице.

![](mvc-music-store-part-3/_static/image8.png)

- Рассмотрим, что изменилось. Метод действия Index в HomeController найден и отображается шаблон \Views\Home\Index.cshtmlView, несмотря на то, что наш код называется «return View()», поскольку наш шаблон представления, а затем стандартного соглашения об именовании.
- Домашняя страница отображает простой приветственное сообщение, которое определено в шаблоне представления \Views\Home\Index.cshtml.
- На домашней странице используется наш \_Layout.cshtml шаблона, и поэтому содержится приветственное сообщение в формате HTML стандартный узла.

## <a name="using-a-model-to-pass-information-to-our-view"></a>Использование модели для передачи данных нашего представления

Шаблон представления, который просто отображает жестко HTML не собираетесь заставить очень интересных веб-сайта. Для создания динамического веб-узла, мы вместо этого потребуется для передачи информации из наших действий контроллера с наших шаблонов представлений.

В шаблоне модель-представление-контроллер термин относится модели для объектов, которые представляют данные в приложении. Часто объекты модели соответствуют таблицам в базе данных, но им не пришлось.

Методы действий контроллера, которые возвращают ActionResult можно передать объект модели представления. Это позволяет контроллеру четко пакета все сведения, необходимые для создания ответа, а затем передать эту информацию в шаблон представления, используемый для создания соответствующих HTML-ответа. Это самый простой для понимания, просмотреть его в действии, Давайте приступим к.

Сначала мы создадим некоторые классы модели, чтобы представлять жанры и альбомов в нашем магазине. Давайте начнем с создания класса жанра. Щелкните правой кнопкой мыши папку «Модели» в проекте, выберите параметр «Добавить класс» и назовите файл «Genre.cs».

![](mvc-music-store-part-3/_static/image2.jpg)

![](mvc-music-store-part-3/_static/image9.png)

Затем добавьте строку открытого свойства Name в класс, который был создан:

[!code-csharp[Main](mvc-music-store-part-3/samples/sample7.cs)]

*Примечание. В случае, если вам интересно, {get; set;} нотации, делает использование C#в автоматически реализуемых свойств. Мы получаем преимуществ свойства без необходимости нам для объявления резервным полем.*

Затем выполните те же действия, чтобы создать класс Album (с именем Album.cs), имеет название и жанр свойство:

[!code-csharp[Main](mvc-music-store-part-3/samples/sample8.cs)]

Теперь мы можем изменить StoreController использовать представления, отображающие динамических сведений из нашей модели. Если параметр - прямо сейчас - для демонстрационных целей мы назвали наш альбомов, на основании идентификатора запроса, мы удалось отобразить эту информацию, как показано в представлении ниже.

![](mvc-music-store-part-3/_static/image10.png)

Мы начнем, изменив на действие Store Details, поэтому он отображает сведения об одном альбома. Добавьте оператор «using» в верхней части **StoreControllers** класса для включения пространства имен MvcMusicStore.Models, поэтому нам не нужно вводить MvcMusicStore.Models.Album мы хотим использовать класс альбома. Раздел «директивы using» этого класса теперь должен выглядеть следующим образом.

[!code-csharp[Main](mvc-music-store-part-3/samples/sample9.cs)]

После этого мы обновим действие контроллера Details, чтобы он возвращал ActionResult, а не строку, как мы сделали с метод HomeController Index.

[!code-csharp[Main](mvc-music-store-part-3/samples/sample10.cs)]

Теперь можно изменить логику, чтобы возвратить объект альбома в представление. Далее в этом руководстве мы будем извлекать данные из базы данных, но прямо сейчас мы будем использовать «пустой данных» Чтобы приступить к работе.

[!code-csharp[Main](mvc-music-store-part-3/samples/sample11.cs)]

*Примечание. Если вы не знакомы с C#, предположение, что использование функции var означает, что нашей переменной альбом с поздним связыванием. Неправильный — компилятор C# использует определение типа на основе что мы назначении переменной для определения этого альбома имеет тип альбома и компиляции альбома локальной переменной как типа альбома, поэтому мы получаем проверки во время компиляции и редактор кода Visual Studio Поддержка.*

Теперь создадим представление шаблона, который использует наши альбома для создания HTML-ответа. Перед этим необходимо построить проект, чтобы добавить представление диалогового окна знал о наших только что созданный класс альбома. Можно построить проект, выбрав Debug⇨Build MvcMusicStore пункта меню (дополнение, можно использовать сочетание клавиш Ctrl + Shift + B для сборки проекта).

![](mvc-music-store-part-3/_static/image11.png)

Теперь, когда мы настроили наш вспомогательные классы, мы готовы создать наш шаблон представления. Щелкните правой кнопкой мыши в методе, сведения и выберите «Добавить представление...» в контекстном меню.

![](mvc-music-store-part-3/_static/image12.png)

Мы собираемся создать новый шаблон представления, как и раньше с HomeController. Поскольку мы создаем из StoreController его по умолчанию создается в файле \Views\Store\Index.cshtml.

В отличие от ранее, мы собираемся установите флажок «Создать строго типизированный» представление. Затем мы собираемся выберите наш класс «Альбом» в «Представление данных класса» drop-downlist. В результате диалогового окна «Добавление представления», чтобы создать шаблон представления, который ожидает, что альбом объекта передается его для использования.

![](mvc-music-store-part-3/_static/image13.png)

При нажатии кнопки «Добавить» наши \Views\Store\Details.cshtml шаблона представления создается, содержит следующий код.

[!code-cshtml[Main](mvc-music-store-part-3/samples/sample12.cshtml)]

Обратите внимание, что первая строка, которая указывает, что данное представление со строгой типизацией к нашему классу альбома. Подсистема просмотра Razor понимает, что он передан объект "альбом", чтобы мы могли легко получить доступ к свойствам модели и даже можете использовать IntelliSense в редакторе Visual Web Developer.

Обновление &lt;h2&gt; тег, чтобы оно отображало свойство Title альбома, изменив эту строку, чтобы выглядеть следующим образом.

[!code-cshtml[Main](mvc-music-store-part-3/samples/sample13.cshtml)]

Обратите внимание на то, что IntelliSense запускается при вводе поставить точку после @Model ключевое слово, показывающий свойства и методы, которые поддерживает класс альбома.

Давайте теперь запустите наш проект и посетите URL-адрес сведений/Store/5. Подробнее см. сведения о альбом как ниже.

![](mvc-music-store-part-3/_static/image14.png)

Теперь сделаем подобное обновление для метода действия Обзор Store. Обновите метод, чтобы он возвращал ActionResult и изменить логику метода, поэтому он создает новый объект жанр и возвращает его в представление.

[!code-csharp[Main](mvc-music-store-part-3/samples/sample14.cs)]

Щелкните правой кнопкой мыши в методе обзора и выберите «Добавить представление...» в контекстном меню, затем добавьте представление, которое является строго типизированным добавьте строго типизированный класс жанра.

![](mvc-music-store-part-3/_static/image15.png)

Обновление &lt;h2&gt; элемент в представлении кода (в /Views/Store/Browse.cshtml) для отображения сведений жанра.

[!code-cshtml[Main](mvc-music-store-part-3/samples/sample15.cshtml)]

Теперь давайте повторно запустите нашего проекта и перейдите к/Store/обзора? Жанр = Disco URL-адрес. Мы увидим под отображается как странице "Обзор".

![](mvc-music-store-part-3/_static/image16.png)

Наконец, создадим немного более сложная операция обновления для **Store индекс** метода действия и представление для отображения списка всех жанров в нашем магазине. Сделаем с помощью список жанров как наш объект модели, а не просто единый жанр фильма.

[!code-csharp[Main](mvc-music-store-part-3/samples/sample16.cs)]

Щелкните правой кнопкой мыши в методе действия индекса Store и выберите Add View, так как перед, выделите как класс модели и нажмите кнопку "Добавить".

![](mvc-music-store-part-3/_static/image17.png)

Сначала мы изменим @model объявление, чтобы указать, что представление будет ожидать несколько жанр объектов вместо одного. Изменение в первой строке /Store/Index.cshtml следующим образом:

[!code-cshtml[Main](mvc-music-store-part-3/samples/sample17.cshtml)]

Это сообщает представлений Razor, он будет работать с помощью модели объекта, который может содержать несколько объектов жанра. Мы используем IEnumerable&lt;жанр&gt; вместо списка&lt;жанр&gt; , так как он является более универсальным, что позволило нам изменить тип нашей модели в более поздней версии на любой тип объекта, который поддерживает интерфейс IEnumerable.

Далее мы будем цикла по жанру объектам в модели, как показано в приведенном ниже коде завершенные.

[!code-cshtml[Main](mvc-music-store-part-3/samples/sample18.cshtml)]

Обратите внимание на то, что у нас есть полностью поддерживается технология IntelliSense вводе этот код таким образом, когда мы введите "@Model.» мы видим, все методы и свойства, поддерживаемые IEnumerable типа жанра.

![](mvc-music-store-part-3/_static/image18.png)

Внутри нашего цикла «foreach» Visual Web Developer знает, что каждый элемент имеет тип жанра, поэтому мы видим IntelliSense для каждого типа жанра.

![](mvc-music-store-part-3/_static/image19.png)

Затем компонент формирования шаблонов проверить объект жанр и установлено, что каждый будет свойство Name, поэтому он перебирает и записывает их. Она также создает ссылки Edit, сведения и Delete для каждого отдельного элемента. Мы будем пользоваться, далее в наш Менеджер магазина, но сейчас мы бы хотели иметь вместо простой список.

Когда мы запустите приложение и перейдите к/Store, мы видим, что отображается число и список жанров.

![](mvc-music-store-part-3/_static/image20.png)

## <a name="adding-links-between-pages"></a>Добавление ссылок между страницами

Наш URL/Store со списком жанров в настоящее время список имен жанр просто в виде обычного текста. Изменим его, чтобы вместо обычного текста вместо этого оставить ссылку имена жанр соответствующий Store или просмотра URL-адрес, таким образом, щелкнув жанр музыки, как производится переход «Disco» / Store/обзора? жанр = Disco URL-адрес. Следует обновить шаблон представления \Views\Store\Index.cshtml выходные данные этих ссылок, с помощью кода как ниже **(не ввести этот текст — мы собираемся над ними)**:

[!code-html[Main](mvc-music-store-part-3/samples/sample19.html)]

Это работает, но это может привести к проблемы в более поздней версии, поскольку он основан на строку. Например если нам нужно переименовать контроллер, мы бы нужно выполнить поиск по наш код, который ищет ссылки, должны быть обновлены.

Альтернативный подход, который мы можем использовать — воспользоваться методом вспомогательный метод HTML. ASP.NET MVC включает методы вспомогательный метод HTML, которые доступны из наш код шаблона представления для выполнения различных задач, так же, как это. Вспомогательный метод Html.ActionLink() является особенно полезен и позволяет легко создавать HTML &lt;&gt; ссылкой и берет на себя раздражает такие сведения, как убедиться, пути URL-адресов осуществляется должным образом в кодировке URL-адрес.

Html.ActionLink() имеет несколько различных перегрузок, позволяющий указывать столько информации, который необходим для ссылки. В самом простом случае нужно будет указать только текст ссылки и метод действия для перехода при щелчке по гиперссылке на стороне клиента. Например мы можно связать с «/ Store /» метод Index() на странице сведений Store с помощью текст ссылки «Перейдите к Store индекс» с помощью следующего вызова:

[!code-cshtml[Main](mvc-music-store-part-3/samples/sample20.cshtml)]

*Примечание. В этом случае нам не нужно указать имя контроллера, так как мы просто ссылка другое действие, в том же контроллере, обрабатывающей текущего представления.*

Наши ссылки на странице "Обзор" потребуется для передачи параметра, однако, поэтому мы будем использовать другую перегрузку метода Html.ActionLink, который принимает три параметра:

- 1. Текст ссылки, который будет отображаться название жанра
- 2. Имя действия контроллера (Обзор)
- 3. Значения параметров маршрута, указав имя (жанр) и значение (название жанра)

Усовершенствование, что все вместе, вот как будет написан этих ссылок в представление Store Index:

[!code-cshtml[Main](mvc-music-store-part-3/samples/sample21.cshtml)]

Теперь, когда мы снова запустить наш проект и указать URL-адрес /Store/ мы увидим список жанров. Каждого жанра является гиперссылкой — при щелчке нам потребуется для наших/Store/обзора? жанр =*[жанр]* URL-адрес.

![](mvc-music-store-part-3/_static/image3.jpg)

HTML-код для списка жанр выглядит следующим образом:

[!code-html[Main](mvc-music-store-part-3/samples/sample22.html)]


> [!div class="step-by-step"]
> [Назад](mvc-music-store-part-2.md)
> [Вперед](mvc-music-store-part-4.md)
