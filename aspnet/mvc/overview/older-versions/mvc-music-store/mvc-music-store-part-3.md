---
uid: mvc/overview/older-versions/mvc-music-store/mvc-music-store-part-3
title: Часть 3. представления и ViewModels | Документация Майкрософт
author: jongalloway
description: В этой серии руководств подробно описаны все шаги, предпринятые для создания примера приложения музыкального хранилища ASP.NET MVC. В части 3 представлены представления и ViewModels.
ms.author: riande
ms.date: 04/21/2011
ms.assetid: 94297aa0-1f2d-4d72-bbcb-63f64653e0c0
msc.legacyurl: /mvc/overview/older-versions/mvc-music-store/mvc-music-store-part-3
msc.type: authoredcontent
ms.openlocfilehash: 3fcfc816cde22c697a78bab2c9ea7ace1bf68501
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78451134"
---
# <a name="part-3-views-and-viewmodels"></a>Часть 3. представления и ViewModels

[Джон Гэллоуэй](https://github.com/jongalloway)

> Музыкальное хранилище MVC — это учебное приложение, в котором представлены и объясняются пошаговые инструкции по использованию ASP.NET MVC и Visual Studio для разработки веб-приложений.  
>   
> Музыкальное хранилище MVC — это упрощенная реализация в магазине, которая продает музыкальные альбомы в сети и реализует базовое администрирование сайта, вход пользователя в систему и функции корзины покупок.  
>   
> В этой серии руководств подробно описаны все шаги, предпринятые для создания примера приложения музыкального хранилища ASP.NET MVC. В части 3 представлены представления и ViewModels.

Пока мы только что возвращали строки из действий контроллера. Это удобный способ понять, как работают контроллеры, но это не то, как вы хотите создать реальное веб-приложение. Нам нужен лучший способ создания HTML-кода обратно в браузерах, посещающих наш сайт. он позволяет использовать файлы шаблонов для упрощения настройки обратной передачи содержимого HTML. Именно это и есть представления.

## <a name="adding-a-view-template"></a>Добавление шаблона представления

Чтобы использовать шаблон представления, мы изменим метод индекса HomeController, чтобы он возвращал ActionResult, и имел возвращаемое представление (), как показано ниже:

[!code-csharp[Main](mvc-music-store-part-3/samples/sample1.cs)]

Приведенное выше изменение указывает, что вместо возврата строки мы хотим использовать "View" для создания результата.

Теперь мы добавим в наш проект соответствующий шаблон представления. Для этого поместите текстовый курсор в метод действия индекса, щелкните его правой кнопкой мыши и выберите "добавить представление". Откроется диалоговое окно Добавление представления:

![](mvc-music-store-part-3/_static/image1.jpg) ![](mvc-music-store-part-3/_static/image1.png)

Диалоговое окно "Добавление представления" позволяет быстро и легко создавать файлы шаблонов представления. По умолчанию диалоговое окно "добавить представление" предварительно заполняет имя создаваемого шаблона представления, чтобы оно соответствовало тому методу действия, который будет его использовать. Так как мы использовали контекстное меню "добавить представление" в методе действия Index () нашего HomeController, в диалоговом окне "добавить представление" выше указано "index", как имя представления, предварительно заполненное по умолчанию. Изменять параметры этого диалогового окна не требуется, поэтому нажмите кнопку Добавить.

При нажатии кнопки Добавить Visual Web Developer создаст новый шаблон представления index. cshtml для нас в каталоге \Виевс\хоме, создавая папку, если она еще не создана.

![](mvc-music-store-part-3/_static/image2.png)

Имя и расположение папки в файле index. cshtml важны и следуют соглашениям об именовании ASP.NET MVC по умолчанию. Имя каталога \Виевс\хоме соответствует контроллеру, который называется HomeController. Имя шаблона представления — index соответствует методу действия контроллера, который будет отображать представление.

ASP.NET MVC позволяет нам избегать явного указания имени или расположения шаблона представления при использовании этого соглашения об именовании для возвращения представления. По умолчанию шаблон представления \Виевс\хоме\индекс.кштмл отображается при написании кода, подобного приведенному ниже, в HomeController:

[!code-csharp[Main](mvc-music-store-part-3/samples/sample2.cs)]

Visual Web Developer создал и открыл шаблон представления index. cshtml после нажатия кнопки "Добавить" в диалоговом окне "Добавление представления". Содержимое index. cshtml показано ниже.

[!code-cshtml[Main](mvc-music-store-part-3/samples/sample3.cshtml)]

Это представление использует синтаксис Razor, что более наглядно, чем обработчик представлений веб-форм, используемый в веб-формах ASP.NET и предыдущих версиях ASP.NET MVC. Обработчик представлений веб-форм по-прежнему доступен в ASP.NET MVC 3, но многие разработчики обнаружили, что подсистема представлений Razor очень хорошо подходит для разработки ASP.NET MVC.

Первые три строки задают заголовок страницы с помощью ViewBag. Title. Мы рассмотрим, как это работает в ближайшее время, но сначала будем обновлять текст заголовка текста и просматривать страницу. Обновите тег &lt;H2&gt;, чтобы сказать: «это Домашняя страница», как показано ниже.

[!code-cshtml[Main](mvc-music-store-part-3/samples/sample4.cshtml)]

При запуске приложения отображается новый текст, отображаемый на домашней странице.

![](mvc-music-store-part-3/_static/image3.png)

## <a name="using-a-layout-for-common-site-elements"></a>Использование макета для общих элементов сайта

Большинство веб-сайтов имеют содержимое, которое совместно используется несколькими страницами: Навигация, нижние колонтитулы, изображения логотипа, ссылки на таблицы стилей и т. д. Подсистема представлений Razor упрощает управление с помощью страницы с именем \_Layout. cshtml, которая автоматически создается для нас в папке/Виевс/Шаред.

![](mvc-music-store-part-3/_static/image4.png)

Дважды щелкните эту папку, чтобы просмотреть ее содержимое, как показано ниже.

[!code-cshtml[Main](mvc-music-store-part-3/samples/sample5.cshtml)]

Содержимое наших индивидуальных представлений будет отображаться командой @RenderBody() и любым общим содержимым, которое мы хотим использовать вне области, которое можно добавить в разметку \_Layout. cshtml. Нам потребуется, чтобы в нашем музыкальном магазине MVC имелся общий заголовок со ссылками на нашу домашнюю страницу и область хранения на всех страницах сайта, поэтому мы добавим его в шаблон непосредственно перед инструкцией @RenderBody().

[!code-cshtml[Main](mvc-music-store-part-3/samples/sample6.cshtml)]

## <a name="updating-the-stylesheet"></a>Обновление таблицы стилей

Шаблон пустого проекта содержит очень упрощенный файл CSS, который содержит только стили, используемые для вывода сообщений проверки. Наш конструктор предоставил некоторые дополнительные CSS и изображения для определения внешнего вида и оформления нашего веб-узла, поэтому мы добавим их сейчас.

Обновленный файл CSS и изображения включены в каталог содержимого Мвкмусиксторе-Ассетс. zip, который доступен в [MVC-Music-Store](https://github.com/evilDave/MVC-Music-Store). Мы выберем оба из них в проводнике Windows и разместите их в папке содержимого нашего решения в Visual Web Developer, как показано ниже:

![](mvc-music-store-part-3/_static/image5.png)

Вам будет предложено подтвердить, нужно ли перезаписать существующий файл Site. CSS. Нажмите кнопку Да.

![](mvc-music-store-part-3/_static/image6.png)

Теперь папка содержимого приложения будет выглядеть следующим образом:

![](mvc-music-store-part-3/_static/image7.png)

Теперь выполним запуск приложения и посмотрим, как наши изменения выглядят на домашней странице.

![](mvc-music-store-part-3/_static/image8.png)

- Давайте посмотрим, что изменилось: метод действия индекса HomeController, найденный и отображающий шаблон \Виевс\хоме\индекс.кштмлвиев, несмотря на то, что наш код называется «Return View ()», так как наш шаблон представления, за которым следует стандартное соглашение об именовании.
- На домашней странице отображается простое приветственное сообщение, которое определено в шаблоне представления \Виевс\хоме\индекс.кштмл.
- Домашняя страница использует наш шаблон \_Layout. cshtml, поэтому приветственное сообщение содержится в макете HTML для стандартного сайта.

## <a name="using-a-model-to-pass-information-to-our-view"></a>Использование модели для передачи информации в наше представление

Шаблон представления, который просто отображает жестко закодированный код HTML, не будет создавать очень интересный веб-сайт. Чтобы создать динамический веб-сайт, мы хотим передать информацию из наших действий контроллера в шаблоны представлений.

В шаблоне модель-представление-контроллер термин модель относится к объектам, которые представляют данные в приложении. Часто объекты модели соответствуют таблицам в базе данных, но им не нужно.

Методы действия контроллера, возвращающие ActionResult, могут передавать объект модели в представление. Это позволяет контроллеру очищать всю информацию, необходимую для создания ответа, а затем передавать эту информацию в шаблон представления для использования при формировании соответствующего HTML-ответа. Это проще понять, просматривая его в действии, поэтому приступим к работе.

Сначала мы создадим некоторые классы модели для представления жанров и альбомов в магазине. Начнем с создания класса жанра. Щелкните правой кнопкой мыши папку Models в проекте, выберите пункт "добавить класс" и назовите файл "Genre.cs".

![](mvc-music-store-part-3/_static/image2.jpg)

![](mvc-music-store-part-3/_static/image9.png)

Затем добавьте свойство имени общедоступной строки в созданный класс:

[!code-csharp[Main](mvc-music-store-part-3/samples/sample7.cs)]

*Примечание. на случай, если вы заинтересовались, в нотации C#{Get; Set;} используется функция автоматического внедрения свойств. Это дает нам преимущества свойства, не требуя объявления резервного поля.*

Затем выполните те же действия, чтобы создать класс альбома (с именем Album.cs) с заголовком и свойством жанра:

[!code-csharp[Main](mvc-music-store-part-3/samples/sample8.cs)]

Теперь мы можем изменить Стореконтроллер, чтобы использовать представления, отображающие динамическую информацию из нашей модели. If-для демонстрационных целей прямо сейчас мы назвали наши альбомы на основе идентификатора запроса. Эти сведения можно отобразить, как показано в приведенном ниже представлении.

![](mvc-music-store-part-3/_static/image10.png)

Мы начнем с изменения действия Store Details, чтобы показать сведения об одном альбоме. Добавьте оператор "using" в начало класса **стореконтроллерс** , чтобы включить пространство имен Мвкмусиксторе. Models, поэтому нам не нужно вводить Мвкмусиксторе. Models. альбом каждый раз, когда нужно использовать класс альбома. Раздел "using" этого класса теперь должен выглядеть так, как показано ниже.

[!code-csharp[Main](mvc-music-store-part-3/samples/sample9.cs)]

Далее мы изменим действие контроллера сведений таким образом, чтобы оно возвращало ActionResult, а не строку, как в случае с методом индекса HomeController.

[!code-csharp[Main](mvc-music-store-part-3/samples/sample10.cs)]

Теперь можно изменить логику, чтобы вернуть объект альбома в представление. Далее в этом учебнике мы будем получать данные из базы данных, но сейчас мы будем использовать фиктивные данные для начала работы.

[!code-csharp[Main](mvc-music-store-part-3/samples/sample11.cs)]

*Примечание. Если вы не знакомы с C#, можно предположить, что использование var означает, что наша переменная альбома имеет позднюю привязку. Это неверно: C# компилятор использует определение типа на основе того, что мы присваиваем переменной, чтобы определить, что альбом имеет тип "альбом" и компилирует переменную локального альбома в качестве типа альбома, поэтому мы получаем проверку во время компиляции и поддержку редактора кода Visual Studio.*

Теперь создадим шаблон представления, который использует наш альбом для создания ответа HTML. Прежде чем делать это, необходимо выполнить сборку проекта, чтобы диалоговое окно добавления представления знало о новом созданном классе альбома. Чтобы построить проект, выберите пункт меню Отладка ⇨ сборка Мвкмусиксторе (для дополнительного кредита можно использовать сочетание клавиш CTRL + SHIFT + B для построения проекта).

![](mvc-music-store-part-3/_static/image11.png)

Теперь, когда мы настроили наши вспомогательные классы, мы готовы к созданию нашего шаблона представления. Щелкните правой кнопкой мыши в методе Details и выберите "добавить представление..." в контекстном меню.

![](mvc-music-store-part-3/_static/image12.png)

Мы создадим новый шаблон представления, как мы делали раньше с HomeController. Так как мы создаем его из Стореконтроллер, он будет создан по умолчанию в \Виевс\сторе\индекс.кштмл-файле.

В отличие от ранее, будет установлен флажок "создать строго типизированное представление". Затем мы будем выбирать наш класс «альбом» в разделе «View Data-Class» Drop-довнлист. Это приведет к созданию в диалоговом окне "Добавление представления" шаблона представления, ожидающего, что объект альбома будет передан ему для использования.

![](mvc-music-store-part-3/_static/image13.png)

При нажатии кнопки "Добавить" будет создан шаблон представления \Виевс\сторе\детаилс.кштмл, содержащий следующий код.

[!code-cshtml[Main](mvc-music-store-part-3/samples/sample12.cshtml)]

Обратите внимание на первую строку, которая указывает, что это представление строго типизировано для нашего класса альбома. Подсистема представления Razor понимает, что ей был передан объект альбома, поэтому мы можем легко получить доступ к свойствам модели и даже воспользоваться преимуществами IntelliSense в редакторе Visual Web Developer.

Обновите тег &lt;H2&gt;, чтобы отобразить свойство заголовка альбома, изменив эту строку следующим образом.

[!code-cshtml[Main](mvc-music-store-part-3/samples/sample13.cshtml)]

Обратите внимание, что IntelliSense активируется при вводе точки после ключевого слова @Model, отображая свойства и методы, поддерживаемые классом альбома.

Теперь повторно запустите наш проект и перейдите по URL-адресу/Store/Details/5. Мы увидим сведения о следующем альбоме, как показано ниже.

![](mvc-music-store-part-3/_static/image14.png)

Теперь мы сделаем аналогичное обновление для метода действия обзора хранилища. Обновите метод, чтобы он возвращал ActionResult, и измените логику метода таким образом, чтобы он создавал новый объект жанра и возвращал его в представление.

[!code-csharp[Main](mvc-music-store-part-3/samples/sample14.cs)]

Щелкните правой кнопкой мыши метод browse и выберите "добавить представление..." в контекстном меню добавьте строго типизированное представление добавление строго типизированного в класс жанра.

![](mvc-music-store-part-3/_static/image15.png)

Обновите элемент &lt;H2&gt; в коде представления (в/Виевс/Сторе/бровсе.кштмл), чтобы отобразить сведения о жанре.

[!code-cshtml[Main](mvc-music-store-part-3/samples/sample15.cshtml)]

Теперь перейдем к нашему проекту и перейду к/Сторе/бровсе? Жанр = URL-адрес Disco. Появится страница Обзор, как показано ниже.

![](mvc-music-store-part-3/_static/image16.png)

Наконец, сделаем немного более сложное обновление метода действия **индекса Store** и просмотр, чтобы отобразить список всех жанров в нашем магазине. Это делается с помощью списка жанров в качестве объекта модели, а не только для одного жанра.

[!code-csharp[Main](mvc-music-store-part-3/samples/sample16.cs)]

Щелкните правой кнопкой мыши метод действия сохранить индекс и выберите Добавить представление как прежде, выберите жанр в качестве класса модели и нажмите кнопку Добавить.

![](mvc-music-store-part-3/_static/image17.png)

Сначала мы изменим объявление @model, чтобы указать, что представление будет ожидать несколько объектов жанра, а не только один. Измените первую строку/Сторе/индекс.кштмл на Read следующим образом:

[!code-cshtml[Main](mvc-music-store-part-3/samples/sample17.cshtml)]

Это указывает ядру представления Razor, что он будет работать с объектом модели, который может содержать несколько объектов-жанров. Мы используем&lt;жанра IEnumerable&gt; а не список&lt;жанр&gt;, так как он более универсальный, что позволяет нам изменить наш тип модели позже на любой тип объектов, поддерживающий интерфейс IEnumerable.

Далее мы выполним перебор объектов жанра в модели, как показано в приведенном ниже коде представления.

[!code-cshtml[Main](mvc-music-store-part-3/samples/sample18.cshtml)]

Обратите внимание, что у нас есть полная поддержка IntelliSense по мере ввода этого кода, поэтому при вводе «@Model». Мы видим все методы и свойства, поддерживаемые IEnumerable типа жанра.

![](mvc-music-store-part-3/_static/image18.png)

В рамках цикла foreach Visual Web Developer знает, что каждый элемент относится к типу жанра, поэтому мы видим IntelliSense для каждого типа жанра.

![](mvc-music-store-part-3/_static/image19.png)

Затем функция формирования шаблонов проверила объект жанра и определила, что каждый из них будет иметь свойство Name, поэтому он просматривает и записывает их. Он также создает ссылки Edit, Details и DELETE для каждого отдельного элемента. Мы будем использовать их позже в нашем Менеджере магазина, но теперь нам хотелось бы иметь простой список.

При запуске приложения и переходе к/Store видно, что отображается количество и список жанров.

![](mvc-music-store-part-3/_static/image20.png)

## <a name="adding-links-between-pages"></a>Добавление ссылок между страницами

Наш URL-адрес/Store, в котором в настоящее время перечислены жанры, просто отображает имена жанров простым текстом. Давайте изменим это так, чтобы вместо обычного текста имена жанров были связаны с соответствующим URL-адресом/Сторе/бровсе, поэтому при щелчке по жанру музыки, например "Disco", будет выполнен переход к URL-адресу/Сторе/бровсе? жанр = Disco. Мы можем обновить наш шаблон представления \Виевс\сторе\индекс.кштмл, чтобы вывести эти ссылки с помощью кода, как показано ниже **(не вводите это в, мы будем улучшать его)** :

[!code-html[Main](mvc-music-store-part-3/samples/sample19.html)]

Это работает, но может привести к возникновению проблем позже, так как оно полагается на жестко закодированную строку. Например, если мы хотим переименовать контроллер, нам придется искать ссылки, которые необходимо обновить, в нашем коде.

Альтернативным подходом, который мы можем использовать, является использование преимуществ вспомогательного метода HTML. ASP.NET MVC включает вспомогательные методы HTML, доступные из нашего кода шаблона представления для выполнения различных распространенных задач, как это происходит. Вспомогательный метод HTML. ActionLink () особенно полезен и упрощает создание HTML-&lt;&gt; ссылок и позаботится о том, что URL-пути правильно кодируются URL-адрес.

В HTML. ActionLink () имеется несколько различных перегрузок, позволяющих указать столько сведений, сколько требуется для ссылок. В самом простом случае вы получите только текст ссылки и метод действия, чтобы переходить по гиперссылке на клиенте. Например, можно создать ссылку на метод Index ()/Сторе/на странице сведений о магазине, щелкнув текст ссылки "переход к индексу магазина", используя следующий вызов:

[!code-cshtml[Main](mvc-music-store-part-3/samples/sample20.cshtml)]

*Примечание. в этом случае нам не нужно указывать имя контроллера, так как мы просто связываемся с другим действием в том же контроллере, который готовит текущее представление.*

Однако наши ссылки на страницу обзора должны передать параметр, поэтому мы будем использовать другую перегрузку метода HTML. ActionLink, принимающую три параметра:

- 1. Текст ссылки, в котором отображается название жанра
- 2. Имя действия контроллера (обзор)
- 3. Значения параметров маршрута, в которых указывается как имя (жанр), так и значение (название жанра).

Поместив все вместе, мы будем писать эти ссылки на представление индекса магазина:

[!code-cshtml[Main](mvc-music-store-part-3/samples/sample21.cshtml)]

Теперь, когда мы снова выполним проект и доступ к URL-адресу/Сторе/, мы увидим список жанров. Каждый жанр является гиперссылкой. когда вы ее щелкнули, мы отпустим свой URL-адрес/Сторе/бровсе? жанр = *[жанр]* .

![](mvc-music-store-part-3/_static/image3.jpg)

HTML-код для списка жанров выглядит следующим образом:

[!code-html[Main](mvc-music-store-part-3/samples/sample22.html)]

> [!div class="step-by-step"]
> [Назад](mvc-music-store-part-2.md)
> [Вперед](mvc-music-store-part-4.md)
