---
uid: mvc/overview/older-versions/hands-on-labs/aspnet-mvc-4-entity-framework-scaffolding-and-migrations
title: ASP.NET MVC 4 Entity Framework формирование шаблонов и миграция | Документация Майкрософт
author: rick-anderson
description: Если вы знакомы с методами контроллера ASP.NET MVC 4 или выполнили &quot;вспомогательные функции, формы и проверки&quot; практической лабораторной работе, следует иметь в виду...
ms.author: riande
ms.date: 02/18/2013
ms.assetid: 093c1362-f10b-407c-a708-be370f4b62b0
msc.legacyurl: /mvc/overview/older-versions/hands-on-labs/aspnet-mvc-4-entity-framework-scaffolding-and-migrations
msc.type: authoredcontent
ms.openlocfilehash: 2b26224390af70e19ca0593abe93a6867140f8ab
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78484644"
---
# <a name="aspnet-mvc-4-entity-framework-scaffolding-and-migrations"></a>Перенос и формирование шаблонов ASP.NET MVC 4 Entity Framework

по [веб-Camp командам](https://twitter.com/webcamps)

[Скачать обучающий комплект Web Camp](https://aka.ms/webcamps-training-kit)

Если вы знакомы с методами контроллера ASP.NET MVC 4 или выполнили &quot;вспомогательные функции, формы и проверки&quot; практической лабораторной работе, необходимо знать, что многие из логики для создания, обновления, перечисления и удаления любой сущности данных, которая повторяется в приложении. Не говоря уже о том, что если модель имеет несколько классов для управления, то, скорее всего, придется потратить значительное время на написание методов POST и GET для каждой операции сущности, а также каждого представления.

В этой лабораторной работе вы узнаете, как использовать формирование шаблонов ASP.NET MVC 4 для автоматического создания базовых показателей CRUD приложения (создание, чтение, обновление и удаление). Начиная с простого класса модели и без написания отдельной строки кода, вы создадите контроллер, который будет содержать все операции CRUD, а также все необходимые представления. После создания и выполнения простого решения будет создана база данных приложения, а также логика и представления MVC для обработки данных.

Кроме того, вы узнаете, как просто использовать Entity Framework миграции для выполнения обновлений модели всего приложения. Entity Framework миграции позволяют изменить базу данных после того, как модель будет изменена простыми действиями. Учитывая все это, вы сможете более эффективно создавать и обслуживать веб-приложения, используя преимущества новейших функций ASP.NET MVC 4.

> [!NOTE]
> Все примеры кода и фрагментов включены в комплект обучающих курсов Web Camp, доступный в [выпусках Microsoft Web/вебкамптраинингкит](https://aka.ms/webcamps-training-kit). Проект, относящийся к этой лабораторной работе, доступен по адресу [ASP.NET MVC 4 Entity Framework формирования шаблонов и миграций](https://github.com/Microsoft-Web/HOL-EntityFrameworkScaffoldingAndMigrations).

<a id="Objectives"></a>
### <a name="objectives"></a>Цели

В этой практической лабораторной работе вы узнаете, как выполнять следующие задачи:

- Для операций CRUD на контроллерах используйте формирование шаблонов ASP.NET.
- Измените модель базы данных с помощью Entity Framework миграции.

<a id="Prerequisites"></a>

<a id="Prerequisites"></a>
### <a name="prerequisites"></a>предварительные требования

Для выполнения этой лабораторной работы необходимо иметь следующие элементы:

- [Microsoft Visual Studio Express 2012 для Web](https://www.microsoft.com/visualstudio/eng/products/visual-studio-express-for-web) или старше (см. [приложение а](#AppendixA) для получения инструкций по его установке).

<a id="Setup"></a>

<a id="Setup"></a>
### <a name="setup"></a>Настройка

**Установка фрагментов кода**

Для удобства большая часть кода, который вы будете управлять в этой лаборатории, доступна в виде фрагментов кода Visual Studio. Чтобы установить фрагменты кода, запустите файл **.\саурце\сетуп\кодесниппетс.ВСИ** .

Если вы не знакомы с фрагментами кода Visual Studio Code и хотите узнать, как их использовать, можно обратиться к приложению из этого документа &quot;[приложении б. Использование фрагментов кода](#AppendixB)&quot;.

---

<a id="Exercises"></a>

<a id="Exercises"></a>
## <a name="exercises"></a>Полнят

Это практическое лабораторное занятие состоит из следующих упражнений:

1. [Использование формирования шаблонов ASP.NET MVC 4 с миграцией Entity Framework](#Exercise1)

> [!NOTE]
> Это упражнение сопровождается **конечной** папкой, содержащей итоговое решение, которое необходимо получить после завершения этого упражнения. Это решение можно использовать в качестве руководства, если требуется дополнительная помощь по работе с этим упражнением.

Предполагаемое время выполнения этой лабораторной работы: **30 минут**

<a id="Exercise1"></a>

<a id="Exercise_1_Using_ASPNET_MVC_4_Scaffolding_with_Entity_Framework_Migrations"></a>
### <a name="exercise-1-using-aspnet-mvc-4-scaffolding-with-entity-framework-migrations"></a>Упражнение 1. Использование шаблонов ASP.NET MVC 4 с миграцией Entity Framework

Формирование шаблонов MVC ASP.NET позволяет быстро создавать операции CRUD в стандартизированном виде, создавая необходимую логику, которая позволяет приложению взаимодействовать с уровнем базы данных.

В этом упражнении вы узнаете, как использовать формирование шаблонов ASP.NET MVC 4 с кодом First для создания методов CRUD. Затем вы узнаете, как обновить модель, применяя изменения в базе данных, с помощью Entity Framework миграции.

<a id="Ex1Task1"></a>

<a id="Task_1-_Creating_a_new_ASPNET_MVC_4_project_using_Scaffolding"></a>
#### <a name="task-1--creating-a-new-aspnet-mvc-4-project-using-scaffolding"></a>Задача 1. Создание нового проекта ASP.NET MVC 4 с помощью формирования шаблонов

1. Если он еще не открыт, запустите **Visual Studio 2012**.
2. Выберите **файл | Новый проект**. В диалоговом окне Новый проект в **визуальном C# элементе |** В разделе "веб-приложение" выберите **ASP.NET MVC 4 Web Application**. Присвойте проекту имя **MVC4andEFMigrations** и задайте в качестве расположения папку **Source\Ex1-UsingMVC4ScaffoldingEFMigrations** этой лабораторной работы. Задайте для параметра **имя решения** значение **Начало** и убедитесь, что установлен флажок **создать каталог для решения** . Нажмите кнопку **ОК**.

    ![Диалоговое окно "Создание проекта ASP.NET MVC 4"](aspnet-mvc-4-entity-framework-scaffolding-and-migrations/_static/image1.png "Диалоговое окно "Создание проекта ASP.NET MVC 4"")

    *Диалоговое окно "Создание проекта ASP.NET MVC 4"*
3. В диалоговом окне **Новый проект ASP.NET MVC 4** выберите шаблон **Интернет-приложение** и убедитесь, что **Razor** является выбранным **обработчиком представлений**. Чтобы создать проект, нажмите кнопку **ОК** .

    ![Новое Интернет – приложение ASP.NET MVC 4](aspnet-mvc-4-entity-framework-scaffolding-and-migrations/_static/image2.png "Новое Интернет – приложение ASP.NET MVC 4")

    *Новое Интернет – приложение ASP.NET MVC 4*
4. В обозреватель решений щелкните правой кнопкой мыши элемент **модели** и выберите команду **Добавить | Класс** для создания простого класса Person (POCO). Присвойте ему имя **Person** и нажмите кнопку **ОК**.
5. Откройте класс Person и вставьте следующие свойства.

    (Фрагмент кода — *ASP.NET MVC 4 и Entity Framework, EX1 свойства Person*)

    [!code-csharp[Main](aspnet-mvc-4-entity-framework-scaffolding-and-migrations/samples/sample1.cs)]
6. Щелкните " **Сборка" | Создайте решение** для сохранения изменений и сборки проекта.

    ![Сборка приложения](aspnet-mvc-4-entity-framework-scaffolding-and-migrations/_static/image3.png "Построение приложения")

    *Сборка приложения*
7. В обозреватель решений щелкните правой кнопкой мыши папку Controllers и выберите **Добавить | Контроллер**.
8. Присвойте контроллеру имя *персонконтроллер* и выполните **Параметры формирования шаблонов** со следующими значениями.

   1. В раскрывающемся списке **шаблон** выберите **контроллер MVC с действиями чтения и записи и представлениями с помощью параметра Entity Framework** .
   2. В раскрывающемся списке **класс модели** выберите класс **Person** .
   3. В списке **класс контекста данных** выберите **&lt;новый контекст данных...&gt;** . Выберите любое имя и нажмите кнопку **ОК**.
   4. Убедитесь, что в раскрывающемся списке **представления** выбран параметр **Razor** .

      ![Добавление контроллера Person с формированием шаблонов](aspnet-mvc-4-entity-framework-scaffolding-and-migrations/_static/image4.png "Добавление контроллера Person с формированием шаблонов")

      *Добавление контроллера Person с формированием шаблонов*
9. Нажмите кнопку **Добавить** , чтобы создать новый контроллер для пользователя с формированием шаблонов. Вы создали действия контроллера, а также представления.

    ![После создания контроллера Person с формированием шаблонов](aspnet-mvc-4-entity-framework-scaffolding-and-migrations/_static/image5.png "После создания контроллера Person с формированием шаблонов")

    *После создания контроллера Person с формированием шаблонов*
10. Откройте класс **персонконтроллер** . Обратите внимание, что все методы действия CRUD были созданы автоматически.

   ![Внутри контроллера Person](aspnet-mvc-4-entity-framework-scaffolding-and-migrations/_static/image6.png "Внутри контроллера Person")

   *Внутри контроллера Person*

<a id="Ex1Task2"></a>

<a id="Task_2-_Running_the_application"></a>
#### <a name="task-2--running-the-application"></a>Задача 2. Запуск приложения

На этом этапе база данных еще не создана. В этой задаче вы запустите приложение в первый раз и проверите операции CRUD. База данных будет создана на лету с Code First.

1. Нажмите клавишу **F5** для запуска приложения.
2. В браузере добавьте **/персон** в URL-адрес, чтобы открыть страницу Person.

    ![Первый запуск приложения](aspnet-mvc-4-entity-framework-scaffolding-and-migrations/_static/image7.png "Первый запуск приложения")

    *Приложение: первый запуск*
3. Теперь вы просматриваете страницы Person и протестируете операции CRUD.

    1. Щелкните **создать** , чтобы добавить нового пользователя. Введите имя и фамилию и нажмите кнопку **создать**.

        ![Добавление нового пользователя](aspnet-mvc-4-entity-framework-scaffolding-and-migrations/_static/image8.png "Добавление нового пользователя")

        *Добавление нового пользователя*
    2. В списке людей можно удалять, изменять и добавлять элементы.

        ![список лиц](aspnet-mvc-4-entity-framework-scaffolding-and-migrations/_static/image9.png "список лиц")

        *Список лиц*
    3. Щелкните **сведения** , чтобы открыть сведения о лице.

        ![Сведения о лице](aspnet-mvc-4-entity-framework-scaffolding-and-migrations/_static/image10.png "Сведения о лице")

        *Сведения о лице*
4. Закройте браузер и вернитесь в Visual Studio. Обратите внимание, что вы создали всю CRUD для сущности Person в приложении — от модели до представлений — без необходимости писать одну строку кода!

<a id="Ex1Task3"></a>

<a id="Task_3-_Updating_the_database_using_Entity_Framework_Migrations"></a>
#### <a name="task-3--updating-the-database-using-entity-framework-migrations"></a>Задача 3. обновление базы данных с помощью Entity Framework миграции

В этой задаче будет обновлена база данных с помощью Entity Framework миграций. Вы узнаете, как просто изменить модель и отразить изменения в базах данных с помощью функции миграции Entity Framework.

1. Откройте консоль диспетчера пакетов. Выберите **Инструменты** > **Диспетчер пакетов NuGet** > **Консоль диспетчера пакетов**.
2. В консоли диспетчера пакетов введите следующую команду.

    PMC

    [!code-powershell[Main](aspnet-mvc-4-entity-framework-scaffolding-and-migrations/samples/sample2.ps1)]

    ![Включение миграции](aspnet-mvc-4-entity-framework-scaffolding-and-migrations/_static/image11.png "Включение миграций")

    *Включение миграции*

    Команда Enable-Migration создает папку **migrations** , которая содержит скрипт для инициализации базы данных.

    ![Папка "миграции"](aspnet-mvc-4-entity-framework-scaffolding-and-migrations/_static/image12.png "Папка "миграции"")

    *Папка "миграции"*
3. Откройте файл **Configuration.CS** в папке migrations. Перейдите к конструктору класса и измените значение **аутоматикмигратионсенаблед** на *true*.

    [!code-csharp[Main](aspnet-mvc-4-entity-framework-scaffolding-and-migrations/samples/sample3.cs)]
4. Откройте класс Person и добавьте атрибут для отчества человека. С помощью этого нового атрибута вы изменяете модель.

    [!code-csharp[Main](aspnet-mvc-4-entity-framework-scaffolding-and-migrations/samples/sample4.cs)]
5. Выбор **сборки | Создайте решение** в меню, чтобы создать приложение.

    ![Сборка приложения](aspnet-mvc-4-entity-framework-scaffolding-and-migrations/_static/image13.png "Построение приложения")

    *Сборка приложения*
6. В консоли диспетчера пакетов введите следующую команду.

    PMC

    [!code-powershell[Main](aspnet-mvc-4-entity-framework-scaffolding-and-migrations/samples/sample5.ps1)]

    Эта команда выполнит поиск изменений в объектах данных, а затем добавит необходимые команды, чтобы соответствующим образом изменить базу данных.

    ![Добавление отчества](aspnet-mvc-4-entity-framework-scaffolding-and-migrations/_static/image14.png "Добавление отчества")

    *Добавление отчества*
7. Используемых Можно выполнить следующую команду, чтобы создать скрипт SQL с разностным обновлением. Это позволит обновить базу данных вручную (в данном случае это необязательно) или применить изменения в других базах данных:

    PMC

    [!code-powershell[Main](aspnet-mvc-4-entity-framework-scaffolding-and-migrations/samples/sample6.ps1)]

    ![Создание скрипта SQL](aspnet-mvc-4-entity-framework-scaffolding-and-migrations/_static/image15.png "Формирование скрипта SQL")

    *Создание скрипта SQL*

    ![Обновление скрипта SQL](aspnet-mvc-4-entity-framework-scaffolding-and-migrations/_static/image16.png "Обновление скрипта SQL")

    *Обновление скрипта SQL*
8. В консоли диспетчера пакетов введите следующую команду, чтобы обновить базу данных:

    PMC

    [!code-powershell[Main](aspnet-mvc-4-entity-framework-scaffolding-and-migrations/samples/sample7.ps1)]

    ![Обновление базы данных](aspnet-mvc-4-entity-framework-scaffolding-and-migrations/_static/image17.png "Обновление базы данных")

    *Обновление базы данных*

    Это приведет к добавлению столбца **MiddleName** в таблицу **People** в соответствии с текущим определением класса **Person** .
9. После обновления базы данных щелкните правой кнопкой мыши папку контроллера и выберите **Добавить | Контроллер** для повторного добавления контроллера Person (с теми же значениями). При этом будут обновлены существующие методы и представления, добавляющие новый атрибут.

    ![Добавление обновления контроллера](aspnet-mvc-4-entity-framework-scaffolding-and-migrations/_static/image18.png "Добавление обновления контроллера")

    *Обновление контроллера*
10. Нажмите кнопку **Добавить**. Затем выберите значения **Перезаписать PersonController.CS** и **Перезапись связанных представлений** и нажмите кнопку **ОК**.

   ![Добавление перезаписи контроллера](aspnet-mvc-4-entity-framework-scaffolding-and-migrations/_static/image19.png)

   *Обновление контроллера*

<a id="Ex1Task4"></a>

<a id="Task4-_Running_the_application"></a>
#### <a name="task4--running-the-application"></a>Task4 — запуск приложения

1. Нажмите клавишу **F5** для запуска приложения.
2. Откройте **/персон**. Обратите внимание, что данные были сохранены, а столбец отчества был добавлен.

    ![Отчество Добавлено](aspnet-mvc-4-entity-framework-scaffolding-and-migrations/_static/image20.png "Отчество Добавлено")

    *Отчество Добавлено*
3. Если нажать кнопку **изменить**, вы сможете добавить отчество к текущему человеку.

    ![Выпуск отчества](aspnet-mvc-4-entity-framework-scaffolding-and-migrations/_static/image21.png "Выпуск отчества")

---

<a id="Summary"></a>

<a id="Summary"></a>
## <a name="summary"></a>Сводка

В этой практической лабораторной работе вы узнали простые действия по созданию операций CRUD с помощью формирования шаблонов ASP.NET MVC 4 с использованием любого класса модели. Затем вы узнали, как выполнить комплексное обновление в приложении — из базы данных в представления, используя Entity Framework миграции.

<a id="AppendixA"></a>

<a id="Appendix_A_Installing_Visual_Studio_Express_2012_for_Web"></a>
## <a name="appendix-a-installing-visual-studio-express-2012-for-web"></a>Приложение а. Установка Visual Studio Express 2012 для Web

Вы можете установить **Microsoft Visual Studio Express 2012 для Web** или другой &quot;Express&quot; версии с помощью **[установщик веб-платформы Майкрософт](https://www.microsoft.com/web/downloads/platform.aspx)** . Следующие инструкции помогут вам выполнить действия, необходимые для установки *Visual Studio Express 2012 для Web* с помощью *установщик веб-платформы Майкрософт*.

1. Перейдите на сайт [https://go.microsoft.com/?linkid=9810169](https://go.microsoft.com/?linkid=9810169). Кроме того, если у вас уже установлен установщик веб-платформы, вы можете открыть его и найти продукт &quot;<em>Visual Studio Express 2012 для Web с Windows Azure SDK</em>&quot;.
2. Щелкните **Install Now (установить сейчас**). Если у вас нет **установщика веб-платформы** , вы будете сначала перенаправлены на загрузку и установку.
3. После открытия **установщика веб-платформы** нажмите кнопку **установить** , чтобы начать установку.

    ![Установка Visual Studio Express](aspnet-mvc-4-entity-framework-scaffolding-and-migrations/_static/image22.png "Установка Visual Studio Express")

    *Установка Visual Studio Express*
4. Прочитайте все лицензии и условия продуктов и нажмите кнопку " **принять** ", чтобы продолжить.

    ![Принятие условий лицензии](aspnet-mvc-4-entity-framework-scaffolding-and-migrations/_static/image23.png)

    *Принятие условий лицензии*
5. Дождитесь завершения процесса загрузки и установки.

    ![Ход установки](aspnet-mvc-4-entity-framework-scaffolding-and-migrations/_static/image24.png)

    *Ход установки*
6. После завершения установки нажмите кнопку **Готово**.

    ![Установка завершена](aspnet-mvc-4-entity-framework-scaffolding-and-migrations/_static/image25.png)

    *Установка завершена*
7. Нажмите кнопку **выход** , чтобы закрыть установщик веб-платформы.
8. Чтобы открыть Visual Studio Express для Интернета, перейдите на **начальный** экран и начните запись &quot;**VS Express**&quot;, а затем щелкните плитку **VS Express для Web** .

    ![Плитка VS Express для Web](aspnet-mvc-4-entity-framework-scaffolding-and-migrations/_static/image26.png)

    *Плитка VS Express для Web*

<a id="AppendixB"></a>

<a id="Appendix_B_Using_Code_Snippets"></a>
## <a name="appendix-b-using-code-snippets"></a>Приложение б. Использование фрагментов кода

С помощью фрагментов кода вы можете получить все необходимые вам коды. В лабораторном документе вы узнаете, когда можно использовать их, как показано на следующем рисунке.

![Использование фрагментов кода Visual Studio для вставки кода в проект](aspnet-mvc-4-entity-framework-scaffolding-and-migrations/_static/image27.png "Использование фрагментов кода Visual Studio для вставки кода в проект")

*Использование фрагментов кода Visual Studio для вставки кода в проект*

***Добавление фрагмента кода с помощью клавиатуры (C# только)***

1. Поместите курсор в то место, куда вы хотите вставить код.
2. Начните вводить имя фрагмента (без пробелов или дефисов).
3. Посмотрите, как IntelliSense отображает соответствующие имена фрагментов кода.
4. Выберите правильный фрагмент кода (или вводите его, пока не будет выбрано имя всего фрагмента).
5. Дважды нажмите клавишу TAB, чтобы вставить фрагмент в позицию курсора.

![Начните вводить имя фрагмента](aspnet-mvc-4-entity-framework-scaffolding-and-migrations/_static/image28.png "Начните вводить имя фрагмента")

*Начните вводить имя фрагмента*

![Нажмите клавишу TAB, чтобы выбрать выделенный фрагмент.](aspnet-mvc-4-entity-framework-scaffolding-and-migrations/_static/image29.png "Нажмите клавишу TAB, чтобы выбрать выделенный фрагмент.")

*Нажмите клавишу TAB, чтобы выбрать выделенный фрагмент.*

![Снова нажмите клавишу TAB, и фрагмент развернется](aspnet-mvc-4-entity-framework-scaffolding-and-migrations/_static/image30.png "Снова нажмите клавишу TAB, и фрагмент развернется")

*Снова нажмите клавишу TAB, и фрагмент развернется*

***Добавление фрагмента кода с помощью мыши (C#, Visual Basic и XML)*** одного. Щелкните правой кнопкой мыши место, куда нужно вставить фрагмент кода.

1. Выберите **Вставить фрагмент** , за которым следуют **фрагменты кода**.
2. Выберите соответствующий фрагмент из списка, щелкнув его.

![Щелкните правой кнопкой мыши место, куда нужно вставить фрагмент кода, и выберите пункт Вставить фрагмент.](aspnet-mvc-4-entity-framework-scaffolding-and-migrations/_static/image31.png "Щелкните правой кнопкой мыши место, куда нужно вставить фрагмент кода, и выберите пункт Вставить фрагмент.")

*Щелкните правой кнопкой мыши место, куда нужно вставить фрагмент кода, и выберите пункт Вставить фрагмент.*

![Выберите соответствующий фрагмент из списка, щелкнув его.](aspnet-mvc-4-entity-framework-scaffolding-and-migrations/_static/image32.png "Выберите соответствующий фрагмент из списка, щелкнув его.")

*Выберите соответствующий фрагмент из списка, щелкнув его.*
