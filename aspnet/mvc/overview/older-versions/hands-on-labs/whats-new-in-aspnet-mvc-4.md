---
uid: mvc/overview/older-versions/hands-on-labs/whats-new-in-aspnet-mvc-4
title: Новые возможности в ASP.NET MVC 4 | Документация Майкрософт
author: rick-anderson
description: ASP.NET MVC 4 — это платформа для создания масштабируемых, основанные на стандартах веб-приложений, с помощью хорошо проверенных шаблонах проектирования и возможности ASP.NET и...
ms.author: riande
ms.date: 02/18/2013
ms.assetid: 48f7feb3-872f-485d-b96f-e30011ff8c4a
msc.legacyurl: /mvc/overview/older-versions/hands-on-labs/whats-new-in-aspnet-mvc-4
msc.type: authoredcontent
ms.openlocfilehash: adb6e990d0ca98df38c47adf8c37fdffeb6d3d73
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2019
ms.locfileid: "65112999"
---
# <a name="whats-new-in-aspnet-mvc-4"></a>Новые возможности ASP.NET MVC 4

по [Web Слышатся Team](https://twitter.com/webcamps)

[Скачайте комплект учебных материалов по лагеря Web](https://aka.ms/webcamps-training-kit)

ASP.NET MVC 4 — это платформа для создания масштабируемых, основанные на стандартах веб-приложений, с помощью хорошо проверенных шаблонах проектирования и возможности ASP.NET и .NET framework. Этот новый, четвертая версия платформы посвящена упрощение разработки мобильных веб-приложений.

Начнем с того при создании нового проекта ASP.NET MVC 4 теперь есть шаблон проекта мобильного приложения, которые можно использовать для построения это автономное приложение, в частности для мобильных устройств. Кроме того ASP.NET MVC 4 интегрируется с jQuery Mobile посредством пакета NuGet jQuery.Mobile.MVC. jQuery Mobile — это платформа на базе HTML5, для разработки веб-приложений, совместимых с всех платформ популярных мобильных устройствах, включая Windows Phone, iPhone, Android и т. д. Тем не менее если вам нужна специализации, ASP.NET MVC 4 также позволяет обслуживать различные представления для разных устройств и предоставить проводить оптимизацию для конкретного устройства.

В этой практической работу вы начнете с ASP.NET MVC 4 &quot;веб-приложение&quot; шаблон проекта для создания приложения Photo Gallery. Постепенно, поможет повысить эффективность приложения с помощью jQuery Mobile и новые функции ASP.NET MVC 4, чтобы обеспечить его совместимость с различных мобильных устройств и классических веб-браузеров. Вы также узнаете о новых рецепты для создания кода для создания кода и как ASP.NET MVC 4 упрощает написание асинхронных методов действия, поддерживая задач&lt;ActionResult&gt; типы возвращаемых значений.

> [!NOTE]
> Все примеры кода и фрагменты кода включены в Web лагеря комплект обучающих материалов, доступных в [выпуски Microsoft Web/WebCampTrainingKit](https://aka.ms/webcamps-training-kit). Проект, относящиеся к этой лаборатории доступен в [новые возможности в веб-форм в ASP.NET 4.5](https://github.com/Microsoft-Web/HOL-ASPNETWebForms).

<a id="Objectives"></a>
### <a name="objectives"></a>Цели

В этой практической работу вы узнаете, как:

- Воспользоваться преимуществами расширений для ASP.NET MVC проект шаблоны, в том числе нового шаблона проекта мобильного приложения
- Использовать окна просмотра атрибут HTML5 и CSS медиа-запросов для улучшения отображения на мобильных устройствах
- Использовать jQuery Mobile для прогрессивного улучшения, а также для создания оптимизированных для сенсорных экранов веб-Интерфейс
- Создание представлений для мобильных устройств
- Использовать компонент переключателя для переключения между представлениями мобильные и Классические приложения
- Создание асинхронных контроллеров, используя поддержку задач

<a id="Prerequisites"></a>

<a id="Prerequisites"></a>
### <a name="prerequisites"></a>Предварительные требования

Необходимо иметь следующие элементы во укомплектовать данную лабораторию:

- [Microsoft Visual Studio Express 2012 для Web](https://www.microsoft.com/visualstudio/eng/products/visual-studio-express-for-web) или руководителя (чтение [приложении Б](#AppendixB) инструкции по его установке).
- [ASP.NET MVC 4](../../../mvc4.md) (входит в установку Microsoft Visual Studio 2012)
- Эмулятор Windows Phone (включен в [Windows Phone 7.1.1 SDK](https://www.microsoft.com/download/details.aspx?id=29233))
- Необязательно — [WebMatrix 2](https://www.microsoft.com/web/webmatrix/) с **Electric Plum iPhone симулятор** расширения (только для Упражнение 3 используется для просмотра веб-приложения с помощью эмулятор iPhone)

<a id="Setup"></a>

<a id="Setup"></a>
### <a name="setup"></a>Установка

В этом документе лаборатории вам будет рекомендовано вставлять блоки кода. Для удобства большая часть этого кода предоставляется как фрагменты кода Visual Studio, который можно использовать из среды Visual Studio, чтобы избежать необходимости добавлять ее вручную.

Чтобы установить фрагменты кода.

1. Откройте окно проводника Windows и перейдите к лаборатории **Source\Setup** папки.
2. Дважды щелкните **Setup.cmd** файл в эту папку, чтобы установить фрагменты кода Visual Studio.

Если вы не знакомы с фрагменты кода Visual Studio и хотите научиться использовать их, можно ссылаться в приложение из этого документа &quot; [приложении a. Фрагменты кода](#AppendixA)&quot;.

<a id="Exercises"></a>

<a id="Exercises"></a>
## <a name="exercises"></a>Упражнения

Это Практическое занятие включает в себя следующие упражнения:

1. [Новые шаблоны проектов ASP.NET MVC 4](#Exercise1)
2. [Создание веб-приложение фотоальбома](#Exercise2)
3. [Добавление поддержки для мобильных устройств](#Exercise3)
4. [Использование асинхронных контроллеров](#Exercise4)

> [!NOTE]
> Каждого упражнения сопровождается **окончания** папку, содержащую полученное решение, должен быть получен после завершения упражнения. Это решение можно использовать как руководство, если вам нужна дополнительная помощь при работе с примерами.

Предполагаемое время для выполнения этого лабораторного: **60 минут**.

<a id="Exercise1"></a>

<a id="Exercise_1_New_ASPNET_MVC_4_Project_Templates"></a>
### <a name="exercise-1-new-aspnet-mvc-4-project-templates"></a>Упражнение 1. Новые шаблоны проектов ASP.NET MVC 4

В этом упражнении будет Узнайте об усовершенствованиях в шаблонах проекта ASP.NET MVC 4. Дополнение к шаблону веб-приложение, уже присутствующего в MVC 3, эта версия теперь включает отдельный шаблон для мобильных приложений. Во-первых будут рассмотрены некоторые соответствующие функции каждого из шаблонов. Затем будет работать над визуализацией страницы правильно на разных платформах с помощью правильного подхода.

<a id="Task_1_-_Exploring_the_Internet_Application_Template"></a>
#### <a name="task-1---exploring-the-internet-application-template"></a>Задача 1 - изучение данный шаблон приложения Интернета

1. Откройте **Visual Studio**.
2. Выберите **файл | Новые | Проект** команды меню. В **новый проект** диалоговом окне выберите **Visual C# | Web** шаблона на левой панели дерева, а затем выберите **веб-приложение ASP.NET MVC 4.** Назовите проект **PhotoGallery**, выберите расположение (или оставьте значение по умолчанию) и нажмите кнопку **ОК**.

    > [!NOTE]
    > После этого следует настроить решение Коллекция фотографий ASP.NET MVC 4, которое теперь создается.

    ![Создание нового проекта](whats-new-in-aspnet-mvc-4/_static/image1.png "создания нового проекта")

    *Создание нового проекта*
3. В **создания проекта ASP.NET MVC 4** диалоговом окне выберите **веб-приложение** шаблон проекта и нажмите кнопку **ОК**. Убедитесь, что выбран в качестве обработчика представлений Razor.

    ![Создание нового приложения ASP.NET MVC 4 Internet](whats-new-in-aspnet-mvc-4/_static/image2.png "Создание нового приложения ASP.NET MVC 4 Internet")

    *Создание нового приложения ASP.NET MVC 4 Internet*

    > [!NOTE]
    > Синтаксис Razor представлена в ASP.NET MVC 3. Наша цель — чтобы свести к минимуму число знаков и нажатий клавиш в файл, позволяя быстро и жидкостей, рабочие процессы кодирования. Razor использует существующие C# / VB (или других) языковые навыки и обеспечивает синтаксис разметки шаблона, который позволяет awesome рабочего процесса создания HTML.
4. Нажмите клавишу **F5** для запуска решения, а также видеть обновленные шаблоны. Вы можете проверить следующие возможности:

    **Шаблоны в современном стиле**

    Шаблоны были обновлены, предоставляя дополнительные стили современных.

    ![Шаблоны ASP.NET MVC 4 restyled](whats-new-in-aspnet-mvc-4/_static/image3.png "restyled шаблонов MVC 4")

    *Шаблоны ASP.NET MVC 4 restyled*

    ![Новая страница контакта](whats-new-in-aspnet-mvc-4/_static/image4.png "страницы нового контакта")

    *Новая страница контакта*

    **Адаптивная отрисовка**

    Извлеките изменения размера окна браузера и обратите внимание на то, как макет страницы приспосабливается к изменениям для нового размера окна. Эти шаблоны использовать методика адаптивной отрисовки для неправильно отображается на настольных и мобильных платформах без какой-либо настройки.

    ![Шаблон проекта ASP.NET MVC 4 в другом браузере размеры](whats-new-in-aspnet-mvc-4/_static/image5.png "шаблон проекта ASP.NET MVC 4 в другом браузере размеры")

    *Шаблон проекта ASP.NET MVC 4 в другом браузере размеры*

    **Более широкие пользовательского интерфейса с помощью JavaScript**

    Другое усовершенствование шаблоны проекта по умолчанию является использование JavaScript для предоставления более интерактивной JavaScript. Вход и регистрация ссылки, используемые в шаблоне проиллюстрировать, как с помощью проверки jQuery проверять поля ввода со стороны клиента.

    ![jQuery Validation](whats-new-in-aspnet-mvc-4/_static/image6.png)

    *jQuery Validation*

    > [!NOTE]
    > Обратите внимание, что два журнала в разделах, в первом разделе, можно в систему с помощью зарегистрированную учетную запись с сайта и во втором разделе, вы можете также войти с помощью другую службу проверки подлинности, например google (отключено по умолчанию).
5. Закройте браузер, чтобы остановить отладчик и вернитесь в Visual Studio.
6. Откройте файл **AuthConfig.cs** каталоге **приложения\_запустить** папки.
7. Удалите комментарий в последней строке регистрацию клиента Google для *OAuth* проверки подлинности.

    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample1.cs)]

    > [!NOTE]
    > Обратите внимание, что вы можете легко включить проверку подлинности с помощью любой службы OpenID или OAuth, таких как Facebook, Twitter, Microsoft, и т.д.
8. Нажмите клавишу **F5** для запуска решения, а затем перейдите на страницу входа.
9. Выберите **Google** службу для входа.

    ![Выбор журнала в службе](whats-new-in-aspnet-mvc-4/_static/image7.png)

    *Выбор журнала в службе*
10. Вход с помощью учетной записи Google.
11. Разрешить переход на сайт (localhost) для получения сведений из учетной записи Google.
12. Наконец вам будет необходимо зарегистрировать на сайте, чтобы связать учетную запись Google.

   ![Связать учетную запись Google](whats-new-in-aspnet-mvc-4/_static/image8.png)

   *Связывание учетной записи Google*
13. Закройте браузер, чтобы остановить отладчик и вернитесь в Visual Studio.
14. Теперь ознакомьтесь с решением для извлечения некоторые новые возможности, появившиеся в ASP.NET MVC 4 в шаблоне проекта.

   ![Шаблон проекта приложения ASP.NET MVC 4 Internet](whats-new-in-aspnet-mvc-4/_static/image9.png "шаблон проекта приложения ASP.NET MVC 4 Internet")

   *Шаблон проекта приложения ASP.NET MVC 4 Internet*

    - **HTML 5 разметки**

       Обзор представлений шаблона, чтобы узнать, Новая разметка темы.

       ![Новый шаблон с помощью Razor и HTML5 About.cshtml разметки. ](whats-new-in-aspnet-mvc-4/_static/image10.png "Новый шаблон, с помощью Razor и HTML5 About.cshtml разметки.")

       *Новый шаблон, с помощью разметки Razor и HTML5 (About.cshtml).*
    - **Обновленные библиотеки JavaScript**

       Шаблон по умолчанию ASP.NET MVC 4 теперь включает KnockoutJS, платформу JavaScript MVVM, которая позволяет создавать разнообразные и малым временем отклика веб-приложений, с помощью JavaScript и HTML. Как и в MVC3, jQuery и библиотеки пользовательского интерфейса jQuery также включаются в ASP.NET MVC 4.

     > [!NOTE]
     > Можно получить дополнительные сведения о библиотеке KnockOutJS в этой связи: [ [ http://learn.knockoutjs.com/ ](http://learn.knockoutjs.com/) ](http://learn.knockoutjs.com/). Кроме того, можно узнать о jQuery и пользовательский Интерфейс jQuery в [ [ http://docs.jquery.com/ ](http://docs.jquery.com/) ](http://docs.jquery.com/).

<a id="Task_2_-_Exploring_the_Mobile_Application_Template"></a>
#### <a name="task-2---exploring-the-mobile-application-template"></a>Задача 2 - изучение шаблона мобильного приложения

ASP.NET MVC 4 облегчает разработку веб-сайтов для мобильных устройств и браузеров планшета. Этот шаблон имеет такую же структуру приложения, как шаблон веб-приложение (Обратите внимание, что код контроллера реализована практически идентично), но его стиль был изменен для неправильно отображается на сенсорным управлением мобильными устройствами.

1. Выберите **файл | Новые | Проект** команды меню. В **новый проект** диалоговом окне выберите **Visual C# | Web** шаблона на левой панели дерева, а затем выберите **веб-приложение ASP.NET MVC 4.** Назовите проект **PhotoGallery.Mobile**, выберите расположение (или оставьте значение по умолчанию), выберите &quot;добавить решение&quot; и нажмите кнопку **ОК**.
2. В **создания проекта ASP.NET MVC 4** диалоговом окне выберите **мобильного приложения** шаблон проекта и нажмите кнопку **ОК**. Убедитесь, что выбран в качестве обработчика представлений Razor.

    ![Создание нового приложения ASP.NET MVC 4 Mobile](whats-new-in-aspnet-mvc-4/_static/image11.png "Создание нового приложения ASP.NET MVC 4 Mobile")

    *Создание нового приложения ASP.NET MVC 4 Mobile*
3. Теперь вы сможете просматривать решения и некоторые новые функции, представленные в шаблоне решения ASP.NET MVC 4 для мобильных устройств:

    - **jQuery Mobile библиотеки**

        Шаблон проекта мобильного приложения включает в себя мобильных библиотеку jQuery, которая является библиотекой с открытым исходным кодом для совместимости браузера мобильного устройства. jQuery Mobile применяется прогрессивное Совершенствование для браузеров мобильных устройств, которые поддерживают CSS и JavaScript. Прогрессивное Совершенствование включает все обозреватели для отображения базовое содержимое веб-страницы, хотя он обеспечивает только самые мощные браузеры для отображения форматированное содержимое. JavaScript и CSS, включенные в файлы jQuery мобильного стиля помочь браузеры мобильных устройств в соответствии с содержимым на экране без внесения изменений в разметке страницы.

        ![jQuery-mobile-library-included-in-the-template](whats-new-in-aspnet-mvc-4/_static/image12.png)

        *Библиотека jQuery мобильных, включенный в шаблон*
    - **Разметки на основе HTML5**

        ![Mobile-application-template-using-HTML5-markup](whats-new-in-aspnet-mvc-4/_static/image13.png)

        *Шаблон мобильного приложения, используя разметку HTML5, (Login.cshtml и index.cshtml)*
4. Нажмите клавишу **F5** для запуска решения.
5. Откройте **Windows Phone 7 Emulator**.
6. На начальном экране телефона откройте Internet Explorer. Ознакомьтесь с URL-адрес, где запуска приложения рабочего стола и перейдите по этому АДРЕСУ с телефона (например `http://localhost:[PortNumber]/`).
7. Теперь вы сможете войти на страницу входа, или ознакомьтесь с возможностями о странице. Обратите внимание на то, что стиль веб-сайта основана на новое приложение Metro для мобильных устройств. Шаблон проекта ASP.NET MVC 4 правильно отображается на мобильных устройствах, убедившись, что все элементы страницы были видимы и включены. Обратите внимание, что ссылки на заголовок достаточно большим, чтобы быть щелкнул пользователь или.

    ![Проект шаблона страниц на мобильном устройстве](whats-new-in-aspnet-mvc-4/_static/image14.png "проекта шаблона страниц на мобильном устройстве")

    *Страницы шаблонов проекта на мобильном устройстве*
8. Новый шаблон также использует **просмотра мета-тег**. Большинство мобильных браузеров определить ширину окна виртуального браузера или &quot;окна просмотра&quot;, который больше, чем фактическую ширину мобильного устройства. Это позволяет браузеры мобильных устройств для отображения всей веб-страницы внутри виртуального дисплея. **Просмотра мета-тег** позволяет веб-разработчикам задать ширину, высоту и масштабирования области браузера на мобильных устройствах **.** Шаблон ASP.NET MVC 4 для мобильных приложений задает окно просмотра по ширине устройства (&quot;width = ширина устройства&quot;) в шаблоне макета (*Views\Shared\_Layout.cshtml*), так что все страницы будет иметь их просмотра присвоено ширину экрана устройства. Обратите внимание на то, что окно просмотра мета-тег не изменится в представление браузера по умолчанию.
9. Откройте  **\_Layout.cshtml**, расположенного в **представления | Общие** папки и комментарий просмотра мета-тег. Запустите приложение, в противном случае уже открыт и извлеките различия.

[!code-cshtml[Main](whats-new-in-aspnet-mvc-4/samples/sample2.cshtml)]

![Сайт после комментирование мета-тег просмотра](whats-new-in-aspnet-mvc-4/_static/image15.png "на сайт после комментирование мета-тег окна просмотра")

*Сайт после комментирование мета-тег окна просмотра*
10. В Visual Studio нажмите клавишу **SHIFT** + **F5** остановить отладку приложения.
11. Раскомментируйте мета-тег окна просмотра.

[!code-cshtml[Main](whats-new-in-aspnet-mvc-4/samples/sample3.cshtml)]

<a id="Task_3_-_Using_Adaptive_Rendering"></a>
#### <a name="task-3---using-adaptive-rendering"></a>Задача 3 - использование адаптивной отрисовки

В этой задаче вы узнаете, как другой метод для отображения веб-страницы правильно на мобильных устройствах и браузерах, в то же время, без какой-либо настройки. Вы уже использовали просмотра мета-тег с одинаковой цели. Теперь надо бороться с другой мощный метод: *адаптивной отрисовки*.

Адаптивная визуализация — это метод, который использует **медиа-запросами CSS3** настроить стиль, применяемый к странице. Медиа-запросами определить условия внутри таблицы стилей, группирование стили CSS при определенном условии. Только в том случае, если условие истинно, стиль применяется к объявленным объекты.

Гибкие возможности, предоставляемые методика адаптивной отрисовки включает все настройки для отображения сайта на разных устройствах. Вы можете определить столько стили на отдельную таблицу стилей без написания кода логики в любое выбрать стиль. Таким образом это очень ловко способ адаптации стилей страницы, поскольку он уменьшает объем дублирование кода и логики для рендеринга. С другой стороны использование пропускной способности возрастет, а немногим удается увеличить размер файлов CSS.

При использовании метода адаптивной отрисовки ваш сайт будет **отображаться неправильно, независимо от браузера.** Тем не менее, следует, если пропускная способность дополнительной нагрузки имеет значения.

> [!NOTE]
> — Базовый формат носителя запроса: @media \[Область: все | портативные | Печать | проекция | экран\] ([свойство: значение] и... [свойство: значение])

Примеры запросов мультимедиа: &gt;  **@media все и (максимальная ширина: 1000px) и (min нулевой ширины: 700px) {}:** Для всех разрешений между 700px и 1000px.

> **@media экран и (min нулевой ширины: 400 px) и (максимальная ширина: 700px) { ... }:** Только для экранов. Разрешение должно быть от 400 до 700px.
> 
> **@media портативные и (min нулевой ширины: 20em) экрана и (min нулевой ширины: 20em) {...}:** Для экранов и карманных устройств (mobile и устройств). Минимальная ширина должна быть больше 20em.
> 
> Дополнительные сведения об этом можно найти на [сайт консорциума W3C](http://www.w3.org/TR/css3-mediaqueries/).

Теперь будет изучено, как работает адаптивной отрисовки, повышения удобочитаемости ASP.NET MVC 4 по умолчанию шаблона веб-сайта.

1. Откройте **PhotoGallery.sln** решения, вы создали в задаче 1 и выберите **PhotoGallery** проекта. Нажмите клавишу **F5** для запуска решения.
2. Изменение ширины браузера, настройку windows на половину или меньше, чем квартал от его исходного размера. Обратите внимание на то, что происходит с элементами в заголовке: Некоторые элементы не будут отображаться в видимой области заголовка.
3. Откройте **Site.css** файл из обозревателя решений Visual Studio, находятся в **содержимого** папки проекта. Нажмите клавишу **CTRL + F** открытия Visual Studio интегрированный поиск, и записи **@media** искомого **медиа-запросов CSS**.

    Условие запроса мультимедиа, определенные в этот шаблон работает таким образом: Если размер окна браузера меньше **850 пикселей**, применены правила CSS, они определены внутри этого блока мультимедиа.

    ![Поиск запросов мультимедиа](whats-new-in-aspnet-mvc-4/_static/image16.png "поиск запрос носителя")

    *Поиск запросов мультимедиа*
4. Замените значение атрибута Максимальная ширина, заданное в 850 пикселей с **10px**, чтобы отключить адаптивной отрисовки и нажмите клавишу **CTRL + S** для сохранения изменений. Вернитесь в браузер и нажмите клавишу **CTRL + F5** для обновления страницы с внесенные изменения. Обратите внимание различия в любой из страниц, при изменении ширины окна.

    ![В левой части страницы применяет @media стиль, в правой части стиль опущен](whats-new-in-aspnet-mvc-4/_static/image17.png "применяет в левой части страницы @media стиль, в правой части стиль опущен")

    *В левой части страницы применяет @media опущен стиля в правом углу: стиль*

    Теперь давайте проверим, что происходит на мобильных устройствах:

    ![В левой части страницы применяет @media стиль, в правой части стиль опущен](whats-new-in-aspnet-mvc-4/_static/image18.png "применяет в левой части страницы @media стиль, в правой части стиль опущен")

    *В левой части страницы применяет @media опущен стиля в правом углу: стиль*

    Несмотря на то, что вы заметите, что изменения при просмотре страницы в веб-браузер не очень важно при использовании мобильного устройства различия становятся более очевидными. В левой области мы видим, что пользовательский стиль повышает удобство чтения.

    Адаптивная отрисовка может использоваться в гораздо больше сценариев, что упрощает применение условного стиля на веб-сайт и устранению распространенных проблем стиля с помощью подхода, чудесно.

    Окна просмотра мета-тег и медиа-запросов CSS не относящиеся к ASP.NET MVC 4, позволяет вам воспользоваться преимуществами этих функций в любое веб-приложение.
5. В Visual Studio нажмите клавишу **SHIFT** + **F5** остановить отладку приложения.

<a id="Exercise2"></a>

<a id="Exercise_2_Creating_the_Photo_Gallery_Web_Application"></a>
### <a name="exercise-2-creating-the-photo-gallery-web-application"></a>Упражнение 2. Создание веб-приложение фотоальбома

В этом упражнении будет работать в приложение фотоальбома для отображения фотографий. Мы начнем с шаблона проекта ASP.NET MVC 4, и затем нужно добавить функцию для получения фотографий из службы и их отображения на домашней странице.

В следующем упражнении вы обновите это решение, чтобы улучшить способ отображения на мобильных устройствах.

<a id="Task_1_-_Creating_a_Mock_Photo_Service"></a>
#### <a name="task-1---creating-a-mock-photo-service"></a>Задача 1 - Создание службы макетов фото

В этой задаче вы создадите макет из службы хранения фотографий, для получения содержимого, которое будет отображаться в коллекции. Чтобы сделать это, вы добавите новый контроллер, который просто возвращает JSON-файл с данными каждой фотографии.

1. Откройте **Visual Studio** Если еще не открыт.
2. Выберите **файл | Новые | Проект** команды меню. В **новый проект** диалоговом окне выберите **Visual C# | Web** шаблона на левой панели дерева, а затем выберите **веб-приложение ASP.NET MVC 4.** Назовите проект **PhotoGallery**, выберите расположение (или оставьте значение по умолчанию) и нажмите кнопку **ОК**. Кроме того, вы можете продолжать работать с вашей существующей ASP.NET MVC 4 **веб-приложение** решение из **упражнения 1** и пропустите следующий шаг.
3. В **создания проекта ASP.NET MVC 4** выберите **веб-приложение** шаблон проекта и нажмите кнопку **ОК**. Убедитесь, что у вас есть выбранные в качестве обработчика представлений Razor.
4. В **обозревателе решений**, щелкните правой кнопкой мыши **приложения\_данных** папку проекта и выберите **Add | Существующий элемент**. Перейдите к **Source\Assets\App\_данных** папку данную лабораторию и добавьте **Photos.json** файла.
5. Создайте новый контроллер с именем **PhotoController**. Чтобы сделать это, щелкните правой кнопкой мыши **контроллеров** перейдите к папке **добавить** и выберите **контроллера.** Полное имя контроллера, оставьте **пустой контроллер MVC** шаблона и нажмите кнопку **добавить**.

    ![Добавление PhotoController](whats-new-in-aspnet-mvc-4/_static/image19.png "Добавление PhotoController")

    *Добавление PhotoController*
6. Замените **индекс** следующим кодом **коллекции** действие и возвращают содержимое из файла JSON, недавно добавленные в проект.

    (Code Snippet - *действие коллекции ASP.NET MVC 4 лаборатории - Ex02 -*)

    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample4.cs)]
7. Нажмите клавишу **F5** для запуска решения, а затем перейдите в следующий URL-адрес для тестирования службы макеты photo: `http://localhost:[port]/photo/gallery` ([порт] значение зависит от текущего порта, где было запущено приложение). Запрос на этот URL-адрес следует извлекать содержимое **Photos.json** файла.

    ![Проверка службы макеты photo](whats-new-in-aspnet-mvc-4/_static/image20.png "тестирование службы макеты фото")

    *Проверка службы макеты фото*

В настоящей реализации можно было использовать [веб-API ASP.NET](../../../../web-api/index.md) для реализации службы Photo Gallery. Веб-API ASP.NET — это платформа, которая позволяет легко создавать HTTP-службы для широкого диапазона клиентов, включая браузеры и мобильные устройства. ASP.NET Web API - это идеальная платформа для сборки REST-приложений на базе .NET Framework.

<a id="Task_2_-_Displaying_the_Photo_Gallery"></a>
#### <a name="task-2---displaying-the-photo-gallery"></a>Задача 2 - отображение Photo Gallery

В этой задаче будет обновлять домашнюю страницу, чтобы показать коллекцию фотографий с помощью макеты службы, созданной в первой задаче данного упражнения. Будет добавлять файлы модели и обновлять представления коллекции.

1. В Visual Studio нажмите клавишу **SHIFT** + **F5** остановить отладку приложения.
2. Создание **Photo** в класс **моделей** папки. Чтобы сделать это, щелкните правой кнопкой мыши **моделей** папку, выберите **добавить** и нажмите кнопку **класс**. Затем задайте имя **Photo.cs** и нажмите кнопку **добавить**.
3. Добавьте следующие члены для **Photo** класса.

    (Code Snippet - *модели ASP.NET MVC 4 лаборатории - Ex02 - Photo*)

    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample5.cs)]
4. Откройте файл **HomeController.cs** в папке **Controllers**.
5. Добавьте следующие инструкции using.

    (Code Snippet - *директивы using HomeController лаборатории - Ex02 - ASP.NET MVC 4*)

    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample6.cs)]
6. Обновление **индекс** действие, чтобы использовать **HttpClient** для получения коллекции данных, а затем используйте **JavaScriptSerializer** для десериализации для модели представления.

    (Code Snippet - *действие индекса ASP.NET MVC 4 лаборатории - Ex02 -*)

    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample7.cs)]
7. Откройте **Index.cshtml** файла, расположенного в **Views\Home** папку и замените все содержимое следующим кодом.

    Этот код перебирает все фотографии, полученных от службы и отображает их в неупорядоченный список.

    (Code Snippet - *списка фотографий ASP.NET MVC 4 лаборатории - Ex02 -*)

    [!code-cshtml[Main](whats-new-in-aspnet-mvc-4/samples/sample8.cshtml)]
8. В **обозревателе решений**, щелкните правой кнопкой мыши **содержимого** папку проекта и выберите **Add | Существующий элемент**. Перейдите к **Source\Assets\Content** папку данную лабораторию и добавьте **Site.css** файл. Необходимо будет подтвердить его замены. Если у вас есть **Site.css** файл открыт, необходимо будет подтвердить на перезагрузку файла также.
9. Откройте проводник и скопировать весь **фотографии** папка размещена в **Source\Assets** папку данную лабораторию в корневую папку проекта в обозревателе решений.
10. Запустите приложение. Теперь вы увидите домашнюю страницу, отображения фотографий в коллекции.

    ![Фотоальбом](whats-new-in-aspnet-mvc-4/_static/image21.png "Photo Gallery")

    *Фотоальбом*
11. В Visual Studio нажмите клавишу **SHIFT** + **F5** остановить отладку приложения.

<a id="Exercise3"></a>

<a id="Exercise_3_Adding_support_for_mobile_devices"></a>
### <a name="exercise-3-adding-support-for-mobile-devices"></a>Упражнение 3. Добавление поддержки для мобильных устройств

Одно из ключевых обновлений в ASP.NET MVC 4 поддерживается для разработки мобильных приложений. В этом упражнении вы изучить новые функции ASP.NET MVC 4 для мобильных приложений путем расширения решения Коллекция фотографий, созданный в предыдущем упражнении.

<a id="Task_1_-_Installing_jQuery_Mobile_in_an_ASPNET_MVC_4_Application"></a>
#### <a name="task-1---installing-jquery-mobile-in-an-aspnet-mvc-4-application"></a>Задача 1 - Установка jQuery Mobile, в приложении ASP.NET MVC 4

1. Откройте **начать** решений, расположенный **источника/Ex3-MobileSupport/начало/** папки. В противном случае можно продолжить использование **окончания** решение получен путем выполнения предыдущего упражнения.

   1. Если вы открыли предоставленный **начать** решение, необходимо будет загрузить некоторые отсутствующие пакеты NuGet прежде чем продолжить. Чтобы сделать это, нажмите кнопку **проекта** меню и выберите **управление пакетами NuGet**.
   2. В **управление пакетами NuGet** диалоговое окно, нажмите кнопку **восстановить** чтобы скачивать отсутствующие пакеты.
   3. Наконец, постройте решение, нажав кнопку **построения** | **построить решение**.

      > [!NOTE]
      > Одним из преимуществ использования NuGet является отсутствие поставлять все библиотеки в проекте, уменьшив размер проекта. С помощью NuGet Power Tools путем указания версий пакета в файле Packages.config можно для скачивания всех необходимых библиотек при первом запуске проекта. Вот почему необходимо выполните описанные выше действия, после открытия существующего решения из этой лаборатории.
2. Откройте **консоль диспетчера пакетов** , щелкнув **средства** > **диспетчер пакетов NuGet** > **консоль диспетчера пакетов**  пункт меню.

    ![Открытие консоли диспетчера пакетов NuGet](whats-new-in-aspnet-mvc-4/_static/image22.png "при открытии консоли диспетчера пакетов NuGet")

    *Открытие консоли диспетчера пакетов NuGet*
3. В консоли диспетчера пакетов выполните следующую команду, чтобы установить **jQuery.Mobile.MVC** пакета.

    jQuery Mobile — это библиотека открытым исходным кодом для создания веб-оптимизированных для сенсорных экранов пользовательского интерфейса. Пакет NuGet jQuery.Mobile.MVC включает вспомогательные методы для использования с приложением ASP.NET MVC 4 jQuery Mobile.

    > [!NOTE]
    > С помощью следующей команды будут загружать jQuery.Mobile.MVC библиотеки из Nuget.

    по полудню

    [!code-powershell[Main](whats-new-in-aspnet-mvc-4/samples/sample9.ps1)]

    Эта команда устанавливает jQuery Mobile и некоторые вспомогательные файлы, включая следующие:

    - **Views/Shared/\_Layout.Mobile.cshtml**: — макет на базе мобильных технологий jQuery, оптимизированный для небольших экранов. Если веб-сайт получает запрос из браузера мобильного устройства, он заменит исходный макет (\_Layout.cshtml) с данным элементом.
    - Компонент переключателя: состоит из **Views/Shared/\_ViewSwitcher.cshtml** частичного представления и **ViewSwitcherController.cs** контроллера. Этот компонент будет отображать ссылку в браузерах мобильных устройств, чтобы пользователи могли переключиться в настольной версии страницы.  
        ![Photo Gallery проекта с поддержкой мобильных](whats-new-in-aspnet-mvc-4/_static/image23.png "Photo Gallery проекта с помощью поддержка мобильных устройств")

        *Проект фотоальбома с поддержка мобильных устройств*
4. Регистрация мобильных устройств пакеты. Чтобы сделать это, откройте **Global.asax.cs** файл и добавьте следующую строку.

    (Code Snippet - *мобильных пакеты ASP.NET MVC 4 лаборатории - Ex03 - Register*)

    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample10.cs)]
5. Запустите приложение с помощью веб-браузер.
6. Откройте **Windows Phone 7 Emulator,** в **меню «Пуск» | Все программы | Windows Phone SDK 7.1 | Эмулятор Windows Phone.**
7. На начальном экране телефона откройте Internet Explorer. Ознакомьтесь с URL-адрес, где запустить приложение и перейдите по этому АДРЕСУ с помощью обозревателя телефона (например `http://localhost:[PortNumber]/`).

    Обратите внимание, что приложение будет выглядеть иначе в эмуляторе Windows Phone, как jQuery.Mobile.MVC создал новые ресурсы в проекте, представления, оптимизированный для мобильных устройств.

    Обратите внимание, что сообщение в верхней части телефона, показывающая ссылку, которая переключается в представление рабочего стола. Кроме того  **\_Layout.Mobile.cshtml** макет, который был создан с помощью пакета установки — включая другой макет в приложении.

    > [!NOTE]
    > На данный момент нет ссылки для возврата к мобильному представлению. Он будет включен в более поздних версиях.

    ![Представление для мобильных устройств Photo коллекции домашней страницы](whats-new-in-aspnet-mvc-4/_static/image24.png "мобильного представления коллекции фотографий на домашней странице")

    *Представление коллекции фотографий на домашней странице для мобильных устройств*
8. В Visual Studio нажмите клавишу **SHIFT** + **F5** остановить отладку приложения.

<a id="Task_2_-_Creating_Mobile_Views"></a>
#### <a name="task-2---creating-mobile-views"></a>Задача 2 - Создание мобильных представлений

В этой задаче вы создадите мобильной версии в представление index с содержимым, адаптированных для улучшения внешнего вида на мобильных устройствах.

1. Копировать **Views\Home\Index.cshtml** просмотра, а затем вставьте его для создания копии, переименуйте новый файл в **Index.Mobile.cshtml**.
2. Открытие нового созданного **Index.Mobile.cshtml** просмотра и замените существующий &lt;ul&gt; тега с этим кодом. Таким образом происходит обновление &lt;ul&gt; тегов с заметками мобильных данных jQuery для использования мобильных темы с jQuery.

    [!code-html[Main](whats-new-in-aspnet-mvc-4/samples/sample11.html)]

    > [!NOTE] 
    > 
    > Обратите внимание на указанные ниже моменты.
    > 
    > - **Роль данных** атрибут **listview** визуализирует список при помощи стилей listview.
    > 
    > - **Вставки данных** атрибута задано значение true будет отображать список с границу со скругленными углами и полей.
    > 
    > - **Фильтр данных** атрибут **true** создаст поле поиска.
    > 
    > Дополнительные сведения о правилах мобильных jQuery в документацию по проекту. [[http://jquerymobile.com/demos/1.1.1/](http://jquerymobile.com/demos/1.1.1/)](http://jquerymobile.com/demos/1.1.1/)
3. Нажмите клавишу **CTRL + S** для сохранения изменений.
4. Переключиться в режим **эмулятора Windows Phone** и обновите узел. Обратите внимание, что благодаря новому интерфейсу списке коллекции, а также новое поле поиска, расположенную в верхней. Введите слово в поле поиска (например, **Tulips**) для начала поиска в коллекции фотографий.

    ![Коллекции с помощью стиля listview с фильтрацией](whats-new-in-aspnet-mvc-4/_static/image25.png "коллекции с помощью стиля listview с фильтрацией")

    *Коллекции с помощью стиля listview с фильтрацией*

    Таким образом, вы использовали Mobilizer представление рецепт для создания копии индекс представления с &quot;мобильных&quot; суффикс. Этот суффикс указывает ASP.NET MVC 4, что все запросы, созданные с помощью мобильного устройства будет использовать эта копия индекса. Кроме того вы обновили мобильную версию индекс представления, чтобы использовать jQuery Mobile для совершенствования внешний вид сайта на мобильных устройствах.
5. Вернитесь в Visual Studio и откройте **Site.Mobile.css** каталоге **содержимого** папки.
6. Исправьте положение Название фотографии, чтобы отобразить в правой части изображения. Чтобы сделать это, добавьте следующий код, чтобы **Site.Mobile.css** файла.

    CSS

    [!code-css[Main](whats-new-in-aspnet-mvc-4/samples/sample12.css)]
7. Нажмите клавишу **CTRL + S** для сохранения изменений.
8. Вернитесь в **эмулятора Windows Phone** и обновите узел. Обратите внимание, что теперь удачно позиционируется в Название фотографии.

    ![Заголовок располагается в правой части изображения](whats-new-in-aspnet-mvc-4/_static/image26.png "Title, расположенный в правой части изображения")

    *Заголовок располагается в правой части изображения*

<a id="Task_3_-_jQuery_Mobile_Themes"></a>
#### <a name="task-3---jquery-mobile-themes"></a>Задача 3 - jQuery Mobile темы

Каждый макет и мини-приложения на jQuery Mobile разработано на основе новой объектно ориентированного CSS платформы, дает возможность применить тему полный единой визуального проектирования к сайтам и приложениям.

jQuery Mobile темы по умолчанию включает в себя 5 образцы, на которые указывает буквы (a, b, c, d, e) краткий справочник.

В этой задаче вы обновите то мобильный макет, чтобы использовать другую тему по умолчанию.

1. Переключитесь в Visual Studio.
2. Откройте  **\_Layout.Mobile.cshtml** файл, расположенный в **Views\Shared**.
3. Найдите элемент div с роли данных, равным &quot;страницы&quot; и обновить **data-theme** для &quot; **e**&quot;.

    [!code-html[Main](whats-new-in-aspnet-mvc-4/samples/sample13.html)]
4. Нажмите клавишу **CTRL + S** для сохранения изменений.
5. Обновите сайт в **эмулятора Windows Phone** и обратите внимание, что новая схема цветов.

    ![Макета для мобильных устройств с помощью другой цветовой схемы](whats-new-in-aspnet-mvc-4/_static/image27.png "макета для мобильных устройств с помощью другой цветовой схемы")

    *С другой цветовой схемы макета для мобильных устройств*

<a id="Task_4_-_Using_the_View-Switcher_Component_and_the_Browser_Overriding_Features"></a>
#### <a name="task-4---using-the-view-switcher-component-and-the-browser-overriding-features"></a>Задача 4 - с помощью компонента переключателя и браузер переопределение функций

Соглашение для веб-страниц, оптимизированных для мобильных устройств — Добавление ссылки которых указано что-то как представление рабочего стола или режиме весь сайт, который позволяет пользователям переключиться в настольной версии страницы. Пакет jQuery.Mobile.MVC включает пример **-переключателя** компонент для этой цели, используемых в  **\_Layout.Mobile.cshtml** представления.

![Ссылку, чтобы переключиться в представление рабочего стола](whats-new-in-aspnet-mvc-4/_static/image28.png "ссылку, чтобы переключиться в представление рабочего стола")

*Ссылку, чтобы перейти в представление рабочего стола*

Просмотреть переключатель используется новая функция, называемая **переопределения браузера**. Эта функция позволяет приложению рассматривать запросы, как если бы они поступали от другой браузер (агент пользователя), теперь поступают с чем.

В этой задаче будет изучено пример реализации представления переключателя добавленные jQuery.Mobile.MVC и новый обозреватель переопределение функций в ASP.NET MVC 4.

1. Переключитесь в Visual Studio.
2. Откройте  **\_Layout.Mobile.cshtml** представление, расположенный в **Views\Shared** папку и обратите внимание, что вызываемый как частичное представление компонента представления переключателя.

    ![Макета для мобильных устройств с помощью компонента переключателя](whats-new-in-aspnet-mvc-4/_static/image29.png "макета для мобильных устройств с помощью переключателя компонента")

    *С помощью компонента переключателя макета для мобильных устройств*
3. Откройте  **\_ViewSwitcher.cshtml** частичного представления.

    Частичное представление использует новый метод **ViewContext.HttpContext.GetOverriddenBrowser()** для определения источника веб-запроса и отображения соответствующую ссылку, чтобы перейти либо к представлениям Desktop или Mobile.

    **GetOverriddenBrowser** возвращает **HttpBrowserCapabilitiesBase** , соответствующего агента пользователя, заданных в настоящее время для запроса (фактические или переопределено). Это значение можно использовать для получения свойств, таких как **IsMobileDevice**.

    ![Частичное представление ViewSwitcher](whats-new-in-aspnet-mvc-4/_static/image30.png "ViewSwitcher частичного представления")

    *ViewSwitcher частичного представления*
4. Откройте **ViewSwitcherController.cs** класс находится в **контроллеров** папки. Ознакомьтесь с этой SwitchView действие вызывается в ссылке в компоненте ViewSwitcher и обратите внимание, что новые методы HttpContext.

    - **HttpContext.ClearOverriddenBrowser()** метод удаляет все переопределенные агенты пользователя для текущего запроса.
    - **HttpContext.SetOverriddenBrowser()** метод переопределяет значение агента пользователя запроса, с указанием указанного агента пользователя.  
        ![Контроллер ViewSwitcher](whats-new-in-aspnet-mvc-4/_static/image31.png "ViewSwitcher контроллера")  
*ViewSwitcher контроллера*

        Подмена браузера — это функция core ASP.NET MVC 4, в которой также доступны, даже если не установить пакет jQuery.Mobile.MVC. Тем не менее эта функция затрагивает только представление макета и частичного представления, и он не влияет на функции, которые зависят от объекта Request.Browser.

<a id="Task_5_-_Adding_the_View-Switcher_in_the_Desktop_View"></a>
#### <a name="task-5---adding-the-view-switcher-in-the-desktop-view"></a>Задача 5 - добавление переключателя в представлении рабочего стола

В этой задаче вы обновите макет рабочего стола для включения переключателя. Это позволит мобильных пользователей, чтобы вернуться в представление для мобильных устройств при просмотре представление рабочего стола.

1. Обновите сайт в **эмулятора Windows Phone**.
2. Щелкните **представление рабочего стола** ссылку в верхней части коллекции. Обратите внимание, что в представлении рабочего стола, чтобы разрешить вернуться к представление для мобильных устройств не представление переключателя.
3. Вернитесь в Visual Studio и откройте  **\_Layout.cshtml** представления.
4. Найдите раздел входа и вставьте вызов для подготовки к просмотру  **\_ViewSwitcher** частичного представления ниже  **\_LogOnPartial** частичного представления. Затем нажмите клавишу **CTRL + S** для сохранения изменений.

    [!code-cshtml[Main](whats-new-in-aspnet-mvc-4/samples/sample14.cshtml)]
5. Нажмите клавишу **CTRL + S** для сохранения изменений.
6. Обновите страницу в эмуляторе Windows Phone и дважды щелкните для увеличения изображения на экране. Обратите внимание, что теперь отображаются на домашней странице **мобильного представления** ссылку, которая переключается от мобильного телефона в представление рабочего стола.

    ![Просмотреть переключатель, подготавливается к просмотру в представление рабочего стола](whats-new-in-aspnet-mvc-4/_static/image32.png "переключателя подготавливается к просмотру в представление рабочего стола")

    *Просмотреть переключатель, подготавливается к просмотру в представление рабочего стола*
7. Снова вернитесь в представление для мобильных устройств и перейдите к **о** страницы (http://localhost[порт] / Home/о). Обратите внимание на то, что, даже если вы не создавали в представлении About.Mobile.cshtml, Обзорная страница отображается с использованием макета для мобильных устройств (\_Layout.Mobile.cshtml).

    ![Страница About](whats-new-in-aspnet-mvc-4/_static/image33.png "о странице")

    *О странице*
8. Наконец откройте сайт в классических веб-браузере. Обратите внимание на то, что ни один из предыдущих обновлений изменяет представление рабочего стола.

    ![Коллекция фотографий представление рабочего стола](whats-new-in-aspnet-mvc-4/_static/image34.png "представление рабочего стола Коллекция фотографий")

    *Коллекция фотографий представление рабочего стола*

<a id="Task_6_-_Creating_New_Display_Modes"></a>
#### <a name="task-6---creating-new-display-modes"></a>Задача 6 - создание новых режимов отображения

Новая функция режимов отображения для работы приложения выберите представления, в зависимости от браузера, создающего запрос. Например, если классический браузер запрашивает на домашнюю страницу, то приложение завершит работу **Views\Home\Index.cshtml** шаблона. Затем, если браузер мобильного устройства запрашивает на домашнюю страницу, то приложение завершит работу **Views\Home\Index.mobile.cshtml** шаблона.

В этой задаче вы создадите настраиваемый макет для устройств iPhone и необходимо смоделировать запросы из устройства iPhone. Чтобы сделать это, можно использовать либо эмулятор/эмулятор iPhone (как [электрического симулятор Mobile](http://www.electricplum.com/)) или браузера с помощью надстроек, которые изменяют агента пользователя. Инструкции о том, как присвоить строку агента пользователя в обозревателе Safari для эмуляции iPhone, см. в разделе [как предоставить Safari представьте это IE](http://www.davidalison.com/2008/05/how-to-let-safari-pretend-its-ie.html) в блоге Дэвида Alison.

**Обратите внимание на то, что эта задача является необязательным, и можно продолжать в лаборатории. без ее выполнения.**

1. В Visual Studio нажмите клавишу **SHIFT** + **F5** остановить отладку приложения.
2. Откройте **Global.asax.cs** и добавьте следующий оператор using.

    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample15.cs)]
3. Добавьте следующий выделенный код в приложение\_метод Start.

    (Code Snippet - *ASP.NET MVC 4 лаборатории - Ex03 - iPhone DisplayMode*)

    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample16.cs)]

Вы зарегистрировали новый **DefaultDisplayMode с именем &quot;iPhone&quot;**, в статический **DisplayModeProvider.Instance.Modes** статического списка, которая будет сопоставлена с Каждый входящий запрос. Если входящий запрос содержит строку &quot;iPhone&quot;, ASP.NET MVC поиск представлений, имена которых содержат &quot;iPhone&quot; суффикс. Параметр 0 указывает, как определенные новый режим; Например, это представление является более точным, чем Общие &quot;.mobile&quot; правило, которое соответствует запросам с мобильных устройств.

После выполнения этого кода, когда это браузер iPhone создает запрос, приложение будет использовать **Views\Shared\\_Layout.iPhone.cshtml** макет, вы создадите на следующих шагах.

> [!NOTE]
> Такой способ тестирования запроса для iPhone был упрощен для демонстрационных целей и не может работать неправильно для каждой строки агента пользователя iPhone (для тестирования пример чувствительно к регистру).

4. Создать копию  **\_Layout.Mobile.cshtml** файл **Views\Shared** папку и переименуйте копию &quot; **\_Layout.iPhone.cshtml**&quot;.
5. Откройте  **\_Layout.iPhone.cshtml** вы создали на предыдущем шаге.
6. Найдите элемент div с атрибутом роли данных, равным **страницы** и измените **data-theme** атрибут &quot;**a**&quot;.

[!code-cshtml[Main](whats-new-in-aspnet-mvc-4/samples/sample17.cshtml)]

Теперь у вас есть 3 макетов в приложении ASP.NET MVC 4:

1. **\_Layout.cshtml**: макет по умолчанию, используемый для браузеров настольных компьютеров.
2. **\_Layout.Mobile.cshtml**: макет по умолчанию, используемый для мобильных устройств.
3. **\_Layout.iPhone.cshtml**: определенный макет для устройства iPhone, используя другой цветовой схемы для различения \_Layout.mobile.cshtml.
7. Нажмите клавишу **F5** для запуска приложения и перейдите на сайт в **эмулятора Windows Phone**.
8. Откройте **симулятора iPhone** (см. в разделе [приложении C](#AppendixC) инструкции по установке и настройке эмулятор iPhone) и перейдите на сайт слишком. Обратите внимание на то, что каждый phone использует указанный шаблон.

    ![Using-different-Views-For-Each-Mobile-device2](whats-new-in-aspnet-mvc-4/_static/image35.png)

    *С помощью различных представлений для каждого мобильного устройства*

<a id="Exercise4"></a>

<a id="Exercise_4_Using_Asynchronous_Controllers"></a>
### <a name="exercise-4-using-asynchronous-controllers"></a>Упражнение 4. Использование асинхронных контроллеров

Microsoft .NET Framework 4.5 предоставляет новые возможности языка в C# и Visual Basic, является основой новой асинхронность в программировании .NET. Этот новый foundation делает асинхронное программирование, аналогичную - и примерно так же просто, как и - синхронное. Теперь есть возможность написать асинхронные методы действия в ASP.NET MVC 4 с помощью **AsyncController** класса. Асинхронные методы действия можно использовать для выполняющейся длительное время, не связаны с ЦП запросов. Это предотвращает блокировку веб-сервера от выполнения операций во время обработки запроса. AsyncController класс обычно используется для длительных вызовов веб-службы.

В этом упражнении рассматриваются основы асинхронной операции в ASP.NET MVC 4. Если вам необходимы более подробные сведения, вы можете ознакомиться со следующей статьей: [[https://msdn.microsoft.com/library/ee728598%28v=vs.100%29.aspx](https://msdn.microsoft.com/library/ee728598%28v=vs.100%29.aspx)](https://msdn.microsoft.com/library/ee728598%28v=vs.100%29.aspx)

<a id="Task_1_-_Implementing_an_Asynchronous_Controller"></a>
#### <a name="task-1---implementing-an-asynchronous-controller"></a>Задача 1 - Реализация асинхронного контроллера

1. Откройте **начать** решений, расположенный **источника/Ex4-Async иBegin/** папки. В противном случае можно продолжить использование **окончания** решение получен путем выполнения предыдущего упражнения.

   1. Если вы открыли предоставленный **начать** решение, необходимо будет загрузить некоторые отсутствующие пакеты NuGet прежде чем продолжить. Чтобы сделать это, нажмите кнопку **проекта** меню и выберите **управление пакетами NuGet**.
   2. В **управление пакетами NuGet** диалоговое окно, нажмите кнопку **восстановить** чтобы скачивать отсутствующие пакеты.
   3. Наконец, постройте решение, нажав кнопку **построения** | **построить решение**.

      > [!NOTE]
      > Одним из преимуществ использования NuGet является отсутствие поставлять все библиотеки в проекте, уменьшив размер проекта. С помощью NuGet Power Tools путем указания версий пакета в файле Packages.config можно для скачивания всех необходимых библиотек при первом запуске проекта. Вот почему необходимо выполните описанные выше действия, после открытия существующего решения из этой лаборатории.
2. Откройте **HomeController.cs** класса из **контроллеров** папки.
3. Добавьте следующий оператор using.

    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample18.cs)]
4. Обновление **HomeController** наследование из класса **AsyncController**. Контроллеры, являющиеся производными от AsyncController позволяют ASP.NET выполнять обработку асинхронных запросов, и они по-прежнему могут обслуживать синхронные методы действия.

    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample19.cs)]
5. Добавить **async** слово **индекс** метод и сделать его возвращаемый тип **задачи&lt;ActionResult&gt;**.

    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample20.cs)]

    > [!NOTE]
    > **Async** ключевое слово является одним из .NET Framework 4.5 предоставляет новые ключевые слова; она сообщает компилятору, что этот метод содержит асинхронного кода. Объект **задачи** представляет асинхронную операцию, которая может завершиться в некоторый момент в будущем.
6. Замените **клиента. GetAsync()** вызов с полной асинхронные версии с помощью await-ключевое слово, как показано ниже.

    (Code Snippet - *GetAsync лаборатории - Ex04 - ASP.NET MVC 4*)

    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample21.cs)]

    > [!NOTE]
    > В предыдущей версии, вы использовали **результат** свойства из **задачи** объекта, чтобы блокировать поток до возврата результата (синхронный).
    > 
    > Добавление **await** ключевое слово указывает компилятору для асинхронного ожидания для задачи, возвращаемой из вызова метода. Это означает, что остальной части кода будет выполнен как обратный вызов только в том случае, после завершения работы метода ожидаемой. Обратите внимание, что еще одну вещь: не нужно изменить в блок try-catch, чтобы выполнить эту операцию: исключения, которые происходят в фоновом режиме или в фоновом режиме по-прежнему будет перехвачено без дополнительных действий с помощью обработчика, предоставляемых платформой.
7. Изменить код, чтобы продолжить асинхронную реализацию, заменив строки с новым кодом, как показано ниже

    (Code Snippet - *ReadAsStringAsync лаборатории - Ex04 - ASP.NET MVC 4*)

    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample22.cs)]
8. Запустите приложение. Вы заметите существенных изменений, но код не будет блокировать поток из пула потоков, что лучше использования ресурсов сервера и повышая производительность.

    > [!NOTE]
    > Дополнительные сведения о новой функции асинхронного программирования в лаборатории &quot; **асинхронное программирование в .NET 4.5 с помощью C# и Visual Basic** &quot; в состав набора обучения Visual Studio.

<a id="Task_2_-_Handling_Time-Outs_with_Cancellation_Tokens"></a>
#### <a name="task-2---handling-time-outs-with-cancellation-tokens"></a>Задача 2 - обработка времени ожидания, токены отмены

Асинхронные методы действия, которые возвращают экземпляры задач также могут поддерживать значения времени ожидания. В этой задаче мы обновим код метода индекс для обработки времени ожидания сценария, с помощью токена отмены.

1. Вернитесь к Visual Studio и нажать клавишу **SHIFT + F5** остановить отладку.
2. Добавьте следующий оператор using **HomeController.cs** файла.

    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample23.cs)]
3. Обновление действия индекса для получения **CancellationToken** аргумент.

    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample24.cs)]
4. Обновление **GetAsync** вызова для передачи токена отмены.

    (Code Snippet - *SendAsync лаборатории - Ex04 - ASP.NET MVC 4 с CancellationToken*)

    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample25.cs)]
5. Decorate *индекс* метод с **AsyncTimeout** атрибуту присвоено значение 500 миллисекунд и **HandleError** атрибут, настроенный для обработки  **TaskCanceledException** путем перенаправления **TimedOut** представления.

    (Code Snippet - *атрибуты лаборатории - Ex04 - ASP.NET MVC 4*)

    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample26.cs)]
6. Откройте **PhotoController** класс и обновление **коллекции** метод отложить выполнение 1000 миллисекунд (1 секунда) для моделирования длительной задачи.

    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample27.cs)]
7. Откройте **Web.config** файл и включите настраиваемых ошибок, добавив следующий элемент.

    [!code-xml[Main](whats-new-in-aspnet-mvc-4/samples/sample28.xml)]
8. Создание нового представления в **Views\Shared** с именем **TimedOut** и использование макета по умолчанию. В обозревателе решений щелкните правой кнопкой мыши **Views\Shared** папку и выберите **Add | Представление**.

    ![С помощью различных представлений для каждого мобильного устройства](whats-new-in-aspnet-mvc-4/_static/image36.png "с помощью различных представлений для каждого мобильного устройства")

    *С помощью различных представлений для каждого мобильного устройства*
9. Обновление **TimedOut** Просмотр содержимого, как показано ниже.

    [!code-cshtml[Main](whats-new-in-aspnet-mvc-4/samples/sample29.cshtml)]
10. Запустите приложение и перейдите к корневой URL-адрес. Как вы добавили **Thread.Sleep** 1000 миллисекунд, вы получите ошибку времени ожидания, создаваемые **AsyncTimeout** атрибут и выявляйте с **HandleError** атрибут.

    ![Время ожидания исключения, обрабатываемого](whats-new-in-aspnet-mvc-4/_static/image37.png "исключение времени ожидания обработки")

    *Исключение времени ожидания обработки*

> [!NOTE]
> Кроме того, можно развернуть это приложение на веб-сайтов Windows Azure ниже [приложение г Публикация приложения ASP.NET MVC 4 с помощью веб-развертывания](#AppendixD).

<a id="Summary"></a>

<a id="Summary"></a>
## <a name="summary"></a>Сводка

В этом практического занятия вы встречающейся некоторые из новых функций постоянно находятся в ASP.NET MVC 4. Подробно обсуждаются следующие понятия:

- Воспользоваться преимуществами расширений для ASP.NET MVC проект шаблоны, в том числе нового шаблона проекта мобильного приложения
- Использовать окна просмотра атрибут HTML5 и CSS медиа-запросов для улучшения отображения на мобильных устройствах
- Использовать jQuery Mobile для прогрессивного улучшения, а также для создания оптимизированных для сенсорных экранов веб-Интерфейс
- Создание представлений для мобильных устройств
- Использовать компонент переключателя для переключения между представлениями мобильные и Классические приложения
- Создание асинхронных контроллеров, используя поддержку задач

<a id="AppendixA"></a>

<a id="Appendix_A_Using_Code_Snippets"></a>
## <a name="appendix-a-using-code-snippets"></a>Приложение а. Фрагменты кода

С помощью фрагментов кода у вас есть весь код, который требуется в вашем распоряжении. Лаборатории документ поможет определить точно при их использовании, как показано на рисунке ниже.

![Фрагменты кода Visual Studio, чтобы вставить код в проект](whats-new-in-aspnet-mvc-4/_static/image38.png "фрагменты кода с помощью Visual Studio, чтобы вставить код в проект")

*Фрагменты кода Visual Studio, чтобы вставить код в проект*

***Чтобы добавить фрагмент кода, с помощью клавиатуры (только C#)***

1. Поместите курсор в место вставки кода.
2. Начните вводить имя фрагмента (без пробелов и дефисов).
3. Посмотрите, как IntelliSense отображает, совпадающие с именами фрагменты.
4. Выберите правильный фрагмент (или продолжите ввод, пока не будет выделен весь фрагмент имени).
5. Нажмите клавишу Tab дважды, чтобы вставить фрагмент в положении курсора.

![Начните вводить имя фрагмента](whats-new-in-aspnet-mvc-4/_static/image39.png "начните вводить имя фрагмента")

*Начните вводить имя фрагмента*

![Нажмите клавишу Tab, чтобы выделить фрагмент в выделенный](whats-new-in-aspnet-mvc-4/_static/image40.png "нажмите клавишу Tab, чтобы выделить выделенный фрагмент")

*Нажмите клавишу Tab, чтобы выделить выделенный фрагмент*

![Снова нажмите клавишу Tab и фрагмент будет расширяться](whats-new-in-aspnet-mvc-4/_static/image41.png "еще раз нажмите клавишу Tab и фрагмент будет расширяться")

*Снова нажмите клавишу Tab и фрагмент будет расширяться*

***Чтобы добавить фрагмент кода, с помощью мыши (C#, Visual Basic и XML)***

1. Щелкните правой кнопкой мыши место для вставки фрагмента кода.
2. Выберите **вставить фрагмент** следуют **Мои фрагменты кода**.
3. Выберите соответствующий фрагмент из списка, щелкнув его.

![Щелкните правой кнопкой мыши, где необходимо вставить фрагмент кода и выберите Вставить фрагмент](whats-new-in-aspnet-mvc-4/_static/image42.png "щелкните правой кнопкой мыши, где необходимо вставить фрагмент кода и выберите Вставить фрагмент")

*Щелкните правой кнопкой мыши место для вставки фрагмента кода и выберите Вставить фрагмент*

![Выберите соответствующий фрагмент из списка, щелкнув по ней](whats-new-in-aspnet-mvc-4/_static/image43.png "выбрать соответствующий фрагмент из списка, щелкнув по ней")

*Выберите соответствующий фрагмент из списка, щелкнув по ней*

<a id="AppendixB"></a>

<a id="Appendix_B_Installing_Visual_Studio_Express_2012_for_Web"></a>
## <a name="appendix-b-installing-visual-studio-express-2012-for-web"></a>Приложение б. Установка Visual Studio Express 2012 для Web

Вы можете установить **Microsoft Visual Studio Express 2012 для Web** или другой &quot;Express&quot; версию с помощью **[Microsoft Web Platform Installer](https://www.microsoft.com/web/downloads/platform.aspx)**. Приведенные ниже инструкции описывают действия, необходимые для установки *Visual studio Express 2012 для Web* с помощью *Microsoft Web Platform Installer*.

1. Перейдите к [ [ https://go.microsoft.com/?linkid=9810169 ](https://go.microsoft.com/?linkid=9810169) ](https://go.microsoft.com/?linkid=9810169). Кроме того, если вы уже установили установщика веб-платформы, можно открыть его и выполните поиск продукта &quot; *Visual Studio Express 2012 для Web с пакетом Windows Azure SDK*&quot;.
2. Щелкните **установить сейчас**. Если у вас нет **установщика веб-платформы** вы будете перенаправлены к сначала загрузить и установить его.
3. Один раз **установщика веб-платформы** открыт, нажмите кнопку **установить** для запуска программы установки.

    ![Установка Visual Studio Express](whats-new-in-aspnet-mvc-4/_static/image44.png "установка Visual Studio Express")

    *Установка Visual Studio Express*
4. Прочтите лицензии и условия все продукты и нажмите кнопку **я принимаю** для продолжения.

    ![Принятие условий лицензии](whats-new-in-aspnet-mvc-4/_static/image45.png)

    *Принятие условий лицензии*
5. Подождите, пока не завершится процесс загрузки и установки.

    ![Ход установки](whats-new-in-aspnet-mvc-4/_static/image46.png)

    *Ход выполнения установки*
6. После завершения установки нажмите кнопку **Готово**.

    ![Установка завершена](whats-new-in-aspnet-mvc-4/_static/image47.png)

    *Установка завершена*
7. Нажмите кнопку **выхода** закрыть установщик веб-платформы.
8. Чтобы открыть Visual Studio Express для Web, перейдите к **запустить** экрана и Займитесь написанием &quot; **VS Express**&quot;, нажмите кнопку на **VS Express для Web** Плитка.

    ![VS Express для Web плитки](whats-new-in-aspnet-mvc-4/_static/image48.png)

    *VS Express для Web плитки*

<a id="AppendixC"></a>

<a id="Appendix_C_Installing_WebMatrix_2_and_iPhone_Simulator"></a>
## <a name="appendix-c-installing-webmatrix-2-and-iphone-simulator"></a>Приложение c. Установка WebMatrix 2 и симулятора iPhone

Чтобы запустить свой сайт в iPhone на имитации устройства можно использовать расширения WebMatrix &quot;электрического симулятор Mobile для iPhone&quot;. Кроме того можно настроить одного модуля для запуска симулятора из Visual Studio 2012.

<a id="ApxCTask1"></a>

<a id="Task_1_-_Installing_WebMatrix_2"></a>
#### <a name="task-1---installing-webmatrix-2"></a>Задача 1 - Установка WebMatrix 2

1. Перейдите к [ [ https://go.microsoft.com/?linkid=9809776 ](https://go.microsoft.com/?linkid=9809776) ](https://go.microsoft.com/?linkid=9810169). Кроме того, если вы уже установили установщика веб-платформы, можно открыть его и выполните поиск продукта &quot; *WebMatrix 2*&quot;.
2. Щелкните **установить сейчас**. Если у вас нет **установщика веб-платформы** вы будете перенаправлены к сначала загрузить и установить его.
3. Один раз **установщика веб-платформы** открыт, нажмите кнопку **установить** для запуска программы установки.

    ![Установка WebMatrix 2](whats-new-in-aspnet-mvc-4/_static/image49.png "Установка WebMatrix 2")

    *Установка WebMatrix 2*
4. Прочтите лицензии и условия все продукты и нажмите кнопку **я принимаю** для продолжения.

    ![Принятие условий лицензии на](whats-new-in-aspnet-mvc-4/_static/image50.png "принятие условий лицензии")

    *Принятие условий лицензии*
5. Подождите, пока не завершится процесс загрузки и установки.

    ![Ход выполнения установки](whats-new-in-aspnet-mvc-4/_static/image51.png "ход выполнения установки")

    *Ход выполнения установки*
6. После завершения установки нажмите кнопку **Готово**.

    ![Установка завершена](whats-new-in-aspnet-mvc-4/_static/image52.png "Установка завершена")

    *Установка завершена*
7. Нажмите кнопку **выхода** закрыть установщик веб-платформы.

<a id="ApxCTask2"></a>

<a id="Task_2_-_Installing_the_iPhone_Simulator_Extension"></a>
#### <a name="task-2---installing-the-iphone-simulator-extension"></a>Задача 2 - Установка расширения симулятора iPhone

1. Запустите **WebMatrix** и открыть любой существующий веб-сайт или создайте новую.
2. Нажмите кнопку **запуска** кнопки **Главная** ленты и выберите **добавить**.

    ![Добавление нового расширения WebMatrix](whats-new-in-aspnet-mvc-4/_static/image53.png "Добавление нового расширения WebMatrix")

    *Добавление нового расширения WebMatrix*
3. Выберите **iPhone симулятор** и нажмите кнопку **установить**.

    ![Просмотр расширения WebMatrix](whats-new-in-aspnet-mvc-4/_static/image54.png "расширения Обзор WebMatrix")

    *Просмотр расширения WebMatrix*
4. Сведения о пакете, щелкните **установить** для продолжения установки расширения.

    ![расширение симулятора iPhone](whats-new-in-aspnet-mvc-4/_static/image55.png "расширение симулятора iPhone")

    *расширение симулятора iPhone*
5. Прочитайте и примите лицензионное соглашение расширения.

    ![Расширения WebMatrix лицензионное соглашение](whats-new-in-aspnet-mvc-4/_static/image56.png "расширения WebMatrix лицензионное соглашение")

    *Расширения WebMatrix лицензионное соглашение*
6. Теперь можно запустить веб-сайт из WebMatrix с помощью параметра симулятора iPhone.

    ![Запустить с помощью iPhone](whats-new-in-aspnet-mvc-4/_static/image57.png "запустить с помощью iPhone")

    *Запустить с помощью iPhone*

<a id="ApxCTask3"></a>

<a id="Task_3_-_Configuring_Visual_Studio_2012_to_run_iPhone_Simulator"></a>
#### <a name="task-3---configuring-visual-studio-2012-to-run-iphone-simulator"></a>Задача 3 - Настройка Visual Studio 2012 для запуска симулятора iPhone

1. Откройте **Visual Studio 2012** и откройте любой веб-сайт или создайте новый проект.
2. Щелкните стрелку рядом с и выберите **просмотр с помощью**.

    ![Просмотр с помощью](whats-new-in-aspnet-mvc-4/_static/image58.png "просмотр с помощью")

    *Просмотр с помощью*
3. В &quot;просмотр с помощью&quot; диалоговое окно, нажмите кнопку **добавить**.
4. В &quot;добавить программу&quot; диалоговое окно, используйте следующие значения:

   - **Программа**: C:\Users\*{CurrentUser}*\AppData\Local\Microsoft\WebMatrix\Extensions\20\iPhoneSimulator\ElectricMobileSim\ElectricMobileSim.exe *(соответствующим образом обновить путь)*
   - **Аргументы**. &quot;1&quot;
   - **Понятное имя**: симулятора iPhone

     ![Добавление программы](whats-new-in-aspnet-mvc-4/_static/image59.png "Добавление программы")

     *Добавьте программу, чтобы перейти с*
5. Нажмите кнопку **ОК** и закрыть все диалоговые окна.
6. Теперь имеется возможность запуска веб-приложений в симуляторе iPhone из Visual Studio 2012.

    ![Просмотр с помощью iPhone симулятор](whats-new-in-aspnet-mvc-4/_static/image60.png "просмотр с помощью симулятора iPhone")

    *Просмотр с помощью симулятора iPhone*

<a id="AppendixD"></a>

<a id="Appendix_D_Publishing_an_ASPNET_MVC_4_Application_using_Web_Deploy"></a>
## <a name="appendix-d-publishing-an-aspnet-mvc-4-application-using-web-deploy"></a>Приложение г. Публикация приложения ASP.NET MVC 4 с помощью веб-развертывания

В этом приложении показано, как создать новый веб-сайт на портале управления Windows Azure и опубликовать приложение, полученный после лаборатории, используя преимущества компонентов публикации веб-развертывания, предоставляемые Windows Azure.

<a id="ApxDTask1"></a>

<a id="Task_1_-_Creating_a_New_Web_Site_from_the_Windows_Azure_Portal"></a>
#### <a name="task-1---creating-a-new-web-site-from-the-windows-azure-portal"></a>Задача 1 - Создание нового веб-сайта с Windows Azure Portal

1. Перейдите к [портала управления Windows Azure](https://manage.windowsazure.com/) и войдите с использованием учетных данных Майкрософт, связанную с вашей подпиской.

    > [!NOTE]
    > С помощью Windows Azure можно бесплатное размещение 10 веб-сайтов ASP.NET и затем масштабировать по мере увеличения объема трафика. Вы можете зарегистрироваться [здесь](https://aka.ms/aspnet-hol-azure).

    ![Войдите на портал Windows Azure](whats-new-in-aspnet-mvc-4/_static/image61.png "Войдите на портал Windows Azure")

    *Войдите на портал управления Windows Azure*
2. Нажмите кнопку **New** на панели команд.

    ![Создание нового веб-сайта](whats-new-in-aspnet-mvc-4/_static/image62.png "создания нового веб-сайта")

    *Создание нового веб-сайта*
3. Нажмите кнопку **вычислений** | **веб-сайт**. Затем выберите **быстрое создание** параметр. Укажите URL-адрес доступен для нового веб-сайта и нажмите кнопку **создать веб-сайт**.

    > [!NOTE]
    > Веб-сайта Windows Azure является узлом для веб-приложение, работающее в облаке, вы можете управлять. Быстрое создание позволяет развернуть завершенное веб-приложения для Windows Azure веб-сайта из вне портала. Он не включает действия по настройке базы данных.

    ![Создание нового веб-сайта, с помощью быстрого создания](whats-new-in-aspnet-mvc-4/_static/image63.png "создания нового веб-сайта, с помощью быстрого создания")

    *Создание нового веб-сайта, с помощью быстрого создания*
4. Подождите, пока новый **веб-сайт** создается.
5. После создания веб-сайт, щелкните ссылку под **URL-адрес** столбца. Проверьте, что новый веб-сайт работает.

    ![Выбрав новый веб-сайт](whats-new-in-aspnet-mvc-4/_static/image64.png "просмотра на новый веб-сайт")

    *Выбрав новый веб-сайт*

    ![Веб-сайт работал](whats-new-in-aspnet-mvc-4/_static/image65.png "веб-узлом")

    *Веб-сайт под управлением*
6. Вернитесь на портал и щелкните имя веб-сайт в **имя** столбец для отображения страницы управления.

    ![Открытие страницы управления веб-сайт](whats-new-in-aspnet-mvc-4/_static/image66.png "Открытие страницы управления веб-сайта")

    *Открытие страницы управления веб-сайта*
7. В **панели мониторинга** раздела **быстрый обзор** щелкните **загрузить профиль публикации** ссылку.

    > [!NOTE]
    > *Профиль публикации* содержит все сведения, необходимые для публикации веб-приложения на веб-сайт Windows Azure для каждого разрешенного метода публикации. Профиль публикации содержит URL-адреса, учетные данные пользователя и строк базы данных, необходимых для подключения и проверку подлинности в каждой из конечных точек, для которых включена метода публикации. **Microsoft WebMatrix 2**, **Microsoft Visual Studio Express для Web** и **Microsoft Visual Studio 2012** поддерживают чтение профилей публикации для автоматизации настройки из этих программ для Публикация веб-приложений на веб-сайтах Windows Azure.

    ![Профиль публикации веб-сайт загрузки](whats-new-in-aspnet-mvc-4/_static/image67.png "профиль публикации веб-сайта загрузки")

    *Профиль публикации веб-сайта загрузки*
8. Скачайте файл профиля публикации в известном месте. Далее в этом упражнении показано, как использовать этот файл для публикации веб-приложения на веб-сайтах, Windows Azure из Visual Studio.

    ![Сохранение файла профиля публикации](whats-new-in-aspnet-mvc-4/_static/image68.png "Сохранение профиля публикации")

    *Сохранение файла профиля публикации*

<a id="ApxDTask2"></a>

<a id="Task_2_-_Configuring_the_Database_Server"></a>
#### <a name="task-2---configuring-the-database-server"></a>Задача 2 - Настройка сервера базы данных

Если приложение использует SQL Server, баз данных, необходимо будет создать сервер базы данных SQL. Эту задачу может пропустить, если вы хотите развернуть простое приложение, которое не использует SQL Server.

1. Вам потребуется сервер базы данных SQL для хранения базы данных приложения. Серверы баз данных SQL можно просмотреть в своей подписке на портале управления Windows Azure в **баз данных Sql** | **серверы** | **сервера Панель мониторинга**. Если у вас на сервер, созданный, можно создать его, используя **добавить** кнопки на панели команд. Запишите **имя сервера и URL-адрес, имя входа администратора и пароль**, как их использование в следующие задачи. Не создавайте базы данных, так как он будет создан в более позднем этапе.

    ![Панель мониторинга базы данных SQL Server](whats-new-in-aspnet-mvc-4/_static/image69.png "панель мониторинга базы данных SQL Server")

    *Панель мониторинга базы данных SQL Server*
2. В следующей задаче вы проверите подключения к базе данных из Visual Studio по этой причине необходимо включить IP-адрес локального сервера списка **разрешенные IP-адреса**. Чтобы сделать это, нажмите кнопку **Настройка**, выберите IP-адрес из **текущий IP-адрес клиента** и вставьте его на **начальный IP-адрес** и **конечный IP-адрес** текстовые поля и нажмите кнопку ![add-client-ip-address-ok-button](whats-new-in-aspnet-mvc-4/_static/image70.png) кнопки.

    ![Добавление IP-адрес клиента](whats-new-in-aspnet-mvc-4/_static/image71.png)

    *Добавление IP-адрес клиента*
3. Один раз **IP-адрес клиента** добавляется разрешенных IP-адресов выберите на **Сохранить** для подтверждения изменения.

    ![Подтверждение изменений](whats-new-in-aspnet-mvc-4/_static/image72.png)

    *Подтверждение изменений*

<a id="ApxDTask3"></a>

<a id="Task_3_-_Publishing_an_ASPNET_MVC_4_Application_using_Web_Deploy"></a>
#### <a name="task-3---publishing-an-aspnet-mvc-4-application-using-web-deploy"></a>Задача 3 - публикация приложения ASP.NET MVC 4 с помощью веб-развертывания

1. Вернитесь к решению для ASP.NET MVC 4. В **обозревателе решений**, щелкните правой кнопкой мыши проект веб-сайта и выберите **публикации**.

    ![Публикация приложения](whats-new-in-aspnet-mvc-4/_static/image73.png "публикации приложения")

    *Публикация веб-сайта*
2. Импортируйте профиль публикации, сохраненный в первой задаче.

    ![Импорт профиля публикации](whats-new-in-aspnet-mvc-4/_static/image74.png "Импорт профиля публикации")

    *Импорт профиля публикации*
3. Нажмите кнопку **Проверка подключения**. После завершения проверки нажмите кнопку **Далее**.

    > [!NOTE]
    > Проверка будет завершена, как только вы увидите зеленый флажок отображаться рядом с кнопкой проверить подключение.

    ![Проверка подключения](whats-new-in-aspnet-mvc-4/_static/image75.png "Проверка подключения")

    *Проверка подключения*
4. В **параметры** раздела **баз данных** нажмите кнопку рядом с текстовое поле подключения к базе данных (т. е. **DefaultConnection**).

    ![Конфигурация веб-развертывания](whats-new-in-aspnet-mvc-4/_static/image76.png "конфигурация веб-развертывания")

    *Конфигурация веб-развертывания*
5. Настройте подключение к базе данных следующим образом:

   - В **имя_сервера** введите URL-адреса серверу базы данных SQL с помощью *tcp:* префикс.
   - В **имя пользователя** введите имя входа администратора сервера.
   - В **пароль** введите пароль входа администратора сервера.
   - Введите новое имя базы данных, например: *MVC4SampleDB*.

     ![Настройка строки подключения назначения](whats-new-in-aspnet-mvc-4/_static/image77.png "Настройка строка соединения с назначением")

     *Настройка строки подключения назначения*
6. Затем нажмите кнопку **ОК**. При появлении запроса на создание базы данных нажмите кнопку **Да**.

    ![Создание базы данных](whats-new-in-aspnet-mvc-4/_static/image78.png "Создание строки базы данных")

    *Создание базы данных*
7. В текстовое поле подключение по умолчанию отображается строка подключения, который будет использоваться для подключения к базе данных SQL в Windows Azure. Затем нажмите кнопку **Далее**.

    ![Строка подключения, указывающий на базу данных SQL](whats-new-in-aspnet-mvc-4/_static/image79.png "строку подключения, указывающий на базу данных SQL")

    *Строка подключения, указывающий на базу данных SQL*
8. В **предварительной версии** щелкните **публикации**.

    ![Публикация веб-приложения](whats-new-in-aspnet-mvc-4/_static/image80.png "публикации веб-приложения")

    *Публикация веб-приложения*
9. После завершения процесса публикации в браузере по умолчанию откроется опубликованного веб-сайта.

    ![Приложение опубликовано в Windows Azure](whats-new-in-aspnet-mvc-4/_static/image81.png "публикации приложения в Windows Azure")

    *Приложение будет публиковаться в Windows Azure*
