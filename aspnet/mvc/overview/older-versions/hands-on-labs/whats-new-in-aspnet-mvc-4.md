---
uid: mvc/overview/older-versions/hands-on-labs/whats-new-in-aspnet-mvc-4
title: Новые возможности ASP.NET MVC 4 | Документация Майкрософт
author: rick-anderson
description: ASP.NET MVC 4 — это платформа для создания масштабируемых веб-приложений на основе стандартов, использующих хорошо установленные шаблоны разработки и мощь ASP.NET и...
ms.author: riande
ms.date: 02/18/2013
ms.assetid: 48f7feb3-872f-485d-b96f-e30011ff8c4a
msc.legacyurl: /mvc/overview/older-versions/hands-on-labs/whats-new-in-aspnet-mvc-4
msc.type: authoredcontent
ms.openlocfilehash: 4235f4fe666cdeb7d0821127a2b349f2ff30cd6e
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78433674"
---
# <a name="whats-new-in-aspnet-mvc-4"></a>Новые возможности ASP.NET MVC 4

по [веб-Camp командам](https://twitter.com/webcamps)

[Скачать обучающий комплект Web Camp](https://aka.ms/webcamps-training-kit)

ASP.NET MVC 4 — это платформа для создания масштабируемых веб-приложений на основе стандартов с помощью хорошо установленных шаблонов разработки и возможностей ASP.NET и .NET Framework. Эта новая, четвертая версия платформы посвящена упрощению разработки мобильных веб-приложений.

Чтобы начать с, при создании нового проекта ASP.NET MVC 4 теперь существует шаблон проекта мобильного приложения, который можно использовать для создания автономного приложения специально для мобильных устройств. Кроме того, ASP.NET MVC 4 интегрируется с jQuery Mobile через пакет NuGet jQuery. Mobile. MVC. jQuery Mobile — это платформа на основе HTML5 для разработки веб-приложений, совместимых со всеми популярными платформами мобильных устройств, включая Windows Phone, iPhone, Android и т. д. Однако если вам нужна специализация, ASP.NET MVC 4 также позволяет использовать различные представления для различных устройств и выполнять оптимизацию для конкретных устройств.

В этой практической лабораторной работе вы начнете с шаблона проекта ASP.NET MVC 4 &quot;Internet Application&quot;, чтобы создать приложение фотоальбома. Вы постепенно улучшите приложение, используя jQuery Mobile и ASP.NET MVC 4, чтобы обеспечить совместимость с различными мобильными устройствами и веб-браузерами настольных систем. Кроме того, вы узнаете о новых рецептах кода для создания кода и о том, как ASP.NET MVC 4 упрощает написание асинхронных методов действий с помощью поддержки задач&lt;ActionResult&gt; возвращаемых типов.

> [!NOTE]
> Все примеры кода и фрагментов включены в набор средств для обучения Web Camp, доступный в [выпусках Microsoft-Web/вебкамптраинингкит](https://aka.ms/webcamps-training-kit). Проект, относящийся к этой лабораторной работе, доступен в новых возможностях [Web Forms в ASP.NET 4,5](https://github.com/Microsoft-Web/HOL-ASPNETWebForms).

<a id="Objectives"></a>
### <a name="objectives"></a>Цели

В этой практической лабораторной работе вы узнаете, как выполнять следующие задачи:

- Воспользуйтесь преимуществами усовершенствований шаблонов проектов ASP.NET MVC, включая новый шаблон проекта мобильных приложений.
- Используйте атрибут окна просмотра HTML5 и запросы мультимедиа CSS, чтобы улучшить отображение на мобильных устройствах.
- Использование jQuery Mobile для последовательного улучшения и создания веб-интерфейса, оптимизированного для сенсорного управления
- Создание представлений для мобильных устройств
- Использование компонента "вид-переключатель" для переключения между мобильными и классическими представлениями в приложении
- Создание асинхронных контроллеров с помощью поддержки задач

<a id="Prerequisites"></a>

<a id="Prerequisites"></a>
### <a name="prerequisites"></a>предварительные требования

Для выполнения этой лабораторной работы необходимо иметь следующие элементы:

- [Microsoft Visual Studio Express 2012 для Web](https://www.microsoft.com/visualstudio/eng/products/visual-studio-express-for-web) или старше (см. [Приложение B](#AppendixB) для получения инструкций по его установке).
- [ASP.NET MVC 4](../../../mvc4.md) (входит в установку Microsoft Visual Studio 2012)
- Эмулятор Windows Phone (входит в состав [пакета SDK для Windows Phone 7.1.1](https://www.microsoft.com/download/details.aspx?id=29233))
- Необязательно- [WebMatrix 2](https://www.microsoft.com/web/webmatrix/) с расширением " **Электрический Плам iPhone Simulator** " (только для упражнений 3, используемых для просмотра веб-приложения с помощью имитатора iPhone)

<a id="Setup"></a>

<a id="Setup"></a>
### <a name="setup"></a>Настройка

На протяжении всего лабораторного документа вы получите инструкции по вставке блоков кода. Для удобства большая часть кода предоставляется в виде Visual Studio Code фрагментов, которые можно использовать в Visual Studio, чтобы не добавлять их вручную.

Чтобы установить фрагменты кода, выполните следующие действия.

1. Откройте окно проводника Windows и перейдите в папку **саурце\сетуп** лаборатории.
2. Дважды щелкните файл **Setup. cmd** в этой папке, чтобы установить фрагменты кода Visual Studio.

Если вы не знакомы с фрагментами кода Visual Studio Code и хотите узнать, как их использовать, см. приложение из этого документа &quot;[приложении а. Использование фрагментов кода](#AppendixA)&quot;.

<a id="Exercises"></a>

<a id="Exercises"></a>
## <a name="exercises"></a>Полнят

Эта практическая лабораторная работа включает в себя следующие упражнения:

1. [Новые шаблоны проектов ASP.NET MVC 4](#Exercise1)
2. [Создание веб-приложения фотоальбома](#Exercise2)
3. [Добавление поддержки мобильных устройств](#Exercise3)
4. [Использование асинхронных контроллеров](#Exercise4)

> [!NOTE]
> Каждое упражнение сопровождается **конечной** папкой, содержащей итоговое решение, которое следует получить после завершения упражнений. Это решение можно использовать в качестве инструкции, если вам нужна дополнительная помощь по работе с упражнениями.

Предполагаемое время выполнения этой лабораторной работы: **60 минут**.

<a id="Exercise1"></a>

<a id="Exercise_1_New_ASPNET_MVC_4_Project_Templates"></a>
### <a name="exercise-1-new-aspnet-mvc-4-project-templates"></a>Упражнение 1. новые шаблоны проектов ASP.NET MVC 4

В этом упражнении будут рассмотрены усовершенствования в шаблонах проектов ASP.NET MVC 4. В дополнение к шаблону Интернет-приложения, уже присутствующему в MVC 3, эта версия теперь включает отдельный шаблон для мобильных приложений. Во первых, мы рассмотрим некоторые важные функции каждого из шаблонов. Затем вы будете правильно работать с визуализацией страницы на разных платформах, используя правильный подход.

<a id="Task_1_-_Exploring_the_Internet_Application_Template"></a>
#### <a name="task-1---exploring-the-internet-application-template"></a>Задача 1. изучение шаблона Интернет-приложения

1. Откройте **Visual Studio**.
2. Выберите **файл | Создать |** Команда меню "проект". В диалоговом окне **Новый проект** выберите **визуальный C# элемент |** В дереве слева выберите веб-шаблон **ASP.NET MVC 4.** Назовите проект **фотогаллери**, выберите расположение (или оставьте значение по умолчанию) и нажмите кнопку **ОК**.

    > [!NOTE]
    > Позже вы настроите созданное вами решение Фотогаллери ASP.NET MVC 4.

    ![Создание нового проекта](whats-new-in-aspnet-mvc-4/_static/image1.png "Создание нового проекта")

    *Создание нового проекта*
3. В диалоговом окне **Новый проект ASP.NET MVC 4** выберите шаблон проекта **Интернет приложение** и нажмите кнопку **ОК**. Убедитесь, что в качестве обработчика представлений выбрано Razor.

    ![Создание нового Интернет-приложения ASP.NET MVC 4](whats-new-in-aspnet-mvc-4/_static/image2.png "Создание нового Интернет-приложения ASP.NET MVC 4")

    *Создание нового Интернет-приложения ASP.NET MVC 4*

    > [!NOTE]
    > Синтаксис Razor представлен в ASP.NET MVC 3. Его целью является сокращение количества символов и нажатий клавиш, необходимых в файле, что позволяет быстро и гибко создавать рабочие процессы кодирования. Razor использует существующие C# и VB-навыки (или другие) языковых навыков и предоставляет синтаксис разметки шаблона, который позволяет выполнять восходящий рабочий процесс создания HTML-кода.
4. Нажмите клавишу **F5** , чтобы запустить решение и просмотреть обновленные шаблоны. Вы можете узнать о следующих функциях:

    **Шаблоны современных стилей**

    Шаблоны были обновлены, предоставляя более современные стили.

    ![Шаблоны с ASP.NET MVC 4](whats-new-in-aspnet-mvc-4/_static/image3.png "Шаблоны с перестилями MVC 4")

    *Шаблоны с ASP.NET MVC 4*

    ![Новая страница контактов](whats-new-in-aspnet-mvc-4/_static/image4.png "Новая страница контактов")

    *Новая страница контактов*

    **Адаптивная визуализация**

    Изучите изменение размера окна браузера и обратите внимание, что макет страницы динамически адаптируется к новому размеру окна. Эти шаблоны используют метод адаптивной отрисовки для правильной отрисовки на настольных и мобильных платформах без каких бы то ни было настроек.

    ![Шаблон проекта ASP.NET MVC 4 в разных размерах браузера](whats-new-in-aspnet-mvc-4/_static/image5.png "Шаблон проекта ASP.NET MVC 4 в разных размерах браузера")

    *Шаблон проекта ASP.NET MVC 4 в разных размерах браузера*

    **Расширенный пользовательский интерфейс с JavaScript**

    Еще одним усовершенствованием шаблонов проектов по умолчанию является использование JavaScript для предоставления более интерактивного кода JavaScript. Ссылки для входа и регистрации, используемые в шаблоне, проиллюстрировать, как использовать проверки jQuery для проверки полей ввода со стороны клиента.

    ![Проверка jQuery](whats-new-in-aspnet-mvc-4/_static/image6.png)

    *Проверка jQuery*

    > [!NOTE]
    > Обратите внимание на два раздела вход в систему. в первом разделе вы можете войти с помощью зарегистрированной учетной записи с сайта, а во втором разделе можно войти, используя другую службу проверки подлинности, например Google (по умолчанию отключена).
5. Закройте браузер, чтобы завершить работу отладчика и вернуться в Visual Studio.
6. Откройте файл **AuthConfig.CS** , расположенный в папке **app\_Start** .
7. Удалите комментарий из последней строки, чтобы зарегистрировать клиент Google для проверки подлинности *OAuth* .

    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample1.cs)]

    > [!NOTE]
    > Обратите внимание, что вы можете легко включить проверку подлинности с помощью любой службы OpenID Connect или OAuth, например Facebook, Twitter, Microsoft и т. д.
8. Нажмите клавишу **F5** , чтобы запустить решение и переходить на страницу входа.
9. Выберите службу **Google** для входа.

    ![Выбор службы входа](whats-new-in-aspnet-mvc-4/_static/image7.png)

    *Выбор службы входа*
10. Войдите в систему, используя учетную запись Google.
11. Разрешить сайту (localhost) получать сведения из учетной записи Google.
12. Наконец, необходимо будет зарегистрироваться на сайте, чтобы связать учетную запись Google.

   ![Связывание учетной записи Google](whats-new-in-aspnet-mvc-4/_static/image8.png)

   *Связывание учетной записи Google*
13. Закройте браузер, чтобы завершить работу отладчика и вернуться в Visual Studio.
14. Теперь изучите решение, чтобы узнать о других новых возможностях, появившихся в шаблоне проекта ASP.NET MVC 4.

   ![Шаблон проекта Интернет приложения ASP.NET MVC 4](whats-new-in-aspnet-mvc-4/_static/image9.png "Шаблон проекта Интернет приложения ASP.NET MVC 4")

   *Шаблон проекта Интернет приложения ASP.NET MVC 4*

    - **Разметка HTML 5**

       Просмотрите представления шаблонов, чтобы узнать новую разметку темы.

       ![Новый шаблон с использованием разметки Razor и HTML5 для. cshtml.](whats-new-in-aspnet-mvc-4/_static/image10.png "Новый шаблон с использованием разметки Razor и HTML5 для. cshtml.")

       *Новый шаблон с использованием разметки Razor и HTML5 (About. cshtml).*
    - **Обновленные библиотеки JavaScript**

       Шаблон ASP.NET MVC 4 по умолчанию теперь включает KnockoutJS, платформу JavaScript MVVM, которая позволяет создавать многофункциональные и высокопроизводительные веб-приложения с помощью JavaScript и HTML. Как и в MVC3, библиотеки UI jQuery и jQuery также включены в ASP.NET MVC 4.

     > [!NOTE]
     > Дополнительные сведения о библиотеке KnockOutJS можно получить по этой ссылке: [[http://learn.knockoutjs.com/](http://learn.knockoutjs.com/)](http://learn.knockoutjs.com/). Кроме того, вы можете узнать о ИНТЕРФЕЙСе jQuery и jQuery в [[http://docs.jquery.com/](http://docs.jquery.com/)](http://docs.jquery.com/).

<a id="Task_2_-_Exploring_the_Mobile_Application_Template"></a>
#### <a name="task-2---exploring-the-mobile-application-template"></a>Задача 2. изучение шаблона мобильного приложения

ASP.NET MVC 4 упрощает разработку веб-сайтов для мобильных и планшетных браузеров. Этот шаблон имеет ту же структуру приложения, что и шаблон Интернет-приложения (Обратите внимание, что код контроллера практически идентичен), но его стиль был изменен для правильной отрисовки на мобильных устройствах с сенсорным доступом.

1. Выберите **файл | Создать |** Команда меню "проект". В диалоговом окне **Новый проект** выберите **визуальный C# элемент |** В дереве слева щелкните веб-шаблон и выберите **веб-приложение ASP.NET MVC 4.** Назовите проект **фотогаллери. Mobile**, выберите расположение (или оставьте значение по умолчанию), выберите &quot;добавить в решение&quot; и нажмите кнопку **ОК**.
2. В диалоговом окне **Новый проект ASP.NET MVC 4** выберите шаблон проекта **мобильного приложения** и нажмите кнопку **ОК**. Убедитесь, что в качестве обработчика представлений выбрано Razor.

    ![Создание нового мобильного приложения ASP.NET MVC 4](whats-new-in-aspnet-mvc-4/_static/image11.png "Создание нового мобильного приложения ASP.NET MVC 4")

    *Создание нового мобильного приложения ASP.NET MVC 4*
3. Теперь вы можете исследовать решение и ознакомиться с новыми функциями, представленными в шаблоне решения ASP.NET MVC 4 для мобильных устройств:

    - **Мобильная библиотека jQuery**

        Шаблон проекта мобильного приложения содержит мобильную библиотеку jQuery, которая является библиотекой с открытым исходным кодом для совместимости с браузером для мобильных устройств. jQuery Mobile применяет прогрессивное улучшение к мобильным браузерам, поддерживающим CSS и JavaScript. Прогрессивное улучшение позволяет всем браузерам отображать базовое содержимое веб-страницы, в то время как оно позволяет только самым мощным браузерам отображать форматированное содержимое. Файлы JavaScript и CSS, входящие в стиль jQuery Mobile, помогают мобильным браузерам вписать содержимое на экран без внесения каких-либо изменений в разметку страницы.

        ![jQuery-Mobile-Library — включается в шаблон](whats-new-in-aspnet-mvc-4/_static/image12.png)

        *Мобильная библиотека jQuery, входящая в шаблон*
    - **Разметка на основе HTML5**

        ![Мобильные приложения-шаблон — использование-HTML5-Markup](whats-new-in-aspnet-mvc-4/_static/image13.png)

        *Шаблон мобильного приложения с использованием разметки HTML5 (login. cshtml и index. cshtml)*
4. Чтобы запустить решение, нажмите клавишу **F5**.
5. Откройте **эмулятор Windows Phone 7**.
6. На начальном экране телефона откройте Internet Explorer. Просмотрите URL-адрес, по которому запускается приложение для настольных компьютеров, и перейдите по этому URL-адресу (например, `http://localhost:[PortNumber]/`).
7. Теперь вы можете ввести страницу входа или ознакомиться со страницей "о программе". Обратите внимание, что стиль веб-сайта основан на новом приложении Metro для мобильных устройств. Шаблон проекта ASP.NET MVC 4 правильно отображается на мобильных устройствах, обеспечивая отображение всех элементов страницы и их включение. Обратите внимание, что ссылки в заголовке достаточно велики для нажатия или касания.

    ![Страницы шаблонов проектов на мобильном устройстве](whats-new-in-aspnet-mvc-4/_static/image14.png "Страницы шаблонов проектов на мобильном устройстве")

    *Страницы шаблонов проектов на мобильном устройстве*
8. Новый шаблон также использует **тег META окна просмотра**. Большинство мобильных браузеров определяют ширину для виртуального окна браузера или &quot;окно просмотра&quot;, которое больше, чем фактическая ширина мобильного устройства. Это позволяет браузерам мобильных устройств отображать всю веб-страницу внутри виртуального экрана. **Тег META окна просмотра** позволяет веб-разработчикам задавать ширину, высоту и масштаб области браузера на мобильных устройствах **.** Шаблон ASP.NET MVC 4 для мобильных приложений задает для окна просмотра ширину устройства (&quot;Width =&quot;ширины устройства) в шаблоне макета (*Views\Shared\_Layout. cshtml*), чтобы для всех страниц в окне просмотра были заданы значения ширины экрана устройства. Обратите внимание, что тег META окна просмотра не изменит представление браузера по умолчанию.
9. Откройте **\_Layout. cshtml**, расположенный в **представлениях | Общая** папка и закомментируйте тег meta в окне просмотра. Запустите приложение, если оно еще не открыто, и ознакомьтесь с различиями.

[!code-cshtml[Main](whats-new-in-aspnet-mvc-4/samples/sample2.cshtml)]

![Сайт после добавления комментария к мета-тегу окна просмотра](whats-new-in-aspnet-mvc-4/_static/image15.png "Сайт после добавления комментария к мета-тегу окна просмотра")

*Сайт после добавления комментария к мета-тегу окна просмотра*
10. В Visual Studio нажмите клавиши **SHIFT** + **F5** , чтобы отключить отладку приложения.
11. Раскомментируйте тег META окна просмотра.

[!code-cshtml[Main](whats-new-in-aspnet-mvc-4/samples/sample3.cshtml)]

<a id="Task_3_-_Using_Adaptive_Rendering"></a>
#### <a name="task-3---using-adaptive-rendering"></a>Задача 3. Использование адаптивной визуализации

В этой задаче вы узнаете о другом методе отображения веб-страницы на мобильных устройствах и веб-браузерах в то же время без настройки. Вы уже использовали мета-тег окна просмотра с аналогичным намерением. Теперь вы будете отвечать другим мощным методам: *адаптивной отрисовке*.

Адаптивная визуализация — это метод, который использует **CSS3-запросы к носителю** для настройки стиля, применяемого к странице. Запросы к носителю определяют условия внутри таблицы стилей, группируя стили CSS при определенном условии. Стиль применяется к объявленным объектам только в том случае, если условие истинно.

Гибкость, обеспечиваемая методом адаптивной визуализации, позволяет настраивать отображение сайта на различных устройствах. Можно определить столько стилей, сколько нужно, для одной таблицы стилей без написания кода логики для выбора стиля. Таким образом, это очень аккуратный способ адаптации стилей страниц, так как он сокращает объем повторяющегося кода и логику для целей визуализации. С другой стороны, использование пропускной способности увеличится, так как размер файлов CSS может увеличиваться в ширину.

При использовании адаптивного метода рендеринга сайт будет **отображаться правильно независимо от браузера.** Однако следует учесть, что при дополнительной нагрузке пропускная способность будет очень важна.

> [!NOTE]
> Базовый формат запроса мультимедиа: @media область \[: все | КПК | Печать | проекция |\] экрана ([свойство: значение] и... [свойство: значение])

Примеры запросов к мультимедиа: &gt; **@media все и (max-width: 1000px) и (min-Width: 700px) {}:** для всех разрешений между 700px и 1000px.

> **@media экран и (min-Width: 400 пикс) и (max-width: 700px) {...}:** Только для экранов. Разрешение должно находиться в диапазоне от 400 до 700px.
> 
> **@media КПК и (min-Width: 20em), Screen и (min-Width: 20em) {...}:** Для карманных компьютеров и устройств и экранов. Минимальная ширина должна быть больше 20em.
> 
> Дополнительные сведения об этом можно найти на [сайте W3C](http://www.w3.org/TR/css3-mediaqueries/).

Теперь вы узнаете, как работает адаптивная визуализация, что повышает удобочитаемость шаблона веб-сайта ASP.NET MVC 4 по умолчанию.

1. Откройте решение **фотогаллери. sln** , созданное в задаче 1, и выберите проект **фотогаллери** . Чтобы запустить решение, нажмите клавишу **F5**.
2. Измените ширину браузера, установив для Windows половину или меньше квартала исходного размера. Обратите внимание, что происходит с элементами в заголовке: некоторые элементы не будут отображаться в видимой области заголовка.
3. Откройте файл **site. CSS** из обозревателя решений Visual Studio, расположенного в папке проекта **содержимого** . Нажмите клавиши **CTRL + F** , чтобы открыть интегрированный поиск Visual Studio, и запишите `@media`, чтобы найти **запрос мультимедиа CSS**.

    Условие запроса носителя, определенное в этом шаблоне, работает таким образом: когда размер окна браузера составляет менее **850**пикселей, применяются правила CSS, определенные внутри этого блока мультимедиа.

    ![Поиск запроса мультимедиа](whats-new-in-aspnet-mvc-4/_static/image16.png "Поиск запроса мультимедиа")

    *Поиск запроса мультимедиа*
4. Замените значение атрибута max-width, заданное в 850 px на **10px**, чтобы отключить адаптивную визуализацию, и нажмите клавиши **CTRL + S** , чтобы сохранить изменения. Вернитесь в браузер и нажмите клавиши **CTRL + F5** , чтобы обновить страницу с учетом внесенных изменений. Обратите внимание на различия в обеих страницах при настройке ширины окна.

    ![Слева страница применяет стиль @media, справа, стиль опускается.](whats-new-in-aspnet-mvc-4/_static/image17.png "Слева страница применяет стиль @media, справа, стиль опускается.")

    *Слева страница применяет стиль @media, справа, стиль опускается.*

    Теперь давайте проверим, что происходит на мобильных устройствах:

    ![Слева страница применяет стиль @media, справа, стиль опускается.](whats-new-in-aspnet-mvc-4/_static/image18.png "Слева страница применяет стиль @media, справа, стиль опускается.")

    *Слева страница применяет стиль @media, справа, стиль опускается.*

    Хотя вы заметите, что изменения, отображаемые при просмотре страницы в веб-браузере, не очень важны, при использовании мобильных устройств различия становятся более очевидными. В левой части изображения видно, что пользовательский стиль улучшил удобочитаемость.

    Адаптивная визуализация может использоваться во многих других сценариях, что упрощает применение условного стиля к веб-узлу и решение распространенных проблем стиля с помощью аккуратного подхода.

    Теги META окна просмотра и запросы мультимедиа CSS не относятся к ASP.NET MVC 4, поэтому вы можете воспользоваться преимуществами этих функций в любом веб-приложении.
5. В Visual Studio нажмите клавиши **SHIFT** + **F5** , чтобы отключить отладку приложения.

<a id="Exercise2"></a>

<a id="Exercise_2_Creating_the_Photo_Gallery_Web_Application"></a>
### <a name="exercise-2-creating-the-photo-gallery-web-application"></a>Упражнение 2. Создание веб-приложения фотоальбома

В этом упражнении вы будете работать с приложением фотоальбома для показа фотографий. Вы начнете с шаблона проекта ASP.NET MVC 4, а затем добавите компонент для получения фотографий из службы и отобразите их на домашней странице.

В следующем упражнении вы обновите это решение, чтобы улучшить способ его отображения на мобильных устройствах.

<a id="Task_1_-_Creating_a_Mock_Photo_Service"></a>
#### <a name="task-1---creating-a-mock-photo-service"></a>Задача 1. Создание макетной службы фотографий

В этой задаче будет создан макет службы Photo для получения содержимого, которое будет отображаться в коллекции. Для этого необходимо добавить новый контроллер, который будет просто возвращать JSON-файл с данными каждой фотографии.

1. Откройте **Visual Studio** , если он еще не открыт.
2. Выберите **файл | Создать |** Команда меню "проект". В диалоговом окне **Новый проект** выберите **визуальный C# элемент |** В дереве слева выберите веб-шаблон **ASP.NET MVC 4.** Назовите проект **фотогаллери**, выберите расположение (или оставьте значение по умолчанию) и нажмите кнопку **ОК**. Кроме того, вы можете продолжить работу из существующего решения Интернет – **приложения** ASP.NET MVC 4 из **упражнения 1** и пропустить следующий шаг.
3. В диалоговом окне **Новый проект ASP.NET MVC 4** выберите шаблон проекта **Интернет приложение** и нажмите кнопку **ОК**. Убедитесь, что в качестве обработчика представлений выбрано значение Razor.
4. В **Обозреватель решений**щелкните правой кнопкой мыши папку **данных приложения\_** проекта и выберите **Добавить | Существующий элемент**. Перейдите к папке **саурце\ассетс\апп\_Data** этой лабораторной работы и добавьте файл **Photos. JSON** .
5. Создайте новый контроллер с именем " **фотоконтроллер**". Для этого щелкните правой кнопкой мыши папку **Controllers** , выберите **Добавить** и щелкните **контроллер.** Завершите имя контроллера, оставьте шаблон **пустого контроллера MVC** и нажмите кнопку **Добавить**.

    ![Добавление фотоконтроллеров](whats-new-in-aspnet-mvc-4/_static/image19.png "Добавление фотоконтроллеров")

    *Добавление фотоконтроллеров*
6. Замените метод **index** следующим действием **коллекции** и верните содержимое из файла JSON, который вы недавно добавили в проект.

    (Фрагмент кода — *действие из коллекции ASP.NET MVC 4 Lab-Ex02-Gallery*)

    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample4.cs)]
7. Нажмите клавишу **F5** , чтобы запустить решение, а затем перейдите по следующему URL-адресу, чтобы протестировать службу имитации фотографий: `http://localhost:[port]/photo/gallery` (значение [порт] зависит от текущего порта, в котором было запущено приложение). Запрос к этому URL-адресу должен получить содержимое файла **Photos. JSON** .

    ![Тестирование службы макетирования фотографий](whats-new-in-aspnet-mvc-4/_static/image20.png "Тестирование службы макетирования фотографий")

    *Тестирование службы макетирования фотографий*

В реальной реализации можно использовать [веб-API ASP.NET](../../../../web-api/index.md) для реализации службы фотоальбома. Веб-API ASP.NET — это платформа, которая позволяет легко создавать HTTP-службы для широкого диапазона клиентов, включая браузеры и мобильные устройства. ASP.NET Web API - это идеальная платформа для сборки REST-приложений на базе .NET Framework.

<a id="Task_2_-_Displaying_the_Photo_Gallery"></a>
#### <a name="task-2---displaying-the-photo-gallery"></a>Задача 2. Отображение коллекции фотографий

В этой задаче будет обновлена Домашняя страница для отображения коллекции фотографий с помощью макетной службы, созданной в первой задаче этого упражнения. Вы добавите файлы модели и обновите представления галереи.

1. В Visual Studio нажмите клавиши **SHIFT** + **F5** , чтобы отключить отладку приложения.
2. Создайте класс **Photo** в папке **Models** . Для этого щелкните правой кнопкой мыши папку **модели** , выберите **Добавить** и щелкните **класс**. Затем задайте имя **Photo.CS** и нажмите кнопку **Добавить**.
3. Добавьте следующие члены в класс **Photo** .

    (Фрагмент кода — *ASP.NET MVC 4 Lab-Ex02-Photo Model*)

    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample5.cs)]
4. Откройте файл **HomeController.cs** в папке **Controllers**.
5. Добавьте следующие инструкции using.

    (Фрагмент кода — *ASP.NET MVC 4 Lab-Ex02-HomeController Usings*)

    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample6.cs)]
6. Обновите действие **индекса** , чтобы использовать **HttpClient** для получения данных коллекции, а затем используйте **JavaScriptSerializer** для десериализации в модель представления.

    (Фрагмент кода — *действие ASP.NET MVC 4 Lab-Ex02-index*)

    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample7.cs)]
7. Откройте файл **index. cshtml** , расположенный в папке **Views\Home** , и замените все содержимое следующим кодом.

    Этот код просматривает все фотографии, полученные из службы, и отображает их в неупорядоченном списке.

    (Фрагмент кода — *ASP.NET MVC 4 Lab-Ex02-Photo List*)

    [!code-cshtml[Main](whats-new-in-aspnet-mvc-4/samples/sample8.cshtml)]
8. В **Обозреватель решений**щелкните правой кнопкой мыши папку **содержимого** проекта и выберите команду **Добавить | Существующий элемент**. Перейдите в папку **саурце\ассетс\контент** этой лабораторной работы и добавьте файл **site. CSS** . Вам потребуется подтвердить его замену. Если файл **site. CSS** открыт, необходимо подтвердить, что файл также будет перезагружен.
9. Откройте проводник и скопируйте всю папку **Photos** , расположенную в папке **саурце\ассетс** этой лабораторной работы, в корневую папку проекта в Обозреватель решений.
10. Запустите приложение. Теперь должна отобразиться домашняя страница, отображающая фотографии в коллекции.

    ![Фотоальбом](whats-new-in-aspnet-mvc-4/_static/image21.png "Фотоальбом")

    *Фотоальбом*
11. В Visual Studio нажмите клавиши **SHIFT** + **F5** , чтобы отключить отладку приложения.

<a id="Exercise3"></a>

<a id="Exercise_3_Adding_support_for_mobile_devices"></a>
### <a name="exercise-3-adding-support-for-mobile-devices"></a>Упражнение 3. Добавление поддержки мобильных устройств

Одним из основных обновлений в ASP.NET MVC 4 является поддержка разработки мобильных приложений. В этом упражнении вы изучите ASP.NET MVC 4 новые функции для мобильных приложений, расширив решение Фотогаллери, созданное в предыдущем упражнении.

<a id="Task_1_-_Installing_jQuery_Mobile_in_an_ASPNET_MVC_4_Application"></a>
#### <a name="task-1---installing-jquery-mobile-in-an-aspnet-mvc-4-application"></a>Задача 1. Установка jQuery Mobile в приложении ASP.NET MVC 4

1. Откройте **Начальное** решение, расположенное по адресу **Source/EX3-мобилесуппорт/Begin/** Folder. В противном случае вы можете продолжать **использовать решение, полученное в результате** выполнения предыдущего упражнения.

   1. Если вы открыли предоставленное **Начальное** решение, перед продолжением потребуется загрузить некоторые недостающие пакеты NuGet. Для этого в меню **проект** выберите пункт **Управление пакетами NuGet**.
   2. В диалоговом окне **Управление пакетами NuGet** нажмите кнопку **восстановить** , чтобы скачать недостающие пакеты.
   3. Наконец, создайте решение, щелкнув **build** | **Build Solution**.

      > [!NOTE]
      > Одним из преимуществ использования NuGet является то, что вам не нужно поставлять все библиотеки в проекте, уменьшая размер проекта. С помощью средств управления питанием NuGet, указав версии пакетов в файле Packages. config, вы сможете скачать все необходимые библиотеки при первом запуске проекта. Именно поэтому после открытия существующего решения из этой лабораторной работы потребуется выполнить следующие действия.
2. Откройте **консоль диспетчера пакетов** , выбрав **Сервис** > **Диспетчер пакетов NuGet** > пункт меню **консоли диспетчера пакетов** .

    ![Открытие консоли диспетчера пакетов NuGet](whats-new-in-aspnet-mvc-4/_static/image22.png "Открытие консоли диспетчера пакетов NuGet")

    *Открытие консоли диспетчера пакетов NuGet*
3. В консоли диспетчера пакетов выполните следующую команду, чтобы установить пакет **jQuery. Mobile. MVC** .

    jQuery Mobile — это библиотека с открытым исходным кодом для создания веб-интерфейса, оптимизированного для сенсорного ввода. Пакет NuGet jQuery. Mobile. MVC содержит вспомогательные методы для использования jQuery Mobile с приложением ASP.NET MVC 4.

    > [!NOTE]
    > Выполнив следующую команду, вы будете скачивать библиотеку jQuery. Mobile. MVC из NuGet.

    PM

    [!code-powershell[Main](whats-new-in-aspnet-mvc-4/samples/sample9.ps1)]

    Эта команда устанавливает jQuery Mobile и некоторые вспомогательные файлы, включая следующие:

    - **Views/Shared/\_Layout. Mobile. cshtml**: — это макет на основе мобильного устройства jQuery, оптимизированный для небольших экранов. Когда веб-сайт получает запрос от браузера мобильного устройства, он заменит исходный макет (\_Layout. cshtml) на этот.
    - Компонент-переключатель представления: состоит из частичного представления views **/Shared/\_виевсвитчер. cshtml** и контроллера **ViewSwitcherController.CS** . Этот компонент покажет ссылку на мобильные браузеры, чтобы пользователи могли переключиться на настольную версию страницы.  
        ![Проект коллекции фотографий с поддержкой мобильных устройств](whats-new-in-aspnet-mvc-4/_static/image23.png "Проект коллекции фотографий с поддержкой мобильных устройств")

        *Проект коллекции фотографий с поддержкой мобильных устройств*
4. Зарегистрируйте мобильные пакеты. Для этого откройте файл **Global.asax.CS** и добавьте следующую строку.

    (Фрагмент кода — *ASP.NET MVC 4 Lab-Ex03 — регистрация мобильных пакетов*)

    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample10.cs)]
5. Запустите приложение с помощью веб-браузера для настольных систем.
6. Откройте **эмулятор Windows Phone 7,** расположенный в меню " **Пуск" | Все программы | Пакет SDK для Windows Phone 7,1 | Эмулятор Windows Phone.**
7. На начальном экране телефона откройте Internet Explorer. Извлеките URL-адрес, по которому запускается приложение, и перейдите к этому URL-адресу в браузере телефона (например, `http://localhost:[PortNumber]/`).

    Вы заметите, что приложение будет выглядеть иначе в эмуляторе Windows Phone, так как jQuery. Mobile. MVC создал в проекте новые ресурсы, отображающие представления, оптимизированные для мобильных устройств.

    Обратите внимание на сообщение в верхней части телефона, в котором отображается ссылка, которая переключается на представление рабочего стола. Кроме того, макет **\_Layout. Mobile. cshtml** , созданный установленным пакетом, включает в себя другой макет приложения.

    > [!NOTE]
    > Пока нет ссылки для возврата в представление для мобильных устройств. Она будет включена в более поздние версии.

    ![Мобильное представление домашней страницы коллекции фотографий](whats-new-in-aspnet-mvc-4/_static/image24.png "Мобильное представление домашней страницы коллекции фотографий")

    *Мобильное представление домашней страницы коллекции фотографий*
8. В Visual Studio нажмите клавиши **SHIFT** + **F5** , чтобы отключить отладку приложения.

<a id="Task_2_-_Creating_Mobile_Views"></a>
#### <a name="task-2---creating-mobile-views"></a>Задача 2. Создание мобильных представлений

В этой задаче вы создадите мобильную версию представления индекса с адаптированным содержимым для улучшения внешнего вида мобильных устройств.

1. Скопируйте представление **Views\Home\Index.cshtml** и вставьте его, чтобы создать копию, и переименуйте новый файл в **index. Mobile. cshtml**.
2. Откройте новое представление Create **index. Mobile. cshtml** и замените существующий тег &lt;UL&gt; этим кодом. После этого вы обновите тег &lt;UL&gt; с заметками данных jQuery Mobile для использования мобильных тем из jQuery.

    [!code-html[Main](whats-new-in-aspnet-mvc-4/samples/sample11.html)]

    > [!NOTE] 
    > 
    > Обратите внимание на указанные ниже моменты.
    > 
    > - Атрибут **роли данных** , установленный в **ListView** , будет отображать список с помощью стилей ListView.
    > 
    > - Для атрибута **Data-** Margin, установленного в значение true, отобразится список со скругленной границей и полем.
    > 
    > - Атрибут **Data-Filter** , установленный в **значение true** , создаст поле поиска.
    > 
    > Дополнительные сведения о соглашениях для мобильных устройств jQuery см. в документации по проекту: [ [http://jquerymobile.com/demos/1.1.1/](http://jquerymobile.com/demos/1.1.1/)](http://jquerymobile.com/demos/1.1.1/)
3. Нажмите клавиши **CTRL + S** , чтобы сохранить изменения.
4. Переключитесь на **эмулятор Windows Phone** и обновите сайт. Обратите внимание на новый вид списка коллекции, а также на новое поле поиска, расположенное в верхней части страницы. Затем введите слово в поле поиска (например, **Tulips**), чтобы начать поиск в коллекции фотографий.

    ![Галерея с использованием стиля ListView с фильтрацией](whats-new-in-aspnet-mvc-4/_static/image25.png "Галерея с использованием стиля ListView с фильтрацией")

    *Галерея с использованием стиля ListView с фильтрацией*

    Для суммирования вы использовали инструкцию View для мобильных устройств, чтобы создать копию представления индекса с помощью &quot;мобильного&quot; суффикса. Этот суффикс означает ASP.NET MVC 4, что каждый запрос, созданный на мобильном устройстве, будет использовать эту копию индекса. Кроме того, вы обновили мобильную версию представления индекса, чтобы использовать jQuery Mobile для улучшения внешнего вида и поведения веб-узла на мобильных устройствах.
5. Вернитесь в Visual Studio и откройте **сайт. Mobile. CSS** , расположенный в папке **Content** .
6. Исправьте положение названия фотографии, чтобы оно отображалось в правой части изображения. Для этого добавьте следующий код в файл **site. Mobile. CSS** .

    CSS

    [!code-css[Main](whats-new-in-aspnet-mvc-4/samples/sample12.css)]
7. Нажмите клавиши **CTRL + S** , чтобы сохранить изменения.
8. Вернитесь в **эмулятор Windows Phone** и обновите сайт. Обратите внимание, что теперь название фотографии правильно позиционировано.

    ![Заголовок расположен справа от изображения](whats-new-in-aspnet-mvc-4/_static/image26.png "Заголовок расположен справа от изображения")

    *Заголовок расположен справа от изображения*

<a id="Task_3_-_jQuery_Mobile_Themes"></a>
#### <a name="task-3---jquery-mobile-themes"></a>Задача 3. темы для мобильных устройств jQuery

Каждый макет и мини-приложение в jQuery Mobile разработано на основе новой объектно-ориентированной платформы CSS, позволяющей применять полную унифицированную тему визуального проектирования к сайтам и приложениям.

Тема jQuery Mobile по умолчанию включает 5 образцов, которые задают буквы (a, b, c, d, e) для краткого справочника.

В этой задаче вы обновите макет мобильного устройства, чтобы использовать другую тему по умолчанию.

1. Вернитесь в Visual Studio.
2. Откройте файл **\_Layout. Mobile. cshtml** , расположенный в **Views\Shared**.
3. Найдите элемент div с установленной ролью данных &quot;страницей&quot; и обновите **тему данных** до &quot;**e**&quot;.

    [!code-html[Main](whats-new-in-aspnet-mvc-4/samples/sample13.html)]
4. Нажмите клавиши **CTRL + S** , чтобы сохранить изменения.
5. Обновите сайт в **эмуляторе Windows Phone** и обратите внимание на новую схему цветов.

    ![Макет для мобильных устройств с другой цветовой схемой](whats-new-in-aspnet-mvc-4/_static/image27.png "Макет для мобильных устройств с другой цветовой схемой")

    *Макет для мобильных устройств с другой цветовой схемой*

<a id="Task_4_-_Using_the_View-Switcher_Component_and_the_Browser_Overriding_Features"></a>
#### <a name="task-4---using-the-view-switcher-component-and-the-browser-overriding-features"></a>Задача 4. Использование компонента "Просмотр-переключатель" и Переопределение функций браузера

В качестве соглашения для веб-страниц, оптимизированных для мобильных устройств, можно добавить ссылку, текст которой похож на вид рабочего стола или полного режима сайта, позволяющий пользователям переключаться на настольную версию страницы. Пакет jQuery. Mobile. MVC содержит пример компонента **переключения представлений** для этой цели, который используется в представлении **\_Layout. Mobile. cshtml** .

![Ссылка для переключения в представление рабочего стола](whats-new-in-aspnet-mvc-4/_static/image28.png "Ссылка для переключения в представление рабочего стола")

*Ссылка для переключения в представление рабочего стола*

Переключатель представлений использует новую функцию, называемую **переопределением браузера**. Эта функция позволяет приложению обрабатывать запросы так, как будто они поступают из другого браузера (агента пользователя), отличного от того, от которого они действительно поступают.

В этой задаче будет рассмотрен пример реализации переключателя представления, добавленного в jQuery. Mobile. MVC, а также новые функции переопределения браузера в ASP.NET MVC 4.

1. Вернитесь в Visual Studio.
2. Откройте представление **\_Layout. Mobile. cshtml** , расположенное в папке **Views\Shared** , и обратите внимание на компонент-переключатель View, на который указывает ссылка как на частичное представление.

    ![Мобильный макет с помощью компонента "Просмотр-переключатель"](whats-new-in-aspnet-mvc-4/_static/image29.png "Мобильный макет с помощью компонента "Просмотр-переключатель"")

    *Мобильный макет с помощью компонента "Просмотр-переключатель"*
3. Откройте частичное представление **\_виевсвитчер. cshtml** .

    В частичном представлении используется новый метод **виевконтекст. HttpContext. жетоверридденбровсер ()** для определения источника веб-запроса и отображения соответствующей ссылки для переключения на настольные или мобильные представления.

    Метод **жетоверридденбровсер** возвращает экземпляр **хттпбровсеркапабилитиесбасе** , соответствующий агенту пользователя, заданному в настоящий момент для запроса (фактический или переопределенный). Это значение можно использовать для получения таких свойств, как **исмобиледевице**.

    ![Частичное представление Виевсвитчер](whats-new-in-aspnet-mvc-4/_static/image30.png "Частичное представление Виевсвитчер")

    *Частичное представление Виевсвитчер*
4. Откройте класс **ViewSwitcherController.CS** , расположенный в папке **Controllers** . Ознакомьтесь с тем, что действие SwitchView вызывается ссылкой в компоненте Виевсвитчер, и обратите внимание на новые методы HttpContext.

    - Метод **HttpContext. клеароверридденбровсер ()** удаляет все переопределенные агенты пользователя для текущего запроса.
    - Метод **HttpContext. сетоверридденбровсер ()** переопределяет фактическое значение агента пользователя запроса с помощью указанного агента пользователя.  
        ![Контроллер Виевсвитчер](whats-new-in-aspnet-mvc-4/_static/image31.png "Контроллер Виевсвитчер")  
*Контроллер Виевсвитчер*

        Переопределение обозревателя является основной функцией ASP.NET MVC 4, которая также доступна даже в том случае, если не установлен пакет jQuery. Mobile. MVC. Однако эта функция влияет только на представление, макет и частичное представление и не влияет на функции, зависящие от объекта Request. browser.

<a id="Task_5_-_Adding_the_View-Switcher_in_the_Desktop_View"></a>
#### <a name="task-5---adding-the-view-switcher-in-the-desktop-view"></a>Задача 5. Добавление переключателя "Просмотр" в представлении "Рабочий стол"

В этой задаче вы обновите макет рабочего стола, чтобы включить переключатель "Просмотр". Это позволит мобильным пользователям вернуться к мобильному представлению при просмотре представления рабочего стола.

1. Обновите сайт в **эмуляторе Windows Phone**.
2. Щелкните ссылку **представление рабочего стола** в верхней части коллекции. Обратите внимание, что в представлении рабочего стола нет переключателя просмотра, позволяющего вернуться к представлению для мобильных устройств.
3. Вернитесь в Visual Studio и откройте представление **\_Layout. cshtml** .
4. Найдите раздел Login (вход) и вставьте вызов для визуализации **\_виевсвитчер** частичного представления под **\_** частичным представлением логонпартиал. Затем нажмите клавиши **CTRL + S** , чтобы сохранить изменения.

    [!code-cshtml[Main](whats-new-in-aspnet-mvc-4/samples/sample14.cshtml)]
5. Нажмите клавиши **CTRL + S** , чтобы сохранить изменения.
6. Обновите страницу в эмуляторе Windows Phone и дважды щелкните экран, чтобы увеличить масштаб. Обратите внимание, что на домашней странице теперь отображается ссылка на **представление мобильного** устройства, которая переключается из режима "Мобильный to Desktop".

    ![Просмотр переключателя в представлении рабочего стола](whats-new-in-aspnet-mvc-4/_static/image32.png "Просмотр переключателя в представлении рабочего стола")

    *Просмотр переключателя в представлении рабочего стола*
7. Снова перейдите к представлению мобильного устройства и перейдите к странице **About** (http://localhost[порт]/Хоме/абаут). Обратите внимание, что, даже если вы еще не создали представление About. Mobile. cshtml, страница about отображается с использованием макета для мобильных устройств (\_Layout. Mobile. cshtml).

    ![Сведения о странице](whats-new-in-aspnet-mvc-4/_static/image33.png "Страница About")

    *Сведения о странице*
8. Наконец, откройте сайт в классическом веб-браузере. Обратите внимание, что ни одно из предыдущих обновлений не влияло на представление "Рабочий стол".

    ![Представление рабочего стола Фотогаллери](whats-new-in-aspnet-mvc-4/_static/image34.png "Представление рабочего стола Фотогаллери")

    *Представление рабочего стола Фотогаллери*

<a id="Task_6_-_Creating_New_Display_Modes"></a>
#### <a name="task-6---creating-new-display-modes"></a>Задача 6. Создание новых режимов экрана

Новая функция режима отображения позволяет приложению выбирать представления в зависимости от браузера, создающего запрос. Например, если браузер настольных систем запрашивает домашнюю страницу, приложение вернет шаблон **Views\Home\Index.cshtml** . Затем, если браузер мобильного устройства запрашивает домашнюю страницу, приложение вернет шаблон **виевс\хоме\индекс.Мобиле.кштмл** .

В этой задаче вы создадите настраиваемый макет для устройств iPhone, и вам придется имитировать запросы с устройств iPhone. Для этого можно использовать эмулятор или симулятор iPhone (например, " [Электрический мобильный симулятор](http://www.electricplum.com/)") или браузер с дополнительными компонентами, которые изменяют агент пользователя. Инструкции по настройке строки агента пользователя в браузере Safari для эмуляции iPhone см. в статье [как разрешить Safari пример IE](http://www.davidalison.com/2008/05/how-to-let-safari-pretend-its-ie.html) в блоге Дэвид Алисон.

**Обратите внимание, что эта задача является необязательной, и вы можете продолжать работу в лаборатории, не выполняя ее.**

1. В Visual Studio нажмите клавиши **SHIFT** + **F5** , чтобы отключить отладку приложения.
2. Откройте **Global.asax.CS** и добавьте следующую инструкцию using.

    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample15.cs)]
3. Добавьте следующий выделенный код в метод\_запуска приложения.

    (Фрагмент кода — *ASP.NET MVC 4 Lab-Ex03-iPhone DisplayMode*)

    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample16.cs)]

Вы зарегистрировали новый **дефаултдисплаймоде с именем &quot;iPhone&quot;** в статическом списке **дисплаймодепровидер. instance. modes** , который будет сопоставляться с каждым входящим запросом. Если входящий запрос содержит строку &quot;iPhone&quot;, ASP.NET MVC найдет представления, имя которых содержит суффикс &quot;iPhone&quot;. Параметр 0 показывает, как задается новый режим. Например, это представление является более конкретным, чем общее правило &quot;. Mobile&quot;, которое соответствует запросам от мобильных устройств.

После выполнения этого кода, когда браузер iPhone создает запрос, приложение будет использовать макет **Views\Shared\\_layout. iPhone. cshtml** , который будет создан в следующих шагах.

> [!NOTE]
> Такой способ тестирования запроса для iPhone был упрощен для демонстрационных целей и может не работать должным образом для каждой строки агента пользователя iPhone (например, проверка с учетом регистра).

4. Создайте копию файла **\_Layout. Mobile. cshtml** в папке **Views\Shared** и переименуйте копию в &quot; **\_Layout. iPhone. cshtml**&quot;.
5. Откройте **\_Layout. iPhone. cshtml** , созданный на предыдущем шаге.
6. Найдите элемент div с атрибутом Data-Role, установленным на **странице** , и измените атрибут **темы данных** **, чтобы &quot;&quot;** .

[!code-cshtml[Main](whats-new-in-aspnet-mvc-4/samples/sample17.cshtml)]

Теперь у вас есть 3 макета в приложении ASP.NET MVC 4:

1. **\_Layout. cshtml**: макет по умолчанию, используемый для браузеров настольных систем.
2. **\_Layout. Mobile. cshtml**: макет по умолчанию, используемый для мобильных устройств.
3. **\_Layout. iPhone. cshtml**: конкретный макет для устройств iPhone, использующий другую цветовую схему для отличия от \_Layout. Mobile. cshtml.
7. Нажмите клавишу **F5** , чтобы запустить приложение и просмотреть сайт в **эмуляторе Windows Phone**.
8. Откройте **симулятор iPhone** (см. [Приложение C](#AppendixC) для получения инструкций по установке и настройке симулятора iPhone) и перейдите на сайт. Обратите внимание, что каждый телефон использует конкретный шаблон.

    ![Использование различных представлений-for-each-для Mobile-device2](whats-new-in-aspnet-mvc-4/_static/image35.png)

    *Использование различных представлений для каждого мобильного устройства*

<a id="Exercise4"></a>

<a id="Exercise_4_Using_Asynchronous_Controllers"></a>
### <a name="exercise-4-using-asynchronous-controllers"></a>Упражнение 4. Использование асинхронных контроллеров

Microsoft .NET Framework 4,5 вводит новые функции языка в C# и Visual Basic, чтобы предоставить новую основу для асинхронность в программировании .NET. Эта новая основа делает асинхронное программирование похожим на – и примерно так же просто, как Синхронное программирование. Теперь вы можете писать асинхронные методы действия в ASP.NET MVC 4 с помощью класса **асинкконтроллер** . Асинхронные методы действия можно использовать для выполняемых в течение длительного времени запросов, которые не связаны с ЦП. Это предотвращает блокировку веб-сервера от выполнения операций во время обработки запроса. Класс Асинкконтроллер обычно используется для долго выполняемых вызовов веб-служб.

В этом упражнении объясняются основы асинхронной работы в ASP.NET MVC 4. Если вы хотите более подробно изучить эту статью, ознакомьтесь со следующей статьей: [ [https://msdn.microsoft.com/library/ee728598%28v=vs.100%29.aspx](https://msdn.microsoft.com/library/ee728598%28v=vs.100%29.aspx)](https://msdn.microsoft.com/library/ee728598%28v=vs.100%29.aspx)

<a id="Task_1_-_Implementing_an_Asynchronous_Controller"></a>
#### <a name="task-1---implementing-an-asynchronous-controller"></a>Задача 1. Реализация асинхронного контроллера

1. Откройте **Начальное** решение, расположенное по адресу **Source/EX4-Async/Begin/** Folder. В противном случае вы можете продолжать **использовать решение, полученное в результате** выполнения предыдущего упражнения.

   1. Если вы открыли предоставленное **Начальное** решение, перед продолжением потребуется загрузить некоторые недостающие пакеты NuGet. Для этого в меню **проект** выберите пункт **Управление пакетами NuGet**.
   2. В диалоговом окне **Управление пакетами NuGet** нажмите кнопку **восстановить** , чтобы скачать недостающие пакеты.
   3. Наконец, создайте решение, щелкнув **build** | **Build Solution**.

      > [!NOTE]
      > Одним из преимуществ использования NuGet является то, что вам не нужно поставлять все библиотеки в проекте, уменьшая размер проекта. С помощью средств управления питанием NuGet, указав версии пакетов в файле Packages. config, вы сможете скачать все необходимые библиотеки при первом запуске проекта. Именно поэтому после открытия существующего решения из этой лабораторной работы потребуется выполнить следующие действия.
2. Откройте класс **HomeController.CS** из папки **Controllers** .
3. Добавьте следующую инструкцию using.

    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample18.cs)]
4. Обновите класс **HomeController** , чтобы он наследовался от **асинкконтроллер**. Контроллеры, производные от Асинкконтроллер, позволяют ASP.NET обрабатывать асинхронные запросы, и они по-прежнему могут обслуживать синхронные методы действий.

    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample19.cs)]
5. Добавьте ключевое слово **Async** в метод **index** и сделайте его возвращать **задачу типа&lt;ActionResult&gt;** .

    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample20.cs)]

    > [!NOTE]
    > Ключевое слово **Async** является одним из новых ключевых слов, которые предоставляет .NET Framework 4,5. Он сообщает компилятору, что этот метод содержит асинхронный код. Объект **Task** представляет асинхронную операцию, которая может завершиться в некоторый момент в будущем.
6. Замените **клиент. Вызов метода async ()** с полной асинхронной версией с ключевым словом await, как показано ниже.

    (Фрагмент кода — *ASP.NET MVC 4 Lab-Ex04-Async*)

    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample21.cs)]

    > [!NOTE]
    > В предыдущей версии использовалось свойство **result** из объекта **Task** , чтобы заблокировать поток до тех пор, пока не будет возвращен результат (версия Sync).
    > 
    > Добавление ключевого слова **await** указывает компилятору асинхронное ожидание задачи, возвращенной вызовом метода. Это означает, что остальная часть кода будет выполняться как обратный вызов только после завершения ожидаемого метода. Обратите внимание, что вам не нужно изменять блок try-catch для выполнения этой задачи: исключения, которые происходят в фоновом или на переднем плане, по-прежнему будут перехвачены без дополнительной работы с помощью обработчика, предоставленного платформой.
7. Измените код, чтобы продолжить асинхронную реализацию, заменив строки новым кодом, как показано ниже.

    (Фрагмент кода — *ASP.NET MVC 4 Lab-Ex04-реадасстрингасинк*)

    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample22.cs)]
8. Запустите приложение. Вы не заметите значительные изменения, но код не будет блокировать поток из пула потоков, повышая эффективность использования ресурсов сервера и повышая производительность.

    > [!NOTE]
    > Дополнительные сведения о новых функциях асинхронного программирования в лаборатории &quot;**асинхронном программировании в .net 4,5 с C# помощью и Visual Basic**&quot;, входящих в комплект обучающих материалов по Visual Studio.

<a id="Task_2_-_Handling_Time-Outs_with_Cancellation_Tokens"></a>
#### <a name="task-2---handling-time-outs-with-cancellation-tokens"></a>Задача 2. Обработка времени ожидания с помощью токенов отмены

Асинхронные методы действия, возвращающие экземпляры задач, также могут поддерживать время ожидания. В этой задаче будет обновлен код метода индекса для обработки сценария истечения времени ожидания с помощью токена отмены.

1. Вернитесь в Visual Studio и нажмите клавиши **SHIFT + F5** , чтобы прерывать отладку.
2. Добавьте следующий оператор using в файл **HomeController.CS** .

    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample23.cs)]
3. Обновите действие индекса, чтобы получить аргумент **CancellationToken** .

    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample24.cs)]
4. Обновите вызов метода **Async** , чтобы передать токен отмены.

    (Фрагмент кода — *ASP.NET MVC 4 Lab-Ex04-SendAsync with CancellationToken*)

    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample25.cs)]
5. Добавьте к методу *индекса* атрибут **AsyncTimeout** , установленный в значение 500 миллисекунд, и атрибут **HandleError** , настроенный на обработку **таскканцеледексцептион** путем перенаправления в представление **timedOut** .

    (Фрагмент кода — *ASP.NET MVC 4 Lab-Ex04-Attributes*)

    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample26.cs)]
6. Откройте класс " **Фотоконтроллер** " и обновите метод **коллекции** , чтобы отложить выполнение в течение 1000 миллисекунд (1 секунда) для имитации длительно выполняемой задачи.

    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample27.cs)]
7. Откройте файл **Web. config** и включите пользовательские ошибки, добавив следующий элемент.

    [!code-xml[Main](whats-new-in-aspnet-mvc-4/samples/sample28.xml)]
8. Создайте новое представление в **Views\Shared** с именем **timedOut** и используйте макет по умолчанию. В обозреватель решений щелкните правой кнопкой мыши папку **Views\Shared** и выберите **Добавить | Представление**.

    ![Использование различных представлений для каждого мобильного устройства](whats-new-in-aspnet-mvc-4/_static/image36.png "Использование различных представлений для каждого мобильного устройства")

    *Использование различных представлений для каждого мобильного устройства*
9. Обновите содержимое представления **timedOut** , как показано ниже.

    [!code-cshtml[Main](whats-new-in-aspnet-mvc-4/samples/sample29.cshtml)]
10. Запустите приложение и перейдите по корневому URL-адресу. После добавления **потока. Сон** в 1000 миллисекунд вы получите ошибку времени ожидания, созданную атрибутом **AsyncTimeout** и перехватите атрибут **HandleError** .

    ![Исключение времени ожидания обработки](whats-new-in-aspnet-mvc-4/_static/image37.png "Исключение времени ожидания обработки")

    *Исключение времени ожидания обработки*

> [!NOTE]
> Кроме того, это приложение можно развернуть на веб-сайтах Windows Azure в следующем [приложении г. Публикация приложения ASP.NET MVC 4 с помощью веб-развертывание](#AppendixD).

<a id="Summary"></a>

<a id="Summary"></a>
## <a name="summary"></a>Сводка

В этом практическом занятии вы наблюдали некоторые новые функции, находящиеся в ASP.NET MVC 4. Обсуждаются следующие концепции:

- Воспользуйтесь преимуществами усовершенствований шаблонов проектов ASP.NET MVC, включая новый шаблон проекта мобильных приложений.
- Используйте атрибут окна просмотра HTML5 и запросы мультимедиа CSS, чтобы улучшить отображение на мобильных устройствах.
- Использование jQuery Mobile для последовательного улучшения и создания веб-интерфейса, оптимизированного для сенсорного управления
- Создание представлений для мобильных устройств
- Использование компонента "вид-переключатель" для переключения между мобильными и классическими представлениями в приложении
- Создание асинхронных контроллеров с помощью поддержки задач

<a id="AppendixA"></a>

<a id="Appendix_A_Using_Code_Snippets"></a>
## <a name="appendix-a-using-code-snippets"></a>Приложение а. Использование фрагментов кода

С помощью фрагментов кода вы можете получить все необходимые вам коды. В лабораторном документе вы узнаете, когда можно использовать их, как показано на следующем рисунке.

![Использование фрагментов кода Visual Studio для вставки кода в проект](whats-new-in-aspnet-mvc-4/_static/image38.png "Использование фрагментов кода Visual Studio для вставки кода в проект")

*Использование фрагментов кода Visual Studio для вставки кода в проект*

***Добавление фрагмента кода с помощью клавиатуры (C# только)***

1. Поместите курсор в то место, куда вы хотите вставить код.
2. Начните вводить имя фрагмента (без пробелов или дефисов).
3. Посмотрите, как IntelliSense отображает соответствующие имена фрагментов кода.
4. Выберите правильный фрагмент кода (или вводите его, пока не будет выбрано имя всего фрагмента).
5. Дважды нажмите клавишу TAB, чтобы вставить фрагмент в позицию курсора.

![Начните вводить имя фрагмента](whats-new-in-aspnet-mvc-4/_static/image39.png "Начните вводить имя фрагмента")

*Начните вводить имя фрагмента*

![Нажмите клавишу TAB, чтобы выбрать выделенный фрагмент.](whats-new-in-aspnet-mvc-4/_static/image40.png "Нажмите клавишу TAB, чтобы выбрать выделенный фрагмент.")

*Нажмите клавишу TAB, чтобы выбрать выделенный фрагмент.*

![Снова нажмите клавишу TAB, и фрагмент развернется](whats-new-in-aspnet-mvc-4/_static/image41.png "Снова нажмите клавишу TAB, и фрагмент развернется")

*Снова нажмите клавишу TAB, и фрагмент развернется*

***Добавление фрагмента кода с помощью мыши (C#, Visual Basic и XML)***

1. Щелкните правой кнопкой мыши место, куда нужно вставить фрагмент кода.
2. Выберите **Вставить фрагмент** , за которым следуют **фрагменты кода**.
3. Выберите соответствующий фрагмент из списка, щелкнув его.

![Щелкните правой кнопкой мыши место, куда нужно вставить фрагмент кода, и выберите пункт Вставить фрагмент.](whats-new-in-aspnet-mvc-4/_static/image42.png "Щелкните правой кнопкой мыши место, куда нужно вставить фрагмент кода, и выберите пункт Вставить фрагмент.")

*Щелкните правой кнопкой мыши место, куда нужно вставить фрагмент кода, и выберите пункт Вставить фрагмент.*

![Выберите соответствующий фрагмент из списка, щелкнув его.](whats-new-in-aspnet-mvc-4/_static/image43.png "Выберите соответствующий фрагмент из списка, щелкнув его.")

*Выберите соответствующий фрагмент из списка, щелкнув его.*

<a id="AppendixB"></a>

<a id="Appendix_B_Installing_Visual_Studio_Express_2012_for_Web"></a>
## <a name="appendix-b-installing-visual-studio-express-2012-for-web"></a>Приложение б. Установка Visual Studio Express 2012 для Web

Вы можете установить **Microsoft Visual Studio Express 2012 для Web** или другой &quot;Express&quot; версии с помощью **[установщик веб-платформы Майкрософт](https://www.microsoft.com/web/downloads/platform.aspx)** . Следующие инструкции помогут вам выполнить действия, необходимые для установки *Visual Studio Express 2012 для Web* с помощью *установщик веб-платформы Майкрософт*.

1. Перейдите в [[https://go.microsoft.com/?linkid=9810169](https://go.microsoft.com/?linkid=9810169)](https://go.microsoft.com/?linkid=9810169). Кроме того, если у вас уже установлен установщик веб-платформы, вы можете открыть его и найти продукт &quot;*Visual Studio Express 2012 для Web с Windows Azure SDK*&quot;.
2. Щелкните **Install Now (установить сейчас**). Если у вас нет **установщика веб-платформы** , вы будете сначала перенаправлены на загрузку и установку.
3. После открытия **установщика веб-платформы** нажмите кнопку **установить** , чтобы начать установку.

    ![Установка Visual Studio Express](whats-new-in-aspnet-mvc-4/_static/image44.png "Установка Visual Studio Express")

    *Установка Visual Studio Express*
4. Прочитайте все лицензии и условия продуктов и нажмите кнопку " **принять** ", чтобы продолжить.

    ![Принятие условий лицензии](whats-new-in-aspnet-mvc-4/_static/image45.png)

    *Принятие условий лицензии*
5. Дождитесь завершения процесса загрузки и установки.

    ![Ход установки](whats-new-in-aspnet-mvc-4/_static/image46.png)

    *Ход установки*
6. После завершения установки нажмите кнопку **Готово**.

    ![Установка завершена](whats-new-in-aspnet-mvc-4/_static/image47.png)

    *Установка завершена*
7. Нажмите кнопку **выход** , чтобы закрыть установщик веб-платформы.
8. Чтобы открыть Visual Studio Express для Интернета, перейдите на **начальный** экран и начните запись &quot;**VS Express**&quot;, а затем щелкните плитку **VS Express для Web** .

    ![Плитка VS Express для Web](whats-new-in-aspnet-mvc-4/_static/image48.png)

    *Плитка VS Express для Web*

<a id="AppendixC"></a>

<a id="Appendix_C_Installing_WebMatrix_2_and_iPhone_Simulator"></a>
## <a name="appendix-c-installing-webmatrix-2-and-iphone-simulator"></a>Приложение в. Установка симулятора WebMatrix 2 и iPhone

Для запуска сайта на виртуальном устройстве iPhone можно использовать расширение WebMatrix &quot;Электрический Mobile Simulator для&quot;iPhone. Кроме того, можно настроить то же расширение для запуска симулятора из Visual Studio 2012.

<a id="ApxCTask1"></a>

<a id="Task_1_-_Installing_WebMatrix_2"></a>
#### <a name="task-1---installing-webmatrix-2"></a>Задача 1. Установка WebMatrix 2

1. Перейдите в [[https://go.microsoft.com/?linkid=9809776](https://go.microsoft.com/?linkid=9809776)](https://go.microsoft.com/?linkid=9810169). Кроме того, если у вас уже установлен установщик веб-платформы, вы можете открыть его и найти продукт &quot;*WebMatrix 2*&quot;.
2. Щелкните **Install Now (установить сейчас**). Если у вас нет **установщика веб-платформы** , вы будете сначала перенаправлены на загрузку и установку.
3. После открытия **установщика веб-платформы** нажмите кнопку **установить** , чтобы начать установку.

    ![Установка WebMatrix 2](whats-new-in-aspnet-mvc-4/_static/image49.png "Установка WebMatrix 2")

    *Установка WebMatrix 2*
4. Прочитайте все лицензии и условия продуктов и нажмите кнопку " **принять** ", чтобы продолжить.

    ![Принятие условий лицензии](whats-new-in-aspnet-mvc-4/_static/image50.png "Принятие условий лицензии")

    *Принятие условий лицензии*
5. Дождитесь завершения процесса загрузки и установки.

    ![Ход установки](whats-new-in-aspnet-mvc-4/_static/image51.png "Ход установки")

    *Ход установки*
6. После завершения установки нажмите кнопку **Готово**.

    ![Установка завершена](whats-new-in-aspnet-mvc-4/_static/image52.png "Установка завершена")

    *Установка завершена*
7. Нажмите кнопку **выход** , чтобы закрыть установщик веб-платформы.

<a id="ApxCTask2"></a>

<a id="Task_2_-_Installing_the_iPhone_Simulator_Extension"></a>
#### <a name="task-2---installing-the-iphone-simulator-extension"></a>Задача 2. Установка расширения имитатора iPhone

1. Запустите **WebMatrix** и откройте любой существующий веб-сайт или создайте новый.
2. Нажмите кнопку **выполнить** на ленте **Главная** и выберите **Добавить новый**.

    ![Добавление нового расширения WebMatrix](whats-new-in-aspnet-mvc-4/_static/image53.png "Добавление нового расширения WebMatrix")

    *Добавление нового расширения WebMatrix*
3. Выберите **iPhone имитатор** и нажмите кнопку **установить**.

    ![Просмотр расширений WebMatrix](whats-new-in-aspnet-mvc-4/_static/image54.png "Просмотр расширений WebMatrix")

    *Просмотр расширений WebMatrix*
4. В сведениях о пакете нажмите кнопку **установить** , чтобы продолжить установку расширения.

    ![расширение имитатора iPhone](whats-new-in-aspnet-mvc-4/_static/image55.png "расширение имитатора iPhone")

    *расширение имитатора iPhone*
5. Прочтите и примите условия лицензионного соглашения на расширение.

    ![Лицензионное соглашение расширения WebMatrix](whats-new-in-aspnet-mvc-4/_static/image56.png "Лицензионное соглашение расширения WebMatrix")

    *Лицензионное соглашение расширения WebMatrix*
6. Теперь можно запустить веб-сайт из WebMatrix с помощью параметра имитатор iPhone.

    ![Запуск с помощью iPhone](whats-new-in-aspnet-mvc-4/_static/image57.png "Запуск с помощью iPhone")

    *Запуск с помощью iPhone*

<a id="ApxCTask3"></a>

<a id="Task_3_-_Configuring_Visual_Studio_2012_to_run_iPhone_Simulator"></a>
#### <a name="task-3---configuring-visual-studio-2012-to-run-iphone-simulator"></a>Задача 3. Настройка Visual Studio 2012 для запуска имитатора iPhone

1. Откройте **Visual Studio 2012** и откройте любой веб-сайт или создайте новый проект.
2. Нажмите кнопку со стрелкой вниз на кнопке выполнить и выберите **просмотреть с помощью**.

    ![Просмотр с помощью](whats-new-in-aspnet-mvc-4/_static/image58.png "Просмотр с помощью")

    *Просмотр с помощью*
3. В диалоговом окне &quot;обзор&quot; нажмите кнопку **Добавить**.
4. В диалоговом окне &quot;добавить программу&quot; используйте следующие значения:

   - **Программа**: C:\Users\*{CurrentUser} * \AppData\Local\Microsoft\WebMatrix\Extensions\20\iPhoneSimulator\ElectricMobileSim\ElectricMobileSim.exe *(соответствующим образом измените путь)*
   - **Аргументы**: &quot;1&quot;
   - **Понятное имя**: имитатор iPhone

     ![Добавить программу](whats-new-in-aspnet-mvc-4/_static/image59.png "Добавить программу")

     *Добавление программы для просмотра*
5. Нажмите кнопку **ОК** и Закройте диалоговые окна.
6. Теперь вы можете запускать веб-приложения в симуляторе iPhone из Visual Studio 2012.

    ![Просмотр с помощью имитатора iPhone](whats-new-in-aspnet-mvc-4/_static/image60.png "Просмотр с помощью имитатора iPhone")

    *Просмотр с помощью имитатора iPhone*

<a id="AppendixD"></a>

<a id="Appendix_D_Publishing_an_ASPNET_MVC_4_Application_using_Web_Deploy"></a>
## <a name="appendix-d-publishing-an-aspnet-mvc-4-application-using-web-deploy"></a>Приложение г. Публикация приложения ASP.NET MVC 4 с помощью веб-развертывание

В этом приложении показано, как создать новый веб-сайт из портал управления Windows Azure и опубликовать полученное приложение, выполнив следующие лабораторные занятия, используя возможности публикации веб-развертывание, предоставляемые Windows Azure.

<a id="ApxDTask1"></a>

<a id="Task_1_-_Creating_a_New_Web_Site_from_the_Windows_Azure_Portal"></a>
#### <a name="task-1---creating-a-new-web-site-from-the-windows-azure-portal"></a>Задача 1. Создание нового веб-сайта на портале Windows Azure

1. Перейдите в [портал управления Windows Azure](https://manage.windowsazure.com/) и выполните вход с использованием учетных данных Майкрософт, связанных с подпиской.

    > [!NOTE]
    > С помощью Windows Azure можно бесплатно разместить 10 веб-сайтов ASP.NET, а затем масштабировать их по мере роста объема трафика. Вы можете зарегистрироваться [здесь](https://aka.ms/aspnet-hol-azure).

    ![Вход в Windows портал Azure](whats-new-in-aspnet-mvc-4/_static/image61.png "Вход в Windows портал Azure")

    *Вход в Windows Azure портал управления*
2. На панели команд щелкните **создать** .

    ![Создание нового веб-сайта](whats-new-in-aspnet-mvc-4/_static/image62.png "Создание нового веб-сайта")

    *Создание нового веб-сайта*
3. Щелкните **Compute** | **веб-сайт**. Затем выберите пункт **Быстрое создание** . Предоставьте доступный URL-адрес для нового веб-сайта и щелкните **создать веб-сайт**.

    > [!NOTE]
    > Веб-сайт Windows Azure — это узел для веб-приложения, работающего в облаке, которыми можно управлять и которыми вы управляете. Параметр Быстрое создание позволяет развернуть завершенное веб-приложение на веб-сайте Windows Azure извне портала. Он не включает шаги по настройке базы данных.

    ![Создание нового веб-сайта с помощью быстрого создания](whats-new-in-aspnet-mvc-4/_static/image63.png "Создание нового веб-сайта с помощью быстрого создания")

    *Создание нового веб-сайта с помощью быстрого создания*
4. Дождитесь создания нового **веб-сайта** .
5. После создания веб-сайта щелкните ссылку в столбце **URL-адрес** . Убедитесь, что новый веб-сайт работает.

    ![Обзор нового веб-сайта](whats-new-in-aspnet-mvc-4/_static/image64.png "Обзор нового веб-сайта")

    *Обзор нового веб-сайта*

    ![Веб-сайт работает](whats-new-in-aspnet-mvc-4/_static/image65.png "Веб-сайт работает")

    *Веб-сайт работает*
6. Вернитесь на портал и щелкните имя веб-сайта в столбце **имя** , чтобы отобразить страницы управления.

    ![Открытие страниц управления веб-сайтом](whats-new-in-aspnet-mvc-4/_static/image66.png "Открытие страниц управления веб-сайтом")

    *Открытие страниц управления веб-сайтом*
7. На странице **панель мониторинга** в разделе **краткий обзор** щелкните ссылку **скачать профиль публикации** .

    > [!NOTE]
    > *Профиль публикации* содержит все сведения, необходимые для публикации веб-приложения на веб-сайте Windows Azure для каждого включенного метода публикации. Профиль публикации содержит URL-адреса, учетные данные пользователей и строки для открытия базы данных, которые необходимы для проверки подлинности и подключения к каждой из конечных точек, соответствующей разрешенному методу публикации. **Microsoft WebMatrix 2**, **Microsoft Visual Studio Express для Web** и **Microsoft Visual Studio 2012** поддерживают чтение профилей публикации для автоматизации настройки этих программ для публикации веб-приложений на веб-сайтах Windows Azure.

    ![Скачивание профиля публикации веб-сайта](whats-new-in-aspnet-mvc-4/_static/image67.png "Скачивание профиля публикации веб-сайта")

    *Скачивание профиля публикации веб-сайта*
8. Скачайте файл профиля публикации в известное расположение. Далее в этом упражнении вы узнаете, как использовать этот файл для публикации веб-приложения на веб-сайтах Windows Azure из Visual Studio.

    ![Сохранение файла профиля публикации](whats-new-in-aspnet-mvc-4/_static/image68.png "Сохранение профиля публикации")

    *Сохранение файла профиля публикации*

<a id="ApxDTask2"></a>

<a id="Task_2_-_Configuring_the_Database_Server"></a>
#### <a name="task-2---configuring-the-database-server"></a>Задача 2. Настройка сервера базы данных

Если приложение использует SQL Server базы данных, потребуется создать сервер базы данных SQL. Если вы хотите развернуть простое приложение, которое не использует SQL Server вы можете пропустить эту задачу.

1. Для хранения базы данных приложения необходим сервер базы данных SQL. Серверы базы данных SQL можно просмотреть в подписке на портале управления Windows Azure в **базах данных sql** | **серверы** | **панели мониторинга сервера**. Если сервер не создан, можно создать его с помощью кнопки **Добавить** на панели команд. Запишите **имя сервера и URL-адрес, имя для входа администратора и пароль**, так как они будут использоваться в следующих задачах. Пока не создавайте базу данных, так как она будет создана на более позднем этапе.

    ![Панель мониторинга сервера базы данных SQL](whats-new-in-aspnet-mvc-4/_static/image69.png "Панель мониторинга сервера базы данных SQL")

    *Панель мониторинга сервера базы данных SQL*
2. В следующей задаче вы проверите подключение к базе данных из Visual Studio. по этой причине необходимо включить локальный IP-адрес в список **разрешенных IP-адресов**сервера. Для этого нажмите кнопку **настроить**, выберите IP-адрес из **текущего IP-адреса клиента** и вставьте его в текстовые поля **начальный IP-адрес** и **конечный IP** -адрес и нажмите кнопку ![добавить-клиент-IP – адрес-OK-кнопка](whats-new-in-aspnet-mvc-4/_static/image70.png).

    ![Добавление IP-адреса клиента](whats-new-in-aspnet-mvc-4/_static/image71.png)

    *Добавление IP-адреса клиента*
3. После добавления **IP-адреса клиента** в список Разрешенные IP-адреса нажмите кнопку **сохранить** , чтобы подтвердить изменения.

    ![Подтверждение изменений](whats-new-in-aspnet-mvc-4/_static/image72.png)

    *Подтверждение изменений*

<a id="ApxDTask3"></a>

<a id="Task_3_-_Publishing_an_ASPNET_MVC_4_Application_using_Web_Deploy"></a>
#### <a name="task-3---publishing-an-aspnet-mvc-4-application-using-web-deploy"></a>Задача 3. Публикация приложения ASP.NET MVC 4 с помощью веб-развертывание

1. Вернитесь к решению ASP.NET MVC 4. В **Обозреватель решений**щелкните правой кнопкой мыши проект веб-сайта и выберите **опубликовать**.

    ![Публикация приложения](whats-new-in-aspnet-mvc-4/_static/image73.png "Публикация приложения")

    *Публикация веб-сайта*
2. Импортируйте профиль публикации, сохраненный в первой задаче.

    ![Импорт профиля публикации](whats-new-in-aspnet-mvc-4/_static/image74.png "Импорт профиля публикации")

    *Импорт профиля публикации*
3. Щелкните **проверить подключение**. После завершения проверки нажмите кнопку **Далее**.

    > [!NOTE]
    > Проверка завершится, когда появится зеленая галочка рядом с кнопкой проверить подключение.

    ![Проверка подключения](whats-new-in-aspnet-mvc-4/_static/image75.png "Проверка подключения")

    *Проверка подключения*
4. На странице **Параметры** в разделе **базы данных** нажмите кнопку рядом с текстовым полем подключения к базе данных (т. е. **DefaultConnection**).

    ![Конфигурация веб-развертывания](whats-new-in-aspnet-mvc-4/_static/image76.png "Конфигурация веб-развертывания")

    *Конфигурация веб-развертывания*
5. Настройте подключение к базе данных следующим образом.

   - В поле **имя сервера** введите URL-адрес сервера базы данных SQL с помощью префикса *TCP:* .
   - В окне **имя пользователя** введите имя для входа администратора сервера.
   - В окне **пароль** введите пароль для входа администратора сервера.
   - Введите имя новой базы данных, например: *MVC4SampleDB*.

     ![Настройка строки подключения к целевому объекту](whats-new-in-aspnet-mvc-4/_static/image77.png "Настройка строки подключения к целевому объекту")

     *Настройка строки подключения к целевому объекту*
6. Нажмите кнопку **ОК**. При появлении запроса на создание базы данных нажмите кнопку **Да**.

    ![Создание базы данных](whats-new-in-aspnet-mvc-4/_static/image78.png "Создание строки базы данных")

    *Создание базы данных*
7. Строка подключения, которая будет использоваться для подключения к базе данных SQL в Windows Azure, отображается в текстовом поле подключения по умолчанию. Затем нажмите кнопку **Далее**.

    ![Строка подключения, указывающая на базу данных SQL](whats-new-in-aspnet-mvc-4/_static/image79.png "Строка подключения, указывающая на базу данных SQL")

    *Строка подключения, указывающая на базу данных SQL*
8. На странице **Предварительный просмотр** нажмите кнопку **опубликовать**.

    ![Публикация веб-приложения](whats-new-in-aspnet-mvc-4/_static/image80.png "Публикация веб-приложения")

    *Публикация веб-приложения*
9. По завершении процесса публикации браузер по умолчанию будет открывать опубликованный веб-сайт.

    ![Приложение, опубликованное в Windows Azure](whats-new-in-aspnet-mvc-4/_static/image81.png "Приложение, опубликованное в Windows Azure")

    *Приложение, опубликованное в Windows Azure*
