---
uid: mvc/overview/security/preventing-open-redirection-attacks
title: Предотвращение атак с открытым перенаправлениемC#() | Документация Майкрософт
author: jongalloway
description: В этом учебнике объясняется, как можно предотвратить атаки с открытым перенаправлением в приложениях ASP.NET MVC. В этом учебнике обсуждаются внесенные изменения...
ms.author: riande
ms.date: 02/27/2014
ms.assetid: 69fb02e0-f5b7-4c35-878c-fa87164fc785
msc.legacyurl: /mvc/overview/security/preventing-open-redirection-attacks
msc.type: authoredcontent
ms.openlocfilehash: cfa635d4fd14d031993c5b452325cbe334f82dc2
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78432588"
---
# <a name="preventing-open-redirection-attacks-c"></a><span data-ttu-id="9a7fc-104">Предотвращение атак с открытой переадресацией (C#)</span><span class="sxs-lookup"><span data-stu-id="9a7fc-104">Preventing Open Redirection Attacks (C#)</span></span>

<span data-ttu-id="9a7fc-105">[Джон Гэллоуэй](https://github.com/jongalloway)</span><span class="sxs-lookup"><span data-stu-id="9a7fc-105">by [Jon Galloway](https://github.com/jongalloway)</span></span>

> <span data-ttu-id="9a7fc-106">В этом учебнике объясняется, как можно предотвратить атаки с открытым перенаправлением в приложениях ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-106">This tutorial explains how you can prevent open redirection attacks in your ASP.NET MVC applications.</span></span> <span data-ttu-id="9a7fc-107">В этом учебнике обсуждаются изменения, внесенные в AccountController в ASP.NET MVC 3, и демонстрируется применение этих изменений в существующих приложениях ASP.NET MVC 1,0 и 2.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-107">This tutorial discusses the changes that have been made in the AccountController in ASP.NET MVC 3 and demonstrates how you can apply these changes in your existing ASP.NET MVC 1.0 and 2 applications.</span></span>

## <a name="what-is-an-open-redirection-attack"></a><span data-ttu-id="9a7fc-108">Что такое атака с открытым перенаправлением?</span><span class="sxs-lookup"><span data-stu-id="9a7fc-108">What is an Open Redirection Attack?</span></span>

<span data-ttu-id="9a7fc-109">Любое веб-приложение, которое перенаправляет на URL-адрес, указанный через запрос, например строку запроса или данные формы, потенциально может быть изменено для перенаправления пользователей на внешний вредоносный URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-109">Any web application that redirects to a URL that is specified via the request such as the querystring or form data can potentially be tampered with to redirect users to an external, malicious URL.</span></span> <span data-ttu-id="9a7fc-110">Такое изменение данных называется атакой открытого перенаправления.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-110">This tampering is called an open redirection attack.</span></span>

<span data-ttu-id="9a7fc-111">Каждый раз, когда логика вашего приложения выполняет перенаправление на определенный URL-адрес, нужно убедиться, что этот адрес не был изменен.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-111">Whenever your application logic redirects to a specified URL, you must verify that the redirection URL hasn't been tampered with.</span></span> <span data-ttu-id="9a7fc-112">Имя входа, используемое в AccountController по умолчанию для ASP.NET MVC 1,0 и ASP.NET MVC 2, уязвимо для атак с перенаправлением.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-112">The login used in the default AccountController for both ASP.NET MVC 1.0 and ASP.NET MVC 2 is vulnerable to open redirection attacks.</span></span> <span data-ttu-id="9a7fc-113">К счастью, можно легко обновить существующие приложения, чтобы использовать исправления из ASP.NET MVC 3 Preview.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-113">Fortunately, it is easy to update your existing applications to use the corrections from the ASP.NET MVC 3 Preview.</span></span>

<span data-ttu-id="9a7fc-114">Чтобы разобраться в уязвимости, рассмотрим, как перенаправление имени входа работает в проекте веб-приложения ASP.NET MVC 2 по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-114">To understand the vulnerability, let's look at how the login redirection works in a default ASP.NET MVC 2 Web Application project.</span></span> <span data-ttu-id="9a7fc-115">В этом приложении попытка посетить действие контроллера, имеющее атрибут [авторизовать], перенаправит неавторизованных пользователей в представление/аккаунт/Логон.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-115">In this application, attempting to visit a controller action that has the [Authorize] attribute will redirect unauthorized users to the /Account/LogOn view.</span></span> <span data-ttu-id="9a7fc-116">Это перенаправление в/аккаунт/Логон будет включать параметр строки запроса returnUrl, чтобы пользователь мог вернуться к первоначально запрошенному URL-адресу после успешного входа.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-116">This redirect to /Account/LogOn will include a returnUrl querystring parameter so that the user can be returned to the originally requested URL after they have successfully logged in.</span></span>

<span data-ttu-id="9a7fc-117">На снимке экрана ниже видно, что попытка получить доступ к представлению/аккаунт/чанжепассворд при отсутствии входа в систему приводит к перенаправлению в/аккаунт/Логон? ReturnUrl =% 2fAccount% 2fChangePassword% 2F.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-117">In the screenshot below, we can see that an attempt to access the /Account/ChangePassword view when not logged in results in a redirect to /Account/LogOn?ReturnUrl=%2fAccount%2fChangePassword%2f.</span></span>

[![](preventing-open-redirection-attacks/_static/image2.png)](preventing-open-redirection-attacks/_static/image1.png)

<span data-ttu-id="9a7fc-118">**Рис. 01**. страница входа с открытым перенаправлением</span><span class="sxs-lookup"><span data-stu-id="9a7fc-118">**Figure 01**: Login page with an open redirection</span></span>

<span data-ttu-id="9a7fc-119">Так как параметр QueryString ReturnUrl не проверяется, злоумышленник может изменить его, чтобы внедрить любой URL-адрес в параметр для проведения атаки с открытым перенаправлением.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-119">Since the ReturnUrl querystring parameter is not validated, an attacker can modify it to inject any URL address into the parameter to conduct an open redirection attack.</span></span> <span data-ttu-id="9a7fc-120">Чтобы продемонстрировать это, можно изменить параметр ReturnUrl на [http://bing.com](http://bing.com), чтобы итоговый URL-адрес входа был/аккаунт/Логон? ReturnUrl =<http://www.bing.com/>.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-120">To demonstrate this, we can modify the ReturnUrl parameter to [http://bing.com](http://bing.com), so the resulting login URL will be /Account/LogOn?ReturnUrl=<http://www.bing.com/>.</span></span> <span data-ttu-id="9a7fc-121">После успешного входа на сайт мы перенаправлены на [http://bing.com](http://bing.com).</span><span class="sxs-lookup"><span data-stu-id="9a7fc-121">Upon successfully logging in to the site, we are redirected to [http://bing.com](http://bing.com).</span></span> <span data-ttu-id="9a7fc-122">Так как перенаправление не проверено, оно может указывать на вредоносный веб-узел, пытающийся обману пользователя.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-122">Since this redirection is not validated, it could instead point to a malicious site that attempts to trick the user.</span></span>

### <a name="a-more-complex-open-redirection-attack"></a><span data-ttu-id="9a7fc-123">Более сложная атака с открытым перенаправлением</span><span class="sxs-lookup"><span data-stu-id="9a7fc-123">A more complex Open Redirection Attack</span></span>

<span data-ttu-id="9a7fc-124">Атаки с открытым перенаправлением особенно опасны, поскольку злоумышленник знает, что мы пытаемся войти на конкретный веб-сайт, что делает уязвимыми для [фишинговых атак](https://www.microsoft.com/protect/fraud/phishing/symptoms.aspx).</span><span class="sxs-lookup"><span data-stu-id="9a7fc-124">Open redirection attacks are especially dangerous because an attacker knows that we're trying to log into a specific website, which makes us vulnerable to a [phishing attack](https://www.microsoft.com/protect/fraud/phishing/symptoms.aspx).</span></span> <span data-ttu-id="9a7fc-125">Например, злоумышленник может отправить вредоносные сообщения электронной почты пользователям веб-сайта при попытке записи паролей.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-125">For example, an attacker could send malicious emails to website users in an attempt to capture their passwords.</span></span> <span data-ttu-id="9a7fc-126">Давайте посмотрим, как это будет работать на сайте NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-126">Let's look at how this would work on the NerdDinner site.</span></span> <span data-ttu-id="9a7fc-127">(Обратите внимание, что активный веб-сайт NerdDinner обновлен для защиты от атак с открытым перенаправлением).</span><span class="sxs-lookup"><span data-stu-id="9a7fc-127">(Note that the live NerdDinner site has been updated to protect against open redirection attacks.)</span></span>

<span data-ttu-id="9a7fc-128">Во-первых, злоумышленник отправляет нам ссылку на страницу входа в NerdDinner, которая включает перенаправление на подложные страницы:</span><span class="sxs-lookup"><span data-stu-id="9a7fc-128">First, an attacker sends us a link to the login page on NerdDinner that includes a redirect to their forged page:</span></span>

[http://nerddinner.com/Account/LogOn?returnUrl=http://nerddiner.com/Account/LogOn](http://nerddinner.com/Account/LogOn?returnUrl=http://nerddiner.com/Account/LogOn)

<span data-ttu-id="9a7fc-129">Обратите внимание, что URL-адрес возврата указывает на nerddiner.com, в котором отсутствует "n" из слова "ужин".</span><span class="sxs-lookup"><span data-stu-id="9a7fc-129">Note that the return URL points to nerddiner.com, which is missing an "n" from the word dinner.</span></span> <span data-ttu-id="9a7fc-130">В этом примере это домен, который контролируется злоумышленником.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-130">In this example, this is a domain that the attacker controls.</span></span> <span data-ttu-id="9a7fc-131">Когда мы доступ к приведенной выше ссылке, мы переходим на страницу допустимого входа в NerdDinner.com.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-131">When we access the above link, we're taken to the legitimate NerdDinner.com login page.</span></span>

[![](preventing-open-redirection-attacks/_static/image4.png)](preventing-open-redirection-attacks/_static/image3.png)

<span data-ttu-id="9a7fc-132">**Рис. 02**. страница входа в NerdDinner с открытым перенаправлением</span><span class="sxs-lookup"><span data-stu-id="9a7fc-132">**Figure 02**: NerdDinner login page with an open redirection</span></span>

<span data-ttu-id="9a7fc-133">При правильном входе в систему ASP.NET MVC AccountController выполняет переадресацию по URL-адресу, указанному в параметре QueryString строки returnUrl.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-133">When we correctly log in, the ASP.NET MVC AccountController's LogOn action redirects us to the URL specified in the returnUrl querystring parameter.</span></span> <span data-ttu-id="9a7fc-134">В данном случае это URL-адрес, который злоумышленник вводит, что [http://nerddiner.com/Account/LogOn](http://nerddiner.com/Account/LogOn).</span><span class="sxs-lookup"><span data-stu-id="9a7fc-134">In this case, it's the URL that the attacker has entered, which is [http://nerddiner.com/Account/LogOn](http://nerddiner.com/Account/LogOn).</span></span> <span data-ttu-id="9a7fc-135">Если мы не очень ватчфул, то, скорее всего, мы не будем заметить это, особенно потому, что злоумышленник следит за тем, чтобы их поддельная страница отображалась точно так же, как и страница легального входа.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-135">Unless we're extremely watchful, it's very likely we won't notice this, especially because the attacker has been careful to make sure that their forged page looks exactly like the legitimate login page.</span></span> <span data-ttu-id="9a7fc-136">Эта страница входа содержит сообщение об ошибке с запросом на повторное вход.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-136">This login page includes an error message requesting that we login again.</span></span> <span data-ttu-id="9a7fc-137">Неловкий нам, нам нужно ввести пароль.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-137">Clumsy us, we must have mistyped our password.</span></span>

[![](preventing-open-redirection-attacks/_static/image6.png)](preventing-open-redirection-attacks/_static/image5.png)

<span data-ttu-id="9a7fc-138">**Рис. 03**. экран входа с подложным NerdDinner</span><span class="sxs-lookup"><span data-stu-id="9a7fc-138">**Figure 03**: Forged NerdDinner Login screen</span></span>

<span data-ttu-id="9a7fc-139">При повторном вводе имени пользователя и пароля страница с подложным входом сохраняет информацию и отправляет нам на законный сайт NerdDinner.com.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-139">When we retype our user name and password, the forged login page saves the information and sends us back to the legitimate NerdDinner.com site.</span></span> <span data-ttu-id="9a7fc-140">На этом этапе сайт NerdDinner.com уже прошел проверку подлинности, поэтому поддельная страница входа может перенаправляться непосредственно на эту страницу.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-140">At this point, the NerdDinner.com site has already authenticated us, so the forged login page can redirect directly to that page.</span></span> <span data-ttu-id="9a7fc-141">Конечным результатом является то, что у злоумышленника есть имя пользователя и пароль, и мы не осведомлены о том, что они предоставлены.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-141">The end result is that the attacker has our user name and password, and we are unaware that we've provided it to them.</span></span>

## <a name="looking-at-the-vulnerable-code-in-the-accountcontroller-logon-action"></a><span data-ttu-id="9a7fc-142">Просмотр уязвимого кода в действии входа AccountController</span><span class="sxs-lookup"><span data-stu-id="9a7fc-142">Looking at the vulnerable code in the AccountController LogOn Action</span></span>

<span data-ttu-id="9a7fc-143">Ниже показан код для действия LogOn в приложении ASP.NET MVC 2.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-143">The code for the LogOn action in an ASP.NET MVC 2 application is shown below.</span></span> <span data-ttu-id="9a7fc-144">Обратите внимание, что при успешном входе контроллер возвращает перенаправление к returnUrl.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-144">Note that upon a successful login, the controller returns a redirect to the returnUrl.</span></span> <span data-ttu-id="9a7fc-145">Вы видите, что для параметра returnUrl не выполняется проверка.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-145">You can see that no validation is being performed against the returnUrl parameter.</span></span>

<span data-ttu-id="9a7fc-146">**Листинг 1 – ASP.NET. действие входа MVC 2 в `AccountController.cs`**</span><span class="sxs-lookup"><span data-stu-id="9a7fc-146">**Listing 1 – ASP.NET MVC 2 LogOn action in `AccountController.cs`**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample1.cs)]

<span data-ttu-id="9a7fc-147">Теперь давайте взглянем на изменения в действии входа в ASP.NET MVC 3.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-147">Now let's look at the changes to the ASP.NET MVC 3 LogOn action.</span></span> <span data-ttu-id="9a7fc-148">Этот код был изменен для проверки параметра returnUrl путем вызова нового метода в классе вспомогательного класса System. Web. MVC. URL с именем `IsLocalUrl()`.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-148">This code has been changed to validate the returnUrl parameter by calling a new method in the System.Web.Mvc.Url helper class named `IsLocalUrl()`.</span></span>

<span data-ttu-id="9a7fc-149">**Листинг 2 – ASP.NETое действие входа MVC 3 в `AccountController.cs`**</span><span class="sxs-lookup"><span data-stu-id="9a7fc-149">**Listing 2 – ASP.NET MVC 3 LogOn action in `AccountController.cs`**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample2.cs)]

<span data-ttu-id="9a7fc-150">Это было изменено для проверки параметра URL-адреса возврата путем вызова нового метода в классе поддержки System. Web. MVC. URL `IsLocalUrl()`.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-150">This has been changed to validate the return URL parameter by calling a new method in the System.Web.Mvc.Url helper class, `IsLocalUrl()`.</span></span>

## <a name="protecting-your-aspnet-mvc-10-and-mvc-2-applications"></a><span data-ttu-id="9a7fc-151">Защита приложений ASP.NET MVC 1,0 и MVC 2</span><span class="sxs-lookup"><span data-stu-id="9a7fc-151">Protecting Your ASP.NET MVC 1.0 and MVC 2 Applications</span></span>

<span data-ttu-id="9a7fc-152">Мы можем воспользоваться преимуществами ASP.NET MVC 3 в существующих приложениях ASP.NET MVC 1,0 и 2, добавив вспомогательный метод Ислокалурл () и обновив действие LogOn для проверки параметра returnUrl.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-152">We can take advantage of the ASP.NET MVC 3 changes in our existing ASP.NET MVC 1.0 and 2 applications by adding the IsLocalUrl() helper method and updating the LogOn action to validate the returnUrl parameter.</span></span>

<span data-ttu-id="9a7fc-153">Метод Урлхелпер Ислокалурл () на самом деле просто вызывает метод в System. Web. веб-страниц, так как эта проверка также используется приложениями веб-страницы ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-153">The UrlHelper IsLocalUrl() method actually just calling into a method in System.Web.WebPages, as this validation is also used by ASP.NET Web Pages applications.</span></span>

<span data-ttu-id="9a7fc-154">**Листинг 3 — метод Ислокалурл () из ASP.NET MVC 3 Урлхелпер `class`**</span><span class="sxs-lookup"><span data-stu-id="9a7fc-154">**Listing 3 – The IsLocalUrl() method from the ASP.NET MVC 3 UrlHelper `class`**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample3.cs)]

<span data-ttu-id="9a7fc-155">Метод Исурллокалтохост содержит реальную логику проверки, как показано в листинге 4.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-155">The IsUrlLocalToHost method contains the actual validation logic, as shown in Listing 4.</span></span>

<span data-ttu-id="9a7fc-156">**Листинг 4 — метод Исурллокалтохост () из класса System. Web. Рекуестекстенсионс**</span><span class="sxs-lookup"><span data-stu-id="9a7fc-156">**Listing 4 – IsUrlLocalToHost() method from the System.Web.WebPages RequestExtensions class**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample4.cs)]

<span data-ttu-id="9a7fc-157">В нашем приложении ASP.NET MVC 1,0 или 2 мы добавим метод Ислокалурл () в AccountController, но по возможности рекомендуется добавить его в отдельный вспомогательный класс.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-157">In our ASP.NET MVC 1.0 or 2 application, we'll add a IsLocalUrl() method to the AccountController, but you're encouraged to add it to a separate helper class if possible.</span></span> <span data-ttu-id="9a7fc-158">Мы будем вносить два небольших изменения в версию Ислокалурл () ASP.NET MVC 3, чтобы она работала внутри AccountController.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-158">We will make two small changes to the ASP.NET MVC 3 version of IsLocalUrl() so that it will work inside the AccountController.</span></span> <span data-ttu-id="9a7fc-159">Во-первых, мы изменим его из открытого метода на частный метод, так как доступ к открытым методам в контроллерах можно получить как к действиям контроллера.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-159">First, we'll change it from a public method to a private method, since public methods in controllers can be accessed as controller actions.</span></span> <span data-ttu-id="9a7fc-160">Во-вторых, мы изменим вызов, который проверяет узел с адресом URL на соответствие узлу приложения.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-160">Second, we'll modify the call that checks the URL host against the application host.</span></span> <span data-ttu-id="9a7fc-161">Этот вызов использует локальное поле RequestContext в классе Урлхелпер.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-161">That call makes use of a local RequestContext field in the UrlHelper class.</span></span> <span data-ttu-id="9a7fc-162">Вместо этого используйте. RequestContext. HttpContext. Request. URL. Host, мы будем использовать его. Request. URL. host.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-162">Instead of using this.RequestContext.HttpContext.Request.Url.Host, we will use this.Request.Url.Host.</span></span> <span data-ttu-id="9a7fc-163">В следующем коде показан измененный метод Ислокалурл () для использования с классом контроллера в приложениях ASP.NET MVC 1,0 и 2.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-163">The following code shows the modified IsLocalUrl() method for use with a controller class in ASP.NET MVC 1.0 and 2 applications.</span></span>

<span data-ttu-id="9a7fc-164">**Листинг 5 — метод Ислокалурл (), который изменяется для использования с классом контроллера MVC**</span><span class="sxs-lookup"><span data-stu-id="9a7fc-164">**Listing 5 – IsLocalUrl() method, which is modified for use with an MVC Controller class**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample5.cs)]

<span data-ttu-id="9a7fc-165">Теперь, когда используется метод Ислокалурл (), мы можем вызвать его из нашего действия входа, чтобы проверить параметр returnUrl, как показано в следующем коде.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-165">Now that the IsLocalUrl() method is in place, we can call it from our LogOn action to validate the returnUrl parameter, as shown in the following code.</span></span>

<span data-ttu-id="9a7fc-166">**Листинг 6 — обновленный метод LogOn, который проверяет параметр returnUrl**</span><span class="sxs-lookup"><span data-stu-id="9a7fc-166">**Listing 6 – Updated LogOn method which validates the returnUrl parameter**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample6.cs)]

<span data-ttu-id="9a7fc-167">Теперь мы можем протестировать атаку с открытой перенаправлением, пытаясь войти с помощью внешнего URL-адреса возврата.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-167">Now we can test an open redirection attack by attempting to log in using an external return URL.</span></span> <span data-ttu-id="9a7fc-168">Будем использовать/аккаунт/Логон? ReturnUrl =<http://www.bing.com/> еще раз.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-168">Let's use /Account/LogOn?ReturnUrl=<http://www.bing.com/> again.</span></span>

[![](preventing-open-redirection-attacks/_static/image8.png)](preventing-open-redirection-attacks/_static/image7.png)

<span data-ttu-id="9a7fc-169">**Рис. 04**. Проверка обновленного действия входа</span><span class="sxs-lookup"><span data-stu-id="9a7fc-169">**Figure 04**: Testing the updated LogOn Action</span></span>

<span data-ttu-id="9a7fc-170">После успешного входа в систему мы будем перенаправлены к действию контроллера Home или index, а не к внешнему URL-адресу.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-170">After successfully logging in, we are redirected to the Home/Index Controller action rather than the external URL.</span></span>

[![](preventing-open-redirection-attacks/_static/image10.png)](preventing-open-redirection-attacks/_static/image9.png)

<span data-ttu-id="9a7fc-171">**Рис. 05**. Немонопольная атака с перенаправлением</span><span class="sxs-lookup"><span data-stu-id="9a7fc-171">**Figure 05**: Open Redirection attack defeated</span></span>

## <a name="summary"></a><span data-ttu-id="9a7fc-172">Сводка</span><span class="sxs-lookup"><span data-stu-id="9a7fc-172">Summary</span></span>

<span data-ttu-id="9a7fc-173">Атаки с перенаправлением могут происходить, когда URL-адреса перенаправления передаются в качестве параметров в URL-адресе приложения.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-173">Open redirection attacks can occur when redirection URLs are passed as parameters in the URL for an application.</span></span> <span data-ttu-id="9a7fc-174">Шаблон ASP.NET MVC 3 содержит код для защиты от атак с открытым перенаправлением.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-174">The ASP.NET MVC 3 template includes code to protect against open redirection attacks.</span></span> <span data-ttu-id="9a7fc-175">Этот код можно добавить с некоторыми изменениями в приложения ASP.NET MVC 1,0 и 2.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-175">You can add this code with some modification to ASP.NET MVC 1.0 and 2 applications.</span></span> <span data-ttu-id="9a7fc-176">Чтобы защититься от атак с открытым перенаправлением при входе в приложения ASP.NET 1,0 и 2, добавьте метод Ислокалурл () и проверьте параметр returnUrl в действии LogOn.</span><span class="sxs-lookup"><span data-stu-id="9a7fc-176">To protect against open redirection attacks when logging into ASP.NET 1.0 and 2 applications, add a IsLocalUrl() method and validate the returnUrl parameter in the LogOn action.</span></span>
