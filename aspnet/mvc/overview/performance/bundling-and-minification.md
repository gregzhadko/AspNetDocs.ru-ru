---
uid: mvc/overview/performance/bundling-and-minification
title: Объединение и минификации | Документация Майкрософт
author: Rick-Anderson
description: Объединение и минификации — это два метода, которые можно использовать в ASP.NET 4,5 для повышения времени загрузки запросов. Объединение и минификации улучшает время загрузки по редуЦин...
ms.author: riande
ms.date: 08/23/2012
ms.assetid: 5894dc13-5d45-4dad-8096-136499120f1d
msc.legacyurl: /mvc/overview/performance/bundling-and-minification
msc.type: authoredcontent
ms.openlocfilehash: 61bfe5dbac04b57e1461183b66ead2f01fe0734c
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78432954"
---
# <a name="bundling-and-minification"></a><span data-ttu-id="8880f-104">Объединение и минификация</span><span class="sxs-lookup"><span data-stu-id="8880f-104">Bundling and Minification</span></span>

<span data-ttu-id="8880f-105">по [Рик Андерсон (](https://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="8880f-105">by [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

> <span data-ttu-id="8880f-106">Объединение и минификации — это два метода, которые можно использовать в ASP.NET 4,5 для повышения времени загрузки запросов.</span><span class="sxs-lookup"><span data-stu-id="8880f-106">Bundling and minification are two techniques you can use in ASP.NET 4.5 to improve request load time.</span></span> <span data-ttu-id="8880f-107">Объединение и минификации увеличивает время загрузки, уменьшая количество запросов к серверу и уменьшая размер запрошенных ресурсов (например, CSS и JavaScript).</span><span class="sxs-lookup"><span data-stu-id="8880f-107">Bundling and minification improves load time by reducing the number of requests to the server and reducing the size of requested assets (such as CSS and JavaScript.)</span></span>

<span data-ttu-id="8880f-108">Большинство текущих основных браузеров ограничивают число [одновременных подключений](http://www.browserscope.org/?category=network) на каждое имя узла до шести.</span><span class="sxs-lookup"><span data-stu-id="8880f-108">Most of the current major browsers limit the number of [simultaneous connections](http://www.browserscope.org/?category=network) per each hostname to six.</span></span> <span data-ttu-id="8880f-109">Это означает, что пока обрабатывается шесть запросов, дополнительные запросы ресурсов на узле помещаются в очередь браузера.</span><span class="sxs-lookup"><span data-stu-id="8880f-109">That means that while six requests are being processed, additional requests for assets on a host will be queued by the browser.</span></span> <span data-ttu-id="8880f-110">На приведенном ниже рисунке вкладки сети средств разработчика F12 в IE показывают время для ресурсов, необходимых для представления примера приложения.</span><span class="sxs-lookup"><span data-stu-id="8880f-110">In the image below, the IE F12 developer tools network tabs shows the timing for assets required by the About view of a sample application.</span></span>

![Б/М](bundling-and-minification/_static/image1.png)

<span data-ttu-id="8880f-112">Серые полосы показывают время, в течение которого запрос находится в очереди браузером, ожидающим шесть ограничений на подключение.</span><span class="sxs-lookup"><span data-stu-id="8880f-112">The gray bars show the time the request is queued by the browser waiting on the six connection limit.</span></span> <span data-ttu-id="8880f-113">Желтая полоса — это время запроса к первому байту, то есть время, затраченное на отправку запроса и получение первого ответа от сервера.</span><span class="sxs-lookup"><span data-stu-id="8880f-113">The yellow bar is the request time to first byte, that is, the time taken to send the request and receive the first response from the server.</span></span> <span data-ttu-id="8880f-114">Синие полосы показывают время, затраченное на получение данных ответа с сервера.</span><span class="sxs-lookup"><span data-stu-id="8880f-114">The blue bars show the time taken to receive the response data from the server.</span></span> <span data-ttu-id="8880f-115">Вы можете дважды щелкнуть ресурс, чтобы получить подробные сведения о времени.</span><span class="sxs-lookup"><span data-stu-id="8880f-115">You can double-click on an asset to get detailed timing information.</span></span> <span data-ttu-id="8880f-116">Например, на следующем рисунке показаны сведения о времени загрузки файла */Scripts/MyScripts/JavaScript6.js* .</span><span class="sxs-lookup"><span data-stu-id="8880f-116">For example, the following image shows the timing details for loading the */Scripts/MyScripts/JavaScript6.js* file.</span></span>

![](bundling-and-minification/_static/image2.png)

<span data-ttu-id="8880f-117">На предыдущем рисунке показано событие **запуска** , которое дает время, в течение которого запрос был поставлен в очередь из-за ограничения числа одновременных подключений в браузере.</span><span class="sxs-lookup"><span data-stu-id="8880f-117">The preceding image shows the **Start** event, which gives the time the request was queued because of the browser limit the number of simultaneous connections.</span></span> <span data-ttu-id="8880f-118">В этом случае запрос был поставлен в очередь на 46 миллисекунд ожидания завершения другого запроса.</span><span class="sxs-lookup"><span data-stu-id="8880f-118">In this case, the request was queued for 46 milliseconds waiting for another request to complete.</span></span>

## <a name="bundling"></a><span data-ttu-id="8880f-119">Объединения</span><span class="sxs-lookup"><span data-stu-id="8880f-119">Bundling</span></span>

<span data-ttu-id="8880f-120">Объединение — это новая функция в ASP.NET 4,5, которая упрощает объединение нескольких файлов в один файл.</span><span class="sxs-lookup"><span data-stu-id="8880f-120">Bundling is a new feature in ASP.NET 4.5 that makes it easy to combine or bundle multiple files into a single file.</span></span> <span data-ttu-id="8880f-121">Можно создать CSS, JavaScript и другие пакеты.</span><span class="sxs-lookup"><span data-stu-id="8880f-121">You can create CSS, JavaScript and other bundles.</span></span> <span data-ttu-id="8880f-122">Меньшее число файлов означает меньшее количество HTTP-запросов и может повысить производительность первой загрузки страницы.</span><span class="sxs-lookup"><span data-stu-id="8880f-122">Fewer files means fewer HTTP requests and that can improve first page load performance.</span></span>

<span data-ttu-id="8880f-123">На следующем рисунке показано одно и то же представление времени для представления About, показанное ранее, но на этот раз с помощью объединения и минификации.</span><span class="sxs-lookup"><span data-stu-id="8880f-123">The following image shows the same timing view of the About view shown previously, but this time with bundling and minification enabled.</span></span>

![](bundling-and-minification/_static/image3.png)

## <a name="minification"></a><span data-ttu-id="8880f-124">Минификации</span><span class="sxs-lookup"><span data-stu-id="8880f-124">Minification</span></span>

<span data-ttu-id="8880f-125">Минификации выполняет различные оптимизации кода для сценариев или CSS, таких как удаление ненужных пробелов и комментариев, а также сокращение имен переменных до одного символа.</span><span class="sxs-lookup"><span data-stu-id="8880f-125">Minification performs a variety of different code optimizations to scripts or css, such as removing unnecessary white space and comments and shortening variable names to one character.</span></span> <span data-ttu-id="8880f-126">Рассмотрим следующую функцию JavaScript.</span><span class="sxs-lookup"><span data-stu-id="8880f-126">Consider the following JavaScript function.</span></span>

[!code-javascript[Main](bundling-and-minification/samples/sample1.js)]

<span data-ttu-id="8880f-127">После минификации функция уменьшается до следующего:</span><span class="sxs-lookup"><span data-stu-id="8880f-127">After minification, the function is reduced to the following:</span></span>

[!code-javascript[Main](bundling-and-minification/samples/sample2.js)]

<span data-ttu-id="8880f-128">Помимо удаления комментариев и ненужных пробелов, следующие параметры и имена переменных были переименованы (сокращены) следующим образом:</span><span class="sxs-lookup"><span data-stu-id="8880f-128">In addition to removing the comments and unnecessary whitespace, the following parameters and variable names were renamed (shortened) as follows:</span></span>

| <span data-ttu-id="8880f-129">**Original**</span><span class="sxs-lookup"><span data-stu-id="8880f-129">**Original**</span></span> | <span data-ttu-id="8880f-130">**Название**</span><span class="sxs-lookup"><span data-stu-id="8880f-130">**Renamed**</span></span> |
| --- | --- |
| <span data-ttu-id="8880f-131">imageTagAndImageID</span><span class="sxs-lookup"><span data-stu-id="8880f-131">imageTagAndImageID</span></span> | <span data-ttu-id="8880f-132">n</span><span class="sxs-lookup"><span data-stu-id="8880f-132">n</span></span> |
| <span data-ttu-id="8880f-133">imageContext</span><span class="sxs-lookup"><span data-stu-id="8880f-133">imageContext</span></span> | <span data-ttu-id="8880f-134">t</span><span class="sxs-lookup"><span data-stu-id="8880f-134">t</span></span> |
| <span data-ttu-id="8880f-135">имажеелемент</span><span class="sxs-lookup"><span data-stu-id="8880f-135">imageElement</span></span> | <span data-ttu-id="8880f-136">i</span><span class="sxs-lookup"><span data-stu-id="8880f-136">i</span></span> |

## <a name="impact-of-bundling-and-minification"></a><span data-ttu-id="8880f-137">Влияние объединения и минификации</span><span class="sxs-lookup"><span data-stu-id="8880f-137">Impact of Bundling and Minification</span></span>

<span data-ttu-id="8880f-138">В следующей таблице приведены некоторые важные различия между выводом списка всех активов по отдельности и использованием объединения и минификации (B/M) в образце программы.</span><span class="sxs-lookup"><span data-stu-id="8880f-138">The following table shows several important differences between listing all the assets individually and using bundling and minification (B/M) in the sample program.</span></span>

|  | <span data-ttu-id="8880f-139">**Использование B/M**</span><span class="sxs-lookup"><span data-stu-id="8880f-139">**Using B/M**</span></span> | <span data-ttu-id="8880f-140">**Без B/M**</span><span class="sxs-lookup"><span data-stu-id="8880f-140">**Without B/M**</span></span> | <span data-ttu-id="8880f-141">**Изменение**</span><span class="sxs-lookup"><span data-stu-id="8880f-141">**Change**</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="8880f-142">**Запросы файлов**</span><span class="sxs-lookup"><span data-stu-id="8880f-142">**File Requests**</span></span> | <span data-ttu-id="8880f-143">9</span><span class="sxs-lookup"><span data-stu-id="8880f-143">9</span></span> | <span data-ttu-id="8880f-144">34</span><span class="sxs-lookup"><span data-stu-id="8880f-144">34</span></span> | <span data-ttu-id="8880f-145">256%</span><span class="sxs-lookup"><span data-stu-id="8880f-145">256%</span></span> |
| <span data-ttu-id="8880f-146">**Отправлено КБ**</span><span class="sxs-lookup"><span data-stu-id="8880f-146">**KB Sent**</span></span> | <span data-ttu-id="8880f-147">3.26</span><span class="sxs-lookup"><span data-stu-id="8880f-147">3.26</span></span> | <span data-ttu-id="8880f-148">11.92</span><span class="sxs-lookup"><span data-stu-id="8880f-148">11.92</span></span> | <span data-ttu-id="8880f-149">266%</span><span class="sxs-lookup"><span data-stu-id="8880f-149">266%</span></span> |
| <span data-ttu-id="8880f-150">**Получено КБ**</span><span class="sxs-lookup"><span data-stu-id="8880f-150">**KB Received**</span></span> | <span data-ttu-id="8880f-151">388.51</span><span class="sxs-lookup"><span data-stu-id="8880f-151">388.51</span></span> | <span data-ttu-id="8880f-152">530</span><span class="sxs-lookup"><span data-stu-id="8880f-152">530</span></span> | <span data-ttu-id="8880f-153">36%</span><span class="sxs-lookup"><span data-stu-id="8880f-153">36%</span></span> |
| <span data-ttu-id="8880f-154">**Время загрузки**</span><span class="sxs-lookup"><span data-stu-id="8880f-154">**Load Time**</span></span> | <span data-ttu-id="8880f-155">510 МС</span><span class="sxs-lookup"><span data-stu-id="8880f-155">510 MS</span></span> | <span data-ttu-id="8880f-156">780 МС</span><span class="sxs-lookup"><span data-stu-id="8880f-156">780 MS</span></span> | <span data-ttu-id="8880f-157">53%</span><span class="sxs-lookup"><span data-stu-id="8880f-157">53%</span></span> |

<span data-ttu-id="8880f-158">Отправленные байты были значительно сокращены с объединением, так как браузеры довольно подробно используют заголовки HTTP, которые они применяют к запросам.</span><span class="sxs-lookup"><span data-stu-id="8880f-158">The bytes sent had a significant reduction with bundling as browsers are fairly verbose with the HTTP headers they apply on requests.</span></span> <span data-ttu-id="8880f-159">Сокращение полученных байтов не так велико, так как самые большие файлы (*скрипты\\жкуери-УИ-1.8.11. min. js* и *Scripts\\жкуери-1.7.1. min. js*) уже являются минифицированные.</span><span class="sxs-lookup"><span data-stu-id="8880f-159">The received bytes reduction is not as large because the largest files (*Scripts\\jquery-ui-1.8.11.min.js* and *Scripts\\jquery-1.7.1.min.js*) are already minified.</span></span> <span data-ttu-id="8880f-160">Примечание. временные показатели в образце программы использовали средство [Fiddler](http://www.fiddler2.com/fiddler2/) для имитации скорости сети.</span><span class="sxs-lookup"><span data-stu-id="8880f-160">Note: The timings on the sample program used the [Fiddler](http://www.fiddler2.com/fiddler2/) tool to simulate a slow network.</span></span> <span data-ttu-id="8880f-161">(В меню **правила** Fiddler выберите **производительность** , а затем — **Эмуляция скорости модема**.)</span><span class="sxs-lookup"><span data-stu-id="8880f-161">(From the Fiddler **Rules** menu, select **Performance** then **Simulate Modem Speeds**.)</span></span>

## <a name="debugging-bundled-and-minified-javascript"></a><span data-ttu-id="8880f-162">Отладка пакетов и Минифицированные JavaScript</span><span class="sxs-lookup"><span data-stu-id="8880f-162">Debugging Bundled and Minified JavaScript</span></span>

<span data-ttu-id="8880f-163">Отладку JavaScript можно выполнить в среде разработки (где [элементу компиляции](https://msdn.microsoft.com/library/s10awwz0.aspx) в файле *Web. config* присваивается значение `debug="true"`), так как файлы JavaScript не упакованы или не минифицированные.</span><span class="sxs-lookup"><span data-stu-id="8880f-163">It's easy to debug your JavaScript in a development environment (where the [compilation Element](https://msdn.microsoft.com/library/s10awwz0.aspx) in the *Web.config* file is set to `debug="true"` ) because the JavaScript files are not bundled or minified.</span></span> <span data-ttu-id="8880f-164">Также можно выполнить отладку сборки выпуска, в которой файлы JavaScript объединены в пакеты и минифицированные.</span><span class="sxs-lookup"><span data-stu-id="8880f-164">You can also debug a release build where your JavaScript files are bundled and minified.</span></span> <span data-ttu-id="8880f-165">Используя средства разработчика F12 для IE, вы отлаживать функцию JavaScript, включенную в пакет минифицированные, с помощью следующего подхода:</span><span class="sxs-lookup"><span data-stu-id="8880f-165">Using the IE F12 developer tools, you debug a JavaScript function included in a minified bundle using the following approach:</span></span>

1. <span data-ttu-id="8880f-166">Перейдите на вкладку **Скрипт** , а затем нажмите кнопку **начать отладку** .</span><span class="sxs-lookup"><span data-stu-id="8880f-166">Select the **Script** tab and then select the **Start debugging** button.</span></span>
2. <span data-ttu-id="8880f-167">Выберите набор, содержащий функцию JavaScript, которую необходимо отладить, с помощью кнопки активы.</span><span class="sxs-lookup"><span data-stu-id="8880f-167">Select the bundle containing the JavaScript function you want to debug using the assets button.</span></span>  
    ![](bundling-and-minification/_static/image4.png)
3. <span data-ttu-id="8880f-168">Отформатируйте минифицированные JavaScript, нажав **кнопку конфигурация** ![](bundling-and-minification/_static/image5.png)и выбрав **Формат JavaScript**.</span><span class="sxs-lookup"><span data-stu-id="8880f-168">Format the minified JavaScript by selecting the **Configuration button** ![](bundling-and-minification/_static/image5.png), and then selecting **Format JavaScript**.</span></span>
4. <span data-ttu-id="8880f-169">В поле Ввод **скрипта поиска** выберите имя функции, которую требуется отладить.</span><span class="sxs-lookup"><span data-stu-id="8880f-169">In the **Search Script** input box, select the name of the function you want to debug.</span></span> <span data-ttu-id="8880f-170">На следующем рисунке **аддалттоимг** был введен в поле ввода **скрипта поиска** .</span><span class="sxs-lookup"><span data-stu-id="8880f-170">In the following image, **AddAltToImg** was entered in the **Search Script** input box.</span></span>  
    ![](bundling-and-minification/_static/image6.png)

<span data-ttu-id="8880f-171">Дополнительные сведения об отладке с помощью средств разработчика F12 см. в статье MSDN [использование средства для разработчиков F12 для отладки ошибок JavaScript](https://msdn.microsoft.com/library/ie/gg699336(v=vs.85).aspx).</span><span class="sxs-lookup"><span data-stu-id="8880f-171">For more information on debugging with the F12 developer tools, see the MSDN article [Using the F12 Developer Tools to Debug JavaScript Errors](https://msdn.microsoft.com/library/ie/gg699336(v=vs.85).aspx).</span></span>

## <a name="controlling-bundling-and-minification"></a><span data-ttu-id="8880f-172">Управление объединением и минификации</span><span class="sxs-lookup"><span data-stu-id="8880f-172">Controlling Bundling and Minification</span></span>

<span data-ttu-id="8880f-173">Объединение и минификации включаются или отключаются путем установки значения атрибута Debug в [элементе compilation](https://msdn.microsoft.com/library/s10awwz0.aspx) в файле *Web. config* .</span><span class="sxs-lookup"><span data-stu-id="8880f-173">Bundling and minification is enabled or disabled by setting the value of the debug attribute in the [compilation Element](https://msdn.microsoft.com/library/s10awwz0.aspx)  in the *Web.config* file.</span></span> <span data-ttu-id="8880f-174">В следующем XML `debug` имеет значение true, поэтому объединение и минификации отключено.</span><span class="sxs-lookup"><span data-stu-id="8880f-174">In the following XML, `debug` is set to true so bundling and minification is disabled.</span></span>

[!code-xml[Main](bundling-and-minification/samples/sample3.xml?highlight=2)]

<span data-ttu-id="8880f-175">Чтобы включить объединение и минификации, задайте для `debug` значение false.</span><span class="sxs-lookup"><span data-stu-id="8880f-175">To enable bundling and minification, set the `debug` value to "false".</span></span> <span data-ttu-id="8880f-176">Параметр *Web. config* можно переопределить с помощью свойства `EnableOptimizations` в классе `BundleTable`.</span><span class="sxs-lookup"><span data-stu-id="8880f-176">You can override the *Web.config* setting with the `EnableOptimizations` property on the `BundleTable` class.</span></span> <span data-ttu-id="8880f-177">Следующий код включает объединение и минификации и переопределяет любой параметр в файле *Web. config* .</span><span class="sxs-lookup"><span data-stu-id="8880f-177">The following code enables bundling and minification and overrides any setting in the *Web.config* file.</span></span>

[!code-csharp[Main](bundling-and-minification/samples/sample4.cs?highlight=7)]

> [!NOTE]
> <span data-ttu-id="8880f-178">Если `EnableOptimizations` не `true` или атрибут Debug в [элементе compilation](https://msdn.microsoft.com/library/s10awwz0.aspx) в файле *Web. config* имеет значение `false`, файлы не будут объединены или минифицированные.</span><span class="sxs-lookup"><span data-stu-id="8880f-178">Unless `EnableOptimizations` is `true` or the debug attribute in the [compilation Element](https://msdn.microsoft.com/library/s10awwz0.aspx)  in the *Web.config* file is set to `false`, files will not be bundled or minified.</span></span> <span data-ttu-id="8880f-179">Кроме того, не будет использоваться минимальная версия файлов, будут выбраны полные отладочные версии.</span><span class="sxs-lookup"><span data-stu-id="8880f-179">Additionally, the .min version of files will not be used, the full debug versions will be selected.</span></span> <span data-ttu-id="8880f-180">`EnableOptimizations` переопределяет атрибут Debug в [элементе compilation](https://msdn.microsoft.com/library/s10awwz0.aspx) файла *Web. config*</span><span class="sxs-lookup"><span data-stu-id="8880f-180">`EnableOptimizations` overrides the debug attribute in the [compilation Element](https://msdn.microsoft.com/library/s10awwz0.aspx)  in the *Web.config* file</span></span>

## <a name="using-bundling-and-minification-with-aspnet-web-forms-and-web-pages"></a><span data-ttu-id="8880f-181">Использование объединения и минификации с веб-формами ASP.NET и веб-страницами</span><span class="sxs-lookup"><span data-stu-id="8880f-181">Using Bundling and Minification with ASP.NET Web Forms and Web Pages</span></span>

- <span data-ttu-id="8880f-182">Для веб-страниц см. запись блога [Добавление веб-оптимизации на сайт веб-страниц](https://docs.microsoft.com/archive/blogs/rickandy/adding-web-optimization-to-a-web-pages-site).</span><span class="sxs-lookup"><span data-stu-id="8880f-182">For Web Pages, see the blog entry [Adding Web Optimization to a Web Pages Site](https://docs.microsoft.com/archive/blogs/rickandy/adding-web-optimization-to-a-web-pages-site).</span></span>
- <span data-ttu-id="8880f-183">Сведения о веб-формах см. в записи блога [Добавление объединения и минификации в веб-формы](https://docs.microsoft.com/archive/blogs/rickandy/adding-bundling-and-minification-to-web-forms).</span><span class="sxs-lookup"><span data-stu-id="8880f-183">For Web Forms, see the blog entry [Adding Bundling and Minification to Web Forms](https://docs.microsoft.com/archive/blogs/rickandy/adding-bundling-and-minification-to-web-forms).</span></span>

## <a name="using-bundling-and-minification-with-aspnet-mvc"></a><span data-ttu-id="8880f-184">Использование объединения и минификации с ASP.NET MVC</span><span class="sxs-lookup"><span data-stu-id="8880f-184">Using Bundling and Minification with ASP.NET MVC</span></span>

<span data-ttu-id="8880f-185">В этом разделе мы создадим проект ASP.NET MVC для изучения объединения и минификации.</span><span class="sxs-lookup"><span data-stu-id="8880f-185">In this section we will create an ASP.NET MVC project to examine bundling and minification.</span></span> <span data-ttu-id="8880f-186">Сначала создайте новый Интернет-проект ASP.NET MVC с именем **мвкбм** , не изменяя значения по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="8880f-186">First, create a new ASP.NET MVC internet project named **MvcBM** without changing any of the defaults.</span></span>

<span data-ttu-id="8880f-187">Откройте *\\приложения \_запустите\\файл BundleConfig.CS* и изучите метод `RegisterBundles`, который используется для создания, регистрации и настройки пакетов.</span><span class="sxs-lookup"><span data-stu-id="8880f-187">Open the *App\\\_Start\\BundleConfig.cs* file and examine the `RegisterBundles` method which is used to create, register and configure bundles.</span></span> <span data-ttu-id="8880f-188">В следующем коде показана часть метода `RegisterBundles`.</span><span class="sxs-lookup"><span data-stu-id="8880f-188">The following code shows a portion of the `RegisterBundles` method.</span></span>

[!code-csharp[Main](bundling-and-minification/samples/sample5.cs)]

<span data-ttu-id="8880f-189">Приведенный выше код создает новый пакет JavaScript с именем *~/бундлес/жкуери* , который включает все подходящие (то есть Debug или минифицированные, но не. *всдок*) файлы в папке *Scripts* , соответствующие подстановочной строке "~/скриптс/жкуери-{версион}.ЖС".</span><span class="sxs-lookup"><span data-stu-id="8880f-189">The  preceding code creates a new JavaScript bundle named *~/bundles/jquery* that includes all the appropriate (that is debug or minified but not .*vsdoc*) files in the *Scripts* folder that match the wild card string "~/Scripts/jquery-{version}.js".</span></span> <span data-ttu-id="8880f-190">Для ASP.NET MVC 4 это означает с отладочной конфигурацией, файл *жкуери-1.7.1. js* будет добавлен в пакет.</span><span class="sxs-lookup"><span data-stu-id="8880f-190">For ASP.NET MVC 4, this means with a debug configuration, the file *jquery-1.7.1.js* will be added to the bundle.</span></span> <span data-ttu-id="8880f-191">В конфигурации выпуска будет добавлен *жкуери-1.7.1. min. js* .</span><span class="sxs-lookup"><span data-stu-id="8880f-191">In a release configuration, *jquery-1.7.1.min.js* will be added.</span></span> <span data-ttu-id="8880f-192">Платформа объединения использует несколько общих соглашений, таких как:</span><span class="sxs-lookup"><span data-stu-id="8880f-192">The bundling framework follows several common conventions such as:</span></span>

- <span data-ttu-id="8880f-193">При наличии *филекс. min. js* и *филекс. js* выбирается файл ". min" для выпуска.</span><span class="sxs-lookup"><span data-stu-id="8880f-193">Selecting ".min" file for release when *FileX.min.js* and *FileX.js* exist.</span></span>
- <span data-ttu-id="8880f-194">Выбор версии, отличной от ". min", для отладки.</span><span class="sxs-lookup"><span data-stu-id="8880f-194">Selecting the non ".min" version for debug.</span></span>
- <span data-ttu-id="8880f-195">Пропуск файлов "-всдок" (например, *жкуери-1.7.1-всдок. js*), которые используются только технологией IntelliSense.</span><span class="sxs-lookup"><span data-stu-id="8880f-195">Ignoring "-vsdoc" files (such as *jquery-1.7.1-vsdoc.js*), which are used only by IntelliSense.</span></span>

<span data-ttu-id="8880f-196">Подстановочные знаки `{version}`, показанные выше, используются для автоматического создания пакета jQuery с соответствующей версией jQuery в папке *Scripts* .</span><span class="sxs-lookup"><span data-stu-id="8880f-196">The `{version}` wild card matching shown above is used to automatically create a jQuery bundle with the appropriate version of jQuery in your *Scripts* folder.</span></span> <span data-ttu-id="8880f-197">В этом примере использование подстановочных знаков предоставляет следующие преимущества:</span><span class="sxs-lookup"><span data-stu-id="8880f-197">In this example, using a wild card provides the following benefits:</span></span>

- <span data-ttu-id="8880f-198">Позволяет использовать NuGet для обновления до более новой версии jQuery, не изменяя предыдущий код объединения или ссылки jQuery на страницах представления.</span><span class="sxs-lookup"><span data-stu-id="8880f-198">Allows you to use NuGet to update to a newer jQuery version without changing the preceding bundling code or jQuery references in your view pages.</span></span>
- <span data-ttu-id="8880f-199">Автоматически выбирает полную версию для конфигураций отладки и версию ". min" для сборок выпуска.</span><span class="sxs-lookup"><span data-stu-id="8880f-199">Automatically selects the full version for debug configurations and the ".min" version for release builds.</span></span>

## <a name="using-a-cdn"></a><span data-ttu-id="8880f-200">Использование CDN</span><span class="sxs-lookup"><span data-stu-id="8880f-200">Using a CDN</span></span>

 <span data-ttu-id="8880f-201">Следующий код заменяет локальный пакет jQuery на пакет CDN jQuery.</span><span class="sxs-lookup"><span data-stu-id="8880f-201">The follow code replaces the local jQuery bundle with a CDN jQuery bundle.</span></span>

[!code-csharp[Main](bundling-and-minification/samples/sample6.cs)]

<span data-ttu-id="8880f-202">В приведенном выше коде jQuery будет запрашиваться из CDN в режиме выпуска, а отладочная версия jQuery будет выбрана локально в режиме отладки.</span><span class="sxs-lookup"><span data-stu-id="8880f-202">In the code above, jQuery will be requested from the CDN while in release mode and the debug version of jQuery will be fetched locally in debug mode.</span></span> <span data-ttu-id="8880f-203">При использовании CDN необходимо использовать резервный механизм в случае сбоя запроса CDN.</span><span class="sxs-lookup"><span data-stu-id="8880f-203">When using a CDN, you should have a fallback mechanism in case the CDN request fails.</span></span> <span data-ttu-id="8880f-204">Следующий фрагмент разметки из конца файла макета показывает скрипт, добавленный в запрос jQuery, в случае сбоя CDN.</span><span class="sxs-lookup"><span data-stu-id="8880f-204">The following markup fragment from the end of the layout file shows script added to request jQuery should the CDN fail.</span></span>

[!code-cshtml[Main](bundling-and-minification/samples/sample7.cshtml?highlight=5-13)]

## <a name="creating-a-bundle"></a><span data-ttu-id="8880f-205">Создание пакета</span><span class="sxs-lookup"><span data-stu-id="8880f-205">Creating a Bundle</span></span>

<span data-ttu-id="8880f-206">Класс [пакета](https://msdn.microsoft.com/library/system.web.optimization.bundle(v=VS.110).aspx) `Include` метод принимает массив строк, где каждая строка является виртуальным путем к ресурсу.</span><span class="sxs-lookup"><span data-stu-id="8880f-206">The [Bundle](https://msdn.microsoft.com/library/system.web.optimization.bundle(v=VS.110).aspx) class `Include` method takes an array of strings, where each string is a virtual path to resource.</span></span> <span data-ttu-id="8880f-207">В следующем коде из метода `RegisterBundles` в *приложении\\\_Start\\файл BundleConfig.CS* показано, как добавить несколько файлов в пакет:</span><span class="sxs-lookup"><span data-stu-id="8880f-207">The following code from the `RegisterBundles` method in the *App\\\_Start\\BundleConfig.cs* file shows how multiple files are added to a bundle:</span></span>

[!code-csharp[Main](bundling-and-minification/samples/sample8.cs)]

<span data-ttu-id="8880f-208">Для добавления всех файлов в каталоге (и при необходимости всех подкаталогов), соответствующих шаблону поиска, предоставляется метод `IncludeDirectory` класса [пакета](https://msdn.microsoft.com/library/system.web.optimization.bundle(v=VS.110).aspx) .</span><span class="sxs-lookup"><span data-stu-id="8880f-208">The [Bundle](https://msdn.microsoft.com/library/system.web.optimization.bundle(v=VS.110).aspx) class `IncludeDirectory` method is provided to add all the files in a directory (and optionally all subdirectories) which match a search pattern.</span></span> <span data-ttu-id="8880f-209">Класс [пакета](https://msdn.microsoft.com/library/system.web.optimization.bundle(v=VS.110).aspx) `IncludeDirectory` API показан ниже:</span><span class="sxs-lookup"><span data-stu-id="8880f-209">The [Bundle](https://msdn.microsoft.com/library/system.web.optimization.bundle(v=VS.110).aspx) class `IncludeDirectory` API is shown below:</span></span>

[!code-csharp[Main](bundling-and-minification/samples/sample9.cs)]

<span data-ttu-id="8880f-210">В представлениях, использующих метод Render (`Styles.Render` для CSS и `Scripts.Render` для JavaScript), используются ссылки на пакеты.</span><span class="sxs-lookup"><span data-stu-id="8880f-210">Bundles are referenced in views using the Render method, (`Styles.Render` for CSS and `Scripts.Render` for JavaScript).</span></span> <span data-ttu-id="8880f-211">Следующая разметка из файла *views\\shared\\\_Layout. cshtml* показывает, как представления Интернет по умолчанию ASP.NET Internet Project ссылаются на пакеты CSS и JavaScript.</span><span class="sxs-lookup"><span data-stu-id="8880f-211">The following markup from the *Views\\Shared\\\_Layout.cshtml* file shows how the default ASP.NET internet project views reference CSS and JavaScript bundles.</span></span>

[!code-cshtml[Main](bundling-and-minification/samples/sample10.cshtml?highlight=5-6,11)]

<span data-ttu-id="8880f-212">Обратите внимание, что методы рендеринга принимают массив строк, поэтому можно добавить несколько пакетов в одной строке кода.</span><span class="sxs-lookup"><span data-stu-id="8880f-212">Notice the Render methods takes an array of strings, so you can add multiple bundles in one line of code.</span></span> <span data-ttu-id="8880f-213">Как правило, необходимо использовать методы рендеринга, которые создают необходимый HTML-код для ссылки на ресурс.</span><span class="sxs-lookup"><span data-stu-id="8880f-213">You will generally want to use the Render methods which create the necessary HTML to reference the asset.</span></span> <span data-ttu-id="8880f-214">Можно использовать метод `Url`, чтобы создать URL-адрес ресурса без разметки, необходимой для ссылки на ресурс.</span><span class="sxs-lookup"><span data-stu-id="8880f-214">You can use the `Url` method to generate the URL to the asset without the markup needed to reference the asset.</span></span> <span data-ttu-id="8880f-215">Предположим, что вы хотите использовать новый [асинхронный](http://www.whatwg.org/specs/web-apps/current-work/#attr-script-async) атрибут HTML5.</span><span class="sxs-lookup"><span data-stu-id="8880f-215">Suppose you wanted to use the new HTML5 [async](http://www.whatwg.org/specs/web-apps/current-work/#attr-script-async) attribute.</span></span> <span data-ttu-id="8880f-216">В следующем коде показано, как сослаться на Modernizr с помощью метода `Url`.</span><span class="sxs-lookup"><span data-stu-id="8880f-216">The following code shows how to reference modernizr using the `Url` method.</span></span>

[!code-cshtml[Main](bundling-and-minification/samples/sample11.cshtml?highlight=11)]

## <a name="using-the--wildcard-character-to-select-files"></a><span data-ttu-id="8880f-217">Использование подстановочного знака "\*" для выбора файлов</span><span class="sxs-lookup"><span data-stu-id="8880f-217">Using the "\*" Wildcard Character to Select Files</span></span>

<span data-ttu-id="8880f-218">Виртуальный путь, указанный в методе `Include` и шаблоне поиска в методе `IncludeDirectory`, может принимать один символ-шаблон "\*" в качестве префикса или суффикса в последнем сегменте пути.</span><span class="sxs-lookup"><span data-stu-id="8880f-218">The virtual path specified in the `Include` method and the search pattern in the `IncludeDirectory` method can accept one "\*" wildcard character as a prefix or suffix to in the last path segment.</span></span> <span data-ttu-id="8880f-219">В строке поиска учитывается регистр.</span><span class="sxs-lookup"><span data-stu-id="8880f-219">The search string is case insensitive.</span></span> <span data-ttu-id="8880f-220">Метод `IncludeDirectory` позволяет выполнять поиск в подкаталогах.</span><span class="sxs-lookup"><span data-stu-id="8880f-220">The `IncludeDirectory` method has the option of searching subdirectories.</span></span>

<span data-ttu-id="8880f-221">Рассмотрим проект со следующими файлами JavaScript:</span><span class="sxs-lookup"><span data-stu-id="8880f-221">Consider a project with the following JavaScript files:</span></span>

- <span data-ttu-id="8880f-222">*Сценарии\\Common\\Аддалттоимг. js*</span><span class="sxs-lookup"><span data-stu-id="8880f-222">*Scripts\\Common\\AddAltToImg.js*</span></span>
- <span data-ttu-id="8880f-223">*Сценарии\\Common\\Тоггледив. js*</span><span class="sxs-lookup"><span data-stu-id="8880f-223">*Scripts\\Common\\ToggleDiv.js*</span></span>
- <span data-ttu-id="8880f-224">*Сценарии\\Common\\Тогглеимг. js*</span><span class="sxs-lookup"><span data-stu-id="8880f-224">*Scripts\\Common\\ToggleImg.js*</span></span>
- <span data-ttu-id="8880f-225">*Сценарии\\Common\\Sub1\\Тогглелинкс. js*</span><span class="sxs-lookup"><span data-stu-id="8880f-225">*Scripts\\Common\\Sub1\\ToggleLinks.js*</span></span>

![dir ин](bundling-and-minification/_static/image7.png)

<span data-ttu-id="8880f-227">В следующей таблице приведены файлы, добавленные в пакет с помощью подстановочного знака, как показано ниже.</span><span class="sxs-lookup"><span data-stu-id="8880f-227">The following table shows the files added to a bundle using the wildcard as shown:</span></span>

| <span data-ttu-id="8880f-228">**Call**</span><span class="sxs-lookup"><span data-stu-id="8880f-228">**Call**</span></span> | <span data-ttu-id="8880f-229">**Добавлено файлов или вызвано исключение**</span><span class="sxs-lookup"><span data-stu-id="8880f-229">**Files Added or Exception Raised**</span></span> |
| --- | --- |
| <span data-ttu-id="8880f-230">Include ("~/Скриптс/Коммон/\*. js")</span><span class="sxs-lookup"><span data-stu-id="8880f-230">Include("~/Scripts/Common/\*.js")</span></span> | <span data-ttu-id="8880f-231">*Аддалттоимг. js*, *тоггледив. js*, *тогглеимг. js*</span><span class="sxs-lookup"><span data-stu-id="8880f-231">*AddAltToImg.js*, *ToggleDiv.js*, *ToggleImg.js*</span></span> |
| <span data-ttu-id="8880f-232">Include ("~/Скриптс/Коммон/т\*. js")</span><span class="sxs-lookup"><span data-stu-id="8880f-232">Include("~/Scripts/Common/T\*.js")</span></span> | <span data-ttu-id="8880f-233">Недопустимое исключение шаблона.</span><span class="sxs-lookup"><span data-stu-id="8880f-233">Invalid pattern exception.</span></span> <span data-ttu-id="8880f-234">Подстановочный знак допускается только для префикса или суффикса.</span><span class="sxs-lookup"><span data-stu-id="8880f-234">The wildcard character is only allowed on the prefix or suffix.</span></span> |
| <span data-ttu-id="8880f-235">Include ("~/Скриптс/Коммон/\*OG.\*")</span><span class="sxs-lookup"><span data-stu-id="8880f-235">Include("~/Scripts/Common/\*og.\*")</span></span> | <span data-ttu-id="8880f-236">Недопустимое исключение шаблона.</span><span class="sxs-lookup"><span data-stu-id="8880f-236">Invalid pattern exception.</span></span> <span data-ttu-id="8880f-237">Допускается только один подстановочный знак.</span><span class="sxs-lookup"><span data-stu-id="8880f-237">Only one wildcard character is allowed.</span></span> |
| <span data-ttu-id="8880f-238">Include ("~/Скриптс/Коммон/т\*")</span><span class="sxs-lookup"><span data-stu-id="8880f-238">Include("~/Scripts/Common/T\*")</span></span> | <span data-ttu-id="8880f-239">*Тоггледив. js*, *тогглеимг. js*</span><span class="sxs-lookup"><span data-stu-id="8880f-239">*ToggleDiv.js*, *ToggleImg.js*</span></span> |
| <span data-ttu-id="8880f-240">Include ("~/Скриптс/Коммон/\*")</span><span class="sxs-lookup"><span data-stu-id="8880f-240">Include("~/Scripts/Common/\*")</span></span> | <span data-ttu-id="8880f-241">Недопустимое исключение шаблона.</span><span class="sxs-lookup"><span data-stu-id="8880f-241">Invalid pattern exception.</span></span> <span data-ttu-id="8880f-242">Недопустимый сегмент нестрогого шаблона.</span><span class="sxs-lookup"><span data-stu-id="8880f-242">A pure wildcard segment is not valid.</span></span> |
| <span data-ttu-id="8880f-243">Инклудедиректори ("~/Скриптс/Коммон", "T\*")</span><span class="sxs-lookup"><span data-stu-id="8880f-243">IncludeDirectory("~/Scripts/Common", "T\*")</span></span> | <span data-ttu-id="8880f-244">*Тоггледив. js*, *тогглеимг. js*</span><span class="sxs-lookup"><span data-stu-id="8880f-244">*ToggleDiv.js*, *ToggleImg.js*</span></span> |
| <span data-ttu-id="8880f-245">Инклудедиректори ("~/Скриптс/Коммон", "T\*", true)</span><span class="sxs-lookup"><span data-stu-id="8880f-245">IncludeDirectory("~/Scripts/Common", "T\*", true)</span></span> | <span data-ttu-id="8880f-246">*Тоггледив. js*, *тогглеимг. js*, *тогглелинкс. js*</span><span class="sxs-lookup"><span data-stu-id="8880f-246">*ToggleDiv.js*, *ToggleImg.js*, *ToggleLinks.js*</span></span> |

<span data-ttu-id="8880f-247">Явное добавление каждого файла в пакет, как правило, является предпочтительным по сравнению с загрузкой файлов по шаблону по следующим причинам.</span><span class="sxs-lookup"><span data-stu-id="8880f-247">Explicitly adding each file to a bundle is generally the preferred over wildcard loading of files for the following reasons:</span></span>

- <span data-ttu-id="8880f-248">Добавление скриптов по умолчанию для их загрузки в алфавитном порядке, которое обычно не требуется.</span><span class="sxs-lookup"><span data-stu-id="8880f-248">Adding scripts by wildcard defaults to loading them in alphabetical order, which is typically not what you want.</span></span> <span data-ttu-id="8880f-249">Файлы CSS и JavaScript часто приходится добавлять в конкретный (не алфавитный) порядок.</span><span class="sxs-lookup"><span data-stu-id="8880f-249">CSS and JavaScript files frequently need to be added in a specific (non-alphabetic) order.</span></span> <span data-ttu-id="8880f-250">Вы можете уменьшить этот риск, добавив пользовательскую реализацию [ибундлеордерер](https://msdn.microsoft.com/library/system.web.optimization.ibundleorderer(VS.110).aspx) , но явно добавлять каждый файл с ошибками менее вероятно.</span><span class="sxs-lookup"><span data-stu-id="8880f-250">You can mitigate this risk by adding a custom [IBundleOrderer](https://msdn.microsoft.com/library/system.web.optimization.ibundleorderer(VS.110).aspx) implementation, but explicitly adding each file is less error prone.</span></span> <span data-ttu-id="8880f-251">Например, вы можете добавить новые ресурсы в папку в будущем, что может потребовать изменения реализации [ибундлеордерер](https://msdn.microsoft.com/library/system.web.optimization.ibundleorderer(VS.110).aspx) .</span><span class="sxs-lookup"><span data-stu-id="8880f-251">For example, you might add new assets to a folder in the future which might require you to modify your [IBundleOrderer](https://msdn.microsoft.com/library/system.web.optimization.ibundleorderer(VS.110).aspx) implementation.</span></span>
- <span data-ttu-id="8880f-252">Просмотр конкретных файлов, добавленных в каталог с использованием подстановочных знаков, может включаться во все представления, ссылающиеся на этот пакет.</span><span class="sxs-lookup"><span data-stu-id="8880f-252">View specific files added to a directory using wild card loading can be included in all views referencing that bundle.</span></span> <span data-ttu-id="8880f-253">Если скрипт для представления добавляется в пакет, может возникнуть ошибка JavaScript для других представлений, ссылающихся на пакет.</span><span class="sxs-lookup"><span data-stu-id="8880f-253">If the view specific script is added to a bundle, you may get a JavaScript error on other views that reference the bundle.</span></span>
- <span data-ttu-id="8880f-254">Файлы CSS, которые импортируют другие файлы, приводят к тому, что импортированные файлы дважды загружаются.</span><span class="sxs-lookup"><span data-stu-id="8880f-254">CSS files that import other files result in the imported files loaded twice.</span></span> <span data-ttu-id="8880f-255">Например, следующий код создает пакет с большинством файлов CSS темы пользовательского интерфейса jQuery, загруженных дважды.</span><span class="sxs-lookup"><span data-stu-id="8880f-255">For example, the following code creates a bundle with most of the jQuery UI theme CSS files loaded twice.</span></span> 

    [!code-csharp[Main](bundling-and-minification/samples/sample12.cs)]

  <span data-ttu-id="8880f-256">Селектор подстановочного знака "\*. CSS" помещает в каждый файл CSS в папке, включая *содержимое\\темы\\базовому файлу\\jQuery. UI. ALL. CSS* .</span><span class="sxs-lookup"><span data-stu-id="8880f-256">The wild card selector "\*.css" brings in each CSS file in the folder, including the *Content\\themes\\base\\jquery.ui.all.css* file.</span></span> <span data-ttu-id="8880f-257">Файл *jQuery. UI. ALL. CSS* импортирует другие файлы CSS.</span><span class="sxs-lookup"><span data-stu-id="8880f-257">The *jquery.ui.all.css* file imports other CSS files.</span></span>

## <a name="bundle-caching"></a><span data-ttu-id="8880f-258">Кэширование пакета</span><span class="sxs-lookup"><span data-stu-id="8880f-258">Bundle Caching</span></span>

<span data-ttu-id="8880f-259">Пакеты задают заголовок HTTP Expires по истечении одного года из при создании пакета.</span><span class="sxs-lookup"><span data-stu-id="8880f-259">Bundles set the HTTP Expires Header one year from when the bundle is created.</span></span> <span data-ttu-id="8880f-260">При переходе к ранее просмотренной странице Fiddler показывает, что IE не выполняет условный запрос для пакета, то есть нет HTTP-запросов GET из IE для пакетов и ответов HTTP 304 с сервера.</span><span class="sxs-lookup"><span data-stu-id="8880f-260">If you navigate to a previously viewed page, Fiddler shows IE does not make a conditional request for the bundle, that is, there are no HTTP GET requests from IE for the bundles and no HTTP 304 responses from the server.</span></span> <span data-ttu-id="8880f-261">Можно принудительно настроить в IE условный запрос для каждого пакета с помощью клавиши F5 (в результате чего HTTP-ответ 304 для каждого пакета).</span><span class="sxs-lookup"><span data-stu-id="8880f-261">You can force IE to make a conditional request for each bundle with the F5 key (resulting in a HTTP 304 response for each bundle).</span></span> <span data-ttu-id="8880f-262">Можно принудительно выполнить полное обновление с помощью команды ^ F5 (в результате чего HTTP 200 отклика для каждого пакета).</span><span class="sxs-lookup"><span data-stu-id="8880f-262">You can force a full refresh by using ^F5 (resulting in a HTTP 200 response for each bundle.)</span></span>

<span data-ttu-id="8880f-263">На следующем рисунке показана вкладка **кэширование** панели отклика Fiddler:</span><span class="sxs-lookup"><span data-stu-id="8880f-263">The following image shows the **Caching** tab of the Fiddler response pane:</span></span>

![изображение кэширования Fiddler](bundling-and-minification/_static/image8.png)

<span data-ttu-id="8880f-265">Запрос</span><span class="sxs-lookup"><span data-stu-id="8880f-265">The request</span></span>   
`http://localhost/MvcBM_time/bundles/AllMyScripts?v=r0sLDicvP58AIXN_mc3QdyVvVj5euZNzdsa2N1PKvb81`  
 <span data-ttu-id="8880f-266">предназначен для пакета **аллмискриптс** и содержит пару строк запроса **v = R0sLDicvP58AIXN\\\_mc3QdyVvVj5euZNzdsa2N1PKvb81**.</span><span class="sxs-lookup"><span data-stu-id="8880f-266">is for the bundle **AllMyScripts** and contains a query string pair **v=r0sLDicvP58AIXN\\\_mc3QdyVvVj5euZNzdsa2N1PKvb81**.</span></span> <span data-ttu-id="8880f-267">Строка запроса **v** имеет маркер значения, который является уникальным идентификатором, используемым для кэширования.</span><span class="sxs-lookup"><span data-stu-id="8880f-267">The query string **v** has a value token that is a unique identifier used for caching.</span></span> <span data-ttu-id="8880f-268">Пока пакет не изменится, приложение ASP.NET запросит пакет **аллмискриптс** с помощью этого маркера.</span><span class="sxs-lookup"><span data-stu-id="8880f-268">As long as the bundle doesn't change, the ASP.NET application will request the **AllMyScripts** bundle using this token.</span></span> <span data-ttu-id="8880f-269">Если какой-либо файл в пакете изменится, платформа оптимизации ASP.NET создаст новый маркер, гарантируя, что запросы в браузере для пакета будут получать последнюю версию пакета.</span><span class="sxs-lookup"><span data-stu-id="8880f-269">If any file in the bundle changes, the ASP.NET optimization framework will generate a new token, guaranteeing that browser requests for the bundle will get the latest bundle.</span></span>

<span data-ttu-id="8880f-270">При запуске средств разработчика IE9 F12 и переходе к ранее загруженной странице IE неправильно отображает условные запросы GET для каждого пакета и сервер, возвращающий HTTP 304.</span><span class="sxs-lookup"><span data-stu-id="8880f-270">If you run the IE9 F12 developer tools and navigate to a previously loaded page, IE incorrectly shows conditional GET requests made to each bundle and the server returning HTTP 304.</span></span> <span data-ttu-id="8880f-271">Вы можете прочитать, почему у IE9 есть проблемы с определением условного запроса в записи блога [с помощью CDN и истечения срока действия для улучшения производительности веб-сайта](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx).</span><span class="sxs-lookup"><span data-stu-id="8880f-271">You can read why IE9 has problems determining if a conditional request was made in the blog entry [Using CDNs and Expires to Improve Web Site Performance](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx).</span></span>

## <a name="less-coffeescript-scss-sass-bundling"></a><span data-ttu-id="8880f-272">"Меньше, CoffeeScript, SCSS," — объединение "Sasser".</span><span class="sxs-lookup"><span data-stu-id="8880f-272">LESS, CoffeeScript, SCSS, Sass Bundling.</span></span>

<span data-ttu-id="8880f-273">Платформа для объединения и минификации предоставляет механизм для обработки промежуточных языков, таких как [SCSS](http://sass-lang.com/), [Sasser](http://sass-lang.com/), [less](http://www.dotlesscss.org/) или [CoffeeScript](http://coffeescript.org/), и применения преобразований, таких как минификации, к результирующему набору.</span><span class="sxs-lookup"><span data-stu-id="8880f-273">The bundling and minification framework provides a mechanism to process intermediate languages such as [SCSS](http://sass-lang.com/), [Sass](http://sass-lang.com/), [LESS](http://www.dotlesscss.org/) or [Coffeescript](http://coffeescript.org/), and apply transforms such as minification to the resulting bundle.</span></span> <span data-ttu-id="8880f-274">Например, чтобы добавить файлы [. less](http://www.dotlesscss.org/) в проект MVC 4:</span><span class="sxs-lookup"><span data-stu-id="8880f-274">For example, to add [.less](http://www.dotlesscss.org/) files to your MVC 4 project:</span></span>

1. <span data-ttu-id="8880f-275">Создайте папку для содержимого меньшего объема.</span><span class="sxs-lookup"><span data-stu-id="8880f-275">Create a folder for your LESS content.</span></span> <span data-ttu-id="8880f-276">В следующем примере используется папка *Content\\милесс* .</span><span class="sxs-lookup"><span data-stu-id="8880f-276">The following example uses the *Content\\MyLess* folder.</span></span>
2. <span data-ttu-id="8880f-277">Добавьте в проект неограниченный пакет NuGet [без](http://www.dotlesscss.org/) **точки** .</span><span class="sxs-lookup"><span data-stu-id="8880f-277">Add the [.less](http://www.dotlesscss.org/) NuGet package **dotless** to your project.</span></span>  
    <span data-ttu-id="8880f-278">![установки NuGet](bundling-and-minification/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="8880f-278">![NuGet dotless install](bundling-and-minification/_static/image9.png)</span></span>
3. <span data-ttu-id="8880f-279">Добавьте класс, реализующий интерфейс [ибундлетрансформ](https://msdn.microsoft.com/library/system.web.optimization.ibundletransform(VS.110).aspx) .</span><span class="sxs-lookup"><span data-stu-id="8880f-279">Add a class that implements the [IBundleTransform](https://msdn.microsoft.com/library/system.web.optimization.ibundletransform(VS.110).aspx) interface.</span></span> <span data-ttu-id="8880f-280">Для преобразования. less добавьте в проект следующий код.</span><span class="sxs-lookup"><span data-stu-id="8880f-280">For the .less transform, add the following code to your project.</span></span>

    [!code-csharp[Main](bundling-and-minification/samples/sample13.cs)]
4. <span data-ttu-id="8880f-281">Создайте пакет из МЕНЬШЕго числа файлов с помощью `LessTransform` и преобразования [кссминифи](https://msdn.microsoft.com/library/system.web.optimization.cssminify(VS.110).aspx) .</span><span class="sxs-lookup"><span data-stu-id="8880f-281">Create a bundle of LESS files with the `LessTransform` and the [CssMinify](https://msdn.microsoft.com/library/system.web.optimization.cssminify(VS.110).aspx) transform.</span></span> <span data-ttu-id="8880f-282">Добавьте следующий код в метод `RegisterBundles` в файле *App\\_Start\\BundleConfig.CS* .</span><span class="sxs-lookup"><span data-stu-id="8880f-282">Add the following code to the `RegisterBundles` method in the *App\\_Start\\BundleConfig.cs* file.</span></span>

    [!code-csharp[Main](bundling-and-minification/samples/sample14.cs)]
5. <span data-ttu-id="8880f-283">Добавьте следующий код в все представления, которые ссылаются на пакет меньшего объема.</span><span class="sxs-lookup"><span data-stu-id="8880f-283">Add the following code to any views which references the LESS bundle.</span></span>

    [!code-cshtml[Main](bundling-and-minification/samples/sample15.cshtml)]

## <a name="bundle-considerations"></a><span data-ttu-id="8880f-284">Рекомендации по пакетам</span><span class="sxs-lookup"><span data-stu-id="8880f-284">Bundle Considerations</span></span>

<span data-ttu-id="8880f-285">Хорошим соглашением при создании пакетов является включение "пакета" в качестве префикса в имя пакета.</span><span class="sxs-lookup"><span data-stu-id="8880f-285">A good convention to follow when creating bundles is to include "bundle" as a prefix in the bundle name.</span></span> <span data-ttu-id="8880f-286">Это предотвратит возможный [конфликт маршрутизации](https://forums.asp.net/post/5012037.aspx).</span><span class="sxs-lookup"><span data-stu-id="8880f-286">This will prevent a possible [routing conflict](https://forums.asp.net/post/5012037.aspx).</span></span>

<span data-ttu-id="8880f-287">После обновления одного файла в пакете создается новый маркер для параметра строки запроса пакета, и при следующем запросе к странице, содержащей пакет, необходимо скачать полный пакет.</span><span class="sxs-lookup"><span data-stu-id="8880f-287">Once you update one file in a bundle, a new token is generated for the bundle query string parameter and the full bundle must be downloaded the next time a client requests a page containing the bundle.</span></span> <span data-ttu-id="8880f-288">В традиционной разметке, где каждый ресурс указан отдельно, будет загружен только измененный файл.</span><span class="sxs-lookup"><span data-stu-id="8880f-288">In traditional markup where each asset is listed individually, only the changed file would be downloaded.</span></span> <span data-ttu-id="8880f-289">Активы, которые часто меняются, могут быть нехорошими кандидатами для объединения.</span><span class="sxs-lookup"><span data-stu-id="8880f-289">Assets that change frequently may not be good candidates for bundling.</span></span>

<span data-ttu-id="8880f-290">Объединение и минификации в первую очередь повышает время загрузки первого запроса страницы.</span><span class="sxs-lookup"><span data-stu-id="8880f-290">Bundling and minification primarily improve the first page request load time.</span></span> <span data-ttu-id="8880f-291">После запроса веб-страницы браузер кэширует ресурсы (JavaScript, CSS и изображения), поэтому объединение и минификации не обеспечивает никакого увеличения производительности при запросе той же страницы или страниц на том же сайте, запрашивающих одни и те же ресурсы.</span><span class="sxs-lookup"><span data-stu-id="8880f-291">Once a webpage has been requested, the browser caches the assets (JavaScript, CSS and images) so bundling and minification won't provide any performance boost when requesting the same page, or pages on the same site requesting the same assets.</span></span> <span data-ttu-id="8880f-292">Если вы не настроили заголовок срока действия в своих активах и не используете объединение и минификации, эвристика обновления браузеров пометит ресурсы как устаревшие через несколько дней, и браузер потребует запрос на проверку для каждого ресурса.</span><span class="sxs-lookup"><span data-stu-id="8880f-292">If you don't set the expires header correctly on your assets, and you don't use bundling and minification, the browsers freshness heuristics will mark the assets stale after a few days and the browser will require a validation request for each asset.</span></span> <span data-ttu-id="8880f-293">В этом случае объединение и минификации обеспечивают увеличение производительности после первого запроса страницы.</span><span class="sxs-lookup"><span data-stu-id="8880f-293">In this case, bundling and minification provide a performance increase after the first page request.</span></span> <span data-ttu-id="8880f-294">Дополнительные сведения см. в блоге [с использованием CDN и истечении срока действия для улучшения производительности веб-сайта](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx).</span><span class="sxs-lookup"><span data-stu-id="8880f-294">For details, see the blog [Using CDNs and Expires to Improve Web Site Performance](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx).</span></span>

<span data-ttu-id="8880f-295">Ограничение в браузерах для шести одновременных подключений на каждое имя узла можно уменьшить с помощью [CDN](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx).</span><span class="sxs-lookup"><span data-stu-id="8880f-295">The browser limitation of six simultaneous connections per each hostname can be mitigated by using a [CDN](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx).</span></span> <span data-ttu-id="8880f-296">Так как CDN будет иметь имя узла, отличное от узла размещения, запросы активов из сети CDN не будут учитываться в течение шести одновременных подключений к среде размещения.</span><span class="sxs-lookup"><span data-stu-id="8880f-296">Because the CDN will have a different hostname than your hosting site, asset requests from the CDN will not count against the six simultaneous connections limit to your hosting environment.</span></span> <span data-ttu-id="8880f-297">CDN также может обеспечить общее кэширование пакета и преимущества пограничных кэширования.</span><span class="sxs-lookup"><span data-stu-id="8880f-297">A CDN can also provide common package caching and edge caching advantages.</span></span>

<span data-ttu-id="8880f-298">Пакеты должны быть секционированы по страницам, которым они необходимы.</span><span class="sxs-lookup"><span data-stu-id="8880f-298">Bundles should be partitioned by pages that need them.</span></span> <span data-ttu-id="8880f-299">Например, шаблон ASP.NET MVC по умолчанию для Интернет-приложения создает набор проверки jQuery отдельно от jQuery.</span><span class="sxs-lookup"><span data-stu-id="8880f-299">For example, the default ASP.NET MVC template for an internet application creates a jQuery Validation bundle separate from jQuery.</span></span> <span data-ttu-id="8880f-300">Так как созданные представления по умолчанию не имеют входных данных и не имеют значений, они не включают в себя набор проверки.</span><span class="sxs-lookup"><span data-stu-id="8880f-300">Because the default views created have no input and do not post values, they don't include the validation bundle.</span></span>

<span data-ttu-id="8880f-301">Пространство имен `System.Web.Optimization` реализовано в *System. Web. Optimization. dll*.</span><span class="sxs-lookup"><span data-stu-id="8880f-301">The `System.Web.Optimization` namespace is implemented in *System.Web.Optimization.dll*.</span></span> <span data-ttu-id="8880f-302">Она использует библиотеку "минификации *" ("* *Antlr3. Runtime. dll*") для возможностей, которые в свою очередь используют.</span><span class="sxs-lookup"><span data-stu-id="8880f-302">It leverages the WebGrease library (*WebGrease.dll*) for minification capabilities, which in turn uses *Antlr3.Runtime.dll*.</span></span>

<span data-ttu-id="8880f-303">*Я использую Twitter, чтобы быстро отправлять сообщения и обмениваться ссылками. Мой обработчик Twitter*: [@RickAndMSFT](http://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="8880f-303">*I use Twitter to make quick posts and share links. My Twitter handle is*: [@RickAndMSFT](http://twitter.com/RickAndMSFT)</span></span>

## <a name="additional-resources"></a><span data-ttu-id="8880f-304">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="8880f-304">Additional resources</span></span>

- <span data-ttu-id="8880f-305">Видео.[объединение и оптимизация](https://channel9.msdn.com/Events/aspConf/aspConf/Bundling-and-Optimizing) с помощью [Говард Дайеркинг](https://twitter.com/#!/howard_dierking)</span><span class="sxs-lookup"><span data-stu-id="8880f-305">Video:[Bundling and Optimizing](https://channel9.msdn.com/Events/aspConf/aspConf/Bundling-and-Optimizing) by [Howard Dierking](https://twitter.com/#!/howard_dierking)</span></span>
- <span data-ttu-id="8880f-306">[Добавление веб-оптимизации на сайт веб-страниц](https://blogs.msdn.com/b/rickandy/archive/2012/08/15/adding-web-optimization-to-a-web-pages-site.aspx).</span><span class="sxs-lookup"><span data-stu-id="8880f-306">[Adding Web Optimization to a Web Pages Site](https://blogs.msdn.com/b/rickandy/archive/2012/08/15/adding-web-optimization-to-a-web-pages-site.aspx).</span></span>
- <span data-ttu-id="8880f-307">[Добавление в веб-формы объединения и минификации](https://blogs.msdn.com/b/rickandy/archive/2012/08/14/adding-bundling-and-minification-to-web-forms.aspx).</span><span class="sxs-lookup"><span data-stu-id="8880f-307">[Adding Bundling and Minification to Web Forms](https://blogs.msdn.com/b/rickandy/archive/2012/08/14/adding-bundling-and-minification-to-web-forms.aspx).</span></span>
- <span data-ttu-id="8880f-308">[Влияние на производительность объединения и минификации при просмотре веб-страниц](https://blogs.msdn.com/b/henrikn/archive/2012/06/17/performance-implications-of-bundling-and-minification-on-http.aspx) с помощью [хенрик F Nielsen](http://en.wikipedia.org/wiki/Henrik_Frystyk_Nielsen) [@frystyk](https://twitter.com/frystyk)</span><span class="sxs-lookup"><span data-stu-id="8880f-308">[Performance Implications of Bundling and Minification on Web Browsing](https://blogs.msdn.com/b/henrikn/archive/2012/06/17/performance-implications-of-bundling-and-minification-on-http.aspx) by [Henrik F Nielsen](http://en.wikipedia.org/wiki/Henrik_Frystyk_Nielsen) [@frystyk](https://twitter.com/frystyk)</span></span>
- <span data-ttu-id="8880f-309">[Использование CDN и истечения срока действия для повышения производительности веб-сайта](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx) на основе рик Андерсон ( [@RickAndMSFT](https://twitter.com/#!/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="8880f-309">[Using CDNs and Expires to Improve Web Site Performance](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx) by Rick Anderson [@RickAndMSFT](https://twitter.com/#!/RickAndMSFT)</span></span>
- [<span data-ttu-id="8880f-310">Уменьшение времени приема-передачи (время кругового пути)</span><span class="sxs-lookup"><span data-stu-id="8880f-310">Minimize RTT (round-trip times)</span></span>](https://developers.google.com/speed/docs/best-practices/rtt)

## <a name="contributors"></a><span data-ttu-id="8880f-311">участники;</span><span class="sxs-lookup"><span data-stu-id="8880f-311">Contributors</span></span>

- <span data-ttu-id="8880f-312">Хао кунг</span><span class="sxs-lookup"><span data-stu-id="8880f-312">Hao Kung</span></span>
- [<span data-ttu-id="8880f-313">Говард Дайеркинг</span><span class="sxs-lookup"><span data-stu-id="8880f-313">Howard Dierking</span></span>](https://twitter.com/#!/howard_dierking)
- <span data-ttu-id="8880f-314">(Diana Лароуз</span><span class="sxs-lookup"><span data-stu-id="8880f-314">Diana LaRose</span></span>
