---
uid: mvc/overview/getting-started/getting-started-with-ef-using-mvc/migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application
title: Учебник. В приложении ASP.NET MVC с помощью EF Migrations и развертывание в Azure
author: tdykstra
description: В этом руководстве вы включите Code First migrations и развертывание приложения в облаке в Azure.
ms.author: riande
ms.date: 01/16/2019
ms.topic: tutorial
ms.assetid: d4dfc435-bda6-4621-9762-9ba270f8de4e
msc.legacyurl: /mvc/overview/getting-started/getting-started-with-ef-using-mvc/migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application
msc.type: authoredcontent
ms.openlocfilehash: 1f25a9afdf379d725496bd88f6ac192ab19930ca
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/09/2019
ms.locfileid: "59384517"
---
# <a name="tutorial-use-ef-migrations-in-an-aspnet-mvc-app-and-deploy-to-azure"></a>Учебник. В приложении ASP.NET MVC с помощью EF Migrations и развертывание в Azure

До сих университета Contoso примера веб-приложения выполнялся локально в IIS Express на компьютере разработчика. В реальном приложении сделать доступным для других пользователей в Интернете, необходимо развернуть его на веб-поставщик услуг размещения. В этом руководстве вы включите Code First migrations и развертывание приложения в облаке в Azure:

- Включение Code First Migrations. Функция миграций позволяет изменить модель данных и развертывания изменений в рабочей среде путем обновления схемы базы данных без необходимости удаления и повторного создания базы данных.
- Развертывание в Azure. Этот шаг является необязательным; оставшихся учебниках можно будет продолжить без развернут проект.

Мы рекомендуем использовать процесс непрерывной интеграции с системой управления версиями для развертывания, что этот учебник не охватывает разделы. Дополнительные сведения см. в разделе [система управления версиями](xref:aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control) и [непрерывной интеграции](xref:aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) главах [Создание реальных облачных приложений в Azure](xref:aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/introduction).

В этом учебнике рассмотрены следующие задачи.

> [!div class="checklist"]
> * Включение Code First migrations
> * Развертывание приложения в Azure (необязательно)

## <a name="prerequisites"></a>Предварительные требования

- [Устойчивость подключений и перехват команд](connection-resiliency-and-command-interception-with-the-entity-framework-in-an-asp-net-mvc-application.md)

## <a name="enable-code-first-migrations"></a>Включение Code First migrations

При разработке нового приложения ваша модель данных часто меняется, и при каждом таком изменении она нарушает синхронизацию с базой данных. Вы настроили платформе Entity Framework автоматически удалить и повторно создать базу данных каждый раз при изменении модели данных. При Добавление, удаление, или изменении классов сущностей или изменении вашей `DbContext` класса, при следующем запуске приложения оно автоматически удаляет существующую базу данных, создает новый, который соответствует модели и заполняет ее тестовыми данными.

Этот способ для обеспечения синхронизации базы данных с моделью данных хорошо работает до развертывания приложения в рабочей среде. Когда приложение выполняется в рабочей среде, оно обычно хранит данные, которые вы хотите сохранить, и вы не хотите потерять все, что каждый раз при внесении изменений, таких как добавление нового столбца. [Code First Migrations](https://msdn.microsoft.com/data/jj591621) функция решает эту проблему, включив Code First обновить схему базы данных вместо удаления и повторного создания базы данных. В этом руководстве вы развернете приложение, и для подготовки, вы будете разрешить миграции.

1. Отключить инициализатора, который мы настроили ранее, комментирования или удалив `contexts` элемент, добавленный в файл Web.config приложения.

    [!code-xml[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample1.xml?highlight=2,6)]
2. Также в приложении *Web.config* файл, измените имя базы данных в строке подключения на ContosoUniversity2.

    [!code-xml[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample2.xml?highlight=2)]

    Это изменение настраивает проект, чтобы первой миграции создает новую базу данных. Это не является обязательным, но вы увидите Далее почему это хорошая идея.
3. В меню **Сервис** последовательно выберите пункты **Диспетчер пакетов NuGet** > **Консоль диспетчера пакетов**.

1. В `PM>` командной строке введите следующие команды:

    ```text
    enable-migrations
    add-migration InitialCreate
    ```

    `enable-migrations` Команда создает *миграций* папки в проекте ContosoUniversity и он помещает в нее *Configuration.cs* файл, который можно изменять для настройки миграций.

    (Если вы пропустили на предыдущем шаге, который необходимо изменить имя базы данных, миграция будет найти существующую базу данных и автоматически выполнять `add-migration` команды. Это нормально, это означает, что не будет работать, чтобы проверить код миграции перед развертыванием базы данных. Более поздние версии, при запуске `update-database` команды, ничего не происходит, так как база данных уже существует.)

    Откройте *ContosoUniversity\Migrations\Configuration.cs* файла. Как и класс инициализатора, который вы уже видели, `Configuration` класс включает `Seed` метод.

    [!code-csharp[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample3.cs)]

    Цель [начальное значение](https://msdn.microsoft.com/library/hh829453(v=vs.103).aspx) метод — научить вас вставлять или обновлять данные теста после Code First создает или обновляет базу данных. Метод вызывается при создании базы данных, и каждый раз при обновлении схемы базы данных после изменения модели данных.

### <a name="set-up-the-seed-method"></a>Настройка метода заполнения

Если вы удалите и повторно создать базу данных для каждого изменения модели данных, используется класс инициализатора `Seed` метод вставляемый проверочных данных, так как база данных уничтожается после каждого изменения модели и все тестовые данные теряются. С помощью Code First Migrations, тест, данные сохраняются после изменения базы данных, таким образом включая тестовых данных в [начальное значение](https://msdn.microsoft.com/library/hh829453(v=vs.103).aspx) метод обычно не требуется. На самом деле, вы не хотите `Seed` метод для вставки данных теста при использовании миграции для развертывания базы данных в рабочей среде, так как `Seed` метод будет выполняться в рабочей среде. В этом случае требуется `Seed` метод только данные, которые необходимо вставить в базу данных в рабочей среде. Например, может потребоваться базы данных, для включения названия фактическое отделов в `Department` таблицы, когда приложение становится доступным для рабочей среды.

В этом учебнике вы будете использовать миграции для развертывания, а `Seed` метод в любом случае Вставка тестовых данных для повышения его читаемости увидеть, как работает функциональных возможностей приложения без необходимости вручную вставить большие объемы данных.

1. Замените содержимое файла *Configuration.cs* файла следующий код, который загружает тестовые данные в новую базу данных.

    [!code-csharp[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample4.cs)]

    [Начальное значение](https://msdn.microsoft.com/library/hh829453(v=vs.103).aspx) метод принимает объект контекста базы данных как входной параметр и код в метод использует этот объект для добавления новых сущностей в базу данных. Для каждого типа сущности, код создает коллекцию новых сущностей, добавляет их в соответствующий [DbSet](https://msdn.microsoft.com/library/system.data.entity.dbset(v=vs.103).aspx) свойства, а затем сохраняет изменения в базе данных. Нет необходимости вызывать [SaveChanges](https://msdn.microsoft.com/library/system.data.entity.dbcontext.savechanges(v=VS.103).aspx) метод после каждой группы сущностей, как показано здесь, но это поможет вам найти источник проблемы, если возникает исключение, когда код записывает в базу данных.

    Некоторые операторы, которые вставляют данные используют [AddOrUpdate](https://msdn.microsoft.com/library/system.data.entity.migrations.idbsetextensions.addorupdate(v=vs.103).aspx) метод для выполнения операции «вставки-обновления». Так как `Seed` метод выполняется при каждом выполнении `update-database` команды обычно после каждую операцию миграции, нельзя просто вставить данные, так как строки, вы пытаетесь добавить уже будут существует после первой миграции, который создает базу данных. Операция «вставки-обновления» позволяет избежать ошибок, произойдет при попытке вставить строку, которая уже существует, но он ***переопределяет*** любые изменения данных, внесенные во время тестирования приложения. Тестовыми данными в некоторых таблицах вы не хотите, чтобы происходить: в некоторых случаях при изменении данных во время тестирования необходимым вам изменениям после обновления базы данных. В этом случае необходимо выполнить операцию вставки условного: вставить строку, только в том случае, если он еще не существует. Метод заполнения использует оба подхода.

    Первый параметр, передаваемый [AddOrUpdate](https://msdn.microsoft.com/library/system.data.entity.migrations.idbsetextensions.addorupdate(v=vs.103).aspx) метод задает свойство, используемое для проверки, если строка уже существует. Для тестовых данных учащихся, вы предоставляете `LastName` свойство может использоваться для этой цели, так как каждой фамилии в списке является уникальным:

    [!code-csharp[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample5.cs)]

    Предполагается, что последний имена являются уникальными. Если вручную добавить учащихся с повторяющимся именем последнего, вы получите следующее исключение при очередном выполнении миграции:

    **Последовательность содержит более одного элемента**

    Сведения о том, как обрабатывать избыточных данных, например с именем «Александр Carson» работы двух учащихся, см. в разделе [заполнения и отладка Entity Framework (EF) DBs](https://blogs.msdn.com/b/rickandy/archive/2013/02/12/seeding-and-debugging-entity-framework-ef-dbs.aspx) в блоге Рика Андерсона:. Дополнительные сведения о `AddOrUpdate` метод, см. в разделе [Будьте внимательны с помощью метода AddOrUpdate 4.3 EF](http://thedatafarm.com/blog/data-access/take-care-with-ef-4-3-addorupdate-method/) блога Джули Лерман.

    Код, создающий `Enrollment` сущностей предполагается, что у вас есть `ID` значение в сущностях в `students` коллекции, несмотря на то, что вы не задали это свойство в коде, который создает коллекции.

    [!code-csharp[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample6.cs?highlight=2)]

    Можно использовать `ID` здесь свойство поскольку `ID` имеет значение при вызове `SaveChanges` для `students` коллекции. EF автоматически получает значение первичного ключа, если он вставляет сущность в базе данных, и обновляет `ID` свойство сущности в памяти.

    Код, который добавляет каждое из них `Enrollment` сущность `Enrollments` набор сущностей не использует `AddOrUpdate` метод. Он проверяет, если сущность уже существует и вставляет сущность, если он не существует. Такой подход позволяет сохранить изменения, внесенные в регистрации корпоративного класса с помощью пользовательского интерфейса приложения. Код просматривает каждый член `Enrollment` [списка](https://msdn.microsoft.com/library/6sh2ey19.aspx) и если регистрации не найден в базе данных, он добавляет регистрации к базе данных. Первый раз, обновить базу данных, базы данных будут пусты, поэтому он добавляет каждой регистрации.

    [!code-csharp[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample7.cs)]

2. Выполните построение проекта.

### <a name="execute-the-first-migration"></a>Выполнение первой миграции

При выполнении `add-migration` команды миграции созданный код, который создаст базу данных с нуля. Этот код присутствует также в *миграций* папку, в файл с именем  *&lt;timestamp&gt;\_InitialCreate.cs*. `Up` Метод `InitialCreate` класс создает таблицы базы данных, которые соответствуют наборам сущностей модели данных, и `Down` метод удаляет их.

[!code-csharp[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample8.cs)]

Функция миграций вызывает метод `Up`, чтобы реализовать изменения модели данных для миграции. При вводе команды для отката обновления функция миграций вызывает метод `Down`.

Это связано с первоначальной миграции, который был создан, когда вы ввели `add-migration InitialCreate` команды. Параметр (`InitialCreate` в примере) используется для файла имя и может быть любым; обычно выбрать слово или фразу, которая обобщает, что необходимо сделать после миграции. Например, можно назвать миграцию &quot;AddDepartmentTable&quot;.

Если вы создали первоначальную миграцию, когда база данных уже существовала, код для создания базы данных формируется, но выполнять его не требуется, так как база данных уже соответствует модели данных. Однако при развертывании приложения в другой среде, где база данных еще не существует, этот код будет выполняться для создания базы данных, поэтому рекомендуется сначала его протестировать. Вот почему вы изменили имя базы данных в строке подключения ранее&mdash;таким образом, чтобы миграций можно создать новую с нуля.

1. В **консоль диспетчера пакетов** окно, введите следующую команду:

    `update-database`

    `update-database` Выполняется команда `Up` метод для создания базы данных, а затем выполняется `Seed` метод для заполнения базы данных. Тот же процесс будет выполняться автоматически в рабочей среде после развертывания приложения, как можно будет увидеть в следующем разделе.
2. Используйте **обозревателя серверов** для проверки базы данных, как это делалось в первом руководстве и запустите приложение, чтобы убедиться, что все по-прежнему работает так же как и раньше.

## <a name="deploy-to-azure"></a>Развертывание в Azure

Пока приложение будет выполняться локально в IIS Express на компьютере разработчика. Чтобы сделать его доступным для других пользователей в Интернете, необходимо развернуть его на веб-поставщик услуг размещения. В этом разделе руководства вы развернете его в Azure. Этот раздел является необязательным; Вы можете пропустить этот шаг и продолжить к следующему учебнику, или можно изменить указания в этом разделе для другого поставщика услуг размещения по своему усмотрению.

### <a name="use-code-first-migrations-to-deploy-the-database"></a>Развертывание базы данных с помощью Code First migrations

Чтобы развернуть базу данных, используется Code First Migrations. При создании профиля публикации, который можно использовать для настройки параметров для развертывания из Visual Studio, будет предложено выбрать флажок **обновления базы данных**. Этот параметр задан, то процесс развертывания, чтобы автоматически настроить приложение *Web.config* файл на конечном сервере, таким образом, Code First использовал `MigrateDatabaseToLatestVersion` инициализатор класса.

Visual Studio не выполняет никаких действий с базой данных во время развертывания, хотя он копирует проекта на целевой сервер. При запуске развернутого приложения, и он обращается к базе данных в первый раз после развертывания, Code First проверяет, если базы данных соответствует модели данных. Если существует несоответствие, Code First автоматически создает базу данных (если он еще не создан) или обновляет схему базы данных до последней версии (если база данных существует, но не соответствует модели). Если приложение реализует миграций `Seed` метод выполнения метода, после создания или обновления схемы.

Миграции `Seed` метод вставляет тестовых данных. При развертывании в рабочей среде, вы должны внести изменения `Seed` метод, чтобы он вставляет только те данные, которые должны быть вставлены в рабочую базу данных. Например в текущей модели данных может потребоваться иметь реальных курсы, но вымышленной учащихся в базе данных разработки. Можно написать `Seed` метод для загрузки в разработке и затем закомментируйте вымышленной учащихся, перед развертыванием в рабочей среде. Или можно написать `Seed` метод для загрузки только курсов и введите вымышленной учащихся в базе данных тестов вручную с помощью пользовательского интерфейса приложения.

### <a name="get-an-azure-account"></a>Получить учетную запись Azure

Вам потребуется учетная запись Azure. Если у вас еще нет, но у вас есть подписка Visual Studio, вы можете [активировать свои преимущества](https://azure.microsoft.com/pricing/member-offers/credit-for-visual-studio-subscribers/
). В противном случае можно создать бесплатную пробную учетную запись всего за несколько минут. Дополнительные сведения см. в разделе [бесплатной пробной версии Azure](https://azure.microsoft.com/free/).

### <a name="create-a-web-site-and-a-sql-database-in-azure"></a>Создание веб-сайта и базы данных SQL в Azure

Веб-приложения в Azure будет выполняться в общей среде размещения, это означает, что он работает на виртуальных машинах (ВМ), которые являются общими с другими клиентами Azure. Общей среде размещения — это недорогой способ начать работу в облаке. Позже Если ваш веб-трафик увеличится, приложение можно масштабировать для удовлетворения потребностей, выполнив на выделенных виртуальных машинах. Дополнительные сведения о ценах на параметры для службы приложений Azure, [цен на службу приложений](https://azure.microsoft.com/pricing/details/app-service/).

Используется для развертывания базы данных в базу данных Azure SQL. База данных SQL — это служба реляционной базы данных на основе облака, которая построена на технологиях SQL Server. Средства и приложения, работающие с SQL Server также работают с базой данных SQL.

1. В [портала управления Azure](https://portal.azure.com), выберите **создать ресурс** в левой вкладке, а затем выберите **см. в разделе, все** на **New** области (или *колонке*) для просмотра всех доступных ресурсов. Выберите **веб-приложение + SQL** в **Web** раздел **все** колонке. Наконец, выберите **создать**.

    ![Создать ресурс на портале Azure](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/create-azure-resource.png)

   Форма для создания нового **новое веб-приложение + SQL** откроется ресурсов.

2. Введите строку в **имя_приложения** поле для использования в качестве уникального URL-адреса для вашего приложения. Полный URL-адрес будет состоять из введенной здесь плюс домена службы приложений по умолчанию (. azurewebsites.net). Если **имя_приложения** уже занято, мастер сообщит с красным значком *имя приложения Недоступно* сообщения. Если **имя_приложения** будет доступен, появится зеленая галочка.

3. В **подписки** , выберите подписку Azure, в котором нужно **службы приложений** находиться.

4. В **группы ресурсов** текстовое поле, выберите группу ресурсов или создайте новую. Этот параметр указывает, какой веб-сайт будет выполняться в центр обработки данных. Дополнительные сведения о группах ресурсов см. в разделе [групп ресурсов](/azure/azure-resource-manager/resource-group-overview#resource-groups).

5. Создайте новый **план службы приложений** , щелкнув *разделе службы приложений*, **Create New**и заполните **план службы приложений** (может быть совпадает с именем Служба приложений), **расположение**, и **Ценовая** (есть бесплатный вариант).

6. Нажмите кнопку **базы данных SQL**, а затем выберите **создать новую базу данных** или выберите существующую базу данных.

7. В **имя** введите имя для базы данных.
8. Нажмите кнопку **целевой сервер** поле, а затем выберите **Создание нового сервера**. Кроме того Если ранее вы создали сервер, можно выбрать этот сервер из списка доступных серверов.
9. Выберите **Ценовая** выберите *бесплатный*. Если требуются дополнительные ресурсы, базы данных можно масштабировать в любое время. Дополнительные сведения о ценах на SQL Azure, см. в разделе [цен на базу данных SQL Azure](https://azure.microsoft.com/pricing/details/sql-database/managed/).
10. Изменить [параметры сортировки](/sql/relational-databases/collations/collation-and-unicode-support) при необходимости.
11. Введите администратора **имя пользователя администратора SQL** и **пароль администратора SQL**.

    - Если вы выбрали **новую базу данных SQL server**, определить новое имя и пароль, который будет использоваться в дальнейшем при доступе к базе данных.
    - Если вы выбрали сервера, который вы создали ранее, введите учетные данные для этого сервера.

12. Сбор данных телеметрии можно включить для службы приложений с помощью Application Insights. С небольшой конфигурацией Application Insights собирает полезные события, исключения, зависимости, запрос и сведения о трассировке. Дополнительные сведения об Application Insights, см. в разделе [Azure Monitor](https://azure.microsoft.com/services/monitor/).
13. Нажмите кнопку **создать** внизу, чтобы указать, что Вы завершили.

    Портал управления возвращает страницу панели мониторинга и **уведомления** область в верхней части страницы показывает, что создается сайт. Через некоторое время (обычно это занимает меньше минуты) есть уведомление об успешном выполнении развертывания. На панели навигации слева с новой службой приложений отображается в **службы приложений** раздел и новую базу данных SQL отображается в **баз данных SQL** раздел.

### <a name="deploy-the-app-to-azure"></a>Развертывание приложения в Azure

1. В Visual Studio щелкните правой кнопкой мыши проект в **обозревателе решений** и выберите **публикации** в контекстном меню.

2. На **выберите целевой объект публикации** выберите **службы приложений** и затем **выбрать существующее**, а затем выберите **публикации**.

    ![Выберите целевой страницы публикации](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/publish-select-existing-azure-app-service.png)

3. Если вы еще не добавили ранее подписки Azure Visual Studio, выполните действия на экране. Эти действия позволяют Visual Studio для подключения к подписке Azure таким образом, список **службы приложений** будет включать веб-сайт.

4. На **службы приложений** выберите **подписки** вы добавили службы приложения. В разделе **представление**выберите **группы ресурсов**. Разверните группу ресурсов, которую вы добавили службы приложения и затем выберите службу приложений. Выберите **ОК** для публикации приложения.

5. **Вывода** окно показывает, какие действия по развертыванию были выполнены и передает об успешном завершении развертывания.

6. После успешного развертывания в браузере по умолчанию автоматически откроется на URL-адрес развернутого веб-сайта.

    ![Students_index_page_with_paging](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/cloud-app-browser.png)

    Теперь ваше приложение работает в облаке.

На этом этапе *SchoolContext* базы данных в базе данных Azure SQL создан, так как вы выбрали **выполнить Code First Migrations (при запуске приложения)**. *Web.config* файл развернутого веб-узла был изменен, чтобы [MigrateDatabaseToLatestVersion](https://msdn.microsoft.com/library/hh829476(v=vs.103).aspx) инициализатор запускается в первый раз, код считывает или записывает данные в базе данных (что произошло При выборе **учащихся** вкладки):

![Выдержка из файла Web.config](https://asp.net/media/4367421/mig.png)

Процесс развертывания также создается новая строка подключения *(SchoolContext\_DatabasePublish*) для Code First Migrations для обновления схемы базы данных и заполнения базы данных.

![Строка подключения в файле Web.config](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image26.png)

Вы найдете развернутой версии файла Web.config на локальном компьютере в *ContosoUniversity\obj\Release\Package\PackageTmp\Web.config*. Доступ к развернутому *Web.config* сам файл с помощью FTP. Инструкции см. в разделе [веб-развертывание ASP.NET с помощью Visual Studio: Развертывание обновления кода](xref:web-forms/overview/deployment/visual-studio-web-deployment/deploying-a-code-update). Следуйте инструкциям, которые начинаются с «Чтобы использовать средство FTP, необходимы три вещи: URL-адрес FTP, имя пользователя и пароль.»

> [!NOTE]
> Веб-приложение не реализует безопасности, поэтому любой кто найдет этот URL-адрес можно изменить данные. Инструкции о том, как защитить веб-сайт, см. в разделе [развертывание безопасного приложения ASP.NET MVC с членством, OAuth и SQL базы данных в Azure](/aspnet/core/security/authorization/secure-data). Можно запретить другим пользователям с помощью сайта, остановив службу, с помощью портала управления Azure или **обозревателя серверов** в Visual Studio.

![Остановить пункт меню приложения службы](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/server-explorer-stop-app-service.png)

## <a name="advanced-migrations-scenarios"></a>Сценарии дополнительные миграции

Если развернуть базу данных, выполнив миграции автоматически, как показано в этом руководстве развертывается на веб-сайт, который выполняется на нескольких серверах, можно получить несколько серверов, попытки запуска миграции, в то же время. Миграция являются атомарными, поэтому если же миграцию следует выполнять два сервера, один будет успешно, а другой не удастся (предполагается, что все действия нельзя выполнить дважды). Если вы хотите избежать этих проблем в этом сценарии можно вызывать миграции вручную и настроить собственный код, чтобы это происходит только один раз. Дополнительные сведения см. в разделе [запущена и сценариев миграции из кода](http://romiller.com/2012/02/09/running-scripting-migrations-from-code/) в блоге Роуэн Миллер и [Migrate.exe](/ef/ef6/modeling/code-first/migrations/migrate-exe) (для выполнения миграции из командной строки).

Сведения о других сценариях миграции, см. в разделе [миграций серию](https://blogs.msdn.com/b/adonet/archive/2014/03/12/migrations-screencast-series.aspx).

## <a name="code-first-initializers"></a>Инициализаторы первого кода

В разделе "Развертывание", встреченного [MigrateDatabaseToLatestVersion](https://msdn.microsoft.com/library/hh829476(v=vs.103).aspx) используется инициализатор. Код сначала также предоставляет другие инициализаторы, включая [CreateDatabaseIfNotExists](https://msdn.microsoft.com/library/gg679221(v=vs.103).aspx) (по умолчанию), [DropCreateDatabaseIfModelChanges](https://msdn.microsoft.com/library/gg679604(v=VS.103).aspx) (который вы использовали ранее) и [ DropCreateDatabaseAlways](https://msdn.microsoft.com/library/gg679506(v=VS.103).aspx). `DropCreateAlways` Инициализаторов может быть полезна для настройки условий для модульных тестов. Можно также написать собственные инициализаторы и инициализатор можно вызвать явным образом, если вы не хотите подождать, пока приложение для считывания и записи в базу данных.

Дополнительные сведения об инициализаторах см. в разделе [инициализаторы основные сведения о базе данных в Entity Framework Code First](http://www.codeguru.com/csharp/article.php/c19999/Understanding-Database-Initializers-in-Entity-Framework-Code-First.htm) и главе 6 книги [Programming Entity Framework: Code First](http://shop.oreilly.com/product/0636920022220.do) , Джули Лерман и Роуэн Миллер.

## <a name="get-the-code"></a>Получение кода

[Скачивание готового проекта](https://webpifeed.blob.core.windows.net/webpifeed/Partners/ASP.NET%20MVC%20Application%20Using%20Entity%20Framework%20Code%20First.zip)

## <a name="additional-resources"></a>Дополнительные ресурсы

Ссылки на другие ресурсы Entity Framework можно найти в [доступ к данным ASP.NET — рекомендуемые ресурсы](xref:whitepapers/aspnet-data-access-content-map).

## <a name="next-steps"></a>Следующие шаги

В этом учебнике рассмотрены следующие задачи.

> [!div class="checklist"]
> * Включена Code First migrations
> * Развернув приложение в Azure (необязательно)

Перейдите к следующей статье, чтобы научиться создавать более сложной модели данных для приложения MVC ASP.NET.
> [!div class="nextstepaction"]
> [Создание более сложной модели данных](creating-a-more-complex-data-model-for-an-asp-net-mvc-application.md)
