---
uid: mvc/overview/getting-started/database-first-development/enhancing-data-validation
title: Учебник. Улучшения проверки данных для EF Database First с помощью приложения ASP.NET MVC
description: Это руководство посвящено добавления заметок к данным в модель данных, чтобы указать требования к проверке и формат отображения.
author: Rick-Anderson
ms.author: riande
ms.date: 01/28/2019
ms.topic: tutorial
ms.assetid: 0ed5e67a-34c0-4b57-84a6-802b0fb3cd00
msc.legacyurl: /mvc/overview/getting-started/database-first-development/enhancing-data-validation
msc.type: authoredcontent
ms.openlocfilehash: 897cd7c6a40445e2a4abede50d81e101372d3233
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/01/2019
ms.locfileid: "57039871"
---
# <a name="tutorial-enhance-data-validation-for-ef-database-first-with-aspnet-mvc-app"></a>Учебник. Улучшения проверки данных для EF Database First с помощью приложения ASP.NET MVC

С помощью MVC, Entity Framework и формирование шаблонов ASP.NET, можно создать веб-приложение, которое предоставляет интерфейс для существующей базы данных. В этой серии руководств показано, как автоматически создавать код, позволяющий пользователям для отображения, изменения и создавать и удалять данные, находящиеся в таблице базы данных. Созданный код соответствует столбцам в таблице базы данных.

Это руководство посвящено добавления заметок к данным в модель данных, чтобы указать требования к проверке и формат отображения. Она была улучшена зависимости на отзывы от пользователей в разделе "Примечания".

В этом учебнике рассмотрены следующие задачи.

> [!div class="checklist"]
> * Добавление заметок к данным
> * Добавить классы метаданных

## <a name="prerequisites"></a>Предварительные требования

* [Настройка представления](customizing-a-view.md)

## <a name="add-data-annotations"></a>Добавление заметок к данным

Как видно в предыдущей статье, некоторые правила проверки данных автоматически применяются к вводимых пользователем данных. Например число может предоставить только для свойства корпоративного уровня. Чтобы указать дополнительные правила проверки данных, можно добавить заметки к данным в классе модели. Эти заметки применяются в рамках всего веб-приложения для указанного свойства. Можно также применить атрибуты форматирования, которые изменяют способ отображения свойств; например изменив значение, используемое для подписи.

В этом руководстве вы добавите заметок к данным для ограничения длины значения, заданные для свойств FirstName, MiddleName и LastName. В базе данных эти значения являются более 50 символов; Тем не менее в веб-приложении этого предельного количества символов в настоящее время не применяется. Если пользователь предоставляет более 50 символов для одного из этих значений, странице произойдет сбой при попытке сохранить значение в базе данных. Также вы ограничите корпоративного уровня для значения в диапазоне от 0 до 4.

Выберите **моделей** > **ContosoModel.edmx** > **ContosoModel.tt** и откройте *Student.cs* файла. Добавьте выделенный ниже код к классу.

[!code-csharp[Main](enhancing-data-validation/samples/sample1.cs?highlight=5,15,17,20)]

Откройте *Enrollment.cs* и добавьте следующий выделенный код.

[!code-csharp[Main](enhancing-data-validation/samples/sample2.cs?highlight=5,10)]

Постройте решение.

Нажмите кнопку **список учащихся** и выберите **изменить**. Если попытаться ввести более 50 символов, отображается сообщение об ошибке.

![Отображение сообщения об ошибке](enhancing-data-validation/_static/image1.png)

Вернитесь на домашнюю страницу. Нажмите кнопку **список регистраций** и выберите **изменить**. Пытается предоставить оценку выше 4. Вы получите эту ошибку: *Поле корпоративного класса должно быть от 0 до 4.*

## <a name="add-metadata-classes"></a>Добавить классы метаданных

Добавление атрибутов проверки непосредственно к классу модели работает, если вы не ожидаете, что базы данных для изменения; Тем не менее если изменения базы данных и вам нужно повторно создать класс модели, вы потеряете все атрибуты, которые были применены к классу модели. Этот подход может оказаться очень неэффективным и подвержен потери важных условий.

Чтобы избежать этой проблемы, можно добавить класс метаданных, содержащий атрибуты. При связывании класса модели к классу метаданных, эти атрибуты применяются к модели. В этом случае можно повторно создать класс модели без потери всех атрибутов, примененных к классу метаданных.

В **моделей** папки, добавьте класс с именем *Metadata.cs*.

Замените код в *Metadata.cs* следующим кодом.

[!code-csharp[Main](enhancing-data-validation/samples/sample3.cs)]

Эти классы метаданных содержат все атрибуты проверки, которые ранее были применены к классам модели. **Отображения** атрибута можно изменить значение, используемое для подписи.

Теперь классы моделей необходимо связать с классов метаданных.

В **моделей** папки, добавьте класс с именем *PartialClasses.cs*.

Замените содержимое файла следующим кодом.

[!code-csharp[Main](enhancing-data-validation/samples/sample4.cs)]

Обратите внимание, что каждый класс обозначен как `partial` класс и все совпадает с именем и пространством имен как класс, который создается автоматически. Применение атрибута метаданных в разделяемый класс, убедитесь, что атрибуты проверки данных будет применяться к классу автоматически создается. Эти атрибуты не будут потеряны при повторном создании классов модели, так как атрибут метаданных применяется в разделяемых классах, которые не восстанавливаются.

Для повторного создания автоматически генерируемых классов, откройте *ContosoModel.edmx* файла. Еще раз щелкните правой кнопкой мыши на область конструктора и выберите **обновить модель из базы данных**. Несмотря на то, что вы не изменили базы данных, этот процесс приведет к повторному созданию классов. В **обновить** выберите **таблиц** и **Готово**.

Сохранить *ContosoModel.edmx* файл, чтобы применить изменения.

Откройте *Student.cs* файл или *Enrollment.cs* файл и обратите внимание, что ранее примененные атрибуты проверки данных больше не находятся в файле. Тем не менее запустите приложение и обратите внимание на то, что по-прежнему применяются правила проверки при вводе данных.

## <a name="conclusion"></a>Заключение

В этой серии предоставлен простой пример того, как создать код из существующей базы данных, который позволяет пользователям изменять, обновлять, создавать и удалять данные. Он используется ASP.NET MVC 5, Entity Framework и формирование шаблонов ASP.NET для создания проекта. 

Вводный пример шаблона разработки Code First, см. в разделе [Приступая к работе с ASP.NET MVC 5](../introduction/getting-started.md). 

Более сложный пример, см. в разделе [Создание модели данных Entity Framework для приложения ASP.NET MVC 4](../getting-started-with-ef-using-mvc/creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md). Обратите внимание, что API DbContext, который используется для работы с данными в базе данных первого так же, как API, который используется для работы с данными в Code First. Даже если вы планируете использовать Database First, рассказывается, как обрабатывать более сложные сценарии, такие как чтение и обновление связанных данных, обработка конфликтов параллелизма, и так далее из учебника Code First. Единственное различие — в том, как создать базу данных, класс контекста и классов сущностей.

## <a name="additional-resources"></a>Дополнительные ресурсы

Полный список проверки заметок к данным можно применить к свойства и классы, см. в разделе [System.ComponentModel.DataAnnotations](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.aspx).

## <a name="next-steps"></a>Следующие шаги

В этом учебнике рассмотрены следующие задачи.

> [!div class="checklist"]
> * Заметки в добавленных данных
> * Добавляемые метаданные классов

Дополнительные сведения о развертывании веб-приложения и базы данных SQL в службе приложений Azure, см. в разделе этого руководства:
> [!div class="nextstepaction"]
> [Развертывание приложения .NET в службе приложений Azure](/azure/app-service/app-service-web-tutorial-dotnet-sqldatabase/)
