---
uid: mvc/overview/getting-started/database-first-development/enhancing-data-validation
title: Учебник. Улучшение проверки данных для EF Database First с помощью приложения ASP.NET MVC
description: В этом учебнике рассматривается добавление заметок к данным в модель данных для указания требований к проверке и форматирования экрана.
author: Rick-Anderson
ms.author: riande
ms.date: 01/28/2019
ms.topic: tutorial
ms.assetid: 0ed5e67a-34c0-4b57-84a6-802b0fb3cd00
msc.legacyurl: /mvc/overview/getting-started/database-first-development/enhancing-data-validation
msc.type: authoredcontent
ms.openlocfilehash: 897cd7c6a40445e2a4abede50d81e101372d3233
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78499536"
---
# <a name="tutorial-enhance-data-validation-for-ef-database-first-with-aspnet-mvc-app"></a>Учебник. Улучшение проверки данных для EF Database First с помощью приложения ASP.NET MVC

С помощью MVC, Entity Framework и шаблонов ASP.NET можно создать веб-приложение, которое предоставляет интерфейс для существующей базы данных. В этой серии руководств показано, как автоматически создавать код, позволяющий пользователям отображать, изменять, создавать и удалять данные, находящиеся в таблице базы данных. Созданный код соответствует столбцам в таблице базы данных.

В этом учебнике рассматривается добавление заметок к данным в модель данных для указания требований к проверке и форматирования экрана. Она была улучшена на основе отзывов пользователей в разделе комментариев.

Изучив это руководство, вы:

> [!div class="checklist"]
> * Добавить заметки к данным
> * Добавление классов метаданных

## <a name="prerequisites"></a>предварительные требования

* [Настройка представления](customizing-a-view.md)

## <a name="add-data-annotations"></a>Добавить заметки к данным

Как было показано в предыдущем разделе, некоторые правила проверки данных автоматически применяются к введенным пользователем данным. Например, можно указать только число для свойства Grade. Чтобы указать дополнительные правила проверки данных, можно добавить заметки к данным в класс модели. Эти заметки применяются ко всему веб-приложению для указанного свойства. Можно также применить атрибуты форматирования, которые изменяют способ отображения свойств. Например, изменение значения, используемого для текстовых меток.

В этом руководстве вы добавите заметки к данным, чтобы ограничить длину значений, указанных для свойств FirstName, LastName и MiddleName. В базе данных эти значения ограничены 50 символами. Однако в веб-приложении ограничения по символам в настоящее время не применяются. Если пользователь предоставляет более 50 символов для одного из этих значений, при попытке сохранить значение в базе данных произойдет сбой страницы. Кроме того, можно ограничить производительность до значений от 0 до 4.

Выберите **модели** > **контосомодел. EDMX** > **ContosoModel.TT** и откройте файл *Student.CS* . Добавьте выделенный ниже код в класс.

[!code-csharp[Main](enhancing-data-validation/samples/sample1.cs?highlight=5,15,17,20)]

Откройте *Enrollment.CS* и добавьте следующий выделенный код.

[!code-csharp[Main](enhancing-data-validation/samples/sample2.cs?highlight=5,10)]

Создайте решение.

Щелкните **список учащихся** и выберите **изменить**. При попытке ввести более 50 символов выводится сообщение об ошибке.

![Отображение сообщения об ошибке](enhancing-data-validation/_static/image1.png)

Вернитесь на домашнюю страницу. Щелкните **список регистраций** и выберите **изменить**. Попытка указать уровень выше 4. Появится следующее сообщение об ошибке: *поле Grade должно находиться в диапазоне от 0 до 4.*

## <a name="add-metadata-classes"></a>Добавление классов метаданных

Добавление атрибутов проверки непосредственно в класс модели работает, если изменение базы данных не предполагается. Однако если база данных изменяется и необходимо повторно создать класс модели, все атрибуты, примененные к классу Model, будут потеряны. Этот подход может быть очень неэффективным и подвержен потере важных правил проверки.

Чтобы избежать этой проблемы, можно добавить класс метаданных, содержащий атрибуты. При связывании класса Model с классом метаданных эти атрибуты применяются к модели. При таком подходе класс модели может быть создан повторно без потери всех атрибутов, примененных к классу метаданных.

В папке **Models** добавьте класс с именем *Metadata.CS*.

Замените код в *Metadata.CS* на следующий код.

[!code-csharp[Main](enhancing-data-validation/samples/sample3.cs)]

Эти классы метаданных содержат все атрибуты проверки, которые ранее были применены к классам модели. Атрибут « **экран** » используется для изменения значения, используемого для текстовых меток.

Теперь классы модели необходимо связать с классами метаданных.

В папке **Models** добавьте класс с именем *PartialClasses.CS*.

Замените содержимое файла на код, приведенный ниже.

[!code-csharp[Main](enhancing-data-validation/samples/sample4.cs)]

Обратите внимание, что каждый класс помечен как класс `partial`, каждый из которых соответствует имени и пространству имен в качестве класса, который создается автоматически. Применяя атрибут метаданных к разделяемому классу, вы гарантируете, что атрибуты проверки данных будут применены к автоматически созданному классу. Эти атрибуты не будут потеряны при повторном создании классов модели, так как атрибут метаданных применяется в разделяемых классах, которые не создаются повторно.

Чтобы повторно создать автоматически создаваемые классы, откройте файл *контосомодел. EDMX* . Опять же, щелкните правой кнопкой мыши область конструктора и выберите пункт **Обновить модель из базы данных**. Несмотря на то, что база данных не была изменена, этот процесс приведет к повторному формированию классов. На вкладке **Обновление** выберите **таблицы** и **Готово**.

Сохраните файл *контосомодел. EDMX* , чтобы применить изменения.

Откройте файл *Student.CS* или *Enrollment.CS* и обратите внимание, что ранее примененные атрибуты проверки данных больше не находятся в файле. Однако запустите приложение и обратите внимание, что правила проверки по-прежнему применяются при вводе данных.

## <a name="conclusion"></a>Заключение

В этой серии представлен простой пример создания кода из существующей базы данных, которая позволяет пользователям изменять, обновлять, создавать и удалять данные. Он использовал ASP.NET MVC 5, Entity Framework и ASP.NET для создания проекта. 

Вводный пример разработки Code First см. в разделе [Начало работы с ASP.NET MVC 5](../introduction/getting-started.md). 

Более сложные примеры см. в разделе [создание Entity Framework модели данных для приложения ASP.NET MVC 4](../getting-started-with-ef-using-mvc/creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md). Обратите внимание, что API DbContext, используемый для работы с данными в Database First, аналогичен API-интерфейсу, используемому для работы с данными в Code First. Даже если вы планируете использовать Database First, вы можете узнать, как обрабатывать более сложные сценарии, такие как чтение и обновление связанных данных, обработка конфликтов параллелизма и т. д. из учебника по Code First. Единственное различие заключается в том, как создаются база данных, класс контекста и классы сущностей.

## <a name="additional-resources"></a>Дополнительные ресурсы

Полный список аннотаций проверки данных, которые можно применять к свойствам и классам, см. в разделе [Примечания к System. ComponentModel](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.aspx).

## <a name="next-steps"></a>Дальнейшие действия

Изучив это руководство, вы:

> [!div class="checklist"]
> * Добавлены заметки к данным
> * Добавленные классы метаданных

Сведения о развертывании веб-приложения и базы данных SQL в службе приложений Azure см. в этом руководстве:
> [!div class="nextstepaction"]
> [Развертывание приложения .NET в службе приложений Azure](/azure/app-service/app-service-web-tutorial-dotnet-sqldatabase/)
