---
uid: mvc/overview/getting-started/database-first-development/setting-up-database
title: Руководство. Начало работы с EF Database First с помощью MVC 5
description: В этом учебнике показано, как начать с существующей базы данных и быстро создать веб-приложение, позволяющее пользователям взаимодействовать с данными.
author: Rick-Anderson
ms.author: riande
ms.date: 01/15/2019
ms.topic: tutorial
ms.assetid: 095abad4-3bfe-4f06-b092-ae6a735b7e49
msc.legacyurl: /mvc/overview/getting-started/database-first-development/setting-up-database
msc.type: authoredcontent
ms.openlocfilehash: a760767839a834a9c7e9fe358a3fd806a833261f
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78471462"
---
# <a name="tutorial-get-started-with-ef-database-first-using-mvc-5"></a><span data-ttu-id="b6cd7-103">Руководство. Начало работы с EF Database First с помощью MVC 5</span><span class="sxs-lookup"><span data-stu-id="b6cd7-103">Tutorial: Get started with EF Database First using MVC 5</span></span>

<span data-ttu-id="b6cd7-104">С помощью MVC, Entity Framework и шаблонов ASP.NET можно создать веб-приложение, которое предоставляет интерфейс для существующей базы данных.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-104">Using MVC, Entity Framework, and ASP.NET Scaffolding, you can create a web application that provides an interface to an existing database.</span></span> <span data-ttu-id="b6cd7-105">В этой серии руководств показано, как автоматически создавать код, позволяющий пользователям отображать, изменять, создавать и удалять данные, находящиеся в таблице базы данных.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-105">This tutorial series shows you how to automatically generate code that enables users to display, edit, create, and delete data that resides in a database table.</span></span> <span data-ttu-id="b6cd7-106">Созданный код соответствует столбцам в таблице базы данных.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-106">The generated code corresponds to the columns in the database table.</span></span> <span data-ttu-id="b6cd7-107">В последней части серии вы узнаете, как добавить заметки к данным в модель данных, чтобы задать требования к проверке и формат отображения.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-107">In the last part of the series, you learn how add data annotations to the data model to specify validation requirements and display formatting.</span></span> <span data-ttu-id="b6cd7-108">Когда все будет готово, вы можете перейти к статье Azure, чтобы узнать, как развернуть приложение .NET и базу данных SQL в службе приложений Azure.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-108">When you're done, you can advance to an Azure article to learn how to deploy a .NET app and SQL database to Azure App Service.</span></span>

<span data-ttu-id="b6cd7-109">В этом учебнике показано, как начать с существующей базы данных и быстро создать веб-приложение, позволяющее пользователям взаимодействовать с данными.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-109">This tutorial shows how to start with an existing database and quickly create a web application that enables users to interact with the data.</span></span> <span data-ttu-id="b6cd7-110">Для создания веб-приложения используется Entity Framework 6 и MVC 5.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-110">It uses the Entity Framework 6 and MVC 5 to build the web application.</span></span> <span data-ttu-id="b6cd7-111">Функция формирования шаблонов ASP.NET позволяет автоматически создавать код для отображения, обновления, создания и удаления данных.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-111">The ASP.NET Scaffolding feature enables you to automatically generate code for displaying, updating, creating and deleting data.</span></span> <span data-ttu-id="b6cd7-112">С помощью средств публикации в Visual Studio можно легко развернуть сайт и базу данных в Azure.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-112">Using the publishing tools within Visual Studio, you can easily deploy the site and database to Azure.</span></span>

<span data-ttu-id="b6cd7-113">Эта часть серии посвящена созданию базы данных и заполнению ее данными.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-113">This part of the series focuses on creating a database and populating it with data.</span></span>

<span data-ttu-id="b6cd7-114">Эта серия была написана с вкладами из Tom Dykstra) и Рик Андерсон (.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-114">This series was written with contributions from Tom Dykstra and Rick Anderson.</span></span> <span data-ttu-id="b6cd7-115">Она была улучшена на основе отзывов пользователей в разделе комментариев.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-115">It was improved based on feedback from users in the comments section.</span></span>

<span data-ttu-id="b6cd7-116">Изучив это руководство, вы:</span><span class="sxs-lookup"><span data-stu-id="b6cd7-116">In this tutorial, you:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="b6cd7-117">Настройка базы данных</span><span class="sxs-lookup"><span data-stu-id="b6cd7-117">Set up the database</span></span>

## <a name="prerequisites"></a><span data-ttu-id="b6cd7-118">предварительные требования</span><span class="sxs-lookup"><span data-stu-id="b6cd7-118">Prerequisites</span></span>

[<span data-ttu-id="b6cd7-119">Visual Studio 2017</span><span class="sxs-lookup"><span data-stu-id="b6cd7-119">Visual Studio 2017</span></span>](https://visualstudio.microsoft.com/downloads/)

## <a name="set-up-the-database"></a><span data-ttu-id="b6cd7-120">Настройка базы данных</span><span class="sxs-lookup"><span data-stu-id="b6cd7-120">Set up the database</span></span>

<span data-ttu-id="b6cd7-121">Чтобы имитировать среду с существующей базой данных, сначала необходимо создать базу данных с предварительно заполненными данными, а затем создать веб-приложение, которое подключается к базе данных.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-121">To mimic the environment of having an existing database, you will first create a database with some pre-filled data, and then create your web application that connects to the database.</span></span>

<span data-ttu-id="b6cd7-122">Этот учебник был разработан с помощью LocalDB в Visual Studio 2017.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-122">This tutorial was developed using LocalDB with Visual Studio 2017.</span></span> <span data-ttu-id="b6cd7-123">Можно использовать существующий сервер базы данных вместо LocalDB, но в зависимости от версии Visual Studio и типа базы данных все средства работы с данными в Visual Studio могут не поддерживаться.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-123">You can use an existing database server instead of LocalDB, but depending on your version of Visual Studio and your type of database, all of the data tools in Visual Studio might not be supported.</span></span> <span data-ttu-id="b6cd7-124">Если средства недоступны для вашей базы данных, может потребоваться выполнить некоторые действия, связанные с базой данных, в наборе Management Suite для своей базы данных.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-124">If the tools are not available for your database, you may need to perform some of the database-specific steps within the management suite for your database.</span></span>

<span data-ttu-id="b6cd7-125">Если у вас возникли проблемы с инструментами для работы с базами данных в вашей версии Visual Studio, убедитесь, что установлена последняя версия инструментов для работы с базами данных.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-125">If you have a problem with the database tools in your version of Visual Studio, make sure you have installed the latest version of the database tools.</span></span> <span data-ttu-id="b6cd7-126">Сведения об обновлении или установке средств базы данных см. в разделе [Microsoft SQL Server Data Tools](https://msdn.microsoft.com/data/hh297027).</span><span class="sxs-lookup"><span data-stu-id="b6cd7-126">For information about updating or installing the database tools, see [Microsoft SQL Server Data Tools](https://msdn.microsoft.com/data/hh297027).</span></span>

<span data-ttu-id="b6cd7-127">Запустите Visual Studio и создайте **проект базы данных SQL Server**.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-127">Launch Visual Studio and create a **SQL Server Database Project**.</span></span> <span data-ttu-id="b6cd7-128">Назовите проект **контосауниверситидата**.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-128">Name the project **ContosoUniversityData**.</span></span>

![Создание проекта базы данных](setting-up-database/_static/image1.png)

<span data-ttu-id="b6cd7-130">Теперь у вас есть пустой проект базы данных.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-130">You now have an empty database project.</span></span> <span data-ttu-id="b6cd7-131">Чтобы обеспечить возможность развертывания этой базы данных в Azure, необходимо настроить базу данных SQL Azure в качестве целевой платформы для проекта.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-131">To make sure that you can deploy this database to Azure, you'll set Azure SQL Database as the target platform for the project.</span></span> <span data-ttu-id="b6cd7-132">Настройка целевой платформы на самом деле не развертывает базу данных; Это означает, что проект базы данных будет проверять совместимость структуры базы данных с целевой платформой.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-132">Setting the target platform does not actually deploy the database; it only means that the database project will verify that the database design is compatible with the target platform.</span></span> <span data-ttu-id="b6cd7-133">Чтобы задать целевую платформу, откройте **Свойства** проекта и выберите **база данных SQL Microsoft Azure** для целевой платформы.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-133">To set the target platform, open the **Properties** for the project and select **Microsoft Azure SQL Database** for the target platform.</span></span>

<span data-ttu-id="b6cd7-134">Таблицы, необходимые для работы с этим руководством, можно создать, добавив скрипты SQL, определяющие таблицы.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-134">You can create the tables needed for this tutorial by adding SQL scripts that define the tables.</span></span> <span data-ttu-id="b6cd7-135">Щелкните правой кнопкой мыши проект и добавьте новый элемент.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-135">Right-click your project and add a new item.</span></span> <span data-ttu-id="b6cd7-136">Выберите **таблицы и представления** > **таблицу** и назовите ее *Student*.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-136">Select **Tables and Views** > **Table** and name it *Student*.</span></span>

<span data-ttu-id="b6cd7-137">В файле таблицы замените команду T-SQL следующим кодом, чтобы создать таблицу.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-137">In the table file, replace the T-SQL command with the following code to create the table.</span></span>

[!code-sql[Main](setting-up-database/samples/sample1.sql)]

<span data-ttu-id="b6cd7-138">Обратите внимание, что окно конструктора автоматически синхронизируется с кодом.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-138">Notice that the design window automatically synchronizes with the code.</span></span> <span data-ttu-id="b6cd7-139">Можно работать с кодом или конструктором.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-139">You can work with either the code or designer.</span></span>

![Отображение кода и дизайна](setting-up-database/_static/image5.png)

<span data-ttu-id="b6cd7-141">Добавьте еще одну таблицу.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-141">Add another table.</span></span> <span data-ttu-id="b6cd7-142">На этот раз назовите этот курс и используйте следующую команду T-SQL.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-142">This time name it Course and use the following T-SQL command.</span></span>

[!code-sql[Main](setting-up-database/samples/sample2.sql)]

<span data-ttu-id="b6cd7-143">И повторите еще один раз, чтобы создать таблицу с именем "регистрация".</span><span class="sxs-lookup"><span data-stu-id="b6cd7-143">And, repeat one more time to create a table named Enrollment.</span></span>

[!code-sql[Main](setting-up-database/samples/sample3.sql)]

<span data-ttu-id="b6cd7-144">Вы можете заполнить базу данных данными с помощью скрипта, который выполняется после развертывания базы данных.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-144">You can populate your database with data through a script that is run after the database is deployed.</span></span> <span data-ttu-id="b6cd7-145">Добавьте скрипт, выполняемый после развертывания, в проект.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-145">Add a Post-Deployment Script to the project.</span></span> <span data-ttu-id="b6cd7-146">Щелкните правой кнопкой мыши проект и добавьте новый элемент.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-146">Right-click your project and add a new item.</span></span> <span data-ttu-id="b6cd7-147">Выберите **пользовательские скрипты** > **скрипт, выполняемый после развертывания**.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-147">Select **User Scripts** > **Post-Deployment Script**.</span></span> <span data-ttu-id="b6cd7-148">Можно использовать имя по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-148">You can use the default name.</span></span>

<span data-ttu-id="b6cd7-149">Добавьте следующий код T-SQL в скрипт, выполняемый после развертывания.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-149">Add the following T-SQL code to the post-deployment script.</span></span> <span data-ttu-id="b6cd7-150">Этот сценарий просто добавляет данные в базу данных, если совпадающая запись не найдена.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-150">This script simply adds data to the database when no matching record is found.</span></span> <span data-ttu-id="b6cd7-151">Он не перезаписывает или не удаляет данные, которые могли быть введены в базу данных.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-151">It does not overwrite or delete any data you may have entered into the database.</span></span>

[!code-sql[Main](setting-up-database/samples/sample4.sql)]

<span data-ttu-id="b6cd7-152">Важно отметить, что скрипт, выполняемый после развертывания, выполняется каждый раз при развертывании проекта базы данных.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-152">It is important to note that the post-deployment script is run every time you deploy your database project.</span></span> <span data-ttu-id="b6cd7-153">Поэтому при написании этого сценария необходимо тщательно продумать свои требования.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-153">Therefore, you need to carefully consider your requirements when writing this script.</span></span> <span data-ttu-id="b6cd7-154">В некоторых случаях может потребоваться начать с известного набора данных каждый раз при развертывании проекта.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-154">In some cases, you may wish to start over from a known set of data every time the project is deployed.</span></span> <span data-ttu-id="b6cd7-155">В других случаях изменять существующие данные каким бы то ни было не нужно.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-155">In other cases, you may not want to alter the existing data in any way.</span></span> <span data-ttu-id="b6cd7-156">В зависимости от требований вы можете решить, нужен ли вам скрипт, выполняемый после развертывания, или что необходимо включить в скрипт.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-156">Based on your requirements, you can decide whether you need a post-deployment script or what you need to include in the script.</span></span> <span data-ttu-id="b6cd7-157">Дополнительные сведения о заполнении базы данных с помощью скрипта, выполняемого после развертывания, см. [в разделе Включение данных в проект базы данных SQL Server](https://blogs.msdn.com/b/ssdt/archive/2012/02/02/including-data-in-an-sql-server-database-project.aspx).</span><span class="sxs-lookup"><span data-stu-id="b6cd7-157">For more information about populating your database with a post-deployment script, see [Including Data in a SQL Server Database Project](https://blogs.msdn.com/b/ssdt/archive/2012/02/02/including-data-in-an-sql-server-database-project.aspx).</span></span>

<span data-ttu-id="b6cd7-158">Теперь у вас есть 4 файла скриптов SQL, но нет фактических таблиц.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-158">You now have 4 SQL script files but no actual tables.</span></span> <span data-ttu-id="b6cd7-159">Вы готовы к развертыванию проекта базы данных в LocalDB.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-159">You are ready to deploy your database project to localdb.</span></span> <span data-ttu-id="b6cd7-160">В Visual Studio нажмите кнопку запустить (или клавишу F5), чтобы выполнить сборку и развертывание проекта базы данных.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-160">In Visual Studio, click the Start button (or F5) to build and deploy your database project.</span></span> <span data-ttu-id="b6cd7-161">Перейдите на вкладку **выходные данные** , чтобы убедиться в успешности сборки и развертывания.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-161">Check the **Output** tab to verify that the build and deployment succeeded.</span></span>

<span data-ttu-id="b6cd7-162">Чтобы увидеть, что новая база данных создана, откройте **Обозреватель объектов SQL Server** и найдите имя проекта на правильном локальном сервере базы данных (в данном случае — **LocalDB) \ProjectsV13**).</span><span class="sxs-lookup"><span data-stu-id="b6cd7-162">To see that the new database has been created, open **SQL Server Object Explorer** and look for the name of the project in the correct local database server (in this case **(localdb)\ProjectsV13**).</span></span>

<span data-ttu-id="b6cd7-163">Чтобы убедиться, что таблицы заполнены данными, щелкните правой кнопкой мыши таблицу и выберите пункт **Просмотреть данные**.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-163">To see that the tables are populated with data, right-click a table, and select **View Data**.</span></span>

![Отображение данных таблицы](setting-up-database/_static/image9.png)

<span data-ttu-id="b6cd7-165">Отображается редактируемое представление данных таблицы.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-165">An editable view of the table data is displayed.</span></span> <span data-ttu-id="b6cd7-166">Например, если выбрать **таблицы** > **dbo. Course** > **Просмотреть данные**, то отобразится таблица с тремя столбцами (**курс**, **заголовок**и **кредиты**) и четырьмя строками.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-166">For example, if you select **Tables** > **dbo.course** > **View Data**, you see a table with three columns (**Course**, **Title**, and **Credits**) and four rows.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="b6cd7-167">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="b6cd7-167">Additional resources</span></span>

<span data-ttu-id="b6cd7-168">Вводный пример разработки Code First см. в разделе [Начало работы с ASP.NET MVC 5](../introduction/getting-started.md).</span><span class="sxs-lookup"><span data-stu-id="b6cd7-168">For an introductory example of Code First development, see [Getting Started with ASP.NET MVC 5](../introduction/getting-started.md).</span></span> <span data-ttu-id="b6cd7-169">Более сложные примеры см. в разделе [создание Entity Framework модели данных для приложения ASP.NET MVC 4](../getting-started-with-ef-using-mvc/creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span><span class="sxs-lookup"><span data-stu-id="b6cd7-169">For a more advanced example, see [Creating an Entity Framework Data Model for an ASP.NET MVC 4 App](../getting-started-with-ef-using-mvc/creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span></span>

<span data-ttu-id="b6cd7-170">Рекомендации по выбору используемого подхода Entity Framework см. в разделе [Entity Framework подходов к разработке](https://msdn.microsoft.com/library/ms178359.aspx#dbfmfcf).</span><span class="sxs-lookup"><span data-stu-id="b6cd7-170">For guidance on selecting which Entity Framework approach to use, see [Entity Framework Development Approaches](https://msdn.microsoft.com/library/ms178359.aspx#dbfmfcf).</span></span>

## <a name="next-steps"></a><span data-ttu-id="b6cd7-171">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="b6cd7-171">Next steps</span></span>

<span data-ttu-id="b6cd7-172">Изучив это руководство, вы:</span><span class="sxs-lookup"><span data-stu-id="b6cd7-172">In this tutorial, you:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="b6cd7-173">Настройка базы данных</span><span class="sxs-lookup"><span data-stu-id="b6cd7-173">Set up the database</span></span>

<span data-ttu-id="b6cd7-174">Перейдите к следующему руководству, чтобы узнать, как создать веб-приложение и модели данных.</span><span class="sxs-lookup"><span data-stu-id="b6cd7-174">Advance to the next tutorial to learn how to create the web application and data models.</span></span>
> [!div class="nextstepaction"]
> [<span data-ttu-id="b6cd7-175">Создание веб-приложения и моделей данных</span><span class="sxs-lookup"><span data-stu-id="b6cd7-175">Create the web application and data models</span></span>](creating-the-web-application.md)
