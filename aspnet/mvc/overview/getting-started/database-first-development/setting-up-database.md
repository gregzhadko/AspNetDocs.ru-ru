---
uid: mvc/overview/getting-started/database-first-development/setting-up-database
title: Руководство. Начало работы с EF Database First с помощью MVC 5
description: В этом учебнике показано, как начать с существующей базы данных и быстро создать веб-приложение, позволяющее пользователям взаимодействовать с данными.
author: Rick-Anderson
ms.author: riande
ms.date: 01/15/2019
ms.topic: tutorial
ms.assetid: 095abad4-3bfe-4f06-b092-ae6a735b7e49
msc.legacyurl: /mvc/overview/getting-started/database-first-development/setting-up-database
msc.type: authoredcontent
ms.openlocfilehash: a760767839a834a9c7e9fe358a3fd806a833261f
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78471462"
---
# <a name="tutorial-get-started-with-ef-database-first-using-mvc-5"></a>Руководство. Начало работы с EF Database First с помощью MVC 5

С помощью MVC, Entity Framework и шаблонов ASP.NET можно создать веб-приложение, которое предоставляет интерфейс для существующей базы данных. В этой серии руководств показано, как автоматически создавать код, позволяющий пользователям отображать, изменять, создавать и удалять данные, находящиеся в таблице базы данных. Созданный код соответствует столбцам в таблице базы данных. В последней части серии вы узнаете, как добавить заметки к данным в модель данных, чтобы задать требования к проверке и формат отображения. Когда все будет готово, вы можете перейти к статье Azure, чтобы узнать, как развернуть приложение .NET и базу данных SQL в службе приложений Azure.

В этом учебнике показано, как начать с существующей базы данных и быстро создать веб-приложение, позволяющее пользователям взаимодействовать с данными. Для создания веб-приложения используется Entity Framework 6 и MVC 5. Функция формирования шаблонов ASP.NET позволяет автоматически создавать код для отображения, обновления, создания и удаления данных. С помощью средств публикации в Visual Studio можно легко развернуть сайт и базу данных в Azure.

Эта часть серии посвящена созданию базы данных и заполнению ее данными.

Эта серия была написана с вкладами из Tom Dykstra) и Рик Андерсон (. Она была улучшена на основе отзывов пользователей в разделе комментариев.

Изучив это руководство, вы:

> [!div class="checklist"]
> * Настройка базы данных

## <a name="prerequisites"></a>предварительные требования

[Visual Studio 2017](https://visualstudio.microsoft.com/downloads/)

## <a name="set-up-the-database"></a>Настройка базы данных

Чтобы имитировать среду с существующей базой данных, сначала необходимо создать базу данных с предварительно заполненными данными, а затем создать веб-приложение, которое подключается к базе данных.

Этот учебник был разработан с помощью LocalDB в Visual Studio 2017. Можно использовать существующий сервер базы данных вместо LocalDB, но в зависимости от версии Visual Studio и типа базы данных все средства работы с данными в Visual Studio могут не поддерживаться. Если средства недоступны для вашей базы данных, может потребоваться выполнить некоторые действия, связанные с базой данных, в наборе Management Suite для своей базы данных.

Если у вас возникли проблемы с инструментами для работы с базами данных в вашей версии Visual Studio, убедитесь, что установлена последняя версия инструментов для работы с базами данных. Сведения об обновлении или установке средств базы данных см. в разделе [Microsoft SQL Server Data Tools](https://msdn.microsoft.com/data/hh297027).

Запустите Visual Studio и создайте **проект базы данных SQL Server**. Назовите проект **контосауниверситидата**.

![Создание проекта базы данных](setting-up-database/_static/image1.png)

Теперь у вас есть пустой проект базы данных. Чтобы обеспечить возможность развертывания этой базы данных в Azure, необходимо настроить базу данных SQL Azure в качестве целевой платформы для проекта. Настройка целевой платформы на самом деле не развертывает базу данных; Это означает, что проект базы данных будет проверять совместимость структуры базы данных с целевой платформой. Чтобы задать целевую платформу, откройте **Свойства** проекта и выберите **база данных SQL Microsoft Azure** для целевой платформы.

Таблицы, необходимые для работы с этим руководством, можно создать, добавив скрипты SQL, определяющие таблицы. Щелкните правой кнопкой мыши проект и добавьте новый элемент. Выберите **таблицы и представления** > **таблицу** и назовите ее *Student*.

В файле таблицы замените команду T-SQL следующим кодом, чтобы создать таблицу.

[!code-sql[Main](setting-up-database/samples/sample1.sql)]

Обратите внимание, что окно конструктора автоматически синхронизируется с кодом. Можно работать с кодом или конструктором.

![Отображение кода и дизайна](setting-up-database/_static/image5.png)

Добавьте еще одну таблицу. На этот раз назовите этот курс и используйте следующую команду T-SQL.

[!code-sql[Main](setting-up-database/samples/sample2.sql)]

И повторите еще один раз, чтобы создать таблицу с именем "регистрация".

[!code-sql[Main](setting-up-database/samples/sample3.sql)]

Вы можете заполнить базу данных данными с помощью скрипта, который выполняется после развертывания базы данных. Добавьте скрипт, выполняемый после развертывания, в проект. Щелкните правой кнопкой мыши проект и добавьте новый элемент. Выберите **пользовательские скрипты** > **скрипт, выполняемый после развертывания**. Можно использовать имя по умолчанию.

Добавьте следующий код T-SQL в скрипт, выполняемый после развертывания. Этот сценарий просто добавляет данные в базу данных, если совпадающая запись не найдена. Он не перезаписывает или не удаляет данные, которые могли быть введены в базу данных.

[!code-sql[Main](setting-up-database/samples/sample4.sql)]

Важно отметить, что скрипт, выполняемый после развертывания, выполняется каждый раз при развертывании проекта базы данных. Поэтому при написании этого сценария необходимо тщательно продумать свои требования. В некоторых случаях может потребоваться начать с известного набора данных каждый раз при развертывании проекта. В других случаях изменять существующие данные каким бы то ни было не нужно. В зависимости от требований вы можете решить, нужен ли вам скрипт, выполняемый после развертывания, или что необходимо включить в скрипт. Дополнительные сведения о заполнении базы данных с помощью скрипта, выполняемого после развертывания, см. [в разделе Включение данных в проект базы данных SQL Server](https://blogs.msdn.com/b/ssdt/archive/2012/02/02/including-data-in-an-sql-server-database-project.aspx).

Теперь у вас есть 4 файла скриптов SQL, но нет фактических таблиц. Вы готовы к развертыванию проекта базы данных в LocalDB. В Visual Studio нажмите кнопку запустить (или клавишу F5), чтобы выполнить сборку и развертывание проекта базы данных. Перейдите на вкладку **выходные данные** , чтобы убедиться в успешности сборки и развертывания.

Чтобы увидеть, что новая база данных создана, откройте **Обозреватель объектов SQL Server** и найдите имя проекта на правильном локальном сервере базы данных (в данном случае — **LocalDB) \ProjectsV13**).

Чтобы убедиться, что таблицы заполнены данными, щелкните правой кнопкой мыши таблицу и выберите пункт **Просмотреть данные**.

![Отображение данных таблицы](setting-up-database/_static/image9.png)

Отображается редактируемое представление данных таблицы. Например, если выбрать **таблицы** > **dbo. Course** > **Просмотреть данные**, то отобразится таблица с тремя столбцами (**курс**, **заголовок**и **кредиты**) и четырьмя строками.

## <a name="additional-resources"></a>Дополнительные ресурсы

Вводный пример разработки Code First см. в разделе [Начало работы с ASP.NET MVC 5](../introduction/getting-started.md). Более сложные примеры см. в разделе [создание Entity Framework модели данных для приложения ASP.NET MVC 4](../getting-started-with-ef-using-mvc/creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).

Рекомендации по выбору используемого подхода Entity Framework см. в разделе [Entity Framework подходов к разработке](https://msdn.microsoft.com/library/ms178359.aspx#dbfmfcf).

## <a name="next-steps"></a>Дальнейшие действия

Изучив это руководство, вы:

> [!div class="checklist"]
> * Настройка базы данных

Перейдите к следующему руководству, чтобы узнать, как создать веб-приложение и модели данных.
> [!div class="nextstepaction"]
> [Создание веб-приложения и моделей данных](creating-the-web-application.md)
