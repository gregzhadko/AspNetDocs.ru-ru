---
title: Добавление представления в приложение MVC
author: Rick-Anderson
description: Добавление представления в приложение MVC
ms.author: riande
ms.date: 01/23/2019
uid: mvc/overview/getting-started/introduction/adding-a-view
ms.openlocfilehash: b8400036cc689d3cd2fec54b3191252d296ade41
ms.sourcegitcommit: 4e6d586faadbe4d9ef27122f86335ec9385134af
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/28/2020
ms.locfileid: "89045017"
---
# <a name="adding-a-view"></a>Добавление представления

по [Рик Андерсон (](https://twitter.com/RickAndMSFT)

[!INCLUDE [consider RP](~/includes/razor.md)]

В этом разделе вы намерены изменить `HelloWorldController` класс, чтобы использовать представление файлов шаблонов для чистого инкапсуляции процесса создания HTML-ответов клиенту. 

Вы создадите файл шаблона представления с помощью [подсистемы представлений Razor](../../../../web-pages/overview/getting-started/introducing-razor-syntax-c.md). Шаблоны представлений на основе Razor имеют расширение *. cshtml* и предоставляют элегантный способ создания выходных данных HTML с помощью C#. Razor уменьшает количество символов и нажатий клавиш, необходимых при написании шаблона представления, и обеспечивает быстрый и жидкий рабочий процесс кодирования.

На данный момент метод `Index` возвращает строку с сообщением, которое жестко задано в классе контроллера. Измените `Index` метод, чтобы вызвать метод [представления](/dotnet/api/microsoft.aspnetcore.mvc.controller.view#Microsoft_AspNetCore_Mvc_Controller_View) Controllers, как показано в следующем коде:

[!code-csharp[Main](adding-a-view/samples/sample1.cs?highlight=1,3)]

`Index`Приведенный выше метод использует шаблон представления для создания HTML-ответа браузеру. Методы контроллера (также известные как [методы действий](http://rachelappel.com/asp.net-mvc-actionresults-explained)), например `Index` приведенный выше метод, обычно возвращают [ActionResult](https://msdn.microsoft.com/library/system.web.mvc.actionresult.aspx) (или класс, производный от [ActionResult](https://msdn.microsoft.com/library/system.web.mvc.actionresult.aspx)), а не примитивные типы, такие как String.

Щелкните правой кнопкой мыши папку *виевс\хелловорлд* и выберите **Добавить**, а затем выберите **страницу представления MVC 5 с макетом (Razor)**.
  
![](adding-a-view/_static/image1.png)   
  
В диалоговом окне **Указание имени для элемента** введите *index*и нажмите кнопку **ОК**.  
  
![](adding-a-view/_static/image2.png)  
  
В диалоговом окне **Выбор страницы макета** примите значение по умолчанию ** \_ Layout. cshtml** и нажмите кнопку **ОК**.  
  
![](adding-a-view/_static/image3.png)  
  
В диалоговом окне выше в левой области выбирается папка *Views\Shared* . Если файл пользовательского макета был создан в другой папке, можно выбрать его. Далее в этом руководстве мы поговорим о файле макета.

Будет создан файл *мвкмовие\виевс\хелловорлд\индекс.кштмл* .

![](adding-a-view/_static/image4.png)

Добавьте следующую выделенную разметку.

[!code-cshtml[Main](adding-a-view/samples/sample2.cshtml?highlight=4-11)]

Щелкните правой кнопкой мыши файл *index. cshtml* и выберите **Просмотреть в браузере**.

![PI](adding-a-view/_static/image5.png)

Можно также щелкнуть правой кнопкой мыши файл *index. cshtml* и выбрать пункт **Просмотреть в инспектор страниц.** Дополнительные сведения см. в [руководстве по инспектор страниц](../../views/using-page-inspector-in-aspnet-mvc.md) .

Также можно запустить приложение и перейти к `HelloWorld` контроллеру ( `http://localhost:xxxx/HelloWorld` ). `Index`Метод в вашем контроллере не требует много усилий. он просто выполнил инструкцию `return View()` , которая указывала, что метод должен использовать файл шаблона представления для отображения ответа в браузере. Так как вы не указали имя используемого файла шаблона представления, ASP.NET MVC по умолчанию использует файл представления *index. cshtml* в папке *\виевс\хелловорлд* . На рисунке ниже показана строка &quot; Hello из нашего шаблона представления &quot; . жестко запрограммирована в представлении.

![](adding-a-view/_static/image6.png)

Выглядит довольно хорошо. Однако обратите внимание, что в заголовке окна браузера отображается «Index-My ASP.NET приложение», а в верхней части страницы — «имя приложения». В зависимости от того, насколько мелким будет окно браузера, может потребоваться щелкнуть три полосы в правом верхнем углу, чтобы открыть ссылки **Домашняя страница**, **сведения о** **контакте**, **Регистрация** и **Вход в систему** .

## <a name="changing-views-and-layout-pages"></a>Изменение представлений и страниц макета

Сначала нужно изменить &quot; ссылку на имя приложения &quot; в верхней части страницы. Этот текст является общим для каждой страницы. Фактически он реализуется только в одном месте проекта, хотя он отображается на каждой странице приложения. Перейдите в папку */виевс/Шаред* в **Обозреватель решений** и откройте файл * \_ Layout. cshtml* . Этот файл называется *страницей макета* и находится в общей папке, используемой всеми остальными страницами.

![_LayoutCshtml](adding-a-view/_static/image7.png)

С помощью шаблонов макета можно в одном месте задать макет контейнера HTML для всего сайта и затем использовать его на разных страницах сайта. Найдите строку `@RenderBody()`. `RenderBody` — это заполнитель, в котором отображаются все создаваемые страницы для определенных представлений, &quot;упакованные&quot; на странице макета. Например, если выбрать ссылку **About** , представление *виевс\хоме\абаут.кштмл* будет отображено внутри `RenderBody` метода.

Измените содержимое элемента title. Измените значение [ActionLink](https://msdn.microsoft.com/library/dd504972(v=vs.108).aspx) в шаблоне макета с " &quot; имя приложения" &quot; на &quot; "ролик" в MVC &quot; и контроллер с `Home` на `Movies` . Полный файл макета приведен ниже.

[!code-cshtml[Main](adding-a-view/samples/sample3.cshtml?highlight=6,20)]

Запустите приложение и обратите внимание, что теперь он говорит о &quot; ролике MVC &quot; . Щелкните ссылку **About (о программе** ), и вы увидите, как на этой странице &quot; также отображается ролик MVC &quot; . Мы смогли внести изменения один раз в шаблон макета и все страницы сайта отражали новый заголовок.

![](adding-a-view/_static/image8.png)

Когда мы сначала создали файл *виевс\хелловорлд\индекс.кштмл* , он содержал следующий код:

[!code-cshtml[Main](adding-a-view/samples/sample4.cshtml)]

Приведенный выше код Razor явно задает страницу макета. Изучите файл *views \\ _ViewStart. cshtml* , он содержит точную разметку Razor. Файл *[views \\ _ViewStart. cshtml](https://weblogs.asp.net/scottgu/archive/2010/10/22/asp-net-mvc-3-layouts.aspx)* определяет общий макет, который будет использоваться всеми представлениями, поэтому можно закомментировать или удалить этот код из файла *виевс\хелловорлд\индекс.кштмл* .

[!code-cshtml[Main](adding-a-view/samples/sample5.cshtml?highlight=1-3)]

Свойство `Layout` может задавать другое представление макета или иметь значение `null`, при котором макет не используется.

Теперь изменим заголовок представления индекса.

Откройте *мвкмовие\виевс\хелловорлд\индекс.кштмл*. Изменение состоит из двух мест: первый — текст, отображаемый в заголовке браузера, а затем во вторичном заголовке ( `<h2>` элемент). Сделайте их немного разными, чтобы видеть, какой именно фрагмент кода изменяет соответствующую часть приложения.

[!code-cshtml[Main](adding-a-view/samples/sample6.cshtml?highlight=2,5)]

Чтобы указать отображаемый заголовок HTML, приведенный выше код задает `Title` свойство `ViewBag` объекта (которое находится в шаблоне представления *index. cshtml* ). Обратите внимание, что шаблон макета ( *Views\Shared \\ _layout. cshtml* ) использует это значение в `<title>` ЭЛЕМЕНТЕ как часть `<head>` раздела HTML, который мы изменили ранее.

[!code-cshtml[Main](adding-a-view/samples/sample7.cshtml?highlight=6)]

С помощью этого `ViewBag` подхода можно легко передавать другие параметры между шаблоном представления и файлом макета.

Запустите приложение. Обратите внимание, что основной и дополнительный заголовки браузера изменились. (Если изменения не отображаются, возможно, вы просматриваете кэшированное содержимое. Нажмите сочетание клавиш CTRL + F5 в браузере, чтобы принудительно загрузить ответ от сервера.) Заголовок браузера создается с `ViewBag.Title` заданными в шаблоне представления *index. cshtml* и дополнительным &quot; приложением-фильмом, &quot; добавленным в файл макета.

Также обратите внимание, что содержимое в шаблоне представления *index. cshtml* было объединено с шаблоном представления * \_ Layout. cshtml* и в браузер был отправлен один ответ HTML. С помощью шаблонов макета можно легко вносить изменения, которые применяются ко всем страницам приложения.

![](adding-a-view/_static/image9.png)

Немало &quot; данных &quot; (в данном случае &quot; Hello из нашего шаблона представления! &quot; Message) жестко закодированы. Приложение MVC имеет &quot; V &quot; (представление), и у вас есть &quot; C &quot; (контроллер), но &quot; еще нет M &quot; (модель). Вскоре мы рассмотрим, как создать базу данных и извлечь из нее данные модели.

## <a name="passing-data-from-the-controller-to-the-view"></a>Передача данных из контроллера в представление

Тем не менее, прежде чем перейти к базе данных и поговорить о моделях, давайте сначала поговорим о передаче информации из контроллера в представление. Классы контроллеров вызываются в ответ на входящий запрос URL-адреса. Класс контроллера — это место написания кода, обрабатывающего входящие запросы браузера, получение данных из базы данных и, в конечном итоге, выбор типа ответа, отправляемого обратно в браузер. Шаблоны представлений можно использовать из контроллера для создания и форматирования HTML-ответа в браузере.

Контроллеры несут ответственность за предоставление любых данных или объектов, необходимых для отображения шаблона представления в ответ на браузер. Рекомендуется: **шаблон представления никогда не должен выполнять бизнес-логику или напрямую взаимодействовать с базой данных**. Вместо этого шаблон представления должен работать только с данными, предоставленными ему контроллером. Поддержание такого &quot; разделения проблем &quot; помогает обеспечить чистоту, тестирование и удобство сопровождения кода.

В настоящее время `Welcome` метод действия в `HelloWorldController` классе принимает `name` и `numTimes` параметр, а затем выводит значения непосредственно в браузер. Вместо того, чтобы передавать этот ответ контроллером в виде строки, давайте изменим контроллер на использование шаблона представления. Шаблон представления создаст динамический ответ, для получения которого необходимо передать соответствующие фрагменты данных из контроллера в представление. Для этого контроллер должен разместить динамические данные (параметры), необходимые шаблону представления, в `ViewBag` объекте, к которому может получить доступ шаблон представления.

Вернитесь в файл *HelloWorldController.CS* и измените метод, `Welcome` чтобы добавить в `Message` `NumTimes` объект значение и `ViewBag` . `ViewBag` — Это динамический объект, который означает, что вы можете поместить в него все необходимое. `ViewBag` объект не имеет определенных свойств, пока вы не помещаете в него что-либо. [Система привязки модели MVC ASP.NET](http://odetocode.com/Blogs/scott/archive/2009/04/27/6-tips-for-asp-net-mvc-model-binding.aspx) автоматически сопоставляет именованные параметры ( `name` и `numTimes` ) из строки запроса в адресной строке с параметрами в методе. Полный файл *HelloWorldController.cs* выглядит следующим образом:

[!code-csharp[Main](adding-a-view/samples/sample8.cs)]

Теперь `ViewBag` объект содержит данные, которые будут автоматически передаваться в представление. Теперь вам нужен шаблон представления приветствия! В меню **Сборка** выберите **собрать решение** (или CTRL + SHIFT + B), чтобы убедиться, что проект скомпилирован. Щелкните правой кнопкой мыши папку *виевс\хелловорлд* и выберите **Добавить**, а затем выберите **страницу представления MVC 5 с макетом (Razor)**.
  
![](adding-a-view/_static/image10.png)   
  
В диалоговом окне **Укажите имя для элемента** введите *Welcome*и нажмите кнопку **ОК**.   
  
В диалоговом окне **Выбор страницы макета** примите значение по умолчанию ** \_ Layout. cshtml** и нажмите кнопку **ОК**.  
  
![](adding-a-view/_static/image11.png)   

Будет создан файл *мвкмовие\виевс\хелловорлд\велкоме.кштмл* .

Замените разметку в файле *Welcome. cshtml* . Вы создадите цикл с текстом Hello столько &quot; &quot; раз, сколько говорит пользователь. Полный файл *Welcome. cshtml* приведен ниже.

[!code-cshtml[Main](adding-a-view/samples/sample9.cshtml)]

Запустите приложение и перейдите по следующему URL-адресу:

`http://localhost:xx/HelloWorld/Welcome?name=Scott&numtimes=4`

Теперь данные берутся из URL-адреса и передаются контроллеру с помощью [связывателя модели](http://odetocode.com/Blogs/scott/archive/2009/04/27/6-tips-for-asp-net-mvc-model-binding.aspx). Контроллер упаковывает данные в `ViewBag` объект и передает этот объект в представление. Представление затем отображает данные в виде HTML-кода для пользователя.

![](adding-a-view/_static/image12.png)

В приведенном выше примере мы использовали `ViewBag` объект для передачи данных из контроллера в представление. Далее в этом руководстве для передачи данных из контроллера в представление мы будем использовать модель представления. Подход модели представления для передачи данных, как правило, является более предпочтительным по сравнению с использованием контейнера представления. Дополнительные сведения см. в записи блога о [строго типизированных представлениях Dynamic V](https://blogs.msdn.com/b/rickandy/archive/2011/01/28/dynamic-v-strongly-typed-views.aspx) . 

Ну, это разновидность &quot; M &quot; для модели, но не тип базы данных. Итак, обобщим все полученные данные и попробуем создать базу данных фильмов.

> [!div class="step-by-step"]
> [Назад](adding-a-controller.md)
> [Вперед](adding-a-model.md)
