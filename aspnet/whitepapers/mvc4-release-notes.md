---
uid: whitepapers/mvc4-release-notes
title: ASP.NET MVC 4 | Документация Майкрософт
author: rick-anderson
description: В этом документе описывается выпуск ASP.NET MVC 4.
ms.author: riande
ms.date: 09/09/2011
ms.assetid: f014524f-25c0-4094-b8e1-886d99536f00
msc.legacyurl: /whitepapers/mvc4-release-notes
msc.type: content
ms.openlocfilehash: b57480bd0274fbb76c600dfb0dd09037bdcbf1e7
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78454236"
---
# <a name="aspnet-mvc-4"></a>ASP.NET MVC 4

> В этом документе описывается выпуск ASP.NET MVC 4.

- [Заметки об установке](#_Toc303253802)
- [Документация](#_Toc303253803)
- [Поддержка](#_Toc303253804)
- [Требования к программному обеспечению](#_Toc303253805)
- [Новые возможности в ASP.NET MVC 4](#_Toc303253807)

    - [ASP.NET Web API](#_Toc317096197)
    - [Усовершенствования шаблонов проектов по умолчанию](#_Toc303253808)
    - [Шаблон мобильного проекта](#_Toc303253809)
    - [Режимы экрана](#_Toc303253810)
    - [jQuery Mobile, переключатель представлений и переопределение браузера](#_Toc303253811)
    - [Поддержка задач для асинхронных контроллеров](#_Toc303253813)
    - [Пакет Azure SDK](#_Toc303253814)
    - [Миграция баз данных](#_Toc303253818)
    - [Пустой шаблон проекта](#_Toc303253819)
    - [Добавление контроллера в любую папку проекта](#_Toc303253820)
    - [Объединение и минификация](#_Toc303253821)
    - [Включение имен входа из Facebook и других сайтов с помощью OAuth и OpenID Connect](#_Toc303253822)
- [Обновление проекта ASP.NET MVC 3 до ASP.NET MVC 4](#_Toc303253806)
- [Изменения из версии-кандидата ASP.NET MVC 4](#_Toc303253817)
- [Известные проблемы и критические изменения](#_Toc303253815)

<a id="_Toc303253802"></a>
## <a name="installation-notes"></a>Замечания по установке

ASP.NET MVC 4 для Visual Studio 2010 можно установить с [домашней страницы ASP.NET MVC 4](../mvc/mvc4.md) с помощью установщика веб-платформы.

Рекомендуется удалить все ранее установленные предварительные версии ASP.NET MVC 4 перед установкой ASP.NET MVC 4. Вы можете обновить бета-версию ASP.NET MVC 4 и RC до ASP.NET MVC 4 без удаления.

Этот выпуск несовместим с предварительными выпусками .NET Framework 4,5. Перед установкой ASP.NET MVC 4 необходимо отдельно обновить все установленные предварительные выпуски .NET Framework 4,5 до последней версии.

ASP.NET MVC 4 можно установить и запустить параллельно с ASP.NET MVC 3.

<a id="_Toc303253803"></a>
## <a name="documentation"></a>Документация

Документацию по ASP.NET MVC доступна на веб-сайте MSDN по URL-адресу:

[https://go.microsoft.com/fwlink/?LinkID=243043](https://go.microsoft.com/fwlink/?LinkID=243043)

Руководства и другие сведения о ASP.NET MVC доступны на странице MVC 4 веб-сайта ASP.NET ([https://www.asp.net/mvc/mvc4](../mvc/mvc4.md)).

<a id="_Toc303253804"></a>
## <a name="support"></a>Поддержка

ASP.NET MVC 4 полностью поддерживается. Если у вас возникли вопросы о работе с этим выпуском, вы также можете опубликовать их на форуме ASP.NET MVC ([https://forums.asp.net/1146.aspx](https://forums.asp.net/1146.aspx)), где участники сообщества ASP.NET часто могут предоставлять неофициальную поддержку.

<a id="_Toc303253805"></a>
## <a name="software-requirements"></a>Требования к программному обеспечению

Для компонентов ASP.NET MVC 4 для Visual Studio требуется PowerShell 2,0 и Visual Studio 2010 с пакетом обновления 1 (SP1) или Visual Web Developer Express 2010 с пакетом обновления 1 (SP1).

<a id="_Toc303253807"></a>
## <a name="new-features-in-aspnet-mvc-4"></a>Новые возможности в ASP.NET MVC 4

В этом разделе описаны функции, которые появились в выпуске ASP.NET MVC 4.

<a id="_Toc317096197"></a>
### <a name="aspnet-web-api"></a>Веб-API ASP.NET

ASP.NET MVC 4 включает веб-API ASP.NET, новую платформу для создания служб HTTP, которые могут обращаться к широкому спектру клиентов, включая браузеры и мобильные устройства. Веб-API ASP.NET также является идеальной платформой для создания служб RESTFUL.

Веб-API ASP.NET включает поддержку следующих функций:

- **Современная модель программирования http:** Прямой доступ и обработка запросов HTTP и ответов в веб-API с помощью новой, строго типизированной объектной модели HTTP. Одна и та же модель программирования и конвейер HTTP симметрично доступны на клиенте через новый тип *HttpClient* .
- **Полная поддержка маршрутов:** Веб-API ASP.NET поддерживает полный набор возможностей маршрута маршрутизации ASP.NET, включая параметры маршрута и ограничения. Кроме того, используйте простые соглашения для соотнесения действий с методами HTTP.
- **Согласование содержимого:** Клиент и сервер могут совместно работать, чтобы определить правильный формат данных, возвращаемых из веб-API. Веб-API ASP.NET предоставляет поддержку по умолчанию для форматов, закодированных в формате URL-адресов XML, JSON и форм. эту поддержку можно расширить путем добавления собственных модулей форматирования или даже замены стратегии согласования содержимого по умолчанию.
- **Привязка и проверка модели:** Связыватели моделей предоставляют простой способ извлечения данных из различных частей HTTP-запроса и преобразования этих частей сообщений в объекты .NET, которые могут использоваться действиями веб-API. Проверка также выполняется для параметров действия на основе заметок к данным.
- **Фильтры:** Веб-API ASP.NET поддерживает фильтры, включая хорошо известные фильтры, такие как атрибут *[авторизовать]* . Вы можете создавать и подключать собственные фильтры для действий, авторизации и обработки исключений.
- **Композиция запросов:** Используйте атрибут фильтра [с поддержкой *запроса]* для действия, которое возвращает *IQueryable* , чтобы обеспечить поддержку запросов к веб-API с помощью соглашений о запросах OData.
- **Улучшенная пригодность для тестирования:** Вместо настройки сведений HTTP в статических объектах контекста действия веб-API работают с экземплярами *HttpRequestMessage* и *HttpResponseMessage*. Создайте проект модульного теста вместе с проектом веб-API, чтобы быстро приступить к написанию модульных тестов для функциональности веб-API.
- **Конфигурация на основе кода:** Веб-API ASP.NET Конфигурация выполняется исключительно с помощью кода, а файлы конфигурации удаляются. Используйте предоставленный шаблон локатора службы для настройки точек расширения.
- **Улучшенная поддержка контейнеров инверсии управления (IOC):** Веб-API ASP.NET предоставляет отличную поддержку для контейнеров IoC с помощью улучшенной абстракции сопоставителя зависимостей
- **Самостоятельный узел:** Веб-API можно размещать в собственном процессе в дополнение к службам IIS, используя все возможности маршрутов и другие функции веб-API.
- **Создание настраиваемых страниц справки и тестов.** Теперь вы можете легко создавать пользовательские страницы справки и тестирования для веб-API с помощью новой службы *иапиексплорер* , чтобы получить полное описание веб-API в среде выполнения.
- **Мониторинг и диагностика.** Веб-API ASP.NET теперь предоставляет инфраструктуру неплотной трассировки, которая упрощает интеграцию с существующими решениями для ведения журналов, такими как System. Diagnostics, ETW и сторонние платформы ведения журналов. Вы можете включить трассировку, предоставив реализацию *итрацевритер* и добавив ее в конфигурацию веб-API.
- **Создание ссылок:** Используйте веб-API ASP.NET *урлхелпер* для создания ссылок на связанные ресурсы в том же приложении.
- **Шаблон проекта веб-API:** Выберите новый проект веб-API создать проект MVC 4, чтобы быстро начать работу с веб-API ASP.NET.
- **Формирование шаблонов:** Используйте диалоговое окно **Добавление контроллера** для быстрого формирования шаблона контроллера веб-API на основе типа модели на основе Entity Framework.

Дополнительные сведения о веб-API ASP.NET см. [https://www.asp.net/web-api](../web-api/index.md).

<a id="_Toc303253808"></a>
### <a name="enhancements-to-default-project-templates"></a>Усовершенствования шаблонов проектов по умолчанию

Шаблон, используемый для создания новых проектов ASP.NET MVC 4, был обновлен для создания более современной веб-сайта:

![](mvc4-release-notes/_static/image1.png)

Помимо косметических улучшений, в новом шаблоне улучшены функциональные возможности. Шаблон использует метод, называемый адаптивной отрисовкой, для удобного поиска в настольных браузерах и в мобильных браузерах без каких-либо настроек.

![](mvc4-release-notes/_static/image2.png)

Чтобы увидеть адаптивную визуализацию в действии, можно использовать эмулятор мобильного устройства или просто попытаться уменьшить размер окна браузера настольных систем. Когда окно браузера становится достаточно малым, макет страницы изменится.

<a id="_Toc303253809"></a>
### <a name="mobile-project-template"></a>Шаблон мобильного проекта

Если вы запускаете новый проект и хотите создать сайт специально для мобильных и планшетных браузеров, можно использовать новый шаблон проекта мобильного приложения. Это основано на jQuery Mobile, библиотеке с открытым исходным кодом для создания пользовательского интерфейса, оптимизированного для сенсорного ввода:

![](mvc4-release-notes/_static/image3.png)

Этот шаблон содержит ту же структуру приложения, что и шаблон Интернет-приложения (и код контроллера практически идентичен), но он использует jQuery Mobile, чтобы выглядеть хорошо и хорошо работать на мобильных устройствах с поддержкой сенсорного ввода. Дополнительные сведения о структурировании и стиле мобильного пользовательского интерфейса см. на [веб-сайте мобильного проекта jQuery](http://jquerymobile.com/).

Если у вас уже есть сайт, ориентированный на Рабочий стол, в который нужно добавить представления, оптимизированные для мобильных устройств, или вы хотите создать отдельный сайт, который будет работать с другими представлениями для настольных и мобильных браузеров, можно использовать новые режимы отображения. (См. следующий раздел).

<a id="_Toc303253810"></a>
### <a name="display-modes"></a>Режимы экрана

Новая функция режима отображения позволяет приложению выбирать представления в зависимости от браузера, выполняющего запрос. Например, если браузер настольных систем запрашивает домашнюю страницу, приложение может использовать шаблон Views\Home\Index.cshtml. Если браузер мобильного устройства запрашивает домашнюю страницу, приложение может вернуть шаблон Виевс\хоме\индекс.Мобиле.кштмл.

Макеты и части можно также переопределять для конкретных типов браузеров. Пример:

- Если папка Views\Shared содержит шаблоны \_Layout. cshtml и \_Layout. Mobile. cshtml, по умолчанию приложение будет использовать \_Layout. Mobile. cshtml во время запросов от мобильных браузеров и \_Layout. cshtml во время других запросов.
- Если папка содержит как \_Мипартиал. cshtml, так и \_Мипартиал. Mobile. cshtml, инструкция @Html.Partial("\_Мипартиал") будет отображать \_Мипартиал. Mobile. cshtml во время запросов от мобильных браузеров и \_Мипартиал. cshtml во время других запросов.

Если вы хотите создать более конкретные представления, макеты или частичные представления для других устройств, можно зарегистрировать новый экземпляр *дефаултдисплаймоде* , чтобы указать, какое имя следует искать, когда запрос удовлетворяет определенным условиям. Например, можно добавить следующий код в метод *\_запуска приложения* в файле Global. asax, чтобы зарегистрировать строку "iPhone" в качестве режима экрана, который применяется при выполнении в браузере Apple iPhone запроса:

[!code-csharp[Main](mvc4-release-notes/samples/sample1.cs)]

После выполнения этого кода, когда браузер Apple iPhone выполняет запрос, приложение будет использовать макет Views\Shared\\_Layout. iPhone. cshtml (если он существует). Дополнительные сведения о режиме просмотра см. в статье [ASP.NET MVC 4 Mobile Features](../mvc/overview/older-versions/aspnet-mvc-4-mobile-features.md). Приложения, использующие Дисплаймодепровидер, должны установить [исправленный](http://nuget.org/packages/Microsoft.AspNet.Mvc.FixedDisplayModes) пакет NuGet DisplayModes. [Обновление ASP.NET 2012](https://go.microsoft.com/fwlink/?LinkID=271322) включает в себя [исправленный](http://nuget.org/packages/Microsoft.AspNet.Mvc.FixedDisplayModes) пакет NuGet DisplayModes в новых шаблонах проектов. Дополнительные сведения об исправлении см. в статье [ASP.NET MVC 4 Mobile кеширование](https://blogs.msdn.com/b/rickandy/archive/2012/09/17/asp-net-mvc-4-mobile-caching-bug-fixed.aspx) исправлена.

<a id="_Toc303253811"></a>
### <a name="jquery-mobile-and-mobile-features"></a>Мобильные и мобильные функции jQuery

Сведения о создании мобильных приложений с помощью ASP.NET MVC 4 с использованием jQuery Mobile см. в руководстве по [мобильным функциям ASP.NET MVC 4](../mvc/overview/older-versions/aspnet-mvc-4-mobile-features.md).

<a id="_Toc303253813"></a>
### <a name="task-support-for-asynchronous-controllers"></a>Поддержка задач для асинхронных контроллеров

Теперь можно писать асинхронные методы действий в виде отдельных методов, возвращающих объект типа *Task* или *task&lt;ActionResult&gt;* .

 Дополнительные сведения см. [в статье Использование асинхронных методов в ASP.NET MVC 4](../mvc/overview/performance/using-asynchronous-methods-in-aspnet-mvc-4.md).

<a id="_Toc303253814"></a>
### <a name="azure-sdk"></a>Пакет SDK Azure

ASP.NET MVC 4 поддерживает версии 1,6 и более поздних версий пакета Windows Azure SDK.

<a id="_Toc303253818"></a>
### <a name="database-migrations"></a>Миграция баз данных

Проекты ASP.NET MVC 4 теперь включают Entity Framework 5. Одной из замечательных функций Entity Framework 5 является поддержка миграции баз данных. Эта функция позволяет легко развивать схему базы данных с помощью переноса, ориентированного на код, с сохранением данных в базе данных. Дополнительные сведения о миграции баз данных см. в разделе [Добавление нового поля в модель фильмов и таблицу](../mvc/overview/older-versions/getting-started-with-aspnet-mvc4/adding-a-new-field-to-the-movie-model-and-table.md) в [учебнике Введение в ASP.NET MVC 4](../mvc/overview/older-versions/getting-started-with-aspnet-mvc4/intro-to-aspnet-mvc-4.md).

<a id="_Toc303253819"></a>
### <a name="empty-project-template"></a>Пустой шаблон проекта

Шаблон пустого проекта MVC теперь действительно пуст, чтобы можно было начать с полного чистого материала. Предыдущая версия шаблона пустого проекта была переименована в базовый.

<a id="_Toc303253820"></a>
### <a name="add-controller-to-any-project-folder"></a>Добавление контроллера в любую папку проекта

Теперь можно щелкнуть правой кнопкой мыши и выбрать пункт **Добавить контроллер** из любой папки в проекте MVC. Это обеспечивает большую гибкость в Организации контроллеров, тем не менее, включая поддержание контроллеров MVC и веб-API в отдельных папках.

<a id="_Toc303253821"></a>
### <a name="bundling-and-minification"></a>Объединение и минификация

Платформа для объединения и минификации позволяет сократить количество HTTP-запросов, которые должна выполнить веб – страница, объединив отдельные файлы в один объединенный файл для сценариев и CSS. Затем он может уменьшить общий размер этих запросов, Минификация содержимое пакета. Минификация может включать такие действия, как удаление пробелов для сокращения имен переменных, чтобы даже сворачивать селекторы CSS на основе их семантики. Пакеты объявляются и настраиваются в коде и легко указываются в представлениях с помощью вспомогательных методов, которые могут формировать либо одну ссылку на пакет, либо, при отладке, несколько ссылок на отдельное содержимое пакета. Дополнительные сведения см. в разделе [объединение и минификации](../mvc/overview/performance/bundling-and-minification.md).

<a id="_Toc303253822"></a>
### <a name="enabling-logins-from-facebook-and-other-sites-using-oauth-and-openid"></a>Включение имен входа из Facebook и других сайтов с помощью OAuth и OpenID Connect

Шаблоны по умолчанию в шаблоне Интернет – проекта ASP.NET MVC 4 теперь включают поддержку входа OAuth и OpenID Connect с помощью библиотеки Дотнетопенаус. Сведения о настройке поставщика OAuth или OpenID Connect см. в разделе [Поддержка OAuth/OpenID Connect для WebForms, MVC и веб-страниц](https://blogs.msdn.com/b/webdev/archive/2012/08/15/oauth-openid-support-for-webforms-mvc-and-webpages.aspx) , а также [Документация по функциям OAuth и OpenID Connect в веб-страницы ASP.NET](../web-pages/overview/releases/top-features-in-web-pages-2.md#oauthsetup).

<a id="_Toc303253806"></a>
## <a name="upgrading-an-aspnet-mvc-3-project-to-aspnet-mvc-4"></a>Обновление проекта ASP.NET MVC 3 до ASP.NET MVC 4

ASP.NET MVC 4 можно установить параллельно с ASP.NET MVC 3 на том же компьютере, что дает гибкость в выборе времени обновления приложения ASP.NET MVC 3 до ASP.NET MVC 4.

Самый простой способ обновления — создать новый проект ASP.NET MVC 4 и скопировать все представления, контроллеры, код и файлы содержимого из существующего проекта MVC 3 в новый проект, а затем обновить ссылки на сборки в новом проекте, чтобы они соответствовали любому шаблону, не являющемуся MVC в клудед ассембилес, который вы используете. Если вы внесли изменения в файл Web. config в проекте MVC 3, необходимо также объединить эти изменения в файл Web. config в проекте MVC 4.

Чтобы вручную обновить существующее приложение ASP.NET MVC 3 до версии 4, выполните следующие действия.

1. Во всех файлах Web. config в проекте (один в корне проекта, один в папке Views, а другой — в папке Views для каждой области проекта) замените каждый экземпляр следующего текста (Примечание: System. Web. веб-страницы, версия = 1.0.0.0 не найдена в проекты, созданные с помощью Visual Studio 2012): 

    [!code-console[Main](mvc4-release-notes/samples/sample2.cmd)]

    со следующим соответствующим текстом:

    [!code-console[Main](mvc4-release-notes/samples/sample3.cmd)]
2. В корневом файле Web. config обновите элемент веб *-страницы: Version* на "2.0.0.0" и добавьте новый ключ *пресервелогинурл* со значением "true": 

    [!code-xml[Main](mvc4-release-notes/samples/sample4.xml)]
3. В обозреватель решений щелкните ссылки правой кнопкой мыши и выберите пункт Управление пакетами NuGet. В левой области выберите **онлине\нужет официальный источник пакета**, а затем обновите следующие:

    - ASP.NET MVC 4
    - (Необязательно) jQuery, jQuery-проверка и пользовательский интерфейс jQuery
    - Используемых Entity Framework
    - (Оптонал) Modernizr
4. В обозреватель решений щелкните правой кнопкой мыши имя проекта и выберите команду Выгрузить проект. Затем щелкните имя правой кнопкой мыши и выберите пункт изменить *имя_проекта*. csproj.
5. Укажите элемент *ProjectTypeGuids* и замените {E53F8FEA-EAE0-44A6-8774-FFD645390401} на {E3E379DF-F4C6-4180-9B81-6769533ABE47}.
6. Сохраните изменения, закройте файл проекта (. csproj), который вы редактировали, щелкните правой кнопкой мыши проект и выберите Перезагрузить проект.
7. Если проект ссылается на сторонние библиотеки, скомпилированные с помощью предыдущих версий ASP.NET MVC, откройте корневой файл Web. config и добавьте в раздел *конфигурации* следующие три элемента *bindingRedirect* : 

    [!code-xml[Main](mvc4-release-notes/samples/sample5.xml)]

<a id="_Toc303253817"></a>
## <a name="changes-from-aspnet-mvc-4-release-candidate"></a>Изменения из версии-кандидата ASP.NET MVC 4

Заметки о выпуске для версии-кандидата ASP.NET MVC 4 можно найти здесь:

Основные изменения в версии-кандидате ASP.NET MVC 4 в этом выпуске приведены ниже.

- **Конфигурация каждого контроллера:** Контроллеры веб-API ASP.NET могут иметь атрибут с настраиваемым атрибутом, который реализует *иконтроллерконфигуратион* для настройки собственных модулей форматирования, селектора действий и связывателей параметров. *Хттпконтроллерконфигуратионаттрибуте* был удален.
- **Для обработчиков сообщений маршрута:** Теперь можно указать окончательный обработчик сообщений в цепочке запросов для заданного маршрута. Это позволяет использовать маршрутизацию для передачи в собственные конечные точки (не*ихттпконтроллер*).
- **Уведомления о ходе выполнения:** *Прогрессмессажехандлер* создает уведомление о ходе выполнения как для отправленных сущностей запроса, так и для загружаемых сущностей ответа. С помощью этого обработчика можно отследить, насколько далеко вы отправляете текст запроса или скачиваете текст ответа.
- **Отправить содержимое:** Класс *пушстреамконтент* позволяет использовать сценарии, в которых производитель данных хочет напрямую выполнить запись в запрос или ответ (синхронно или асинхронно), используя поток. Когда *пушстреамконтент* готов к приему данных, он вызывает делегат действия с выходным потоком. После этого разработчик может выполнять запись в поток в течение всего времени и при завершении записи закрыть поток. *Пушстреамконтент* обнаруживает закрытие потока и завершает базовую асинхронную *задачу* для записи содержимого.
- **Создание ответов об ошибках:** Используйте тип *HttpError* для согласованного представления сведений об ошибках, таких как ошибки проверки и исключения, с сохранением *инклудиррордетаилполици*. Используйте новые методы расширения *креатиррорреспонсе* , чтобы легко создавать ответы об ошибках с *HttpError* в качестве содержимого. Содержимое *HttpError* является полностью согласованным содержимым.
- **Медиаранжемаппинг удалено:** Диапазоны типов носителей теперь обрабатываются Negotiator содержимого по умолчанию.
- **Привязка параметра по умолчанию для параметров простого типа теперь [фромури]:** В предыдущих выпусках веб-API ASP.NET привязку параметра по умолчанию для простых параметров типа, которые использовали привязку модели. Привязка параметра по умолчанию для параметров простого типа теперь *[фромури]* .
- При **выборе действия учитываются необходимые параметры:** Выбор действий в веб-API ASP.NET теперь будет выбирать действие только в том случае, если предоставлены все необходимые параметры, полученные из URI. Параметр можно указать как необязательный, указав значение по умолчанию для аргумента в сигнатуре метода действия.
- **Настройка привязок HTTP-параметров:** Используйте *параметербиндингаттрибуте* , чтобы настроить привязку параметра для конкретного параметра Action или использовать *параметербиндингрулес* в *HttpConfiguration* для более широкого изменения привязок параметров.
- **Усовершенствования MediaTypeFormatter:** Теперь модули форматирования имеют доступ к полному экземпляру *хттпконтент* .
- **Выбор политики буферизации узла:** Реализуйте и настройте службу *ихостбуфферполициселектор* в веб-API ASP.NET, чтобы разрешить узлам определять политику для использования буферизации.
- **Доступ к сертификатам клиента на узле независимым образом:** Используйте метод расширения *жетклиентцертификате* , чтобы получить указанный сертификат клиента из сообщения запроса.
- **Расширяемость согласования содержимого:** Настройте согласование содержимого, выполнив наследование от *дефаултконтентнеготиатор* и переопределив любой аспект согласования содержимого.
- **Поддержка возврата 406 неприемлемых ответов:** Теперь можно возвращать 406 неприемлемых ответов в веб-API ASP.NET, если подходящий модуль форматирования не найден путем создания *дефаултконтентнеготиатор* с параметром *ексклудематчонтипеонли* , для которого установлено значение *true*.
- **Чтение данных формы в виде NameValueCollection или JToken:** Данные формы можно считывать в строке запроса URI или в тексте запроса как *NameValueCollection* с помощью методов расширения *парсекуеристринг* и *реадасформдатаасинк* соответственно. Аналогичным образом можно считывать данные формы в строке запроса URI или в тексте запроса как *JToken* с помощью методов расширения *триреадкуерясжсон* и *реадасасинк*&lt;t&gt; соответственно.
- **Многокомпонентные улучшения:** Теперь можно написать *мултипартстреампровидер* , полностью адаптированный к типу составных данных MIME, который он может читать, и представлять результат оптимальным способом для пользователя. Можно также привязать шаг завершающей обработки к *мултипартстреампровидер* , который позволяет реализации выполнять любые действия после обработки, необходимые для составных частей тела MIME. Например, реализация *мултипартформдатастреампровидер* считывает элементы данных HTML-формы и добавляет их в *NameValueCollection* , чтобы их можно было легко получить из вызывающего.
- **Улучшения создания ссылок:** *Урлхелпер* больше не зависит от *HttpControllerContext*. Теперь вы можете получить доступ к *урлхелпер* из любого контекста, в котором доступен *HttpRequestMessage* .
- **Изменение порядка выполнения обработчика сообщений:** Обработчики сообщений теперь выполняются в том порядке, в котором они настроены, а не в порядке следования.
- **Вспомогательное приложение для привязки обработчиков сообщений:** Новый *хттпклиентфактори* , который может подключить *Делегатингхандлерс* и создать *HttpClient* с требуемым конвейером, готовым к работе. Он также предоставляет функциональные возможности для подключения к альтернативным внутренним обработчикам (по умолчанию — *HttpClientHandler*), а также при использовании *Хттпмессажеинвокер* или другого *DelegatingHandler* вместо *HttpClient* в качестве верхнего вызова.
- **Поддержка CDN в веб-оптимизации ASP.NET:** Веб-Оптимизация ASP.NET теперь обеспечивает поддержку альтернативных путей CDN, позволяя указать для каждого пакета дополнительный URL-адрес, указывающий на тот же ресурс в сети доставки содержимого. Поддержка CDN позволяет вам географически ближе к конечным потребителям веб-приложений. Рабочие приложения должны реализовать откат, если сеть CDN недоступна. Проверьте резервный вариант.
- **Веб-API ASP.NET маршруты и конфигурация перемещены в *WebApiConfig. Register* статический метод, который может быть изменен в коде теста.** Ранее веб-API ASP.NETные маршруты были добавлены в *раутеконфиг. регистерраутес* вместе с стандартными маршрутами MVC. Веб-API ASP.NET маршруты и конфигурация по умолчанию теперь обрабатываются в отдельном методе *WebApiConfig. Register* для упрощения тестирования.

<a id="_Toc303253815"></a>
## <a name="known-issues-and-breaking-changes"></a>Известные проблемы и критические изменения

- **Версия-кандидат и RTM ASP.NET MVC 4 неправильно возвратила кэшированные представления рабочего стола при возврате мобильных представлений.**

    - Сведения об исправлении см. в статье [ASP.NET MVC 4 Mobile Caching](https://blogs.msdn.com/b/rickandy/archive/2012/09/17/asp-net-mvc-4-mobile-caching-bug-fixed.aspx) исправлена. Исправление можно установить из [исправленного](http://nuget.org/packages/Microsoft.AspNet.Mvc.FixedDisplayModes) пакета NuGet DisplayModes.
- **Критические изменения в подсистеме представления Razor**. Следующие типы были удалены из *System. Web. MVC. Razor*: 

    - *моделспан*
    - *мвквбразоркодеженератор*
    - *мвккшарпразоркодеженератор*
    - *мвквбразоркодепарсер*

  Также были удалены следующие методы: 

    - *Мвккшарпразоркодепарсер. Парсеинхеритсстатемент (System. Web. Razor. Parser. Кодеблоккинфо)*
    - *Мвквебпажеразорхост. Декоратекодеженератор (System. Web. Razor. Generator. Разоркодеженератор)*
    - *Мвквбразоркодепарсер. Парсеинхеритсстатемент (System. Web. Razor. Parser. Кодеблоккинфо)*
- **Когда WebMatrix. dll включается в каталог "ASP.NET" приложений MVC 4, он принимает по URL-адресу для проверки подлинности с помощью форм.** Добавление сборки WebMatrix. WebDeploy. dll в приложение (например, при выборе "веб-страницы ASP.NET с синтаксисом Razor" при использовании диалогового окна Добавление развертываемых зависимостей) переопределяет перенаправление входа в систему проверки подлинности на/аккаунт/Логон, а не/аккаунт/логин, как ожидалось контроллером учетной записи ASP.NET MVC по умолчанию. Чтобы предотвратить такое поведение и использовать URL-адрес, который уже указан в разделе Authentication файла Web. config, можно добавить appSetting с именем Пресервелогинурл и задать для него значение true: 

    [!code-xml[Main](mvc4-release-notes/samples/sample6.xml)]
- **Не удается установить диспетчер пакетов NuGet при попытке установить ASP.NET MVC 4 для параллельных установок Visual Studio 2010 и Visual Web Developer 2010.** Чтобы запустить Visual Studio 2010 и Visual Web Developer 2010 параллельно с ASP.NET MVC 4, необходимо установить ASP.NET MVC 4 после того, как обе версии Visual Studio уже установлены.
- **Удаление ASP.NET MVC 4 завершается сбоем, если предварительные условия уже удалены.** Чтобы аккуратно удалить ASP.NET MVC 4you, перед удалением Visual Studio необходимо удалить ASP.NET MVC 4.
- **Установка ASP.NET MVC 4 прерывает приложения ASP.NET MVC 3 RTM.** Приложения ASP.NET MVC 3, созданные в выпуске RTM (а не в [средстве ASP.NET MVC 3 Tools Update](https://www.microsoft.com/download/details.aspx?id=1491) ), для параллельной работы с ASP.NET MVC 4 должны внести следующие изменения. Сборка проекта без выполнения этих обновлений приведет к ошибкам компиляции. 

    **Обязательные обновления**

  1. В корневом файле Web. config добавьте новую запись *&lt;appSettings&gt;* с ключевыми *веб-страницами: Version* и Value *1.0.0.0*. 

      [!code-xml[Main](mvc4-release-notes/samples/sample7.xml)]
  2. В обозреватель решений щелкните правой кнопкой мыши имя проекта и выберите команду Выгрузить проект. Затем щелкните имя правой кнопкой мыши и выберите пункт изменить *имя_проекта*. csproj.
  3. Нахождение следующих ссылок на сборки: 

      [!code-xml[Main](mvc4-release-notes/samples/sample8.xml)]

      Замените их следующим:

      [!code-xml[Main](mvc4-release-notes/samples/sample9.xml)]
  4. Сохраните изменения, закройте файл проекта (. csproj), который вы редактировали, и щелкните правой кнопкой мыши проект и выберите перезагрузить.

- **Изменение проекта ASP.NET MVC 4 на целевой сервер 4,0 с 4,5 не приводит к обновлению ссылки на сборку EntityFramework:** Если изменить проект ASP.NET MVC 4 на целевой сервер 4,0 после предназначенных 4,5, ссылка на сборку EntityFramework будет по-прежнему указывать на версию 4,5. Чтобы устранить эту проблему, удалите и переустановите пакет NuGet EntityFramework.
- **403. запрещено при запуске приложения ASP.NET MVC 4 в Azure после перехода на целевую 4,0 из 4,5:** Если вы измените проект ASP.NET MVC 4 на Target 4,0 после предназначенных 4,5, а затем выполните развертывание в Azure, в среде выполнения может появиться сообщение об ошибке "403 запрещено". Чтобы решить эту проблему, добавьте следующий фрагмент в файл Web. config: `<modules runAllManagedModulesForAllRequests="true" />`
- **Visual Studio 2012 аварийно завершает работу при вводе "\' в строковом литерале в файле Razor.** Чтобы обойти эту ошибку, сначала введите закрывающую кавычку строкового литерала.
- <strong>Обзор &quot;учетной записи или управления&quot; в шаблоне Интернета приводит к ошибке времени выполнения для языков CHS, TRK и CHT.</strong> Чтобы устранить проблему, измените страницу, чтобы отделить <em>@User.Identity.Name</em> , поместив ее в качестве единственного содержимого в тег <em>&lt;надежный&gt;</em> .
- **Поставщики Google и LinkedIn не поддерживаются на веб-сайтах Azure.** Используйте альтернативные поставщики проверки подлинности при развертывании на веб-сайтах Azure.
- **При использовании Урипасекстенсионмаппинг с IIS 8 Express/IIS при попытке использовать расширение вы получите 404 ошибок, не найденных.** Обработчик статических файлов будет влиять на запросы к веб-API, которые используют *урипасекстенсионмаппингс*. Задайте *runAllManagedModulesForAllRequests = true* в файле Web. config, чтобы устранить эту ошибку.
- **Метод Controller. Execute больше не вызывается.** Все контроллеры MVC теперь всегда выполняются асинхронно.
