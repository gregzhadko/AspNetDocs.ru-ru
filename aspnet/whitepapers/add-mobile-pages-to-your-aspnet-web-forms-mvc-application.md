---
uid: whitepapers/add-mobile-pages-to-your-aspnet-web-forms-mvc-application
title: 'Как выполнить: Добавление мобильных страниц в ASP.NET Web Forms и MVC-приложения | Документация Майкрософт'
author: rick-anderson
description: Данном разделе описывается различные способы для обслуживания страниц, оптимизированных для мобильных устройств из вашей веб-форм ASP.NET и MVC-приложения и предлагает архитектуры и...
ms.author: riande
ms.date: 01/20/2011
ms.assetid: 3124f28e-cc32-418a-afe3-519fa56f4c36
msc.legacyurl: /whitepapers/add-mobile-pages-to-your-aspnet-web-forms-mvc-application
msc.type: content
ms.openlocfilehash: db8f336f3fd9a88dfb32f99510fc53cd7b4a5178
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59415990"
---
# <a name="how-to-add-mobile-pages-to-your-aspnet-web-forms--mvc-application"></a><span data-ttu-id="3491d-103">Как выполнить: Добавление мобильных страниц в веб-формы или MVC-приложение ASP.NET</span><span class="sxs-lookup"><span data-stu-id="3491d-103">How To: Add Mobile Pages to Your ASP.NET Web Forms / MVC Application</span></span>

> <span data-ttu-id="3491d-104">**Применяется к**</span><span class="sxs-lookup"><span data-stu-id="3491d-104">**Applies To**</span></span>
> 
> - <span data-ttu-id="3491d-105">Версии веб-форм ASP.NET 4.0</span><span class="sxs-lookup"><span data-stu-id="3491d-105">ASP.NET Web Forms version 4.0</span></span>
> - <span data-ttu-id="3491d-106">ASP.NET MVC версии 3.0</span><span class="sxs-lookup"><span data-stu-id="3491d-106">ASP.NET MVC version 3.0</span></span>
> 
> <span data-ttu-id="3491d-107">**Сводка**</span><span class="sxs-lookup"><span data-stu-id="3491d-107">**Summary**</span></span>
> 
> <span data-ttu-id="3491d-108">Данном разделе описывается различные способы для обслуживания страниц, оптимизированных для мобильных устройств из вашей веб-форм ASP.NET и MVC-приложения и предлагает архитектуры и проблем, которые следует учитывать при разработке для широкого спектра устройств проектирования.</span><span class="sxs-lookup"><span data-stu-id="3491d-108">This How To describes various ways to serve pages optimized for mobile devices from your ASP.NET Web Forms / MVC application, and suggests architectural and design issues to consider when targeting a broad range of devices.</span></span> <span data-ttu-id="3491d-109">В этом документе также объясняется, почему ASP.NET мобильных элементов управления ASP.NET 2.0 до 3.5 теперь являются устаревшими и описываются некоторые современные альтернативы.</span><span class="sxs-lookup"><span data-stu-id="3491d-109">This document also explains why the ASP.NET Mobile Controls from ASP.NET 2.0 to 3.5 are now obsolete, and discusses some modern alternatives.</span></span>


## <a name="contents"></a><span data-ttu-id="3491d-110">Описание</span><span class="sxs-lookup"><span data-stu-id="3491d-110">Contents</span></span>

- <span data-ttu-id="3491d-111">Обзор</span><span class="sxs-lookup"><span data-stu-id="3491d-111">Overview</span></span>
- <span data-ttu-id="3491d-112">Архитектурные варианты</span><span class="sxs-lookup"><span data-stu-id="3491d-112">Architectural options</span></span>
- <span data-ttu-id="3491d-113">Обнаружение браузеров и устройств</span><span class="sxs-lookup"><span data-stu-id="3491d-113">Browser and device detection</span></span>
- <span data-ttu-id="3491d-114">Как приложения веб-форм ASP.NET могут обеспечивать страниц, относящихся к mobile</span><span class="sxs-lookup"><span data-stu-id="3491d-114">How ASP.NET Web Forms applications can present mobile-specific pages</span></span>
- <span data-ttu-id="3491d-115">Как приложения ASP.NET MVC могут обеспечивать страниц, относящихся к mobile</span><span class="sxs-lookup"><span data-stu-id="3491d-115">How ASP.NET MVC applications can present mobile-specific pages</span></span>
- <span data-ttu-id="3491d-116">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="3491d-116">Additional resources</span></span>

<span data-ttu-id="3491d-117">Загружаемые примеры кода для веб-форм ASP.NET и MVC, демонстрирующие методы в этом техническом документе, см. в разделе [мобильных приложений и узлов с использованием ASP.NET](https://docs.microsoft.com/aspnet/mobile/overview).</span><span class="sxs-lookup"><span data-stu-id="3491d-117">For downloadable code samples demonstrating this white paper's techniques for both ASP.NET Web Forms and MVC, see [Mobile Apps & Sites with ASP.NET](https://docs.microsoft.com/aspnet/mobile/overview).</span></span>

## <a name="overview"></a><span data-ttu-id="3491d-118">Обзор</span><span class="sxs-lookup"><span data-stu-id="3491d-118">Overview</span></span>

<span data-ttu-id="3491d-119">Мобильными устройствами — смартфонами, телефонах и планшеты — продолжают набирать популярность как способ доступа к веб.</span><span class="sxs-lookup"><span data-stu-id="3491d-119">Mobile devices – smartphones, feature phones, and tablets – continue to grow in popularity as a means to access the Web.</span></span> <span data-ttu-id="3491d-120">Для многих веб-разработчиков и предприятий, ориентированных на web это означает, что более важно указывать обзора удобной для посетителей, с помощью этих устройств.</span><span class="sxs-lookup"><span data-stu-id="3491d-120">For many web developers and web-oriented businesses, this means it's increasingly important to provide a great browsing experience for visitors using those devices.</span></span>

### <a name="how-earlier-versions-of-aspnet-supported-mobile-browsers"></a><span data-ttu-id="3491d-121">Как более ранних версиях ASP.NET поддерживаемые браузеры для мобильных устройств</span><span class="sxs-lookup"><span data-stu-id="3491d-121">How earlier versions of ASP.NET supported mobile browsers</span></span>

<span data-ttu-id="3491d-122">ASP.NET версии 2.0 до версии 3.5 включены *ASP.NET Mobile Controls*: набор серверных элементов управления для мобильных устройств в *System.Web.Mobile.dll* сборки и  *System.Web.UI.MobileControls* пространства имен.</span><span class="sxs-lookup"><span data-stu-id="3491d-122">ASP.NET versions 2.0 to 3.5 included *ASP.NET Mobile Controls*: a set of server controls for mobile devices in the *System.Web.Mobile.dll* assembly and the *System.Web.UI.MobileControls* namespace.</span></span> <span data-ttu-id="3491d-123">Сборки по-прежнему включается в ASP.NET 4, но она устарела.</span><span class="sxs-lookup"><span data-stu-id="3491d-123">The assembly is still included in ASP.NET 4, but it is deprecated.</span></span> <span data-ttu-id="3491d-124">Разработчикам рекомендуется перейти на более современные подходы, подобные описанным в этом документе.</span><span class="sxs-lookup"><span data-stu-id="3491d-124">Developers are advised to migrate to more modern approaches, such as those described in this paper.</span></span>

<span data-ttu-id="3491d-125">Почему ASP.NET Mobile Controls были помечены как устаревшие причина в том, что их проектирования является ориентирован на мобильных телефонов, которые были распространены вокруг 2005 и более ранних версий.</span><span class="sxs-lookup"><span data-stu-id="3491d-125">The reason why ASP.NET Mobile Controls have been marked as obsolete is that their design is oriented around the mobile phones that were common around 2005 and earlier.</span></span> <span data-ttu-id="3491d-126">Элементы управления главным образом предназначены для визуализации разметки WML или cHTML (вместо обычных HTML) для обозревателей WAP, эры.</span><span class="sxs-lookup"><span data-stu-id="3491d-126">The controls are mainly designed to render WML or cHTML markup (instead of regular HTML) for the WAP browsers of that era.</span></span> <span data-ttu-id="3491d-127">Но WAP, cHTML и WML которые больше не нужны для большинства проектов, так как HTML теперь стал язык повсеместно разметки для мобильных и классических браузерах одинаково.</span><span class="sxs-lookup"><span data-stu-id="3491d-127">But WAP, WML, and cHTML are no longer relevant for most projects, because HTML has now become the ubiquitous markup language for mobile and desktop browsers alike.</span></span>

### <a name="the-challenges-of-supporting-mobile-devices-today"></a><span data-ttu-id="3491d-128">Трудности поддержка мобильных устройств уже сегодня</span><span class="sxs-lookup"><span data-stu-id="3491d-128">The challenges of supporting mobile devices today</span></span>

<span data-ttu-id="3491d-129">Несмотря на то, что браузеры мобильных устройств теперь поддерживает практически все отклики HTML, вы по-прежнему столкнутся с многими трудностями, возникающими при нам необходимо для создания отличных мобильных работы с браузером:</span><span class="sxs-lookup"><span data-stu-id="3491d-129">Even though mobile browsers now almost universally support HTML, you will still face many challenges when aiming to create great mobile browsing experiences:</span></span>

- <span data-ttu-id="3491d-130">***Размер экрана*** - мобильных устройств существенно различаться в форме, и их экраны часто большая меньше, чем мониторами.</span><span class="sxs-lookup"><span data-stu-id="3491d-130">***Screen size*** - Mobile devices vary dramatically in form, and their screens are often much smaller than desktop monitors.</span></span> <span data-ttu-id="3491d-131">Таким образом необходимо разработать совершенно разные макеты для них.</span><span class="sxs-lookup"><span data-stu-id="3491d-131">So, you may need to design completely different page layouts for them.</span></span>
- <span data-ttu-id="3491d-132">***Входные данные методов*** — некоторые устройства имеют клавиатурами, некоторые из них имеют styluses, другим пользователям использовать сенсорный ввод.</span><span class="sxs-lookup"><span data-stu-id="3491d-132">***Input methods*** – Some devices have keypads, some have styluses, others use touch.</span></span> <span data-ttu-id="3491d-133">Вам может потребоваться несколько переходов механизмов и методы ввода.</span><span class="sxs-lookup"><span data-stu-id="3491d-133">You may need to consider multiple navigation mechanisms and data input methods.</span></span>
- <span data-ttu-id="3491d-134">***Соответствие стандартам*** – Многие браузеры мобильных устройств не поддерживают новейшие стандарты HTML, CSS или JavaScript.</span><span class="sxs-lookup"><span data-stu-id="3491d-134">***Standards compliance*** – Many mobile browsers do not support the latest HTML, CSS, or JavaScript standards.</span></span>
- <span data-ttu-id="3491d-135">***Пропускная способность*** — совершенно зависит производительность сети передачи данных, и некоторые пользователи находятся на тарифы, на которые стоит в мегабайтах.</span><span class="sxs-lookup"><span data-stu-id="3491d-135">***Bandwidth*** – Cellular data network performance varies wildly, and some end users are on tariffs that charge by the megabyte.</span></span>

<span data-ttu-id="3491d-136">Не существует универсального решения; приложение будет выглядеть и работать по-разному в соответствии с устройств, доступ к нему.</span><span class="sxs-lookup"><span data-stu-id="3491d-136">There's no one-size-fits-all solution; your application will have to look and behave differently according to the device accessing it.</span></span> <span data-ttu-id="3491d-137">В зависимости от того, какой уровень поддержка мобильных устройств необходимо это может быть большие сложности для веб-разработчиков, чем рабочего стола «браузера войны» был ранее.</span><span class="sxs-lookup"><span data-stu-id="3491d-137">Depending on what level of mobile support you want, this can be a bigger challenge for web developers than the desktop "browser wars" ever was.</span></span>

<span data-ttu-id="3491d-138">Разработчики, изучающие поддержка браузера для мобильных устройств в первый раз часто изначально думаю, что очень важно только для поддержки смартфонов самую современную (например, Windows Phone 7, iPhone или Android), возможно, поскольку разработчики часто лично владельцем таких устройства.</span><span class="sxs-lookup"><span data-stu-id="3491d-138">Developers approaching mobile browser support for the first time often initially think it's only important to support the latest and most sophisticated smartphones (e.g., Windows Phone 7, iPhone, or Android), perhaps because developers often personally own such devices.</span></span> <span data-ttu-id="3491d-139">Тем не менее дешевле телефоны по-прежнему невероятно популярны, и их владельцев следует использовать их в Интернете — особенно в странах, где мобильные телефоны являются более чем широкополосного подключения.</span><span class="sxs-lookup"><span data-stu-id="3491d-139">However, cheaper phones are still extremely popular, and their owners do use them to browse the web – especially in countries where mobile phones are easier to get than a broadband connection.</span></span> <span data-ttu-id="3491d-140">Вашего бизнеса необходимо решить, какой диапазон устройств, поддержку, учитывая его вероятных заказчиков.</span><span class="sxs-lookup"><span data-stu-id="3491d-140">Your business will need to decide what range of devices to support by considering its likely customers.</span></span> <span data-ttu-id="3491d-141">При создании online Брошюра spa работоспособности luxury, может принять решение business только для расширенных смартфонов, тогда как при создании это система заказа столиков в ресторане билет для кинотеатрах, вы, вероятно, должны учитывать для посетителей с менее мощные функции телефоны.</span><span class="sxs-lookup"><span data-stu-id="3491d-141">If you're building an online brochure for a luxury health spa, you might make a business decision only to target advanced smartphones, whereas if you're creating a ticket booking system for a cinema, you probably need to account for visitors with less powerful feature phones.</span></span>

## <a name="architectural-options"></a><span data-ttu-id="3491d-142">Архитектурные варианты</span><span class="sxs-lookup"><span data-stu-id="3491d-142">Architectural options</span></span>

<span data-ttu-id="3491d-143">Прежде чем углубиться в технические особенности веб-форм ASP.NET или MVC, обратите внимание, что веб-разработчиков в целом три основных возможных варианта поддержка мобильных браузеров:</span><span class="sxs-lookup"><span data-stu-id="3491d-143">Before we get to the specific technical details of ASP.NET Web Forms or MVC, note that web developers in general have three main possible options for supporting mobile browsers:</span></span>

1. <span data-ttu-id="3491d-144">***Не выполнять никаких действий —*** просто можно создать стандартный, ориентированных на рабочий стол веб-приложения и зависят от браузеров мобильных устройств для подготовки к просмотру его вполне приемлемо.</span><span class="sxs-lookup"><span data-stu-id="3491d-144">***Do nothing –*** You can simply create a standard, desktop-oriented web application, and rely on mobile browsers to render it acceptably.</span></span> 

    - <span data-ttu-id="3491d-145">**Преимущество**: Это экономичный вариант для реализации и обслуживания — без дополнительной работы</span><span class="sxs-lookup"><span data-stu-id="3491d-145">**Advantage**: It's the cheapest option to implement and maintain – no extra work</span></span>
    - <span data-ttu-id="3491d-146">**Недостаток**: Предоставляет наихудшее взаимодействие с пользователем:</span><span class="sxs-lookup"><span data-stu-id="3491d-146">**Disadvantage**: Gives the worst end-user experience:</span></span> 

        - <span data-ttu-id="3491d-147">Последние смартфонов разворачивалась HTML точно так же как браузеров на компьютерах, но пользователи по-прежнему обязательно для масштабирования и прокрутки по горизонтали и по вертикали для использования вашего контента на небольшом экране.</span><span class="sxs-lookup"><span data-stu-id="3491d-147">The latest smartphones may render your HTML just as well as a desktop browser, but users will still be forced to zoom and scroll horizontally and vertically to consume your content on a small screen.</span></span> <span data-ttu-id="3491d-148">Это далеко от оптимального.</span><span class="sxs-lookup"><span data-stu-id="3491d-148">This is far from optimal.</span></span>
        - <span data-ttu-id="3491d-149">Старые устройства и телефонах могут не отображаться в разметку удовлетворительным образом.</span><span class="sxs-lookup"><span data-stu-id="3491d-149">Older devices and feature phones may fail to render your markup in a satisfactory way.</span></span>
        - <span data-ttu-id="3491d-150">Даже на последнюю планшетные устройства (экраны, может быть большим, чем экранах ноутбуков) применяются правила различные взаимодействия.</span><span class="sxs-lookup"><span data-stu-id="3491d-150">Even on the latest tablet devices (whose screens can be as big as laptop screens), different interaction rules apply.</span></span> <span data-ttu-id="3491d-151">Touch рукописных данных лучше всего работает с большего размера кнопок и связывает spread дальнейшей друг от друга, и нет способа для наведите курсор мыши на всплывающее меню.</span><span class="sxs-lookup"><span data-stu-id="3491d-151">Touch-based input works best with larger buttons and links spread further apart, and there's no way to hover a mouse cursor over a fly-out menu.</span></span>
2. <span data-ttu-id="3491d-152">***Решить проблему на клиенте* —** с Аккуратное использование CSS и [прогрессивное Совершенствование](http://en.wikipedia.org/wiki/Progressive_enhancement) созданием разметки, стили и скрипты, которые адаптируются к их выполняют любой браузер.</span><span class="sxs-lookup"><span data-stu-id="3491d-152">***Solve the problem on the client* –** With careful use of CSS and [progressive enhancement](http://en.wikipedia.org/wiki/Progressive_enhancement) you can create markup, styles, and scripts that adapt to whatever browser is running them.</span></span> <span data-ttu-id="3491d-153">Например, с помощью [медиа-запросов CSS 3](http://www.w3.org/TR/2010/CR-css3-mediaqueries-20100727/), можно создать многостолбцовый макет, который включает в одном столбце макет на устройствах, экранах более узких, чем выбранные пороговые значения.</span><span class="sxs-lookup"><span data-stu-id="3491d-153">For example, with [CSS 3 media queries](http://www.w3.org/TR/2010/CR-css3-mediaqueries-20100727/), you could create a multi-column layout that turns into a single column layout on devices whose screens are narrower than a chosen threshold.</span></span> 

    - <span data-ttu-id="3491d-154">**Преимущество**: Оптимизирует отрисовки для конкретного устройства используется, даже для неизвестных будущих устройств в соответствии с любого экрана и характеристики входных они имеют</span><span class="sxs-lookup"><span data-stu-id="3491d-154">**Advantage**: Optimizes rendering for the specific device in use, even for unknown future devices according to whatever screen and input characteristics they have</span></span>
    - <span data-ttu-id="3491d-155">**Преимущество**: Легко позволяет совместно использовать логику на стороне сервера на всех типах устройств — минимальное дублирование кода или усилий</span><span class="sxs-lookup"><span data-stu-id="3491d-155">**Advantage**: Easily lets you share server-side logic across all device types – minimal duplication of code or effort</span></span>
    - <span data-ttu-id="3491d-156">**Недостаток**: Мобильные устройства, таким образом отличаются от настольных компьютеров, что может действительно требуется мобильных веб-страниц полностью отличаться от классических страниц, показывая различные сведения.</span><span class="sxs-lookup"><span data-stu-id="3491d-156">**Disadvantage**: Mobile devices are so different from desktop devices that you may really want your mobile pages to be completely different from your desktop pages, showing different information.</span></span> <span data-ttu-id="3491d-157">Такие варианты может оказаться неэффективным или вообще нельзя реализовать надежно посредством CSS одиночестве, учитывая то, как старые устройства интерпретации правила CSS.</span><span class="sxs-lookup"><span data-stu-id="3491d-157">Such variations can be inefficient or impossible to achieve robustly through CSS alone, especially considering how inconsistently older devices interpret CSS rules.</span></span> <span data-ttu-id="3491d-158">Это особенно верно для атрибуты CSS 3.</span><span class="sxs-lookup"><span data-stu-id="3491d-158">This is particularly true of CSS 3 attributes.</span></span>
    - <span data-ttu-id="3491d-159">**Недостаток**: Не поддерживает различные логику на стороне сервера и рабочие процессы для различных устройств.</span><span class="sxs-lookup"><span data-stu-id="3491d-159">**Disadvantage**: Provides no support for varying server-side logic and workflows for different devices.</span></span> <span data-ttu-id="3491d-160">Упрощенный корзину для покупок извлечения рабочий процесс для мобильных пользователей нельзя например, реализовать посредством только CSS.</span><span class="sxs-lookup"><span data-stu-id="3491d-160">You can't, for example, implement a simplified shopping cart checkout workflow for mobile users by means of CSS alone.</span></span>
    - <span data-ttu-id="3491d-161">**Недостаток**: Использование неэффективным пропускной способности.</span><span class="sxs-lookup"><span data-stu-id="3491d-161">**Disadvantage**: Inefficient bandwidth use.</span></span> <span data-ttu-id="3491d-162">Ваш сервер может потребоваться передачи разметки и стили, которые применяются ко всем устройствам возможных, несмотря на то, что целевое устройство будет использовать только часть этой информации.</span><span class="sxs-lookup"><span data-stu-id="3491d-162">You server may have to transmit the markup and styles that apply to all possible devices, even though the target device will only use a subset of that information.</span></span>
3. <span data-ttu-id="3491d-163">***Решить проблему на сервере* —** Если ваш сервер знает, какое устройство имеет доступ к нему — или минимальных характеристики этого устройства, такие как размер экрана и метода ввода, будь то мобильном устройстве: оно может выполняться другой логикой и выходные данные разную HTML-разметку.</span><span class="sxs-lookup"><span data-stu-id="3491d-163">***Solve the problem on the server* –** If your server knows what device is accessing it – or at least the characteristics of that device, such as its screen size and input method, and whether it's a mobile device – it can run different logic and output different HTML markup.</span></span> 

    - <span data-ttu-id="3491d-164">**Преимущества:** Максимальную гибкость.</span><span class="sxs-lookup"><span data-stu-id="3491d-164">**Advantage:** Maximum flexibility.</span></span> <span data-ttu-id="3491d-165">Нет ограничений сколько различаются логику на стороне сервера для мобильных устройств или оптимизировать разметку для макета требуемой, зависящий от устройства.</span><span class="sxs-lookup"><span data-stu-id="3491d-165">There's no limit to how much you can vary your server-side logic for mobiles or optimize your markup for the desired, device-specific layout.</span></span>
    - <span data-ttu-id="3491d-166">**Преимущества:** Используйте эффективный пропускной способности.</span><span class="sxs-lookup"><span data-stu-id="3491d-166">**Advantage:** Efficient bandwidth use.</span></span> <span data-ttu-id="3491d-167">Требуется только для передачи разметки и сведения о котором на целевом устройстве нужно использовать.</span><span class="sxs-lookup"><span data-stu-id="3491d-167">You only need to transmit the markup and styling information that the target device is going to use.</span></span>
    - <span data-ttu-id="3491d-168">**Недостаток:** Иногда вызывает повторение усилий или код (например, делая Создание похожие, но немного другой копии страницы веб-форм или MVC представления).</span><span class="sxs-lookup"><span data-stu-id="3491d-168">**Disadvantage:** Sometimes forces repetition of effort or code (e.g., making you create similar but slightly different copies of your Web Forms pages or MVC views).</span></span> <span data-ttu-id="3491d-169">Где возможно, вам необходимо учитывать out общую логику базового уровня или службы, но тем не менее, некоторые части кода пользовательского интерфейса или разметки необходимо быть копируется и затем сохраняется в параллельном режиме.</span><span class="sxs-lookup"><span data-stu-id="3491d-169">Where possible you will factor out common logic into an underlying layer or service, but still, some parts of your UI code or markup may have to be duplicated and then maintained in parallel.</span></span>
    - <span data-ttu-id="3491d-170">**Недостаток:** Обнаружение устройств является непростой задачей.</span><span class="sxs-lookup"><span data-stu-id="3491d-170">**Disadvantage:** Device detection is not trivial.</span></span> <span data-ttu-id="3491d-171">Он требует базы данных типов известных устройств и их характеристики (которые могут не всегда идеально актуальные) и не обязательно будет точно сопоставить каждый входящий запрос.</span><span class="sxs-lookup"><span data-stu-id="3491d-171">It requires a list or database of known device types and their characteristics (which may not always be perfectly up-to-date) and isn't guaranteed to accurately match every incoming request.</span></span> <span data-ttu-id="3491d-172">В этом документе описываются некоторые параметры и их ловушки позже.</span><span class="sxs-lookup"><span data-stu-id="3491d-172">This document describes some options and their pitfalls later.</span></span>

<span data-ttu-id="3491d-173">Чтобы получить лучшие результаты, большинство разработчиков найдите, необходимую для объединения параметров (2) и (3).</span><span class="sxs-lookup"><span data-stu-id="3491d-173">To get the best results, most developers find they need to combine options (2) and (3).</span></span> <span data-ttu-id="3491d-174">Рассматриваемая стилистических лучше всего объединяются на стороне клиента с помощью CSS или даже JavaScript, тогда как наиболее эффективно существенные различия в данных, рабочий процесс или разметки реализуются в коде на стороне сервера.</span><span class="sxs-lookup"><span data-stu-id="3491d-174">Minor stylistic differences are best accommodated on the client using CSS or even JavaScript, whereas major differences in data, workflow, or markup are most effectively implemented in server-side code.</span></span>

### <a name="this-paper-focuses-on-server-side-techniques"></a><span data-ttu-id="3491d-175">Этот документ посвящен методы на стороне сервера</span><span class="sxs-lookup"><span data-stu-id="3491d-175">This paper focuses on server-side techniques</span></span>

<span data-ttu-id="3491d-176">Так как веб-форм ASP.NET и MVC обеих технологий в первую очередь на стороне сервера, в этом техническом документе основное внимание уделяется методы на стороне сервера, позволяющие создавать различные разметки и логику для браузеров мобильных устройств.</span><span class="sxs-lookup"><span data-stu-id="3491d-176">Since ASP.NET Web Forms and MVC are both primarily server-side technologies, this white paper will focus on server-side techniques that let you produce different markup and logic for mobile browsers.</span></span> <span data-ttu-id="3491d-177">Само собой это можно также объединять с помощью любой подходящей методики на стороне клиента (например, CSS 3 медиа-запросов, поэтапного улучшения JavaScript), но это, чтобы в большей степени веб-дизайн чем разработки ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="3491d-177">Of course, you can also combine this with any client-side technique (e.g., CSS 3 media queries, progressive-enhancement JavaScript), but that's more a matter of web design than ASP.NET development.</span></span>

## <a name="browser-and-device-detection"></a><span data-ttu-id="3491d-178">Обнаружение браузеров и устройств</span><span class="sxs-lookup"><span data-stu-id="3491d-178">Browser and device detection</span></span>

<span data-ttu-id="3491d-179">Ключа необходимым условием для всех методов на стороне сервера для поддержки мобильных устройств — это знать, какое устройство используется посетителем.</span><span class="sxs-lookup"><span data-stu-id="3491d-179">The key prerequisite for all server-side techniques for supporting mobile devices is to know what device your visitor is using.</span></span> <span data-ttu-id="3491d-180">На самом деле, еще лучше, чем знать номер изготовитель и модель устройства *характеристики* устройства.</span><span class="sxs-lookup"><span data-stu-id="3491d-180">In fact, even better than knowing the manufacturer and model number of that device is knowing the *characteristics* of the device.</span></span> <span data-ttu-id="3491d-181">Характеристики могут включать:</span><span class="sxs-lookup"><span data-stu-id="3491d-181">Characteristics may include:</span></span>

- <span data-ttu-id="3491d-182">Это мобильное устройство?</span><span class="sxs-lookup"><span data-stu-id="3491d-182">Is it a mobile device?</span></span>
- <span data-ttu-id="3491d-183">Метод ввода (клавиатуры и мыши, касания, клавиатуры, джойстика,...)</span><span class="sxs-lookup"><span data-stu-id="3491d-183">Input method (mouse/keyboard, touch, keypad, joystick, …)</span></span>
- <span data-ttu-id="3491d-184">Размер экрана (физически и в пикселях)</span><span class="sxs-lookup"><span data-stu-id="3491d-184">Screen size (physically and in pixels)</span></span>
- <span data-ttu-id="3491d-185">Поддерживаемые форматы мультимедиа и данных</span><span class="sxs-lookup"><span data-stu-id="3491d-185">Supported media and data formats</span></span>
- <span data-ttu-id="3491d-186">Д.</span><span class="sxs-lookup"><span data-stu-id="3491d-186">Etc.</span></span>

<span data-ttu-id="3491d-187">Это лучше для принятия решений, с учетом характеристик, чем номер модели, так как, а затем вы сможете более широкие возможности для обработки будущих устройствах.</span><span class="sxs-lookup"><span data-stu-id="3491d-187">It's better to make decisions based on characteristics than model number, because then you'll be better equipped to handle future devices.</span></span>

### <a name="using-aspnets-built-in-browser-detection-support"></a><span data-ttu-id="3491d-188">С помощью ASP. Поддержка NET встроенного браузера</span><span class="sxs-lookup"><span data-stu-id="3491d-188">Using ASP.NET's built-in browser detection support</span></span>

<span data-ttu-id="3491d-189">Веб-форм ASP.NET и MVC разработчики могут немедленно обнаружить важные характеристики посещаемый обозреватель, проверяя свойства *Request.Browser* объекта.</span><span class="sxs-lookup"><span data-stu-id="3491d-189">ASP.NET Web Forms and MVC developers can immediately discover important characteristics of a visiting browser by inspecting properties of the *Request.Browser* object.</span></span> <span data-ttu-id="3491d-190">Например см. в разделе</span><span class="sxs-lookup"><span data-stu-id="3491d-190">For example, see</span></span>

- <span data-ttu-id="3491d-191">Request.Browser.IsMobileDevice</span><span class="sxs-lookup"><span data-stu-id="3491d-191">Request.Browser.IsMobileDevice</span></span>
- <span data-ttu-id="3491d-192">Request.Browser.MobileDeviceManufacturer Request.Browser.MobileDeviceModel</span><span class="sxs-lookup"><span data-stu-id="3491d-192">Request.Browser.MobileDeviceManufacturer, Request.Browser.MobileDeviceModel</span></span>
- <span data-ttu-id="3491d-193">Request.Browser.ScreenPixelsWidth</span><span class="sxs-lookup"><span data-stu-id="3491d-193">Request.Browser.ScreenPixelsWidth</span></span>
- <span data-ttu-id="3491d-194">Request.Browser.SupportsXmlHttp</span><span class="sxs-lookup"><span data-stu-id="3491d-194">Request.Browser.SupportsXmlHttp</span></span>
- <span data-ttu-id="3491d-195">...и многие другие</span><span class="sxs-lookup"><span data-stu-id="3491d-195">…and many others</span></span>

<span data-ttu-id="3491d-196">По сути, платформой ASP.NET соответствует входящего *User-Agent* заголовок HTTP (UA) от регулярных выражений в набор файлов XML определения браузера.</span><span class="sxs-lookup"><span data-stu-id="3491d-196">Behind the scenes, the ASP.NET platform matches the incoming *User-Agent* (UA) HTTP header against regular expressions in a set of Browser Definition XML files.</span></span> <span data-ttu-id="3491d-197">По умолчанию платформа включает определения для многих распространенных мобильных устройств и для других пользователей, которые требуется распознать можно добавить пользовательские файлы определения браузера.</span><span class="sxs-lookup"><span data-stu-id="3491d-197">By default the platform includes definitions for many common mobile devices, and you can add custom Browser Definition files for others you wish to recognize.</span></span> <span data-ttu-id="3491d-198">Дополнительные сведения см. на странице MSDN [ASP.NET серверных элементов управления и возможностей браузера](https://msdn.microsoft.com/library/x3k2ssx2.aspx).</span><span class="sxs-lookup"><span data-stu-id="3491d-198">For more details, see the MSDN page [ASP.NET Web Server Controls and Browser Capabilities](https://msdn.microsoft.com/library/x3k2ssx2.aspx).</span></span>

### <a name="using-the-wurfl-device-database-via-51degreesmobi-foundation"></a><span data-ttu-id="3491d-199">Используя базу данных WURFL устройства через 51Degrees.mobi Foundation</span><span class="sxs-lookup"><span data-stu-id="3491d-199">Using the WURFL device database via 51Degrees.mobi Foundation</span></span>

<span data-ttu-id="3491d-200">Хотя ASP. Поддержка NET встроенного браузера будет достаточно для многих приложений существует два основных варианта когда может быть недостаточно:</span><span class="sxs-lookup"><span data-stu-id="3491d-200">While ASP.NET's built-in browser detection support will be sufficient for many applications, there are two main cases when it might not be enough:</span></span>

- <span data-ttu-id="3491d-201">***Можно будет распознать последних устройствах***(без создания файлов определения браузера для их вручную).</span><span class="sxs-lookup"><span data-stu-id="3491d-201">***You want to recognize the latest devices***(without manually creating Browser Definition files for them).</span></span> <span data-ttu-id="3491d-202">Обратите внимание, что файлы определения браузера .NET 4 не старая для распознавания Windows Phone 7, телефонах с Android, обозревателей Opera Mobile или устройства Apple iPad.</span><span class="sxs-lookup"><span data-stu-id="3491d-202">Note that .NET 4's Browser Definition files are not recent enough to recognize Windows Phone 7, Android phones, Opera Mobile browsers, or Apple iPads.</span></span>
- <span data-ttu-id="3491d-203">***Требуется более подробные сведения о возможностях устройства***.</span><span class="sxs-lookup"><span data-stu-id="3491d-203">***You need more detailed information about device capabilities***.</span></span> <span data-ttu-id="3491d-204">Необходимо знать о метод ввода устройства (например, касания vs клавиатуре), или какие аудио форматов браузер поддерживает.</span><span class="sxs-lookup"><span data-stu-id="3491d-204">You may need to know about a device's input method (e.g., touch vs keypad), or what audio formats the browser supports.</span></span> <span data-ttu-id="3491d-205">Эти сведения недоступны в стандартных файлов определения браузера.</span><span class="sxs-lookup"><span data-stu-id="3491d-205">This information isn't available in the standard Browser Definition files.</span></span>

<span data-ttu-id="3491d-206">[ *Wireless Universal Resource File* проекта (WURFL)](http://wurfl.sourceforge.net/) поддерживает гораздо больше актуальном состоянии и подробные сведения о мобильных устройствах используется уже сегодня.</span><span class="sxs-lookup"><span data-stu-id="3491d-206">The [*Wireless Universal Resource File* (WURFL) project](http://wurfl.sourceforge.net/) maintains much more up-to-date and detailed information about mobile devices in use today.</span></span>

<span data-ttu-id="3491d-207">Хорошая новость для разработчиков .NET-ASP. Возможность обнаружения NET браузера является расширяемой, поэтому можно расширить его возможности для преодоления этих проблем.</span><span class="sxs-lookup"><span data-stu-id="3491d-207">The great news for .NET developers is that ASP.NET's browser detection feature is extensible, so it's possible to enhance it to overcome these problems.</span></span> <span data-ttu-id="3491d-208">Например, можно добавить открытым [ *51Degrees.mobi Foundation* ](https://github.com/51Degrees/dotNET-Device-Detection) библиотеки в проект.</span><span class="sxs-lookup"><span data-stu-id="3491d-208">For example, you can add the open source [*51Degrees.mobi Foundation*](https://github.com/51Degrees/dotNET-Device-Detection) library to your project.</span></span> <span data-ttu-id="3491d-209">Это ASP.NET IHttpModule или поставщики возможностей (можно использовать в приложениях Web Forms и MVC), который непосредственно считывает данных WURFL и подключает его в ASP. Механизм обнаружения NET встроенного браузера.</span><span class="sxs-lookup"><span data-stu-id="3491d-209">It's an ASP.NET IHttpModule or Browser Capabilities Provider (usable on both Web Forms and MVC applications), that directly reads WURFL data and hooks it into ASP.NET's built-in browser detection mechanism.</span></span> <span data-ttu-id="3491d-210">После установки модуля, *Request.Browser* внезапно будет содержать более точные и подробные сведения: он будет правильно многие из упомянутых выше устройства и заполнил их возможности (в том числе Дополнительные возможности в частности метод ввода).</span><span class="sxs-lookup"><span data-stu-id="3491d-210">Once you've installed the module, *Request.Browser* will suddenly contain a lot more accurate and detailed information: it will correctly recognize many of the devices previously mentioned and list their capabilities (including additional capabilities such as input method).</span></span> <span data-ttu-id="3491d-211">См. документацию по проекту для получения дополнительных сведений.</span><span class="sxs-lookup"><span data-stu-id="3491d-211">See the project's documentation for more details.</span></span>

## <a name="how-web-forms-applications-can-present-mobile-specific-pages"></a><span data-ttu-id="3491d-212">Как приложения веб-форм может представлять страниц, относящихся к mobile</span><span class="sxs-lookup"><span data-stu-id="3491d-212">How Web Forms applications can present mobile-specific pages</span></span>

<span data-ttu-id="3491d-213">По умолчанию Вот как совершенно новую программу веб-форм отображает на общих мобильных устройств:</span><span class="sxs-lookup"><span data-stu-id="3491d-213">By default, here's how a brand new Web Forms application displays on common mobile devices:</span></span>

![](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/_static/image1.png)

<span data-ttu-id="3491d-214">Очевидно ни макета выглядит очень адаптированный для мобильных устройств — эта страница была разработана для больших и альбомной ориентацией монитора, не для небольших ориентированных на книжной ориентации экрана.</span><span class="sxs-lookup"><span data-stu-id="3491d-214">Clearly, neither layout looks very mobile-friendly – this page was designed for a large, landscape-oriented monitor, not for a small portrait-oriented screen.</span></span> <span data-ttu-id="3491d-215">Так что можно делать?</span><span class="sxs-lookup"><span data-stu-id="3491d-215">So what can you do about it?</span></span>

<span data-ttu-id="3491d-216">Как уже говорилось ранее в этой статье, существует множество способов настройки страницы для мобильных устройств.</span><span class="sxs-lookup"><span data-stu-id="3491d-216">As discussed earlier in this paper, there are many ways to tailor your pages for mobile devices.</span></span> <span data-ttu-id="3491d-217">Некоторые методы основаны на сервере, запустить другие пользователи на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="3491d-217">Some techniques are server-based, others run on the client.</span></span>

### <a name="creating-a-mobile-specific-master-page"></a><span data-ttu-id="3491d-218">Создание главной страницы мобильных обозревателей</span><span class="sxs-lookup"><span data-stu-id="3491d-218">Creating a mobile-specific master page</span></span>

<span data-ttu-id="3491d-219">В зависимости от требований, может появиться возможность использовать же веб-форм для всех посетителей, но имеют два отдельных главные страницы: один для настольных систем посетителей, другой — для посетители с мобильных устройств.</span><span class="sxs-lookup"><span data-stu-id="3491d-219">Depending on your requirements, you may be able to use the same Web Forms for all visitors, but have two separate master pages: one for desktop visitors, another for mobile visitors.</span></span> <span data-ttu-id="3491d-220">Это позволяет легко изменять таблицы стилей CSS или разметки HTML верхнего уровня в соответствии с мобильных устройств, не заставляя позволяет дублировать логику страницы.</span><span class="sxs-lookup"><span data-stu-id="3491d-220">This gives you the flexibility of changing the CSS stylesheet or your top-level HTML markup to suit mobile devices, without forcing you to duplicate any page logic.</span></span>

<span data-ttu-id="3491d-221">Это легко сделать.</span><span class="sxs-lookup"><span data-stu-id="3491d-221">This is easy to do.</span></span> <span data-ttu-id="3491d-222">Например на веб-форму можно добавить обработчик PreInit следующего вида:</span><span class="sxs-lookup"><span data-stu-id="3491d-222">For example, you can add a PreInit handler such as the following to a Web Form:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample1.cs)]

<span data-ttu-id="3491d-223">Теперь создайте главную страницу с именем Mobile.Master в папке верхнего уровня приложения, и он будет использоваться при обнаружении мобильного устройства.</span><span class="sxs-lookup"><span data-stu-id="3491d-223">Now, create a master page called Mobile.Master in the top-level folder of your application, and it will be used when a mobile device is detected.</span></span> <span data-ttu-id="3491d-224">При необходимости мобильных главную страницу может ссылаться на таблицы стилей CSS мобильных обозревателей.</span><span class="sxs-lookup"><span data-stu-id="3491d-224">Your mobile master page can reference a mobile-specific CSS stylesheet if necessary.</span></span> <span data-ttu-id="3491d-225">Посетители рабочего стола будет по-прежнему см. в разделе главную страницу по умолчанию, не тот мобильных устройств.</span><span class="sxs-lookup"><span data-stu-id="3491d-225">Desktop visitors will still see your default master page, not the mobile one.</span></span>

### <a name="creating-independent-mobile-specific-web-forms"></a><span data-ttu-id="3491d-226">Создание независимых мобильных обозревателей веб-форм</span><span class="sxs-lookup"><span data-stu-id="3491d-226">Creating independent mobile-specific Web Forms</span></span>

<span data-ttu-id="3491d-227">Для обеспечения максимальной гибкости вы можете гораздо дальше, чем просто отдельный главных страниц для различных типов устройств.</span><span class="sxs-lookup"><span data-stu-id="3491d-227">For maximum flexibility, you can go much further than just having separate master pages for different device types.</span></span> <span data-ttu-id="3491d-228">Можно реализовать двумя *полностью отделить наборов страниц веб-форм* — один набор для браузеров настольных компьютеров, второй набор для мобильных устройств.</span><span class="sxs-lookup"><span data-stu-id="3491d-228">You can implement two *totally separate sets of Web Forms pages* – one set for desktop browsers, another set for mobiles.</span></span> <span data-ttu-id="3491d-229">Это работает лучше, если нужно представить данные будут сильно отличаться или рабочих процессов, чтобы посетители с мобильных устройств.</span><span class="sxs-lookup"><span data-stu-id="3491d-229">This works best if you want to present very different information or workflows to mobile visitors.</span></span> <span data-ttu-id="3491d-230">В оставшейся части этого раздела описывается этот подход подробно.</span><span class="sxs-lookup"><span data-stu-id="3491d-230">The rest of this section describes this approach in detail.</span></span>

<span data-ttu-id="3491d-231">Предположим, что у вас уже есть веб-форм, предназначенной для браузеров настольных компьютеров, чтобы продолжить проще создать вложенную папку с именем «Мобильный» в проекте, а ваш мобильных страниц.</span><span class="sxs-lookup"><span data-stu-id="3491d-231">Assuming you already have a Web Forms application designed for desktop browsers, the easiest way to proceed is to create a subfolder called "Mobile" within your project, and build your mobile pages there.</span></span> <span data-ttu-id="3491d-232">Можно создать всего дочернего сайта, с собственными главных страниц, таблиц стилей и страниц, используя те же методы, которые можно использовать для любого другого приложения веб-форм.</span><span class="sxs-lookup"><span data-stu-id="3491d-232">You can construct an entire sub-site, with its own master pages, style sheets, and pages, using all the same techniques that you'd use for any other Web Forms application.</span></span> <span data-ttu-id="3491d-233">Не обязательно создавать мобильные эквивалент для *каждые* страница рабочего стола узла; вы можете определить, какая часть функциональности смысл посетители с мобильных устройств.</span><span class="sxs-lookup"><span data-stu-id="3491d-233">You don't necessarily need to produce a mobile equivalent for *every* page in your desktop site; you can choose what subset of functionality makes sense for mobile visitors.</span></span>

<span data-ttu-id="3491d-234">Страницах для мобильных устройств можно совместно использовать общие статические ресурсы (такие как изображения, JavaScript или CSS файлы) с помощью обычных страниц при необходимости.</span><span class="sxs-lookup"><span data-stu-id="3491d-234">Your mobile pages can share common static resources (such as images, JavaScript, or CSS files) with your regular pages if you wish.</span></span> <span data-ttu-id="3491d-235">Так как в папке «Мобильный» будет *не* помечаться как отдельное приложение при размещении в IIS (это просто простой вложенной страницы веб-форм), для него будет также использоваться те же конфигурации, данные о сеансе и другой инфраструктуры, как ваши страницы, рабочего стола.</span><span class="sxs-lookup"><span data-stu-id="3491d-235">Since your "Mobile" folder will *not* be marked as a separate application when hosted in IIS (it's just a simple subfolder of Web Forms pages), it will also share all the same configuration, Session data, and other infrastructure as your desktop pages.</span></span>

> [!NOTE]
> <span data-ttu-id="3491d-236">Так как этот подход обычно включает в себя некоторые повторы кода (страницах для мобильных устройств, вероятно, для совместного использования некоторое сходство с рабочего стола pages), очень важно, чтобы вынести любого распространенных кода бизнес-логики или данных доступа в общий базовый уровень или службы.</span><span class="sxs-lookup"><span data-stu-id="3491d-236">Since this approach usually involves some duplication of code (mobile pages are likely to share some similarities with desktop pages), it's important to factor out any common business logic or data access code into a shared underlying layer or service.</span></span> <span data-ttu-id="3491d-237">В противном случае вы будете двойные усилия на создание и обслуживание приложения.</span><span class="sxs-lookup"><span data-stu-id="3491d-237">Otherwise, you'll double the effort of creating and maintaining your application.</span></span>


#### <a name="redirecting-mobile-visitors-to-your-mobile-pages"></a><span data-ttu-id="3491d-238">Перенаправление посетители с мобильных устройств для мобильных веб-страниц</span><span class="sxs-lookup"><span data-stu-id="3491d-238">Redirecting mobile visitors to your mobile pages</span></span>

<span data-ttu-id="3491d-239">Часто бывает удобно для перенаправления посетители с мобильных устройств на страницах для мобильных устройств только в случае *первый* запросить их сеанса (и не при каждом запросе в свой сеанс), так как:</span><span class="sxs-lookup"><span data-stu-id="3491d-239">It's often convenient to redirect mobile visitors to the mobile pages only on the *first* request in their browsing session (and not on every request in their session), because:</span></span>

- <span data-ttu-id="3491d-240">Затем можно легко разрешить посетители с мобильных устройств для доступа к страницам рабочего стола, по желанию – просто поместить ссылку на главной странице, передается «Версии».</span><span class="sxs-lookup"><span data-stu-id="3491d-240">You can then easily allow mobile visitors to access your desktop pages if they wish – just put a link on your master page that goes to "Desktop version".</span></span> <span data-ttu-id="3491d-241">Посетитель не будет снова перенаправлены на странице для мобильных устройств, так как это не первый запрос в течение сеанса.</span><span class="sxs-lookup"><span data-stu-id="3491d-241">The visitor won't be redirected back to a mobile page, because it's no longer the first request in their session.</span></span>
- <span data-ttu-id="3491d-242">Это позволяет избежать риска конфликта с запросов любых динамических ресурсов, совместно настольных и мобильных частей узла (например, если у вас есть общие веб-формы, настольных и мобильных частей узла отображается в IFRAME, или некоторые обработчики Ajax)</span><span class="sxs-lookup"><span data-stu-id="3491d-242">It avoids the risk of interfering with requests for any dynamic resources shared between desktop and mobile parts of your site (e.g., if you have a common Web Form that both desktop and mobile parts of your site display in an IFRAME, or certain Ajax handlers)</span></span>

<span data-ttu-id="3491d-243">Чтобы сделать это, можно разместить логику перенаправления в **сеанса\_запустить** метод.</span><span class="sxs-lookup"><span data-stu-id="3491d-243">To do this, you can place your redirection logic in a **Session\_Start** method.</span></span> <span data-ttu-id="3491d-244">Например добавьте следующий метод в файл Global.asax.cs:</span><span class="sxs-lookup"><span data-stu-id="3491d-244">For example, add the following method to your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample2.cs)]

#### <a name="configuring-forms-authentication-to-respect-your-mobile-pages"></a><span data-ttu-id="3491d-245">Настройка проверки подлинности форм следует учитывать страницах для мобильных устройств</span><span class="sxs-lookup"><span data-stu-id="3491d-245">Configuring Forms Authentication to respect your mobile pages</span></span>

<span data-ttu-id="3491d-246">Обратите внимание на то, что проверка подлинности форм делает некоторые предположения о которых он может перенаправить посетителей, во время и после процесса проверки подлинности:</span><span class="sxs-lookup"><span data-stu-id="3491d-246">Note that Forms Authentication makes certain assumptions about where it can redirect visitors during and after the authentication process:</span></span>

- <span data-ttu-id="3491d-247">Когда пользователь должен пройти проверку подлинности, проверку подлинности форм перенаправит их на страницу входа для настольных систем, независимо от того, находятся ли они компьютере или мобильном пользователя (поскольку в нем концепцию *один* URL-адрес входа).</span><span class="sxs-lookup"><span data-stu-id="3491d-247">When a user needs to be authenticated, Forms Authentication will redirect them to your desktop login page, regardless of whether they're a desktop or mobile user (because it only has a concept of *one* login URL).</span></span> <span data-ttu-id="3491d-248">Предположим, что вы хотите по-разному в стиле страницы регистрации мобильных устройств, необходимо улучшить страницу вход на рабочий стол, таким образом, чтобы он перенаправляет мобильных пользователей на страницу входа отдельных мобильных устройств.</span><span class="sxs-lookup"><span data-stu-id="3491d-248">Assuming you want to style your mobile login page differently, you need to enhance your desktop login page so that it redirects mobile users to a separate mobile login page.</span></span> <span data-ttu-id="3491d-249">Например, добавьте следующий код, чтобы ваши **desktop** кода страницы входа:</span><span class="sxs-lookup"><span data-stu-id="3491d-249">For example, add the following code to your **desktop** login page code-behind:</span></span> 

    [!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample3.cs)]
- <span data-ttu-id="3491d-250">После успешного входа пользователя формы проверки подлинности по умолчанию перенаправит их на домашнюю страницу рабочего стола (поскольку в нем концепцию *один* страница по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="3491d-250">After a user successfully logs in, Forms Authentication will by default redirect them to your desktop home page (because it only has a concept of *one* default page).</span></span> <span data-ttu-id="3491d-251">Следует усовершенствовать страницы регистрации мобильных устройств, чтобы он перенаправляет на mobile домашнюю страницу после успешного входа.</span><span class="sxs-lookup"><span data-stu-id="3491d-251">You need to enhance your mobile login page so that it redirects to the mobile home page after a successful log-in.</span></span> <span data-ttu-id="3491d-252">Например, добавьте следующий код, чтобы ваши **мобильных** кода страницы входа:</span><span class="sxs-lookup"><span data-stu-id="3491d-252">For example, add the following code to your **mobile** login page code-behind:</span></span> 

    [!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample4.cs)]
  
  <span data-ttu-id="3491d-253">Этот код предполагается, что страница имеет имя входа серверного элемента управления, называется LoginUser, как в шаблоне проекта по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="3491d-253">This code assumes your page has a Login server control called LoginUser, as in the default project template.</span></span>

### <a name="working-with-output-caching"></a><span data-ttu-id="3491d-254">Работа с кэширования выходных данных</span><span class="sxs-lookup"><span data-stu-id="3491d-254">Working with Output Caching</span></span>

<span data-ttu-id="3491d-255">При использовании кэширования вывода, имейте в виду, что по умолчанию для рабочего стола пользователя посетить определенных URL-адрес (в результате чего его выходные данные, должен быть помещен в кэш) возможен, за которым следует мобильных пользователей, которые затем Получает кэшированный вывод рабочего стола.</span><span class="sxs-lookup"><span data-stu-id="3491d-255">If you're using output caching, beware that by default it's possible for a desktop user to visit a certain URL (causing its output to be cached), followed by a mobile user who then receives the cached desktop output.</span></span> <span data-ttu-id="3491d-256">Это предупреждение относится ли вы только что varying главную страницу по типу устройства, или реализации совершенно отдельной веб-форм на тип устройства.</span><span class="sxs-lookup"><span data-stu-id="3491d-256">This warning applies whether you're just varying your master page by device type, or implementing totally separate Web Forms per device type.</span></span>

<span data-ttu-id="3491d-257">Чтобы избежать проблемы, можно указать ASP.NET для изменения записи кэша в соответствии с ли посетитель с помощью мобильного устройства.</span><span class="sxs-lookup"><span data-stu-id="3491d-257">To avoid the problem, you can instruct ASP.NET to vary the cache entry according to whether the visitor is using a mobile device.</span></span> <span data-ttu-id="3491d-258">Добавление параметра VaryByCustom объявление OutputCache страницы следующим образом:</span><span class="sxs-lookup"><span data-stu-id="3491d-258">Add a VaryByCustom parameter to your page's OutputCache declaration as follows:</span></span>

[!code-aspx[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample5.aspx)]

<span data-ttu-id="3491d-259">Затем определите *isMobileDevice* как пользовательского кэша переопределить параметр, добавив следующий метод в файл Global.asax.cs:</span><span class="sxs-lookup"><span data-stu-id="3491d-259">Next, define *isMobileDevice* as a custom cache parameter by adding the following method override to your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample6.cs)]

<span data-ttu-id="3491d-260">Это позволит гарантировать, что посетители с мобильных устройств на страницу не получать выходные данные, уже успели поместить в кэш рабочего стола посетителем.</span><span class="sxs-lookup"><span data-stu-id="3491d-260">This will ensure that mobile visitors to the page don't receive output previously put into the cache by a desktop visitor.</span></span>

### <a name="a-working-example"></a><span data-ttu-id="3491d-261">Рабочий пример</span><span class="sxs-lookup"><span data-stu-id="3491d-261">A working example</span></span>

<span data-ttu-id="3491d-262">Для просмотра этих методик в действии, скачайте [примеры кода в этом техническом документе](https://docs.microsoft.com/aspnet/mobile/overview).</span><span class="sxs-lookup"><span data-stu-id="3491d-262">To see these techniques in action, download [this white paper's code samples](https://docs.microsoft.com/aspnet/mobile/overview).</span></span> <span data-ttu-id="3491d-263">Пример приложения Web Forms автоматически перенаправляет набор страниц, относящихся к mobile во вложенной папке Mobile мобильных пользователей.</span><span class="sxs-lookup"><span data-stu-id="3491d-263">The Web Forms sample application automatically redirects mobile users to a set of mobile-specific pages in a subfolder called Mobile.</span></span> <span data-ttu-id="3491d-264">Разметки и стиля этих страниц лучше оптимизирован для браузеров мобильных устройств, как вы видите от следующих снимков экрана:</span><span class="sxs-lookup"><span data-stu-id="3491d-264">The markup and styling of those pages is better optimized for mobile browsers, as you can see from the following screenshots:</span></span>

![](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/_static/image2.png)

<span data-ttu-id="3491d-265">Дополнительные советы по оптимизации разметки и CSS для браузеров мобильных устройств см. в разделе «Стилизация страницах для мобильных устройств для браузеров мобильных устройств» далее в этом документе.</span><span class="sxs-lookup"><span data-stu-id="3491d-265">For more tips about optimizing your markup and CSS for mobile browsers, see the section "Styling mobile pages for mobile browsers" later in this document.</span></span>

## <a name="how-aspnet-mvc-applications-can-present-mobile-specific-pages"></a><span data-ttu-id="3491d-266">Как приложения ASP.NET MVC могут обеспечивать страниц, относящихся к mobile</span><span class="sxs-lookup"><span data-stu-id="3491d-266">How ASP.NET MVC applications can present mobile-specific pages</span></span>

<span data-ttu-id="3491d-267">Так как шаблон Model-View-Controller отделяет логику приложения (в контроллерах) от логики представления (в представлениях), можно из любого из следующих подходов к обработке поддержка мобильных устройств в коде на стороне сервера:</span><span class="sxs-lookup"><span data-stu-id="3491d-267">Since the Model-View-Controller pattern decouples application logic (in controllers) from presentation logic (in views), you can choose from any of the following approaches to handling mobile support in server-side code:</span></span>

1. <span data-ttu-id="3491d-268">\*\**Используйте те же контроллеры и представления для настольных и мобильных браузеров, но отображать представления с различные макеты Razor, в зависимости от типа устройств *.**</span><span class="sxs-lookup"><span data-stu-id="3491d-268">\***Use the same controllers and views for both desktop and mobile browsers, but render the views with different Razor layouts depending on the device type\*.**</span></span> <span data-ttu-id="3491d-269">Этот параметр работает лучше, если вы отображаете одинаковые данные на всех устройствах, но просто необходимо указать разные таблицы стилей CSS, или изменить несколько элементов верхнего уровня HTML для мобильных устройств.</span><span class="sxs-lookup"><span data-stu-id="3491d-269">This option works best if you're displaying identical data on all devices, but simply want to supply different CSS stylesheets or change a few top-level HTML elements for mobiles.</span></span>
2. <span data-ttu-id="3491d-270">***Использовать же контроллеров для настольных и мобильных браузеров, но отображать различные представления в зависимости от типа устройства***.</span><span class="sxs-lookup"><span data-stu-id="3491d-270">***Use the same controllers for both desktop and mobile browsers, but render different views depending on the device type***.</span></span> <span data-ttu-id="3491d-271">Этот параметр работает лучше, если вы отображение примерно те же данные и те же рабочие для конечных пользователей, но хотите выполнить рендеринг очень разную HTML-разметку в соответствии с устройством.</span><span class="sxs-lookup"><span data-stu-id="3491d-271">This option works best if you're displaying roughly the same data and providing the same workflows for end users, but want to render very different HTML markup to suit the device being used.</span></span>
3. <span data-ttu-id="3491d-272">\*\**Создайте отдельные области для настольных и мобильных браузеров, реализация независимых контроллеров и представлений для каждого *.**</span><span class="sxs-lookup"><span data-stu-id="3491d-272">\***Create separate areas for desktop and mobile browsers, implementing independent controllers and views for each\*.**</span></span> <span data-ttu-id="3491d-273">Этот вариант лучше всего применять, если вы отображать очень разные экраны, содержащие разные данные и начальные пользователя с помощью различных рабочих процессов, оптимизированный для их типа устройства.</span><span class="sxs-lookup"><span data-stu-id="3491d-273">This option works best if you're displaying very different screens, containing different information and leading the user through different workflows optimized for their device type.</span></span> <span data-ttu-id="3491d-274">Это может означать некоторые повторений кода, но можно свести к минимуму, выделяя общую логику в базовый уровень или службы.</span><span class="sxs-lookup"><span data-stu-id="3491d-274">It may mean some repetition of code, but you can minimize that by factoring out common logic into an underlying layer or service.</span></span>

<span data-ttu-id="3491d-275">Если вы хотите воспользоваться **первый** параметр и различаются только макета Razor на тип устройства, это очень просто.</span><span class="sxs-lookup"><span data-stu-id="3491d-275">If you want to take the **first** option and vary only the Razor layout per device type, it's very easy.</span></span> <span data-ttu-id="3491d-276">Просто измените вашей \_ViewStart.cshtml файл следующим образом:</span><span class="sxs-lookup"><span data-stu-id="3491d-276">Just modify your \_ViewStart.cshtml file as follows:</span></span>

[!code-cshtml[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample7.cshtml)]

<span data-ttu-id="3491d-277">Теперь вы можете создать макет мобильных обозревателей \_LayoutMobile.cshtml со структурой страницу и CSS правила, оптимизированный для мобильных устройств.</span><span class="sxs-lookup"><span data-stu-id="3491d-277">Now you can create a mobile-specific layout called \_LayoutMobile.cshtml with a page structure and CSS rules optimized for mobile devices.</span></span>

<span data-ttu-id="3491d-278">Если вы хотите воспользоваться **второй** параметр отрисовки совершенно различные представления в соответствии с типом устройства посетителя, см. в разделе [записи блога Скотта Хансельмана](http://www.hanselman.com/blog/ABetterASPNETMVCMobileDeviceCapabilitiesViewEngine.aspx).</span><span class="sxs-lookup"><span data-stu-id="3491d-278">If you want to take the **second** option render totally different views according to the visitor's device type, see [Scott Hanselman's blog post](http://www.hanselman.com/blog/ABetterASPNETMVCMobileDeviceCapabilitiesViewEngine.aspx).</span></span>

<span data-ttu-id="3491d-279">Оставшаяся часть этого документа посвящена **третий** параметр — Создание отдельные контроллеры *и* представлений для мобильных устройств — Чтобы указать, можно точно определить, какая часть функциональности предлагается для посетители с мобильных устройств.</span><span class="sxs-lookup"><span data-stu-id="3491d-279">The rest of this paper focuses on the **third** option – creating separate controllers *and* views for mobile devices – so you can control exactly what subset of functionality is offered for mobile visitors.</span></span>

### <a name="setting-up-a-mobile-area-within-your-aspnet-mvc-application"></a><span data-ttu-id="3491d-280">Настройка мобильных области в приложении ASP.NET MVC</span><span class="sxs-lookup"><span data-stu-id="3491d-280">Setting up a Mobile area within your ASP.NET MVC application</span></span>

<span data-ttu-id="3491d-281">Можно добавить активной зоне «Mobile» в существующее приложение ASP.NET MVC обычным способом: щелкните правой кнопкой мыши имя проекта в обозревателе решений и выберите Add, а область.</span><span class="sxs-lookup"><span data-stu-id="3491d-281">You can add an area called "Mobile" to an existing ASP.NET MVC application in the normal way: right-click on your project name in Solution Explorer, then choose Add à Area.</span></span> <span data-ttu-id="3491d-282">Затем можно добавить контроллеры и представления как для любой области в приложении ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="3491d-282">You can then add controllers and views as you would for any other area within an ASP.NET MVC application.</span></span> <span data-ttu-id="3491d-283">Например добавите в область мобильных новый контроллер с именем HomeController в качестве домашней страницы для посетители с мобильных устройств.</span><span class="sxs-lookup"><span data-stu-id="3491d-283">For example, add to your Mobile area a new controller called HomeController to act as a homepage for mobile visitors.</span></span>

### <a name="ensuring-the-url-mobile-reaches-the-mobile-homepage"></a><span data-ttu-id="3491d-284">Обеспечение /Mobile URL-адрес достигает мобильных домашней страницы</span><span class="sxs-lookup"><span data-stu-id="3491d-284">Ensuring the URL /Mobile reaches the mobile homepage</span></span>

<span data-ttu-id="3491d-285">Если требуется /Mobile URL-адрес для доступа к действие Index в HomeController внутри продвижению мобильных, необходимо внесение двух небольших изменений в конфигурацию маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="3491d-285">If you want the URL /Mobile to reach the Index action on HomeController inside your Mobile area, you will need to make two small changes to your routing configuration.</span></span> <span data-ttu-id="3491d-286">Во-первых обновите ваш класс MobileAreaRegistration таким образом, чтобы HomeController контроллера по умолчанию в вашем регионе мобильных устройств, как показано в следующем коде:</span><span class="sxs-lookup"><span data-stu-id="3491d-286">First, update your MobileAreaRegistration class so that HomeController is the default controller in your Mobile area, as shown in the following code:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample8.cs)]

<span data-ttu-id="3491d-287">Это означает мобильных домашней страницы теперь будет расположена на /Mobile вместо/Mobile/Home, так как «Home» теперь является неявным образом имя по умолчанию контроллер страницах для мобильных устройств.</span><span class="sxs-lookup"><span data-stu-id="3491d-287">This means the mobile homepage will now be located at /Mobile, rather than /Mobile/Home, because "Home" is now the implicitly default controller name for mobile pages.</span></span>

<span data-ttu-id="3491d-288">Далее Обратите внимание на то, что путем добавления второй HomeController приложения (т. е. мобильных тот, в дополнение к существующей рабочего стола один), при будет разрыве регулярных рабочих столов главной странице.</span><span class="sxs-lookup"><span data-stu-id="3491d-288">Next, note that by adding a second HomeController to your application (i.e., the mobile one, in addition to the existing desktop one), you'll have broken your regular desktop homepage.</span></span> <span data-ttu-id="3491d-289">Она завершится с ошибкой "*найдено несколько типов, которые соответствуют контроллер с именем «Home»*«.</span><span class="sxs-lookup"><span data-stu-id="3491d-289">It will fail with the error "*Multiple types were found that match the controller named 'Home'*".</span></span> <span data-ttu-id="3491d-290">Чтобы устранить эту проблему, обновите конфигурацию верхнего уровня маршрутизации (в файле Global.asax.cs) для указания, что вашего рабочего стола HomeController следует имеют более высокий приоритет при наличии неоднозначности:</span><span class="sxs-lookup"><span data-stu-id="3491d-290">To resolve this, update your top-level routing configuration (in Global.asax.cs) to specify that your desktop HomeController should take priority when there's ambiguity:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample9.cs)]

<span data-ttu-id="3491d-291">Теперь будет отправлена ошибка размещение и URL-адрес http:\/\/*ваш_сайт*/ достигнет рабочего стола и домашнюю страницу http:\/\/*ваш_сайт*будет /mobile/ получить доступ к домашней странице мобильных устройств.</span><span class="sxs-lookup"><span data-stu-id="3491d-291">Now the error will go away, and the URL http:\/\/*yoursite*/ will reach the desktop homepage, and http:\/\/*yoursite*/mobile/ will reach the mobile homepage.</span></span>

### <a name="redirecting-mobile-visitors-to-your-mobile-area"></a><span data-ttu-id="3491d-292">Перенаправление посетители с мобильных устройств в мобильных область</span><span class="sxs-lookup"><span data-stu-id="3491d-292">Redirecting mobile visitors to your mobile area</span></span>

<span data-ttu-id="3491d-293">Имеется множество разные точки расширения в ASP.NET MVC, поэтому существует много возможных способов для добавления логики перенаправления.</span><span class="sxs-lookup"><span data-stu-id="3491d-293">There are many different extensibility points in ASP.NET MVC, so there are many possible ways to inject redirection logic.</span></span> <span data-ttu-id="3491d-294">Один из вариантов ясном — создайте атрибут фильтра, [RedirectMobileDevicesToMobileArea], который выполняет перенаправление в том случае, если выполняются следующие условия:</span><span class="sxs-lookup"><span data-stu-id="3491d-294">One neat option is to create a filter attribute, [RedirectMobileDevicesToMobileArea], that performs a redirection if the following conditions are met:</span></span>

1. <span data-ttu-id="3491d-295">Это первый запрос в сеансе пользователя (т. е. Session.IsNewSession имеет значение true)</span><span class="sxs-lookup"><span data-stu-id="3491d-295">It's the first request in the user's session (i.e., Session.IsNewSession equals true)</span></span>
2. <span data-ttu-id="3491d-296">Запрос поступает от браузера мобильного устройства (т. е. Request.Browser.IsMobileDevice имеет значение true)</span><span class="sxs-lookup"><span data-stu-id="3491d-296">The request comes from a mobile browser (i.e., Request.Browser.IsMobileDevice equals true)</span></span>
3. <span data-ttu-id="3491d-297">Пользователь уже не запрашивает ресурс в области мобильных устройств (т. е. *путь* часть URL-адрес не начинается с /Mobile)</span><span class="sxs-lookup"><span data-stu-id="3491d-297">The user is not already requesting a resource in the mobile area (i.e., the *path* part of the URL does not begin with /Mobile)</span></span>

<span data-ttu-id="3491d-298">Загружаемый пример, включенные в этот технический документ содержит реализацию этой логики.</span><span class="sxs-lookup"><span data-stu-id="3491d-298">The downloadable sample included with this white paper includes an implementation of this logic.</span></span> <span data-ttu-id="3491d-299">Он реализован в виде фильтра авторизации, производный от AuthorizeAttribute, это означает, что он может работать правильно даже при использовании кэширования выходных данных (в противном случае, если может кэшировать и затем обслуживать рабочего стола посетителя первый обращений к определенным URL-адрес, выходные данные рабочего стола последующие посетители с мобильных устройств).</span><span class="sxs-lookup"><span data-stu-id="3491d-299">It's implemented as an authorization filter, derived from AuthorizeAttribute, which means it can work correctly even if you are using output caching (otherwise, if a desktop visitor first accesses a certain URL, the desktop output might be cached and then served to subsequent mobile visitors).</span></span>

<span data-ttu-id="3491d-300">Так как он является фильтром, вы можете применить его для определенных контроллеров и действий, например,</span><span class="sxs-lookup"><span data-stu-id="3491d-300">As it's a filter, you can choose either to apply it to specific controllers and actions, e.g.,</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample10.cs)]

<span data-ttu-id="3491d-301">…</span><span class="sxs-lookup"><span data-stu-id="3491d-301">…</span></span> <span data-ttu-id="3491d-302">или вы можете применить ко всем контроллерам и действиям качестве MVC 3 *глобальный фильтр* в файле Global.asax.cs:</span><span class="sxs-lookup"><span data-stu-id="3491d-302">or you can apply it to all controllers and actions as an MVC 3 *global filter* in your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample11.cs)]

<span data-ttu-id="3491d-303">Загружаемый пример также демонстрирует, как можно создать подклассы этого атрибута, которые перенаправляют в определенные расположения в вашем регионе мобильных устройств.</span><span class="sxs-lookup"><span data-stu-id="3491d-303">The downloadable sample also demonstrates how you can create subclasses of this attribute that redirect to specific locations within your mobile area.</span></span> <span data-ttu-id="3491d-304">Это означает, например, вы можете:</span><span class="sxs-lookup"><span data-stu-id="3491d-304">This means, for example, you can:</span></span>

- <span data-ttu-id="3491d-305">Зарегистрируйте глобальный фильтр как показано выше, отправляющий посетители с мобильных устройств на мобильных домашнюю страницу по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="3491d-305">Register a global filter as shown above that sends mobile visitors to the mobile homepage by default.</span></span>
- <span data-ttu-id="3491d-306">Также примените фильтр [RedirectMobileDevicesToMobileProductPage] специальные действие «ознакомиться с продуктом», которое принимает посетители с мобильных устройств к мобильной версии они бы запрошен страница продукта.</span><span class="sxs-lookup"><span data-stu-id="3491d-306">Also apply a special [RedirectMobileDevicesToMobileProductPage] filter to a "view product" action that takes mobile visitors to the mobile version of whatever product page they had requested.</span></span>
- <span data-ttu-id="3491d-307">Также применяются другие специальные подклассы фильтра к определенным действиям, перенаправляя посетители с мобильных устройств для эквивалентных страницы мобильного устройства</span><span class="sxs-lookup"><span data-stu-id="3491d-307">Also apply other special subclasses of the filter to specific actions, redirecting mobile visitors to the equivalent mobile page</span></span>

### <a name="configuring-forms-authentication-to-respect-your-mobile-pages"></a><span data-ttu-id="3491d-308">Настройка проверки подлинности форм следует учитывать страницах для мобильных устройств</span><span class="sxs-lookup"><span data-stu-id="3491d-308">Configuring Forms Authentication to respect your mobile pages</span></span>

<span data-ttu-id="3491d-309">Если вы используете проверку подлинности форм, следует отметить, что при попытке пользователя выполнить вход, он автоматически перенаправляет пользователя на одного конкретного «вход в» URL-адрес, который по умолчанию является **/учетной записи и входа в систему**.</span><span class="sxs-lookup"><span data-stu-id="3491d-309">If you're using Forms Authentication, you should note that when a user needs to log in, it automatically redirects the user to a single specific "log on" URL, which by default is **/Account/LogOn**.</span></span> <span data-ttu-id="3491d-310">Это означает, что мобильные пользователи могут быть перенаправлены действию рабочего стола «вход».</span><span class="sxs-lookup"><span data-stu-id="3491d-310">This means that mobile users may be redirected to your desktop "log on" action.</span></span>

<span data-ttu-id="3491d-311">Чтобы избежать этой проблемы, добавьте логику вашего рабочего стола «вход в» действие таким образом, чтобы он перенаправляет мобильные пользователи снова мобильных действию «вход».</span><span class="sxs-lookup"><span data-stu-id="3491d-311">To avoid this problem, add logic to your desktop "log on" action so that it redirects mobile users again to a mobile "log on" action.</span></span> <span data-ttu-id="3491d-312">Если вы используете шаблон приложения ASP.NET MVC по умолчанию, обновите действие входа в систему в AccountController следующим образом:</span><span class="sxs-lookup"><span data-stu-id="3491d-312">If you're using the default ASP.NET MVC application template, update AccountController's LogOn action as follows:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample12.cs)]

<span data-ttu-id="3491d-313">…</span><span class="sxs-lookup"><span data-stu-id="3491d-313">…</span></span> <span data-ttu-id="3491d-314">и затем реализовать подходящий действие «вход в» мобильных обозревателей на контроллере вызывается AccountController по продвижению мобильных устройств.</span><span class="sxs-lookup"><span data-stu-id="3491d-314">and then implement a suitable mobile-specific "log on" action on a controller called AccountController in your Mobile area.</span></span>

### <a name="working-with-output-caching"></a><span data-ttu-id="3491d-315">Работа с кэширования выходных данных</span><span class="sxs-lookup"><span data-stu-id="3491d-315">Working with Output Caching</span></span>

<span data-ttu-id="3491d-316">Если вы используете фильтр [OutputCache], необходимо принудительно записи кэша, чтобы зависеть от типа устройства.</span><span class="sxs-lookup"><span data-stu-id="3491d-316">If you're using the [OutputCache] filter, you must force the cache entry to vary by device type.</span></span> <span data-ttu-id="3491d-317">Например напишите:</span><span class="sxs-lookup"><span data-stu-id="3491d-317">For example, write:</span></span>

[!code-javascript[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample13.js)]

<span data-ttu-id="3491d-318">Затем добавьте следующий метод в файл Global.asax.cs:</span><span class="sxs-lookup"><span data-stu-id="3491d-318">Then, add the following method to your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample14.cs)]

<span data-ttu-id="3491d-319">Это позволит гарантировать, что посетители с мобильных устройств на страницу не получать выходные данные, уже успели поместить в кэш рабочего стола посетителем.</span><span class="sxs-lookup"><span data-stu-id="3491d-319">This will ensure that mobile visitors to the page don't receive output previously put into the cache by a desktop visitor.</span></span>

### <a name="a-working-example"></a><span data-ttu-id="3491d-320">Рабочий пример</span><span class="sxs-lookup"><span data-stu-id="3491d-320">A working example</span></span>

<span data-ttu-id="3491d-321">Для просмотра этих методик в действии, скачайте [кода в этом техническом документе связанные примеры](https://docs.microsoft.com/aspnet/mobile/overview).</span><span class="sxs-lookup"><span data-stu-id="3491d-321">To see these techniques in action, download [this white paper's code associated samples](https://docs.microsoft.com/aspnet/mobile/overview).</span></span> <span data-ttu-id="3491d-322">В образец входит приложение ASP.NET MVC 3 (версия-кандидат), улучшены для поддержки мобильных устройств с помощью описанных выше методов.</span><span class="sxs-lookup"><span data-stu-id="3491d-322">The sample includes an ASP.NET MVC 3 (Release Candidate) application enhanced to support mobile devices using the methods described above.</span></span>

## <a name="further-guidance-and-suggestions"></a><span data-ttu-id="3491d-323">Дополнительные примеры и рекомендации</span><span class="sxs-lookup"><span data-stu-id="3491d-323">Further guidance and suggestions</span></span>

<span data-ttu-id="3491d-324">Следующее обсуждение применяется к веб-форм и MVC разработчикам, использующим технологии, описанные в этом документе.</span><span class="sxs-lookup"><span data-stu-id="3491d-324">The following discussion applies both to Web Forms and MVC developers who are using the techniques covered in this document.</span></span>

### <a name="enhancing-your-redirection-logic-using-51degreesmobi-foundation"></a><span data-ttu-id="3491d-325">Улучшение логику перенаправления, с помощью 51Degrees.mobi Foundation</span><span class="sxs-lookup"><span data-stu-id="3491d-325">Enhancing your redirection logic using 51Degrees.mobi Foundation</span></span>

<span data-ttu-id="3491d-326">Логику перенаправления, показанные в данном документе может быть вполне достаточно для вашего приложения, но он не будет работать, если вам нужно отключить сеансы, или с помощью браузеров мобильных устройств, которые отклонить файлы cookie (они не могут иметь сеансы), так как он не знает ли данного запроса является Первый из них от этого посетителя.</span><span class="sxs-lookup"><span data-stu-id="3491d-326">The redirection logic shown in this document may be perfectly sufficient for your application, but it won't work if you need to disable sessions, or with mobile browsers that reject cookies (these can't have sessions), because it won't know whether a given request is the first one from that visitor.</span></span>

<span data-ttu-id="3491d-327">Вы уже узнали, как открытым исходным кодом 51Degrees.mobi Foundation повышает точность ASP. Определение обозревателя NET.</span><span class="sxs-lookup"><span data-stu-id="3491d-327">You already learned how the open source 51Degrees.mobi Foundation can improve the accuracy of ASP.NET's browser detection.</span></span> <span data-ttu-id="3491d-328">Он также содержит встроенные возможность перенаправления посетители с мобильных устройств для определенного расположения, настроенные в файле Web.config. Это может работать без зависимости от сеансов ASP.NET (и, следовательно файлы cookie), сохраняя временного журнала хэшей посетителей заголовки HTTP и IP-адресов, благодаря которому известно ли каждый запрос является первым из заданного готовый посетитель.</span><span class="sxs-lookup"><span data-stu-id="3491d-328">It also has a built-in ability to redirect mobile visitors to specific locations configured in Web.config. It's able to work without depending on ASP.NET Sessions (and hence cookies) by storing a temporary log of hashes of visitors' HTTP headers and IP addresses, so it knows whether or not each request is the first one from a given vistor.</span></span>

<span data-ttu-id="3491d-329">Следующий элемент, добавляемый в fiftyOne разделе файла web.config будет перенаправлять первого запроса с мобильного устройства, обнаруженные на страницу ~ / Mobile/Default.aspx.</span><span class="sxs-lookup"><span data-stu-id="3491d-329">The following element added to the fiftyOne section of the web.config file will redirect the first request from a detected mobile device to the page ~/Mobile/Default.aspx.</span></span> <span data-ttu-id="3491d-330">Любые запросы к страницам в папке мобильных будет *не* перенаправлены, вне зависимости от типа устройства.</span><span class="sxs-lookup"><span data-stu-id="3491d-330">Any requests to pages under the Mobile folder will *not* be redirected, regardless of device type.</span></span> <span data-ttu-id="3491d-331">Если мобильное устройство был неактивен в течение 20 минут или больше устройств удаляются, и последующие запросы будут рассматриваться как новые командлеты для целей перенаправления.</span><span class="sxs-lookup"><span data-stu-id="3491d-331">If the mobile device has been inactive for a period of 20 minutes or more the device will be forgotten and subsequent requests will be treated as new ones for the purposes of redirection.</span></span>

[!code-xml[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample15.xml)]

<span data-ttu-id="3491d-332">Дополнительные сведения см. в разделе [51degrees.mobi документации Foundation](https://github.com/51Degrees/dotNET-Device-Detection).</span><span class="sxs-lookup"><span data-stu-id="3491d-332">For more details, see [51degrees.mobi Foundation documentation](https://github.com/51Degrees/dotNET-Device-Detection).</span></span>

> [!NOTE]
> <span data-ttu-id="3491d-333">Вы *можно* Foundation 51Degrees.mobi использования функции перенаправления в приложениях ASP.NET MVC, но будет необходимо определить конфигурацию перенаправления с точки зрения обычный URL-адреса, не в терминах параметров маршрутизации или путем помещения фильтров MVC о действиях.</span><span class="sxs-lookup"><span data-stu-id="3491d-333">You *can* use 51Degrees.mobi Foundation's redirection feature on ASP.NET MVC applications, but you will need to define your redirection configuration in terms of plain URLs, not in terms of routing parameters or by putting MVC filters on actions.</span></span> <span data-ttu-id="3491d-334">Это обусловлено (на момент написания статьи) 51Degrees.mobi Foundation не поддерживает фильтры или маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="3491d-334">This is because (at the time of writing) 51Degrees.mobi Foundation does not recognize filters or routing.</span></span>


### <a name="disabling-transcoders-and-proxy-servers"></a><span data-ttu-id="3491d-335">Отключение Транскодеры и прокси-серверы</span><span class="sxs-lookup"><span data-stu-id="3491d-335">Disabling Transcoders and Proxy Servers</span></span>

<span data-ttu-id="3491d-336">Операторы мобильной сети имеют две широкие цели в свой подход к Интернету мобильных устройств.</span><span class="sxs-lookup"><span data-stu-id="3491d-336">Mobile network operators have two broad objectives in their approach to the mobile internet:</span></span>

1. <span data-ttu-id="3491d-337">Укажите в качестве гораздо соответствующего содержимого максимально</span><span class="sxs-lookup"><span data-stu-id="3491d-337">Provide as much relevant content as possible</span></span>
2. <span data-ttu-id="3491d-338">Максимальное количество клиентов, которые могут совместно использовать пропускную способность сети ограниченной радио</span><span class="sxs-lookup"><span data-stu-id="3491d-338">Maximize the number of customers who can share the limited radio network bandwidth</span></span>

<span data-ttu-id="3491d-339">Так как большинство веб-страниц, разработанные для экранов большого размера рабочего стола и быстрого фиксированной строки широкополосным соединениям, многие операторы используют *транскодеры* или *прокси-серверы* , динамически изменить веб-содержимого.</span><span class="sxs-lookup"><span data-stu-id="3491d-339">Since most web pages were designed for large desktop-sized screens and fast fixed-line broadband connections, many operators use *transcoders* or *proxy servers* that dynamically alter web content.</span></span> <span data-ttu-id="3491d-340">Они могут изменять разметку HTML или CSS в соответствии с экране меньшего размера (особенно для «телефонах», не хватает вычислительной мощности для обработки сложных макетов), и они могут повторное сжатие изображений (значительно снижает качество) для повышения скорости доставки страницы.</span><span class="sxs-lookup"><span data-stu-id="3491d-340">They may modify your HTML markup or CSS to suit smaller screens (especially for "feature phones" that lack the processing power to handle complex layouts), and they may recompress your images (significantly reducing their quality) to improve page delivery speeds.</span></span>

<span data-ttu-id="3491d-341">Но, если были предприняты попытки создать оптимизированный для мобильных устройств версию веб-узла, возможно, не повлиять на его работу любые дополнительные сети оператора.</span><span class="sxs-lookup"><span data-stu-id="3491d-341">But if you've taken the effort to produce a mobile-optimized version of your site, you probably don't want the network operator to interfere with it any further.</span></span> <span data-ttu-id="3491d-342">Можно добавить следующую строку на страницу\_событие Load в любой веб-формы ASP.NET:</span><span class="sxs-lookup"><span data-stu-id="3491d-342">You can add the following line to the Page\_Load event in any ASP.NET Web Form:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample16.cs)]

<span data-ttu-id="3491d-343">Или для контроллера ASP.NET MVC, можно добавить следующее переопределение метода, то есть применяется ко всем действиям на этом контроллере:</span><span class="sxs-lookup"><span data-stu-id="3491d-343">Or, for an ASP.NET MVC controller, you could add the following method override so that it applies to all actions on that controller:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample17.cs)]

<span data-ttu-id="3491d-344">Результирующее сообщение HTTP сообщает, соответствует транскодеры W3C и прокси-серверы, не для того, чтобы изменить содержимое.</span><span class="sxs-lookup"><span data-stu-id="3491d-344">The resulting HTTP message informs W3C compliant transcoders and proxies not to alter content.</span></span> <span data-ttu-id="3491d-345">Само собой нет никакой гарантии, что операторы мобильной сети будут использовать это сообщение.</span><span class="sxs-lookup"><span data-stu-id="3491d-345">Of course, there is no guarantee that mobile network operators will respect this message.</span></span>

### <a name="styling-mobile-pages-for-mobile-browsers"></a><span data-ttu-id="3491d-346">Задание стиля страницах для мобильных устройств для браузеров мобильных устройств</span><span class="sxs-lookup"><span data-stu-id="3491d-346">Styling mobile pages for mobile browsers</span></span>

<span data-ttu-id="3491d-347">Он выходит за рамки этого документа описывается подробно какие виды рабочих разметки HTML правильно или какие стратегии разработки web увеличения удобства использования на определенных устройств.</span><span class="sxs-lookup"><span data-stu-id="3491d-347">It's beyond the scope of this document to describe in great detail what kinds of HTML markup work correctly or which web design techniques maximize usability on particular devices.</span></span> <span data-ttu-id="3491d-348">Он содержит копии вам найти достаточно простой макет, оптимизированные для экрана mobile среднего размера, без использования ненадежных HTML или размещения приемы CSS.</span><span class="sxs-lookup"><span data-stu-id="3491d-348">It's up to you to find a sufficiently simple layout, optimized for a mobile-sized screen, without using unreliable HTML or CSS positioning tricks.</span></span> <span data-ttu-id="3491d-349">Один из важных способов стоит упомянуть, тем не менее, — *просмотра мета-тег*.</span><span class="sxs-lookup"><span data-stu-id="3491d-349">One important technique worth mentioning, however, is the *viewport meta tag*.</span></span>

<span data-ttu-id="3491d-350">Определенные современных браузеров мобильных устройств, на веб-страницах усилий отображения предназначены для мониторами, визуализации страницы на виртуальный canvas также называется «окно просмотра» (например, виртуального окна просмотра — 980 пикселей в ширину и на iPhone и 850 пикселей в ширину и в Opera Mobile по умолчанию) и затем результат уменьшить масштаб в соответствии с размерами экрана физических пикселей.</span><span class="sxs-lookup"><span data-stu-id="3491d-350">Certain modern mobile browsers, in an effort display web pages meant for desktop monitors, render the page on a virtual canvas, also called "viewport" (e.g., the virtual viewport is 980 pixels wide on iPhone, and 850 pixels wide on Opera Mobile by default) and then scale the result down to fit onto the screen's physical pixels.</span></span> <span data-ttu-id="3491d-351">Пользователь может затем увеличить масштаб и Lightbox вокруг этого окна просмотра.</span><span class="sxs-lookup"><span data-stu-id="3491d-351">The user can then zoom in and pan around that viewport.</span></span> <span data-ttu-id="3491d-352">Это имеет то преимущество, что он позволяет браузеру на страницу предполагаемого макета, но также есть недостаток, что она заставляет масштабирования и панорамирования, который неудобно для пользователя.</span><span class="sxs-lookup"><span data-stu-id="3491d-352">This has the advantage that it lets the browser display the page in its intended layout, but it's also has the disadvantage that it forces zooming and panning, which is inconvenient for the user.</span></span> <span data-ttu-id="3491d-353">При разработке для мобильных устройств, лучше проектирования для узкой экрана, масштабирование или горизонтальная прокрутка необходим.</span><span class="sxs-lookup"><span data-stu-id="3491d-353">If you're designing for mobile, it's better to design for a narrow screen so that no zooming or horizontal scrolling is necessary.</span></span>

<span data-ttu-id="3491d-354">Заставляет браузер мобильного устройства ширину окна просмотра должно быть – нестандартное *просмотра* мета-тег.</span><span class="sxs-lookup"><span data-stu-id="3491d-354">A way to tell the mobile browser how wide the viewport should be is through the nonstandard *viewport* meta tag.</span></span> <span data-ttu-id="3491d-355">Например, если необходимо добавить следующий раздел HEAD страницы,</span><span class="sxs-lookup"><span data-stu-id="3491d-355">For example, if you add the following to your page's HEAD section,</span></span>

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample18.html)]

<span data-ttu-id="3491d-356">…</span><span class="sxs-lookup"><span data-stu-id="3491d-356">…</span></span> <span data-ttu-id="3491d-357">затем Поддержка браузеров смартфонов будет разметки страницы на полотне виртуальные 480 пикселей.</span><span class="sxs-lookup"><span data-stu-id="3491d-357">then supporting smartphone browsers will lay out the page on a 480-pixel wide virtual canvas.</span></span> <span data-ttu-id="3491d-358">Это означает, что если ваш HTML-элементов определяет их ширина в процентах, процентные показатели будут интерпретироваться по отношению к этой 480 пикселов, не ширины окна просмотра по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="3491d-358">This means that if your HTML elements define their widths in percentage terms, the percentages will be interpreted with respect to this 480-pixel width, not the default viewport width.</span></span> <span data-ttu-id="3491d-359">Таким образом пользователь вряд ли придется изменение масштаба и сдвиг по горизонтали — значительно улучшение мобильной работы в Интернете.</span><span class="sxs-lookup"><span data-stu-id="3491d-359">As a result, the user is less likely to have to zoom and pan horizontally – considerably improving the mobile browsing experience.</span></span>

<span data-ttu-id="3491d-360">При желании ширины окна просмотра в соответствии с физических пикселей устройства можно указать следующее:</span><span class="sxs-lookup"><span data-stu-id="3491d-360">If you want the viewport width to match the device's physical pixels, you can specify the following:</span></span>

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample19.html)]

<span data-ttu-id="3491d-361">Чтобы это работало правильно, вы не заставлять явно элементов нарушать это ограничение (например, с помощью *ширины* атрибут или свойство CSS), в противном случае браузера будут вынуждены использовать независимо от того, окно просмотра большего размера.</span><span class="sxs-lookup"><span data-stu-id="3491d-361">For this to work correctly, you must not explicitly force elements to exceed that width (e.g., using a *width* attribute or CSS property), otherwise the browser will be forced to use a larger viewport regardless.</span></span> <span data-ttu-id="3491d-362">См. также: [Дополнительные сведения о теге нестандартное просмотра](https://developer.apple.com/library/safari/#documentation/AppleApplications/Reference/SafariHTMLRef/Articles/MetaTags.html).</span><span class="sxs-lookup"><span data-stu-id="3491d-362">See also: [more details about the nonstandard viewport tag](https://developer.apple.com/library/safari/#documentation/AppleApplications/Reference/SafariHTMLRef/Articles/MetaTags.html).</span></span>

<span data-ttu-id="3491d-363">Поддерживает наиболее современные смартфоны *двойную ориентацию*: они могут храниться в книжном или альбомном режиме.</span><span class="sxs-lookup"><span data-stu-id="3491d-363">Most modern smartphones support *dual orientation*: they can be held in either portrait or landscape mode.</span></span> <span data-ttu-id="3491d-364">Таким образом важно не делать предположения о ширину экрана в пикселях.</span><span class="sxs-lookup"><span data-stu-id="3491d-364">So, it's important not to make assumptions about the screen width in pixels.</span></span> <span data-ttu-id="3491d-365">Не даже предполагается, что ширину экрана является фиксированным, так как пользователь повторно можете ориентировать свои устройства, находящиеся на странице.</span><span class="sxs-lookup"><span data-stu-id="3491d-365">Don't even assume that the screen width is fixed, because the user can re-orient their device while they are on your page.</span></span>

<span data-ttu-id="3491d-366">Старые устройства Windows Mobile и Blackberry также может принимать следующие теги meta в заголовке страницы, чтобы уведомить пользователя содержимого был оптимизирован для мобильных устройств и поэтому не должны преобразовываться.</span><span class="sxs-lookup"><span data-stu-id="3491d-366">Older Windows Mobile and Blackberry devices may also accept the following meta tags in the page header to inform them content has been optimized for mobile and therefore should not be transformed.</span></span>

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample20.html)]

## <a name="additional-resources"></a><span data-ttu-id="3491d-367">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="3491d-367">Additional Resources</span></span>

<span data-ttu-id="3491d-368">Список эмуляторы мобильных устройств и симуляторов, можно использовать для тестирования мобильных веб-приложения ASP.NET, см. на странице [имитация популярных мобильных устройств для тестирования](../mobile/device-simulators.md).</span><span class="sxs-lookup"><span data-stu-id="3491d-368">For a list of mobile device emulators and simulators you can use to test your mobile ASP.NET web application, see the page [Simulate popular mobile devices for testing](../mobile/device-simulators.md).</span></span>

## <a name="credits"></a><span data-ttu-id="3491d-369">Благодарности</span><span class="sxs-lookup"><span data-stu-id="3491d-369">Credits</span></span>

- <span data-ttu-id="3491d-370">Основным автором: Стивен Сандерсон</span><span class="sxs-lookup"><span data-stu-id="3491d-370">Primary author: Steven Sanderson</span></span>
- <span data-ttu-id="3491d-371">Рецензенты / дополнительных модулей записи содержимого: Джеймс Rosewell, Майкл Söderström, (Scott hanselman), Скотт Хантер</span><span class="sxs-lookup"><span data-stu-id="3491d-371">Reviewers / additional content writers: James Rosewell, Mikael Söderström, Scott Hanselman, Scott Hunter</span></span>
