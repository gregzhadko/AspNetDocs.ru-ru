---
uid: whitepapers/add-mobile-pages-to-your-aspnet-web-forms-mvc-application
title: Как добавить мобильные страницы в веб-формы ASP.NET или приложение MVC | Документация Майкрософт
author: rick-anderson
description: В этом разделе описываются различные способы обслуживания страниц, оптимизированных для мобильных устройств, из веб-форм ASP.NET и приложения MVC и предлагаются архитектурные и...
ms.author: riande
ms.date: 01/20/2011
ms.assetid: 3124f28e-cc32-418a-afe3-519fa56f4c36
msc.legacyurl: /whitepapers/add-mobile-pages-to-your-aspnet-web-forms-mvc-application
msc.type: content
ms.openlocfilehash: 63c555358d06a9506bb5c8c993800c3307108192
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78462216"
---
# <a name="how-to-add-mobile-pages-to-your-aspnet-web-forms--mvc-application"></a><span data-ttu-id="798c1-103">Как добавить мобильные страницы в веб-формы ASP.NET или приложение MVC</span><span class="sxs-lookup"><span data-stu-id="798c1-103">How To: Add Mobile Pages to Your ASP.NET Web Forms / MVC Application</span></span>

> <span data-ttu-id="798c1-104">**Применимо к**</span><span class="sxs-lookup"><span data-stu-id="798c1-104">**Applies To**</span></span>
> 
> - <span data-ttu-id="798c1-105">Веб-формы ASP.NET версии 4,0</span><span class="sxs-lookup"><span data-stu-id="798c1-105">ASP.NET Web Forms version 4.0</span></span>
> - <span data-ttu-id="798c1-106">ASP.NET MVC версии 3,0</span><span class="sxs-lookup"><span data-stu-id="798c1-106">ASP.NET MVC version 3.0</span></span>
> 
> <span data-ttu-id="798c1-107">**Сводка**</span><span class="sxs-lookup"><span data-stu-id="798c1-107">**Summary**</span></span>
> 
> <span data-ttu-id="798c1-108">В этом разделе описываются различные способы обслуживания страниц, оптимизированных для мобильных устройств, из веб-форм ASP.NET и приложения MVC, а затем рассматриваются вопросы архитектуры и проектирования, которые следует учитывать при нацеливании на широкий спектр устройств.</span><span class="sxs-lookup"><span data-stu-id="798c1-108">This How To describes various ways to serve pages optimized for mobile devices from your ASP.NET Web Forms / MVC application, and suggests architectural and design issues to consider when targeting a broad range of devices.</span></span> <span data-ttu-id="798c1-109">В этом документе также объясняется, почему ASP.NET мобильные элементы управления от ASP.NET 2,0 до 3,5 теперь устарели и обсуждаются некоторые современные альтернативы.</span><span class="sxs-lookup"><span data-stu-id="798c1-109">This document also explains why the ASP.NET Mobile Controls from ASP.NET 2.0 to 3.5 are now obsolete, and discusses some modern alternatives.</span></span>

## <a name="contents"></a><span data-ttu-id="798c1-110">Содержимое</span><span class="sxs-lookup"><span data-stu-id="798c1-110">Contents</span></span>

- <span data-ttu-id="798c1-111">Обзор</span><span class="sxs-lookup"><span data-stu-id="798c1-111">Overview</span></span>
- <span data-ttu-id="798c1-112">Параметры архитектуры</span><span class="sxs-lookup"><span data-stu-id="798c1-112">Architectural options</span></span>
- <span data-ttu-id="798c1-113">Обнаружение браузеров и устройств</span><span class="sxs-lookup"><span data-stu-id="798c1-113">Browser and device detection</span></span>
- <span data-ttu-id="798c1-114">Как приложения веб-форм ASP.NET могут представлять страницы для мобильных устройств</span><span class="sxs-lookup"><span data-stu-id="798c1-114">How ASP.NET Web Forms applications can present mobile-specific pages</span></span>
- <span data-ttu-id="798c1-115">Как приложения ASP.NET MVC могут представлять страницы для мобильных устройств</span><span class="sxs-lookup"><span data-stu-id="798c1-115">How ASP.NET MVC applications can present mobile-specific pages</span></span>
- <span data-ttu-id="798c1-116">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="798c1-116">Additional resources</span></span>

<span data-ttu-id="798c1-117">Примеры кода для загрузки, демонстрирующие методы ASP.NET Web Forms и MVC, см. в статье [мобильные приложения & сайтах с ASP.NET](https://docs.microsoft.com/aspnet/mobile/overview).</span><span class="sxs-lookup"><span data-stu-id="798c1-117">For downloadable code samples demonstrating this white paper's techniques for both ASP.NET Web Forms and MVC, see [Mobile Apps & Sites with ASP.NET](https://docs.microsoft.com/aspnet/mobile/overview).</span></span>

## <a name="overview"></a><span data-ttu-id="798c1-118">Обзор</span><span class="sxs-lookup"><span data-stu-id="798c1-118">Overview</span></span>

<span data-ttu-id="798c1-119">Мобильные устройства — смартфоны, телефоны функций и планшеты — продолжают расти популярность как средства для доступа в Интернет.</span><span class="sxs-lookup"><span data-stu-id="798c1-119">Mobile devices – smartphones, feature phones, and tablets – continue to grow in popularity as a means to access the Web.</span></span> <span data-ttu-id="798c1-120">Для многих веб-разработчиков и веб-компаний это означает, что все больше важно обеспечить удобную работу с посетителями для посетителей, использующих эти устройства.</span><span class="sxs-lookup"><span data-stu-id="798c1-120">For many web developers and web-oriented businesses, this means it's increasingly important to provide a great browsing experience for visitors using those devices.</span></span>

### <a name="how-earlier-versions-of-aspnet-supported-mobile-browsers"></a><span data-ttu-id="798c1-121">Как ранние версии ASP.NET поддерживали мобильные браузеры</span><span class="sxs-lookup"><span data-stu-id="798c1-121">How earlier versions of ASP.NET supported mobile browsers</span></span>

<span data-ttu-id="798c1-122">ASP.NET версии 2,0 – 3,5 включали *ASP.NET мобильные элементы управления*: набор серверных элементов управления для мобильных устройств в сборке *System. Web. Mobile. dll* и пространство имен *System. Web. UI. мобилеконтролс* .</span><span class="sxs-lookup"><span data-stu-id="798c1-122">ASP.NET versions 2.0 to 3.5 included *ASP.NET Mobile Controls*: a set of server controls for mobile devices in the *System.Web.Mobile.dll* assembly and the *System.Web.UI.MobileControls* namespace.</span></span> <span data-ttu-id="798c1-123">Сборка по-прежнему включается в ASP.NET 4, но не рекомендуется.</span><span class="sxs-lookup"><span data-stu-id="798c1-123">The assembly is still included in ASP.NET 4, but it is deprecated.</span></span> <span data-ttu-id="798c1-124">Разработчикам рекомендуется перейти на более современные подходы, например, описанные в этом документе.</span><span class="sxs-lookup"><span data-stu-id="798c1-124">Developers are advised to migrate to more modern approaches, such as those described in this paper.</span></span>

<span data-ttu-id="798c1-125">Причина, по которой ASP.NET мобильные элементы управления помечена как устаревшая, заключается в том, что их дизайн ориентирован на мобильные телефоны, которые были общими около 2005 и более ранних версий.</span><span class="sxs-lookup"><span data-stu-id="798c1-125">The reason why ASP.NET Mobile Controls have been marked as obsolete is that their design is oriented around the mobile phones that were common around 2005 and earlier.</span></span> <span data-ttu-id="798c1-126">Элементы управления в основном предназначены для отображения разметки WML или cHTML (вместо обычного HTML) для браузеров WAP этой эры.</span><span class="sxs-lookup"><span data-stu-id="798c1-126">The controls are mainly designed to render WML or cHTML markup (instead of regular HTML) for the WAP browsers of that era.</span></span> <span data-ttu-id="798c1-127">Но WAP, WML и cHTML больше не важны для большинства проектов, поскольку HTML теперь стал повсеместным языком разметки для мобильных и настольных браузеров.</span><span class="sxs-lookup"><span data-stu-id="798c1-127">But WAP, WML, and cHTML are no longer relevant for most projects, because HTML has now become the ubiquitous markup language for mobile and desktop browsers alike.</span></span>

### <a name="the-challenges-of-supporting-mobile-devices-today"></a><span data-ttu-id="798c1-128">Проблемы, связанные с поддержкой мобильных устройств сегодня</span><span class="sxs-lookup"><span data-stu-id="798c1-128">The challenges of supporting mobile devices today</span></span>

<span data-ttu-id="798c1-129">Несмотря на то, что мобильные браузеры в настоящее время поддерживают HTML, вы по-прежнему сталкиваетесь с множеством проблем, когда надежде для создания привлекательных возможностей мобильного обзора:</span><span class="sxs-lookup"><span data-stu-id="798c1-129">Even though mobile browsers now almost universally support HTML, you will still face many challenges when aiming to create great mobile browsing experiences:</span></span>

- <span data-ttu-id="798c1-130">***Размер экрана*** — мобильные устройства значительно отличаются в форме, и их экраны зачастую намного меньше, чем мониторы настольных систем.</span><span class="sxs-lookup"><span data-stu-id="798c1-130">***Screen size*** - Mobile devices vary dramatically in form, and their screens are often much smaller than desktop monitors.</span></span> <span data-ttu-id="798c1-131">Поэтому для них может потребоваться разработать совершенно разные макеты страниц.</span><span class="sxs-lookup"><span data-stu-id="798c1-131">So, you may need to design completely different page layouts for them.</span></span>
- <span data-ttu-id="798c1-132">***Методы ввода*** — на некоторых устройствах есть клавиатуры, некоторые из которых имеют свои планшеты, другие используют сенсорный ввод.</span><span class="sxs-lookup"><span data-stu-id="798c1-132">***Input methods*** – Some devices have keypads, some have styluses, others use touch.</span></span> <span data-ttu-id="798c1-133">Может потребоваться рассмотреть несколько механизмов навигации и методов ввода данных.</span><span class="sxs-lookup"><span data-stu-id="798c1-133">You may need to consider multiple navigation mechanisms and data input methods.</span></span>
- <span data-ttu-id="798c1-134">***Соответствие стандартам*** — многие мобильные браузеры не поддерживают новейшие стандарты HTML, CSS или JavaScript.</span><span class="sxs-lookup"><span data-stu-id="798c1-134">***Standards compliance*** – Many mobile browsers do not support the latest HTML, CSS, or JavaScript standards.</span></span>
- <span data-ttu-id="798c1-135">***Пропускная способность*** — производительность сети сотовой связи меняется, а некоторые конечные пользователи — в тариффс, которые взимается по мегабайтам.</span><span class="sxs-lookup"><span data-stu-id="798c1-135">***Bandwidth*** – Cellular data network performance varies wildly, and some end users are on tariffs that charge by the megabyte.</span></span>

<span data-ttu-id="798c1-136">Такого решения нет ни для одного размера. приложение будет работать по-разному в соответствии с устройством, осуществляющим доступ к нему.</span><span class="sxs-lookup"><span data-stu-id="798c1-136">There's no one-size-fits-all solution; your application will have to look and behave differently according to the device accessing it.</span></span> <span data-ttu-id="798c1-137">В зависимости от того, какой уровень мобильной поддержки вам нужен, это может быть более сложной задачей для веб-разработчиков, чем настольная «Browser Звездные».</span><span class="sxs-lookup"><span data-stu-id="798c1-137">Depending on what level of mobile support you want, this can be a bigger challenge for web developers than the desktop "browser wars" ever was.</span></span>

<span data-ttu-id="798c1-138">Разработчики, приближающиеся к поддержке мобильных браузеров в первый раз, часто считают, что это только важно для поддержки новейших и более сложных смартфонов (например, Windows Phone 7, iPhone или Android), возможно, из-за того, что разработчики часто владеют такими устройствах.</span><span class="sxs-lookup"><span data-stu-id="798c1-138">Developers approaching mobile browser support for the first time often initially think it's only important to support the latest and most sophisticated smartphones (e.g., Windows Phone 7, iPhone, or Android), perhaps because developers often personally own such devices.</span></span> <span data-ttu-id="798c1-139">Однако более низкие телефоны по-прежнему являются чрезвычайно популярными, и их владельцы используют их для просмотра Интернета, особенно в тех странах, где мобильные телефоны проще, чем высокоскоростное подключение.</span><span class="sxs-lookup"><span data-stu-id="798c1-139">However, cheaper phones are still extremely popular, and their owners do use them to browse the web – especially in countries where mobile phones are easier to get than a broadband connection.</span></span> <span data-ttu-id="798c1-140">Вашему бизнесу необходимо решить, какой диапазон устройств следует поддерживать, с учетом наиболее вероятных клиентов.</span><span class="sxs-lookup"><span data-stu-id="798c1-140">Your business will need to decide what range of devices to support by considering its likely customers.</span></span> <span data-ttu-id="798c1-141">Если вы создаете Интернет-буклет для проверки работоспособности люкс, вы можете принимать решение только для опытных смартфонов, а если вы создаете систему резервирования билетов для рекламы в кинотеатрах, вам, скорее всего, придется учитывать посетителей с менее мощными функциями. звонят.</span><span class="sxs-lookup"><span data-stu-id="798c1-141">If you're building an online brochure for a luxury health spa, you might make a business decision only to target advanced smartphones, whereas if you're creating a ticket booking system for a cinema, you probably need to account for visitors with less powerful feature phones.</span></span>

## <a name="architectural-options"></a><span data-ttu-id="798c1-142">Параметры архитектуры</span><span class="sxs-lookup"><span data-stu-id="798c1-142">Architectural options</span></span>

<span data-ttu-id="798c1-143">Прежде чем перейти к конкретным техническим деталям веб-форм ASP.NET или MVC, обратите внимание, что веб-разработчики в целом имеют три основных возможных варианта поддержки мобильных браузеров:</span><span class="sxs-lookup"><span data-stu-id="798c1-143">Before we get to the specific technical details of ASP.NET Web Forms or MVC, note that web developers in general have three main possible options for supporting mobile browsers:</span></span>

1. <span data-ttu-id="798c1-144">***Ничего не делать —*** Вы можете просто создать стандартное веб-приложение, ориентированное на настольное устройство, и использовать мобильные браузеры для его приемлемого отображения.</span><span class="sxs-lookup"><span data-stu-id="798c1-144">***Do nothing –*** You can simply create a standard, desktop-oriented web application, and rely on mobile browsers to render it acceptably.</span></span> 

    - <span data-ttu-id="798c1-145">**Преимущество**: это самый дешевый вариант для реализации и обслуживания – не дополнительная работа</span><span class="sxs-lookup"><span data-stu-id="798c1-145">**Advantage**: It's the cheapest option to implement and maintain – no extra work</span></span>
    - <span data-ttu-id="798c1-146">**Недостаток**: обеспечивает наихудшие возможности для конечных пользователей:</span><span class="sxs-lookup"><span data-stu-id="798c1-146">**Disadvantage**: Gives the worst end-user experience:</span></span> 

        - <span data-ttu-id="798c1-147">Последние смартфоны могут визуализировать код HTML так же, как и браузер настольных систем, но для использования содержимого на маленьком экране пользователи по-прежнему будут вынуждены изменять масштаб и прокручивать горизонтально и вертикально.</span><span class="sxs-lookup"><span data-stu-id="798c1-147">The latest smartphones may render your HTML just as well as a desktop browser, but users will still be forced to zoom and scroll horizontally and vertically to consume your content on a small screen.</span></span> <span data-ttu-id="798c1-148">Это далеко не оптимально.</span><span class="sxs-lookup"><span data-stu-id="798c1-148">This is far from optimal.</span></span>
        - <span data-ttu-id="798c1-149">Более старые устройства и телефоны функций могут не иметь удовлетворительной визуализации разметки.</span><span class="sxs-lookup"><span data-stu-id="798c1-149">Older devices and feature phones may fail to render your markup in a satisfactory way.</span></span>
        - <span data-ttu-id="798c1-150">Даже на последних планшетных устройствах (экраны которых могут быть как экраны ноутбуков), применяются различные правила взаимодействия.</span><span class="sxs-lookup"><span data-stu-id="798c1-150">Even on the latest tablet devices (whose screens can be as big as laptop screens), different interaction rules apply.</span></span> <span data-ttu-id="798c1-151">Ввод на основе сенсорного ввода лучше всего подходит для более масштабных кнопок и ссылок, и в этом случае не удается навести курсор мыши на всплывающее меню.</span><span class="sxs-lookup"><span data-stu-id="798c1-151">Touch-based input works best with larger buttons and links spread further apart, and there's no way to hover a mouse cursor over a fly-out menu.</span></span>
2. <span data-ttu-id="798c1-152">***Решение проблемы на клиенте* —** с помощью тщательного использования CSS и [последовательного расширения](http://en.wikipedia.org/wiki/Progressive_enhancement) можно создавать разметку, стили и сценарии, которые адаптируются к любому браузеру.</span><span class="sxs-lookup"><span data-stu-id="798c1-152">***Solve the problem on the client* –** With careful use of CSS and [progressive enhancement](http://en.wikipedia.org/wiki/Progressive_enhancement) you can create markup, styles, and scripts that adapt to whatever browser is running them.</span></span> <span data-ttu-id="798c1-153">Например, при использовании [запросов мультимедиа CSS 3](http://www.w3.org/TR/2010/CR-css3-mediaqueries-20100727/)можно создать макет с несколькими столбцами, который преобразуется в один столбец на устройствах, экраны которых будут узким, чем выбранное пороговое значение.</span><span class="sxs-lookup"><span data-stu-id="798c1-153">For example, with [CSS 3 media queries](http://www.w3.org/TR/2010/CR-css3-mediaqueries-20100727/), you could create a multi-column layout that turns into a single column layout on devices whose screens are narrower than a chosen threshold.</span></span> 

    - <span data-ttu-id="798c1-154">**Преимущество**: оптимизирует отрисовку для конкретного используемого устройства, даже для неизвестных будущих устройств в зависимости от того, какие характеристики экрана и входных данных они имеют.</span><span class="sxs-lookup"><span data-stu-id="798c1-154">**Advantage**: Optimizes rendering for the specific device in use, even for unknown future devices according to whatever screen and input characteristics they have</span></span>
    - <span data-ttu-id="798c1-155">**Преимущество**. простое позволяет совместно использовать логику на стороне сервера для всех типов устройств — минимальное дублирование кода или усилий</span><span class="sxs-lookup"><span data-stu-id="798c1-155">**Advantage**: Easily lets you share server-side logic across all device types – minimal duplication of code or effort</span></span>
    - <span data-ttu-id="798c1-156">**Недостаток**: мобильные устройства так отличаются от настольных устройств, на которых вы действительно хотите, чтобы мобильные страницы полностью отличались от страниц настольных ПК, отображая разные сведения.</span><span class="sxs-lookup"><span data-stu-id="798c1-156">**Disadvantage**: Mobile devices are so different from desktop devices that you may really want your mobile pages to be completely different from your desktop pages, showing different information.</span></span> <span data-ttu-id="798c1-157">Такие вариации могут быть неэффективными или невозможными для обеспечения надежности только с помощью CSS, особенно учитывая, как несогласованные старые устройства преобразуют правила CSS.</span><span class="sxs-lookup"><span data-stu-id="798c1-157">Such variations can be inefficient or impossible to achieve robustly through CSS alone, especially considering how inconsistently older devices interpret CSS rules.</span></span> <span data-ttu-id="798c1-158">Это особенно справедливо для атрибутов CSS 3.</span><span class="sxs-lookup"><span data-stu-id="798c1-158">This is particularly true of CSS 3 attributes.</span></span>
    - <span data-ttu-id="798c1-159">**Недостаток**: не поддерживает различные серверные логики и рабочие процессы для различных устройств.</span><span class="sxs-lookup"><span data-stu-id="798c1-159">**Disadvantage**: Provides no support for varying server-side logic and workflows for different devices.</span></span> <span data-ttu-id="798c1-160">Вы не можете, например, реализовать упрощенный рабочий процесс извлечения корзины для мобильных пользователей с помощью только CSS.</span><span class="sxs-lookup"><span data-stu-id="798c1-160">You can't, for example, implement a simplified shopping cart checkout workflow for mobile users by means of CSS alone.</span></span>
    - <span data-ttu-id="798c1-161">**Недостаток**: использование неэффективного пропускной способности.</span><span class="sxs-lookup"><span data-stu-id="798c1-161">**Disadvantage**: Inefficient bandwidth use.</span></span> <span data-ttu-id="798c1-162">Возможно, сервер должен передать разметку и стили, которые применяются ко всем возможным устройствам, даже если целевое устройство будет использовать только подмножество этих сведений.</span><span class="sxs-lookup"><span data-stu-id="798c1-162">You server may have to transmit the markup and styles that apply to all possible devices, even though the target device will only use a subset of that information.</span></span>
3. <span data-ttu-id="798c1-163">***Устраните проблему на сервере* —** Если сервер знает, какое устройство обращается к нему, или по крайней мере характеристики этого устройства, такие как размер экрана и метод ввода, а также является ли оно мобильным устройством, оно может запускать другую логику и выводить другую разметку HTML.</span><span class="sxs-lookup"><span data-stu-id="798c1-163">***Solve the problem on the server* –** If your server knows what device is accessing it – or at least the characteristics of that device, such as its screen size and input method, and whether it's a mobile device – it can run different logic and output different HTML markup.</span></span> 

    - <span data-ttu-id="798c1-164">**Преимущества:** Максимальная гибкость.</span><span class="sxs-lookup"><span data-stu-id="798c1-164">**Advantage:** Maximum flexibility.</span></span> <span data-ttu-id="798c1-165">Не существует ограничений на то, сколько можно изменить логику на стороне сервера для мобильных устройств, или оптимизировать разметку для нужной структуры конкретного устройства.</span><span class="sxs-lookup"><span data-stu-id="798c1-165">There's no limit to how much you can vary your server-side logic for mobiles or optimize your markup for the desired, device-specific layout.</span></span>
    - <span data-ttu-id="798c1-166">**Преимущества:** Эффективное использование пропускной способности.</span><span class="sxs-lookup"><span data-stu-id="798c1-166">**Advantage:** Efficient bandwidth use.</span></span> <span data-ttu-id="798c1-167">Необходимо передать только сведения о разметке и стилизации, которые будет использовать целевое устройство.</span><span class="sxs-lookup"><span data-stu-id="798c1-167">You only need to transmit the markup and styling information that the target device is going to use.</span></span>
    - <span data-ttu-id="798c1-168">**Недостаток:** Иногда выполняет принудительное повторение усилий или кода (например, создание похожих, но слегка отличающихся копий страниц веб-форм или представлений MVC).</span><span class="sxs-lookup"><span data-stu-id="798c1-168">**Disadvantage:** Sometimes forces repetition of effort or code (e.g., making you create similar but slightly different copies of your Web Forms pages or MVC views).</span></span> <span data-ttu-id="798c1-169">Там, где это возможно, вы выберете общую логику в базовый слой или службу, но все же может потребоваться дублировать некоторые части кода пользовательского интерфейса или разметки, а затем поддерживаться параллельно.</span><span class="sxs-lookup"><span data-stu-id="798c1-169">Where possible you will factor out common logic into an underlying layer or service, but still, some parts of your UI code or markup may have to be duplicated and then maintained in parallel.</span></span>
    - <span data-ttu-id="798c1-170">**Недостаток:** Обнаружение устройств не является тривиальным.</span><span class="sxs-lookup"><span data-stu-id="798c1-170">**Disadvantage:** Device detection is not trivial.</span></span> <span data-ttu-id="798c1-171">Для этого требуется список или база данных известных типов устройств и их характеристики (которые могут не всегда быть актуальными) и не гарантировано точно соответствуют всем входящим запросам.</span><span class="sxs-lookup"><span data-stu-id="798c1-171">It requires a list or database of known device types and their characteristics (which may not always be perfectly up-to-date) and isn't guaranteed to accurately match every incoming request.</span></span> <span data-ttu-id="798c1-172">В этом документе описаны некоторые параметры и их ошибки.</span><span class="sxs-lookup"><span data-stu-id="798c1-172">This document describes some options and their pitfalls later.</span></span>

<span data-ttu-id="798c1-173">Чтобы получить лучшие результаты, большинство разработчиков найдут, что им нужно объединить параметры (2) и (3).</span><span class="sxs-lookup"><span data-stu-id="798c1-173">To get the best results, most developers find they need to combine options (2) and (3).</span></span> <span data-ttu-id="798c1-174">Небольшие стилистические различия лучше всего подходят для клиента с помощью CSS или даже JavaScript, тогда как основные различия в данных, рабочем процессе или разметке наиболее эффективно реализуются в коде на стороне сервера.</span><span class="sxs-lookup"><span data-stu-id="798c1-174">Minor stylistic differences are best accommodated on the client using CSS or even JavaScript, whereas major differences in data, workflow, or markup are most effectively implemented in server-side code.</span></span>

### <a name="this-paper-focuses-on-server-side-techniques"></a><span data-ttu-id="798c1-175">Эта статья посвящена методам на стороне сервера</span><span class="sxs-lookup"><span data-stu-id="798c1-175">This paper focuses on server-side techniques</span></span>

<span data-ttu-id="798c1-176">Так как веб-формы ASP.NET и MVC являются главными серверными технологиями, в этом техническом документе основное внимание уделяется методам на стороне сервера, которые позволяют создавать различные разметки и логику для мобильных браузеров.</span><span class="sxs-lookup"><span data-stu-id="798c1-176">Since ASP.NET Web Forms and MVC are both primarily server-side technologies, this white paper will focus on server-side techniques that let you produce different markup and logic for mobile browsers.</span></span> <span data-ttu-id="798c1-177">Разумеется, это можно также сочетать с любой методикой на стороне клиента (например, запросы к носителю CSS 3, последовательное улучшение кода JavaScript), но это не так важно, как веб-проект, а не ASP.NETная разработка.</span><span class="sxs-lookup"><span data-stu-id="798c1-177">Of course, you can also combine this with any client-side technique (e.g., CSS 3 media queries, progressive-enhancement JavaScript), but that's more a matter of web design than ASP.NET development.</span></span>

## <a name="browser-and-device-detection"></a><span data-ttu-id="798c1-178">Обнаружение браузеров и устройств</span><span class="sxs-lookup"><span data-stu-id="798c1-178">Browser and device detection</span></span>

<span data-ttu-id="798c1-179">Ключевым условием для всех серверных методов для поддержки мобильных устройств является знание того, какое устройство использует посетитель.</span><span class="sxs-lookup"><span data-stu-id="798c1-179">The key prerequisite for all server-side techniques for supporting mobile devices is to know what device your visitor is using.</span></span> <span data-ttu-id="798c1-180">На самом деле, даже лучше, чем знать изготовителя и номер модели этого устройства, вы узнаете о *характеристиках* устройства.</span><span class="sxs-lookup"><span data-stu-id="798c1-180">In fact, even better than knowing the manufacturer and model number of that device is knowing the *characteristics* of the device.</span></span> <span data-ttu-id="798c1-181">Характеристики могут включать:</span><span class="sxs-lookup"><span data-stu-id="798c1-181">Characteristics may include:</span></span>

- <span data-ttu-id="798c1-182">Это мобильное устройство?</span><span class="sxs-lookup"><span data-stu-id="798c1-182">Is it a mobile device?</span></span>
- <span data-ttu-id="798c1-183">Метод ввода (мышь/клавиатура, касание, клавиатура, джойстик,...)</span><span class="sxs-lookup"><span data-stu-id="798c1-183">Input method (mouse/keyboard, touch, keypad, joystick, …)</span></span>
- <span data-ttu-id="798c1-184">Размер экрана (физически и в пикселях)</span><span class="sxs-lookup"><span data-stu-id="798c1-184">Screen size (physically and in pixels)</span></span>
- <span data-ttu-id="798c1-185">Поддерживаемые носители и форматы данных</span><span class="sxs-lookup"><span data-stu-id="798c1-185">Supported media and data formats</span></span>
- <span data-ttu-id="798c1-186">Прочее</span><span class="sxs-lookup"><span data-stu-id="798c1-186">Etc.</span></span>

<span data-ttu-id="798c1-187">Лучше принимать решения на основе характеристик, превышающих номер модели, так как тогда вы будете лучше поддерживать будущие устройства.</span><span class="sxs-lookup"><span data-stu-id="798c1-187">It's better to make decisions based on characteristics than model number, because then you'll be better equipped to handle future devices.</span></span>

### <a name="using-aspnets-built-in-browser-detection-support"></a><span data-ttu-id="798c1-188">Использование ASP. Встроенная поддержка обнаружения в браузере NET</span><span class="sxs-lookup"><span data-stu-id="798c1-188">Using ASP.NET's built-in browser detection support</span></span>

<span data-ttu-id="798c1-189">Веб-формы ASP.NET и разработчики MVC могут немедленно обнаружить важные характеристики посещаемого браузера, изучив свойства объекта *request. browser* .</span><span class="sxs-lookup"><span data-stu-id="798c1-189">ASP.NET Web Forms and MVC developers can immediately discover important characteristics of a visiting browser by inspecting properties of the *Request.Browser* object.</span></span> <span data-ttu-id="798c1-190">Например, см.</span><span class="sxs-lookup"><span data-stu-id="798c1-190">For example, see</span></span>

- <span data-ttu-id="798c1-191">Request. browser. Исмобиледевице</span><span class="sxs-lookup"><span data-stu-id="798c1-191">Request.Browser.IsMobileDevice</span></span>
- <span data-ttu-id="798c1-192">Request. browser. Мобиледевицемануфактурер, Request. browser. Мобиледевицемодел</span><span class="sxs-lookup"><span data-stu-id="798c1-192">Request.Browser.MobileDeviceManufacturer, Request.Browser.MobileDeviceModel</span></span>
- <span data-ttu-id="798c1-193">Request. browser. Скринпикселсвидс</span><span class="sxs-lookup"><span data-stu-id="798c1-193">Request.Browser.ScreenPixelsWidth</span></span>
- <span data-ttu-id="798c1-194">Request. browser. Суппортсксмлхттп</span><span class="sxs-lookup"><span data-stu-id="798c1-194">Request.Browser.SupportsXmlHttp</span></span>
- <span data-ttu-id="798c1-195">...и многие другие</span><span class="sxs-lookup"><span data-stu-id="798c1-195">…and many others</span></span>

<span data-ttu-id="798c1-196">В фоновом режиме платформа ASP.NET сопоставляет заголовок HTTP входящего *агента пользователя* (UA) с регулярными выражениями в наборе XML-файлов определения браузера.</span><span class="sxs-lookup"><span data-stu-id="798c1-196">Behind the scenes, the ASP.NET platform matches the incoming *User-Agent* (UA) HTTP header against regular expressions in a set of Browser Definition XML files.</span></span> <span data-ttu-id="798c1-197">По умолчанию платформа включает определения для многих распространенных мобильных устройств, и вы можете добавить пользовательские файлы определения браузера для других пользователей, которые вы хотите распознать.</span><span class="sxs-lookup"><span data-stu-id="798c1-197">By default the platform includes definitions for many common mobile devices, and you can add custom Browser Definition files for others you wish to recognize.</span></span> <span data-ttu-id="798c1-198">Дополнительные сведения см. в разделе [веб-серверные элементы управления и возможности браузера](https://msdn.microsoft.com/library/x3k2ssx2.aspx)на странице MSDN Page ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="798c1-198">For more details, see the MSDN page [ASP.NET Web Server Controls and Browser Capabilities](https://msdn.microsoft.com/library/x3k2ssx2.aspx).</span></span>

### <a name="using-the-wurfl-device-database-via-51degreesmobi-foundation"></a><span data-ttu-id="798c1-199">Использование базы данных устройств WURFL с помощью 51Degrees.mobi Foundation</span><span class="sxs-lookup"><span data-stu-id="798c1-199">Using the WURFL device database via 51Degrees.mobi Foundation</span></span>

<span data-ttu-id="798c1-200">Хотя ASP. Встроенная поддержка обнаружения в браузере NET будет достаточной для многих приложений, но в некоторых случаях может быть недостаточно.</span><span class="sxs-lookup"><span data-stu-id="798c1-200">While ASP.NET's built-in browser detection support will be sufficient for many applications, there are two main cases when it might not be enough:</span></span>

- <span data-ttu-id="798c1-201">Необходимо ***распознать последние устройства***(без создания файлов определения браузера для них вручную).</span><span class="sxs-lookup"><span data-stu-id="798c1-201">***You want to recognize the latest devices***(without manually creating Browser Definition files for them).</span></span> <span data-ttu-id="798c1-202">Обратите внимание, что файлы определения браузера .NET 4 неактуальны для распознавания Windows Phone 7, телефонов Android, мобильных браузеров Opera или Apple iPad.</span><span class="sxs-lookup"><span data-stu-id="798c1-202">Note that .NET 4's Browser Definition files are not recent enough to recognize Windows Phone 7, Android phones, Opera Mobile browsers, or Apple iPads.</span></span>
- <span data-ttu-id="798c1-203">***Требуются более подробные сведения о***возможностях устройств.</span><span class="sxs-lookup"><span data-stu-id="798c1-203">***You need more detailed information about device capabilities***.</span></span> <span data-ttu-id="798c1-204">Может потребоваться узнать о методе ввода устройства (например, о сенсорной клавиатуре VS) или о том, какие форматы звука поддерживает браузер.</span><span class="sxs-lookup"><span data-stu-id="798c1-204">You may need to know about a device's input method (e.g., touch vs keypad), or what audio formats the browser supports.</span></span> <span data-ttu-id="798c1-205">Эта информация недоступна в стандартных файлах определения браузера.</span><span class="sxs-lookup"><span data-stu-id="798c1-205">This information isn't available in the standard Browser Definition files.</span></span>

<span data-ttu-id="798c1-206">Проект [ *беспроводного файла универсальных ресурсов* (WURFL)](http://wurfl.sourceforge.net/) поддерживает гораздо более актуальную и подробную информацию о мобильных устройствах, используемых сегодня.</span><span class="sxs-lookup"><span data-stu-id="798c1-206">The [*Wireless Universal Resource File* (WURFL) project](http://wurfl.sourceforge.net/) maintains much more up-to-date and detailed information about mobile devices in use today.</span></span>

<span data-ttu-id="798c1-207">Отличная новость для разработчиков .NET заключается в том, что ASP. Функция обнаружения обозревателя NET является расширяемой, поэтому ее можно усовершенствовать, чтобы преодолеть эти проблемы.</span><span class="sxs-lookup"><span data-stu-id="798c1-207">The great news for .NET developers is that ASP.NET's browser detection feature is extensible, so it's possible to enhance it to overcome these problems.</span></span> <span data-ttu-id="798c1-208">Например, можно добавить в проект библиотеку [*51Degrees.mobi Foundation*](https://github.com/51Degrees/dotNET-Device-Detection) с открытым кодом.</span><span class="sxs-lookup"><span data-stu-id="798c1-208">For example, you can add the open source [*51Degrees.mobi Foundation*](https://github.com/51Degrees/dotNET-Device-Detection) library to your project.</span></span> <span data-ttu-id="798c1-209">Это ASP.NET интерфейс IHttpModule или поставщик возможностей браузера (который можно использовать как в веб-формах, так и в приложениях MVC), который напрямую считывает данные WURFL и привязывает их к ASP. Встроенный механизм обнаружения в браузере NET.</span><span class="sxs-lookup"><span data-stu-id="798c1-209">It's an ASP.NET IHttpModule or Browser Capabilities Provider (usable on both Web Forms and MVC applications), that directly reads WURFL data and hooks it into ASP.NET's built-in browser detection mechanism.</span></span> <span data-ttu-id="798c1-210">После установки модуля *запрос. браузер* внезапно будет содержать гораздо более точную и подробную информацию: он будет правильно распознать многие из упомянутых ранее устройств и составить список их возможностей (включая дополнительные возможности, такие как метод ввода).</span><span class="sxs-lookup"><span data-stu-id="798c1-210">Once you've installed the module, *Request.Browser* will suddenly contain a lot more accurate and detailed information: it will correctly recognize many of the devices previously mentioned and list their capabilities (including additional capabilities such as input method).</span></span> <span data-ttu-id="798c1-211">Дополнительные сведения см. в документации по проекту.</span><span class="sxs-lookup"><span data-stu-id="798c1-211">See the project's documentation for more details.</span></span>

## <a name="how-web-forms-applications-can-present-mobile-specific-pages"></a><span data-ttu-id="798c1-212">Как приложения Web Forms могут представлять страницы для мобильных устройств</span><span class="sxs-lookup"><span data-stu-id="798c1-212">How Web Forms applications can present mobile-specific pages</span></span>

<span data-ttu-id="798c1-213">По умолчанию здесь показано, как новое приложение Web Forms отображается на общих мобильных устройствах:</span><span class="sxs-lookup"><span data-stu-id="798c1-213">By default, here's how a brand new Web Forms application displays on common mobile devices:</span></span>

![](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/_static/image1.png)

<span data-ttu-id="798c1-214">Очевидно, что ни одна из макетов не выглядит очень удобной для мобильных устройств. Эта страница предназначена для крупных, альбомных, ориентированных на страницы мониторов, а не для небольших дисплеев.</span><span class="sxs-lookup"><span data-stu-id="798c1-214">Clearly, neither layout looks very mobile-friendly – this page was designed for a large, landscape-oriented monitor, not for a small portrait-oriented screen.</span></span> <span data-ttu-id="798c1-215">Итак, что же можно сделать?</span><span class="sxs-lookup"><span data-stu-id="798c1-215">So what can you do about it?</span></span>

<span data-ttu-id="798c1-216">Как обсуждалось ранее в этом документе, существует множество способов адаптации страниц к мобильным устройствам.</span><span class="sxs-lookup"><span data-stu-id="798c1-216">As discussed earlier in this paper, there are many ways to tailor your pages for mobile devices.</span></span> <span data-ttu-id="798c1-217">Некоторые методы основаны на сервере, другие работают на клиенте.</span><span class="sxs-lookup"><span data-stu-id="798c1-217">Some techniques are server-based, others run on the client.</span></span>

### <a name="creating-a-mobile-specific-master-page"></a><span data-ttu-id="798c1-218">Создание главной страницы для мобильных устройств</span><span class="sxs-lookup"><span data-stu-id="798c1-218">Creating a mobile-specific master page</span></span>

<span data-ttu-id="798c1-219">В зависимости от требований вы можете использовать одни и те же веб-формы для всех посетителей, но две отдельные главные страницы: одна для посетителей настольных систем, другая для посетителей мобильных устройств.</span><span class="sxs-lookup"><span data-stu-id="798c1-219">Depending on your requirements, you may be able to use the same Web Forms for all visitors, but have two separate master pages: one for desktop visitors, another for mobile visitors.</span></span> <span data-ttu-id="798c1-220">Это обеспечивает гибкость изменения таблицы стилей CSS или разметки HTML верхнего уровня в соответствии с мобильными устройствами, не требуя дублирования какой-либо логики страницы.</span><span class="sxs-lookup"><span data-stu-id="798c1-220">This gives you the flexibility of changing the CSS stylesheet or your top-level HTML markup to suit mobile devices, without forcing you to duplicate any page logic.</span></span>

<span data-ttu-id="798c1-221">Это легко сделать.</span><span class="sxs-lookup"><span data-stu-id="798c1-221">This is easy to do.</span></span> <span data-ttu-id="798c1-222">Например, можно добавить обработчик инициализации, такой как следующий, в веб-форму:</span><span class="sxs-lookup"><span data-stu-id="798c1-222">For example, you can add a PreInit handler such as the following to a Web Form:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample1.cs)]

<span data-ttu-id="798c1-223">Теперь создайте главную страницу с именем Mobile. master в папке верхнего уровня приложения и будет использоваться при обнаружении мобильного устройства.</span><span class="sxs-lookup"><span data-stu-id="798c1-223">Now, create a master page called Mobile.Master in the top-level folder of your application, and it will be used when a mobile device is detected.</span></span> <span data-ttu-id="798c1-224">При необходимости Главная страница мобильной связи может ссылаться на таблицу стилей CSS, относящуюся к мобильному приложению.</span><span class="sxs-lookup"><span data-stu-id="798c1-224">Your mobile master page can reference a mobile-specific CSS stylesheet if necessary.</span></span> <span data-ttu-id="798c1-225">Посетители рабочего стола будут по-прежнему видеть главную страницу по умолчанию, а не мобильную.</span><span class="sxs-lookup"><span data-stu-id="798c1-225">Desktop visitors will still see your default master page, not the mobile one.</span></span>

### <a name="creating-independent-mobile-specific-web-forms"></a><span data-ttu-id="798c1-226">Создание независимых веб-форм для мобильных устройств</span><span class="sxs-lookup"><span data-stu-id="798c1-226">Creating independent mobile-specific Web Forms</span></span>

<span data-ttu-id="798c1-227">Для максимальной гибкости можно не только иметь отдельные главные страницы для различных типов устройств.</span><span class="sxs-lookup"><span data-stu-id="798c1-227">For maximum flexibility, you can go much further than just having separate master pages for different device types.</span></span> <span data-ttu-id="798c1-228">Можно реализовать два *совершенно отдельных набора страниц Web Forms* — один набор для браузеров настольных систем, другой набор для мобильных устройств.</span><span class="sxs-lookup"><span data-stu-id="798c1-228">You can implement two *totally separate sets of Web Forms pages* – one set for desktop browsers, another set for mobiles.</span></span> <span data-ttu-id="798c1-229">Это работает наилучшим образом, если вы хотите предоставить очень разные сведения или рабочие процессы мобильным посетителям.</span><span class="sxs-lookup"><span data-stu-id="798c1-229">This works best if you want to present very different information or workflows to mobile visitors.</span></span> <span data-ttu-id="798c1-230">В оставшейся части этого раздела подробно описывается этот подход.</span><span class="sxs-lookup"><span data-stu-id="798c1-230">The rest of this section describes this approach in detail.</span></span>

<span data-ttu-id="798c1-231">Если у вас уже есть приложение Web Forms, предназначенное для браузеров для настольных систем, проще всего создать вложенную папку с именем "Mobile" в проекте и создать на ней мобильные страницы.</span><span class="sxs-lookup"><span data-stu-id="798c1-231">Assuming you already have a Web Forms application designed for desktop browsers, the easiest way to proceed is to create a subfolder called "Mobile" within your project, and build your mobile pages there.</span></span> <span data-ttu-id="798c1-232">Вы можете создать весь дочерний сайт со своими собственными главными страницами, таблицами стилей и страницами, используя те же методы, что и для любого другого приложения веб-форм.</span><span class="sxs-lookup"><span data-stu-id="798c1-232">You can construct an entire sub-site, with its own master pages, style sheets, and pages, using all the same techniques that you'd use for any other Web Forms application.</span></span> <span data-ttu-id="798c1-233">Вам не обязательно создавать эквиваленты для мобильных устройств для *каждой* страницы на рабочем столе; можно выбрать, какое подмножество функций имеет смысл для посетителей мобильных устройств.</span><span class="sxs-lookup"><span data-stu-id="798c1-233">You don't necessarily need to produce a mobile equivalent for *every* page in your desktop site; you can choose what subset of functionality makes sense for mobile visitors.</span></span>

<span data-ttu-id="798c1-234">При желании ваши мобильные страницы могут совместно использовать общие статические ресурсы (например, изображения, JavaScript или файлы CSS) с обычными страницами.</span><span class="sxs-lookup"><span data-stu-id="798c1-234">Your mobile pages can share common static resources (such as images, JavaScript, or CSS files) with your regular pages if you wish.</span></span> <span data-ttu-id="798c1-235">Так как папка "Mobile" *не* будет помечена как отдельное приложение при размещении в службах IIS (это просто обычная вложенная папка страниц веб-форм), она также будет использовать ту же конфигурацию, данные сеанса и другую инфраструктуру как страницы рабочего стола.</span><span class="sxs-lookup"><span data-stu-id="798c1-235">Since your "Mobile" folder will *not* be marked as a separate application when hosted in IIS (it's just a simple subfolder of Web Forms pages), it will also share all the same configuration, Session data, and other infrastructure as your desktop pages.</span></span>

> [!NOTE]
> <span data-ttu-id="798c1-236">Так как этот подход обычно включает в себя некоторое дублирование кода (мобильные страницы, скорее всего, могут поделиться с страницами рабочего стола), важно разложить любую общую бизнес-логику или код доступа к данным в общий нижележащий слой или службу.</span><span class="sxs-lookup"><span data-stu-id="798c1-236">Since this approach usually involves some duplication of code (mobile pages are likely to share some similarities with desktop pages), it's important to factor out any common business logic or data access code into a shared underlying layer or service.</span></span> <span data-ttu-id="798c1-237">В противном случае Вы удваиваете усилия по созданию и обслуживанию приложения.</span><span class="sxs-lookup"><span data-stu-id="798c1-237">Otherwise, you'll double the effort of creating and maintaining your application.</span></span>

#### <a name="redirecting-mobile-visitors-to-your-mobile-pages"></a><span data-ttu-id="798c1-238">Перенаправление посетителей мобильных устройств на мобильные страницы</span><span class="sxs-lookup"><span data-stu-id="798c1-238">Redirecting mobile visitors to your mobile pages</span></span>

<span data-ttu-id="798c1-239">Часто бывает удобно перенаправить посетителей мобильных устройств на мобильные страницы только при *первом* запросе в сеансе обзора (а не при каждом запросе в сеансе), поскольку:</span><span class="sxs-lookup"><span data-stu-id="798c1-239">It's often convenient to redirect mobile visitors to the mobile pages only on the *first* request in their browsing session (and not on every request in their session), because:</span></span>

- <span data-ttu-id="798c1-240">После этого можно легко разрешить посетителям мобильных устройств доступ к страницам рабочего стола, если это нужно, просто поместив ссылку на главную страницу, которая переходит на версию Desktop.</span><span class="sxs-lookup"><span data-stu-id="798c1-240">You can then easily allow mobile visitors to access your desktop pages if they wish – just put a link on your master page that goes to "Desktop version".</span></span> <span data-ttu-id="798c1-241">Посетитель не будет перенаправлен обратно на мобильную страницу, так как он больше не является первым запросом в своем сеансе.</span><span class="sxs-lookup"><span data-stu-id="798c1-241">The visitor won't be redirected back to a mobile page, because it's no longer the first request in their session.</span></span>
- <span data-ttu-id="798c1-242">Это позволяет избежать риска противоречить запросам для любых динамических ресурсов, совместно используемых настольными и мобильными частями вашего сайта (например, при наличии общей веб-формы, которая настольной и мобильной части отображаются в IFRAME или определенных обработчиках AJAX).</span><span class="sxs-lookup"><span data-stu-id="798c1-242">It avoids the risk of interfering with requests for any dynamic resources shared between desktop and mobile parts of your site (e.g., if you have a common Web Form that both desktop and mobile parts of your site display in an IFRAME, or certain Ajax handlers)</span></span>

<span data-ttu-id="798c1-243">Для этого можно поместить логику перенаправления в **сеанс\_метод Start** .</span><span class="sxs-lookup"><span data-stu-id="798c1-243">To do this, you can place your redirection logic in a **Session\_Start** method.</span></span> <span data-ttu-id="798c1-244">Например, добавьте следующий метод в файл Global.asax.cs:</span><span class="sxs-lookup"><span data-stu-id="798c1-244">For example, add the following method to your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample2.cs)]

#### <a name="configuring-forms-authentication-to-respect-your-mobile-pages"></a><span data-ttu-id="798c1-245">Настройка проверки подлинности с помощью форм для соблюдения мобильных страниц</span><span class="sxs-lookup"><span data-stu-id="798c1-245">Configuring Forms Authentication to respect your mobile pages</span></span>

<span data-ttu-id="798c1-246">Обратите внимание, что проверка подлинности с помощью форм дает определенные предположения о том, где можно перенаправлять посетителей во время и после процесса проверки подлинности</span><span class="sxs-lookup"><span data-stu-id="798c1-246">Note that Forms Authentication makes certain assumptions about where it can redirect visitors during and after the authentication process:</span></span>

- <span data-ttu-id="798c1-247">Когда пользователь должен пройти проверку подлинности, аутентификация с помощью форм перенаправит их на страницу входа на Рабочий стол, независимо от того, является ли он настольным или мобильным пользователем (так как у него есть только *один* URL-адрес для входа).</span><span class="sxs-lookup"><span data-stu-id="798c1-247">When a user needs to be authenticated, Forms Authentication will redirect them to your desktop login page, regardless of whether they're a desktop or mobile user (because it only has a concept of *one* login URL).</span></span> <span data-ttu-id="798c1-248">Если вы хотите изменить стиль страницы входа в систему по-разному, необходимо улучшить страницу входа на Рабочий стол, чтобы она перенаправляла мобильные пользователи на отдельную мобильную страницу входа.</span><span class="sxs-lookup"><span data-stu-id="798c1-248">Assuming you want to style your mobile login page differently, you need to enhance your desktop login page so that it redirects mobile users to a separate mobile login page.</span></span> <span data-ttu-id="798c1-249">Например, добавьте следующий код на страницу с кодом программной части для входа на **Рабочий стол** :</span><span class="sxs-lookup"><span data-stu-id="798c1-249">For example, add the following code to your **desktop** login page code-behind:</span></span> 

    [!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample3.cs)]
- <span data-ttu-id="798c1-250">После успешного входа пользователя в систему проверка подлинности на формах будет по умолчанию перенаправлены на домашнюю страницу рабочего стола (так как в ней имеется только *одна* страница по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="798c1-250">After a user successfully logs in, Forms Authentication will by default redirect them to your desktop home page (because it only has a concept of *one* default page).</span></span> <span data-ttu-id="798c1-251">Необходимо расширить мобильную страницу входа, чтобы она перенаправлялась на домашнюю страницу мобильного устройства после успешного входа.</span><span class="sxs-lookup"><span data-stu-id="798c1-251">You need to enhance your mobile login page so that it redirects to the mobile home page after a successful log-in.</span></span> <span data-ttu-id="798c1-252">Например, добавьте следующий код на страницу с кодом программной части для **мобильного** входа:</span><span class="sxs-lookup"><span data-stu-id="798c1-252">For example, add the following code to your **mobile** login page code-behind:</span></span> 

    [!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample4.cs)]
  
  <span data-ttu-id="798c1-253">В этом коде предполагается, что на странице есть серверный элемент управления Login с именем Логинусер, как в шаблоне проекта по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="798c1-253">This code assumes your page has a Login server control called LoginUser, as in the default project template.</span></span>

### <a name="working-with-output-caching"></a><span data-ttu-id="798c1-254">Работа с кэшированием выходных данных</span><span class="sxs-lookup"><span data-stu-id="798c1-254">Working with Output Caching</span></span>

<span data-ttu-id="798c1-255">Если вы используете кэширование вывода, учтите, что по умолчанию пользователь настольной системы может посетить определенный URL-адрес (в результате чего его выходные данные будут кэшироваться), а затем — мобильный пользователь, который получит кэшированные выходные данные рабочего стола.</span><span class="sxs-lookup"><span data-stu-id="798c1-255">If you're using output caching, beware that by default it's possible for a desktop user to visit a certain URL (causing its output to be cached), followed by a mobile user who then receives the cached desktop output.</span></span> <span data-ttu-id="798c1-256">Это предупреждение относится к тому, что вы просто изменяли главную страницу по типу устройства или реализуете совершенно отдельные веб-формы для каждого типа устройства.</span><span class="sxs-lookup"><span data-stu-id="798c1-256">This warning applies whether you're just varying your master page by device type, or implementing totally separate Web Forms per device type.</span></span>

<span data-ttu-id="798c1-257">Чтобы избежать этой проблемы, можно указать ASP.NET изменять запись кэша в зависимости от того, использует ли посетитель мобильное устройство.</span><span class="sxs-lookup"><span data-stu-id="798c1-257">To avoid the problem, you can instruct ASP.NET to vary the cache entry according to whether the visitor is using a mobile device.</span></span> <span data-ttu-id="798c1-258">Добавьте параметр VaryByCustom в объявление OutputCache страницы следующим образом:</span><span class="sxs-lookup"><span data-stu-id="798c1-258">Add a VaryByCustom parameter to your page's OutputCache declaration as follows:</span></span>

[!code-aspx[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample5.aspx)]

<span data-ttu-id="798c1-259">Затем определите *исмобиледевице* в качестве настраиваемого параметра кэша, добавив следующее переопределение метода в файл Global.asax.cs:</span><span class="sxs-lookup"><span data-stu-id="798c1-259">Next, define *isMobileDevice* as a custom cache parameter by adding the following method override to your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample6.cs)]

<span data-ttu-id="798c1-260">Это обеспечит, чтобы посетители мобильных устройств не получали данные, ранее помещаемые в кэш посетителем рабочего стола.</span><span class="sxs-lookup"><span data-stu-id="798c1-260">This will ensure that mobile visitors to the page don't receive output previously put into the cache by a desktop visitor.</span></span>

### <a name="a-working-example"></a><span data-ttu-id="798c1-261">Рабочий пример</span><span class="sxs-lookup"><span data-stu-id="798c1-261">A working example</span></span>

<span data-ttu-id="798c1-262">Чтобы увидеть эти методы в действии, скачайте [примеры кода для этого технического документа](https://docs.microsoft.com/aspnet/mobile/overview).</span><span class="sxs-lookup"><span data-stu-id="798c1-262">To see these techniques in action, download [this white paper's code samples](https://docs.microsoft.com/aspnet/mobile/overview).</span></span> <span data-ttu-id="798c1-263">Пример приложения веб-форм автоматически перенаправляет пользователей мобильных устройств на набор страниц для мобильных устройств, находящийся в подпапке Mobile.</span><span class="sxs-lookup"><span data-stu-id="798c1-263">The Web Forms sample application automatically redirects mobile users to a set of mobile-specific pages in a subfolder called Mobile.</span></span> <span data-ttu-id="798c1-264">Разметка и стили этих страниц лучше оптимизированы для мобильных браузеров, как видно на следующих снимках экрана:</span><span class="sxs-lookup"><span data-stu-id="798c1-264">The markup and styling of those pages is better optimized for mobile browsers, as you can see from the following screenshots:</span></span>

![](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/_static/image2.png)

<span data-ttu-id="798c1-265">Дополнительные советы по оптимизации разметки и CSS для мобильных браузеров см. в подразделе «стилизация мобильных страниц для мобильных браузеров» далее в этом документе.</span><span class="sxs-lookup"><span data-stu-id="798c1-265">For more tips about optimizing your markup and CSS for mobile browsers, see the section "Styling mobile pages for mobile browsers" later in this document.</span></span>

## <a name="how-aspnet-mvc-applications-can-present-mobile-specific-pages"></a><span data-ttu-id="798c1-266">Как приложения ASP.NET MVC могут представлять страницы для мобильных устройств</span><span class="sxs-lookup"><span data-stu-id="798c1-266">How ASP.NET MVC applications can present mobile-specific pages</span></span>

<span data-ttu-id="798c1-267">Поскольку шаблон "модель-представление-контроллер" разделяет логику приложения (в контроллерах) от логики представления (в представлениях), можно выбрать любой из следующих подходов к обработке мобильной поддержки в коде на стороне сервера:</span><span class="sxs-lookup"><span data-stu-id="798c1-267">Since the Model-View-Controller pattern decouples application logic (in controllers) from presentation logic (in views), you can choose from any of the following approaches to handling mobile support in server-side code:</span></span>

1. <span data-ttu-id="798c1-268">\*\**использовать одни и те же контроллеры и представления для настольных и мобильных браузеров, но отображать представления с разными макетами Razor в зависимости от типа устройства *.**</span><span class="sxs-lookup"><span data-stu-id="798c1-268">\***Use the same controllers and views for both desktop and mobile browsers, but render the views with different Razor layouts depending on the device type\*.**</span></span> <span data-ttu-id="798c1-269">Этот вариант лучше всего подходит, если на всех устройствах отображаются идентичные данные, но просто требуется предоставить разные таблицы стилей CSS или изменить несколько элементов HTML верхнего уровня для мобильных устройств.</span><span class="sxs-lookup"><span data-stu-id="798c1-269">This option works best if you're displaying identical data on all devices, but simply want to supply different CSS stylesheets or change a few top-level HTML elements for mobiles.</span></span>
2. <span data-ttu-id="798c1-270">***Используйте одни и те же контроллеры для настольных и мобильных браузеров, но выводите различные представления в зависимости от типа устройства***.</span><span class="sxs-lookup"><span data-stu-id="798c1-270">***Use the same controllers for both desktop and mobile browsers, but render different views depending on the device type***.</span></span> <span data-ttu-id="798c1-271">Этот вариант работает лучше, если вы видите примерно те же данные и предоставляете те же рабочие процессы для конечных пользователей, но хотите, чтобы в соответствии с используемым устройством отображалась совершенно другая разметка HTML.</span><span class="sxs-lookup"><span data-stu-id="798c1-271">This option works best if you're displaying roughly the same data and providing the same workflows for end users, but want to render very different HTML markup to suit the device being used.</span></span>
3. <span data-ttu-id="798c1-272">\*\**создавать отдельные области для браузеров для настольных и мобильных устройств, реализовывать независимые контроллеры и представления для каждого *.**</span><span class="sxs-lookup"><span data-stu-id="798c1-272">\***Create separate areas for desktop and mobile browsers, implementing independent controllers and views for each\*.**</span></span> <span data-ttu-id="798c1-273">Этот вариант работает наилучшим образом, если отображаются очень разные экраны, содержащие различные сведения и ведущие пользователя через различные процессы, оптимизированные для их типа устройств.</span><span class="sxs-lookup"><span data-stu-id="798c1-273">This option works best if you're displaying very different screens, containing different information and leading the user through different workflows optimized for their device type.</span></span> <span data-ttu-id="798c1-274">Это может означать некоторое повторение кода, но его можно уменьшить, выполнив разложение общей логики в нижележащий слой или службу.</span><span class="sxs-lookup"><span data-stu-id="798c1-274">It may mean some repetition of code, but you can minimize that by factoring out common logic into an underlying layer or service.</span></span>

<span data-ttu-id="798c1-275">Если вы хотите использовать **первый** вариант и изменить только макет Razor для каждого типа устройства, это очень просто.</span><span class="sxs-lookup"><span data-stu-id="798c1-275">If you want to take the **first** option and vary only the Razor layout per device type, it's very easy.</span></span> <span data-ttu-id="798c1-276">Просто измените файл \_Виевстарт. cshtml следующим образом:</span><span class="sxs-lookup"><span data-stu-id="798c1-276">Just modify your \_ViewStart.cshtml file as follows:</span></span>

[!code-cshtml[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample7.cshtml)]

<span data-ttu-id="798c1-277">Теперь можно создать макет для мобильных устройств, именуемый \_Лайаутмобиле. cshtml со структурой страницы и правилами CSS, оптимизированными для мобильных устройств.</span><span class="sxs-lookup"><span data-stu-id="798c1-277">Now you can create a mobile-specific layout called \_LayoutMobile.cshtml with a page structure and CSS rules optimized for mobile devices.</span></span>

<span data-ttu-id="798c1-278">Если вы хотите, чтобы **второй** параметр отображался совершенно по-разному в соответствии с типом устройства посетителя, см. [запись блога Скотта Hanselman](http://www.hanselman.com/blog/ABetterASPNETMVCMobileDeviceCapabilitiesViewEngine.aspx).</span><span class="sxs-lookup"><span data-stu-id="798c1-278">If you want to take the **second** option render totally different views according to the visitor's device type, see [Scott Hanselman's blog post](http://www.hanselman.com/blog/ABetterASPNETMVCMobileDeviceCapabilitiesViewEngine.aspx).</span></span>

<span data-ttu-id="798c1-279">Оставшаяся часть статьи посвящена **третьему** варианту: создание отдельных контроллеров *и* представлений для мобильных устройств. Таким образом, вы можете контролировать, какое именно подмножество функций предлагается для мобильных посетителей.</span><span class="sxs-lookup"><span data-stu-id="798c1-279">The rest of this paper focuses on the **third** option – creating separate controllers *and* views for mobile devices – so you can control exactly what subset of functionality is offered for mobile visitors.</span></span>

### <a name="setting-up-a-mobile-area-within-your-aspnet-mvc-application"></a><span data-ttu-id="798c1-280">Настройка мобильной области в приложении ASP.NET MVC</span><span class="sxs-lookup"><span data-stu-id="798c1-280">Setting up a Mobile area within your ASP.NET MVC application</span></span>

<span data-ttu-id="798c1-281">Можно добавить область с именем "Mobile" в существующее приложение ASP.NET MVC обычным образом: щелкните правой кнопкой мыши имя проекта в обозреватель решений, а затем выберите Добавить продажам область.</span><span class="sxs-lookup"><span data-stu-id="798c1-281">You can add an area called "Mobile" to an existing ASP.NET MVC application in the normal way: right-click on your project name in Solution Explorer, then choose Add à Area.</span></span> <span data-ttu-id="798c1-282">Затем можно добавить контроллеры и представления, как и для любой другой области в приложении ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="798c1-282">You can then add controllers and views as you would for any other area within an ASP.NET MVC application.</span></span> <span data-ttu-id="798c1-283">Например, добавьте в мобильную область новый контроллер с именем HomeController, который будет использоваться в качестве домашней страницы для посетителей мобильных устройств.</span><span class="sxs-lookup"><span data-stu-id="798c1-283">For example, add to your Mobile area a new controller called HomeController to act as a homepage for mobile visitors.</span></span>

### <a name="ensuring-the-url-mobile-reaches-the-mobile-homepage"></a><span data-ttu-id="798c1-284">Обеспечение того, что URL-адрес/Мобиле достиг домашней страницы мобильного устройства</span><span class="sxs-lookup"><span data-stu-id="798c1-284">Ensuring the URL /Mobile reaches the mobile homepage</span></span>

<span data-ttu-id="798c1-285">Если вы хотите, чтобы URL-адрес/Мобиле к действию индекса в HomeController в вашей мобильной области, необходимо внести два небольших изменения в конфигурацию маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="798c1-285">If you want the URL /Mobile to reach the Index action on HomeController inside your Mobile area, you will need to make two small changes to your routing configuration.</span></span> <span data-ttu-id="798c1-286">Сначала обновите класс Мобилеареарегистратион, чтобы HomeController был контроллером по умолчанию в вашей мобильной области, как показано в следующем коде:</span><span class="sxs-lookup"><span data-stu-id="798c1-286">First, update your MobileAreaRegistration class so that HomeController is the default controller in your Mobile area, as shown in the following code:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample8.cs)]

<span data-ttu-id="798c1-287">Это означает, что домашняя страница мобильного устройства теперь находится по адресу/Мобиле, а не/Мобиле/Хоме, так как "Home" теперь является неявным именем контроллера по умолчанию для мобильных страниц.</span><span class="sxs-lookup"><span data-stu-id="798c1-287">This means the mobile homepage will now be located at /Mobile, rather than /Mobile/Home, because "Home" is now the implicitly default controller name for mobile pages.</span></span>

<span data-ttu-id="798c1-288">Обратите внимание, что, добавив второй HomeController в приложение (т. е. мобильное устройство, в дополнение к существующему рабочему столу), вы перейдете к обычной домашней странице рабочего стола.</span><span class="sxs-lookup"><span data-stu-id="798c1-288">Next, note that by adding a second HomeController to your application (i.e., the mobile one, in addition to the existing desktop one), you'll have broken your regular desktop homepage.</span></span> <span data-ttu-id="798c1-289">Она завершится ошибкой "*обнаружено несколько типов, соответствующих контроллеру с именем" Home "* .</span><span class="sxs-lookup"><span data-stu-id="798c1-289">It will fail with the error "*Multiple types were found that match the controller named 'Home'*".</span></span> <span data-ttu-id="798c1-290">Чтобы устранить эту проблему, обновите конфигурацию маршрутизации верхнего уровня (в Global.asax.cs), чтобы указать, что рабочий стол HomeController должен иметь приоритет при неоднозначности:</span><span class="sxs-lookup"><span data-stu-id="798c1-290">To resolve this, update your top-level routing configuration (in Global.asax.cs) to specify that your desktop HomeController should take priority when there's ambiguity:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample9.cs)]

<span data-ttu-id="798c1-291">Теперь произойдет ошибка, и URL-адрес http:\/\/*йоурсите*/будет достигать домашней страницы рабочего стола, а http:\/\/*йоурсите*/Мобиле/будет достигать домашней страницы мобильного устройства.</span><span class="sxs-lookup"><span data-stu-id="798c1-291">Now the error will go away, and the URL http:\/\/*yoursite*/ will reach the desktop homepage, and http:\/\/*yoursite*/mobile/ will reach the mobile homepage.</span></span>

### <a name="redirecting-mobile-visitors-to-your-mobile-area"></a><span data-ttu-id="798c1-292">Перенаправление посетителей мобильных устройств в мобильную область</span><span class="sxs-lookup"><span data-stu-id="798c1-292">Redirecting mobile visitors to your mobile area</span></span>

<span data-ttu-id="798c1-293">В ASP.NET MVC существует множество различных точек расширения, поэтому существует множество способов вставки логики перенаправления.</span><span class="sxs-lookup"><span data-stu-id="798c1-293">There are many different extensibility points in ASP.NET MVC, so there are many possible ways to inject redirection logic.</span></span> <span data-ttu-id="798c1-294">Один из вариантов — создать атрибут фильтра [Редиректмобиледевицестомобилеареа], который выполняет перенаправление при соблюдении следующих условий.</span><span class="sxs-lookup"><span data-stu-id="798c1-294">One neat option is to create a filter attribute, [RedirectMobileDevicesToMobileArea], that performs a redirection if the following conditions are met:</span></span>

1. <span data-ttu-id="798c1-295">Это первый запрос в сеансе пользователя (т. е. Session. Исневсессион имеет значение true)</span><span class="sxs-lookup"><span data-stu-id="798c1-295">It's the first request in the user's session (i.e., Session.IsNewSession equals true)</span></span>
2. <span data-ttu-id="798c1-296">Запрос поступает из браузера мобильного устройства (т. е. Request. browser. Исмобиледевице имеет значение true)</span><span class="sxs-lookup"><span data-stu-id="798c1-296">The request comes from a mobile browser (i.e., Request.Browser.IsMobileDevice equals true)</span></span>
3. <span data-ttu-id="798c1-297">Пользователь еще не запросил ресурс в мобильной области (т. е. часть *пути* URL-адреса не начинается с/Мобиле).</span><span class="sxs-lookup"><span data-stu-id="798c1-297">The user is not already requesting a resource in the mobile area (i.e., the *path* part of the URL does not begin with /Mobile)</span></span>

<span data-ttu-id="798c1-298">Загружаемый пример, прилагаемый к этому техническом документу, включает реализацию этой логики.</span><span class="sxs-lookup"><span data-stu-id="798c1-298">The downloadable sample included with this white paper includes an implementation of this logic.</span></span> <span data-ttu-id="798c1-299">Он реализуется как фильтр авторизации, производный от AuthorizeAttribute. Это означает, что он может работать правильно даже при использовании кэширования вывода (в противном случае, если посетитель настольного приложения сначала обращается к определенному URL-адресу, выходные данные рабочего стола могут кэшироваться, а затем обрабатываться в последующие мобильные посетители).</span><span class="sxs-lookup"><span data-stu-id="798c1-299">It's implemented as an authorization filter, derived from AuthorizeAttribute, which means it can work correctly even if you are using output caching (otherwise, if a desktop visitor first accesses a certain URL, the desktop output might be cached and then served to subsequent mobile visitors).</span></span>

<span data-ttu-id="798c1-300">Так как это фильтр, можно выбрать способ применения его к конкретным контроллерам и действиям, например,</span><span class="sxs-lookup"><span data-stu-id="798c1-300">As it's a filter, you can choose either to apply it to specific controllers and actions, e.g.,</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample10.cs)]

<span data-ttu-id="798c1-301">…</span><span class="sxs-lookup"><span data-stu-id="798c1-301">…</span></span> <span data-ttu-id="798c1-302">Кроме того, его можно применить ко всем контроллерам и действиям в качестве *глобального фильтра* MVC 3 в файле Global.asax.cs:</span><span class="sxs-lookup"><span data-stu-id="798c1-302">or you can apply it to all controllers and actions as an MVC 3 *global filter* in your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample11.cs)]

<span data-ttu-id="798c1-303">В загружаемом образце также показано, как можно создать подклассы этого атрибута, перенаправляемые в определенные расположения в вашей мобильной области.</span><span class="sxs-lookup"><span data-stu-id="798c1-303">The downloadable sample also demonstrates how you can create subclasses of this attribute that redirect to specific locations within your mobile area.</span></span> <span data-ttu-id="798c1-304">Это означает, например, что вы можете:</span><span class="sxs-lookup"><span data-stu-id="798c1-304">This means, for example, you can:</span></span>

- <span data-ttu-id="798c1-305">Зарегистрируйте глобальный фильтр, как показано выше, который по умолчанию отправляет мобильные Посетители на домашнюю страницу мобильных устройств.</span><span class="sxs-lookup"><span data-stu-id="798c1-305">Register a global filter as shown above that sends mobile visitors to the mobile homepage by default.</span></span>
- <span data-ttu-id="798c1-306">Также примените Специальный фильтр [Редиректмобиледевицестомобилепродуктпаже] к действию "Просмотр продукта", которое позволяет посетителям мобильных устройств перейти на мобильную версию какой-либо страницы продукта, которую они запросили.</span><span class="sxs-lookup"><span data-stu-id="798c1-306">Also apply a special [RedirectMobileDevicesToMobileProductPage] filter to a "view product" action that takes mobile visitors to the mobile version of whatever product page they had requested.</span></span>
- <span data-ttu-id="798c1-307">Также примените другие специальные подклассы фильтра к определенным действиям, перенаправляющие посетителей мобильных устройств на эквивалентную мобильную страницу.</span><span class="sxs-lookup"><span data-stu-id="798c1-307">Also apply other special subclasses of the filter to specific actions, redirecting mobile visitors to the equivalent mobile page</span></span>

### <a name="configuring-forms-authentication-to-respect-your-mobile-pages"></a><span data-ttu-id="798c1-308">Настройка проверки подлинности с помощью форм для соблюдения мобильных страниц</span><span class="sxs-lookup"><span data-stu-id="798c1-308">Configuring Forms Authentication to respect your mobile pages</span></span>

<span data-ttu-id="798c1-309">Если вы используете проверку подлинности с помощью форм, следует отметить, что когда пользователь должен войти в систему, он автоматически перенаправит пользователя по отдельному URL-адресу для входа, который по умолчанию — **/аккаунт/Логон**.</span><span class="sxs-lookup"><span data-stu-id="798c1-309">If you're using Forms Authentication, you should note that when a user needs to log in, it automatically redirects the user to a single specific "log on" URL, which by default is **/Account/LogOn**.</span></span> <span data-ttu-id="798c1-310">Это означает, что мобильные пользователи могут перенаправляться в действие "вход в систему" на рабочем столе.</span><span class="sxs-lookup"><span data-stu-id="798c1-310">This means that mobile users may be redirected to your desktop "log on" action.</span></span>

<span data-ttu-id="798c1-311">Чтобы избежать этой проблемы, добавьте логику к рабочему столу "вход в систему", чтобы пользователи мобильных устройств перенаправлялись на мобильное действие "вход в систему".</span><span class="sxs-lookup"><span data-stu-id="798c1-311">To avoid this problem, add logic to your desktop "log on" action so that it redirects mobile users again to a mobile "log on" action.</span></span> <span data-ttu-id="798c1-312">Если вы используете шаблон приложения ASP.NET MVC по умолчанию, обновите действие входа AccountController, как показано ниже.</span><span class="sxs-lookup"><span data-stu-id="798c1-312">If you're using the default ASP.NET MVC application template, update AccountController's LogOn action as follows:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample12.cs)]

<span data-ttu-id="798c1-313">…</span><span class="sxs-lookup"><span data-stu-id="798c1-313">…</span></span> <span data-ttu-id="798c1-314">Затем реализуйте подходящее действие входа в систему на контроллере, который называется AccountController в вашей мобильной области.</span><span class="sxs-lookup"><span data-stu-id="798c1-314">and then implement a suitable mobile-specific "log on" action on a controller called AccountController in your Mobile area.</span></span>

### <a name="working-with-output-caching"></a><span data-ttu-id="798c1-315">Работа с кэшированием выходных данных</span><span class="sxs-lookup"><span data-stu-id="798c1-315">Working with Output Caching</span></span>

<span data-ttu-id="798c1-316">Если вы используете фильтр [OutputCache], необходимо принудительно затребовать, чтобы запись кэша заменяться типом устройства.</span><span class="sxs-lookup"><span data-stu-id="798c1-316">If you're using the [OutputCache] filter, you must force the cache entry to vary by device type.</span></span> <span data-ttu-id="798c1-317">Например, напишите:</span><span class="sxs-lookup"><span data-stu-id="798c1-317">For example, write:</span></span>

[!code-javascript[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample13.js)]

<span data-ttu-id="798c1-318">Затем добавьте в файл Global.asax.cs следующий метод:</span><span class="sxs-lookup"><span data-stu-id="798c1-318">Then, add the following method to your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample14.cs)]

<span data-ttu-id="798c1-319">Это обеспечит, чтобы посетители мобильных устройств не получали данные, ранее помещаемые в кэш посетителем рабочего стола.</span><span class="sxs-lookup"><span data-stu-id="798c1-319">This will ensure that mobile visitors to the page don't receive output previously put into the cache by a desktop visitor.</span></span>

### <a name="a-working-example"></a><span data-ttu-id="798c1-320">Рабочий пример</span><span class="sxs-lookup"><span data-stu-id="798c1-320">A working example</span></span>

<span data-ttu-id="798c1-321">Чтобы увидеть эти методы в действии, скачайте [примеры кода, связанные с этим](https://docs.microsoft.com/aspnet/mobile/overview)документом.</span><span class="sxs-lookup"><span data-stu-id="798c1-321">To see these techniques in action, download [this white paper's code associated samples](https://docs.microsoft.com/aspnet/mobile/overview).</span></span> <span data-ttu-id="798c1-322">Этот пример включает приложение ASP.NET MVC 3 (версия-кандидат), расширенное для поддержки мобильных устройств с помощью описанных выше методов.</span><span class="sxs-lookup"><span data-stu-id="798c1-322">The sample includes an ASP.NET MVC 3 (Release Candidate) application enhanced to support mobile devices using the methods described above.</span></span>

## <a name="further-guidance-and-suggestions"></a><span data-ttu-id="798c1-323">Дополнительные рекомендации и предложения</span><span class="sxs-lookup"><span data-stu-id="798c1-323">Further guidance and suggestions</span></span>

<span data-ttu-id="798c1-324">Следующее обсуждение применимо как к веб-формам, так и к разработчикам MVC, которые используют методики, описанные в этом документе.</span><span class="sxs-lookup"><span data-stu-id="798c1-324">The following discussion applies both to Web Forms and MVC developers who are using the techniques covered in this document.</span></span>

### <a name="enhancing-your-redirection-logic-using-51degreesmobi-foundation"></a><span data-ttu-id="798c1-325">Повышение логики перенаправления с помощью 51Degrees.mobi Foundation</span><span class="sxs-lookup"><span data-stu-id="798c1-325">Enhancing your redirection logic using 51Degrees.mobi Foundation</span></span>

<span data-ttu-id="798c1-326">Логика перенаправления, показанная в этом документе, может быть вполне достаточна для вашего приложения, но она не будет работать, если необходимо отключить сеансы или в мобильных браузерах, отклоняя файлы cookie (они не могут быть сеансами), так как они не будут знать, является ли данный запрос Первый из этого посетителя.</span><span class="sxs-lookup"><span data-stu-id="798c1-326">The redirection logic shown in this document may be perfectly sufficient for your application, but it won't work if you need to disable sessions, or with mobile browsers that reject cookies (these can't have sessions), because it won't know whether a given request is the first one from that visitor.</span></span>

<span data-ttu-id="798c1-327">Вы уже узнали, как открытый исходный код 51Degrees.mobi Foundation может улучшить точность ASP. Обнаружение обозревателя NET.</span><span class="sxs-lookup"><span data-stu-id="798c1-327">You already learned how the open source 51Degrees.mobi Foundation can improve the accuracy of ASP.NET's browser detection.</span></span> <span data-ttu-id="798c1-328">Она также имеет встроенную возможность перенаправлять посетителей мобильных устройств в определенные места, настроенные в файле Web. config. Он может работать вне зависимости от сеансов ASP.NET (и, следовательно, файлов cookie), сохраняя временный журнал хэшей заголовков HTTP посетителей и IP-адресов, поэтому он знает, является ли каждый запрос первым из заданной вистор.</span><span class="sxs-lookup"><span data-stu-id="798c1-328">It also has a built-in ability to redirect mobile visitors to specific locations configured in Web.config. It's able to work without depending on ASP.NET Sessions (and hence cookies) by storing a temporary log of hashes of visitors' HTTP headers and IP addresses, so it knows whether or not each request is the first one from a given vistor.</span></span>

<span data-ttu-id="798c1-329">Следующий элемент, добавленный в раздел Фифтйоне файла Web. config, перенаправит первый запрос с обнаруженного мобильного устройства на страницу ~/Мобиле/дефаулт.аспкс.</span><span class="sxs-lookup"><span data-stu-id="798c1-329">The following element added to the fiftyOne section of the web.config file will redirect the first request from a detected mobile device to the page ~/Mobile/Default.aspx.</span></span> <span data-ttu-id="798c1-330">Любые запросы к страницам в мобильной папке *не* будут перенаправляться независимо от типа устройства.</span><span class="sxs-lookup"><span data-stu-id="798c1-330">Any requests to pages under the Mobile folder will *not* be redirected, regardless of device type.</span></span> <span data-ttu-id="798c1-331">Если мобильное устройство было неактивным в течение 20 минут или больше, устройство будет утрачено, а последующие запросы будут рассматриваться как новые в целях перенаправления.</span><span class="sxs-lookup"><span data-stu-id="798c1-331">If the mobile device has been inactive for a period of 20 minutes or more the device will be forgotten and subsequent requests will be treated as new ones for the purposes of redirection.</span></span>

[!code-xml[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample15.xml)]

<span data-ttu-id="798c1-332">Дополнительные сведения см. в [документации по 51Degrees.mobi Foundation](https://github.com/51Degrees/dotNET-Device-Detection).</span><span class="sxs-lookup"><span data-stu-id="798c1-332">For more details, see [51degrees.mobi Foundation documentation](https://github.com/51Degrees/dotNET-Device-Detection).</span></span>

> [!NOTE]
> <span data-ttu-id="798c1-333">Вы *можете* использовать функцию перенаправления 51Degrees.mobi Foundation в приложениях ASP.NET MVC, но необходимо определить конфигурацию перенаправления с точки зрения простых URL-адресов, а не с точки зрения параметров маршрутизации или путем добавления фильтров MVC к действиям.</span><span class="sxs-lookup"><span data-stu-id="798c1-333">You *can* use 51Degrees.mobi Foundation's redirection feature on ASP.NET MVC applications, but you will need to define your redirection configuration in terms of plain URLs, not in terms of routing parameters or by putting MVC filters on actions.</span></span> <span data-ttu-id="798c1-334">Это происходит потому, что (на момент написания статьи) 51Degrees.mobi Foundation не распознает фильтры или маршрутизацию.</span><span class="sxs-lookup"><span data-stu-id="798c1-334">This is because (at the time of writing) 51Degrees.mobi Foundation does not recognize filters or routing.</span></span>

### <a name="disabling-transcoders-and-proxy-servers"></a><span data-ttu-id="798c1-335">Отключение трансагентов и прокси-серверов</span><span class="sxs-lookup"><span data-stu-id="798c1-335">Disabling Transcoders and Proxy Servers</span></span>

<span data-ttu-id="798c1-336">Операторы мобильной сети имеют две широкие цели в своем подходе к мобильным Интернет:</span><span class="sxs-lookup"><span data-stu-id="798c1-336">Mobile network operators have two broad objectives in their approach to the mobile internet:</span></span>

1. <span data-ttu-id="798c1-337">Укажите как можно больше релевантного содержимого</span><span class="sxs-lookup"><span data-stu-id="798c1-337">Provide as much relevant content as possible</span></span>
2. <span data-ttu-id="798c1-338">Максимальное число клиентов, которые могут совместно использовать ограниченную пропускную способность сети</span><span class="sxs-lookup"><span data-stu-id="798c1-338">Maximize the number of customers who can share the limited radio network bandwidth</span></span>

<span data-ttu-id="798c1-339">Так как большинство веб-страниц разрабатывались для крупных экранов рабочего стола и высокоскоростных широкополосных подключений, многие *операторы используют программы* -программы или *серверы* , которые динамически изменяют веб-содержимое.</span><span class="sxs-lookup"><span data-stu-id="798c1-339">Since most web pages were designed for large desktop-sized screens and fast fixed-line broadband connections, many operators use *transcoders* or *proxy servers* that dynamically alter web content.</span></span> <span data-ttu-id="798c1-340">Они могут изменять разметку HTML или CSS в соответствии с мелкими экранами (особенно для "сотовых телефонов", которые не имеют вычислительной мощности для обработки сложных макетов) и могут повторно сжимать изображения (значительно уменьшая их качество) для повышения скорости доставки страниц.</span><span class="sxs-lookup"><span data-stu-id="798c1-340">They may modify your HTML markup or CSS to suit smaller screens (especially for "feature phones" that lack the processing power to handle complex layouts), and they may recompress your images (significantly reducing their quality) to improve page delivery speeds.</span></span>

<span data-ttu-id="798c1-341">Но если вы предоставили усилия по созданию версии сайта, оптимизированной для мобильных устройств, вы, вероятно, не хотите, чтобы оператор сети не влиял на него.</span><span class="sxs-lookup"><span data-stu-id="798c1-341">But if you've taken the effort to produce a mobile-optimized version of your site, you probably don't want the network operator to interfere with it any further.</span></span> <span data-ttu-id="798c1-342">Можно добавить следующую строку на страницу\_загрузки в любой веб-форме ASP.NET:</span><span class="sxs-lookup"><span data-stu-id="798c1-342">You can add the following line to the Page\_Load event in any ASP.NET Web Form:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample16.cs)]

<span data-ttu-id="798c1-343">Для контроллера MVC ASP.NET можно добавить следующее переопределение метода, чтобы оно применялось ко всем действиям на этом контроллере:</span><span class="sxs-lookup"><span data-stu-id="798c1-343">Or, for an ASP.NET MVC controller, you could add the following method override so that it applies to all actions on that controller:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample17.cs)]

<span data-ttu-id="798c1-344">Полученное сообщение HTTP информирует совместимые с W3C преобразования и прокси-серверы, не изменяя содержимое.</span><span class="sxs-lookup"><span data-stu-id="798c1-344">The resulting HTTP message informs W3C compliant transcoders and proxies not to alter content.</span></span> <span data-ttu-id="798c1-345">Конечно, нет никакой гарантии, что операторы мобильной сети будут учитывать это сообщение.</span><span class="sxs-lookup"><span data-stu-id="798c1-345">Of course, there is no guarantee that mobile network operators will respect this message.</span></span>

### <a name="styling-mobile-pages-for-mobile-browsers"></a><span data-ttu-id="798c1-346">Стилизация страниц мобильных устройств для браузеров мобильных устройств</span><span class="sxs-lookup"><span data-stu-id="798c1-346">Styling mobile pages for mobile browsers</span></span>

<span data-ttu-id="798c1-347">Он выходит за рамки этого документа, чтобы подробно описать, какие виды разметки HTML работают правильно или какие методы веб-дизайна максимально упрощают удобство использования на определенных устройствах.</span><span class="sxs-lookup"><span data-stu-id="798c1-347">It's beyond the scope of this document to describe in great detail what kinds of HTML markup work correctly or which web design techniques maximize usability on particular devices.</span></span> <span data-ttu-id="798c1-348">Вы можете найти достаточно простой макет, оптимизированный для экрана с мобильным размером, без использования ненадежных HTML или приемов позиционирования CSS.</span><span class="sxs-lookup"><span data-stu-id="798c1-348">It's up to you to find a sufficiently simple layout, optimized for a mobile-sized screen, without using unreliable HTML or CSS positioning tricks.</span></span> <span data-ttu-id="798c1-349">Однако один важный подход, который стоит упомянуть, — это *тег META окна просмотра*.</span><span class="sxs-lookup"><span data-stu-id="798c1-349">One important technique worth mentioning, however, is the *viewport meta tag*.</span></span>

<span data-ttu-id="798c1-350">В некоторых современных мобильных браузерах веб-страницы, предназначенные для мониторов настольных систем, подготавливаются к просмотру страницы на виртуальном холсте, также называемом «окном просмотра» (например, виртуальное окно просмотра имеет ширину 980 пикселей на iPhone и 850 пикселей на уровне Opera Mobile по умолчанию), а затем масштабировать результат в соответствии с физическими пикселами на экране.</span><span class="sxs-lookup"><span data-stu-id="798c1-350">Certain modern mobile browsers, in an effort display web pages meant for desktop monitors, render the page on a virtual canvas, also called "viewport" (e.g., the virtual viewport is 980 pixels wide on iPhone, and 850 pixels wide on Opera Mobile by default) and then scale the result down to fit onto the screen's physical pixels.</span></span> <span data-ttu-id="798c1-351">Затем пользователь может увеличить и сдвинуть это окно просмотра.</span><span class="sxs-lookup"><span data-stu-id="798c1-351">The user can then zoom in and pan around that viewport.</span></span> <span data-ttu-id="798c1-352">Это дает возможность браузеру отображать страницу в ее предполагаемом макете, но у нее также есть недостаток, который вызывает изменение масштаба и панорамирование, что неудобно для пользователя.</span><span class="sxs-lookup"><span data-stu-id="798c1-352">This has the advantage that it lets the browser display the page in its intended layout, but it's also has the disadvantage that it forces zooming and panning, which is inconvenient for the user.</span></span> <span data-ttu-id="798c1-353">Если вы разрабатываете для мобильных устройств, лучше разрабатывать узкие экраны, чтобы не требовалось изменять масштаб или горизонтальную прокрутку.</span><span class="sxs-lookup"><span data-stu-id="798c1-353">If you're designing for mobile, it's better to design for a narrow screen so that no zooming or horizontal scrolling is necessary.</span></span>

<span data-ttu-id="798c1-354">Способ сообщить мобильному браузеру, насколько широким окном просмотра, — через нестандартный тег META *окна просмотра* .</span><span class="sxs-lookup"><span data-stu-id="798c1-354">A way to tell the mobile browser how wide the viewport should be is through the nonstandard *viewport* meta tag.</span></span> <span data-ttu-id="798c1-355">Например, если добавить следующий фрагмент в заголовок страницы,</span><span class="sxs-lookup"><span data-stu-id="798c1-355">For example, if you add the following to your page's HEAD section,</span></span>

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample18.html)]

<span data-ttu-id="798c1-356">…</span><span class="sxs-lookup"><span data-stu-id="798c1-356">…</span></span> <span data-ttu-id="798c1-357">затем Поддержка браузеров смартфонов приведет к размещению страницы на виртуальном холсте размером 480 пикселей.</span><span class="sxs-lookup"><span data-stu-id="798c1-357">then supporting smartphone browsers will lay out the page on a 480-pixel wide virtual canvas.</span></span> <span data-ttu-id="798c1-358">Это означает, что если элементы HTML определяют свои значения ширины в процентах, то проценты будут интерпретироваться в соответствии с шириной 480 пикселей, а не с шириной окна просмотра по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="798c1-358">This means that if your HTML elements define their widths in percentage terms, the percentages will be interpreted with respect to this 480-pixel width, not the default viewport width.</span></span> <span data-ttu-id="798c1-359">В результате пользователь, скорее всего, должен иметь возможность изменять масштаб и панорамирование по горизонтали — значительно улучшая возможности мобильного просмотра.</span><span class="sxs-lookup"><span data-stu-id="798c1-359">As a result, the user is less likely to have to zoom and pan horizontally – considerably improving the mobile browsing experience.</span></span>

<span data-ttu-id="798c1-360">Если требуется, чтобы ширина окна просмотра совпадала с физическими пикселами устройства, можно указать следующее:</span><span class="sxs-lookup"><span data-stu-id="798c1-360">If you want the viewport width to match the device's physical pixels, you can specify the following:</span></span>

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample19.html)]

<span data-ttu-id="798c1-361">Чтобы это работало правильно, не следует явно заставлять элементы, превышающие эту ширину (например, с помощью атрибута *Width* или свойства CSS), в противном случае браузер будет вынужден использовать большее окно просмотра, независимо от того, что оно использует.</span><span class="sxs-lookup"><span data-stu-id="798c1-361">For this to work correctly, you must not explicitly force elements to exceed that width (e.g., using a *width* attribute or CSS property), otherwise the browser will be forced to use a larger viewport regardless.</span></span> <span data-ttu-id="798c1-362">См. также [Дополнительные сведения о нестандартном теге окна просмотра](https://developer.apple.com/library/safari/#documentation/AppleApplications/Reference/SafariHTMLRef/Articles/MetaTags.html).</span><span class="sxs-lookup"><span data-stu-id="798c1-362">See also: [more details about the nonstandard viewport tag](https://developer.apple.com/library/safari/#documentation/AppleApplications/Reference/SafariHTMLRef/Articles/MetaTags.html).</span></span>

<span data-ttu-id="798c1-363">Большинство современных смартфонов поддерживают *двойную ориентацию*: они могут храниться в книжном или альбомном режиме.</span><span class="sxs-lookup"><span data-stu-id="798c1-363">Most modern smartphones support *dual orientation*: they can be held in either portrait or landscape mode.</span></span> <span data-ttu-id="798c1-364">Поэтому важно не делать предположения относительно ширины экрана в пикселях.</span><span class="sxs-lookup"><span data-stu-id="798c1-364">So, it's important not to make assumptions about the screen width in pixels.</span></span> <span data-ttu-id="798c1-365">Даже не следует думать, что ширина экрана фиксирована, так как пользователь может изменить ориентацию устройства, находясь на странице.</span><span class="sxs-lookup"><span data-stu-id="798c1-365">Don't even assume that the screen width is fixed, because the user can re-orient their device while they are on your page.</span></span>

<span data-ttu-id="798c1-366">Старые устройства Windows Mobile и BlackBerry могут также принять следующие теги META в заголовке страницы, чтобы сообщить, что содержимое было оптимизировано для мобильных устройств и поэтому не должно преобразовываться.</span><span class="sxs-lookup"><span data-stu-id="798c1-366">Older Windows Mobile and Blackberry devices may also accept the following meta tags in the page header to inform them content has been optimized for mobile and therefore should not be transformed.</span></span>

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample20.html)]

## <a name="additional-resources"></a><span data-ttu-id="798c1-367">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="798c1-367">Additional Resources</span></span>

<span data-ttu-id="798c1-368">Список эмуляторов и симуляторов мобильных устройств, которые можно использовать для тестирования веб-приложения Mobile ASP.NET, см. на странице [имитация популярных мобильных устройств для тестирования](../mobile/device-simulators.md).</span><span class="sxs-lookup"><span data-stu-id="798c1-368">For a list of mobile device emulators and simulators you can use to test your mobile ASP.NET web application, see the page [Simulate popular mobile devices for testing](../mobile/device-simulators.md).</span></span>

## <a name="credits"></a><span data-ttu-id="798c1-369">Баллы</span><span class="sxs-lookup"><span data-stu-id="798c1-369">Credits</span></span>

- <span data-ttu-id="798c1-370">Первичный Автор: Стивен Сандерсон</span><span class="sxs-lookup"><span data-stu-id="798c1-370">Primary author: Steven Sanderson</span></span>
- <span data-ttu-id="798c1-371">Рецензенты/дополнительные модули записи содержимого: Джеймс Росевелл, Mikael Сöдерстрöм, Скотт Hanselman, Скотт Хантер</span><span class="sxs-lookup"><span data-stu-id="798c1-371">Reviewers / additional content writers: James Rosewell, Mikael Söderström, Scott Hanselman, Scott Hunter</span></span>
