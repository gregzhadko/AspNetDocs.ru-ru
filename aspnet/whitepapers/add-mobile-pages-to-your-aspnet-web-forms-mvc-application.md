---
uid: whitepapers/add-mobile-pages-to-your-aspnet-web-forms-mvc-application
title: 'Как выполнить: Добавление мобильных страниц в ASP.NET Web Forms и MVC-приложения | Документация Майкрософт'
author: rick-anderson
description: Данном разделе описывается различные способы для обслуживания страниц, оптимизированных для мобильных устройств из вашей веб-форм ASP.NET и MVC-приложения и предлагает архитектуры и...
ms.author: riande
ms.date: 01/20/2011
ms.assetid: 3124f28e-cc32-418a-afe3-519fa56f4c36
msc.legacyurl: /whitepapers/add-mobile-pages-to-your-aspnet-web-forms-mvc-application
msc.type: content
ms.openlocfilehash: 63c555358d06a9506bb5c8c993800c3307108192
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2019
ms.locfileid: "65114436"
---
# <a name="how-to-add-mobile-pages-to-your-aspnet-web-forms--mvc-application"></a>Как выполнить: Добавление мобильных страниц в веб-формы или MVC-приложение ASP.NET

> **Применяется к**
> 
> - Версии веб-форм ASP.NET 4.0
> - ASP.NET MVC версии 3.0
> 
> **Сводка**
> 
> Данном разделе описывается различные способы для обслуживания страниц, оптимизированных для мобильных устройств из вашей веб-форм ASP.NET и MVC-приложения и предлагает архитектуры и проблем, которые следует учитывать при разработке для широкого спектра устройств проектирования. В этом документе также объясняется, почему ASP.NET мобильных элементов управления ASP.NET 2.0 до 3.5 теперь являются устаревшими и описываются некоторые современные альтернативы.

## <a name="contents"></a>Описание

- Обзор
- Архитектурные варианты
- Обнаружение браузеров и устройств
- Как приложения веб-форм ASP.NET могут обеспечивать страниц, относящихся к mobile
- Как приложения ASP.NET MVC могут обеспечивать страниц, относящихся к mobile
- Дополнительные ресурсы

Загружаемые примеры кода для веб-форм ASP.NET и MVC, демонстрирующие методы в этом техническом документе, см. в разделе [мобильных приложений и узлов с использованием ASP.NET](https://docs.microsoft.com/aspnet/mobile/overview).

## <a name="overview"></a>Обзор

Мобильными устройствами — смартфонами, телефонах и планшеты — продолжают набирать популярность как способ доступа к веб. Для многих веб-разработчиков и предприятий, ориентированных на web это означает, что более важно указывать обзора удобной для посетителей, с помощью этих устройств.

### <a name="how-earlier-versions-of-aspnet-supported-mobile-browsers"></a>Как более ранних версиях ASP.NET поддерживаемые браузеры для мобильных устройств

ASP.NET версии 2.0 до версии 3.5 включены *ASP.NET Mobile Controls*: набор серверных элементов управления для мобильных устройств в *System.Web.Mobile.dll* сборки и  *System.Web.UI.MobileControls* пространства имен. Сборки по-прежнему включается в ASP.NET 4, но она устарела. Разработчикам рекомендуется перейти на более современные подходы, подобные описанным в этом документе.

Почему ASP.NET Mobile Controls были помечены как устаревшие причина в том, что их проектирования является ориентирован на мобильных телефонов, которые были распространены вокруг 2005 и более ранних версий. Элементы управления главным образом предназначены для визуализации разметки WML или cHTML (вместо обычных HTML) для обозревателей WAP, эры. Но WAP, cHTML и WML которые больше не нужны для большинства проектов, так как HTML теперь стал язык повсеместно разметки для мобильных и классических браузерах одинаково.

### <a name="the-challenges-of-supporting-mobile-devices-today"></a>Трудности поддержка мобильных устройств уже сегодня

Несмотря на то, что браузеры мобильных устройств теперь поддерживает практически все отклики HTML, вы по-прежнему столкнутся с многими трудностями, возникающими при нам необходимо для создания отличных мобильных работы с браузером:

- ***Размер экрана*** - мобильных устройств существенно различаться в форме, и их экраны часто большая меньше, чем мониторами. Таким образом необходимо разработать совершенно разные макеты для них.
- ***Входные данные методов*** — некоторые устройства имеют клавиатурами, некоторые из них имеют styluses, другим пользователям использовать сенсорный ввод. Вам может потребоваться несколько переходов механизмов и методы ввода.
- ***Соответствие стандартам*** – Многие браузеры мобильных устройств не поддерживают новейшие стандарты HTML, CSS или JavaScript.
- ***Пропускная способность*** — совершенно зависит производительность сети передачи данных, и некоторые пользователи находятся на тарифы, на которые стоит в мегабайтах.

Не существует универсального решения; приложение будет выглядеть и работать по-разному в соответствии с устройств, доступ к нему. В зависимости от того, какой уровень поддержка мобильных устройств необходимо это может быть большие сложности для веб-разработчиков, чем рабочего стола «браузера войны» был ранее.

Разработчики, изучающие поддержка браузера для мобильных устройств в первый раз часто изначально думаю, что очень важно только для поддержки смартфонов самую современную (например, Windows Phone 7, iPhone или Android), возможно, поскольку разработчики часто лично владельцем таких устройства. Тем не менее дешевле телефоны по-прежнему невероятно популярны, и их владельцев следует использовать их в Интернете — особенно в странах, где мобильные телефоны являются более чем широкополосного подключения. Вашего бизнеса необходимо решить, какой диапазон устройств, поддержку, учитывая его вероятных заказчиков. При создании online Брошюра spa работоспособности luxury, может принять решение business только для расширенных смартфонов, тогда как при создании это система заказа столиков в ресторане билет для кинотеатрах, вы, вероятно, должны учитывать для посетителей с менее мощные функции телефоны.

## <a name="architectural-options"></a>Архитектурные варианты

Прежде чем углубиться в технические особенности веб-форм ASP.NET или MVC, обратите внимание, что веб-разработчиков в целом три основных возможных варианта поддержка мобильных браузеров:

1. ***Не выполнять никаких действий —*** просто можно создать стандартный, ориентированных на рабочий стол веб-приложения и зависят от браузеров мобильных устройств для подготовки к просмотру его вполне приемлемо. 

    - **Преимущество**: Это экономичный вариант для реализации и обслуживания — без дополнительной работы
    - **Недостаток**: Предоставляет наихудшее взаимодействие с пользователем: 

        - Последние смартфонов разворачивалась HTML точно так же как браузеров на компьютерах, но пользователи по-прежнему обязательно для масштабирования и прокрутки по горизонтали и по вертикали для использования вашего контента на небольшом экране. Это далеко от оптимального.
        - Старые устройства и телефонах могут не отображаться в разметку удовлетворительным образом.
        - Даже на последнюю планшетные устройства (экраны, может быть большим, чем экранах ноутбуков) применяются правила различные взаимодействия. Touch рукописных данных лучше всего работает с большего размера кнопок и связывает spread дальнейшей друг от друга, и нет способа для наведите курсор мыши на всплывающее меню.
2. ***Решить проблему на клиенте* —** с Аккуратное использование CSS и [прогрессивное Совершенствование](http://en.wikipedia.org/wiki/Progressive_enhancement) созданием разметки, стили и скрипты, которые адаптируются к их выполняют любой браузер. Например, с помощью [медиа-запросов CSS 3](http://www.w3.org/TR/2010/CR-css3-mediaqueries-20100727/), можно создать многостолбцовый макет, который включает в одном столбце макет на устройствах, экранах более узких, чем выбранные пороговые значения. 

    - **Преимущество**: Оптимизирует отрисовки для конкретного устройства используется, даже для неизвестных будущих устройств в соответствии с любого экрана и характеристики входных они имеют
    - **Преимущество**: Легко позволяет совместно использовать логику на стороне сервера на всех типах устройств — минимальное дублирование кода или усилий
    - **Недостаток**: Мобильные устройства, таким образом отличаются от настольных компьютеров, что может действительно требуется мобильных веб-страниц полностью отличаться от классических страниц, показывая различные сведения. Такие варианты может оказаться неэффективным или вообще нельзя реализовать надежно посредством CSS одиночестве, учитывая то, как старые устройства интерпретации правила CSS. Это особенно верно для атрибуты CSS 3.
    - **Недостаток**: Не поддерживает различные логику на стороне сервера и рабочие процессы для различных устройств. Упрощенный корзину для покупок извлечения рабочий процесс для мобильных пользователей нельзя например, реализовать посредством только CSS.
    - **Недостаток**: Использование неэффективным пропускной способности. Ваш сервер может потребоваться передачи разметки и стили, которые применяются ко всем устройствам возможных, несмотря на то, что целевое устройство будет использовать только часть этой информации.
3. ***Решить проблему на сервере* —** Если ваш сервер знает, какое устройство имеет доступ к нему — или минимальных характеристики этого устройства, такие как размер экрана и метода ввода, будь то мобильном устройстве: оно может выполняться другой логикой и выходные данные разную HTML-разметку. 

    - **Преимущества:** Максимальную гибкость. Нет ограничений сколько различаются логику на стороне сервера для мобильных устройств или оптимизировать разметку для макета требуемой, зависящий от устройства.
    - **Преимущества:** Используйте эффективный пропускной способности. Требуется только для передачи разметки и сведения о котором на целевом устройстве нужно использовать.
    - **Недостаток:** Иногда вызывает повторение усилий или код (например, делая Создание похожие, но немного другой копии страницы веб-форм или MVC представления). Где возможно, вам необходимо учитывать out общую логику базового уровня или службы, но тем не менее, некоторые части кода пользовательского интерфейса или разметки необходимо быть копируется и затем сохраняется в параллельном режиме.
    - **Недостаток:** Обнаружение устройств является непростой задачей. Он требует базы данных типов известных устройств и их характеристики (которые могут не всегда идеально актуальные) и не обязательно будет точно сопоставить каждый входящий запрос. В этом документе описываются некоторые параметры и их ловушки позже.

Чтобы получить лучшие результаты, большинство разработчиков найдите, необходимую для объединения параметров (2) и (3). Рассматриваемая стилистических лучше всего объединяются на стороне клиента с помощью CSS или даже JavaScript, тогда как наиболее эффективно существенные различия в данных, рабочий процесс или разметки реализуются в коде на стороне сервера.

### <a name="this-paper-focuses-on-server-side-techniques"></a>Этот документ посвящен методы на стороне сервера

Так как веб-форм ASP.NET и MVC обеих технологий в первую очередь на стороне сервера, в этом техническом документе основное внимание уделяется методы на стороне сервера, позволяющие создавать различные разметки и логику для браузеров мобильных устройств. Само собой это можно также объединять с помощью любой подходящей методики на стороне клиента (например, CSS 3 медиа-запросов, поэтапного улучшения JavaScript), но это, чтобы в большей степени веб-дизайн чем разработки ASP.NET.

## <a name="browser-and-device-detection"></a>Обнаружение браузеров и устройств

Ключа необходимым условием для всех методов на стороне сервера для поддержки мобильных устройств — это знать, какое устройство используется посетителем. На самом деле, еще лучше, чем знать номер изготовитель и модель устройства *характеристики* устройства. Характеристики могут включать:

- Это мобильное устройство?
- Метод ввода (клавиатуры и мыши, касания, клавиатуры, джойстика,...)
- Размер экрана (физически и в пикселях)
- Поддерживаемые форматы мультимедиа и данных
- Д.

Это лучше для принятия решений, с учетом характеристик, чем номер модели, так как, а затем вы сможете более широкие возможности для обработки будущих устройствах.

### <a name="using-aspnets-built-in-browser-detection-support"></a>С помощью ASP. Поддержка NET встроенного браузера

Веб-форм ASP.NET и MVC разработчики могут немедленно обнаружить важные характеристики посещаемый обозреватель, проверяя свойства *Request.Browser* объекта. Например см. в разделе

- Request.Browser.IsMobileDevice
- Request.Browser.MobileDeviceManufacturer Request.Browser.MobileDeviceModel
- Request.Browser.ScreenPixelsWidth
- Request.Browser.SupportsXmlHttp
- ...и многие другие

По сути, платформой ASP.NET соответствует входящего *User-Agent* заголовок HTTP (UA) от регулярных выражений в набор файлов XML определения браузера. По умолчанию платформа включает определения для многих распространенных мобильных устройств и для других пользователей, которые требуется распознать можно добавить пользовательские файлы определения браузера. Дополнительные сведения см. на странице MSDN [ASP.NET серверных элементов управления и возможностей браузера](https://msdn.microsoft.com/library/x3k2ssx2.aspx).

### <a name="using-the-wurfl-device-database-via-51degreesmobi-foundation"></a>Используя базу данных WURFL устройства через 51Degrees.mobi Foundation

Хотя ASP. Поддержка NET встроенного браузера будет достаточно для многих приложений существует два основных варианта когда может быть недостаточно:

- ***Можно будет распознать последних устройствах***(без создания файлов определения браузера для их вручную). Обратите внимание, что файлы определения браузера .NET 4 не старая для распознавания Windows Phone 7, телефонах с Android, обозревателей Opera Mobile или устройства Apple iPad.
- ***Требуется более подробные сведения о возможностях устройства***. Необходимо знать о метод ввода устройства (например, касания vs клавиатуре), или какие аудио форматов браузер поддерживает. Эти сведения недоступны в стандартных файлов определения браузера.

[ *Wireless Universal Resource File* проекта (WURFL)](http://wurfl.sourceforge.net/) поддерживает гораздо больше актуальном состоянии и подробные сведения о мобильных устройствах используется уже сегодня.

Хорошая новость для разработчиков .NET-ASP. Возможность обнаружения NET браузера является расширяемой, поэтому можно расширить его возможности для преодоления этих проблем. Например, можно добавить открытым [ *51Degrees.mobi Foundation* ](https://github.com/51Degrees/dotNET-Device-Detection) библиотеки в проект. Это ASP.NET IHttpModule или поставщики возможностей (можно использовать в приложениях Web Forms и MVC), который непосредственно считывает данных WURFL и подключает его в ASP. Механизм обнаружения NET встроенного браузера. После установки модуля, *Request.Browser* внезапно будет содержать более точные и подробные сведения: он будет правильно многие из упомянутых выше устройства и заполнил их возможности (в том числе Дополнительные возможности в частности метод ввода). См. документацию по проекту для получения дополнительных сведений.

## <a name="how-web-forms-applications-can-present-mobile-specific-pages"></a>Как приложения веб-форм может представлять страниц, относящихся к mobile

По умолчанию Вот как совершенно новую программу веб-форм отображает на общих мобильных устройств:

![](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/_static/image1.png)

Очевидно ни макета выглядит очень адаптированный для мобильных устройств — эта страница была разработана для больших и альбомной ориентацией монитора, не для небольших ориентированных на книжной ориентации экрана. Так что можно делать?

Как уже говорилось ранее в этой статье, существует множество способов настройки страницы для мобильных устройств. Некоторые методы основаны на сервере, запустить другие пользователи на стороне клиента.

### <a name="creating-a-mobile-specific-master-page"></a>Создание главной страницы мобильных обозревателей

В зависимости от требований, может появиться возможность использовать же веб-форм для всех посетителей, но имеют два отдельных главные страницы: один для настольных систем посетителей, другой — для посетители с мобильных устройств. Это позволяет легко изменять таблицы стилей CSS или разметки HTML верхнего уровня в соответствии с мобильных устройств, не заставляя позволяет дублировать логику страницы.

Это легко сделать. Например на веб-форму можно добавить обработчик PreInit следующего вида:

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample1.cs)]

Теперь создайте главную страницу с именем Mobile.Master в папке верхнего уровня приложения, и он будет использоваться при обнаружении мобильного устройства. При необходимости мобильных главную страницу может ссылаться на таблицы стилей CSS мобильных обозревателей. Посетители рабочего стола будет по-прежнему см. в разделе главную страницу по умолчанию, не тот мобильных устройств.

### <a name="creating-independent-mobile-specific-web-forms"></a>Создание независимых мобильных обозревателей веб-форм

Для обеспечения максимальной гибкости вы можете гораздо дальше, чем просто отдельный главных страниц для различных типов устройств. Можно реализовать двумя *полностью отделить наборов страниц веб-форм* — один набор для браузеров настольных компьютеров, второй набор для мобильных устройств. Это работает лучше, если нужно представить данные будут сильно отличаться или рабочих процессов, чтобы посетители с мобильных устройств. В оставшейся части этого раздела описывается этот подход подробно.

Предположим, что у вас уже есть веб-форм, предназначенной для браузеров настольных компьютеров, чтобы продолжить проще создать вложенную папку с именем «Мобильный» в проекте, а ваш мобильных страниц. Можно создать всего дочернего сайта, с собственными главных страниц, таблиц стилей и страниц, используя те же методы, которые можно использовать для любого другого приложения веб-форм. Не обязательно создавать мобильные эквивалент для *каждые* страница рабочего стола узла; вы можете определить, какая часть функциональности смысл посетители с мобильных устройств.

Страницах для мобильных устройств можно совместно использовать общие статические ресурсы (такие как изображения, JavaScript или CSS файлы) с помощью обычных страниц при необходимости. Так как в папке «Мобильный» будет *не* помечаться как отдельное приложение при размещении в IIS (это просто простой вложенной страницы веб-форм), для него будет также использоваться те же конфигурации, данные о сеансе и другой инфраструктуры, как ваши страницы, рабочего стола.

> [!NOTE]
> Так как этот подход обычно включает в себя некоторые повторы кода (страницах для мобильных устройств, вероятно, для совместного использования некоторое сходство с рабочего стола pages), очень важно, чтобы вынести любого распространенных кода бизнес-логики или данных доступа в общий базовый уровень или службы. В противном случае вы будете двойные усилия на создание и обслуживание приложения.

#### <a name="redirecting-mobile-visitors-to-your-mobile-pages"></a>Перенаправление посетители с мобильных устройств для мобильных веб-страниц

Часто бывает удобно для перенаправления посетители с мобильных устройств на страницах для мобильных устройств только в случае *первый* запросить их сеанса (и не при каждом запросе в свой сеанс), так как:

- Затем можно легко разрешить посетители с мобильных устройств для доступа к страницам рабочего стола, по желанию – просто поместить ссылку на главной странице, передается «Версии». Посетитель не будет снова перенаправлены на странице для мобильных устройств, так как это не первый запрос в течение сеанса.
- Это позволяет избежать риска конфликта с запросов любых динамических ресурсов, совместно настольных и мобильных частей узла (например, если у вас есть общие веб-формы, настольных и мобильных частей узла отображается в IFRAME, или некоторые обработчики Ajax)

Чтобы сделать это, можно разместить логику перенаправления в **сеанса\_запустить** метод. Например добавьте следующий метод в файл Global.asax.cs:

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample2.cs)]

#### <a name="configuring-forms-authentication-to-respect-your-mobile-pages"></a>Настройка проверки подлинности форм следует учитывать страницах для мобильных устройств

Обратите внимание на то, что проверка подлинности форм делает некоторые предположения о которых он может перенаправить посетителей, во время и после процесса проверки подлинности:

- Когда пользователь должен пройти проверку подлинности, проверку подлинности форм перенаправит их на страницу входа для настольных систем, независимо от того, находятся ли они компьютере или мобильном пользователя (поскольку в нем концепцию *один* URL-адрес входа). Предположим, что вы хотите по-разному в стиле страницы регистрации мобильных устройств, необходимо улучшить страницу вход на рабочий стол, таким образом, чтобы он перенаправляет мобильных пользователей на страницу входа отдельных мобильных устройств. Например, добавьте следующий код, чтобы ваши **desktop** кода страницы входа: 

    [!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample3.cs)]
- После успешного входа пользователя формы проверки подлинности по умолчанию перенаправит их на домашнюю страницу рабочего стола (поскольку в нем концепцию *один* страница по умолчанию). Следует усовершенствовать страницы регистрации мобильных устройств, чтобы он перенаправляет на mobile домашнюю страницу после успешного входа. Например, добавьте следующий код, чтобы ваши **мобильных** кода страницы входа: 

    [!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample4.cs)]
  
  Этот код предполагается, что страница имеет имя входа серверного элемента управления, называется LoginUser, как в шаблоне проекта по умолчанию.

### <a name="working-with-output-caching"></a>Работа с кэширования выходных данных

При использовании кэширования вывода, имейте в виду, что по умолчанию для рабочего стола пользователя посетить определенных URL-адрес (в результате чего его выходные данные, должен быть помещен в кэш) возможен, за которым следует мобильных пользователей, которые затем Получает кэшированный вывод рабочего стола. Это предупреждение относится ли вы только что varying главную страницу по типу устройства, или реализации совершенно отдельной веб-форм на тип устройства.

Чтобы избежать проблемы, можно указать ASP.NET для изменения записи кэша в соответствии с ли посетитель с помощью мобильного устройства. Добавление параметра VaryByCustom объявление OutputCache страницы следующим образом:

[!code-aspx[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample5.aspx)]

Затем определите *isMobileDevice* как пользовательского кэша переопределить параметр, добавив следующий метод в файл Global.asax.cs:

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample6.cs)]

Это позволит гарантировать, что посетители с мобильных устройств на страницу не получать выходные данные, уже успели поместить в кэш рабочего стола посетителем.

### <a name="a-working-example"></a>Рабочий пример

Для просмотра этих методик в действии, скачайте [примеры кода в этом техническом документе](https://docs.microsoft.com/aspnet/mobile/overview). Пример приложения Web Forms автоматически перенаправляет набор страниц, относящихся к mobile во вложенной папке Mobile мобильных пользователей. Разметки и стиля этих страниц лучше оптимизирован для браузеров мобильных устройств, как вы видите от следующих снимков экрана:

![](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/_static/image2.png)

Дополнительные советы по оптимизации разметки и CSS для браузеров мобильных устройств см. в разделе «Стилизация страницах для мобильных устройств для браузеров мобильных устройств» далее в этом документе.

## <a name="how-aspnet-mvc-applications-can-present-mobile-specific-pages"></a>Как приложения ASP.NET MVC могут обеспечивать страниц, относящихся к mobile

Так как шаблон Model-View-Controller отделяет логику приложения (в контроллерах) от логики представления (в представлениях), можно из любого из следующих подходов к обработке поддержка мобильных устройств в коде на стороне сервера:

1. ***Используйте те же контроллеры и представления для настольных и мобильных браузеров, но отображать представления с различные макеты Razor, в зависимости от типа устройств*.** Этот параметр работает лучше, если вы отображаете одинаковые данные на всех устройствах, но просто необходимо указать разные таблицы стилей CSS, или изменить несколько элементов верхнего уровня HTML для мобильных устройств.
2. ***Использовать же контроллеров для настольных и мобильных браузеров, но отображать различные представления в зависимости от типа устройства***. Этот параметр работает лучше, если вы отображение примерно те же данные и те же рабочие для конечных пользователей, но хотите выполнить рендеринг очень разную HTML-разметку в соответствии с устройством.
3. ***Создайте отдельные области для настольных и мобильных браузеров, реализация независимых контроллеров и представлений для каждого*.** Этот вариант лучше всего применять, если вы отображать очень разные экраны, содержащие разные данные и начальные пользователя с помощью различных рабочих процессов, оптимизированный для их типа устройства. Это может означать некоторые повторений кода, но можно свести к минимуму, выделяя общую логику в базовый уровень или службы.

Если вы хотите воспользоваться **первый** параметр и различаются только макета Razor на тип устройства, это очень просто. Просто измените вашей \_ViewStart.cshtml файл следующим образом:

[!code-cshtml[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample7.cshtml)]

Теперь вы можете создать макет мобильных обозревателей \_LayoutMobile.cshtml со структурой страницу и CSS правила, оптимизированный для мобильных устройств.

Если вы хотите воспользоваться **второй** параметр отрисовки совершенно различные представления в соответствии с типом устройства посетителя, см. в разделе [записи блога Скотта Хансельмана](http://www.hanselman.com/blog/ABetterASPNETMVCMobileDeviceCapabilitiesViewEngine.aspx).

Оставшаяся часть этого документа посвящена **третий** параметр — Создание отдельные контроллеры *и* представлений для мобильных устройств — Чтобы указать, можно точно определить, какая часть функциональности предлагается для посетители с мобильных устройств.

### <a name="setting-up-a-mobile-area-within-your-aspnet-mvc-application"></a>Настройка мобильных области в приложении ASP.NET MVC

Можно добавить активной зоне «Mobile» в существующее приложение ASP.NET MVC обычным способом: щелкните правой кнопкой мыши имя проекта в обозревателе решений и выберите Add, а область. Затем можно добавить контроллеры и представления как для любой области в приложении ASP.NET MVC. Например добавите в область мобильных новый контроллер с именем HomeController в качестве домашней страницы для посетители с мобильных устройств.

### <a name="ensuring-the-url-mobile-reaches-the-mobile-homepage"></a>Обеспечение /Mobile URL-адрес достигает мобильных домашней страницы

Если требуется /Mobile URL-адрес для доступа к действие Index в HomeController внутри продвижению мобильных, необходимо внесение двух небольших изменений в конфигурацию маршрутизации. Во-первых обновите ваш класс MobileAreaRegistration таким образом, чтобы HomeController контроллера по умолчанию в вашем регионе мобильных устройств, как показано в следующем коде:

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample8.cs)]

Это означает мобильных домашней страницы теперь будет расположена на /Mobile вместо/Mobile/Home, так как «Home» теперь является неявным образом имя по умолчанию контроллер страницах для мобильных устройств.

Далее Обратите внимание на то, что путем добавления второй HomeController приложения (т. е. мобильных тот, в дополнение к существующей рабочего стола один), при будет разрыве регулярных рабочих столов главной странице. Она завершится с ошибкой "*найдено несколько типов, которые соответствуют контроллер с именем «Home»* «. Чтобы устранить эту проблему, обновите конфигурацию верхнего уровня маршрутизации (в файле Global.asax.cs) для указания, что вашего рабочего стола HomeController следует имеют более высокий приоритет при наличии неоднозначности:

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample9.cs)]

Теперь будет отправлена ошибка размещение и URL-адрес http:\/\/*ваш_сайт*/ достигнет рабочего стола и домашнюю страницу http:\/\/*ваш_сайт*будет /mobile/ получить доступ к домашней странице мобильных устройств.

### <a name="redirecting-mobile-visitors-to-your-mobile-area"></a>Перенаправление посетители с мобильных устройств в мобильных область

Имеется множество разные точки расширения в ASP.NET MVC, поэтому существует много возможных способов для добавления логики перенаправления. Один из вариантов ясном — создайте атрибут фильтра, [RedirectMobileDevicesToMobileArea], который выполняет перенаправление в том случае, если выполняются следующие условия:

1. Это первый запрос в сеансе пользователя (т. е. Session.IsNewSession имеет значение true)
2. Запрос поступает от браузера мобильного устройства (т. е. Request.Browser.IsMobileDevice имеет значение true)
3. Пользователь уже не запрашивает ресурс в области мобильных устройств (т. е. *путь* часть URL-адрес не начинается с /Mobile)

Загружаемый пример, включенные в этот технический документ содержит реализацию этой логики. Он реализован в виде фильтра авторизации, производный от AuthorizeAttribute, это означает, что он может работать правильно даже при использовании кэширования выходных данных (в противном случае, если может кэшировать и затем обслуживать рабочего стола посетителя первый обращений к определенным URL-адрес, выходные данные рабочего стола последующие посетители с мобильных устройств).

Так как он является фильтром, вы можете применить его для определенных контроллеров и действий, например,

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample10.cs)]

… или вы можете применить ко всем контроллерам и действиям качестве MVC 3 *глобальный фильтр* в файле Global.asax.cs:

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample11.cs)]

Загружаемый пример также демонстрирует, как можно создать подклассы этого атрибута, которые перенаправляют в определенные расположения в вашем регионе мобильных устройств. Это означает, например, вы можете:

- Зарегистрируйте глобальный фильтр как показано выше, отправляющий посетители с мобильных устройств на мобильных домашнюю страницу по умолчанию.
- Также примените фильтр [RedirectMobileDevicesToMobileProductPage] специальные действие «ознакомиться с продуктом», которое принимает посетители с мобильных устройств к мобильной версии они бы запрошен страница продукта.
- Также применяются другие специальные подклассы фильтра к определенным действиям, перенаправляя посетители с мобильных устройств для эквивалентных страницы мобильного устройства

### <a name="configuring-forms-authentication-to-respect-your-mobile-pages"></a>Настройка проверки подлинности форм следует учитывать страницах для мобильных устройств

Если вы используете проверку подлинности форм, следует отметить, что при попытке пользователя выполнить вход, он автоматически перенаправляет пользователя на одного конкретного «вход в» URL-адрес, который по умолчанию является **/учетной записи и входа в систему**. Это означает, что мобильные пользователи могут быть перенаправлены действию рабочего стола «вход».

Чтобы избежать этой проблемы, добавьте логику вашего рабочего стола «вход в» действие таким образом, чтобы он перенаправляет мобильные пользователи снова мобильных действию «вход». Если вы используете шаблон приложения ASP.NET MVC по умолчанию, обновите действие входа в систему в AccountController следующим образом:

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample12.cs)]

… и затем реализовать подходящий действие «вход в» мобильных обозревателей на контроллере вызывается AccountController по продвижению мобильных устройств.

### <a name="working-with-output-caching"></a>Работа с кэширования выходных данных

Если вы используете фильтр [OutputCache], необходимо принудительно записи кэша, чтобы зависеть от типа устройства. Например напишите:

[!code-javascript[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample13.js)]

Затем добавьте следующий метод в файл Global.asax.cs:

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample14.cs)]

Это позволит гарантировать, что посетители с мобильных устройств на страницу не получать выходные данные, уже успели поместить в кэш рабочего стола посетителем.

### <a name="a-working-example"></a>Рабочий пример

Для просмотра этих методик в действии, скачайте [кода в этом техническом документе связанные примеры](https://docs.microsoft.com/aspnet/mobile/overview). В образец входит приложение ASP.NET MVC 3 (версия-кандидат), улучшены для поддержки мобильных устройств с помощью описанных выше методов.

## <a name="further-guidance-and-suggestions"></a>Дополнительные примеры и рекомендации

Следующее обсуждение применяется к веб-форм и MVC разработчикам, использующим технологии, описанные в этом документе.

### <a name="enhancing-your-redirection-logic-using-51degreesmobi-foundation"></a>Улучшение логику перенаправления, с помощью 51Degrees.mobi Foundation

Логику перенаправления, показанные в данном документе может быть вполне достаточно для вашего приложения, но он не будет работать, если вам нужно отключить сеансы, или с помощью браузеров мобильных устройств, которые отклонить файлы cookie (они не могут иметь сеансы), так как он не знает ли данного запроса является Первый из них от этого посетителя.

Вы уже узнали, как открытым исходным кодом 51Degrees.mobi Foundation повышает точность ASP. Определение обозревателя NET. Он также содержит встроенные возможность перенаправления посетители с мобильных устройств для определенного расположения, настроенные в файле Web.config. Это может работать без зависимости от сеансов ASP.NET (и, следовательно файлы cookie), сохраняя временного журнала хэшей посетителей заголовки HTTP и IP-адресов, благодаря которому известно ли каждый запрос является первым из заданного готовый посетитель.

Следующий элемент, добавляемый в fiftyOne разделе файла web.config будет перенаправлять первого запроса с мобильного устройства, обнаруженные на страницу ~ / Mobile/Default.aspx. Любые запросы к страницам в папке мобильных будет *не* перенаправлены, вне зависимости от типа устройства. Если мобильное устройство был неактивен в течение 20 минут или больше устройств удаляются, и последующие запросы будут рассматриваться как новые командлеты для целей перенаправления.

[!code-xml[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample15.xml)]

Дополнительные сведения см. в разделе [51degrees.mobi документации Foundation](https://github.com/51Degrees/dotNET-Device-Detection).

> [!NOTE]
> Вы *можно* Foundation 51Degrees.mobi использования функции перенаправления в приложениях ASP.NET MVC, но будет необходимо определить конфигурацию перенаправления с точки зрения обычный URL-адреса, не в терминах параметров маршрутизации или путем помещения фильтров MVC о действиях. Это обусловлено (на момент написания статьи) 51Degrees.mobi Foundation не поддерживает фильтры или маршрутизации.

### <a name="disabling-transcoders-and-proxy-servers"></a>Отключение Транскодеры и прокси-серверы

Операторы мобильной сети имеют две широкие цели в свой подход к Интернету мобильных устройств.

1. Укажите в качестве гораздо соответствующего содержимого максимально
2. Максимальное количество клиентов, которые могут совместно использовать пропускную способность сети ограниченной радио

Так как большинство веб-страниц, разработанные для экранов большого размера рабочего стола и быстрого фиксированной строки широкополосным соединениям, многие операторы используют *транскодеры* или *прокси-серверы* , динамически изменить веб-содержимого. Они могут изменять разметку HTML или CSS в соответствии с экране меньшего размера (особенно для «телефонах», не хватает вычислительной мощности для обработки сложных макетов), и они могут повторное сжатие изображений (значительно снижает качество) для повышения скорости доставки страницы.

Но, если были предприняты попытки создать оптимизированный для мобильных устройств версию веб-узла, возможно, не повлиять на его работу любые дополнительные сети оператора. Можно добавить следующую строку на страницу\_событие Load в любой веб-формы ASP.NET:

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample16.cs)]

Или для контроллера ASP.NET MVC, можно добавить следующее переопределение метода, то есть применяется ко всем действиям на этом контроллере:

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample17.cs)]

Результирующее сообщение HTTP сообщает, соответствует транскодеры W3C и прокси-серверы, не для того, чтобы изменить содержимое. Само собой нет никакой гарантии, что операторы мобильной сети будут использовать это сообщение.

### <a name="styling-mobile-pages-for-mobile-browsers"></a>Задание стиля страницах для мобильных устройств для браузеров мобильных устройств

Он выходит за рамки этого документа описывается подробно какие виды рабочих разметки HTML правильно или какие стратегии разработки web увеличения удобства использования на определенных устройств. Он содержит копии вам найти достаточно простой макет, оптимизированные для экрана mobile среднего размера, без использования ненадежных HTML или размещения приемы CSS. Один из важных способов стоит упомянуть, тем не менее, — *просмотра мета-тег*.

Определенные современных браузеров мобильных устройств, на веб-страницах усилий отображения предназначены для мониторами, визуализации страницы на виртуальный canvas также называется «окно просмотра» (например, виртуального окна просмотра — 980 пикселей в ширину и на iPhone и 850 пикселей в ширину и в Opera Mobile по умолчанию) и затем результат уменьшить масштаб в соответствии с размерами экрана физических пикселей. Пользователь может затем увеличить масштаб и Lightbox вокруг этого окна просмотра. Это имеет то преимущество, что он позволяет браузеру на страницу предполагаемого макета, но также есть недостаток, что она заставляет масштабирования и панорамирования, который неудобно для пользователя. При разработке для мобильных устройств, лучше проектирования для узкой экрана, масштабирование или горизонтальная прокрутка необходим.

Заставляет браузер мобильного устройства ширину окна просмотра должно быть – нестандартное *просмотра* мета-тег. Например, если необходимо добавить следующий раздел HEAD страницы,

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample18.html)]

… затем Поддержка браузеров смартфонов будет разметки страницы на полотне виртуальные 480 пикселей. Это означает, что если ваш HTML-элементов определяет их ширина в процентах, процентные показатели будут интерпретироваться по отношению к этой 480 пикселов, не ширины окна просмотра по умолчанию. Таким образом пользователь вряд ли придется изменение масштаба и сдвиг по горизонтали — значительно улучшение мобильной работы в Интернете.

При желании ширины окна просмотра в соответствии с физических пикселей устройства можно указать следующее:

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample19.html)]

Чтобы это работало правильно, вы не заставлять явно элементов нарушать это ограничение (например, с помощью *ширины* атрибут или свойство CSS), в противном случае браузера будут вынуждены использовать независимо от того, окно просмотра большего размера. См. также: [Дополнительные сведения о теге нестандартное просмотра](https://developer.apple.com/library/safari/#documentation/AppleApplications/Reference/SafariHTMLRef/Articles/MetaTags.html).

Поддерживает наиболее современные смартфоны *двойную ориентацию*: они могут храниться в книжном или альбомном режиме. Таким образом важно не делать предположения о ширину экрана в пикселях. Не даже предполагается, что ширину экрана является фиксированным, так как пользователь повторно можете ориентировать свои устройства, находящиеся на странице.

Старые устройства Windows Mobile и Blackberry также может принимать следующие теги meta в заголовке страницы, чтобы уведомить пользователя содержимого был оптимизирован для мобильных устройств и поэтому не должны преобразовываться.

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample20.html)]

## <a name="additional-resources"></a>Дополнительные ресурсы

Список эмуляторы мобильных устройств и симуляторов, можно использовать для тестирования мобильных веб-приложения ASP.NET, см. на странице [имитация популярных мобильных устройств для тестирования](../mobile/device-simulators.md).

## <a name="credits"></a>Благодарности

- Основным автором: Стивен Сандерсон
- Рецензенты / дополнительных модулей записи содержимого: Джеймс Rosewell, Майкл Söderström, (Scott hanselman), Скотт Хантер
