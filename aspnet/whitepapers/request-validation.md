---
uid: whitepapers/request-validation
title: Проверка запросов — предотвращение атак сценариев | Документация Майкрософт
author: rick-anderson
description: В этом документе описывается функция проверки запросов ASP.NET, где, по умолчанию, приложению запрещено обрабатывать незакодированное содержимое HTML субмитт...
ms.author: riande
ms.date: 02/10/2010
ms.assetid: fa429113-5f8f-4ef4-97c5-5c04900a19fa
msc.legacyurl: /whitepapers/request-validation
msc.type: content
ms.openlocfilehash: 807cccd6fe1acdd6359b014387abd3878840d4cd
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78520584"
---
# <a name="request-validation---preventing-script-attacks"></a>Проверка запроса. Предотвращение атак на основе сценариев

> В этом документе описывается функция проверки запросов ASP.NET, где, по умолчанию, приложению запрещено обрабатывать незакодированное HTML-содержимое, отправленное на сервер. Эта функция проверки запросов может быть отключена, если приложение предназначено для безопасной обработки данных HTML.
> 
> Применяется к ASP.NET 1,1 и ASP.NET 2,0.

Проверка запросов — это функция ASP.NET (начиная с версии 1.1), блокирующая прием содержимого с незашифрованным HTML-кодом на сервере. Эта функция помогает предотвращать некоторые атаки путем внедрения кода, с помощью которых злоумышленники могут оправлять неизвестный код скрипта клиента или HTML-код на сервер, сохранять его, а затем распространять другим пользователям. Мы настоятельно рекомендуем при необходимости проверять все входные данные и кодировать их в формате HTML.

Например, вы создаете веб-страницу, которая запрашивает адрес электронной почты пользователя, а затем сохраняет этот адрес электронной почты в базе данных. Если пользователь вводит &lt;сценарий&gt;предупреждения ("Привет из скрипта")&lt;/SCRIPT&gt; вместо допустимого адреса электронной почты, этот скрипт можно выполнить, если содержимое не было закодировано должным образом. Функция проверки запросов ASP.NET не позволяет это делать.

## <a name="why-this-feature-is-useful"></a>Почему эта функция полезна

Многие сайты не знают о том, что они открыты для простых атак путем внедрения сценариев. Следует ли использовать эти атаки для нарушить сайт, отображая HTML, или, возможно, выполнить клиентский сценарий для перенаправления пользователя на веб-сайт хакера, атаки путем внедрения сценариев — это проблема, с которой разработчики должны конкурировать.

Атаки путем внедрения сценариев являются проблемой для всех веб-разработчиков, будь то использование ASP.NET, ASP или других технологий веб-разработки.

Функция проверки запросов ASP.NET заранее предотвращает эти атаки, запрещая обработку незакодированного HTML-содержимого сервером, если только разработчик не решил разрешить это содержимое.

## <a name="what-to-expect-error-page"></a>Что следует предполагать: страница ошибки

На снимке экрана ниже показан пример кода ASP.NET:

![](request-validation/_static/image1.png)

Выполнение этого кода приводит к отображению простой страницы, которая позволяет ввести некоторый текст в текстовое поле, нажать кнопку и отобразить текст в элементе управления Label:

![](request-validation/_static/image2.png)

Однако были бы JavaScript, например `<script>alert("hello!")</script>` для введения и отправки, мы получаем исключение:

![](request-validation/_static/image3.png)

В сообщении об ошибке указывается, что обнаружено потенциально опасное значение запроса. форма, а также подробные сведения о том, что именно произошло и как изменить поведение. Пример:

При проверке запроса обнаружено потенциально опасное входное значение клиента, а обработка запроса была прервана. Это значение может означать попытку нарушения безопасности приложения, например атаки с помощью межсайтовых сценариев. Проверку запроса можно отключить, задав `validateRequest=false` в директиве Page или в разделе конфигурации. Однако настоятельно рекомендуется, чтобы приложение явно проверит все входные данные в этом случае.

## <a name="disabling-request-validation-on-a-page"></a>Отключение проверки запросов на странице

Чтобы отключить проверку запросов на странице, необходимо задать для атрибута `validateRequest` директивы страницы значение `false`:

[!code-aspx[Main](request-validation/samples/sample1.aspx)]

> [!CAUTION]
> Если проверка запросов отключена, содержимое можно отправить на страницу. разработчик страницы обязан обеспечить правильную кодировку и обработку содержимого.

## <a name="disabling-request-validation-for-your-application"></a>Отключение проверки запросов для приложения

Чтобы отключить проверку запросов для приложения, необходимо изменить или создать файл Web. config для приложения и задать для атрибута validateRequest раздела `<pages />` значение `false`.

[!code-xml[Main](request-validation/samples/sample2.xml)]

Если вы хотите отключить проверку запросов для всех приложений на сервере, можно внести это изменение в файл Machine. config.

> [!CAUTION]
> Если проверка запросов отключена, содержимое можно отправить в приложение. разработчик приложения обязан обеспечить правильную кодировку и обработку содержимого.

Приведенный ниже код изменен для отключения проверки запроса.

![](request-validation/_static/image4.png)

Теперь, если следующий код JavaScript был добавлен в текстовое поле `<script>alert("hello!")</script>` результат будет следующим:

![](request-validation/_static/image5.png)

Чтобы избежать этого, при отключенной проверке запросов необходимо кодировать содержимое в формате HTML.

## <a name="how-to-html-encode-content"></a>Как кодировать содержимое в формате HTML

Если проверка запросов отключена, рекомендуется использовать HTML-кодирование содержимого, которое будет храниться для использования в будущем. Кодировка HTML автоматически заменит все "&lt;" или "&gt;" (вместе с несколькими другими символами) на соответствующее представление в кодировке HTML. Например, "&lt;" заменяется на "&amp;lt;", а "&gt;" заменяется на "&amp;gt;". Браузеры используют эти специальные коды для вывода "&lt;" или "&gt;" в браузере.

Содержимое может быть легко закодировано в формате HTML на сервере с помощью `Server.HtmlEncode(string)` API. Содержимое также можно легко декодировать в формате HTML, то есть вернуться к стандартному HTML-коду с помощью метода `Server.HtmlDecode(string)`.

![](request-validation/_static/image6.png)

Результат:

![](request-validation/_static/image7.png)
