---
uid: identity/overview/getting-started/introduction-to-aspnet-identity
title: Введение в ASP.NET Identity-ASP.NET 4. x
author: jongalloway
description: Система членства в ASP.NET была введена с ASP.NET 2,0 обратно в 2005, а после этого существовало много изменений в способах типичных веб-приложений...
ms.author: riande
ms.date: 01/22/2019
ms.assetid: 38717fc1-5989-43cf-952d-4007cc1dd923
ms.custom: seoapril2019
msc.legacyurl: /identity/overview/getting-started/introduction-to-aspnet-identity
msc.type: authoredcontent
ms.openlocfilehash: 0268dfc16cd2cfb1e79ee14997a4c5eb247af950
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78471738"
---
# <a name="introduction-to-aspnet-identity"></a>Введение в ASP.NET Identity

> Система членства в ASP.NET была введена с ASP.NET 2,0 обратно в 2005, а после этого существовало много изменений в способах, с помощью которых веб-приложения обычно обрабатывали проверку подлинности и авторизацию. ASP.NET Identity является новым представлением системы членства при создании современных приложений для Интернета, телефона или планшета.

## <a name="background-membership-in-aspnet"></a>Background: членство в ASP.NET

### <a name="aspnet-membership"></a>Членство в ASP.NET

[Членство в ASP.NET](https://msdn.microsoft.com/library/yh26yfzy(v=VS.100).aspx) было предназначено для решения требований к членству в сайтах, которые были распространены в 2005, в которых использовалась проверка подлинности с помощью форм, а SQL Server база данных для имен пользователей, паролей и данных профилей. На сегодняшний день существует более широкий спектр вариантов хранения данных для веб-приложений, и большинство разработчиков хотят, чтобы их сайты использовали поставщики удостоверений социальных сетей для проверки подлинности и авторизации. Ограничения структуры членства в ASP.NET делают этот переход трудным:

- Схема базы данных была разработана для SQL Server и ее нельзя изменить. Можно добавить сведения о профиле, но дополнительные данные упаковываются в другую таблицу, что усложняет доступ любых средств, за исключением API поставщика профилей.
- Система поставщика позволяет изменить резервное хранилище данных, но система разработана на основе допущений, подходящих для реляционной базы данных. Вы можете написать поставщик для хранения сведений о членстве в механизме нереляционного хранения, например в таблицах службы хранилища Azure, но тогда необходимо обойти реляционную структуру, написав большой объем кода и `System.NotImplementedException` исключения для методов, которые не применяются к базам данных NoSQL.
- Поскольку функции входа в систему и выхода из системы основаны на проверке подлинности на основе форм, система членства не может использовать [OWIN](../../../aspnet/overview/owin-and-katana/an-overview-of-project-katana.md). OWIN включает в себя компоненты промежуточного слоя для проверки подлинности, включая поддержку входа с использованием внешних поставщиков удостоверений (например, учетные записи Майкрософт, Facebook, Google, Twitter) и вход в систему с использованием учетных записей организации из локальной Active Directory или Azure Active Directory. OWIN также включает поддержку OAuth 2,0, JWT и CORS.

### <a name="aspnet-simple-membership"></a>Простое членство в ASP.NET

[Простое членство ASP.NET](../../../web-pages/overview/security/16-adding-security-and-membership.md) было разработано как система членства для веб-страницы ASP.NET. Он был выпущен в WebMatrix и Visual Studio 2010 с пакетом обновления 1 (SP1). Цель простого членства заключается в том, чтобы упростить добавление функций членства в приложение веб-страниц.

Простое членство состоит в том, чтобы упростить настройку сведений о профиле пользователя, но оно по-прежнему использует другие проблемы с членством в ASP.NET и имеет ряд ограничений.

- Было трудно сохранить данные системы членства в нереляционном хранилище.
- Его нельзя использовать с OWIN.
- Он плохо работает с существующими поставщиками членства ASP.NET, и он не является расширяемым.

### <a name="aspnet-universal-providers"></a>Универсальные поставщики ASP.NET

[Универсальные поставщики ASP.NET](http://www.hanselman.com/blog/IntroducingSystemWebProvidersASPNETUniversalProvidersForSessionMembershipRolesAndUserProfileOnSQLCompactAndSQLAzure.aspx) были разработаны для сохранения сведений о членстве в база данных SQL Microsoft Azure, а также для работы с SQL Server Compact. Универсальные поставщики построены на Entity Framework Code First. Это означает, что универсальные поставщики можно использовать для сохранения данных в любом хранилище, поддерживаемом EF. С универсальные поставщики, схема базы данных также была полностью очищена.

Универсальные поставщики созданы на основе инфраструктуры членства ASP.NET, поэтому они по-прежнему имеют те же ограничения, что и поставщик Склмембершип. То есть они разрабатывались для реляционных баз данных, и настраивать профиль и информацию о пользователе сложно. Эти поставщики также по-прежнему используют проверку подлинности с помощью форм для входа и выхода.

## <a name="aspnet-identity"></a>ASP.NET Identity

По мере развития истории членства в ASP.NET в течение нескольких лет Группа ASP.NET обнаружила множество отзывов от клиентов.

Предположение, что пользователи будут входить в систему, введя имя пользователя и пароль, которые были зарегистрированы в вашем приложении, теперь станут недействительными. Веб-сайт стал более социальным. Пользователи взаимодействуют друг с другом в реальном времени через социальные каналы, такие как Facebook, Twitter и другие социальные веб-сайты. Разработчики хотят, чтобы пользователи могли выполнять вход с помощью социальных удостоверений, чтобы они могли работать на своих веб-узлах с широкими возможностями. Современная система членства должна включать входы на основе перенаправления для поставщиков проверки подлинности, таких как Facebook, Twitter и др.

По мере развития веб-разработки мы сделали шаблоны веб-разработки. Модульное тестирование кода приложения стало основной задачей для разработчиков приложений. В 2008 ASP.NET добавлена новая платформа на основе шаблона модель-представление-контроллер (MVC), которая помогает разработчикам создавать приложения, поддерживающие модульные тесты ASP.NET. Разработчикам, желающим модульное тестирование логики приложения, также требовалось сделать это с системой членства.

Учитывая эти изменения в разработке веб-приложений, ASP.NET Identity была разработана со следующими целями:

- **Одна ASP.NET Identityная система**

    - ASP.NET Identity можно использовать со всеми платформами ASP.NET, такими как ASP.NET MVC, Web Forms, Web Pages, Web API и SignalR.
    - ASP.NET Identity можно использовать при создании веб-, телефонного, магазина или гибридных приложений.
- **Простота подключения данных профиля пользователя**

    - Вы можете управлять схемой сведений о пользователях и профилях. Например, можно легко включить в системе хранение дат рождения, введенных пользователями при регистрации учетной записи в приложении.

- **Управление сохраняемостью**

    - По умолчанию система ASP.NET Identity хранит все сведения о пользователях в базе данных. ASP.NET Identity использует Entity Framework Code First для реализации всех механизмов сохранения.
    - Так как вы управляете схемой базы данных, выполнять стандартные задачи, такие как изменение имен таблиц или изменение типа данных первичных ключей, очень просто.
    - Вы можете легко подключать различные механизмы хранения, такие как SharePoint, Служба таблиц службы хранилища Azure, базы данных NoSQL и т. д., без необходимости создавать исключения `System.NotImplementedExceptions`.
- **Модульное тестирование**

    - ASP.NET Identity делает веб-приложение более модульным для тестирования. Модульные тесты можно создавать для частей приложения, использующих ASP.NET Identity.
- **Поставщик ролей**

    - Существует поставщик ролей, позволяющий ограничить доступ к частям приложения с помощью ролей. Вы можете легко создавать роли, например "admin", и добавлять пользователей в роли.
- **На основе утверждений**

    - ASP.NET Identity поддерживает проверку подлинности на основе утверждений, где удостоверение пользователя представляется в виде набора утверждений. Утверждения позволяют разработчикам гораздо более выразительным в описании удостоверения пользователя, чем разрешено ролями. В то время как членство в роли является просто логическим (членом или не членом), утверждение может включать в себя подробные сведения об удостоверении и членстве пользователя.
- **Поставщики социальных имен входа**

    - Вы можете легко добавлять в свое приложение данные для входа в социальные сети, такие как учетная запись Майкрософт, Facebook, Twitter, Google и др.

- **Интеграция OWIN**

    - Проверка подлинности ASP.NET теперь основана на промежуточном по OWIN, который можно использовать на любом узле, использующем OWIN. ASP.NET Identity не зависит от System. Web. Это полностью совместимая платформа OWIN, которую можно использовать в любом размещенном приложении OWIN.
    - ASP.NET Identity использует проверку подлинности OWIN для входа и выхода пользователей на веб-сайте. Это означает, что вместо использования FormsAuthentication для создания файла cookie приложение использует OWIN Кукиеаусентикатион для этого.
- **Пакет NuGet**.

    - ASP.NET Identity распространяется в виде пакета NuGet, установленного в ASP.NET MVC, веб-формах и шаблонах веб-API, поставляемых с Visual Studio 2017. Этот пакет NuGet можно скачать из коллекции NuGet.
    - Освобождение ASP.NET Identity как пакета NuGet позволяет команде ASP.NET выполнять итерацию по новым возможностям и исправлениям ошибок, а также предоставлять их для разработчиков гибким способом.

## <a name="get-started-with-aspnet-identity"></a>Начало работы с ASP.NET Identity

ASP.NET Identity используется в шаблонах проектов Visual Studio 2017 для ASP.NET MVC, Web Forms, Web API и SPA. В этом пошаговом руководстве мы продемонстрируем, как шаблоны проектов используют ASP.NET Identity для добавления функций для регистрации, входа и выхода пользователя.

ASP.NET Identity реализуется с помощью следующей процедуры. Цель этой статьи — предоставить общий обзор ASP.NET Identity; можно выполнить шаг за шагом или просто прочитать сведения. Более подробные инструкции по созданию приложений с помощью ASP.NET Identity, включая использование нового API для добавления пользователей, ролей и сведений о профилях, см. в разделе дальнейшие действия в конце этой статьи.

1. Создание приложения ASP.NET MVC с отдельными учетными записями. Вы можете использовать ASP.NET Identity в ASP.NET MVC, Web Forms, Web API, SignalR и т. д. В этой статье мы начнем с приложения ASP.NET MVC.  
  
    ![](introduction-to-aspnet-identity/_static/image1.png)
2. Созданный проект содержит следующие три пакета для ASP.NET Identity.

    - [`Microsoft.AspNet.Identity.EntityFramework`](http://www.nuget.org/packages/Microsoft.AspNet.Identity.EntityFramework/)  
   Этот пакет содержит Entity Framework реализацию ASP.NET Identity, которая сохранит данные ASP.NET Identity и схему для SQL Server.
    - [`Microsoft.AspNet.Identity.Core`](http://www.nuget.org/packages/Microsoft.AspNet.Identity.Core/)  
   Этот пакет содержит основные интерфейсы для ASP.NET Identity. Этот пакет можно использовать для создания реализации ASP.NET Identity, которая нацелена на различные хранилища сохраняемости, такие как хранилище таблиц Azure, базы данных NoSQL и т. д.
    - [`Microsoft.AspNet.Identity.OWIN`](http://www.nuget.org/packages/Microsoft.AspNet.Identity.Owin/)  
   Этот пакет содержит функциональные возможности, используемые для подключения OWIN проверки подлинности с помощью ASP.NET Identity в приложениях ASP.NET. Это используется при добавлении функции входа в приложение и вызове по промежуточного слоя проверки подлинности OWIN cookie для создания файла cookie.
3. Создание пользователя.  
   Запустите приложение, а затем щелкните ссылку **Register (регистрация** ), чтобы создать пользователя. На следующем рисунке показана страница регистрация, которая собирает имя пользователя и пароль.  
  
    ![](introduction-to-aspnet-identity/_static/image2.png)  
  
   Когда пользователь нажимает кнопку **Register** , `Register` действие контроллера учетной записи создает пользователя, вызывая API ASP.NET Identity, как показано ниже:

    [!code-csharp[Main](introduction-to-aspnet-identity/samples/sample1.cs?highlight=8-9)]
4. Войдите.  
   Если пользователь был успешно создан, он подписывается методом `SignInAsync`.  

    [!code-csharp[Main](introduction-to-aspnet-identity/samples/sample6.cs?highlight=12)]

   Метод `SignInManager.SignInAsync` создает [ClaimsIdentity](https://msdn.microsoft.com/library/system.security.claims.claimsidentity.aspx). Так как проверка подлинности ASP.NET Identity и OWIN cookie — это система на основе утверждений, платформа требует, чтобы приложение создавало ClaimsIdentity для пользователя. ClaimsIdentity содержит сведения обо всех утверждениях для пользователя, например о ролях, к которым принадлежит пользователь.   
 
5. Выйдите из системы.  
   Щелкните ссылку **Завершение сеанса,** чтобы вызвать действие выход из системы в контроллере учетной записи. 

    [!code-csharp[Main](introduction-to-aspnet-identity/samples/sample5.cs?highlight=6)]

   В выделенном выше коде показан метод OWIN `AuthenticationManager.SignOut`. Это аналогично методу [FormsAuthentication. Signing](https://msdn.microsoft.com/library/system.web.security.formsauthentication.signout.aspx) , который используется модулем [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) в веб-формах.

## <a name="components-of-aspnet-identity"></a>Компоненты ASP.NET Identity

На схеме ниже показаны компоненты системы ASP.NET Identity (выберите на [ней или на](introduction-to-aspnet-identity/_static/image3.png) диаграмме, чтобы увеличить ее). Пакеты в зеленом виде составляют систему ASP.NET Identity. Все остальные пакеты являются зависимостями, необходимыми для использования ASP.NET Identityной системы в приложениях ASP.NET.

[![](introduction-to-aspnet-identity/_static/image5.png)](introduction-to-aspnet-identity/_static/image4.png)

Ниже приведено краткое описание пакетов NuGet, не упомянутых ранее.

- [Microsoft.Owin.Security.Cookies](http://www.nuget.org/packages/Microsoft.Owin.Security.Cookies/)  
 По промежуточного слоя, позволяющее приложению использовать проверку подлинности на основе файлов cookie, аналогично ASP. Проверка подлинности с помощью форм NET.
- [EntityFramework](http://www.nuget.org/packages/EntityFramework/)  
 Entity Framework рекомендуем использовать технологию доступа к данным Майкрософт для реляционных баз данных.

## <a name="migrating-from-membership-to-aspnet-identity"></a>Миграция из членства в ASP.NET Identity

Мы надеемся, что вскоре представили рекомендации по переносу существующих приложений, использующих членство в ASP.NET или простое членство в новой системе ASP.NET Identity.

## <a name="next-steps"></a>Next Steps

- [Создание приложения ASP.NET MVC 5 с помощью Facebook и Google OAuth2 и OpenID Connect входа](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md)  
 В этом руководстве используется ASP.NET Identity API для добавления сведений о профиле в пользовательскую базу данных и проверки подлинности в Google и Facebook.
- [Создание приложения ASP.NET MVC с аутентификацией и базой данных SQL и его развертывание в службе приложений Azure](https://docs.microsoft.com/aspnet/core/security/authorization/secure-data)  
 В этом руководстве показано, как использовать API удостоверений для добавления пользователей и ролей.
- [https://github.com/rustd/AspnetIdentitySample](https://github.com/rustd/AspnetIdentitySample)  
 Пример приложения, демонстрирующий Добавление основных ролей и поддержки пользователей, а также управление ролями и пользователями.
