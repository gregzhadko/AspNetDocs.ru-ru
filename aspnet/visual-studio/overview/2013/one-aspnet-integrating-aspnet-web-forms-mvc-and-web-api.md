---
uid: visual-studio/overview/2013/one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api
title: 'Практическое занятие. одна ASP.NET: Интеграция ASP.NET Web Forms, MVC и веб-API | Документация Майкрософт'
author: rick-anderson
description: ASP.NET — это платформа для создания веб-сайтов, приложений и служб с помощью специализированных технологий, таких как MVC, веб-API и др. С расширением ASP.NET h...
ms.author: riande
ms.date: 07/16/2014
ms.assetid: 4fe2558d-67cc-4d12-a5c1-6fb9f6f16137
msc.legacyurl: /visual-studio/overview/2013/one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api
msc.type: authoredcontent
ms.openlocfilehash: 165d104b5d3ef3281af449cc8673ad96f531d628
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78505458"
---
# <a name="hands-on-lab-one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api"></a>Практическое занятие. одна ASP.NET: Интеграция ASP.NET Web Forms, MVC и веб-API

по [веб-Camp командам](https://twitter.com/webcamps)

[Скачать обучающий комплект Web Camp](https://aka.ms/webcamps-training-kit)

> ASP.NET — это платформа для создания веб-сайтов, приложений и служб с помощью специализированных технологий, таких как MVC, веб-API и др. С момента создания ASP.NET расширения и выражения, которые должны интегрировать эти технологии, существуют последние усилия по работе с **одним ASP.NET**.
> 
> В Visual Studio 2013 введена новая унифицированная система проектов, позволяющая создавать приложения и использовать все технологии ASP.NET в одном проекте. Эта функция избавляет от необходимости выбирать одну технологию в начале проекта и заменять ее, а вместо этого способствует использованию нескольких ASP.NET платформ в рамках одного проекта.
> 
> Все примеры кода и фрагментов включены в комплект обучающих курсов Web Camp, доступный по адресу [https://aka.ms/webcamps-training-kit](https://aka.ms/webcamps-training-kit).

<a id="Overview"></a>
## <a name="overview"></a>Обзор

<a id="Objectives"></a>
### <a name="objectives"></a>Цели

В этой практической лабораторной работе вы узнаете, как выполнять следующие задачи:

- Создание веб-сайта на основе одного типа проекта **ASP.NET**
- Использование различных платформ **ASP.NET** , таких как **MVC** и **веб-API** , в одном проекте
- Поиск основных компонентов приложения **ASP.NET**
- Воспользуйтесь преимуществами платформы **формирования шаблонов ASP.NET** , чтобы автоматически создавать контроллеры и представления для выполнения операций CRUD на основе классов модели.
- Предоставление одинакового набора сведений в форматах машинного и удобного для чтения данных с помощью правильного инструмента для каждого задания

<a id="Prerequisites"></a>
### <a name="prerequisites"></a>предварительные требования

Для выполнения этой практической лабораторной работы требуется следующее:

- [Visual Studio Express 2013 для Web](https://www.microsoft.com/visualstudio/) или более поздней версии
- [Visual Studio 2013 с обновлением 1](https://go.microsoft.com/fwlink/?LinkId=301714)

<a id="Setup"></a>
### <a name="setup"></a>Настройка

Чтобы выполнить упражнения в этой практической лабораторной работе, сначала необходимо настроить среду.

1. Откройте проводник Windows и перейдите к **исходной** папке лаборатории.
2. Щелкните **Setup. cmd** правой кнопкой мыши и выберите **Запуск от имени администратора** , чтобы запустить процесс установки, который будет настраивать среду и установить фрагменты кода Visual Studio для этой лабораторной работы.
3. Если отображается диалоговое окно Контроль учетных записей пользователей, подтвердите действие для продолжения.

> [!NOTE]
> Убедитесь, что проверены все зависимости для этой лабораторной работы перед запуском программы установки.

<a id="CodeSnippets"></a>
### <a name="using-the-code-snippets"></a>Использование фрагментов кода

На протяжении всего лабораторного документа вы получите инструкции по вставке блоков кода. Для удобства большая часть этого кода предоставляется как Visual Studio Code фрагменты, к которым можно получить доступ из Visual Studio 2013, чтобы не добавлять их вручную.

> [!NOTE]
> Каждое упражнение сопровождается начальным решением, расположенным в **начальной** папке упражнения, которое позволяет выполнять каждое упражнение независимо от других. Имейте в виду, что фрагменты кода, добавленные во время упражнения, отсутствуют в этих начальных решениях и могут не работать, пока вы не завершите упражнение. В исходном коде для упражнения также будет найдена **Конечная** папка, содержащая решение Visual Studio с кодом, полученным в результате выполнения шагов в соответствующем упражнении. Эти решения можно использовать в качестве руководства, если вам нужна дополнительная помощь во время работы с этой практической лабораторной работой.

---

<a id="Exercises"></a>
## <a name="exercises"></a>Полнят

Эта практическая лабораторная работа включает в себя следующие упражнения:

1. [Создание нового проекта веб-форм](#Exercise1)
2. [Создание контроллера MVC с помощью формирования шаблонов](#Exercise2)
3. [Создание контроллера веб-API с помощью формирования шаблонов](#Exercise3)

Предполагаемое время выполнения этой лабораторной работы: **60 минут**

> [!NOTE]
> При первом запуске Visual Studio необходимо выбрать одну из предварительно определенных коллекций параметров. Каждая предопределенная коллекция разработана для соответствия определенному стилю разработки и определяет макеты окон, поведение редактора, фрагменты кода IntelliSense и параметры диалоговых окон. Процедуры в этом лабораторном занятии описывают действия, необходимые для выполнения данной задачи в Visual Studio при использовании коллекции **общих параметров разработки** . При выборе другой коллекции параметров для среды разработки могут возникнуть различия в действиях, которые необходимо учитывать.

<a id="Exercise1"></a>
### <a name="exercise-1-creating-a-new-web-forms-project"></a>Упражнение 1. Создание нового проекта веб-форм

В этом упражнении вы создадите новый сайт Web Forms в Visual Studio 2013 с помощью единого унифицированного проекта **ASP.NET** , который позволит легко интегрировать веб-формы, MVC и компоненты веб-API в одно приложение. Затем будет рассмотрено созданное решение и его части, и, наконец, вы увидите, что веб-сайт в действии.

<a id="Ex1Task1"></a>
#### <a name="task-1--creating-a-new-site-using-the-one-aspnet-experience"></a>Задача 1. Создание нового сайта с помощью одного интерфейса ASP.NET

В этой задаче вы приступите к созданию нового веб-сайта в Visual Studio на основе одного типа проекта **ASP.NET** . **Один ASP.NET** объединяет все технологии ASP.NET и дает возможность смешивать и сопоставлять их по своему усмотрению. Затем вы узнаете о различных компонентах веб-форм, MVC и веб-API, которые параллельно находятся в приложении.

1. Откройте **Visual Studio Express 2013 для Web** и выберите **файл | Создать проект...** для запуска нового решения.

    ![Создание нового проекта](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/_static/image1.png)

    *Создание нового проекта*
2. В диалоговом окне **Новый проект** выберите **ASP.NET веб-приложение** в **визуальном C# элементе | Веб-** вкладку и убедитесь, что выбран **.NET Framework 4,5** . Назовите проект *михибридсите*, выберите **Расположение** и нажмите кнопку **ОК**.

    ![Новый проект веб-приложения ASP.NET](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/_static/image2.png)

    *Создание нового проекта веб-приложения ASP.NET*
3. В диалоговом окне **Новый проект ASP.NET** выберите шаблон **веб-формы** и выберите параметры **MVC** и **веб-API** . Кроме того, убедитесь, что для параметра **Проверка подлинности** задано значение **индивидуальные учетные записи пользователей**. Чтобы продолжить, нажмите кнопку **ОК** .

    ![Создание нового проекта с помощью шаблона веб-форм, включая веб-API и компоненты MVC](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/_static/image3.png)

    *Создание нового проекта с помощью шаблона веб-форм, включая веб-API и компоненты MVC*
4. Теперь вы можете исследовать структуру созданного решения.

    ![Изучение созданного решения](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/_static/image4.png)

    *Изучение созданного решения*

    1. **Учетная запись:** Эта папка содержит страницы веб-форм для регистрации, входа в систему и управления учетными записями пользователей приложения. Эта папка добавляется при выборе параметра Проверка подлинности **отдельных учетных записей пользователей** во время настройки шаблона проекта веб-форм.
    2. **Модели:** В этой папке будут содержаться классы, представляющие данные приложения.
    3. **Контроллеры** и **представления**. Эти папки необходимы для компонентов **ASP.NET MVC** и **веб-API ASP.NET** . В следующих упражнениях рассматривается технология MVC и веб-API.
    4. Файлы **Default. aspx**, **Contact. aspx** и **About. aspx** являются предварительно определенными страницами веб-форм, которые можно использовать в качестве начальных точек для создания страниц, относящихся к конкретному приложению. Логика программирования этих файлов размещается в отдельном файле, который называется &quot;ным файлом кода&quot; программной части, который имеет расширение &quot;. aspx. vb&quot; или &quot;. aspx.cs&quot; (в зависимости от используемого языка). Логика кода программной части выполняется на сервере и динамически создает выходные данные HTML для страницы.
    5. Страницы **site. master** и **site. Mobile. master** определяют внешний вид и стандартное поведение всех страниц в приложении.
5. Дважды щелкните файл **Default. aspx** , чтобы просмотреть содержимое страницы.

    ![Изучение страницы Default. aspx](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/_static/image5.png)

    *Изучение страницы Default. aspx*

    > [!NOTE]
    > Директива **Page** в верхней части файла определяет атрибуты страницы Web Forms. Например, атрибут **MasterPageFile** задает путь к главной странице, в данном случае — на странице *site. master* — и атрибут **Inherits** определяет класс кода программной части для наследуемой страницы. Этот класс находится в файле, определяемом атрибутом **CodeBehind** .
    > 
    > Элемент управления **ASP: Content** содержит фактическое содержимое страницы (текст, разметку и элементы управления) и сопоставляется с элементом управления **ASP: ContentPlaceHolder** на главной странице. В этом случае содержимое страницы будет отображаться внутри элемента управления *MainContent* , определенного на странице *site. master* .
6. Разверните папку **App\_Start** и обратите внимание на файл **WebApiConfig.CS** . Visual Studio включил этот файл в созданное решение, так как вы включили веб-API при настройке проекта с помощью шаблона "один ASP.NET".
7. Откройте файл **WebApiConfig.CS** . В классе *WebApiConfig* вы найдете конфигурацию, связанную с веб-API, которая СОПОСТАВЛЯЕТ маршруты HTTP с **контроллерами веб-API**.

    [!code-csharp[Main](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/samples/sample1.cs)]
8. Откройте файл **RouteConfig.CS** . В методе *регистерраутес* вы найдете конфигурацию, связанную с MVC, которая СОПОСТАВЛЯЕТ маршруты HTTP с **контроллерами MVC**.

    [!code-csharp[Main](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/samples/sample2.cs)]

<a id="Ex1Task2"></a>
#### <a name="task-2--running-the-solution"></a>Задача 2. Запуск решения

В этой задаче будет запущено созданное решение, рассмотрено приложение и некоторые его функции, такие как переписывание URL-адресов и встроенная проверка подлинности.

1. Чтобы запустить решение, нажмите клавишу **F5** или кнопку **запустить** , расположенную на панели инструментов. Домашняя страница приложения должна открываться в браузере.

    ![Запуск решения](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/_static/image6.png)
2. Убедитесь, что страницы веб-форм вызываются. Для этого добавьте **/контакт.аспкс** в URL-адрес в адресной строке и нажмите клавишу **Ввод**.

    ![Понятные URL-адреса](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/_static/image7.png)

    *Понятные URL-адреса*

    > [!NOTE]
    > Как видите, URL-адрес меняется на **/контакт**. Начиная с **ASP.NET 4**, возможности маршрутизации URL-адресов были добавлены в веб-формы, поэтому вместо *[http://www.mysite.com/products.aspx?category=software](http://www.mysite.com/products.aspx?category=software)* можно создавать URL-адреса, такие как *[http://www.mysite.com/products/software](http://www.mysite.com/products/software)* . Дополнительные сведения см. в разделе [Маршрутизация URL-адресов](../../../web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/url-routing.md).
3. Теперь мы рассмотрим поток проверки подлинности, интегрированный в приложение. Для этого щелкните **зарегистрировать** в правом верхнем углу страницы.

    ![Регистрация нового пользователя](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/_static/image8.png)

    *Регистрация нового пользователя*
4. На странице **Регистрация** введите **имя пользователя** и **пароль**, а затем нажмите кнопку **зарегистрировать**.

    ![Страница "регистрация"](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/_static/image9.png)

    *Страница "регистрация"*
5. Приложение регистрирует новую учетную запись, и пользователь проходит проверку подлинности.

    ![Пользователь прошел проверку подлинности](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/_static/image10.png)

    *Пользователь прошел проверку подлинности*
6. Вернитесь в Visual Studio и нажмите клавиши **SHIFT + F5** , чтобы прерывать отладку.

<a id="Exercise2"></a>
### <a name="exercise-2-creating-an-mvc-controller-using-scaffolding"></a>Упражнение 2. Создание контроллера MVC с помощью формирования шаблонов

В этом упражнении вы будете использовать преимущества платформы формирования шаблонов ASP.NET, предоставляемой Visual Studio для создания контроллера ASP.NET MVC 5 с действиями и представлениями Razor для выполнения операций CRUD, не написав ни одной строки кода. Процесс формирования шаблонов будет использовать Entity Framework Code First для создания контекста данных и схемы базы данных в базе данных SQL.

**Сведения о Entity Framework Code First**

Entity Framework (EF) — это объектно-реляционная система сопоставления (ORM), позволяющая создавать приложения для доступа к данным с помощью программирования с концептуальной моделью приложения, а не непосредственно с помощью реляционной схемы хранилища.

Рабочий процесс моделирования Entity Framework Code First позволяет использовать собственные доменные классы для представления модели, используемой EF при выполнении запросов, функций отслеживания изменений и обновления. С помощью рабочего процесса разработки Code First не нужно начинать приложение путем создания базы данных или указания схемы. Вместо этого можно написать стандартные классы .NET, определяющие наиболее подходящие объекты модели предметной области для приложения, а Entity Framework создаст базу данных.

> [!NOTE]
> Дополнительные сведения о Entity Framework см. [здесь](../../../entity-framework.md).

<a id="Ex2Task1"></a>
#### <a name="task-1--creating-a-new-model"></a>Задача 1. Создание новой модели

Теперь вы определите класс **Person** , который будет моделью, используемой процессом формирования шаблонов для создания контроллера MVC и представлений. Начнем с создания класса модели **Person** , и операции CRUD в контроллере будут автоматически созданы с помощью функций формирования шаблонов.

1. Откройте **Visual Studio Express 2013 для Web** и решение **михибридсите. sln** , расположенное в папке **Source/EX2-MvcScaffolding/Begin** . Кроме того, можно продолжить работу с решением, полученным в предыдущем упражнении.
2. В **Обозреватель решений**щелкните правой кнопкой мыши папку **Models** проекта **михибридсите** и выберите **Добавить | Класс...** .

    ![Добавление класса модели Person](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/_static/image11.png)

    *Добавление класса модели Person*
3. В диалоговом окне **Добавление нового элемента** укажите имя файла *Person.CS* и нажмите кнопку **добавить**.

    ![Создание класса модели Person](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/_static/image12.png)

    *Создание класса модели Person*
4. Замените содержимое файла **Person.CS** следующим кодом. Нажмите клавиши **CTRL + S** , чтобы сохранить изменения.

    (Фрагмент кода — *брингингтожесеронеаспнет-EX2-персонкласс*)

    [!code-csharp[Main](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/samples/sample3.cs)]
5. В **Обозреватель решений**щелкните правой кнопкой мыши проект **михибридсите** и выберите пункт **Сборка**или нажмите клавиши **CTRL + SHIFT + B** , чтобы выполнить сборку проекта.

<a id="Ex2Task2"></a>
#### <a name="task-2--creating-an-mvc-controller"></a>Задача 2. Создание контроллера MVC

Теперь, когда модель **Person** создана, вы будете использовать формирование шаблонов ASP.NET MVC с Entity Framework, чтобы создать действия и представления контроллера CRUD для **пользователя**.

1. В **Обозреватель решений**щелкните правой кнопкой мыши папку **Controllers** проекта **михибридсите** и выберите **Добавить | Создать шаблонный элемент...**

    ![Создание нового шаблона контроллера](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/_static/image13.png)

    *Создание нового шаблона контроллера*
2. В диалоговом окне **Добавление шаблона** выберите **контроллер MVC 5 с представлениями, используя Entity Framework** и нажмите кнопку **Добавить.**

    ![Выбор контроллера MVC 5 с представлениями и Entity Framework](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/_static/image14.png)

    *Выбор контроллера MVC 5 с представлениями и Entity Framework*
3. Задайте *мвкперсонконтроллер* в качестве **имени контроллера**, выберите параметр **использовать действия асинхронного контроллера** и выберите **Person (михибридсите. Models)** в качестве **класса модели**.

    ![Добавление контроллера MVC с формированием шаблонов](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/_static/image15.png)

    *Добавление контроллера MVC с формированием шаблонов*
4. В разделе **класс контекста данных**щелкните **создать контекст данных.** ...

    ![Создание нового контекста данных](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/_static/image16.png)

    *Создание нового контекста данных*
5. В диалоговом окне **новый контекст данных** введите имя нового контекста данных *персонконтекст* и нажмите кнопку **добавить**.

    ![Создание нового Персонконтекст](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/_static/image17.png)

    *Создание нового типа Персонконтекст*
6. Нажмите кнопку **Добавить** , чтобы создать новый контроллер для **пользователя** с формированием шаблонов. Visual Studio создаст действия контроллера, контекст данных Person и представления Razor.

    ![После создания контроллера MVC с формированием шаблонов](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/_static/image18.png)

    *После создания контроллера MVC с формированием шаблонов*
7. Откройте файл **MvcPersonController.CS** в папке **Controllers** . Обратите внимание, что методы действия CRUD были созданы автоматически.

    [!code-csharp[Main](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/samples/sample4.cs)]

    > [!NOTE]
    > Установив флажок **использовать действия асинхронного контроллера** из параметров формирования шаблонов на предыдущих шагах, Visual Studio создает асинхронные методы действия для всех действий, которые задействуют доступ к контексту данных Person. Рекомендуется использовать асинхронные методы действий для длительно выполняющихся запросов, не связанных с ЦП, чтобы предотвратить выполнение работы веб-сервером во время обработки запроса.

<a id="Ex2Task3"></a>
#### <a name="task-3--running-the-solution"></a>Задача 3. Запуск решения

В этой задаче будет снова запущено решение, чтобы убедиться, что представления для **пользователя** работают должным образом. Вы добавите нового пользователя, чтобы убедиться, что оно успешно сохранено в базе данных.

1. Чтобы запустить решение, нажмите клавишу **F5**.
2. Перейдите по адресу **/мвкперсон**. Представление с формированием шаблонов, в котором отображается список людей.
3. Щелкните **создать** , чтобы добавить нового пользователя.

    ![Переход к формированию сформированных представлений MVC](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/_static/image19.png)

    *Переход к формированию сформированных представлений MVC*
4. В представлении **создать** укажите **имя** и **возраст** пользователя, а затем нажмите кнопку **создать**.

    ![Добавление нового пользователя](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/_static/image20.png)

    *Добавление нового пользователя*
5. Новый пользователь будет добавлен в список. В списке элемент щелкните **сведения** , чтобы отобразить представление сведений о лице. Затем в представлении " **сведения** " нажмите кнопку **назад к списку** , чтобы вернуться к представлению списка.

    ![Представление сведений о лице](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/_static/image21.png)

    *Представление сведений о лице*
6. Щелкните ссылку **Удалить** , чтобы удалить пользователя. В представлении **Удаление** нажмите кнопку **Удалить** , чтобы подтвердить операцию.

    ![Удаление пользователя](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/_static/image22.png)

    *Удаление пользователя*
7. Вернитесь в Visual Studio и нажмите клавиши **SHIFT + F5** , чтобы прерывать отладку.

<a id="Exercise3"></a>
### <a name="exercise-3-creating-a-web-api-controller-using-scaffolding"></a>Упражнение 3. Создание контроллера веб-API с помощью формирования шаблонов

Платформа веб-API является частью стека ASP.NET и предназначена для упрощения реализации служб HTTP, которая обычно отправляет и получает данные в формате JSON или XML через API RESTFUL.

В этом упражнении для создания контроллера веб-API будет использоваться формирование шаблонов ASP.NET. Вы будете использовать те же классы **Person** и **персонконтекст** из предыдущего упражнения, чтобы предоставить одни и те же данные пользователя в формате JSON. Вы увидите, как можно предоставить одни и те же ресурсы различными способами в рамках одного приложения ASP.NET.

<a id="Ex3Task1"></a>
#### <a name="task-1--creating-a-web-api-controller"></a>Задача 1. Создание контроллера веб-API

В этой задаче вы создадите новый **контроллер веб-API** , который будет предоставлять данные о пользователях в используемом для компьютера формате, например JSON.

1. Если он еще не открыт, откройте **Visual Studio Express 2013 для Web** и откройте решение **михибридсите. sln** , расположенное в папке **Source/EX3-WebAPI/Begin** . Кроме того, можно продолжить работу с решением, полученным в предыдущем упражнении.

    > [!NOTE]
    > Если вы начинаете с упражнения 3, нажмите клавиши **CTRL + SHIFT + B** , чтобы создать решение.
2. В **Обозреватель решений**щелкните правой кнопкой мыши папку **Controllers** проекта **михибридсите** и выберите **Добавить | Создать шаблонный элемент...**

    ![Создание нового шаблона контроллера](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/_static/image23.png)

    *Создание нового шаблона контроллера*
3. В диалоговом окне **Добавление шаблона** в области слева выберите **веб-API** , затем **контроллер Web API 2 с действиями, с помощью Entity Framework** в средней области и нажмите кнопку **Добавить.**

    ![Выбор контроллера веб-API 2 с действиями и Entity Framework](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/_static/image24.png "Выбор контроллера веб-API 2 с действиями и Entity Framework")

    *Выбор контроллера веб-API 2 с действиями и Entity Framework*
4. Задайте *апиперсонконтроллер* в качестве **имени контроллера**, выберите параметр **использовать действия асинхронного контроллера** **и в качестве** классов **контекста данных** выберите **Person (михибридсите. Models)** и **персонконтекст (михибридсите. Models)** соответственно. Нажмите кнопку **Добавить**.

    ![Добавление контроллера веб-API с формированием шаблонов](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/_static/image25.png "Добавление контроллера веб-API с формированием шаблонов")

    *Добавление контроллера веб-API с формированием шаблонов*
5. Visual Studio создаст класс **апиперсонконтроллер** с четырьмя действиями CRUD для работы с данными.

    ![После создания контроллера веб-API с формированием шаблонов](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/_static/image26.png "После создания контроллера веб-API с формированием шаблонов")

    *После создания контроллера веб-API с формированием шаблонов*
6. Откройте файл **ApiPersonController.CS** и проверьте метод действия для *пользователей* . Этот метод запрашивает поле базы данных типа **персонконтекст** , чтобы получить данные о людях.

    [!code-csharp[Main](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/samples/sample5.cs)]
7. Теперь обратите внимание на комментарий над определением метода. Он предоставляет универсальный код ресурса (URI), который предоставляет это действие, которое будет использоваться в следующей задаче.

    [!code-csharp[Main](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/samples/sample6.cs)]

    > [!NOTE]
    > По умолчанию веб-API настроен для перехвата запросов к */API* пути во избежание конфликтов с контроллерами MVC. Если необходимо изменить этот параметр, см. сведения в разделе [Маршрутизация в веб-API ASP.NET](../../../web-api/overview/web-api-routing-and-actions/routing-in-aspnet-web-api.md).

<a id="Ex3Task2"></a>
#### <a name="task-2--running-the-solution"></a>Задача 2. Запуск решения

В этой задаче вы будете использовать **средства разработчика F12** для Internet Explorer, чтобы проверить полный ответ от контроллера веб-API. Вы увидите, как можно захватить сетевой трафик, чтобы получить более подробные сведения о данных приложения.

> [!NOTE]
> Убедитесь, что в кнопке **Пуск** на панели инструментов Visual Studio выбран параметр **Internet Explorer** .
> 
> ![Параметр Internet Explorer](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/_static/image27.png)
> 
> **Средства разработчика F12** имеют широкий набор функциональных возможностей, которые не рассматриваются в этом практическом занятии. Дополнительные сведения об этом см. в статье [использование средств разработчика F12](https://msdn.microsoft.com/library/ie/bg182326(v=vs.85)).

1. Чтобы запустить решение, нажмите клавишу **F5**.

    > [!NOTE]
    > Чтобы правильно выполнить эту задачу, приложение должно иметь данные. Если база данных пуста, можно вернуться к задаче 3 в упражнении 2 и выполнить инструкции по созданию нового пользователя с помощью представлений MVC.
2. В браузере нажмите клавишу **F12** , чтобы открыть панель **средства для разработчиков** . Нажмите **сочетание клавиш CTRL** + **4** или щелкните значок **сети** , а затем нажмите кнопку с зеленой стрелкой, чтобы начать запись сетевого трафика.

    ![Инициация записи сети веб-API](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/_static/image28.png "Инициация записи сети веб-API")

    *Инициация записи сети веб-API*
3. Добавьте **API/апиперсон** в URL-адрес в адресной строке браузера. Теперь вы проверите сведения о ответе в **апиперсонконтроллер**.

    ![Получение данных Person через веб-API](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/_static/image29.png "Получение данных Person через веб-API")

    *Получение данных Person через веб-API*

    > [!NOTE]
    > После завершения загрузки вам будет предложено выполнить действие с скачанным файлом. Оставьте диалоговое окно открытым, чтобы иметь возможность просматривать содержимое ответа через окно инструментов разработчиков.
4. Теперь вы проверите текст ответа. Для этого перейдите на вкладку **сведения** и щелкните **текст ответа**. Можно проверить, что загруженные данные представляют собой список объектов со свойствами **ID**, **Name** и **Age** , которые соответствуют классу **Person** .

    ![Просмотр текста ответа веб-API](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/_static/image30.png "Просмотр текста ответа веб-API")

    *Просмотр текста ответа веб-API*

<a id="Ex3Task3"></a>
#### <a name="task-3--adding-web-api-help-pages"></a>Задача 3. Добавление страниц справки по веб-API

При создании веб-API полезно создать страницу справки, чтобы другие разработчики узнают, как вызывать API. Можно создавать и обновлять страницы документации вручную, но лучше создавать их автоматически, чтобы не выполнять обслуживание. В этой задаче будет использоваться пакет NuGet для автоматического создания страниц справки веб-API для решения.

1. В меню **Сервис** в Visual Studio выберите **Диспетчер пакетов NuGet**, а затем щелкните **консоль диспетчера пакетов**.
2. В окне **консоли диспетчера пакетов** выполните следующую команду:

    [!code-powershell[Main](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/samples/sample7.ps1)]

    > [!NOTE]
    > Пакет **Microsoft. AspNet. WebApi. хелппаже** устанавливает необходимые сборки и добавляет представления MVC для страниц справки в папке **Areas/хелппаже** .

    ![Область Хелппаже](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/_static/image31.png "Область Хелппаже")

    *Область Хелппаже*
3. По умолчанию страницы справки содержат строки заполнителей для документации. Для создания документации можно использовать комментарии XML-документации. Чтобы включить эту функцию, откройте файл **HelpPageConfig.CS** , расположенный в папке **Areas/хелппаже/App\_Start** , и раскомментируйте следующую строку:

    [!code-javascript[Main](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/samples/sample8.js)]
4. В **Обозреватель решений**щелкните правой кнопкой мыши проект **михибридсите**, выберите пункт **Свойства** и перейдите на вкладку **Сборка** .

    ![Вкладка "сборка"](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/_static/image32.png "Раздел "сборка"")

    *Вкладка "сборка"*
5. В разделе **выходные данные**выберите **XML-файл документации**. В поле ввода введите **App\_Data/XmlDocument. XML**.

    ![Раздел выходных данных на вкладке "сборка"](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/_static/image33.png "Раздел выходных данных на вкладке "сборка"")

    *Раздел выходных данных на вкладке "сборка"*
6. Нажмите клавиши **CTRL** + **S** , чтобы сохранить изменения.
7. Откройте файл **ApiPersonController.CS** в папке **Controllers** .
8. Введите новую строку между сигнатурой *метода апиперсон* и комментарием *//Get API/* , а затем введите три косые черты.

    > [!NOTE]
    > Visual Studio автоматически вставляет XML-элементы, определяющие документацию по методам.
9. Добавьте текст сводки и возвращаемое значение для метода *People* . Он должен выглядеть следующим образом.

    [!code-csharp[Main](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/samples/sample9.cs)]
10. Чтобы запустить решение, нажмите клавишу **F5**.
11. Добавьте **/Help** в URL-адрес в адресной строке, чтобы перейти на страницу справки.

    ![Страница справки веб-API ASP.NET](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/_static/image34.png "Страница справки веб-API ASP.NET")

    *Страница справки веб-API ASP.NET*

    > [!NOTE]
    > Основное содержимое страницы — это таблица API-интерфейсов, сгруппированных по контроллеру. Записи таблицы создаются динамически с помощью интерфейса **иапиексплорер** . При добавлении или обновлении контроллера API таблица будет автоматически обновляться при следующей сборке приложения.
    > 
    > В столбце **API** перечисляются метод HTTP и относительный URI. В столбце **Описание** содержатся сведения, извлеченные из документации по методу.
12. Обратите внимание, что описание, добавленное над определением метода, отображается в столбце Описание.

    ![Описание метода API](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/_static/image35.png "Описание метода API")

    *Описание метода API*
13. Щелкните один из методов API, чтобы переходить к странице с более подробными сведениями, включая образцы текстов ответов.

    ![Страница сведений](one-aspnet-integrating-aspnet-web-forms-mvc-and-web-api/_static/image36.png "Страница сведений")

    *Страница подробных сведений*

---

<a id="Summary"></a>
## <a name="summary"></a>Сводка

С помощью этой практической лабораторной работы вы узнали, как:

- Создание нового веб-приложения с помощью одного интерфейса ASP.NET в Visual Studio 2013
- Интеграция нескольких ASP.NET технологий в один проект
- Создание контроллеров и представлений MVC из классов модели с помощью формирования шаблонов ASP.NET
- Создание контроллеров веб-API, использующих такие функции, как асинхронное программирование и доступ к данным с помощью Entity Framework
- Автоматическое создание страниц справки по веб-API для контроллеров
