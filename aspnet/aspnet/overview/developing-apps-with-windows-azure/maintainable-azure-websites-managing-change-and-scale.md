---
uid: aspnet/overview/developing-apps-with-windows-azure/maintainable-azure-websites-managing-change-and-scale
title: 'Практическое лабораторное занятие. Простые в обслуживании веб-сайты Azure: Управление изменениями и масштабированием | Документация Майкрософт'
author: rick-anderson
description: В этой лабораторной работы Узнайте, как Microsoft Azure позволяет легко создавать и развертывать веб-сайтов в рабочей среде.
ms.author: riande
ms.date: 07/16/2014
ms.assetid: ecfd0eb4-c4ad-44e6-9db9-a2a66611ff6a
msc.legacyurl: /aspnet/overview/developing-apps-with-windows-azure/maintainable-azure-websites-managing-change-and-scale
msc.type: authoredcontent
ms.openlocfilehash: ec0058472f8bc1d8d58e7c78deeb8b6097532510
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/09/2019
ms.locfileid: "59409737"
---
# <a name="hands-on-lab-maintainable-azure-websites-managing-change-and-scale"></a>Практическое лабораторное занятие. Простые в обслуживании веб-сайты Azure: управление изменениями и масштабированием

по [Web Слышатся Team](https://twitter.com/webcamps)

[Скачайте комплект учебных материалов по лагеря Web](https://aka.ms/webcamps-training-kit)

> Microsoft Azure позволяет легко создавать и развертывать веб-сайтов в рабочей среде. Но вы не закончили при динамической приложения, вы только начинаете работу! Нужно будет обработать изменение требования, обновления базы данных, масштабирования и многое другое. К счастью служба приложений Azure реализована в рамках, множество функций, которые помогут вам работать с ними бесперебойной работы.
>
> Azure предлагает безопасные и гибкие возможности разработки, развертывания и масштабирования для веб-приложений любого размера. Используйте существующие средства создания и развертывания приложений, не заботясь об управлении инфраструктурой.
>
> Рабочее веб-приложение самостоятельно Подготовьте в минутах, простого развертывания содержимого, созданного с помощью привычного средства разработки. Можно развернуть существующий сайт напрямую из системы управления версиями с поддержкой **Git**, **GitHub**, **Bitbucket**, **TFS**и даже  **DropBox**. Развертывание непосредственно из избранного интерфейса IDE или скриптов, используя **PowerShell** в Windows или **CLI** средств, работающих в любой операционной системе. После развертывания, своевременно веб-сайтов постоянно с поддержкой для непрерывного развертывания.
>
> Azure предоставляет масштабируемые, надежные облачные хранилища, архивации и восстановления любых данных, больших или малых. При развертывании приложений в рабочей среде, службы хранилища, такие как таблицы, большие двоичные объекты и базы данных SQL, позволяют масштабировать приложения в облаке.
>
> В базах данных SQL важно поддерживать актуальность производительность базы данных при развертывании новых версий приложения. Выражаем благодарность **Entity Framework Code First Migrations**, разработку и развертывание модели данных был упрощен для обновления среды за несколько минут. Это Практическое занятие покажу различные темы, которые могут возникнуть при развертывании веб-приложения в рабочую среду в Microsoft Azure.
>
> Все примеры кода и фрагменты кода включены в Web лагеря комплект обучающих материалов, доступных в [ https://aka.ms/webcamps-training-kit ](https://aka.ms/webcamps-training-kit).
>
> Более подробные сведения в этом разделе, см. в разделе [Создание реальных облачных приложений в Azure электронная книга](building-real-world-cloud-apps-with-windows-azure/introduction.md).


<a id="Overview"></a>
## <a name="overview"></a>Обзор

<a id="Objectives"></a>
### <a name="objectives"></a>Цели

В этой практической работу вы узнаете, как:

- Включить миграций Entity Framework с использованием существующей модели
- Обновите модель объектов и базы данных соответствующим образом с помощью миграций Entity Framework
- Развертывание в службе приложений Azure с помощью Git
- Откат до предыдущего развертывания с помощью портала управления Azure
- Использование хранилища Azure для масштабирования веб-приложения
- Настройка автоматического масштабирования для веб-приложения с помощью портала управления Azure
- Создание и настройка проекта нагрузочного тестирования в Visual Studio

<a id="Prerequisites"></a>
### <a name="prerequisites"></a>Предварительные требования

Для завершения этой практической работу требуется следующее:

- [Visual Studio Express 2013 для Web](https://www.microsoft.com/visualstudio/) или более поздней версии
- [Пакет Azure SDK для .NET 2.2](https://www.microsoft.com/windowsazure/sdk/)
- [Система управления версиями GIT](http://git-scm.com/download)
- Подписка Microsoft Azure

    - Зарегистрируйтесь в службе [бесплатной пробной версии](https://aka.ms/watk-freetrial)
    - Если вы являетесь Visual Studio Professional, Test Professional, Premium или Ultimate с MSDN или MSDN Platforms, активировать ваши [преимущества для подписчиков MSDN](https://aka.ms/watk-msdn) сейчас, чтобы начать разработку и тестирование в Azure
    - [BizSpark](https://aka.ms/watk-bizspark) элементы автоматически получать Azure преимущество при приобретении Visual Studio Ultimate с подписками MSDN
    - Членами [Microsoft Partner Network](https://aka.ms/watk-mpn) программе Cloud Essentials получают ежемесячные кредиты Azure бесплатно

<a id="Setup"></a>
### <a name="setup"></a>Установка

Для выполнения упражнений в этой практической работу, необходимо сначала настроить среду.

1. Откройте Windows Explorer и перейдите к лаборатории **источника** папки.
2. Щелкните правой кнопкой мыши **Setup.cmd** и выберите **Запуск от имени администратора** для запуска процесса установки, будет настроить среду и установить фрагменты кода Visual Studio для этой лабораторной работы.
3. Если открыто диалоговое окно контроля учетных записей, подтвердите действие для продолжения.

> [!NOTE]
> Убедитесь, что все зависимости для этой лабораторной работы вы вернули перед запуском программы установки.


<a id="CodeSnippets"></a>
### <a name="using-the-code-snippets"></a>Фрагменты кода

В этом документе лаборатории вам будет рекомендовано вставлять блоки кода. Для удобства основная часть кода предоставляется как фрагменты кода Visual Studio, к которому можно получить из в Visual Studio 2013, чтобы избежать необходимости добавлять ее вручную.

> [!NOTE]
> Каждого упражнения сопровождается начальный решения, расположенный в **начать** папку упражнения, чему вы сможете каждого упражнения, независимо от других. Имейте в виду, что фрагменты кода, которые добавляются во время атаки, отсутствуют эти стартовые решения и могут не работать, пока не будут выполнены упражнения. В исходном коде для упражнения, вы также найдете **окончания** папку, содержащую решение Visual Studio с кодом, полученный в результате выполнения действий, описанных в соответствующий упражнении. Эти решения можно использовать в качестве руководства, если вам нужна дополнительная помощь, отвечая на это Практическое занятие.


---

<a id="Exercises"></a>
## <a name="exercises"></a>Упражнения

Это Практическое занятие включает в себя следующие упражнения:

1. [С помощью миграций Entity Framework](#Exercise1)
2. [Развертывание веб-приложения в промежуточную среду](#Exercise2)
3. [Выполняя откат развертывания в рабочей среде](#Exercise3)
4. [Масштабирование с помощью службы хранилища Azure](#Exercise4)
5. [С помощью автоматического масштабирования для веб-приложений](#Exercise5) (необязательно для Visual Studio 2013 Ultimate edition)

Предполагаемое время для выполнения этого лабораторного: **75 минут**

> [!NOTE]
> При первом запуске Visual Studio, необходимо выбрать один из предварительно определенных коллекций параметров. Каждой коллекции предопределенных соответствует конкретному стилю разработки и определяет макетов окон, поведение редактора, фрагменты кода IntelliSense и параметры диалогового окна. В этом лабораторном занятии описаны действия, необходимые для выполнения данной задачи в Visual Studio при использовании **обычные параметры разработки** коллекции. При выборе другого набора параметров для среды разработки, возможно, различия в действиях, которые следует учитывать.


<a id="Exercise1"></a>
### <a name="exercise-1-using-entity-framework-migrations"></a>Упражнение 1. С помощью миграций Entity Framework

При разработке приложения, модель данных может измениться с течением времени. Эти изменения могут повлиять на существующей модели базы данных (при создании новой версии), и это важно для обновления базы данных во избежание ошибок.

Для упрощения отслеживания этих изменений в модели, **Entity Framework Code First Migrations** автоматически обнаруживать изменения, сравнивая модели с помощью схемы базы данных и создает код для обновления базы данных, Создание нового *версии* базы данных.

В этом упражнении показано, как включить **миграций** для приложения и как можно легко обнаружить и вызывают изменения для обновления баз данных.

<a id="Ex1Task1"></a>
#### <a name="task-1--enabling-migrations"></a>Задача 1 – включение миграции

В этой задаче будет пропускать все шаги включения **Entity Framework Code First Migrations** для **Quiz Компьютерщик** базы данных, изменение модели и общие сведения о том, как эти изменения отражаются в База данных.

1. Откройте Visual Studio и откройте **GeekQuiz.sln** файл решения из **Source\Ex1 UsingEntityFrameworkMigrations\Begin**.
2. Выполните сборку решения для загрузки и установки **NuGet** зависимости пакетов. Чтобы сделать это, щелкните правой кнопкой мыши решение и нажмите кнопку **построить решение** или нажмите клавишу **Ctrl + Shift + B**.
3. Из **средства** меню в Visual Studio, выберите пункт **диспетчер пакетов NuGet**, а затем нажмите кнопку **консоль диспетчера пакетов**.
4. В **консоль диспетчера пакетов**, введите следующую команду и нажмите клавишу **ввод**. Будет создан на основе существующей модели первоначальной миграции.

    [!code-powershell[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample1.ps1)]

    ![Включение Migrations](maintainable-azure-websites-managing-change-and-scale/_static/image1.png "включение миграции")

    *Включение миграций*

    > [!NOTE]
    > Эта команда добавляет **миграций** папке Quiz Компьютерщик проект, который содержит файл с именем **Configuration.cs**. **Конфигурации** класс позволяет настраивать поведение миграций для контекста.
5. С помощью миграций включить, необходимо обновить **конфигурации** класс для заполнения базы данных с начальными данными, **Quiz Компьютерщик** требует. В разделе **миграций**, замените **Configuration.cs** файл с тем, который расположен в **Source\Assets** папку данную лабораторию.

    > [!NOTE]
    > Так как **миграций** вызовет **начальное значение** метод при каждом обновлении базы данных, необходимо убедиться, что записи не повторяются в базе данных. **AddOrUpdate** метод поможет предотвратить дублирование данных.
6. Чтобы добавить первоначальную миграцию, введите следующую команду и нажмите клавишу **ввод**.

    > [!NOTE]
    > Убедитесь, что нет никакой базы данных с именем &quot;GeekQuizProd&quot; в экземпляре LocalDB.

    [!code-powershell[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample2.ps1)]

    ![Добавление базовой схемы миграции](maintainable-azure-websites-managing-change-and-scale/_static/image2.png "Добавление базовой схемы миграции")

    *Добавление базовой схемы миграции*

    > [!NOTE]
    > **Add-Migration** будет формировать следующей миграции на основе изменений, внесенные в модель с момента создания последней миграции. В этом случае является первой миграции проекта, добавит скриптов для создания таблиц, определенных в **TriviaContext** класса.
7. Выполнение миграции для обновления базы данных, выполнив следующую команду. Для этой команды необходимо указать **Verbose** флаг для просмотра инструкций SQL, применяемых к целевой базе данных.

    [!code-powershell[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample3.ps1)]

    ![Создание исходной базы данных](maintainable-azure-websites-managing-change-and-scale/_static/image3.png "создание исходной базы данных")

    *Создание исходной базы данных*

    > [!NOTE]
    > **Update-Database** будет применение всех ожидающих миграции в базу данных. В этом случае он создаст в базе данных с помощью строки подключения, определенные в файле web.config.
8. Перейдите к **представление** меню и откройте **обозреватель объектов SQL Server**.

    ![Открыть в обозревателе объектов SQL Server](maintainable-azure-websites-managing-change-and-scale/_static/image4.png "открыть в обозревателе объектов SQL Server")

    *Открыть в обозревателе объектов SQL Server*
9. В **обозреватель объектов SQL Server** окна, подключитесь к экземпляру LocalDB, щелкнув правой кнопкой мыши **SQL Server** узла и выбрав **добавить SQL Server...**  параметр.

    ![Добавление экземпляра SQL Server](maintainable-azure-websites-managing-change-and-scale/_static/image5.png "Добавление экземпляра SQL Server")

    *Добавление экземпляра SQL Server в обозревателе объектов SQL Server*
10. Задайте **имя_сервера** для *(localdb) \v11.0* и оставить **проверки подлинности Windows** как свой режим проверки подлинности. Нажмите кнопку **Connect** для продолжения.

    ![Подключение к LocalDB](maintainable-azure-websites-managing-change-and-scale/_static/image6.png "подключение к LocalDB")

    *Подключение к LocalDB*
11. Откройте **GeekQuizProd** базы данных и разверните **таблиц** узла. Как вы видите, **Update-Database** команда создается все таблицы, определенные в **TriviaContext** класса. Найдите **dbo. TriviaQuestions** таблицы и откройте узел «столбцы». В следующей задаче будет добавить новый столбец в эту таблицу и обновить базу данных при помощи **миграций**.

    ![Занимательные вопросы столбцы](maintainable-azure-websites-managing-change-and-scale/_static/image7.png "занимательные вопросы столбцов")

    *Занимательные вопросы столбцов*

<a id="Ex1Task2"></a>
#### <a name="task-2--updating-database-schema-using-migrations"></a>Задача 2 – обновление схемы базы данных, с помощью миграций

В этой задаче вы воспользуетесь **Entity Framework Code First Migrations** обнаруживать изменения в модели и сформировать необходимый код для обновления базы данных. Мы обновим **TriviaQuestions** сущности, добавив в него новое свойство. Затем вы выполните команды для создания новой миграции для включения нового столбца в таблице.

1. В **обозревателе решений**, дважды щелкните **TriviaQuestion.cs** файл, расположенный внутри **моделей** папки.
2. Добавить новое свойство с именем **указание**, как показано в следующем фрагменте кода.

    [!code-csharp[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample4.cs)]
3. В **консоль диспетчера пакетов**, введите следующую команду и нажмите клавишу **ввод**. Новой миграции создается отображающий изменения в нашей модели.

    [!code-powershell[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample5.ps1)]

    ![Add-Migration](maintainable-azure-websites-managing-change-and-scale/_static/image8.png "Add-Migration")

    *Add-Migration*

    > [!NOTE]
    > Файл миграции состоит из двух методов **вверх** и **вниз**.
    >
    > - **Вверх** метод будет использоваться для указания, какие изменения в текущей версии наши приложения, нужно внести в базу данных.
    > - **Вниз** используется для отмены изменений, мы добавили **вверх** метод.
    >
    > При миграции базы данных обновляет базу данных, в порядке меток времени, а только те, которые не были использованы с момента последнего обновления будут применяться при всех переносах ( \_MigrationHistory таблицы следит за миграций, которые были применены). **Вверх** будет вызван метод всех операций миграции и будут внесены изменения, мы указали в базу данных. Если мы решим, чтобы вернуться к предыдущей миграции, **вниз** метод будет вызываться, чтобы внести изменения в обратном порядке.
4. В **консоль диспетчера пакетов**, введите следующую команду и нажмите клавишу **ввод**.

    [!code-powershell[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample6.ps1)]
5. Выходные данные **Update-Database** созданную команду **Alter Table** инструкцию SQL, чтобы добавить новый столбец для **TriviaQuestions** таблицы, как показано на рисунке ниже.

    ![Добавьте инструкцию SQL столбца создан](maintainable-azure-websites-managing-change-and-scale/_static/image9.png "добавьте инструкцию SQL столбца создан")

    *Добавьте инструкцию SQL столбца создан*
6. В **обозреватель объектов SQL Server**, обновите **dbo. TriviaQuestions** таблицу и убедитесь, что новый **указание** отображается столбец.

    ![Отображение нового столбца указание](maintainable-azure-websites-managing-change-and-scale/_static/image10.png "отображение нового столбца подсказки")

    *Отображение нового столбца подсказки*
7. Вернитесь в **TriviaQuestion.cs** редакторе добавьте **StringLength** ограничение *указание* свойства, как показано в следующем фрагменте кода.

    [!code-csharp[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample7.cs)]
8. В **консоль диспетчера пакетов**, введите следующую команду и нажмите клавишу **ввод**.

    [!code-powershell[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample8.ps1)]
9. В **консоль диспетчера пакетов**, введите следующую команду и нажмите клавишу **ввод**.

    [!code-powershell[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample9.ps1)]
10. Выходные данные **Update-Database** созданную команду **Alter Table** инструкции SQL для обновления *указание* столбец, имеющий тип **TriviaQuestions** таблицы, как показано на рисунке ниже.

    ![Инструкция ALTER column SQL создается](maintainable-azure-websites-managing-change-and-scale/_static/image11.png "инструкция Alter column SQL создан")

    *Инструкция ALTER column SQL создан*
11. В **обозреватель объектов SQL Server**, обновите **dbo. TriviaQuestions** таблицу и убедитесь, что **указание** столбец имеет тип **nvarchar(150)**.

    ![Отображение нового ограничения](maintainable-azure-websites-managing-change-and-scale/_static/image12.png "отображается новое ограничение")

    *Отображение нового ограничения*

<a id="Exercise2"></a>
### <a name="exercise-2-deploying-a-web-app-to-staging"></a>Упражнение 2. Развертывание веб-приложения в промежуточную среду

**Веб-приложения в службе приложений Azure** позволяет выполнять промежуточную публикацию. Для промежуточной публикации создается слот промежуточного сайта для каждого рабочего сайта по умолчанию и позволяет менять слоты без задержки. Это отлично подходит для проверки изменений перед выпуском общедоступной, осуществляют пошаговую интеграцию содержимого сайта и откатывается, если изменения не работают надлежащим образом.

В этом упражнении вы развернете **Quiz Компьютерщик** приложения в промежуточной среде, веб-приложения с помощью системы управления версиями Git. Чтобы сделать это, будет создание веб-приложения и подготовить необходимые компоненты на портале управления, Настройка **Git** репозиторий и Push-уведомлений приложения исходный код с локального компьютера в промежуточном слоте. Требуется обновить рабочую базу данных с помощью **Code First Migrations** вы создали в предыдущем упражнении. Затем приложение будет выполняться в данной тестовой среде, чтобы проверить его работу. Когда вы будете удовлетворены, что приложение работает в соответствии с вашим ожиданиям, будет переводить приложения в рабочей среде.

> [!NOTE]
> Чтобы включить промежуточную публикацию, веб-приложения должен быть в **стандартный режим**. Обратите внимание на то, что при изменении веб-приложения в стандартном режиме будет взиматься дополнительная плата. Дополнительные сведения о ценах см. в разделе [цен на службу приложений](https://azure.microsoft.com/pricing/details/app-service/).


<a id="Ex2Task1"></a>
#### <a name="task-1--creating-a-web-app-in-azure-app-service"></a>Задача 1 – Создание веб-приложения в службе приложений Azure

В этой задаче вы создадите веб-приложения в **службе приложений Azure** на портале управления. Вы также настроите **базы данных SQL** для сохранения данных приложения и Настройка локального репозитория Git для системы управления версиями.

1. Перейдите к [портал управления Azure](https://manage.windowsazure.com) и войдите с использованием учетной записи Майкрософт, связанную с вашей подпиской.

    ![Войдите на портал управления Azure](maintainable-azure-websites-managing-change-and-scale/_static/image13.png)

    *Войдите на портал управления Azure*
2. Нажмите кнопку **New** на панели команд в нижней части страницы.

    ![Создание нового веб-приложения](maintainable-azure-websites-managing-change-and-scale/_static/image14.png "Создание нового веб-приложения")

    *Создание нового веб-приложения*
3. Нажмите кнопку **вычислений**, **веб-сайт** и затем **настраиваемое создание**.

    ![Создание нового веб-приложения, воспользуйтесь функцией настраиваемое создание](maintainable-azure-websites-managing-change-and-scale/_static/image15.png "Создание нового веб-приложения, воспользуйтесь функцией настраиваемое Создание")

    *Создание нового веб-приложения, воспользуйтесь функцией настраиваемое Создание*
4. В **новый веб-узел — настраиваемое создание** диалоговое окно укажите свободный **URL-адрес** (например *Компьютерщик головоломки*), выберите расположение в **регион** Выберите в раскрывающемся списке и выберите **создать новую базу данных SQL** в **базы данных** стрелку раскрывающегося списка. Наконец, выберите **публикации из системы управления версиями** флажок и нажмите кнопку **Далее**.

    ![Настройка нового веб-приложения](maintainable-azure-websites-managing-change-and-scale/_static/image16.png)

    *Настройка нового веб-приложения*
5. Укажите следующие сведения для настройки базы данных:

   - В **имя** текста введите имя базы данных (например *geekquiz\_db*)
   - На сервере **раскрывающегося списка** выберите **сервер базы данных SQL на новый**. Кроме того можно выбрать существующий сервер.
   - В **имя пользователя базы данных** и **пароль базы данных** введите имя пользователя администратора и пароль для сервера базы данных SQL. Если после выбора сервера, вы уже создали, вам будет предложено ввести пароль.

     ![Задание параметров базы данных](maintainable-azure-websites-managing-change-and-scale/_static/image17.png)

     *Задание параметров базы данных*
6. Чтобы продолжить, нажмите кнопку **Далее** .
7. Выберите **локальный репозиторий Git** для системы управления версиями, и нажмите кнопку **Далее**.

    > [!NOTE]
    > Вы может запрашиваться учетные данные развертывания (имя пользователя и пароль).

    ![Создание репозитория Git](maintainable-azure-websites-managing-change-and-scale/_static/image18.png)

    *Создание репозитория Git*
8. Подождите, пока создается новое веб-приложение.

    > [!NOTE]
    > По умолчанию, Azure предоставляет доменов на *azurewebsites.net* , но также дает возможность задать пользовательские домены, с помощью портала управления Azure. Тем не менее можно управлять только пользовательские домены при использовании определенных режимах службе приложений Azure.
    >
    > Служба приложений Azure доступен в выпусках Free, Shared, Basic, Standard и Premium. В режиме Free и Shared все веб-приложения выполняются в среде с несколькими клиентами и имеет квот на использование ЦП, памяти и сети. Максимальное число бесплатных приложений зависит от плана. В стандартном режиме выберите, какие приложения, выполните на выделенных виртуальных машинах, которые соответствуют в стандартный Azure вычислительные ресурсы. Можно найти конфигурацию режима веб-приложения в **масштабирования** меню веб-приложения.
    >
    > ![Служба приложений Azure режимы](maintainable-azure-websites-managing-change-and-scale/_static/image19.png "режимы службы приложений Azure")
    >
    > Если вы используете **Shared** или **стандартный** режиме, вы сможете управлять личными доменами для веб-приложения, перейдя к своему приложению **Настройка** меню и выбрав пункт **Управление доменами** под *доменных имен*.
    >
    > ![Управление доменами](maintainable-azure-websites-managing-change-and-scale/_static/image20.png "Управление доменами")
    >
    > ![Управление пользовательскими доменами](maintainable-azure-websites-managing-change-and-scale/_static/image21.png "управление пользовательскими доменами")
9. После создания веб-приложения щелкните ссылку под **URL-адрес** столбца, чтобы проверить выполнение нового веб-приложения.

    ![Просмотр новое веб-приложение](maintainable-azure-websites-managing-change-and-scale/_static/image22.png)

    *Просмотр новое веб-приложение*

    ![Выполнение веб-приложения](maintainable-azure-websites-managing-change-and-scale/_static/image23.png)

    *Выполнение веб-приложения*

<a id="Ex2Task2"></a>
#### <a name="task-2--creating-the-production-sql-database"></a>Задача 2 – Создание рабочей базы данных SQL

В этой задаче вы воспользуетесь **Entity Framework Code First Migrations** для создания базы данных, предназначенных для **базы данных SQL Azure** экземпляр, созданный в предыдущей задаче.

1. На портале управления перейдите к веб-приложения, созданного в предыдущей задаче и перейти к его **панели мониторинга**.
2. В **панели мониторинга** щелкните **просмотреть строки подключения** ссылку в списке **быстрый обзор** раздел.

    ![Просмотреть строки подключения](maintainable-azure-websites-managing-change-and-scale/_static/image24.png "просмотреть строки подключения")

    *Просмотр строк подключения*
3. Копировать **строку подключения** значение и закрыть диалоговое окно.

    ![Строка подключения на портале управления Azure](maintainable-azure-websites-managing-change-and-scale/_static/image25.png "строку подключения на портале управления Azure")

    *Строка подключения на портале управления Azure*
4. Нажмите кнопку **баз данных SQL** для просмотра списка баз данных SQL в Azure

    ![Меню базы данных SQL](maintainable-azure-websites-managing-change-and-scale/_static/image26.png "меню базы данных SQL")

    *Меню базы данных SQL*
5. Найдите базу данных, созданную в предыдущей задаче и нажмите кнопку на сервере.

    ![Сервер базы данных SQL](maintainable-azure-websites-managing-change-and-scale/_static/image27.png "базы данных SQL server")

    *Сервер базы данных SQL*
6. В **быстрый запуск** страницы сервера, щелкните **Настройка**.

    ![Настройка меню](maintainable-azure-websites-managing-change-and-scale/_static/image28.png "Настройка меню")

    *Настройка меню*
7. В **разрешенные IP-адреса** щелкните **добавить в разрешенные IP-адреса** ссылку, чтобы включить IP-адрес для подключения к серверу базы данных SQL.

    ![Разрешенные IP-адреса](maintainable-azure-websites-managing-change-and-scale/_static/image29.png "разрешенные IP-адреса")

    *Разрешенные IP-адреса*
8. Нажмите кнопку **Сохранить** в нижней части страницы, чтобы завершить шаг.
9. Переключитесь в Visual Studio.
10. В **консоль диспетчера пакетов**, выполните следующие команды, заменив *[YOUR-CONNECTION-STRING]* заполнитель строкой подключения, скопированной из Azure

    [!code-powershell[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample10.ps1)]

    ![Обновление базы данных, предназначенных для Windows Azure SQL Database](maintainable-azure-websites-managing-change-and-scale/_static/image30.png "обновления базы данных, предназначенных для базы данных SQL Windows Azure")

    *Обновление базы данных, предназначенных для базы данных SQL Azure*

<a id="Ex2Task3"></a>
#### <a name="task-3--deploying-geek-quiz-to-staging-using-git"></a>Задача 3 – развертывание Компьютерщик тест в промежуточную среду с помощью Git

В этой задаче будет включить промежуточную публикацию в веб-приложении. Затем будет использовать Git для публикации приложения Quiz Компьютерщик непосредственно с локального компьютера в промежуточной среде, веб-приложения.

1. Вернитесь на портал и щелкните имя веб-приложения в разделе **имя** столбец для отображения страницы управления.

    ![Открытие приложения управления веб-страниц](maintainable-azure-websites-managing-change-and-scale/_static/image31.png)

    *Открытие приложения управления веб-страниц*
2. Перейдите к **масштабирования** страницы. В разделе **Общие** выберите **стандартный** конфигурации и нажмите кнопку **Сохранить** на панели команд.

    > [!NOTE]
    > Запускать все веб-приложения в текущей области и подписки в **стандартный** режим, оставьте **выбрать все** флажком в **выберите сайты** конфигурации. В противном случае снимите **выбрать все** "флажок".

    ![Обновление веб-приложения до стандартного режима](maintainable-azure-websites-managing-change-and-scale/_static/image32.png "повышения веб-приложения до стандартного режима")

    *Обновление до стандартного режима веб-приложения*
3. Нажмите кнопку **Да** для подтверждения изменения.

    ![Подтверждение изменений до стандартного режима](maintainable-azure-websites-managing-change-and-scale/_static/image33.png "продолжить изменение режима web app")

    *Подтверждение изменений до стандартного режима*
4. Перейдите к **панели мониторинга** и нажмите кнопку **Enable промежуточная публикация** под **быстрый обзор** раздел.

    ![Позволяют использовать промежуточную публикацию](maintainable-azure-websites-managing-change-and-scale/_static/image34.png "Включение промежуточная публикация")

    *Позволяют использовать промежуточную публикацию*
5. Нажмите кнопку **Да** Чтобы включить промежуточную публикацию.

    ![Подтверждение промежуточная публикация](maintainable-azure-websites-managing-change-and-scale/_static/image35.png "нажав кнопку Да, чтобы включить промежуточную публикацию")

    *Подтверждение для промежуточной публикации*
6. В списке веб-приложений разверните знак слева от вашего имени веб-приложения для отображения слот промежуточного сайта. Он имеет имя веб-приложения, за которым следует ***(промежуточный)***. Щелкните промежуточный сайт, чтобы перейти на страницу управления.

    ![Переход к промежуточному веб-приложению](maintainable-azure-websites-managing-change-and-scale/_static/image36.png "переход к промежуточному веб-приложению")

    *Переход к промежуточного приложения*
7. Обратите внимание, что эту страницу управления он выглядит как страница управления любого другого веб-приложения. Перейдите к **развертываний** страницы и скопируйте **URL-адрес Git** значение. Он понадобится позже в этом упражнении.

    ![Копирование URL-адрес Git](maintainable-azure-websites-managing-change-and-scale/_static/image37.png)

    *Копирование URL-адрес Git*
8. Откройте новую **Git Bash** консоли и выполните следующие команды. Обновление *[YOUR-APPLICATION-PATH]* заполнитель с путем к **GeekQuiz** решения, расположенный в **Source\Ex1 DeployingWebSiteToStaging\Begin** папку Это лабораторное занятие.

    [!code-console[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample11.cmd)]

    ![Инициализация Git и первой фиксации](maintainable-azure-websites-managing-change-and-scale/_static/image38.png)

    *Инициализация Git и первой фиксации*
9. Выполните следующую команду для отправки изменений в удаленный веб-приложения **Git** репозитория. Замените заполнитель URL-адрес, полученный с портала управления. Вам будет предложено ввести пароль развертывания.

    [!code-console[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample12.cmd)]

    ![Отправка в Windows Azure](maintainable-azure-websites-managing-change-and-scale/_static/image39.png)

    *Отправка в Azure*

    > [!NOTE]
    > При развертывании содержимого на FTP-узле или репозитории GIT веб-приложения, нужно пройти аутентификацию с помощью **учетные данные развертывания** , созданный на основе веб приложения **быстрый запуск** или **панели мониторинга**  страниц управления. Если вы не знаете, учетные данные развертывания вы можете легко сбросить их с помощью портала управления. Откройте веб-приложение **панели мониторинга** и нажмите кнопку **сбросить учетные данные развертывания** ссылку. Укажите новый пароль и нажмите кнопку **ОК**. Учетные данные развертывания могут использоваться для всех веб-приложений, связанных с вашей подпиской.
10. Чтобы проверить веб-приложение было успешно отправлено в Azure, вернитесь на портал управления и нажмите кнопку **веб-сайтов**.
11. Найдите веб-приложения и разверните запись для отображения слот промежуточного сайта. Щелкните его **имя** чтобы перейти на страницу управления.
12. Нажмите кнопку **развертываний** для см. в разделе **журнала развертывания**. Убедитесь в наличии **активное развертывание** с вашей  *&quot;начальной фиксации&quot;*.

    ![Активное развертывание](maintainable-azure-websites-managing-change-and-scale/_static/image40.png)

    *Активное развертывание*
13. Наконец, нажмите кнопку **Обзор** на панели команд, чтобы перейти на веб-приложения.

    ![Обзор веб-приложения](maintainable-azure-websites-managing-change-and-scale/_static/image41.png)

    *Обзор веб-приложения*
14. Если приложение успешно развернуто, вы увидите страницу входа Компьютерщик тест.

    > [!NOTE]
    > URL-адрес развернутого приложения содержит имя веб-приложения, за которым следует *-промежуточных*.

    ![Приложения, работающего в промежуточной среде](maintainable-azure-websites-managing-change-and-scale/_static/image42.png)

    *Приложения, работающего в промежуточной среде*
15. Если вы хотите просмотреть приложение, нажмите кнопку **зарегистрировать** для регистрации нового пользователя. Выполните действия, учетной записи, указав имя пользователя, адрес электронной почты и пароль. Затем приложение показывает первый вопрос головоломки. Ответьте на несколько вопросов, чтобы убедиться в том, что оно работает должным образом.

    ![Приложения готовы к использованию](maintainable-azure-websites-managing-change-and-scale/_static/image43.png)

    *Приложения готовы к использованию*

<a id="Ex2Task4"></a>
#### <a name="task-4--promoting-the-web-app-to-production"></a>Задача 4 — повышение уровня веб-приложения в рабочей среде

Теперь, когда вы убедились, что веб-приложение работает правильно, в промежуточной среде, можно приступать к его распространение в рабочей среде. В этой задаче будет переключить слот промежуточного сайта узла на рабочий слот.

1. Вернитесь на портал управления и выберите слот промежуточного сайта. Нажмите кнопку **замены** на панели команд.

    ![На производственную](maintainable-azure-websites-managing-change-and-scale/_static/image44.png)

    *На производственную*
2. Нажмите кнопку **Да** в диалоговом окне подтверждения, чтобы продолжить операцию замены. Azure будет немедленно Замените содержимое на рабочем сайте с помощью содержимого промежуточного сайта.

    > [!NOTE]
    > Некоторые параметры из промежуточную версию будет автоматически копироваться в рабочей версии, (например строка соединения переопределений, сопоставления обработчика т. д.), но другие параметры не изменится (например конечные точки DNS, SSL-привязки, и т.д.).

    ![Подтверждение операции замены](maintainable-azure-websites-managing-change-and-scale/_static/image45.png)

    *Подтверждение операции замены*
3. После завершения переключения выберите рабочий слот и нажмите кнопку **Обзор** на панели команд, чтобы открыть на рабочем сайте. Обратите внимание, что URL-адрес в адресной строке.

    > [!NOTE]
    > Может потребоваться обновить браузер, чтобы очистить кэш. В Internet Explorer, это можно сделать, нажав клавишу **CTRL + R**.

    ![Веб-приложения в рабочей среде](maintainable-azure-websites-managing-change-and-scale/_static/image46.png)
4. В **GitBash** консоли, обновите удаленный URL-адрес локального репозитория Git для нацеливания на рабочий слот. Чтобы сделать это, выполните следующую команду, заменив заполнители имя пользователя для развертывания и имя веб-приложения.

    > [!NOTE]
    > В следующих упражнениях изменения будут переданы на рабочий сайт вместо промежуточной для простоты мы лаборатории. В реальной ситуации рекомендуется проверить изменения в промежуточной среде перед повышением роли в рабочей среде.

    [!code-console[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample13.cmd)]

<a id="Exercise3"></a>
### <a name="exercise-3-performing-deployment-rollback-in-production"></a>Упражнение 3. Выполняя откат развертывания в рабочей среде

Существуют сценарии, где у вас нет промежуточный слот развертывания для выполнения горячей замены между промежуточной и рабочей среде, например, если вы работаете с **бесплатный** или **Shared** режим. В этих случаях следует протестировать приложение в тестовой среде — локально или на удаленном сайте — перед развертыванием в рабочей среде. Тем не менее существует возможность, что проблема не обнаруживается во время этапа тестирования может возникнуть на рабочем сайте. В этом случае важно иметь механизм легко переключиться на предыдущий и стабильнее версию приложения как можно быстрее.

В **службе приложений Azure**, непрерывное развертывание из системы управления версиями делает это возможно благодаря **повторно развернуть** действии, доступном на портале управления. Azure отслеживает развертываний, которые связаны с фиксациями, отправлен в репозиторий и предоставляет возможность повторного развертывания приложения с помощью любого из предыдущих развертываний, в любое время.

В этом упражнении будет выполнять изменений в код в **Quiz Компьютерщик** приложение, которое намеренно внедряет *ошибки*. Вы развернете приложение в рабочей среде, чтобы просмотреть ошибку, и можно будет воспользоваться преимуществами функции повторного развертывания, чтобы вернуться к предыдущему состоянию.

<a id="Ex3Task1"></a>
#### <a name="task-1--updating-the-geek-quiz-application"></a>Задача 1 – обновление приложения Quiz Компьютерщик

В этой задаче будет рефакторинг небольшой фрагмент кода из **TriviaController** класса для извлечения часть логики, которая извлекает выбранный тестирование из базы данных в новый метод.

1. Перейдите к экземпляру Visual Studio с **GeekQuiz** решение из предыдущего упражнения.
2. В **обозревателе решений**откройте **TriviaController.cs** внутри **контроллеров** папки.
3. Найдите **StoreAsync** метод и выберите код, выделенный на рисунке ниже.

    ![Выберите код](maintainable-azure-websites-managing-change-and-scale/_static/image47.png)

    *Выберите код*
4. Щелкните правой кнопкой мыши выделенный код, разверните узел **рефакторинг** меню и выберите **извлечение метода...** .

    ![Извлечение кода как новый метод](maintainable-azure-websites-managing-change-and-scale/_static/image48.png)

    *Выбор метода извлечения*
5. В **извлечение метода** диалоговом окне имя нового метода *MatchesOption* и нажмите кнопку **ОК**.

    ![Указывая имя метода](maintainable-azure-websites-managing-change-and-scale/_static/image49.png)

    *Указание имени для извлечения метода*
6. Выделенный код затем извлекается в **MatchesOption** метод. В следующем фрагменте показан итоговый код.

    [!code-csharp[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample14.cs)]
7. Нажмите клавишу **CTRL + S** для сохранения изменений.

<a id="Ex3Task2"></a>
#### <a name="task-2--redeploying-the-geek-quiz-application"></a>Задача 2 — повторного развертывания приложения Quiz Компьютерщик

Теперь будет перенести изменения, внесенные в предыдущей задаче, в хранилище, которое будет активировать новое развертывание в рабочей среде. Затем будет устраняются проблемы с помощью **средства разработки F12** обеспечивает Internet Explorer, а затем выполнить откат для предыдущего развертывания на портале управления Azure.

1. Откройте новую **Git Bash** консоли, чтобы развернуть обновленное приложение в службе приложений Azure.
2. Выполните следующие команды для внесения изменений в Azure. Обновление *[YOUR-APPLICATION-PATH]* заполнитель с путем к **GeekQuiz** решения. Вам будет предложено ввести пароль развертывания.

    [!code-console[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample15.cmd)]

    ![Отправка оптимизированный код поясняется в Azure](maintainable-azure-websites-managing-change-and-scale/_static/image50.png)

    *Отправка оптимизированный код поясняется в Azure*
3. Откройте Internet Explorer и перейдите к веб-приложения (например `http://<your-web-site>.azurewebsites.net`). Вход с помощью ранее созданные учетные данные.
4. Нажмите клавишу **F12** для запуска средства разработки, выберите **сети** вкладку и нажмите кнопку **воспроизведение** кнопку, чтобы начать запись.

    ![Запуск записи сетевых](maintainable-azure-websites-managing-change-and-scale/_static/image51.png "начиная запись сети")

    *Начальная запись сети*
5. Выберите любой параметр головоломки. Вы увидите, что ничего не происходит.
6. В **F12** окна, элемент, соответствующий HTTP-запроса POST показывает HTTP **500** результат.

    ![HTTP 500 ошибок](maintainable-azure-websites-managing-change-and-scale/_static/image52.png)

    *HTTP 500 ошибок*
7. Выберите **консоли** вкладки. Регистрирует ошибку в журнале с описанием причины.

    ![Записанная ошибка](maintainable-azure-websites-managing-change-and-scale/_static/image53.png)

    *Записанная ошибка*
8. Найдите часть сведений об ошибке. Очевидно Эта ошибка вызвана кода, рефакторинг вы зафиксирована на предыдущих шагах.

    `Details: LINQ to Entities does not recognize the method 'Boolean MatchesOption ...`.
9. Не закрывайте браузер.
10. В новом экземпляре браузера, перейдите к [портал управления Azure](https://manage.windowsazure.com) и войдите с использованием учетной записи Майкрософт, связанную с вашей подпиской.
11. Выберите **веб-сайтов** и нажмите кнопку веб-приложения, созданный в упражнении 2.
12. Перейдите к **развертываний** страницы. Обратите внимание, что выполнены все фиксации, перечислены в журнале развертывания.

    ![Список существующих развертываний](maintainable-azure-websites-managing-change-and-scale/_static/image54.png)

    *Список существующих развертываний*
13. Выберите предыдущую фиксацию и нажмите кнопку **повторно развернуть** на панели команд.

    ![Повторное развертывание предыдущую фиксацию](maintainable-azure-websites-managing-change-and-scale/_static/image55.png)

    *Повторное развертывание предыдущую фиксацию*
14. При появлении запроса на подтверждение, щелкните **Да**.

    ![Подтверждение повторного развертывания](maintainable-azure-websites-managing-change-and-scale/_static/image56.png)
15. После завершения развертывания переключитесь обратно в экземпляре обозревателя с веб-приложения и нажмите клавишу **CTRL + F5**.
16. Щелкните любой из параметров. Подготовить и результат, теперь потребует переворачивающейся анимации (*и неуспешных*) будет отображаться.
17. (Необязательно) Переключиться в режим **Git Bash** консоли и выполните следующие команды, чтобы вернуться к предыдущей операции фиксации.

    > [!NOTE]
    > Эти команды создают новую фиксацию, которая отменяет все изменения в репозитории Git, которые были внесены в неверный фиксации. Azure затем будет повторное развертывание приложения с помощью новой фиксации.

    [!code-console[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample16.cmd)]

<a id="Exercise4"></a>
### <a name="exercise-4-scaling-using-azure-storage"></a>Упражнение 4. Масштабирование с помощью службы хранилища Azure

**Большие двоичные объекты** — самый простой способ хранения больших объемов неструктурированных текстовых или двоичных данных, таких как видео, аудио и изображения. Перемещение статическое содержимое приложения в хранилище, позволяет масштабировать приложение, обслуживание изображений или документов непосредственно в браузере.

В этом упражнении будет выполнено перемещение статическое содержимое приложения в контейнер больших двоичных объектов. Затем необходимо будет настроить приложение таким образом, чтобы добавить **правила переопределения URL-адреса ASP.NET** в **Web.config** для перенаправления содержимое в контейнер больших двоичных объектов.

<a id="Ex4Task1"></a>
#### <a name="task-1--creating-an-azure-storage-account"></a>Задача 1 – Создание учетной записи хранения Azure

В этой задаче вы узнаете, как создать учетную запись хранения с помощью портала управления.

1. Перейдите к [портал управления Azure](https://manage.windowsazure.com) и войдите с использованием учетной записи Майкрософт, связанную с вашей подпиской.
2. Выберите **New | Службы Data Services | Хранилище | Быстрое создание** Чтобы приступить к созданию новой учетной записи хранения. Введите уникальное имя для учетной записи и выберите **регион** из списка. Нажмите кнопку **создать учетную запись хранения** для продолжения.

    ![Создание учетной записи хранения](maintainable-azure-websites-managing-change-and-scale/_static/image57.png "Создание учетной записи хранения")

    *Создание учетной записи хранения*
3. В **хранения** разделе, подождите, пока состояние учетной записи хранения изменится на *Online* чтобы продолжить на следующем шаге.

    ![Созданную учетную запись хранения](maintainable-azure-websites-managing-change-and-scale/_static/image58.png "созданной учетной записи хранения")

    *Созданную учетную запись хранения*
4. Щелкните имя учетной записи хранения и нажмите кнопку **панели мониторинга** ссылку в верхней части страницы. **Панели мониторинга** страница содержит сведения о состоянии учетной записи и конечные точки службы, которые могут использоваться в приложениях.

    ![Отображение панели мониторинга учетной записи хранения](maintainable-azure-websites-managing-change-and-scale/_static/image59.png "отображение панели мониторинга учетной записи хранения")

    *Отображение панели мониторинга учетной записи хранения*
5. Нажмите кнопку **управление ключами доступа** кнопки на панели навигации.

    !["Управление ключами доступа"](maintainable-azure-websites-managing-change-and-scale/_static/image60.png "кнопку Управление ключами доступа")

    *Управление кнопкой "ключи доступа"*
6. В **управление ключами доступа** диалоговое окно, скопируйте **имя учетной записи хранения** и **первичный ключ доступа** так, как они понадобятся в следующем упражнении. Закройте диалоговое окно.

    ![Диалоговое окно Управление ключом доступа](maintainable-azure-websites-managing-change-and-scale/_static/image61.png "диалоговое окно «Управление ключами доступа»")

    *Ключ доступа диалоговое окно управления*

<a id="Ex4Task2"></a>
#### <a name="task-2--uploading-an-asset-to-azure-blob-storage"></a>Задача 2 – Отправка ресурс-контейнер в хранилище BLOB-объектов Azure

В этой задаче в окне обозревателя серверов в Visual Studio будет использовать для подключения к вашей учетной записи хранения. Затем будет создайте контейнер больших двоичных объектов и отправить файл с логотипом Компьютерщик тест в контейнер.

1. Перейдите к экземпляру Visual Studio с **GeekQuiz** решение из предыдущего упражнения.
2. В строке меню выберите **представление** и нажмите кнопку **обозревателя серверов**.
3. В **обозревателя серверов**, щелкните правой кнопкой мыши **Azure** узел и выберите **подключение к Azure...** . Вход с учетной записью Майкрософт, связанную с вашей подпиской.

    ![Подключение к Windows Azure](maintainable-azure-websites-managing-change-and-scale/_static/image62.png)

    *Подключение к Azure*
4. Разверните **Azure** узел, щелкните правой кнопкой мыши **хранения** и выберите **присоединить внешнее хранилище...** .
5. В **добавить новую учетную запись хранения** диалогового окна введите **имя учетной записи** и **ключ учетной записи** полученный в предыдущей задаче и нажмите кнопку **ОК**.

    ![Добавление новой учетной записи хранения-диалоговое окно](maintainable-azure-websites-managing-change-and-scale/_static/image63.png)

    *Добавление новой учетной записи хранения-диалоговое окно*
6. Учетной записи хранения должен появиться узел **хранения** узла. Разверните свою учетную запись хранения, щелкните правой кнопкой мыши **большие двоичные объекты** и выберите **создать контейнер BLOB-объектов...** .

    ![Создайте контейнер больших двоичных объектов](maintainable-azure-websites-managing-change-and-scale/_static/image64.png "создать контейнер больших двоичных объектов")

    *Создайте контейнер больших двоичных объектов*
7. В **создать контейнер больших двоичных объектов** диалогового окна введите имя контейнера больших двоичных объектов и нажмите кнопку **ОК**.

    ![Диалоговое окно Создание контейнера больших двоичных объектов](maintainable-azure-websites-managing-change-and-scale/_static/image65.png "диалоговое окно создания контейнера больших двоичных объектов")

    *Создание диалогового окна контейнера больших двоичных объектов*
8. Новый контейнер больших двоичных объектов, которые должны добавляться к **большие двоичные объекты** узла. Измените разрешения доступа в контейнере, чтобы сделать контейнер общедоступным. Чтобы сделать это, щелкните правой кнопкой мыши **образы** контейнер и выберите **свойства**.

    ![свойства контейнера изображений](maintainable-azure-websites-managing-change-and-scale/_static/image66.png "свойства контейнера изображений")

    *Свойства образа контейнера*
9. В **свойства** окне **общий доступ на чтение** для **контейнера**.

    ![Изменение свойства общего доступа на чтение](maintainable-azure-websites-managing-change-and-scale/_static/image67.png "изменение свойства общего доступа на чтение")

    *Изменение свойства общего доступа на чтение*
10. При появлении запроса, если действительно требуется изменить свойства общего доступа, нажмите кнопку **Да**.

    ![Microsoft Visual Studio предупреждение](maintainable-azure-websites-managing-change-and-scale/_static/image68.png "предупреждение Microsoft Visual Studio")

    *Microsoft Visual Studio предупреждение*
11. В **обозревателя серверов**, щелкните правой кнопкой мыши в **образы** контейнер больших двоичных объектов и выберите **контейнер больших двоичных объектов представления**.

    ![Просмотреть контейнер больших двоичных объектов](maintainable-azure-websites-managing-change-and-scale/_static/image69.png "просмотреть контейнер больших двоичных объектов")

    *Представление контейнера больших двоичных объектов*
12. Образы контейнеров следует открыть в новом окне и отображать условные обозначения без элементов. Нажмите кнопку **отправить** значок, чтобы отправить файл в контейнер больших двоичных объектов.

    ![Образы контейнеров без элементов](maintainable-azure-websites-managing-change-and-scale/_static/image70.png "образы контейнеров без элементов")

    *Образы контейнеров без элементов*
13. В **отправки большого двоичного объекта** диалогового окна выберите **активы** папку лаборатории. Выберите **логотип big.png** файл и нажмите кнопку **откройте**.
14. Подождите, пока файл передается. По завершении отправки файл должен быть указан в контейнере изображения. Щелкните правой кнопкой мыши запись файла и выберите **Копировать URL-адрес**.

    ![Скопируйте URL-адрес большого двоичного объекта](maintainable-azure-websites-managing-change-and-scale/_static/image71.png "скопируйте URL-адрес файла BLOB-объектов")

    *Скопируйте URL-адрес BLOB-объектов*
15. Откройте Internet Explorer и вставьте URL-адрес. В обозревателе, должно быть показано ниже.

    ![Логотип big.png изображения из хранилища больших двоичных объектов Windows](maintainable-azure-websites-managing-change-and-scale/_static/image72.png "big.png логотип изображения из хранилища")

    *Логотип big.png изображения из хранилища BLOB-объектов Azure*

<a id="Ex4Task3"></a>
#### <a name="task-3--updating-the-solution-to-consume-static-content-from-azure-blob-storage"></a>Задача 3 – обновление решения для использования статического содержимого из хранилища BLOB-объектов Azure

В этой задаче вы настроите **GeekQuiz** решение, чтобы использовать изображение отправлен в хранилище BLOB-объектов Azure (вместо образа, расположенного в веб-приложения), добавив правило переопределения URL-адреса ASP.NET в **web.config**файл.

1. В Visual Studio откройте **Web.config** внутри **GeekQuiz** проекта и найдите **&lt;system.webServer&gt;** элемент.
2. Добавьте следующий код, чтобы добавить URL-адрес правила переопределения, обновление заполнитель именем учетной записи хранения.

    (Code Snippet - *UrlRewriteRule WebSitesInProduction - Ex4 -*)

    [!code-xml[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample17.xml)]

    > [!NOTE]
    > Переопределение URL-адресов — это процесс перехвата входящего веб-запроса и перенаправляет их на другой ресурс. Правила переписывания URL подсистема переписывания при необходимости перенаправить запрос и куда они должны перенаправляться. Переписывания правило состоит из двух строк: шаблон для поиска в запрошенного URL-адреса (как правило, с помощью регулярных выражений), и строка для замены шаблона, в том случае, если найдена. Дополнительные сведения см. в разделе [переписывание URL-адресов в ASP.NET](https://msdn.microsoft.com/library/ms972974.aspx).
3. Нажмите клавишу **CTRL + S** для сохранения изменений.
4. Откройте новую **Git Bash** консоли, чтобы развернуть обновленное приложение в службе приложений Azure.
5. Выполните следующие команды для внесения изменений в Azure. Обновление *[YOUR-APPLICATION-PATH]* заполнитель с путем к **GeekQuiz** решения. Вам будет предложено ввести пароль развертывания.

    [!code-console[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample18.cmd)]

    ![Развертывание обновления в Azure](maintainable-azure-websites-managing-change-and-scale/_static/image73.png)

    *Развертывание обновления в Azure*

<a id="Ex4Task4"></a>
#### <a name="task-4--verification"></a>Задача 4 – Проверка

В этой задаче вы воспользуетесь **Internet Explorer** для просмотра **Quiz Компьютерщик** приложения и установите флажок, что URL-адрес перепишите правило для образов сработало правильно и вы будете перенаправлены на образ, размещенный в **BLOB-объектов Azure Хранилище**.

1. Откройте Internet Explorer и перейдите к веб-приложения (например `http://<your-web-site>.azurewebsites.net`). Вход с помощью ранее созданные учетные данные.

    ![Отображение веб-приложение Quiz Компьютерщик с изображением](maintainable-azure-websites-managing-change-and-scale/_static/image74.png "отображение веб-приложение Quiz Компьютерщик с изображением")

    *Отображение веб-приложение Quiz Компьютерщик с изображением*
2. Нажмите клавишу **F12** для запуска средства разработки, выберите **сети** вкладку и начните запись.

    ![Запуск записи сетевых](maintainable-azure-websites-managing-change-and-scale/_static/image75.png "начиная запись сети")

    *Начальная запись сети*
3. Нажмите клавишу **CTRL + F5** для обновления веб-страницы.
4. После завершения загрузки страницы вы увидите HTTP-запроса для **/img/logo-big.png** URL-адрес с помощью HTTP **301** результат (перенаправление), а также выполнить другой запрос для `http://[YOUR-STORAGE-ACCOUNT].blob.core.windows.net/images/logo-big.png` URL-адрес с помощью HTTP **200** результат.

    ![Проверка URL-адрес перенаправления](maintainable-azure-websites-managing-change-and-scale/_static/image76.png "отображение перенаправления в средствах разработки")

    *Проверка URL-адрес перенаправления*

<a id="Exercise5"></a>
### <a name="exercise-5-using-autoscale-for-web-apps"></a>Упражнение 5. С помощью автоматического масштабирования для веб-приложений

> [!NOTE]
> В этом упражнении является необязательным, так как она требует поддержки веб-нагрузку &amp; тестирования производительности, который доступен только для **Visual Studio 2013 Ultimate Edition**. Дополнительные сведения об определенных функциях Visual Studio 2013 сравнить версии [здесь](https://www.microsoft.com/visualstudio/eng/products/compare).


**Azure веб-приложения службы** предоставляет функцию автомасштабирования для веб-приложений, работающих в **стандартный режим**. Автоматическое масштабирование помогает Azure автоматически масштабировала число экземпляров веб-приложения в зависимости от нагрузки. Если Автомасштабирование включено, Azure проверяет нагрузку ЦП для веб-приложения один раз каждые пять минут и добавляет экземпляры при необходимости в определенный момент времени. Если ЦП низкая, Azure убирает экземпляры каждые два часа, чтобы убедиться, что не снижается производительность веб-приложения.

В этом упражнении будут рассмотрены шаги, необходимые для настройки **автомасштабирования** возможностей **Quiz Компьютерщик** веб-приложения. Эта функция проверит, выполнив нагрузочного теста Visual Studio для создания достаточной нагрузки ЦП в приложении, чтобы активировать обновление экземпляра.

<a id="Ex5Task1"></a>
#### <a name="task-1--configuring-autoscale-based-on-the-cpu-metric"></a>Задача 1 – Настройка автоматического масштабирования на основе метрики ЦП

В этой задаче будут использовать портал управления Azure для включения функции автоматического масштабирования для веб-приложения, созданный в упражнении 2.

1. В [портал управления Azure](https://manage.windowsazure.com/)выберите **веб-сайтов** и нажмите кнопку веб-приложения, созданный в упражнении 2.
2. Перейдите к **масштабирования** страницы. В разделе **емкость** выберите **ЦП** для **масштабирование по метрике** конфигурации.

    > [!NOTE]
    > При масштабировании по ЦП, Azure динамически регулирует количество экземпляров, которые использует приложение, если ЦП изменяется.

    ![При выборе масштабирование по ЦП](maintainable-azure-websites-managing-change-and-scale/_static/image77.png "Выбор метрики ЦП для автоматического масштабирования")

    *При выборе масштабирование по ЦП*
3. Изменение **целевой ЦП** конфигурацию, чтобы **20**-**40** процентов.

    > [!NOTE]
    > Этот диапазон представляет среднее использование ЦП для веб-приложения. Azure будет добавлять или удалять экземпляры, чтобы удержать веб-приложения в этом диапазоне. Минимальное и максимальное число экземпляров, используемых для масштабирования указывается в **число экземпляров** конфигурации. Azure никогда не перейдем выше или за рамками этого ограничения.
    >
    > Значение по умолчанию **целевой ЦП** значения изменяются только в целях этой лаборатории. Настроив диапазон ЦП с небольшими значениями, расширить возможности для триггера автомасштабирования, когда Средняя нагрузка на приложение.

    ![Изменение целевой ЦП, чтобы быть в диапазоне от 20 до 40 процентов](maintainable-azure-websites-managing-change-and-scale/_static/image78.png "Изменение целевой ЦП находиться в диапазоне от 20 до 40 процентов")

    *Изменение целевой ЦП, чтобы быть в диапазоне от 20 до 40 процентов*
4. Нажмите кнопку **Сохранить** на панели команд, чтобы сохранить изменения.

<a id="Ex5Task2"></a>
#### <a name="task-2--load-testing-with-visual-studio"></a>Задача 2 — нагрузочного тестирования с помощью Visual Studio

Теперь, когда **автомасштабирования** была настроена, вы создадите **веб-тестами производительности и загрузить тестовый проект** в Visual Studio создать нагрузку на ЦП на веб-приложения.

1. Откройте **Visual Studio Ultimate 2013** и выберите **файл | Новые | Проект...**  для запуска нового решения.

    ![Создание нового проекта](maintainable-azure-websites-managing-change-and-scale/_static/image79.png "создания нового проекта")

    *Создание нового проекта*
2. В **новый проект** выберите **веб-тестами производительности и нагрузочных тестов** под **Visual C# | Тест** вкладки. Убедитесь, что **.NET Framework 4.5** — флажок установлен, назовите проект *WebAndLoadTestProject*, выберите **расположение** и нажмите кнопку **ОК**.

    ![Создание проекта нагрузочного теста и веб-](maintainable-azure-websites-managing-change-and-scale/_static/image80.png "создания нагрузочного теста и веб-проекта")

    *Создание нового проекта веб- и нагрузочного теста*
3. В **WebTest1.webtest** щелкните правой кнопкой мыши **WebTest1** узел и нажмите кнопку **добавить запрос**.

    ![Добавление запроса в WebTest1](maintainable-azure-websites-managing-change-and-scale/_static/image81.png "Добавление WebTest1 запрос")

    *Добавление запроса в WebTest1*
4. В **свойства** окно нового запроса узла, обновить **URL-адрес** свойство, чтобы они указывали на URL-адрес веб-приложения (например *[ http://geek-quiz.azurewebsites.net/ ](http://geek-quiz.azurewebsites.net/)*).

    ![Изменение свойства URL-адрес](maintainable-azure-websites-managing-change-and-scale/_static/image82.png "изменения свойства URL-адрес")

    *Изменение свойства URL-адрес*
5. В **WebTest1.webtest** окно, щелкните правой кнопкой мыши **WebTest1** и нажмите кнопку **добавить цикл...** .

    ![Добавление цикла WebTest1](maintainable-azure-websites-managing-change-and-scale/_static/image83.png "Добавление цикла WebTest1")

    *Добавление цикла WebTest1*
6. В **Добавьте условное правило и элементы в цикл** выберите **цикл For** правила и измените следующие свойства.

   1. **Конечное значение:** 1000.
   2. **Имя параметра контекста:** Итератор
   3. **Значение приращения:** 1

      ![Выберите правило для цикла и обновления свойств](maintainable-azure-websites-managing-change-and-scale/_static/image84.png "выбирая правило для цикла и обновление свойств")

      *Выберите правило для цикла и обновление свойств*
7. В разделе **элементы в цикле** выберите запрос, созданный ранее первого и последнего элемента для цикла. Нажмите кнопку **ОК** , чтобы продолжить.

    ![Выбрав первый и последний элемент цикла for](maintainable-azure-websites-managing-change-and-scale/_static/image85.png "выбрав первый и последний элемент цикла")

    *Выбрав первый и последний элемент цикла*
8. В **обозревателе решений**, щелкните правой кнопкой мыши **WebAndLoadTestProject** проекта, разверните **добавить** меню и выберите **нагрузочный тест...** .

    ![Добавление нагрузочного теста в проект WebAndLoadTestProject](maintainable-azure-websites-managing-change-and-scale/_static/image86.png "Добавление в проект WebAndLoadTestProject нагрузочного теста")

    *Добавление в проект WebAndLoadTestProject нагрузочного теста*
9. В **мастера тестовой нагрузки** диалоговом окне щелкните **Далее**.

    ![Мастер тестовой нагрузки](maintainable-azure-websites-managing-change-and-scale/_static/image87.png "мастера тестовой нагрузки")

    *Мастер тестовой нагрузки*
10. В **сценарий** выберите **не указывайте время на обдумывание** и нажмите кнопку **Далее**.

    ![Выбор не следует использовать время на обдумывание](maintainable-azure-websites-managing-change-and-scale/_static/image88.png "выбор не следует использовать время на обдумывание")

    *Выбор не следует использовать время на обдумывание*
11. В **шаблон нагрузки** странице, убедитесь, что **постоянной нагрузки** выбран параметр. Изменение **число пользователей** присвоить **250** пользователей и нажмите кнопку **Далее**.

    ![Изменение число пользователей до 250](maintainable-azure-websites-managing-change-and-scale/_static/image89.png "изменение число пользователей на 250")

    *Изменить число пользователей на 250*
12. В **модель тестового набора** выберите **основе с последовательным упорядочиванием тестов** и нажмите кнопку **Далее**.

    ![Выбор модели тестового набора](maintainable-azure-websites-managing-change-and-scale/_static/image90.png "Выбор модели тестового набора")

    *Выбор модели тестового набора*
13. В **модель тестового набора** щелкните **добавить...**  Добавление теста в набор.

    ![Добавление теста в тестовом наборе](maintainable-azure-websites-managing-change-and-scale/_static/image91.png "Добавление теста в тестовый набор")

    *Добавление теста в тестовый набор*
14. В **добавить тесты** диалоговое окно, дважды щелкните **WebTest1** Чтобы добавить тест в **выбранные тесты** списка. Нажмите кнопку **ОК** , чтобы продолжить.

    ![Добавление теста WebTest1](maintainable-azure-websites-managing-change-and-scale/_static/image92.png "Добавление WebTest1 теста")

    *Добавление теста WebTest1*
15. Вернитесь в **тестового набора** щелкните **Далее**.

    ![Завершение работы страница тестового набора](maintainable-azure-websites-managing-change-and-scale/_static/image93.png "завершения работы тестового набора")

    *Завершение работы страница тестового набора*
16. В **смешанного сетевого профиля** щелкните **Далее**.

    ![Нажав кнопку Далее на странице смешанного сетевого профиля](maintainable-azure-websites-managing-change-and-scale/_static/image94.png "нажав кнопку Далее на странице смешанный сетевой профиль")

    *Нажав кнопку Далее на странице смешанный сетевой профиль*
17. В **браузеров** выберите **Internet Explorer 10.0** тип браузера и нажмите кнопку **Далее**.

    ![Выбрав тип браузера](maintainable-azure-websites-managing-change-and-scale/_static/image95.png "выбрав тип браузера")

    *Выбрав тип браузера*
18. В **наборы счетчиков** щелкните **Далее**.

    ![Нажав кнопку "Далее" на странице наборы счетчиков](maintainable-azure-websites-managing-change-and-scale/_static/image96.png "нажав кнопку \"Далее\", на странице наборы счетчиков")

    *Нажав кнопку "Далее" на странице наборы счетчиков*
19. В **параметры запуска** странице **длительность нагрузочного теста** для **5 минут** и нажмите кнопку **Готово**.

    ![Параметр длительность нагрузочного теста до 5 минут](maintainable-azure-websites-managing-change-and-scale/_static/image97.png "параметр длительность нагрузочного теста до 5 минут")

    *Параметр длительность нагрузочного теста до 5 минут*
20. В **обозревателе решений**, дважды щелкните **Local.settings** файл для просмотра параметров тестирования. По умолчанию Visual Studio использует локального компьютера для выполнения тестов.

    > [!NOTE]
    > Кроме того, можно настроить проект тестов для выполнения нагрузочных тестов в облаке с помощью **планов тестирования Azure**. Планы тестирования Azure предоставляет Облачное нагрузочное тестирование служба, которая имитирует более реалистичный нагрузки, как избежать ограничений локальной среде, например мощности ЦП, объем доступной памяти и пропускной способности сети. Дополнительные сведения об использовании Azure планы тестирования для выполнения нагрузочных тестов, см. в разделе [загрузить сценарии тестирования](/azure/devops/test/load-test/overview?view=vsts).

    ![Параметры тестирования](maintainable-azure-websites-managing-change-and-scale/_static/image98.png)

<a id="Ex5Task3"></a>
#### <a name="task-3--autoscale-verification"></a>Задача 3 – Проверка автомасштабирования

Вы выполните нагрузочный тест, созданный в предыдущей задаче и см. в разделе, как веб-приложение ведет себя под нагрузкой.

1. В **обозревателе решений**, дважды щелкните **LoadTest1.loadtest** открыть нагрузочного теста.

    ![Открыв файл LoadTest1.loadtest](maintainable-azure-websites-managing-change-and-scale/_static/image99.png "Открытие LoadTest1.loadtest")

    *Открытие LoadTest1.loadtest*
2. В **LoadTest1.loadtest** окно, нажмите первую кнопку на панели элементов для выполнения нагрузочного теста.

    ![Запуск нагрузочного теста](maintainable-azure-websites-managing-change-and-scale/_static/image100.png "нагрузочный тест")

    *Запуск нагрузочного теста*
3. Дождитесь завершения нагрузочного теста.

    > [!NOTE]
    > Нагрузочный тест моделирует несколько пользователей, которые одновременно отправлять запросы в веб-приложение. Если тест выполняется, вы можете отслеживать доступные счетчики для обнаружения ошибок, предупреждений или другие сведения о выполнении нагрузочного теста.

    ![Загрузить тест будет выполняться](maintainable-azure-websites-managing-change-and-scale/_static/image101.png "дождаться завершения нагрузочного теста")

    *Если нагрузочный тест выполняется*
4. После завершения теста, вернитесь на портал управления и перейдите к **масштабирования** страницы веб-приложения. В разделе **емкость** разделе, вы должны увидеть в графе, новый экземпляр был развернут автоматически.

    ![Автоматически развертывать новый экземпляр](maintainable-azure-websites-managing-change-and-scale/_static/image102.png)

    *Автоматически развертывать новый экземпляр*

    > [!NOTE]
    > Может занять несколько минут, чтобы изменения отобразились в графе (нажмите клавишу **CTRL + F5** периодически, чтобы обновить страницу). Если вы не видите все изменения, можно попробовать следующее:
    >
    > - Увеличьте продолжительность нагрузочного теста (например, чтобы **10 минут**)
    > - Уменьшить максимальное и минимальное значения **целевой ЦП** диапазон в конфигурации автоматического масштабирования для веб-приложения
    > - Запуск нагрузочного теста в облаке с **планов тестирования Azure**. Дополнительные сведения [здесь](/azure/devops/test/load-test/index?view=vsts)

---

<a id="Summary"></a>
## <a name="summary"></a>Сводка

В этой практической работу вы узнали, как настроить и развернуть приложение в рабочей среде веб-приложения в Azure. Вы начали путем обнаружения и обновления баз данных, используя **Entity Framework Code First Migrations**, затем продолжает выполнение развертывание новых версий своего сайта с помощью **Git** и выполнения отката для Последняя стабильная версия веб-узла. Кроме того вы узнали, как масштабировать приложение с помощью хранилища для перемещения статическое содержимое в контейнер больших двоичных объектов.
