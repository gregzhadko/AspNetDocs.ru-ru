---
uid: aspnet/overview/developing-apps-with-windows-azure/maintainable-azure-websites-managing-change-and-scale
title: 'Практическое занятие. обслуживаемые веб-сайты Azure: Управление изменениями и масштабированием | Документация Майкрософт'
author: rick-anderson
description: В этом лабораторном занятии вы узнаете, как Microsoft Azure упрощает создание и развертывание веб-сайтов в рабочей среде.
ms.author: riande
ms.date: 07/16/2014
ms.assetid: ecfd0eb4-c4ad-44e6-9db9-a2a66611ff6a
msc.legacyurl: /aspnet/overview/developing-apps-with-windows-azure/maintainable-azure-websites-managing-change-and-scale
msc.type: authoredcontent
ms.openlocfilehash: c88bae40a8aa092037c0b359ee391acaf161cf10
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78506376"
---
# <a name="hands-on-lab-maintainable-azure-websites-managing-change-and-scale"></a><span data-ttu-id="38dca-103">Практическое занятие. обслуживаемые веб-сайты Azure: Управление изменениями и масштабированием</span><span class="sxs-lookup"><span data-stu-id="38dca-103">Hands on Lab: Maintainable Azure Websites: Managing Change and Scale</span></span>

<span data-ttu-id="38dca-104">по [веб-Camp командам](https://twitter.com/webcamps)</span><span class="sxs-lookup"><span data-stu-id="38dca-104">by [Web Camps Team](https://twitter.com/webcamps)</span></span>

[<span data-ttu-id="38dca-105">Скачать обучающий комплект Web Camp</span><span class="sxs-lookup"><span data-stu-id="38dca-105">Download Web Camps Training Kit</span></span>](https://aka.ms/webcamps-training-kit)

> <span data-ttu-id="38dca-106">Microsoft Azure позволяет легко создавать и развертывать веб-сайты в рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="38dca-106">Microsoft Azure makes it easy to build and deploy websites to production.</span></span> <span data-ttu-id="38dca-107">Но вы не делаете это, когда ваше приложение активно, вы только начинаете работу!</span><span class="sxs-lookup"><span data-stu-id="38dca-107">But you're not done when your application is live, you're just getting started!</span></span> <span data-ttu-id="38dca-108">Вам потребуется выполнить обработку измененных требований, обновление базы данных, масштабирование и многое другое.</span><span class="sxs-lookup"><span data-stu-id="38dca-108">You'll need to handle changing requirements, database updates, scale, and more.</span></span> <span data-ttu-id="38dca-109">К счастью, в службе приложений Azure было рассмотрено множество функций, которые помогут обеспечить бесперебойную работу сайтов.</span><span class="sxs-lookup"><span data-stu-id="38dca-109">Fortunately, Azure App Service has you covered, with plenty of features to help you keep your sites running smoothly.</span></span>
>
> <span data-ttu-id="38dca-110">Azure предлагает безопасные и гибкие возможности разработки, развертывания и масштабирования веб-приложений любого размера.</span><span class="sxs-lookup"><span data-stu-id="38dca-110">Azure offers secure and flexible development, deployment and scaling options for any size web application.</span></span> <span data-ttu-id="38dca-111">Используйте существующие средства для создания и развертывания приложений, не загружая управляющую инфраструктуру.</span><span class="sxs-lookup"><span data-stu-id="38dca-111">Leverage your existing tools to create and deploy applications without the hassle of managing infrastructure.</span></span>
>
> <span data-ttu-id="38dca-112">Самостоятельное предоставление рабочего веб-приложения за несколько минут путем простого развертывания содержимого, созданного с помощью любимого средства разработки.</span><span class="sxs-lookup"><span data-stu-id="38dca-112">Provision a production web application yourself in minutes by easily deploying content created using your favorite development tool.</span></span> <span data-ttu-id="38dca-113">Вы можете развернуть существующий сайт непосредственно из системы управления версиями с поддержкой **git**, **GitHub**, **BitBucket**, **TFS**и даже **Dropbox**.</span><span class="sxs-lookup"><span data-stu-id="38dca-113">You can deploy an existing site directly from source control with support for **Git**, **GitHub**, **Bitbucket**, **TFS**, and even **DropBox**.</span></span> <span data-ttu-id="38dca-114">Развертывайте непосредственно из предпочтительной среды IDE или из сценариев с помощью **PowerShell** в Windows или в средствах **CLI** , работающих в любой операционной системе.</span><span class="sxs-lookup"><span data-stu-id="38dca-114">Deploy directly from your favorite IDE or from scripts using **PowerShell** in Windows or **CLI** tools running on any OS.</span></span> <span data-ttu-id="38dca-115">После развертывания постоянно обновляйте сайты благодаря поддержке непрерывного развертывания.</span><span class="sxs-lookup"><span data-stu-id="38dca-115">Once deployed, keep your sites constantly up-to-date with support for continuous deployment.</span></span>
>
> <span data-ttu-id="38dca-116">Azure предоставляет масштабируемые, надежные облачные решения для хранения, резервного копирования и восстановления любых данных, большие или небольшие.</span><span class="sxs-lookup"><span data-stu-id="38dca-116">Azure provides scalable, durable cloud storage, backup, and recovery solutions for any data, big or small.</span></span> <span data-ttu-id="38dca-117">При развертывании приложений в рабочей среде службы хранилища, такие как таблицы, большие двоичные объекты и базы данных SQL, помогают масштабировать приложение в облаке.</span><span class="sxs-lookup"><span data-stu-id="38dca-117">When deploying applications to a production environment, storage services such as Tables, Blobs and SQL Databases, help you scale your application in the cloud.</span></span>
>
> <span data-ttu-id="38dca-118">При использовании баз данных SQL важно иметь актуальную версию эффективной базы данных при развертывании новых версий приложения.</span><span class="sxs-lookup"><span data-stu-id="38dca-118">With SQL Databases, it is important to keep your productive database up-to-date when deploying new versions of your application.</span></span> <span data-ttu-id="38dca-119">Благодаря **Entity Framework Code First migrations**, разработка и развертывание модели данных были упрощены для обновления сред в течение нескольких минут.</span><span class="sxs-lookup"><span data-stu-id="38dca-119">Thanks to **Entity Framework Code First Migrations**, the development and deployment of your data model has been simplified to update your environments in minutes.</span></span> <span data-ttu-id="38dca-120">В этой практической лабораторной работе будут показаны различные темы, которые могут возникнуть при развертывании веб-приложения в рабочих средах в Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="38dca-120">This hands-on lab will show you the different topics you could encounter when deploying your web app to production environments in Microsoft Azure.</span></span>
>
> <span data-ttu-id="38dca-121">Все примеры кода и фрагментов включены в комплект обучающих курсов Web Camp, доступный по адресу [https://aka.ms/webcamps-training-kit](https://aka.ms/webcamps-training-kit).</span><span class="sxs-lookup"><span data-stu-id="38dca-121">All sample code and snippets are included in the Web Camps Training Kit, available at [https://aka.ms/webcamps-training-kit](https://aka.ms/webcamps-training-kit).</span></span>
>
> <span data-ttu-id="38dca-122">Более подробное описание этой статьи см. в статье [создание реальных облачных приложений с помощью электронной книги Azure](building-real-world-cloud-apps-with-windows-azure/introduction.md).</span><span class="sxs-lookup"><span data-stu-id="38dca-122">For more in-depth coverage of this topic, see the [Building Real-World Cloud Apps with Azure e-book](building-real-world-cloud-apps-with-windows-azure/introduction.md).</span></span>

<a id="Overview"></a>
## <a name="overview"></a><span data-ttu-id="38dca-123">Обзор</span><span class="sxs-lookup"><span data-stu-id="38dca-123">Overview</span></span>

<a id="Objectives"></a>
### <a name="objectives"></a><span data-ttu-id="38dca-124">Цели</span><span class="sxs-lookup"><span data-stu-id="38dca-124">Objectives</span></span>

<span data-ttu-id="38dca-125">В этой практической лабораторной работе вы узнаете, как выполнять следующие задачи:</span><span class="sxs-lookup"><span data-stu-id="38dca-125">In this hands-on lab, you will learn how to:</span></span>

- <span data-ttu-id="38dca-126">Включение миграции Entity Framework с помощью существующей модели</span><span class="sxs-lookup"><span data-stu-id="38dca-126">Enable Entity Framework Migrations with an existing model</span></span>
- <span data-ttu-id="38dca-127">Соответствующим образом обновите объектную модель и базу данных с помощью Entity Framework миграции</span><span class="sxs-lookup"><span data-stu-id="38dca-127">Update the object model and database accordingly using Entity Framework Migrations</span></span>
- <span data-ttu-id="38dca-128">Развертывание в службе приложений Azure с помощью Git</span><span class="sxs-lookup"><span data-stu-id="38dca-128">Deploy to Azure App Service using Git</span></span>
- <span data-ttu-id="38dca-129">Откат к предыдущему развертыванию с помощью портала управления Azure</span><span class="sxs-lookup"><span data-stu-id="38dca-129">Rollback to a previous deployment using the Azure Management portal</span></span>
- <span data-ttu-id="38dca-130">Использование службы хранилища Azure для масштабирования веб-приложения</span><span class="sxs-lookup"><span data-stu-id="38dca-130">Use Azure Storage to scale a web app</span></span>
- <span data-ttu-id="38dca-131">Настройка автоматического масштабирования для веб-приложения с помощью портал управления Azure</span><span class="sxs-lookup"><span data-stu-id="38dca-131">Configure auto-scaling for a web app using the Azure Management Portal</span></span>
- <span data-ttu-id="38dca-132">Создание и Настройка проекта нагрузочного теста в Visual Studio</span><span class="sxs-lookup"><span data-stu-id="38dca-132">Create and configure a load test project in Visual Studio</span></span>

<a id="Prerequisites"></a>
### <a name="prerequisites"></a><span data-ttu-id="38dca-133">предварительные требования</span><span class="sxs-lookup"><span data-stu-id="38dca-133">Prerequisites</span></span>

<span data-ttu-id="38dca-134">Для выполнения этой практической лабораторной работы требуется следующее:</span><span class="sxs-lookup"><span data-stu-id="38dca-134">The following is required to complete this hands-on lab:</span></span>

- <span data-ttu-id="38dca-135">[Visual Studio Express 2013 для Web](https://www.microsoft.com/visualstudio/) или более поздней версии</span><span class="sxs-lookup"><span data-stu-id="38dca-135">[Visual Studio Express 2013 for Web](https://www.microsoft.com/visualstudio/) or greater</span></span>
- [<span data-ttu-id="38dca-136">Пакет Azure SDK для .NET 2,2</span><span class="sxs-lookup"><span data-stu-id="38dca-136">Azure SDK for .NET 2.2</span></span>](https://www.microsoft.com/windowsazure/sdk/)
- [<span data-ttu-id="38dca-137">Система управления версиями GIT</span><span class="sxs-lookup"><span data-stu-id="38dca-137">GIT Version Control System</span></span>](http://git-scm.com/download)
- <span data-ttu-id="38dca-138">Подписка на Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="38dca-138">A Microsoft Azure subscription</span></span>

    - <span data-ttu-id="38dca-139">Зарегистрируйтесь для получения [бесплатной пробной версии](https://aka.ms/watk-freetrial)</span><span class="sxs-lookup"><span data-stu-id="38dca-139">Sign up for a [Free Trial](https://aka.ms/watk-freetrial)</span></span>
    - <span data-ttu-id="38dca-140">Если вы используете Visual Studio Professional, Test Professional, Premium или Ultimate с MSDN или подписчиком MSDN Platforms, активируйте [преимущества MSDN](https://aka.ms/watk-msdn) сейчас, чтобы приступить к разработке и тестированию в Azure.</span><span class="sxs-lookup"><span data-stu-id="38dca-140">If you are a Visual Studio Professional, Test Professional, Premium or Ultimate with MSDN or MSDN Platforms subscriber, activate your [MSDN benefit](https://aka.ms/watk-msdn) now to start developing and testing on Azure</span></span>
    - <span data-ttu-id="38dca-141">Участники [BizSpark](https://aka.ms/watk-bizspark) автоматически получают преимущества Azure через подписки Visual Studio Ultimate с подпиской MSDN</span><span class="sxs-lookup"><span data-stu-id="38dca-141">[BizSpark](https://aka.ms/watk-bizspark) members automatically receive the Azure benefit through their Visual Studio Ultimate with MSDN subscriptions</span></span>
    - <span data-ttu-id="38dca-142">Участники программы [Microsoft Partner Network](https://aka.ms/watk-mpn) Cloud Essentials бесплатно получают ежемесячные кредиты в Azure</span><span class="sxs-lookup"><span data-stu-id="38dca-142">Members of the [Microsoft Partner Network](https://aka.ms/watk-mpn) Cloud Essentials program receive monthly Azure credits at no charge</span></span>

<a id="Setup"></a>
### <a name="setup"></a><span data-ttu-id="38dca-143">Настройка</span><span class="sxs-lookup"><span data-stu-id="38dca-143">Setup</span></span>

<span data-ttu-id="38dca-144">Чтобы выполнить упражнения в этой практической лабораторной работе, сначала необходимо настроить среду.</span><span class="sxs-lookup"><span data-stu-id="38dca-144">In order to run the exercises in this hands-on lab, you will need to set up your environment first.</span></span>

1. <span data-ttu-id="38dca-145">Откройте проводник Windows и перейдите к **исходной** папке лаборатории.</span><span class="sxs-lookup"><span data-stu-id="38dca-145">Open Windows Explorer and browse to the lab's **Source** folder.</span></span>
2. <span data-ttu-id="38dca-146">Щелкните **Setup. cmd** правой кнопкой мыши и выберите **Запуск от имени администратора** , чтобы запустить процесс установки, который будет настраивать среду и установить фрагменты кода Visual Studio для этой лабораторной работы.</span><span class="sxs-lookup"><span data-stu-id="38dca-146">Right-click on **Setup.cmd** and select **Run as administrator** to launch the setup process that will configure your environment and install the Visual Studio code snippets for this lab.</span></span>
3. <span data-ttu-id="38dca-147">Если отображается диалоговое окно Контроль учетных записей пользователей, подтвердите действие для продолжения.</span><span class="sxs-lookup"><span data-stu-id="38dca-147">If the User Account Control dialog is shown, confirm the action to proceed.</span></span>

> [!NOTE]
> <span data-ttu-id="38dca-148">Убедитесь, что проверены все зависимости для этой лабораторной работы перед запуском программы установки.</span><span class="sxs-lookup"><span data-stu-id="38dca-148">Make sure you have checked all the dependencies for this lab before running the setup.</span></span>

<a id="CodeSnippets"></a>
### <a name="using-the-code-snippets"></a><span data-ttu-id="38dca-149">Использование фрагментов кода</span><span class="sxs-lookup"><span data-stu-id="38dca-149">Using the Code Snippets</span></span>

<span data-ttu-id="38dca-150">На протяжении всего лабораторного документа вы получите инструкции по вставке блоков кода.</span><span class="sxs-lookup"><span data-stu-id="38dca-150">Throughout the lab document, you will be instructed to insert code blocks.</span></span> <span data-ttu-id="38dca-151">Для удобства большая часть этого кода предоставляется как Visual Studio Code фрагменты, к которым можно получить доступ из Visual Studio 2013, чтобы не добавлять их вручную.</span><span class="sxs-lookup"><span data-stu-id="38dca-151">For your convenience, most of this code is provided as Visual Studio Code Snippets, which you can access from within Visual Studio 2013 to avoid having to add it manually.</span></span>

> [!NOTE]
> <span data-ttu-id="38dca-152">Каждое упражнение сопровождается начальным решением, расположенным в **начальной** папке упражнения, которое позволяет выполнять каждое упражнение независимо от других.</span><span class="sxs-lookup"><span data-stu-id="38dca-152">Each exercise is accompanied by a starting solution located in the **Begin** folder of the exercise that allows you to follow each exercise independently of the others.</span></span> <span data-ttu-id="38dca-153">Имейте в виду, что фрагменты кода, добавленные во время упражнения, отсутствуют в этих начальных решениях и могут не работать, пока вы не завершите упражнение.</span><span class="sxs-lookup"><span data-stu-id="38dca-153">Please be aware that the code snippets that are added during an exercise are missing from these starting solutions and may not work until you have completed the exercise.</span></span> <span data-ttu-id="38dca-154">В исходном коде для упражнения также будет найдена **Конечная** папка, содержащая решение Visual Studio с кодом, полученным в результате выполнения шагов в соответствующем упражнении.</span><span class="sxs-lookup"><span data-stu-id="38dca-154">Inside the source code for an exercise, you will also find an **End** folder containing a Visual Studio solution with the code that results from completing the steps in the corresponding exercise.</span></span> <span data-ttu-id="38dca-155">Эти решения можно использовать в качестве руководства, если вам нужна дополнительная помощь во время работы с этой практической лабораторной работой.</span><span class="sxs-lookup"><span data-stu-id="38dca-155">You can use these solutions as guidance if you need additional help as you work through this hands-on lab.</span></span>

---

<a id="Exercises"></a>
## <a name="exercises"></a><span data-ttu-id="38dca-156">Полнят</span><span class="sxs-lookup"><span data-stu-id="38dca-156">Exercises</span></span>

<span data-ttu-id="38dca-157">Эта практическая лабораторная работа включает в себя следующие упражнения:</span><span class="sxs-lookup"><span data-stu-id="38dca-157">This hands-on lab includes the following exercises:</span></span>

1. [<span data-ttu-id="38dca-158">Использование Entity Framework миграций</span><span class="sxs-lookup"><span data-stu-id="38dca-158">Using Entity Framework Migrations</span></span>](#Exercise1)
2. [<span data-ttu-id="38dca-159">Развертывание веб-приложения для промежуточного хранения</span><span class="sxs-lookup"><span data-stu-id="38dca-159">Deploying a Web App to Staging</span></span>](#Exercise2)
3. [<span data-ttu-id="38dca-160">Выполнение отката развертывания в рабочей среде</span><span class="sxs-lookup"><span data-stu-id="38dca-160">Performing Deployment Rollback in Production</span></span>](#Exercise3)
4. [<span data-ttu-id="38dca-161">Масштабирование с помощью службы хранилища Azure</span><span class="sxs-lookup"><span data-stu-id="38dca-161">Scaling Using Azure Storage</span></span>](#Exercise4)
5. <span data-ttu-id="38dca-162">[Использование автомасштабирования для веб-приложений](#Exercise5) (необязательно для выпуска Visual Studio 2013 Ultimate)</span><span class="sxs-lookup"><span data-stu-id="38dca-162">[Using Autoscale for Web Apps](#Exercise5) (Optional for Visual Studio 2013 Ultimate edition)</span></span>

<span data-ttu-id="38dca-163">Предполагаемое время выполнения этой лабораторной работы: **75 минут**</span><span class="sxs-lookup"><span data-stu-id="38dca-163">Estimated time to complete this lab: **75 minutes**</span></span>

> [!NOTE]
> <span data-ttu-id="38dca-164">При первом запуске Visual Studio необходимо выбрать одну из предварительно определенных коллекций параметров.</span><span class="sxs-lookup"><span data-stu-id="38dca-164">When you first start Visual Studio, you must select one of the predefined settings collections.</span></span> <span data-ttu-id="38dca-165">Каждая предопределенная коллекция разработана для соответствия определенному стилю разработки и определяет макеты окон, поведение редактора, фрагменты кода IntelliSense и параметры диалоговых окон.</span><span class="sxs-lookup"><span data-stu-id="38dca-165">Each predefined collection is designed to match a particular development style and determines window layouts, editor behavior, IntelliSense code snippets, and dialog box options.</span></span> <span data-ttu-id="38dca-166">Процедуры в этом лабораторном занятии описывают действия, необходимые для выполнения данной задачи в Visual Studio при использовании коллекции **общих параметров разработки** .</span><span class="sxs-lookup"><span data-stu-id="38dca-166">The procedures in this lab describe the actions necessary to accomplish a given task in Visual Studio when using the **General Development Settings** collection.</span></span> <span data-ttu-id="38dca-167">При выборе другой коллекции параметров для среды разработки могут возникнуть различия в действиях, которые необходимо учитывать.</span><span class="sxs-lookup"><span data-stu-id="38dca-167">If you choose a different settings collection for your development environment, there may be differences in the steps that you should take into account.</span></span>

<a id="Exercise1"></a>
### <a name="exercise-1-using-entity-framework-migrations"></a><span data-ttu-id="38dca-168">Упражнение 1. использование Entity Framework миграций</span><span class="sxs-lookup"><span data-stu-id="38dca-168">Exercise 1: Using Entity Framework Migrations</span></span>

<span data-ttu-id="38dca-169">При разработке приложения модель данных может изменяться со временем.</span><span class="sxs-lookup"><span data-stu-id="38dca-169">When you are developing an application, your data model might change over time.</span></span> <span data-ttu-id="38dca-170">Эти изменения могут повлиять на существующую модель в базе данных (если создается новая версия), и важно иметь актуальную версию базы данных, чтобы предотвратить возникновение ошибок.</span><span class="sxs-lookup"><span data-stu-id="38dca-170">These changes could affect the existing model in your database (if you are creating a new version) and it is important to keep your database up-to-date to prevent errors.</span></span>

<span data-ttu-id="38dca-171">Чтобы упростить отслеживание этих изменений в модели, **Entity Framework Code First migrations** автоматически обнаруживать изменения, сравнивающие модель с схемой базы данных, и создает конкретный код для обновления базы данных, создавая новые *версии* базы данных.</span><span class="sxs-lookup"><span data-stu-id="38dca-171">To simplify the tracking of these changes in your model, **Entity Framework Code First Migrations** automatically detect changes comparing your model with the database schema and generates specific code to update your database, creating new *versions* of your database.</span></span>

<span data-ttu-id="38dca-172">В этом упражнении показано, как включить **миграцию** для приложения и как можно легко обнаружить и создать изменения для обновления баз данных.</span><span class="sxs-lookup"><span data-stu-id="38dca-172">This exercise shows you how to enable **Migrations** for your application and how you can easily detect and generate changes to update your databases.</span></span>

<a id="Ex1Task1"></a>
#### <a name="task-1--enabling-migrations"></a><span data-ttu-id="38dca-173">Задача 1. Включение миграции</span><span class="sxs-lookup"><span data-stu-id="38dca-173">Task 1 – Enabling Migrations</span></span>

<span data-ttu-id="38dca-174">В этой задаче будут рассмотрены шаги по включению **Entity Framework Code First migrations** в базу данных " **Викторина** ", изменение модели и понимание того, как эти изменения отражаются в базе данных.</span><span class="sxs-lookup"><span data-stu-id="38dca-174">In this task, you will go through the steps of enabling **Entity Framework Code First Migrations** to the **Geek Quiz** database, changing the model and understanding how those changes are reflected in the database.</span></span>

1. <span data-ttu-id="38dca-175">Откройте Visual Studio и откройте файл решения **жееккуиз. sln** из **Source\Ex1-UsingEntityFrameworkMigrations\Begin**.</span><span class="sxs-lookup"><span data-stu-id="38dca-175">Open Visual Studio and open the **GeekQuiz.sln** solution file from **Source\Ex1-UsingEntityFrameworkMigrations\Begin**.</span></span>
2. <span data-ttu-id="38dca-176">Создайте решение, чтобы скачать и установить зависимости пакета **NuGet** .</span><span class="sxs-lookup"><span data-stu-id="38dca-176">Build the solution in order to download and install the **NuGet** package dependencies.</span></span> <span data-ttu-id="38dca-177">Для этого щелкните решение правой кнопкой мыши и выберите пункт **построить решение** или нажмите клавиши **CTRL + SHIFT + B**.</span><span class="sxs-lookup"><span data-stu-id="38dca-177">To do this, right-click the solution and click **Build Solution** or press **Ctrl + Shift + B**.</span></span>
3. <span data-ttu-id="38dca-178">В меню **Сервис** в Visual Studio выберите **Диспетчер пакетов NuGet**, а затем щелкните **консоль диспетчера пакетов**.</span><span class="sxs-lookup"><span data-stu-id="38dca-178">From the **Tools** menu in Visual Studio, select **NuGet Package Manager**, and then click **Package Manager Console**.</span></span>
4. <span data-ttu-id="38dca-179">В **консоли диспетчера пакетов**введите следующую команду и нажмите клавишу **Ввод**.</span><span class="sxs-lookup"><span data-stu-id="38dca-179">In the **Package Manager Console**, enter the following command and then press **Enter**.</span></span> <span data-ttu-id="38dca-180">Будет создана начальная миграция на основе существующей модели.</span><span class="sxs-lookup"><span data-stu-id="38dca-180">An initial migration based on the existing model will be created.</span></span>

    [!code-powershell[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample1.ps1)]

    <span data-ttu-id="38dca-181">![Включение миграции](maintainable-azure-websites-managing-change-and-scale/_static/image1.png "Включение миграций")</span><span class="sxs-lookup"><span data-stu-id="38dca-181">![Enabling Migrations](maintainable-azure-websites-managing-change-and-scale/_static/image1.png "Enabling Migrations")</span></span>

    <span data-ttu-id="38dca-182">*Включение миграции*</span><span class="sxs-lookup"><span data-stu-id="38dca-182">*Enabling Migrations*</span></span>

    > [!NOTE]
    > <span data-ttu-id="38dca-183">Эта команда добавляет папку **миграций** в проект проекта по проекту, который содержит файл с именем **Configuration.CS**.</span><span class="sxs-lookup"><span data-stu-id="38dca-183">This command adds a **Migrations** folder to Geek Quiz project that contains a file called **Configuration.cs**.</span></span> <span data-ttu-id="38dca-184">Класс **конфигурации** позволяет настроить работу миграций в контексте.</span><span class="sxs-lookup"><span data-stu-id="38dca-184">The **Configuration** class allows you to configure how Migrations behaves for your context.</span></span>
5. <span data-ttu-id="38dca-185">При включенных миграции необходимо обновить класс **конфигурации** , чтобы заполнить базу данных начальными **данными, необходимыми для этого.**</span><span class="sxs-lookup"><span data-stu-id="38dca-185">With Migrations enabled, you need to update the **Configuration** class to populate the database with the initial data that **Geek Quiz** requires.</span></span> <span data-ttu-id="38dca-186">В разделе **Миграция**замените файл **Configuration.CS** файлом, который находится в папке **саурце\ассетс** этой лабораторной работы.</span><span class="sxs-lookup"><span data-stu-id="38dca-186">Under **Migrations**, replace the **Configuration.cs** file with the one located in the **Source\Assets** folder of this lab.</span></span>

    > [!NOTE]
    > <span data-ttu-id="38dca-187">Поскольку **Миграция** будет вызывать метод **начального значения** при каждом обновлении базы данных, необходимо убедиться, что записи не дублируются в базе данных.</span><span class="sxs-lookup"><span data-stu-id="38dca-187">Since **Migrations** will call the **Seed** method with every database update, you need to be sure that records are not duplicated in the database.</span></span> <span data-ttu-id="38dca-188">Метод **AddOrUpdate** поможет предотвратить дублирование данных.</span><span class="sxs-lookup"><span data-stu-id="38dca-188">The **AddOrUpdate** method will help to prevent duplicate data.</span></span>
6. <span data-ttu-id="38dca-189">Чтобы добавить начальную миграцию, введите следующую команду и нажмите клавишу **Ввод**.</span><span class="sxs-lookup"><span data-stu-id="38dca-189">To add an initial migration, enter the following command and then press **Enter**.</span></span>

    > [!NOTE]
    > <span data-ttu-id="38dca-190">Убедитесь, что в экземпляре LocalDB нет базы данных с именем &quot;Жееккуизпрод&quot;.</span><span class="sxs-lookup"><span data-stu-id="38dca-190">Make sure that there is no database named &quot;GeekQuizProd&quot; in your LocalDB instance.</span></span>

    [!code-powershell[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample2.ps1)]

    <span data-ttu-id="38dca-191">![Добавление миграции базовой схемы](maintainable-azure-websites-managing-change-and-scale/_static/image2.png "Добавление миграции базовой схемы")</span><span class="sxs-lookup"><span data-stu-id="38dca-191">![Adding base schema migration](maintainable-azure-websites-managing-change-and-scale/_static/image2.png "Adding base schema migration")</span></span>

    <span data-ttu-id="38dca-192">*Добавление миграции базовой схемы*</span><span class="sxs-lookup"><span data-stu-id="38dca-192">*Adding base schema migration*</span></span>

    > [!NOTE]
    > <span data-ttu-id="38dca-193">**Добавление и миграция** приведет к формированию новой миграции на основе изменений, внесенных в модель с момента создания последней миграции.</span><span class="sxs-lookup"><span data-stu-id="38dca-193">**Add-Migration** will scaffold the next migration based on changes you have made to your model since the last migration was created.</span></span> <span data-ttu-id="38dca-194">В этом случае, поскольку это первый перенос проекта, он добавляет скрипты для создания всех таблиц, определенных в классе **тривиаконтекст** .</span><span class="sxs-lookup"><span data-stu-id="38dca-194">In this case, as it is the first migration of the project, it will add the scripts to create all the tables defined in the **TriviaContext** class.</span></span>
7. <span data-ttu-id="38dca-195">Выполните миграцию, чтобы обновить базу данных, выполнив следующую команду.</span><span class="sxs-lookup"><span data-stu-id="38dca-195">Execute the migration to update the database by running the following command.</span></span> <span data-ttu-id="38dca-196">Для этой команды будет указан флаг **verbose** для просмотра инструкций SQL, применяемых к целевой базе данных.</span><span class="sxs-lookup"><span data-stu-id="38dca-196">For this command you will specify the **Verbose** flag to view the SQL statements being applied to the target database.</span></span>

    [!code-powershell[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample3.ps1)]

    <span data-ttu-id="38dca-197">![Создание начальной базы данных](maintainable-azure-websites-managing-change-and-scale/_static/image3.png "Создание начальной базы данных")</span><span class="sxs-lookup"><span data-stu-id="38dca-197">![Creating initial database](maintainable-azure-websites-managing-change-and-scale/_static/image3.png "Creating initial database")</span></span>

    <span data-ttu-id="38dca-198">*Создание начальной базы данных*</span><span class="sxs-lookup"><span data-stu-id="38dca-198">*Creating initial database*</span></span>

    > [!NOTE]
    > <span data-ttu-id="38dca-199">**Update — база данных** будет применять все незавершенные миграции к базе данных.</span><span class="sxs-lookup"><span data-stu-id="38dca-199">**Update-Database** will apply any pending migrations to the database.</span></span> <span data-ttu-id="38dca-200">В этом случае она создаст базу данных, используя строку подключения, определенную в файле Web. config.</span><span class="sxs-lookup"><span data-stu-id="38dca-200">In this case, it will create the database using the connection string defined in your web.config file.</span></span>
8. <span data-ttu-id="38dca-201">Перейдите в меню " **вид** " и откройте **Обозреватель объектов SQL Server**.</span><span class="sxs-lookup"><span data-stu-id="38dca-201">Go to **View** menu and open **SQL Server Object Explorer**.</span></span>

    <span data-ttu-id="38dca-202">![Открыть в обозреватель объектов SQL Server](maintainable-azure-websites-managing-change-and-scale/_static/image4.png "Открыть в обозреватель объектов SQL Server")</span><span class="sxs-lookup"><span data-stu-id="38dca-202">![Open in SQL Server Object Explorer](maintainable-azure-websites-managing-change-and-scale/_static/image4.png "Open in SQL Server Object Explorer")</span></span>

    <span data-ttu-id="38dca-203">*Открыть в обозреватель объектов SQL Server*</span><span class="sxs-lookup"><span data-stu-id="38dca-203">*Open in SQL Server Object Explorer*</span></span>
9. <span data-ttu-id="38dca-204">В окне **Обозреватель объектов SQL Server** подключитесь к экземпляру LocalDB, щелкнув правой кнопкой мыши узел **SQL Server** и выбрав пункт **Добавить SQL Server...** .</span><span class="sxs-lookup"><span data-stu-id="38dca-204">In the **SQL Server Object Explorer** window, connect to your LocalDB instance by right-clicking the **SQL Server** node and selecting **Add SQL Server...** option.</span></span>

    <span data-ttu-id="38dca-205">![Добавление SQL Server экземпляра](maintainable-azure-websites-managing-change-and-scale/_static/image5.png "Добавление SQL Server экземпляра")</span><span class="sxs-lookup"><span data-stu-id="38dca-205">![Adding a SQL Server Instance](maintainable-azure-websites-managing-change-and-scale/_static/image5.png "Adding a SQL Server Instance")</span></span>

    <span data-ttu-id="38dca-206">*Добавление SQL Server экземпляра в обозреватель объектов SQL Server*</span><span class="sxs-lookup"><span data-stu-id="38dca-206">*Adding a SQL Server instance to SQL Server Object Explorer*</span></span>
10. <span data-ttu-id="38dca-207">Задайте **имя сервера** *(LocalDB) \V11.0* и оставьте **проверку подлинности Windows** в качестве режима проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="38dca-207">Set the **server name** to *(localdb)\v11.0* and leave **Windows Authentication** as your authentication mode.</span></span> <span data-ttu-id="38dca-208">Чтобы продолжить, щелкните **Подключить** .</span><span class="sxs-lookup"><span data-stu-id="38dca-208">Click **Connect** to continue.</span></span>

    <span data-ttu-id="38dca-209">![Подключение к LocalDB](maintainable-azure-websites-managing-change-and-scale/_static/image6.png "Подключение к LocalDB")</span><span class="sxs-lookup"><span data-stu-id="38dca-209">![Connecting to LocalDB](maintainable-azure-websites-managing-change-and-scale/_static/image6.png "Connecting to LocalDB")</span></span>

    <span data-ttu-id="38dca-210">*Подключение к LocalDB*</span><span class="sxs-lookup"><span data-stu-id="38dca-210">*Connecting to LocalDB*</span></span>
11. <span data-ttu-id="38dca-211">Откройте базу данных **жееккуизпрод** и разверните узел **таблицы** .</span><span class="sxs-lookup"><span data-stu-id="38dca-211">Open the **GeekQuizProd** database and expand the **Tables** node.</span></span> <span data-ttu-id="38dca-212">Как видите, команда **Update-Database** создала все таблицы, определенные в классе **тривиаконтекст** .</span><span class="sxs-lookup"><span data-stu-id="38dca-212">As you can see, the **Update-Database** command generated all the tables defined in the **TriviaContext** class.</span></span> <span data-ttu-id="38dca-213">Нахождение **dbo. Тривиакуестионс** таблицу и откройте узел столбцы.</span><span class="sxs-lookup"><span data-stu-id="38dca-213">Locate the **dbo.TriviaQuestions** table and open the columns node.</span></span> <span data-ttu-id="38dca-214">В следующей задаче вы добавите новый столбец в эту таблицу и обновите базу данных с помощью **миграции**.</span><span class="sxs-lookup"><span data-stu-id="38dca-214">In the next task, you will add a new column to this table and update the database using **Migrations**.</span></span>

    <span data-ttu-id="38dca-215">![Столбцы вопросов Trivia](maintainable-azure-websites-managing-change-and-scale/_static/image7.png "Столбцы вопросов Trivia")</span><span class="sxs-lookup"><span data-stu-id="38dca-215">![Trivia Questions Columns](maintainable-azure-websites-managing-change-and-scale/_static/image7.png "Trivia Questions Columns")</span></span>

    <span data-ttu-id="38dca-216">*Столбцы вопросов Trivia*</span><span class="sxs-lookup"><span data-stu-id="38dca-216">*Trivia Questions Columns*</span></span>

<a id="Ex1Task2"></a>
#### <a name="task-2--updating-database-schema-using-migrations"></a><span data-ttu-id="38dca-217">Задача 2. обновление схемы базы данных с помощью миграций</span><span class="sxs-lookup"><span data-stu-id="38dca-217">Task 2 – Updating Database Schema Using Migrations</span></span>

<span data-ttu-id="38dca-218">В этой задаче вы будете использовать **Entity Framework Code First migrations** для обнаружения изменений в модели и создания кода, необходимого для обновления базы данных.</span><span class="sxs-lookup"><span data-stu-id="38dca-218">In this task, you will use **Entity Framework Code First Migrations** to detect a change in your model and generate the necessary code to update the database.</span></span> <span data-ttu-id="38dca-219">Сущность **тривиакуестионс** будет обновлена путем добавления в нее нового свойства.</span><span class="sxs-lookup"><span data-stu-id="38dca-219">You will update the **TriviaQuestions** entity by adding a new property to it.</span></span> <span data-ttu-id="38dca-220">Затем предстоит выполнить команды для создания новой миграции, чтобы включить новый столбец в таблицу.</span><span class="sxs-lookup"><span data-stu-id="38dca-220">Then you will run commands to create a new Migration to include the new column in the table.</span></span>

1. <span data-ttu-id="38dca-221">В **Обозреватель решений**дважды щелкните файл **TriviaQuestion.CS** , расположенный в папке **Models** .</span><span class="sxs-lookup"><span data-stu-id="38dca-221">In **Solution Explorer**, double-click the **TriviaQuestion.cs** file located inside the **Models** folder.</span></span>
2. <span data-ttu-id="38dca-222">Добавьте новое свойство с именем " **Указание**", как показано в следующем фрагменте кода.</span><span class="sxs-lookup"><span data-stu-id="38dca-222">Add a new property named **Hint**, as shown in the following code snippet.</span></span>

    [!code-csharp[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample4.cs)]
3. <span data-ttu-id="38dca-223">В **консоли диспетчера пакетов**введите следующую команду и нажмите клавишу **Ввод**.</span><span class="sxs-lookup"><span data-stu-id="38dca-223">In the **Package Manager Console**, enter the following command and then press **Enter**.</span></span> <span data-ttu-id="38dca-224">Будет создана новая миграция, отражающая изменение в нашей модели.</span><span class="sxs-lookup"><span data-stu-id="38dca-224">A new migration will be created reflecting the change in our model.</span></span>

    [!code-powershell[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample5.ps1)]

    <span data-ttu-id="38dca-225">![Добавление и миграция](maintainable-azure-websites-managing-change-and-scale/_static/image8.png "Добавление и миграция")</span><span class="sxs-lookup"><span data-stu-id="38dca-225">![Add-Migration](maintainable-azure-websites-managing-change-and-scale/_static/image8.png "Add-Migration")</span></span>

    <span data-ttu-id="38dca-226">*Добавление и миграция*</span><span class="sxs-lookup"><span data-stu-id="38dca-226">*Add-Migration*</span></span>

    > [!NOTE]
    > <span data-ttu-id="38dca-227">Файл миграции состоит из двух методов: **вверх** и **вниз**.</span><span class="sxs-lookup"><span data-stu-id="38dca-227">A Migration file is composed of two methods, **Up** and **Down**.</span></span>
    >
    > - <span data-ttu-id="38dca-228">Метод **up** будет использоваться для указания изменений, которые должна применить Текущая версия нашего приложения к базе данных.</span><span class="sxs-lookup"><span data-stu-id="38dca-228">The **Up** method will be used to specify what changes the current version of our application need to apply to the database.</span></span>
    > - <span data-ttu-id="38dca-229">**Стрелка вниз** используется для отмены изменений, добавленных в метод **up** .</span><span class="sxs-lookup"><span data-stu-id="38dca-229">The **Down** is used to reverse the changes we have added to the **Up** method.</span></span>
    >
    > <span data-ttu-id="38dca-230">Когда база данных выполняет миграцию, она запускает все миграции в порядке отметок времени и только те, которые не использовались с момента последнего обновления (\_таблица Мигратионхистори отслеживает, какие миграции были применены).</span><span class="sxs-lookup"><span data-stu-id="38dca-230">When the Database Migration updates the database, it will run all migrations in the timestamp order, and only those that have not been used since the last update (The \_MigrationHistory table keeps track of which migrations have been applied).</span></span> <span data-ttu-id="38dca-231">Метод **up** всех миграций будет вызван и внесет изменения, указанные в базе данных.</span><span class="sxs-lookup"><span data-stu-id="38dca-231">The **Up** method of all migrations will be called and will make the changes we have specified to the database.</span></span> <span data-ttu-id="38dca-232">Если мы решили вернуться к предыдущей миграции, будет вызван метод **Down** для возврата изменений в обратном порядке.</span><span class="sxs-lookup"><span data-stu-id="38dca-232">If we decide to go back to a previous migration, the **Down** method will be called to redo the changes in a reverse order.</span></span>
4. <span data-ttu-id="38dca-233">В **консоли диспетчера пакетов**введите следующую команду и нажмите клавишу **Ввод**.</span><span class="sxs-lookup"><span data-stu-id="38dca-233">In the **Package Manager Console**, enter the following command and then press **Enter**.</span></span>

    [!code-powershell[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample6.ps1)]
5. <span data-ttu-id="38dca-234">Выходные данные команды **Update-Database** создавали инструкцию SQL **ALTER TABLE** для добавления нового столбца в таблицу **тривиакуестионс** , как показано на рисунке ниже.</span><span class="sxs-lookup"><span data-stu-id="38dca-234">The output of the **Update-Database** command generated an **Alter Table** SQL statement to add a new column to the **TriviaQuestions** table, as shown in the image below.</span></span>

    <span data-ttu-id="38dca-235">![Добавление созданного столбца инструкции SQL](maintainable-azure-websites-managing-change-and-scale/_static/image9.png "Добавление созданного столбца инструкции SQL")</span><span class="sxs-lookup"><span data-stu-id="38dca-235">![Add column SQL statement generated](maintainable-azure-websites-managing-change-and-scale/_static/image9.png "Add column SQL statement generated")</span></span>

    <span data-ttu-id="38dca-236">*Добавление созданного столбца инструкции SQL*</span><span class="sxs-lookup"><span data-stu-id="38dca-236">*Add column SQL statement generated*</span></span>
6. <span data-ttu-id="38dca-237">В **Обозреватель объектов SQL Server**обновите **dbo. Тривиакуестионс** таблицу и убедитесь, что новый столбец **подсказок** отображается.</span><span class="sxs-lookup"><span data-stu-id="38dca-237">In **SQL Server Object Explorer**, refresh the **dbo.TriviaQuestions** table and check that the new **Hint** column is displayed.</span></span>

    <span data-ttu-id="38dca-238">![Отображение нового столбца подсказок](maintainable-azure-websites-managing-change-and-scale/_static/image10.png "Отображение нового столбца подсказок")</span><span class="sxs-lookup"><span data-stu-id="38dca-238">![Showing the new Hint Column](maintainable-azure-websites-managing-change-and-scale/_static/image10.png "Showing the new Hint Column")</span></span>

    <span data-ttu-id="38dca-239">*Отображение нового столбца подсказок*</span><span class="sxs-lookup"><span data-stu-id="38dca-239">*Showing the new Hint Column*</span></span>
7. <span data-ttu-id="38dca-240">Вернувшись в редактор **TriviaQuestion.CS** , добавьте ограничение **StringLength** *к свойству* указания, как показано в следующем фрагменте кода.</span><span class="sxs-lookup"><span data-stu-id="38dca-240">Back in the **TriviaQuestion.cs** editor, add a **StringLength** constraint to the *Hint* property, as shown in the following code snippet.</span></span>

    [!code-csharp[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample7.cs)]
8. <span data-ttu-id="38dca-241">В **консоли диспетчера пакетов**введите следующую команду и нажмите клавишу **Ввод**.</span><span class="sxs-lookup"><span data-stu-id="38dca-241">In the **Package Manager Console**, enter the following command and then press **Enter**.</span></span>

    [!code-powershell[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample8.ps1)]
9. <span data-ttu-id="38dca-242">В **консоли диспетчера пакетов**введите следующую команду и нажмите клавишу **Ввод**.</span><span class="sxs-lookup"><span data-stu-id="38dca-242">In the **Package Manager Console**, enter the following command and then press **Enter**.</span></span>

    [!code-powershell[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample9.ps1)]
10. <span data-ttu-id="38dca-243">Выходные данные команды **Update-Database** создавали инструкцию SQL **ALTER TABLE** для обновления типа столбца *подсказок* таблицы **тривиакуестионс** , как показано на рисунке ниже.</span><span class="sxs-lookup"><span data-stu-id="38dca-243">The output of the **Update-Database** command generated an **Alter Table** SQL statement to update the *hint* column type of the **TriviaQuestions** table, as shown in the image below.</span></span>

    <span data-ttu-id="38dca-244">![Инструкция SQL ALTER COLUMN Generated](maintainable-azure-websites-managing-change-and-scale/_static/image11.png "Инструкция SQL ALTER COLUMN Generated")</span><span class="sxs-lookup"><span data-stu-id="38dca-244">![Alter column SQL statement generated](maintainable-azure-websites-managing-change-and-scale/_static/image11.png "Alter column SQL statement generated")</span></span>

    <span data-ttu-id="38dca-245">*Инструкция SQL ALTER COLUMN Generated*</span><span class="sxs-lookup"><span data-stu-id="38dca-245">*Alter column SQL statement generated*</span></span>
11. <span data-ttu-id="38dca-246">В **Обозреватель объектов SQL Server**обновите **dbo. Тривиакуестионс** таблица и проверьте, что тип столбца **подсказки** — **nvarchar (150)** .</span><span class="sxs-lookup"><span data-stu-id="38dca-246">In **SQL Server Object Explorer**, refresh the **dbo.TriviaQuestions** table and check that the **Hint** column type is **nvarchar(150)**.</span></span>

    <span data-ttu-id="38dca-247">![Отображение нового ограничения](maintainable-azure-websites-managing-change-and-scale/_static/image12.png "Отображение нового ограничения")</span><span class="sxs-lookup"><span data-stu-id="38dca-247">![Showing the new constraint](maintainable-azure-websites-managing-change-and-scale/_static/image12.png "Showing the new constraint")</span></span>

    <span data-ttu-id="38dca-248">*Отображение нового ограничения*</span><span class="sxs-lookup"><span data-stu-id="38dca-248">*Showing the new constraint*</span></span>

<a id="Exercise2"></a>
### <a name="exercise-2-deploying-a-web-app-to-staging"></a><span data-ttu-id="38dca-249">Упражнение 2. Развертывание веб-приложения для промежуточного хранения</span><span class="sxs-lookup"><span data-stu-id="38dca-249">Exercise 2: Deploying a Web App to Staging</span></span>

<span data-ttu-id="38dca-250">**Веб-приложения в службе приложений Azure** позволяют выполнять промежуточную публикацию.</span><span class="sxs-lookup"><span data-stu-id="38dca-250">**Web Apps in Azure App Service** enables you to perform staged publishing.</span></span> <span data-ttu-id="38dca-251">Поэтапная публикация создает слот промежуточного сайта для каждого рабочего сайта по умолчанию и позволяет поменять местами эти слоты без простоя.</span><span class="sxs-lookup"><span data-stu-id="38dca-251">Staged publishing creates a staging site slot for each default production site and enables you to swap these slots with no down time.</span></span> <span data-ttu-id="38dca-252">Это действительно полезно для проверки изменений перед выпуском в общедоступной, постепенной интеграции содержимого сайта и отката, если изменения не работают должным образом.</span><span class="sxs-lookup"><span data-stu-id="38dca-252">This is really useful to validate changes before releasing to the public, incrementally integrate site content, and roll back if changes are not working as expected.</span></span>

<span data-ttu-id="38dca-253">В этом упражнении вы развернете приложение " **головоломка** " в промежуточной среде веб-приложения с помощью системы управления версиями Git.</span><span class="sxs-lookup"><span data-stu-id="38dca-253">In this exercise, you will deploy the **Geek Quiz** application to the staging environment of your web app using Git source control.</span></span> <span data-ttu-id="38dca-254">Для этого необходимо создать веб-приложение и подготовить необходимые компоненты на портале управления, настроить репозиторий **Git** и отправить исходный код приложения с локального компьютера в промежуточный слот.</span><span class="sxs-lookup"><span data-stu-id="38dca-254">To do this, you will create the web app and provision the required components at the management portal, configure a **Git** repository and push the application source code from your local computer to the staging slot.</span></span> <span data-ttu-id="38dca-255">Вы также обновите рабочую базу данных с помощью **Code First migrations** , созданного в предыдущем упражнении.</span><span class="sxs-lookup"><span data-stu-id="38dca-255">You will also update your production database with the **Code First Migrations** you created in the previous exercise.</span></span> <span data-ttu-id="38dca-256">Затем приложение будет выполняться в этой тестовой среде для проверки его работы.</span><span class="sxs-lookup"><span data-stu-id="38dca-256">You will then execute the application in this test environment to verify its operation.</span></span> <span data-ttu-id="38dca-257">Если вы удовлетворены работой в соответствии с ожиданиями, вы сможете повысить уровень приложения до рабочей среды.</span><span class="sxs-lookup"><span data-stu-id="38dca-257">Once you are satisfied that it is working according to your expectations, you will promote the application to production.</span></span>

> [!NOTE]
> <span data-ttu-id="38dca-258">Чтобы включить промежуточную публикацию, веб-приложение должно работать в **стандартном режиме**.</span><span class="sxs-lookup"><span data-stu-id="38dca-258">To enable staged publishing, the web app must be in **Standard mode**.</span></span> <span data-ttu-id="38dca-259">Обратите внимание, что при переходе веб-приложения в стандартный режим будут взиматься дополнительные расходы.</span><span class="sxs-lookup"><span data-stu-id="38dca-259">Note that additional charges will be incurred if you change your web app to Standard mode.</span></span> <span data-ttu-id="38dca-260">Дополнительные сведения о ценах см. на странице [цен на службу приложений](https://azure.microsoft.com/pricing/details/app-service/).</span><span class="sxs-lookup"><span data-stu-id="38dca-260">For more information about pricing, see [App Service Pricing](https://azure.microsoft.com/pricing/details/app-service/).</span></span>

<a id="Ex2Task1"></a>
#### <a name="task-1--creating-a-web-app-in-azure-app-service"></a><span data-ttu-id="38dca-261">Задача 1. Создание веб-приложения в службе приложений Azure</span><span class="sxs-lookup"><span data-stu-id="38dca-261">Task 1 – Creating a Web App in Azure App Service</span></span>

<span data-ttu-id="38dca-262">В этой задаче вы создадите веб-приложение в **службе приложений Azure** на портале управления.</span><span class="sxs-lookup"><span data-stu-id="38dca-262">In this task, you will create a web app in **Azure App Service** from the management portal.</span></span> <span data-ttu-id="38dca-263">Вы также настроите **базу данных SQL** для хранения данных приложения и настроите локальный репозиторий Git для системы управления версиями.</span><span class="sxs-lookup"><span data-stu-id="38dca-263">You will also configure a **SQL Database** to persist the application data, and configure a local Git repository for source control.</span></span>

1. <span data-ttu-id="38dca-264">Перейдите на [портал управления Azure](https://manage.windowsazure.com) и выполните вход с помощью учетная запись Майкрософт, связанного с вашей подпиской.</span><span class="sxs-lookup"><span data-stu-id="38dca-264">Go to the [Azure management portal](https://manage.windowsazure.com) and sign in using the Microsoft account associated with your subscription.</span></span>

    ![Вход на портал управления Azure](maintainable-azure-websites-managing-change-and-scale/_static/image13.png)

    <span data-ttu-id="38dca-266">*Вход на портал управления Azure*</span><span class="sxs-lookup"><span data-stu-id="38dca-266">*Sign in to the Azure management portal*</span></span>
2. <span data-ttu-id="38dca-267">Щелкните **создать** на панели команд в нижней части страницы.</span><span class="sxs-lookup"><span data-stu-id="38dca-267">Click **New** in the command bar at the bottom of the page.</span></span>

    <span data-ttu-id="38dca-268">![Создание нового веб-приложения](maintainable-azure-websites-managing-change-and-scale/_static/image14.png "Создание нового веб-приложения")</span><span class="sxs-lookup"><span data-stu-id="38dca-268">![Creating a new web app](maintainable-azure-websites-managing-change-and-scale/_static/image14.png "Creating a new web app")</span></span>

    <span data-ttu-id="38dca-269">*Создание нового веб-приложения*</span><span class="sxs-lookup"><span data-stu-id="38dca-269">*Creating a new web app*</span></span>
3. <span data-ttu-id="38dca-270">Щелкните **Вычисление**, **веб-сайт** , а затем **настраиваемое создание**.</span><span class="sxs-lookup"><span data-stu-id="38dca-270">Click **Compute**, **Website** and then **Custom Create**.</span></span>

    <span data-ttu-id="38dca-271">![Создание нового веб-приложения с помощью настраиваемого создания](maintainable-azure-websites-managing-change-and-scale/_static/image15.png "Создание нового веб-приложения с помощью настраиваемого создания")</span><span class="sxs-lookup"><span data-stu-id="38dca-271">![Creating a new web app using Custom Create](maintainable-azure-websites-managing-change-and-scale/_static/image15.png "Creating a new web app using Custom Create")</span></span>

    <span data-ttu-id="38dca-272">*Создание нового веб-приложения с помощью настраиваемого создания*</span><span class="sxs-lookup"><span data-stu-id="38dca-272">*Creating a new web app using Custom Create*</span></span>
4. <span data-ttu-id="38dca-273">В диалоговом окне **новый веб-сайт — настраиваемое создание** укажите доступный **URL-адрес** (например, "сотрудник *-Викторина*"), выберите расположение в раскрывающемся списке **регион** и выберите **создать новую базу данных SQL** в раскрывающемся списке **база данных** .</span><span class="sxs-lookup"><span data-stu-id="38dca-273">In the **New Website - Custom Create** dialog box, provide an available **URL** (e.g. *geek-quiz*), select a location in the **Region** drop-down list, and select **Create a new SQL database** in the **Database** drop-down list.</span></span> <span data-ttu-id="38dca-274">Наконец, установите флажок **опубликовать из системы управления версиями** и нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="38dca-274">Finally, select the **Publish from source control** check box and click **Next**.</span></span>

    ![Настройка нового веб-приложения](maintainable-azure-websites-managing-change-and-scale/_static/image16.png)

    <span data-ttu-id="38dca-276">*Настройка нового веб-приложения*</span><span class="sxs-lookup"><span data-stu-id="38dca-276">*Customizing the new web app*</span></span>
5. <span data-ttu-id="38dca-277">Укажите следующие сведения для параметров базы данных.</span><span class="sxs-lookup"><span data-stu-id="38dca-277">Specify the following information for the database settings:</span></span>

   - <span data-ttu-id="38dca-278">В текстовом поле **имя** введите имя базы данных (например, *жееккуиз\_DB*).</span><span class="sxs-lookup"><span data-stu-id="38dca-278">In the **Name** text box, enter a database name (e.g. *geekquiz\_db*)</span></span>
   - <span data-ttu-id="38dca-279">В раскрывающемся **списке сервер** выберите **новый сервер базы данных SQL**.</span><span class="sxs-lookup"><span data-stu-id="38dca-279">In the Server **drop-down** list, select **New SQL database server**.</span></span> <span data-ttu-id="38dca-280">Кроме того, можно выбрать существующий сервер.</span><span class="sxs-lookup"><span data-stu-id="38dca-280">Alternatively, you can select an existing server.</span></span>
   - <span data-ttu-id="38dca-281">В полях **имя пользователя базы данных** и **пароль базы данных** введите имя пользователя и пароль администратора для сервера базы данных SQL.</span><span class="sxs-lookup"><span data-stu-id="38dca-281">In the **Database username** and **Database password** boxes, enter the administrator username and password for the SQL database server.</span></span> <span data-ttu-id="38dca-282">Если вы выбрали уже созданный сервер, появится запрос на ввод пароля.</span><span class="sxs-lookup"><span data-stu-id="38dca-282">If you select a server you have already created, you will be prompted for the password.</span></span>

     ![Указание параметров базы данных](maintainable-azure-websites-managing-change-and-scale/_static/image17.png)

     <span data-ttu-id="38dca-284">*Указание параметров базы данных*</span><span class="sxs-lookup"><span data-stu-id="38dca-284">*Specifying the database settings*</span></span>
6. <span data-ttu-id="38dca-285">Чтобы продолжить, нажмите кнопку **Далее** .</span><span class="sxs-lookup"><span data-stu-id="38dca-285">Click **Next** to continue.</span></span>
7. <span data-ttu-id="38dca-286">Выберите **локальный репозиторий Git** для использования системы управления версиями и нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="38dca-286">Select **Local Git repository** for the source control to use and click **Next**.</span></span>

    > [!NOTE]
    > <span data-ttu-id="38dca-287">Может появиться запрос на ввод учетных данных развертывания (имя пользователя и пароль).</span><span class="sxs-lookup"><span data-stu-id="38dca-287">You may be prompted for the deployment credentials (a username and password).</span></span>

    ![Создание репозитория Git](maintainable-azure-websites-managing-change-and-scale/_static/image18.png)

    <span data-ttu-id="38dca-289">*Создание репозитория Git*</span><span class="sxs-lookup"><span data-stu-id="38dca-289">*Creating the Git repository*</span></span>
8. <span data-ttu-id="38dca-290">Дождитесь создания нового веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="38dca-290">Wait until the new web app is created.</span></span>

    > [!NOTE]
    > <span data-ttu-id="38dca-291">По умолчанию Azure предоставляет домены на сайте *azurewebsites.NET* , но также дает возможность задать личные домены с помощью портала управления Azure.</span><span class="sxs-lookup"><span data-stu-id="38dca-291">By default, Azure provides domains at *azurewebsites.net* but also gives you the possibility to set custom domains using the Azure management portal.</span></span> <span data-ttu-id="38dca-292">Однако вы можете управлять только пользовательскими доменами, если вы используете определенные режимы службы приложений Azure.</span><span class="sxs-lookup"><span data-stu-id="38dca-292">However, you can only manage custom domains if you are using certain Azure App Service modes.</span></span>
    >
    > <span data-ttu-id="38dca-293">Служба приложений Azure доступна в выпусках Free, Shared, Basic, Standard и Premium.</span><span class="sxs-lookup"><span data-stu-id="38dca-293">Azure App Service is available in Free, Shared, Basic, Standard, and Premium editions.</span></span> <span data-ttu-id="38dca-294">В режиме "бесплатный" и "общий" все веб-приложения работают в среде с несколькими клиентами и имеют квоты для ЦП, памяти и использования сети.</span><span class="sxs-lookup"><span data-stu-id="38dca-294">In Free and Shared mode, all web apps run in a multi-tenant environment and have quotas for CPU, Memory, and Network usage.</span></span> <span data-ttu-id="38dca-295">Максимальное количество бесплатных приложений может отличаться в зависимости от вашего плана.</span><span class="sxs-lookup"><span data-stu-id="38dca-295">The maximum number of free apps may vary with your plan.</span></span> <span data-ttu-id="38dca-296">В стандартном режиме вы выбираете, какие приложения выполняются на выделенных виртуальных машинах, соответствующих стандартным ресурсам вычислений Azure.</span><span class="sxs-lookup"><span data-stu-id="38dca-296">In Standard mode, you choose which apps run on dedicated virtual machines that correspond to the standard Azure compute resources.</span></span> <span data-ttu-id="38dca-297">Конфигурацию режима веб-приложения можно найти в меню **масштаб** веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="38dca-297">You can find the web app mode configuration in the **Scale** menu of your web app.</span></span>
    >
    > <span data-ttu-id="38dca-298">![Режимы службы приложений Azure](maintainable-azure-websites-managing-change-and-scale/_static/image19.png "Режимы службы приложений Azure")</span><span class="sxs-lookup"><span data-stu-id="38dca-298">![Azure App Service Modes](maintainable-azure-websites-managing-change-and-scale/_static/image19.png "Azure App Service Modes")</span></span>
    >
    > <span data-ttu-id="38dca-299">Если вы используете режим " **Общий** " или " **стандартный** ", вы сможете управлять личными доменами для веб-приложения, перейдя в меню " **Настройка** " приложения и выбрав пункт " **Управление доменами** " в разделе " *имена доменов*".</span><span class="sxs-lookup"><span data-stu-id="38dca-299">If you are using **Shared** or **Standard** mode, you will be able to manage custom domains for your web app by going to your app's **Configure** menu and clicking **Manage Domains** under *domain names*.</span></span>
    >
    > <span data-ttu-id="38dca-300">![Управление доменами](maintainable-azure-websites-managing-change-and-scale/_static/image20.png "Управление доменами")</span><span class="sxs-lookup"><span data-stu-id="38dca-300">![Manage Domains](maintainable-azure-websites-managing-change-and-scale/_static/image20.png "Manage Domains")</span></span>
    >
    > <span data-ttu-id="38dca-301">![Управление пользовательскими доменами](maintainable-azure-websites-managing-change-and-scale/_static/image21.png "Управление пользовательскими доменами")</span><span class="sxs-lookup"><span data-stu-id="38dca-301">![Manage Custom Domains](maintainable-azure-websites-managing-change-and-scale/_static/image21.png "Manage Custom Domains")</span></span>
9. <span data-ttu-id="38dca-302">После создания веб-приложения щелкните ссылку в столбце **URL-адрес** , чтобы проверить, работает ли новое веб-приложение.</span><span class="sxs-lookup"><span data-stu-id="38dca-302">Once the web app is created, click the link under the **URL** column to check that the new web app is running.</span></span>

    ![Обзор нового веб-приложения](maintainable-azure-websites-managing-change-and-scale/_static/image22.png)

    <span data-ttu-id="38dca-304">*Обзор нового веб-приложения*</span><span class="sxs-lookup"><span data-stu-id="38dca-304">*Browsing to the new web app*</span></span>

    ![веб-приложение работает](maintainable-azure-websites-managing-change-and-scale/_static/image23.png)

    <span data-ttu-id="38dca-306">*веб-приложение работает*</span><span class="sxs-lookup"><span data-stu-id="38dca-306">*web app running*</span></span>

<a id="Ex2Task2"></a>
#### <a name="task-2--creating-the-production-sql-database"></a><span data-ttu-id="38dca-307">Задача 2. Создание рабочей базы данных SQL</span><span class="sxs-lookup"><span data-stu-id="38dca-307">Task 2 – Creating the Production SQL Database</span></span>

<span data-ttu-id="38dca-308">В этой задаче вы будете использовать **Entity Framework Code First migrations** , чтобы создать базу данных, предназначенную для экземпляра **базы данных SQL Azure** , созданного в предыдущей задаче.</span><span class="sxs-lookup"><span data-stu-id="38dca-308">In this task, you will use the **Entity Framework Code First Migrations** to create the database targeting the **Azure SQL Database** instance you created in the previous task.</span></span>

1. <span data-ttu-id="38dca-309">В портал управления перейдите к веб-приложению, созданному в предыдущей задаче, и перейдите на соответствующую **панель мониторинга**.</span><span class="sxs-lookup"><span data-stu-id="38dca-309">In the Management Portal, navigate to the web app you created in the previous task and go to its **Dashboard**.</span></span>
2. <span data-ttu-id="38dca-310">На странице **панель мониторинга** щелкните ссылку **просмотреть строки подключения** в разделе **краткий обзор** .</span><span class="sxs-lookup"><span data-stu-id="38dca-310">In the **Dashboard** page, click **View connection strings** link under the **quick glance** section.</span></span>

    <span data-ttu-id="38dca-311">![Просмотр строк подключения](maintainable-azure-websites-managing-change-and-scale/_static/image24.png "Просмотр строк подключения")</span><span class="sxs-lookup"><span data-stu-id="38dca-311">![View connection strings](maintainable-azure-websites-managing-change-and-scale/_static/image24.png "View connection strings")</span></span>

    <span data-ttu-id="38dca-312">*Просмотр строк подключения*</span><span class="sxs-lookup"><span data-stu-id="38dca-312">*View connection strings*</span></span>
3. <span data-ttu-id="38dca-313">Скопируйте значение **строки подключения** и закройте диалоговое окно.</span><span class="sxs-lookup"><span data-stu-id="38dca-313">Copy the **connection string** value and close the dialog box.</span></span>

    <span data-ttu-id="38dca-314">![Строка подключения в портал управления Azure](maintainable-azure-websites-managing-change-and-scale/_static/image25.png "Строка подключения в портал управления Azure")</span><span class="sxs-lookup"><span data-stu-id="38dca-314">![Connection String in Azure Management Portal](maintainable-azure-websites-managing-change-and-scale/_static/image25.png "Connection String in Azure Management Portal")</span></span>

    <span data-ttu-id="38dca-315">*Строка подключения в портал управления Azure*</span><span class="sxs-lookup"><span data-stu-id="38dca-315">*Connection String in Azure Management Portal*</span></span>
4. <span data-ttu-id="38dca-316">Щелкните " **базы данных SQL** ", чтобы просмотреть список баз данных SQL в Azure.</span><span class="sxs-lookup"><span data-stu-id="38dca-316">Click **SQL Databases** to see the list of SQL databases in Azure</span></span>

    <span data-ttu-id="38dca-317">![Меню базы данных SQL](maintainable-azure-websites-managing-change-and-scale/_static/image26.png "Меню базы данных SQL")</span><span class="sxs-lookup"><span data-stu-id="38dca-317">![SQL Database menu](maintainable-azure-websites-managing-change-and-scale/_static/image26.png "SQL Database menu")</span></span>

    <span data-ttu-id="38dca-318">*Меню базы данных SQL*</span><span class="sxs-lookup"><span data-stu-id="38dca-318">*SQL Database menu*</span></span>
5. <span data-ttu-id="38dca-319">Выберите базу данных, созданную в предыдущей задаче, и щелкните сервер.</span><span class="sxs-lookup"><span data-stu-id="38dca-319">Locate the database you created in the previous task and click on the Server.</span></span>

    <span data-ttu-id="38dca-320">![Сервер базы данных SQL](maintainable-azure-websites-managing-change-and-scale/_static/image27.png "Сервер базы данных SQL")</span><span class="sxs-lookup"><span data-stu-id="38dca-320">![SQL Database server](maintainable-azure-websites-managing-change-and-scale/_static/image27.png "SQL Database server")</span></span>

    <span data-ttu-id="38dca-321">*Сервер базы данных SQL*</span><span class="sxs-lookup"><span data-stu-id="38dca-321">*SQL Database server*</span></span>
6. <span data-ttu-id="38dca-322">На странице **быстрое начало** сервера щелкните **настроить**.</span><span class="sxs-lookup"><span data-stu-id="38dca-322">In the **Quick Start** page of the server, click on **Configure**.</span></span>

    <span data-ttu-id="38dca-323">![Меню настройки](maintainable-azure-websites-managing-change-and-scale/_static/image28.png "Меню настройки")</span><span class="sxs-lookup"><span data-stu-id="38dca-323">![Configure menu](maintainable-azure-websites-managing-change-and-scale/_static/image28.png "Configure menu")</span></span>

    <span data-ttu-id="38dca-324">*Меню настройки*</span><span class="sxs-lookup"><span data-stu-id="38dca-324">*Configure menu*</span></span>
7. <span data-ttu-id="38dca-325">В разделе **Разрешенные IP-адреса** нажмите кнопку **Добавить в раздел разрешенные IP-адреса** , чтобы разрешить вашему IP-адресу подключаться к серверу базы данных SQL.</span><span class="sxs-lookup"><span data-stu-id="38dca-325">In the **Allowed IP addresses** section, click on **Add to the allowed IP addresses** link to enable your IP to connect to the SQL Database server.</span></span>

    <span data-ttu-id="38dca-326">![Разрешенные IP-адреса](maintainable-azure-websites-managing-change-and-scale/_static/image29.png "Разрешенные IP-адреса")</span><span class="sxs-lookup"><span data-stu-id="38dca-326">![Allowed IP addresses](maintainable-azure-websites-managing-change-and-scale/_static/image29.png "Allowed IP addresses")</span></span>

    <span data-ttu-id="38dca-327">*Разрешенные IP-адреса*</span><span class="sxs-lookup"><span data-stu-id="38dca-327">*Allowed IP addresses*</span></span>
8. <span data-ttu-id="38dca-328">Чтобы завершить шаг, нажмите кнопку **Сохранить** в нижней части страницы.</span><span class="sxs-lookup"><span data-stu-id="38dca-328">Click **Save** at the bottom of the page to complete the step.</span></span>
9. <span data-ttu-id="38dca-329">Вернитесь в Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="38dca-329">Switch back to Visual Studio.</span></span>
10. <span data-ttu-id="38dca-330">В **консоли диспетчера пакетов**выполните следующую команду, заменив заполнитель *[a-Connection-String]* строкой подключения, скопированной из Azure.</span><span class="sxs-lookup"><span data-stu-id="38dca-330">In the **Package Manager Console**, execute the following command replacing *[YOUR-CONNECTION-STRING]* placeholder with the connection string you copied from Azure</span></span>

    [!code-powershell[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample10.ps1)]

    <span data-ttu-id="38dca-331">![Обновление базы данных, предназначенной для базы данных SQL Windows Azure](maintainable-azure-websites-managing-change-and-scale/_static/image30.png "Обновление базы данных, предназначенной для базы данных SQL Windows Azure")</span><span class="sxs-lookup"><span data-stu-id="38dca-331">![Update database targeting Windows Azure SQL Database](maintainable-azure-websites-managing-change-and-scale/_static/image30.png "Update database targeting Windows Azure SQL Database")</span></span>

    <span data-ttu-id="38dca-332">*Обновление базы данных, предназначенной для базы данных SQL Azure*</span><span class="sxs-lookup"><span data-stu-id="38dca-332">*Update database targeting Azure SQL Database*</span></span>

<a id="Ex2Task3"></a>
#### <a name="task-3--deploying-geek-quiz-to-staging-using-git"></a><span data-ttu-id="38dca-333">Задача 3. Развертывание головоломки для подготовки к промежуточному хранению с помощью Git</span><span class="sxs-lookup"><span data-stu-id="38dca-333">Task 3 – Deploying Geek Quiz to Staging Using Git</span></span>

<span data-ttu-id="38dca-334">В этой задаче будет включена промежуточная публикация в веб-приложении.</span><span class="sxs-lookup"><span data-stu-id="38dca-334">In this task, you will enable staged publishing in your web app.</span></span> <span data-ttu-id="38dca-335">Затем вы будете использовать Git для публикации приложения для головоломки на основе вашего локального компьютера в промежуточную среду веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="38dca-335">Then, you will use Git to publish the Geek Quiz application directly from your local computer to the staging environment of your web app.</span></span>

1. <span data-ttu-id="38dca-336">Вернитесь на портал и щелкните имя веб-приложения в столбце **имя** , чтобы отобразить страницы управления.</span><span class="sxs-lookup"><span data-stu-id="38dca-336">Go back to the portal and click the name of the web app under the **Name** column to display the management pages.</span></span>

    ![Открытие страниц управления веб-приложениями](maintainable-azure-websites-managing-change-and-scale/_static/image31.png)

    <span data-ttu-id="38dca-338">*Открытие страниц управления веб-приложениями*</span><span class="sxs-lookup"><span data-stu-id="38dca-338">*Opening the web app management pages*</span></span>
2. <span data-ttu-id="38dca-339">Перейдите на страницу **шкалы** .</span><span class="sxs-lookup"><span data-stu-id="38dca-339">Navigate to the **Scale** page.</span></span> <span data-ttu-id="38dca-340">В разделе **Общие** выберите **стандартный** для конфигурации и нажмите кнопку **сохранить** на панели команд.</span><span class="sxs-lookup"><span data-stu-id="38dca-340">Under the **general** section, select **Standard** for the configuration and click **Save** in the command bar.</span></span>

    > [!NOTE]
    > <span data-ttu-id="38dca-341">Чтобы запустить все веб-приложения в текущем регионе и подписке в **стандартном** режиме, оставьте флажок **выбрать все** , установленный в конфигурации **Выбор сайтов** .</span><span class="sxs-lookup"><span data-stu-id="38dca-341">To run all web apps in the current region and subscription in **Standard** mode, leave the **Select All** check box selected in the **Choose Sites** configuration.</span></span> <span data-ttu-id="38dca-342">В противном случае снимите флажок " **выбрать все** ".</span><span class="sxs-lookup"><span data-stu-id="38dca-342">Otherwise, clear the **Select All** check box.</span></span>

    <span data-ttu-id="38dca-343">![Обновление веб-приложения до стандартного режима](maintainable-azure-websites-managing-change-and-scale/_static/image32.png "Обновление веб-приложения до стандартного режима")</span><span class="sxs-lookup"><span data-stu-id="38dca-343">![Upgrading the web app to Standard mode](maintainable-azure-websites-managing-change-and-scale/_static/image32.png "Upgrading the web app to Standard mode")</span></span>

    <span data-ttu-id="38dca-344">*Обновление веб-приложения до стандартного режима*</span><span class="sxs-lookup"><span data-stu-id="38dca-344">*Upgrading the Web App to Standard mode*</span></span>
3. <span data-ttu-id="38dca-345">Нажмите кнопку **Да** , чтобы подтвердить изменения.</span><span class="sxs-lookup"><span data-stu-id="38dca-345">Click **Yes** to confirm the changes.</span></span>

    <span data-ttu-id="38dca-346">![Подтверждение изменения в стандартном режиме](maintainable-azure-websites-managing-change-and-scale/_static/image33.png "Продолжение изменения режима веб-приложения")</span><span class="sxs-lookup"><span data-stu-id="38dca-346">![Confirming the change to Standard mode](maintainable-azure-websites-managing-change-and-scale/_static/image33.png "Continuing with the changing of the web app mode")</span></span>

    <span data-ttu-id="38dca-347">*Подтверждение изменения в стандартном режиме*</span><span class="sxs-lookup"><span data-stu-id="38dca-347">*Confirming the change to Standard mode*</span></span>
4. <span data-ttu-id="38dca-348">Перейдите на страницу **панели мониторинга** и щелкните **включить промежуточную публикацию** в разделе **краткий обзор** .</span><span class="sxs-lookup"><span data-stu-id="38dca-348">Go to the **Dashboard** page and click **Enable staged publishing** under the **quick glance** section.</span></span>

    <span data-ttu-id="38dca-349">![Включение промежуточной публикации](maintainable-azure-websites-managing-change-and-scale/_static/image34.png "Включение промежуточной публикации")</span><span class="sxs-lookup"><span data-stu-id="38dca-349">![Enabling staged publishing](maintainable-azure-websites-managing-change-and-scale/_static/image34.png "Enabling staged publishing")</span></span>

    <span data-ttu-id="38dca-350">*Включение промежуточной публикации*</span><span class="sxs-lookup"><span data-stu-id="38dca-350">*Enabling staged publishing*</span></span>
5. <span data-ttu-id="38dca-351">Нажмите кнопку **Да** , чтобы включить промежуточную публикацию.</span><span class="sxs-lookup"><span data-stu-id="38dca-351">Click **Yes** to enable staged publishing.</span></span>

    <span data-ttu-id="38dca-352">![Подтверждение промежуточной публикации](maintainable-azure-websites-managing-change-and-scale/_static/image35.png "Нажмите кнопку Да, чтобы включить промежуточную публикацию")</span><span class="sxs-lookup"><span data-stu-id="38dca-352">![Confirming staged publishing](maintainable-azure-websites-managing-change-and-scale/_static/image35.png "Clicking Yes to enable staged publishing")</span></span>

    <span data-ttu-id="38dca-353">*Подтверждение промежуточной публикации*</span><span class="sxs-lookup"><span data-stu-id="38dca-353">*Confirming staged publishing*</span></span>
6. <span data-ttu-id="38dca-354">В списке веб-приложений разверните метку слева от имени веб-приложения, чтобы отобразить промежуточный слот сайта.</span><span class="sxs-lookup"><span data-stu-id="38dca-354">In the list of web apps, expand the mark to the left of your web app name to display the staging site slot.</span></span> <span data-ttu-id="38dca-355">Он содержит имя веб-приложения, за которым следует ***(промежуточное хранение)***.</span><span class="sxs-lookup"><span data-stu-id="38dca-355">It has the name of your web app followed by ***(staging)***.</span></span> <span data-ttu-id="38dca-356">Щелкните промежуточный сайт, чтобы открыть страницу управления.</span><span class="sxs-lookup"><span data-stu-id="38dca-356">Click the staging site to go to the management page.</span></span>

    <span data-ttu-id="38dca-357">![Переход к промежуточному веб-приложению](maintainable-azure-websites-managing-change-and-scale/_static/image36.png "Переход к промежуточному веб-приложению")</span><span class="sxs-lookup"><span data-stu-id="38dca-357">![Navigating to the staging web app](maintainable-azure-websites-managing-change-and-scale/_static/image36.png "Navigating to the staging web app")</span></span>

    <span data-ttu-id="38dca-358">*Переход к промежуточному приложению*</span><span class="sxs-lookup"><span data-stu-id="38dca-358">*Navigating to the staging app*</span></span>
7. <span data-ttu-id="38dca-359">Обратите внимание, что страница управления выглядит как любая другая страница управления веб-приложением.</span><span class="sxs-lookup"><span data-stu-id="38dca-359">Notice that he management page looks like any other web app's management page.</span></span> <span data-ttu-id="38dca-360">Перейдите на страницу **развертывания** и скопируйте значение **URL-адреса Git** .</span><span class="sxs-lookup"><span data-stu-id="38dca-360">Navigate to the **Deployments** page and copy the **Git URL** value.</span></span> <span data-ttu-id="38dca-361">Он будет использоваться позже в этом упражнении.</span><span class="sxs-lookup"><span data-stu-id="38dca-361">You will use it later in this exercise.</span></span>

    ![Копирование значения URL-адреса Git](maintainable-azure-websites-managing-change-and-scale/_static/image37.png)

    <span data-ttu-id="38dca-363">*Копирование значения URL-адреса Git*</span><span class="sxs-lookup"><span data-stu-id="38dca-363">*Copying the Git URL value*</span></span>
8. <span data-ttu-id="38dca-364">Откройте новую консоль **Git Bash** и выполните следующие команды.</span><span class="sxs-lookup"><span data-stu-id="38dca-364">Open a new **Git Bash** console and execute the following commands.</span></span> <span data-ttu-id="38dca-365">Измените заполнитель *[My-Application-path]* на путь к решению **жееккуиз** , расположенному в папке **Source\Ex1-DeployingWebSiteToStaging\Begin** этой лабораторной работы.</span><span class="sxs-lookup"><span data-stu-id="38dca-365">Update the *[YOUR-APPLICATION-PATH]* placeholder with the path to the **GeekQuiz** solution, located in the **Source\Ex1-DeployingWebSiteToStaging\Begin** folder of this lab.</span></span>

    [!code-console[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample11.cmd)]

    ![Инициализация Git и первая фиксация](maintainable-azure-websites-managing-change-and-scale/_static/image38.png)

    <span data-ttu-id="38dca-367">*Инициализация Git и первая фиксация*</span><span class="sxs-lookup"><span data-stu-id="38dca-367">*Git initialization and first commit*</span></span>
9. <span data-ttu-id="38dca-368">Выполните следующую команду, чтобы отправить веб-приложение в удаленный репозиторий **Git** .</span><span class="sxs-lookup"><span data-stu-id="38dca-368">Run the following command to push your web app to the remote **Git** repository.</span></span> <span data-ttu-id="38dca-369">Замените заполнитель URL-адресом, полученным на портале управления.</span><span class="sxs-lookup"><span data-stu-id="38dca-369">Replace the placeholder with the URL you obtained from the management portal.</span></span> <span data-ttu-id="38dca-370">Вам будет предложено ввести пароль развертывания.</span><span class="sxs-lookup"><span data-stu-id="38dca-370">You will be prompted for your deployment password.</span></span>

    [!code-console[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample12.cmd)]

    ![Принудительная отправка в Windows Azure](maintainable-azure-websites-managing-change-and-scale/_static/image39.png)

    <span data-ttu-id="38dca-372">*Отправка в Azure*</span><span class="sxs-lookup"><span data-stu-id="38dca-372">*Pushing to Azure*</span></span>

    > [!NOTE]
    > <span data-ttu-id="38dca-373">При развертывании содержимого на узле FTP или в репозитории GIT веб-приложения необходимо пройти проверку подлинности с помощью **учетных данных развертывания** , созданных на **быстрое начало** или на страницах управления **панели мониторинга** веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="38dca-373">When you deploy content to the FTP host or GIT repository of a web app, you must authenticate using the **deployment credentials** that you created from the web app's **Quick Start** or **Dashboard** management pages.</span></span> <span data-ttu-id="38dca-374">Если вы не знакомы с учетными данными развертывания, их можно легко сбросить с помощью портала управления.</span><span class="sxs-lookup"><span data-stu-id="38dca-374">If you do not know your deployment credentials you can easily reset them using the management portal.</span></span> <span data-ttu-id="38dca-375">Откройте страницу **панели мониторинга** веб-приложения и щелкните ссылку **сбросить учетные данные развертывания** .</span><span class="sxs-lookup"><span data-stu-id="38dca-375">Open the web app **Dashboard** page and click the **Reset your deployment credentials** link.</span></span> <span data-ttu-id="38dca-376">Укажите новый пароль и нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="38dca-376">Provide a new password and click **OK**.</span></span> <span data-ttu-id="38dca-377">Учетные данные развертывания допустимы для использования со всеми веб-приложениями, связанными с вашей подпиской.</span><span class="sxs-lookup"><span data-stu-id="38dca-377">Deployment credentials are valid for use with all web apps associated with your subscription.</span></span>
10. <span data-ttu-id="38dca-378">Чтобы убедиться, что веб-приложение успешно отправлено в Azure, вернитесь на портал управления и щелкните **веб-сайты**.</span><span class="sxs-lookup"><span data-stu-id="38dca-378">In order to verify the web app was successfully pushed to Azure, go back to the management portal and click **Websites**.</span></span>
11. <span data-ttu-id="38dca-379">Откройте веб-приложение и разверните запись, чтобы отобразить слот промежуточного сайта.</span><span class="sxs-lookup"><span data-stu-id="38dca-379">Locate your web app and expand the entry to display the staging site slot.</span></span> <span data-ttu-id="38dca-380">Щелкните его **имя** , чтобы открыть страницу управления.</span><span class="sxs-lookup"><span data-stu-id="38dca-380">Click its **Name** to go to the management page.</span></span>
12. <span data-ttu-id="38dca-381">Щелкните **развертывания** , чтобы просмотреть **журнал развертывания**.</span><span class="sxs-lookup"><span data-stu-id="38dca-381">Click **Deployments** to see the **deployment history**.</span></span> <span data-ttu-id="38dca-382">Убедитесь, что имеется **активное развертывание** с *&quot;начальной фиксацией&quot;* .</span><span class="sxs-lookup"><span data-stu-id="38dca-382">Verify that there is an **Active Deployment** with your *&quot;Initial Commit&quot;*.</span></span>

    ![Активное развертывание](maintainable-azure-websites-managing-change-and-scale/_static/image40.png)

    <span data-ttu-id="38dca-384">*Активное развертывание*</span><span class="sxs-lookup"><span data-stu-id="38dca-384">*Active deployment*</span></span>
13. <span data-ttu-id="38dca-385">Наконец, нажмите кнопку **Обзор** на панели команд, чтобы перейти к веб-приложению.</span><span class="sxs-lookup"><span data-stu-id="38dca-385">Finally, click **Browse** in the command bar to go to the web app.</span></span>

    ![Обзор веб-приложения](maintainable-azure-websites-managing-change-and-scale/_static/image41.png)

    <span data-ttu-id="38dca-387">*Обзор веб-приложения*</span><span class="sxs-lookup"><span data-stu-id="38dca-387">*Browse web app*</span></span>
14. <span data-ttu-id="38dca-388">Если приложение успешно развернуто, вы увидите страницу входа в викторину.</span><span class="sxs-lookup"><span data-stu-id="38dca-388">If the application is successfully deployed, you will see the Geek Quiz login page.</span></span>

    > [!NOTE]
    > <span data-ttu-id="38dca-389">URL-адрес развернутого приложения содержит имя веб-приложения, за которым следует *промежуточное хранение*.</span><span class="sxs-lookup"><span data-stu-id="38dca-389">The address URL of the deployed application contains the name of your web app followed by *-staging*.</span></span>

    ![Приложение, выполняющееся в промежуточной среде](maintainable-azure-websites-managing-change-and-scale/_static/image42.png)

    <span data-ttu-id="38dca-391">*Приложение, выполняющееся в промежуточной среде*</span><span class="sxs-lookup"><span data-stu-id="38dca-391">*Application running in the staging environment*</span></span>
15. <span data-ttu-id="38dca-392">Если вы хотите изучить приложение, нажмите кнопку **Регистрация** , чтобы зарегистрировать нового пользователя.</span><span class="sxs-lookup"><span data-stu-id="38dca-392">If you wish to explore the application, click **Register** to register a new user.</span></span> <span data-ttu-id="38dca-393">Заполните сведения об учетной записи, введя имя пользователя, адрес электронной почты и пароль.</span><span class="sxs-lookup"><span data-stu-id="38dca-393">Complete the account details by entering a user name, email address and password.</span></span> <span data-ttu-id="38dca-394">Затем в приложении отображается первый вопрос головоломки.</span><span class="sxs-lookup"><span data-stu-id="38dca-394">Next, the application shows the first question of the quiz.</span></span> <span data-ttu-id="38dca-395">Ответьте на несколько вопросов, чтобы убедиться, что она работает правильно.</span><span class="sxs-lookup"><span data-stu-id="38dca-395">Answer a few questions to make sure it is working as expected.</span></span>

    ![Приложение готово к использованию](maintainable-azure-websites-managing-change-and-scale/_static/image43.png)

    <span data-ttu-id="38dca-397">*Приложение готово к использованию*</span><span class="sxs-lookup"><span data-stu-id="38dca-397">*Application ready to be used*</span></span>

<a id="Ex2Task4"></a>
#### <a name="task-4--promoting-the-web-app-to-production"></a><span data-ttu-id="38dca-398">Задача 4. повышение уровня веб-приложения до рабочей среды</span><span class="sxs-lookup"><span data-stu-id="38dca-398">Task 4 – Promoting the Web App to Production</span></span>

<span data-ttu-id="38dca-399">Теперь, убедившись, что веб-приложение правильно работает в промежуточной среде, вы можете повысить его уровень до рабочей среды.</span><span class="sxs-lookup"><span data-stu-id="38dca-399">Now that you have verified that the web app is working correctly in the staging environment, you are ready to promote it to production.</span></span> <span data-ttu-id="38dca-400">В этой задаче слот промежуточного сайта будет заменен слотом рабочего сайта.</span><span class="sxs-lookup"><span data-stu-id="38dca-400">In this task, you will swap the staging site slot with the production site slot.</span></span>

1. <span data-ttu-id="38dca-401">Вернитесь на портал управления и выберите слот промежуточного сайта.</span><span class="sxs-lookup"><span data-stu-id="38dca-401">Go back to the management portal and select the staging site slot.</span></span> <span data-ttu-id="38dca-402">Нажмите кнопку **поменять местами** на панели команд.</span><span class="sxs-lookup"><span data-stu-id="38dca-402">Click **Swap** in the command bar.</span></span>

    ![Переключение на рабочую среду](maintainable-azure-websites-managing-change-and-scale/_static/image44.png)

    <span data-ttu-id="38dca-404">*Переключение на рабочую среду*</span><span class="sxs-lookup"><span data-stu-id="38dca-404">*Swap to production*</span></span>
2. <span data-ttu-id="38dca-405">Нажмите кнопку **Да** в диалоговом окне подтверждения, чтобы продолжить операцию переключения.</span><span class="sxs-lookup"><span data-stu-id="38dca-405">Click **Yes** in the confirmation dialog box to proceed with the swap operation.</span></span> <span data-ttu-id="38dca-406">Azure немедленно заменит содержимое рабочего сайта содержимым промежуточного сайта.</span><span class="sxs-lookup"><span data-stu-id="38dca-406">Azure will immediately swap the content of the production site with the content of the staging site.</span></span>

    > [!NOTE]
    > <span data-ttu-id="38dca-407">Некоторые параметры из промежуточной версии будут автоматически скопированы в рабочую версию (например, переопределения строк подключения, сопоставления обработчиков и т. д.), но другие параметры не изменятся (например, конечные точки DNS, SSL-привязки и т. д.).</span><span class="sxs-lookup"><span data-stu-id="38dca-407">Some settings from the staged version will automatically be copied to the production version (e.g. connection string overrides, handler mappings, etc.) but other settings will not change (e.g. DNS endpoints, SSL bindings, etc.).</span></span>

    ![Подтверждение операции переключения](maintainable-azure-websites-managing-change-and-scale/_static/image45.png)

    <span data-ttu-id="38dca-409">*Подтверждение операции переключения*</span><span class="sxs-lookup"><span data-stu-id="38dca-409">*Confirming swap operation*</span></span>
3. <span data-ttu-id="38dca-410">После завершения переключения выберите Рабочий слот и нажмите кнопку **Обзор** на панели команд, чтобы открыть рабочий сайт.</span><span class="sxs-lookup"><span data-stu-id="38dca-410">Once the swap is complete, select the production slot and click **Browse** in the command bar to open the production site.</span></span> <span data-ttu-id="38dca-411">Обратите внимание на URL-адрес в адресной строке.</span><span class="sxs-lookup"><span data-stu-id="38dca-411">Notice the URL in the address bar.</span></span>

    > [!NOTE]
    > <span data-ttu-id="38dca-412">Возможно, потребуется обновить браузер, чтобы очистить кэш.</span><span class="sxs-lookup"><span data-stu-id="38dca-412">You might need to refresh your browser to clear cache.</span></span> <span data-ttu-id="38dca-413">В Internet Explorer это можно сделать, нажав клавиши **CTRL + R**.</span><span class="sxs-lookup"><span data-stu-id="38dca-413">In Internet Explorer, you can do this by pressing **CTRL+R**.</span></span>

    ![Веб-приложение, работающее в рабочей среде](maintainable-azure-websites-managing-change-and-scale/_static/image46.png)
4. <span data-ttu-id="38dca-415">В консоли **GitBash** обновите удаленный URL-адрес для локального репозитория Git, чтобы он был предназначен для рабочего слота.</span><span class="sxs-lookup"><span data-stu-id="38dca-415">In the **GitBash** console, update the remote URL for the local Git repository to target the production slot.</span></span> <span data-ttu-id="38dca-416">Для этого выполните следующую команду, заменив заполнители именем пользователя развертывания и именем своего веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="38dca-416">To do this, run the following command replacing the placeholders with your deployment username and the name of your web app.</span></span>

    > [!NOTE]
    > <span data-ttu-id="38dca-417">В следующих упражнениях вы отправите изменения на рабочий сайт, а не на промежуточное хранение только для простоты лабораторий.</span><span class="sxs-lookup"><span data-stu-id="38dca-417">In the following exercises, you will push changes to the production site instead of staging just for the simplicity of the lab.</span></span> <span data-ttu-id="38dca-418">В реальном сценарии рекомендуется проверять изменения в промежуточной среде перед повышением уровня рабочей среды.</span><span class="sxs-lookup"><span data-stu-id="38dca-418">In a real-world scenario, it is recommended to verify the changes in the staging environment before promoting to production.</span></span>

    [!code-console[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample13.cmd)]

<a id="Exercise3"></a>
### <a name="exercise-3-performing-deployment-rollback-in-production"></a><span data-ttu-id="38dca-419">Упражнение 3. Выполнение отката развертывания в рабочей среде</span><span class="sxs-lookup"><span data-stu-id="38dca-419">Exercise 3: Performing Deployment Rollback in Production</span></span>

<span data-ttu-id="38dca-420">Существуют сценарии, в которых нет промежуточного слота для выполнения оперативного переключения между промежуточным и рабочим режимом, например, при работе в режиме " **бесплатный** " или " **Общий** ".</span><span class="sxs-lookup"><span data-stu-id="38dca-420">There are scenarios where you do not have a staging slot to perform hot swap between staging and production, for example, if you are working with **Free** or **Shared** mode.</span></span> <span data-ttu-id="38dca-421">В этих сценариях вы должны протестировать приложение в среде тестирования локально или на удаленном сайте перед развертыванием в рабочую среду.</span><span class="sxs-lookup"><span data-stu-id="38dca-421">In those scenarios, you should test your application in a testing environment –either locally or in a remote site– before deploying to production.</span></span> <span data-ttu-id="38dca-422">Однако возможно, что на рабочем сайте может возникнуть ошибка, не определенная на этапе тестирования.</span><span class="sxs-lookup"><span data-stu-id="38dca-422">However, it is possible that an issue not detected during the testing phase may arise in the production site.</span></span> <span data-ttu-id="38dca-423">В этом случае важно иметь механизм, позволяющий легко переключаться на предыдущую и стабильную версию приложения как можно быстрее.</span><span class="sxs-lookup"><span data-stu-id="38dca-423">In this case, it is important to have a mechanism to easily switch to a previous and more stable version of the application as quickly as possible.</span></span>

<span data-ttu-id="38dca-424">В **службе приложений Azure**непрерывное развертывание из системы управления версиями делает это возможным благодаря действию **повторного развертывания** , доступному на портале управления.</span><span class="sxs-lookup"><span data-stu-id="38dca-424">In **Azure App Service**, continuous deployment from source control makes this possible thanks to the **redeploy** action available in the management portal.</span></span> <span data-ttu-id="38dca-425">Azure отслеживает развертывания, связанные с фиксациями, отправленными в репозиторий, и предоставляет возможность повторного развертывания приложения с помощью любого из предыдущих развертываний в любое время.</span><span class="sxs-lookup"><span data-stu-id="38dca-425">Azure keeps track of the deployments associated with the commits pushed to the repository and provides an option to redeploy your application using any of your previous deployments, at any time.</span></span>

<span data-ttu-id="38dca-426">В этом упражнении будет выполнено изменение кода в приложении " **головоломка** ", которое намеренно внедряет *ошибку*.</span><span class="sxs-lookup"><span data-stu-id="38dca-426">In this exercise you will perform a change to the code in the **Geek Quiz** application that intentionally injects a *bug*.</span></span> <span data-ttu-id="38dca-427">Вы развернете приложение в рабочей среде, чтобы увидеть ошибку, а затем будете использовать функцию повторного развертывания, чтобы вернуться к предыдущему состоянию.</span><span class="sxs-lookup"><span data-stu-id="38dca-427">You will deploy the application to production to see the error, and then you will take advantage of the redeploy feature to go back to the previous state.</span></span>

<a id="Ex3Task1"></a>
#### <a name="task-1--updating-the-geek-quiz-application"></a><span data-ttu-id="38dca-428">Задача 1. Обновление приложения для головоломки</span><span class="sxs-lookup"><span data-stu-id="38dca-428">Task 1 – Updating the Geek Quiz Application</span></span>

<span data-ttu-id="38dca-429">В этой задаче предстоит выполнить рефакторинг небольшой части кода класса **тривиаконтроллер** , чтобы извлечь часть логики, которая извлекает выбранный параметр головоломки из базы данных в новый метод.</span><span class="sxs-lookup"><span data-stu-id="38dca-429">In this task, you will refactor a small piece of code of the **TriviaController** class to extract part of the logic that retrieves the selected quiz option from the database into a new method.</span></span>

1. <span data-ttu-id="38dca-430">Переключитесь на экземпляр Visual Studio с помощью решения **жееккуиз** из предыдущего упражнения.</span><span class="sxs-lookup"><span data-stu-id="38dca-430">Switch to the Visual Studio instance with the **GeekQuiz** solution from the previous exercise.</span></span>
2. <span data-ttu-id="38dca-431">В **Обозреватель решений**откройте файл **TriviaController.CS** в папке **Controllers** .</span><span class="sxs-lookup"><span data-stu-id="38dca-431">In **Solution Explorer**, open the **TriviaController.cs** file inside the **Controllers** folder.</span></span>
3. <span data-ttu-id="38dca-432">Перейдите к методу **стореасинк** и выберите код, выделенный на следующем рисунке.</span><span class="sxs-lookup"><span data-stu-id="38dca-432">Locate the **StoreAsync** method and select the code highlighted in the following figure.</span></span>

    ![Выбор кода](maintainable-azure-websites-managing-change-and-scale/_static/image47.png)

    <span data-ttu-id="38dca-434">*Выбор кода*</span><span class="sxs-lookup"><span data-stu-id="38dca-434">*Selecting the code*</span></span>
4. <span data-ttu-id="38dca-435">Щелкните правой кнопкой мыши выделенный код, разверните меню **Рефакторинг** и выберите пункт **извлечь метод...** .</span><span class="sxs-lookup"><span data-stu-id="38dca-435">Right-click the selected code, expand the **Refactor** menu and select **Extract Method...**.</span></span>

    ![Извлечение кода как нового метода](maintainable-azure-websites-managing-change-and-scale/_static/image48.png)

    <span data-ttu-id="38dca-437">*Выбор метода извлечения*</span><span class="sxs-lookup"><span data-stu-id="38dca-437">*Selecting Extract Method*</span></span>
5. <span data-ttu-id="38dca-438">В диалоговом окне **Извлечение метода** назовите новый метод *матчесоптион* и нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="38dca-438">In the **Extract Method** dialog box, name the new method *MatchesOption* and click **OK**.</span></span>

    ![Указание имени метода](maintainable-azure-websites-managing-change-and-scale/_static/image49.png)

    <span data-ttu-id="38dca-440">*Указание имени для извлеченного метода*</span><span class="sxs-lookup"><span data-stu-id="38dca-440">*Specifying the name for the extracted method*</span></span>
6. <span data-ttu-id="38dca-441">Затем выбранный код извлекается в метод **матчесоптион** .</span><span class="sxs-lookup"><span data-stu-id="38dca-441">The selected code is then extracted into the **MatchesOption** method.</span></span> <span data-ttu-id="38dca-442">Полученный код показан в следующем фрагменте кода.</span><span class="sxs-lookup"><span data-stu-id="38dca-442">The resulting code is shown in the following snippet.</span></span>

    [!code-csharp[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample14.cs)]
7. <span data-ttu-id="38dca-443">Нажмите клавиши **CTRL + S** , чтобы сохранить изменения.</span><span class="sxs-lookup"><span data-stu-id="38dca-443">Press **CTRL + S** to save the changes.</span></span>

<a id="Ex3Task2"></a>
#### <a name="task-2--redeploying-the-geek-quiz-application"></a><span data-ttu-id="38dca-444">Задача 2. повторное развертывание приложения для головоломки</span><span class="sxs-lookup"><span data-stu-id="38dca-444">Task 2 – Redeploying the Geek Quiz Application</span></span>

<span data-ttu-id="38dca-445">Теперь изменения, внесенные в предыдущей задаче, будут отправлены в репозиторий, что приведет к активации нового развертывания в рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="38dca-445">You will now push the changes you made in the previous task to the repository, which will trigger a new deployment to the production environment.</span></span> <span data-ttu-id="38dca-446">Затем вы устранятьи проблемы с помощью **средств разработки F12** , предоставляемых Internet Explorer, а затем выполните откат к предыдущему развертыванию на портале управления Azure.</span><span class="sxs-lookup"><span data-stu-id="38dca-446">Then, you will troubleshot an issue using the **F12 development tools** provided by Internet Explorer, and then perform a rollback to the previous deployment from the Azure management portal.</span></span>

1. <span data-ttu-id="38dca-447">Откройте новую консоль **Git Bash** , чтобы развернуть обновленное приложение в службе приложений Azure.</span><span class="sxs-lookup"><span data-stu-id="38dca-447">Open a new **Git Bash** console to deploy the updated application to Azure App Service.</span></span>
2. <span data-ttu-id="38dca-448">Выполните следующие команды, чтобы отправить изменения в Azure.</span><span class="sxs-lookup"><span data-stu-id="38dca-448">Execute the following commands to push the changes to Azure.</span></span> <span data-ttu-id="38dca-449">Замените заполнитель *[My-Application-path]* на путь к решению **жееккуиз** .</span><span class="sxs-lookup"><span data-stu-id="38dca-449">Update the *[YOUR-APPLICATION-PATH]* placeholder with the path to the **GeekQuiz** solution.</span></span> <span data-ttu-id="38dca-450">Вам будет предложено ввести пароль развертывания.</span><span class="sxs-lookup"><span data-stu-id="38dca-450">You will be prompted for your deployment password.</span></span>

    [!code-console[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample15.cmd)]

    ![Принудительная отправка оптимизированного кода в Azure](maintainable-azure-websites-managing-change-and-scale/_static/image50.png)

    <span data-ttu-id="38dca-452">*Принудительная отправка оптимизированного кода в Azure*</span><span class="sxs-lookup"><span data-stu-id="38dca-452">*Pushing refactored code to Azure*</span></span>
3. <span data-ttu-id="38dca-453">Откройте Internet Explorer и перейдите к своему веб-приложению (например, `http://<your-web-site>.azurewebsites.net`).</span><span class="sxs-lookup"><span data-stu-id="38dca-453">Open Internet Explorer and navigate to your web app (e.g. `http://<your-web-site>.azurewebsites.net`).</span></span> <span data-ttu-id="38dca-454">Войдите в систему, используя ранее созданные учетные данные.</span><span class="sxs-lookup"><span data-stu-id="38dca-454">Log in using the previously created credentials.</span></span>
4. <span data-ttu-id="38dca-455">Нажмите клавишу **F12** , чтобы запустить средства разработки, перейдите на вкладку **сеть** и нажмите кнопку **Воспроизведение** , чтобы начать запись.</span><span class="sxs-lookup"><span data-stu-id="38dca-455">Press **F12** to launch the development tools, select the **Network** tab and click the **Play** button to start recording.</span></span>

    <span data-ttu-id="38dca-456">![Запуск записи в сеть](maintainable-azure-websites-managing-change-and-scale/_static/image51.png "Запуск записи в сеть")</span><span class="sxs-lookup"><span data-stu-id="38dca-456">![Starting network recording](maintainable-azure-websites-managing-change-and-scale/_static/image51.png "Starting network recording")</span></span>

    <span data-ttu-id="38dca-457">*Запуск записи в сеть*</span><span class="sxs-lookup"><span data-stu-id="38dca-457">*Starting network recording*</span></span>
5. <span data-ttu-id="38dca-458">Выберите любой вариант головоломки.</span><span class="sxs-lookup"><span data-stu-id="38dca-458">Select any option of the quiz.</span></span> <span data-ttu-id="38dca-459">Вы увидите, что ничего не происходит.</span><span class="sxs-lookup"><span data-stu-id="38dca-459">You will see that nothing happens.</span></span>
6. <span data-ttu-id="38dca-460">В окне **F12** запись, СООТВЕТСТВУЮЩая HTTP-запросу POST, показывает результат HTTP **500** .</span><span class="sxs-lookup"><span data-stu-id="38dca-460">In the **F12** window, the entry corresponding to the POST HTTP request shows an HTTP **500** result.</span></span>

    ![Ошибка HTTP 500](maintainable-azure-websites-managing-change-and-scale/_static/image52.png)

    <span data-ttu-id="38dca-462">*Ошибка HTTP 500*</span><span class="sxs-lookup"><span data-stu-id="38dca-462">*HTTP 500 error*</span></span>
7. <span data-ttu-id="38dca-463">Перейдите на вкладку **консоль** . В журнал заносится ошибка с описанием причины.</span><span class="sxs-lookup"><span data-stu-id="38dca-463">Select the **Console** tab. An error is logged with the details of the cause.</span></span>

    ![Зарегистрированная ошибка](maintainable-azure-websites-managing-change-and-scale/_static/image53.png)

    <span data-ttu-id="38dca-465">*Зарегистрированная ошибка*</span><span class="sxs-lookup"><span data-stu-id="38dca-465">*Logged error*</span></span>
8. <span data-ttu-id="38dca-466">Нахождение подробной части ошибки.</span><span class="sxs-lookup"><span data-stu-id="38dca-466">Locate the details part of the error.</span></span> <span data-ttu-id="38dca-467">Очевидно, что эта ошибка вызвана оптимизацией кода, которую Вы зафиксировали на предыдущих шагах.</span><span class="sxs-lookup"><span data-stu-id="38dca-467">Clearly, this error is caused by the code refactoring you committed in the previous steps.</span></span>

    <span data-ttu-id="38dca-468">`Details: LINQ to Entities does not recognize the method 'Boolean MatchesOption ...`.</span><span class="sxs-lookup"><span data-stu-id="38dca-468">`Details: LINQ to Entities does not recognize the method 'Boolean MatchesOption ...`.</span></span>
9. <span data-ttu-id="38dca-469">Не закрывайте браузер.</span><span class="sxs-lookup"><span data-stu-id="38dca-469">Do not close the browser.</span></span>
10. <span data-ttu-id="38dca-470">В новом экземпляре браузера перейдите на [портал управления Azure](https://manage.windowsazure.com) и выполните вход с помощью учетная запись Майкрософт, связанного с вашей подпиской.</span><span class="sxs-lookup"><span data-stu-id="38dca-470">In a new browser instance, navigate to the [Azure management portal](https://manage.windowsazure.com) and sign in using the Microsoft account associated with your subscription.</span></span>
11. <span data-ttu-id="38dca-471">Выберите **сайты** и щелкните веб-приложение, созданное в упражнении 2.</span><span class="sxs-lookup"><span data-stu-id="38dca-471">Select **Websites** and click the web app you created in Exercise 2.</span></span>
12. <span data-ttu-id="38dca-472">Перейдите на страницу **развертывания** .</span><span class="sxs-lookup"><span data-stu-id="38dca-472">Navigate to the **Deployments** page.</span></span> <span data-ttu-id="38dca-473">Обратите внимание, что все выполненные фиксации перечислены в журнале развертывания.</span><span class="sxs-lookup"><span data-stu-id="38dca-473">Notice that all the commits performed are listed in the deployment history.</span></span>

    ![Список существующих развертываний](maintainable-azure-websites-managing-change-and-scale/_static/image54.png)

    <span data-ttu-id="38dca-475">*Список существующих развертываний*</span><span class="sxs-lookup"><span data-stu-id="38dca-475">*List of existing deployments*</span></span>
13. <span data-ttu-id="38dca-476">Выберите предыдущую фиксацию и нажмите кнопку **Повторное развертывание** на панели команд.</span><span class="sxs-lookup"><span data-stu-id="38dca-476">Select the previous commit and click **Redeploy** on the command bar.</span></span>

    ![Повторное развертывание предыдущей фиксации](maintainable-azure-websites-managing-change-and-scale/_static/image55.png)

    <span data-ttu-id="38dca-478">*Повторное развертывание предыдущей фиксации*</span><span class="sxs-lookup"><span data-stu-id="38dca-478">*Redeploying the previous commit*</span></span>
14. <span data-ttu-id="38dca-479">При появлении запроса на подтверждение щелкните **Yes**(Да).</span><span class="sxs-lookup"><span data-stu-id="38dca-479">When prompted to confirm, click **Yes**.</span></span>

    ![Подтверждение повторного развертывания](maintainable-azure-websites-managing-change-and-scale/_static/image56.png)
15. <span data-ttu-id="38dca-481">После завершения развертывания переключитесь обратно на экземпляр браузера с помощью веб-приложения и нажмите клавиши **CTRL + F5**.</span><span class="sxs-lookup"><span data-stu-id="38dca-481">When the deployment completes, switch back to the browser instance with your web app and press **CTRL + F5**.</span></span>
16. <span data-ttu-id="38dca-482">Щелкните любой из параметров.</span><span class="sxs-lookup"><span data-stu-id="38dca-482">Click any of the options.</span></span> <span data-ttu-id="38dca-483">Теперь будет отображена анимация отражения, и отобразится результат (*правильно или неправильно*).</span><span class="sxs-lookup"><span data-stu-id="38dca-483">The flip animation will now take place and the result (*correct/incorrect*) will be displayed.</span></span>
17. <span data-ttu-id="38dca-484">Используемых Перейдите в консоль **Git Bash** и выполните следующие команды, чтобы вернуться к предыдущей фиксации.</span><span class="sxs-lookup"><span data-stu-id="38dca-484">(Optional) Switch to the **Git Bash** console and execute the following commands to revert to the previous commit.</span></span>

    > [!NOTE]
    > <span data-ttu-id="38dca-485">Эти команды создают новую фиксацию, которая отменяет все изменения в репозитории Git, которые были сделаны в результате неудачной фиксации.</span><span class="sxs-lookup"><span data-stu-id="38dca-485">These commands create a new commit that undoes all changes in the Git repository that were made in the bad commit.</span></span> <span data-ttu-id="38dca-486">Azure выполнит повторное развертывание приложения с помощью новой фиксации.</span><span class="sxs-lookup"><span data-stu-id="38dca-486">Azure will then redeploy the application using the new commit.</span></span>

    [!code-console[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample16.cmd)]

<a id="Exercise4"></a>
### <a name="exercise-4-scaling-using-azure-storage"></a><span data-ttu-id="38dca-487">Упражнение 4. масштабирование с помощью службы хранилища Azure</span><span class="sxs-lookup"><span data-stu-id="38dca-487">Exercise 4: Scaling Using Azure Storage</span></span>

<span data-ttu-id="38dca-488">**Большие двоичные объекты** — это самый простой способ хранения больших объемов неструктурированных текстовых или двоичных данных, таких как видео, аудио и изображения.</span><span class="sxs-lookup"><span data-stu-id="38dca-488">**Blobs** are the simplest way to store large amounts of unstructured text or binary data such as video, audio and images.</span></span> <span data-ttu-id="38dca-489">Перемещение статического содержимого приложения в хранилище помогает масштабировать приложение путем обслуживания изображений или документов непосредственно в браузере.</span><span class="sxs-lookup"><span data-stu-id="38dca-489">Moving the static content of your application to Storage, helps to scale your application by serving images or documents directly to the browser.</span></span>

<span data-ttu-id="38dca-490">В этом упражнении вы переместит статическое содержимое приложения в контейнер больших двоичных объектов.</span><span class="sxs-lookup"><span data-stu-id="38dca-490">In this exercise, you will move the static content of your application to a Blob container.</span></span> <span data-ttu-id="38dca-491">Затем вы настроите приложение, чтобы добавить **правило переопределения URL-адресов ASP.NET** в **файле Web. config** для перенаправления содержимого в контейнер больших двоичных объектов.</span><span class="sxs-lookup"><span data-stu-id="38dca-491">Then you will configure your application to add an **ASP.NET URL rewrite rule** in the **Web.config** to redirect your content to the Blob container.</span></span>

<a id="Ex4Task1"></a>
#### <a name="task-1--creating-an-azure-storage-account"></a><span data-ttu-id="38dca-492">Задача 1. Создание учетной записи хранения Azure</span><span class="sxs-lookup"><span data-stu-id="38dca-492">Task 1 – Creating an Azure Storage Account</span></span>

<span data-ttu-id="38dca-493">В этой задаче вы узнаете, как создать новую учетную запись хранения с помощью портала управления.</span><span class="sxs-lookup"><span data-stu-id="38dca-493">In this task you will learn how to create a new storage account using the management portal.</span></span>

1. <span data-ttu-id="38dca-494">Перейдите на [портал управления Azure](https://manage.windowsazure.com) и выполните вход с помощью учетная запись Майкрософт, связанного с вашей подпиской.</span><span class="sxs-lookup"><span data-stu-id="38dca-494">Navigate to the [Azure management portal](https://manage.windowsazure.com) and sign in using the Microsoft account associated with your subscription.</span></span>
2. <span data-ttu-id="38dca-495">Выберите " **создать" | Службы данных | Хранилище | Быстрое создание** , чтобы начать создание новой учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="38dca-495">Select **New | Data Services | Storage | Quick Create** to start creating a new storage account.</span></span> <span data-ttu-id="38dca-496">Введите уникальное имя учетной записи и выберите **регион** из списка.</span><span class="sxs-lookup"><span data-stu-id="38dca-496">Enter a unique name for the account and select a **Region** from the list.</span></span> <span data-ttu-id="38dca-497">Чтобы продолжить, щелкните **создать учетную запись хранения** .</span><span class="sxs-lookup"><span data-stu-id="38dca-497">Click **Create Storage Account** to continue.</span></span>

    <span data-ttu-id="38dca-498">![Создание новой учетной записи хранения](maintainable-azure-websites-managing-change-and-scale/_static/image57.png "Создание новой учетной записи хранения")</span><span class="sxs-lookup"><span data-stu-id="38dca-498">![Creating a new Storage Account](maintainable-azure-websites-managing-change-and-scale/_static/image57.png "Creating a new Storage Account")</span></span>

    <span data-ttu-id="38dca-499">*Создание новой учетной записи хранения*</span><span class="sxs-lookup"><span data-stu-id="38dca-499">*Creating a new storage account*</span></span>
3. <span data-ttu-id="38dca-500">В разделе " **хранилище** " дождитесь, пока состояние новой учетной записи хранения изменится на "в *сети* ", чтобы продолжить выполнение следующего шага.</span><span class="sxs-lookup"><span data-stu-id="38dca-500">In the **Storage** section, wait until the status of the new storage account changes to *Online* in order to continue with the following step.</span></span>

    <span data-ttu-id="38dca-501">![Учетная запись хранения создана](maintainable-azure-websites-managing-change-and-scale/_static/image58.png "Учетная запись хранения создана")</span><span class="sxs-lookup"><span data-stu-id="38dca-501">![Storage Account created](maintainable-azure-websites-managing-change-and-scale/_static/image58.png "Storage Account created")</span></span>

    <span data-ttu-id="38dca-502">*Учетная запись хранения создана*</span><span class="sxs-lookup"><span data-stu-id="38dca-502">*Storage Account created*</span></span>
4. <span data-ttu-id="38dca-503">Щелкните имя учетной записи хранения, а затем щелкните ссылку на **панель мониторинга** в верхней части страницы.</span><span class="sxs-lookup"><span data-stu-id="38dca-503">Click on the storage account name and then click the **Dashboard** link at the top of the page.</span></span> <span data-ttu-id="38dca-504">На странице **панель мониторинга** представлены сведения о состоянии учетной записи и конечных точек службы, которые могут использоваться в приложениях.</span><span class="sxs-lookup"><span data-stu-id="38dca-504">The **Dashboard** page provides you with information about the status of the account and the service endpoints that can be used within your applications.</span></span>

    <span data-ttu-id="38dca-505">![Отображение панели мониторинга учетной записи хранения](maintainable-azure-websites-managing-change-and-scale/_static/image59.png "Отображение панели мониторинга учетной записи хранения")</span><span class="sxs-lookup"><span data-stu-id="38dca-505">![Displaying the Storage Account Dashboard](maintainable-azure-websites-managing-change-and-scale/_static/image59.png "Displaying the Storage Account Dashboard")</span></span>

    <span data-ttu-id="38dca-506">*Отображение панели мониторинга учетной записи хранения*</span><span class="sxs-lookup"><span data-stu-id="38dca-506">*Displaying the Storage Account Dashboard*</span></span>
5. <span data-ttu-id="38dca-507">Нажмите кнопку **Управление ключами доступа** на панели навигации.</span><span class="sxs-lookup"><span data-stu-id="38dca-507">Click the **Manage Access Keys** button in the navigation bar.</span></span>

    <span data-ttu-id="38dca-508">![Кнопка "Управление ключами доступа"](maintainable-azure-websites-managing-change-and-scale/_static/image60.png "Кнопка "Управление ключами доступа"")</span><span class="sxs-lookup"><span data-stu-id="38dca-508">![Manage Access Keys button](maintainable-azure-websites-managing-change-and-scale/_static/image60.png "Manage Access Keys button")</span></span>

    <span data-ttu-id="38dca-509">*Кнопка "Управление ключами доступа"*</span><span class="sxs-lookup"><span data-stu-id="38dca-509">*Manage Access Keys button*</span></span>
6. <span data-ttu-id="38dca-510">В диалоговом окне **Управление ключами доступа** скопируйте **имя учетной записи хранения** и **первичный ключ доступа** , которые понадобятся вам в следующем упражнении.</span><span class="sxs-lookup"><span data-stu-id="38dca-510">In the **Manage Access Keys** dialog box, copy the **Storage Account Name** and **Primary Access Key** as you will need them in the following exercise.</span></span> <span data-ttu-id="38dca-511">Затем закройте диалоговое окно.</span><span class="sxs-lookup"><span data-stu-id="38dca-511">Then, close the dialog box.</span></span>

    <span data-ttu-id="38dca-512">![Диалоговое окно «Управление ключом доступа»](maintainable-azure-websites-managing-change-and-scale/_static/image61.png "Диалоговое окно «Управление ключом доступа»")</span><span class="sxs-lookup"><span data-stu-id="38dca-512">![Manage Access Key dialog box](maintainable-azure-websites-managing-change-and-scale/_static/image61.png "Manage Access Key dialog box")</span></span>

    <span data-ttu-id="38dca-513">*Диалоговое окно «Управление ключом доступа»*</span><span class="sxs-lookup"><span data-stu-id="38dca-513">*Manage Access Key dialog box*</span></span>

<a id="Ex4Task2"></a>
#### <a name="task-2--uploading-an-asset-to-azure-blob-storage"></a><span data-ttu-id="38dca-514">Задача 2. Передача ресурса в хранилище BLOB-объектов Azure</span><span class="sxs-lookup"><span data-stu-id="38dca-514">Task 2 – Uploading an Asset to Azure Blob Storage</span></span>

<span data-ttu-id="38dca-515">В этой задаче вы будете использовать окно обозреватель сервера из Visual Studio для подключения к учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="38dca-515">In this task, you will use the Server Explorer window from Visual Studio to connect to your storage account.</span></span> <span data-ttu-id="38dca-516">Затем вы создадите контейнер больших двоичных объектов и загрузили файл с логотипом "головоломка" в контейнер.</span><span class="sxs-lookup"><span data-stu-id="38dca-516">You will then create a blob container and upload a file with the Geek Quiz logo to the container.</span></span>

1. <span data-ttu-id="38dca-517">Переключитесь на экземпляр Visual Studio с помощью решения **жееккуиз** из предыдущего упражнения.</span><span class="sxs-lookup"><span data-stu-id="38dca-517">Switch to the Visual Studio instance with the **GeekQuiz** solution from the previous exercise.</span></span>
2. <span data-ttu-id="38dca-518">В строке меню выберите **вид** и щелкните **Обозреватель сервера**.</span><span class="sxs-lookup"><span data-stu-id="38dca-518">From the menu bar, select **View** and then click **Server Explorer**.</span></span>
3. <span data-ttu-id="38dca-519">В **Обозреватель сервера**щелкните правой кнопкой мыши узел **Azure** и выберите **подключиться к Azure..** .. Войдите с помощью учетная запись Майкрософт, связанного с вашей подпиской.</span><span class="sxs-lookup"><span data-stu-id="38dca-519">In **Server Explorer**, right-click the **Azure** node and select **Connect to Azure...**. Sign in using the Microsoft account associated with your subscription.</span></span>

    ![Подключение к Windows Azure](maintainable-azure-websites-managing-change-and-scale/_static/image62.png)

    <span data-ttu-id="38dca-521">*Подключение к Azure*</span><span class="sxs-lookup"><span data-stu-id="38dca-521">*Connect to Azure*</span></span>
4. <span data-ttu-id="38dca-522">Разверните узел **Azure** , щелкните правой кнопкой мыши **хранилище** и выберите **подключить внешнее хранилище.** ...</span><span class="sxs-lookup"><span data-stu-id="38dca-522">Expand the **Azure** node, right-click **Storage** and select **Attach External Storage...**.</span></span>
5. <span data-ttu-id="38dca-523">В диалоговом окне **Добавление новой учетной записи хранения** введите **имя учетной** записи и **ключ учетной записи** , полученные в предыдущей задаче, и нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="38dca-523">In the **Add New Storage Account** dialog box, enter the **Account name** and **Account key** you obtained in the previous task and click **OK**.</span></span>

    ![Диалоговое окно "Добавление новой учетной записи хранения"](maintainable-azure-websites-managing-change-and-scale/_static/image63.png)

    <span data-ttu-id="38dca-525">*Диалоговое окно "Добавление новой учетной записи хранения"*</span><span class="sxs-lookup"><span data-stu-id="38dca-525">*Add New Storage Account dialog box*</span></span>
6. <span data-ttu-id="38dca-526">Ваша учетная запись хранения должна отображаться в узле " **хранилище** ".</span><span class="sxs-lookup"><span data-stu-id="38dca-526">Your storage account should appear under the **Storage** node.</span></span> <span data-ttu-id="38dca-527">Разверните учетную запись хранения, щелкните правой кнопкой мыши **BLOB-объекты** и выберите **создать контейнер BLOB-объектов.**</span><span class="sxs-lookup"><span data-stu-id="38dca-527">Expand your storage account, right-click **Blobs** and select **Create Blob Container...**.</span></span>

    <span data-ttu-id="38dca-528">![Создание контейнера больших двоичных объектов](maintainable-azure-websites-managing-change-and-scale/_static/image64.png "Создание контейнера больших двоичных объектов")</span><span class="sxs-lookup"><span data-stu-id="38dca-528">![Create Blob Container](maintainable-azure-websites-managing-change-and-scale/_static/image64.png "Create Blob Container")</span></span>

    <span data-ttu-id="38dca-529">*Создание контейнера больших двоичных объектов*</span><span class="sxs-lookup"><span data-stu-id="38dca-529">*Create Blob Container*</span></span>
7. <span data-ttu-id="38dca-530">В диалоговом окне **Создание контейнера больших двоичных объектов** введите имя для контейнера больших двоичных объектов и нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="38dca-530">In the **Create Blob Container** dialog box, enter a name for the blob container and click **OK**.</span></span>

    <span data-ttu-id="38dca-531">![Диалоговое окно "Создание контейнера больших двоичных объектов"](maintainable-azure-websites-managing-change-and-scale/_static/image65.png "Диалоговое окно "Создание контейнера больших двоичных объектов"")</span><span class="sxs-lookup"><span data-stu-id="38dca-531">![Create Blob Container dialog box](maintainable-azure-websites-managing-change-and-scale/_static/image65.png "Create Blob Container dialog box")</span></span>

    <span data-ttu-id="38dca-532">*Диалоговое окно "Создание контейнера больших двоичных объектов"*</span><span class="sxs-lookup"><span data-stu-id="38dca-532">*Create Blob Container dialog box*</span></span>
8. <span data-ttu-id="38dca-533">Новый контейнер больших двоичных объектов должен быть добавлен в узел **BLOB-объектов** .</span><span class="sxs-lookup"><span data-stu-id="38dca-533">The new blob container should be added to the **Blobs** node.</span></span> <span data-ttu-id="38dca-534">Измените разрешения доступа в контейнере, чтобы сделать контейнер открытым.</span><span class="sxs-lookup"><span data-stu-id="38dca-534">Change the access permissions in the container to make the container public.</span></span> <span data-ttu-id="38dca-535">Для этого щелкните правой кнопкой мыши контейнер **изображения** и выберите пункт **свойства**.</span><span class="sxs-lookup"><span data-stu-id="38dca-535">To do this, right-click the **images** container and select **Properties**.</span></span>

    <span data-ttu-id="38dca-536">![свойства контейнера изображений](maintainable-azure-websites-managing-change-and-scale/_static/image66.png "свойства контейнера изображений")</span><span class="sxs-lookup"><span data-stu-id="38dca-536">![images container properties](maintainable-azure-websites-managing-change-and-scale/_static/image66.png "images container properties")</span></span>

    <span data-ttu-id="38dca-537">*Свойства контейнера изображений*</span><span class="sxs-lookup"><span data-stu-id="38dca-537">*Images container properties*</span></span>
9. <span data-ttu-id="38dca-538">В окне **Свойства** установите **общий доступ на чтение** к **контейнеру**.</span><span class="sxs-lookup"><span data-stu-id="38dca-538">In the **Properties** window, set the **Public Read Access** to **Container**.</span></span>

    <span data-ttu-id="38dca-539">![Изменение свойства общего доступа для чтения](maintainable-azure-websites-managing-change-and-scale/_static/image67.png "Изменение свойства общего доступа для чтения")</span><span class="sxs-lookup"><span data-stu-id="38dca-539">![Changing public read access property](maintainable-azure-websites-managing-change-and-scale/_static/image67.png "Changing public read access property")</span></span>

    <span data-ttu-id="38dca-540">*Изменение свойства общего доступа для чтения*</span><span class="sxs-lookup"><span data-stu-id="38dca-540">*Changing public read access property*</span></span>
10. <span data-ttu-id="38dca-541">При появлении запроса в случае, если вы уверены, что хотите изменить свойство общего доступа, нажмите кнопку **Да**.</span><span class="sxs-lookup"><span data-stu-id="38dca-541">When prompted if you are sure you want to change the public access property, click **Yes**.</span></span>

    <span data-ttu-id="38dca-542">![Предупреждение Microsoft Visual Studio](maintainable-azure-websites-managing-change-and-scale/_static/image68.png "Предупреждение Microsoft Visual Studio")</span><span class="sxs-lookup"><span data-stu-id="38dca-542">![Microsoft Visual Studio warning](maintainable-azure-websites-managing-change-and-scale/_static/image68.png "Microsoft Visual Studio warning")</span></span>

    <span data-ttu-id="38dca-543">*Предупреждение Microsoft Visual Studio*</span><span class="sxs-lookup"><span data-stu-id="38dca-543">*Microsoft Visual Studio warning*</span></span>
11. <span data-ttu-id="38dca-544">В **Обозреватель сервера**щелкните правой кнопкой мыши контейнер BLOB-объектов **Images** и выберите пункт **Просмотр контейнера больших двоичных объектов**.</span><span class="sxs-lookup"><span data-stu-id="38dca-544">In **Server Explorer**, right-click in the **images** blob container and select **View Blob Container**.</span></span>

    <span data-ttu-id="38dca-545">![Просмотр контейнера больших двоичных объектов](maintainable-azure-websites-managing-change-and-scale/_static/image69.png "Просмотр контейнера больших двоичных объектов")</span><span class="sxs-lookup"><span data-stu-id="38dca-545">![View Blob Container](maintainable-azure-websites-managing-change-and-scale/_static/image69.png "View Blob Container")</span></span>

    <span data-ttu-id="38dca-546">*Просмотр контейнера больших двоичных объектов*</span><span class="sxs-lookup"><span data-stu-id="38dca-546">*View Blob Container*</span></span>
12. <span data-ttu-id="38dca-547">Контейнер изображений должен открываться в новом окне, и условные обозначения без записей должны отображаться.</span><span class="sxs-lookup"><span data-stu-id="38dca-547">The images container should open in a new window and a legend with no entries should be shown.</span></span> <span data-ttu-id="38dca-548">Щелкните значок **отправки** , чтобы отправить файл в контейнер больших двоичных объектов.</span><span class="sxs-lookup"><span data-stu-id="38dca-548">Click the **upload** icon to upload a file to the blob container.</span></span>

    <span data-ttu-id="38dca-549">![Контейнер изображений без записей](maintainable-azure-websites-managing-change-and-scale/_static/image70.png "Контейнер изображений без записей")</span><span class="sxs-lookup"><span data-stu-id="38dca-549">![Images container with no entries](maintainable-azure-websites-managing-change-and-scale/_static/image70.png "Images container with no entries")</span></span>

    <span data-ttu-id="38dca-550">*Контейнер изображений без записей*</span><span class="sxs-lookup"><span data-stu-id="38dca-550">*Images container with no entries*</span></span>
13. <span data-ttu-id="38dca-551">В диалоговом окне **Отправка большого двоичного объекта** перейдите в папку **Assets** лаборатории.</span><span class="sxs-lookup"><span data-stu-id="38dca-551">In the **Upload Blob** dialog box, navigate to the **Assets** folder of the lab.</span></span> <span data-ttu-id="38dca-552">Выберите файл **лого-БиГ. png** и нажмите кнопку **Открыть**.</span><span class="sxs-lookup"><span data-stu-id="38dca-552">Select the **logo-big.png** file and click **Open**.</span></span>
14. <span data-ttu-id="38dca-553">Дождитесь отправки файла.</span><span class="sxs-lookup"><span data-stu-id="38dca-553">Wait until the file is uploaded.</span></span> <span data-ttu-id="38dca-554">После завершения передачи файл должен быть указан в контейнере Images.</span><span class="sxs-lookup"><span data-stu-id="38dca-554">When the upload completes, the file should be listed in the images container.</span></span> <span data-ttu-id="38dca-555">Щелкните правой кнопкой мыши запись файла и выберите **Копировать URL-адрес**.</span><span class="sxs-lookup"><span data-stu-id="38dca-555">Right-click the file entry and select **Copy URL**.</span></span>

    <span data-ttu-id="38dca-556">![Копировать URL-адрес большого двоичного объекта](maintainable-azure-websites-managing-change-and-scale/_static/image71.png "Копировать URL-адрес файла большого двоичного объекта")</span><span class="sxs-lookup"><span data-stu-id="38dca-556">![Copy blob URL](maintainable-azure-websites-managing-change-and-scale/_static/image71.png "Copy blob file URL")</span></span>

    <span data-ttu-id="38dca-557">*Копировать URL-адрес большого двоичного объекта*</span><span class="sxs-lookup"><span data-stu-id="38dca-557">*Copy blob URL*</span></span>
15. <span data-ttu-id="38dca-558">Откройте Internet Explorer и вставьте URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="38dca-558">Open Internet Explorer and paste the URL.</span></span> <span data-ttu-id="38dca-559">В браузере должен отображаться следующий рисунок.</span><span class="sxs-lookup"><span data-stu-id="38dca-559">The following image should be shown in the browser.</span></span>

    <span data-ttu-id="38dca-560">![изображение лого-БиГ. png из хранилища BLOB-объектов Windows](maintainable-azure-websites-managing-change-and-scale/_static/image72.png "изображение лого-БиГ. png из хранилища")</span><span class="sxs-lookup"><span data-stu-id="38dca-560">![logo-big.png image from Windows Blob Storage](maintainable-azure-websites-managing-change-and-scale/_static/image72.png "logo-big.png image from storage")</span></span>

    <span data-ttu-id="38dca-561">*изображение лого-БиГ. png из хранилища BLOB-объектов Azure*</span><span class="sxs-lookup"><span data-stu-id="38dca-561">*logo-big.png image from Azure Blob Storage*</span></span>

<a id="Ex4Task3"></a>
#### <a name="task-3--updating-the-solution-to-consume-static-content-from-azure-blob-storage"></a><span data-ttu-id="38dca-562">Задача 3. Обновление решения для использования статического содержимого из хранилища BLOB-объектов Azure</span><span class="sxs-lookup"><span data-stu-id="38dca-562">Task 3 – Updating the Solution to Consume Static Content from Azure Blob Storage</span></span>

<span data-ttu-id="38dca-563">В этой задаче вы настроите решение **жееккуиз** для использования изображения, отправленного в хранилище BLOB-объектов Azure (вместо образа, расположенного в веб – приложении), добавив в файл **Web. config** правило перезаписи URL-адресов ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="38dca-563">In this task, you will configure the **GeekQuiz** solution to consume the image uploaded to Azure Blob Storage (instead of the image located in the web app) by adding an ASP.NET URL rewrite rule in the **web.config** file.</span></span>

1. <span data-ttu-id="38dca-564">В Visual Studio откройте файл **Web. config** в проекте **жееккуиз** и выберите элемент **&lt;System.&gt;** .</span><span class="sxs-lookup"><span data-stu-id="38dca-564">In Visual Studio, open the **Web.config** file inside the **GeekQuiz** project and locate the **&lt;system.webServer&gt;** element.</span></span>
2. <span data-ttu-id="38dca-565">Добавьте следующий код, чтобы добавить правило переопределения URL-адресов, обновив заполнитель именем учетной записи хранения.</span><span class="sxs-lookup"><span data-stu-id="38dca-565">Add the following code to add an URL rewrite rule, updating the placeholder with your storage account name.</span></span>

    <span data-ttu-id="38dca-566">(Фрагмент кода — *вебситесинпродуктион-EX4-урлревритеруле*)</span><span class="sxs-lookup"><span data-stu-id="38dca-566">(Code Snippet - *WebSitesInProduction - Ex4 - UrlRewriteRule*)</span></span>

    [!code-xml[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample17.xml)]

    > [!NOTE]
    > <span data-ttu-id="38dca-567">Переписывание URL-адресов — это процесс перехвата входящего веб-запроса и перенаправления запроса другому ресурсу.</span><span class="sxs-lookup"><span data-stu-id="38dca-567">URL rewriting is the process of intercepting an incoming Web request and redirecting the request to a different resource.</span></span> <span data-ttu-id="38dca-568">Правила переопределения URL-адресов сообщают подсистеме перезаписи о необходимости перенаправления запроса, а также место, где они должны перенаправляться.</span><span class="sxs-lookup"><span data-stu-id="38dca-568">The URL rewriting rules tells the rewriting engine when a request needs to be redirected, and where should they be redirected.</span></span> <span data-ttu-id="38dca-569">Правило перезаписи состоит из двух строк: шаблона для поиска в запрошенном URL-адресе (обычно с помощью регулярных выражений) и строки для замены шаблона, если он найден.</span><span class="sxs-lookup"><span data-stu-id="38dca-569">A rewriting rule is composed of two strings: the pattern to look for in the requested URL (usually, using regular expressions), and the string to replace the pattern with, if found.</span></span> <span data-ttu-id="38dca-570">Дополнительные сведения см. [в разделе перезапись URL-адресов в ASP.NET](https://msdn.microsoft.com/library/ms972974.aspx).</span><span class="sxs-lookup"><span data-stu-id="38dca-570">For more information, see [URL Rewriting in ASP.NET](https://msdn.microsoft.com/library/ms972974.aspx).</span></span>
3. <span data-ttu-id="38dca-571">Нажмите клавиши **CTRL + S** , чтобы сохранить изменения.</span><span class="sxs-lookup"><span data-stu-id="38dca-571">Press **CTRL + S** to save the changes.</span></span>
4. <span data-ttu-id="38dca-572">Откройте новую консоль **Git Bash** , чтобы развернуть обновленное приложение в службе приложений Azure.</span><span class="sxs-lookup"><span data-stu-id="38dca-572">Open a new **Git Bash** console to deploy the updated application to Azure App Service.</span></span>
5. <span data-ttu-id="38dca-573">Выполните следующие команды, чтобы отправить изменения в Azure.</span><span class="sxs-lookup"><span data-stu-id="38dca-573">Execute the following commands to push the changes to Azure.</span></span> <span data-ttu-id="38dca-574">Замените заполнитель *[My-Application-path]* на путь к решению **жееккуиз** .</span><span class="sxs-lookup"><span data-stu-id="38dca-574">Update the *[YOUR-APPLICATION-PATH]* placeholder with the path to the **GeekQuiz** solution.</span></span> <span data-ttu-id="38dca-575">Вам будет предложено ввести пароль развертывания.</span><span class="sxs-lookup"><span data-stu-id="38dca-575">You will be prompted for your deployment password.</span></span>

    [!code-console[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample18.cmd)]

    ![Развертывание обновления в Azure](maintainable-azure-websites-managing-change-and-scale/_static/image73.png)

    <span data-ttu-id="38dca-577">*Развертывание обновления в Azure*</span><span class="sxs-lookup"><span data-stu-id="38dca-577">*Deploying update to Azure*</span></span>

<a id="Ex4Task4"></a>
#### <a name="task-4--verification"></a><span data-ttu-id="38dca-578">Задача 4 — Проверка</span><span class="sxs-lookup"><span data-stu-id="38dca-578">Task 4 – Verification</span></span>

<span data-ttu-id="38dca-579">В этой задаче вы будете использовать **Internet Explorer** для просмотра приложения " **викторина по владению** " и проверки того, что правило переопределения URL-адресов для образов работает и вы будете перенаправлены к образу, размещенному в **хранилище больших двоичных объектов Azure**.</span><span class="sxs-lookup"><span data-stu-id="38dca-579">In this task you will use **Internet Explorer** to browse the **Geek Quiz** application and check that the URL rewrite rule for images works and you are redirected to the image hosted on **Azure Blob Storage**.</span></span>

1. <span data-ttu-id="38dca-580">Откройте Internet Explorer и перейдите к своему веб-приложению (например, `http://<your-web-site>.azurewebsites.net`).</span><span class="sxs-lookup"><span data-stu-id="38dca-580">Open Internet Explorer and navigate to your web app (e.g. `http://<your-web-site>.azurewebsites.net`).</span></span> <span data-ttu-id="38dca-581">Войдите в систему, используя ранее созданные учетные данные.</span><span class="sxs-lookup"><span data-stu-id="38dca-581">Log in using the previously created credentials.</span></span>

    <span data-ttu-id="38dca-582">![Отображение веб-приложения «викторина» с изображением](maintainable-azure-websites-managing-change-and-scale/_static/image74.png "Отображение веб-приложения «викторина» с изображением")</span><span class="sxs-lookup"><span data-stu-id="38dca-582">![Showing the Geek Quiz web app with the image](maintainable-azure-websites-managing-change-and-scale/_static/image74.png "Showing the Geek Quiz web app with the image")</span></span>

    <span data-ttu-id="38dca-583">*Отображение веб-приложения «викторина» с изображением*</span><span class="sxs-lookup"><span data-stu-id="38dca-583">*Showing the Geek Quiz web app with the image*</span></span>
2. <span data-ttu-id="38dca-584">Нажмите клавишу **F12** , чтобы запустить средства разработки, перейдите на вкладку **сеть** и начните запись.</span><span class="sxs-lookup"><span data-stu-id="38dca-584">Press **F12** to launch the development tools, select the **Network** tab and start recording.</span></span>

    <span data-ttu-id="38dca-585">![Запуск записи в сеть](maintainable-azure-websites-managing-change-and-scale/_static/image75.png "Запуск записи в сеть")</span><span class="sxs-lookup"><span data-stu-id="38dca-585">![Starting network recording](maintainable-azure-websites-managing-change-and-scale/_static/image75.png "Starting network recording")</span></span>

    <span data-ttu-id="38dca-586">*Запуск записи в сеть*</span><span class="sxs-lookup"><span data-stu-id="38dca-586">*Starting network recording*</span></span>
3. <span data-ttu-id="38dca-587">Нажмите клавиши **CTRL + F5** , чтобы обновить веб-страницу.</span><span class="sxs-lookup"><span data-stu-id="38dca-587">Press **CTRL + F5** to refresh the web page.</span></span>
4. <span data-ttu-id="38dca-588">После завершения загрузки страницы вы увидите HTTP-запрос к **/ИМГ/лого-БиГ.ПНГ** URL с результатом HTTP **301** (перенаправление), а другой запрос URL-адреса `http://[YOUR-STORAGE-ACCOUNT].blob.core.windows.net/images/logo-big.png` с результатом HTTP **200** .</span><span class="sxs-lookup"><span data-stu-id="38dca-588">Once the page has finished loading, you should see an HTTP request for the **/img/logo-big.png** URL with an HTTP **301** result (redirect) and another request for `http://[YOUR-STORAGE-ACCOUNT].blob.core.windows.net/images/logo-big.png` URL with a HTTP **200** result.</span></span>

    <span data-ttu-id="38dca-589">![Проверка перенаправления URL-адреса](maintainable-azure-websites-managing-change-and-scale/_static/image76.png "Отображение перенаправления в средствах разработки")</span><span class="sxs-lookup"><span data-stu-id="38dca-589">![Verifying the URL redirect](maintainable-azure-websites-managing-change-and-scale/_static/image76.png "Showing the redirect in Dev Tools")</span></span>

    <span data-ttu-id="38dca-590">*Проверка перенаправления URL-адреса*</span><span class="sxs-lookup"><span data-stu-id="38dca-590">*Verifying the URL redirect*</span></span>

<a id="Exercise5"></a>
### <a name="exercise-5-using-autoscale-for-web-apps"></a><span data-ttu-id="38dca-591">Упражнение 5. Использование автомасштабирования для веб-приложений</span><span class="sxs-lookup"><span data-stu-id="38dca-591">Exercise 5: Using Autoscale for Web Apps</span></span>

> [!NOTE]
> <span data-ttu-id="38dca-592">Это упражнение не является обязательным, так как для него требуется поддержка веб-нагрузки &amp; тестирования производительности, которая доступна только для **выпуска Visual Studio 2013 Ultimate**.</span><span class="sxs-lookup"><span data-stu-id="38dca-592">This exercise is optional, since it requires support for Web Load &amp; Performance Testing which is only available for **Visual Studio 2013 Ultimate Edition**.</span></span> <span data-ttu-id="38dca-593">Дополнительные сведения о конкретных функциях Visual Studio 2013 см. [здесь](https://www.microsoft.com/visualstudio/eng/products/compare).</span><span class="sxs-lookup"><span data-stu-id="38dca-593">For more information on specific Visual Studio 2013 features, compare versions [here](https://www.microsoft.com/visualstudio/eng/products/compare).</span></span>

<span data-ttu-id="38dca-594">**Веб-приложения службы приложений Azure** предоставляют функцию автомасштабирования для веб-приложений, выполняемых в **стандартном режиме**.</span><span class="sxs-lookup"><span data-stu-id="38dca-594">**Azure App Service Web Apps** provides the Autoscale feature for web apps running in **Standard Mode**.</span></span> <span data-ttu-id="38dca-595">Автомасштабирование позволяет Azure автоматически масштабировать число экземпляров веб-приложения в зависимости от нагрузки.</span><span class="sxs-lookup"><span data-stu-id="38dca-595">Autoscale lets Azure automatically scale the instance count of your web app depending on the load.</span></span> <span data-ttu-id="38dca-596">Если включен Автомасштабирование, Azure проверяет ЦП веб-приложения каждые пять минут и добавляет экземпляры в тот момент, когда это необходимо.</span><span class="sxs-lookup"><span data-stu-id="38dca-596">When Autoscale is enabled, Azure checks the CPU of your web app once every five minutes and adds instances as needed at that point in time.</span></span> <span data-ttu-id="38dca-597">Если загрузка ЦП мала, Azure будет удалять экземпляры каждые два часа, чтобы гарантировать, что производительность веб-приложения не будет снижена.</span><span class="sxs-lookup"><span data-stu-id="38dca-597">If the CPU usage is low, Azure will remove instances once every two hours to ensure that the performance of your web app is not degraded.</span></span>

<span data-ttu-id="38dca-598">В этом упражнении предстоит выполнить шаги, необходимые для настройки функции **автомасштабирования** для веб-приложения " **Викторина** ".</span><span class="sxs-lookup"><span data-stu-id="38dca-598">In this exercise you will go through the steps required to configure the **Autoscale** feature for the **Geek Quiz** web app.</span></span> <span data-ttu-id="38dca-599">Вы проверите эту функцию, выполнив нагрузочный тест Visual Studio, чтобы создать достаточно нагрузки на ЦП для приложения, чтобы активировать обновление экземпляра.</span><span class="sxs-lookup"><span data-stu-id="38dca-599">You will verify this feature by running a Visual Studio load test to generate enough CPU load on the application to trigger an instance upgrade.</span></span>

<a id="Ex5Task1"></a>
#### <a name="task-1--configuring-autoscale-based-on-the-cpu-metric"></a><span data-ttu-id="38dca-600">Задача 1. Настройка автомасштабирования на основе метрики ЦП</span><span class="sxs-lookup"><span data-stu-id="38dca-600">Task 1 – Configuring Autoscale Based on the CPU Metric</span></span>

<span data-ttu-id="38dca-601">В этой задаче вы будете использовать портал управления Azure, чтобы включить функцию автомасштабирования для веб-приложения, созданного в упражнении 2.</span><span class="sxs-lookup"><span data-stu-id="38dca-601">In this task you will use the Azure management portal to enable the Autoscale feature for the web app you created in Exercise 2.</span></span>

1. <span data-ttu-id="38dca-602">На [портале управления Azure](https://manage.windowsazure.com/)выберите веб **-сайты** и щелкните веб-приложение, созданное в упражнении 2.</span><span class="sxs-lookup"><span data-stu-id="38dca-602">In the [Azure management portal](https://manage.windowsazure.com/), select **Websites** and click the web app you created in Exercise 2.</span></span>
2. <span data-ttu-id="38dca-603">Перейдите на страницу **шкалы** .</span><span class="sxs-lookup"><span data-stu-id="38dca-603">Navigate to the **Scale** page.</span></span> <span data-ttu-id="38dca-604">В разделе **емкость** выберите **ЦП** для параметра **Масштаб по конфигурации метрик** .</span><span class="sxs-lookup"><span data-stu-id="38dca-604">Under the **capacity** section, select **CPU** for the **Scale by Metric** configuration.</span></span>

    > [!NOTE]
    > <span data-ttu-id="38dca-605">При масштабировании по ЦП Azure динамически корректирует количество экземпляров, используемых приложением при изменении загрузки ЦП.</span><span class="sxs-lookup"><span data-stu-id="38dca-605">When scaling by CPU, Azure dynamically adjusts the number of instances that the app uses if the CPU usage changes.</span></span>

    <span data-ttu-id="38dca-606">![Выбор для масштабирования по ЦП](maintainable-azure-websites-managing-change-and-scale/_static/image77.png "Выбор метрики ЦП для автоматического масштабирования")</span><span class="sxs-lookup"><span data-stu-id="38dca-606">![Selecting to scale by CPU](maintainable-azure-websites-managing-change-and-scale/_static/image77.png "Selecting the CPU metric for auto scaling")</span></span>

    <span data-ttu-id="38dca-607">*Выбор для масштабирования по ЦП*</span><span class="sxs-lookup"><span data-stu-id="38dca-607">*Selecting to scale by CPU*</span></span>
3. <span data-ttu-id="38dca-608">Измените конфигурацию **целевого процессора** на **20**-**40** %.</span><span class="sxs-lookup"><span data-stu-id="38dca-608">Change the **Target CPU** configuration to **20**-**40** percent.</span></span>

    > [!NOTE]
    > <span data-ttu-id="38dca-609">Этот диапазон представляет среднюю загрузку ЦП для веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="38dca-609">This range represents the average CPU usage for your web app.</span></span> <span data-ttu-id="38dca-610">Azure добавит или удалите экземпляры для сохранения веб-приложения в этом диапазоне.</span><span class="sxs-lookup"><span data-stu-id="38dca-610">Azure will add or remove instances to keep your web app in this range.</span></span> <span data-ttu-id="38dca-611">Минимальное и максимальное число экземпляров, используемых для масштабирования, задается в конфигурации **количества экземпляров** .</span><span class="sxs-lookup"><span data-stu-id="38dca-611">The minimum and maximum number of instances used for scaling is specified in the **Instance Count** configuration.</span></span> <span data-ttu-id="38dca-612">Azure никогда не выйдет за этот предел.</span><span class="sxs-lookup"><span data-stu-id="38dca-612">Azure will never go above or beyond that limit.</span></span>
    >
    > <span data-ttu-id="38dca-613">Значения **целевого ЦП** по умолчанию изменяются только для целей этого лабораторного занятия.</span><span class="sxs-lookup"><span data-stu-id="38dca-613">The default **Target CPU** values are modified just for the purposes of this lab.</span></span> <span data-ttu-id="38dca-614">Настраивая диапазон ЦП мелкими значениями, вы увеличиваете вероятность запуска автоматического масштабирования при помещении средней нагрузки в приложение.</span><span class="sxs-lookup"><span data-stu-id="38dca-614">By configuring the CPU range with small values, you are increasing the chances to trigger Autoscale when a moderate load is placed on the application.</span></span>

    <span data-ttu-id="38dca-615">![Изменение целевого ЦП на значение от 20 до 40%](maintainable-azure-websites-managing-change-and-scale/_static/image78.png "Изменение целевого ЦП на значение от 20 до 40%")</span><span class="sxs-lookup"><span data-stu-id="38dca-615">![Changing the target CPU to be between 20 and 40 percent](maintainable-azure-websites-managing-change-and-scale/_static/image78.png "Changing the target CPU to be between 20 and 40 percent")</span></span>

    <span data-ttu-id="38dca-616">*Изменение целевого ЦП на значение от 20 до 40%*</span><span class="sxs-lookup"><span data-stu-id="38dca-616">*Changing the Target CPU to be between 20 and 40 percent*</span></span>
4. <span data-ttu-id="38dca-617">Нажмите кнопку **сохранить** на панели команд, чтобы сохранить изменения.</span><span class="sxs-lookup"><span data-stu-id="38dca-617">Click **Save** in the command bar to save the changes.</span></span>

<a id="Ex5Task2"></a>
#### <a name="task-2--load-testing-with-visual-studio"></a><span data-ttu-id="38dca-618">Задача 2. нагрузочное тестирование с помощью Visual Studio</span><span class="sxs-lookup"><span data-stu-id="38dca-618">Task 2 – Load Testing with Visual Studio</span></span>

<span data-ttu-id="38dca-619">Теперь, когда **Автомасштабирование** настроено, вы создадите **проект веб-тестов производительности и нагрузочного теста** в Visual Studio для создания некоторой нагрузки на ЦП веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="38dca-619">Now that **Autoscale** has been configured, you will create a **Web Performance and Load Test Project** in Visual Studio to generate some CPU load on your web app.</span></span>

1. <span data-ttu-id="38dca-620">Откройте **Visual Studio Ultimate 2013** и выберите **файл | Создать | Проект...** для запуска нового решения.</span><span class="sxs-lookup"><span data-stu-id="38dca-620">Open **Visual Studio Ultimate 2013** and select **File | New | Project...** to start a new solution.</span></span>

    <span data-ttu-id="38dca-621">![Создание нового проекта](maintainable-azure-websites-managing-change-and-scale/_static/image79.png "Создание нового проекта")</span><span class="sxs-lookup"><span data-stu-id="38dca-621">![Creating a new project](maintainable-azure-websites-managing-change-and-scale/_static/image79.png "Creating a new project")</span></span>

    <span data-ttu-id="38dca-622">*Создание нового проекта*</span><span class="sxs-lookup"><span data-stu-id="38dca-622">*Creating a new project*</span></span>
2. <span data-ttu-id="38dca-623">В диалоговом окне **Новый проект** выберите **проект веб-тесты производительности и нагрузочного теста** в **визуальном C# элементе |** Вкладка "тест". Убедитесь, что выбрано **.NET Framework 4,5** , назовите проект *вебандлоадтестпрожект*, выберите **Расположение** и нажмите кнопку " **ОК**".</span><span class="sxs-lookup"><span data-stu-id="38dca-623">In the **New Project** dialog box, select **Web Performance and Load Test Project** under the **Visual C# | Test** tab. Make sure **.NET Framework 4.5** is selected, name the project *WebAndLoadTestProject*, choose a **Location** and click **OK**.</span></span>

    <span data-ttu-id="38dca-624">![Создание нового проекта веб-теста и тестовой нагрузки](maintainable-azure-websites-managing-change-and-scale/_static/image80.png "Создание нового проекта веб-теста и тестовой нагрузки")</span><span class="sxs-lookup"><span data-stu-id="38dca-624">![Creating a new Web and Load Test project](maintainable-azure-websites-managing-change-and-scale/_static/image80.png "Creating a new Web and Load Test project")</span></span>

    <span data-ttu-id="38dca-625">*Создание нового проекта веб-теста и тестовой нагрузки*</span><span class="sxs-lookup"><span data-stu-id="38dca-625">*Creating a new Web and Load Test project*</span></span>
3. <span data-ttu-id="38dca-626">Щелкните правой кнопкой **мыши узел веб-test1 в** веб- **test1. webtest** и выберите команду **Добавить запрос**.</span><span class="sxs-lookup"><span data-stu-id="38dca-626">In the **WebTest1.webtest** Right-click the **WebTest1** node and click **Add Request**.</span></span>

    <span data-ttu-id="38dca-627">![Добавление запроса в test1](maintainable-azure-websites-managing-change-and-scale/_static/image81.png "Добавление запроса в test1")</span><span class="sxs-lookup"><span data-stu-id="38dca-627">![Adding a request to WebTest1](maintainable-azure-websites-managing-change-and-scale/_static/image81.png "Adding a request to WebTest1")</span></span>

    <span data-ttu-id="38dca-628">*Добавление запроса в test1*</span><span class="sxs-lookup"><span data-stu-id="38dca-628">*Adding a request to WebTest1*</span></span>
4. <span data-ttu-id="38dca-629">В окне **Свойства** нового узла запроса обновите свойство **URL** , чтобы оно указывало на URL веб-приложения (например, *[http://geek-quiz.azurewebsites.net/](http://geek-quiz.azurewebsites.net/)* ).</span><span class="sxs-lookup"><span data-stu-id="38dca-629">In the **Properties** window of the new request node, update the **Url** property to point to the URL of your web app (e.g. *[http://geek-quiz.azurewebsites.net/](http://geek-quiz.azurewebsites.net/)*).</span></span>

    <span data-ttu-id="38dca-630">![Изменение свойства URL-адреса](maintainable-azure-websites-managing-change-and-scale/_static/image82.png "Изменение свойства URL-адреса")</span><span class="sxs-lookup"><span data-stu-id="38dca-630">![Changing the Url property](maintainable-azure-websites-managing-change-and-scale/_static/image82.png "Changing the Url property")</span></span>

    <span data-ttu-id="38dca-631">*Изменение свойства URL-адреса*</span><span class="sxs-lookup"><span data-stu-id="38dca-631">*Changing the Url property*</span></span>
5. <span data-ttu-id="38dca-632">В окне веб- **теста. webtest** щелкните правой кнопкой мыши элемент веб **test1** и выберите команду **Добавить цикл...** .</span><span class="sxs-lookup"><span data-stu-id="38dca-632">In the **WebTest1.webtest** window, right-click **WebTest1** and click **Add Loop...**.</span></span>

    <span data-ttu-id="38dca-633">![Добавление цикла в test1](maintainable-azure-websites-managing-change-and-scale/_static/image83.png "Добавление цикла в test1")</span><span class="sxs-lookup"><span data-stu-id="38dca-633">![Adding a loop to WebTest1](maintainable-azure-websites-managing-change-and-scale/_static/image83.png "Adding a loop to WebTest1")</span></span>

    <span data-ttu-id="38dca-634">*Добавление цикла в test1*</span><span class="sxs-lookup"><span data-stu-id="38dca-634">*Adding a loop to WebTest1*</span></span>
6. <span data-ttu-id="38dca-635">В диалоговом окне **Добавление условного правила и элементы в цикл** выберите правило **цикл по** элементам и измените следующие свойства.</span><span class="sxs-lookup"><span data-stu-id="38dca-635">In the **Add Conditional Rule and Items to Loop** dialog box, select the **For Loop** rule and modify the following properties.</span></span>

   1. <span data-ttu-id="38dca-636">**Завершающее значение:** 1000</span><span class="sxs-lookup"><span data-stu-id="38dca-636">**Terminating value:** 1000</span></span>
   2. <span data-ttu-id="38dca-637">**Имя параметра контекста:** Итераци</span><span class="sxs-lookup"><span data-stu-id="38dca-637">**Context Parameter Name:** Iterator</span></span>
   3. <span data-ttu-id="38dca-638">**Значение приращения:** 1</span><span class="sxs-lookup"><span data-stu-id="38dca-638">**Increment Value:** 1</span></span>

      <span data-ttu-id="38dca-639">![Выбор правила цикла for и обновление свойств](maintainable-azure-websites-managing-change-and-scale/_static/image84.png "Выбор правила цикла for и обновление свойств")</span><span class="sxs-lookup"><span data-stu-id="38dca-639">![Selecting the For Loop rule and updating the properties](maintainable-azure-websites-managing-change-and-scale/_static/image84.png "Selecting the For Loop rule and updating the properties")</span></span>

      <span data-ttu-id="38dca-640">*Выбор правила цикла for и обновление свойств*</span><span class="sxs-lookup"><span data-stu-id="38dca-640">*Selecting the For Loop rule and updating the properties*</span></span>
7. <span data-ttu-id="38dca-641">В разделе **элементы в цикле** выберите созданный ранее запрос, который будет первым и последним элементом цикла.</span><span class="sxs-lookup"><span data-stu-id="38dca-641">Under the **Items in loop** section, select the request you created previously to be the first and last item for the loop.</span></span> <span data-ttu-id="38dca-642">Чтобы продолжить, нажмите кнопку **ОК** .</span><span class="sxs-lookup"><span data-stu-id="38dca-642">Click **OK** to continue.</span></span>

    <span data-ttu-id="38dca-643">![Выбор первого и последнего элементов цикла](maintainable-azure-websites-managing-change-and-scale/_static/image85.png "Выбор первого и последнего элементов цикла")</span><span class="sxs-lookup"><span data-stu-id="38dca-643">![Selecting the first and last items for the loop](maintainable-azure-websites-managing-change-and-scale/_static/image85.png "Selecting the first and last items for the loop")</span></span>

    <span data-ttu-id="38dca-644">*Выбор первого и последнего элементов цикла*</span><span class="sxs-lookup"><span data-stu-id="38dca-644">*Selecting the first and last items for the loop*</span></span>
8. <span data-ttu-id="38dca-645">В **Обозреватель решений**щелкните правой кнопкой мыши проект **вебандлоадтестпрожект** , разверните меню **Добавить** и выберите пункт **нагрузочный тест...** .</span><span class="sxs-lookup"><span data-stu-id="38dca-645">In **Solution Explorer**, right-click the **WebAndLoadTestProject** project, expand the **Add** menu and select **Load Test...**.</span></span>

    <span data-ttu-id="38dca-646">![Добавление нагрузочного теста в проект Вебандлоадтестпрожект](maintainable-azure-websites-managing-change-and-scale/_static/image86.png "Добавление нагрузочного теста в проект Вебандлоадтестпрожект")</span><span class="sxs-lookup"><span data-stu-id="38dca-646">![Adding a Load Test to the WebAndLoadTestProject project](maintainable-azure-websites-managing-change-and-scale/_static/image86.png "Adding a Load Test to the WebAndLoadTestProject project")</span></span>

    <span data-ttu-id="38dca-647">*Добавление нагрузочного теста в проект Вебандлоадтестпрожект*</span><span class="sxs-lookup"><span data-stu-id="38dca-647">*Adding a Load Test to the WebAndLoadTestProject project*</span></span>
9. <span data-ttu-id="38dca-648">В диалоговом окне **создание мастер тестовой нагрузки** нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="38dca-648">In the **New Load Test Wizard** dialog box, click **Next**.</span></span>

    <span data-ttu-id="38dca-649">![Новые мастер тестовой нагрузки](maintainable-azure-websites-managing-change-and-scale/_static/image87.png "Новые мастер тестовой нагрузки")</span><span class="sxs-lookup"><span data-stu-id="38dca-649">![New Load Test Wizard](maintainable-azure-websites-managing-change-and-scale/_static/image87.png "New Load Test Wizard")</span></span>

    <span data-ttu-id="38dca-650">*Новые мастер тестовой нагрузки*</span><span class="sxs-lookup"><span data-stu-id="38dca-650">*New Load Test Wizard*</span></span>
10. <span data-ttu-id="38dca-651">На странице **сценарий** выберите **не использовать время обработки** и нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="38dca-651">In the **Scenario** page, select **Do not use think times** and click **Next**.</span></span>

    <span data-ttu-id="38dca-652">![Выбор не для использования времени на обдумывание](maintainable-azure-websites-managing-change-and-scale/_static/image88.png "Выбор не для использования времени на обдумывание")</span><span class="sxs-lookup"><span data-stu-id="38dca-652">![Selecting not to use think times](maintainable-azure-websites-managing-change-and-scale/_static/image88.png "Selecting not to use think times")</span></span>

    <span data-ttu-id="38dca-653">*Выбор не для использования времени на обдумывание*</span><span class="sxs-lookup"><span data-stu-id="38dca-653">*Selecting not to use think times*</span></span>
11. <span data-ttu-id="38dca-654">На странице **шаблон нагрузки** убедитесь, что выбран параметр **постоянная нагрузка** .</span><span class="sxs-lookup"><span data-stu-id="38dca-654">In the **Load Pattern** page, make sure that the **Constant Load** option is selected.</span></span> <span data-ttu-id="38dca-655">Измените значение параметра **Счетчик пользователей** на **250** пользователей и нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="38dca-655">Change the **User Count** setting to **250** users and click **Next**.</span></span>

    <span data-ttu-id="38dca-656">![Изменение числа пользователей на 250](maintainable-azure-websites-managing-change-and-scale/_static/image89.png "Изменение числа пользователей на 250")</span><span class="sxs-lookup"><span data-stu-id="38dca-656">![Changing the user count to 250](maintainable-azure-websites-managing-change-and-scale/_static/image89.png "Changing the user count to 250")</span></span>

    <span data-ttu-id="38dca-657">*Изменение числа пользователей на 250*</span><span class="sxs-lookup"><span data-stu-id="38dca-657">*Changing the user count to 250*</span></span>
12. <span data-ttu-id="38dca-658">На странице **модель тестового набора** выберите в **зависимости от последовательного порядка тестов** и нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="38dca-658">In the **Test Mix Model** page, select **Based on sequential test order** and click **Next**.</span></span>

    <span data-ttu-id="38dca-659">![Выбор модели тестового набора](maintainable-azure-websites-managing-change-and-scale/_static/image90.png "Выбор модели тестового набора")</span><span class="sxs-lookup"><span data-stu-id="38dca-659">![Selecting the test mix model](maintainable-azure-websites-managing-change-and-scale/_static/image90.png "Selecting the test mix model")</span></span>

    <span data-ttu-id="38dca-660">*Выбор модели тестового набора*</span><span class="sxs-lookup"><span data-stu-id="38dca-660">*Selecting the test mix model*</span></span>
13. <span data-ttu-id="38dca-661">На странице **модель тестового набора** нажмите кнопку **Добавить...** , чтобы добавить тест в набор.</span><span class="sxs-lookup"><span data-stu-id="38dca-661">In the **Test Mix Model** page, click **Add...** to add a test to the mix.</span></span>

    <span data-ttu-id="38dca-662">![Добавление теста в тестовый набор](maintainable-azure-websites-managing-change-and-scale/_static/image91.png "Добавление теста в тестовый набор")</span><span class="sxs-lookup"><span data-stu-id="38dca-662">![Adding a test to the test mix](maintainable-azure-websites-managing-change-and-scale/_static/image91.png "Adding a test to the test mix")</span></span>

    <span data-ttu-id="38dca-663">*Добавление теста в тестовый набор*</span><span class="sxs-lookup"><span data-stu-id="38dca-663">*Adding a test to the test mix*</span></span>
14. <span data-ttu-id="38dca-664">В диалоговом окне **Добавление тестов** дважды щелкните элемент веб **test1** , чтобы добавить тест в список **Выбранные тесты** .</span><span class="sxs-lookup"><span data-stu-id="38dca-664">In the **Add Tests** dialog box, double-click **WebTest1** to add the test to the **Selected tests** list.</span></span> <span data-ttu-id="38dca-665">Чтобы продолжить, нажмите кнопку **ОК** .</span><span class="sxs-lookup"><span data-stu-id="38dca-665">Click **OK** to continue.</span></span>

    <span data-ttu-id="38dca-666">![Добавление теста веб-test1](maintainable-azure-websites-managing-change-and-scale/_static/image92.png "Добавление теста веб-test1")</span><span class="sxs-lookup"><span data-stu-id="38dca-666">![Adding the WebTest1 test](maintainable-azure-websites-managing-change-and-scale/_static/image92.png "Adding the WebTest1 test")</span></span>

    <span data-ttu-id="38dca-667">*Добавление теста веб-test1*</span><span class="sxs-lookup"><span data-stu-id="38dca-667">*Adding the WebTest1 test*</span></span>
15. <span data-ttu-id="38dca-668">Вернитесь на страницу " **тестовый набор** " и нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="38dca-668">Back in the **Test Mix** page, click **Next**.</span></span>

    <span data-ttu-id="38dca-669">![Завершение страницы тестового набора](maintainable-azure-websites-managing-change-and-scale/_static/image93.png "Завершение страницы тестового набора")</span><span class="sxs-lookup"><span data-stu-id="38dca-669">![Completing the Test Mix page](maintainable-azure-websites-managing-change-and-scale/_static/image93.png "Completing the Test Mix page")</span></span>

    <span data-ttu-id="38dca-670">*Завершение страницы тестового набора*</span><span class="sxs-lookup"><span data-stu-id="38dca-670">*Completing the Test Mix page*</span></span>
16. <span data-ttu-id="38dca-671">На странице **сетевой профиль** нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="38dca-671">In the **Network Mix** page, click **Next**.</span></span>

    <span data-ttu-id="38dca-672">![Нажатие кнопки "Далее" на странице "смешанный сетевой профиль"](maintainable-azure-websites-managing-change-and-scale/_static/image94.png "Нажатие кнопки "Далее" на странице "смешанный сетевой профиль"")</span><span class="sxs-lookup"><span data-stu-id="38dca-672">![Clicking next in the Network Mix page](maintainable-azure-websites-managing-change-and-scale/_static/image94.png "Clicking next in the Network Mix page")</span></span>

    <span data-ttu-id="38dca-673">*Нажатие кнопки "Далее" на странице "смешанный сетевой профиль"*</span><span class="sxs-lookup"><span data-stu-id="38dca-673">*Clicking next in the Network Mix page*</span></span>
17. <span data-ttu-id="38dca-674">На странице **набор браузеров** выберите **Internet Explorer 10,0** в качестве типа браузера и нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="38dca-674">In the **Browser Mix** page, select **Internet Explorer 10.0** as the browser type and click **Next**.</span></span>

    <span data-ttu-id="38dca-675">![Выбор типа браузера](maintainable-azure-websites-managing-change-and-scale/_static/image95.png "Выбор типа браузера")</span><span class="sxs-lookup"><span data-stu-id="38dca-675">![Selecting the browser type](maintainable-azure-websites-managing-change-and-scale/_static/image95.png "Selecting the browser type")</span></span>

    <span data-ttu-id="38dca-676">*Выбор типа браузера*</span><span class="sxs-lookup"><span data-stu-id="38dca-676">*Selecting the browser type*</span></span>
18. <span data-ttu-id="38dca-677">На странице **наборы счетчиков** нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="38dca-677">In the **Counter Sets** page, click **Next**.</span></span>

    <span data-ttu-id="38dca-678">![Нажатие кнопки "Далее" на странице "наборы счетчиков"](maintainable-azure-websites-managing-change-and-scale/_static/image96.png "Нажатие кнопки "Далее" на странице "наборы счетчиков"")</span><span class="sxs-lookup"><span data-stu-id="38dca-678">![Clicking Next in the Counter Sets page](maintainable-azure-websites-managing-change-and-scale/_static/image96.png "Clicking Next in the Counter Sets page")</span></span>

    <span data-ttu-id="38dca-679">*Нажатие кнопки "Далее" на странице "наборы счетчиков"*</span><span class="sxs-lookup"><span data-stu-id="38dca-679">*Clicking Next in the Counter Sets page*</span></span>
19. <span data-ttu-id="38dca-680">На странице **Параметры запуска** задайте для параметра **Длительность нагрузочного теста** значение **5 минут** и нажмите кнопку **Готово**.</span><span class="sxs-lookup"><span data-stu-id="38dca-680">In the **Run Settings** page, set the **Load test duration** to **5 minutes** and click **Finish**.</span></span>

    <span data-ttu-id="38dca-681">![Задание длительности нагрузочного теста в 5 минут](maintainable-azure-websites-managing-change-and-scale/_static/image97.png "Задание длительности нагрузочного теста в 5 минут")</span><span class="sxs-lookup"><span data-stu-id="38dca-681">![Setting the load test duration to 5 minutes](maintainable-azure-websites-managing-change-and-scale/_static/image97.png "Setting the load test duration to 5 minutes")</span></span>

    <span data-ttu-id="38dca-682">*Задание длительности нагрузочного теста в 5 минут*</span><span class="sxs-lookup"><span data-stu-id="38dca-682">*Setting the load test duration to 5 minutes*</span></span>
20. <span data-ttu-id="38dca-683">В **Обозреватель решений**дважды щелкните файл **Local. Settings** , чтобы просмотреть параметры тестирования.</span><span class="sxs-lookup"><span data-stu-id="38dca-683">In **Solution Explorer**, double-click the **Local.settings** file to explore the test settings.</span></span> <span data-ttu-id="38dca-684">По умолчанию Visual Studio использует локальный компьютер для выполнения тестов.</span><span class="sxs-lookup"><span data-stu-id="38dca-684">By default, Visual Studio uses your local computer to run the tests.</span></span>

    > [!NOTE]
    > <span data-ttu-id="38dca-685">Кроме того, можно настроить тестовый проект для выполнения нагрузочных тестов в облаке с помощью **Azure Test Plans**.</span><span class="sxs-lookup"><span data-stu-id="38dca-685">Alternatively, you can configure your test project to run the load tests in the cloud using **Azure Test Plans**.</span></span> <span data-ttu-id="38dca-686">Azure Test Plans предоставляет облачную службу нагрузочного тестирования, которая имитирует более реалистичную нагрузку, избегая локальных ограничений среды, таких как емкость ЦП, доступная память и пропускная способность сети.</span><span class="sxs-lookup"><span data-stu-id="38dca-686">Azure Test Plans provides a cloud-based load testing service that simulates a more realistic load, avoiding local environment constraints like CPU capacity, available memory, and network bandwidth.</span></span> <span data-ttu-id="38dca-687">Дополнительные сведения об использовании Azure Test Plans для выполнения нагрузочных тестов см. в разделе [сценарии нагрузочного тестирования](/azure/devops/test/load-test/overview?view=vsts).</span><span class="sxs-lookup"><span data-stu-id="38dca-687">For more information about using Azure Test Plans to run load tests, see [Load testing scenarios](/azure/devops/test/load-test/overview?view=vsts).</span></span>

    ![Параметры тестирования](maintainable-azure-websites-managing-change-and-scale/_static/image98.png)

<a id="Ex5Task3"></a>
#### <a name="task-3--autoscale-verification"></a><span data-ttu-id="38dca-689">Задача 3 — Проверка автомасштабирования</span><span class="sxs-lookup"><span data-stu-id="38dca-689">Task 3 – Autoscale Verification</span></span>

<span data-ttu-id="38dca-690">Теперь вы сможете выполнить нагрузочный тест, созданный в предыдущей задаче, и увидеть, как веб-приложение работает под нагрузкой.</span><span class="sxs-lookup"><span data-stu-id="38dca-690">You will now execute the load test you created in the previous task and see how your web app behaves under load.</span></span>

1. <span data-ttu-id="38dca-691">В **Обозреватель решений**дважды щелкните **LoadTest1. loadtest** , чтобы открыть нагрузочный тест.</span><span class="sxs-lookup"><span data-stu-id="38dca-691">In **Solution Explorer**, double-click **LoadTest1.loadtest** to open the load test.</span></span>

    <span data-ttu-id="38dca-692">![Открытие LoadTest1. loadtest](maintainable-azure-websites-managing-change-and-scale/_static/image99.png "Открытие LoadTest1. loadtest")</span><span class="sxs-lookup"><span data-stu-id="38dca-692">![Opening LoadTest1.loadtest](maintainable-azure-websites-managing-change-and-scale/_static/image99.png "Opening LoadTest1.loadtest")</span></span>

    <span data-ttu-id="38dca-693">*Открытие LoadTest1. loadtest*</span><span class="sxs-lookup"><span data-stu-id="38dca-693">*Opening LoadTest1.loadtest*</span></span>
2. <span data-ttu-id="38dca-694">В окне **LoadTest1. loadtest** нажмите первую кнопку на панели элементов, чтобы запустить нагрузочный тест.</span><span class="sxs-lookup"><span data-stu-id="38dca-694">In the **LoadTest1.loadtest** window, click the first button in the toolbox to run the load test.</span></span>

    <span data-ttu-id="38dca-695">![Выполнение нагрузочного теста](maintainable-azure-websites-managing-change-and-scale/_static/image100.png "Выполнение нагрузочного теста")</span><span class="sxs-lookup"><span data-stu-id="38dca-695">![Running the load test](maintainable-azure-websites-managing-change-and-scale/_static/image100.png "Running the load test")</span></span>

    <span data-ttu-id="38dca-696">*Выполнение нагрузочного теста*</span><span class="sxs-lookup"><span data-stu-id="38dca-696">*Running the load test*</span></span>
3. <span data-ttu-id="38dca-697">Дождитесь завершения нагрузочного теста.</span><span class="sxs-lookup"><span data-stu-id="38dca-697">Wait until the load test completes.</span></span>

    > [!NOTE]
    > <span data-ttu-id="38dca-698">Нагрузочный тест имитирует нескольких пользователей, которые одновременно отправляют запросы в веб-приложение.</span><span class="sxs-lookup"><span data-stu-id="38dca-698">The load test simulates multiple users that send requests to the web app simultaneously.</span></span> <span data-ttu-id="38dca-699">При выполнении теста можно отслеживать доступные счетчики, чтобы обнаружить ошибки, предупреждения или другие сведения, связанные с выполнением нагрузочного теста.</span><span class="sxs-lookup"><span data-stu-id="38dca-699">When the test is running, you can monitor the available counters to detect any errors, warnings or other information related to your load test run.</span></span>

    <span data-ttu-id="38dca-700">![Нагрузочный тест выполнен](maintainable-azure-websites-managing-change-and-scale/_static/image101.png "Ожидание завершения нагрузочного теста")</span><span class="sxs-lookup"><span data-stu-id="38dca-700">![Load test running](maintainable-azure-websites-managing-change-and-scale/_static/image101.png "Waiting until the load test completes")</span></span>

    <span data-ttu-id="38dca-701">*Нагрузочный тест выполнен*</span><span class="sxs-lookup"><span data-stu-id="38dca-701">*Load test running*</span></span>
4. <span data-ttu-id="38dca-702">После завершения теста вернитесь на портал управления и перейдите к странице " **масштаб** " веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="38dca-702">Once the test completes, go back to the management portal and navigate to the **Scale** page of your web app.</span></span> <span data-ttu-id="38dca-703">В разделе **Capacity (емкость** ) на диаграмме должно быть показано, что новый экземпляр был автоматически развернут.</span><span class="sxs-lookup"><span data-stu-id="38dca-703">Under the **capacity** section, you should see in the graph that a new instance was automatically deployed.</span></span>

    ![Новый экземпляр автоматически развернут](maintainable-azure-websites-managing-change-and-scale/_static/image102.png)

    <span data-ttu-id="38dca-705">*Новый экземпляр автоматически развернут*</span><span class="sxs-lookup"><span data-stu-id="38dca-705">*New instance automatically deployed*</span></span>

    > [!NOTE]
    > <span data-ttu-id="38dca-706">Для отображения изменений на диаграмме может потребоваться несколько минут (для обновления страницы нажмите клавиши **CTRL + F5** периодически).</span><span class="sxs-lookup"><span data-stu-id="38dca-706">It may take several minutes for the changes to appear in the graph (press **CTRL + F5** periodically to refresh the page).</span></span> <span data-ttu-id="38dca-707">Если изменения не отображаются, можно попробовать выполнить следующие действия.</span><span class="sxs-lookup"><span data-stu-id="38dca-707">If you do not see any changes, you can try the following:</span></span>
    >
    > - <span data-ttu-id="38dca-708">Увеличение длительности нагрузочного теста (например, **10 минут**)</span><span class="sxs-lookup"><span data-stu-id="38dca-708">Increase the duration of the load test (e.g. to **10 minutes**)</span></span>
    > - <span data-ttu-id="38dca-709">Сократите максимальное и минимальное значения целевого диапазона **ЦП** в конфигурации автомасштабирования веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="38dca-709">Reduce the maximum and minimum values of the **Target CPU** range in the Autoscale configuration of your web app</span></span>
    > - <span data-ttu-id="38dca-710">Запустите нагрузочный тест в облаке с **Azure Test Plans**.</span><span class="sxs-lookup"><span data-stu-id="38dca-710">Run the load test in the cloud with **Azure Test Plans**.</span></span> <span data-ttu-id="38dca-711">Дополнительные сведения см. [здесь](/azure/devops/test/load-test/index?view=vsts).</span><span class="sxs-lookup"><span data-stu-id="38dca-711">More information [here](/azure/devops/test/load-test/index?view=vsts)</span></span>

---

<a id="Summary"></a>
## <a name="summary"></a><span data-ttu-id="38dca-712">Сводка</span><span class="sxs-lookup"><span data-stu-id="38dca-712">Summary</span></span>

<span data-ttu-id="38dca-713">В этой практической лабораторной работе вы узнали, как настроить и развернуть приложение в рабочих веб-приложениях в Azure.</span><span class="sxs-lookup"><span data-stu-id="38dca-713">In this hands-on lab, you learned how to set up and deploy your application to production web apps in Azure.</span></span> <span data-ttu-id="38dca-714">Вы начали с обнаружения и обновления баз данных с помощью **Entity Framework Code First migrations**, а затем продолжаете развертывание новых версий сайта с помощью **Git** и выполняет откат до последней стабильной версии сайта.</span><span class="sxs-lookup"><span data-stu-id="38dca-714">You started by detecting and updating your databases using **Entity Framework Code First Migrations**, then continued by deploying new versions of your site using **Git** and performing rollbacks to the latest stable version of your site.</span></span> <span data-ttu-id="38dca-715">Кроме того, вы узнали, как масштабировать приложение с помощью хранилища для перемещения статического содержимого в контейнер больших двоичных объектов.</span><span class="sxs-lookup"><span data-stu-id="38dca-715">Additionally, you learned how to scale your app using Storage to move your static content to a Blob container.</span></span>
