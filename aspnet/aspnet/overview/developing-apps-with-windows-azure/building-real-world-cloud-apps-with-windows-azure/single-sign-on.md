---
uid: aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/single-sign-on
title: Единый вход (создание облачных приложений в реальном мире с помощью Azure) | Документация Майкрософт
author: MikeWasson
description: Создание реальных облачных приложений с помощью электронной книги Azure основано на презентации, разработанной Скотт Гатри (. В нем объясняются 13 шаблонов и методик, которые могут...
ms.author: riande
ms.date: 06/12/2014
ms.assetid: 7d82d5e9-0619-4f22-9e03-32a6d52940a5
msc.legacyurl: /aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/single-sign-on
msc.type: authoredcontent
ms.openlocfilehash: 1ca93cce22487295a24aae95437b3e69dfc5b504
ms.sourcegitcommit: 7709c0a091b8d55b7b33bad8849f7b66b23c3d72
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/19/2020
ms.locfileid: "77457145"
---
# <a name="single-sign-on-building-real-world-cloud-apps-with-azure"></a>Единый вход (создание облачных приложений в реальном мире с помощью Azure)

[Майк Уоссон](https://github.com/MikeWasson), [Рик Андерсон (](https://twitter.com/RickAndMSFT), том [Dykstra)](https://github.com/tdykstra)

[Скачивание решения ИТ-проекта](https://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4) или [Загрузка электронной книги](https://blogs.msdn.com/b/microsoft_press/archive/2014/07/23/free-ebook-building-cloud-apps-with-microsoft-azure.aspx)

> **Создание реальных облачных приложений с помощью** электронной книги Azure основано на презентации, разработанной Скотт Гатри (. В нем объясняются 13 шаблонов и методик, которые могут помочь в успешной разработке веб-приложений для облака. Сведения о электронной книге см. [в первой главе](introduction.md).

При разработке облачного приложения существует множество проблем безопасности, но в этой серии мы рассмотрим только один вход. Вопрос часто спрашивают: «я в основном создаю приложения для сотрудников моей компании; как разместить эти приложения в облаке и по-прежнему позволить им использовать ту же модель безопасности, которую мои сотрудники узнают и используете в локальной среде, когда они работают с приложениями, размещенными в брандмауэре? Один из способов включения этого сценария называется Azure Active Directory (Azure AD). Azure AD позволяет делать корпоративные бизнес-приложения, доступные через Интернет, а также предоставлять доступ к этим приложениям для бизнес-партнеров.

## <a name="introduction-to-azure-ad"></a>Введение в Azure AD

[Azure AD](https://docs.microsoft.com/azure/active-directory/) предоставляет [Active Directory](https://msdn.microsoft.com/library/windows/desktop/aa746492.aspx) в облаке. К основным функциям относятся следующие.

- Она интегрируется с локальными Active Directory.
- Он обеспечивает единый вход в приложения.
- Он поддерживает открытые стандарты, такие как [SAML](http://en.wikipedia.org/wiki/SAML_2.0), [WS-подача](http://en.wikipedia.org/wiki/WS-Federation)и [OAuth 2,0](http://oauth.net/2/).
- Он поддерживает корпоративный [график REST API](https://msdn.microsoft.com/library/hh974476.aspx).

Предположим, что у вас есть локальная среда Windows Server Active Directory, с помощью которой сотрудники смогут входить в приложения интрасети:

![](single-sign-on/_static/image1.png)

Что позволяет Azure AD создать каталог в облаке. Это бесплатная функция, которую можно легко настроить.

Оно может быть полностью независимым от локального Active Directory; Вы можете поместить в него всех пользователей и проверить их подлинность в приложениях Интернета.

![Active Directory в Windows Azure](single-sign-on/_static/image2.png)

Вы также можете интегрировать его с локальной службой AD.

![Интеграция AD и WAAD](single-sign-on/_static/image3.png)

Теперь все сотрудники, которые могут проходить проверку подлинности в локальной среде, также могут пройти проверку подлинности через Интернет — без необходимости открывать брандмауэр или развертывать новые серверы в центре обработки данных. Вы можете продолжить использовать всю имеющуюся среду Active Directory, которую вы узнаете и используете сегодня, чтобы предоставить внутренним приложениям возможность единого входа.

После создания подключения между AD и Azure AD можно также включить веб-приложения и мобильные устройства для проверки подлинности сотрудников в облаке. Кроме того, вы можете включить сторонние приложения, такие как Office 365, SalesForce.com или Google Apps, чтобы принять ваши учетные данные сотрудников. Если вы используете Office 365, вы уже настроили Azure AD, так как Office 365 использует Azure AD для проверки подлинности и авторизации.

![сторонние приложения](single-sign-on/_static/image4.png)

Преимуществом этого подхода является то, что каждый раз, когда ваша организация добавляет или удаляет пользователя или изменяет пароль, вы используете тот же процесс, который используется в локальной среде в настоящее время. Все локальные изменения AD автоматически распространяются в облачную среду.

Если ваша компания использует или переходит на Office 365, хорошая новость заключается в том, что Azure AD настроен автоматически, так как Office 365 использует Azure AD для проверки подлинности. Поэтому вы можете легко использовать в собственных приложениях ту же проверку подлинности, которую использует Office 365.

## <a name="set-up-an-azure-ad-tenant"></a>Настройка клиента Azure AD

Каталог Azure AD называется [клиентом](https://technet.microsoft.com/library/jj573650.aspx)Azure AD, и Настройка клиента довольно проста. Мы покажем, как это делается в портал управления Azure, чтобы продемонстрировать основные понятия, но, конечно же, с другими функциями портала, можно также использовать скрипт или API управления.

На портале управления перейдите на вкладку Active Directory.

![WAAD на портале](single-sign-on/_static/image5.png)

Вы автоматически используете один клиент Azure AD для своей учетной записи Azure, и вы можете нажать кнопку **Добавить** в нижней части страницы, чтобы создать дополнительные каталоги. Например, вам может потребоваться одна из них для тестовой среды, а другая — для рабочей. Подумайте о том, что вы назначите имя нового каталога. Если вы используете имя каталога, а затем снова используете его имя для одного из пользователей, это может привести к путанице.

![Добавление каталога](single-sign-on/_static/image6.png)

Портал полностью поддерживает создание, удаление пользователей и управление ими в этой среде. Например, чтобы добавить пользователя, перейдите на вкладку **Пользователи** и нажмите кнопку **Добавить пользователя** .

![Кнопка "Добавить пользователя"](single-sign-on/_static/image7.png)

![Диалоговое окно добавления пользователя](single-sign-on/_static/image8.png)

Можно создать нового пользователя, который существует только в этом каталоге, или зарегистрировать учетную запись Майкрософт в качестве пользователя в этом каталоге или зарегистрировать пользователя из другого каталога Azure AD в качестве пользователя в этом каталоге. (В реальном каталоге домен по умолчанию будет ContosoTest.onmicrosoft.com. Вы также можете использовать собственный домен, например contoso.com.)

![Пользовательские типы](single-sign-on/_static/image9.png)

![Диалоговое окно добавления пользователя](single-sign-on/_static/image10.png)

Пользователю можно назначить роль.

![Профиль пользователя](single-sign-on/_static/image11.png)

Учетная запись создается с временным паролем.

![Временный пароль](single-sign-on/_static/image12.png)

Пользователи, которые вы создаете таким образом, могут немедленно войти в веб-приложения с помощью этого облачного каталога.

Но что замечательно для корпоративного единого входа, на вкладке **Интеграция каталогов** :

![Вкладка "Интеграция каталогов"](single-sign-on/_static/image13.png)

Если включить интеграцию каталогов и [скачать средство](https://social.technet.microsoft.com/wiki/contents/articles/19098.howto-install-the-windows-azure-active-directory-sync-tool-now-with-pictures.aspx), вы можете синхронизировать этот облачный каталог с существующими локальными Active Directory, которые вы уже используете в вашей организации. Затем все пользователи, хранящиеся в каталоге, будут отображаться в этом облачном каталоге. Ваши облачные приложения теперь могут проходить проверку подлинности всех сотрудников, используя существующие учетные данные Active Directory. И все это бесплатно — как средство синхронизации, так и Azure AD.

Средство — это простой в использовании мастер, как видно из этих снимков экрана. Эти инструкции не являются полными, просто пример, демонстрирующий базовый процесс. Более подробные сведения о том, как это сделать, см. по ссылкам в разделе [ресурсов](#resources) в конце главы.

![Мастер настройки средства синхронизации WAAD](single-sign-on/_static/image14.png)

Нажмите кнопку **Далее**, а затем введите учетные данные Azure Active Directory.

![Мастер настройки средства синхронизации WAAD](single-sign-on/_static/image15.png)

Нажмите кнопку **Далее**, а затем введите локальные учетные данные AD.

![Мастер настройки средства синхронизации WAAD](single-sign-on/_static/image16.png)

Нажмите кнопку **Далее**, а затем укажите, хотите ли вы сохранить хэш паролей AD в облаке.

![Мастер настройки средства синхронизации WAAD](single-sign-on/_static/image17.png)

Хэш пароля, который можно хранить в облаке, является односторонним. фактические пароли никогда не хранятся в Azure AD. Если вы решили хранить хэши в облаке, необходимо использовать [службы федерации Active Directory (AD FS)](https://technet.microsoft.com/library/hh831502.aspx) (ADFS). Существуют также другие факторы, которые следует [учитывать при выборе того, следует ли использовать ADFS](https://technet.microsoft.com/library/jj573653.aspx). Параметр ADFS требует выполнения нескольких дополнительных действий по настройке.

Если вы решили сохранить хэши в облаке, то все готово, и средство начнет синхронизацию каталогов при нажатии кнопки **Далее**.

![Мастер настройки средства синхронизации WAAD](single-sign-on/_static/image18.png)

И через несколько минут вы уже сделали это.

![Мастер настройки средства синхронизации WAAD](single-sign-on/_static/image19.png)

Это необходимо выполнить только на одном контроллере домена в Организации, в Windows 2003 или более поздней версии. И перезагружаться не нужно. Когда все будет готово, все пользователи будут находиться в облаке, и вы сможете выполнить единый вход из любого веб-или мобильного приложения с помощью SAML, OAuth или WS-подач.

Иногда мы попросят о том, насколько безопасно это сделать — Корпорация Майкрософт использует ее для своих конфиденциальных бизнес-данных? И ответ — Да. Например, если вы переходите на внутренний сайт Microsoft SharePoint по адресу [https://microsoft.sharepoint.com/](https://microsoft.sharepoint.com/), вам будет предложено войти в систему.

![Вход в Office 365](single-sign-on/_static/image20.png)

Корпорация Майкрософт включила ADFS, поэтому при вводе идентификатора Майкрософт вы будете перенаправлены на страницу входа в ADFS.

![Вход в ADFS](single-sign-on/_static/image21.png)

После ввода учетных данных, хранящихся во внутренней учетной записи Microsoft AD, вы получите доступ к этому внутреннему приложению.

![Сайт MS SharePoint](single-sign-on/_static/image22.png)

В основном мы используем сервер входа в систему Active Directory, так как мы уже настроили ADFS до того, как Azure AD стала доступной, но процесс входа проходит через каталог Azure AD в облаке. Мы поместили важные документы, систему управления версиями, файлы управления производительностью, отчеты о продажах и многое другое, в облаке и используем это точное же решение для их защиты.

## <a name="create-an-aspnet-app-that-uses-azure-ad-for-single-sign-on"></a>Создание приложения ASP.NET, использующего Azure AD для единого входа

Visual Studio позволяет очень легко создать приложение, использующее Azure AD для единого входа, как видно из нескольких снимков экрана.

При создании нового приложения ASP.NET (MVC или Web Forms) по умолчанию используется метод проверки подлинности ASP.NET Identity. Чтобы изменить это в Azure AD, нажмите кнопку **изменить проверку подлинности** .

![Изменить проверку подлинности](single-sign-on/_static/image23.png)

Выберите учетные записи организации, введите свое имя домена, а затем выберите единый вход.

![Диалоговое окно настройки проверки подлинности](single-sign-on/_static/image24.png)

Можно также предоставить приложению разрешение на чтение или чтение и запись для данных каталога. В этом случае можно использовать [REST API Azure Graph](https://msdn.microsoft.com/library/windowsazure/hh974476.aspx) для поиска номера телефона пользователей, узнать, находятся ли они в офисе, когда они последний вошел в систему и т. д.

Это все, что нужно сделать — Visual Studio запрашивает учетные данные для администратора клиента Azure AD, а затем настраивает проект и клиент Azure AD для нового приложения.

При запуске проекта вы увидите страницу входа и можете войти в систему, используя учетные данные пользователя в каталоге Azure AD.

![Вход в учетную запись Организации](single-sign-on/_static/image25.png)

![Вход выполнен](single-sign-on/_static/image26.png)

При развертывании приложения в Azure все, что нужно сделать, — это установить флажок **включить проверку подлинности организации** , и снова Visual Studio позаботится о настройке.

![Веб-публикация](single-sign-on/_static/image27.png)

Эти снимки экрана посвящены полному пошаговому руководству, в котором показано, как создать приложение, использующее проверку подлинности Azure AD: [Разработка приложений ASP.NET с помощью Azure Active Directory](../../../../identity/overview/getting-started/developing-aspnet-apps-with-windows-azure-active-directory.md).

## <a name="summary"></a>Сводка

В этой главе вы видели, что Azure Active Directory, Visual Studio и ASP.NET, упрощают настройку единого входа в Интернет-приложениях для пользователей вашей организации. Пользователи могут входить в Интернет приложения, используя те же учетные данные, которые используются для входа в систему с помощью Active Directory во внутренней сети.

В [следующей главе](data-storage-options.md) рассматриваются варианты хранения данных, доступные для облачного приложения.

<a id="resources"></a>
## <a name="resources"></a>Ресурсы

Дополнительные сведения см. в следующих источниках.

- [Документация Azure Active Directory](https://docs.microsoft.com/azure/active-directory/). Страница портала для документации по Azure AD на сайте windowsazure.com. Пошаговые учебники см. в разделе **Разработка** .
- [Многофакторная идентификация Azure](https://docs.microsoft.com/azure/multi-factor-authentication/). Страница портала для документации по многофакторной проверке подлинности в Azure.
- [Параметры проверки подлинности учетной записи организации](../../../../visual-studio/overview/2013/creating-web-projects-in-visual-studio.md#orgauthoptions). Описание параметров проверки подлинности Azure AD в диалоговом окне Visual Studio 2013 New-Project.
- [Шаблоны и методики Майкрософт — федеративный шаблон удостоверений](https://msdn.microsoft.com/library/dn589790.aspx).
- [Практическое руководство. Установка средства синхронизации Azure Active Directory](https://social.technet.microsoft.com/wiki/contents/articles/19098.howto-install-the-windows-azure-active-directory-sync-tool-now-with-pictures.aspx).
- [Службы федерации Active Directory (AD FS) 2,0. Таблица содержимого](https://social.technet.microsoft.com/wiki/contents/articles/2735.ad-fs-2-0-content-map.aspx). Ссылки на документацию по ADFS 2,0.
- [Авторизация на основе ролей и списков управления доступом в приложении Windows Azure AD](https://code.msdn.microsoft.com/Role-Based-and-ACL-Based-86ad71a1). Пример приложения.
- [Блог Azure Active Directory API Graph](https://blogs.msdn.com/b/aadgraphteam/).
- [Управление доступом в BYOD и интеграции каталогов в гибридной инфраструктуре идентификации](https://channel9.msdn.com/Events/TechEd/NorthAmerica/2014/PCIT-B213#fbid=). Видеоролик о конференции Tech Ed 2014, Гайана Багдасарян.

> [!div class="step-by-step"]
> [Назад](web-development-best-practices.md)
> [Вперед](data-storage-options.md)
