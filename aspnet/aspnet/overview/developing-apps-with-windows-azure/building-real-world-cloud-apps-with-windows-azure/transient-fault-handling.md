---
uid: aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/transient-fault-handling
title: Transient Fault Handling (Создание реальных облачных приложений с помощью Azure) | Документация Майкрософт
author: MikeWasson
description: Создание реальных облачных приложений в условиях электронная книга основана на презентацию, разработанная Скоттом Гатри. Здесь объясняется, 13 шаблонов и практических рекомендаций, которые он может...
ms.author: riande
ms.date: 11/03/2015
ms.assetid: 7ead83bc-c08c-4b26-8617-00e07292e35c
msc.legacyurl: /aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/transient-fault-handling
msc.type: authoredcontent
ms.openlocfilehash: 5c9a408acb074a31aeb347ad8e33ba5319530563
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/01/2019
ms.locfileid: "57029391"
---
<a name="transient-fault-handling-building-real-world-cloud-apps-with-azure"></a>Transient Fault Handling (Создание реальных облачных приложений с помощью Azure)
====================
по [Майк Уоссон](https://github.com/MikeWasson), [Рик Андерсон]((https://twitter.com/RickAndMSFT)), [том Дайкстра](https://github.com/tdykstra)

[Загрузить решение проект](http://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4) или [скачайте электронную книгу](http://blogs.msdn.com/b/microsoft_press/archive/2014/07/23/free-ebook-building-cloud-apps-with-microsoft-azure.aspx)

> **Создание реальных облачных приложений в условиях Azure** электронная книга основана на презентацию, разработанная Скоттом Гатри. Здесь объясняется 13 шаблоны и рекомендации, которые помогут вам быть в успешном развертывании веб-приложений для облака. Сведения о книге, см. в разделе [первой главы](introduction.md).


При разработке реального облачного приложения, среди прочего, что нужно подумать о заключается в обработке временных перерывов в обслуживании. Эту проблему однозначно важно в облачных приложениях, так как вы настолько зависит от сетевых подключений и внешних служб. Зачастую можно получить небольшими проблемами, которые обычно самовосстановления, и если вы не готовы обрабатывать их, они будет привести негативный опыт работы для ваших клиентов.

## <a name="causes-of-transient-failures"></a>Причины возникновения временных сбоев

Происходит периодически, в облачной среде вы найдете которых произошла ошибка и прерванные подключения базы данных. Это отчасти потому, что вы будете через дополнительные подсистемы балансировки нагрузки, по сравнению с локальной средой где веб-сервер и сервер базы данных имеют прямого физического подключения. Кроме того иногда в том случае, когда вы будете зависит от службы несколькими клиентами вы увидите вызовы службы работают медленнее или истечения времени ожидания, так как человек, который использует служба достижение сильно. В других случаях может быть пользователь, который использует службу слишком часто, и служба намеренно регулирует вы — запрещает подключения — чтобы не допустить влияния других клиентов службы.

## <a name="use-smart-retryback-off-logic-to-mitigate-the-effect-of-transient-failures"></a>Использовать смарт-логику повторов и отсрочки, чтобы смягчить воздействие временных сбоев

Вместо создания исключения и отображение на странице не доступен или ошибка клиенту, может распознавать ошибки, которые обычно являются временными, и автоматически повторить операцию, которая привела к ошибке, в надеется, что, прежде чем долго будет успешной. В большинстве случаев эта операция будет выполнена при повторной попытке, и обеспечивает восстановление после ошибки без клиента, когда-либо была виду, что возникла проблема.

Вы можете реализовать логику повторных попыток смарт-несколькими способами.

- Microsoft Patterns &amp; рекомендации группа имеет [временных Fault Handling Application Block](https://msdn.microsoft.com/library/dn440719(v=pandp.60).aspx) , выполняет все автоматически при использовании ADO.NET для доступа к базе данных SQL (не через Entity Framework). Вы просто задать политику для повторных попыток — сколько раз следует повторить запрос или команду и сколько нужно ждать между попытками — и перенос кода SQL в *с помощью* блока.

    [!code-csharp[Main](transient-fault-handling/samples/sample1.cs)]

    Также поддерживает TFH [кэша роли Azure](https://msdn.microsoft.com/library/windowsazure/dn386103.aspx) и [служебной шины](https://azure.microsoft.com/services/service-bus/).
- При использовании Entity Framework вы обычно не работают непосредственно с подключениями SQL, поэтому нельзя использовать этот пакет шаблонов и практических рекомендаций, но Entity Framework 6 построения такого рода логику повторных попыток прямо в framework. Аналогичным образом укажите стратегия повторных попыток, а затем EF использует эта стратегия, каждый раз, когда она осуществляет доступ к базе данных.

    Для использования этой функции в приложении Fix It, все что нужно сделать — добавить класс, который является производным от *DbConfiguration* и включить логику повторных попыток.

    [!code-csharp[Main](transient-fault-handling/samples/sample2.cs)]

    Для исключения базы данных SQL, которые платформа определяет как обычно временные ошибки показанный код указывает, что EF, чтобы повторить операцию до трех попыток с экспоненциальной задержкой задержки между повторными попытками и максимальную задержку равную 5 секунд. Экспоненциальная означает, что после каждого повтора неудачных он будет ожидать более длительный период времени перед повторной попыткой. При сбое три попытки подряд, он вызовет исключение. В следующем разделе размыкателя цепи объясняется, зачем стратегию экспоненциальной отсрочки и ограниченное число повторных попыток.

    При использовании службы хранилища Azure, как приложение Fix It, так и для больших двоичных объектов и API клиента хранилища .NET уже реализует того же вида логики, может иметь аналогичные проблемы. Просто укажите политику повтора, или даже не нужно делать, если вас устраивают значения по умолчанию.

<a id="circuitbreakers"></a>
## <a name="circuit-breakers"></a>Размыкатели цепи

Существует несколько причин, почему вы не хотите повторить попытку слишком много раз за слишком длинный период:

- Слишком много пользователей, постоянно Повтор неудачных запросов может привести к снижению работы других пользователей. Если миллионы людей — это все, что делает повторяющиеся повторные запросы можно продолжительный очереди диспетчера IIS и препятствует обслуживание запросов, поскольку в противном случае может обрабатывать успешно приложения.
- Если все восстанавливается из-за сбоя службы, может быть так много запросов в очередь, служба получает распространяются при запуске для восстановления.
- Если ошибка из-за регулирования и интервал времени, служба использует для регулирования, непрерывных попыток удалось перемещение окна и вызвать регулирования продолжить.
- Возможно, пользователь ожидания для веб-страницы к просмотру. Создание людей ожидания слишком много времени может более раздражающих, относительно быстро поддельного чтобы повторить попытку позже.

Экспоненциальная рассматриваются некоторые из этих проблем. путем ограничения частоты повторов, которые служба может получить из приложения. Но необходимо также иметь *размыкатели*: это означает, что в определенное повторите пороговое значение, ваше приложение останавливает повтор и выполняет других действий, таких как одно из следующих:

- Настраиваемый резервный. Если не удается получить цены акций в Reuters, возможно его можно приобрести в Bloomberg; или, если не удается получить данные из базы данных, возможно это можно сделать из кэша.
- Сбой автоматической. Если вам потребуются следующие компоненты из службы не отдельных для вашего приложения, просто возвращать значение null Если не удается получить данные. Если вы отображаете задачу Fix It и служба BLOB-объектов не отвечает, можно отобразить сведения о задаче без изображения.
- Завершиться. Произошла ошибка при выход из системы пользователя позволяет избежать перегрузки службы с повторите запросы, которые могут приводить к перебоев в работе службы для других пользователей или расширить периода регулирования. Можно отображать понятное сообщение «повторите попытку позже».

Отсутствует политика универсальная повторных попыток. Можно повторить несколько раз и больше времени в асинхронном фоновом процессе рабочей роли, чем как синхронный веб-приложение, когда пользователь ожидает ответ. Вы можете ожидать больше между повторными попытками для службы реляционной базы данных, чем для службы кэша. Ниже приведены некоторые образцы рекомендуется повторите политики дать вам представление о том, как номера могут различаться. («Fast первый» означает отсутствие задержки перед первой повторной попыткой.

![Пример политики повтора](transient-fault-handling/_static/image1.png)

Руководство по политики повтора базы данных SQL, см. в разделе [Устранение временных сбоев и ошибок подключения к базе данных SQL](https://azure.microsoft.com/documentation/articles/sql-database-connectivity-issues/).

## <a name="summary"></a>Сводка

Стратегию повторов и отсрочки помогают сделать временные ошибки невидимым для клиента большую часть времени, и корпорация Майкрософт предоставляет платформ, которые можно использовать, чтобы свести к минимуму работу реализации стратегии, используете ли вы ADO.NET Entity Framework и Azure Служба хранилища.

В [следующей главе](distributed-caching.md), мы рассмотрим способы повышения производительности и надежности с помощью распределенного кэширования.

## <a name="resources"></a>Ресурсы

Дополнительные сведения см. в следующих ресурсах:

Документация

- [Советы и рекомендации по проектированию крупномасштабных служб в облачных службах Azure](https://msdn.microsoft.com/library/windowsazure/jj717232.aspx). Технический документ по (Mark simms) и Майкл Томасси. Как и серия Failsafe, но переход в практические подробности. В разделе Телеметрия и диагностика.
- [Отказоустойчивость. Рекомендации по устойчивой облачной архитектуре](https://msdn.microsoft.com/library/windowsazure/jj853352.aspx). Технический документ, Марк Меркьюри, Ульрих Хоманн и Эндрю Таунхилл. Версия веб-страницу видео из цикла Безаварийность.
- [Microsoft Patterns and Practices — руководство по Azure](https://msdn.microsoft.com/library/dn568099.aspx). См. Повторите шаблона, шаблон супервизора агента планировщика.
- [Отказоустойчивость в базе данных Azure SQL](https://blogs.msdn.com/b/windowsazure/archive/2012/07/30/fault-tolerance-in-windows-azure-sql-database.aspx). Запись блога, Tony Petrossian.
- [Entity Framework — устойчивость соединения и логика повторных попыток](https://msdn.microsoft.com/data/dn456835). Как использовать и настраивать функции Entity Framework 6 для обработки временной ошибки.
- [Устойчивость подключений и перехват команд с помощью Entity Framework в приложении ASP.NET MVC](../../../../mvc/overview/getting-started/getting-started-with-ef-using-mvc/connection-resiliency-and-command-interception-with-the-entity-framework-in-an-asp-net-mvc-application.md). В-четвертых в серии руководств девяти частей, показано, как настроить функция устойчивость подключений EF 6 для базы данных SQL.

Видеоролики

- [Отказоустойчивость. Построение масштабируемых, надежных облачных служб](https://channel9.msdn.com/Series/FailSafe). Девять веб-трансляций, Ульрих Хоманн, Марк Меркьюри и (Mark simms). Отображает высокоуровневых концепциях и архитектурные принципы очень доступен и интересным способом, истории, извлеченных из консультационной группой Microsoft клиентов (CAT) опыт работы с реальными клиентами. См. в обсуждении размыкателей цепи в эпизод 3, начиная с 40:55.
- [Создание больших: Уроки из клиентов Azure — часть II](https://channel9.msdn.com/Events/Build/2012/3-030). (Mark simms) рассказывает о разработке для сбоя, временные ошибки обработки и все, что инструментирование.

Пример кода

- [Основы облачных служб в Azure](https://code.msdn.microsoft.com/Cloud-Service-Fundamentals-4ca72649). Пример приложения, созданные Майкрософт группы консультирования клиентов Azure, демонстрирующий способ использования [Enterprise Library Transient Fault Handling Block](http://nuget.org/packages/EnterpriseLibrary.TransientFaultHandling/) (TFH). Дополнительные сведения см. в разделе [облачной службы основы данных уровень доступа к — обработка временного сбоя](https://social.technet.microsoft.com/wiki/contents/articles/18665.cloud-service-fundamentals-data-access-layer-transient-fault-handling.aspx). Для доступа к базе данных с помощью ADO.NET напрямую (без использования платформы Entity Framework) рекомендуется TFH.

> [!div class="step-by-step"]
> [Назад](monitoring-and-telemetry.md)
> [Вперед](distributed-caching.md)
