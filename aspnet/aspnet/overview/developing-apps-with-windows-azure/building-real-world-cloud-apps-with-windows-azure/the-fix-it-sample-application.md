---
uid: aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/the-fix-it-sample-application
title: Приложение. Исправление пример приложения (Создание реальных облачных приложений с помощью Azure) | Документация Майкрософт
author: MikeWasson
description: Создание реальных облачных приложений в условиях электронная книга основана на презентацию, разработанная Скоттом Гатри. Здесь объясняется, 13 шаблонов и практических рекомендаций, которые он может...
ms.author: riande
ms.date: 06/12/2014
ms.assetid: 1bc333c5-f096-4ea7-b170-779accc21c1a
msc.legacyurl: /aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/the-fix-it-sample-application
msc.type: authoredcontent
ms.openlocfilehash: d3a965ccf7ca001d3178819f88836b59f2893bb0
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59406422"
---
# <a name="appendix-the-fix-it-sample-application-building-real-world-cloud-apps-with-azure"></a><span data-ttu-id="6f8d7-104">Приложение. Исправление пример приложения (Создание реальных облачных приложений с помощью Azure)</span><span class="sxs-lookup"><span data-stu-id="6f8d7-104">Appendix: The Fix It Sample Application (Building Real-World Cloud Apps with Azure)</span></span>

<span data-ttu-id="6f8d7-105">по [Майк Уоссон](https://github.com/MikeWasson), [Рик Андерсон]((https://twitter.com/RickAndMSFT)), [том Дайкстра](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="6f8d7-105">by [Mike Wasson](https://github.com/MikeWasson), [Rick Anderson]((https://twitter.com/RickAndMSFT)), [Tom Dykstra](https://github.com/tdykstra)</span></span>

[<span data-ttu-id="6f8d7-106">Загрузите исправление, его проекта</span><span class="sxs-lookup"><span data-stu-id="6f8d7-106">Download The Fix It Project</span></span>](http://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4)

> <span data-ttu-id="6f8d7-107">**Создание реальных облачных приложений в условиях Azure** электронная книга основана на презентацию, разработанная Скоттом Гатри.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-107">The **Building Real World Cloud Apps with Azure** e-book is based on a presentation developed by Scott Guthrie.</span></span> <span data-ttu-id="6f8d7-108">Здесь объясняется 13 шаблоны и рекомендации, которые помогут вам быть в успешном развертывании веб-приложений для облака.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-108">It explains 13 patterns and practices that can help you be successful developing web apps for the cloud.</span></span> <span data-ttu-id="6f8d7-109">Сведения о книге, см. в разделе [первой главы](introduction.md).</span><span class="sxs-lookup"><span data-stu-id="6f8d7-109">For information about the e-book, see [the first chapter](introduction.md).</span></span>

<span data-ttu-id="6f8d7-110">В этом приложении для создание реальных облачных приложений в условиях электронная книга содержит следующие разделы, предоставляющие дополнительные сведения о Fix It примера приложения, который можно загрузить.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-110">This appendix to the Building Real World Cloud Apps with Azure e-book contains the following sections that provide additional information about the Fix It sample application that you can download:</span></span>

- [<span data-ttu-id="6f8d7-111">Известные проблемы</span><span class="sxs-lookup"><span data-stu-id="6f8d7-111">Known issues</span></span>](#knownissues)
- [<span data-ttu-id="6f8d7-112">Рекомендации</span><span class="sxs-lookup"><span data-stu-id="6f8d7-112">Best practices</span></span>](#bestpractices)
- [<span data-ttu-id="6f8d7-113">Как запустить приложение из Visual Studio на локальном компьютере</span><span class="sxs-lookup"><span data-stu-id="6f8d7-113">How to run the app from Visual Studio on your local computer</span></span>](#run-in-vs)
- [<span data-ttu-id="6f8d7-114">Развертывание базового приложения на веб-приложениях службы приложений Azure с помощью сценариев Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="6f8d7-114">How to deploy the base app to Azure App Service Web Apps by using the Windows PowerShell scripts</span></span>](#deploybase)
- [<span data-ttu-id="6f8d7-115">Устранение неполадок сценариев Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="6f8d7-115">Troubleshooting the Windows PowerShell scripts</span></span>](#troubleshooting)
- [<span data-ttu-id="6f8d7-116">Как развернуть приложение с очередью, обработку для веб-приложениях службы приложений Azure и в облачной службе Azure</span><span class="sxs-lookup"><span data-stu-id="6f8d7-116">How to deploy the app with queue processing to Azure App Service Web Apps and an Azure Cloud Service</span></span>](#deployqueues)

<a id="knownissues"></a>
## <a name="known-issues"></a><span data-ttu-id="6f8d7-117">Известные проблемы</span><span class="sxs-lookup"><span data-stu-id="6f8d7-117">Known issues</span></span>

<span data-ttu-id="6f8d7-118">Приложение Fix It было разработано в качестве примера просто максимально некоторые шаблоны, представленные в этой электронной книги.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-118">The Fix It app was originally developed in order to illustrate as simply as possible some of the patterns presented in this e-book.</span></span> <span data-ttu-id="6f8d7-119">Тем не менее так как в книге рассматривается построение реальных приложений, мы распространяется кода Fix It для проверки и тестирования процесс аналогичен мы бы сделать для версии программного обеспечения.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-119">However, since the e-book is about building real-world apps, we subjected the Fix It code to a review and testing process similar to what we'd do for released software.</span></span> <span data-ttu-id="6f8d7-120">Мы обнаружили несколько проблем и как и в случае с любым приложением реального мира, некоторые из них мы исправили и некоторые из них мы откладывается до более поздней версии.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-120">We found a number of issues, and as with any real-world application, some of them we fixed and some of them we deferred to a later release.</span></span>

<span data-ttu-id="6f8d7-121">Ниже перечислены проблемы, которые должны быть решены в рабочем приложении, но для той или иной, которые мы решили не адрес в первоначальном выпуске примера приложения ее исправить.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-121">The following list includes issues that should be addressed in a production application, but for one reason or another we decided not to address in the initial release of the Fix It sample application.</span></span>

### <a name="security"></a><span data-ttu-id="6f8d7-122">Безопасность</span><span class="sxs-lookup"><span data-stu-id="6f8d7-122">Security</span></span>

- <span data-ttu-id="6f8d7-123">Убедитесь в том, что нельзя назначить задачи владельца не существует.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-123">Ensure that you can't assign a task to a non-existent owner.</span></span>
- <span data-ttu-id="6f8d7-124">Убедитесь, что вы можете только просматривать и изменять задач, созданных или назначенных вам.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-124">Ensure that you can only view and modify tasks that you created or are assigned to you.</span></span>
- <span data-ttu-id="6f8d7-125">Используйте HTTPS для страниц входа в систему и файлы cookie проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-125">Use HTTPS for sign-in pages and authentication cookies.</span></span>
- <span data-ttu-id="6f8d7-126">Укажите время, выделенное для файлов cookie проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-126">Specify a time limit for authentication cookies.</span></span>

### <a name="input-validation"></a><span data-ttu-id="6f8d7-127">Проверка входных данных</span><span class="sxs-lookup"><span data-stu-id="6f8d7-127">Input validation</span></span>

<span data-ttu-id="6f8d7-128">Как правило, делается рабочего приложения более проверкой ввода, чем приложения ее исправить.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-128">In general, a production app would do more input validation than the Fix It app.</span></span> <span data-ttu-id="6f8d7-129">Например, размер образа / image допустимый размер файла для загрузки, должны быть ограничены.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-129">For example, the image size / image file size allowed for upload should be limited.</span></span>

### <a name="administrator-functionality"></a><span data-ttu-id="6f8d7-130">Функциональные возможности администратора</span><span class="sxs-lookup"><span data-stu-id="6f8d7-130">Administrator functionality</span></span>

<span data-ttu-id="6f8d7-131">Администратор должен иметь возможность изменить владельца на существующие задачи.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-131">An administrator should be able to change ownership on existing tasks.</span></span> <span data-ttu-id="6f8d7-132">Например создателя задачи может покинуть компанию, оставляя никто с полномочиями для поддержания задачи, пока не будет включен доступ с правами администратора.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-132">For example, the creator of a task might leave the company, leaving no one with authority to maintain the task unless administrative access is enabled.</span></span>

### <a name="queue-message-processing"></a><span data-ttu-id="6f8d7-133">Обработка сообщений в очереди</span><span class="sxs-lookup"><span data-stu-id="6f8d7-133">Queue message processing</span></span>

<span data-ttu-id="6f8d7-134">Сообщение очереди, обработки в приложении Fix It была разработана для быть упрощен с целью демонстрации основе очередей рабочий шаблон с помощью минимального количества кода.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-134">Queue message processing in the Fix It app was designed to be simple in order to illustrate the queue-centric work pattern with a minimum amount of code.</span></span> <span data-ttu-id="6f8d7-135">Этот простой код не подходить для приложения производства.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-135">This simple code would not be adequate for an actual production application.</span></span>

- <span data-ttu-id="6f8d7-136">Код не гарантирует, что каждое сообщение очереди будет обрабатываться не более одного раза.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-136">The code does not guarantee that each queue message will be processed at most once.</span></span> <span data-ttu-id="6f8d7-137">При получении сообщения из очереди, то есть период ожидания, во время которого сообщение остается невидимым для других прослушивателей очередей.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-137">When you get a message from the queue, there is a timeout period, during which the message is invisible to other queue listeners.</span></span> <span data-ttu-id="6f8d7-138">Если время ожидания истекает до сообщение удаляется, то сообщение снова становится видимым.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-138">If the timeout expires before the message is deleted, the message becomes visible again.</span></span> <span data-ttu-id="6f8d7-139">Таким образом Если в экземпляр рабочей роли тратит много времени обработки сообщения, это теоретически возможно для того же сообщения будут обработаны дважды, приводит к повторяющиеся задачи в базе данных.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-139">Therefore, if a worker role instance spends a long time processing a message, it is theoretically possible for the same message to get processed twice, resulting in a duplicate task in the database.</span></span> <span data-ttu-id="6f8d7-140">Дополнительные сведения об этой проблеме см. в разделе [очереди службы хранилища Azure с помощью](https://msdn.microsoft.com/library/ff803365.aspx#sec7).</span><span class="sxs-lookup"><span data-stu-id="6f8d7-140">For more information about this issue, see [Using Azure Storage Queues](https://msdn.microsoft.com/library/ff803365.aspx#sec7).</span></span>
- <span data-ttu-id="6f8d7-141">Логика опроса очереди может быть более экономичным, пакетное выполнение извлечения сообщения.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-141">The queue polling logic could be more cost-effective, by batching message retrieval.</span></span> <span data-ttu-id="6f8d7-142">Каждый раз при вызове [CloudQueue.GetMessageAsync](https://msdn.microsoft.com/library/microsoft.windowsazure.storage.queue.cloudqueue.getmessageasync.aspx), оплачивается транзакции.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-142">Every time you call [CloudQueue.GetMessageAsync](https://msdn.microsoft.com/library/microsoft.windowsazure.storage.queue.cloudqueue.getmessageasync.aspx), there is a transaction cost.</span></span> <span data-ttu-id="6f8d7-143">Вместо этого можно вызвать [CloudQueue.GetMessagesAsync](https://msdn.microsoft.com/library/microsoft.windowsazure.storage.queue.cloudqueue.getmessagesasync.aspx) (Обратите внимание, plural "), которая получает несколько сообщений в одной транзакции.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-143">Instead, you can call [CloudQueue.GetMessagesAsync](https://msdn.microsoft.com/library/microsoft.windowsazure.storage.queue.cloudqueue.getmessagesasync.aspx) (note the plural 's'), which gets multiple messages in a single transaction.</span></span> <span data-ttu-id="6f8d7-144">Затраты на транзакции для очереди службы хранилища Azure являются очень мало, поэтому влияние на затраты, не является существенным в большинстве сценариев.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-144">The transaction costs for Azure Storage Queues are very low, so the impact on costs is not substantial in most scenarios.</span></span>
- <span data-ttu-id="6f8d7-145">Непрерывном цикле в коде обработки сообщения очереди вызывает сходство ЦП, который не использует виртуальные машины несколькими ядрами эффективно.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-145">The tight loop in the queue message-processing code causes CPU affinity, which does not utilize multi-core VMs efficiently.</span></span> <span data-ttu-id="6f8d7-146">Параллелизм задач лучше использовать для параллельного выполнения нескольких асинхронных задач.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-146">A better design would use task parallelism to run several async tasks in parallel.</span></span>
- <span data-ttu-id="6f8d7-147">Обработка сообщений очереди предусмотрена обработка только элементарные исключение.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-147">Queue message-processing has only rudimentary exception handling.</span></span> <span data-ttu-id="6f8d7-148">Например, код не может обработать [сообщения о сбое](https://msdn.microsoft.com/library/ms789028.aspx).</span><span class="sxs-lookup"><span data-stu-id="6f8d7-148">For example, the code doesn't handle [poison messages](https://msdn.microsoft.com/library/ms789028.aspx).</span></span> <span data-ttu-id="6f8d7-149">(При обработке сообщений возникает исключение, необходимо записать ошибку в журнал и удалить сообщение, или рабочей роли будет пытаться обрабатывать ее снова, и цикл продолжается неограниченно долго.)</span><span class="sxs-lookup"><span data-stu-id="6f8d7-149">(When message processing causes an exception, you have to log the error and delete the message, or the worker role will try to process it again, and the loop will continue indefinitely.)</span></span>

### <a name="sql-queries-are-unbounded"></a><span data-ttu-id="6f8d7-150">SQL-запросы не ограничены</span><span class="sxs-lookup"><span data-stu-id="6f8d7-150">SQL queries are unbounded</span></span>

<span data-ttu-id="6f8d7-151">Текущий код Fix It размещает отсутствие ограничений на количество строк, то запросы для страниц индексов могут возвращать.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-151">Current Fix It code places no limit on how many rows the queries for Index pages might return.</span></span> <span data-ttu-id="6f8d7-152">Если большое количество задач вводится в базу данных, размер полученных итоговый списков могут вызывать проблемы производительности.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-152">If a large volume of tasks is entered into the database, the size of the resulting lists received could cause performance issues.</span></span> <span data-ttu-id="6f8d7-153">Рекомендуется реализовать разбиение по страницам.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-153">The solution is to implement paging.</span></span> <span data-ttu-id="6f8d7-154">Например, см. в разделе [сортировку, фильтрацию и разбиение по страницам с Entity Framework в приложении MVC ASP.NET](../../../../mvc/overview/getting-started/getting-started-with-ef-using-mvc/sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application.md).</span><span class="sxs-lookup"><span data-stu-id="6f8d7-154">For an example, see [Sorting, Filtering, and Paging with the Entity Framework in an ASP.NET MVC Application](../../../../mvc/overview/getting-started/getting-started-with-ef-using-mvc/sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application.md).</span></span>

### <a name="view-models-recommended"></a><span data-ttu-id="6f8d7-155">Просмотр моделей рекомендуется</span><span class="sxs-lookup"><span data-stu-id="6f8d7-155">View models recommended</span></span>

<span data-ttu-id="6f8d7-156">Приложение Fix It использует класс сущностей FixItTask для передачи сведений между контроллером и представлением.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-156">The Fix It app uses the FixItTask entity class to pass information between the controller and the view.</span></span> <span data-ttu-id="6f8d7-157">Мы рекомендуем использовать модели представления.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-157">A best practice is to use view models.</span></span> <span data-ttu-id="6f8d7-158">Модель предметной области (например, класс сущности FixItTask) разработано на основе необходимых для сохранения данных, а модель представления может разрабатываться для представления данных.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-158">The domain model (e.g., the FixItTask entity class) is designed around what is needed for data persistence, while a view model can be designed for data presentation.</span></span> <span data-ttu-id="6f8d7-159">Дополнительные сведения см. в разделе [12 ASP.NET MVC рекомендаций](http://codeclimber.net.nz/archive/2009/10/27/12-asp.net-mvc-best-practices.aspx).</span><span class="sxs-lookup"><span data-stu-id="6f8d7-159">For more information, see [12 ASP.NET MVC Best Practices](http://codeclimber.net.nz/archive/2009/10/27/12-asp.net-mvc-best-practices.aspx).</span></span>

### <a name="secure-image-blob-recommended"></a><span data-ttu-id="6f8d7-160">Большой двоичный объект безопасный образ рекомендуется</span><span class="sxs-lookup"><span data-stu-id="6f8d7-160">Secure image blob recommended</span></span>

<span data-ttu-id="6f8d7-161">Магазины приложений Fix It Отправить изображения как открытые, это означает, что любой кто найдет этот URL-адрес можно получить доступ к изображения.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-161">The Fix It app stores uploaded images as public, meaning that anyone who finds the URL can access the images.</span></span> <span data-ttu-id="6f8d7-162">Изображения можно было защитить, а не общедоступным.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-162">The images could be secured instead of public.</span></span>

### <a name="no-powershell-automation-scripts-for-queues"></a><span data-ttu-id="6f8d7-163">Скрипты автоматизации не PowerShell для очередей</span><span class="sxs-lookup"><span data-stu-id="6f8d7-163">No PowerShell automation scripts for queues</span></span>

<span data-ttu-id="6f8d7-164">Примеры сценариев PowerShell автоматизации были написаны только для базовой версии Fix It, полностью выполняется в веб-приложениях службы приложений Azure.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-164">Sample PowerShell automation scripts were written only for the base version of Fix It that runs entirely in Azure App Service Web Apps.</span></span> <span data-ttu-id="6f8d7-165">Мы не указали скрипты для установки и развертывания веб-приложения, а также среду облачной службы, необходимые для обработки очередей.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-165">We haven't provided scripts for setting up and deploying to the web app plus Cloud Service environment required for queue processing.</span></span>

### <a name="special-handling-for-html-codes-in-user-input"></a><span data-ttu-id="6f8d7-166">Специальная обработка кодов HTML в ввод данных пользователем</span><span class="sxs-lookup"><span data-stu-id="6f8d7-166">Special handling for HTML codes in user input</span></span>

<span data-ttu-id="6f8d7-167">ASP.NET автоматически предотвращает множество способов, в которых пользователи-злоумышленники могут попытаться атаки с использованием межузловых сценариев, введя скрипт в поля ввода текста пользователем.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-167">ASP.NET automatically prevents many ways in which malicious users might attempt cross-site scripting attacks by entering script in user input text boxes.</span></span> <span data-ttu-id="6f8d7-168">И MVC `DisplayFor` вспомогательный метод, используемый для отображения задач названия и заметки о автоматически кодирует в HTML значения, отправляемых в браузер.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-168">And the MVC `DisplayFor` helper used to display task titles and notes automatically HTML-encodes values that it sends to the browser.</span></span> <span data-ttu-id="6f8d7-169">Однако в рабочем приложении может потребоваться принять дополнительные меры.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-169">But in a production app you might want to take additional measures.</span></span> <span data-ttu-id="6f8d7-170">Дополнительные сведения см. в разделе [проверки запросов в ASP.NET](https://msdn.microsoft.com/library/hh882339.aspx).</span><span class="sxs-lookup"><span data-stu-id="6f8d7-170">For more information, see [Request Validation in ASP.NET](https://msdn.microsoft.com/library/hh882339.aspx).</span></span>

<a id="bestpractices"></a>
## <a name="best-practices"></a><span data-ttu-id="6f8d7-171">Рекомендации</span><span class="sxs-lookup"><span data-stu-id="6f8d7-171">Best practices</span></span>

<span data-ttu-id="6f8d7-172">Ниже приведены некоторые проблемы, появившиеся после, обнаруженных при проверке кода и тестирование исходная версия приложения ее исправить.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-172">Following are some issues that were fixed after being discovered in code review and testing of the original version of the Fix It app.</span></span> <span data-ttu-id="6f8d7-173">Некоторые были вызваны исходного автору кода, не определенного рекомендуется учитывать некоторые просто потому, что код написан на быстро и не был предназначен для версии программного обеспечения.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-173">Some were caused by the original coder not being aware of a particular best practice, some simply because the code was written quickly and wasn't intended for released software.</span></span> <span data-ttu-id="6f8d7-174">Мы выводе содержимого причины проблем здесь есть то, что мы узнали из этого проверки и тестирования, будут полезны другим пользователям, которые также при разработке веб-приложений.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-174">We're listing the issues here in case there's something we learned from this review and testing that might be helpful to others who are also developing web apps.</span></span>

### <a name="dispose-the-database-repository"></a><span data-ttu-id="6f8d7-175">Dispose хранилище базы данных</span><span class="sxs-lookup"><span data-stu-id="6f8d7-175">Dispose the database repository</span></span>

<span data-ttu-id="6f8d7-176">`FixItTaskRepository` Класса должно быть освобождено Entity Framework `DbContext` экземпляра.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-176">The `FixItTaskRepository` class must dispose the Entity Framework `DbContext` instance.</span></span> <span data-ttu-id="6f8d7-177">Мы сделали это, реализовав `IDisposable` в `FixItTaskRepository` класса:</span><span class="sxs-lookup"><span data-stu-id="6f8d7-177">We did this by implementing `IDisposable` in the `FixItTaskRepository` class:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample1.cs)]

<span data-ttu-id="6f8d7-178">Обратите внимание, что автоматически удаляет AutoFac `FixItTaskRepository` экземпляра, поэтому нам не нужно явно удалять его.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-178">Note that AutoFac will automatically dispose the `FixItTaskRepository` instance, so we don't need to explicitly dispose it.</span></span>

<span data-ttu-id="6f8d7-179">Другой вариант заключается в удалении `DbContext` переменной-члена из `FixItTaskRepository`и вместо этого создайте локальную `DbContext` переменных в пределах каждого метода репозитория внутри `using` инструкции.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-179">Another option is to remove the `DbContext` member variable from `FixItTaskRepository`, and instead create a local `DbContext` variable within each repository method, inside a `using` statement.</span></span> <span data-ttu-id="6f8d7-180">Пример:</span><span class="sxs-lookup"><span data-stu-id="6f8d7-180">For example:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample2.cs)]

### <a name="register-singletons-as-such-with-di"></a><span data-ttu-id="6f8d7-181">Таким образом зарегистрировать одноэлементные экземпляры с помощью внедрения Зависимостей</span><span class="sxs-lookup"><span data-stu-id="6f8d7-181">Register singletons as such with DI</span></span>

<span data-ttu-id="6f8d7-182">Поскольку только один экземпляр `PhotoService` класс и `Logger` требуется класс, эти классы должны быть [зарегистрирован как отдельные экземпляры для введения зависимостей](https://code.google.com/p/autofac/wiki/InstanceScope) в *DependenciesConfig.cs*:</span><span class="sxs-lookup"><span data-stu-id="6f8d7-182">Since only one instance of the `PhotoService` class and `Logger` class is needed, these classes should be [registered as single instances for dependency injection](https://code.google.com/p/autofac/wiki/InstanceScope) in *DependenciesConfig.cs*:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample3.cs?highlight=1,3)]

### <a name="security-dont-show-error-details-to-users"></a><span data-ttu-id="6f8d7-183">Безопасность: Больше не показывать сведения об ошибке для пользователей</span><span class="sxs-lookup"><span data-stu-id="6f8d7-183">Security: Don't show error details to users</span></span>

<span data-ttu-id="6f8d7-184">Исходное приложение Fix It не имеют типовой страницы ошибки и просто оставить все пузырек исключения до пользовательского интерфейса, поэтому некоторые исключения, такие как ошибки подключения базы данных может привести к полной трассировке стека отображаемая в браузере.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-184">The original Fix It app didn't have a generic error page and just let all exceptions bubble up to the UI, so some exceptions such as database connection errors could result in a full stack trace being displayed to the browser.</span></span> <span data-ttu-id="6f8d7-185">Подробные сведения об ошибке иногда может способствовать атаке злоумышленников.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-185">Detailed error information can sometimes facilitate attacks by malicious users.</span></span> <span data-ttu-id="6f8d7-186">Решение — вход в сведениях об исключении и отображаться страница ошибки пользователю, который не содержит сведения об ошибке.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-186">The solution is to log the exception details and display an error page to the user that doesn't include error details.</span></span> <span data-ttu-id="6f8d7-187">Уже ведение журнала приложения ее исправить, и чтобы отобразить страницу ошибки, мы добавили `<customErrors mode=On>` в файле Web.config.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-187">The Fix It app was already logging, and in order to display an error page, we added `<customErrors mode=On>` in the Web.config file.</span></span>

[!code-xml[Main](the-fix-it-sample-application/samples/sample4.xml?highlight=2)]

<span data-ttu-id="6f8d7-188">По умолчанию это приводит к *Views\Shared\Error.cshtml* для отображения ошибок.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-188">By default this causes *Views\Shared\Error.cshtml* to be displayed for errors.</span></span> <span data-ttu-id="6f8d7-189">Вы можете настроить *Error.cshtml* или создайте собственное представление страницы ошибки и добавьте `defaultRedirect` атрибута.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-189">You can customize *Error.cshtml* or create your own error page view and add a `defaultRedirect` attribute.</span></span> <span data-ttu-id="6f8d7-190">Можно также указать другую ошибку страницы для конкретных ошибок.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-190">You can also specify different error pages for specific errors.</span></span>

### <a name="security-only-allow-a-task-to-be-edited-by-its-creator"></a><span data-ttu-id="6f8d7-191">Безопасность: разрешить только задачу, которую нужно изменить ее создателем</span><span class="sxs-lookup"><span data-stu-id="6f8d7-191">Security: only allow a task to be edited by its creator</span></span>

<span data-ttu-id="6f8d7-192">Страница индекса панели мониторинга отображаются только те задачи, созданные пользователем, вошедшего в систему, но пользователь-злоумышленник может создать URL-адрес с Идентификатором задачей другого пользователя.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-192">The Dashboard Index page only shows tasks created by the logged-on user, but a malicious user could create a URL with an ID to another user's task.</span></span> <span data-ttu-id="6f8d7-193">Мы добавили код в *DashboardController.cs* возвращать ошибку 404, в этом случае:</span><span class="sxs-lookup"><span data-stu-id="6f8d7-193">We added code in *DashboardController.cs* to return a 404 in that case:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample5.cs?highlight=9-14,24-29)]

### <a name="dont-swallow-exceptions"></a><span data-ttu-id="6f8d7-194">Не проглатывания исключений</span><span class="sxs-lookup"><span data-stu-id="6f8d7-194">Don't swallow exceptions</span></span>

<span data-ttu-id="6f8d7-195">Исходное приложение Fix It просто вернул значение null после входа исключения, полученное в результате SQL-запроса:</span><span class="sxs-lookup"><span data-stu-id="6f8d7-195">The original Fix It app just returned null after logging an exception that resulted from a SQL query:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample6.cs?highlight=4)]

<span data-ttu-id="6f8d7-196">Это сделает его видеть пользователи, как в том случае, если запрос выполнено успешно, но только не возвратил никаких строк.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-196">This would make it look to the user as if the query succeeded but just didn't return any rows.</span></span> <span data-ttu-id="6f8d7-197">Решением является повторно создавать исключение после перехвата и ведения журнала:</span><span class="sxs-lookup"><span data-stu-id="6f8d7-197">Solution is to re-throw the exception after catching and logging:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample7.cs)]

### <a name="catch-all-exceptions-in-worker-roles"></a><span data-ttu-id="6f8d7-198">Перехватывать все исключения в рабочих ролях</span><span class="sxs-lookup"><span data-stu-id="6f8d7-198">Catch all exceptions in worker roles</span></span>

<span data-ttu-id="6f8d7-199">Все необработанные исключения в рабочей роли приведет к перезапуску виртуальной Машины, поэтому необходимо поместить все в блок try-catch и обрабатывать все исключения.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-199">Any unhandled exceptions in a worker role will cause the VM to be recycled, so you want to wrap everything you do in a try-catch block and handle all exceptions.</span></span>

### <a name="specify-length-for-string-properties-in-entity-classes"></a><span data-ttu-id="6f8d7-200">Указание длины строковых свойств в классах сущностей</span><span class="sxs-lookup"><span data-stu-id="6f8d7-200">Specify length for string properties in entity classes</span></span>

<span data-ttu-id="6f8d7-201">Для отображения простого кода, исходная версия приложения Fix It не были указаны значения длины для полей сущности FixItTask и поэтому они были определены как varchar(max) в базе данных.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-201">In order to display simple code, the original version of the Fix It app didn't specify lengths for the fields of the FixItTask entity, and as a result they were defined as varchar(max) in the database.</span></span> <span data-ttu-id="6f8d7-202">Таким образом пользовательский Интерфейс принимали практически любого объема входных данных.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-202">As a result, the UI would accept almost any amount of input.</span></span> <span data-ttu-id="6f8d7-203">Указав применяются оба пользователю ограничения длины наборов входных данных в веб-страницы и размер столбца в базе данных:</span><span class="sxs-lookup"><span data-stu-id="6f8d7-203">Specifying lengths sets limits that apply both to user input in the web page and column size in the database:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample8.cs?highlight=4,7,10,12,14)]

### <a name="mark-private-members-as-readonly-when-they-arent-expected-to-change"></a><span data-ttu-id="6f8d7-204">Пометить закрытых членов только для чтения, когда они не ожидаются для изменения</span><span class="sxs-lookup"><span data-stu-id="6f8d7-204">Mark private members as readonly when they aren't expected to change</span></span>

<span data-ttu-id="6f8d7-205">Например, в `DashboardController` класса экземпляра `FixItTaskRepository` создается и не должен изменить, поэтому мы определили его как [readonly](https://msdn.microsoft.com/library/acdd6hb7.aspx).</span><span class="sxs-lookup"><span data-stu-id="6f8d7-205">For example, in the `DashboardController` class an instance of `FixItTaskRepository` is created and isn't expected to change, so we defined it as [readonly](https://msdn.microsoft.com/library/acdd6hb7.aspx).</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample9.cs?highlight=3)]

### <a name="use-listany-instead-of-listcount-gt-0"></a><span data-ttu-id="6f8d7-206">Используйте список. Any() вместо списка. Count() &gt; 0</span><span class="sxs-lookup"><span data-stu-id="6f8d7-206">Use list.Any() instead of list.Count() &gt; 0</span></span>

<span data-ttu-id="6f8d7-207">Если вы все интересующие вас ли один или несколько элементов в списке соответствуют указанным критериям, используйте [любой](https://msdn.microsoft.com/library/bb534972.aspx) метод, поскольку он возвращает как только обнаруживается элемент подгонки критерии, тогда как `Count` всегда имеет метод для выполнения итерации через каждый элемент.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-207">If you all you care about is whether one or more items in a list fit the specified criteria, use the [Any](https://msdn.microsoft.com/library/bb534972.aspx) method, because it returns as soon as an item fitting the criteria is found, whereas the `Count` method always has to iterate through every item.</span></span> <span data-ttu-id="6f8d7-208">Панели мониторинга *Index.cshtml* файл изначально содержал этот код:</span><span class="sxs-lookup"><span data-stu-id="6f8d7-208">The Dashboard *Index.cshtml* file originally had this code:</span></span>

[!code-cshtml[Main](the-fix-it-sample-application/samples/sample10.cshtml)]

<span data-ttu-id="6f8d7-209">Мы изменили его на это:</span><span class="sxs-lookup"><span data-stu-id="6f8d7-209">We changed it to this:</span></span>

[!code-cshtml[Main](the-fix-it-sample-application/samples/sample11.cshtml?highlight=1)]

### <a name="generate-urls-in-mvc-views-using-mvc-helpers"></a><span data-ttu-id="6f8d7-210">Создание URL-адреса в представлений MVC с помощью вспомогательных методов MVC</span><span class="sxs-lookup"><span data-stu-id="6f8d7-210">Generate URLs in MVC views using MVC helpers</span></span>

<span data-ttu-id="6f8d7-211">Для **создать Fix It** кнопки на домашней странице, Fix It приложение жестких закодированных элемент привязки:</span><span class="sxs-lookup"><span data-stu-id="6f8d7-211">For the **Create a Fix It** button on the home page, the Fix It app hard coded an anchor element:</span></span>

[!code-cshtml[Main](the-fix-it-sample-application/samples/sample12.cshtml)]

<span data-ttu-id="6f8d7-212">Для ссылки на представление/действия следующим образом лучше использовать [Url.Action](https://msdn.microsoft.com/library/system.web.mvc.urlhelper.action.aspx) вспомогательный метод HTML, например:</span><span class="sxs-lookup"><span data-stu-id="6f8d7-212">For View/Action links like this it's better to use the [Url.Action](https://msdn.microsoft.com/library/system.web.mvc.urlhelper.action.aspx) HTML helper, for example:</span></span>

[!code-cshtml[Main](the-fix-it-sample-application/samples/sample13.cshtml)]

### <a name="use-taskdelay-instead-of-threadsleep-in-worker-role"></a><span data-ttu-id="6f8d7-213">Используйте Task.Delay вместо Thread.Sleep в рабочей роли</span><span class="sxs-lookup"><span data-stu-id="6f8d7-213">Use Task.Delay instead of Thread.Sleep in worker role</span></span>

<span data-ttu-id="6f8d7-214">Шаблон нового проекта помещает `Thread.Sleep` в образце кода для рабочей роли, но из-за чего в спящий режим может привести к породить дополнительные ненужные потоки пула потоков.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-214">The new-project template puts `Thread.Sleep` in the sample code for a worker role, but causing the thread to sleep can cause the thread pool to spawn additional unnecessary threads.</span></span> <span data-ttu-id="6f8d7-215">Этого можно избежать, используя [Task.Delay](https://msdn.microsoft.com/library/hh139096.aspx) вместо этого.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-215">You can avoid that by using [Task.Delay](https://msdn.microsoft.com/library/hh139096.aspx) instead.</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample14.cs?highlight=11)]

### <a name="avoid-async-void"></a><span data-ttu-id="6f8d7-216">Избегайте async void</span><span class="sxs-lookup"><span data-stu-id="6f8d7-216">Avoid async void</span></span>

<span data-ttu-id="6f8d7-217">Если асинхронный метод не должно возвращать значение, возвращают `Task` типа вместо `void`.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-217">If an async method doesn't need to return a value, return a `Task` type rather than `void`.</span></span>

<span data-ttu-id="6f8d7-218">Этот пример взят из `FixItQueueManager` класса:</span><span class="sxs-lookup"><span data-stu-id="6f8d7-218">This example is from the `FixItQueueManager` class:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample15.cs)]

<span data-ttu-id="6f8d7-219">Следует использовать `async void` только для обработчиков событий верхнего уровня.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-219">You should use `async void` only for top-level event handlers.</span></span> <span data-ttu-id="6f8d7-220">При определении метода в качестве `async void`, вызывающий объект не может **await** метода или перехватывайте любые исключения, метод создает исключение.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-220">If you define a method as `async void`, the caller cannot **await** the method or catch any exceptions the method throws.</span></span> <span data-ttu-id="6f8d7-221">Дополнительные сведения см. в разделе [рекомендации в асинхронное программирование](https://msdn.microsoft.com/magazine/jj991977.aspx).</span><span class="sxs-lookup"><span data-stu-id="6f8d7-221">For more information, see [Best Practices in Asynchronous Programming](https://msdn.microsoft.com/magazine/jj991977.aspx).</span></span>

### <a name="use-a-cancellation-token-to-break-from-worker-role-loop"></a><span data-ttu-id="6f8d7-222">Использовать токен отмены для из этого цикла рабочей роли</span><span class="sxs-lookup"><span data-stu-id="6f8d7-222">Use a cancellation token to break from worker role loop</span></span>

<span data-ttu-id="6f8d7-223">Как правило **запуска** метод на рабочей роли содержит бесконечный цикл.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-223">Typically, the **Run** method on a worker role contains an infinite loop.</span></span> <span data-ttu-id="6f8d7-224">Когда выполняется остановка рабочей роли, [RoleEntryPoint.OnStop](https://msdn.microsoft.com/library/windowsazure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx) вызывается метод.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-224">When the worker role is stopping, the [RoleEntryPoint.OnStop](https://msdn.microsoft.com/library/windowsazure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx) method is called.</span></span> <span data-ttu-id="6f8d7-225">Этот метод следует использовать для отмены работы, который выполняется внутри **запуска** метод и выхода корректно.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-225">You should use this method to cancel the work that is being done inside the **Run** method and exit gracefully.</span></span> <span data-ttu-id="6f8d7-226">В противном случае процесс может быть прерван в процессе выполнения операции.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-226">Otherwise, the process might be terminated in the middle of an operation.</span></span>

### <a name="opt-out-of-automatic-mime-sniffing-procedure"></a><span data-ttu-id="6f8d7-227">Отказаться от автоматической процедуры обнаружение типов MIME</span><span class="sxs-lookup"><span data-stu-id="6f8d7-227">Opt out of Automatic MIME Sniffing Procedure</span></span>

<span data-ttu-id="6f8d7-228">В некоторых случаях Internet Explorer сообщает тип MIME, отличается от типа, заданного параметром веб-сервера.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-228">In some cases, Internet Explorer reports a MIME type different than the type specified by the web server.</span></span> <span data-ttu-id="6f8d7-229">Например если Internet Explorer находит HTML содержимого в файле, присутствующие в заголовке ответа HTTP Content-Type: text/plain, Internet Explorer определяет, что содержимое должны отображаться в формате HTML.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-229">For instance, if Internet Explorer finds HTML content in a file delivered with the HTTP response header Content-Type: text/plain, Internet Explorer determines that the content should be rendered as HTML.</span></span> <span data-ttu-id="6f8d7-230">К сожалению это «MIME-сканирование» также может привести к проблем безопасности для серверов, размещающих ненадежное содержимое.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-230">Unfortunately, this "MIME-sniffing" can also lead to security problems for servers hosting untrusted content.</span></span> <span data-ttu-id="6f8d7-231">Для борьбы с этой проблемой, Internet Explorer 8 внесла ряд изменений в код определение типа MIME и позволяет разработчикам приложений [отказаться от того, обнаружение типов MIME](https://blogs.msdn.com/b/ie/archive/2008/07/02/ie8-security-part-v-comprehensive-protection.aspx).</span><span class="sxs-lookup"><span data-stu-id="6f8d7-231">To combat this problem, Internet Explorer 8 has made a number of changes to MIME-type determination code and allows application developers to [opt out of MIME-sniffing](https://blogs.msdn.com/b/ie/archive/2008/07/02/ie8-security-part-v-comprehensive-protection.aspx).</span></span> <span data-ttu-id="6f8d7-232">Следующий код был добавлен к *Web.config* файл.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-232">The following code was added to the *Web.config* file.</span></span>

[!code-xml[Main](the-fix-it-sample-application/samples/sample16.xml?highlight=2-7)]

### <a name="enable-bundling-and-minification"></a><span data-ttu-id="6f8d7-233">Включить объединение и Минификация</span><span class="sxs-lookup"><span data-stu-id="6f8d7-233">Enable bundling and minification</span></span>

<span data-ttu-id="6f8d7-234">Когда Visual Studio создает новый веб-проекта, объединение и Минификация файлы JavaScript не включен по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-234">When Visual Studio creates a new web project, bundling and minification of JavaScript files is not enabled by default.</span></span> <span data-ttu-id="6f8d7-235">Мы добавили строку кода в BundleConfig.cs:</span><span class="sxs-lookup"><span data-stu-id="6f8d7-235">We added a line of code in BundleConfig.cs:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample17.cs?highlight=9)]

### <a name="set-an-expiration-time-out-for-authentication-cookies"></a><span data-ttu-id="6f8d7-236">Установки завершения времени для файлов cookie проверки подлинности</span><span class="sxs-lookup"><span data-stu-id="6f8d7-236">Set an expiration time-out for authentication cookies</span></span>

<span data-ttu-id="6f8d7-237">По умолчанию файлы cookie проверки подлинности истекает через две недели.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-237">By default, authentication cookies expire in two weeks.</span></span> <span data-ttu-id="6f8d7-238">Более короткое время является более безопасным.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-238">A shorter time is more secure.</span></span> <span data-ttu-id="6f8d7-239">Можно изменить этот параметр в *StartupAuth.cs*:</span><span class="sxs-lookup"><span data-stu-id="6f8d7-239">You can change this setting in *StartupAuth.cs*:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample18.cs?highlight=4-5)]

<a id="run-in-vs"></a>
## <a name="how-to-run-the-app-from-visual-studio-on-your-local-computer"></a><span data-ttu-id="6f8d7-240">Как запустить приложение из Visual Studio на локальном компьютере</span><span class="sxs-lookup"><span data-stu-id="6f8d7-240">How to run the app from Visual Studio on your local computer</span></span>

<span data-ttu-id="6f8d7-241">Для запуска приложения ее исправить двумя способами:</span><span class="sxs-lookup"><span data-stu-id="6f8d7-241">There are two ways to run the Fix It app:</span></span>

- <span data-ttu-id="6f8d7-242">Запустите базового приложения, который записывает новые задачи непосредственно к базе данных SQL.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-242">Run the base application that writes new tasks directly to the SQL database.</span></span>
- <span data-ttu-id="6f8d7-243">Запустите приложение с помощью очереди, а также в серверную службу для создания задачи.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-243">Run the application using a queue plus a backend service to create tasks.</span></span> <span data-ttu-id="6f8d7-244">Шаблон очереди описан в главе [рабочий шаблон на основе очередей](queue-centric-work-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="6f8d7-244">The queue pattern is described in the chapter [Queue-Centric Work Pattern](queue-centric-work-pattern.md).</span></span>

<a id="runbase"></a>
### <a name="run-the-base-application"></a><span data-ttu-id="6f8d7-245">Запуск базового приложения</span><span class="sxs-lookup"><span data-stu-id="6f8d7-245">Run the base application</span></span>

1. <span data-ttu-id="6f8d7-246">Установка [Visual Studio 2017](https://visualstudio.microsoft.com/downloads/?utm_medium=microsoft&utm_source=docs.microsoft.com&utm_campaign=button+cta&utm_content=download+vs2017).</span><span class="sxs-lookup"><span data-stu-id="6f8d7-246">Install [Visual Studio 2017](https://visualstudio.microsoft.com/downloads/?utm_medium=microsoft&utm_source=docs.microsoft.com&utm_campaign=button+cta&utm_content=download+vs2017).</span></span>
2. <span data-ttu-id="6f8d7-247">Установка [Azure SDK для .NET для Visual Studio](https://azure.microsoft.com/downloads/).</span><span class="sxs-lookup"><span data-stu-id="6f8d7-247">Install the [Azure SDK for .NET for Visual Studio](https://azure.microsoft.com/downloads/).</span></span>
3. <span data-ttu-id="6f8d7-248">Скачайте ZIP-файл из [коллекции кода MSDN](https://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4).</span><span class="sxs-lookup"><span data-stu-id="6f8d7-248">Download the .zip file from the [MSDN Code Gallery](https://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4).</span></span>
4. <span data-ttu-id="6f8d7-249">В проводнике щелкните правой кнопкой мыши ZIP-файл и выберите пункт Свойства, а затем в окне свойств нажмите кнопку разблокировать.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-249">In File Explorer, right-click the .zip file and click Properties, then in the Properties window click Unblock.</span></span>
5. <span data-ttu-id="6f8d7-250">Распакуйте файл.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-250">Unzip the file.</span></span>
6. <span data-ttu-id="6f8d7-251">Дважды щелкните файл SLN-файл для запуска Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-251">Double-click the .sln file to launch Visual Studio.</span></span>
7. <span data-ttu-id="6f8d7-252">Из **средства** меню, щелкните **диспетчер пакетов NuGet**, затем **консоль диспетчера пакетов**.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-252">From the **Tools** menu, click **NuGet Package Manager**, then **Package Manager Console**.</span></span>
8. <span data-ttu-id="6f8d7-253">В консоли диспетчера пакетов (PMC), нажмите кнопку Восстановить.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-253">In the Package Manager Console (PMC), click Restore.</span></span>
9. <span data-ttu-id="6f8d7-254">Закройте Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-254">Exit Visual Studio.</span></span>
10. <span data-ttu-id="6f8d7-255">Запуск [эмулятора хранения Azure](/azure/storage/common/storage-use-emulator).</span><span class="sxs-lookup"><span data-stu-id="6f8d7-255">Start the [Azure storage emulator](/azure/storage/common/storage-use-emulator).</span></span>
11. <span data-ttu-id="6f8d7-256">Перезапустите Visual Studio, откройте файл решения вы закрыли на предыдущем шаге.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-256">Restart Visual Studio, opening the solution file you closed in the previous step.</span></span>
12. <span data-ttu-id="6f8d7-257">Убедитесь, что проект FixIt задан в качестве запускаемого проекта и нажмите клавишу CTRL + F5, чтобы запустить проект.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-257">Make sure the FixIt project is set as the startup project, and then press CTRL+F5 to run the project.</span></span>

<a id="queueslocal"></a>
### <a name="run-the-application-with-queue-processing"></a><span data-ttu-id="6f8d7-258">Запустите приложение с обработкой очереди</span><span class="sxs-lookup"><span data-stu-id="6f8d7-258">Run the application with queue processing</span></span>

1. <span data-ttu-id="6f8d7-259">Следуйте указаниям, приведенным для [запуска базового приложения](#runbase), а затем закройте браузер и закрыть Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-259">Follow the directions for [Run the base application](#runbase), and then close the browser and close Visual Studio.</span></span>
2. <span data-ttu-id="6f8d7-260">Запустите Visual Studio с правами администратора.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-260">Start Visual Studio with administrator privileges.</span></span> <span data-ttu-id="6f8d7-261">(Вы будете использовать эмулятор вычислений Azure, и, требуются права администратора).</span><span class="sxs-lookup"><span data-stu-id="6f8d7-261">(You'll be using the Azure compute emulator, and that requires administrator privileges.)</span></span>
3. <span data-ttu-id="6f8d7-262">В приложении *Web.config* файл *MyFixIt* проекта (веб-проект), измените значение свойства `appSettings/UseQueues` «true»:</span><span class="sxs-lookup"><span data-stu-id="6f8d7-262">In the application *Web.config* file in the *MyFixIt* project (the web project), change the value of `appSettings/UseQueues` to "true":</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample19.cmd?highlight=3)]
4. <span data-ttu-id="6f8d7-263">Если [эмулятора хранения Azure](https://msdn.microsoft.com/library/windowsazure/hh403989.aspx) не все еще выполняется, запустите его снова.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-263">If the [Azure storage emulator](https://msdn.microsoft.com/library/windowsazure/hh403989.aspx) isn't still running, start it again.</span></span>
5. <span data-ttu-id="6f8d7-264">Запустите FixIt веб-проект и проект MyFixItCloudService одновременно.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-264">Run the FixIt web project and the MyFixItCloudService project simultaneously.</span></span>

    <span data-ttu-id="6f8d7-265">С помощью Visual Studio:</span><span class="sxs-lookup"><span data-stu-id="6f8d7-265">Using Visual Studio:</span></span>

   1. <span data-ttu-id="6f8d7-266">Нажмите клавишу **F5** для запуска проекта FixIt.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-266">Press **F5** to run the FixIt project.</span></span>
   2. <span data-ttu-id="6f8d7-267">В **обозревателе решений**, щелкните правой кнопкой мыши проект MyFixItCloudService и нажмите кнопку **Отладка** > **запустить новый экземпляр**.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-267">In **Solution Explorer**, right-click the MyFixItCloudService project, and then click **Debug** > **Start New Instance**.</span></span>

    <span data-ttu-id="6f8d7-268">С помощью Visual Studio 2013 Express для Web.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-268">Using Visual Studio 2013 Express for Web:</span></span>

   3. <span data-ttu-id="6f8d7-269">В обозревателе решений щелкните правой кнопкой мыши решение решить и выберите **свойства**.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-269">In Solution Explorer, right-click the FixIt solution and select **Properties**.</span></span>
   4. <span data-ttu-id="6f8d7-270">Выберите **несколько запускаемых проектов**.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-270">Select **Multiple Startup Projects**.</span></span>
   5. <span data-ttu-id="6f8d7-271">В **действие** выберите в раскрывающемся списке в разделе MyFixIt и MyFixItCloudService, **запустить**.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-271">In the **Action** dropdown list under MyFixIt and MyFixItCloudService, select **Start**.</span></span>
   6. <span data-ttu-id="6f8d7-272">Нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-272">Click **OK**.</span></span>
   7. <span data-ttu-id="6f8d7-273">Нажмите клавишу **F5** запуск обоих проектов.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-273">Press **F5** to run both projects.</span></span>

      <span data-ttu-id="6f8d7-274">При запуске проекта MyFixItCloudService, Visual Studio запускает эмулятор вычислений Azure.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-274">When you run the MyFixItCloudService project, Visual Studio starts the Azure compute emulator.</span></span> <span data-ttu-id="6f8d7-275">В зависимости от конфигурации брандмауэра необходимо разрешить в эмуляторе через брандмауэр.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-275">Depending on your firewall configuration, you might need to allow the emulator through the firewall.</span></span>

<a id="deploybase"></a>
## <a name="how-to-deploy-the-base-app-to-azure-app-service-web-apps-by-using-the-windows-powershell-scripts"></a><span data-ttu-id="6f8d7-276">Развертывание базового приложения на веб-приложениях службы приложений Azure с помощью сценариев Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="6f8d7-276">How to deploy the base app to Azure App Service Web Apps by using the Windows PowerShell scripts</span></span>

<span data-ttu-id="6f8d7-277">Чтобы проиллюстрировать [автоматизировать все, что](automate-everything.md) шаблон приложения ее исправить, сопровождаются скрипты, настроить среду в Azure и развертывание проекта в новую среду.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-277">To illustrate the [Automate Everything](automate-everything.md) pattern, the Fix It app is supplied with scripts that set up an environment in Azure and deploy the project to the new environment.</span></span> <span data-ttu-id="6f8d7-278">Ниже описано, как с помощью сценариев.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-278">The following instructions explain how to use the scripts.</span></span>

<span data-ttu-id="6f8d7-279">Если вы хотите запустить в Azure без использования очередей, а после внесения изменений для локального выполнения с очередями, убедитесь, что значение UseQueues appSetting обратно в значение false, прежде чем продолжить приведенные ниже инструкции.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-279">If you want to run in Azure without using queues, and you made the changes to run locally with queues, make sure you set the UseQueues appSetting value back to false before proceeding with the following instructions.</span></span>

<span data-ttu-id="6f8d7-280">Эти инструкции предполагают, уже загружено и запустить решение Fix It локально, и что у вас есть Azure учетной записи или нет подписки Azure, вы можете управлять.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-280">These instructions assume you have already downloaded and run the Fix It solution locally, and that you have an Azure account or have an Azure subscription that you are authorized to manage.</span></span>

1. <span data-ttu-id="6f8d7-281">Установка **Azure PowerShell** консоли.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-281">Install the **Azure PowerShell** console.</span></span> <span data-ttu-id="6f8d7-282">Инструкции см. в разделе [описывается установка и настройка Azure PowerShell](https://docs.microsoft.com/powershell/azure/overview?view=azurermps-4.3.1).</span><span class="sxs-lookup"><span data-stu-id="6f8d7-282">For instructions, see [How to install and configure Azure PowerShell](https://docs.microsoft.com/powershell/azure/overview?view=azurermps-4.3.1).</span></span>

    <span data-ttu-id="6f8d7-283">Это специальная консоль настроена для работы с вашей подпиской Azure.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-283">This customized console is configured to work with your Azure subscription.</span></span> <span data-ttu-id="6f8d7-284">Модуль Azure устанавливается в *Program Files* directory и автоматически импортируется на каждый использование консоли Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-284">The Azure module is installed in the *Program Files* directory and is automatically imported on every use of the Azure PowerShell console.</span></span>

    <span data-ttu-id="6f8d7-285">Если вы предпочитаете работать в другой узел программы, такие как интегрированная среда Сценариев Windows PowerShell, обязательно используйте [Import-Module](https://go.microsoft.com/fwlink/?LinkID=141553) командлет для импорта модуля Аzure или использовать команду в модуле Azure для активации, автоматический импорт модуля.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-285">If you prefer to work in a different host program, such as Windows PowerShell ISE, be sure to use the [Import-Module](https://go.microsoft.com/fwlink/?LinkID=141553) cmdlet to import the Azure module or use a command in the Azure module to trigger automatic importing of the module.</span></span>
2. <span data-ttu-id="6f8d7-286">Запустите Azure PowerShell с **Запуск от имени администратора** параметр.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-286">Start Azure PowerShell with the **Run as administrator** option.</span></span>
3. <span data-ttu-id="6f8d7-287">Запустите [Set-ExecutionPolicy](https://go.microsoft.com/fwlink/p/?linkid=293941) командлет, чтобы задать политику выполнения Azure PowerShell `RemoteSigned`.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-287">Run the [Set-ExecutionPolicy](https://go.microsoft.com/fwlink/p/?linkid=293941) cmdlet to set the Azure PowerShell execution policy to `RemoteSigned`.</span></span> <span data-ttu-id="6f8d7-288">Введите **Y** (для подтверждения) для завершения изменения политики.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-288">Enter **Y** (for Yes) to complete the policy change.</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample20.cmd)]

    <span data-ttu-id="6f8d7-289">Этот параметр позволяет запускать локальные сценарии, не имеющие цифровой подписи.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-289">This setting enables you to run local scripts that aren't digitally signed.</span></span> <span data-ttu-id="6f8d7-290">(Можно также задать политику выполнения `Unrestricted`, что помогло бы исключить необходимость для шага unblock позже, но это не рекомендуется по соображениям безопасности.)</span><span class="sxs-lookup"><span data-stu-id="6f8d7-290">(You can also set the execution policy to `Unrestricted`, which would eliminate the need for the unblock step later, but this is not recommended for security reasons.)</span></span>
4. <span data-ttu-id="6f8d7-291">Запустите `Add-AzureAccount` командлет, чтобы настроить PowerShell, используя учетные данные для учетной записи.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-291">Run the `Add-AzureAccount` cmdlet to set up PowerShell with credentials for your account.</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample21.cmd)]

    <span data-ttu-id="6f8d7-292">Эти учетные данные действительны после определенного периода времени, и вам придется повторно выполнить `Add-AzureAccount` командлета.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-292">These credentials expire after a period of time and you have to re-run the `Add-AzureAccount` cmdlet.</span></span> <span data-ttu-id="6f8d7-293">Как выполняется запись в этой электронной книге, предельное время до истечения срока действия учетных данных является 12 часов.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-293">As this e-book is being written, the time limit before credentials expire is 12 hours.</span></span>
5. <span data-ttu-id="6f8d7-294">Если у вас несколько подписок, позволяет указать подписку, которую нужно создать тестовую среду в командлет Select-AzureSubscription.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-294">If you have multiple subscriptions, use the Select-AzureSubscription cmdlet to specify the subscription you want to create the test environment in.</span></span>
6. <span data-ttu-id="6f8d7-295">Импортируйте сертификат управления для той же подписке Azure с помощью `Get-AzurePublishSettingsFile` и `Import-AzurePublishSettingsFile` командлетов.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-295">Import a management certificate for the same Azure subscription by using the `Get-AzurePublishSettingsFile` and `Import-AzurePublishSettingsFile` cmdlets.</span></span> <span data-ttu-id="6f8d7-296">Первый из этих командлетов загружает файл сертификата, а во второй укажите расположение этого файла, чтобы импортировать его.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-296">The first of these cmdlets downloads a certificate file, and in the second one you specify the location of that file in order to import it.</span></span> > [!IMPORTANT]
   > <span data-ttu-id="6f8d7-297">Сохранить скачанный файл в безопасном месте или удалите его после завершения работы с, так как он содержит сертификат, который может использоваться для управления службами Azure.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-297">Keep the downloaded file in a safe location or delete it when you're done with it, because it contains a certificate that can be used to manage your Azure services.</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample22.cmd)]

    <span data-ttu-id="6f8d7-298">Этот сертификат используется для вызова REST API, который обнаруживает IP-адрес компьютера разработки, чтобы задать правило брандмауэра на сервере базы данных SQL.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-298">The certificate is used for a REST API call that detects the development machine's IP address in order to set a firewall rule on the SQL Database server.</span></span>
7. <span data-ttu-id="6f8d7-299">Запустите [Set-Location](https://go.microsoft.com/fwlink/p/?linkid=293912) командлет (псевдонимы `cd`, `chdir`, и `sl`) для перехода к каталогу, который содержит сценарии.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-299">Run the [Set-Location](https://go.microsoft.com/fwlink/p/?linkid=293912) cmdlet (aliases are `cd`, `chdir`, and `sl`) to navigate to the directory that contains the scripts.</span></span> <span data-ttu-id="6f8d7-300">(Они находятся в *автоматизации* папку в папке решения Fix It.) Заключите путь в кавычки, если какой-либо имен каталогов содержит пробелы.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-300">(They're located in the *Automation* folder in the Fix It solution folder.) Put the path in quotes if any of the directory names contain spaces.</span></span> <span data-ttu-id="6f8d7-301">Например, чтобы перейти к `c:\Sample Apps\FixIt\Automation` directory, можно ввести следующую команду:</span><span class="sxs-lookup"><span data-stu-id="6f8d7-301">For example, to navigate to the `c:\Sample Apps\FixIt\Automation` directory you could enter the following command:</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample23.cmd)]
8. <span data-ttu-id="6f8d7-302">Чтобы разрешить Windows PowerShell для запуска этих сценариев, используйте [Unblock-File](https://go.microsoft.com/fwlink/p/?linkid=294021) командлета.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-302">To allow Windows PowerShell to run these scripts, use the [Unblock-File](https://go.microsoft.com/fwlink/p/?linkid=294021) cmdlet.</span></span> <span data-ttu-id="6f8d7-303">(Скрипты блокируются, так как они были загружены из Интернета).</span><span class="sxs-lookup"><span data-stu-id="6f8d7-303">(The scripts are blocked because they were downloaded from the Internet.)</span></span>

    > [!WARNING]
    > <span data-ttu-id="6f8d7-304">Безопасность — перед запуском `Unblock-File` на любой сценарий или исполняемый файл, откройте файл в блокноте, проверить команды и убедитесь, что они не содержат любой вредоносный код.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-304">Security - Before running `Unblock-File` on any script or executable file, open the file in Notepad, examine the commands, and verify that they do not contain any malicious code.</span></span>

    <span data-ttu-id="6f8d7-305">Например, следующая команда запускает `Unblock-File` командлет на всех скриптов в текущем каталоге.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-305">For example, the following command runs the `Unblock-File` cmdlet on all scripts in the current directory.</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample24.cmd)]
9. <span data-ttu-id="6f8d7-306">Создание веб-приложения для базового (очереди без обработки) решение приложения, выполните скрипт создания среды.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-306">To create the web app for the base (no queues processing) Fix It app, run the environment creation script.</span></span>

    <span data-ttu-id="6f8d7-307">Необходимая `Name` параметр указывает имя базы данных, а также используется для учетной записи хранения, который создает сценарий.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-307">The required `Name` parameter specifies the name of the database and is also used for the storage account that the script creates.</span></span> <span data-ttu-id="6f8d7-308">Имя должно быть глобально уникальным в домене azurewebsites.net.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-308">The name must be globally unique within the azurewebsites.net domain.</span></span> <span data-ttu-id="6f8d7-309">Если указать имя, которое не является уникальным, как решить или теста (или даже как в примере, fixitdemo) `New-AzureWebsite` командлетов происходит сбой произошла внутренняя ошибка, которая сообщает о конфликте.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-309">If you specify a name that is not unique, like Fixit or Test (or even as in the example, fixitdemo), the `New-AzureWebsite` cmdlet fails with an Internal Error that reports a conflict.</span></span> <span data-ttu-id="6f8d7-310">Он преобразует имя в нижнем регистре в соответствии с требованиями имя веб-приложений, учетные записи хранения и баз данных.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-310">The script converts the name to all lower-case to comply with name requirements for web apps, storage accounts, and databases.</span></span>

    <span data-ttu-id="6f8d7-311">Необходимая `SqlDatabasePassword` параметр указывает пароль для учетной записи администратора, который будет создан для базы данных SQL.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-311">The required `SqlDatabasePassword` parameter specifies the password for the admin account that will be created for SQL Database.</span></span> <span data-ttu-id="6f8d7-312">Не включать специальные символы XML в пароле (&amp; &lt; &gt; ;).</span><span class="sxs-lookup"><span data-stu-id="6f8d7-312">Don't include special XML characters in the password (&amp; &lt; &gt; ;).</span></span> <span data-ttu-id="6f8d7-313">Это ограничение определенным способом написания скриптов не ограничение в Azure.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-313">This is a limitation of the way the scripts were written, not a limitation of Azure.</span></span>

    <span data-ttu-id="6f8d7-314">Например если вы хотите создать веб-приложения с именем «fixitdemo» и использовать пароль администратора SQL Server «Passw0rd1», можно ввести следующую команду:</span><span class="sxs-lookup"><span data-stu-id="6f8d7-314">For example, if you want to create a web app named "fixitdemo" and use a SQL Server administrator password of "Passw0rd1", you could enter the following command:</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample25.cmd)]

    <span data-ttu-id="6f8d7-315">Имя должно быть уникальным в домене azurewebsites.net, а пароль должен соответствовать требованиям базы данных SQL к сложности паролей.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-315">The name must be unique in the azurewebsites.net domain, and the password must meet SQL Database requirements for password complexity.</span></span> <span data-ttu-id="6f8d7-316">(Пример Passw0rd1 отвечает требованиям.)</span><span class="sxs-lookup"><span data-stu-id="6f8d7-316">(The example Passw0rd1 does meet the requirements.)</span></span>

    <span data-ttu-id="6f8d7-317">Обратите внимание, что команда начинается с «. \".</span><span class="sxs-lookup"><span data-stu-id="6f8d7-317">Note that the command begins with ".\".</span></span> <span data-ttu-id="6f8d7-318">Чтобы предотвратить выполнение вредоносных сценариев Windows PowerShell необходимо указать полный путь к файлу скрипта при запуске сценария.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-318">To help prevent malicious execution of scripts, Windows PowerShell requires that you provide the fully qualified path to the script file when you run a script.</span></span> <span data-ttu-id="6f8d7-319">Для указания текущего каталога можно использовать точку (».\") или укажите полный путь, например:</span><span class="sxs-lookup"><span data-stu-id="6f8d7-319">You can use a dot to indicate the current directory (".\") or provide the fully qualified path, such as:</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample26.cmd)]

    <span data-ttu-id="6f8d7-320">Дополнительные сведения о сценарии использования `Get-Help` командлета.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-320">For more information about the script, use the `Get-Help` cmdlet.</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample27.cmd)]

    <span data-ttu-id="6f8d7-321">Можно использовать `Detailed`, `Full`, `Parameters`, и `Examples` параметры командлета Get-Help для фильтрации справки, который возвращается.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-321">You can use the `Detailed`, `Full`, `Parameters`, and `Examples` parameters of the Get-Help cmdlet to filter the help that is returned.</span></span>

    <span data-ttu-id="6f8d7-322">Если скрипт вызывает сбой или ошибки, такие как «New-AzureWebsite: Во-первых, вызвать Set-AzureSubscription и Select-AzureSubscription» может не завершена конфигурации Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-322">If the script fails or generates errors, such as "New-AzureWebsite : Call Set-AzureSubscription and Select-AzureSubscription first," you might not have completed the configuration of Azure PowerShell.</span></span>

    <span data-ttu-id="6f8d7-323">После выполнения сценария на портале управления Azure можно использовать для просмотра ресурсов, которые были созданы, в том случае, как показано в [автоматизировать все, что](automate-everything.md) главы.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-323">After the script finishes, you can use the Azure Management Portal to see the resources that were created, as shown in the [Automate Everything](automate-everything.md) chapter.</span></span>
10. <span data-ttu-id="6f8d7-324">Чтобы развернуть проект FixIt в новую среду Azure, используйте *AzureWebsite.ps1* скрипта.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-324">To deploy the FixIt project to the new Azure environment, use the *AzureWebsite.ps1* script.</span></span> <span data-ttu-id="6f8d7-325">Пример:</span><span class="sxs-lookup"><span data-stu-id="6f8d7-325">For example:</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample28.cmd)]

    <span data-ttu-id="6f8d7-326">После завершения развертывания в браузере откроется с Fix It работающих в Azure.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-326">When deployment is done, the browser opens with Fix It running in Azure.</span></span>

<a id="troubleshooting"></a>
## <a name="troubleshooting-the-windows-powershell-scripts"></a><span data-ttu-id="6f8d7-327">Устранение неполадок сценариев Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="6f8d7-327">Troubleshooting the Windows PowerShell scripts</span></span>

<span data-ttu-id="6f8d7-328">Наиболее распространенные ошибки, возникшие при выполнении этих сценариев связанных с разрешениями.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-328">The most common errors encountered when running these scripts are related to permissions.</span></span> <span data-ttu-id="6f8d7-329">Убедитесь, что `Add-AzureAccount` и `Import-AzurePublishSettingsFile` выполнены успешно, и использовать их для той же подписке Azure.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-329">Make sure that `Add-AzureAccount` and `Import-AzurePublishSettingsFile` were successful and that you used them for the same Azure subscription.</span></span> <span data-ttu-id="6f8d7-330">Даже если `Add-AzureAccount` был успешно может потребоваться запустить его снова.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-330">Even if `Add-AzureAccount` was successful you might have to run it again.</span></span> <span data-ttu-id="6f8d7-331">Разрешения, добавленные `Add-AzureAccount` истекает через 12 часов.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-331">The permissions added by `Add-AzureAccount` expire in 12 hours.</span></span>

### <a name="object-reference-not-set-to-an-instance-of-an-object"></a><span data-ttu-id="6f8d7-332">Ссылка на объект не указывает на экземпляр объекта.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-332">Object reference not set to an instance of an object.</span></span>

<span data-ttu-id="6f8d7-333">Если сценарий возвращает ошибки, такие как «Ссылка на объект не указывает на экземпляр объекта,» это означает, что Windows PowerShell не удается найти объект к процессу (это исключение null reference), запустите `Add-AzureAccount` командлета и повторите сценарий снова.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-333">If the script returns errors, such as "Object reference not set to an instance of an object," which means that Windows PowerShell can't find an object to process (this is a null reference exception), run the `Add-AzureAccount` cmdlet and try the script again.</span></span>

[!code-console[Main](the-fix-it-sample-application/samples/sample29.cmd)]

### <a name="internalerror-the-server-encountered-an-internal-error"></a><span data-ttu-id="6f8d7-334">Внутренняя ошибка: Внутренняя ошибка сервера.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-334">InternalError: The server encountered an internal error.</span></span>

<span data-ttu-id="6f8d7-335">`New-AzureWebsite` Командлет возвращает внутреннюю ошибку, если имя не является уникальным в домене azurewebsites.net.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-335">The `New-AzureWebsite` cmdlet returns an internal error when the name is not unique in the azurewebsites.net domain.</span></span> <span data-ttu-id="6f8d7-336">Чтобы устранить эту ошибку, используйте другое значение для имени, которая находится на имя параметра *New AzureWebsiteEnv.ps1*.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-336">To resolve the error, use a different value for the name, which is in the Name parameter of *New-AzureWebsiteEnv.ps1*.</span></span>

[!code-console[Main](the-fix-it-sample-application/samples/sample30.cmd)]

### <a name="restarting-the-script"></a><span data-ttu-id="6f8d7-337">Перезапустить сценарий</span><span class="sxs-lookup"><span data-stu-id="6f8d7-337">Restarting the script</span></span>

<span data-ttu-id="6f8d7-338">Если необходимо перезапустить *New AzureWebsiteEnv.ps1* сценария из-за его сбоя, прежде чем оно было напечатано сообщение «Сценарий завершена», может потребоваться удалить ресурсы, которые остановлены сценарий, созданный перед ним.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-338">If you need to restart the *New-AzureWebsiteEnv.ps1* script because it failed before it printed the "Script is complete" message, you might want to delete resources that the script created before it stopped.</span></span> <span data-ttu-id="6f8d7-339">Например если он уже создан ContosoFixItDemo веб-приложение и вы снова запустите сценарий с тем же именем, скрипт при этом завершится ошибкой, поскольку имя уже используется.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-339">For example, if the script already created the ContosoFixItDemo web app and you run the script again with the same name, the script will fail because the name is in use.</span></span>

<span data-ttu-id="6f8d7-340">Чтобы определить, какие ресурсы сценарий, созданный до его остановки, используйте следующие командлеты:</span><span class="sxs-lookup"><span data-stu-id="6f8d7-340">To determine which resources the script created before it stopped, use the following cmdlets:</span></span>

- `Get-AzureWebsite`
- `Get-AzureSqlDatabaseServer`
- <span data-ttu-id="6f8d7-341">`Get-AzureSqlDatabase`: Чтобы выполнить этот командлет, передайте имя сервера базы данных, чтобы `Get-AzureSqlDatabase`:   `Get-AzureSqlDatabaseServer | Get-AzureSqlDatabase.`</span><span class="sxs-lookup"><span data-stu-id="6f8d7-341">`Get-AzureSqlDatabase`: To run this cmdlet, pipe the database server name to `Get-AzureSqlDatabase`:   `Get-AzureSqlDatabaseServer | Get-AzureSqlDatabase.`</span></span>

<span data-ttu-id="6f8d7-342">Чтобы удалить эти ресурсы, используйте следующие команды.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-342">To delete these resources, use the following commands.</span></span> <span data-ttu-id="6f8d7-343">Обратите внимание, что при удалении сервера базы данных, вы автоматически удаления баз данных, связанных с сервером.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-343">Note that if you delete the database server, you automatically delete the databases associated with the server.</span></span>

- `Get-AzureWebsite -Name <WebsiteName> | Remove-AzureWebsite`
- `Get-AzureSqlDatabase -Name <DatabaseName> -ServerName <DatabaseServerName> | Remove-SqlAzureDatabase`
- `Get-AzureSqlDatabaseServer | Remove-AzureSqlDatabaseServer`

<a id="deployqueues"></a>
## <a name="how-to-deploy-the-app-with-queue-processing-to-azure-app-service-web-apps-and-an-azure-cloud-service"></a><span data-ttu-id="6f8d7-344">Как развернуть приложение с очередью, обработку для веб-приложениях службы приложений Azure и в облачной службе Azure</span><span class="sxs-lookup"><span data-stu-id="6f8d7-344">How to deploy the app with queue processing to Azure App Service Web Apps and an Azure Cloud Service</span></span>

<span data-ttu-id="6f8d7-345">Чтобы включить очереди, внести следующие изменения в файл MyFixIt\Web.config.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-345">To enable queues, make the following change in the MyFixIt\Web.config file.</span></span> <span data-ttu-id="6f8d7-346">В разделе `appSettings`, измените значение свойства `UseQueues` «true»:</span><span class="sxs-lookup"><span data-stu-id="6f8d7-346">Under `appSettings`, change the value of `UseQueues` to "true":</span></span>

[!code-xml[Main](the-fix-it-sample-application/samples/sample31.xml)]

<span data-ttu-id="6f8d7-347">Затем развернуть приложение MVC в веб-приложение в службе приложений Azure, как описано [более ранних](#deploybase).</span><span class="sxs-lookup"><span data-stu-id="6f8d7-347">Then deploy the MVC application to an web app in Azure App Service, as described [earlier](#deploybase).</span></span>

<span data-ttu-id="6f8d7-348">Создайте новую Azure облачную службу.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-348">Next, create a new Azure cloud service.</span></span> <span data-ttu-id="6f8d7-349">Сценарии, в состав приложения Fix It не создаются и развертывание облачной службы, поэтому для этого необходимо использовать портал Azure.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-349">The scripts included with the Fix It app do not create or deploy the cloud service, so you must use Azure portal for this.</span></span> <span data-ttu-id="6f8d7-350">На портале, щелкните **New** -- **вычислений** — **облачной службы** -- **быстрое создание**, а затем введите URL-адрес и расположение центра обработки данных.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-350">In the portal, click **New** -- **Compute** – **Cloud Service** -- **Quick Create**, and then enter a URL and a data center location.</span></span> <span data-ttu-id="6f8d7-351">Используйте в одном центре обработки данных, где вы развернули веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-351">Use the same data center where you deployed the web app.</span></span>

![](the-fix-it-sample-application/_static/image1.png)

<span data-ttu-id="6f8d7-352">Перед развертыванием облачной службы, необходимо обновить некоторые из файлов конфигурации.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-352">Before you can deploy the cloud service, you need to update some of the configuration files.</span></span>

<span data-ttu-id="6f8d7-353">В MyFixIt.WorkerRole\app.config в разделе `connectionStrings`, замените значение `appdb` строку подключения с фактической строкой подключения для базы данных SQL.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-353">In MyFixIt.WorkerRole\app.config, under `connectionStrings`, replace the value of the `appdb` connection string with the actual connection string for the SQL Database.</span></span> <span data-ttu-id="6f8d7-354">Строку подключения можно получить на портале.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-354">You can get the connection string from the portal.</span></span> <span data-ttu-id="6f8d7-355">На портале, щелкните **баз данных SQL** - **appdb** - **базы данных SQL представления строки подключения для ADO .net, ODBC, PHP и JDBC**.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-355">In the portal, click **SQL Databases** - **appdb** - **View SQL Database connection strings for ADO .Net, ODBC, PHP, and JDBC**.</span></span> <span data-ttu-id="6f8d7-356">Скопируйте строку подключения ADO.NET и вставьте его в файл app.config.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-356">Copy the ADO.NET connection string and paste the value into the app.config file.</span></span> <span data-ttu-id="6f8d7-357">Замените «{вашей\_пароль\_здесь}» с пароль базы данных.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-357">Replace "{your\_password\_here}" with your database password.</span></span> <span data-ttu-id="6f8d7-358">(При условии, что использовать сценарии для развертывания приложения MVC, указанный пароль базы данных в `SqlDatabasePassword` скрипт параметр.)</span><span class="sxs-lookup"><span data-stu-id="6f8d7-358">(Assuming you used the scripts to deploy the MVC app, you specified the database password in the `SqlDatabasePassword` script parameter.)</span></span>

<span data-ttu-id="6f8d7-359">Результат должен выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="6f8d7-359">The result should look like the following:</span></span>

[!code-xml[Main](the-fix-it-sample-application/samples/sample32.xml)]

<span data-ttu-id="6f8d7-360">В этом же файле MyFixIt.WorkerRole\app.config под `appSettings`, замените два значения заполнителей для учетной записи хранения Azure.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-360">In the same MyFixIt.WorkerRole\app.config file, under `appSettings`, replace the two placeholder values for the Azure storage account.</span></span>

[!code-xml[Main](the-fix-it-sample-application/samples/sample33.xml?highlight=2-3)]

<span data-ttu-id="6f8d7-361">Ключ доступа можно получить на портале.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-361">You can get the access key from the portal.</span></span> <span data-ttu-id="6f8d7-362">См. в разделе [управление учетными записями хранения](https://docs.microsoft.com/azure/storage/common/storage-create-storage-account).</span><span class="sxs-lookup"><span data-stu-id="6f8d7-362">See [How To Manage Storage Accounts](https://docs.microsoft.com/azure/storage/common/storage-create-storage-account).</span></span>

<span data-ttu-id="6f8d7-363">В MyFixItCloudService\ServiceConfiguration.Cloud.cscfg замените две одинаковые значения заполнители для учетной записи хранения Azure.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-363">In MyFixItCloudService\ServiceConfiguration.Cloud.cscfg, replace the same two placeholders values for the Azure storage account.</span></span>

[!code-xml[Main](the-fix-it-sample-application/samples/sample34.xml?highlight=3)]

<span data-ttu-id="6f8d7-364">Теперь все готово к развертыванию облачной службы.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-364">Now you are ready to deploy the cloud service.</span></span> <span data-ttu-id="6f8d7-365">В обозревателе решений щелкните правой кнопкой мыши проект MyFixItCloudService и выберите **публикации**.</span><span class="sxs-lookup"><span data-stu-id="6f8d7-365">In Solution Explore, right-click the MyFixItCloudService project and select **Publish**.</span></span> <span data-ttu-id="6f8d7-366">Дополнительные сведения см. в разделе "[развертывание приложения в Azure](https://www.windowsazure.com/develop/net/tutorials/multi-tier-web-site/2-download-and-run/#deployAz)«, который находится во второй части [учебником](https://code.msdn.microsoft.com/Windows-Azure-Multi-Tier-eadceb36).</span><span class="sxs-lookup"><span data-stu-id="6f8d7-366">For more information, see "[Deploy the Application to Azure](https://www.windowsazure.com/develop/net/tutorials/multi-tier-web-site/2-download-and-run/#deployAz)", which is in part 2 of [this tutorial](https://code.msdn.microsoft.com/Windows-Azure-Multi-Tier-eadceb36).</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="6f8d7-367">Назад</span><span class="sxs-lookup"><span data-stu-id="6f8d7-367">Previous</span></span>](more-patterns-and-guidance.md)
