---
uid: aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/distributed-caching
title: Распределенный кэширование (создание облачных приложений в реальном мире с помощью Azure) Документы Майкрософт
author: MikeWasson
description: Создание облачных приложений реального мира с электронной книгой Azure основано на презентации, разработанной Скоттом Гатри. Это объясняет 13 моделей и практик, которые могут он ...
ms.author: riande
ms.date: 07/20/2015
ms.assetid: 406518e9-3817-49ce-8b90-e82bc461e2c0
msc.legacyurl: /aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/distributed-caching
msc.type: authoredcontent
ms.openlocfilehash: 87a7516415895e761d1589fd459b93e5c15c0f85
ms.sourcegitcommit: ce28244209db8615bc9bdd576a2e2c88174d318d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2020
ms.locfileid: "80675661"
---
# <a name="distributed-caching-building-real-world-cloud-apps-with-azure"></a>Распределенный кэширование (создание реальных облачных приложений с помощью Azure)

[Майк Уоссон](https://github.com/MikeWasson), [Рик Андерсон](https://twitter.com/RickAndMSFT), [Том Дайкстра](https://github.com/tdykstra)

[Скачать Fix It Project](https://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4) или [скачать электронную книгу](https://blogs.msdn.com/b/microsoft_press/archive/2014/07/23/free-ebook-building-cloud-apps-with-microsoft-azure.aspx)

> **Создание облачных приложений реального мира с** электронной книгой Azure основано на презентации, разработанной Скоттом Гатри. В нем изушатся 13 шаблонов и практик, которые могут помочь вам успешно разрабатывать веб-приложения для облака. Для получения информации об электронной книге, [см.](introduction.md)

Предыдущая глава рассматривала переходную обработку неисправностей и упоминала кэширование как стратегию выключателя цепи. В этой главе дается более подробная информация о кэширование, в том числе о том, когда его использовать, общих шаблонах для его использования и о том, как реализовать его в Azure.

## <a name="what-is-distributed-caching"></a>Что распределяется кэширование

Кэш обеспечивает высокую пропускную, низкой задержки доступа к обычно доступу к данным приложения, путем хранения данных в памяти. Для облачного приложения наиболее полезным типом кэша является распределенный кэш, что означает, что данные хранятся не на памяти отдельного веб-сервера, а на других облачных ресурсах, а кэшированные данные становятся доступными для всех веб-серверов приложения (или других облачных VMs, используемых приложением).

![диаграмма, показывающая несколько веб-серверов, доступ к тем же серверам кэша](distributed-caching/_static/image1.png)

Когда приложение масштабируется путем добавления или удаления серверов, или когда серверы заменяются из-за обновлений или сбоев, кэшированные данные остаются доступными для каждого сервера, который управляет приложением.

Избегая доступа к данным с высокой задержкой в постоянном хранилище данных, кэширование может значительно улучшить отзывчивость приложений. Например, извлечение данных из кэша происходит гораздо быстрее, чем извлечение их из реляционной базы данных.

Побочным преимуществом кэширования является уменьшение трафика в постоянном хранилище данных, что может привести к снижению затрат при наличии платы за выход данных для постоянного хранилища данных.

## <a name="when-to-use-distributed-caching"></a>При использовании распределенного кэширования

Кэширование лучше всего подходит для рабочих нагрузок приложений, которые больше читают, чем написание данных, и когда модель данных поддерживает организацию ключей/ценностей, которую используют для хранения и извлечения данных в кэше. Это также более полезно, когда пользователи приложений имеют много общих данных; например, кэш не даст столько преимуществ, если каждый пользователь обычно получает данные, уникальные для этого пользователя. Примером, где кэширование может быть очень полезным, является каталог продуктов, поскольку данные не часто меняются, и все клиенты смотрят на одни и те же данные.

Преимущество кэширования становится все более измеримым, чем больше масштабов приложения, так как ограничения пропускной способности и задержки задержки постоянного хранилища данных становятся все более ограничениями на общую производительность приложения. Однако кэширование может быть реализовано по другим причинам, не же по производительностьм. Для данных, которые не должны быть совершенно актуальными при показе пользователю, доступ к кэша может служить выключателем, когда постоянный хранилище данных не отвечает или недоступен.

## <a name="popular-cache-population-strategies"></a>Популярные стратегии популяции кэша

Для того, чтобы иметь возможность получить данные из кэша, вы должны хранить его там в первую очередь. Существует несколько стратегий получения необходимых данных в кэш:

- По требованию / Кэш Помимо

    Приложение пытается получить данные из кэша, и когда кэш не имеет данных ("мисс"), приложение хранит данные в кэше, так что они будут доступны в следующий раз. В следующий раз, когда приложение попытается получить те же данные, оно находит то, что ищет в кэше ("хит"). Чтобы предотвратить извлечение изысканных в базе данных кэша, при внесении изменений в хранилище данных следует отменять кэш.
- Нажмите фоновых данных

    Справочные службы перебрасывают данные в кэш в обычном графике, и приложение всегда вытаскивает из кэша. Этот подход отлично работает с источниками данных с высокой задержкой, которые не требуют, чтобы вы всегда возвращали последние данные.
- Автоматическое выключение

    Приложение обычно общается напрямую с постоянным хранилищем данных, но когда в постоянном хранилище данных возникали проблемы с доступностью, приложение извлекает данные из кэша. Данные могут быть помещены в кэш, используя либо в сторону кэша, либо стратегию нажатия фоновых данных. Это стратегия обработки неисправностей, а не стратегия повышения производительности.

Для сохранения данных в потоке кэша можно удалить связанные записи кэша, когда приложение создает, обновляет или удаляет данные. Если приложение может иногда получать данные, которые немного устарели, можно положиться на настраиваемое время истечения срока действия, чтобы установить ограничение на количество старых данных кэша.

Можно настроить абсолютное истечение срока действия (количество времени с момента создания элемента кэша) или скользящий срок (количество времени с момента последнего доступа к элементу кэша). Абсолютный истечение используется, когда вы в зависимости от механизма истечения кэша, чтобы предотвратить данные становятся слишком устаревшими. В приложении Fix It мы вручную выселим устаревшие элементы кэша и будем использовать скользящий срок действия, чтобы сохранить самые актуальные данные в кэше. Независимо от выбираемых политики истечения срока действия, кэш автоматически выселяет старейшие (наименее недавно использованные или LRU) элементы при достигаете предела памяти кэша.

## <a name="sample-cache-aside-code-for-fix-it-app"></a>Пример кода кэша для приложения Fix It

В следующем примере кода мы сначала проверяем кэш при извлечении задачи Fix It. Если задача найдена в кэше, мы возвращаем его; если не найдено, мы получаем его из базы данных и храним его в кэше. Высвечиваются изменения, внесенные для `FindTaskByIdAsync` добавления кэширования в метод.

[!code-csharp[Main](distributed-caching/samples/sample1.cs?highlight=5,9-11,13-15,19)]

При обновлении или удалении задачи Fix It необходимо аннулировать (удалить) кэшированную задачу. В противном случае будущие попытки прочитать эту задачу будут продолжать получать старые данные из кэша.

[!code-csharp[Main](distributed-caching/samples/sample2.cs?highlight=7)]

Эти примеры, чтобы проиллюстрировать простой код кэширования; кэширование не было реализовано в загружаемом проекте Fix It.

## <a name="azure-caching-services"></a>Услуги кэширования Azure

Azure предлагает следующие службы кэширования: [Azure Redis Cache](https://msdn.microsoft.com/library/dn690523.aspx) и [Azure Managed Cache.](https://msdn.microsoft.com/library/dn386094.aspx) Кэш Azure Redis основан на популярном [кэше Redis Cache с открытым исходным кодом](http://redis.io/) и является первым выбором для большинства сценариев кэширования.

<a id="sessionstate"></a>
## <a name="aspnet-session-state-using-a-cache-provider"></a>ASP.NET состояние сеанса с помощью поставщика кэша

Как уже упоминалось в [главе веб-разработки передовой практики](web-development-best-practices.md), наилучшая практика заключается в том, чтобы избежать использования состояния сеанса. Если приложение требует состояния сеанса, следующая наилучшая практика заключается в том, чтобы избежать поставщика памяти по умолчанию, потому что это не позволяет масштабировать (несколько экземпляров веб-сервера). В ASP.NET поставщика сеанса S'L Server позволяет сайту, который работает на нескольких веб-серверах, использовать состояние сеанса, но он несет высокую задержку по сравнению с поставщиком в памяти. Наилучшим решением, если вам нужно использовать состояние сеанса, является использование поставщика кэша, например [поставщика состояния сеанса для azure Cache.](https://msdn.microsoft.com/library/windowsazure/gg185668.aspx)

## <a name="summary"></a>Сводка

Вы видели, как приложение Fix It может реализовать кэширование, чтобы улучшить время отклика и масштабируемость, а также позволить приложению продолжать реагировать на операции чтения, когда база данных недоступна. В [следующей главе](queue-centric-work-pattern.md) мы покажем, как еще больше улучшить масштабируемость и сделать приложение продолжать реагировать на операции записи.

## <a name="resources"></a>Ресурсы

Для получения дополнительной информации о кэширования см.

Документация

- [Лазурный кэш](https://msdn.microsoft.com/library/gg278356.aspx). Официальная документация MSDN о кэшировании в Azure.
- [Шаблоны и практики Microsoft - Руководство Azure](https://msdn.microsoft.com/library/dn568099.aspx). См. Руководство Кэшинга и шаблон Cache-Aside.
- [Failsafe: Руководство для устойчивых облачных архитектур.](https://msdn.microsoft.com/library/windowsazure/jj853352.aspx) В белом документе Марк Меркури, Ульрих Хоманн и Эндрю Таунхилл. Смотрите раздел на Кэшинг.
- [Рекомендации по разработке крупномасштабных сервисов в облачных службах Azure.](https://msdn.microsoft.com/library/windowsazure/jj717232.aspx) Ц. Белая книга Марка Симмса и Майкла Томасси. Смотрите раздел о распределенном кэше.
- [Распределенный кэширование на пути к масштабируемости.](https://msdn.microsoft.com/magazine/dd942840.aspx) Старая (2009) статья журнала MSDN, но четко написанное введение в распределенное кэширование в целом; идет в более глубину, чем кэширование разделов FailSafe и передовой практики белых документов.

Видео

- [FailSafe: Создание масштабируемых и устойчивых облачных служб.](https://channel9.msdn.com/Series/FailSafe) Девятисерийные фильмы Ульриха Хомана, Марка Меркури и Марка Симмса. Представляет 400-уровневое представление о том, как проектировать облачные приложения. Эта серия фокусируется на теории и причинах, почему; для получения более подробной информации, см. Смотрите обсуждение кэширования в эпизоде 3, начиная с 1:24:14.
- [Строительство большой: Уроки, извлеченные из клиентов Azure - Часть I](https://channel9.msdn.com/Events/Build/2012/3-029). Саймон Дэвис обсуждает распределенное кэширование, начиная с 46:00. Как и в серии Failsafe, но идет в более как-к деталям. Презентация была представлена 31 октября 2012 года, поэтому она не охватывает кэшинг службы web-приложений в Azure App Service, которая была введена в 2013 году.

Пример кода

- [Основы облачных сервисов в Azure](https://code.msdn.microsoft.com/Cloud-Service-Fundamentals-4ca72649). Пример приложения, реализуемый распределенным кэшированием. Смотрите сопроводительный блог [Обуповывающий сервис Основы - Кэшинг Основы](https://blogs.msdn.com/b/windowsazure/archive/2013/10/03/cloud-service-fundamentals-caching-basics.aspx).

> [!div class="step-by-step"]
> [Назад](transient-fault-handling.md)
> [Вперед](queue-centric-work-pattern.md)
