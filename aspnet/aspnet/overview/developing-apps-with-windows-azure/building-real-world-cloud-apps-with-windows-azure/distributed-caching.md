---
uid: aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/distributed-caching
title: Распределенное кэширование (создание облачных приложений в реальном мире с помощью Azure) | Документация Майкрософт
author: MikeWasson
description: Создание реальных облачных приложений с помощью электронной книги Azure основано на презентации, разработанной Скотт Гатри (. В нем объясняются 13 шаблонов и методик, которые могут...
ms.author: riande
ms.date: 07/20/2015
ms.assetid: 406518e9-3817-49ce-8b90-e82bc461e2c0
msc.legacyurl: /aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/distributed-caching
msc.type: authoredcontent
ms.openlocfilehash: 87a7516415895e761d1589fd459b93e5c15c0f85
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78471480"
---
# <a name="distributed-caching-building-real-world-cloud-apps-with-azure"></a>Распределенное кэширование (создание облачных приложений в реальном мире с помощью Azure)

[Майк Уоссон](https://github.com/MikeWasson), [Рик Андерсон (](https://twitter.com/RickAndMSFT), том [Dykstra)](https://github.com/tdykstra)

[Скачивание решения ИТ-проекта](https://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4) или [Загрузка электронной книги](https://blogs.msdn.com/b/microsoft_press/archive/2014/07/23/free-ebook-building-cloud-apps-with-microsoft-azure.aspx)

> **Создание реальных облачных приложений с помощью** электронной книги Azure основано на презентации, разработанной Скотт Гатри (. В нем объясняются 13 шаблонов и методик, которые могут помочь в успешной разработке веб-приложений для облака. Сведения о электронной книге см. [в первой главе](introduction.md).

В предыдущей главе рассматривалась обработка временных сбоев и упоминалось кэширование в качестве стратегии автоматического прерывания. В этой главе содержатся дополнительные сведения о кэшировании, в том числе о том, когда его использовать, общие шаблоны для использования и как реализовать его в Azure.

## <a name="what-is-distributed-caching"></a>Что такое распределенное кэширование

Кэш обеспечивает высокую пропускную способность и низкую задержку доступа к часто используемым данным приложения, сохраняя данные в памяти. Для облачного приложения наиболее полезный тип кэша — распределенный кэш. Это означает, что данные не хранятся в памяти отдельного веб-сервера, но в других облачных ресурсах, а кэшированные данные доступны всем веб-серверам приложения (или другим облачным виртуальным машинам, которые распределены по AR e используется приложением).

![Схема, демонстрирующая несколько веб-серверов, обращающихся к одним и тем же серверам кэша](distributed-caching/_static/image1.png)

Когда приложение масштабируется путем добавления или удаления серверов или при замене серверов из-за обновления или сбоя, кэшированные данные остаются доступными для каждого сервера, на котором выполняется приложение.

Благодаря предотвращению высокой задержки доступа к данным постоянного хранилища данных, кэширование может значительно повысить скорость реагирования приложений. Например, получение данных из кэша выполняется гораздо быстрее, чем извлечение из реляционной базы данных.

Преимущество кэширования заключается в снижении трафика в хранилище постоянных данных, что может привести к снижению затрат, если для постоянного хранилища данных взимается плата за исходящие данные.

## <a name="when-to-use-distributed-caching"></a>Когда следует использовать распределенное кэширование

Кэширование лучше подходит для рабочих нагрузок приложений, которые более считывают данные, чем запись данных, и когда модель данных поддерживает организацию "ключ — значение", используемую для хранения и извлечения данных в кэше. Он также полезнее, когда пользователи приложений совместно используют большое количество общих данных. Например, кэш не будет предоставлять как можно больше преимуществ, если каждый пользователь обычно получает данные, уникальные для этого пользователя. Пример, в котором кэширование может оказаться очень полезным, — это каталог продуктов, поскольку данные не меняются часто, и все клиенты ищут одни и те же данные.

Преимущество кэширования становится все более ощутимым в том, что более масштабное приложение масштабируется, так как ограничения пропускной способности и задержки хранилища данных становятся более ограниченными в общей производительности приложения. Однако вы можете реализовать кэширование по другим причинам, чем также производительность. Для данных, которые не обязательно должны быть актуальными при отображении пользователю, доступ к кэшу может выступать в качестве автоматического выключения, когда постоянное хранилище данных не отвечает или недоступно.

## <a name="popular-cache-population-strategies"></a>Популярные стратегии заполнения кэша

Чтобы иметь возможность получать данные из кэша, необходимо сначала сохранить их. Существует несколько стратегий получения данных, необходимых в кэше:

- По запросу или кэшированию

    Приложение пытается получить данные из кэша, а если кэш не содержит данных («промах»), приложение сохраняет данные в кэше, чтобы они были доступны в следующий раз. В следующий раз, когда приложение попытается получить те же данные, оно обнаружит, что он ищет в кэше ("попадание"). Чтобы предотвратить выборку кэшированных данных, измененных в базе данных, вы сделаете кэш недействительным при внесении изменений в хранилище данных.
- Фоновая отправка данных

    Фоновые службы отправляют данные в кэш по обычному расписанию, и приложение всегда извлекает из кэша. Этот подход отлично подходит для источников данных с высоким временем задержки, которые не нуждаются в возврате последних данных.
- Автоматическое выключение

    Приложение обычно взаимодействует с постоянным хранилищем данных, но когда хранилище постоянных данных имеет проблемы с доступностью, приложение извлекает данные из кэша. Данные могли быть помещены в кэш с помощью стратегии отработки или фоновой отправки данных кэша. Это стратегия обработки ошибок, а не стратегия повышения производительности.

Чтобы обеспечить актуальность данных в кэше, можно удалить связанные записи кэша, когда приложение создает, обновляет или удаляет данные. Если приложение иногда может получить данные, которые немного устарели, можно полагаться на настраиваемое время окончания срока действия, чтобы установить ограничение на то, как могут быть получены старые данные кэша.

Можно настроить Абсолютный срок действия (время, прошедшее с момента создания элемента кэша) или скользящий срок действия (количество времени с момента последнего обращения к элементу кэша). Абсолютный срок действия используется в зависимости от механизма истечения срока действия кэша, чтобы избежать слишком устаревания данных. В приложении Fix it мы будем вручную исключать устаревшие элементы кэша, и мы будем использовать скользящий срок действия для хранения самых актуальных данных в кэше. Независимо от выбранной политики истечения срока действия кэш автоматически удаляет самые старые элементы (по крайней мере недавно использовавшиеся или LRU) при достижении предела памяти кэша.

## <a name="sample-cache-aside-code-for-fix-it-app"></a>Пример кода в кэше для исправления ИТ-приложения

В следующем примере кода сначала проверяется кэш при получении задачи Fix ИТ. Если задача найдена в кэше, мы возвращаем ее. Если объект не найден, он получается из базы данных и сохраняется в кэше. Изменения, внесенные в добавление кэширования в метод `FindTaskByIdAsync`, выделяются.

[!code-csharp[Main](distributed-caching/samples/sample1.cs?highlight=5,9-11,13-15,19)]

При обновлении или удалении задачи устранения проблем необходимо сделать ее недействительной (удалить) кэшированную задачу. В противном случае будущие попытки прочитать эту задачу продолжат получать старые данные из кэша.

[!code-csharp[Main](distributed-caching/samples/sample2.cs?highlight=7)]

Это примеры, иллюстрирующие простой код кэширования. кэширование не реализовано в проекте для скачиваемых исправлений ИТ.

## <a name="azure-caching-services"></a>Службы кэширования Azure

Azure предлагает следующие службы кэширования: [кэш Redis для Azure](https://msdn.microsoft.com/library/dn690523.aspx) и [управляемый кэш Azure](https://msdn.microsoft.com/library/dn386094.aspx). Кэш Redis для Azure основан на популярном [кэше Redis с открытым исходным кодом](http://redis.io/) и является первым выбором для большинства сценариев кэширования.

<a id="sessionstate"></a>
## <a name="aspnet-session-state-using-a-cache-provider"></a>ASP.NET состояние сеанса с помощью поставщика кэша

Как упоминалось в главе «рекомендации по [веб-разработке](web-development-best-practices.md)», рекомендуется избегать использования состояния сеанса. Если приложению требуется состояние сеанса, рекомендуется избегать используемого по умолчанию поставщика в памяти, так как он не включает масштабирование (несколько экземпляров веб-сервера). Поставщик состояний сеансов ASP.NET SQL Server позволяет сайту, работающему на нескольких веб-серверах, использовать состояние сеанса, но при этом снижается стоимость задержки по сравнению с поставщиком в памяти. Лучшим решением, если необходимо использовать состояние сеанса, является использование поставщика кэша, например [поставщика состояний сеансов для кэша Azure](https://msdn.microsoft.com/library/windowsazure/gg185668.aspx).

## <a name="summary"></a>Сводка

Вы увидели, как приложение для устранения проблем может реализовать кэширование, чтобы повысить время отклика и масштабируемость, а также позволить приложению продолжать отвечать на операции чтения, когда база данных недоступна. В [следующей главе](queue-centric-work-pattern.md) мы покажем, как улучшить масштабируемость и заставить приложение продолжать реагировать на операции записи.

## <a name="resources"></a>Ресурсы

Дополнительные сведения о кэшировании см. в следующих ресурсах.

Документация

- [Кэш Azure](https://msdn.microsoft.com/library/gg278356.aspx). Официальная документация MSDN по кэшированию в Azure.
- [Шаблоны и методики Майкрософт. Руководство по Azure](https://msdn.microsoft.com/library/dn568099.aspx). См. раздел Руководство по кэшированию и шаблон кэша.
- [Отказоустойчивость: руководство по устойчивым облачным архитектурам](https://msdn.microsoft.com/library/windowsazure/jj853352.aspx). Технический документ, (Marc Меркури, Ульрих Хоманн и Эндрю Товнхилл. См. раздел о кэшировании.
- Рекомендации [по проектированию крупномасштабных служб в облачных службах Azure](https://msdn.microsoft.com/library/windowsazure/jj717232.aspx). Ц. Технический документ, пометив SIMM и Майкл Сомасси. См. раздел о распределенном кэшировании.
- [Распределенное кэширование по пути к масштабируемости](https://msdn.microsoft.com/magazine/dd942840.aspx). Более старая статья MSDN Magazine (2009), но четко написанное введение в распределенное кэширование в целом; переходит на более глубокий уровень, чем в разделах, посвященных кэшированию и рекомендациям по обеспечению отказоустойчивости и рекомендаций.

Видео

- [Отказоустойчивость: создание масштабируемых отказоустойчивых облачных служб](https://channel9.msdn.com/Series/FailSafe). Серия из девяти частей, Ульрих Хоманн, (Marc Меркури и пометить SIMM. Представляется представление о проектировании облачных приложений на уровне 400. Эта серия посвящена теории и причинам. Дополнительные сведения см. в статье Создание больших рядов с помощью метки SIMM. См. обсуждение кэширования в серии 3, начиная с 1:24:14.
- [Создание больших: уроки, полученные от клиентов Azure. часть I](https://channel9.msdn.com/Events/Build/2012/3-029). Simon Дэвиса обсуждает распределенное кэширование, начиная с 46:00. Как и в случае с отказоустойчивостью, вы переходите к дополнительным сведениям. Презентация была выпущена 31 октября 2012 г., поэтому она не охватывает службу кэширования веб-приложений в службе приложений Azure, представленную в 2013.

Пример кода

- [Основы облачной службы в Azure](https://code.msdn.microsoft.com/Cloud-Service-Fundamentals-4ca72649). Пример приложения, реализующего распределенное кэширование. Ознакомьтесь с [основными сведениями о облачных службах в блоге — основы кэширования](https://blogs.msdn.com/b/windowsazure/archive/2013/10/03/cloud-service-fundamentals-caching-basics.aspx).

> [!div class="step-by-step"]
> [Назад](transient-fault-handling.md)
> [Вперед](queue-centric-work-pattern.md)
