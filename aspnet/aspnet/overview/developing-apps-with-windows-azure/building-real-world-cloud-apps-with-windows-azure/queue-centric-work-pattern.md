---
uid: aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/queue-centric-work-pattern
title: Рабочий шаблон, ориентированный на очередь (создание облачных приложений в реальном мире с помощью Azure) | Документация Майкрософт
author: MikeWasson
description: Создание реальных облачных приложений с помощью электронной книги Azure основано на презентации, разработанной Скотт Гатри (. В нем объясняются 13 шаблонов и методик, которые могут...
ms.author: riande
ms.date: 06/12/2014
ms.assetid: cc1ad51b-40c3-4c68-8620-9aaa0fd1f6cf
msc.legacyurl: /aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/queue-centric-work-pattern
msc.type: authoredcontent
ms.openlocfilehash: 1177336b25479c06706227e5c8ff4d027cdaebb8
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78472572"
---
# <a name="queue-centric-work-pattern-building-real-world-cloud-apps-with-azure"></a><span data-ttu-id="3f7bd-104">Рабочий шаблон, ориентированный на очередь (создание облачных приложений в реальном мире с помощью Azure)</span><span class="sxs-lookup"><span data-stu-id="3f7bd-104">Queue-Centric Work Pattern (Building Real-World Cloud Apps with Azure)</span></span>

<span data-ttu-id="3f7bd-105">[Майк Уоссон](https://github.com/MikeWasson), [Рик Андерсон (](https://twitter.com/RickAndMSFT), том [Dykstra)](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="3f7bd-105">by [Mike Wasson](https://github.com/MikeWasson), [Rick Anderson](https://twitter.com/RickAndMSFT), [Tom Dykstra](https://github.com/tdykstra)</span></span>

<span data-ttu-id="3f7bd-106">[Скачивание решения ИТ-проекта](https://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4) или [Загрузка электронной книги](https://blogs.msdn.com/b/microsoft_press/archive/2014/07/23/free-ebook-building-cloud-apps-with-microsoft-azure.aspx)</span><span class="sxs-lookup"><span data-stu-id="3f7bd-106">[Download Fix It Project](https://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4) or [Download E-book](https://blogs.msdn.com/b/microsoft_press/archive/2014/07/23/free-ebook-building-cloud-apps-with-microsoft-azure.aspx)</span></span>

> <span data-ttu-id="3f7bd-107">**Создание реальных облачных приложений с помощью** электронной книги Azure основано на презентации, разработанной Скотт Гатри (.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-107">The **Building Real World Cloud Apps with Azure** e-book is based on a presentation developed by Scott Guthrie.</span></span> <span data-ttu-id="3f7bd-108">В нем объясняются 13 шаблонов и методик, которые могут помочь в успешной разработке веб-приложений для облака.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-108">It explains 13 patterns and practices that can help you be successful developing web apps for the cloud.</span></span> <span data-ttu-id="3f7bd-109">Сведения о электронной книге см. [в первой главе](introduction.md).</span><span class="sxs-lookup"><span data-stu-id="3f7bd-109">For information about the e-book, see [the first chapter](introduction.md).</span></span>

<span data-ttu-id="3f7bd-110">Ранее мы видели, что использование нескольких служб может привести к созданию "составного" соглашения об уровне обслуживания, где эффективное соглашение об уровне обслуживания приложения — это *продукт* отдельных SLA.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-110">Earlier, we saw that using multiple services can result in a "composite" SLA, where the app's effective SLA is the *product* of the individual SLAs.</span></span> <span data-ttu-id="3f7bd-111">Например, приложение для устранения проблем использует веб-сайты, хранилище и базу данных SQL.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-111">For example, the Fix It app uses Web Sites, Storage, and SQL Database.</span></span> <span data-ttu-id="3f7bd-112">В случае сбоя любой из этих служб приложение вернет пользователю сообщение об ошибке.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-112">If any one of these services fails, the app will return an error to the user.</span></span>

<span data-ttu-id="3f7bd-113">Кэширование — это хороший способ обработки временных сбоев для содержимого, доступного только для чтения.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-113">Caching is a good way to handle transient failures for read-only content.</span></span> <span data-ttu-id="3f7bd-114">Но что делать, если приложению нужно работать?</span><span class="sxs-lookup"><span data-stu-id="3f7bd-114">But what if your application needs to do work?</span></span> <span data-ttu-id="3f7bd-115">Например, когда пользователь отправляет новую задачу Fix ИТ, приложение не может просто разместить задачу в кэше.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-115">For example, when the user submits a new Fix It task, the app can't just put the task into the cache.</span></span> <span data-ttu-id="3f7bd-116">Приложению необходимо записать задачу Fix ИТ в постоянное хранилище данных, чтобы его можно было обработать.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-116">The app needs to write the Fix It task into a persistent data store, so it can be processed.</span></span>

<span data-ttu-id="3f7bd-117">Именно здесь поступает рабочий шаблон, ориентированный на очередь.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-117">That's where the queue-centric work pattern comes in.</span></span> <span data-ttu-id="3f7bd-118">Этот шаблон обеспечивает слабую связь между веб-уровнем и внутренней службой.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-118">This pattern enables loose coupling between a web tier and a backend service.</span></span>

<span data-ttu-id="3f7bd-119">Вот как работает этот шаблон.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-119">Here's how the pattern works.</span></span> <span data-ttu-id="3f7bd-120">Когда приложение получает запрос, оно помещает рабочий элемент в очередь и немедленно возвращает ответ.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-120">When the application gets a request, it puts a work item onto a queue and immediately returns the response.</span></span> <span data-ttu-id="3f7bd-121">Затем отдельный внутренний процесс извлекает из очереди рабочие элементы и выполняет работу.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-121">Then a separate backend process pulls work items from the queue and does the work.</span></span>

<span data-ttu-id="3f7bd-122">Рабочий шаблон, ориентированный на очередь, полезен для следующих задач:</span><span class="sxs-lookup"><span data-stu-id="3f7bd-122">The queue-centric work pattern is useful for:</span></span>

- <span data-ttu-id="3f7bd-123">Работа, требующая длительного времени (с высокой задержкой).</span><span class="sxs-lookup"><span data-stu-id="3f7bd-123">Work that is time consuming (high latency).</span></span>
- <span data-ttu-id="3f7bd-124">Работа, для которой требуется внешняя служба, которая может быть не всегда доступна.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-124">Work that requires an external service that might not always be available.</span></span>
- <span data-ttu-id="3f7bd-125">Работа, интенсивно использующая ресурсы (высокая загрузка ЦП).</span><span class="sxs-lookup"><span data-stu-id="3f7bd-125">Work that is resource-intensive (high CPU).</span></span>
- <span data-ttu-id="3f7bd-126">Работа, для которой выгодно выравнивание скорости (в условиях внезапного ускорения нагрузки).</span><span class="sxs-lookup"><span data-stu-id="3f7bd-126">Work that would benefit from rate leveling (subject to sudden load bursts).</span></span>

## <a name="reduced-latency"></a><span data-ttu-id="3f7bd-127">Уменьшенная задержка</span><span class="sxs-lookup"><span data-stu-id="3f7bd-127">Reduced Latency</span></span>

<span data-ttu-id="3f7bd-128">Очереди удобно использовать в любой момент, когда вы выполняете трудоемкую работу.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-128">Queues are useful any time you are doing time-consuming work.</span></span> <span data-ttu-id="3f7bd-129">Если задача занимает несколько секунд или больше, вместо блокировки конечного пользователя помещайте рабочий элемент в очередь.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-129">If a task takes a few seconds or longer, instead of blocking the end user, put the work item into a queue.</span></span> <span data-ttu-id="3f7bd-130">Сообщите пользователю "Мы работаем над этим", а затем используйте прослушиватель очереди для обработки задачи в фоновом режиме.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-130">Tell the user "We're working on it," and then use a queue listener to process the task in the background.</span></span>

<span data-ttu-id="3f7bd-131">Например, если вы приобрели что-либо в Интернет-магазине, он немедленно подтверждает Ваш заказ.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-131">For example, when you purchase something at an online retailer, the web site confirms your order immediately.</span></span> <span data-ttu-id="3f7bd-132">Но это не значит, что ваши материалы уже есть в грузовике.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-132">But that doesn't mean your stuff is already in a truck being delivered.</span></span> <span data-ttu-id="3f7bd-133">Они помещают задачу в очередь и в фоновом режиме выполняют проверку кредита, подготавливая элементы для доставки и т. д.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-133">They put a task in a queue, and in the background they are doing the credit check, preparing your items for shipping, and so forth.</span></span>

<span data-ttu-id="3f7bd-134">В сценариях с небольшой задержкой общее время может быть больше, чем при использовании очереди, по сравнению с выполнением задачи в синхронном режиме.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-134">For scenarios with short latency, the total end-to-end time might be longer using a queue, compared with doing the task synchronously.</span></span> <span data-ttu-id="3f7bd-135">Но даже тогда другие преимущества могут перевесить это преимущество.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-135">But even then, the other benefits can outweigh that disadvantage.</span></span>

## <a name="increased-reliability"></a><span data-ttu-id="3f7bd-136">Повышенная надежность</span><span class="sxs-lookup"><span data-stu-id="3f7bd-136">Increased Reliability</span></span>

<span data-ttu-id="3f7bd-137">В той версии, которую мы рассматривали до сих пор, внешний веб-интерфейс тесно связан с серверной частью базы данных SQL.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-137">In the version of Fix It that we've been looking at so far, the web front-end is tightly coupled with the SQL Database back-end.</span></span> <span data-ttu-id="3f7bd-138">Если служба базы данных SQL недоступна, пользователь получает сообщение об ошибке.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-138">If the SQL database service is unavailable, the user gets an error.</span></span> <span data-ttu-id="3f7bd-139">Если повторные попытки не работают (т. е. сбой является более временным), единственное, что можно сделать, это отобразить ошибку и попросить пользователя повторить попытку позже.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-139">If retries don't work (that is, the failure is more than transient), the only thing you can do is show an error and ask the user to try again later.</span></span>

![Схема сбоя фонового веб-интерфейса при сбое серверной части базы данных SQL](queue-centric-work-pattern/_static/image1.png)

<span data-ttu-id="3f7bd-141">При использовании очередей, когда пользователь отправляет задачу Fix ИТ, приложение записывает сообщение в очередь.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-141">Using queues, when a user submits a Fix It task, the app writes a message to the queue.</span></span> <span data-ttu-id="3f7bd-142">Полезные данные сообщения представляют собой представление [JSON](http://json.org/) задачи.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-142">The message payload is a [JSON](http://json.org/) representation of the task.</span></span> <span data-ttu-id="3f7bd-143">Как только сообщение записывается в очередь, приложение возвращает и сразу же отображает сообщение об успешном выполнении для пользователя.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-143">As soon as the message is written to the queue, the app returns and immediately shows a success message to the user.</span></span>

<span data-ttu-id="3f7bd-144">Если какая-либо из серверных служб, например база данных SQL или прослушиватель очереди, переходит в автономный режим, пользователи по-прежнему могут отправлять новые задачи устранения проблем.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-144">If any of the backend services – such as the SQL database or the queue listener -- go offline, users can still submit new Fix It tasks.</span></span> <span data-ttu-id="3f7bd-145">Сообщения будут просто ставиться в очередь до тех пор, пока серверные службы снова не будут доступны.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-145">The messages will just queue up until the backend services are available again.</span></span> <span data-ttu-id="3f7bd-146">На этом этапе серверные службы будут отслеживать невыполненную работу.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-146">At that point, the backend services will catch up on the backlog.</span></span>

![Схема, показывающая, что клиентский веб-интерфейс продолжает работать при возникновении ошибки базы данных SQL](queue-centric-work-pattern/_static/image2.png)

<span data-ttu-id="3f7bd-148">Более того, теперь можно добавить дополнительную серверную логику, не беспокоясь о устойчивости внешнего интерфейса.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-148">Moreover, now you can add more backend logic without worrying about the resiliency of the front end.</span></span> <span data-ttu-id="3f7bd-149">Например, может потребоваться отправить владельцу сообщение электронной почты или SMS при каждом назначении нового исправления.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-149">For example, you might want to send an email or SMS message to the owner whenever a new Fix It is assigned.</span></span> <span data-ttu-id="3f7bd-150">Если электронная почта или служба SMS становятся недоступными, можно обработать все остальное, а затем поместить сообщение в отдельную очередь для отправки сообщений электронной почты и SMS.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-150">If the email or SMS service becomes unavailable, you can process everything else, and then put a message into a separate queue for sending email/SMS messages.</span></span>

<span data-ttu-id="3f7bd-151">Ранее наше соглашение об уровне обслуживания было веб-приложениями &times; хранилище &times; база данных SQL = 99,7%.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-151">Previously, our effective SLA was Web Apps &times; Storage &times; SQL Database = 99.7%.</span></span> <span data-ttu-id="3f7bd-152">(См. раздел [Разработка для выдерживаться сбоев](design-to-survive-failures.md).)</span><span class="sxs-lookup"><span data-stu-id="3f7bd-152">(See [Design to Survive Failures](design-to-survive-failures.md).)</span></span>

<span data-ttu-id="3f7bd-153">При изменении приложения для использования очереди клиентский веб-интерфейс зависит только от веб-приложений и хранилища, для составного соглашения об уровне обслуживания 99,8%.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-153">When we change the app to use a queue, the web front end depends only on Web Apps and Storage, for a composite SLA of 99.8%.</span></span> <span data-ttu-id="3f7bd-154">(Обратите внимание, что очереди являются частью службы хранилища Azure, поэтому они включены в то же соглашение об уровне обслуживания, что и хранилище BLOB-объектов.)</span><span class="sxs-lookup"><span data-stu-id="3f7bd-154">(Note that queues are part of the Azure storage service, so they are included in the same SLA as blob storage.)</span></span>

<span data-ttu-id="3f7bd-155">Если вам нужно еще более чем 99,8%, можно создать две очереди в двух разных регионах.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-155">If you need even better than 99.8%, you can create two queues in two different regions.</span></span> <span data-ttu-id="3f7bd-156">Назначьте один из них первичным, а другой — базой данных-получателем.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-156">Designate one as the primary, and the other as the secondary.</span></span> <span data-ttu-id="3f7bd-157">В приложении отработка отказа во вторичную очередь, если основная очередь недоступна.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-157">In your app, fail over to the secondary queue if the primary queue is not available.</span></span> <span data-ttu-id="3f7bd-158">Вероятность одновременного недоступности обоих экземпляров очень мала.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-158">The chance of both being unavailable at the same time is very small.</span></span>

## <a name="rate-leveling-and-independent-scaling"></a><span data-ttu-id="3f7bd-159">Скорость и независимое масштабирование</span><span class="sxs-lookup"><span data-stu-id="3f7bd-159">Rate Leveling and Independent Scaling</span></span>

<span data-ttu-id="3f7bd-160">Очереди также полезны для чего-либо, называемого *выравниванием скорости* или *выравниванием нагрузки*.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-160">Queues are also useful for something called *rate leveling* or *load leveling*.</span></span>

<span data-ttu-id="3f7bd-161">Веб-приложения часто чувствительны к резкому увеличению трафика.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-161">Web apps are often susceptible to sudden bursts in traffic.</span></span> <span data-ttu-id="3f7bd-162">Хотя Автомасштабирование можно использовать для автоматического добавления веб-серверов для обработки увеличенного веб-трафика, автоматическое масштабирование может не удаться быстро реагировать на обработку внезапных пиков нагрузки.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-162">While you can use autoscaling to automatically add web servers to handle increased web traffic, autoscaling might not be able to react quickly enough to handle abrupt spikes in load.</span></span> <span data-ttu-id="3f7bd-163">Если веб-серверы могут разгрузить часть работы, которую они должны выполнить, записав сообщение в очередь, они могут справиться с большим объемом трафика.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-163">If the web servers can offload some of the work they have to do by writing a message to a queue, they can handle more traffic.</span></span> <span data-ttu-id="3f7bd-164">Серверная служба может затем считывать сообщения из очереди и обрабатывать их.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-164">A backend service can then read messages from the queue and process them.</span></span> <span data-ttu-id="3f7bd-165">Глубина очереди будет увеличиваться или уменьшаться по мере того, как входящая нагрузка меняется.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-165">The depth of the queue will grow or shrink as the incoming load varies.</span></span>

<span data-ttu-id="3f7bd-166">В значительной степени длительной работы, загруженной в серверную службу, веб-уровень может более легко реагировать на внезапные пики трафика.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-166">With much of its time-consuming work off-loaded to a backend service, the web tier can more easily respond to sudden spikes in traffic.</span></span> <span data-ttu-id="3f7bd-167">И вы экономите деньги, поскольку любой заданный объем трафика может обрабатываться меньшим числом веб-серверов.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-167">And you save money because any given amount of traffic can be handled by fewer web servers.</span></span>

<span data-ttu-id="3f7bd-168">Веб-уровень и серверную службу можно масштабировать независимо друг от друга.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-168">You can scale the web tier and backend service independently.</span></span> <span data-ttu-id="3f7bd-169">Например, может потребоваться три веб-сервера, но только один сервер обрабатывает сообщения очереди.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-169">For example, you might need three web servers but only one server processing queue messages.</span></span> <span data-ttu-id="3f7bd-170">Или, если вы используете ресурсоемкие задачи в фоновом режиме, может потребоваться большее количество внутренних серверов.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-170">Or if you're running a compute-intensive task in the background, you might need more backend servers.</span></span>

![](queue-centric-work-pattern/_static/image3.png)

<span data-ttu-id="3f7bd-171">Автомасштабирование работает с серверными службами, а также с веб-уровнем.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-171">Autoscaling works with backend services as well as with the web tier.</span></span> <span data-ttu-id="3f7bd-172">Можно увеличить или уменьшить количество виртуальных машин, обрабатывающих задачи в очереди, на основе загрузки ЦП серверных виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-172">You can scale up or scale down the number of VMs that are processing the tasks in the queue, based on the CPU usage of the backend VMs.</span></span> <span data-ttu-id="3f7bd-173">Кроме того, можно выполнить Автомасштабирование в зависимости от количества элементов в очереди.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-173">Or, you can autoscale based on how many items are in a queue.</span></span> <span data-ttu-id="3f7bd-174">Например, можно настроить автоматическое масштабирование, чтобы попытаться не более 10 элементов в очереди.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-174">For example, you can tell autoscale to try to keep no more than 10 items in the queue.</span></span> <span data-ttu-id="3f7bd-175">Если очередь содержит более 10 элементов, автоматическое масштабирование добавит виртуальные машины.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-175">If the queue has more than 10 items, autoscale will add VMs.</span></span> <span data-ttu-id="3f7bd-176">Когда они захватываются, автомасштабирование приведет к разрыву дополнительных виртуальных машин.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-176">When they catch up, autoscale will tear down the extra VMs.</span></span>

## <a name="adding-queues-to-the-fix-it-application"></a><span data-ttu-id="3f7bd-177">Добавление очередей в приложение Fix It</span><span class="sxs-lookup"><span data-stu-id="3f7bd-177">Adding Queues to the Fix It Application</span></span>

<span data-ttu-id="3f7bd-178">Чтобы реализовать шаблон очереди, необходимо внести два изменения в приложение Fix ИТ.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-178">To implement the queue pattern, we need to make two changes to the Fix It app.</span></span>

- <span data-ttu-id="3f7bd-179">Когда пользователь отправляет новую задачу Fix ИТ, добавьте ее в очередь, а не записывая в базу данных.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-179">When a user submits a new Fix It task, put the task in the queue, instead of writing it to the database.</span></span>
- <span data-ttu-id="3f7bd-180">Создайте серверную службу, которая обрабатывает сообщения в очереди.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-180">Create a back-end service that processes messages in the queue.</span></span>

<span data-ttu-id="3f7bd-181">Для очереди мы будем использовать [службу хранилища очередей Azure](https://www.windowsazure.com/develop/net/how-to-guides/queue-service/).</span><span class="sxs-lookup"><span data-stu-id="3f7bd-181">For the queue, we'll use the [Azure Queue Storage Service](https://www.windowsazure.com/develop/net/how-to-guides/queue-service/).</span></span> <span data-ttu-id="3f7bd-182">Другой вариант — использовать [служебную шину Azure](https://docs.microsoft.com/azure/service-bus/).</span><span class="sxs-lookup"><span data-stu-id="3f7bd-182">Another option is to use [Azure Service Bus](https://docs.microsoft.com/azure/service-bus/).</span></span>

<span data-ttu-id="3f7bd-183">Чтобы решить, какую службу очередей использовать, определите, как ваше приложение должно отправлять и получать сообщения в очереди:</span><span class="sxs-lookup"><span data-stu-id="3f7bd-183">To decide which queue service to use, consider how your app needs to send and receive the messages in the queue:</span></span>

- <span data-ttu-id="3f7bd-184">Если у вас есть сооперационные производители и конкурирующие потребители, рассмотрите возможность использования службы хранилища очередей Azure.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-184">If you have cooperating producers and competing consumers, consider using Azure Queue Storage Service.</span></span> <span data-ttu-id="3f7bd-185">«Взаиморабочие производители» означает, что несколько процессов добавляют сообщения в очередь.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-185">"Cooperating producers" means multiple processes are adding messages to a queue.</span></span> <span data-ttu-id="3f7bd-186">«Конкурирующие потребители» означает, что несколько процессов получают сообщения из очереди для их обработки, но любое конкретное сообщение может обрабатываться только одним «потребителем».</span><span class="sxs-lookup"><span data-stu-id="3f7bd-186">"Competing consumers" means multiple processes are pulling messages off the queue to process them, but any given message can only be processed by one "consumer."</span></span> <span data-ttu-id="3f7bd-187">Если требуется больше пропускной способности, чем можно получить с помощью одной очереди, используйте дополнительные очереди и (или) дополнительные учетные записи хранения.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-187">If you need more throughput than you can get with a single queue, use additional queues and/or additional storage accounts.</span></span>
- <span data-ttu-id="3f7bd-188">Если вам нужна [модель публикации и подписки](http://en.wikipedia.org/wiki/Publish/subscribe), рассмотрите возможность использования очередей служебной шины Azure.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-188">If you need a [publish/subscribe model](http://en.wikipedia.org/wiki/Publish/subscribe), consider using Azure Service Bus Queues.</span></span>

<span data-ttu-id="3f7bd-189">Приложение для устранения проблем соответствует требованиям к взаимоэксплуатационным производителям и модели конкурирующих потребителей.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-189">The Fix It app fits the cooperating producers and competing consumers model.</span></span>

<span data-ttu-id="3f7bd-190">Еще один вопрос — доступность приложения.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-190">Another consideration is application availability.</span></span> <span data-ttu-id="3f7bd-191">Служба хранилища очередей является частью той же службы, которую мы используем для хранения BLOB-объектов, поэтому ее использование не влияет на соглашение об уровне обслуживания.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-191">The Queue Storage Service is part of the same service that we're using for blob storage, so using it has no effect on our SLA.</span></span> <span data-ttu-id="3f7bd-192">Служебная шина Azure — это отдельная служба с собственным соглашением об уровне обслуживания.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-192">Azure Service Bus is a separate service with its own SLA.</span></span> <span data-ttu-id="3f7bd-193">Если мы использовали очереди служебной шины, нам пришлось бы учесть дополнительный процент соглашения об уровне обслуживания, и наше составное соглашение об уровне обслуживания было бы ниже.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-193">If we used Service Bus Queues, we would have to factor in an additional SLA percentage, and our composite SLA would be lower.</span></span> <span data-ttu-id="3f7bd-194">При выборе службы очередей убедитесь, что вы понимаете влияние вашего выбора на доступность приложения.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-194">When you're choosing a queue service, make sure you understand the impact of your choice on application availability.</span></span> <span data-ttu-id="3f7bd-195">Дополнительные сведения см. в разделе [Resources](#resources) .</span><span class="sxs-lookup"><span data-stu-id="3f7bd-195">For more information, see the [Resources](#resources) section.</span></span>

## <a name="creating-queue-messages"></a><span data-ttu-id="3f7bd-196">Создание сообщений очереди</span><span class="sxs-lookup"><span data-stu-id="3f7bd-196">Creating Queue Messages</span></span>

<span data-ttu-id="3f7bd-197">Чтобы поместить в очередь эту задачу, веб-интерфейс выполняет следующие действия.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-197">To put a Fix It task on the queue, the web front end performs the following steps:</span></span>

1. <span data-ttu-id="3f7bd-198">Создайте экземпляр [CloudQueueClient](https://msdn.microsoft.com/library/microsoft.windowsazure.storage.queue.cloudqueueclient.aspx) .</span><span class="sxs-lookup"><span data-stu-id="3f7bd-198">Create a [CloudQueueClient](https://msdn.microsoft.com/library/microsoft.windowsazure.storage.queue.cloudqueueclient.aspx) instance.</span></span> <span data-ttu-id="3f7bd-199">Экземпляр `CloudQueueClient` используется для выполнения запросов к службе очередей.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-199">The `CloudQueueClient` instance is used to execute requests against the Queue Service.</span></span>
2. <span data-ttu-id="3f7bd-200">Создайте очередь, если она еще не существует.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-200">Create the queue, if it doesn't exist yet.</span></span>
3. <span data-ttu-id="3f7bd-201">Сериализация задачи Fix ИТ.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-201">Serialize the Fix It task.</span></span>
4. <span data-ttu-id="3f7bd-202">Вызовите [CloudQueue. аддмессажеасинк](https://msdn.microsoft.com/library/microsoft.windowsazure.storage.queue.cloudqueue.addmessageasync.aspx) , чтобы поместить сообщение в очередь.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-202">Call [CloudQueue.AddMessageAsync](https://msdn.microsoft.com/library/microsoft.windowsazure.storage.queue.cloudqueue.addmessageasync.aspx) to put the message onto the queue.</span></span>

<span data-ttu-id="3f7bd-203">Мы выполним эту работу в конструкторе и `SendMessageAsync` методе нового класса `FixItQueueManager`.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-203">We'll do this work in the constructor and `SendMessageAsync` method of a new `FixItQueueManager` class.</span></span>

[!code-csharp[Main](queue-centric-work-pattern/samples/sample1.cs?highlight=11-12,16,18-25)]

<span data-ttu-id="3f7bd-204">Здесь мы используем библиотеку [JSON.NET](https://github.com/JamesNK/Newtonsoft.Json) для сериализации формата Fixit в формат JSON.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-204">Here we are using the [Json.NET](https://github.com/JamesNK/Newtonsoft.Json) library to serialize the fixit to JSON format.</span></span> <span data-ttu-id="3f7bd-205">Вы можете использовать любой предпочтительный подход к сериализации.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-205">You can use whatever serialization approach you prefer.</span></span> <span data-ttu-id="3f7bd-206">Формат JSON имеет преимущество для человеческого восприятия, но менее подробный, чем XML.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-206">JSON has the advantage of being human-readable, while being less verbose than XML.</span></span>

<span data-ttu-id="3f7bd-207">Код рабочего качества добавляет логику обработки ошибок, приостанавливает выполнение, если база данных становится недоступной, полностью обрабатывает восстановление, создает очередь для запуска приложения и управляет[подозрительными сообщениями](https://msdn.microsoft.com/library/ms789028(v=vs.110).aspx).</span><span class="sxs-lookup"><span data-stu-id="3f7bd-207">Production-quality code would add error handling logic, pause if the database became unavailable, handle recovery more cleanly, create the queue on application start-up, and manage "[poison" messages](https://msdn.microsoft.com/library/ms789028(v=vs.110).aspx).</span></span> <span data-ttu-id="3f7bd-208">(Опасное сообщение — это сообщение, которое не может быть обработано по какой-либо причине.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-208">(A poison message is a message that cannot be processed for some reason.</span></span> <span data-ttu-id="3f7bd-209">Вы не хотите, чтобы подозрительные сообщения находились в очереди, где рабочая роль будет постоянно пытаться обработать их, завершиться ошибкой, повторить попытку, завершиться сбоем и т. д.)</span><span class="sxs-lookup"><span data-stu-id="3f7bd-209">You don't want poison messages to sit in the queue, where the worker role will continually try to process them, fail, try again, fail, and so on.)</span></span>

<span data-ttu-id="3f7bd-210">В приложении MVC внешнего интерфейса необходимо обновить код, который создает новую задачу.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-210">In the front-end MVC application, we need to update the code that creates a new task.</span></span> <span data-ttu-id="3f7bd-211">Вместо помещения задачи в репозиторий вызовите метод `SendMessageAsync`, показанный выше.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-211">Instead of putting the task into the repository, call the `SendMessageAsync` method shown above.</span></span>

[!code-csharp[Main](queue-centric-work-pattern/samples/sample2.cs?highlight=10)]

## <a name="processing-queue-messages"></a><span data-ttu-id="3f7bd-212">Обработка сообщений очереди</span><span class="sxs-lookup"><span data-stu-id="3f7bd-212">Processing Queue Messages</span></span>

<span data-ttu-id="3f7bd-213">Для обработки сообщений в очереди мы создадим серверную службу.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-213">To process messages in the queue, we'll create a backend service.</span></span> <span data-ttu-id="3f7bd-214">Серверная служба будет выполнять бесконечный цикл, который выполняет следующие действия:</span><span class="sxs-lookup"><span data-stu-id="3f7bd-214">The backend service will run an infinite loop that performs the following steps:</span></span>

1. <span data-ttu-id="3f7bd-215">Получение следующего сообщения из очереди.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-215">Get the next message from the queue.</span></span>
2. <span data-ttu-id="3f7bd-216">Десериализация сообщения в задачу Fix ИТ.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-216">Deserialize the message to a Fix It task.</span></span>
3. <span data-ttu-id="3f7bd-217">Напишите задачу Fix ИТ в базу данных.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-217">Write the Fix It task to the database.</span></span>

<span data-ttu-id="3f7bd-218">Чтобы разместить серверную службу, мы создадим облачную службу Azure, которая содержит *рабочую роль*.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-218">To host the backend service, we'll create an Azure Cloud Service that contains a *worker role*.</span></span> <span data-ttu-id="3f7bd-219">Рабочая роль состоит из одной или нескольких виртуальных машин, которые могут выполнять серверную обработку.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-219">A worker role consists of one or more VMs that can do backend processing.</span></span> <span data-ttu-id="3f7bd-220">Код, выполняемый на этих виртуальных машинах, будет извлекать сообщения из очереди по мере их появления.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-220">The code that runs in these VMs will pull messages from the queue as they become available.</span></span> <span data-ttu-id="3f7bd-221">Для каждого сообщения будут десериализованы полезные данные JSON и записан экземпляр сущности Fix ИТ Task в базу данных, используя тот же репозиторий, который мы использовали ранее на веб-уровне.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-221">For each message, we'll deserialize the JSON payload and write an instance of the Fix It Task entity to the database, using the same repository that we used earlier in the web tier.</span></span>

<span data-ttu-id="3f7bd-222">В следующих шагах показано, как добавить проект рабочей роли в решение, имеющее стандартный веб-проект.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-222">The following steps show how to add a worker role project to a solution that has a standard web project.</span></span> <span data-ttu-id="3f7bd-223">Эти действия уже выполнены в проекте Fix, который можно загрузить.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-223">These steps have already been done in the Fix It project that you can download.</span></span>

<span data-ttu-id="3f7bd-224">Сначала добавьте проект облачной службы в решение Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-224">First add a Cloud Service project to the Visual Studio solution.</span></span> <span data-ttu-id="3f7bd-225">Щелкните решение правой кнопкой мыши и выберите **Добавить**, а затем **Новый проект**.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-225">Right-click the solution and select **Add**, then **New Project**.</span></span> <span data-ttu-id="3f7bd-226">В левой области разверните узел **визуальный C#**  элемент и выберите **облако**.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-226">In the left pane, expand **Visual C#** and select **Cloud**.</span></span>

[![](queue-centric-work-pattern/_static/image5.png)](queue-centric-work-pattern/_static/image4.png)

<span data-ttu-id="3f7bd-227">В диалоговом окне **новая облачная служба Azure** разверните **узел C# визуальный** элемент в левой области.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-227">In the **New Azure Cloud Service** dialog, expand the **Visual C#** node on the left pane.</span></span> <span data-ttu-id="3f7bd-228">Выберите **Рабочая роль** и щелкните значок стрелки вправо.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-228">Select **Worker Role** and click the right-arrow icon.</span></span>

![](queue-centric-work-pattern/_static/image6.png)

<span data-ttu-id="3f7bd-229">(Обратите внимание, что можно также добавить *веб-роль*.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-229">(Notice that you can also add a *web role*.</span></span> <span data-ttu-id="3f7bd-230">Мы могли бы запустить интерфейс исправления ИТ-интерфейса в той же облачной службе, а не запускать его на веб-сайте Azure.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-230">We could run the Fix It front-end in the same Cloud Service instead of running it in an Azure Web Site.</span></span> <span data-ttu-id="3f7bd-231">У него есть некоторые преимущества, позволяющие упростить координацию соединений между внешним интерфейсом и серверной частью.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-231">That has some advantages in making connections between front-end and back-end easier to coordinate.</span></span> <span data-ttu-id="3f7bd-232">Однако для простоты этой демонстрации мы работаем в веб-приложении службы приложений Azure и только в облачной службе.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-232">However, to keep this demo simple, we're keeping the front-end in an Azure App Service Web App and only running the back-end in a Cloud Service.)</span></span>

<span data-ttu-id="3f7bd-233">Рабочей роли назначается имя по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-233">A default name is assigned to the worker role.</span></span> <span data-ttu-id="3f7bd-234">Чтобы изменить имя, наведите указатель мыши на рабочую роль на правой панели, а затем щелкните значок карандаша.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-234">To change the name, hover the mouse over the worker role in the right pane, then click the pencil icon.</span></span>

![](queue-centric-work-pattern/_static/image7.png)

<span data-ttu-id="3f7bd-235">Нажмите кнопку **ОК** , чтобы завершить диалог.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-235">Click **OK** to complete the dialog.</span></span> <span data-ttu-id="3f7bd-236">При этом в решение Visual Studio добавляются два проекта.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-236">This adds two projects to the Visual Studio solution.</span></span>

- <span data-ttu-id="3f7bd-237">проект Azure, который определяет облачную службу, включая сведения о конфигурации.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-237">an Azure project that defines the cloud service, including configuration information.</span></span>
- <span data-ttu-id="3f7bd-238">Проект рабочей роли, определяющий рабочую роль.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-238">A worker role project that defines the worker role.</span></span>

![](queue-centric-work-pattern/_static/image8.png)

<span data-ttu-id="3f7bd-239">Дополнительные сведения см. в статье [Создание проекта Azure с помощью Visual Studio.](https://msdn.microsoft.com/library/windowsazure/ee405487.aspx)</span><span class="sxs-lookup"><span data-stu-id="3f7bd-239">For more information, see [Creating an Azure Project with Visual Studio.](https://msdn.microsoft.com/library/windowsazure/ee405487.aspx)</span></span>

<span data-ttu-id="3f7bd-240">Внутри рабочей роли мы будем опрашивать сообщения, вызывая метод `ProcessMessageAsync` класса `FixItQueueManager`, который мы видели ранее.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-240">Inside the worker role, we poll for messages by calling the `ProcessMessageAsync` method of the `FixItQueueManager` class that we saw earlier.</span></span>

[!code-csharp[Main](queue-centric-work-pattern/samples/sample3.cs?highlight=25)]

<span data-ttu-id="3f7bd-241">Метод `ProcessMessagesAsync` проверяет, находится ли сообщение в состоянии ожидания.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-241">The `ProcessMessagesAsync` method checks if there's a message waiting.</span></span> <span data-ttu-id="3f7bd-242">Если таковой имеется, он десериализует сообщение в сущность `FixItTask` и сохраняет сущность в базе данных.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-242">If there is one, it deserializes the message into a `FixItTask` entity and saves the entity in the database.</span></span> <span data-ttu-id="3f7bd-243">Он проходит до тех пор, пока очередь не будет пустой.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-243">It loops until the queue is empty.</span></span>

[!code-csharp[Main](queue-centric-work-pattern/samples/sample4.cs)]

<span data-ttu-id="3f7bd-244">При опросе сообщений очереди возникает небольшая плата за транзакцию, поэтому при отсутствии сообщений, ожидающих обработки, метод `RunAsync` рабочей роли ожидает повторного опроса, вызывая `Task.Delay(1000)`.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-244">Polling for queue messages incurs a small transaction charge, so when there's no message waiting to be processed, the worker role's `RunAsync` method waits a second before polling again by calling `Task.Delay(1000)`.</span></span>

<span data-ttu-id="3f7bd-245">В веб-проекте Добавление асинхронного кода может автоматически повысить производительность, так как службы IIS управляют ограниченным пулом потоков.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-245">In a web project, adding asynchronous code can automatically improve performance because IIS manages a limited thread pool.</span></span> <span data-ttu-id="3f7bd-246">Это не так в проекте рабочей роли.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-246">That is not the case in a worker role project.</span></span> <span data-ttu-id="3f7bd-247">Чтобы повысить масштабируемость рабочей роли, можно написать многопоточный код или использовать асинхронный код для реализации [параллельного программирования](https://msdn.microsoft.com/library/ff963553.aspx).</span><span class="sxs-lookup"><span data-stu-id="3f7bd-247">To improve scalability of the worker role, you can write multi-threaded code or use asynchronous code to implement [parallel programming](https://msdn.microsoft.com/library/ff963553.aspx).</span></span> <span data-ttu-id="3f7bd-248">Пример не реализует параллельное программирование, но демонстрирует, как сделать код асинхронным, чтобы можно было реализовать параллельное программирование.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-248">The sample doesn't implement parallel programming but shows how to make the code asynchronous so you can implement parallel programming.</span></span>

## <a name="summary"></a><span data-ttu-id="3f7bd-249">Сводка</span><span class="sxs-lookup"><span data-stu-id="3f7bd-249">Summary</span></span>

<span data-ttu-id="3f7bd-250">В этой главе вы узнали, как улучшить скорость реагирования приложений, надежность и масштабируемость, реализовав рабочий шаблон, ориентированный на очередь.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-250">In this chapter you've seen how to improve application responsiveness, reliability, and scalability by implementing the queue-centric work pattern.</span></span>

<span data-ttu-id="3f7bd-251">Это последний из 13 шаблонов, рассмотренных в этой электронной книге, но существует множество других шаблонов и методик, которые могут помочь в создании успешных облачных приложений.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-251">This is the last of the 13 patterns covered in this e-book, but there are of course many other patterns and practices that can help you build successful cloud apps.</span></span> <span data-ttu-id="3f7bd-252">В [последней главе](more-patterns-and-guidance.md) содержатся ссылки на ресурсы для разделов, которые не были включены в эти 13 шаблонов.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-252">The [final chapter](more-patterns-and-guidance.md) provides links to resources for topics that haven't been covered in these 13 patterns.</span></span>

<a id="resources"></a>
## <a name="resources"></a><span data-ttu-id="3f7bd-253">Ресурсы</span><span class="sxs-lookup"><span data-stu-id="3f7bd-253">Resources</span></span>

<span data-ttu-id="3f7bd-254">Дополнительные сведения об очередях см. в следующих ресурсах.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-254">For more information about queues, see the following resources.</span></span>

<span data-ttu-id="3f7bd-255">Документация.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-255">Documentation:</span></span>

- <span data-ttu-id="3f7bd-256">[Служба хранилища Microsoft Azure очереди, часть 1: Начало работы](https://www.red-gate.com/simple-talk/cloud/platform-as-a-service/microsoft-azure-storage-queues-part-1-getting-started/).</span><span class="sxs-lookup"><span data-stu-id="3f7bd-256">[Microsoft Azure Storage Queues Part 1: Getting Started](https://www.red-gate.com/simple-talk/cloud/platform-as-a-service/microsoft-azure-storage-queues-part-1-getting-started/).</span></span> <span data-ttu-id="3f7bd-257">Статьи по римских Счачерл.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-257">Article by Roman Schacherl.</span></span>
- <span data-ttu-id="3f7bd-258">[Выполняя фоновые задачи](https://msdn.microsoft.com/library/ff803365.aspx), глава 5 [перемещения приложений в облако, третий выпуск](https://msdn.microsoft.com/library/ff728592.aspx) из шаблонов и практических рекомендаций Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-258">[Executing Background Tasks](https://msdn.microsoft.com/library/ff803365.aspx), chapter 5 of [Moving Applications to the Cloud, 3rd Edition](https://msdn.microsoft.com/library/ff728592.aspx) from Microsoft Patterns and Practices.</span></span> <span data-ttu-id="3f7bd-259">(В частности, раздел ["Использование очередей службы хранилища Azure"](https://msdn.microsoft.com/library/ff803365.aspx#sec7).)</span><span class="sxs-lookup"><span data-stu-id="3f7bd-259">(In particular, the section ["Using Azure Storage Queues"](https://msdn.microsoft.com/library/ff803365.aspx#sec7).)</span></span>
- <span data-ttu-id="3f7bd-260">Рекомендации [по максимальному увеличению масштабируемости и экономичности решений по обмену сообщениями на основе очередей в Azure](https://msdn.microsoft.com/library/windowsazure/hh697709.aspx).</span><span class="sxs-lookup"><span data-stu-id="3f7bd-260">[Best Practices for Maximizing Scalability and Cost Effectiveness of Queue-Based Messaging Solutions on Azure](https://msdn.microsoft.com/library/windowsazure/hh697709.aspx).</span></span> <span data-ttu-id="3f7bd-261">Технический документ, Valery Мизонов.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-261">White paper by Valery Mizonov.</span></span>
- <span data-ttu-id="3f7bd-262">[Сравнение очередей Azure и очередей служебной шины](https://msdn.microsoft.com/magazine/jj159884.aspx).</span><span class="sxs-lookup"><span data-stu-id="3f7bd-262">[Comparing Azure Queues and Service Bus Queues](https://msdn.microsoft.com/magazine/jj159884.aspx).</span></span> <span data-ttu-id="3f7bd-263">Статья журнала MSDN Magazine содержит дополнительные сведения, которые помогут выбрать используемую службу очередей.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-263">MSDN Magazine article, provides additional information that can help you choose which queue service to use.</span></span> <span data-ttu-id="3f7bd-264">В статье упоминается, что служебная шина зависит от службы ACS для проверки подлинности, что означает, что очереди SB будут недоступны, если служба ACS недоступна.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-264">The article mentions that Service Bus is dependent on ACS for authentication, which means your SB queues would be unavailable when ACS is unavailable.</span></span> <span data-ttu-id="3f7bd-265">Однако с момента написания статьи SB был изменен, чтобы вы использовали [маркеры SAS](https://msdn.microsoft.com/library/windowsazure/dn170477.aspx) в качестве АЛЬТЕРНАТИВы службам ACS.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-265">However, since the article was written, SB was changed to enable you to use [SAS tokens](https://msdn.microsoft.com/library/windowsazure/dn170477.aspx) as an alternative to ACS.</span></span>
- <span data-ttu-id="3f7bd-266">[Шаблоны и методики Майкрософт. Руководство по Azure](https://msdn.microsoft.com/library/dn568099.aspx).</span><span class="sxs-lookup"><span data-stu-id="3f7bd-266">[Microsoft Patterns and Practices - Azure Guidance](https://msdn.microsoft.com/library/dn568099.aspx).</span></span> <span data-ttu-id="3f7bd-267">См. Руководство по асинхронному обмену сообщениями, шаблону каналов и фильтров, шаблону компенсирующих транзакций, шаблону конкурирующих потребителей, шаблону CQRS.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-267">See Asynchronous Messaging primer, Pipes and Filters pattern, Compensating Transaction pattern, Competing Consumers pattern, CQRS pattern.</span></span>
- <span data-ttu-id="3f7bd-268">[Путешествие в CQRS](https://msdn.microsoft.com/library/jj554200).</span><span class="sxs-lookup"><span data-stu-id="3f7bd-268">[CQRS Journey](https://msdn.microsoft.com/library/jj554200).</span></span> <span data-ttu-id="3f7bd-269">Электронная книга, посвященная CQRS с помощью шаблонов и методик корпорации Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-269">E-book about CQRS by Microsoft Patterns and Practices.</span></span>

<span data-ttu-id="3f7bd-270">Видео:</span><span class="sxs-lookup"><span data-stu-id="3f7bd-270">Video:</span></span>

- <span data-ttu-id="3f7bd-271">[Отказоустойчивость: создание масштабируемых отказоустойчивых облачных служб](https://channel9.msdn.com/Series/FailSafe).</span><span class="sxs-lookup"><span data-stu-id="3f7bd-271">[FailSafe: Building Scalable, Resilient Cloud Services](https://channel9.msdn.com/Series/FailSafe).</span></span> <span data-ttu-id="3f7bd-272">Серия видео из девяти частей по Ульрих Хоманн, (Marc Меркури и пометить SIMM.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-272">Nine-part video series by Ulrich Homann, Marc Mercuri, and Mark Simms.</span></span> <span data-ttu-id="3f7bd-273">Предоставляет основные понятия и архитектурные принципы в очень удобном и интересном смысле, а также истории, полученные от работы группы консультирования клиентов Майкрософт (CAT) с реальными клиентами.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-273">Presents high-level concepts and architectural principles in a very accessible and interesting way, with stories drawn from Microsoft Customer Advisory Team (CAT) experience with actual customers.</span></span> <span data-ttu-id="3f7bd-274">Общие сведения о службе хранилища Azure и очередях см. в разделе Эпизод 5 начиная с 35:13.</span><span class="sxs-lookup"><span data-stu-id="3f7bd-274">For an introduction to the Azure Storage service and queues, see episode 5 starting at 35:13.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="3f7bd-275">[Назад](distributed-caching.md)
> [Вперед](more-patterns-and-guidance.md)</span><span class="sxs-lookup"><span data-stu-id="3f7bd-275">[Previous](distributed-caching.md)
[Next](more-patterns-and-guidance.md)</span></span>
