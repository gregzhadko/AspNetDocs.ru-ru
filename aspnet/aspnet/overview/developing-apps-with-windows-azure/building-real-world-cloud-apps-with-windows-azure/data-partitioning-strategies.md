---
uid: aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/data-partitioning-strategies
title: Стратегии секционирования данных (создание облачных приложений в реальном мире с помощью Azure) | Документация Майкрософт
author: MikeWasson
description: Создание реальных облачных приложений с помощью электронной книги Azure основано на презентации, разработанной Скотт Гатри (. В нем объясняются 13 шаблонов и методик, которые могут...
ms.author: riande
ms.date: 06/12/2014
ms.assetid: 513837a7-cfea-4568-a4e9-1f5901245d24
msc.legacyurl: /aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/data-partitioning-strategies
msc.type: authoredcontent
ms.openlocfilehash: efc3fa0255aa765e515412c5fa4098303a9d9234
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78500838"
---
# <a name="data-partitioning-strategies-building-real-world-cloud-apps-with-azure"></a>Стратегии секционирования данных (создание облачных приложений в реальном мире с помощью Azure)

[Майк Уоссон](https://github.com/MikeWasson), [Рик Андерсон (](https://twitter.com/RickAndMSFT), том [Dykstra)](https://github.com/tdykstra)

[Скачивание решения ИТ-проекта](https://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4) или [Загрузка электронной книги](https://blogs.msdn.com/b/microsoft_press/archive/2014/07/23/free-ebook-building-cloud-apps-with-microsoft-azure.aspx)

> **Создание реальных облачных приложений с помощью** электронной книги Azure основано на презентации, разработанной Скотт Гатри (. В нем объясняются 13 шаблонов и методик, которые могут помочь в успешной разработке веб-приложений для облака. Дополнительные сведения о ряде см. [в первой главе](introduction.md).

Ранее мы увидели, насколько просто масштабировать веб-уровень облачного приложения, добавляя и удаляя веб-серверы. Но если все они используют одно и то же хранилище данных, то узкое место вашего приложения перемещается из внешнего интерфейса в серверную часть, а уровень данных является самым сложным для масштабирования. В этой главе мы рассмотрим, как можно сделать масштабируемый уровень данных путем секционирования данных в несколько реляционных баз данных или путем объединения хранилища реляционной базы с другими вариантами хранения данных.

Настройка схемы секционирования лучше всего выполняется заранее по той же причине, о которой упоминалось ранее: в рабочей среде очень сложно изменить стратегию хранения данных. Если вы думаете о различных подходах, вы можете избежать возникновения проблем с "Twitter", когда приложение аварийно завершает работу или выходит из строя в течение длительного времени, одновременно реорганизуя данные приложения и код доступа к данным.

## <a name="the-three-vs-of-data-storage"></a>Три и более хранилища данных

Чтобы определить, нужна ли вам стратегия секционирования и что она должна быть, рассмотрите три вопроса о данных:

- Volume — какой объем данных будет храниться в конечном итоге? Несколько гигабайт? Пару сотен гигабайт? Терабайт? Петабайтов?
- Скорость — какова скорость роста данных? Это внутреннее приложение, которое не создает много данных? Внешнее приложение, в которое пользователи будут отправлять изображения и видео?
- Различные типы данных, которые будут храниться? Реляционные, изображения, пары "ключ-значение", социальные графики?

Если вы считаете, что собираетесь иметь большое количество громкости, скорости или множества, необходимо тщательно продумать, какой тип схемы секционирования наилучшим образом позволит вашему приложению масштабироваться эффективно и эффективно по мере роста, а также для того, чтобы не выполнять никаких узких мест.

Существует три основных подхода к секционированию:

- Вертикальное секционирование
- Горизонтальное секционирование
- Гибридное секционирование

## <a name="vertical-partitioning"></a>Вертикальное секционирование

Вертикальная часть представляет собой разделение таблицы по столбцам: один набор столбцов переходит в одно хранилище данных, а другой набор столбцов переходит в другое хранилище данных.

Например, пусть мое приложение хранит данные о людях, включая изображения:

![Таблица данных](data-partitioning-strategies/_static/image1.png)

Если данные представлены в виде таблицы и рассматривает различные данные, можно увидеть, что три столбца слева содержат строковые данные, которые могут быть эффективно сохранены реляционной базой данных, а два столбца справа — байтовые массивы в c OMe из файлов изображений. Вы можете хранить данные файла изображения в реляционной базе данных, и многие пользователи делают это, так как они не сохраняют данные в файловой системе. У них может не быть файловая система, способная хранить необходимые объемы данных, или может не потребоваться управлять отдельной системой резервного копирования и восстановления. Этот подход хорошо подходит для локальных баз данных и для небольших объемов данных в облачных базах данных. В локальной среде администратор базы данных может позаботиться обо всем.

Но в облачной базе данных хранилище является относительно дорогостоящим, и большое количество образов может привести к тому, что размер базы данных превысит пределы, с которой она может эффективно работать. Эти проблемы можно решить, разбейте данные по вертикали, что означает выбор наиболее подходящего хранилища данных для каждого столбца в таблице данных. Для этого примера лучше подходит разместить строковые данные в реляционной базе данных и изображениях в хранилище BLOB-объектов.

![Таблица данных вертикально секционирована](data-partitioning-strategies/_static/image2.png)

Хранение образов в хранилище BLOB-объектов вместо базы данных является более практичным в облаке, чем в локальной среде, поскольку вам не нужно беспокоиться о настройке файловых серверов или управлении резервным копированием и восстановлению данных, хранящихся за пределами реляционной базы данных: все Это автоматически обрабатывается службой хранилища BLOB-объектов.

Это подход к секционированию, реализованный в приложении Fix ИТ, и мы рассмотрим код для этого в [главе хранилище BLOB-объектов](unstructured-blob-storage.md). Без этой схемы секционирования и при условии, что средний размер изображения равен 3 мегабайтам, приложение для устранения проблем сможет хранить около 40 000 задач до достижения максимального размера базы данных 150 гигабайт. После удаления образов база данных может хранить в 10 раз столько задач, сколько. до того, как придется думать о реализации горизонтальной схемы секционирования, можно пойти намного дольше. При масштабировании приложения ваши расходы увеличиваются более медленно, так как основная часть потребностей в хранении в хранилище больших двоичных объектов будет очень недорогой.

## <a name="horizontal-partitioning-sharding"></a>Горизонтальное секционирование (сегментирование)

Горизонтальное разделение аналогично разделению строк на строки: один набор строк переходит в одно хранилище данных, а другой набор строк переходит в другое хранилище данных.

При наличии одного и того же набора данных другой вариант заключается в хранении различных диапазонов имен клиентов в разных базах данных.

![Таблица данных по горизонтали секционирована](data-partitioning-strategies/_static/image3.png)

Вы должны быть очень осторожными со схемой сегментирования, чтобы обеспечить равномерное распределение данных, чтобы избежать горячего расположения. Этот простой пример, использующий первую букву фамилии, не соответствует этому требованию, так как многие люди имеют фамилии, начинающиеся с некоторых часто встречающихся букв. Вы можете столкнуться с ограничениями размера таблицы раньше, чем можно ожидать, так как некоторые базы данных будут очень большими, хотя большинство из них останется небольшими.

Некоторая сторона горизонтального секционирования заключается в том, что может быть трудно выполнять запросы по всем данным. В этом примере запрос должен нарисоваться от до 26 разных баз данных, чтобы получить все данные, хранящиеся в приложении.

## <a name="hybrid-partitioning"></a>Гибридное секционирование

Можно сочетать вертикальное и горизонтальное секционирование. Например, в примерах данных можно хранить изображения в хранилище BLOB-объектов и горизонтально секционировать строковые данные.

![Гибридная секционированная таблица данных](data-partitioning-strategies/_static/image4.png)

## <a name="partitioning-a-production-application"></a>Секционирование рабочего приложения

По сути, проще понять, как работает схема секционирования, но любая схема секционирования увеличивает сложность кода и предоставляет множество новых осложнений, с которыми необходимо работать. Если вы перемещаете образы в хранилище BLOB-объектов, что делать, если служба хранилища не работает? Как вы управляете безопасностью BLOB-объектов? Что произойдет, если база данных и хранилище BLOB-объектов не синхронизированы? Если вы создаете сегментирование, как будет работать запрос для всех баз данных?

Сложности могут быть управляемыми до тех пор, пока вы планируете их перед переходом к рабочей среде. Многие люди, которые не сделали этого, потребовались позже. В среднем группа специалистов по консультированию клиентов получает паниккед телефонные звонки примерно раз в месяц от клиентов, чьи приложения отключаются на самом деле, и они не выполнили это планирование. И говорят примерно так: «Help! Я помещаю все в одно хранилище данных, и в течение 45 дней я запусту место на диске! " Если у вас есть много бизнес-логики, которая встроена в доступ к хранилищу данных и у вас есть клиенты, использующие ваше приложение, нет хорошего времени для перехода на несколько дней. В итоге мы что усилия, чтобы помочь клиенту секционировать свои данные на лету без простоев. Это очень интересная и очень страшное, но не то, что вы хотите, если можете избежать этого! Подумаем об этом на передний план и интегрируя его в ваше приложение, вы сделаете свою жизнь гораздо проще, если приложение растет позже.

## <a name="summary"></a>Сводка

Эффективная схема секционирования может позволить облачному приложению масштабироваться до петабайтов данных в облаке без узких мест. И вам не нужно платить за большие компьютеры или обширную инфраструктуру, как если бы вы работали с приложением в локальном центре обработки данных. В облаке можно постепенно добавить необходимую емкость, и вы платите только за те ресурсы, которые вы используете при ее использовании.

В [следующей главе](unstructured-blob-storage.md) мы посмотрим, как приложение Fix ИТ реализует вертикальное секционирование путем хранения образов в хранилище BLOB-объектов.

## <a name="resources"></a>Ресурсы

Дополнительные сведения о стратегиях секционирования см. в следующих ресурсах.

Документация.

- Рекомендации [по проектированию крупномасштабных служб в облачных службах Windows Azure](https://msdn.microsoft.com/library/windowsazure/jj717232.aspx). Технический документ, пометив SIMM и Майкл Сомасси.
- [Шаблоны и методики Майкрософт — шаблоны проектирования в облаке](https://msdn.microsoft.com/library/dn568099.aspx). См. Руководство по секционированию данных, шаблон сегментирования.

Видеоролики:

- [Отказоустойчивость: создание масштабируемых отказоустойчивых облачных служб](https://channel9.msdn.com/Series/FailSafe). Серия из девяти частей, Ульрих Хоманн, (Marc Меркури и пометить SIMM. Предоставляет основные понятия и архитектурные принципы в очень удобном и интересном смысле, а также истории, полученные от работы группы консультирования клиентов Майкрософт (CAT) с реальными клиентами. См. обсуждение секционирования в серии 7.
- [Создание больших: уроки, полученные от клиентов Windows Azure, часть I](https://channel9.msdn.com/Events/Build/2012/3-029). Марк SIMM обсуждает схемы секционирования, стратегии сегментирования, способы реализации сегментирования и Федерации баз данных SQL, начиная с 19:49. Как и в случае с отказоустойчивостью, вы переходите к дополнительным сведениям.

Пример кода:

- [Основы облачных служб в Windows Azure](https://code.msdn.microsoft.com/Cloud-Service-Fundamentals-4ca72649). Пример приложения, включающий сегментированную базу данных. Описание примененной схемы сегментирования см. в разделе [DAL — сегментирование РСУБД](https://blogs.msdn.com/b/windowsazure/archive/2013/09/05/dal-sharding-of-rdbms.aspx) в блоге Windows Azure.

> [!div class="step-by-step"]
> [Назад](data-storage-options.md)
> [Вперед](unstructured-blob-storage.md)
