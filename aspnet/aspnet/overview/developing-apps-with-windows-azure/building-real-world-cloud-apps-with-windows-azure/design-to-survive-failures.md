---
uid: aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/design-to-survive-failures
title: Проектирование для устойчивых сбоев (создание облачных приложений в реальном мире с помощью Azure) | Документация Майкрософт
author: MikeWasson
description: Создание реальных облачных приложений с помощью электронной книги Azure основано на презентации, разработанной Скотт Гатри (. В нем объясняются 13 шаблонов и методик, которые могут...
ms.author: riande
ms.date: 06/12/2014
ms.assetid: 364ce84e-5af8-4e08-afc9-75a512b01f84
msc.legacyurl: /aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/design-to-survive-failures
msc.type: authoredcontent
ms.openlocfilehash: 9bf9acb8b4f8521d03c053c124c5fc4a07d6cb9a
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/28/2019
ms.locfileid: "74585656"
---
# <a name="design-to-survive-failures-building-real-world-cloud-apps-with-azure"></a><span data-ttu-id="3f29d-104">Разработка для устойчивых сбоев (создание облачных приложений в реальном мире с помощью Azure)</span><span class="sxs-lookup"><span data-stu-id="3f29d-104">Design to Survive Failures (Building Real-World Cloud Apps with Azure)</span></span>

<span data-ttu-id="3f29d-105">[Майк Уоссон](https://github.com/MikeWasson), [Рик Андерсон (]((https://twitter.com/RickAndMSFT)), том [Dykstra)](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="3f29d-105">by [Mike Wasson](https://github.com/MikeWasson), [Rick Anderson]((https://twitter.com/RickAndMSFT)), [Tom Dykstra](https://github.com/tdykstra)</span></span>

<span data-ttu-id="3f29d-106">[Скачивание решения ИТ-проекта](https://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4) или [Загрузка электронной книги](https://blogs.msdn.com/b/microsoft_press/archive/2014/07/23/free-ebook-building-cloud-apps-with-microsoft-azure.aspx)</span><span class="sxs-lookup"><span data-stu-id="3f29d-106">[Download Fix It Project](https://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4) or [Download E-book](https://blogs.msdn.com/b/microsoft_press/archive/2014/07/23/free-ebook-building-cloud-apps-with-microsoft-azure.aspx)</span></span>

> <span data-ttu-id="3f29d-107">**Создание реальных облачных приложений с помощью** электронной книги Azure основано на презентации, разработанной Скотт Гатри (.</span><span class="sxs-lookup"><span data-stu-id="3f29d-107">The **Building Real World Cloud Apps with Azure** e-book is based on a presentation developed by Scott Guthrie.</span></span> <span data-ttu-id="3f29d-108">В нем объясняются 13 шаблонов и методик, которые могут помочь в успешной разработке веб-приложений для облака.</span><span class="sxs-lookup"><span data-stu-id="3f29d-108">It explains 13 patterns and practices that can help you be successful developing web apps for the cloud.</span></span> <span data-ttu-id="3f29d-109">Сведения о электронной книге см. [в первой главе](introduction.md).</span><span class="sxs-lookup"><span data-stu-id="3f29d-109">For information about the e-book, see [the first chapter](introduction.md).</span></span>

<span data-ttu-id="3f29d-110">Одно из моментов, о которых необходимо подумать при создании приложения любого типа, но особенно те, которые будут работать в облаке, где его используют многие пользователи, — это создание приложения, позволяющее корректно обрабатывать сбои и продолжать доставлять ценность настолько, насколько позволяет.</span><span class="sxs-lookup"><span data-stu-id="3f29d-110">One of the things you have to think about when you build any type of application, but especially one that will run in the cloud where lots of people will be using it, is how to design the app so that it can gracefully handle failures and continue to deliver value as much as possible.</span></span> <span data-ttu-id="3f29d-111">Учитывая достаточное время, вещи в любой среде или в любой системе программного обеспечения будут неправильными.</span><span class="sxs-lookup"><span data-stu-id="3f29d-111">Given enough time, things are going to go wrong in any environment or any software system.</span></span> <span data-ttu-id="3f29d-112">Как ваше приложение обрабатывает эти ситуации, определяет, как обеспокоен ваши клиенты и сколько времени нужно потратить на анализ и устранение проблем.</span><span class="sxs-lookup"><span data-stu-id="3f29d-112">How your app handles those situations determines how upset your customers will get and how much time you have to spend analyzing and fixing problems.</span></span>

## <a name="types-of-failures"></a><span data-ttu-id="3f29d-113">Типы сбоев</span><span class="sxs-lookup"><span data-stu-id="3f29d-113">Types of failures</span></span>

<span data-ttu-id="3f29d-114">Существует две основные категории сбоев, которые нужно обменять по-разному:</span><span class="sxs-lookup"><span data-stu-id="3f29d-114">There are two basic categories of failures that you'll want to handle differently:</span></span>

- <span data-ttu-id="3f29d-115">Временные ошибки самовосстановления, такие как временные неполадки с сетевым подключением.</span><span class="sxs-lookup"><span data-stu-id="3f29d-115">Transient, self-healing failures such as intermittent network connectivity issues.</span></span>
- <span data-ttu-id="3f29d-116">Долгоживущий сбои, требующие вмешательства.</span><span class="sxs-lookup"><span data-stu-id="3f29d-116">Enduring failures that require intervention.</span></span>

<span data-ttu-id="3f29d-117">Для временных сбоев можно реализовать политику повтора, чтобы обеспечить большую часть времени, которое приложение восстанавливает быстро и автоматически.</span><span class="sxs-lookup"><span data-stu-id="3f29d-117">For transient failures, you can implement a retry policy to ensure that most of the time the app recovers quickly and automatically.</span></span> <span data-ttu-id="3f29d-118">Клиенты могут заметить немного больше времени отклика, но в противном случае они не будут затронуты.</span><span class="sxs-lookup"><span data-stu-id="3f29d-118">Your customers might notice slightly longer response time, but otherwise they won't be affected.</span></span> <span data-ttu-id="3f29d-119">Мы покажем некоторые способы обработки этих ошибок в [главе обработка временной ошибки](transient-fault-handling.md).</span><span class="sxs-lookup"><span data-stu-id="3f29d-119">We'll show some ways to handle these errors in the [Transient Fault Handling chapter](transient-fault-handling.md).</span></span>

<span data-ttu-id="3f29d-120">Для сбоев долгоживущий можно реализовать функции мониторинга и ведения журнала, которые немедленно уведомляют пользователя о возникновении проблем и способствуют анализу основных причин.</span><span class="sxs-lookup"><span data-stu-id="3f29d-120">For enduring failures, you can implement monitoring and logging functionality that notifies you promptly when issues arise and that facilitates root cause analysis.</span></span> <span data-ttu-id="3f29d-121">Мы покажем некоторые способы, которые помогут вам остаться в курсе ошибок этих типов в [главе мониторинг и телеметрии](monitoring-and-telemetry.md).</span><span class="sxs-lookup"><span data-stu-id="3f29d-121">We'll show some ways to help you stay on top of these kinds of errors in the [Monitoring and Telemetry chapter](monitoring-and-telemetry.md).</span></span>

## <a name="failure-scope"></a><span data-ttu-id="3f29d-122">Область сбоя</span><span class="sxs-lookup"><span data-stu-id="3f29d-122">Failure scope</span></span>

<span data-ttu-id="3f29d-123">Кроме того, необходимо подумать о области сбоя — независимо от того, затрагивается ли одна машина — вся служба, например база данных SQL или хранилище, или весь регион.</span><span class="sxs-lookup"><span data-stu-id="3f29d-123">You also have to think about failure scope – whether a single machine is affected, a whole service such as SQL Database or Storage, or an entire region.</span></span>

![Область сбоя](design-to-survive-failures/_static/image1.png)

### <a name="machine-failures"></a><span data-ttu-id="3f29d-125">Сбои компьютеров</span><span class="sxs-lookup"><span data-stu-id="3f29d-125">Machine failures</span></span>

<span data-ttu-id="3f29d-126">В Azure сервер, на котором произошел сбой, автоматически заменяется новым, и хорошо спроектированное облачное приложение автоматически восстанавливается из этого типа сбоя.</span><span class="sxs-lookup"><span data-stu-id="3f29d-126">In Azure, a failed server is automatically replaced by a new one, and a well-designed cloud app recovers from this kind of failure automatically and quickly.</span></span> <span data-ttu-id="3f29d-127">Ранее мы превышены преимущества масштабируемости веб-уровня без отслеживания состояния, и простота восстановления с неисправного сервера является еще одним преимуществом стателесснесс.</span><span class="sxs-lookup"><span data-stu-id="3f29d-127">Earlier we stressed the scalability benefits of a stateless web tier, and ease of recovery from a failed server is another benefit of statelessness.</span></span> <span data-ttu-id="3f29d-128">Простота восстановления является также одним из преимуществ функций платформы как услуги (PaaS), таких как база данных SQL и веб-приложения службы приложений Azure.</span><span class="sxs-lookup"><span data-stu-id="3f29d-128">Ease of recovery is also one of the benefits of platform-as-a-service (PaaS) features such as SQL Database and Azure App Service Web Apps.</span></span> <span data-ttu-id="3f29d-129">Аппаратные сбои происходят редко, но, когда они происходят, эти службы обрабатывают их автоматически. Вам даже не придется писать код для выполнения сбоев компьютеров, если вы используете одну из этих служб.</span><span class="sxs-lookup"><span data-stu-id="3f29d-129">Hardware failures are rare, but when they occur these services handle them automatically; you don't even have to write code to handle machine failures when you're using one of these services.</span></span>

### <a name="service-failures"></a><span data-ttu-id="3f29d-130">Сбои службы</span><span class="sxs-lookup"><span data-stu-id="3f29d-130">Service failures</span></span>

<span data-ttu-id="3f29d-131">В облачных приложениях обычно используется несколько служб.</span><span class="sxs-lookup"><span data-stu-id="3f29d-131">Cloud apps typically use multiple services.</span></span> <span data-ttu-id="3f29d-132">Например, приложение для устранения проблем использует службу базы данных SQL, службу хранилища, а веб-приложение развертывается в службе приложений Azure.</span><span class="sxs-lookup"><span data-stu-id="3f29d-132">For example, the Fix It app uses the SQL Database service, the Storage service, and the web app is deployed to Azure App Service.</span></span> <span data-ttu-id="3f29d-133">Что будет делать ваше приложение, если происходит сбой одной из служб, от которых вы зависите?</span><span class="sxs-lookup"><span data-stu-id="3f29d-133">What will your app do if one of the services you depend on fails?</span></span> <span data-ttu-id="3f29d-134">Для некоторых сбоев служб может оказаться, что вы можете получить более удобное сообщение.</span><span class="sxs-lookup"><span data-stu-id="3f29d-134">For some service failures a friendly "sorry, try again later" message might be the best you can do.</span></span> <span data-ttu-id="3f29d-135">Но во многих сценариях это можно сделать лучше.</span><span class="sxs-lookup"><span data-stu-id="3f29d-135">But in many scenarios you can do better.</span></span> <span data-ttu-id="3f29d-136">Например, если серверное хранилище данных не работает, можно принять входные данные пользователя, отобразить "ваш запрос получен" и сохранить вход в другом месте. Затем, когда нужная служба работает снова, вы можете получить входные данные и обработать ее.</span><span class="sxs-lookup"><span data-stu-id="3f29d-136">For example, when your back-end data store is down, you can accept user input, display "your request has been received," and store the input someplace else temporarily; then when the service you need is operational again, you can retrieve the input and process it.</span></span>

<span data-ttu-id="3f29d-137">В главе « [рабочий шаблон, ориентированной на очередь](queue-centric-work-pattern.md) » показан один из способов обработки этого сценария.</span><span class="sxs-lookup"><span data-stu-id="3f29d-137">The [Queue-centric Work Pattern](queue-centric-work-pattern.md) chapter shows one way to handle this scenario.</span></span> <span data-ttu-id="3f29d-138">Приложение Fix ИТ сохраняет задачи в базе данных SQL, но не нужно выходить из нее, когда база данных SQL не работает.</span><span class="sxs-lookup"><span data-stu-id="3f29d-138">The Fix It app stores tasks in SQL Database, but it doesn't have to quit working when SQL Database is down.</span></span> <span data-ttu-id="3f29d-139">В этой главе будет показано, как хранить ввод пользователя для задачи в очереди и использовать рабочий процесс для чтения очереди и обновления задачи.</span><span class="sxs-lookup"><span data-stu-id="3f29d-139">In that chapter we'll see how to store user input for a task in a queue, and use a worker process to read the queue and update the task.</span></span> <span data-ttu-id="3f29d-140">Если SQL не работает, возможность создания решения для ИТ-задач не затрагивается. Рабочий процесс может ожидать и обрабатывать новые задачи, если база данных SQL доступна.</span><span class="sxs-lookup"><span data-stu-id="3f29d-140">If SQL is down, the ability to create Fix It tasks is unaffected; the worker process can wait and process new tasks when SQL Database is available.</span></span>

### <a name="region-failures"></a><span data-ttu-id="3f29d-141">Сбои в регионах</span><span class="sxs-lookup"><span data-stu-id="3f29d-141">Region failures</span></span>

<span data-ttu-id="3f29d-142">Все регионы могут завершиться ошибкой.</span><span class="sxs-lookup"><span data-stu-id="3f29d-142">Entire regions may fail.</span></span> <span data-ttu-id="3f29d-143">Естественная авария может привести к удалению центра обработки данных, он может быть сведен к Meteor, а линия магистрали в центр обработки может быть вырезана Фармер буринг a Cow с экскаватора и т. д. Что делать, если приложение размещено в центре обработки данных стриккен?</span><span class="sxs-lookup"><span data-stu-id="3f29d-143">A natural disaster might destroy a data center, it might get flattened by a meteor, the trunk line into the datacenter could be cut by a farmer burying a cow with a backhoe, etc. If your app is hosted in the stricken datacenter what do you do?</span></span> <span data-ttu-id="3f29d-144">Можно настроить приложение в Azure для одновременного запуска в нескольких регионах, чтобы при наличии аварии в одном из других регионов продолжить выполнение в другом регионе.</span><span class="sxs-lookup"><span data-stu-id="3f29d-144">It's possible to set up your app in Azure to run in multiple regions simultaneously so that if there's a disaster in one, you continue running in another region.</span></span> <span data-ttu-id="3f29d-145">Такие сбои очень редки, и большинство приложений не переходят через препятствий, необходимое для обеспечения бесперебойной работы службы при сбоях этой сортировки.</span><span class="sxs-lookup"><span data-stu-id="3f29d-145">Such failures are extremely rare occurrences, and most apps don't jump through the hoops necessary to ensure uninterrupted service through failures of this sort.</span></span> <span data-ttu-id="3f29d-146">Сведения о том, как сделать приложение доступным даже при сбое региона, см. в разделе ресурсы в конце главы.</span><span class="sxs-lookup"><span data-stu-id="3f29d-146">See the Resources section at the end of the chapter for information about how to keep your app available even through a region failure.</span></span>

<span data-ttu-id="3f29d-147">Цель Azure состоит в том, чтобы значительно упростить обработку всех этих видов сбоев, и вы увидите несколько примеров того, как мы делаем это в следующих главах.</span><span class="sxs-lookup"><span data-stu-id="3f29d-147">A goal of Azure is to make handling all of these kinds of failures a lot easier, and you'll see some examples of how we're doing that in the following chapters.</span></span>

## <a name="slas"></a><span data-ttu-id="3f29d-148">Обслуживания</span><span class="sxs-lookup"><span data-stu-id="3f29d-148">SLAs</span></span>

<span data-ttu-id="3f29d-149">Люди часто слышит соглашения об уровне обслуживания в облачной среде.</span><span class="sxs-lookup"><span data-stu-id="3f29d-149">People often hear about service-level agreements (SLAs) in the cloud environment.</span></span> <span data-ttu-id="3f29d-150">По сути, это обещает, что компании делают то, насколько надежна их служба.</span><span class="sxs-lookup"><span data-stu-id="3f29d-150">Basically these are promises that companies make about how reliable their service is.</span></span> <span data-ttu-id="3f29d-151">Соглашение об уровне обслуживания, равное 99,9%, означает, что служба должна работать правильно 99,9% времени.</span><span class="sxs-lookup"><span data-stu-id="3f29d-151">A 99.9% SLA means you should expect the service to be working correctly 99.9% of the time.</span></span> <span data-ttu-id="3f29d-152">Это довольно типичное значение для соглашения об уровне обслуживания, которое кажется очень большим, но вы можете не осознать, сколько времени составляет 0,1% на самом деле.</span><span class="sxs-lookup"><span data-stu-id="3f29d-152">That's a fairly typical value for an SLA and it sounds like a very high number, but you might not realize how much down time .1% actually amounts to.</span></span> <span data-ttu-id="3f29d-153">Ниже приведена таблица, на которой показано, сколько времени простоя в процентах от общего количества для соглашения об уровне обслуживания в течение года, месяца и недели.</span><span class="sxs-lookup"><span data-stu-id="3f29d-153">Here's a table that shows how much downtime various SLA percentages amount to over a year, a month, and a week.</span></span>

![Таблица SLA](design-to-survive-failures/_static/image2.png)

<span data-ttu-id="3f29d-155">Таким образом, соглашение об уровне обслуживания 99,9% означает, что ваша служба может быть отключена 8,76 часа в год или 43,2 минут в месяц.</span><span class="sxs-lookup"><span data-stu-id="3f29d-155">So a 99.9% SLA means your service could be down 8.76 hours a year or 43.2 minutes a month.</span></span> <span data-ttu-id="3f29d-156">Это более длительное время, чем большинство людей понимают.</span><span class="sxs-lookup"><span data-stu-id="3f29d-156">That's more down time than most people realize.</span></span> <span data-ttu-id="3f29d-157">Таким образом, разработчику необходимо знать, что может быть некоторое время простоя и правильно обрабатывать его.</span><span class="sxs-lookup"><span data-stu-id="3f29d-157">So as a developer you want to be aware that a certain amount of down time is possible and handle it in a graceful way.</span></span> <span data-ttu-id="3f29d-158">В какой-то момент пользователь будет использовать ваше приложение, и служба будет недоступна и вы хотите уменьшить негативное влияние на клиента.</span><span class="sxs-lookup"><span data-stu-id="3f29d-158">At some point someone is going to be using your app, and a service is going to be down, and you want to minimize the negative impact of that on the customer.</span></span>

<span data-ttu-id="3f29d-159">Необходимо узнать о соглашении об уровне обслуживания, на которое он ссылается. часы сбрасываются каждую неделю, каждый месяц или каждый год?</span><span class="sxs-lookup"><span data-stu-id="3f29d-159">One thing you should know about an SLA is what time-frame it refers to: does the clock get reset every week, every month, or every year?</span></span> <span data-ttu-id="3f29d-160">В Azure мы сбрасывать часы каждый месяц, что лучше, чем ежегодное соглашение об уровне обслуживания, так как ежегодное соглашение об уровне обслуживания может скрыть неправильные месяцы, изменив их на ряд хороших месяцев.</span><span class="sxs-lookup"><span data-stu-id="3f29d-160">In Azure we reset the clock every month, which is better for you than a yearly SLA, since a yearly SLA could hide bad months by offsetting them with a series of good months.</span></span>

<span data-ttu-id="3f29d-161">Конечно, мы всегда стремитесь, что это лучше, чем соглашение об уровне обслуживания. Обычно это будет намного меньше.</span><span class="sxs-lookup"><span data-stu-id="3f29d-161">Of course we always aspire to do better than the SLA; usually you'll be down much less than that.</span></span> <span data-ttu-id="3f29d-162">Обещание состоит в том, что, если сейчас у нас больше времени, чем максимальное время простоя, вы можете запросить деньги.</span><span class="sxs-lookup"><span data-stu-id="3f29d-162">The promise is that if we're ever down for longer than the maximum down time you can ask for money back.</span></span> <span data-ttu-id="3f29d-163">Объем денег, который вы получаете, вероятно, не будет полностью компенсировать влияние на бизнес влияния чрезмерного времени, но этот аспект соглашения об уровне обслуживания действует как политика принудительного применения, и вы узнаете о том, что мы очень серьезно выберем.</span><span class="sxs-lookup"><span data-stu-id="3f29d-163">The amount of money you get back probably wouldn't fully compensate you for the business impact of the excess down time, but that aspect of the SLA acts as an enforcement policy and lets you know that we do take it very seriously.</span></span>

### <a name="composite-slas"></a><span data-ttu-id="3f29d-164">Составные соглашения об уровне обслуживания</span><span class="sxs-lookup"><span data-stu-id="3f29d-164">Composite SLAs</span></span>

<span data-ttu-id="3f29d-165">Важно помнить, что при просмотре соглашения об уровне обслуживания — это влияние использования нескольких служб в приложении, при этом каждая служба имеет отдельное соглашение об уровне обслуживания.</span><span class="sxs-lookup"><span data-stu-id="3f29d-165">An important thing to think about when you're looking at SLAs is the impact of using multiple services in an app, with each service having a separate SLA.</span></span> <span data-ttu-id="3f29d-166">Например, приложение для устранения проблем использует веб-приложения службы приложений Azure, службу хранилища Azure и базу данных SQL.</span><span class="sxs-lookup"><span data-stu-id="3f29d-166">For example, the Fix It app uses Azure App Service Web Apps, Azure Storage, and SQL Database.</span></span> <span data-ttu-id="3f29d-167">Ниже приведены номера соглашений об уровне обслуживания на момент написания этой электронной книги в декабре 2013:</span><span class="sxs-lookup"><span data-stu-id="3f29d-167">Here are their SLA numbers as of the date this e-book is being written in December, 2013:</span></span>

![Веб-узел SLA, хранилище, база данных SQL](design-to-survive-failures/_static/image3.png)

<span data-ttu-id="3f29d-169">Каково максимальное время ожидания для приложения на основе этих соглашений об уровне обслуживания?</span><span class="sxs-lookup"><span data-stu-id="3f29d-169">What is the maximum down time you would expect for the app based on these service SLAs?</span></span> <span data-ttu-id="3f29d-170">Вы можете подумать, что время простоя будет равно наихудшему проценту соглашения об уровне обслуживания или 99,9% в данном случае.</span><span class="sxs-lookup"><span data-stu-id="3f29d-170">You might think that your down time would be equal to the worst SLA percentage, or 99.9% in this case.</span></span> <span data-ttu-id="3f29d-171">Это было бы верно, если все три службы всегда завершились сбоем одновременно, но это не обязательно происходит.</span><span class="sxs-lookup"><span data-stu-id="3f29d-171">That would be true if all three services always failed at the same time, but that isn't necessarily what actually happens.</span></span> <span data-ttu-id="3f29d-172">Каждая служба может завершаться сбоем независимо в разное время, поэтому необходимо вычислить составное соглашение об уровне обслуживания, умножив отдельные номера SLA.</span><span class="sxs-lookup"><span data-stu-id="3f29d-172">Each service may fail independently at different times, so you have to calculate the composite SLA by multiplying the individual SLA numbers.</span></span>

![Составное соглашение об уровне обслуживания](design-to-survive-failures/_static/image4.png)

<span data-ttu-id="3f29d-174">Так что ваше приложение может быть не только 43,2 минут в месяц, но в 3 раза больше, чем 108 минут в месяц, и по-прежнему находиться в пределах ограничений соглашения об уровне обслуживания Azure.</span><span class="sxs-lookup"><span data-stu-id="3f29d-174">So your app could be down not just 43.2 minutes a month but 3 times that amount, 108 minutes a month – and still be within the Azure SLA limits.</span></span>

<span data-ttu-id="3f29d-175">Эта проблема не является уникальной для Azure.</span><span class="sxs-lookup"><span data-stu-id="3f29d-175">This issue is not unique to Azure.</span></span> <span data-ttu-id="3f29d-176">Мы предоставляем оптимальное облачное соглашение об уровне обслуживания для любой доступной облачной службы, и у вас возникнут аналогичные проблемы, связанные с использованием облачных служб любого поставщика.</span><span class="sxs-lookup"><span data-stu-id="3f29d-176">We actually provide the best cloud SLAs of any cloud service available, and you'll have similar issues to deal with if you use any vendor's cloud services.</span></span> <span data-ttu-id="3f29d-177">В этой статье важно подумать о том, как можно спроектировать приложение для корректной работы неизбежных сбоев службы, так как они могут быть достаточно часто, чтобы повлиять на клиентов или пользователей.</span><span class="sxs-lookup"><span data-stu-id="3f29d-177">What this highlights is the importance of thinking about how you can design your app to handle the inevitable service failures gracefully, because they might happen often enough to impact your customers or users.</span></span>

### <a name="cloud-slas-compared-to-enterprise-down-time-experience"></a><span data-ttu-id="3f29d-178">Облачные соглашения об уровне обслуживания по сравнению с корпоративным временем работы</span><span class="sxs-lookup"><span data-stu-id="3f29d-178">Cloud SLAs compared to enterprise down-time experience</span></span>

<span data-ttu-id="3f29d-179">Иногда люди говорят: «в моем корпоративном приложении у меня нет этих проблем».</span><span class="sxs-lookup"><span data-stu-id="3f29d-179">People sometimes say, "In my enterprise app I never have these problems."</span></span> <span data-ttu-id="3f29d-180">Если вы задаете, сколько времени на самом деле у них есть, они, как правило, говорят, что это случается иногда.</span><span class="sxs-lookup"><span data-stu-id="3f29d-180">If you ask how much down time a month they actually have, they usually say, "Well, it happens occasionally."</span></span> <span data-ttu-id="3f29d-181">И, если спросить, как часто, они признают, что иногда требуется резервное копирование или установка нового сервера или обновления программного обеспечения ".</span><span class="sxs-lookup"><span data-stu-id="3f29d-181">And if you ask how often, they admit that "Sometimes we do need to back up or install a new server or update software."</span></span> <span data-ttu-id="3f29d-182">Конечно, это учитывается как время простоя.</span><span class="sxs-lookup"><span data-stu-id="3f29d-182">Of course, that counts as down time.</span></span> <span data-ttu-id="3f29d-183">Большинство корпоративных приложений, если они не являются особенно важными, на самом деле не работают в течение более чем времени, допускаемого соглашениями об уровне обслуживания.</span><span class="sxs-lookup"><span data-stu-id="3f29d-183">Most enterprise apps unless they are especially mission-critical are actually down for more than the amount of time allowed by our service SLAs.</span></span> <span data-ttu-id="3f29d-184">Но когда это ваш сервер и инфраструктура, и вы несете ответственность за ИТ и контролируете ее, вы, скорее всего, волненийе меньше времени.</span><span class="sxs-lookup"><span data-stu-id="3f29d-184">But when it's your server and your infrastructure and you're responsible for it and in control of it, you tend to feel less angst about down times.</span></span> <span data-ttu-id="3f29d-185">В облачной среде вы зависят от кого-то другого и не знаете, что происходит.</span><span class="sxs-lookup"><span data-stu-id="3f29d-185">In a cloud environment you're dependent on someone else and you don't know what's going on, so you might tend to get more worried about it.</span></span>

<span data-ttu-id="3f29d-186">Когда предприятие достигает более высокого процента времени, чем вы получаете в рамках соглашения об уровне обслуживания для облака, он выполняет гораздо больше денег на оборудование.</span><span class="sxs-lookup"><span data-stu-id="3f29d-186">When an enterprise achieves a greater up-time percentage than you get from a cloud SLA, they do it by spending a lot more money on hardware.</span></span> <span data-ttu-id="3f29d-187">Облачная служба может сделать это, но при этом придется взимать множество дополнительных услуг.</span><span class="sxs-lookup"><span data-stu-id="3f29d-187">A cloud service could do that but would have to charge much more for its services.</span></span> <span data-ttu-id="3f29d-188">Вместо этого вы получаете экономичную службу и разрабатываете программное обеспечение, чтобы неизбежные сбои приводили к минимальному перерыву в работе клиентов.</span><span class="sxs-lookup"><span data-stu-id="3f29d-188">Instead, you take advantage of a cost-effective service and design your software so that the inevitable failures cause minimum disruption to your customers.</span></span> <span data-ttu-id="3f29d-189">Ваше задание в качестве конструктора облачных приложений не настолько много, чтобы избежать сбоев, так как это не катастрофы, и это можно сделать, если сосредоточиться на программном обеспечении, а не на оборудовании.</span><span class="sxs-lookup"><span data-stu-id="3f29d-189">Your job as a cloud app designer is not so much to avoid failure as to avoid catastrophe, and you do that by focusing on software, not on hardware.</span></span> <span data-ttu-id="3f29d-190">В то время как корпоративные приложения стремятся к максимальному среднему времени между сбоями, облачные приложения стремятся к минимальному среднему времени для восстановления.</span><span class="sxs-lookup"><span data-stu-id="3f29d-190">Whereas enterprise apps strive to maximize mean time between failures, cloud apps strive to minimize mean time to recover.</span></span>

### <a name="not-all-cloud-services-have-slas"></a><span data-ttu-id="3f29d-191">Не все облачные службы имеют соглашение об уровне обслуживания</span><span class="sxs-lookup"><span data-stu-id="3f29d-191">Not all cloud services have SLAs</span></span>

<span data-ttu-id="3f29d-192">Учтите также, что не все облачные службы даже имеют соглашение об уровне обслуживания.</span><span class="sxs-lookup"><span data-stu-id="3f29d-192">Be aware also that not every cloud service even has an SLA.</span></span> <span data-ttu-id="3f29d-193">Если ваше приложение зависит от службы без гарантии времени, вы можете быть слишком длиннее, чем вы, возможно, представиме.</span><span class="sxs-lookup"><span data-stu-id="3f29d-193">If your app is dependent on a service with no up-time guarantee, you could be down far longer than you might imagine.</span></span> <span data-ttu-id="3f29d-194">Например, если вы включили вход на сайт с помощью поставщика социальных сетей, например Facebook или Twitter, обратитесь к поставщику услуг, чтобы узнать, есть ли соглашение об уровне обслуживания, и вы можете найти его.</span><span class="sxs-lookup"><span data-stu-id="3f29d-194">For example, if you enable log-in to your site using a social provider such as Facebook or Twitter, check with the service provider to find out if there is an SLA, and you might find out there isn't one.</span></span> <span data-ttu-id="3f29d-195">Но если служба проверки подлинности выходит из строя или не может поддерживать объем полученных запросов, ваши клиенты будут заблокированы для вашего приложения.</span><span class="sxs-lookup"><span data-stu-id="3f29d-195">But if the authentication service goes down or is unable to support the volume of requests you throw at it, your customers are locked out of your app.</span></span> <span data-ttu-id="3f29d-196">Возможно, вы не превысили дни или дольше.</span><span class="sxs-lookup"><span data-stu-id="3f29d-196">You could be down for days or longer.</span></span> <span data-ttu-id="3f29d-197">Создатели одного нового приложения ожидали сотни миллионов Скачиваний и потратили зависимость от проверки подлинности Facebook, но не работали с Facebook, прежде чем начать работу и обнаружить слишком поздно, что соглашение об уровне обслуживания для этой службы не было.</span><span class="sxs-lookup"><span data-stu-id="3f29d-197">The creators of one new app expected hundreds of millions of downloads and took a dependency on Facebook authentication – but didn't talk to Facebook before going live and discovered too late that there was no SLA for that service.</span></span>

### <a name="not-all-downtime-counts-toward-slas"></a><span data-ttu-id="3f29d-198">Не все время простоя приближается к соглашениям об уровне обслуживания</span><span class="sxs-lookup"><span data-stu-id="3f29d-198">Not all downtime counts toward SLAs</span></span>

<span data-ttu-id="3f29d-199">Некоторые облачные службы могут намеренно запретить службу, если приложение использует их.</span><span class="sxs-lookup"><span data-stu-id="3f29d-199">Some cloud services may deliberately deny service if your app over-uses them.</span></span> <span data-ttu-id="3f29d-200">Это называется *регулированием*.</span><span class="sxs-lookup"><span data-stu-id="3f29d-200">This is called *throttling*.</span></span> <span data-ttu-id="3f29d-201">Если у службы есть соглашение об уровне обслуживания, оно должно определять условия, при которых вы можете регулировать, и проект приложения должен избегать этих условий и соответствующим образом реагировать на регулирование, если это происходит.</span><span class="sxs-lookup"><span data-stu-id="3f29d-201">If a service has an SLA, it should state the conditions under which you might be throttled, and your app design should avoid those conditions and react appropriately to the throttling if it happens.</span></span> <span data-ttu-id="3f29d-202">Например, если запросы к службе запускаются с ошибкой при превышении определенного числа в секунду, необходимо гарантировать, что автоматические повторные попытки не будут выполняться настолько быстро, что они приведут к продолжению регулирования.</span><span class="sxs-lookup"><span data-stu-id="3f29d-202">For example, if requests to a service start to fail when you exceed a certain number per second, you want to make sure automatic retries don't happen so fast that they cause the throttling to continue.</span></span> <span data-ttu-id="3f29d-203">Мы будем говорить о регулировании в [главе по обработке временной ошибки](transient-fault-handling.md).</span><span class="sxs-lookup"><span data-stu-id="3f29d-203">We'll have more to say about throttling in the [Transient Fault Handling chapter](transient-fault-handling.md).</span></span>

## <a name="summary"></a><span data-ttu-id="3f29d-204">Сводка</span><span class="sxs-lookup"><span data-stu-id="3f29d-204">Summary</span></span>

<span data-ttu-id="3f29d-205">В этой главе была предпринята попытка определить причину, по которой облачное приложение для реальных приложений должно быть спроектировано так, чтобы успешно выдерживать сбои.</span><span class="sxs-lookup"><span data-stu-id="3f29d-205">This chapter has tried to help you realize why a real world cloud app has to be designed to survive failures gracefully.</span></span> <span data-ttu-id="3f29d-206">Начиная с [следующей главы](monitoring-and-telemetry.md), остальные шаблоны в этой серии попадают в более подробные сведения о некоторых стратегиях, которые можно использовать для этого:</span><span class="sxs-lookup"><span data-stu-id="3f29d-206">Starting with the [next chapter](monitoring-and-telemetry.md), the remaining patterns in this series go into more detail about some strategies you can use to do that:</span></span>

- <span data-ttu-id="3f29d-207">Иметь хороший [мониторинг и телеметрии](monitoring-and-telemetry.md), чтобы быстро узнать о сбоях, требующих вмешательства пользователя, и получить достаточные сведения для их устранения.</span><span class="sxs-lookup"><span data-stu-id="3f29d-207">Have good [monitoring and telemetry](monitoring-and-telemetry.md), so that you find out quickly about failures that require intervention, and you have sufficient information to resolve them.</span></span>
- <span data-ttu-id="3f29d-208">[Обрабатывайте временные ошибки](transient-fault-handling.md) , реализовав интеллектуальную логику повторных попыток, чтобы приложение автоматически закрывалось, когда оно может и возвращается к логике выключения [цепи](transient-fault-handling.md#circuitbreakers) , когда это невозможно.</span><span class="sxs-lookup"><span data-stu-id="3f29d-208">[Handle transient faults](transient-fault-handling.md) by implementing intelligent retry logic, so that your app recovers automatically when it can and falls back to [circuit breaker](transient-fault-handling.md#circuitbreakers) logic when it can't.</span></span>
- <span data-ttu-id="3f29d-209">Используйте [распределенное кэширование](distributed-caching.md) , чтобы свести к сведению проблемы с пропускной способностью, задержкой и подключением к базе данных.</span><span class="sxs-lookup"><span data-stu-id="3f29d-209">Use [distributed caching](distributed-caching.md) in order to minimize throughput, latency, and connection problems with database access.</span></span>
- <span data-ttu-id="3f29d-210">Реализуйте слабую связь с помощью [рабочего шаблона, ориентированного на очередь](queue-centric-work-pattern.md), чтобы внешний интерфейс приложения мог продолжать работать при отключении серверной части.</span><span class="sxs-lookup"><span data-stu-id="3f29d-210">Implement loose coupling via the [queue-centric work pattern](queue-centric-work-pattern.md), so that your app front end can continue to work when the back end is down.</span></span>

## <a name="resources"></a><span data-ttu-id="3f29d-211">Ресурсы</span><span class="sxs-lookup"><span data-stu-id="3f29d-211">Resources</span></span>

<span data-ttu-id="3f29d-212">Дополнительные сведения см. в последующих главах этой электронной книги и следующих ресурсах.</span><span class="sxs-lookup"><span data-stu-id="3f29d-212">For more information, see later chapters in this e-book and the following resources.</span></span>

<span data-ttu-id="3f29d-213">Документация:</span><span class="sxs-lookup"><span data-stu-id="3f29d-213">Documentation:</span></span>

- <span data-ttu-id="3f29d-214">[Отказоустойчивость: руководство по устойчивым облачным архитектурам](https://msdn.microsoft.com/library/windowsazure/jj853352.aspx).</span><span class="sxs-lookup"><span data-stu-id="3f29d-214">[Failsafe: Guidance for Resilient Cloud Architectures](https://msdn.microsoft.com/library/windowsazure/jj853352.aspx).</span></span> <span data-ttu-id="3f29d-215">Технический документ, (Marc Меркури, Ульрих Хоманн и Эндрю Товнхилл.</span><span class="sxs-lookup"><span data-stu-id="3f29d-215">White paper by Marc Mercuri, Ulrich Homann, and Andrew Townhill.</span></span> <span data-ttu-id="3f29d-216">Версия веб-страницы серии видеоматериалов по отказоустойчивости.</span><span class="sxs-lookup"><span data-stu-id="3f29d-216">Web page version of the FailSafe video series.</span></span>
- <span data-ttu-id="3f29d-217">Рекомендации [по проектированию крупномасштабных служб в облачных службах Azure](https://msdn.microsoft.com/library/windowsazure/jj717232.aspx).</span><span class="sxs-lookup"><span data-stu-id="3f29d-217">[Best Practices for the Design of Large-Scale Services on Azure Cloud Services](https://msdn.microsoft.com/library/windowsazure/jj717232.aspx).</span></span> <span data-ttu-id="3f29d-218">Технический документ, пометив SIMM и Майкл Сомасси.</span><span class="sxs-lookup"><span data-stu-id="3f29d-218">White paper by Mark Simms and Michael Thomassy.</span></span>
- <span data-ttu-id="3f29d-219">[Техническое руководство по обеспечению непрерывности бизнес-процессов Azure](https://msdn.microsoft.com/library/windowsazure/hh873027.aspx).</span><span class="sxs-lookup"><span data-stu-id="3f29d-219">[Azure Business Continuity Technical Guidance](https://msdn.microsoft.com/library/windowsazure/hh873027.aspx).</span></span> <span data-ttu-id="3f29d-220">Технический документ, Патрик Викклине и Джейсон Roth).</span><span class="sxs-lookup"><span data-stu-id="3f29d-220">White paper by Patrick Wickline and Jason Roth.</span></span>
- <span data-ttu-id="3f29d-221">[Аварийное восстановление и высокий уровень доступности для приложений Azure](https://msdn.microsoft.com/library/windowsazure/dn251004.aspx).</span><span class="sxs-lookup"><span data-stu-id="3f29d-221">[Disaster Recovery and High Availability for Azure Applications](https://msdn.microsoft.com/library/windowsazure/dn251004.aspx).</span></span> <span data-ttu-id="3f29d-222">Технический документ: Майкл Мккеовн, Hanu Коммалапати и Джейсон Roth).</span><span class="sxs-lookup"><span data-stu-id="3f29d-222">White paper by Michael McKeown, Hanu Kommalapati, and Jason Roth.</span></span>
- <span data-ttu-id="3f29d-223">[Шаблоны и методики Майкрософт. Руководство по Azure](https://msdn.microsoft.com/library/dn568099.aspx).</span><span class="sxs-lookup"><span data-stu-id="3f29d-223">[Microsoft Patterns and Practices - Azure Guidance](https://msdn.microsoft.com/library/dn568099.aspx).</span></span> <span data-ttu-id="3f29d-224">См. Руководство по развертыванию центра обработки данных, шаблон автоматического выключения.</span><span class="sxs-lookup"><span data-stu-id="3f29d-224">See Multi Data Center Deployment guidance, Circuit breaker pattern.</span></span>
- <span data-ttu-id="3f29d-225">[Поддержка Azure — соглашения об уровне обслуживания](https://azure.microsoft.com/support/legal/sla/).</span><span class="sxs-lookup"><span data-stu-id="3f29d-225">[Azure Support - Service Level Agreements](https://azure.microsoft.com/support/legal/sla/).</span></span>
- <span data-ttu-id="3f29d-226">[Непрерывность бизнес-процессов в базе данных SQL Azure](https://msdn.microsoft.com/library/windowsazure/hh852669.aspx).</span><span class="sxs-lookup"><span data-stu-id="3f29d-226">[Business Continuity in Azure SQL Database](https://msdn.microsoft.com/library/windowsazure/hh852669.aspx).</span></span> <span data-ttu-id="3f29d-227">Документация по функциям высокой доступности и аварийного восстановления базы данных SQL.</span><span class="sxs-lookup"><span data-stu-id="3f29d-227">Documentation about SQL Database high availability and disaster recovery features.</span></span>
- <span data-ttu-id="3f29d-228">[Высокий уровень доступности и аварийное восстановление для SQL Server на виртуальных машинах Azure](https://msdn.microsoft.com/library/windowsazure/jj870962.aspx).</span><span class="sxs-lookup"><span data-stu-id="3f29d-228">[High Availability and Disaster Recovery for SQL Server in Azure Virtual Machines](https://msdn.microsoft.com/library/windowsazure/jj870962.aspx).</span></span>

<span data-ttu-id="3f29d-229">Видеоматериалы:</span><span class="sxs-lookup"><span data-stu-id="3f29d-229">Videos:</span></span>

- <span data-ttu-id="3f29d-230">[Отказоустойчивость: создание масштабируемых отказоустойчивых облачных служб](https://channel9.msdn.com/Series/FailSafe).</span><span class="sxs-lookup"><span data-stu-id="3f29d-230">[FailSafe: Building Scalable, Resilient Cloud Services](https://channel9.msdn.com/Series/FailSafe).</span></span> <span data-ttu-id="3f29d-231">Серия из девяти частей, Ульрих Хоманн, (Marc Меркури и пометить SIMM.</span><span class="sxs-lookup"><span data-stu-id="3f29d-231">Nine-part series by Ulrich Homann, Marc Mercuri, and Mark Simms.</span></span> <span data-ttu-id="3f29d-232">Предоставляет основные понятия и архитектурные принципы в очень удобном и интересном смысле, а также истории, полученные от работы группы консультирования клиентов Майкрософт (CAT) с реальными клиентами.</span><span class="sxs-lookup"><span data-stu-id="3f29d-232">Presents high-level concepts and architectural principles in a very accessible and interesting way, with stories drawn from Microsoft Customer Advisory Team (CAT) experience with actual customers.</span></span> <span data-ttu-id="3f29d-233">Эпизоды 1 и 8 подробно попадают в причины, по которым облачные приложения могут выдерживать сбои.</span><span class="sxs-lookup"><span data-stu-id="3f29d-233">Episodes 1 and 8 go in depth into the reasons for designing cloud apps to survive failures.</span></span> <span data-ttu-id="3f29d-234">См. также описание регулирования в эпизоде 2, начиная с 49:57, обсуждение точек сбоя и режимов сбоя в эпизоде 2, начиная с 56:05, и обсуждение средств разбиения на каналах в серии 3, начиная с 40:55.</span><span class="sxs-lookup"><span data-stu-id="3f29d-234">See also the follow-up discussion of throttling in episode 2 starting at 49:57, the discussion of failure points and failure modes in episode 2 starting at 56:05, and the discussion of circuit breakers in episode 3 starting at 40:55.</span></span>
- <span data-ttu-id="3f29d-235">[Создание больших: уроки, полученные от клиентов Azure, часть II](https://channel9.msdn.com/Events/Build/2012/3-030).</span><span class="sxs-lookup"><span data-stu-id="3f29d-235">[Building Big: Lessons learned from Azure customers - Part II](https://channel9.msdn.com/Events/Build/2012/3-030).</span></span> <span data-ttu-id="3f29d-236">Марк SIMM рассказывает о проектировании для сбоев и инструментировании всех.</span><span class="sxs-lookup"><span data-stu-id="3f29d-236">Mark Simms talks about designing for failure and instrumenting everything.</span></span> <span data-ttu-id="3f29d-237">Как и в случае с отказоустойчивостью, вы переходите к дополнительным сведениям.</span><span class="sxs-lookup"><span data-stu-id="3f29d-237">Similar to the Failsafe series but goes into more how-to details.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="3f29d-238">[Назад](unstructured-blob-storage.md)
> [Вперед](monitoring-and-telemetry.md)</span><span class="sxs-lookup"><span data-stu-id="3f29d-238">[Previous](unstructured-blob-storage.md)
[Next](monitoring-and-telemetry.md)</span></span>
