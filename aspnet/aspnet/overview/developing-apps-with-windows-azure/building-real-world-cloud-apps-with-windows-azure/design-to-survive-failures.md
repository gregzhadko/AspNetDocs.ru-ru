---
uid: aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/design-to-survive-failures
title: Проектирование для устойчивых сбоев (создание облачных приложений в реальном мире с помощью Azure) | Документация Майкрософт
author: MikeWasson
description: Создание реальных облачных приложений с помощью электронной книги Azure основано на презентации, разработанной Скотт Гатри (. В нем объясняются 13 шаблонов и методик, которые могут...
ms.author: riande
ms.date: 06/12/2014
ms.assetid: 364ce84e-5af8-4e08-afc9-75a512b01f84
msc.legacyurl: /aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/design-to-survive-failures
msc.type: authoredcontent
ms.openlocfilehash: 348232af531b5d53dc3cb46d6d2c7931d95a572d
ms.sourcegitcommit: 7709c0a091b8d55b7b33bad8849f7b66b23c3d72
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/19/2020
ms.locfileid: "77457132"
---
# <a name="design-to-survive-failures-building-real-world-cloud-apps-with-azure"></a>Разработка для устойчивых сбоев (создание облачных приложений в реальном мире с помощью Azure)

[Майк Уоссон](https://github.com/MikeWasson), [Рик Андерсон (](https://twitter.com/RickAndMSFT), том [Dykstra)](https://github.com/tdykstra)

[Скачивание решения ИТ-проекта](https://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4) или [Загрузка электронной книги](https://blogs.msdn.com/b/microsoft_press/archive/2014/07/23/free-ebook-building-cloud-apps-with-microsoft-azure.aspx)

> **Создание реальных облачных приложений с помощью** электронной книги Azure основано на презентации, разработанной Скотт Гатри (. В нем объясняются 13 шаблонов и методик, которые могут помочь в успешной разработке веб-приложений для облака. Сведения о электронной книге см. [в первой главе](introduction.md).

Одно из моментов, о которых необходимо подумать при создании приложения любого типа, но особенно те, которые будут работать в облаке, где его используют многие пользователи, — это создание приложения, позволяющее корректно обрабатывать сбои и продолжать доставлять ценность настолько, насколько позволяет. Учитывая достаточное время, вещи в любой среде или в любой системе программного обеспечения будут неправильными. Как ваше приложение обрабатывает эти ситуации, определяет, как обеспокоен ваши клиенты и сколько времени нужно потратить на анализ и устранение проблем.

## <a name="types-of-failures"></a>Типы сбоев

Существует две основные категории сбоев, которые нужно обменять по-разному:

- Временные ошибки самовосстановления, такие как временные неполадки с сетевым подключением.
- Долгоживущий сбои, требующие вмешательства.

Для временных сбоев можно реализовать политику повтора, чтобы обеспечить большую часть времени, которое приложение восстанавливает быстро и автоматически. Клиенты могут заметить немного больше времени отклика, но в противном случае они не будут затронуты. Мы покажем некоторые способы обработки этих ошибок в [главе обработка временной ошибки](transient-fault-handling.md).

Для сбоев долгоживущий можно реализовать функции мониторинга и ведения журнала, которые немедленно уведомляют пользователя о возникновении проблем и способствуют анализу основных причин. Мы покажем некоторые способы, которые помогут вам остаться в курсе ошибок этих типов в [главе мониторинг и телеметрии](monitoring-and-telemetry.md).

## <a name="failure-scope"></a>Область сбоя

Кроме того, необходимо подумать о области сбоя — независимо от того, затрагивается ли одна машина — вся служба, например база данных SQL или хранилище, или весь регион.

![Область сбоя](design-to-survive-failures/_static/image1.png)

### <a name="machine-failures"></a>Сбои компьютеров

В Azure сервер, на котором произошел сбой, автоматически заменяется новым, и хорошо спроектированное облачное приложение автоматически восстанавливается из этого типа сбоя. Ранее мы превышены преимущества масштабируемости веб-уровня без отслеживания состояния, и простота восстановления с неисправного сервера является еще одним преимуществом стателесснесс. Простота восстановления является также одним из преимуществ функций платформы как услуги (PaaS), таких как база данных SQL и веб-приложения службы приложений Azure. Аппаратные сбои происходят редко, но, когда они происходят, эти службы обрабатывают их автоматически. Вам даже не придется писать код для выполнения сбоев компьютеров, если вы используете одну из этих служб.

### <a name="service-failures"></a>Сбои службы

В облачных приложениях обычно используется несколько служб. Например, приложение для устранения проблем использует службу базы данных SQL, службу хранилища, а веб-приложение развертывается в службе приложений Azure. Что будет делать ваше приложение, если происходит сбой одной из служб, от которых вы зависите? Для некоторых сбоев служб может оказаться, что вы можете получить более удобное сообщение. Но во многих сценариях это можно сделать лучше. Например, если серверное хранилище данных не работает, можно принять входные данные пользователя, отобразить "ваш запрос получен" и сохранить вход в другом месте. Затем, когда нужная служба работает снова, вы можете получить входные данные и обработать ее.

В главе « [рабочий шаблон, ориентированной на очередь](queue-centric-work-pattern.md) » показан один из способов обработки этого сценария. Приложение Fix ИТ сохраняет задачи в базе данных SQL, но не нужно выходить из нее, когда база данных SQL не работает. В этой главе будет показано, как хранить ввод пользователя для задачи в очереди и использовать рабочий процесс для чтения очереди и обновления задачи. Если SQL не работает, возможность создания решения для ИТ-задач не затрагивается. Рабочий процесс может ожидать и обрабатывать новые задачи, если база данных SQL доступна.

### <a name="region-failures"></a>Сбои в регионах

Все регионы могут завершиться ошибкой. Естественная авария может привести к удалению центра обработки данных, он может быть сведен к Meteor, а линия магистрали в центр обработки может быть вырезана Фармер буринг a Cow с экскаватора и т. д. Что делать, если приложение размещено в центре обработки данных стриккен? Можно настроить приложение в Azure для одновременного запуска в нескольких регионах, чтобы при наличии аварии в одном из других регионов продолжить выполнение в другом регионе. Такие сбои очень редки, и большинство приложений не переходят через препятствий, необходимое для обеспечения бесперебойной работы службы при сбоях этой сортировки. Сведения о том, как сделать приложение доступным даже при сбое региона, см. в разделе ресурсы в конце главы.

Цель Azure состоит в том, чтобы значительно упростить обработку всех этих видов сбоев, и вы увидите несколько примеров того, как мы делаем это в следующих главах.

## <a name="slas"></a>Соглашения об уровне обслуживания

Люди часто слышит соглашения об уровне обслуживания в облачной среде. По сути, это обещает, что компании делают то, насколько надежна их служба. Соглашение об уровне обслуживания, равное 99,9%, означает, что служба должна работать правильно 99,9% времени. Это довольно типичное значение для соглашения об уровне обслуживания, которое кажется очень большим, но вы можете не осознать, сколько времени составляет 0,1% на самом деле. Ниже приведена таблица, на которой показано, сколько времени простоя в процентах от общего количества для соглашения об уровне обслуживания в течение года, месяца и недели.

![Таблица SLA](design-to-survive-failures/_static/image2.png)

Таким образом, соглашение об уровне обслуживания 99,9% означает, что ваша служба может быть отключена 8,76 часа в год или 43,2 минут в месяц. Это более длительное время, чем большинство людей понимают. Таким образом, разработчику необходимо знать, что может быть некоторое время простоя и правильно обрабатывать его. В какой-то момент пользователь будет использовать ваше приложение, и служба будет недоступна и вы хотите уменьшить негативное влияние на клиента.

Необходимо узнать о соглашении об уровне обслуживания, на которое он ссылается. часы сбрасываются каждую неделю, каждый месяц или каждый год? В Azure мы сбрасывать часы каждый месяц, что лучше, чем ежегодное соглашение об уровне обслуживания, так как ежегодное соглашение об уровне обслуживания может скрыть неправильные месяцы, изменив их на ряд хороших месяцев.

Конечно, мы всегда стремитесь, что это лучше, чем соглашение об уровне обслуживания. Обычно это будет намного меньше. Обещание состоит в том, что, если сейчас у нас больше времени, чем максимальное время простоя, вы можете запросить деньги. Объем денег, который вы получаете, вероятно, не будет полностью компенсировать влияние на бизнес влияния чрезмерного времени, но этот аспект соглашения об уровне обслуживания действует как политика принудительного применения, и вы узнаете о том, что мы очень серьезно выберем.

### <a name="composite-slas"></a>Составные соглашения об уровне обслуживания

Важно помнить, что при просмотре соглашения об уровне обслуживания — это влияние использования нескольких служб в приложении, при этом каждая служба имеет отдельное соглашение об уровне обслуживания. Например, приложение для устранения проблем использует веб-приложения службы приложений Azure, службу хранилища Azure и базу данных SQL. Ниже приведены номера соглашений об уровне обслуживания на момент написания этой электронной книги в декабре 2013:

![Веб-узел SLA, хранилище, база данных SQL](design-to-survive-failures/_static/image3.png)

Каково максимальное время ожидания для приложения на основе этих соглашений об уровне обслуживания? Вы можете подумать, что время простоя будет равно наихудшему проценту соглашения об уровне обслуживания или 99,9% в данном случае. Это было бы верно, если все три службы всегда завершились сбоем одновременно, но это не обязательно происходит. Каждая служба может завершаться сбоем независимо в разное время, поэтому необходимо вычислить составное соглашение об уровне обслуживания, умножив отдельные номера SLA.

![Составное соглашение об уровне обслуживания](design-to-survive-failures/_static/image4.png)

Так что ваше приложение может быть не только 43,2 минут в месяц, но в 3 раза больше, чем 108 минут в месяц, и по-прежнему находиться в пределах ограничений соглашения об уровне обслуживания Azure.

Эта проблема не является уникальной для Azure. Мы предоставляем оптимальное облачное соглашение об уровне обслуживания для любой доступной облачной службы, и у вас возникнут аналогичные проблемы, связанные с использованием облачных служб любого поставщика. В этой статье важно подумать о том, как можно спроектировать приложение для корректной работы неизбежных сбоев службы, так как они могут быть достаточно часто, чтобы повлиять на клиентов или пользователей.

### <a name="cloud-slas-compared-to-enterprise-down-time-experience"></a>Облачные соглашения об уровне обслуживания по сравнению с корпоративным временем работы

Иногда люди говорят: «в моем корпоративном приложении у меня нет этих проблем». Если вы задаете, сколько времени на самом деле у них есть, они, как правило, говорят, что это случается иногда. И, если спросить, как часто, они признают, что иногда требуется резервное копирование или установка нового сервера или обновления программного обеспечения ". Конечно, это учитывается как время простоя. Большинство корпоративных приложений, если они не являются особенно важными, на самом деле не работают в течение более чем времени, допускаемого соглашениями об уровне обслуживания. Но когда это ваш сервер и инфраструктура, и вы несете ответственность за ИТ и контролируете ее, вы, скорее всего, волненийе меньше времени. В облачной среде вы зависят от кого-то другого и не знаете, что происходит.

Когда предприятие достигает более высокого процента времени, чем вы получаете в рамках соглашения об уровне обслуживания для облака, он выполняет гораздо больше денег на оборудование. Облачная служба может сделать это, но при этом придется взимать множество дополнительных услуг. Вместо этого вы получаете экономичную службу и разрабатываете программное обеспечение, чтобы неизбежные сбои приводили к минимальному перерыву в работе клиентов. Ваше задание в качестве конструктора облачных приложений не настолько много, чтобы избежать сбоев, так как это не катастрофы, и это можно сделать, если сосредоточиться на программном обеспечении, а не на оборудовании. В то время как корпоративные приложения стремятся к максимальному среднему времени между сбоями, облачные приложения стремятся к минимальному среднему времени для восстановления.

### <a name="not-all-cloud-services-have-slas"></a>Не все облачные службы имеют соглашение об уровне обслуживания

Учтите также, что не все облачные службы даже имеют соглашение об уровне обслуживания. Если ваше приложение зависит от службы без гарантии времени, вы можете быть слишком длиннее, чем вы, возможно, представиме. Например, если вы включили вход на сайт с помощью поставщика социальных сетей, например Facebook или Twitter, обратитесь к поставщику услуг, чтобы узнать, есть ли соглашение об уровне обслуживания, и вы можете найти его. Но если служба проверки подлинности выходит из строя или не может поддерживать объем полученных запросов, ваши клиенты будут заблокированы для вашего приложения. Возможно, вы не превысили дни или дольше. Создатели одного нового приложения ожидали сотни миллионов Скачиваний и потратили зависимость от проверки подлинности Facebook, но не работали с Facebook, прежде чем начать работу и обнаружить слишком поздно, что соглашение об уровне обслуживания для этой службы не было.

### <a name="not-all-downtime-counts-toward-slas"></a>Не все время простоя приближается к соглашениям об уровне обслуживания

Некоторые облачные службы могут намеренно запретить службу, если приложение использует их. Это называется *регулированием*. Если у службы есть соглашение об уровне обслуживания, оно должно определять условия, при которых вы можете регулировать, и проект приложения должен избегать этих условий и соответствующим образом реагировать на регулирование, если это происходит. Например, если запросы к службе запускаются с ошибкой при превышении определенного числа в секунду, необходимо гарантировать, что автоматические повторные попытки не будут выполняться настолько быстро, что они приведут к продолжению регулирования. Мы будем говорить о регулировании в [главе по обработке временной ошибки](transient-fault-handling.md).

## <a name="summary"></a>Сводка

В этой главе была предпринята попытка определить причину, по которой облачное приложение для реальных приложений должно быть спроектировано так, чтобы успешно выдерживать сбои. Начиная с [следующей главы](monitoring-and-telemetry.md), остальные шаблоны в этой серии попадают в более подробные сведения о некоторых стратегиях, которые можно использовать для этого:

- Иметь хороший [мониторинг и телеметрии](monitoring-and-telemetry.md), чтобы быстро узнать о сбоях, требующих вмешательства пользователя, и получить достаточные сведения для их устранения.
- [Обрабатывайте временные ошибки](transient-fault-handling.md) , реализовав интеллектуальную логику повторных попыток, чтобы приложение автоматически закрывалось, когда оно может и возвращается к логике выключения [цепи](transient-fault-handling.md#circuitbreakers) , когда это невозможно.
- Используйте [распределенное кэширование](distributed-caching.md) , чтобы свести к сведению проблемы с пропускной способностью, задержкой и подключением к базе данных.
- Реализуйте слабую связь с помощью [рабочего шаблона, ориентированного на очередь](queue-centric-work-pattern.md), чтобы внешний интерфейс приложения мог продолжать работать при отключении серверной части.

## <a name="resources"></a>Ресурсы

Дополнительные сведения см. в последующих главах этой электронной книги и следующих ресурсах.

Документация:

- [Отказоустойчивость: руководство по устойчивым облачным архитектурам](https://msdn.microsoft.com/library/windowsazure/jj853352.aspx). Технический документ, (Marc Меркури, Ульрих Хоманн и Эндрю Товнхилл. Версия веб-страницы серии видеоматериалов по отказоустойчивости.
- Рекомендации [по проектированию крупномасштабных служб в облачных службах Azure](https://msdn.microsoft.com/library/windowsazure/jj717232.aspx). Технический документ, пометив SIMM и Майкл Сомасси.
- [Техническое руководство по обеспечению непрерывности бизнес-процессов Azure](https://msdn.microsoft.com/library/windowsazure/hh873027.aspx). Технический документ, Патрик Викклине и Джейсон Roth).
- [Аварийное восстановление и высокий уровень доступности для приложений Azure](https://msdn.microsoft.com/library/windowsazure/dn251004.aspx). Технический документ: Майкл Мккеовн, Hanu Коммалапати и Джейсон Roth).
- [Шаблоны и методики Майкрософт. Руководство по Azure](https://msdn.microsoft.com/library/dn568099.aspx). См. Руководство по развертыванию центра обработки данных, шаблон автоматического выключения.
- [Поддержка Azure — соглашения об уровне обслуживания](https://azure.microsoft.com/support/legal/sla/).
- [Непрерывность бизнес-процессов в базе данных SQL Azure](https://msdn.microsoft.com/library/windowsazure/hh852669.aspx). Документация по функциям высокой доступности и аварийного восстановления базы данных SQL.
- [Высокий уровень доступности и аварийное восстановление для SQL Server на виртуальных машинах Azure](https://msdn.microsoft.com/library/windowsazure/jj870962.aspx).

Видеоролики:

- [Отказоустойчивость: создание масштабируемых отказоустойчивых облачных служб](https://channel9.msdn.com/Series/FailSafe). Серия из девяти частей, Ульрих Хоманн, (Marc Меркури и пометить SIMM. Предоставляет основные понятия и архитектурные принципы в очень удобном и интересном смысле, а также истории, полученные от работы группы консультирования клиентов Майкрософт (CAT) с реальными клиентами. Эпизоды 1 и 8 подробно попадают в причины, по которым облачные приложения могут выдерживать сбои. См. также описание регулирования в эпизоде 2, начиная с 49:57, обсуждение точек сбоя и режимов сбоя в эпизоде 2, начиная с 56:05, и обсуждение средств разбиения на каналах в серии 3, начиная с 40:55.
- [Создание больших: уроки, полученные от клиентов Azure, часть II](https://channel9.msdn.com/Events/Build/2012/3-030). Марк SIMM рассказывает о проектировании для сбоев и инструментировании всех. Как и в случае с отказоустойчивостью, вы переходите к дополнительным сведениям.

> [!div class="step-by-step"]
> [Назад](unstructured-blob-storage.md)
> [Вперед](monitoring-and-telemetry.md)
