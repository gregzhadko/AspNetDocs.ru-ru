---
uid: aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/web-development-best-practices
title: Рекомендации по веб-разработке (создание облачных приложений в реальном мире с помощью Azure) | Документация Майкрософт
author: MikeWasson
description: Создание реальных облачных приложений с помощью электронной книги Azure основано на презентации, разработанной Скотт Гатри (. В нем объясняются 13 шаблонов и методик, которые могут...
ms.author: riande
ms.date: 06/12/2014
ms.assetid: 52d6c941-2cd9-442f-9872-2c798d6d90cd
msc.legacyurl: /aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/web-development-best-practices
msc.type: authoredcontent
ms.openlocfilehash: dfd8a3ac2328d3f17dfbe36e68b37d181177b0f4
ms.sourcegitcommit: 7709c0a091b8d55b7b33bad8849f7b66b23c3d72
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/19/2020
ms.locfileid: "77457093"
---
# <a name="web-development-best-practices-building-real-world-cloud-apps-with-azure"></a>Рекомендации по веб-разработке (создание облачных приложений в реальном мире с помощью Azure)

[Майк Уоссон](https://github.com/MikeWasson), [Рик Андерсон (](https://twitter.com/RickAndMSFT), том [Dykstra)](https://github.com/tdykstra)

[Скачивание решения ИТ-проекта](https://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4) или [Загрузка электронной книги](https://blogs.msdn.com/b/microsoft_press/archive/2014/07/23/free-ebook-building-cloud-apps-with-microsoft-azure.aspx)

> **Создание реальных облачных приложений с помощью** электронной книги Azure основано на презентации, разработанной Скотт Гатри (. В нем объясняются 13 шаблонов и методик, которые могут помочь в успешной разработке веб-приложений для облака. Сведения о электронной книге см. [в первой главе](introduction.md).

Первые три шаблона изходили о настройке гибкого процесса разработки. остальные находятся в архитектуре и коде. Это набор рекомендаций для веб-разработки:

- [Веб-серверы без отслеживания состояния](#stateless) за счет интеллектуальной подсистемы балансировки нагрузки.
- [Избегайте состояния сеанса](#sessionstate) (или, если вы не можете его избежать, используйте распределенный кэш, а не базу данных).
- [Использование сети CDN](#cdn) для статических файловых ресурсов кэша (образы, сценарии).
- [Используйте асинхронную поддержку .NET 4.5](#async) , чтобы избежать блокирующих вызовов.

Эти рекомендации действительны для всех веб-приложений, а не только для облачных приложений, но они особенно важны для облачных приложений. Они работают вместе, чтобы обеспечить оптимальное использование крайне гибкого масштабирования, предлагаемого облачной средой. Если вы не будете следовать этим рекомендациям, то при попытке масштабирования приложения будут использоваться ограничения.

<a id="stateless"></a>
## <a name="stateless-web-tier-behind-a-smart-load-balancer"></a>Веб-уровень без отслеживания состояния за смарт-подсистемой балансировки нагрузки

*Веб-уровень без отслеживания состояния* означает, что вы не храните данные приложений в памяти веб-сервера или в файловой системе. Сохранение состояния веб-уровня позволяет обеспечить лучшую работу клиентов и сэкономить деньги:

- Если веб-уровень не имеет состояния и находится за подсистемой балансировки нагрузки, можно быстро реагировать на изменения в трафике приложений, динамически добавляя или удаляя серверы. В облачной среде, где вы платите только за ресурсы сервера до тех пор, пока вы фактически используете их, возможность реагирования на изменения спроса может привести к большой экономии.
- Веб-уровень без отслеживания состояния гораздо проще в масштабировании приложения. Это также позволяет быстрее реагировать на запросы на масштабирование и тратить меньше денег на разработку и тестирование в процессе.
- Облачные серверы, например локальные серверы, должны быть исправлены и перезагружены периодически; а если веб-уровень не имеет состояния, перенаправление трафика при временном отключении сервера не вызывает ошибок или непредвиденного поведения.

Большинству реальных приложений требуется хранить состояние веб-сеанса; главным моментом здесь является отсутствие необходимости хранить его на веб-сервере. Состояние можно хранить другими способами, например на клиенте в файлах cookie или вне процесса на стороне сервера в состоянии сеанса ASP.NET с помощью поставщика кэша. Вы можете хранить файлы в [хранилище больших двоичных объектов Windows Azure](unstructured-blob-storage.md) , а не в локальной файловой системе.

В качестве примера того, насколько просто масштабировать приложение на веб-сайтах Windows Azure, если веб-уровень не имеет состояния, см. вкладку **масштабирование** для веб-сайта Windows Azure на портале управления:

![Вкладка "Масштаб"](web-development-best-practices/_static/image1.png)

Если вы хотите добавить веб-серверы, можно просто перетащить ползунок счетчик экземпляров вправо. Задайте для него значение 5 и нажмите кнопку **сохранить**. в течение нескольких секунд у вас будет 5 веб-серверов в Windows Azure, обрабатывающих трафик вашего веб-сайта.

![Пять экземпляров](web-development-best-practices/_static/image2.png)

Вы можете точно так же задать для счетчика экземпляров значение 3 или вернуться к 1. При обратном масштабировании вы начнете экономию денег немедленно, так как плата за Windows Azure будет взиматься за минуту, а не за час.

Можно также указать Windows Azure на автоматическое увеличение или уменьшение числа веб-серверов на основе загрузки ЦП. В следующем примере, когда загрузка ЦП составляет менее 60%, число веб-серверов будет уменьшено до 2, а если загрузка ЦП превышает 80%, число веб-серверов увеличится до 4.

![Масштабирование по использованию ЦП](web-development-best-practices/_static/image3.png)

Или что если известно, что ваш сайт будет занят только в рабочее время? Вы можете указать Windows Azure на запуск нескольких серверов в течение постоянную и сократить до одного сервера пятницы, ночей и выходных дней. В следующей серии снимков экрана показано, как настроить веб-сайт для запуска одного сервера в часы и 4 сервера в рабочее время с 8 до 17:00.

![Масштабировать по расписанию](web-development-best-practices/_static/image4.png)

![Задать время расписания](web-development-best-practices/_static/image5.png)

![Расписание постоянную](web-development-best-practices/_static/image6.png)

![Расписание викнигхт](web-development-best-practices/_static/image7.png)

![Расписание выходных дней](web-development-best-practices/_static/image8.png)

И, конечно же, все это можно сделать в сценариях, а также на портале.

Возможность масштабирования приложения почти не ограничена в Windows Azure, так как вы не можете динамически добавлять или удалять виртуальные машины сервера, сохраняя состояние веб-уровня.

<a id="sessionstate"></a>
## <a name="avoid-session-state"></a>Избежание состояния сеанса

Не хранить определенные виды состояний сеансов пользователя в реальном облачном приложении бывает нецелесообразно, но разные подходы по-разному влияют на производительность и масштабируемость. Если вам нужно хранить состояния, лучшим решением будет хранить небольшой объем состояний в файлах cookie. Если это нецелесообразно, следующее лучшее решение заключается в использовании состояния сеанса ASP.NET с поставщиком для [распределенного кэша в памяти](distributed-caching.md#sessionstate). Худшее решение с точки зрения масштабируемости и производительности — использовать базу данных резервного поставщика состояний сеансов.

<a id="cdn"></a>
## <a name="use-a-cdn-to-cache-static-file-assets"></a>Использование CDN для кэширования ресурсов статических файлов

CDN — это аббревиатура для сети доставки содержимого. Вы предоставляете статические файловые ресурсы, такие как изображения и файлы скриптов, поставщику CDN, а поставщик кэширует эти файлы в центрах обработки данных по всему миру, чтобы все пользователи, обращающиеся к вашему приложению, могли получать сравнительно быстрый отклик и низкая задержка для кэшированного Основное. Это ускоряет общее время загрузки сайта и сокращает нагрузку на веб-серверы. CDN особенно важны, если вы достигли аудитории, которая широко распределена географически.

В Windows Azure есть CDN, и вы можете использовать другие CDN в приложении, работающем в Windows Azure или в любой среде веб-размещения.

<a id="async"></a>
## <a name="use-net-45s-async-support-to-avoid-blocking-calls"></a>Используйте асинхронную поддержку .NET 4.5, чтобы избежать блокирующих вызовов

В .NET 4,5 усовершенствованы языки программирования C# и VB, чтобы упростить асинхронную обработку задач. Преимущество асинхронного программирования заключается не только в ситуациях с параллельной обработкой, например, когда нужно запускать несколько вызовов веб-службы одновременно. Она также позволяет веб-серверу более эффективно и надежно работать в условиях высокой нагрузки. На веб-сервере доступно ограниченное количество потоков, и в условиях высокой нагрузки при использовании всех потоков входящие запросы должны ожидать освобождения потоков. Если код приложения не обрабатывает такие задачи, как запросы к базе данных и вызовы веб-службы, то многие потоки не всегда связаны, пока сервер ожидает ответа ввода-вывода. Это ограничивает объем трафика, который сервер может обслуживать при высоких условиях загрузки. При асинхронном программировании потоки, ожидающие возврата данных веб-службой или базой данных, освобождаются до обслуживания новых запросов до получения данных. В загруженном веб-сервере сотни или тысячи запросов могут быть обработаны быстро, что в противном случае будет ожидать освобождения потоков.

Как было показано ранее, можно легко уменьшить количество веб-серверов, обрабатывающих веб-сайт, так как это позволит увеличить их. Таким образом, если сервер может достичь большей пропускной способности, вам не нужно много ресурсов, и вы можете снизить затраты, так как для определенного объема трафика требуется меньшее количество серверов, чем в противном случае.

Поддержка асинхронной модели программирования .NET 4,5 включена в ASP.NET 4,5 для веб-форм, MVC и веб-API. в Entity Framework 6 и в [API хранилища Windows Azure](https://blogs.msdn.com/b/windowsazurestorage/archive/2013/07/12/introducing-storage-client-library-2-1-rc-for-net-and-windows-phone-8.aspx).

### <a name="async-support-in-aspnet-45"></a>Поддержка асинхронных операций в ASP.NET 4,5

В ASP.NET 4,5 поддержка асинхронного программирования была добавлена не только для языка, но и для платформ MVC, веб-форм и веб-API. Например, метод действия контроллера MVC ASP.NET получает данные из веб-запроса и передает их в представление, которое затем создает HTML-код для отправки в браузер. Часто методу действия необходимо получить данные из базы данных или веб-службы, чтобы отобразить их на веб-странице или сохранить данные, указанные на веб-странице. В этих сценариях несложно сделать метод действия асинхронным: вместо возврата объекта *ActionResult* вы возвращаете *Task&lt;ActionResult&gt;* и помечаете метод ключевым словом *Async* . Внутри метода, когда строка кода запускает операцию, включающую время ожидания, вы помечаете ее с помощью ключевого слова await.

Ниже приведен простой метод действия, который вызывает метод репозитория для запроса к базе данных:

[!code-csharp[Main](web-development-best-practices/samples/sample1.cs)]

И вот тот же метод, который обрабатывает вызов базы данных асинхронно:

[!code-csharp[Main](web-development-best-practices/samples/sample2.cs?highlight=1,4)]

В разделе рассматриваются компилятор создает соответствующий асинхронный код. Когда приложение выполняет вызов `FindTaskByIdAsync`, ASP.NET делает `FindTask`ный запрос, а затем очищает рабочий поток и делает его доступным для обработки другого запроса. Когда запрос `FindTask` выполняется, поток перезапускается для продолжения обработки кода, который поступает после этого вызова. Во время промежуточной работы при инициации запроса `FindTask` и возвращении данных у вас есть поток, позволяющий выполнить полезную работу, которая в противном случае будет связана с ожиданием ответа.

Существует несколько дополнительных издержек для асинхронного кода, но при условиях низкого уровня нагрузки эти издержки незначительны, а в условиях высокой нагрузки можно обрабатывать запросы, которые в противном случае могут ожидать доступных потоков.

Этот тип асинхронного программирования можно выполнить с момента ASP.NET 1,1, но было сложно писать, погрешности и усложнить отладку. Теперь, когда мы упростили написание кода для него в ASP.NET 4,5, нет никаких причин.

### <a name="async-support-in-entity-framework-6"></a>Поддержка асинхронных операций в Entity Framework 6

В рамках асинхронной поддержки в 4,5 мы поставляли асинхронную поддержку вызовов веб-служб, сокетов и операций ввода-вывода файловой системы, но наиболее распространенный шаблон для веб-приложений — это достижение базы данных, и наши библиотеки данных не поддерживали Async. Теперь Entity Framework 6 добавляет поддержку асинхронной поддержки для доступа к базе данных.

В Entity Framework 6 все методы, которые вызывают отправку запроса или команды в базу данных, имеют асинхронные версии. В этом примере показана асинхронная версия метода *Find* .

[!code-csharp[Main](web-development-best-practices/samples/sample3.cs?highlight=8)]

Эта поддержка асинхронной работы не только для операций вставки, удаления, обновления и простого поиска, но также работает с запросами LINQ:

[!code-csharp[Main](web-development-best-practices/samples/sample4.cs?highlight=7,10)]

Существует `Async`ная версия метода `ToList`, так как в этом коде это метод, который вызывает отправку запроса в базу данных. Методы `Where` и `OrderByDescending` настраивают только запрос, а метод `ToListAsync` выполняет запрос и сохраняет ответ в переменной `result`.

## <a name="summary"></a>Сводка

Вы можете реализовать рекомендации по веб-разработке, описанные здесь в любой платформе веб-программирования и в любой облачной среде, но у нас есть средства в ASP.NET и Windows Azure для упрощения работы. Если следовать этим шаблонам, вы можете легко масштабировать веб-уровень, и вы сократите расходы, так как каждый сервер сможет обрабатывать больше трафика.

В [следующей главе](single-sign-on.md) рассматривается, как облако включает сценарии единого входа.

## <a name="resources"></a>Ресурсы

Дополнительные сведения см. в следующих ресурсах.

Веб-серверы без отслеживания состояния:

- [Шаблоны и методики Майкрософт — руководство по автомасштабированию](https://msdn.microsoft.com/library/dn589774.aspx).
- [Отключение сходства экземпляров службы ARR на веб-сайтах Windows Azure](https://azure.microsoft.com/blog/2013/11/18/disabling-arrs-instance-affinity-in-windows-azure-web-sites/). Запись блога, получения запись блога, объясняет сходство сеансов на веб-сайтах Windows Azure.

СЕТЬ

- [Отказоустойчивость: создание масштабируемых отказоустойчивых облачных служб](https://channel9.msdn.com/Series/FailSafe). Серия видео из девяти частей по Ульрих Хоманн, (Marc Меркури и пометить SIMM. См. обсуждение CDN в серии 3, начиная с 1:34:00.
- [Шаблон размещения статического содержимого шаблонов и методик Майкрософт](https://msdn.microsoft.com/library/dn589776.aspx)
- [Проверка CDN](http://www.cdnreviews.com/). Обзор многих CDN.

Асинхронное программирование:

- [Использование асинхронных методов в ASP.NET MVC 4](../../../../mvc/overview/performance/using-asynchronous-methods-in-aspnet-mvc-4.md). Учебник по Рик Андерсон (.
- [Асинхронное программирование с использованием Async иC# Await (и Visual Basic)](https://msdn.microsoft.com/library/vstudio/hh191443.aspx). Технический документ MSDN, посвященный обоснованию асинхронного программирования, его работе в ASP.NET 4,5 и написанию кода для его реализации.
- [Entity Framework асинхронный запрос и сохранить](https://msdn.microsoft.com/data/jj819165)
- [Как создавать веб-приложения ASP.NET с помощью Async](https://channel9.msdn.com/Events/TechEd/NorthAmerica/2013/DEV-B337#fbid=tgkT4SR_DK7). Видеопрезентация, Роуэн Миллер. Содержит графическое представление о том, как асинхронное программирование может способствовать значительному увеличению пропускной способности веб-сервера при высоких условиях нагрузки.
- [Отказоустойчивость: создание масштабируемых отказоустойчивых облачных служб](https://channel9.msdn.com/Series/FailSafe). Серия видео из девяти частей по Ульрих Хоманн, (Marc Меркури и пометить SIMM. Сведения о влиянии асинхронного программирования на масштабируемость см. в серии 4 и серии 8.
- [Волшебность использования асинхронных методов в ASP.NET 4,5 и важная](http://www.hanselman.com/blog/TheMagicOfUsingAsynchronousMethodsInASPNET45PlusAnImportantGotcha.aspx)проблема. Запись блога Скотта Hanselman, в первую очередь об использовании Async в приложениях веб-форм ASP.NET.

Дополнительные рекомендации по веб-разработке см. в следующих ресурсах:

- [Пример приложения по устранению неполадок — рекомендации](the-fix-it-sample-application.md#bestpractices). В этом электронном руководстве представлен ряд рекомендаций, которые были реализованы в ИТ-приложении Fix.
- [Контрольный список веб-разработчика](http://webdevchecklist.com/asp.net)

> [!div class="step-by-step"]
> [Назад](continuous-integration-and-continuous-delivery.md)
> [Вперед](single-sign-on.md)
