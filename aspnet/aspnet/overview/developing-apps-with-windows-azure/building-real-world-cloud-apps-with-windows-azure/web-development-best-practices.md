---
uid: aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/web-development-best-practices
title: Лучшие практики веб-разработки (создание облачных приложений в реальном мире с помощью Azure) Документы Майкрософт
author: MikeWasson
description: Создание облачных приложений реального мира с электронной книгой Azure основано на презентации, разработанной Скоттом Гатри. Это объясняет 13 моделей и практик, которые могут он ...
ms.author: riande
ms.date: 06/12/2014
ms.assetid: 52d6c941-2cd9-442f-9872-2c798d6d90cd
msc.legacyurl: /aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/web-development-best-practices
msc.type: authoredcontent
ms.openlocfilehash: dfd8a3ac2328d3f17dfbe36e68b37d181177b0f4
ms.sourcegitcommit: ce28244209db8615bc9bdd576a2e2c88174d318d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2020
ms.locfileid: "80675643"
---
# <a name="web-development-best-practices-building-real-world-cloud-apps-with-azure"></a>Лучшие практики веб-разработки (создание облачных приложений в реальном мире с помощью Azure)

[Майк Уоссон](https://github.com/MikeWasson), [Рик Андерсон](https://twitter.com/RickAndMSFT), [Том Дайкстра](https://github.com/tdykstra)

[Скачать Fix It Project](https://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4) или [скачать электронную книгу](https://blogs.msdn.com/b/microsoft_press/archive/2014/07/23/free-ebook-building-cloud-apps-with-microsoft-azure.aspx)

> **Создание облачных приложений реального мира с** электронной книгой Azure основано на презентации, разработанной Скоттом Гатри. В нем изушатся 13 шаблонов и практик, которые могут помочь вам успешно разрабатывать веб-приложения для облака. Для получения информации об электронной книге, [см.](introduction.md)

Первые три шаблона были о создании гибкого процесса разработки; остальное посвящено архитектуре и коду. Это один набор веб-разработки передового опыта:

- [Веб-серверы без состояния,](#stateless) стоящие за интеллектуальным балансом нагрузки.
- [Избегайте состояния сеанса](#sessionstate) (или если вы не можете избежать этого, используйте распределенный кэш, а не базу данных).
- [Используйте CDN](#cdn) для кэша статических файлов (изображения, скрипты).
- [Используйте поддержку async .NET 4.5,](#async) чтобы избежать блокирования вызовов.

Эти методы действительны для всех веб-разработок, а не только для облачных приложений, но они особенно важны для облачных приложений. Они работают вместе, чтобы помочь вам оптимально использовать высокогибкий масштабирование, предлагаемое облачной средой. Если вы не будете следовать этим методам, вы столкнетесь с ограничениями, когда вы попытаетесь масштабировать приложение.

<a id="stateless"></a>
## <a name="stateless-web-tier-behind-a-smart-load-balancer"></a>Веб-уровень без состояния за интеллектуальным балансером нагрузки

*Веб-уровень stateless* означает, что вы не храните данные приложения в памяти веб-сервера или файловой системе. Сохранение вашего веб-уровня абонестом позволяет как обеспечить лучший опыт клиентов и сэкономить деньги:

- Если веб-уровень не имеет апоза и находится за балансом нагрузки, вы можете быстро реагировать на изменения в трафике приложений, динамически добавляя или удаляя серверы. В облачной среде, где вы платите только за серверные ресурсы до тех пор, пока вы фактически используете их, эта способность реагировать на изменения спроса может привести к огромной экономии.
- Веб-уровень без состояния архитектурно гораздо проще масштабировать приложение. Это также позволяет быстрее реагировать на потребности в масштабировании и тратить меньше денег на разработку и тестирование.
- Облачные серверы, как и на прежневые серверы, должны время от времени исправляться и перезагружаться; и если веб-уровень является апостером, перенастройка трафика при временном сходе сервера не вызовет ошибок или неожиданного поведения.

Большинство реальных приложений должны хранить состояние для веб-сессии; Главное здесь не хранить его на веб-сервере. Состояние можно хранить другими способами, например, на клиенте в файлах cookie или вне сервера процесса в состоянии ASP.NET сеанса с помощью поставщика кэша. Вы можете хранить файлы в [хранилище Windows Azure Blob](unstructured-blob-storage.md) вместо локальной файловой системы.

В качестве примера того, как легко масштабировать приложение в веб-сайтах Windows Azure, если ваш веб-уровень не имеет апота, см. вкладку **Шкала** для веб-сайта Windows Azure на портале управления:

![Вкладка "Масштаб"](web-development-best-practices/_static/image1.png)

Если вы хотите добавить веб-серверы, вы можете просто перетащить ползунок отсчета экземпляров вправо. Установите его на 5 и нажмите **Сохранить**, и в течение нескольких секунд у вас есть 5 веб-серверов в Windows Azure обработки трафика вашего веб-сайта.

![Пять экземпляров](web-development-best-practices/_static/image2.png)

Вы можете так же легко установить отсчет экземпляра до 3 или обратно до 1. При сокращении масштабирования вы начинаете экономить деньги немедленно, потому что Windows Azure заряжается поминутно, а не по часам.

Вы также можете сказать Windows Azure, чтобы автоматически увеличить или уменьшить количество веб-серверов на основе использования процессора. В следующем примере, когда использование процессора опускается ниже 60%, количество веб-серверов сократится до минимума 2, а если использование процессора превысит 80%, количество веб-серверов будет увеличено до максимум4.

![Масштаб по использованию процессора](web-development-best-practices/_static/image3.png)

Или что делать, если вы знаете, что ваш сайт будет занят только в рабочее время? Вы можете сказать Windows Azure, чтобы запустить несколько серверов в дневное время и уменьшить до одного сервера вечеров, ночей и выходных. Следующая серия скриншотов показывает, как настроить веб-сайт для запуска одного сервера в нерабочее время и 4 сервера в рабочее время с 8 утра до 5 вечера.

![Масштаб по расписанию](web-development-best-practices/_static/image4.png)

![Установка времени расписания](web-development-best-practices/_static/image5.png)

![Дневное расписание](web-development-best-practices/_static/image6.png)

![Расписание на уик-н](web-development-best-practices/_static/image7.png)

![Расписание выходных](web-development-best-practices/_static/image8.png)

И, конечно, все это можно сделать как в сценариях, так и на портале.

Возможность масштабирования приложения практически не ограничена в Windows Azure, если вы избегаете препятствий для динамического добавления или удаления серверных ВМ, сохраняя веб-уровень без гражданства.

<a id="sessionstate"></a>
## <a name="avoid-session-state"></a>Избегайте состояния сеанса

Не хранить определенные виды состояний сеансов пользователя в реальном облачном приложении бывает нецелесообразно, но разные подходы по-разному влияют на производительность и масштабируемость. Если вам нужно хранить состояния, лучшим решением будет хранить небольшой объем состояний в файлах cookie. Если это невозможно, следующим лучшим решением является использование состояния сеанса ASP.NET с поставщиком для [распределенного кэша в памяти.](distributed-caching.md#sessionstate) Худшее решение с точки зрения масштабируемости и производительности — использовать базу данных резервного поставщика состояний сеансов.

<a id="cdn"></a>
## <a name="use-a-cdn-to-cache-static-file-assets"></a>Используйте CDN для кэша статических файлов

CDN является аббревиатурой для сети доставки контента. Вы предоставляете статичные файлохранилища, такие как изображения и файлы скриптов поставщику CDN, и поставщик кэшиэтирает эти файлы в центрах обработки данных по всему миру, так что везде, где люди получают доступ к вашему приложению, они получают относительно быстрый ответ и низкую задержку для кэшированных активов. Это ускоряет общее время загрузки сайта и снижает нагрузку на веб-серверы. CDN особенно важны, если вы достигаете аудитории, которая широко распределена географически.

Windows Azure имеет CDN, и вы можете использовать другие CDN в приложении, которое работает в Windows Azure или любой среде веб-хостинга.

<a id="async"></a>
## <a name="use-net-45s-async-support-to-avoid-blocking-calls"></a>Используйте поддержку async .NET 4.5, чтобы избежать блокирования вызовов

.NET 4.5 улучшил языки программирования C и VB, чтобы сделать его гораздо проще для обработки задач асинхронно. Преимущество асинхронного программирования заключается не только в параллельных ситуациях обработки, например, когда вы хотите начать несколько вызовов веб-службы одновременно. Это также позволяет веб-серверу работать более эффективно и надежно в условиях высокой нагрузки. Веб-сервер имеет только ограниченное количество доступных потоков, и в условиях высокой нагрузки, когда все потоки используются, входящие запросы должны ждать, пока потоки будут освобождены. Если код приложения не обрабатывает такие задачи, как запросы базы данных и вызовы веб-службы, многие потоки неоправданно связаны, пока сервер ждет ответа на ввод/о. Это ограничивает объем трафика, который сервер может обрабатывать в условиях высокой нагрузки. С асинхронным программированием потоки, ожидающие возврата данных веб-службы или базы данных, освобождаются для обслуживания новых запросов до получения данных. В занят веб-сервере сотни или тысячи запросов могут быть оперативно обработаны, что в противном случае будет ждать потоки, которые будут освобождены.

Как вы видели ранее, это так же легко уменьшить количество веб-серверов обработки веб-сайта, как это, чтобы увеличить их. Так что если сервер может достичь большей пропускной связи, вам не нужно, как многие из них, и вы можете уменьшить ваши расходы, потому что вам нужно меньше серверов для данного объема трафика, чем вы в противном случае.

Поддержка модели асинхронного программирования .NET 4.5 включена в ASP.NET 4.5 для web-форм, MVC и Web API; в рамках сущности 6 и в [API для хранения данных Windows Azure.](https://blogs.msdn.com/b/windowsazurestorage/archive/2013/07/12/introducing-storage-client-library-2-1-rc-for-net-and-windows-phone-8.aspx)

### <a name="async-support-in-aspnet-45"></a>Поддержка Async в ASP.NET 4.5

В ASP.NET 4.5 поддержка асинхронного программирования была добавлена не только к языку, но и к платформам MVC, Web Forms и Web API. Например, метод действия контроллера ASP.NET MVC получает данные из веб-запроса и передает данные в представление, которое затем создает HTML для отправки в браузер. Часто метод действия должен получать данные из базы данных или веб-службы, чтобы отобразить их на веб-странице или сохранить данные, введенные на веб-странице. В этих сценариях легко сделать метод действия асинхронным: вместо того, чтобы вернуть объект *ActionResult,* вы возвращаете *&lt;ActionResult&gt; и* помечаете метод ключевым словом *async.* Внутри метода, когда строка кода начинает операцию, которая включает время ожидания, вы пометите ее ключевым словом ожидания.

Вот простой метод действий, который вызывает метод репозитория для запроса базы данных:

[!code-csharp[Main](web-development-best-practices/samples/sample1.cs)]

И вот тот же метод, который обрабатывает вызов базы данных асинхронно:

[!code-csharp[Main](web-development-best-practices/samples/sample2.cs?highlight=1,4)]

Под крышками компилятор генерирует соответствующий асинхронный код. Когда приложение делает `FindTaskByIdAsync`вызов, ASP.NET `FindTask` делает запрос, а затем раскручивает поток рабочего и делает его доступным для обработки другого запроса. Когда `FindTask` запрос выполняется, поток перезапускается для продолжения обработки кода, который приходит после этого вызова. В течение промежуточного `FindTask` периода между тем, когда запрос инициирован и когда данные возвращаются, у вас есть поток, доступный для выполнения полезной работы, которая в противном случае была бы связана в ожидании ответа.

Есть некоторые накладные расходы для асинхронного кода, но в условиях низкой нагрузки накладные расходы незначительны, в то время как в условиях высокой нагрузки вы можете обрабатывать запросы, которые в противном случае были бы задержаны в ожидании доступных потоков.

С момента ASP.NET 1.1 можно было делать такого рода асинхронное программирование, но было трудно писать, подвержены ошибкам и трудно отладить. Теперь, когда мы упростили кодирование для него в ASP.NET 4.5, нет никаких причин не делать этого больше.

### <a name="async-support-in-entity-framework-6"></a>Поддержка Async в рамках entity 6

В рамках поддержки async в 4.5 мы отправили поддержку async для вызовов веб-служб, розеток и файловой системы вв.К., но наиболее распространенной моделью для веб-приложений является попадание в базу данных, и наши библиотеки данных не поддерживали async. Теперь Entity Framework 6 добавляет поддержку async для доступа к базе данных.

В системе Entity 6 все методы, вызывающие отправку запроса или команды в базу данных, имеют асинверсии. Пример здесь показывает версию async метода *Поиска.*

[!code-csharp[Main](web-development-best-practices/samples/sample3.cs?highlight=8)]

И эта поддержка async работает не только для вставок, удаляет, обновляет и просто находит, но и работает с запросами LIN':

[!code-csharp[Main](web-development-best-practices/samples/sample4.cs?highlight=7,10)]

Есть `Async` версия `ToList` метода, потому что в этом коде этот метод приводит к отправке запроса в базу данных. Методы `Where` только настраивать запрос, в `ToListAsync` то время как метод выполняет запрос и сохраняет ответ в переменной. `result` `OrderByDescending`

## <a name="summary"></a>Сводка

Вы можете реализовать лучшие практики веб-разработки, описанные здесь в любой среде веб-программирования и любой облачной среде, но у нас есть инструменты в ASP.NET и Windows Azure, чтобы сделать это легко. Если вы будете следовать этим шаблонам, вы можете легко масштабировать свой веб-уровень, и вы сведете к минимуму свои расходы, потому что каждый сервер будет в состоянии обрабатывать больше трафика.

В [следующей главе](single-sign-on.md) рассматривается, как облако позволяет создавать отдельные сценарии.

## <a name="resources"></a>Ресурсы

Для получения дополнительной информации см.

Веб-серверы без гражданства:

- [Шаблоны и практики Microsoft - Руководство по автомасштабированию](https://msdn.microsoft.com/library/dn589774.aspx).
- [Отключение ARR в инстанции Аффинити в Windows Azure веб-сайтов](https://azure.microsoft.com/blog/2013/11/18/disabling-arrs-instance-affinity-in-windows-azure-web-sites/). Блог Эрез Бенари, объясняет сродство сессии в Windows Azure веб-сайтов.

Cdn:

- [FailSafe: Создание масштабируемых и устойчивых облачных служб.](https://channel9.msdn.com/Series/FailSafe) Девятисерийный сериал Ульриха Хомана, Марка Меркури и Марка Симмса. Смотрите обсуждение CDN в эпизоде 3, начиная с 1:34:00.
- [Шаблоны microsoft и методы статического хостинга контента](https://msdn.microsoft.com/library/dn589776.aspx)
- [CDN Отзывы](http://www.cdnreviews.com/). Обзор многих CDN.

Асинхронное программирование:

- [Использование асинхронных методов в ASP.NET MVC 4](../../../../mvc/overview/performance/using-asynchronous-methods-in-aspnet-mvc-4.md). Учебник Рика Андерсона.
- [Асинхронное программирование с Async и Await (C и Visual Basic)](https://msdn.microsoft.com/library/vstudio/hh191443.aspx). Информационный документ MSDN, в который разъясняют обоснование асинхронного программирования, как оно работает в ASP.NET 4.5, и как писать код для его реализации.
- [Система Async Async Запрос и сохранение](https://msdn.microsoft.com/data/jj819165)
- [Как построить ASP.NET веб-приложений с помощью Async](https://channel9.msdn.com/Events/TechEd/NorthAmerica/2013/DEV-B337#fbid=tgkT4SR_DK7). Видеопрезентация Роуэна Миллера. Включает в себя графическую демонстрацию того, как асинхронное программирование может способствовать резкому увеличению пропускной всей проходики веб-сервера в условиях высокой нагрузки.
- [FailSafe: Создание масштабируемых и устойчивых облачных служб.](https://channel9.msdn.com/Series/FailSafe) Девятисерийный сериал Ульриха Хомана, Марка Меркури и Марка Симмса. Для обсуждения влияния асинхронного программирования на масштабируемость см.
- [Магия использования асинхронных методов в ASP.NET 4,5 плюс важный gotcha](http://www.hanselman.com/blog/TheMagicOfUsingAsynchronousMethodsInASPNET45PlusAnImportantGotcha.aspx). Блог сообщение Скотт Hanselman, в первую очередь об использовании async в ASP.NET Web Forms приложений.

Дополнительные рекомендации веб-разработки можно узнать из следующих ресурсов:

- [Исправить его пример применения - Лучшие практики](the-fix-it-sample-application.md#bestpractices). В приложении к этой электронной книге перечислен ряд рекомендаций, которые были реализованы в приложении Fix It.
- [Контрольный список веб-разработчиков](http://webdevchecklist.com/asp.net)

> [!div class="step-by-step"]
> [Назад](continuous-integration-and-continuous-delivery.md)
> [Вперед](single-sign-on.md)
