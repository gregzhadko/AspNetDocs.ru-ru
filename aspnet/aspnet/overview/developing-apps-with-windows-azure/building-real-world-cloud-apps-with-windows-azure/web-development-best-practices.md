---
uid: aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/web-development-best-practices
title: Веб-рекомендации по разработке (Создание реальных облачных приложений в Azure) | Документация Майкрософт
author: MikeWasson
description: Создание реальных облачных приложений в условиях электронная книга основана на презентацию, разработанная Скоттом Гатри. Здесь объясняется, 13 шаблонов и практических рекомендаций, которые он может...
ms.author: riande
ms.date: 06/12/2014
ms.assetid: 52d6c941-2cd9-442f-9872-2c798d6d90cd
msc.legacyurl: /aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/web-development-best-practices
msc.type: authoredcontent
ms.openlocfilehash: 930b9be35ef2e0dd85cee8f6584b9e90c80933b9
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/01/2019
ms.locfileid: "57029231"
---
<a name="web-development-best-practices-building-real-world-cloud-apps-with-azure"></a>Рекомендации по разработке Web (Создание реальных облачных приложений в Azure)
====================
по [Майк Уоссон](https://github.com/MikeWasson), [Рик Андерсон]((https://twitter.com/RickAndMSFT)), [том Дайкстра](https://github.com/tdykstra)

[Загрузить решение проект](http://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4) или [скачайте электронную книгу](http://blogs.msdn.com/b/microsoft_press/archive/2014/07/23/free-ebook-building-cloud-apps-with-microsoft-azure.aspx)

> **Создание реальных облачных приложений в условиях Azure** электронная книга основана на презентацию, разработанная Скоттом Гатри. Здесь объясняется 13 шаблоны и рекомендации, которые помогут вам быть в успешном развертывании веб-приложений для облака. Сведения о книге, см. в разделе [первой главы](introduction.md).


Первые три шаблоны были о настройке гибкого процесса разработки; остальные являются об архитектуре и кода. Это — это набор рекомендаций по разработке web:

- [Веб-серверов](#stateless) балансировщиком нагрузки smart.
- [Избежать состояния сеанса](#sessionstate) (или если невозможно обойти его, использовать распределенный кэш, а не базу данных).
- [CDN-именем](#cdn) для пограничного кэша статических файловых ресурсов (изображений, сценариев).
- [Использовать асинхронную поддержку .NET 4.5](#async) во избежание блокирующих вызовов.

Эти рекомендации являются допустимыми для всех веб-разработки, не только для облачных приложений, но они особенно важно для облачных приложений. Они работают вместе для обеспечения оптимального использования высокой гибкого масштабирования, предлагаемые в облачную среду. При несоблюдении этих рекомендаций, вы будете запускать с ограничениями при масштабировании приложения.

<a id="stateless"></a>
## <a name="stateless-web-tier-behind-a-smart-load-balancer"></a>Без отслеживания состояния веб-уровня с подсистемой балансировки нагрузки смарт-

*Без отслеживания состояния веб-уровня* означает, что вы не храните данные приложения в систему памяти или в файле веб-сервера. Сохранение без отслеживания состояния на веб-уровне позволяет улучшить качество обслуживания клиентов и сэкономить деньги.

- Если веб-уровня без отслеживания состояния, и он находится за подсистемой балансировки нагрузки, можно быстро реагировать на изменения в приложение трафика можно динамически добавлять или удалять серверы. В облачной среде, где вы платите только за ресурсы сервера для до тех пор, пока вы используете их что способность реагировать на изменения спроса можно перевести на огромная экономия.
- Без отслеживания состояния веб-уровня с точки зрения архитектуры гораздо проще масштабировать приложение. Слишком позволяет реагировать на быстро удовлетворения потребностей в масштабировании и сократите свои расходы на разработку и тестирование в процессе.
- Серверы, облака, например на локальных серверах, необходимо исправить и время от времени; перезагружать а если веб-уровня без отслеживания состояния, маршрутизацию трафика, когда сервер временно отключается не вызывают ошибки или непредвиденное поведение.

Большинство реальных приложений требуется для хранения состояния для веб-сеанса; самое главное здесь является не хранение его на веб-сервере. Можно хранить состояние другими способами, например, на клиенте в файлах cookie или вне процесса на сервере в состоянии сеанса ASP.NET с помощью поставщика кэша. Вы можете хранить файлы в [хранилища больших двоичных объектов Windows Azure](unstructured-blob-storage.md) вместо локальной файловой системе.

Как пример того, насколько это просто масштабирование приложения в Windows Azure Web Sites, если на веб-уровне без отслеживания состояния, см. в разделе **масштабирования** вкладку для Windows Azure веб-сайта на портале управления:

![Вкладка "масштаб"](web-development-best-practices/_static/image1.png)

Если вы хотите добавить веб-серверов, можно просто перетащите ползунок число экземпляра справа. Задайте для него значение 5 и нажмите кнопку **Сохранить**, и в течение нескольких секунд у вас есть 5 веб-серверов в Windows Azure, обработки трафика веб сайта.

![Пять экземпляров](web-development-best-practices/_static/image2.png)

Можно просто задать число экземпляров до 3 или до 1. При масштабировании назад, вы начинаете экономить деньги сразу, так как Windows Azure, Оплата по минутам, не по часам.

Можно также сообщить Windows Azure, чтобы автоматически увеличивать или уменьшать количество веб-серверы, на основе использования ЦП. В следующем примере когда загрузка ЦП опускается ниже 60%, число веб-серверов уменьшится до минимального значения 2 и увеличивается, если загрузка ЦП превышает 80%, число веб-серверов не более 4.

![Масштабирование по ЦП](web-development-best-practices/_static/image3.png)

Или, что делать, если вы знаете, что сайт будет только занятости в рабочее время? Чтобы узнать Windows Azure для запуска нескольких серверов во время излишнему повышению нагрузки и уменьшить в односерверной числе по вечерам, вечера или даже ночи и выходные. Следующий набор снимков экрана показано, как настроить веб-сайт для запуска на одном сервере в нерабочие часы и 4 серверов во время работы с 8: 00 до 17: 00.

![Масштабирование по расписанию.](web-development-best-practices/_static/image4.png)

![Задание значений времени расписания](web-development-best-practices/_static/image5.png)

![Дневное расписание](web-development-best-practices/_static/image6.png)

![Расписание weeknight](web-development-best-practices/_static/image7.png)

![Расписание выходные дни](web-development-best-practices/_static/image8.png)

И Конечно все это можно сделать в скриптах, а также как и на портале.

Горизонтальное масштабирование приложения является увлеченным Windows Azure, до тех пор, пока избежать препятствия на пути к динамически Добавление или удаление виртуальных машин сервера, сохраняя без отслеживания состояния веб-уровня.

<a id="sessionstate"></a>
## <a name="avoid-session-state"></a>Избежать состояния сеанса

Часто не рекомендуется в реальном облачном приложении не хранить определенные виды состояний сеанса пользователя, но некоторые подходы повлиять на производительность и масштабируемость чаще, чем другие. Если для хранения состояния, лучшим решением является небольшой объем состояния и в файлах cookie. Если это невозможно, лучшей альтернативой является использование состояния сеанса ASP.NET с помощью поставщика для [распределенный кэш в памяти](distributed-caching.md#sessionstate). Худшее решение с точки зрения масштабируемости и производительности — использовать базу данных резервного поставщика состояний сеансов.

<a id="cdn"></a>
## <a name="use-a-cdn-to-cache-static-file-assets"></a>Использование CDN для кэширования статических файловых ресурсов

CDN — это сокращение от сети доставки содержимого. Вы вводите статических файловых ресурсов, таких как изображения и файлы скриптов с поставщиком CDN, а поставщик кэширует эти файлы в центрах обработки данных по всему миру, таким образом, чтобы везде, где пользователи получить доступ к приложению, они получают относительно быстрого ответа и низкой задержкой для кэшированного ресурсы. Это ускоряет общее время загрузки веб-узла и уменьшает нагрузку на веб-серверов. CDN особенно важны в тех случаях, если производится доступ аудитории, широко распространенный географически.

Windows Azure CDN, и другие CDN можно использовать в приложении, которое выполняется в Windows Azure или в любой среде веб-размещения.

<a id="async"></a>
## <a name="use-net-45s-async-support-to-avoid-blocking-calls"></a>Используйте Поддержка асинхронного выполнения .NET 4.5, чтобы избежать блокирующих вызовов

.NET 4.5 усиленной языков программирования C# и VB, чтобы существенно упростить асинхронная обработка задач. Преимущества асинхронного программирования не только для параллельной обработки ситуациях, например, если вы хотите одновременно запускать несколько вызовов веб-службы. Он также позволяет веб-сервера для более эффективного выполнения и надежных в условиях высокой нагрузки. Веб-сервер имеет только ограниченное число потоков, доступных, и в условиях высокой нагрузки при все потоки заняты, входящие запросы придется ждать, пока не будут высвобождены потоки. Если код приложения не обрабатывает задач, таких как базы данных запросов и вызовов веб-службы асинхронно, много потоков без необходимости привязаны, пока сервер ожидает ответ ввода-вывода. Это ограничивает объем трафика, который может обработать сервер в условиях высокой нагрузки. В асинхронном программировании потоков, ожидающих веб-службы или базы данных для возвращения данных освобождаются до обслуживания новых запросов до данных получен. В занят веб-сервера сотни или тысячи запросов затем может обрабатываться немедленно которых в противном случае пришлось бы ждать потоков освободить.

Как было показано ранее, это так же просто сократить количество веб-серверов, обработка веб-сайт, как увеличить их. Поэтому если сервер может обеспечить более высокую пропускную способность, нет необходимости как многие из них и позволяет сократить расходы, так как требуется меньшее количество серверов для тома данного трафика, чем в противном случае.

Поддержка модели асинхронного программирования .NET 4.5 входит в ASP.NET 4.5 для веб-форм, MVC и веб-API; в Entity Framework 6, а в [Windows API службы хранилища Azure](https://blogs.msdn.com/b/windowsazurestorage/archive/2013/07/12/introducing-storage-client-library-2-1-rc-for-net-and-windows-phone-8.aspx).

### <a name="async-support-in-aspnet-45"></a>Поддержка асинхронного выполнения в ASP.NET 4.5

В ASP.NET 4.5 поддержка для асинхронного программирования был добавлен не только для языка, но также для платформы MVC, веб-форм и веб-API. Например метода действия контроллера ASP.NET MVC получает данные из веб-запроса и передает данные в представление, после чего будет создан код HTML, отправляемого в браузер. Часто метод действия должен получить данные из базы данных или веб-службы для отображения на веб-странице или сохранять данные, введенные в веб-страницы. В этих случаях проще сделать асинхронного метода действия: вместо возвращения *ActionResult* возвращаемого вами объекта *задачи&lt;ActionResult&gt;*  и пометить метод с помощью *async* ключевое слово. Внутри метода Если строка кода запускает операцию, которая включает в себя время ожидания его пометить с ключевым словом await.

Ниже приведен простой метод действия, вызывающего метод репозиторий для запроса к базе данных.

[!code-csharp[Main](web-development-best-practices/samples/sample1.cs)]

А вот тот же метод, который асинхронно обрабатывает обращение к базе данных:

[!code-csharp[Main](web-development-best-practices/samples/sample2.cs?highlight=1,4)]

На самом деле компилятор создает соответствующий код с асинхронными вызовами. Если приложение выполняет вызов `FindTaskByIdAsync`, ASP.NET предоставляет `FindTask` запроса, а затем освобождает рабочего потока и делает его доступным для обработки другого запроса. Когда `FindTask` выполняется запрос, поток перезагружается для продолжения обработки кода, которое идет после этого вызова. Во время промежутке между удалением `FindTask` отправляет запрос и при возврате данных, у вас есть поток для выполнения требуемых задач, которые в противном случае может быть объединено для ответа.

Есть некоторые издержки для асинхронного кода, но в условиях низкой нагрузкой, эти издержки не пренебречь в условиях высокой нагрузкой, которые вы можете обрабатывать запросы, которые в противном случае будет находится в ожидании доступных потоков.

Ее можно выполнить такого рода асинхронного программирования с ASP.NET 1.1, но было трудно писать, ошибкам и трудно отладить. Теперь, когда мы упростили названия, написание кода для него в ASP.NET 4.5, нет причин не этим заниматься.

### <a name="async-support-in-entity-framework-6"></a>Поддержка асинхронного выполнения в Entity Framework 6

В рамках поддержки асинхронности в 4.5 мы выпустили поддержка асинхронных вызовов веб-службы, сокеты и файловой системы ввода-вывода, но самый распространенный шаблон для веб-приложений – нажать кнопку базы данных и наших данных библиотеки не поддерживают async. Теперь Entity Framework 6 добавляет поддержку async для доступа к базе данных.

В Entity Framework 6 все методы, вызывающие запроса или команды, отправляемые в базу данных имеют версии async. В примере ниже показано асинхронная версия *найти* метод.

[!code-csharp[Main](web-development-best-practices/samples/sample3.cs?highlight=8)]

И эта поддержка async работает не только для операции вставки, удаления, обновления и простых находит, она также работает с запросами LINQ.

[!code-csharp[Main](web-development-best-practices/samples/sample4.cs?highlight=7,10)]

Существует `Async` версии `ToList` метод так, как в этом коде это метод, который завершает запрос, отправляемый в базу данных. `Where` И `OrderByDescending` методы только Настройка запроса, хотя `ToListAsync` метод выполняет запрос и сохраняет ответ в `result` переменной.

## <a name="summary"></a>Сводка

Вы можете реализовать рекомендации по веб-разработке, описанную в любой веб-программирования, платформы и любой облачной среде, но у нас есть средства в ASP.NET и Windows Azure, чтобы упростить процесс. При выполнении этих шаблонов вы можете легко выполнить развертывание на веб-уровне, и будет свести к минимуму расходы, так как каждый сервер будет иметь возможность обрабатывать больше трафика.

[Следующей главе](single-sign-on.md) рассматривает как облако позволяет сценариев единого входа.

## <a name="resources"></a>Ресурсы

Дополнительные сведения см. следующие ресурсы.

Веб-серверов:

- [Рекомендации — руководство по автоматическому масштабированию](https://msdn.microsoft.com/library/dn589774.aspx).
- [Отключение ARR экземпляра сопоставление и в Windows Azure Web Sites](https://azure.microsoft.com/blog/2013/11/18/disabling-arrs-instance-affinity-in-windows-azure-web-sites/). В блоге по Benari получения Описывает сходства сеансов в Windows Azure Web Sites.

CDN:

- [Отказоустойчивость. Построение масштабируемых, надежных облачных служб](https://channel9.msdn.com/Series/FailSafe). Серия видеоматериалов девяти частей, Ульрих Хоманн, Марк Меркьюри и (Mark simms). См. в обсуждении CDN эпизод 3, начиная с 1:34:00.
- [Шаблон Microsoft шаблоны и методики размещение статического содержимого](https://msdn.microsoft.com/library/dn589776.aspx)
- [Обзоры CDN](http://www.cdnreviews.com/). Общие сведения о многих CDN.

Асинхронное программирование:

- [Использование асинхронных методов в ASP.NET MVC 4](../../../../mvc/overview/performance/using-asynchronous-methods-in-aspnet-mvc-4.md). Учебник по Рик Андерсон.
- [Асинхронное программирование с помощью Async и Await (C# и Visual Basic)](https://msdn.microsoft.com/library/vstudio/hh191443.aspx). Технический документ MSDN объяснением обоснование для асинхронного программирования, как она работает в ASP.NET 4.5 и как написать код для его реализации.
- [Entity Framework асинхронный запрос и сохранить](https://msdn.microsoft.com/data/jj819165)
- [Как создать веб-приложений ASP.NET с помощью Async](https://channel9.msdn.com/Events/TechEd/NorthAmerica/2013/DEV-B337#fbid=tgkT4SR_DK7). Видеопрезентация Роуэн Миллер. Включает в себя графических демонстрацию асинхронного программирования может упростить существенно увеличивает пропускную способность в условиях высокой нагрузки.
- [Отказоустойчивость. Построение масштабируемых, надежных облачных служб](https://channel9.msdn.com/Series/FailSafe). Серия видеоматериалов девяти частей, Ульрих Хоманн, Марк Меркьюри и (Mark simms). Для обсуждения о влиянии асинхронного программирования на масштабируемость см. в статье серии 4 и 8 эпизод.
- [Использование асинхронных методов в ASP.NET 4.5, а также важные подводный Магия](http://www.hanselman.com/blog/TheMagicOfUsingAsynchronousMethodsInASPNET45PlusAnImportantGotcha.aspx). Запись блога, Скотт Хансельман, главным образом, об использовании async в приложениях веб-форм ASP.NET.

Рекомендации по разработке дополнительных web см. следующие ресурсы:

- [Исправление пример приложения — рекомендации по](the-fix-it-sample-application.md#bestpractices). Приложение для этой электронной книге рассматривается ряд рекомендаций, которые были реализованы в приложении Fix It.
- [Контрольный список разработчика Web](http://webdevchecklist.com/asp.net)

> [!div class="step-by-step"]
> [Назад](continuous-integration-and-continuous-delivery.md)
> [Вперед](single-sign-on.md)
