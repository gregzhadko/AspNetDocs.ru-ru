---
uid: aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/unstructured-blob-storage
title: Хранилище неструктурированных BLOB-объектов (Создание реальных облачных приложений в Azure) | Документация Майкрософт
author: MikeWasson
description: Создание реальных облачных приложений в условиях электронная книга основана на презентацию, разработанная Скоттом Гатри. Здесь объясняется, 13 шаблонов и практических рекомендаций, которые он может...
ms.author: riande
ms.date: 03/30/2015
ms.assetid: 9f05ccb1-2004-4661-ad8b-c370e6c09c8e
msc.legacyurl: /aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/unstructured-blob-storage
msc.type: authoredcontent
ms.openlocfilehash: 8148891f68ac8417400859540516e44be007dab7
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2019
ms.locfileid: "65118314"
---
# <a name="unstructured-blob-storage-building-real-world-cloud-apps-with-azure"></a>Хранилище неструктурированных BLOB-объектов (Создание реальных облачных приложений в Azure)

по [Майк Уоссон](https://github.com/MikeWasson), [Рик Андерсон]((https://twitter.com/RickAndMSFT)), [том Дайкстра](https://github.com/tdykstra)

[Загрузить решение проект](http://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4) или [скачайте электронную книгу](http://blogs.msdn.com/b/microsoft_press/archive/2014/07/23/free-ebook-building-cloud-apps-with-microsoft-azure.aspx)

> **Создание реальных облачных приложений в условиях Azure** электронная книга основана на презентацию, разработанная Скоттом Гатри. Здесь объясняется 13 шаблоны и рекомендации, которые помогут вам быть в успешном развертывании веб-приложений для облака. Сведения о книге, см. в разделе [первой главы](introduction.md).

В предыдущей главе мы рассмотрели схем секционирования и описано, как приложение Fix It хранит образы в службе BLOB-объектов хранилища Azure и другие данные задач в базе данных SQL Azure. В этой главе мы выполнить более глубокий службы BLOB-объектов и показать, как это реализуется в коде проекта Fix It.

## <a name="what-is-blob-storage"></a>Что такое хранилище BLOB-объектов?

Служба BLOB-объектов хранилища Azure предоставляет способ хранения файлов в облаке. Служба BLOB-объектов имеет ряд преимуществ по сравнению с хранение файлов в файловой системе локальной сети:

- Он имеет высокую степень масштабируемости. Можно хранить в одной учетной записи хранения [сотни терабайт](https://msdn.microsoft.com/library/windowsazure/dn249410.aspx), и у вас есть несколько учетных записей хранения. Некоторые из самых больших клиентам Azure хранят сотни петабайтов. Microsoft SkyDrive использует хранилище BLOB-объектов.
- Он является устойчивой. Автоматически архивируются каждый файл, которые хранятся в службе BLOB-объектов.
- Он обеспечивает высокий уровень доступности. [Соглашение об уровне ОБСЛУЖИВАНИЯ для хранилища](https://go.microsoft.com/fwlink/p/?linkid=159705&amp;clcid=0x409) обещания 99,9% или 99,99% время, в зависимости от выбранного варианта географическая избыточность выберите.
- Это функция платформы как службы (PaaS) Azure, который означает, что вы только что хранения и извлечения файлов, оплачивая только фактический объем хранилища, вы используете, и автоматически отвечает за настройкой и управлением все виртуальные машины и диски, необходимые для Azure Служба.
- Можно получить доступ к службе BLOB-объектов, с помощью REST API или на любом языке программирования API. Пакеты SDK доступны для .NET, Java, Ruby и другим пользователям.
- При сохранении файла в службе BLOB-объектов можно легко вносить его общедоступным через Интернет.
- Вы можете защитить файлы в BLOB-объектов, доступ к службе, поэтому они могут получить только авторизованными пользователями, или можно предоставить временный доступ маркеры, которые становятся доступными другому пользователю только в течение ограниченного периода времени.

Каждый раз, когда вы создаете приложение для Azure и вы хотите хранить большие объемы данных, в локальной среде будет обрабатываться в файлов, таких как изображения, видео, документы PDF, электронные таблицы, и т.д. — рассмотрим службу BLOB-объектов.

## <a name="creating-a-storage-account"></a>Создание учетной записи хранения

Чтобы приступить к работе со службой BLOB-объектов создайте учетную запись хранения в Azure. На портале, щелкните **New** -- **Data Services** -- **хранения** -- **быстрое создание**, а затем введите URL-адрес и расположение центра обработки данных. Расположение центра обработки данных должен быть таким же, как веб-приложения.

![Создание учетная запись хранения](unstructured-blob-storage/_static/image1.png)

Выбрать основной регион место для хранения содержимого, а если вы выберите [георепликации](https://blogs.msdn.com/b/windowsazurestorage/archive/2013/12/11/introducing-read-access-geo-replicated-storage-ra-grs-for-windows-azure-storage.aspx#_Geo_Redundant_Storage) параметр, Azure создает реплики для всех данных в другом центре обработки данных в другой регион страны. Например при выборе центра обработки данных Западная часть США, при сохранении файла, что было сделано в центр обработки данных Западная часть США, но в фоновом режиме Azure также копирует его к одному из других центрах обработки данных США. В случае аварии в пределах одного региона, страны, данные можно по-прежнему безопасно.

Azure не будет реплицировать данные через границы геополитического: при исходном расположении в США, файлы только реплицируются в другой регион в США; Если основное Австралии, файлы только реплицируются в другой центр обработки данных в Австралии.

Само собой также можно создать учетную запись хранения, выполнив команды с помощью скрипта, как было показано ранее. Вот команда Windows PowerShell для создания учетной записи хранения:

[!code-powershell[Main](unstructured-blob-storage/samples/sample1.ps1)]

Получив учетную запись хранения, можно немедленно начать хранения файлов в службе BLOB-объектов.

## <a name="using-blob-storage-in-the-fix-it-app"></a>Использование хранилища BLOB-объектов в приложении Fix It

Приложение Fix It позволяет выполнять отправку фотографий.

![Создание задачи Fix It](unstructured-blob-storage/_static/image2.png)

При нажатии кнопки **создать FixIt**, приложение передает файл указанное изображение и сохраняет его в службе BLOB-объектов.

### <a name="set-up-the-blob-container"></a>Настроить контейнер больших двоичных объектов

Для хранения файла в службе BLOB-объектов, вам потребуется *контейнера* сохранит их в. Контейнер больших двоичных объектов службы соответствует папке файловой системы. Скрипты создания среды, которые мы рассмотрели в [автоматизировать все, что глава](automate-everything.md) учетная запись хранения, но они не создать контейнер. Поэтому цель `CreateAndConfigure` метод `PhotoService` является класс, чтобы создать контейнер, если он еще не существует. Этот метод вызывается из `Application_Start` метод в *Global.asax*.

[!code-csharp[Main](unstructured-blob-storage/samples/sample2.cs)]

Ключ имени и учетной записи хранения хранятся в `appSettings` коллекцию *Web.config* файла и код в `StorageUtils.StorageAccount` метод использует эти значения для создания строки подключения и установить подключение:

[!code-csharp[Main](unstructured-blob-storage/samples/sample3.cs)]

`CreateAndConfigureAsync` Затем метод создает объект, представляющий службу BLOB-объект и объект, представляющий контейнер (папку) с именем «изображения» в службе BLOB-объектов:

[!code-csharp[Main](unstructured-blob-storage/samples/sample4.cs)]

Если контейнер с именем «images» еще не создан--которого будет иметь значение true, в первый раз, при запуске приложения с новой учетной записи хранения — код создает контейнер и задает разрешения, чтобы сделать его общедоступным. (По умолчанию новые контейнеры больших двоичных объектов являются закрытыми и доступны только пользователям, имеющим разрешение на доступ к вашей учетной записи хранения.)

[!code-csharp[Main](unstructured-blob-storage/samples/sample5.cs)]

### <a name="store-the-uploaded-photo-in-blob-storage"></a>Store переданная фотография в хранилище BLOB-объектов

Для загрузки и сохранения файла изображения, приложение использует `IPhotoService` интерфейс и реализацию интерфейса в `PhotoService` класса. *PhotoService.cs* файл содержит весь код в Fix It приложение, которое взаимодействует со службой BLOB-объектов.

Следующий метод контроллера MVC вызывается, когда пользователь щелкает **создать FixIt**. В этом коде `photoService` ссылается на экземпляр `PhotoService` класса, и `fixittask` ссылается на экземпляр `FixItTask` класс сущностей, который хранит данные для новой задачи.

[!code-csharp[Main](unstructured-blob-storage/samples/sample6.cs?highlight=8)]

`UploadPhotoAsync` Метод в `PhotoService` класс хранит загруженный файл в службе BLOB-объектов и возвращает URL-адрес, который указывает новый большой двоичный объект.

[!code-csharp[Main](unstructured-blob-storage/samples/sample7.cs)]

Как и в `CreateAndConfigure` метод, код подключается к учетной записи хранения и создает объект, представляющий контейнер больших двоичных объектов «образы», за исключением того, здесь его предполагается, что контейнер уже существует.

Затем он создает уникальный идентификатор для образа должна быть загружена, объединяя новое значение GUID с расширением файла:

[!code-csharp[Main](unstructured-blob-storage/samples/sample8.cs)]

Затем код использует объект-контейнер больших двоичных объектов и новый уникальный идентификатор для создания большого двоичного объекта, задает атрибут для этого объекта, указывающее, какого рода файл его, а затем использует большой двоичный объект для хранения файла в хранилище BLOB-объектов.

[!code-csharp[Main](unstructured-blob-storage/samples/sample9.cs)]

Наконец он получает URL-адрес, ссылающийся на большой двоичный объект. Этот URL-адрес будет храниться в базе данных и может использоваться для отображения переданного изображения в Fix It веб-страниц.

[!code-csharp[Main](unstructured-blob-storage/samples/sample10.cs)]

Этот URL-адрес сохраняется в базе данных как один из столбцов таблицы FixItTask.

[!code-csharp[Main](unstructured-blob-storage/samples/sample11.cs?highlight=10)]

Только URL-адрес в базе данных и изображений в хранилище BLOB-объектов приложение Fix It позволяет базе данных небольшими, масштабируемое и недорогое, тогда как образы хранятся где хранилища является дешевым и может обрабатывать терабайты и петабайты. Одна учетная запись хранения можно хранить сотни терабайт Fix It фотографий, и вы платите только за использование. Таким образом можно начать небольшой платной версии 9 центов за гигабайт первый и добавить дополнительные образы для пенсов за дополнительный гигабайт.

### <a name="display-the-uploaded-file"></a>Отобразить отправленный файл

Приложение Fix It отображает файл, отправленный образ при его отображении сведения о задаче.

![Исправить сведения о задаче с помощью photo](unstructured-blob-storage/_static/image3.png)

Для отображения изображения, все представления MVC приходится делать это включают `PhotoUrl` значение в формате HTML, отправляемых в браузер. Веб-сервера и базы данных не используется циклов для отображения изображения, они только применяете несколько байтов в URL-адрес изображения. В следующем коде Razor `Model` ссылается на экземпляр `FixItTask` класс сущностей.

[!code-cshtml[Main](unstructured-blob-storage/samples/sample12.cshtml?highlight=11)]

Если взглянуть на страницы, которая отображает HTML-код, вы увидите адрес URL, указывающий на изображение в хранилище BLOB-объектов, примерно так:

[!code-cshtml[Main](unstructured-blob-storage/samples/sample13.cshtml?highlight=11)]

## <a name="summary"></a>Сводка

Вы видели, как приложение Fix It хранит образы в службе BLOB-объектов и только URL-адресов изображений в базе данных SQL. С помощью службы BLOB-объектов в базу данных SQL сохраняет намного меньше, чем его в противном случае было бы, дает возможность использовать масштабироваться с учетом практически неограниченное количество задач и можно выполнить без написания большого объема кода.

В учетной записи хранения может быть сотни терабайт и затраты на хранение гораздо дешевле, чем хранилище базы данных SQL, начиная с примерно 3 центов за гигабайт в месяц плюс счет небольших транзакций. И имейте в виду, что вы платите, не максимальной емкости, но только в течение интервала, который фактически хранятся, поэтому приложение будет готово для масштабирования, но вы не платите для всех, дополнительная емкость.

В [следующей главе](design-to-survive-failures.md) мы поговорим о важности использования облачного приложения может корректно обрабатывать сбои.

## <a name="resources"></a>Ресурсы

Дополнительные сведения см. следующие ресурсы:

- [Введение в хранилище больших двоичных ОБЪЕКТОВ](https://www.simple-talk.com/cloud/cloud-data/an-introduction-to-windows-azure-blob-storage-/). Блог Майка дерева.
- [Как использовать службу хранилища BLOB-объектов Azure в .NET](https://docs.microsoft.com/azure/storage/blobs/storage-dotnet-how-to-use-blobs). Официальная документация на сайте MicrosoftAzure.com. Краткое введение в следуют примеры кода, показывающий, как подключаться к хранилищу BLOB-объектов, хранилище BLOB-объектов создавать контейнеры, отправка и скачивание больших двоичных объектов и т. д.
- [Отказоустойчивость. Построение масштабируемых, надежных облачных служб](https://channel9.msdn.com/Series/FailSafe). Серия видеоматериалов девяти частей, Ульрих Хоманн, Марк Меркьюри и (Mark simms). Отображает высокоуровневых концепциях и архитектурные принципы очень доступен и интересным способом, истории, извлеченных из консультационной группой Microsoft клиентов (CAT) опыт работы с реальными клиентами. Описание службы хранилища Azure и большие двоичные объекты см. в разделе эпизод 5, начиная с 35:13.
- [Microsoft Patterns and Practices — руководство по Azure](https://msdn.microsoft.com/library/dn568099.aspx). Шаблон ключа Камердинера см. в разделе.

> [!div class="step-by-step"]
> [Назад](data-partitioning-strategies.md)
> [Вперед](design-to-survive-failures.md)
