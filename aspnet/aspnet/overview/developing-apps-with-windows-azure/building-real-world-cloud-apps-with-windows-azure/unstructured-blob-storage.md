---
uid: aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/unstructured-blob-storage
title: Неструктурированное хранилище BLOB-объектов (создание облачных приложений в реальном мире с помощью Azure) | Документация Майкрософт
author: MikeWasson
description: Создание реальных облачных приложений с помощью электронной книги Azure основано на презентации, разработанной Скотт Гатри (. В нем объясняются 13 шаблонов и методик, которые могут...
ms.author: riande
ms.date: 03/30/2015
ms.assetid: 9f05ccb1-2004-4661-ad8b-c370e6c09c8e
msc.legacyurl: /aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/unstructured-blob-storage
msc.type: authoredcontent
ms.openlocfilehash: f48b2be755b84dff9b2672bd348c73107602c6dd
ms.sourcegitcommit: 7709c0a091b8d55b7b33bad8849f7b66b23c3d72
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/19/2020
ms.locfileid: "77456795"
---
# <a name="unstructured-blob-storage-building-real-world-cloud-apps-with-azure"></a>Неструктурированное хранилище BLOB-объектов (создание облачных приложений в реальном мире с помощью Azure)

[Майк Уоссон](https://github.com/MikeWasson), [Рик Андерсон (](https://twitter.com/RickAndMSFT), том [Dykstra)](https://github.com/tdykstra)

[Скачивание решения ИТ-проекта](https://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4) или [Загрузка электронной книги](https://blogs.msdn.com/b/microsoft_press/archive/2014/07/23/free-ebook-building-cloud-apps-with-microsoft-azure.aspx)

> **Создание реальных облачных приложений с помощью** электронной книги Azure основано на презентации, разработанной Скотт Гатри (. В нем объясняются 13 шаблонов и методик, которые могут помочь в успешной разработке веб-приложений для облака. Сведения о электронной книге см. [в первой главе](introduction.md).

В предыдущей главе мы рассматривали схемы секционирования и объяснили, как приложение для устранения проблем сохраняет изображения в службе Azure Storage Blob и другие данные задач в базе данных SQL Azure. В этой главе мы подробно рассмотрим службу BLOB-объектов и покажем, как она реализована в разделе Исправление кода ИТ-проекта.

## <a name="what-is-blob-storage"></a>Что такое хранилище BLOB-объектов?

Служба Azure Storage Blob предоставляет способ хранения файлов в облаке. Служба BLOB-объектов имеет ряд преимуществ по сравнению с хранением файлов в локальной сетевой файловой системе:

- Это очень масштабируемая. Одна учетная запись хранения может хранить [сотни терабайт](https://msdn.microsoft.com/library/windowsazure/dn249410.aspx), и у вас может быть несколько учетных записей хранения. Некоторые из крупнейших клиентов Azure хранят сотни петабайтов. Microsoft SkyDrive использует хранилище BLOB-объектов.
- Это устойчивое. Резервное копирование всех файлов, хранящихся в службе BLOB-объектов, выполняется автоматически.
- Он обеспечивает высокий уровень доступности. [Соглашение об уровне обслуживания для хранилища](https://go.microsoft.com/fwlink/p/?linkid=159705&amp;clcid=0x409) обещает 99,9% или 99,99% времени работы в зависимости от выбранного варианта геоизбыточности.
- Это функция платформы как услуги (PaaS) в Azure. Это означает, что вы просто храните и извлечете файлы, платите только за фактический объем хранилища, и Azure автоматически следит за настройкой и управлением всеми виртуальными машинами и дисками, необходимыми для служеб.
- Доступ к службе BLOB-объектов можно получить с помощью REST API или API языка программирования. Пакеты SDK доступны для .NET, Java, Ruby и других.
- При сохранении файла в службе BLOB-объектов можно легко сделать его общедоступным через Интернет.
- Вы можете защитить файлы в службе BLOB-объектов, чтобы они могли обращаться только к полномочным пользователям, или предоставить временный маркер доступа, который сделает их доступными только в течение ограниченного периода времени.

Когда вы создаете приложение для Azure и хотите хранить большое количество данных в локальной среде, попадают в файлы, такие как изображения, видео, документы PDF, электронные таблицы и т. д. — Рассмотрим службу BLOB-объектов.

## <a name="creating-a-storage-account"></a>Создание учетной записи хранения

Чтобы приступить к работе со службой BLOB-объектов, создайте учетную запись хранения в Azure. На портале щелкните **создать** -- **Data Services** -- **хранилище** -- **Быстрое создание**, а затем введите URL-адрес и расположение центра обработки данных. Расположение центра обработки данных должно быть таким же, как и веб-приложение.

![Создание учетной записи хранилища](unstructured-blob-storage/_static/image1.png)

Вы выбираете основной регион, в котором вы хотите сохранить содержимое, и если вы выбрали вариант [георепликации](https://blogs.msdn.com/b/windowsazurestorage/archive/2013/12/11/introducing-read-access-geo-replicated-storage-ra-grs-for-windows-azure-storage.aspx#_Geo_Redundant_Storage) , Azure создает реплики всех данных в другом центре обработки данных в другом регионе страны. Например, если выбрать центр обработки данных "Западная часть США", то при сохранении файла он переходит в центр обработки данных "Западная часть США", но в фоновом режиме Azure также копирует его в один из других центров обработки данных США. Если в одном регионе страны происходит аварии, данные остаются безнадежными.

Azure не реплицирует данные через географические границы: Если ваше основное расположение находится в США, ваши файлы реплицируются только в другой регион в США. Если основное расположение — Австралия, файлы реплицируются только в другой центр обработки данных в Австралии.

Конечно, вы также можете создать учетную запись хранения, выполнив команды из скрипта, как было показано ранее. Ниже приведена команда Windows PowerShell для создания учетной записи хранения.

[!code-powershell[Main](unstructured-blob-storage/samples/sample1.ps1)]

После создания учетной записи хранения вы можете сразу же начать хранить файлы в службе BLOB-объектов.

## <a name="using-blob-storage-in-the-fix-it-app"></a>Использование хранилища BLOB-объектов в приложении Fix ИТ

Приложение для устранения проблем позволяет отправлять фотографии.

![Создание задачи решения ИТ](unstructured-blob-storage/_static/image2.png)

При нажатии кнопки **создать Fixit**приложение отправляет указанный файл изображения и сохраняет его в службе BLOB-объектов.

### <a name="set-up-the-blob-container"></a>Настройка контейнера больших двоичных объектов

Чтобы сохранить файл в службе BLOB-объектов, необходим *контейнер* для его хранения. Контейнер службы BLOB-объектов соответствует папке файловой системы. Сценарии создания среды, которые мы рассматривали в [главе Автоматизация всех](automate-everything.md) , создают учетную запись хранения, но не создают контейнер. Поэтому целью метода `CreateAndConfigure` класса `PhotoService` является создание контейнера, если он еще не существует. Этот метод вызывается из метода `Application_Start` в *Global. asax*.

[!code-csharp[Main](unstructured-blob-storage/samples/sample2.cs)]

Имя учетной записи хранения и ключ доступа хранятся в коллекции `appSettings` файла *Web. config* , а код в методе `StorageUtils.StorageAccount` использует эти значения для создания строки подключения и установления соединения:

[!code-csharp[Main](unstructured-blob-storage/samples/sample3.cs)]

Затем метод `CreateAndConfigureAsync` создает объект, представляющий службу BLOB-объектов, и объект, представляющий контейнер (папку) с именем "Images" в службе больших двоичных объектов:

[!code-csharp[Main](unstructured-blob-storage/samples/sample4.cs)]

Если контейнер с именем "Images" еще не существует, то это будет иметь значение true при первом запуске приложения для новой учетной записи хранения. код создает контейнер и устанавливает разрешения, чтобы сделать его общедоступным. (По умолчанию новые контейнеры больших двоичных объектов являются частными и доступны только пользователям, имеющим разрешение на доступ к вашей учетной записи хранения.)

[!code-csharp[Main](unstructured-blob-storage/samples/sample5.cs)]

### <a name="store-the-uploaded-photo-in-blob-storage"></a>Хранение отправленной фотографии в хранилище BLOB-объектов

Чтобы передать и сохранить файл изображения, приложение использует интерфейс `IPhotoService` и реализацию интерфейса в классе `PhotoService`. Файл *PhotoService.CS* содержит весь код в приложении Fix ИТ, которое взаимодействует со службой BLOB-объектов.

Следующий метод контроллера MVC вызывается, когда пользователь нажимает кнопку **создать Fixit**. В этом коде `photoService` ссылается на экземпляр класса `PhotoService`, а `fixittask` ссылается на экземпляр класса сущностей `FixItTask`, в котором хранятся данные для новой задачи.

[!code-csharp[Main](unstructured-blob-storage/samples/sample6.cs?highlight=8)]

Метод `UploadPhotoAsync` в классе `PhotoService` сохраняет отправленный файл в службе больших двоичных объектов и возвращает URL-адрес, указывающий на новый большой двоичный объект.

[!code-csharp[Main](unstructured-blob-storage/samples/sample7.cs)]

Как и в методе `CreateAndConfigure`, код подключается к учетной записи хранения и создает объект, представляющий контейнер больших двоичных объектов "Images", за исключением случаев, когда предполагается, что контейнер уже существует.

Затем он создает уникальный идентификатор для образа, который будет отправлен, путем сцепления нового значения GUID с расширением файла:

[!code-csharp[Main](unstructured-blob-storage/samples/sample8.cs)]

Затем код использует объект контейнера больших двоичных объектов и новый уникальный идентификатор для создания объекта BLOB, устанавливает атрибут для этого объекта, указывающий тип файла, а затем использует объект большого двоичного объекта для хранения файла в хранилище BLOB-объектов.

[!code-csharp[Main](unstructured-blob-storage/samples/sample9.cs)]

Наконец, он получает URL-адрес, который ссылается на большой двоичный объект. Этот URL-адрес будет храниться в базе данных и может использоваться на веб-страницах исправления для вывода отправленного изображения.

[!code-csharp[Main](unstructured-blob-storage/samples/sample10.cs)]

Этот URL-адрес хранится в базе данных как один из столбцов таблицы Фикситтаск.

[!code-csharp[Main](unstructured-blob-storage/samples/sample11.cs?highlight=10)]

Благодаря только URL-адресу в базе данных и изображениям в хранилище BLOB-приложений решение для устранения проблем сохраняет небольшие, масштабируемые и недорогие базы данных, а образы хранятся в том месте, где хранилище недорого и может обрабатывать терабайты или петабайтов. Одна учетная запись хранения может хранить сотни терабайт для исправления ИТ, и вы платите только за то, что используете. Так что вы можете начать с небольшой выплаты 9 центов на первый гигабайт и добавить дополнительные образы для копеек на каждый дополнительный гигабайт.

### <a name="display-the-uploaded-file"></a>Отображение отправленного файла

При отображении сведений о задаче приложение для устранения проблем отображает отправленный файл изображения.

![Устранение сведений о задачах ИТ с помощью фото](unstructured-blob-storage/_static/image3.png)

Чтобы отобразить изображение, все представление MVC должно содержать `PhotoUrl` значение в HTML-коде, отправляемом в браузер. Веб-сервер и база данных не используют циклы для показа образа. они обслуживают только несколько байтов для URL-адреса образа. В следующем коде Razor `Model` ссылается на экземпляр класса сущностей `FixItTask`.

[!code-cshtml[Main](unstructured-blob-storage/samples/sample12.cshtml?highlight=11)]

Если взглянуть на код HTML отображаемой страницы, вы увидите URL-адрес, указывающий непосредственно на образ в хранилище BLOB-объектов, примерно так:

[!code-cshtml[Main](unstructured-blob-storage/samples/sample13.cshtml?highlight=11)]

## <a name="summary"></a>Сводка

Вы увидели, как приложение для устранения проблем сохраняет изображения в службе BLOB-объектов и только URL для изображений в базе данных SQL. Использование службы BLOB-объектов позволяет хранить базу данных SQL гораздо меньше, чем в противном случае, что позволяет масштабировать до почти неограниченного числа задач и может быть выполнено без написания большого объема кода.

В учетной записи хранения можно использовать сотни терабайтов, а стоимость хранения гораздо дешевле, чем хранилище базы данных SQL, начиная с 3 центов за гигабайт в месяц и за счет небольшого объема транзакций. И помните, что вы не платите за максимальную емкость, но только за фактический объем, чтобы ваше приложение было готово к масштабированию, но вы не оплачиваете все эти дополнительные возможности.

В [следующей главе](design-to-survive-failures.md) мы поговорим о важности создания облачного приложения, способного корректно обрабатывать сбои.

## <a name="resources"></a>Ресурсы

Дополнительные сведения см. в следующих ресурсах:

- [Введение в хранилище BLOB-объектов Azure](https://www.simple-talk.com/cloud/cloud-data/an-introduction-to-windows-azure-blob-storage-/). Блог от Майка.
- [Как использовать службу хранилища BLOB-объектов Azure в .NET](https://docs.microsoft.com/azure/storage/blobs/storage-dotnet-how-to-use-blobs). Официальная документация на сайте MicrosoftAzure.com. Краткое введение в хранилище BLOB-объектов, а затем примеры кода, посвященные подключению к хранилищу BLOB-объектов, созданию контейнеров, передаче и скачиванию больших двоичных объектов и т. д.
- [Отказоустойчивость: создание масштабируемых отказоустойчивых облачных служб](https://channel9.msdn.com/Series/FailSafe). Серия видео из девяти частей по Ульрих Хоманн, (Marc Меркури и пометить SIMM. Предоставляет основные понятия и архитектурные принципы в очень удобном и интересном смысле, а также истории, полученные от работы группы консультирования клиентов Майкрософт (CAT) с реальными клиентами. Сведения о службе хранилища Azure и больших двоичных объектах см. в статье о версии 5, начиная с 35:13.
- [Шаблоны и методики Майкрософт. Руководство по Azure](https://msdn.microsoft.com/library/dn568099.aspx). См. раздел шаблон камердинера Key.

> [!div class="step-by-step"]
> [Назад](data-partitioning-strategies.md)
> [Вперед](design-to-survive-failures.md)
