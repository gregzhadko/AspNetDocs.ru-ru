---
uid: aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/automate-everything
title: Полная автоматизация (Создание реальных облачных приложений с помощью Azure) | Документация Майкрософт
author: MikeWasson
description: Создание реальных облачных приложений в условиях электронная книга основана на презентацию, разработанная Скоттом Гатри. Здесь объясняется, 13 шаблонов и практических рекомендаций, которые он может...
ms.author: riande
ms.date: 06/12/2014
ms.assetid: ba6e6baa-9b9f-471f-b39d-b007a3addadc
msc.legacyurl: /aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/automate-everything
msc.type: authoredcontent
ms.openlocfilehash: 18e988279b56e479b0bb27de2f01ab22a2e70301
ms.sourcegitcommit: 289e051cc8a90e8f7127e239fda73047bde4de12
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/25/2019
ms.locfileid: "58422614"
---
<a name="automate-everything-building-real-world-cloud-apps-with-azure"></a>Полная автоматизация (Создание реальных облачных приложений с помощью Azure)
====================
по [Майк Уоссон](https://github.com/MikeWasson), [Рик Андерсон]((https://twitter.com/RickAndMSFT)), [том Дайкстра](https://github.com/tdykstra)

[Загрузить решение проект](http://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4) или [скачайте электронную книгу](http://blogs.msdn.com/b/microsoft_press/archive/2014/07/23/free-ebook-building-cloud-apps-with-microsoft-azure.aspx)

> **Создание реальных облачных приложений в условиях Azure** электронная книга основана на презентацию, разработанная Скоттом Гатри. Здесь объясняется 13 шаблоны и рекомендации, которые помогут вам быть в успешном развертывании веб-приложений для облака. Введение в книге, см. в разделе [первой главы](introduction.md).


Первые три шаблонов, которые мы рассмотрим применяют для любого проекта разработки программного обеспечения, но особенно для проектов в облаке. Эта концепция играет об автоматизации задач разработки. Это важная тема, поскольку выполняемых вручную процессов, медленным и ненадежным; Автоматизация как многие из них как возможные помогает настроить рабочий процесс быстрой, надежной и гибкой. Очень важно уникальным образом для разработки облачных приложений, так как вы можете с легкостью автоматизировать многие задачи, которые трудно или невозможно автоматизировать в локальной среде. Например, можно настроить всего теста сред, включая новый веб-сервер и внутренние виртуальные машины, базы данных, больших двоичных объектов хранилища (хранилище файлов), очереди и т. д.

## <a name="devops-workflow"></a>Рабочий процесс DevOps

Все чаще вы слышите термин «DevOps». Термин, разработанных вне распознавания, что нужно интегрировать задачах разработки и эксплуатации для эффективной разработки программного обеспечения. Тип рабочего процесса, который вы хотите включить — один, в котором вы можно разрабатывать приложения, развернуть его, узнайте от его использования в рабочей среде, измените его в ответ на полученные знания и повторите цикл, быстро и надежно.

Некоторые команды разработчиков успешно разработать Облачное развертывание несколько раз в день в производственной среде. Команда Azure, используемая для развертывания основной обновлять каждые 2 – 3 месяцев, но теперь выпуски незначительные изменения, каждые 2-3 дня и основной освобождает каждые 2-3 недели. Начало в этой периодичности действительно помогает реагировать на отзывы клиентов.

Для этого необходимо включить цикл разработки и развертывания, который является repeatable, надежную, прогнозируемого и имеет время низкой цикла.

![Рабочий процесс DevOps](automate-everything/_static/image1.png)

Другими словами период времени между при наличии идею для функции и когда его использования и предоставления отзывов клиентов должен быть как можно более короткими. Первые три шаблонов — Полная автоматизация, системы управления версиями, и Непрерывная интеграция и поставка--предназначены для рекомендации, которые мы рекомендуем, чтобы включить такого рода процесса.

## <a name="azure-management-scripts"></a>Сценарии управления Azure

В [введение в этой электронной книге](introduction.md), можно было увидеть веб-консоли, на портале управления Azure. На портале управления позволяет отслеживать и управлять ими, все ресурсы, которые были развернуты в Azure. Это простой способ создание и удаление служб, таких как веб-приложений и виртуальных машин, настройте эти службы, отслеживать операции службы и т. д. Это прекрасно, но с его помощью выполняется вручную. Если вы собираетесь разрабатывать в рабочем приложении любого размера, и особенно в среде team, рекомендуется, чтобы перейти в пользовательском Интерфейсе, чтобы узнать и изучения Azure портала и затем автоматизировать процессы, которые вы будете делать несколько раз.

Почти все, что можно сделать вручную на портале управления или из Visual Studio можно также путем вызова API REST управления. Можно написать скрипты с помощью [Windows PowerShell](https://msdn.microsoft.com/library/windowsazure/jj156055.aspx), или можно использовать платформу с открытым исходным кодом, такие как [Chef](http://www.opscode.com/chef/) или [Puppet](http://puppetlabs.com/puppet/what-is-puppet). Можно также использовать средство командной строки Bash в среде Mac или Linux. Azure имеет API для создания сценариев для этих разных сред, а его [API управления .NET](http://www.hanselman.com/blog/PennyPinchingInTheCloudAutomatingEverythingWithTheWindowsAzureManagementLibrariesAndNET.aspx) в случае, если вы хотите писать код вместо скрипта.

Для приложения Fix It мы создали некоторые сценарии Windows PowerShell для автоматизации процессов создания среды тестирования и развертывания проекта для этой среды, и мы рассмотрим некоторые из содержимое этих сценариев.

## <a name="environment-creation-script"></a>Скрипт создания среды

Первый сценарий, мы рассмотрим называется *New AzureWebsiteEnv.ps1*. Он создает среду Azure, можно развернуть Fix It для тестируемого приложения. Ниже перечислены основные задачи, которые выполняет этот скрипт.

- Создание веб-приложения.
- Создайте учетную запись хранения. (Требуется для больших двоичных объектов и очередей, как вы увидите в последующих главах).
- Создать сервер базы данных SQL и две базы данных: базы данных приложения и базы данных членства.
- Параметры Store в Azure, что приложение будет использовать для доступа к учетной записи хранения и баз данных.
- Создание файлов параметров, которые будут использоваться для автоматизации развертывания.

### <a name="run-the-script"></a>Запуск сценария


> [!NOTE]
> В этой части главы показаны примеры скриптов и команд, введенных для их работы. Этот демонстрационный ролик и не предоставляет все, что нужно знать, чтобы выполнять сценарии. Пошаговые инструкции практические-в-it, см. в разделе [приложение: Исправление пример приложения](the-fix-it-sample-application.md#deploybase).


Для выполнения сценария PowerShell, который управляет службами Azure, вам нужно установить консоль Azure PowerShell и настроить его для работы с вашей подпиской Azure. После настройки нужных параметров, можно выполнить на Fix It среде скрипт создания с помощью команды следующего вида:

`.\New-AzureWebsiteEnv.ps1 -Name <websitename> -SqlDatabasePassword <password>`

`Name` Параметр указывает имя, которое будет использоваться при создании базы данных и учетные записи хранения и `SqlDatabasePassword` параметр указывает пароль для учетной записи администратора, который будет создан для базы данных SQL. Существуют другие параметры, которые можно использовать, что мы рассмотрим позже.

![Окно PowerShell](automate-everything/_static/image2.png)

После завершения скрипта вы увидите в на портале управления, что был создан. Вы найдете две базы данных:

![Базы данных](automate-everything/_static/image3.png)

Учетная запись хранения:

![Учетная запись хранения](automate-everything/_static/image4.png)

И веб-приложения:

![Веб-сайт](automate-everything/_static/image5.png)

На **Настройка** вкладку веб-приложения, вы увидите, что он имеет параметры учетной записи хранения и строки подключения к базам данных SQL настроили для исправления его приложение.

![appSettings и connectionStrings](automate-everything/_static/image6.png)

*Автоматизации* теперь содержатся  *&lt;websitename&gt;.pubxml* файла. Этот файл содержит параметры, MSBuild будет использовать для развертывания приложения в среде Azure, который был только что создали. Пример:

[!code-xml[Main](automate-everything/samples/sample1.xml)]

Как вы видите, сценарий создала полный тестовой среде, и весь процесс выполняется в около 90 секунд.

Если кто-то другой в вашей команде хочет создать тестовую среду, их можно просто запустить скрипт. Не только выполняется быстро, но также они могут быть уверены, что они используют отличается от используемой среды. Не удалось выполнить довольно как уверенным, если все настраиваем вручную с помощью портала управления пользовательского интерфейса.

### <a name="a-look-at-the-scripts"></a>Краткий обзор сценариев

Существует фактически три сценария, этой цели. При вызове одного из командной строки и автоматически использует два других для выполнения некоторых задач:

- *Новый AzureWebSiteEnv.ps1* является основным сценарием.

    - *Новый AzureStorage.ps1* создает учетную запись хранения.
    - *Новый AzureSql.ps1* создает базы данных.

### <a name="parameters-in-the-main-script"></a>Параметры основного скрипта

Основной скрипт, *New AzureWebSiteEnv.ps1*, определяет несколько параметров:

[!code-powershell[Main](automate-everything/samples/sample2.ps1)]

Необходимы два параметра:

- Имя веб-приложения, который создает сценарий. (Это также используется для URL-адрес: `<name>.azurewebsites.net`.)
- Пароль для нового администратора сервера базы данных, который создает сценарий.

Необязательные параметры позволяют указать расположение центра обработки данных (по умолчанию — «Западная часть США»), имя администратора сервера базы данных (по умолчанию — «dbuser») и правило брандмауэра для сервера базы данных.

### <a name="create-the-web-app"></a>Создание веб-приложения

Первое, что делает сценарий — создание веб-приложения путем вызова `New-AzureWebsite` командлета, передавая в него веб-приложения имя и расположение значения параметров:

[!code-powershell[Main](automate-everything/samples/sample3.ps1?highlight=2)]

### <a name="create-the-storage-account"></a>Создание учетной записи хранения

Затем основной скрипт запускает <em>New AzureStorage.ps1</em> скрипт, указав "<em>&lt;websitename&gt;</em>хранилища» для имени учетной записи хранения, и те же данные центра расположении, что веб-приложения.

[!code-powershell[Main](automate-everything/samples/sample4.ps1?highlight=3)]

*Новый AzureStorage.ps1* вызовы `New-AzureStorageAccount` командлет, чтобы создать учетную запись хранения и он возвращает учетную запись имени и значения ключа. Эти значения потребуются приложения для доступа к BLOB-объектов и очередей в учетной записи хранения.

[!code-powershell[Main](automate-everything/samples/sample5.ps1?highlight=2)]

Не всегда можно создать учетную запись хранения; скрипт можно улучшить, добавив параметр, который при необходимости, то она использовать существующую учетную запись хранения.

### <a name="create-the-databases"></a>Создание баз данных

Основной скрипт запустит скрипт создания базы данных, *New AzureSql.ps1*, после настройки базы данных по умолчанию и имена правил брандмауэра:

[!code-powershell[Main](automate-everything/samples/sample6.ps1)]

[!code-powershell[Main](automate-everything/samples/sample7.ps1?highlight=2)]

Скрипт создания базы данных извлекает IP-адрес компьютера разработки и задает правило брандмауэра, чтобы компьютер разработки можно подключиться, а также управлять сервером. Скрипт создания базы данных затем проходит через несколько шагов для настройки баз данных:

- Создает сервер с помощью `New-AzureSqlDatabaseServer` командлета.

    [!code-powershell[Main](automate-everything/samples/sample8.ps1?highlight=1)]
- Создает правила брандмауэра, чтобы включить компьютер разработки для управления сервером и включения веб-приложения для подключения к нему. 

    [!code-powershell[Main](automate-everything/samples/sample9.ps1?highlight=3,5)]
- Создает контекст базы данных, которая включает имя сервера и учетные данные, с помощью `New-AzureSqlDatabaseServerContext` командлета.

    [!code-powershell[Main](automate-everything/samples/sample10.ps1?highlight=4)]

    `New-PSCredentialFromPlainText` — Это функция в скрипт, который вызывает `ConvertTo-SecureString` командлет для шифрования пароля или возвращает `PSCredential` объект того же типа, который `Get-Credential` командлетом.
- Создает базу данных приложения и базы данных членства, используя `New-AzureSqlDatabase` командлета.

    [!code-powershell[Main](automate-everything/samples/sample11.ps1?highlight=2,5)]
- Вызывает локально определенные функции, чтобы создать строку подключения для каждой базы данных. Приложение будет использовать эти строки подключения для доступа к базе данных. 

    [!code-powershell[Main](automate-everything/samples/sample12.ps1?highlight=1-2)]

    Get-SQLAzureDatabaseConnectionString — это функция, определенная в сценарий, который создает строку подключения из значений параметров, передаваемые ей.

    [!code-powershell[Main](automate-everything/samples/sample13.ps1?highlight=1)]
- Возвращает хэш-таблицу с именем сервера базы данных и строки подключения.

    [!code-powershell[Main](automate-everything/samples/sample14.ps1)]

Приложение Fix It использует отдельный членства и базы данных приложения. Можно также поместить данные членства и приложения в одной базе данных.

### <a name="store-app-settings-and-connection-strings"></a>Параметры приложения Store и строки подключения

Azure имеет функцию, которая позволяет хранить и строки подключения, которые автоматически переопределяют что возвращается приложению, при попытке чтения `appSettings` или `connectionStrings` коллекций в файле Web.config. Это альтернатива применению [преобразования Web.config](../../../../web-forms/overview/deployment/visual-studio-web-deployment/web-config-transformations.md) при развертывании. Дополнительные сведения см. в разделе [Store конфиденциальных данных в Azure](source-control.md#appsettings) далее в этой электронной книги.

Сохраняет скрипт создания среды в Azure все `appSettings` и `connectionStrings` значения, необходимые приложению для доступа к учетной записи хранения и баз данных, когда оно работает в Azure.

[!code-powershell[Main](automate-everything/samples/sample15.ps1)]

[!code-powershell[Main](automate-everything/samples/sample16.ps1)]

[!code-powershell[Main](automate-everything/samples/sample17.ps1?highlight=2)]

[New Relic](http://newrelic.com/) — это платформа данных телеметрии, описанный в [мониторинг и Телеметрия](monitoring-and-telemetry.md) главы. Скрипт создания среды также перезапускается веб-приложения, чтобы убедиться в том, что он собирает параметры New Relic.

[!code-powershell[Main](automate-everything/samples/sample18.ps1?highlight=2)]

### <a name="preparing-for-deployment"></a>Подготовка к развертыванию

В конце процесса сценарий создания среды вызывает две функции для создания файлов, которые будут использоваться с помощью сценария развертывания.

Один из этих функций создает профиль публикации *(&lt;websitename&gt;.pubxml* файла). Код вызывает API REST Azure, чтобы получить параметры публикации, и сохраняет сведения в *.publishsettings* файла. Затем она использует сведения из этого файла, а также файл шаблона (*pubxml.template*) для создания *.pubxml* файл, содержащий профиль публикации. Этот двухэтапный процесс имитирует, рассматриваемые в Visual Studio: скачайте *.publishsettings* файл и импортировать, чтобы создать профиль публикации.

Другая функция использует другой файл шаблона (веб-сайт environment.template) для создания *веб-сайт environment.xml* файла, содержащего параметры скрипта развертывания будет использоваться вместе с *.pubxml*файл.

### <a name="troubleshooting-and-error-handling"></a>Устранение неполадок и обработка ошибок

Сценарии похожи на программы: они могут завершиться ошибкой, и при этом вы хотите знать, сколько вы можете о сбое и что вызвало его. По этой причине сценарий создания среды изменяет значение `VerbosePreference` переменной из `SilentlyContinue` для `Continue` так, чтобы отображались все подробные сообщения. Он также изменяет значение `ErrorActionPreference` переменной из `Continue` для `Stop`, так что сценарий останавливается, даже когда он встречает устранимые ошибки:

[!code-powershell[Main](automate-everything/samples/sample19.ps1)]

Перед этим какой-либо работы, сценарий сохраняет время начала, чтобы его можно вычислить время, прошедшее после завершения:

[!code-powershell[Main](automate-everything/samples/sample20.ps1)]

После завершения работы, сценарий отображает затраченное время:

[!code-powershell[Main](automate-everything/samples/sample21.ps1)]

И для каждой операции ключа скрипт записывает подробные сообщения, например:

[!code-powershell[Main](automate-everything/samples/sample22.ps1)]

## <a name="deployment-script"></a>Скрипт развертывания

Что *New AzureWebsiteEnv.ps1* делает сценарий для создания среды *AzureWebsite.ps1 публикации* делает сценарий для развертывания приложения.

Скрипт развертывания получает имя веб-приложения из *environment.xml веб-сайт* файл, созданный с помощью сценария создания среды.

[!code-powershell[Main](automate-everything/samples/sample23.ps1)]

Он возвращает пароль пользователя развертывания из *.publishsettings* файла:

[!code-powershell[Main](automate-everything/samples/sample24.ps1)]

Он выполняет [MSBuild](http://msbuildbook.com/) команду, которая создает и развертывает проект:

[!code-powershell[Main](automate-everything/samples/sample25.ps1)]

И если вы указали `Launch` параметр в командной строке, он вызывает `Show-AzureWebsite` командлет, чтобы открыть браузер на URL-адрес веб-сайта по умолчанию.

[!code-powershell[Main](automate-everything/samples/sample26.ps1?highlight=3)]

Скрипт развертывания можно запустить с помощью команды следующего вида:

`.\Publish-AzureWebsite.ps1 ..\MyFixIt\MyFixIt.csproj -Launch`

И после этого, в браузере откроется с сайтом, работающее в облаке в `<websitename>.azurewebsites.net` URL-адрес.

![Исправить приложение, развернутое в Windows Azure](automate-everything/_static/image7.png)

## <a name="summary"></a>Сводка

С помощью этих скриптов вы можете быть уверены, что те же действия всегда будет выполняться в том же порядке, с теми же параметрами. Это гарантирует, что каждый разработчик в группе не что-то или что-то нарушить или что-то пользовательские на своей машине, не будет работать фактически так же, как в среде другой член команды или в рабочей среде развертывания.

Аналогичным образом вы можете автоматизировать наиболее Azure функций управления, которые можно выполнять на портале управления, с помощью REST API, сценарии Windows PowerShell, на языке .NET API или программа Bash, который можно запустить в Linux или Mac.

В [следующей главе](source-control.md) мы рассмотрим исходный код и объясним, почему важно включить скрипты в репозиторий исходного кода.

## <a name="resources"></a>Ресурсы

- [Установка и настройка Windows PowerShell для Azure](https://docs.microsoft.com/powershell/azure/overview?view=azurermps-4.3.1). Объясняет, как установить командлеты Azure PowerShell и способ установки сертификата, что вам требуется на компьютере, чтобы управлять Azure учетная запись. Это прекрасная возможность приступить к работе, так как он также содержит ссылки на ресурсы для изучения PowerShell сам.
- [Центр сценариев Azure](https://docs.microsoft.com/azure/automation/automation-runbook-gallery). Портале WindowsAzure.com к ресурсам для разработки сценариев, управления службами Azure, со ссылками на начало учебники, командлет Справочник по документации и исходный код и примеры сценариев
- [Scripter выходные дни: Приступая к работе с Azure и PowerShell](http://blogs.technet.com/b/heyscriptingguy/archive/2013/06/22/weekend-scripter-getting-started-with-windows-azure-and-powershell.aspx). В блоге, посвященная Windows PowerShell этой записи обеспечивает вас отличным введением в использование PowerShell для работы функций управления Azure.
- [Установка и настройка Azure кросс платформенного интерфейса командной строки](https://docs.microsoft.com/cli/azure/install-azure-cli?view=azure-cli-latest). Руководство по началу для сценариев инфраструктуры Azure, которое работает на Mac и Linux, а также Windows систем.
- [Программы командной строки раздела Загрузите пакеты Azure SDK и средства](https://azure.microsoft.com/downloads/). Страница портала, документацию и файлы для загрузки, относящиеся к средствам командной строки для Azure.
- [Автоматизация с использованием библиотек управления Azure и .NET](http://www.hanselman.com/blog/PennyPinchingInTheCloudAutomatingEverythingWithTheWindowsAzureManagementLibrariesAndNET.aspx). Скотт Хансельман предоставляет API управления .NET для Azure.
- [Использование скриптов Windows PowerShell для публикации в средах разработки и тестирования](https://msdn.microsoft.com/library/azure/dn642480.aspx). Документация MSDN, который содержит сведения об использовании опубликовать скрипты, которые Visual Studio автоматически создает для веб-проектов.
- [Инструменты PowerShell для Visual Studio 2013](https://visualstudiogallery.msdn.microsoft.com/c9eb3ba8-0c59-4944-9a62-6eee37294597). Расширение Visual Studio, добавляет поддержку языка для Windows PowerShell в Visual Studio.

> [!div class="step-by-step"]
> [Назад](introduction.md)
> [Вперед](source-control.md)
