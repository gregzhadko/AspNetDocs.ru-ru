---
uid: web-api/overview/getting-started-with-aspnet-web-api/tutorial-your-first-web-api
title: Начало работы с ASP.NET Web API 2 (C#)
author: MikeWasson
description: HTTP не только для предоставления веб-страниц. Это также мощную платформу для создания API, которые предоставляют службы и данные. Протокол HTTP является простая и гибкая и ubiq...
ms.author: riande
ms.date: 11/28/2017
msc.legacyurl: /web-api/overview/getting-started-with-aspnet-web-api/tutorial-your-first-web-api
msc.type: authoredcontent
ms.openlocfilehash: 7bec95af4532535f0d620bfe6862958907466874
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/01/2019
ms.locfileid: "57060191"
---
<a name="get-started-with-aspnet-web-api-2-c"></a>Начало работы с ASP.NET Web API 2 (C#)
====================
по [Майк Уоссон](https://github.com/MikeWasson)

[Скачать завершенный проект](https://code.msdn.microsoft.com/Sample-code-of-Getting-c56ccb28)

HTTP не только для предоставления веб-страниц. Протокол HTTP также является мощной платформой для создания API, которые предоставляют службы и данные. HTTP — простую, гибкую и повсеместно. Практически любой платформе, можно представить себе имеет библиотеки HTTP, поэтому службы HTTP могут стать идеальным широкого круга клиентов, включая браузеры мобильных устройств и Классические приложения.

Веб-API ASP.NET — это платформа для создания веб-API-интерфейсы на основе .NET Framework. В этом руководстве используется веб-API ASP.NET для создания веб-API, который возвращает список продуктов.

## <a name="software-versions-used-in-the-tutorial"></a>Версии программного обеспечения, используемые в этом руководстве

- [Visual Studio 2017](https://visualstudio.microsoft.com/downloads/?utm_medium=microsoft&utm_source=docs.microsoft.com&utm_campaign=button+cta&utm_content=download+vs2017)
- Веб-API 2

См. в разделе [Создание веб-API с помощью ASP.NET Core и Visual Studio для Windows](https://docs.microsoft.com/aspnet/core/tutorials/first-web-api) для более новой версии этого руководства.

## <a name="create-a-web-api-project"></a>Создать проект веб-API

В этом руководстве используется веб-API ASP.NET для создания веб-API, который возвращает список продуктов. Интерфейсный веб-страницы использует jQuery для отображения результатов.

![](tutorial-your-first-web-api/_static/image1.png)

Запустите Visual Studio и выберите **новый проект** из **запустить** страницы. Или с **файл** меню, выберите **New** и затем **проекта**.

В **шаблоны** области выберите **установленные шаблоны** и разверните **Visual C#** узла. В разделе **Visual C#** выберите **Web**. В списке шаблонов проектов выберите **веб-приложение ASP.NET**. Присвойте проекту имя «ProductsApp» и нажмите кнопку **ОК**.

![](tutorial-your-first-web-api/_static/image2.png)

В **новый проект ASP.NET** диалоговом окне выберите **пустой** шаблона. В разделе &quot;добавить папки и основные ссылки для&quot;, проверьте **веб-API**. Нажмите кнопку **ОК**.

![](tutorial-your-first-web-api/_static/image3.png)

> [!NOTE]
> Можно также создать проект веб-API с помощью &quot;веб-API&quot; шаблона. Шаблон веб-API ASP.NET MVC использует для предоставления страницы справки по API. Я использую пустой шаблон в этом руководстве, поскольку я хочу показать веб-API без MVC. В общем случае не нужно знать ASP.NET MVC позволяет использовать веб-API.


## <a name="adding-a-model"></a>Добавление модели

*Модель* — это объект, представляющий данные в приложении. Веб-API ASP.NET может автоматически сериализовать модель в JSON, XML или другом формате, а затем записывает сериализованные данные в тексте сообщения HTTP-ответа. До тех пор, пока клиент может прочитать формат сериализации, он может выполнить десериализацию объекта. Большинство клиентов может выполнить синтаксический анализ XML или JSON. Кроме того клиент может указать, какой формат, ему, задав заголовок Accept в сообщении запроса HTTP.

Давайте сначала создадим простую модель, которая представляет продукт.

Если обозреватель решений не отображается, нажмите кнопку **представление** меню и выберите **обозревателе решений**. В обозревателе решений щелкните правой кнопкой мыши папку Models. В контекстном меню выберите **добавить** выберите **класс**.

![](tutorial-your-first-web-api/_static/image4.png)

Назовите класс &quot;продукта&quot;. Добавьте следующие свойства `Product` класса.

[!code-csharp[Main](tutorial-your-first-web-api/samples/sample1.cs)]

## <a name="adding-a-controller"></a>Добавление контроллера

В веб-API *контроллера* — это объект, который обрабатывает HTTP-запросы. Мы добавим контроллер, который может возвращать список продуктов и один продукт, указываемого идентификатором.

> [!NOTE]
> Если вы использовали ASP.NET MVC, вы уже знакомы с контроллерами. Контроллеры веб-API похожи на контроллеры MVC, но наследуется **ApiController** вместо класса **контроллера** класса.

В **обозревателе решений**, щелкните правой кнопкой мыши папку Controllers. Выберите **добавить** , а затем выберите **контроллера**.

![](tutorial-your-first-web-api/_static/image5.png)

В **Добавление шаблона** диалоговом окне выберите **контроллер Web API — пустой**. Нажмите кнопку **Добавить**.

![](tutorial-your-first-web-api/_static/image6.png)

В **Добавление контроллера** диалоговое окно, назовите контроллер &quot;ProductsController&quot;. Нажмите кнопку **Добавить**.

![](tutorial-your-first-web-api/_static/image7.png)

Формирование шаблонов создает файл с именем ProductsController.cs в папку "контроллеры".

![](tutorial-your-first-web-api/_static/image8.png)

> [!NOTE]
> Не нужно поместить в папку с именем контроллеры контроллеров. Имя папки — это просто удобный способ организации исходные файлы.


Если этот файл еще не открыт, дважды щелкните файл, чтобы открыть его. Замените код в этот файл следующее:

[!code-csharp[Main](tutorial-your-first-web-api/samples/sample2.cs)]

Для простоты в примере, продукты, хранятся в массив фиксированной длины внутри класса контроллера. Разумеется в реальном приложении бы запрос к базе данных или использовать другого источника внешних данных.

Контроллер определяет два метода, которые возвращают продуктов:

- `GetAllProducts` Метод возвращает весь список продуктов, как **IEnumerable&lt;продукта&gt;**  типа.
- `GetProduct` Метод ищет один продукт по его идентификатору.

Вот и все! У вас есть рабочий веб-API. Каждый метод в контроллере соответствует на один или несколько URI:

| Метод контроллера | URI |
| --- | --- |
| GetAllProducts | / api/продуктов |
| GetProduct | /API/продукты/*идентификатор* |

Для `GetProduct` метод, *идентификатор* в URI — это. Например, чтобы получить продукт с Идентификатором 5, URI имеет `api/products/5`.

Дополнительные сведения о том, как веб-API направляет HTTP-запросов в методы контроллера, см. в разделе [маршрутизации в ASP.NET Web API](../web-api-routing-and-actions/routing-in-aspnet-web-api.md).

## <a name="calling-the-web-api-with-javascript-and-jquery"></a>Вызов веб-API с помощью Javascript и jQuery

В этом разделе мы добавим страницу HTML, которое использует AJAX для вызова веб-API. Мы будем использовать jQuery для выполнения вызовов AJAX, так и для обновления страницы с результатами.

В обозревателе решений щелкните правой кнопкой мыши проект и выберите **добавить**, а затем выберите **новый элемент**.

![](tutorial-your-first-web-api/_static/image9.png)

В **Добавление нового элемента** диалоговое окно, выберите **Web** в узле **Visual C#**, а затем выберите **HTML-страницу** элемента. Присвойте странице имя &quot;index.html&quot;.

![](tutorial-your-first-web-api/_static/image10.png)

Замените все содержимое этого файла следующим кодом:

[!code-html[Main](tutorial-your-first-web-api/samples/sample3.html)]

Для получения jQuery можно использовать следующие способы. В этом примере я использовал [сети доставки Содержимого Microsoft Ajax](../../../ajax/cdn/overview.md). Вы также можете скачать его из [ http://jquery.com/ ](http://jquery.com/)и ASP.NET «Веб-API» шаблон проекта включает также jQuery.

### <a name="getting-a-list-of-products"></a>Получение списка продуктов

Для получения списка продуктов, отправьте запрос HTTP GET к &quot;/api/products&quot;.

JQuery [getJSON](http://api.jquery.com/jQuery.getJSON/) функция отправляет запрос AJAX. Ответ содержит массив объектов JSON. `done` Функция задает обратный вызов, который вызывается, если запрос выполнен успешно. В обратный вызов Мы обновляем DOM с помощью информации о продукте.

[!code-html[Main](tutorial-your-first-web-api/samples/sample4.html)]

### <a name="getting-a-product-by-id"></a>Получение продукта по Идентификатору

Для получения продуктов по Идентификатору, отправьте запрос HTTP GET к &quot;/API/продукты/*идентификатор*&quot;, где *идентификатор* идентификатор продукта.

[!code-javascript[Main](tutorial-your-first-web-api/samples/sample5.js)]

Мы по-прежнему вызвать `getJSON` для отправки запроса AJAX, но на этот раз мы поместили идентификатор в URI запроса. Ответ от этого запроса — это представление JSON за единицу продукта.

## <a name="running-the-application"></a>Запуск приложения

Нажмите клавишу F5, чтобы начать отладку приложения. Веб-страницы должна выглядеть следующим образом:

![](tutorial-your-first-web-api/_static/image11.png)

Чтобы получить продукт по Идентификатору, введите код и нажмите кнопку поиска:

![](tutorial-your-first-web-api/_static/image12.png)

Если введен недопустимый идентификатор, сервер возвращает ошибку HTTP:

![](tutorial-your-first-web-api/_static/image13.png)

## <a name="using-f12-to-view-the-http-request-and-response"></a>С помощью F12 для просмотра HTTP-запроса и ответа

При работе с HTTP-службу, может быть полезно для сообщений запросов и см. в разделе HTTP-запроса. Это можно сделать с помощью средств разработчика F12 в Internet Explorer 9. Internet Explorer 9, нажмите **F12** чтобы открыть средства. Нажмите кнопку **сети** вкладку и нажмите клавишу **начать захват**. Теперь вернитесь к веб-страницы и нажмите клавишу **F5** перезагрузить веб-страницы. Internet Explorer захватывает HTTP-трафика между браузером и веб-сервера. Представление "Сводка" показывает весь сетевой трафик для страницы:

![](tutorial-your-first-web-api/_static/image14.png)

Найдите запись для относительного URI «api/products /». Выберите эту запись и нажмите кнопку **перейдите к представлению подробные**. В представлении «Подробности» есть вкладки для просмотра заголовков запроса и ответа и текст. Например, если щелкнуть **заголовки запроса** вкладке, можно увидеть, что клиент запросил &quot;application/json&quot; в заголовке Accept.

![](tutorial-your-first-web-api/_static/image15.png)

Если щелкнуть вкладку тело ответа, вы увидите сообщение о том, как список продуктов был сериализован в формат JSON. Другие браузеры имеют схожие функции. Другой полезный инструмент — [Fiddler](http://www.fiddler2.com/fiddler2/), веб-прокси для отладки. Можно использовать Fiddler для просмотра трафик HTTP, а также для составления HTTP-запросов, который дает полный контроль над заголовков HTTP в запросе.

## <a name="see-this-app-running-on-azure"></a>Это приложение работает в Azure см. в разделе

Вы действительно хотите см. по завершении сайт, запущенный в качестве активного веб-приложения? Полную версию приложения можно развернуть учетную запись Azure, просто нажав кнопку ниже.

[![](https://azuredeploy.net/deploybutton.png)](https://deploy.azure.com/?WT.mc_id=deploy_azure_aspnet&repository=https://github.com/tfitzmac/WebAPI-ProductsApp#/form/setup)

Требуется учетная запись Azure для развертывания этого решения в Azure. Если у вас еще нет учетной записи, у вас есть следующие параметры:

- [Открыть учетную запись Azure бесплатно](https://azure.microsoft.com/pricing/free-trial/?WT.mc_id=A443DD604) -вы получаете кредиты можно использовать для опробования платных служб Azure и даже в том случае, если они используются, вы сохраняете учетную запись и использовать бесплатные службы Azure.
- [Активировать преимущества подписчика MSDN](https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/?WT.mc_id=A443DD604) -ваша подписка MSDN предоставляет вам кредиты каждый месяц, который можно использовать для оплаты служб Azure.

## <a name="next-steps"></a>Следующие шаги

- Более полный пример службы HTTP, поддерживающий действия POST, PUT и DELETE и запись в базе данных, см. в разделе [с помощью веб-API 2 с Entity Framework 6](../data/using-web-api-with-entity-framework/part-1.md).
- Дополнительные сведения о создании динамична и веб-приложений на основе HTTP-службу, см. в разделе [одностраничного приложения ASP.NET](../../../single-page-application/index.md).
- Сведения о том, как развернуть веб-проекта Visual Studio в службе приложений Azure, см. в разделе [создать веб-приложение ASP.NET в службе приложений Azure](https://azure.microsoft.com/documentation/articles/web-sites-dotnet-get-started/).
