---
uid: web-api/overview/getting-started-with-aspnet-web-api/tutorial-your-first-web-api
title: Начало работы с веб-API ASP.NET 2 (C#)-ASP.NET 4. x
author: MikeWasson
description: Учебник с кодом. Используйте веб-API ASP.NET, чтобы создать веб-API, который возвращает список продуктов.
ms.author: riande
ms.date: 11/28/2017
ms.custom: seoapril2019
msc.legacyurl: /web-api/overview/getting-started-with-aspnet-web-api/tutorial-your-first-web-api
msc.type: authoredcontent
ms.openlocfilehash: 3e35c2bc0e46dfdb4544b772775eddd533f27be3
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78448554"
---
# <a name="get-started-with-aspnet-web-api-2-c"></a>Начало работы с веб-API ASP.NET 2 (C#)

по [Майк Уоссон](https://github.com/MikeWasson)

[Скачать завершенный проект](https://code.msdn.microsoft.com/Sample-code-of-Getting-c56ccb28)

В этом учебнике для создания веб-API, возвращающего список продуктов, будет использоваться веб-API ASP.NET.

HTTP не только обслуживает веб-страницы. Протокол HTTP также является мощной платформой для создания API-интерфейсов, предоставляющих службы и данные. HTTP является простой, гибкой и повсеместной. Практически любая платформа, которой можно считать, имеет библиотеку HTTP, поэтому службы HTTP могут обращаться к широкому спектру клиентов, включая браузеры, мобильные устройства и традиционные классические приложения.

Веб-API ASP.NET — это платформа для создания веб-API поверх .NET Framework. 

## <a name="software-versions-used-in-the-tutorial"></a>Версии программного обеспечения, используемые в этом руководстве

- [Visual Studio 2017](https://visualstudio.microsoft.com/downloads/?utm_medium=microsoft&utm_source=docs.microsoft.com&utm_campaign=button+cta&utm_content=download+vs2017)
- Веб-API 2

Более новую версию этого руководства см. в статье [Создание веб-API с помощью ASP.NET Core и Visual Studio для Windows](https://docs.microsoft.com/aspnet/core/tutorials/first-web-api) .

## <a name="create-a-web-api-project"></a>Создание проекта веб-API

В этом учебнике для создания веб-API, возвращающего список продуктов, будет использоваться веб-API ASP.NET. Интерфейсная веб-страница использует jQuery для вывода результатов.

![](tutorial-your-first-web-api/_static/image1.png)

Запустите Visual Studio и выберите **создать проект** на **начальной** странице. Либо в меню **файл** выберите **создать** , а затем — **проект**.

В области **шаблоны** выберите **Установленные шаблоны** и разверните узел  **C# визуального** элемента. В **разделе C#визуальный** элемент выберите **веб**. В списке шаблонов проектов выберите **ASP.NET веб-приложение**. Присвойте проекту имя "Продуктсапп" и нажмите кнопку **ОК**.

![](tutorial-your-first-web-api/_static/image2.png)

В диалоговом окне **Новый проект ASP.NET** выберите **пустой** шаблон. В разделе &quot;добавить папки и основные ссылки для&quot;, проверьте **веб-API**. Нажмите кнопку **ОК**.

![](tutorial-your-first-web-api/_static/image3.png)

> [!NOTE]
> Вы также можете создать проект веб-API, используя шаблон &quot;веб-API&quot;. Шаблон веб-API использует ASP.NET MVC для предоставления страниц справки API. Я использую пустой шаблон для этого руководства, так как я хочу отобразить веб-API без MVC. В общем случае нет необходимости знать ASP.NET MVC для использования веб-API.

## <a name="adding-a-model"></a>Добавление модели

*Модель* — это объект, который представляет данные в приложении. Веб-API ASP.NET может автоматически сериализовать вашу модель в формат JSON, XML или в какой-либо другие форматы, а затем записать сериализованные данные в текст сообщения HTTP-ответа. Пока клиент может считывать формат сериализации, он может десериализовать объект. Большинство клиентов могут выполнять синтаксический анализ XML-кода или JSON. Более того, клиент может указать, какой формат требуется, установив заголовок Accept в сообщении HTTP-запроса.

Начнем с создания простой модели, представляющей продукт.

Если обозреватель решений не отображается, щелкните меню **Просмотр** и выберите **Обозреватель решений**. В обозревателе решений щелкните правой кнопкой мыши папку Models. В контекстном меню выберите **Добавить**, а затем выберите **Класс**.

![](tutorial-your-first-web-api/_static/image4.png)

Присвойте классу имя &quot;&quot;продукта. Добавьте следующие свойства в класс `Product`.

[!code-csharp[Main](tutorial-your-first-web-api/samples/sample1.cs)]

## <a name="adding-a-controller"></a>Добавление контроллера

В веб-API *контроллер* — это объект, который обрабатывает HTTP-запросы. Мы добавим контроллер, который может возвращать либо список продуктов, либо отдельный продукт, заданный по ИДЕНТИФИКАТОРу.

> [!NOTE]
> Если вы использовали ASP.NET MVC, вы уже знакомы с контроллерами. Контроллеры веб-API похожи на контроллеры MVC, но наследуют класс **ApiController** , а не класс **Controller** .

В **обозревателе решений** щелкните правой кнопкой мыши папку Controllers. Щелкните **Добавить**, а затем выберите **Контроллер**.

![](tutorial-your-first-web-api/_static/image5.png)

В диалоговом окне **Добавление шаблона** выберите **Контроллер веб-API — пустой**. Нажмите кнопку **Добавить**.

![](tutorial-your-first-web-api/_static/image6.png)

В диалоговом окне **Добавление контроллера введите** имя контроллера &quot;продуктсконтроллер&quot;. Нажмите кнопку **Добавить**.

![](tutorial-your-first-web-api/_static/image7.png)

Формирование шаблонов создает файл с именем ProductsController.cs в папке Controllers.

![](tutorial-your-first-web-api/_static/image8.png)

> [!NOTE]
> Вам не нужно размещать контроллеры в папке с именем Controllers. Имя папки — это просто удобный способ организации исходных файлов.

Если этот файл еще не открыт, дважды щелкните его. Замените код в этом файле следующим кодом:

[!code-csharp[Main](tutorial-your-first-web-api/samples/sample2.cs)]

Чтобы упростить этот пример, продукты хранятся в фиксированном массиве внутри класса Controller. Разумеется, в реальных приложениях можно запрашивать базу данных или использовать какой-либо другой внешний источник данных.

Контроллер определяет два метода, которые возвращают продукты:

- Метод `GetAllProducts` возвращает весь список продуктов как тип **&gt;продукта IEnumerable&lt;** .
- Метод `GetProduct` ищет один продукт по его ИДЕНТИФИКАТОРу.

Вот и все! У вас есть рабочий веб-API. Каждый метод на контроллере соответствует одному или нескольким URI:

| Метод контроллера | URI |
| --- | --- |
| жеталлпродуктс | /апи/продуктс |
| Продукт | *идентификатор* /АПИ/Продуктс/ |

Для метода `GetProduct` *идентификатором* в URI является заполнитель. Например, чтобы получить продукт с ИДЕНТИФИКАТОРом 5, URI `api/products/5`.

Дополнительные сведения о том, как веб-API направляет запросы HTTP к методам контроллера, см. [в разделе Маршрутизация в веб-API ASP.NET](../web-api-routing-and-actions/routing-in-aspnet-web-api.md).

## <a name="calling-the-web-api-with-javascript-and-jquery"></a>Вызов веб-API с помощью JavaScript и jQuery

В этом разделе мы добавим страницу HTML, которая использует AJAX для вызова веб-API. Мы будем использовать jQuery для выполнения вызовов AJAX, а также для обновления страницы с результатами.

В обозреватель решений щелкните правой кнопкой мыши проект и выберите **Добавить**, а затем выберите **новый элемент**.

![](tutorial-your-first-web-api/_static/image9.png)

В диалоговом окне **Добавление нового элемента** выберите **веб-** узел в **разделе C#визуальный** элемент, а затем выберите **HTML Page** . Присвойте странице имя &quot;index. HTML&quot;.

![](tutorial-your-first-web-api/_static/image10.png)

Замените все в этом файле следующим:

[!code-html[Main](tutorial-your-first-web-api/samples/sample3.html)]

Для получения jQuery можно использовать следующие способы. В этом примере я использовал [CDN Microsoft AJAX](../../../ajax/cdn/overview.md). Его также можно скачать из [http://jquery.com/](http://jquery.com/), а шаблон проекта веб-API ASP.NET включает также jQuery.

### <a name="getting-a-list-of-products"></a>Получение списка продуктов

Чтобы получить список продуктов, отправьте запрос HTTP GET в &quot;&quot;/АПИ/Продуктс.

Функция jQuery [JSON](http://api.jquery.com/jQuery.getJSON/) ОТПРАВЛЯЕТ запрос Ajax. Для Response содержит массив объектов JSON. Функция `done` указывает обратный вызов, который вызывается при удачном выполнении запроса. В ответном вызове мы обновляем модель DOM с помощью сведений о продукте.

[!code-html[Main](tutorial-your-first-web-api/samples/sample4.html)]

### <a name="getting-a-product-by-id"></a>Получение продукта по ИДЕНТИФИКАТОРу

Чтобы получить продукт по ИДЕНТИФИКАТОРу, отправьте запрос HTTP GET в &quot;*идентификатор* /АПИ/Продуктс/&quot;, где *ID* — это идентификатор продукта.

[!code-javascript[Main](tutorial-your-first-web-api/samples/sample5.js)]

Мы по-прежнему вызываем `getJSON` для отправки запроса AJAX, но на этот раз идентификатор помещается в URI запроса. Ответ этого запроса представляет собой представление JSON одного продукта.

## <a name="running-the-application"></a>Запуск приложения

Нажмите клавишу F5 для запуска отладки приложения. Веб-страница должна выглядеть следующим образом:

![](tutorial-your-first-web-api/_static/image11.png)

Чтобы получить продукт по ИДЕНТИФИКАТОРу, введите идентификатор и нажмите кнопку Поиск:

![](tutorial-your-first-web-api/_static/image12.png)

При вводе недопустимого идентификатора сервер возвращает ошибку HTTP:

![](tutorial-your-first-web-api/_static/image13.png)

## <a name="using-f12-to-view-the-http-request-and-response"></a>Использование F12 для просмотра HTTP-запроса и ответа

При работе со службой HTTP может оказаться полезным просмотреть сообщения HTTP Request и Request. Это можно сделать с помощью средств разработчика F12 в Internet Explorer 9. В Internet Explorer 9 нажмите клавишу **F12** , чтобы открыть средства. Перейдите на вкладку **сеть** и нажмите кнопку **начать запись**. Теперь вернитесь на веб-страницу и нажмите клавишу **F5** , чтобы перезагрузить веб-страницу. Internet Explorer захватывает трафик HTTP между браузером и веб-сервером. В представлении "Сводка" отображается весь сетевой трафик для страницы:

![](tutorial-your-first-web-api/_static/image14.png)

Нахождение записи относительно URI "API/Products/". Выберите эту запись и щелкните **Перейти к подробному просмотру**. В подробном представлении имеются вкладки для просмотра заголовков запроса и ответа и текста. Например, если щелкнуть вкладку **заголовки запросов** , можно увидеть, что клиент запросил &quot;Application/JSON&quot; в заголовке Accept.

![](tutorial-your-first-web-api/_static/image15.png)

Если щелкнуть вкладку текст ответа, можно увидеть, как список продуктов был сериализован в JSON. Другие браузеры имеют аналогичные функции. Другой полезный инструмент — [Fiddler](http://www.fiddler2.com/fiddler2/), прокси-сервер отладки. Fiddler можно использовать для просмотра HTTP-трафика, а также для составления HTTP-запросов, что дает полный контроль над заголовками HTTP в запросе.

## <a name="see-this-app-running-on-azure"></a>См. приложение, работающее в Azure

Вы хотите увидеть готовый сайт, работающий как активное веб-приложение? Вы можете развернуть полную версию приложения в учетной записи Azure, просто нажав кнопку ниже.

[![](https://azuredeploy.net/deploybutton.png)](https://deploy.azure.com/?WT.mc_id=deploy_azure_aspnet&repository=https://github.com/tfitzmac/WebAPI-ProductsApp#/form/setup)

Для развертывания этого решения в Azure необходима учетная запись Azure. Если у вас еще нет учетной записи, возможны следующие варианты:

- [Откройте учетную запись Azure бесплатно](https://azure.microsoft.com/pricing/free-trial/?WT.mc_id=A443DD604) — вы получаете кредиты, которые можно использовать для пробного использования платных служб Azure, и даже после их использования вы можете удержать учетную запись и использовать бесплатные службы Azure.
- [Активация преимуществ для подписчиков MSDN](https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/?WT.mc_id=A443DD604) . Ваша подписка MSDN предоставляет Вам кредиты каждый месяц, который можно использовать для платных служб Azure.

## <a name="next-steps"></a>Next Steps

- Более полный пример службы HTTP, поддерживающей действия POST, WHERE и DELETE и записывающих данные в базу данных, см. в разделе [Использование веб-API 2 с Entity Framework 6](../data/using-web-api-with-entity-framework/part-1.md).
- Дополнительные сведения о создании гибких и реагирующих веб-приложений поверх службы HTTP см. в разделе [одностраничное приложение ASP.NET](../../../single-page-application/index.md).
- Сведения о том, как развернуть веб-проект Visual Studio в службе приложений Azure, см. [в статье Создание веб-приложения ASP.NET в службе приложений Azure](https://azure.microsoft.com/documentation/articles/web-sites-dotnet-get-started/).
