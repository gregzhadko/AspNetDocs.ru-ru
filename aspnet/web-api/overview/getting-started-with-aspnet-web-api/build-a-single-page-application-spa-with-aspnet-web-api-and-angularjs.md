---
uid: web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs
title: Практическое занятие. Создание одностраничного приложения (SPA) с веб-API ASP.NET и угловой. js-ASP.NET 4. x
author: rick-anderson
description: Пошаговое руководство. Создание одностраничного приложения (SPA) с веб-API ASP.NET и угловой JS-файл для ASP.NET 4. x.
ms.author: riande
ms.date: 09/30/2015
ms.custom: seoapril2019
ms.assetid: 719727b7-bef3-45ad-bfe9-ba5bcdb2305f
msc.legacyurl: /web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs
msc.type: authoredcontent
ms.openlocfilehash: 86833a890da759e489dd11dc9afb128a9b7a75e3
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78448764"
---
# <a name="hands-on-lab-build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs"></a>Практическое занятие. Создание одностраничного приложения (SPA) с помощью веб-API ASP.NET и угловой. js

по [веб-Camp командам](https://twitter.com/webcamps)

[Скачать обучающий комплект Web Camp](https://aka.ms/webcamps-training-kit)

В этом практическом занятии показано, как создать одностраничное приложение (SPA) с веб-API ASP.NET и угловой. js для ASP.NET 4. x.

В этом практическом занятии вы будете использовать преимущества этих технологий для реализации высокопроизводительного головоломки, веб-сайта Trivia на основе концепции SPA. Сначала необходимо реализовать слой служб с веб-API ASP.NET, чтобы предоставить необходимые конечные точки для получения контрольных вопросов и сохранения ответов. Затем вы создадите богатый и реагирующий пользовательский интерфейс, используя эффекты преобразования AngularJS и CSS3.

В традиционных веб-приложениях клиент (браузер) инициирует связь с сервером, запрашивая страницу. Затем сервер обрабатывает запрос и отправляет клиенту HTML-код страницы. При последующем взаимодействии со страницей, например. пользователь переходит по ссылке или отправляет форму с данными — на сервер отправляется новый запрос, и последовательность запускается снова: сервер обрабатывает запрос и отправляет в браузер новую страницу в ответ на новый запрос действия. ED клиента.
> 
> В одностраничных приложениях (одностраничные приложения) вся страница загружается в браузер после первоначального запроса, но последующие взаимодействия выполняются через запросы AJAX. Это означает, что браузер должен обновить только ту часть страницы, которая была изменена. нет необходимости перезагружать всю страницу. Подход с SPA сокращает время, затрачиваемое приложением на реагирование на действия пользователя, что приводит к более гибкому интерфейсу.
> 
> Архитектура SPA подразумевает определенные проблемы, которые не представлены в традиционных веб-приложениях. Однако новые технологии, такие как веб-API ASP.NET, платформы JavaScript, такие как AngularJS и новые функции стилизации, предоставляемые CSS3, упрощают проектирование и сборку одностраничные приложения.
> 
> 
> Все примеры кода и фрагментов включены в комплект обучающих курсов Web Camp, доступный по адресу [https://aka.ms/webcamps-training-kit](https://aka.ms/webcamps-training-kit).

## <a name="overview"></a>Обзор

<a id="Objectives"></a>
### <a name="objectives"></a>Цели

В этой практической лабораторной работе вы узнаете, как выполнять следующие задачи:

- Создание веб-API ASP.NET службы для отправки и получения данных JSON
- Создание реагирующего пользовательского интерфейса с помощью AngularJS
- Повышение удобства работы с ИНТЕРФЕЙСом с помощью преобразований CSS3

<a id="Prerequisites"></a>
### <a name="prerequisites"></a>предварительные требования

Для выполнения этой практической лабораторной работы требуется следующее:

- [Visual Studio Express 2013 для Web](https://www.microsoft.com/visualstudio/) или более поздней версии

<a id="Setup"></a>
### <a name="setup"></a>Настройка

Чтобы выполнить упражнения в этой практической лабораторной работе, сначала необходимо настроить среду.

1. Откройте проводник Windows и перейдите к **исходной** папке лаборатории.
2. Щелкните **Setup. cmd** правой кнопкой мыши и выберите **Запуск от имени администратора** , чтобы запустить процесс установки, который будет настраивать среду и установить фрагменты кода Visual Studio для этой лабораторной работы.
3. Если отображается диалоговое окно Контроль учетных записей пользователей, подтвердите действие для продолжения.

> [!NOTE]
> Убедитесь, что проверены все зависимости для этой лабораторной работы перед запуском программы установки.

<a id="CodeSnippets"></a>
### <a name="using-the-code-snippets"></a>Использование фрагментов кода

На протяжении всего лабораторного документа вы получите инструкции по вставке блоков кода. Для удобства большая часть этого кода предоставляется как Visual Studio Code фрагменты, к которым можно получить доступ из Visual Studio 2013, чтобы не добавлять их вручную.

> [!NOTE]
> Каждое упражнение сопровождается начальным решением, расположенным в **начальной** папке упражнения, которое позволяет выполнять каждое упражнение независимо от других. Имейте в виду, что фрагменты кода, добавленные во время упражнения, отсутствуют в этих начальных решениях и могут не работать, пока вы не завершите упражнение. В исходном коде для упражнения также будет найдена **Конечная** папка, содержащая решение Visual Studio с кодом, полученным в результате выполнения шагов в соответствующем упражнении. Эти решения можно использовать в качестве руководства, если вам нужна дополнительная помощь во время работы с этой практической лабораторной работой.

---

<a id="Exercises"></a>
## <a name="exercises"></a>Полнят

Эта практическая лабораторная работа включает в себя следующие упражнения:

1. [Создание веб-API](#Exercise1)
2. [Создание интерфейса SPA](#Exercise2)

Предполагаемое время выполнения этой лабораторной работы: **60 минут**

> [!NOTE]
> При первом запуске Visual Studio необходимо выбрать одну из предварительно определенных коллекций параметров. Каждая предопределенная коллекция разработана для соответствия определенному стилю разработки и определяет макеты окон, поведение редактора, фрагменты кода IntelliSense и параметры диалоговых окон. Процедуры в этом лабораторном занятии описывают действия, необходимые для выполнения данной задачи в Visual Studio при использовании коллекции **общих параметров разработки** . При выборе другой коллекции параметров для среды разработки могут возникнуть различия в действиях, которые необходимо учитывать.

<a id="Exercise1"></a>
### <a name="exercise-1-creating-a-web-api"></a>Упражнение 1. Создание веб-API

Одной из ключевых частей SPA является уровень служб. Он отвечает за обработку вызовов AJAX, отправленных интерфейсом пользователя, и возвращает данные в ответ на этот вызов. Полученные данные должны быть представлены в удобочитаемом для компьютера формате, чтобы их можно было проанализировать и использовать в клиенте.

Платформа веб-API является частью стека ASP.NET и разработана для упрощения реализации служб HTTP, которая обычно отправляет и получает данные в формате JSON или XML через API RESTFUL. В этом упражнении вы создадите веб-сайт для размещения приложения "Викторина", а затем реализуете серверную службу для предоставления и сохранения данных головоломки с помощью веб-API ASP.NET.

<a id="Ex1Task1"></a>
#### <a name="task-1--creating-the-initial-project-for-geek-quiz"></a>Задача 1. Создание начального проекта для головоломки

В этой задаче будет начато создание нового проекта ASP.NET MVC с поддержкой веб-API ASP.NET на основе типа проекта **ASP.NET** , который поставляется с Visual Studio. **Один ASP.NET** объединяет все технологии ASP.NET и дает возможность смешивать и сопоставлять их по своему усмотрению. Затем вы добавите классы модели Entity Framework и инициализатор базы данных, чтобы вставить вопросы о викторине.

1. Откройте **Visual Studio Express 2013 для Web** и выберите **файл | Создать проект...** для запуска нового решения.

    ![Создание нового проекта](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image1.png "Создание нового проекта")

    *Создание нового проекта*
2. В диалоговом окне **Новый проект** выберите **ASP.NET веб-приложение** в **визуальном C# элементе | Веб-** вкладка. Убедитесь, что выбран **.NET Framework 4,5** , назовите его *жееккуиз*, выберите **Расположение** и нажмите кнопку **ОК**.

    ![Создание нового проекта веб-приложения ASP.NET](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image2.png "Создание нового проекта веб-приложения ASP.NET")

    *Создание нового проекта веб-приложения ASP.NET*
3. В диалоговом окне **Новый проект ASP.NET** выберите шаблон **MVC** и выберите параметр **веб-API** . Кроме того, убедитесь, что для параметра **Проверка подлинности** задано значение **индивидуальные учетные записи пользователей**. Чтобы продолжить, нажмите кнопку **ОК** .

    ![Создание нового проекта с шаблоном MVC, включая компоненты веб-API](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image3.png)

    *Создание нового проекта с шаблоном MVC, включая компоненты веб-API*
4. В **Обозреватель решений**щелкните правой кнопкой мыши папку **Models** проекта **жееккуиз** и выберите **Добавить | Существующий элемент...** .

    ![Добавление существующего элемента](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image4.png "Добавление существующего элемента")

    *Добавление существующего элемента*
5. В диалоговом окне **Добавление существующего элемента** перейдите к папке **Source/Assets/Models** и выберите все файлы. Нажмите кнопку **Добавить**.

    ![Добавление ресурсов модели](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image5.png "Добавление ресурсов модели")

    *Добавление ресурсов модели*

    > [!NOTE]
    > Добавляя эти файлы, вы добавляете модель данных, контекст базы данных Entity Framework и инициализатор базы данных для приложения для головоломки.
    > 
    > **Entity Framework (EF)** — это объектно-реляционная система СОПОСТАВЛЕНИЯ (ORM), позволяющая создавать приложения для доступа к данным с помощью программирования с концептуальной моделью приложения, а не непосредственно с помощью реляционной схемы хранилища. Дополнительные сведения о Entity Framework см. [здесь](../../../entity-framework.md).
    > 
    > Ниже приведено описание только что добавленных классов.
    > 
    > - **Тривиаоптион:** представляет один параметр, связанный с вопросом головоломки.
    > - **Тривиакуестион:** представляет вопрос головоломки и предоставляет связанные параметры через свойство **Options** .
    > - **Тривиаансвер:** представляет параметр, выбранный пользователем в ответ на вопрос о викторине.
    > - **Тривиаконтекст.** представляет контекст базы данных Entity Framework приложения для головоломки. Этот класс является производным от **дконтекст** и предоставляет свойства **DbSet** , представляющие коллекции сущностей, описанных выше.
    > - **Тривиадатабасеинитиализер:** реализация инициализатора Entity Framework для класса **тривиаконтекст** , который наследует от **CreateDatabaseIfNotExists**. Поведение этого класса по умолчанию — создать базу данных только в том случае, если она не существует, вставляя сущности, указанные в методе **SEED** .
6. Откройте файл **Global.asax.CS** и добавьте следующую инструкцию using.

    [!code-csharp[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample1.cs)]
7. Добавьте следующий код в начало **\_ного метода запуска приложения** , чтобы задать в качестве инициализатора базы данных **тривиадатабасеинитиализер** .

    [!code-csharp[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample2.cs)]
8. Измените контроллер **Home** , чтобы ограничить доступ для пользователей, прошедших проверку подлинности. Для этого откройте файл **HomeController.CS** в папке **Controllers** и добавьте атрибут **авторизовать** в определение класса **HomeController** .

    [!code-csharp[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample3.cs)]

    > [!NOTE]
    > Фильтр **авторизации** проверяет, прошел ли пользователь проверку подлинности. Если пользователь не прошел проверку подлинности, он возвращает код состояния HTTP 401 (не санкционированный) без вызова действия. Фильтр можно применять глобально, на уровне контроллера или на уровне отдельных действий.
9. Теперь вы настроите макет веб-страниц и фирменной символики. Для этого откройте файл **\_Layout. cshtml** в **представлениях | Общая** папка и обновление содержимого элемента **&lt;Title&gt;** , заменив *приложение ASP.NET* с помощью *головоломки*.

    [!code-cshtml[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample4.cshtml)]
10. В том же файле обновите панель навигации, удалив ссылки *About* и *Contact* и переименование *домашней* ссылки для *воспроизведения*. Кроме того, переименуйте ссылку на *имя приложения* в *викторину по владению*. HTML-код для панели навигации должен выглядеть, как в следующем коде.

    [!code-cshtml[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample5.cshtml)]
11. Обновите нижний колонтитул страницы макета, заменив *приложение ASP.NET* с помощью *головоломки*. Для этого замените содержимое элемента **&gt;нижнего колонтитула&lt;** следующим выделенным кодом.

    [!code-html[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample6.html)]

<a id="Ex1Task2"></a>
#### <a name="task-2--creating-the-triviacontroller-web-api"></a>Задача 2. Создание веб-API Тривиаконтроллер

В предыдущей задаче вы создали начальную структуру веб-приложения "Викторина". Теперь вы создадите простую службу веб-API, которая взаимодействует с моделью данных головоломки и предоставляет следующие действия:

- **Get/АПИ/Тривиа**: получение следующего вопроса из списка опроса для получения ответа от пользователя, прошедшего проверку подлинности.
- **POST/АПИ/Тривиа**: сохраняет ответ головоломки, указанный прошедшим проверку подлинности пользователем.

Вы будете использовать средства формирования шаблонов ASP.NET, предоставляемые Visual Studio, для создания базовых показателей для класса контроллера веб-API.

1. Откройте файл **WebApiConfig.CS** в папке **приложения\_Start** . Этот файл определяет конфигурацию службы веб-API, например способ сопоставления маршрутов с действиями контроллера веб-API.
2. Добавьте следующую инструкцию using в начало файла.

    [!code-csharp[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample7.cs)]
3. Добавьте выделенный ниже код в метод **Register** для глобальной настройки модуля форматирования данных JSON, извлекаемых методами действий веб-API.

    [!code-csharp[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample8.cs)]

    > [!NOTE]
    > **Камелкасепропертинамесконтрактресолвер** автоматически преобразует имена свойств в *Camel* , что является общим соглашением для имен свойств в JavaScript.
4. В **Обозреватель решений**щелкните правой кнопкой мыши папку **Controllers** проекта **жееккуиз** и выберите **Добавить | Создать шаблонный элемент...**

    ![Создание нового шаблона элемента](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image6.png "Создание нового шаблона элемента")

    *Создание нового шаблона элемента*
5. В диалоговом окне **Добавление шаблона** убедитесь, что на левой панели выбран параметр **Общий** узел. Затем выберите шаблон " **контроллер веб-API 2 — пустой** " в центральной области и нажмите кнопку **Добавить**.

    ![Выбор пустого шаблона веб-API 2](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image7.png "Выбор пустого шаблона веб-API 2")

    *Выбор пустого шаблона веб-API 2*

    > [!NOTE]
    > **Формирование шаблонов ASP.NET** — это платформа создания кода для веб-приложений ASP.NET. Visual Studio 2013 включает предварительно установленные генераторы кода для проектов MVC и веб-API. Формирование шаблонов в проекте следует использовать, если необходимо быстро добавить код, взаимодействующий с моделями данных, чтобы сократить время, необходимое для разработки стандартных операций с данными.
    > 
    > Процесс формирования шаблонов также гарантирует, что в проекте будут установлены все необходимые зависимости. Например, если начать с пустого проекта ASP.NET, а затем использовать формирование шаблонов для добавления контроллера веб-API, необходимые пакеты и ссылки NuGet веб-API добавляются в проект автоматически.
6. В диалоговом окне **Добавление контроллера** в текстовом поле **имя контроллера** введите *тривиаконтроллер* и нажмите кнопку **Добавить**.

    ![Добавление контроллера Trivia](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image8.png "Добавление контроллера Trivia")

    *Добавление контроллера Trivia*
7. Затем файл **TriviaController.CS** добавляется в папку **Controllers** проекта **Жееккуиз** , содержащий пустой класс **тривиаконтроллер** . Добавьте следующие операторы using в начало файла.

    (Фрагмент кода — *аспнетвебаписпа-EX1-тривиаконтроллерусингс*)

    [!code-csharp[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample9.cs)]
8. Добавьте следующий код в начало класса **тривиаконтроллер** , чтобы определить, инициализировать и ликвидировать экземпляр **тривиаконтекст** в контроллере.

    (Фрагмент кода — *аспнетвебаписпа-EX1-тривиаконтроллерконтекст*)

    [!code-csharp[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample10.cs)]

    > [!NOTE]
    > Метод **Dispose** метода **тривиаконтроллер** вызывает метод **Dispose** экземпляра **тривиаконтекст** , который гарантирует освобождение всех ресурсов, используемых объектом контекста, при удалении экземпляра **тривиаконтекст** или при сборке мусора. Это включает закрытие всех подключений к базе данных, открытых Entity Framework.
9. Добавьте следующий вспомогательный метод в конец класса **тривиаконтроллер** . Этот метод извлекает из базы данных следующий контрольный вопрос для ответа от указанного пользователя.

    (Фрагмент кода — *аспнетвебаписпа-EX1-тривиаконтроллернексткуестион*)

    [!code-csharp[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample11.cs)]
10. Добавьте следующий метод действия **Get** в класс **тривиаконтроллер** . Этот метод действия вызывает вспомогательный метод **нексткуестионасинк** , определенный на предыдущем шаге, для получения следующего вопроса для пользователя, прошедшего проверку подлинности.

    (Фрагмент кода — *аспнетвебаписпа-EX1-тривиаконтроллержетактион*)

    [!code-csharp[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample12.cs)]
11. Добавьте следующий вспомогательный метод в конец класса **тривиаконтроллер** . Этот метод сохраняет указанный ответ в базе данных и возвращает логическое значение, указывающее, является ли ответ правильным.

    (Фрагмент кода — *аспнетвебаписпа-EX1-тривиаконтроллерстореасинк*)

    [!code-csharp[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample13.cs)]
12. Добавьте следующий метод действия **POST** в класс **тривиаконтроллер** . Этот метод действия связывает ответ для пользователя, прошедшего проверку подлинности, и вызывает вспомогательный метод **стореасинк** . Затем он отправляет ответ с логическим значением, возвращенным вспомогательным методом.

    (Фрагмент кода — *аспнетвебаписпа-EX1-тривиаконтроллерпостактион*)

    [!code-csharp[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample14.cs)]
13. Измените контроллер веб-API, чтобы ограничить доступ к пользователям, прошедшим проверку подлинности, добавив атрибут **авторизации** в определение класса **тривиаконтроллер** .

    [!code-csharp[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample15.cs)]

<a id="Ex1Task3"></a>
#### <a name="task-3--running-the-solution"></a>Задача 3. Запуск решения

В этой задаче будет выполнена проверка правильности работы службы веб-API, созданной в предыдущей задаче. Для записи сетевого трафика и проверки полного ответа от службы веб-API используется Средства для разработчиков Internet Explorer **F12** .

> [!NOTE]
> Убедитесь, что в кнопке **Пуск** на панели инструментов Visual Studio выбран параметр **Internet Explorer** .
> 
> ![Параметр Internet Explorer](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image9.png)

1. Чтобы запустить решение, нажмите клавишу **F5**. Страница **входа** должна появиться в браузере.

    > [!NOTE]
    > При запуске приложения активируется маршрут MVC по умолчанию, который по умолчанию сопоставляется с действием **индекса** класса **HomeController** . Так как **HomeController** ограничена пользователями, прошедшим проверку подлинности (Помните, что вы наложили этот класс атрибутом **авторизации** в упражнении 1) и пока не прошли проверку подлинности пользователя, приложение перенаправит исходный запрос на страницу входа.

    ![Запуск решения](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image10.png "Запуск решения")

    *Запуск решения*
2. Нажмите кнопку **зарегистрировать** , чтобы создать нового пользователя.

    ![Регистрация нового пользователя](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image11.png "Регистрация нового пользователя")

    *Регистрация нового пользователя*
3. На странице **Регистрация** введите **имя пользователя** и **пароль**, а затем нажмите кнопку **зарегистрировать**.

    ![Страница "регистрация"](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image12.png "Страница "регистрация"")

    *Страница "регистрация"*
4. Приложение регистрирует новую учетную запись, и пользователь проходит проверку подлинности и перенаправляется обратно на домашнюю страницу.

    ![Пользователь прошел проверку подлинности](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image13.png "Пользователь прошел проверку подлинности")

    *Пользователь прошел проверку подлинности*
5. В браузере нажмите клавишу **F12** , чтобы открыть панель **средства для разработчиков** . Нажмите **сочетание клавиш Ctrl + 4** или щелкните значок **сети** , а затем нажмите кнопку с зеленой стрелкой, чтобы начать запись сетевого трафика.

    ![Инициация записи сети веб-API](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image14.png "Инициация записи сети веб-API")

    *Инициация записи сети веб-API*
6. Добавьте **API/Trivia** в URL-адрес в адресной строке браузера. Теперь вы проверите сведения о ответе в методе действия **Get** в **тривиаконтроллер**.

    ![Получение данных следующего вопроса через веб-API](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image15.png "Получение данных следующего вопроса через веб-API")

    *Получение данных следующего вопроса через веб-API*

    > [!NOTE]
    > После завершения загрузки вам будет предложено выполнить действие с скачанным файлом. Оставьте диалоговое окно открытым, чтобы иметь возможность просматривать содержимое ответа через окно инструментов разработчиков.
7. Теперь вы проверите текст ответа. Для этого перейдите на вкладку **сведения** и щелкните **текст ответа**. Можно проверить, что загруженные данные являются объектом с **параметрами** свойств (который является списком объектов **тривиаоптион** ), **идентификатором** и **названием** , которые соответствуют классу **тривиакуестион** .

    ![Просмотр текста ответа веб-API](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image16.png "Просмотр текста ответа веб-API")

    *Просмотр текста ответа веб-API*
8. Вернитесь в Visual Studio и нажмите клавиши **SHIFT + F5** , чтобы прерывать отладку.

<a id="Exercise2"></a>
### <a name="exercise-2-creating-the-spa-interface"></a>Упражнение 2. Создание интерфейса SPA

В этом упражнении вы сначала создаете веб-интерфейсную часть головоломки, которая сосредоточена на взаимодействии одностраничного приложения с помощью **AngularJS**. Затем вы улучшите взаимодействие с пользователем с помощью CSS3, чтобы выполнять богатую анимацию и обеспечить визуальный эффект переключения контекста при переходе от одного вопроса к другому.

<a id="Ex2Task1"></a>
#### <a name="task-1--creating-the-spa-interface-using-angularjs"></a>Задача 1. Создание интерфейса SPA с помощью AngularJS

В этой задаче вы будете использовать **AngularJS** для реализации клиентской стороны приложения для головоломки. **AngularJS** — это платформа JavaScript с открытым исходным кодом, которая дополняет приложения на основе браузера с помощью *модели* MVC, что упрощает разработку и тестирование.

Начнем с установки AngularJS из консоли диспетчера пакетов Visual Studio. Затем вы создадите контроллер, чтобы обеспечить поведение приложения для головоломки и представления для отображения вопросов и ответов по викторине с помощью механизма шаблонов AngularJS.

> [!NOTE]
> Дополнительные сведения об AngularJS см. в разделе [[http://angularjs.org/](http://angularjs.org/)](http://angularjs.org/).

1. Откройте **Visual Studio Express 2013 для Web** и откройте решение **жееккуиз. sln** , расположенное в папке **Source/EX2-креатингаспаинтерфаце/Begin** . Кроме того, можно продолжить работу с решением, полученным в предыдущем упражнении.
2. Откройте **консоль диспетчера пакетов** из **меню Инструменты** > **Диспетчер пакетов NuGet**. Введите следующую команду, чтобы установить пакет NuGet для **AngularJS. Core** .

    [!code-powershell[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample16.ps1)]
3. В **Обозреватель решений**щелкните правой кнопкой мыши папку **Scripts** проекта **жееккуиз** и выберите **Добавить | Новая папка**. Назовите **приложение** папки и нажмите клавишу **Ввод**.
4. Щелкните правой кнопкой мыши только что созданную папку **приложения** и выберите **Добавить | Файл JavaScript**.

    ![Создание нового файла JavaScript](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image17.png)

    *Создание нового файла JavaScript*
5. В диалоговом окне **Указание имени для элемента** введите *Викторина-Controller* в текстовое поле **имя элемента** и нажмите кнопку **ОК**.

    ![Присвоение имени новому файлу JavaScript](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image18.png)

    *Присвоение имени новому файлу JavaScript*
6. В файле **куиз-контроллер. js** добавьте следующий код для объявления и инициализации контроллера AngularJS **куизктрл** .

    (Фрагмент кода — *аспнетвебаписпа-EX2-ангуларкуизконтроллер*)

    [!code-javascript[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample17.js)]

    > [!NOTE]
    > Функция конструктора контроллера **куизктрла** должна включать в себя параметр с именем **$Scope**. Начальное состояние области должно быть настроено в функции конструктора путем присоединения свойств к объекту **$Scope** . Свойства содержат **модель представления**и будут доступны шаблону при регистрации контроллера.
    > 
    > Контроллер **куизктрл** определяется внутри модуля с именем **куизапп**. Модули — это рабочие блоки, которые позволяют разбивать приложение на отдельные компоненты. Основными преимуществами использования модулей являются то, что код проще в понимании и упрощает модульное тестирование, повторное использование и удобство сопровождения.
7. Теперь вы добавите поведение в область, чтобы реагировать на события, запускаемые из представления. Добавьте следующий код в конец контроллера **куизктрл** , чтобы определить функцию **нексткуестион** в объекте **$Scope** .

    (Фрагмент кода — *аспнетвебаписпа-EX2-ангуларкуизконтроллернексткуестион*)

    [!code-javascript[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample18.js)]

    > [!NOTE]
    > Эта функция извлекает следующий вопрос из веб-API **Trivia** , созданного в предыдущем упражнении, и прикрепляет данные вопроса к объекту **$Scope** .
8. Вставьте следующий код в конец контроллера **куизктрл** , чтобы определить функцию **сендансвер** в объекте **$Scope** .

    (Фрагмент кода — *аспнетвебаписпа-EX2-ангуларкуизконтроллерсендансвер*)

    [!code-javascript[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample19.js)]

    > [!NOTE]
    > Эта функция отправляет ответ, выбранный пользователем, в веб-API **Trivia** и сохраняет результат — т. е. Если ответ правильный или нет — в объекте **$Scope** .
    > 
    > Функции **нексткуестион** и **сендансвер** , приведенные выше, используют объект AngularJS **$http** для абстракции взаимодействия с веб-API через объект JavaScript XMLHttpRequest из браузера. AngularJS поддерживает другую службу, которая предоставляет более высокий уровень абстракции для выполнения операций CRUD с ресурсом через API RESTFUL. Объект AngularJS **$Resource** имеет методы действий, которые обеспечивают высокий уровень поведения без необходимости взаимодействия с объектом **$http** . Рассмотрите возможность использования объекта **$Resource** в сценариях, для которых требуется модель CRUD (для получения сведений см. [документацию по $Resource](https://docs.angularjs.org/api/ngResource/service/$resource)).
9. Следующим шагом является создание шаблона AngularJS, определяющего представление для головоломки. Для этого откройте файл **index. cshtml** в **представлениях | Домашняя** папка и замените содержимое следующим кодом.

    (Фрагмент кода — *аспнетвебаписпа-EX2-жееккуизвиев*)

    [!code-cshtml[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample20.cshtml)]

    > [!NOTE]
    > Шаблон AngularJS — это декларативная спецификация, которая использует информацию из модели и контроллера для преобразования статической разметки в динамическое представление, которое пользователь видит в браузере. Ниже приведены примеры элементов AngularJS и атрибутов элементов, которые можно использовать в шаблоне.
    > 
    > - Директива **NG-App** сообщает ANGULARJS элемент DOM, представляющий корневой элемент приложения.
    > - Директива **NG-Controller** прикрепляет контроллер к модели DOM в точке объявления директивы.
    > - Фигурная скобка **{{}}** обозначает привязки к свойствам области, определенным в контроллере.
    > - Директива **NG-Click** используется для вызова функций, определенных в области действия в ответ на нажатие пользователем.
10. Откройте файл **site. CSS** в папке **Content** и добавьте в конец файла следующие выделенные стили, чтобы обеспечить внешний вид и представление головоломки.

    (Фрагмент кода — *аспнетвебаписпа-EX2-жееккуизстилес*)

    [!code-css[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample21.css)]

<a id="Ex2Task2"></a>
#### <a name="task-2--running-the-solution"></a>Задача 2. Запуск решения

В этой задаче вы выполните решение с помощью нового пользовательского интерфейса, созданного с помощью AngularJS, чтобы ответить на некоторые вопросы головоломки.

1. Чтобы запустить решение, нажмите клавишу **F5**.
2. Зарегистрируйте новую учетную запись пользователя. Для этого выполните действия по регистрации, описанные в упражнении 1, задача 3.

    > [!NOTE]
    > Если вы используете решение из предыдущего упражнения, вы можете войти в систему, используя учетную запись пользователя, созданную ранее.
3. Откроется **Домашняя** страница с первым вопросом головоломки. Ответьте на вопрос, щелкнув один из вариантов. Это приведет к активации функции **сендансвер** , определенной ранее, которая отправляет выбранный параметр в веб-API **Trivia** .

    ![Ответ на вопрос](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image19.png "Ответ на вопрос")

    *Ответ на вопрос*
4. После нажатия одной из кнопок появится ответ. Нажмите кнопку **следующий вопрос** , чтобы отобразить следующий вопрос. Это приведет к активации функции **нексткуестион** , определенной в контроллере.

    ![Запрос следующего вопроса](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image20.png "Запрос следующего вопроса")

    *Запрос следующего вопроса*
5. Должен появиться следующий вопрос. Продолжайте отвечать на вопросы столько раз, сколько нужно. После выполнения всех вопросов необходимо вернуться к первому вопросу.

    ![Другой вопрос](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image21.png "Другой вопрос")

    *Следующий вопрос*
6. Вернитесь в Visual Studio и нажмите клавиши **SHIFT + F5** , чтобы прерывать отладку.

<a id="Ex2Task3"></a>
#### <a name="task-3--creating-a-flip-animation-using-css3"></a>Задача 3. Создание отражения анимации с помощью CSS3

В этой задаче вы будете использовать свойства CSS3 для выполнения многофункциональной анимации, добавив эффект перелистывания при ответе на вопрос и при получении следующего вопроса.

1. В **Обозреватель решений**щелкните правой кнопкой мыши папку **содержимого** проекта **жееккуиз** и выберите **Добавить | Существующий элемент...** .

    ![Добавление существующего элемента в папку содержимого](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image22.png "Добавление существующего элемента в папку содержимого")

    *Добавление существующего элемента в папку содержимого*
2. В диалоговом окне **Добавление существующего элемента** перейдите к папке **Source/Assets** и выберите **reворачивают. CSS**. Нажмите кнопку **Добавить**.

    ![Добавление файла reпереворот. CSS из ресурсов](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image23.png "Добавление файла reпереворот. CSS из ресурсов")

    *Добавление файла reпереворот. CSS из ресурсов*
3. Откройте только что добавленный файл **reворачивают. CSS** и проверьте его содержимое.
4. Откройте комментарий **преобразования "отразить** ". Стили, приведенные ниже, используют **перспективу** CSS и преобразования поворота для создания &quot;ной карты, **перевернутой**&quot;ный результат.

    [!code-css[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample22.css)]
5. В окне " **Скрыть панель" во время перелистывания** . Стиль под комментарием скрывает сторону стороны сторон, когда они исчезают от средства просмотра, устанавливая свойство CSS со свойством **отображения** обратной стороны в значение *Hidden*.

    [!code-css[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample23.css)]
6. Откройте файл **BundleConfig.CS** в папке **приложения\_Start** и добавьте ссылку на файл **отражения. css** в **&quot;~/контент/КСС&quot;** наборе стилей

    [!code-csharp[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample24.cs)]
7. Нажмите клавишу **F5** , чтобы запустить решение и войти с помощью своих учетных данных.
8. Ответьте на вопрос, щелкнув один из вариантов. Обратите внимание на эффекты перелистывания при переходе между представлениями.

    ![Ответ на вопрос с помощью действия "отразить"](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image24.png "Ответ на вопрос с помощью действия "отразить"")

    *Ответ на вопрос с помощью действия "отразить"*
9. Нажмите кнопку **следующий вопрос** , чтобы получить следующий вопрос. Результат перелистывания должен появиться снова.

    ![Получение следующего вопроса с помощью действия "отразить"](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image25.png "Получение следующего вопроса с помощью действия "отразить"")

    *Получение следующего вопроса с помощью действия "отразить"*

---

<a id="Summary"></a>
## <a name="summary"></a>Сводка

С помощью этой практической лабораторной работы вы узнали, как:

- Создание контроллера веб-API ASP.NET с помощью формирования шаблонов ASP.NET
- Реализация действия Get веб-API для получения следующего контрольного вопроса
- Реализация действия POST веб-API для хранения ответов на викторину
- Установка AngularJS из консоли диспетчера пакетов Visual Studio
- Реализация шаблонов и контроллеров AngularJS
- Использование переходов CSS3 для выполнения эффектов анимации
