---
uid: web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs
title: Практическое занятие. Создание одностраничного приложения (SPA) с веб-API ASP.NET и угловой. js-ASP.NET 4. x
author: rick-anderson
description: Пошаговое руководство. Создание одностраничного приложения (SPA) с веб-API ASP.NET и угловой JS-файл для ASP.NET 4. x.
ms.author: riande
ms.date: 09/30/2015
ms.custom: seoapril2019
ms.assetid: 719727b7-bef3-45ad-bfe9-ba5bcdb2305f
msc.legacyurl: /web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs
msc.type: authoredcontent
ms.openlocfilehash: 86833a890da759e489dd11dc9afb128a9b7a75e3
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78448764"
---
# <a name="hands-on-lab-build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs"></a><span data-ttu-id="87a15-103">Практическое занятие. Создание одностраничного приложения (SPA) с помощью веб-API ASP.NET и угловой. js</span><span class="sxs-lookup"><span data-stu-id="87a15-103">Hands On Lab: Build a Single Page Application (SPA) with ASP.NET Web API and Angular.js</span></span>

<span data-ttu-id="87a15-104">по [веб-Camp командам](https://twitter.com/webcamps)</span><span class="sxs-lookup"><span data-stu-id="87a15-104">by [Web Camps Team](https://twitter.com/webcamps)</span></span>

[<span data-ttu-id="87a15-105">Скачать обучающий комплект Web Camp</span><span class="sxs-lookup"><span data-stu-id="87a15-105">Download Web Camps Training Kit</span></span>](https://aka.ms/webcamps-training-kit)

<span data-ttu-id="87a15-106">В этом практическом занятии показано, как создать одностраничное приложение (SPA) с веб-API ASP.NET и угловой. js для ASP.NET 4. x.</span><span class="sxs-lookup"><span data-stu-id="87a15-106">This hands on lab shows you how to build a Single Page Application (SPA) with ASP.NET Web API and Angular.js for ASP.NET 4.x.</span></span>

<span data-ttu-id="87a15-107">В этом практическом занятии вы будете использовать преимущества этих технологий для реализации высокопроизводительного головоломки, веб-сайта Trivia на основе концепции SPA.</span><span class="sxs-lookup"><span data-stu-id="87a15-107">In this hand-on lab, you will take advantage of those technologies to implement Geek Quiz, a trivia website based on the SPA concept.</span></span> <span data-ttu-id="87a15-108">Сначала необходимо реализовать слой служб с веб-API ASP.NET, чтобы предоставить необходимые конечные точки для получения контрольных вопросов и сохранения ответов.</span><span class="sxs-lookup"><span data-stu-id="87a15-108">You will first implement the service layer with ASP.NET Web API to expose the required endpoints to retrieve the quiz questions and store the answers.</span></span> <span data-ttu-id="87a15-109">Затем вы создадите богатый и реагирующий пользовательский интерфейс, используя эффекты преобразования AngularJS и CSS3.</span><span class="sxs-lookup"><span data-stu-id="87a15-109">Then, you will build a rich and responsive UI using AngularJS and CSS3 transformation effects.</span></span>

<span data-ttu-id="87a15-110">В традиционных веб-приложениях клиент (браузер) инициирует связь с сервером, запрашивая страницу.</span><span class="sxs-lookup"><span data-stu-id="87a15-110">In traditional web applications, the client (browser) initiates the communication with the server by requesting a page.</span></span> <span data-ttu-id="87a15-111">Затем сервер обрабатывает запрос и отправляет клиенту HTML-код страницы.</span><span class="sxs-lookup"><span data-stu-id="87a15-111">The server then processes the request and sends the HTML of the page to the client.</span></span> <span data-ttu-id="87a15-112">При последующем взаимодействии со страницей, например. пользователь переходит по ссылке или отправляет форму с данными — на сервер отправляется новый запрос, и последовательность запускается снова: сервер обрабатывает запрос и отправляет в браузер новую страницу в ответ на новый запрос действия. ED клиента.</span><span class="sxs-lookup"><span data-stu-id="87a15-112">In subsequent interactions with the page –e.g. the user navigates to a link or submits a form with data– a new request is sent to the server, and the flow starts again: the server processes the request and sends a new page to the browser in response to the new action requested by the client.</span></span>
> 
> <span data-ttu-id="87a15-113">В одностраничных приложениях (одностраничные приложения) вся страница загружается в браузер после первоначального запроса, но последующие взаимодействия выполняются через запросы AJAX.</span><span class="sxs-lookup"><span data-stu-id="87a15-113">In Single-Page Applications (SPAs) the entire page is loaded in the browser after the initial request, but subsequent interactions take place through Ajax requests.</span></span> <span data-ttu-id="87a15-114">Это означает, что браузер должен обновить только ту часть страницы, которая была изменена. нет необходимости перезагружать всю страницу.</span><span class="sxs-lookup"><span data-stu-id="87a15-114">This means that the browser has to update only the portion of the page that has changed; there is no need to reload the entire page.</span></span> <span data-ttu-id="87a15-115">Подход с SPA сокращает время, затрачиваемое приложением на реагирование на действия пользователя, что приводит к более гибкому интерфейсу.</span><span class="sxs-lookup"><span data-stu-id="87a15-115">The SPA approach reduces the time taken by the application to respond to user actions, resulting in a more fluid experience.</span></span>
> 
> <span data-ttu-id="87a15-116">Архитектура SPA подразумевает определенные проблемы, которые не представлены в традиционных веб-приложениях.</span><span class="sxs-lookup"><span data-stu-id="87a15-116">The architecture of a SPA involves certain challenges that are not present in traditional web applications.</span></span> <span data-ttu-id="87a15-117">Однако новые технологии, такие как веб-API ASP.NET, платформы JavaScript, такие как AngularJS и новые функции стилизации, предоставляемые CSS3, упрощают проектирование и сборку одностраничные приложения.</span><span class="sxs-lookup"><span data-stu-id="87a15-117">However, emerging technologies like ASP.NET Web API, JavaScript frameworks like AngularJS and new styling features provided by CSS3 make it really easy to design and build SPAs.</span></span>
> 
> 
> <span data-ttu-id="87a15-118">Все примеры кода и фрагментов включены в комплект обучающих курсов Web Camp, доступный по адресу [https://aka.ms/webcamps-training-kit](https://aka.ms/webcamps-training-kit).</span><span class="sxs-lookup"><span data-stu-id="87a15-118">All sample code and snippets are included in the Web Camps Training Kit, available at [https://aka.ms/webcamps-training-kit](https://aka.ms/webcamps-training-kit).</span></span>

## <a name="overview"></a><span data-ttu-id="87a15-119">Обзор</span><span class="sxs-lookup"><span data-stu-id="87a15-119">Overview</span></span>

<a id="Objectives"></a>
### <a name="objectives"></a><span data-ttu-id="87a15-120">Цели</span><span class="sxs-lookup"><span data-stu-id="87a15-120">Objectives</span></span>

<span data-ttu-id="87a15-121">В этой практической лабораторной работе вы узнаете, как выполнять следующие задачи:</span><span class="sxs-lookup"><span data-stu-id="87a15-121">In this hands-on lab, you will learn how to:</span></span>

- <span data-ttu-id="87a15-122">Создание веб-API ASP.NET службы для отправки и получения данных JSON</span><span class="sxs-lookup"><span data-stu-id="87a15-122">Create an ASP.NET Web API service to send and receive JSON data</span></span>
- <span data-ttu-id="87a15-123">Создание реагирующего пользовательского интерфейса с помощью AngularJS</span><span class="sxs-lookup"><span data-stu-id="87a15-123">Create a responsive UI using AngularJS</span></span>
- <span data-ttu-id="87a15-124">Повышение удобства работы с ИНТЕРФЕЙСом с помощью преобразований CSS3</span><span class="sxs-lookup"><span data-stu-id="87a15-124">Enhance the UI experience with CSS3 transformations</span></span>

<a id="Prerequisites"></a>
### <a name="prerequisites"></a><span data-ttu-id="87a15-125">предварительные требования</span><span class="sxs-lookup"><span data-stu-id="87a15-125">Prerequisites</span></span>

<span data-ttu-id="87a15-126">Для выполнения этой практической лабораторной работы требуется следующее:</span><span class="sxs-lookup"><span data-stu-id="87a15-126">The following is required to complete this hands-on lab:</span></span>

- <span data-ttu-id="87a15-127">[Visual Studio Express 2013 для Web](https://www.microsoft.com/visualstudio/) или более поздней версии</span><span class="sxs-lookup"><span data-stu-id="87a15-127">[Visual Studio Express 2013 for Web](https://www.microsoft.com/visualstudio/) or greater</span></span>

<a id="Setup"></a>
### <a name="setup"></a><span data-ttu-id="87a15-128">Настройка</span><span class="sxs-lookup"><span data-stu-id="87a15-128">Setup</span></span>

<span data-ttu-id="87a15-129">Чтобы выполнить упражнения в этой практической лабораторной работе, сначала необходимо настроить среду.</span><span class="sxs-lookup"><span data-stu-id="87a15-129">In order to run the exercises in this hands-on lab, you will need to set up your environment first.</span></span>

1. <span data-ttu-id="87a15-130">Откройте проводник Windows и перейдите к **исходной** папке лаборатории.</span><span class="sxs-lookup"><span data-stu-id="87a15-130">Open Windows Explorer and browse to the lab's **Source** folder.</span></span>
2. <span data-ttu-id="87a15-131">Щелкните **Setup. cmd** правой кнопкой мыши и выберите **Запуск от имени администратора** , чтобы запустить процесс установки, который будет настраивать среду и установить фрагменты кода Visual Studio для этой лабораторной работы.</span><span class="sxs-lookup"><span data-stu-id="87a15-131">Right-click on **Setup.cmd** and select **Run as administrator** to launch the setup process that will configure your environment and install the Visual Studio code snippets for this lab.</span></span>
3. <span data-ttu-id="87a15-132">Если отображается диалоговое окно Контроль учетных записей пользователей, подтвердите действие для продолжения.</span><span class="sxs-lookup"><span data-stu-id="87a15-132">If the User Account Control dialog box is shown, confirm the action to proceed.</span></span>

> [!NOTE]
> <span data-ttu-id="87a15-133">Убедитесь, что проверены все зависимости для этой лабораторной работы перед запуском программы установки.</span><span class="sxs-lookup"><span data-stu-id="87a15-133">Make sure you have checked all the dependencies for this lab before running the setup.</span></span>

<a id="CodeSnippets"></a>
### <a name="using-the-code-snippets"></a><span data-ttu-id="87a15-134">Использование фрагментов кода</span><span class="sxs-lookup"><span data-stu-id="87a15-134">Using the Code Snippets</span></span>

<span data-ttu-id="87a15-135">На протяжении всего лабораторного документа вы получите инструкции по вставке блоков кода.</span><span class="sxs-lookup"><span data-stu-id="87a15-135">Throughout the lab document, you will be instructed to insert code blocks.</span></span> <span data-ttu-id="87a15-136">Для удобства большая часть этого кода предоставляется как Visual Studio Code фрагменты, к которым можно получить доступ из Visual Studio 2013, чтобы не добавлять их вручную.</span><span class="sxs-lookup"><span data-stu-id="87a15-136">For your convenience, most of this code is provided as Visual Studio Code Snippets, which you can access from within Visual Studio 2013 to avoid having to add it manually.</span></span>

> [!NOTE]
> <span data-ttu-id="87a15-137">Каждое упражнение сопровождается начальным решением, расположенным в **начальной** папке упражнения, которое позволяет выполнять каждое упражнение независимо от других.</span><span class="sxs-lookup"><span data-stu-id="87a15-137">Each exercise is accompanied by a starting solution located in the **Begin** folder of the exercise that allows you to follow each exercise independently of the others.</span></span> <span data-ttu-id="87a15-138">Имейте в виду, что фрагменты кода, добавленные во время упражнения, отсутствуют в этих начальных решениях и могут не работать, пока вы не завершите упражнение.</span><span class="sxs-lookup"><span data-stu-id="87a15-138">Please be aware that the code snippets that are added during an exercise are missing from these starting solutions and may not work until you have completed the exercise.</span></span> <span data-ttu-id="87a15-139">В исходном коде для упражнения также будет найдена **Конечная** папка, содержащая решение Visual Studio с кодом, полученным в результате выполнения шагов в соответствующем упражнении.</span><span class="sxs-lookup"><span data-stu-id="87a15-139">Inside the source code for an exercise, you will also find an **End** folder containing a Visual Studio solution with the code that results from completing the steps in the corresponding exercise.</span></span> <span data-ttu-id="87a15-140">Эти решения можно использовать в качестве руководства, если вам нужна дополнительная помощь во время работы с этой практической лабораторной работой.</span><span class="sxs-lookup"><span data-stu-id="87a15-140">You can use these solutions as guidance if you need additional help as you work through this hands-on lab.</span></span>

---

<a id="Exercises"></a>
## <a name="exercises"></a><span data-ttu-id="87a15-141">Полнят</span><span class="sxs-lookup"><span data-stu-id="87a15-141">Exercises</span></span>

<span data-ttu-id="87a15-142">Эта практическая лабораторная работа включает в себя следующие упражнения:</span><span class="sxs-lookup"><span data-stu-id="87a15-142">This hands-on lab includes the following exercises:</span></span>

1. [<span data-ttu-id="87a15-143">Создание веб-API</span><span class="sxs-lookup"><span data-stu-id="87a15-143">Creating a Web API</span></span>](#Exercise1)
2. [<span data-ttu-id="87a15-144">Создание интерфейса SPA</span><span class="sxs-lookup"><span data-stu-id="87a15-144">Creating a SPA Interface</span></span>](#Exercise2)

<span data-ttu-id="87a15-145">Предполагаемое время выполнения этой лабораторной работы: **60 минут**</span><span class="sxs-lookup"><span data-stu-id="87a15-145">Estimated time to complete this lab: **60 minutes**</span></span>

> [!NOTE]
> <span data-ttu-id="87a15-146">При первом запуске Visual Studio необходимо выбрать одну из предварительно определенных коллекций параметров.</span><span class="sxs-lookup"><span data-stu-id="87a15-146">When you first start Visual Studio, you must select one of the predefined settings collections.</span></span> <span data-ttu-id="87a15-147">Каждая предопределенная коллекция разработана для соответствия определенному стилю разработки и определяет макеты окон, поведение редактора, фрагменты кода IntelliSense и параметры диалоговых окон.</span><span class="sxs-lookup"><span data-stu-id="87a15-147">Each predefined collection is designed to match a particular development style and determines window layouts, editor behavior, IntelliSense code snippets, and dialog box options.</span></span> <span data-ttu-id="87a15-148">Процедуры в этом лабораторном занятии описывают действия, необходимые для выполнения данной задачи в Visual Studio при использовании коллекции **общих параметров разработки** .</span><span class="sxs-lookup"><span data-stu-id="87a15-148">The procedures in this lab describe the actions necessary to accomplish a given task in Visual Studio when using the **General Development Settings** collection.</span></span> <span data-ttu-id="87a15-149">При выборе другой коллекции параметров для среды разработки могут возникнуть различия в действиях, которые необходимо учитывать.</span><span class="sxs-lookup"><span data-stu-id="87a15-149">If you choose a different settings collection for your development environment, there may be differences in the steps that you should take into account.</span></span>

<a id="Exercise1"></a>
### <a name="exercise-1-creating-a-web-api"></a><span data-ttu-id="87a15-150">Упражнение 1. Создание веб-API</span><span class="sxs-lookup"><span data-stu-id="87a15-150">Exercise 1: Creating a Web API</span></span>

<span data-ttu-id="87a15-151">Одной из ключевых частей SPA является уровень служб.</span><span class="sxs-lookup"><span data-stu-id="87a15-151">One of the key parts of a SPA is the service layer.</span></span> <span data-ttu-id="87a15-152">Он отвечает за обработку вызовов AJAX, отправленных интерфейсом пользователя, и возвращает данные в ответ на этот вызов.</span><span class="sxs-lookup"><span data-stu-id="87a15-152">It is responsible for processing the Ajax calls sent by the UI and returning data in response to that call.</span></span> <span data-ttu-id="87a15-153">Полученные данные должны быть представлены в удобочитаемом для компьютера формате, чтобы их можно было проанализировать и использовать в клиенте.</span><span class="sxs-lookup"><span data-stu-id="87a15-153">The data retrieved should be presented in a machine-readable format in order to be parsed and consumed by the client.</span></span>

<span data-ttu-id="87a15-154">Платформа веб-API является частью стека ASP.NET и разработана для упрощения реализации служб HTTP, которая обычно отправляет и получает данные в формате JSON или XML через API RESTFUL.</span><span class="sxs-lookup"><span data-stu-id="87a15-154">The Web API framework is part of the ASP.NET Stack and is designed to make it easy to implement HTTP services, generally sending and receiving JSON- or XML-formatted data through a RESTful API.</span></span> <span data-ttu-id="87a15-155">В этом упражнении вы создадите веб-сайт для размещения приложения "Викторина", а затем реализуете серверную службу для предоставления и сохранения данных головоломки с помощью веб-API ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="87a15-155">In this exercise you will create the Web site to host the Geek Quiz application and then implement the back-end service to expose and persist the quiz data using ASP.NET Web API.</span></span>

<a id="Ex1Task1"></a>
#### <a name="task-1--creating-the-initial-project-for-geek-quiz"></a><span data-ttu-id="87a15-156">Задача 1. Создание начального проекта для головоломки</span><span class="sxs-lookup"><span data-stu-id="87a15-156">Task 1 – Creating the Initial Project for Geek Quiz</span></span>

<span data-ttu-id="87a15-157">В этой задаче будет начато создание нового проекта ASP.NET MVC с поддержкой веб-API ASP.NET на основе типа проекта **ASP.NET** , который поставляется с Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="87a15-157">In this task you will start creating a new ASP.NET MVC project with support for ASP.NET Web API based on the **One ASP.NET** project type that comes with Visual Studio.</span></span> <span data-ttu-id="87a15-158">**Один ASP.NET** объединяет все технологии ASP.NET и дает возможность смешивать и сопоставлять их по своему усмотрению.</span><span class="sxs-lookup"><span data-stu-id="87a15-158">**One ASP.NET** unifies all ASP.NET technologies and gives you the option to mix and match them as desired.</span></span> <span data-ttu-id="87a15-159">Затем вы добавите классы модели Entity Framework и инициализатор базы данных, чтобы вставить вопросы о викторине.</span><span class="sxs-lookup"><span data-stu-id="87a15-159">You will then add the Entity Framework's model classes and the database initializer to insert the quiz questions.</span></span>

1. <span data-ttu-id="87a15-160">Откройте **Visual Studio Express 2013 для Web** и выберите **файл | Создать проект...** для запуска нового решения.</span><span class="sxs-lookup"><span data-stu-id="87a15-160">Open **Visual Studio Express 2013 for Web** and select **File | New Project...** to start a new solution.</span></span>

    <span data-ttu-id="87a15-161">![Создание нового проекта](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image1.png "Создание нового проекта")</span><span class="sxs-lookup"><span data-stu-id="87a15-161">![Creating a New Project](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image1.png "Creating a New Project")</span></span>

    <span data-ttu-id="87a15-162">*Создание нового проекта*</span><span class="sxs-lookup"><span data-stu-id="87a15-162">*Creating a New Project*</span></span>
2. <span data-ttu-id="87a15-163">В диалоговом окне **Новый проект** выберите **ASP.NET веб-приложение** в **визуальном C# элементе | Веб-** вкладка. Убедитесь, что выбран **.NET Framework 4,5** , назовите его *жееккуиз*, выберите **Расположение** и нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="87a15-163">In the **New Project** dialog box, select **ASP.NET Web Application** under the **Visual C# | Web** tab. Make sure **.NET Framework 4.5** is selected, name it *GeekQuiz*, choose a **Location** and click **OK**.</span></span>

    <span data-ttu-id="87a15-164">![Создание нового проекта веб-приложения ASP.NET](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image2.png "Создание нового проекта веб-приложения ASP.NET")</span><span class="sxs-lookup"><span data-stu-id="87a15-164">![Creating a new ASP.NET Web Application project](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image2.png "Creating a new ASP.NET Web Application project")</span></span>

    <span data-ttu-id="87a15-165">*Создание нового проекта веб-приложения ASP.NET*</span><span class="sxs-lookup"><span data-stu-id="87a15-165">*Creating a new ASP.NET Web Application project*</span></span>
3. <span data-ttu-id="87a15-166">В диалоговом окне **Новый проект ASP.NET** выберите шаблон **MVC** и выберите параметр **веб-API** .</span><span class="sxs-lookup"><span data-stu-id="87a15-166">In the **New ASP.NET Project** dialog box, select the **MVC** template and select the **Web API** option.</span></span> <span data-ttu-id="87a15-167">Кроме того, убедитесь, что для параметра **Проверка подлинности** задано значение **индивидуальные учетные записи пользователей**.</span><span class="sxs-lookup"><span data-stu-id="87a15-167">Also, make sure that the **Authentication** option is set to **Individual User Accounts**.</span></span> <span data-ttu-id="87a15-168">Чтобы продолжить, нажмите кнопку **ОК** .</span><span class="sxs-lookup"><span data-stu-id="87a15-168">Click **OK** to continue.</span></span>

    ![Создание нового проекта с шаблоном MVC, включая компоненты веб-API](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image3.png)

    <span data-ttu-id="87a15-170">*Создание нового проекта с шаблоном MVC, включая компоненты веб-API*</span><span class="sxs-lookup"><span data-stu-id="87a15-170">*Creating a new project with the MVC template, including Web API components*</span></span>
4. <span data-ttu-id="87a15-171">В **Обозреватель решений**щелкните правой кнопкой мыши папку **Models** проекта **жееккуиз** и выберите **Добавить | Существующий элемент...** .</span><span class="sxs-lookup"><span data-stu-id="87a15-171">In **Solution Explorer**, right-click the **Models** folder of the **GeekQuiz** project and select **Add | Existing Item...**.</span></span>

    <span data-ttu-id="87a15-172">![Добавление существующего элемента](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image4.png "Добавление существующего элемента")</span><span class="sxs-lookup"><span data-stu-id="87a15-172">![Adding an existing item](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image4.png "Adding an existing item")</span></span>

    <span data-ttu-id="87a15-173">*Добавление существующего элемента*</span><span class="sxs-lookup"><span data-stu-id="87a15-173">*Adding an existing item*</span></span>
5. <span data-ttu-id="87a15-174">В диалоговом окне **Добавление существующего элемента** перейдите к папке **Source/Assets/Models** и выберите все файлы.</span><span class="sxs-lookup"><span data-stu-id="87a15-174">In the **Add Existing Item** dialog box, navigate to the **Source/Assets/Models** folder and select all the files.</span></span> <span data-ttu-id="87a15-175">Нажмите кнопку **Добавить**.</span><span class="sxs-lookup"><span data-stu-id="87a15-175">Click **Add**.</span></span>

    <span data-ttu-id="87a15-176">![Добавление ресурсов модели](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image5.png "Добавление ресурсов модели")</span><span class="sxs-lookup"><span data-stu-id="87a15-176">![Adding the model assets](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image5.png "Adding the model assets")</span></span>

    <span data-ttu-id="87a15-177">*Добавление ресурсов модели*</span><span class="sxs-lookup"><span data-stu-id="87a15-177">*Adding the model assets*</span></span>

    > [!NOTE]
    > <span data-ttu-id="87a15-178">Добавляя эти файлы, вы добавляете модель данных, контекст базы данных Entity Framework и инициализатор базы данных для приложения для головоломки.</span><span class="sxs-lookup"><span data-stu-id="87a15-178">By adding these files, you are adding the data model, the Entity Framework's database context and the database initializer for the Geek Quiz application.</span></span>
    > 
    > <span data-ttu-id="87a15-179">**Entity Framework (EF)** — это объектно-реляционная система СОПОСТАВЛЕНИЯ (ORM), позволяющая создавать приложения для доступа к данным с помощью программирования с концептуальной моделью приложения, а не непосредственно с помощью реляционной схемы хранилища.</span><span class="sxs-lookup"><span data-stu-id="87a15-179">**Entity Framework (EF)** is an object-relational mapper (ORM) that enables you to create data access applications by programming with a conceptual application model instead of programming directly using a relational storage schema.</span></span> <span data-ttu-id="87a15-180">Дополнительные сведения о Entity Framework см. [здесь](../../../entity-framework.md).</span><span class="sxs-lookup"><span data-stu-id="87a15-180">You can learn more about Entity Framework [here](../../../entity-framework.md).</span></span>
    > 
    > <span data-ttu-id="87a15-181">Ниже приведено описание только что добавленных классов.</span><span class="sxs-lookup"><span data-stu-id="87a15-181">The following is a description of the classes you just added:</span></span>
    > 
    > - <span data-ttu-id="87a15-182">**Тривиаоптион:** представляет один параметр, связанный с вопросом головоломки.</span><span class="sxs-lookup"><span data-stu-id="87a15-182">**TriviaOption:** represents a single option associated with a quiz question</span></span>
    > - <span data-ttu-id="87a15-183">**Тривиакуестион:** представляет вопрос головоломки и предоставляет связанные параметры через свойство **Options** .</span><span class="sxs-lookup"><span data-stu-id="87a15-183">**TriviaQuestion:** represents a quiz question and exposes the associated options through the **Options** property</span></span>
    > - <span data-ttu-id="87a15-184">**Тривиаансвер:** представляет параметр, выбранный пользователем в ответ на вопрос о викторине.</span><span class="sxs-lookup"><span data-stu-id="87a15-184">**TriviaAnswer:** represents the option selected by the user in response to a quiz question</span></span>
    > - <span data-ttu-id="87a15-185">**Тривиаконтекст.** представляет контекст базы данных Entity Framework приложения для головоломки.</span><span class="sxs-lookup"><span data-stu-id="87a15-185">**TriviaContext:** represents the Entity Framework's database context of the Geek Quiz application.</span></span> <span data-ttu-id="87a15-186">Этот класс является производным от **дконтекст** и предоставляет свойства **DbSet** , представляющие коллекции сущностей, описанных выше.</span><span class="sxs-lookup"><span data-stu-id="87a15-186">This class derives from **DContext** and exposes **DbSet** properties that represent collections of the entities described above.</span></span>
    > - <span data-ttu-id="87a15-187">**Тривиадатабасеинитиализер:** реализация инициализатора Entity Framework для класса **тривиаконтекст** , который наследует от **CreateDatabaseIfNotExists**.</span><span class="sxs-lookup"><span data-stu-id="87a15-187">**TriviaDatabaseInitializer:** the implementation of the Entity Framework initializer for the **TriviaContext** class which inherits from **CreateDatabaseIfNotExists**.</span></span> <span data-ttu-id="87a15-188">Поведение этого класса по умолчанию — создать базу данных только в том случае, если она не существует, вставляя сущности, указанные в методе **SEED** .</span><span class="sxs-lookup"><span data-stu-id="87a15-188">The default behavior of this class is to create the database only if it does not exist, inserting the entities specified in the **Seed** method.</span></span>
6. <span data-ttu-id="87a15-189">Откройте файл **Global.asax.CS** и добавьте следующую инструкцию using.</span><span class="sxs-lookup"><span data-stu-id="87a15-189">Open the **Global.asax.cs** file and add the following using statement.</span></span>

    [!code-csharp[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample1.cs)]
7. <span data-ttu-id="87a15-190">Добавьте следующий код в начало **\_ного метода запуска приложения** , чтобы задать в качестве инициализатора базы данных **тривиадатабасеинитиализер** .</span><span class="sxs-lookup"><span data-stu-id="87a15-190">Add the following code at the beginning of the **Application\_Start** method to set the **TriviaDatabaseInitializer** as the database initializer.</span></span>

    [!code-csharp[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample2.cs)]
8. <span data-ttu-id="87a15-191">Измените контроллер **Home** , чтобы ограничить доступ для пользователей, прошедших проверку подлинности.</span><span class="sxs-lookup"><span data-stu-id="87a15-191">Modify the **Home** controller to restrict access to authenticated users.</span></span> <span data-ttu-id="87a15-192">Для этого откройте файл **HomeController.CS** в папке **Controllers** и добавьте атрибут **авторизовать** в определение класса **HomeController** .</span><span class="sxs-lookup"><span data-stu-id="87a15-192">To do this, open the **HomeController.cs** file inside the **Controllers** folder and add the **Authorize** attribute to the **HomeController** class definition.</span></span>

    [!code-csharp[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample3.cs)]

    > [!NOTE]
    > <span data-ttu-id="87a15-193">Фильтр **авторизации** проверяет, прошел ли пользователь проверку подлинности.</span><span class="sxs-lookup"><span data-stu-id="87a15-193">The **Authorize** filter checks to see if the user is authenticated.</span></span> <span data-ttu-id="87a15-194">Если пользователь не прошел проверку подлинности, он возвращает код состояния HTTP 401 (не санкционированный) без вызова действия.</span><span class="sxs-lookup"><span data-stu-id="87a15-194">If the user is not authenticated, it returns HTTP status code 401 (Unauthorized) without invoking the action.</span></span> <span data-ttu-id="87a15-195">Фильтр можно применять глобально, на уровне контроллера или на уровне отдельных действий.</span><span class="sxs-lookup"><span data-stu-id="87a15-195">You can apply the filter globally, at the controller level, or at the level of individual actions.</span></span>
9. <span data-ttu-id="87a15-196">Теперь вы настроите макет веб-страниц и фирменной символики.</span><span class="sxs-lookup"><span data-stu-id="87a15-196">You will now customize the layout of the web pages and the branding.</span></span> <span data-ttu-id="87a15-197">Для этого откройте файл **\_Layout. cshtml** в **представлениях | Общая** папка и обновление содержимого элемента **&lt;Title&gt;** , заменив *приложение ASP.NET* с помощью *головоломки*.</span><span class="sxs-lookup"><span data-stu-id="87a15-197">To do this, open the **\_Layout.cshtml** file inside the **Views | Shared** folder and update the content of the **&lt;title&gt;** element by replacing *My ASP.NET Application* with *Geek Quiz*.</span></span>

    [!code-cshtml[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample4.cshtml)]
10. <span data-ttu-id="87a15-198">В том же файле обновите панель навигации, удалив ссылки *About* и *Contact* и переименование *домашней* ссылки для *воспроизведения*.</span><span class="sxs-lookup"><span data-stu-id="87a15-198">In the same file, update the navigation bar by removing the *About* and *Contact* links and renaming the *Home* link to *Play*.</span></span> <span data-ttu-id="87a15-199">Кроме того, переименуйте ссылку на *имя приложения* в *викторину по владению*.</span><span class="sxs-lookup"><span data-stu-id="87a15-199">Additionally, rename the *Application name* link to *Geek Quiz*.</span></span> <span data-ttu-id="87a15-200">HTML-код для панели навигации должен выглядеть, как в следующем коде.</span><span class="sxs-lookup"><span data-stu-id="87a15-200">The HTML for the navigation bar should look like the following code.</span></span>

    [!code-cshtml[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample5.cshtml)]
11. <span data-ttu-id="87a15-201">Обновите нижний колонтитул страницы макета, заменив *приложение ASP.NET* с помощью *головоломки*.</span><span class="sxs-lookup"><span data-stu-id="87a15-201">Update the footer of the layout page by replacing *My ASP.NET Application* with *Geek Quiz*.</span></span> <span data-ttu-id="87a15-202">Для этого замените содержимое элемента **&gt;нижнего колонтитула&lt;** следующим выделенным кодом.</span><span class="sxs-lookup"><span data-stu-id="87a15-202">To do this, replace the content of the **&lt;footer&gt;** element with the following highlighted code.</span></span>

    [!code-html[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample6.html)]

<a id="Ex1Task2"></a>
#### <a name="task-2--creating-the-triviacontroller-web-api"></a><span data-ttu-id="87a15-203">Задача 2. Создание веб-API Тривиаконтроллер</span><span class="sxs-lookup"><span data-stu-id="87a15-203">Task 2 – Creating the TriviaController Web API</span></span>

<span data-ttu-id="87a15-204">В предыдущей задаче вы создали начальную структуру веб-приложения "Викторина".</span><span class="sxs-lookup"><span data-stu-id="87a15-204">In the previous task, you created the initial structure of the Geek Quiz web application.</span></span> <span data-ttu-id="87a15-205">Теперь вы создадите простую службу веб-API, которая взаимодействует с моделью данных головоломки и предоставляет следующие действия:</span><span class="sxs-lookup"><span data-stu-id="87a15-205">You will now build a simple Web API service that interacts with the quiz data model and exposes the following actions:</span></span>

- <span data-ttu-id="87a15-206">**Get/АПИ/Тривиа**: получение следующего вопроса из списка опроса для получения ответа от пользователя, прошедшего проверку подлинности.</span><span class="sxs-lookup"><span data-stu-id="87a15-206">**GET /api/trivia**: Retrieves the next question from the quiz list to be answered by the authenticated user.</span></span>
- <span data-ttu-id="87a15-207">**POST/АПИ/Тривиа**: сохраняет ответ головоломки, указанный прошедшим проверку подлинности пользователем.</span><span class="sxs-lookup"><span data-stu-id="87a15-207">**POST /api/trivia**: Stores the quiz answer specified by the authenticated user.</span></span>

<span data-ttu-id="87a15-208">Вы будете использовать средства формирования шаблонов ASP.NET, предоставляемые Visual Studio, для создания базовых показателей для класса контроллера веб-API.</span><span class="sxs-lookup"><span data-stu-id="87a15-208">You will use the ASP.NET Scaffolding tools provided by Visual Studio to create the baseline for the Web API controller class.</span></span>

1. <span data-ttu-id="87a15-209">Откройте файл **WebApiConfig.CS** в папке **приложения\_Start** .</span><span class="sxs-lookup"><span data-stu-id="87a15-209">Open the **WebApiConfig.cs** file inside the **App\_Start** folder.</span></span> <span data-ttu-id="87a15-210">Этот файл определяет конфигурацию службы веб-API, например способ сопоставления маршрутов с действиями контроллера веб-API.</span><span class="sxs-lookup"><span data-stu-id="87a15-210">This file defines the configuration of the Web API service, like how routes are mapped to Web API controller actions.</span></span>
2. <span data-ttu-id="87a15-211">Добавьте следующую инструкцию using в начало файла.</span><span class="sxs-lookup"><span data-stu-id="87a15-211">Add the following using statement at the beginning of the file.</span></span>

    [!code-csharp[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample7.cs)]
3. <span data-ttu-id="87a15-212">Добавьте выделенный ниже код в метод **Register** для глобальной настройки модуля форматирования данных JSON, извлекаемых методами действий веб-API.</span><span class="sxs-lookup"><span data-stu-id="87a15-212">Add the following highlighted code to the **Register** method to globally configure the formatter for the JSON data retrieved by the Web API action methods.</span></span>

    [!code-csharp[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample8.cs)]

    > [!NOTE]
    > <span data-ttu-id="87a15-213">**Камелкасепропертинамесконтрактресолвер** автоматически преобразует имена свойств в *Camel* , что является общим соглашением для имен свойств в JavaScript.</span><span class="sxs-lookup"><span data-stu-id="87a15-213">The **CamelCasePropertyNamesContractResolver** automatically converts property names to *camel* case, which is the general convention for property names in JavaScript.</span></span>
4. <span data-ttu-id="87a15-214">В **Обозреватель решений**щелкните правой кнопкой мыши папку **Controllers** проекта **жееккуиз** и выберите **Добавить | Создать шаблонный элемент...**</span><span class="sxs-lookup"><span data-stu-id="87a15-214">In **Solution Explorer**, right-click the **Controllers** folder of the **GeekQuiz** project and select **Add | New Scaffolded Item...**.</span></span>

    <span data-ttu-id="87a15-215">![Создание нового шаблона элемента](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image6.png "Создание нового шаблона элемента")</span><span class="sxs-lookup"><span data-stu-id="87a15-215">![Creating a new scaffolded item](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image6.png "Creating a new scaffolded item")</span></span>

    <span data-ttu-id="87a15-216">*Создание нового шаблона элемента*</span><span class="sxs-lookup"><span data-stu-id="87a15-216">*Creating a new scaffolded item*</span></span>
5. <span data-ttu-id="87a15-217">В диалоговом окне **Добавление шаблона** убедитесь, что на левой панели выбран параметр **Общий** узел.</span><span class="sxs-lookup"><span data-stu-id="87a15-217">In the **Add Scaffold** dialog box, make sure that the **Common** node is selected in the left pane.</span></span> <span data-ttu-id="87a15-218">Затем выберите шаблон " **контроллер веб-API 2 — пустой** " в центральной области и нажмите кнопку **Добавить**.</span><span class="sxs-lookup"><span data-stu-id="87a15-218">Then, select the **Web API 2 Controller - Empty** template in the center pane and click **Add**.</span></span>

    <span data-ttu-id="87a15-219">![Выбор пустого шаблона веб-API 2](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image7.png "Выбор пустого шаблона веб-API 2")</span><span class="sxs-lookup"><span data-stu-id="87a15-219">![Selecting the Web API 2 Controller Empty template](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image7.png "Selecting the Web API 2 Controller Empty template")</span></span>

    <span data-ttu-id="87a15-220">*Выбор пустого шаблона веб-API 2*</span><span class="sxs-lookup"><span data-stu-id="87a15-220">*Selecting the Web API 2 Controller Empty template*</span></span>

    > [!NOTE]
    > <span data-ttu-id="87a15-221">**Формирование шаблонов ASP.NET** — это платформа создания кода для веб-приложений ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="87a15-221">**ASP.NET Scaffolding** is a code generation framework for ASP.NET Web applications.</span></span> <span data-ttu-id="87a15-222">Visual Studio 2013 включает предварительно установленные генераторы кода для проектов MVC и веб-API.</span><span class="sxs-lookup"><span data-stu-id="87a15-222">Visual Studio 2013 includes pre-installed code generators for MVC and Web API projects.</span></span> <span data-ttu-id="87a15-223">Формирование шаблонов в проекте следует использовать, если необходимо быстро добавить код, взаимодействующий с моделями данных, чтобы сократить время, необходимое для разработки стандартных операций с данными.</span><span class="sxs-lookup"><span data-stu-id="87a15-223">You should use scaffolding in your project when you want to quickly add code that interacts with data models in order to reduce the amount of time required to develop standard data operations.</span></span>
    > 
    > <span data-ttu-id="87a15-224">Процесс формирования шаблонов также гарантирует, что в проекте будут установлены все необходимые зависимости.</span><span class="sxs-lookup"><span data-stu-id="87a15-224">The scaffolding process also ensures that all the required dependencies are installed in the project.</span></span> <span data-ttu-id="87a15-225">Например, если начать с пустого проекта ASP.NET, а затем использовать формирование шаблонов для добавления контроллера веб-API, необходимые пакеты и ссылки NuGet веб-API добавляются в проект автоматически.</span><span class="sxs-lookup"><span data-stu-id="87a15-225">For example, if you start with an empty ASP.NET project and then use scaffolding to add a Web API controller, the required Web API NuGet packages and references are added to your project automatically.</span></span>
6. <span data-ttu-id="87a15-226">В диалоговом окне **Добавление контроллера** в текстовом поле **имя контроллера** введите *тривиаконтроллер* и нажмите кнопку **Добавить**.</span><span class="sxs-lookup"><span data-stu-id="87a15-226">In the **Add Controller** dialog box, type *TriviaController* in the **Controller name** text box and click **Add**.</span></span>

    <span data-ttu-id="87a15-227">![Добавление контроллера Trivia](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image8.png "Добавление контроллера Trivia")</span><span class="sxs-lookup"><span data-stu-id="87a15-227">![Adding the Trivia Controller](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image8.png "Adding the Trivia Controller")</span></span>

    <span data-ttu-id="87a15-228">*Добавление контроллера Trivia*</span><span class="sxs-lookup"><span data-stu-id="87a15-228">*Adding the Trivia Controller*</span></span>
7. <span data-ttu-id="87a15-229">Затем файл **TriviaController.CS** добавляется в папку **Controllers** проекта **Жееккуиз** , содержащий пустой класс **тривиаконтроллер** .</span><span class="sxs-lookup"><span data-stu-id="87a15-229">The **TriviaController.cs** file is then added to the **Controllers** folder of the **GeekQuiz** project, containing an empty **TriviaController** class.</span></span> <span data-ttu-id="87a15-230">Добавьте следующие операторы using в начало файла.</span><span class="sxs-lookup"><span data-stu-id="87a15-230">Add the following using statements at the beginning of the file.</span></span>

    <span data-ttu-id="87a15-231">(Фрагмент кода — *аспнетвебаписпа-EX1-тривиаконтроллерусингс*)</span><span class="sxs-lookup"><span data-stu-id="87a15-231">(Code Snippet - *AspNetWebApiSpa - Ex1 - TriviaControllerUsings*)</span></span>

    [!code-csharp[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample9.cs)]
8. <span data-ttu-id="87a15-232">Добавьте следующий код в начало класса **тривиаконтроллер** , чтобы определить, инициализировать и ликвидировать экземпляр **тривиаконтекст** в контроллере.</span><span class="sxs-lookup"><span data-stu-id="87a15-232">Add the following code at the beginning of the **TriviaController** class to define, initialize and dispose the **TriviaContext** instance in the controller.</span></span>

    <span data-ttu-id="87a15-233">(Фрагмент кода — *аспнетвебаписпа-EX1-тривиаконтроллерконтекст*)</span><span class="sxs-lookup"><span data-stu-id="87a15-233">(Code Snippet - *AspNetWebApiSpa - Ex1 - TriviaControllerContext*)</span></span>

    [!code-csharp[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample10.cs)]

    > [!NOTE]
    > <span data-ttu-id="87a15-234">Метод **Dispose** метода **тривиаконтроллер** вызывает метод **Dispose** экземпляра **тривиаконтекст** , который гарантирует освобождение всех ресурсов, используемых объектом контекста, при удалении экземпляра **тривиаконтекст** или при сборке мусора.</span><span class="sxs-lookup"><span data-stu-id="87a15-234">The **Dispose** method of **TriviaController** invokes the **Dispose** method of the **TriviaContext** instance, which ensures that all the resources used by the context object are released when the **TriviaContext** instance is disposed or garbage-collected.</span></span> <span data-ttu-id="87a15-235">Это включает закрытие всех подключений к базе данных, открытых Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="87a15-235">This includes closing all database connections opened by Entity Framework.</span></span>
9. <span data-ttu-id="87a15-236">Добавьте следующий вспомогательный метод в конец класса **тривиаконтроллер** .</span><span class="sxs-lookup"><span data-stu-id="87a15-236">Add the following helper method at the end of the **TriviaController** class.</span></span> <span data-ttu-id="87a15-237">Этот метод извлекает из базы данных следующий контрольный вопрос для ответа от указанного пользователя.</span><span class="sxs-lookup"><span data-stu-id="87a15-237">This method retrieves the following quiz question from the database to be answered by the specified user.</span></span>

    <span data-ttu-id="87a15-238">(Фрагмент кода — *аспнетвебаписпа-EX1-тривиаконтроллернексткуестион*)</span><span class="sxs-lookup"><span data-stu-id="87a15-238">(Code Snippet - *AspNetWebApiSpa - Ex1 - TriviaControllerNextQuestion*)</span></span>

    [!code-csharp[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample11.cs)]
10. <span data-ttu-id="87a15-239">Добавьте следующий метод действия **Get** в класс **тривиаконтроллер** .</span><span class="sxs-lookup"><span data-stu-id="87a15-239">Add the following **Get** action method to the **TriviaController** class.</span></span> <span data-ttu-id="87a15-240">Этот метод действия вызывает вспомогательный метод **нексткуестионасинк** , определенный на предыдущем шаге, для получения следующего вопроса для пользователя, прошедшего проверку подлинности.</span><span class="sxs-lookup"><span data-stu-id="87a15-240">This action method calls the **NextQuestionAsync** helper method defined in the previous step to retrieve the next question for the authenticated user.</span></span>

    <span data-ttu-id="87a15-241">(Фрагмент кода — *аспнетвебаписпа-EX1-тривиаконтроллержетактион*)</span><span class="sxs-lookup"><span data-stu-id="87a15-241">(Code Snippet - *AspNetWebApiSpa - Ex1 - TriviaControllerGetAction*)</span></span>

    [!code-csharp[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample12.cs)]
11. <span data-ttu-id="87a15-242">Добавьте следующий вспомогательный метод в конец класса **тривиаконтроллер** .</span><span class="sxs-lookup"><span data-stu-id="87a15-242">Add the following helper method at the end of the **TriviaController** class.</span></span> <span data-ttu-id="87a15-243">Этот метод сохраняет указанный ответ в базе данных и возвращает логическое значение, указывающее, является ли ответ правильным.</span><span class="sxs-lookup"><span data-stu-id="87a15-243">This method stores the specified answer in the database and returns a Boolean value indicating whether or not the answer is correct.</span></span>

    <span data-ttu-id="87a15-244">(Фрагмент кода — *аспнетвебаписпа-EX1-тривиаконтроллерстореасинк*)</span><span class="sxs-lookup"><span data-stu-id="87a15-244">(Code Snippet - *AspNetWebApiSpa - Ex1 - TriviaControllerStoreAsync*)</span></span>

    [!code-csharp[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample13.cs)]
12. <span data-ttu-id="87a15-245">Добавьте следующий метод действия **POST** в класс **тривиаконтроллер** .</span><span class="sxs-lookup"><span data-stu-id="87a15-245">Add the following **Post** action method to the **TriviaController** class.</span></span> <span data-ttu-id="87a15-246">Этот метод действия связывает ответ для пользователя, прошедшего проверку подлинности, и вызывает вспомогательный метод **стореасинк** .</span><span class="sxs-lookup"><span data-stu-id="87a15-246">This action method associates the answer to the authenticated user and calls the **StoreAsync** helper method.</span></span> <span data-ttu-id="87a15-247">Затем он отправляет ответ с логическим значением, возвращенным вспомогательным методом.</span><span class="sxs-lookup"><span data-stu-id="87a15-247">Then, it sends a response with the Boolean value returned by the helper method.</span></span>

    <span data-ttu-id="87a15-248">(Фрагмент кода — *аспнетвебаписпа-EX1-тривиаконтроллерпостактион*)</span><span class="sxs-lookup"><span data-stu-id="87a15-248">(Code Snippet - *AspNetWebApiSpa - Ex1 - TriviaControllerPostAction*)</span></span>

    [!code-csharp[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample14.cs)]
13. <span data-ttu-id="87a15-249">Измените контроллер веб-API, чтобы ограничить доступ к пользователям, прошедшим проверку подлинности, добавив атрибут **авторизации** в определение класса **тривиаконтроллер** .</span><span class="sxs-lookup"><span data-stu-id="87a15-249">Modify the Web API controller to restrict access to authenticated users by adding the **Authorize** attribute to the **TriviaController** class definition.</span></span>

    [!code-csharp[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample15.cs)]

<a id="Ex1Task3"></a>
#### <a name="task-3--running-the-solution"></a><span data-ttu-id="87a15-250">Задача 3. Запуск решения</span><span class="sxs-lookup"><span data-stu-id="87a15-250">Task 3 – Running the Solution</span></span>

<span data-ttu-id="87a15-251">В этой задаче будет выполнена проверка правильности работы службы веб-API, созданной в предыдущей задаче.</span><span class="sxs-lookup"><span data-stu-id="87a15-251">In this task you will verify that the Web API service you built in the previous task is working as expected.</span></span> <span data-ttu-id="87a15-252">Для записи сетевого трафика и проверки полного ответа от службы веб-API используется Средства для разработчиков Internet Explorer **F12** .</span><span class="sxs-lookup"><span data-stu-id="87a15-252">You will use the Internet Explorer **F12 Developer Tools** to capture the network traffic and inspect the full response from the Web API service.</span></span>

> [!NOTE]
> <span data-ttu-id="87a15-253">Убедитесь, что в кнопке **Пуск** на панели инструментов Visual Studio выбран параметр **Internet Explorer** .</span><span class="sxs-lookup"><span data-stu-id="87a15-253">Make sure that **Internet Explorer** is selected in the **Start** button located on the Visual Studio toolbar.</span></span>
> 
> ![Параметр Internet Explorer](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image9.png)

1. <span data-ttu-id="87a15-255">Чтобы запустить решение, нажмите клавишу **F5**.</span><span class="sxs-lookup"><span data-stu-id="87a15-255">Press **F5** to run the solution.</span></span> <span data-ttu-id="87a15-256">Страница **входа** должна появиться в браузере.</span><span class="sxs-lookup"><span data-stu-id="87a15-256">The **Log in** page should appear in the browser.</span></span>

    > [!NOTE]
    > <span data-ttu-id="87a15-257">При запуске приложения активируется маршрут MVC по умолчанию, который по умолчанию сопоставляется с действием **индекса** класса **HomeController** .</span><span class="sxs-lookup"><span data-stu-id="87a15-257">When the application starts, the default MVC route is triggered, which by default is mapped to the **Index** action of the **HomeController** class.</span></span> <span data-ttu-id="87a15-258">Так как **HomeController** ограничена пользователями, прошедшим проверку подлинности (Помните, что вы наложили этот класс атрибутом **авторизации** в упражнении 1) и пока не прошли проверку подлинности пользователя, приложение перенаправит исходный запрос на страницу входа.</span><span class="sxs-lookup"><span data-stu-id="87a15-258">Since **HomeController** is restricted to authenticated users (remember that you decorated that class with the **Authorize** attribute in Exercise 1) and there is no user authenticated yet, the application redirects the original request to the log in page.</span></span>

    <span data-ttu-id="87a15-259">![Запуск решения](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image10.png "Запуск решения")</span><span class="sxs-lookup"><span data-stu-id="87a15-259">![Running the solution](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image10.png "Running the solution")</span></span>

    <span data-ttu-id="87a15-260">*Запуск решения*</span><span class="sxs-lookup"><span data-stu-id="87a15-260">*Running the solution*</span></span>
2. <span data-ttu-id="87a15-261">Нажмите кнопку **зарегистрировать** , чтобы создать нового пользователя.</span><span class="sxs-lookup"><span data-stu-id="87a15-261">Click **Register** to create a new user.</span></span>

    <span data-ttu-id="87a15-262">![Регистрация нового пользователя](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image11.png "Регистрация нового пользователя")</span><span class="sxs-lookup"><span data-stu-id="87a15-262">![Registering a new user](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image11.png "Registering a new user")</span></span>

    <span data-ttu-id="87a15-263">*Регистрация нового пользователя*</span><span class="sxs-lookup"><span data-stu-id="87a15-263">*Registering a new user*</span></span>
3. <span data-ttu-id="87a15-264">На странице **Регистрация** введите **имя пользователя** и **пароль**, а затем нажмите кнопку **зарегистрировать**.</span><span class="sxs-lookup"><span data-stu-id="87a15-264">In the **Register** page, enter a **User name** and **Password**, and then click **Register**.</span></span>

    <span data-ttu-id="87a15-265">![Страница "регистрация"](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image12.png "Страница "регистрация"")</span><span class="sxs-lookup"><span data-stu-id="87a15-265">![Register page](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image12.png "Register page")</span></span>

    <span data-ttu-id="87a15-266">*Страница "регистрация"*</span><span class="sxs-lookup"><span data-stu-id="87a15-266">*Register page*</span></span>
4. <span data-ttu-id="87a15-267">Приложение регистрирует новую учетную запись, и пользователь проходит проверку подлинности и перенаправляется обратно на домашнюю страницу.</span><span class="sxs-lookup"><span data-stu-id="87a15-267">The application registers the new account and the user is authenticated and redirected back to the home page.</span></span>

    <span data-ttu-id="87a15-268">![Пользователь прошел проверку подлинности](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image13.png "Пользователь прошел проверку подлинности")</span><span class="sxs-lookup"><span data-stu-id="87a15-268">![User is authenticated](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image13.png "User authenticated")</span></span>

    <span data-ttu-id="87a15-269">*Пользователь прошел проверку подлинности*</span><span class="sxs-lookup"><span data-stu-id="87a15-269">*User is authenticated*</span></span>
5. <span data-ttu-id="87a15-270">В браузере нажмите клавишу **F12** , чтобы открыть панель **средства для разработчиков** .</span><span class="sxs-lookup"><span data-stu-id="87a15-270">In the browser, press **F12** to open the **Developer Tools** panel.</span></span> <span data-ttu-id="87a15-271">Нажмите **сочетание клавиш Ctrl + 4** или щелкните значок **сети** , а затем нажмите кнопку с зеленой стрелкой, чтобы начать запись сетевого трафика.</span><span class="sxs-lookup"><span data-stu-id="87a15-271">Press **CTRL + 4** or click the **Network** icon, and then click the green arrow button to begin capturing network traffic.</span></span>

    <span data-ttu-id="87a15-272">![Инициация записи сети веб-API](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image14.png "Инициация записи сети веб-API")</span><span class="sxs-lookup"><span data-stu-id="87a15-272">![Initiating Web API network capture](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image14.png "Initiating Web API network capture")</span></span>

    <span data-ttu-id="87a15-273">*Инициация записи сети веб-API*</span><span class="sxs-lookup"><span data-stu-id="87a15-273">*Initiating Web API network capture*</span></span>
6. <span data-ttu-id="87a15-274">Добавьте **API/Trivia** в URL-адрес в адресной строке браузера.</span><span class="sxs-lookup"><span data-stu-id="87a15-274">Append **api/trivia** to the URL in the browser's address bar.</span></span> <span data-ttu-id="87a15-275">Теперь вы проверите сведения о ответе в методе действия **Get** в **тривиаконтроллер**.</span><span class="sxs-lookup"><span data-stu-id="87a15-275">You will now inspect the details of the response from the **Get** action method in **TriviaController**.</span></span>

    <span data-ttu-id="87a15-276">![Получение данных следующего вопроса через веб-API](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image15.png "Получение данных следующего вопроса через веб-API")</span><span class="sxs-lookup"><span data-stu-id="87a15-276">![Retrieving the next question data through Web API](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image15.png "Retrieving the next question data through Web API")</span></span>

    <span data-ttu-id="87a15-277">*Получение данных следующего вопроса через веб-API*</span><span class="sxs-lookup"><span data-stu-id="87a15-277">*Retrieving the next question data through Web API*</span></span>

    > [!NOTE]
    > <span data-ttu-id="87a15-278">После завершения загрузки вам будет предложено выполнить действие с скачанным файлом.</span><span class="sxs-lookup"><span data-stu-id="87a15-278">Once the download finishes, you will be prompted to make an action with the downloaded file.</span></span> <span data-ttu-id="87a15-279">Оставьте диалоговое окно открытым, чтобы иметь возможность просматривать содержимое ответа через окно инструментов разработчиков.</span><span class="sxs-lookup"><span data-stu-id="87a15-279">Leave the dialog box open in order to be able to watch the response content through the Developers Tool window.</span></span>
7. <span data-ttu-id="87a15-280">Теперь вы проверите текст ответа.</span><span class="sxs-lookup"><span data-stu-id="87a15-280">Now you will inspect the body of the response.</span></span> <span data-ttu-id="87a15-281">Для этого перейдите на вкладку **сведения** и щелкните **текст ответа**.</span><span class="sxs-lookup"><span data-stu-id="87a15-281">To do this, click the **Details** tab and then click **Response body**.</span></span> <span data-ttu-id="87a15-282">Можно проверить, что загруженные данные являются объектом с **параметрами** свойств (который является списком объектов **тривиаоптион** ), **идентификатором** и **названием** , которые соответствуют классу **тривиакуестион** .</span><span class="sxs-lookup"><span data-stu-id="87a15-282">You can check that the downloaded data is an object with the properties **options** (which is a list of **TriviaOption** objects), **id** and **title** that correspond to the **TriviaQuestion** class.</span></span>

    <span data-ttu-id="87a15-283">![Просмотр текста ответа веб-API](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image16.png "Просмотр текста ответа веб-API")</span><span class="sxs-lookup"><span data-stu-id="87a15-283">![Viewing the Web API Response Body](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image16.png "Viewing the Web API Response Body")</span></span>

    <span data-ttu-id="87a15-284">*Просмотр текста ответа веб-API*</span><span class="sxs-lookup"><span data-stu-id="87a15-284">*Viewing Web API Response Body*</span></span>
8. <span data-ttu-id="87a15-285">Вернитесь в Visual Studio и нажмите клавиши **SHIFT + F5** , чтобы прерывать отладку.</span><span class="sxs-lookup"><span data-stu-id="87a15-285">Go back to Visual Studio and press **SHIFT + F5** to stop debugging.</span></span>

<a id="Exercise2"></a>
### <a name="exercise-2-creating-the-spa-interface"></a><span data-ttu-id="87a15-286">Упражнение 2. Создание интерфейса SPA</span><span class="sxs-lookup"><span data-stu-id="87a15-286">Exercise 2: Creating the SPA Interface</span></span>

<span data-ttu-id="87a15-287">В этом упражнении вы сначала создаете веб-интерфейсную часть головоломки, которая сосредоточена на взаимодействии одностраничного приложения с помощью **AngularJS**.</span><span class="sxs-lookup"><span data-stu-id="87a15-287">In this exercise you will first build the web front-end portion of Geek Quiz, focusing on the Single-Page Application interaction using **AngularJS**.</span></span> <span data-ttu-id="87a15-288">Затем вы улучшите взаимодействие с пользователем с помощью CSS3, чтобы выполнять богатую анимацию и обеспечить визуальный эффект переключения контекста при переходе от одного вопроса к другому.</span><span class="sxs-lookup"><span data-stu-id="87a15-288">You will then enhance the user experience with CSS3 to perform rich animations and provide a visual effect of context switching when transitioning from one question to the next.</span></span>

<a id="Ex2Task1"></a>
#### <a name="task-1--creating-the-spa-interface-using-angularjs"></a><span data-ttu-id="87a15-289">Задача 1. Создание интерфейса SPA с помощью AngularJS</span><span class="sxs-lookup"><span data-stu-id="87a15-289">Task 1 – Creating the SPA Interface Using AngularJS</span></span>

<span data-ttu-id="87a15-290">В этой задаче вы будете использовать **AngularJS** для реализации клиентской стороны приложения для головоломки.</span><span class="sxs-lookup"><span data-stu-id="87a15-290">In this task you will use **AngularJS** to implement the client side of the Geek Quiz application.</span></span> <span data-ttu-id="87a15-291">**AngularJS** — это платформа JavaScript с открытым исходным кодом, которая дополняет приложения на основе браузера с помощью *модели* MVC, что упрощает разработку и тестирование.</span><span class="sxs-lookup"><span data-stu-id="87a15-291">**AngularJS** is an open-source JavaScript framework that augments browser-based applications with *Model-View-Controller* (MVC) capability, facilitating both development and testing.</span></span>

<span data-ttu-id="87a15-292">Начнем с установки AngularJS из консоли диспетчера пакетов Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="87a15-292">You will start by installing AngularJS from Visual Studio's Package Manager Console.</span></span> <span data-ttu-id="87a15-293">Затем вы создадите контроллер, чтобы обеспечить поведение приложения для головоломки и представления для отображения вопросов и ответов по викторине с помощью механизма шаблонов AngularJS.</span><span class="sxs-lookup"><span data-stu-id="87a15-293">Then, you will create the controller to provide the behavior of the Geek Quiz app and the view to render the quiz questions and answers using the AngularJS template engine.</span></span>

> [!NOTE]
> <span data-ttu-id="87a15-294">Дополнительные сведения об AngularJS см. в разделе [[http://angularjs.org/](http://angularjs.org/)](http://angularjs.org/).</span><span class="sxs-lookup"><span data-stu-id="87a15-294">For more information about AngularJS, refer to [[http://angularjs.org/](http://angularjs.org/)](http://angularjs.org/).</span></span>

1. <span data-ttu-id="87a15-295">Откройте **Visual Studio Express 2013 для Web** и откройте решение **жееккуиз. sln** , расположенное в папке **Source/EX2-креатингаспаинтерфаце/Begin** .</span><span class="sxs-lookup"><span data-stu-id="87a15-295">Open **Visual Studio Express 2013 for Web** and open the **GeekQuiz.sln** solution located in the **Source/Ex2-CreatingASPAInterface/Begin** folder.</span></span> <span data-ttu-id="87a15-296">Кроме того, можно продолжить работу с решением, полученным в предыдущем упражнении.</span><span class="sxs-lookup"><span data-stu-id="87a15-296">Alternatively, you can continue with the solution that you obtained in the previous exercise.</span></span>
2. <span data-ttu-id="87a15-297">Откройте **консоль диспетчера пакетов** из **меню Инструменты** > **Диспетчер пакетов NuGet**.</span><span class="sxs-lookup"><span data-stu-id="87a15-297">Open the **Package Manager Console** from **Tools** > **NuGet Package Manager**.</span></span> <span data-ttu-id="87a15-298">Введите следующую команду, чтобы установить пакет NuGet для **AngularJS. Core** .</span><span class="sxs-lookup"><span data-stu-id="87a15-298">Type the following command to install the **AngularJS.Core** NuGet package.</span></span>

    [!code-powershell[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample16.ps1)]
3. <span data-ttu-id="87a15-299">В **Обозреватель решений**щелкните правой кнопкой мыши папку **Scripts** проекта **жееккуиз** и выберите **Добавить | Новая папка**.</span><span class="sxs-lookup"><span data-stu-id="87a15-299">In **Solution Explorer**, right-click the **Scripts** folder of the **GeekQuiz** project and select **Add | New Folder**.</span></span> <span data-ttu-id="87a15-300">Назовите **приложение** папки и нажмите клавишу **Ввод**.</span><span class="sxs-lookup"><span data-stu-id="87a15-300">Name the folder **app** and press **Enter**.</span></span>
4. <span data-ttu-id="87a15-301">Щелкните правой кнопкой мыши только что созданную папку **приложения** и выберите **Добавить | Файл JavaScript**.</span><span class="sxs-lookup"><span data-stu-id="87a15-301">Right-click the **app** folder you just created and select **Add | JavaScript File**.</span></span>

    ![Создание нового файла JavaScript](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image17.png)

    <span data-ttu-id="87a15-303">*Создание нового файла JavaScript*</span><span class="sxs-lookup"><span data-stu-id="87a15-303">*Creating a new JavaScript file*</span></span>
5. <span data-ttu-id="87a15-304">В диалоговом окне **Указание имени для элемента** введите *Викторина-Controller* в текстовое поле **имя элемента** и нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="87a15-304">In the **Specify Name for Item** dialog box, type *quiz-controller* in the **Item name** text box and click **OK**.</span></span>

    ![Присвоение имени новому файлу JavaScript](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image18.png)

    <span data-ttu-id="87a15-306">*Присвоение имени новому файлу JavaScript*</span><span class="sxs-lookup"><span data-stu-id="87a15-306">*Naming the new JavaScript file*</span></span>
6. <span data-ttu-id="87a15-307">В файле **куиз-контроллер. js** добавьте следующий код для объявления и инициализации контроллера AngularJS **куизктрл** .</span><span class="sxs-lookup"><span data-stu-id="87a15-307">In the **quiz-controller.js** file, add the following code to declare and initialize the AngularJS **QuizCtrl** controller.</span></span>

    <span data-ttu-id="87a15-308">(Фрагмент кода — *аспнетвебаписпа-EX2-ангуларкуизконтроллер*)</span><span class="sxs-lookup"><span data-stu-id="87a15-308">(Code Snippet - *AspNetWebApiSpa - Ex2 - AngularQuizController*)</span></span>

    [!code-javascript[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample17.js)]

    > [!NOTE]
    > <span data-ttu-id="87a15-309">Функция конструктора контроллера **куизктрла** должна включать в себя параметр с именем **$Scope**.</span><span class="sxs-lookup"><span data-stu-id="87a15-309">The constructor function of the **QuizCtrl** controller expects an injectable parameter named **$scope**.</span></span> <span data-ttu-id="87a15-310">Начальное состояние области должно быть настроено в функции конструктора путем присоединения свойств к объекту **$Scope** .</span><span class="sxs-lookup"><span data-stu-id="87a15-310">The initial state of the scope should be set up in the constructor function by attaching properties to the **$scope** object.</span></span> <span data-ttu-id="87a15-311">Свойства содержат **модель представления**и будут доступны шаблону при регистрации контроллера.</span><span class="sxs-lookup"><span data-stu-id="87a15-311">The properties contain the **view model**, and will be accessible to the template when the controller is registered.</span></span>
    > 
    > <span data-ttu-id="87a15-312">Контроллер **куизктрл** определяется внутри модуля с именем **куизапп**.</span><span class="sxs-lookup"><span data-stu-id="87a15-312">The **QuizCtrl** controller is defined inside a module named **QuizApp**.</span></span> <span data-ttu-id="87a15-313">Модули — это рабочие блоки, которые позволяют разбивать приложение на отдельные компоненты.</span><span class="sxs-lookup"><span data-stu-id="87a15-313">Modules are units of work that let you break your application into separate components.</span></span> <span data-ttu-id="87a15-314">Основными преимуществами использования модулей являются то, что код проще в понимании и упрощает модульное тестирование, повторное использование и удобство сопровождения.</span><span class="sxs-lookup"><span data-stu-id="87a15-314">The main advantages of using modules is that the code is easier to understand and facilitates unit testing, reusability and maintainability.</span></span>
7. <span data-ttu-id="87a15-315">Теперь вы добавите поведение в область, чтобы реагировать на события, запускаемые из представления.</span><span class="sxs-lookup"><span data-stu-id="87a15-315">You will now add behavior to the scope in order to react to events triggered from the view.</span></span> <span data-ttu-id="87a15-316">Добавьте следующий код в конец контроллера **куизктрл** , чтобы определить функцию **нексткуестион** в объекте **$Scope** .</span><span class="sxs-lookup"><span data-stu-id="87a15-316">Add the following code at the end of the **QuizCtrl** controller to define the **nextQuestion** function in the **$scope** object.</span></span>

    <span data-ttu-id="87a15-317">(Фрагмент кода — *аспнетвебаписпа-EX2-ангуларкуизконтроллернексткуестион*)</span><span class="sxs-lookup"><span data-stu-id="87a15-317">(Code Snippet - *AspNetWebApiSpa - Ex2 - AngularQuizControllerNextQuestion*)</span></span>

    [!code-javascript[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample18.js)]

    > [!NOTE]
    > <span data-ttu-id="87a15-318">Эта функция извлекает следующий вопрос из веб-API **Trivia** , созданного в предыдущем упражнении, и прикрепляет данные вопроса к объекту **$Scope** .</span><span class="sxs-lookup"><span data-stu-id="87a15-318">This function retrieves the next question from the **Trivia** Web API created in the previous exercise and attaches the question data to the **$scope** object.</span></span>
8. <span data-ttu-id="87a15-319">Вставьте следующий код в конец контроллера **куизктрл** , чтобы определить функцию **сендансвер** в объекте **$Scope** .</span><span class="sxs-lookup"><span data-stu-id="87a15-319">Insert the following code at the end of the **QuizCtrl** controller to define the **sendAnswer** function in the **$scope** object.</span></span>

    <span data-ttu-id="87a15-320">(Фрагмент кода — *аспнетвебаписпа-EX2-ангуларкуизконтроллерсендансвер*)</span><span class="sxs-lookup"><span data-stu-id="87a15-320">(Code Snippet - *AspNetWebApiSpa - Ex2 - AngularQuizControllerSendAnswer*)</span></span>

    [!code-javascript[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample19.js)]

    > [!NOTE]
    > <span data-ttu-id="87a15-321">Эта функция отправляет ответ, выбранный пользователем, в веб-API **Trivia** и сохраняет результат — т. е. Если ответ правильный или нет — в объекте **$Scope** .</span><span class="sxs-lookup"><span data-stu-id="87a15-321">This function sends the answer selected by the user to the **Trivia** Web API and stores the result –i.e. if the answer is correct or not– in the **$scope** object.</span></span>
    > 
    > <span data-ttu-id="87a15-322">Функции **нексткуестион** и **сендансвер** , приведенные выше, используют объект AngularJS **$http** для абстракции взаимодействия с веб-API через объект JavaScript XMLHttpRequest из браузера.</span><span class="sxs-lookup"><span data-stu-id="87a15-322">The **nextQuestion** and **sendAnswer** functions from above use the AngularJS **$http** object to abstract the communication with the Web API via the XMLHttpRequest JavaScript object from the browser.</span></span> <span data-ttu-id="87a15-323">AngularJS поддерживает другую службу, которая предоставляет более высокий уровень абстракции для выполнения операций CRUD с ресурсом через API RESTFUL.</span><span class="sxs-lookup"><span data-stu-id="87a15-323">AngularJS supports another service that brings a higher level of abstraction to perform CRUD operations against a resource through RESTful APIs.</span></span> <span data-ttu-id="87a15-324">Объект AngularJS **$Resource** имеет методы действий, которые обеспечивают высокий уровень поведения без необходимости взаимодействия с объектом **$http** .</span><span class="sxs-lookup"><span data-stu-id="87a15-324">The AngularJS **$resource** object has action methods which provide high-level behaviors without the need to interact with the **$http** object.</span></span> <span data-ttu-id="87a15-325">Рассмотрите возможность использования объекта **$Resource** в сценариях, для которых требуется модель CRUD (для получения сведений см. [документацию по $Resource](https://docs.angularjs.org/api/ngResource/service/$resource)).</span><span class="sxs-lookup"><span data-stu-id="87a15-325">Consider using the **$resource** object in scenarios that requires the CRUD model (fore information, see the [$resource documentation](https://docs.angularjs.org/api/ngResource/service/$resource)).</span></span>
9. <span data-ttu-id="87a15-326">Следующим шагом является создание шаблона AngularJS, определяющего представление для головоломки.</span><span class="sxs-lookup"><span data-stu-id="87a15-326">The next step is to create the AngularJS template that defines the view for the quiz.</span></span> <span data-ttu-id="87a15-327">Для этого откройте файл **index. cshtml** в **представлениях | Домашняя** папка и замените содержимое следующим кодом.</span><span class="sxs-lookup"><span data-stu-id="87a15-327">To do this, open the **Index.cshtml** file inside the **Views | Home** folder and replace the content with the following code.</span></span>

    <span data-ttu-id="87a15-328">(Фрагмент кода — *аспнетвебаписпа-EX2-жееккуизвиев*)</span><span class="sxs-lookup"><span data-stu-id="87a15-328">(Code Snippet - *AspNetWebApiSpa - Ex2 - GeekQuizView*)</span></span>

    [!code-cshtml[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample20.cshtml)]

    > [!NOTE]
    > <span data-ttu-id="87a15-329">Шаблон AngularJS — это декларативная спецификация, которая использует информацию из модели и контроллера для преобразования статической разметки в динамическое представление, которое пользователь видит в браузере.</span><span class="sxs-lookup"><span data-stu-id="87a15-329">The AngularJS template is a declarative specification that uses information from the model and the controller to transform static markup into the dynamic view that the user sees in the browser.</span></span> <span data-ttu-id="87a15-330">Ниже приведены примеры элементов AngularJS и атрибутов элементов, которые можно использовать в шаблоне.</span><span class="sxs-lookup"><span data-stu-id="87a15-330">The following are examples of AngularJS elements and element attributes that can be used in a template:</span></span>
    > 
    > - <span data-ttu-id="87a15-331">Директива **NG-App** сообщает ANGULARJS элемент DOM, представляющий корневой элемент приложения.</span><span class="sxs-lookup"><span data-stu-id="87a15-331">The **ng-app** directive tells AngularJS the DOM element that represents the root element of the application.</span></span>
    > - <span data-ttu-id="87a15-332">Директива **NG-Controller** прикрепляет контроллер к модели DOM в точке объявления директивы.</span><span class="sxs-lookup"><span data-stu-id="87a15-332">The **ng-controller** directive attaches a controller to the DOM at the point where the directive is declared.</span></span>
    > - <span data-ttu-id="87a15-333">Фигурная скобка **{{}}** обозначает привязки к свойствам области, определенным в контроллере.</span><span class="sxs-lookup"><span data-stu-id="87a15-333">The curly brace notation **{{ }}** denotes bindings to the scope properties defined in the controller.</span></span>
    > - <span data-ttu-id="87a15-334">Директива **NG-Click** используется для вызова функций, определенных в области действия в ответ на нажатие пользователем.</span><span class="sxs-lookup"><span data-stu-id="87a15-334">The **ng-click** directive is used to invoke the functions defined in the scope in response to user clicks.</span></span>
10. <span data-ttu-id="87a15-335">Откройте файл **site. CSS** в папке **Content** и добавьте в конец файла следующие выделенные стили, чтобы обеспечить внешний вид и представление головоломки.</span><span class="sxs-lookup"><span data-stu-id="87a15-335">Open the **Site.css** file inside the **Content** folder and add the following highlighted styles at the end of the file to provide a look and feel for the quiz view.</span></span>

    <span data-ttu-id="87a15-336">(Фрагмент кода — *аспнетвебаписпа-EX2-жееккуизстилес*)</span><span class="sxs-lookup"><span data-stu-id="87a15-336">(Code Snippet - *AspNetWebApiSpa - Ex2 - GeekQuizStyles*)</span></span>

    [!code-css[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample21.css)]

<a id="Ex2Task2"></a>
#### <a name="task-2--running-the-solution"></a><span data-ttu-id="87a15-337">Задача 2. Запуск решения</span><span class="sxs-lookup"><span data-stu-id="87a15-337">Task 2 – Running the Solution</span></span>

<span data-ttu-id="87a15-338">В этой задаче вы выполните решение с помощью нового пользовательского интерфейса, созданного с помощью AngularJS, чтобы ответить на некоторые вопросы головоломки.</span><span class="sxs-lookup"><span data-stu-id="87a15-338">In this task you will execute the solution using the new user interface you built with AngularJS to answer some of the quiz questions.</span></span>

1. <span data-ttu-id="87a15-339">Чтобы запустить решение, нажмите клавишу **F5**.</span><span class="sxs-lookup"><span data-stu-id="87a15-339">Press **F5** to run the solution.</span></span>
2. <span data-ttu-id="87a15-340">Зарегистрируйте новую учетную запись пользователя.</span><span class="sxs-lookup"><span data-stu-id="87a15-340">Register a new user account.</span></span> <span data-ttu-id="87a15-341">Для этого выполните действия по регистрации, описанные в упражнении 1, задача 3.</span><span class="sxs-lookup"><span data-stu-id="87a15-341">To do this, follow the registration steps described in Exercise 1, Task 3.</span></span>

    > [!NOTE]
    > <span data-ttu-id="87a15-342">Если вы используете решение из предыдущего упражнения, вы можете войти в систему, используя учетную запись пользователя, созданную ранее.</span><span class="sxs-lookup"><span data-stu-id="87a15-342">If you are using the solution from the previous exercise, you can log in with the user account you created before.</span></span>
3. <span data-ttu-id="87a15-343">Откроется **Домашняя** страница с первым вопросом головоломки.</span><span class="sxs-lookup"><span data-stu-id="87a15-343">The **Home** page should appear, showing the first question of the quiz.</span></span> <span data-ttu-id="87a15-344">Ответьте на вопрос, щелкнув один из вариантов.</span><span class="sxs-lookup"><span data-stu-id="87a15-344">Answer the question by clicking one of the options.</span></span> <span data-ttu-id="87a15-345">Это приведет к активации функции **сендансвер** , определенной ранее, которая отправляет выбранный параметр в веб-API **Trivia** .</span><span class="sxs-lookup"><span data-stu-id="87a15-345">This will trigger the **sendAnswer** function defined earlier, which sends the selected option to the **Trivia** Web API.</span></span>

    <span data-ttu-id="87a15-346">![Ответ на вопрос](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image19.png "Ответ на вопрос")</span><span class="sxs-lookup"><span data-stu-id="87a15-346">![Answering a question](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image19.png "Answering a question")</span></span>

    <span data-ttu-id="87a15-347">*Ответ на вопрос*</span><span class="sxs-lookup"><span data-stu-id="87a15-347">*Answering a question*</span></span>
4. <span data-ttu-id="87a15-348">После нажатия одной из кнопок появится ответ.</span><span class="sxs-lookup"><span data-stu-id="87a15-348">After clicking one of the buttons, the answer should appear.</span></span> <span data-ttu-id="87a15-349">Нажмите кнопку **следующий вопрос** , чтобы отобразить следующий вопрос.</span><span class="sxs-lookup"><span data-stu-id="87a15-349">Click **Next Question** to show the following question.</span></span> <span data-ttu-id="87a15-350">Это приведет к активации функции **нексткуестион** , определенной в контроллере.</span><span class="sxs-lookup"><span data-stu-id="87a15-350">This will trigger the **nextQuestion** function defined in the controller.</span></span>

    <span data-ttu-id="87a15-351">![Запрос следующего вопроса](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image20.png "Запрос следующего вопроса")</span><span class="sxs-lookup"><span data-stu-id="87a15-351">![Requesting the next question](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image20.png "Requesting the next question")</span></span>

    <span data-ttu-id="87a15-352">*Запрос следующего вопроса*</span><span class="sxs-lookup"><span data-stu-id="87a15-352">*Requesting the next question*</span></span>
5. <span data-ttu-id="87a15-353">Должен появиться следующий вопрос.</span><span class="sxs-lookup"><span data-stu-id="87a15-353">The next question should appear.</span></span> <span data-ttu-id="87a15-354">Продолжайте отвечать на вопросы столько раз, сколько нужно.</span><span class="sxs-lookup"><span data-stu-id="87a15-354">Continue answering questions as many times as you want.</span></span> <span data-ttu-id="87a15-355">После выполнения всех вопросов необходимо вернуться к первому вопросу.</span><span class="sxs-lookup"><span data-stu-id="87a15-355">After completing all the questions you should return to the first question.</span></span>

    <span data-ttu-id="87a15-356">![Другой вопрос](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image21.png "Другой вопрос")</span><span class="sxs-lookup"><span data-stu-id="87a15-356">![Another question](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image21.png "Another question")</span></span>

    <span data-ttu-id="87a15-357">*Следующий вопрос*</span><span class="sxs-lookup"><span data-stu-id="87a15-357">*Next question*</span></span>
6. <span data-ttu-id="87a15-358">Вернитесь в Visual Studio и нажмите клавиши **SHIFT + F5** , чтобы прерывать отладку.</span><span class="sxs-lookup"><span data-stu-id="87a15-358">Go back to Visual Studio and press **SHIFT + F5** to stop debugging.</span></span>

<a id="Ex2Task3"></a>
#### <a name="task-3--creating-a-flip-animation-using-css3"></a><span data-ttu-id="87a15-359">Задача 3. Создание отражения анимации с помощью CSS3</span><span class="sxs-lookup"><span data-stu-id="87a15-359">Task 3 – Creating a Flip Animation Using CSS3</span></span>

<span data-ttu-id="87a15-360">В этой задаче вы будете использовать свойства CSS3 для выполнения многофункциональной анимации, добавив эффект перелистывания при ответе на вопрос и при получении следующего вопроса.</span><span class="sxs-lookup"><span data-stu-id="87a15-360">In this task you will use CSS3 properties to perform rich animations by adding a flip effect when a question is answered and when the next question is retrieved.</span></span>

1. <span data-ttu-id="87a15-361">В **Обозреватель решений**щелкните правой кнопкой мыши папку **содержимого** проекта **жееккуиз** и выберите **Добавить | Существующий элемент...** .</span><span class="sxs-lookup"><span data-stu-id="87a15-361">In **Solution Explorer**, right-click the **Content** folder of the **GeekQuiz** project and select **Add | Existing Item...**.</span></span>

    <span data-ttu-id="87a15-362">![Добавление существующего элемента в папку содержимого](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image22.png "Добавление существующего элемента в папку содержимого")</span><span class="sxs-lookup"><span data-stu-id="87a15-362">![Adding an existing item to the Content folder](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image22.png "Adding an existing item to the Content folder")</span></span>

    <span data-ttu-id="87a15-363">*Добавление существующего элемента в папку содержимого*</span><span class="sxs-lookup"><span data-stu-id="87a15-363">*Adding an existing item to the Content folder*</span></span>
2. <span data-ttu-id="87a15-364">В диалоговом окне **Добавление существующего элемента** перейдите к папке **Source/Assets** и выберите **reворачивают. CSS**.</span><span class="sxs-lookup"><span data-stu-id="87a15-364">In the **Add Existing Item** dialog box, navigate to the **Source/Assets** folder and select **Flip.css**.</span></span> <span data-ttu-id="87a15-365">Нажмите кнопку **Добавить**.</span><span class="sxs-lookup"><span data-stu-id="87a15-365">Click **Add**.</span></span>

    <span data-ttu-id="87a15-366">![Добавление файла reпереворот. CSS из ресурсов](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image23.png "Добавление файла reпереворот. CSS из ресурсов")</span><span class="sxs-lookup"><span data-stu-id="87a15-366">![Adding the Flip.css file from Assets](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image23.png "Adding the Flip.css file from Assets")</span></span>

    <span data-ttu-id="87a15-367">*Добавление файла reпереворот. CSS из ресурсов*</span><span class="sxs-lookup"><span data-stu-id="87a15-367">*Adding the Flip.css file from Assets*</span></span>
3. <span data-ttu-id="87a15-368">Откройте только что добавленный файл **reворачивают. CSS** и проверьте его содержимое.</span><span class="sxs-lookup"><span data-stu-id="87a15-368">Open the **Flip.css** file you just added and inspect its content.</span></span>
4. <span data-ttu-id="87a15-369">Откройте комментарий **преобразования "отразить** ".</span><span class="sxs-lookup"><span data-stu-id="87a15-369">Locate the **flip transformation** comment.</span></span> <span data-ttu-id="87a15-370">Стили, приведенные ниже, используют **перспективу** CSS и преобразования поворота для создания &quot;ной карты, **перевернутой**&quot;ный результат.</span><span class="sxs-lookup"><span data-stu-id="87a15-370">The styles below that comment use the CSS **perspective** and **rotateY** transformations to generate a &quot;card flip&quot; effect.</span></span>

    [!code-css[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample22.css)]
5. <span data-ttu-id="87a15-371">В окне " **Скрыть панель" во время перелистывания** .</span><span class="sxs-lookup"><span data-stu-id="87a15-371">Locate the **hide back of pane during flip** comment.</span></span> <span data-ttu-id="87a15-372">Стиль под комментарием скрывает сторону стороны сторон, когда они исчезают от средства просмотра, устанавливая свойство CSS со свойством **отображения** обратной стороны в значение *Hidden*.</span><span class="sxs-lookup"><span data-stu-id="87a15-372">The style below that comment hides the back-side of the faces when they are facing away from the viewer by setting the **backface-visibility** CSS property to *hidden*.</span></span>

    [!code-css[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample23.css)]
6. <span data-ttu-id="87a15-373">Откройте файл **BundleConfig.CS** в папке **приложения\_Start** и добавьте ссылку на файл **отражения. css** в **&quot;~/контент/КСС&quot;** наборе стилей</span><span class="sxs-lookup"><span data-stu-id="87a15-373">Open the **BundleConfig.cs** file inside the **App\_Start** folder and add the reference to the **Flip.css** file in the **&quot;~/Content/css&quot;** style bundle</span></span>

    [!code-csharp[Main](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/samples/sample24.cs)]
7. <span data-ttu-id="87a15-374">Нажмите клавишу **F5** , чтобы запустить решение и войти с помощью своих учетных данных.</span><span class="sxs-lookup"><span data-stu-id="87a15-374">Press **F5** to run the solution and log in with your credentials.</span></span>
8. <span data-ttu-id="87a15-375">Ответьте на вопрос, щелкнув один из вариантов.</span><span class="sxs-lookup"><span data-stu-id="87a15-375">Answer a question by clicking one of the options.</span></span> <span data-ttu-id="87a15-376">Обратите внимание на эффекты перелистывания при переходе между представлениями.</span><span class="sxs-lookup"><span data-stu-id="87a15-376">Notice the flip effect when transitioning between views.</span></span>

    <span data-ttu-id="87a15-377">![Ответ на вопрос с помощью действия "отразить"](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image24.png "Ответ на вопрос с помощью действия "отразить"")</span><span class="sxs-lookup"><span data-stu-id="87a15-377">![Answering a question with the flip effect](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image24.png "Answering a question with the flip effect")</span></span>

    <span data-ttu-id="87a15-378">*Ответ на вопрос с помощью действия "отразить"*</span><span class="sxs-lookup"><span data-stu-id="87a15-378">*Answering a question with the flip effect*</span></span>
9. <span data-ttu-id="87a15-379">Нажмите кнопку **следующий вопрос** , чтобы получить следующий вопрос.</span><span class="sxs-lookup"><span data-stu-id="87a15-379">Click **Next Question** to retrieve the following question.</span></span> <span data-ttu-id="87a15-380">Результат перелистывания должен появиться снова.</span><span class="sxs-lookup"><span data-stu-id="87a15-380">The flip effect should appear again.</span></span>

    <span data-ttu-id="87a15-381">![Получение следующего вопроса с помощью действия "отразить"](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image25.png "Получение следующего вопроса с помощью действия "отразить"")</span><span class="sxs-lookup"><span data-stu-id="87a15-381">![Retrieving the following question with the flip effect](build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs/_static/image25.png "Retrieving the following question with the flip effect")</span></span>

    <span data-ttu-id="87a15-382">*Получение следующего вопроса с помощью действия "отразить"*</span><span class="sxs-lookup"><span data-stu-id="87a15-382">*Retrieving the following question with the flip effect*</span></span>

---

<a id="Summary"></a>
## <a name="summary"></a><span data-ttu-id="87a15-383">Сводка</span><span class="sxs-lookup"><span data-stu-id="87a15-383">Summary</span></span>

<span data-ttu-id="87a15-384">С помощью этой практической лабораторной работы вы узнали, как:</span><span class="sxs-lookup"><span data-stu-id="87a15-384">By completing this hands-on lab you have learned how to:</span></span>

- <span data-ttu-id="87a15-385">Создание контроллера веб-API ASP.NET с помощью формирования шаблонов ASP.NET</span><span class="sxs-lookup"><span data-stu-id="87a15-385">Create an ASP.NET Web API controller using ASP.NET Scaffolding</span></span>
- <span data-ttu-id="87a15-386">Реализация действия Get веб-API для получения следующего контрольного вопроса</span><span class="sxs-lookup"><span data-stu-id="87a15-386">Implement a Web API Get action to retrieve the next quiz question</span></span>
- <span data-ttu-id="87a15-387">Реализация действия POST веб-API для хранения ответов на викторину</span><span class="sxs-lookup"><span data-stu-id="87a15-387">Implement a Web API Post action to store the quiz answers</span></span>
- <span data-ttu-id="87a15-388">Установка AngularJS из консоли диспетчера пакетов Visual Studio</span><span class="sxs-lookup"><span data-stu-id="87a15-388">Install AngularJS from the Visual Studio Package Manager Console</span></span>
- <span data-ttu-id="87a15-389">Реализация шаблонов и контроллеров AngularJS</span><span class="sxs-lookup"><span data-stu-id="87a15-389">Implement AngularJS templates and controllers</span></span>
- <span data-ttu-id="87a15-390">Использование переходов CSS3 для выполнения эффектов анимации</span><span class="sxs-lookup"><span data-stu-id="87a15-390">Use CSS3 transitions to perform animation effects</span></span>
