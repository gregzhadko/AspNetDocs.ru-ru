---
uid: web-api/overview/mobile-clients/calling-web-api-from-a-windows-phone-8-application
title: Вызов веб-API из приложения Windows Phone 8 (C#) — ASP.NET 4. x
author: rmcmurray
description: Руководство с кодом. Создайте веб-API ASP.NETное приложение в ASP.NET 4. x, которое предоставляет каталог книг для приложения Windows Phone 8.
ms.author: riande
ms.date: 10/09/2013
ms.custom: seoapril2019
ms.assetid: b9775f41-352a-4f82-baa6-23e95b342e20
msc.legacyurl: /web-api/overview/mobile-clients/calling-web-api-from-a-windows-phone-8-application
msc.type: authoredcontent
ms.openlocfilehash: c5da14a6856f551343b6fb14f0aedc659e792f6b
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78498216"
---
# <a name="calling-web-api-from-a-windows-phone-8-application-c"></a>Вызов веб-API из приложения Windows Phone 8 (C#)

[Роберт мкмуррай](https://github.com/rmcmurray)

В этом учебнике вы узнаете, как создать комплексный сценарий, состоящий из веб-API ASP.NET приложения, которое предоставляет каталог книг для приложения Windows Phone 8.

### <a name="overview"></a>Обзор

Службы RESTFUL, такие как веб-API ASP.NET упрощают создание приложений на основе HTTP для разработчиков путем абстракции архитектуры для приложений на стороне сервера и на стороне клиента. Вместо создания собственного протокола на основе сокетов для обмена данными разработчики веб-API просто должны опубликовать необходимые методы HTTP для своего приложения (например, GET, POST, WHERE, DELETE) и разработчикам клиентских приложений требуется только использовать методы HTTP, необходимые для своего приложения.

В этом комплексном руководстве вы узнаете, как использовать веб-API для создания следующих проектов:

- В [первой части этого руководства](#STEP1)вы создадите веб-API ASP.NET приложение, которое поддерживает все операции создания, чтения, обновления и удаления (CRUD) для управления каталогом книг. Это приложение будет использовать [Образец XML-файла (Books. XML)](https://msdn.microsoft.com/library/windows/desktop/ms762271.aspx) из MSDN.
- Во [второй части этого руководства](#STEP2)вы создадите интерактивное приложение Windows Phone 8, которое получает данные из приложения веб-API.

#### <a name="prerequisites"></a>предварительные требования

- Visual Studio 2013 с установленным пакетом SDK для Windows Phone 8
- Windows 8 или более поздняя версия в 64-разрядной системе с установленным Hyper-V
- Список дополнительных требований см. в разделе *требования к системе* на странице скачивания [Windows Phone SDK 8,0](https://www.microsoft.com/download/details.aspx?id=35471) .

> [!NOTE]
> Если вы собираетесь проверить подключение между веб-API и Windows Phone 8 проектами в локальной системе, необходимо выполнить инструкции из статьи *[Подключение эмулятора Windows Phone 8 к приложениям веб-API на локальном компьютере](https://go.microsoft.com/fwlink/?LinkId=324014)* , чтобы настроить среду тестирования.

<a id="STEP1"></a>
### <a name="step-1-creating-the-web-api-bookstore-project"></a>Шаг 1. Создание проекта веб-API в книжном магазине

Первым этапом этого комплексного руководства является создание проекта веб-API, поддерживающего все операции CRUD. Обратите внимание, что вы добавите проект Windows Phone приложения в это решение на [шаге 2](#STEP2) этого руководства.

1. Откройте **Visual Studio 2013**.
2. Последовательно выберите пункты **файл**, **создать**и **проект**.
3. Когда откроется диалоговое окно **Новый проект** , разверните узел **установленные**, затем **шаблоны**, **визуальный C#** элемент и **веб-узел**.

   | [![](calling-web-api-from-a-windows-phone-8-application/_static/image2.png)](calling-web-api-from-a-windows-phone-8-application/_static/image1.png) |
   |-----------------------------------------------------------------------------------------------------------------------------------------------------|
   |                                                                Щелкните изображение, чтобы развернуть                                                                |

4. Выделите **веб-приложение ASP.NET**, введите **Bookstore** в поле имя проекта и нажмите кнопку **ОК**.
5. Когда откроется диалоговое окно **Новый проект ASP.NET** , выберите шаблон **веб-API** и нажмите кнопку **ОК**.

   | [![](calling-web-api-from-a-windows-phone-8-application/_static/image4.png)](calling-web-api-from-a-windows-phone-8-application/_static/image3.png) |
   |-----------------------------------------------------------------------------------------------------------------------------------------------------|
   |                                                                Щелкните изображение, чтобы развернуть                                                                |

6. После открытия проекта веб-API удалите пример контроллера из проекта:

    1. Разверните папку **контроллеры** в обозревателе решений.
    2. Щелкните правой кнопкой мыши файл **ValuesController.CS** и выберите пункт **Удалить**.
    3. При появлении запроса на подтверждение удаления нажмите кнопку **ОК** .
7. Добавьте файл данных XML в проект веб-API. Этот файл содержит содержимое каталога книжного магазина:

   1. Щелкните правой кнопкой мыши папку **данных приложения\_** в обозревателе решений, выберите пункт **Добавить**, а затем щелкните **новый элемент**.
   2. При отображении диалогового окна **Добавление нового элемента** выделите шаблон **XML-файла** .
   3. Присвойте файлу имя **Books. XML**, а затем нажмите кнопку **Добавить**.
   4. При открытии файла **Books. XML** замените код в файле XML-кодом из образца файла **Books. XML** на сайте MSDN: 

       [!code-xml[Main](calling-web-api-from-a-windows-phone-8-application/samples/sample1.xml)]
   5. Сохраните и закройте XML-файл.

8. Добавьте модель книжного магазина в проект веб-API. Эта модель содержит логику создания, чтения, обновления и удаления (CRUD) для приложения Bookstore:

   1. Щелкните правой кнопкой мыши папку **модели** в обозревателе решений, выберите **Добавить**, а затем — **класс**.
   2. Когда откроется диалоговое окно **Добавление нового элемента** , назовите файл класса **BookDetails.CS**и нажмите кнопку **добавить**.
   3. При открытии файла **BookDetails.CS** замените код в файле следующим кодом: 

       [!code-csharp[Main](calling-web-api-from-a-windows-phone-8-application/samples/sample2.cs)]
   4. Сохраните и закройте файл **BookDetails.CS** .

9. Добавьте контроллер Bookstore в проект веб-API:

   1. Щелкните правой кнопкой мыши папку **Controllers** в обозревателе решений, выберите **Добавить**, а затем щелкните **контроллер**.
   2. Когда откроется диалоговое окно **Добавление шаблона** , выделите **контроллер Web API 2 — пустой**и нажмите кнопку **добавить**.
   3. Когда откроется диалоговое окно **Добавление контроллера** , назовите контроллер **буксконтроллер**и нажмите кнопку **добавить**.
   4. При открытии файла **BooksController.CS** замените код в файле следующим кодом: 

       [!code-csharp[Main](calling-web-api-from-a-windows-phone-8-application/samples/sample3.cs)]
   5. Сохраните и закройте файл **BooksController.CS** .

10. Создайте приложение веб-API для проверки на наличие ошибок.

<a id="STEP2"></a>
### <a name="step-2-adding-the-windows-phone-8-bookstore-catalog-project"></a>Шаг 2. Добавление проекта каталога Windows Phone 8 в книжном магазине

Следующим этапом этого сквозного сценария является создание приложения каталога для Windows Phone 8. Это приложение будет использовать шаблон *приложения Windows Phone с привязкой* к данным для пользовательского интерфейса по умолчанию и будет использовать приложение веб-API, созданное на [шаге 1](#STEP1) этого учебника в качестве источника данных.

1. Щелкните правой кнопкой мыши решение **Bookstore** в в обозревателе решений, затем щелкните **Добавить**, а затем — **Новый проект**.
2. Когда откроется диалоговое окно **Создание проекта** , разверните узел **установленные**, а **затем C#Visual** и затем **Windows Phone**.
3. Выделите **Windows Phone приложение с привязкой к данным**, введите **буккаталог** в поле имя и нажмите кнопку **ОК**.
4. Добавьте пакет NuGet Json.NET в проект **буккаталог** :

    1. Щелкните правой кнопкой мыши **ссылки** на проект **буккаталог** в обозревателе решений и выберите пункт **Управление пакетами NuGet**.
    2. Когда откроется диалоговое окно **Управление пакетами NuGet** , разверните раздел **Online** и выделите **NuGet.org**.
    3. Введите **JSON.NET** в поле поиска и щелкните значок поиска.
    4. Выделите **JSON.NET** в результатах поиска и нажмите кнопку **установить**.
    5. После завершения установки нажмите кнопку **Закрыть**.
5. Добавьте модель **букдетаилс** в проект **буккаталог** . Он содержит универсальную модель класса Bookstore:

   1. Щелкните правой кнопкой мыши проект **буккаталог** в обозревателе решений, нажмите кнопку **Добавить**, а затем выберите пункт **создать папку**.
   2. Назовите новые **модели**папок.
   3. Щелкните правой кнопкой мыши папку **модели** в обозревателе решений, выберите **Добавить**, а затем — **класс**.
   4. Когда откроется диалоговое окно **Добавление нового элемента** , назовите файл класса **BookDetails.CS**и нажмите кнопку **добавить**.
   5. При открытии файла **BookDetails.CS** замените код в файле следующим кодом: 

       [!code-csharp[Main](calling-web-api-from-a-windows-phone-8-application/samples/sample4.cs)]
   6. Сохраните и закройте файл **BookDetails.CS** .

6. Обновите класс **MainViewModel.CS** , чтобы включить функции для взаимодействия с приложением веб-API книжного магазина:

   1. Разверните папку **ViewModels** в обозревателе решений, а затем дважды щелкните файл **MainViewModel.CS** .
   2. При открытии файла **MainViewModel.CS** замените код в файле следующим кодом. Обратите внимание, что необходимо обновить значение `apiUrl`ной константы с помощью фактического URL-адреса вашего Web API: 

       [!code-csharp[Main](calling-web-api-from-a-windows-phone-8-application/samples/sample5.cs)]
   3. Сохраните и закройте файл **MainViewModel.CS** .

7. Обновите файл **MainPage. XAML** , чтобы настроить имя приложения:

   1. Дважды щелкните файл **MainPage. XAML** в обозревателе решений.
   2. При открытии файла **MainPage. XAML** нахождение следующих строк кода: 

       [!code-xml[Main](calling-web-api-from-a-windows-phone-8-application/samples/sample6.xml)]
   3. Замените эти строки следующим: 

       [!code-xml[Main](calling-web-api-from-a-windows-phone-8-application/samples/sample7.xml)]
   4. Сохраните и закройте файл **MainPage. XAML** .

8. Обновите файл **детаилспаже. XAML** , чтобы настроить отображаемые элементы:

   1. Дважды щелкните файл **детаилспаже. XAML** в обозревателе решений.
   2. При открытии файла **детаилспаже. XAML** нахождение следующих строк кода: 

       [!code-xml[Main](calling-web-api-from-a-windows-phone-8-application/samples/sample8.xml)]
   3. Замените эти строки следующим: 

       [!code-xml[Main](calling-web-api-from-a-windows-phone-8-application/samples/sample9.xml)]
   4. Сохраните и закройте файл **детаилспаже. XAML** .

9. Создайте приложение Windows Phone для проверки на наличие ошибок.

### <a name="step-3-testing-the-end-to-end-solution"></a>Шаг 3. Тестирование комплексного решения

Как упоминалось в разделе " *Предварительные требования* " этого руководства, при тестировании подключения между проектами веб-api и Windows Phone 8 в локальной системе необходимо выполнить инструкции из статьи *[подключение эмулятора Windows Phone 8 к ПРИЛОЖЕНИЯМ веб-API на локальном компьютере](https://go.microsoft.com/fwlink/?LinkId=324014)* , чтобы настроить среду тестирования.

После настройки тестовой среды необходимо задать приложение Windows Phone в качестве запускаемого проекта. Для этого выделите приложение **буккаталог** в обозревателе решений и нажмите кнопку **Назначить запускаемым проектом**.

| [![](calling-web-api-from-a-windows-phone-8-application/_static/image6.png)](calling-web-api-from-a-windows-phone-8-application/_static/image5.png) |
| --- |
| Щелкните изображение, чтобы развернуть |

При нажатии клавиши F5 Visual Studio запустит эмулятор Windows Phone, в котором будет отображаться &quot;подождите&quot; сообщение, пока данные приложения будут получены из веб-API:

| [![](calling-web-api-from-a-windows-phone-8-application/_static/image8.png)](calling-web-api-from-a-windows-phone-8-application/_static/image7.png) |
| --- |
| Щелкните изображение, чтобы развернуть |

Если все прошло успешно, должен отобразиться каталог:

| [![](calling-web-api-from-a-windows-phone-8-application/_static/image10.png)](calling-web-api-from-a-windows-phone-8-application/_static/image9.png) |
| --- |
| Щелкните изображение, чтобы развернуть |

Если коснуться любого названия книги, в приложении отобразится описание книги:

| [![](calling-web-api-from-a-windows-phone-8-application/_static/image12.png)](calling-web-api-from-a-windows-phone-8-application/_static/image11.png) |
| --- |
| Щелкните изображение, чтобы развернуть |

Если приложение не может взаимодействовать с веб-API, отобразится сообщение об ошибке:

| [![](calling-web-api-from-a-windows-phone-8-application/_static/image14.png)](calling-web-api-from-a-windows-phone-8-application/_static/image13.png) |
| --- |
| Щелкните изображение, чтобы развернуть |

Если коснуться сообщения об ошибке, будут отображаться дополнительные сведения об ошибке:

| [![](calling-web-api-from-a-windows-phone-8-application/_static/image16.png)](calling-web-api-from-a-windows-phone-8-application/_static/image15.png) |
|-------------------------------------------------------------------------------------------------------------------------------------------------------|
|                                                                 Щелкните изображение, чтобы развернуть                                                                 |
