---
uid: web-api/overview/data/using-web-api-with-entity-framework/part-2
title: Добавление моделей и контроллеров | Документация Майкрософт
author: MikeWasson
description: ''
ms.author: riande
ms.date: 06/16/2014
ms.assetid: 88908ff8-51a9-40eb-931c-a8139128b680
msc.legacyurl: /web-api/overview/data/using-web-api-with-entity-framework/part-2
msc.type: authoredcontent
ms.openlocfilehash: 57dacda421968f341284d89c9a3ad80040c16e25
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78449190"
---
# <a name="add-models-and-controllers"></a>Добавление моделей и контроллеров

по [Майк Уоссон](https://github.com/MikeWasson)

[Скачать завершенный проект](https://github.com/MikeWasson/BookService)

В этом разделе вы добавите классы модели, определяющие сущности базы данных. Затем вы добавите контроллеры веб-API, выполняющие операции CRUD с этими сущностями.

## <a name="add-model-classes"></a>Добавление классов модели

В этом учебнике мы создадим базу данных с помощью подхода "Code First" к Entity Framework (EF). С помощью Code First вы пишете C# классы, соответствующие таблицам базы данных, и EF создает базу данных. (Дополнительные сведения см. в разделе [Entity Framework подходов к разработке](https://msdn.microsoft.com/library/ms178359%28v=vs.110%29.aspx#dbfmfcf).)

Начнем с определения наших объектов домена как POCO (обычные объекты CLR). Мы создадим следующие POCO:

- Автор
- Book

В обозреватель решений щелкните правой кнопкой мыши папку модели. Нажмите кнопку **Добавить**, а затем выберите **класс**. Назовите класс `Author`.

![](part-2/_static/image1.png)

Замените весь стандартный код в Author.cs следующим кодом.

[!code-csharp[Main](part-2/samples/sample1.cs)]

Добавьте еще один класс с именем `Book`и приведенный ниже код.

[!code-csharp[Main](part-2/samples/sample2.cs)]

Entity Framework будут использовать эти модели для создания таблиц базы данных. Для каждой модели свойство `Id` станет первичным ключевым столбцом таблицы базы данных.

В классе Book `AuthorId` определяет внешний ключ в `Author` таблице. (Для простоты я полагаю, что каждая книга имеет один автор.) Класс Book также содержит свойство навигации для связанного `Author`. Для доступа к связанным `Author` в коде можно использовать свойство навигации. Я говорю Подробнее о свойствах навигации в части 4, [обрабатывая связи сущностей](part-4.md).

## <a name="add-web-api-controllers"></a>Добавление контроллеров веб-API

В этом разделе мы добавим контроллеры веб-API, поддерживающие операции CRUD (создание, чтение, обновление и удаление). Контроллеры будут использовать Entity Framework для взаимодействия с уровнем базы данных.

Во-первых, можно удалить файловые контроллеры/объекта valuescontroller. cs. Этот файл содержит пример контроллера веб-API, но он не требуется для работы с этим руководством.

![](part-2/_static/image2.png)

Затем постройте проект. Формирование шаблонов веб-API использует отражение для поиска классов модели, поэтому ему требуется скомпилированная сборка.

В обозреватель решений щелкните правой кнопкой мыши папку Controllers. Нажмите кнопку **Добавить**, а затем выберите **контроллер**.

![](part-2/_static/image3.png)

В диалоговом окне **Добавление шаблона** выберите "контроллер веб-API 2 с действиями с помощью Entity Framework". Нажмите кнопку **Добавить**.

![](part-2/_static/image4.png)

В диалоговом окне **Добавление контроллера** выполните следующие действия.

1. В раскрывающемся списке **класс модели** выберите класс `Author`. (Если вы не видите его в раскрывающемся списке, убедитесь, что вы создали проект.)
2. Установите флажок "использовать действия асинхронного контроллера".
3. Оставьте имя контроллера &quot;Аусорсконтроллер&quot;.
4. Нажмите кнопку со знаком «плюс» (+) рядом с **классом контекста данных**.

![](part-2/_static/image5.png)

В диалоговом окне **новый контекст данных** оставьте имя по умолчанию и нажмите кнопку **Добавить**.

![](part-2/_static/image6.png)

Нажмите кнопку **Добавить** , чтобы завершить диалоговое окно **Добавление контроллера** . В этом диалоговом окне в проект добавляются два класса:

- `AuthorsController` определяет контроллер веб-API. Контроллер реализует REST API, которые клиенты используют для выполнения операций CRUD в списке авторов.
- `BookServiceContext` управляет объектами сущностей во время выполнения, включая заполнение объектов данными из базы данных, отслеживание изменений и сохранение данных в базе данных. Он наследует от `DbContext`.

![](part-2/_static/image7.png)

На этом этапе повторите сборку проекта. Теперь выполните те же действия, чтобы добавить контроллер API для сущностей `Book`. На этот раз выберите `Book` для класса Model и выберите существующий класс `BookServiceContext` для класса контекста данных. (Не создавайте новый контекст данных.) Нажмите кнопку **Добавить** , чтобы добавить контроллер.

![](part-2/_static/image8.png)

> [!div class="step-by-step"]
> [Назад](part-1.md)
> [Вперед](part-3.md)
