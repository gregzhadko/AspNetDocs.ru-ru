---
uid: web-api/overview/data/using-web-api-with-entity-framework/part-2
title: Добавление моделей и контроллеров | Документация Майкрософт
author: MikeWasson
description: ''
ms.author: riande
ms.date: 06/16/2014
ms.assetid: 88908ff8-51a9-40eb-931c-a8139128b680
msc.legacyurl: /web-api/overview/data/using-web-api-with-entity-framework/part-2
msc.type: authoredcontent
ms.openlocfilehash: 57dacda421968f341284d89c9a3ad80040c16e25
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59405083"
---
# <a name="add-models-and-controllers"></a>Добавление моделей и контроллеров

по [Майк Уоссон](https://github.com/MikeWasson)

[Скачать завершенный проект](https://github.com/MikeWasson/BookService)

В этом разделе вы добавите модели классы, определяющие сущности базы данных. Затем нужно добавить контроллеры веб-API, которые выполняют операции CRUD в этих сущностях.

## <a name="add-model-classes"></a>Добавление классов модели

В этом руководстве мы создадим базу данных с помощью подхода «Code First» для Entity Framework (EF). В режиме Code First писать классы C#, которые соответствуют таблицам базы данных, а EF создает базу данных. (Дополнительные сведения см. в разделе [принципы разработки с использованием Entity Framework](https://msdn.microsoft.com/library/ms178359%28v=vs.110%29.aspx#dbfmfcf).)

Мы начнем с определения объектов домена как POCO (обычные старые объекты CLR). Мы создадим следующие POCO.

- Дизайнер
- Книги

В обозревателе решений щелкните правой кнопкой мыши папку Models. Выберите **добавить**, а затем выберите **класс**. Присвойте классу имя `Author`.

![](part-2/_static/image1.png)

Замените весь код шаблона в Author.cs следующим кодом.

[!code-csharp[Main](part-2/samples/sample1.cs)]

Добавьте еще один класс с именем `Book`, следующим кодом.

[!code-csharp[Main](part-2/samples/sample2.cs)]

Entity Framework будет использовать эти модели для создания таблиц базы данных. Для каждой модели `Id` свойство станет столбец первичного ключа таблицы базы данных.

В классе книги `AuthorId` определяет внешний ключ в `Author` таблицы. (Для простоты я предполагаю, что каждая книга имеет один автор.) Класс книги также содержит свойство навигации к связанным `Author`. Свойство навигации можно использовать для доступа к соответствующим `Author` в коде. Подробнее о свойствах навигации в часть 4, [Обработка отношений сущностей](part-4.md).

## <a name="add-web-api-controllers"></a>Добавление контроллеров веб-API

В этом разделе мы добавим контроллеры веб-API, которые поддерживают операции CRUD (Создание, чтение, обновление и удаление). Контроллеры будут использовать Entity Framework для взаимодействия с уровня базы данных.

Во-первых можно удалить файл Controllers/ValuesController.cs. Этот файл содержит пример контроллера веб-API, но это не требуется для этого руководства.

![](part-2/_static/image2.png)

Затем выполнить сборку проекта. Формирование шаблонов веб-API использует отражение для поиска классов модели, поэтому оно должно скомпилированной сборки.

В обозревателе решений щелкните правой кнопкой мыши папку Controllers. Выберите **добавить**, а затем выберите **контроллера**.

![](part-2/_static/image3.png)

В **Добавление шаблона** диалоговое окно, выберите «веб-API 2 контроллер с действиями, использующий Entity Framework». Нажмите кнопку **Добавить**.

![](part-2/_static/image4.png)

В **Добавление контроллера** диалоговое окно, выполните следующие действия:

1. В **класс модели** раскрывающемся списке выберите `Author` класса. (Если вы не видите его в раскрывающемся списке, убедитесь, что вы создали проект.)
2. Проверьте «Используйте асинхронные действия контроллера».
3. Имя контроллера как оставить &quot;AuthorsController&quot;.
4. Щелкните плюс (+) рядом с пунктом **класс контекста данных**.

![](part-2/_static/image5.png)

В **новый контекст данных** диалоговом окне оставьте имя по умолчанию и нажмите кнопку **добавить**.

![](part-2/_static/image6.png)

Нажмите кнопку **добавить** для завершения **Добавление контроллера** диалоговое окно. Диалоговое окно добавляет два класса в проект:

- `AuthorsController` Определяет контроллер Web API. Контроллер реализует REST API, который клиенты используют для выполнения операций CRUD в список авторов.
- `BookServiceContext` управляет объектами сущностей во время выполнения, который включает заполнение объектов с помощью данных из базы данных, отслеживание изменений и сохранения данных в базе данных. Он наследует от `DbContext`.

![](part-2/_static/image7.png)

На этом этапе построения проекта. Теперь выполните те же действия, чтобы добавить контроллер API для `Book` сущностей. На этот раз выберите `Book` для класс модели и выберите существующий `BookServiceContext` класс для класса контекста данных. (Не создавайте новый контекст данных). Нажмите кнопку **добавить** Добавление контроллера.

![](part-2/_static/image8.png)

> [!div class="step-by-step"]
> [Назад](part-1.md)
> [Вперед](part-3.md)
