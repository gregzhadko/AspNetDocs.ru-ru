---
uid: web-api/overview/older-versions/build-restful-apis-with-aspnet-web-api
title: Создание API-интерфейсов RESTFUL с помощью веб-API ASP.NET ASP.NET 4. x
author: rick-anderson
description: Практическое занятие. Используйте веб-API в ASP.NET 4. x для создания простого REST API для приложения диспетчера контактов.
ms.author: riande
ms.date: 02/18/2013
ms.custom: seoapril2019
ms.assetid: 87daa99f-3810-407e-b969-dd28a192959d
msc.legacyurl: /web-api/overview/older-versions/build-restful-apis-with-aspnet-web-api
msc.type: authoredcontent
ms.openlocfilehash: 35b115d6b4f84084e78e429bbb4842670e57bba4
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78504270"
---
# <a name="build-restful-apis-with-aspnet-web-api"></a>Создание API-интерфейсов RESTFUL с помощью веб-API ASP.NET

по [веб-Camp командам](https://twitter.com/webcamps)

> Практическое занятие. Используйте веб-API в ASP.NET 4. x для создания простого REST API для приложения диспетчера контактов. Кроме того, будет построен клиент для использования API.

В последние годы он стал ясно, что HTTP не только обслуживает HTML-страницы. Она также является мощной платформой для создания веб-API, используя несколько глаголов (GET, POST и т. д.) и несколько простых концепций, таких как *URI* и *заголовки*. Веб-API ASP.NET — это набор компонентов, упрощающих программирование HTTP. Поскольку она построена на базе среды выполнения MVC ASP.NET, веб-API автоматически обрабатывает данные транспорта низкого уровня по протоколу HTTP. В то же время веб-API естественным образом предоставляет модель программирования HTTP. На самом деле, одна из целей веб-API заключается в том, чтобы *не* приойти к реальности HTTP. В результате веб-API является гибким и простым в расширении.  Архитектурный стиль «ОСТАЛЬной» стал эффективным способом использования протокола HTTP, хотя он, безусловно, не является единственным допустимым подходом к HTTP. Диспетчер контактов будет предоставлять все остальное для перечисления, добавления и удаления контактов. 

В этом лабораторном занятии требуется базовое понимание протокола HTTP, а также предполагается, что у вас есть основные знания о HTML, JavaScript и jQuery.
> 
> > [!NOTE]
> > На веб-сайте ASP.NET есть область, выделенная для веб-API ASP.NET Framework на [https://asp.net/web-api](https://asp.net/web-api). Этот сайт продолжит предоставлять последние сведения, примеры и новости, связанные с веб-API, поэтому регулярно проверяйте его, если вы хотите глубже изучить создание настраиваемых веб-API, доступных практически для любого устройства или платформы разработки.
> > 
> > Веб-API ASP.NET, как и в случае с ASP.NET MVC 4, имеет большую гибкость в плане разделения уровня служб от контроллеров, что позволяет легко использовать несколько доступных платформ внедрения зависимостей. В MSDN есть хороший пример, демонстрирующий использование Нинжект для внедрения зависимостей в проект веб-API ASP.NET, который можно скачать [отсюда](https://code.msdn.microsoft.com/ASPNET-Web-API-JavaScript-d0d64dd7).
> 
> 
> Все примеры кода и фрагментов включены в комплект обучающих курсов Web Camp, доступный по адресу [https://go.microsoft.com/fwlink/?LinkID=248297&clcid=0x409](https://go.microsoft.com/fwlink/?LinkID=248297&clcid=0x409).

<a id="Objectives"></a>
### <a name="objectives"></a>Цели

В этой практической лабораторной работе вы узнаете, как выполнять следующие задачи:

- Реализация веб-API RESTFUL
- Вызов API из HTML-клиента

<a id="Prerequisites"></a>
### <a name="prerequisites"></a>предварительные требования

Для выполнения этой практической лабораторной работы требуется следующее:

- [Microsoft Visual Studio Express 2012 для Web](https://www.microsoft.com/visualstudio/eng/products/visual-studio-express-for-web) или старше (см. [Приложение B](#AppendixB) для получения инструкций по его установке).

<a id="Setup"></a>
### <a name="setup"></a>Настройка

**Установка фрагментов кода**

Для удобства большая часть кода, который вы будете управлять в этой лаборатории, доступна в виде фрагментов кода Visual Studio. Чтобы установить фрагменты кода, запустите файл **.\саурце\сетуп\кодесниппетс.ВСИ** .

Если вы не знакомы с фрагментами кода Visual Studio Code и хотите узнать, как их использовать, см. приложение из этого документа &quot;[приложении а. Использование фрагментов кода](#AppendixA)&quot;.

<a id="Exercises"></a>
## <a name="exercises"></a>Полнят

Эта практическая лабораторная работа включает в себя следующее упражнение:

1. [Упражнение 1. Создание веб-API только для чтения](#Exercise1)
2. [Упражнение 2. Создание веб-API для чтения и записи](#Exercise2)
3. [Упражнение 3. Использование веб-API из клиента HTML](#Exercise3)

> [!NOTE]
> Каждое упражнение сопровождается **конечной** папкой, содержащей итоговое решение, которое следует получить после завершения упражнений. Это решение можно использовать в качестве инструкции, если вам нужна дополнительная помощь по работе с упражнениями.

Предполагаемое время выполнения этой лабораторной работы: **60 минут**.

<a id="Exercise1"></a>

<a id="Exercise_1_Create_a_Read-Only_Web_API"></a>
### <a name="exercise-1-create-a-read-only-web-api"></a>Упражнение 1. Создание веб-API только для чтения

В этом упражнении будут реализованы методы GET, доступные только для чтения для диспетчера контактов.

<a id="Ex1Task1"></a>

<a id="Task_1_-_Creating_the_API_Project"></a>
#### <a name="task-1---creating-the-api-project"></a>Задача 1. Создание проекта API

В этой задаче вы будете использовать новые шаблоны веб-проектов ASP.NET для создания веб-приложения API.

1. Запустите **Visual Studio 2012 Express для Web**. для этого перейдите в раздел **запуск** и введите **VS Express для Web** нажмите клавишу **Ввод**.
2. В меню **файл** выберите пункт **создать проект**. Выберите **визуальный C# элемент | Тип веб-** проекта из древовидного представления типа проекта, а затем выберите тип проекта **веб-приложение ASP.NET MVC 4** . Задайте для проекта **имя** *ContactManager* , а для параметра **имя решения** — *Начало*, а затем нажмите кнопку **ОК**.

    ![Создание нового проекта веб-приложения ASP.NET MVC 4,0](build-restful-apis-with-aspnet-web-api/_static/image1.png "Создание нового проекта веб-приложения ASP.NET MVC 4,0")

    *Создание нового проекта веб-приложения ASP.NET MVC 4,0*
3. В диалоговом окне Тип проекта ASP.NET MVC 4 Выберите тип проекта **веб-API** . Нажмите кнопку **ОК**.

    ![Указание типа проекта веб-API](build-restful-apis-with-aspnet-web-api/_static/image2.png "Указание типа проекта веб-API")

    *Указание типа проекта веб-API*

<a id="Ex1Task2"></a>

<a id="Task_2_-_Creating_the_Contact_Manager_API_Controllers"></a>
#### <a name="task-2---creating-the-contact-manager-api-controllers"></a>Задача 2. Создание контроллеров API диспетчера контактов

В этой задаче будут созданы классы контроллеров, в которых будут размещаться методы API.

1. Удалите файл с именем **ValuesController.CS** в папке **Controllers** из проекта.
2. Щелкните правой кнопкой мыши папку **Controllers** в проекте и выберите **Добавить | Контроллер** из контекстного меню.

    ![Добавление нового контроллера в проект](build-restful-apis-with-aspnet-web-api/_static/image3.png "Добавление нового контроллера в проект")

    *Добавление нового контроллера в проект*
3. В появившемся диалоговом окне **Добавление контроллера** в меню шаблон выберите пункт **пустой контроллер API** . Назовите класс контроллера **контактконтроллер**. Затем нажмите кнопку **Добавить.**

    ![Использование диалогового окна "Добавление контроллера" для создания нового контроллера веб-API](build-restful-apis-with-aspnet-web-api/_static/image4.png "Использование диалогового окна "Добавление контроллера" для создания нового контроллера веб-API")

    *Использование диалогового окна "Добавление контроллера" для создания нового контроллера веб-API*
4. Добавьте следующий код в **контактконтроллер**.

    (Фрагмент кода — *веб-API Lab-Ex01-Get метод API*)

    [!code-csharp[Main](build-restful-apis-with-aspnet-web-api/samples/sample1.cs)]
5. Нажмите клавишу **F5** для запуска отладки приложения. Должна отобразиться домашняя страница по умолчанию для проекта веб-API.

    ![Домашняя страница по умолчанию веб-API ASP.NET приложения](build-restful-apis-with-aspnet-web-api/_static/image5.png "Домашняя страница по умолчанию веб-API ASP.NET приложения")

    *Домашняя страница по умолчанию веб-API ASP.NET приложения*
6. В окне Internet Explorer нажмите клавишу **F12** , чтобы открыть окно **средства для разработчиков** . Перейдите на вкладку **сеть** и нажмите кнопку **Start захватить (начать запись** ), чтобы начать запись сетевого трафика в окно.

    ![Открытие вкладки "сеть" и инициация записи в сеть](build-restful-apis-with-aspnet-web-api/_static/image6.png "Открытие вкладки "сеть" и инициация записи в сеть")

    *Открытие вкладки "сеть" и инициация записи в сеть*
7. Добавьте URL-адрес в адресную строку браузера с помощью **/АПИ/контакт** и нажмите клавишу ВВОД. Сведения о передаче будут отображаться в окне "запись сети". Обратите внимание, что тип MIME ответа — **Application/JSON**. Это показывает, как формат вывода по умолчанию — JSON.

    ![Просмотр выходных данных запроса веб-API в представлении сети](build-restful-apis-with-aspnet-web-api/_static/image7.png "Просмотр выходных данных запроса веб-API в представлении сети")

    *Просмотр выходных данных запроса веб-API в представлении сети*

    > [!NOTE]
    > По умолчанию Internet Explorer 10 получит запрос на сохранение или открытие потока, полученного при вызове веб-API. Выходные данные будут представлять собой текстовый файл, содержащий результат JSON вызова URL веб-API. Не отменяйте диалоговое окно, чтобы иметь возможность просматривать содержимое ответа через окно инструментов разработчиков.
8. Нажмите кнопку " **Перейти к подробному просмотру** ", чтобы просмотреть дополнительные сведения о ответе этого вызова API.

    ![Переключиться в подробное представление](build-restful-apis-with-aspnet-web-api/_static/image8.png "Переключиться в представление сведений")

    *Переключиться в подробное представление*
9. Щелкните вкладку **текст ответа** , чтобы просмотреть фактический текст ответа JSON.

    ![Просмотр выходного текста JSON в сетевом мониторе](build-restful-apis-with-aspnet-web-api/_static/image9.png "Просмотр выходного текста JSON в сетевом мониторе")

    *Просмотр выходного текста JSON в сетевом мониторе*

<a id="Ex1Task3"></a>

<a id="Task_3_-_Creating_the_Contact_Models_and_Augment_the_Contact_Controller"></a>
#### <a name="task-3---creating-the-contact-models-and-augment-the-contact-controller"></a>Задача 3. Создание моделей контактов и дополнение контактного контроллера

В этой задаче будут созданы классы контроллеров, в которых будут размещаться методы API.

1. Щелкните правой кнопкой мыши папку **модели** и выберите **Добавить | Класс...** в контекстном меню.

    ![Добавление новой модели в веб-приложение](build-restful-apis-with-aspnet-web-api/_static/image10.png "Добавление новой модели в веб-приложение")

    *Добавление новой модели в веб-приложение*
2. В диалоговом окне **Добавление нового элемента** назовите новый файл **Contact.CS** и нажмите кнопку **Добавить.**

    ![Создание нового файла класса Contact](build-restful-apis-with-aspnet-web-api/_static/image11.png "Создание нового файла класса Contact")

    *Создание нового файла класса Contact*
3. Добавьте выделенный ниже код в класс **Contact** .

    (Фрагмент кода — *веб-API Lab — Ex01 — класс Contact*)

    [!code-csharp[Main](build-restful-apis-with-aspnet-web-api/samples/sample2.cs)]
4. В классе **контактконтроллер** выберите слово **строка** в определении метода **Get** и введите слово *Contact*. После того как слово введено, в начале **контакта**слова появится индикатор. Либо удерживайте нажатой клавишу **CTRL** , либо нажмите клавишу точка (.) или щелкните значок с помощью мыши, чтобы открыть диалоговое окно помощи в редакторе кода, чтобы автоматически заполнить директиву **using** для пространства имен Models.

    ![Использование справки IntelliSense для объявлений пространств имен](build-restful-apis-with-aspnet-web-api/_static/image12.png)

    *Использование справки IntelliSense для объявлений пространств имен*
5. Измените код для метода **Get** таким образом, чтобы он возвращал массив экземпляров модели связи.

    (Фрагмент кода — *веб-API Lab — Ex01 — Возврат списка контактов*)

    [!code-csharp[Main](build-restful-apis-with-aspnet-web-api/samples/sample3.cs)]
6. Нажмите клавишу **F5** для отладки веб-приложения в браузере. Чтобы просмотреть изменения, внесенные в выходные данные ответа API, выполните следующие действия.

   1. После открытия браузера нажмите клавишу **F12** , если средства разработчика еще не открыты.
   2. Перейдите на вкладку **сеть** .
   3. Нажмите кнопку **начать запись** .
   4. Добавьте URL-суффикс **/АПИ/контакт** к URL-адресу в адресной строке и нажмите клавишу **Ввод** .
   5. Нажмите кнопку **Перейти к подробному просмотру** .
   6. Перейдите на вкладку **текст ответа** . Должна отобразиться строка JSON, представляющая сериализованную форму массива экземпляров контакта.

      ![Сериализованные выходные данные JSON вызова сложного метода веб-API](build-restful-apis-with-aspnet-web-api/_static/image13.png "Сериализованные выходные данные JSON вызова сложного метода веб-API")

      *Сериализованные выходные данные JSON вызова сложного метода веб-API*

<a id="Ex1Task4"></a>

<a id="Task_4_-_Extracting_Functionality_into_a_Service_Layer"></a>
#### <a name="task-4---extracting-functionality-into-a-service-layer"></a>Задача 4. Извлечение функциональных возможностей в слой служб

В этой задаче будет продемонстрировано, как извлечь функциональные возможности в слой служб, чтобы разработчикам было проще отделить функциональность служб от уровня контроллера, таким образом обеспечивая возможность повторного использования служб, которые реально выполняют работу.

1. Создайте новую папку в корне решения и назовите ее **Services**. Для этого щелкните правой кнопкой мыши проект **ContactManager** , выберите **Добавить** | **создать папку**, назовите *службы*.

    ![Создание папки служб](build-restful-apis-with-aspnet-web-api/_static/image14.png "Создание папки служб")

    *Создание папки служб*
2. Щелкните правой кнопкой мыши папку **службы** и выберите команду **Добавить | Класс...** в контекстном меню.

    ![Добавление нового класса в папку "службы"](build-restful-apis-with-aspnet-web-api/_static/image15.png "Добавление нового класса в папку "службы"")

    *Добавление нового класса в папку "службы"*
3. Когда появится диалоговое окно **Добавление нового элемента** , назовите новый класс **ContactRepository** и нажмите кнопку **добавить**.

    ![Создание файла класса, содержащего код для уровня службы репозитория контактов](build-restful-apis-with-aspnet-web-api/_static/image16.png "Создание файла класса, содержащего код для уровня службы репозитория контактов")

    *Создание файла класса, содержащего код для уровня службы репозитория контактов*
4. Добавьте директиву using в файл **ContactRepository.CS** , чтобы включить пространство имен Models.

    [!code-csharp[Main](build-restful-apis-with-aspnet-web-api/samples/sample4.cs)]
5. Добавьте следующий выделенный код в файл **ContactRepository.CS** для реализации метода жеталлконтактс.

    (Фрагмент кода — *веб-API Lab — Ex01 — репозиторий контактов*)

    [!code-csharp[Main](build-restful-apis-with-aspnet-web-api/samples/sample5.cs)]
6. Откройте файл **ContactController.CS** , если он еще не открыт.
7. Добавьте следующий оператор using в раздел объявления пространства имен файла.

    [!code-csharp[Main](build-restful-apis-with-aspnet-web-api/samples/sample6.cs)]
8. Добавьте следующий выделенный код в класс **ContactController.CS** , чтобы добавить закрытое поле для представления экземпляра репозитория, чтобы остальные члены класса могли использовать реализацию службы.

    (Фрагмент кода — *веб-API Lab — Ex01 — контактный контроллер*)

    [!code-csharp[Main](build-restful-apis-with-aspnet-web-api/samples/sample7.cs)]
9. Измените метод **Get** таким образом, чтобы он использовал службу репозитория контактов.

    (Фрагмент кода — *веб-API Lab — Ex01 — Возврат списка контактов через репозиторий*)

    [!code-csharp[Main](build-restful-apis-with-aspnet-web-api/samples/sample8.cs)]
10. Установите точку останова в определении метода **Get** **контактконтроллер**.

   ![Добавление точек останова в контактный контроллер](build-restful-apis-with-aspnet-web-api/_static/image17.png "Добавление точек останова в контактный контроллер")

   *Добавление точек останова в контактный контроллер*
11. Нажмите клавишу **F5** для запуска приложения.
12. Когда откроется браузер, нажмите клавишу **F12** , чтобы открыть средства разработчика.
13. Перейдите на вкладку **сеть** .
14. Нажмите кнопку **начать запись** .
15. Добавьте URL-адрес в адресную строку с суффиксом **/АПИ/контакт** и нажмите клавишу **Ввод** , чтобы загрузить контроллер API.
16. Visual Studio 2012 должна прерываться после начала выполнения метода **Get** .

   ![Прерывание в методе Get](build-restful-apis-with-aspnet-web-api/_static/image18.png "Прерывание в методе Get")

   *Прерывание в методе Get*
17. Нажмите клавишу **F5**, чтобы продолжить.
18. Вернитесь в Internet Explorer, если он еще не находится в фокусе. Обратите внимание на окно записи в сеть.

    ![Представление "сеть" в Internet Explorer, отображающее результаты вызова веб-API](build-restful-apis-with-aspnet-web-api/_static/image19.png "Представление "сеть" в Internet Explorer, отображающее результаты вызова веб-API")

    *Представление "сеть" в Internet Explorer, отображающее результаты вызова веб-API*
19. Нажмите кнопку " **Перейти к подробному просмотру** ".
20. Перейдите на вкладку **текст ответа** . Обратите внимание на выходные данные JSON вызова API и на то, как он представляет два контакта, полученные слоем служб.

    ![Просмотр выходных данных JSON из веб-API в окне средств разработчика](build-restful-apis-with-aspnet-web-api/_static/image20.png "Просмотр выходных данных JSON из веб-API в окне средств разработчика")

    *Просмотр выходных данных JSON из веб-API в окне средств разработчика*

<a id="Exercise2"></a>

<a id="Exercise_2_Create_a_ReadWrite_Web_API"></a>
### <a name="exercise-2-create-a-readwrite-web-api"></a>Упражнение 2. Создание веб-API для чтения и записи

В этом упражнении будут реализованы методы POST и постановки для диспетчера контактов, чтобы включить его с помощью функций редактирования данных.

<a id="Ex2Task1"></a>

<a id="Task_1_-_Opening_the_Web_API_Project"></a>
#### <a name="task-1---opening-the-web-api-project"></a>Задача 1. Открытие проекта веб-API

В этой задаче вы будете готовы усовершенствовать проект веб-API, созданный в упражнении 1, чтобы он мог принимать данные, вводимые пользователем.

1. Запустите **Visual Studio 2012 Express для Web**. для этого перейдите в раздел **запуск** и введите **VS Express для Web** нажмите клавишу **Ввод**.
2. Откройте **Начальное** решение, расположенное по адресу **Source/Ex02-реадвритевебапи/Begin/** Folder. В противном случае вы можете продолжать **использовать решение, полученное в результате** выполнения предыдущего упражнения.

   1. Если вы открыли предоставленное **Начальное** решение, перед продолжением потребуется загрузить некоторые недостающие пакеты NuGet. Для этого в меню **проект** выберите пункт **Управление пакетами NuGet**.
   2. В диалоговом окне **Управление пакетами NuGet** нажмите кнопку **восстановить** , чтобы скачать недостающие пакеты.
   3. Наконец, создайте решение, щелкнув **build** | **Build Solution**.

      > [!NOTE]
      > Одним из преимуществ использования NuGet является то, что вам не нужно поставлять все библиотеки в проекте, уменьшая размер проекта. С помощью средств управления питанием NuGet, указав версии пакетов в файле Packages. config, вы сможете скачать все необходимые библиотеки при первом запуске проекта. Именно поэтому после открытия существующего решения из этой лабораторной работы потребуется выполнить следующие действия.
3. Откройте файл **Services/ContactRepository. CS** .

<a id="Ex2Task2"></a>

<a id="Task_2_-_Adding_Data-Persistence_Features_to_the_Contact_Repository_Implementation"></a>
#### <a name="task-2---adding-data-persistence-features-to-the-contact-repository-implementation"></a>Задача 2. Добавление функций сохраняемости данных в реализацию репозитория контактов

В этой задаче вы дополните класс ContactRepository проекта веб-API, созданного в упражнении 1, чтобы он мог сохранять и принимать введенные пользователем данные и новые экземпляры контактов.

1. Добавьте следующую константу в класс **ContactRepository** для представления имени ключа элемента кэша веб-сервера далее в этом упражнении.

    [!code-csharp[Main](build-restful-apis-with-aspnet-web-api/samples/sample9.cs)]
2. Добавьте конструктор в **ContactRepository** , содержащий следующий код.

    (Фрагмент кода — *веб-API Lab-Ex02-конструктор репозитория*)

    [!code-csharp[Main](build-restful-apis-with-aspnet-web-api/samples/sample10.cs)]
3. Измените код метода **жеталлконтактс** , как показано ниже.

    (Фрагмент кода — *веб-API Lab — Ex02 — получение всех контактов*)

    [!code-csharp[Main](build-restful-apis-with-aspnet-web-api/samples/sample11.cs)]

    > [!NOTE]
    > Этот пример предназначен для демонстрационных целей и будет использовать кэш веб-сервера в качестве среды хранения, чтобы значения были доступны нескольким клиентам одновременно, вместо использования механизма хранения сеанса или времени существования хранилища запросов. Можно использовать Entity Framework, хранилище XML или любые другие разнообразные вместо кэша веб-сервера.
4. Реализуйте новый метод с именем **савеконтакт** для класса **ContactRepository** , чтобы выполнить действия по сохранению контакта. Метод **савеконтакт** должен принимать один параметр **Contact** и возвращать логическое значение, указывающее на успешное выполнение или сбой.

    (Фрагмент кода — *веб-API Lab-Ex02 — реализация метода савеконтакт*)

    [!code-csharp[Main](build-restful-apis-with-aspnet-web-api/samples/sample12.cs)]

<a id="Exercise3"></a>

<a id="Exercise_3_Consume_the_Web_API_from_an_HTML_Client"></a>
### <a name="exercise-3-consume-the-web-api-from-an-html-client"></a>Упражнение 3. Использование веб-API из клиента HTML

В этом упражнении вам предстоит создать HTML-клиент для вызова Web API. Этот клиент упрощает обмен данными с веб-API с помощью JavaScript и отображает результаты в веб-браузере с помощью разметки HTML.

<a id="Ex3Task1"></a>

<a id="Task_1_-_Modifying_the_Index_View_to_Provide_a_GUI_for_Displaying_Contacts"></a>
#### <a name="task-1---modifying-the-index-view-to-provide-a-gui-for-displaying-contacts"></a>Задача 1. изменение представления индекса для предоставления графического пользовательского интерфейса для отображения контактов

В этой задаче будет изменено представление индекса по умолчанию веб-приложения для поддержки требования отображения списка существующих контактов в HTML-браузере.

1. Откройте **Visual Studio 2012 Express для Web** , если она еще не открыта.
2. Откройте **Начальное** решение, расположенное по адресу **Source/Ex03-консумингвебапи/Begin/** Folder. В противном случае вы можете продолжать **использовать решение, полученное в результате** выполнения предыдущего упражнения.

   1. Если вы открыли предоставленное **Начальное** решение, перед продолжением потребуется загрузить некоторые недостающие пакеты NuGet. Для этого в меню **проект** выберите пункт **Управление пакетами NuGet**.
   2. В диалоговом окне **Управление пакетами NuGet** нажмите кнопку **восстановить** , чтобы скачать недостающие пакеты.
   3. Наконец, создайте решение, щелкнув **build** | **Build Solution**.

      > [!NOTE]
      > Одним из преимуществ использования NuGet является то, что вам не нужно поставлять все библиотеки в проекте, уменьшая размер проекта. С помощью средств управления питанием NuGet, указав версии пакетов в файле Packages. config, вы сможете скачать все необходимые библиотеки при первом запуске проекта. Именно поэтому после открытия существующего решения из этой лабораторной работы потребуется выполнить следующие действия.
3. Откройте файл **index. cshtml** , расположенный в папке **Views/Home** .
4. Замените код HTML в элементе div на **текст** идентификатора, чтобы он выглядел как следующий код.

    [!code-html[Main](build-restful-apis-with-aspnet-web-api/samples/sample13.html)]
5. Добавьте следующий код JavaScript в нижнюю часть файла, чтобы выполнить HTTP-запрос к Web API.

    [!code-cshtml[Main](build-restful-apis-with-aspnet-web-api/samples/sample14.cshtml)]
6. Откройте файл **ContactController.CS** , если он еще не открыт.
7. Поместите точку останова в метод **Get** класса **контактконтроллер** .

    ![Размещение точки останова в методе Get контроллера API](build-restful-apis-with-aspnet-web-api/_static/image21.png "Размещение точки останова в методе Get контроллера API")

    *Размещение точки останова в методе Get контроллера API*
8. Нажмите клавишу **F5**, чтобы запустить проект. Браузер загрузит HTML-документ.

    > [!NOTE]
    > Убедитесь, что вы посещаете корневой URL-адрес приложения.
9. После загрузки страницы и выполнения JavaScript будет достигнута точка останова, и выполнение кода будет приостановлено в контроллере.

    ![Отладка в вызовах веб-API с помощью VS Express для Web](build-restful-apis-with-aspnet-web-api/_static/image22.png "Отладка в вызовах веб-API с помощью VS Express для Web")

    *Отладка в вызове веб-API с помощью Visual Studio 2012 Express для Web*
10. Удалите точку останова и нажмите клавишу **F5** или кнопку **Continue** на панели инструментов отладки, чтобы продолжить загрузку представления в браузере. После завершения вызова веб-API вы должны увидеть контакты, возвращенные из вызова веб-API, отображаемые как элементы списка в браузере.

    ![Результаты вызова API, отображаемого в браузере как элементы списка](build-restful-apis-with-aspnet-web-api/_static/image23.png "Результаты вызова API, отображаемого в браузере как элементы списка")

    *Результаты вызова API, отображаемого в браузере как элементы списка*
11. Остановите отладку.

<a id="Ex3Task2"></a>

<a id="Task_2_-_Modifying_the_Index_View_to_Provide_a_GUI_for_Creating_Contacts"></a>
#### <a name="task-2---modifying-the-index-view-to-provide-a-gui-for-creating-contacts"></a>Задача 2. изменение представления индекса для предоставления графического пользовательского интерфейса для создания контактов

В этой задаче будет продолжаться изменение представления индекса приложения MVC. На страницу HTML будет добавлена форма, которая будет записывать вводимые пользователем данные и передавать их в веб-API для создания нового контакта, и будет создан новый метод контроллера веб-API для сбора данных о дате из графического интерфейса пользователя.

1. Откройте файл **ContactController.CS** .
2. Добавьте новый метод в класс контроллера с именем **POST** , как показано в следующем коде.

    (Фрагмент кода — *метод веб-API Lab-Ex03-POST*)

    [!code-csharp[Main](build-restful-apis-with-aspnet-web-api/samples/sample15.cs)]
3. Откройте файл **index. cshtml** в Visual Studio, если он еще не открыт.
4. Добавьте приведенный ниже код HTML в файл сразу после неупорядоченного списка, добавленного в предыдущей задаче.

    [!code-html[Main](build-restful-apis-with-aspnet-web-api/samples/sample16.html)]
5. В элементе script в нижней части документа добавьте следующий выделенный код для управления событиями нажатия кнопки, которые будут отправлять данные в веб-API с помощью вызова HTTP POST.

    [!code-html[Main](build-restful-apis-with-aspnet-web-api/samples/sample17.html)]
6. В **ContactController.CS**разместите точку останова в методе **POST** .
7. Нажмите клавишу **F5** , чтобы запустить приложение в браузере.
8. После загрузки страницы в браузере введите новое имя и идентификатор контакта и нажмите кнопку **сохранить** .

    ![Клиентский HTML-документ, загруженный в браузере](build-restful-apis-with-aspnet-web-api/_static/image24.png "Клиентский HTML-документ, загруженный в браузере")

    *Клиентский HTML-документ, загруженный в браузере*
9. Когда окно отладчика останавливается в методе **POST** , просмотрите свойства параметра **Contact** . Значения должны соответствовать данным, введенным в форме.

    ![Объект Contact, отправляемый в веб-API из клиента](build-restful-apis-with-aspnet-web-api/_static/image25.png "Объект Contact, отправляемый в веб-API из клиента")

    *Объект Contact, отправляемый в веб-API из клиента*
10. Пошаговое выполнение метода в отладчике до создания переменной **ответа** . После проверки в окне " **локальные** " отладчика вы увидите, что установлены все свойства.

   ![Ответ, следующий за созданием в отладчике](build-restful-apis-with-aspnet-web-api/_static/image26.png "Ответ, следующий за созданием в отладчике")

   *Ответ, следующий за созданием в отладчике*
11. Если нажать клавишу **F5** или нажать кнопку **продолжить** в отладчике, запрос будет выполнен. После переключения обратно в браузер новый контакт будет добавлен в список контактов, сохраненных реализацией **ContactRepository** .

   ![Браузер отражает успешное создание нового экземпляра контакта](build-restful-apis-with-aspnet-web-api/_static/image27.png "Браузер отражает успешное создание нового экземпляра контакта")

   *Браузер отражает успешное создание нового экземпляра контакта*

> [!NOTE]
> Кроме того, это приложение можно развернуть в Azure в [приложении C: Публикация приложения ASP.NET MVC 4 с помощью веб-развертывание](#AppendixC).

---

<a id="Summary"></a>
## <a name="summary"></a>Сводка

В этом лабораторном занятии введена новая платформа веб-API ASP.NET и реализация веб-API RESTFUL с помощью платформы. Здесь можно создать новый репозиторий, который упрощает сохранение данных с помощью любого количества механизмов и сети, которые обслуживаются, а не простой, как в примере в этой лаборатории. Веб-API поддерживает ряд дополнительных функций, таких как включение взаимодействия от клиентов, отличных от HTML, написанных на любом языке, поддерживающем HTTP и JSON или XML. Возможность размещения веб-API за пределами обычного веб-приложения также возможна, а также позволяет создавать собственные форматы сериализации.

На веб-сайте ASP.NET есть область, выделенная для веб-API ASP.NET Framework на [[https://asp.net/web-api](https://asp.net/web-api)](https://asp.net/web-api). Этот сайт продолжит предоставлять последние сведения, примеры и новости, связанные с веб-API, поэтому регулярно проверяйте его, если вы хотите глубже изучить создание настраиваемых веб-API, доступных практически для любого устройства или платформы разработки.

<a id="AppendixA"></a>

<a id="Appendix_A_Using_Code_Snippets"></a>
## <a name="appendix-a-using-code-snippets"></a>Приложение а. Использование фрагментов кода

С помощью фрагментов кода вы можете получить все необходимые вам коды. В лабораторном документе вы узнаете, когда можно использовать их, как показано на следующем рисунке.

![Использование фрагментов кода Visual Studio для вставки кода в проект](build-restful-apis-with-aspnet-web-api/_static/image28.png "Использование фрагментов кода Visual Studio для вставки кода в проект")

*Использование фрагментов кода Visual Studio для вставки кода в проект*

<a id="CodeSnippetUsingKeyBoard"></a>

<a id="To_add_a_code_snippet_using_the_keyboard_C_only"></a>
### <a name="to-add-a-code-snippet-using-the-keyboard-c-only"></a>Добавление фрагмента кода с помощью клавиатуры (C# только)

1. Поместите курсор в то место, куда вы хотите вставить код.
2. Начните вводить имя фрагмента (без пробелов или дефисов).
3. Посмотрите, как IntelliSense отображает соответствующие имена фрагментов кода.
4. Выберите правильный фрагмент кода (или вводите его, пока не будет выбрано имя всего фрагмента).
5. Дважды нажмите клавишу TAB, чтобы вставить фрагмент в позицию курсора.

    ![Начните вводить имя фрагмента](build-restful-apis-with-aspnet-web-api/_static/image29.png "Начните вводить имя фрагмента")

    *Начните вводить имя фрагмента*

    ![Нажмите клавишу TAB, чтобы выбрать выделенный фрагмент.](build-restful-apis-with-aspnet-web-api/_static/image30.png "Нажмите клавишу TAB, чтобы выбрать выделенный фрагмент.")

    *Нажмите клавишу TAB, чтобы выбрать выделенный фрагмент.*

    ![Снова нажмите клавишу TAB, и фрагмент развернется](build-restful-apis-with-aspnet-web-api/_static/image31.png "Снова нажмите клавишу TAB, и фрагмент развернется")

    *Снова нажмите клавишу TAB, и фрагмент развернется*

<a id="CodeSnippetUsingMouse"></a>

<a id="To_add_a_code_snippet_using_the_mouse_C_Visual_Basic_and_XML"></a>
### <a name="to-add-a-code-snippet-using-the-mouse-c-visual-basic-and-xml"></a>Добавление фрагмента кода с помощью мыши (C#, Visual Basic и XML)

1. Щелкните правой кнопкой мыши место, куда нужно вставить фрагмент кода.
2. Выберите **Вставить фрагмент** , за которым следуют **фрагменты кода**.
3. Выберите соответствующий фрагмент из списка, щелкнув его.

    ![Щелкните правой кнопкой мыши место, куда нужно вставить фрагмент кода, и выберите пункт Вставить фрагмент.](build-restful-apis-with-aspnet-web-api/_static/image32.png "Щелкните правой кнопкой мыши место, куда нужно вставить фрагмент кода, и выберите пункт Вставить фрагмент.")

    *Щелкните правой кнопкой мыши место, куда нужно вставить фрагмент кода, и выберите пункт Вставить фрагмент.*

    ![Выберите соответствующий фрагмент из списка, щелкнув его.](build-restful-apis-with-aspnet-web-api/_static/image33.png "Выберите соответствующий фрагмент из списка, щелкнув его.")

    *Выберите соответствующий фрагмент из списка, щелкнув его.*

<a id="AppendixB"></a>

<a id="Appendix_B_Installing_Visual_Studio_Express_2012_for_Web"></a>
## <a name="appendix-b-installing-visual-studio-express-2012-for-web"></a>Приложение б. Установка Visual Studio Express 2012 для Web

Вы можете установить **Microsoft Visual Studio Express 2012 для Web** или другой &quot;Express&quot; версии с помощью **[установщик веб-платформы Майкрософт](https://www.microsoft.com/web/downloads/platform.aspx)** . Следующие инструкции помогут вам выполнить действия, необходимые для установки *Visual Studio Express 2012 для Web* с помощью *установщик веб-платформы Майкрософт*.

1. Перейдите в [[https://go.microsoft.com/?linkid=9810169](https://go.microsoft.com/?linkid=9810169)](https://go.microsoft.com/?linkid=9810169). Кроме того, если у вас уже установлен установщик веб-платформы, вы можете открыть его и найти продукт &quot;<em>Visual Studio Express 2012 для Web с пакетом Azure SDK</em>&quot;.
2. Щелкните **Install Now (установить сейчас**). Если у вас нет **установщика веб-платформы** , вы будете сначала перенаправлены на загрузку и установку.
3. После открытия **установщика веб-платформы** нажмите кнопку **установить** , чтобы начать установку.

    ![Установка Visual Studio Express](build-restful-apis-with-aspnet-web-api/_static/image34.png "Установка Visual Studio Express")

    *Установка Visual Studio Express*
4. Прочитайте все лицензии и условия продуктов и нажмите кнопку " **принять** ", чтобы продолжить.

    ![Принятие условий лицензии](build-restful-apis-with-aspnet-web-api/_static/image35.png)

    *Принятие условий лицензии*
5. Дождитесь завершения процесса загрузки и установки.

    ![Ход установки](build-restful-apis-with-aspnet-web-api/_static/image36.png)

    *Ход установки*
6. После завершения установки нажмите кнопку **Готово**.

    ![Установка завершена](build-restful-apis-with-aspnet-web-api/_static/image37.png)

    *Установка завершена*
7. Нажмите кнопку **выход** , чтобы закрыть установщик веб-платформы.
8. Чтобы открыть Visual Studio Express для Интернета, перейдите на **начальный** экран и начните запись &quot;**VS Express**&quot;, а затем щелкните плитку **VS Express для Web** .

    ![Плитка VS Express для Web](build-restful-apis-with-aspnet-web-api/_static/image38.png)

    *Плитка VS Express для Web*

<a id="AppendixC"></a>

<a id="Appendix_C_Publishing_an_ASPNET_MVC_4_Application_using_Web_Deploy"></a>
## <a name="appendix-c-publishing-an-aspnet-mvc-4-application-using-web-deploy"></a>Приложение в. Публикация приложения ASP.NET MVC 4 с помощью веб-развертывание

В этом приложении показано, как создать новый веб-сайт на портале Azure и опубликовать полученное приложение, выполнив следующие лабораторные занятия, используя возможности публикации веб-развертывание, предоставляемые Azure.

<a id="ApxCTask1"></a>

<a id="Task_1_-_Creating_a_New_Web_Site_from_the_Windows_Azure_Portal"></a>
#### <a name="task-1---creating-a-new-web-site-from-the-azure-portal"></a>Задача 1. Создание нового веб-сайта на портале Azure

1. Перейдите в [портал управления Azure](https://manage.windowsazure.com/) и выполните вход с использованием учетных данных Майкрософт, связанных с подпиской.

    > [!NOTE]
    > С помощью Azure вы можете бесплатно разместить 10 веб-сайтов ASP.NET, а затем масштабировать их по мере роста объема трафика. Вы можете зарегистрироваться [здесь](https://aka.ms/aspnet-hol-azure).

    ![Вход в Windows портал Azure](build-restful-apis-with-aspnet-web-api/_static/image39.png "Вход в Windows портал Azure")

    *Вход на портал*
2. На панели команд щелкните **создать** .

    ![Создание нового веб-сайта](build-restful-apis-with-aspnet-web-api/_static/image40.png "Создание нового веб-сайта")

    *Создание нового веб-сайта*
3. Щелкните **Compute** | **веб-сайт**. Затем выберите пункт **Быстрое создание** . Предоставьте доступный URL-адрес для нового веб-сайта и щелкните **создать веб-сайт**.

    > [!NOTE]
    > Azure — это узел для веб-приложения, работающего в облаке, которое можно контролировать и управлять ими. Параметр Быстрое создание позволяет развернуть завершенное веб-приложение в Azure за пределами портала. Он не включает шаги по настройке базы данных.

    ![Создание нового веб-сайта с помощью быстрого создания](build-restful-apis-with-aspnet-web-api/_static/image41.png "Создание нового веб-сайта с помощью быстрого создания")

    *Создание нового веб-сайта с помощью быстрого создания*
4. Дождитесь создания нового **веб-сайта** .
5. После создания веб-сайта щелкните ссылку в столбце **URL-адрес** . Убедитесь, что новый веб-сайт работает.

    ![Обзор нового веб-сайта](build-restful-apis-with-aspnet-web-api/_static/image42.png "Обзор нового веб-сайта")

    *Обзор нового веб-сайта*

    ![Веб-сайт работает](build-restful-apis-with-aspnet-web-api/_static/image43.png "Веб-сайт работает")

    *Веб-сайт работает*
6. Вернитесь на портал и щелкните имя веб-сайта в столбце **имя** , чтобы отобразить страницы управления.

    ![Открытие страниц управления веб-сайтом](build-restful-apis-with-aspnet-web-api/_static/image44.png "Открытие страниц управления веб-сайтом")

    *Открытие страниц управления веб-сайтом*
7. На странице **панель мониторинга** в разделе **краткий обзор** щелкните ссылку **скачать профиль публикации** .

    > [!NOTE]
    > *Профиль публикации* содержит все сведения, необходимые для публикации веб-приложения в Azure для каждого включенного метода публикации. Профиль публикации содержит URL-адреса, учетные данные пользователей и строки для открытия базы данных, которые необходимы для проверки подлинности и подключения к каждой из конечных точек, соответствующей разрешенному методу публикации. **Microsoft WebMatrix 2**, **Microsoft Visual Studio Express для Web** и **Microsoft Visual Studio 2012** поддерживают чтение профилей публикации для автоматизации настройки этих программ для публикации веб-приложений в Azure.

    ![Скачивание профиля публикации веб-сайта](build-restful-apis-with-aspnet-web-api/_static/image45.png "Скачивание профиля публикации веб-сайта")

    *Скачивание профиля публикации веб-сайта*
8. Скачайте файл профиля публикации в известное расположение. Далее в этом упражнении вы узнаете, как использовать этот файл для публикации веб-приложения в Azure из Visual Studio.

    ![Сохранение файла профиля публикации](build-restful-apis-with-aspnet-web-api/_static/image46.png "Сохранение профиля публикации")

    *Сохранение файла профиля публикации*

<a id="ApxCTask2"></a>

<a id="Task_2_-_Configuring_the_Database_Server"></a>
#### <a name="task-2---configuring-the-database-server"></a>Задача 2. Настройка сервера базы данных

Если приложение использует SQL Server базы данных, потребуется создать сервер базы данных SQL. Если вы хотите развернуть простое приложение, которое не использует SQL Server вы можете пропустить эту задачу.

1. Для хранения базы данных приложения необходим сервер базы данных SQL. Серверы базы данных SQL можно просмотреть в подписке на портале управления Azure в **базах данных sql** | **серверы** | **панели мониторинга сервера**. Если сервер не создан, можно создать его с помощью кнопки **Добавить** на панели команд. Запишите **имя сервера и URL-адрес, имя для входа администратора и пароль**, так как они будут использоваться в следующих задачах. Пока не создавайте базу данных, так как она будет создана на более позднем этапе.

    ![Панель мониторинга сервера базы данных SQL](build-restful-apis-with-aspnet-web-api/_static/image47.png "Панель мониторинга сервера базы данных SQL")

    *Панель мониторинга сервера базы данных SQL*
2. В следующей задаче вы проверите подключение к базе данных из Visual Studio. по этой причине необходимо включить локальный IP-адрес в список **разрешенных IP-адресов**сервера. Для этого нажмите кнопку **настроить**, выберите IP-адрес из **текущего IP-адреса клиента** и вставьте его в текстовые поля **начальный IP-адрес** и **конечный IP** -адрес и нажмите кнопку ![добавить-клиент-IP – адрес-OK-кнопка](build-restful-apis-with-aspnet-web-api/_static/image48.png).

    ![Добавление IP-адреса клиента](build-restful-apis-with-aspnet-web-api/_static/image49.png)

    *Добавление IP-адреса клиента*
3. После добавления **IP-адреса клиента** в список Разрешенные IP-адреса нажмите кнопку **сохранить** , чтобы подтвердить изменения.

    ![Подтверждение изменений](build-restful-apis-with-aspnet-web-api/_static/image50.png)

    *Подтверждение изменений*

<a id="ApxCTask3"></a>

<a id="Task_3_-_Publishing_an_ASPNET_MVC_4_Application_using_Web_Deploy"></a>
#### <a name="task-3---publishing-an-aspnet-mvc-4-application-using-web-deploy"></a>Задача 3. Публикация приложения ASP.NET MVC 4 с помощью веб-развертывание

1. Вернитесь к решению ASP.NET MVC 4. В **Обозреватель решений**щелкните правой кнопкой мыши проект веб-сайта и выберите **опубликовать**.

    ![Публикация приложения](build-restful-apis-with-aspnet-web-api/_static/image51.png "Публикация приложения")

    *Публикация веб-сайта*
2. Импортируйте профиль публикации, сохраненный в первой задаче.

    ![Импорт профиля публикации](build-restful-apis-with-aspnet-web-api/_static/image52.png "Импорт профиля публикации")

    *Импорт профиля публикации*
3. Щелкните **проверить подключение**. После завершения проверки нажмите кнопку **Далее**.

    > [!NOTE]
    > Проверка завершится, когда появится зеленая галочка рядом с кнопкой проверить подключение.

    ![Проверка подключения](build-restful-apis-with-aspnet-web-api/_static/image53.png "Проверка подключения")

    *Проверка подключения*
4. На странице **Параметры** в разделе **базы данных** нажмите кнопку рядом с текстовым полем подключения к базе данных (т. е. **DefaultConnection**).

    ![Конфигурация веб-развертывания](build-restful-apis-with-aspnet-web-api/_static/image54.png "Конфигурация веб-развертывания")

    *Конфигурация веб-развертывания*
5. Настройте подключение к базе данных следующим образом.

   - В поле **имя сервера** введите URL-адрес сервера базы данных SQL с помощью префикса *TCP:* .
   - В окне **имя пользователя** введите имя для входа администратора сервера.
   - В окне **пароль** введите пароль для входа администратора сервера.
   - Введите имя новой базы данных, например: *MVC4SampleDB*.

     ![Настройка строки подключения к целевому объекту](build-restful-apis-with-aspnet-web-api/_static/image55.png "Настройка строки подключения к целевому объекту")

     *Настройка строки подключения к целевому объекту*
6. Нажмите кнопку **ОК**. При появлении запроса на создание базы данных нажмите кнопку **Да**.

    ![Создание базы данных](build-restful-apis-with-aspnet-web-api/_static/image56.png "Создание строки базы данных")

    *Создание базы данных*
7. Строка подключения, которая будет использоваться для подключения к базе данных SQL в Windows Azure, отображается в текстовом поле подключения по умолчанию. Затем нажмите кнопку **Далее**.

    ![Строка подключения, указывающая на базу данных SQL](build-restful-apis-with-aspnet-web-api/_static/image57.png "Строка подключения, указывающая на базу данных SQL")

    *Строка подключения, указывающая на базу данных SQL*
8. На странице **Предварительный просмотр** нажмите кнопку **опубликовать**.

    ![Публикация веб-приложения](build-restful-apis-with-aspnet-web-api/_static/image58.png "Публикация веб-приложения")

    *Публикация веб-приложения*
9. По завершении процесса публикации браузер по умолчанию будет открывать опубликованный веб-сайт.

    ![Приложение, опубликованное в Windows Azure](build-restful-apis-with-aspnet-web-api/_static/image59.png "Приложение, опубликованное в Windows Azure")

    *Приложение Опубликовано в Azure*
