---
uid: web-api/overview/security/external-authentication-services
title: Внешние службы проверки подлинности с помощью веб-API ASP.NET (C#) | Документация Майкрософт
author: rmcmurray
description: Описывает использование внешних служб проверки подлинности в веб-API ASP.NET.
ms.author: riande
ms.date: 01/28/2019
ms.assetid: 3bb8eb15-b518-44f5-a67d-a27e051aedc6
msc.legacyurl: /web-api/overview/security/external-authentication-services
msc.type: authoredcontent
ms.openlocfilehash: b2571552a3f8040ff42bfa0a9fa48981f71a1e4b
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2019
ms.locfileid: "65133572"
---
# <a name="external-authentication-services-with-aspnet-web-api-c"></a>Внешние службы проверки подлинности с помощью веб-API ASP.NET (C#)

Visual Studio 2017 и ASP.NET 4.7.2 разверните параметры безопасности для [одностраничных приложений](../../../single-page-application/index.md) (SPA) и [веб-API](../../index.md) службы для интеграции с внешними службами аутентификации, которые включают несколько OAuth или OpenID и социальных служб проверки подлинности: Учетные записи Майкрософт, Twitter, Facebook и Google.  

### <a name="in-this-walkthrough"></a>В этом пошаговом руководстве

- [Используя внешние службы проверки подлинности](#USING)
- [Создание примера веб-приложения](#SAMPLE)
- [Включение проверки подлинности Facebook](#FACEBOOK)
- [Включение проверки подлинности Google](#GOOGLE)
- [Включение проверки подлинности Майкрософт](#MICROSOFT)
- [Включение проверки подлинности Twitter](#TWITTER)
- [Дополнительные сведения](#MOREINFO)

    - [Объединение внешние службы проверки подлинности](#COMBINE)
    - [Настройка IIS Express, чтобы использовать полное доменное имя](#FQDN)
    - [Как получить параметры приложения для проверки подлинности Майкрософт](#OBTAIN)
    - [Дополнительно. Отключить регистрацию локального](#DISABLE)

### <a name="prerequisites"></a>Предварительные требования

Чтобы выполнить примеры в этом пошаговом руководстве, необходимо иметь следующее:

- Visual Studio 2017
- Учетная запись разработчика с идентификатором приложения и секретный ключ для одной из следующих служб проверки подлинности социальные сети:

  - Учетные записи Майкрософт ([https://go.microsoft.com/fwlink/?LinkID=144070](https://go.microsoft.com/fwlink/?LinkID=144070))
  - Twitter ([https://dev.twitter.com/](https://dev.twitter.com/))
  - Facebook ([https://developers.facebook.com/](https://developers.facebook.com/))
  - Google ([https://developers.google.com/](https://developers.google.com))

<a id="USING"></a>
## <a name="using-external-authentication-services"></a>Используя внешние службы проверки подлинности

Огромное количество внешние службы проверки подлинности, доступных для веб-разработчиков Справка для уменьшения разработки время при создании новых веб-приложений. Веб-пользователей обычно имеют несколько существующих учетных записей для популярных веб-служб и социальных веб-сайтов, поэтому при реализованных приложением web, служб проверки подлинности из внешней веб-службы или социальных веб-сайта, она сохраняет время разработки бы потраченных Создание реализацию проверки подлинности. С помощью внешней проверки подлинности службы сохраняет конечных пользователей от необходимости создать другую учетную запись для веб-приложения, а также от необходимости запоминать другого имени пользователя и пароля.

В прошлом, разработчикам приходится учить два варианта: создать свою собственную реализацию проверки подлинности, или узнайте, как интегрировать службу внешней проверки подлинности в свои приложения. На самом базовом уровне, на следующей схеме показана последовательность простого запроса для агента пользователя (веб-браузер), запрашивает сведения из веб-приложения, который настроен для использования службы внешней проверки подлинности:

[![](external-authentication-services/_static/image2.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image1.png)

На предыдущей схеме агент пользователя (или веб-браузер, в этом примере) выполняет запрос к веб-приложения, который перенаправляет веб-браузера в службу внешней проверки подлинности. Агент пользователя отправляет свои учетные данные в службу внешней проверки подлинности, и если агента пользователя успешно прошел проверку подлинности, служба внешней проверки подлинности перенаправляет агента пользователя для исходного веб-приложения с использованием некоторой типа маркера, который агент пользователя отправляет веб-приложения. Веб-приложение будет использовать для убедитесь, что агент пользователя успешно проверена службой внешней проверки подлинности, и веб-приложение может использовать маркер для сбора дополнительной информации об агенте пользователя. После этого приложение обработка информации агента пользователя, веб-приложение будет возвращать ответные действия агента пользователя, основываясь на своих параметрах авторизации.

Во втором примере агент пользователя подключается к веб-приложения и внешнюю авторизацию сервера и веб-приложение выполняет дополнительное взаимодействие с сервером Внешняя авторизация для получения дополнительных сведений о пользователе агент:

[![](external-authentication-services/_static/image4.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image3.png)

Visual Studio 2017 и ASP.NET 4.7.2 упростить интеграцию с внешними службами аутентификации для разработчиков, предоставляя встроенную интеграцию для следующих служб проверки подлинности:

- Facebook
- Google
- Учетные записи Майкрософт (учетные записи Windows Live ID)
- Twitter

В примерах в этом пошаговом руководстве демонстрируется настройка каждого из поддерживаемых внешние службы проверки подлинности с помощью нового шаблона веб-приложение ASP.NET, который поставляется с Visual Studio 2017.

> [!NOTE]
> При необходимости, может потребоваться добавить полное доменное имя в параметрах для внешней проверки подлинности службы. Это требование зависит от ограничений безопасности для некоторых служб внешней проверки подлинности, которые требуют полного доменного ИМЕНИ, в параметрах приложения совпадает с доменным ИМЕНЕМ, который используется клиентами. (Эти действия, существенно изменяется для каждой службы внешней проверки подлинности требуется см. в документации для каждой внешней проверки подлинности службы, чтобы увидеть, если это необходимо и как настроить эти параметры.) Если необходимо настроить IIS Express, чтобы использовать полное доменное имя для этой среды тестирования, см. в разделе [настройки IIS Express, чтобы использовать полное доменное имя](#FQDN) далее в этом пошаговом руководстве.

<a id="SAMPLE"></a>
## <a name="create-a-sample-web-application"></a>Создание примера веб-приложения

Следующие действия, покажут вам по созданию примера приложения с помощью шаблона веб-приложение ASP.NET и будет использовать этот образец приложения для каждой из служб внешней проверки подлинности далее в этом пошаговом руководстве.

Запустите Visual Studio 2017 и выберите **новый проект** с начальной страницы. Или с **файл** меню, выберите **New** и затем **проекта**.

<!-- [![](external-authentication-services/_static/image6.png "Click to Expand the Image")](external-authentication-services/_static/image5.png) -->

Когда **новый проект** отображается диалоговое окно, выберите пункт **установленные** и разверните **Visual C#** . В разделе **Visual C#** выберите **Web**. В списке шаблонов проектов выберите **веб-приложение ASP.NET (.Net Framework)**. Введите имя проекта и нажмите кнопку **ОК**.

[![](external-authentication-services/_static/image71.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image71.png)

Когда **новый проект ASP.NET** — отображается, выберите пункт **одностраничного приложения** шаблона и нажмите кнопку **Создание проекта**.

[![](external-authentication-services/_static/image72.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image72.png)

Ожидания, что и Visual Studio 2017 будет создан проект.

<!-- [![](external-authentication-services/_static/image12.png "Click to Expand the Image")](external-authentication-services/_static/image11.png) -->

После завершения создания проекта Visual Studio 2017 откройте *Startup.Auth.cs* файл, расположенный в **приложения\_запустить** папки.

При создании проекта, ни один из внешние службы проверки подлинности включены в *Startup.Auth.cs* файл; ниже показано, что ваш код может иметь вид, с выделенными для where разделами разрешения Служба внешней проверки подлинности и любые актуальные параметры для использования проверки подлинности учетных записей Майкрософт, Twitter, Google или Facebook в приложении ASP.NET:

[!code-csharp[Main](external-authentication-services/samples/sample1.cs)]

При нажатии клавиши F5 для сборки и отладки веб-приложения, он будет отображаться экран входа, где вы увидите, что внешние службы аутентификации не были определены.

[![](external-authentication-services/_static/image73.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image73.png)

В следующих разделах вы узнаете, как включить каждой внешней проверки подлинности службы, входящие в состав ASP.NET в Visual Studio 2017.

<a id="FACEBOOK"></a>
## <a name="enabling-facebook-authentication"></a>Включение проверки подлинности Facebook

С помощью Facebook проверки подлинности, необходимо создать учетную запись разработчика Facebook и проекта потребуется идентификатор приложения и секретный ключ от Facebook для функционирования. Сведения о создании учетной записи разработчика Facebook и получение идентификатора приложения и секретный ключ, см. в разделе [ https://go.microsoft.com/fwlink/?LinkID=252166 ](https://go.microsoft.com/fwlink/?LinkID=252166).

Получив идентификатор приложения и секретный ключ, выполните следующие действия для включения проверки подлинности Facebook для веб-приложения.

1. Когда проект открыт в Visual Studio 2017, откройте *Startup.Auth.cs* файла.

2. Найдите в разделе проверки подлинности Facebook кода:

    [!code-csharp[Main](external-authentication-services/samples/sample2.cs)]
3. Удалить &quot; // &quot; символов Раскомментировать выделенные строки кода, а затем добавить идентификатор приложения и секретный ключ. После добавления этих параметров, можно перекомпилировать проекта:

    [!code-csharp[Main](external-authentication-services/samples/sample3.cs)]
4. При нажатии клавиши F5, чтобы открыть веб-приложения в веб-браузере, вы увидите, что Facebook был определен как службу внешней проверки подлинности:

    [![](external-authentication-services/_static/image74.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image74.png)
5. При нажатии кнопки **Facebook** кнопки, ваш браузер будет переадресован к странице входа Facebook:

    [![](external-authentication-services/_static/image22.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image21.png)
6. После ввода учетных данных Facebook и нажмите кнопку **войдите в**, веб-браузере перейдете обратно на веб-приложения, который будет предложено ввести **имя пользователя** , необходимо связать с вашей Учетная запись Facebook:

    [![](external-authentication-services/_static/image24.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image23.png)
7. После ввода имени пользователя и щелчке **зарегистрироваться** кнопку, веб-приложения будет отображаться по умолчанию **Домашняя страница** для вашей учетной записи Facebook:

    [![](external-authentication-services/_static/image26.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image25.png)

<a id="GOOGLE"></a>
## <a name="enabling-google-authentication"></a>Включение проверки подлинности Google

С помощью Google проверки подлинности, необходимо создать учетную запись разработчика Google и проекта потребуется идентификатор приложения и секретный ключ из Google для функционирования. Сведения о создании учетной записи разработчика Google и получение идентификатора приложения и секретный ключ, см. в разделе [ https://developers.google.com ](https://developers.google.com).

Чтобы включить проверку подлинности Google для веб-приложения, используйте следующие действия:

1. Когда проект открыт в Visual Studio 2017, откройте *Startup.Auth.cs* файла.

2. Найдите в разделе проверки подлинности Google кода:

    [!code-csharp[Main](external-authentication-services/samples/sample4.cs)]
3. Удалить &quot; // &quot; символов Раскомментировать выделенные строки кода, а затем добавить идентификатор приложения и секретный ключ. После добавления этих параметров, можно перекомпилировать проекта:

    [!code-csharp[Main](external-authentication-services/samples/sample5.cs)]
4. При нажатии клавиши F5, чтобы открыть веб-приложения в веб-браузере, вы увидите, что Google был определен как службу внешней проверки подлинности:

    [![](external-authentication-services/_static/image75.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image75.png)
5. При нажатии кнопки **Google** кнопки, ваш браузер будет переадресован к странице входа Google:

    [![](external-authentication-services/_static/image32.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image31.png)
6. После ввода учетных данных Google и нажмите кнопку **вход**, Google предложит убедитесь, что веб-приложение имеет разрешения на доступ к вашей учетной записи Google:

    [![](external-authentication-services/_static/image34.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image33.png)
7. При нажатии кнопки **Accept**, веб-браузере перейдете обратно на веб-приложения, который будет предложено ввести **имя пользователя** , необходимо связать с учетной записью Google:

    [![](external-authentication-services/_static/image36.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image35.png)
8. После ввода имени пользователя и щелчке **зарегистрироваться** кнопку, веб-приложения будет отображаться по умолчанию **Домашняя страница** для вашей учетной записи Google:

    [![](external-authentication-services/_static/image38.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image37.png)

<a id="MICROSOFT"></a>
## <a name="enabling-microsoft-authentication"></a>Включение проверки подлинности Майкрософт

Проверка подлинности Майкрософт, необходимо создать учетную запись разработчика, и требуется идентификатор клиента и секрет клиента для работы. Сведения о создании учетной записи разработчика Майкрософт и получение идентификатора клиента и секрет клиента, см. в разделе [ https://go.microsoft.com/fwlink/?LinkID=144070 ](https://go.microsoft.com/fwlink/?LinkID=144070).

Получив ключ клиента и секрет клиента, выполните следующие действия для включения проверки подлинности Майкрософт для веб-приложения.

1. Когда проект открыт в Visual Studio 2017, откройте *Startup.Auth.cs* файла.

2. Найдите в разделе проверки подлинности Майкрософт кода:

    [!code-csharp[Main](external-authentication-services/samples/sample6.cs)]
3. Удалить &quot; // &quot; символов Раскомментировать выделенные строки кода, а затем добавить идентификатор клиента и секрет клиента. После добавления этих параметров, можно перекомпилировать проекта:

    [!code-csharp[Main](external-authentication-services/samples/sample7.cs)]
4. При нажатии клавиши F5, чтобы открыть веб-приложения в веб-браузере, вы увидите сообщение о том, что Майкрософт был определен как службу внешней проверки подлинности:

    [![](external-authentication-services/_static/image42.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image41.png)
5. При нажатии кнопки **Microsoft** кнопки, ваш браузер будет переадресован к странице входа Майкрософт:

    [![](external-authentication-services/_static/image44.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image43.png)
6. Введите свои учетные данные Microsoft и нажмите кнопку **вход**, вам будет предложено убедитесь, что веб-приложение имеет разрешения на доступ к учетной записи Майкрософт:

    [![](external-authentication-services/_static/image46.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image45.png)
7. При нажатии кнопки **Да**, веб-браузере перейдете обратно на веб-приложения, который будет предложено ввести **имя пользователя** , необходимо связать с учетной записью Майкрософт:

    [![](external-authentication-services/_static/image48.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image47.png)
8. После ввода имени пользователя и щелчке **зарегистрироваться** кнопку, веб-приложения будет отображаться по умолчанию **Домашняя страница** для учетной записи Майкрософт:

    [![](external-authentication-services/_static/image50.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image49.png)

<a id="TWITTER"></a>
## <a name="enabling-twitter-authentication"></a>Включение проверки подлинности Twitter

Twitter, проверка подлинности требует выполнить создание учетной записи разработчика, и ей требуется ключ клиента и секрет клиента для работы. Сведения о создании учетной записи разработчика Twitter и получение ключ клиента и секрет клиента, см. в разделе [ https://go.microsoft.com/fwlink/?LinkID=252166 ](https://go.microsoft.com/fwlink/?LinkID=252166).

Получив ключ клиента и секрет клиента, выполните следующие действия для включения проверки подлинности Twitter для веб-приложения.

1. Когда проект открыт в Visual Studio 2017, откройте *Startup.Auth.cs* файла.

2. Найдите в разделе проверки подлинности Twitter кода:

    [!code-csharp[Main](external-authentication-services/samples/sample8.cs)]
3. Удалить &quot; // &quot; символов Раскомментировать выделенные строки кода, а затем добавьте ключ клиента и секрет клиента. После добавления этих параметров, можно перекомпилировать проекта:

    [!code-csharp[Main](external-authentication-services/samples/sample9.cs)]
4. При нажатии клавиши F5, чтобы открыть веб-приложения в веб-браузере, вы увидите, что Twitter был определен как службу внешней проверки подлинности:

    [![](external-authentication-services/_static/image54.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image53.png)
5. При нажатии кнопки **Twitter** кнопки, ваш браузер будет переадресован к странице входа Twitter:

    [![](external-authentication-services/_static/image56.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image55.png)
6. После ввода учетных данных Twitter и щелкните **Authorize app**, веб-браузере перейдете обратно на веб-приложения, который будет предложено ввести **имя пользователя** , необходимо связать с учетной записи Twitter:

    [![](external-authentication-services/_static/image58.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image57.png)
7. После ввода имени пользователя и щелчке **зарегистрироваться** кнопку, веб-приложения будет отображаться по умолчанию **Домашняя страница** для учетной записи Twitter:

    [![](external-authentication-services/_static/image60.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image59.png)

<a id="MOREINFO"></a>
## <a name="additional-information"></a>Дополнительные сведения

Дополнительные сведения о создании приложений, использующих OAuth и OpenID см. следующие URL-адреса:

- [https://go.microsoft.com/fwlink/?LinkID=252166](https://go.microsoft.com/fwlink/?LinkID=252166)
- [https://go.microsoft.com/fwlink/?LinkID=243995](https://go.microsoft.com/fwlink/?LinkID=243995)

<a id="COMBINE"></a>
### <a name="combining-external-authentication-services"></a>Объединение внешние службы проверки подлинности

Для повышения гибкости в то же время можно определить несколько внешние службы проверки подлинности — пользователи веб-приложения могут использовать учетную запись из каких-либо служб включена внешняя проверка подлинности:

[![](external-authentication-services/_static/image62.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image61.png)

<a id="FQDN"></a>
### <a name="configure-iis-express-to-use-a-fully-qualified-domain-name"></a>Настройка IIS Express, чтобы использовать полное доменное имя

Некоторые поставщики услуг внешней проверки подлинности не поддерживают тестирование приложения с помощью HTTP-адрес как `http://localhost:port/`. Чтобы обойти эту проблему, можно добавить в файл HOSTS статическим сопоставлением полное доменное имя (FQDN) и настроить параметры проекта в Visual Studio 2017, чтобы использовать полное доменное имя для тестирования и отладки. Чтобы сделать это, следуйте инструкциям ниже:

- Добавьте статический полное доменное имя сопоставления в файле HOSTS:

  1. Откройте командную строку с повышенными правами в Windows.
  2. Введите следующую команду:

      <kbd>Блокнот %WinDir%\system32\drivers\etc\hosts</kbd>
  3. Добавьте в файл HOSTS запись следующим образом:

      <kbd>127.0.0.1 www.wingtiptoys.com</kbd>
  4. Сохраните и закройте файл HOSTS.

- Настройка проекта Visual Studio для использования полного доменного ИМЕНИ.

  1. Когда проект открыт в Visual Studio 2017, щелкните **проекта** меню, а затем выберите свойства для проекта. Например, можно выбрать **WebApplication1 свойства**.
  2. Выберите **Web** вкладки.
  3. Введите полное доменное имя для <strong>URL-адрес проекта</strong>. Например, можно ввести <kbd> <http://www.wingtiptoys.com> </kbd> Если это было сопоставление полное доменное имя, которое вы добавили в файл HOSTS.

- Настройте IIS Express, чтобы использовать полное доменное имя для приложения.

    1. Откройте командную строку с повышенными правами в Windows.
    2. Введите следующую команду, чтобы изменить папку IIS Express:

        <kbd>cd /d &quot;%ProgramFiles%\IIS Express&quot;</kbd>
    3. Введите следующую команду, чтобы добавить полное доменное имя для приложения:

        <kbd>appcmd.exe set config-section:system.applicationHost/sites / +&quot;[имя = «WebApplication1»] .bindings. [ протокол = «http», bindingInformation = "*:80:www.wingtiptoys.com"]&quot; /commit:apphost</kbd>

  Где **WebApplication1** имя проекта и **bindingInformation** содержит номер порта, которые вы хотите использовать для тестирования и полного доменного ИМЕНИ.

<a id="OBTAIN"></a>
### <a name="how-to-obtain-your-application-settings-for-microsoft-authentication"></a>Как получить параметры приложения для проверки подлинности Майкрософт

Связывание приложения для Windows Live для проверки подлинности Майкрософт — это простой процесс. Если вы уже не связали приложение для Windows Live, можно использовать следующие действия:

1. Перейдите к [ https://go.microsoft.com/fwlink/?LinkID=144070 ](https://go.microsoft.com/fwlink/?LinkID=144070) и введите имя учетной записи Майкрософт и пароль при появлении запроса, а затем нажмите кнопку **вход**:

   <!--  [![](external-authentication-services/_static/image64.png "Click to Expand the Image")](external-authentication-services/_static/image63.png) -->
2. Выберите **Добавление веб-приложения** и введите имя приложения при появлении запроса и нажмите кнопку **создать**:

    [![](external-authentication-services/_static/image79.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image79.png)
3. Выберите свое приложение в разделе **имя** и откроется его страница свойств приложения.

4. Введите домен перенаправления приложения. Копировать **идентификатор приложения** и в разделе **секретов приложения**выберите **создать пароль**. Скопируйте пароль, который отображается. Идентификатор приложения и пароль, идентификатор клиента и секрет клиента. Выберите **ОК** и затем **Сохранить**.

    [![](external-authentication-services/_static/image77.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image77.png)

<a id="DISABLE"></a>
### <a name="optional-disable-local-registration"></a>Необязательные: Отключить регистрацию локального

Текущим функциональным регистрацию локального ASP.NET не запрещает создание учетных записей; член автоматическими программами (программами-роботами) Например, с помощью технологии защиты от программ-роботов и проверки, как [CAPTCHA](../../../web-pages/overview/security/16-adding-security-and-membership.md). По этой причине следует удалить ссылки формы и регистрации локального входа на странице входа. Чтобы сделать это, откройте  *\_Login.cshtml* странице в проекте, а затем закомментируйте строки для панели локальное имя входа и ссылка для регистрации. Итоговый страница должна выглядеть как в следующем примере кода:

[!code-html[Main](external-authentication-services/samples/sample10.html)]

После отключения панели локальное имя входа и ссылка для регистрации страница входа будут отображаться только внешних поставщиков проверки подлинности, для которых включен:

[![](external-authentication-services/_static/image70.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image69.png)
