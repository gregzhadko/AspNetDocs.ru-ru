---
uid: web-api/overview/security/individual-accounts-in-web-api
title: Защита веб-API с помощью отдельных учетных записей и локального имени входа в ASP.NET Web API 2.2 | Документация Майкрософт
author: MikeWasson
description: В этом разделе показано, как защитить веб-API с использованием OAuth2 для проверки подлинности в базе данных членства. Версии программного обеспечения, используемые в руководстве Visual Studio 201...
ms.author: riande
ms.date: 10/15/2014
ms.assetid: 92c84846-f0ea-4b5e-94b6-5004874eb060
msc.legacyurl: /web-api/overview/security/individual-accounts-in-web-api
msc.type: authoredcontent
ms.openlocfilehash: 7492c4aa4c2a0a8aeed64c3462bda8fc51f35a6b
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2019
ms.locfileid: "65134302"
---
# <a name="secure-a-web-api-with-individual-accounts-and-local-login-in-aspnet-web-api-22"></a><span data-ttu-id="01ef1-104">Защита веб-API с помощью отдельных учетных записей и локального имени входа в ASP.NET Web API 2.2</span><span class="sxs-lookup"><span data-stu-id="01ef1-104">Secure a Web API with Individual Accounts and Local Login in ASP.NET Web API 2.2</span></span>

<span data-ttu-id="01ef1-105">по [Майк Уоссон](https://github.com/MikeWasson)</span><span class="sxs-lookup"><span data-stu-id="01ef1-105">by [Mike Wasson](https://github.com/MikeWasson)</span></span>

[<span data-ttu-id="01ef1-106">Скачайте пример приложения</span><span class="sxs-lookup"><span data-stu-id="01ef1-106">Download Sample App</span></span>](https://github.com/MikeWasson/LocalAccountsApp)

> <span data-ttu-id="01ef1-107">В этом разделе показано, как защитить веб-API с использованием OAuth2 для проверки подлинности в базе данных членства.</span><span class="sxs-lookup"><span data-stu-id="01ef1-107">This topic shows how to secure a web API using OAuth2 to authenticate against a membership database.</span></span>
> 
> ## <a name="software-versions-used-in-the-tutorial"></a><span data-ttu-id="01ef1-108">Версии программного обеспечения, используемые в этом руководстве</span><span class="sxs-lookup"><span data-stu-id="01ef1-108">Software versions used in the tutorial</span></span>
> 
> 
> - [<span data-ttu-id="01ef1-109">Visual Studio 2013 с обновлением 3</span><span class="sxs-lookup"><span data-stu-id="01ef1-109">Visual Studio 2013 Update 3</span></span>](https://www.microsoft.com/visualstudio/eng/2013-downloads)
> - [<span data-ttu-id="01ef1-110">Веб-API 2.2</span><span class="sxs-lookup"><span data-stu-id="01ef1-110">Web API 2.2</span></span>](../releases/whats-new-in-aspnet-web-api-22.md)
> - [<span data-ttu-id="01ef1-111">ASP.NET Identity 2.1</span><span class="sxs-lookup"><span data-stu-id="01ef1-111">ASP.NET Identity 2.1</span></span>](../../../identity/index.md)

<span data-ttu-id="01ef1-112">В Visual Studio 2013 шаблон проекта веб-API предоставляет три варианта проверки подлинности:</span><span class="sxs-lookup"><span data-stu-id="01ef1-112">In Visual Studio 2013, the Web API project template gives you three options for authentication:</span></span>

- <span data-ttu-id="01ef1-113">**Индивидуальные учетные записи.**</span><span class="sxs-lookup"><span data-stu-id="01ef1-113">**Individual accounts.**</span></span> <span data-ttu-id="01ef1-114">Приложение использует базу данных членства.</span><span class="sxs-lookup"><span data-stu-id="01ef1-114">The app uses a membership database.</span></span>
- <span data-ttu-id="01ef1-115">**Учетные записи организации.**</span><span class="sxs-lookup"><span data-stu-id="01ef1-115">**Organizational accounts.**</span></span> <span data-ttu-id="01ef1-116">Вход пользователей с помощью их Azure Active Directory, Office 365 или учетные данные Active Directory на предприятии.</span><span class="sxs-lookup"><span data-stu-id="01ef1-116">Users sign in with their Azure Active Directory, Office 365, or on-premise Active Directory credentials.</span></span>
- <span data-ttu-id="01ef1-117">**Проверка подлинности Windows.**</span><span class="sxs-lookup"><span data-stu-id="01ef1-117">**Windows authentication.**</span></span> <span data-ttu-id="01ef1-118">Этот параметр предназначен для приложений интрасети и использует модуль IIS проверку подлинности Windows.</span><span class="sxs-lookup"><span data-stu-id="01ef1-118">This option is intended for Intranet applications, and uses the Windows Authentication IIS module.</span></span>

<span data-ttu-id="01ef1-119">Дополнительные сведения об этих параметрах см. в разделе [Создание веб-проектов ASP.NET в Visual Studio 2013](../../../visual-studio/overview/2013/creating-web-projects-in-visual-studio.md#auth).</span><span class="sxs-lookup"><span data-stu-id="01ef1-119">For more details about these options, see [Creating ASP.NET Web Projects in Visual Studio 2013](../../../visual-studio/overview/2013/creating-web-projects-in-visual-studio.md#auth).</span></span>

<span data-ttu-id="01ef1-120">Индивидуальные учетные записи предоставляют два способа для пользователя выполнить вход:</span><span class="sxs-lookup"><span data-stu-id="01ef1-120">Individual accounts provide two ways for a user to log in:</span></span>

- <span data-ttu-id="01ef1-121">**Локальное имя входа**.</span><span class="sxs-lookup"><span data-stu-id="01ef1-121">**Local login**.</span></span> <span data-ttu-id="01ef1-122">Пользователь проходит регистрацию на сайте, указав имя пользователя и пароль.</span><span class="sxs-lookup"><span data-stu-id="01ef1-122">The user registers at the site, entering a username and password.</span></span> <span data-ttu-id="01ef1-123">Приложение хранит хэш пароля в базе данных членства.</span><span class="sxs-lookup"><span data-stu-id="01ef1-123">The app stores the password hash in the membership database.</span></span> <span data-ttu-id="01ef1-124">При входе пользователя в систему ASP.NET Identity проверка пароля.</span><span class="sxs-lookup"><span data-stu-id="01ef1-124">When the user logs in, the ASP.NET Identity system verifies the password.</span></span>
- <span data-ttu-id="01ef1-125">**Учетные записи социальных сетей**.</span><span class="sxs-lookup"><span data-stu-id="01ef1-125">**Social login**.</span></span> <span data-ttu-id="01ef1-126">Пользователь выполняет вход с помощью внешней службы, например Microsoft, Google или Facebook.</span><span class="sxs-lookup"><span data-stu-id="01ef1-126">The user signs in with an external service, such as Facebook, Microsoft, or Google.</span></span> <span data-ttu-id="01ef1-127">Приложение по-прежнему создает запись для пользователя в базе данных членства, но не хранит учетные данные.</span><span class="sxs-lookup"><span data-stu-id="01ef1-127">The app still creates an entry for the user in the membership database, but does not store any credentials.</span></span> <span data-ttu-id="01ef1-128">Пользователь проходит проверку подлинности при входе в внешней службы.</span><span class="sxs-lookup"><span data-stu-id="01ef1-128">The user authenticates by signing into the external service.</span></span>

<span data-ttu-id="01ef1-129">В этой статье рассматриваются сценарии локального имени входа.</span><span class="sxs-lookup"><span data-stu-id="01ef1-129">This article looks at the local login scenario.</span></span> <span data-ttu-id="01ef1-130">Для входа на локальных и социальных сетей веб-API использует OAuth2 для проверки подлинности запросов.</span><span class="sxs-lookup"><span data-stu-id="01ef1-130">For both local and social login, Web API uses OAuth2 to authenticate requests.</span></span> <span data-ttu-id="01ef1-131">Тем не менее потоки учетные данные отличаются для локальных и социальных сетей имени входа.</span><span class="sxs-lookup"><span data-stu-id="01ef1-131">However, the credential flows are different for local and social login.</span></span>

<span data-ttu-id="01ef1-132">В этой статье я продемонстрирую простое приложение, которое позволяет пользователю войти в систему и отправить проверенные на подлинность вызовы AJAX в веб-API.</span><span class="sxs-lookup"><span data-stu-id="01ef1-132">In this article, I'll demonstrate a simple app that lets the user log in and send authenticated AJAX calls to a web API.</span></span> <span data-ttu-id="01ef1-133">Можно загрузить образец кода [здесь](https://github.com/MikeWasson/LocalAccountsApp).</span><span class="sxs-lookup"><span data-stu-id="01ef1-133">You can download the sample code [here](https://github.com/MikeWasson/LocalAccountsApp).</span></span> <span data-ttu-id="01ef1-134">Файл readme описывается создание примера с нуля в Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="01ef1-134">The readme describes how to create the sample from scratch in Visual Studio.</span></span>

[![](individual-accounts-in-web-api/_static/image2.png)](individual-accounts-in-web-api/_static/image1.png)

<span data-ttu-id="01ef1-135">Пример приложения использует Knockout.js для привязки данных и jQuery для отправки запросов AJAX.</span><span class="sxs-lookup"><span data-stu-id="01ef1-135">The sample app uses Knockout.js for data-binding and jQuery for sending AJAX requests.</span></span> <span data-ttu-id="01ef1-136">Я уделю вызовы AJAX, поэтому не нужно знать Knockout.js для этой статьи.</span><span class="sxs-lookup"><span data-stu-id="01ef1-136">I'll be focusing on the AJAX calls, so you don't need to know Knockout.js for this article.</span></span>

<span data-ttu-id="01ef1-137">Кроме того я опишу:</span><span class="sxs-lookup"><span data-stu-id="01ef1-137">Along the way, I'll describe:</span></span>

- <span data-ttu-id="01ef1-138">Приложение действия на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="01ef1-138">What the app is doing on the client side.</span></span>
- <span data-ttu-id="01ef1-139">Что происходит на сервере.</span><span class="sxs-lookup"><span data-stu-id="01ef1-139">What's happening on the server.</span></span>
- <span data-ttu-id="01ef1-140">HTTP-трафика в середине.</span><span class="sxs-lookup"><span data-stu-id="01ef1-140">The HTTP traffic in the middle.</span></span>

<span data-ttu-id="01ef1-141">Во-первых необходимо определить термины OAuth2.</span><span class="sxs-lookup"><span data-stu-id="01ef1-141">First, we need to define some OAuth2 terminology.</span></span>

- <span data-ttu-id="01ef1-142">*Ресурс*.</span><span class="sxs-lookup"><span data-stu-id="01ef1-142">*Resource*.</span></span> <span data-ttu-id="01ef1-143">Некоторые часть данных, могут быть защищены.</span><span class="sxs-lookup"><span data-stu-id="01ef1-143">Some piece of data that can be protected.</span></span>
- <span data-ttu-id="01ef1-144">*Сервер ресурсов*.</span><span class="sxs-lookup"><span data-stu-id="01ef1-144">*Resource server*.</span></span> <span data-ttu-id="01ef1-145">Сервер, на котором размещается ресурс.</span><span class="sxs-lookup"><span data-stu-id="01ef1-145">The server that hosts the resource.</span></span>
- <span data-ttu-id="01ef1-146">*Владелец ресурса*.</span><span class="sxs-lookup"><span data-stu-id="01ef1-146">*Resource owner*.</span></span> <span data-ttu-id="01ef1-147">Сущность, можно предоставить разрешение на доступ к ресурсу.</span><span class="sxs-lookup"><span data-stu-id="01ef1-147">The entity that can grant permission to access a resource.</span></span> <span data-ttu-id="01ef1-148">(Обычно пользователя).</span><span class="sxs-lookup"><span data-stu-id="01ef1-148">(Typically the user.)</span></span>
- <span data-ttu-id="01ef1-149">*Клиент*: Приложение, которое хочет получить доступ к ресурсу.</span><span class="sxs-lookup"><span data-stu-id="01ef1-149">*Client*: The app that wants access to the resource.</span></span> <span data-ttu-id="01ef1-150">В этой статье клиентом является веб-браузер.</span><span class="sxs-lookup"><span data-stu-id="01ef1-150">In this article, the client is a web browser.</span></span>
- <span data-ttu-id="01ef1-151">*Маркер доступа*.</span><span class="sxs-lookup"><span data-stu-id="01ef1-151">*Access token*.</span></span> <span data-ttu-id="01ef1-152">Маркер, который предоставляет доступ к ресурсу.</span><span class="sxs-lookup"><span data-stu-id="01ef1-152">A token that grants access to a resource.</span></span>
- <span data-ttu-id="01ef1-153">*Токен носителя*.</span><span class="sxs-lookup"><span data-stu-id="01ef1-153">*Bearer token*.</span></span> <span data-ttu-id="01ef1-154">Определенный тип маркера доступа, со свойством, что любой пользователь может использовать маркер.</span><span class="sxs-lookup"><span data-stu-id="01ef1-154">A particular type of access token, with the property that anyone can use the token.</span></span> <span data-ttu-id="01ef1-155">Другими словами клиент не криптографический ключ или других секрет для использования токена носителя.</span><span class="sxs-lookup"><span data-stu-id="01ef1-155">In other words, a client doesn't need a cryptographic key or other secret to use a bearer token.</span></span> <span data-ttu-id="01ef1-156">По этой причине токены носителя должны использоваться только по протоколу HTTPS и должен иметь относительно короткие сроки действия.</span><span class="sxs-lookup"><span data-stu-id="01ef1-156">For that reason, bearer tokens should only be used over a HTTPS, and should have relatively short expiration times.</span></span>
- <span data-ttu-id="01ef1-157">*Сервер авторизации*.</span><span class="sxs-lookup"><span data-stu-id="01ef1-157">*Authorization server*.</span></span> <span data-ttu-id="01ef1-158">Сервер, который выдает маркеры доступа.</span><span class="sxs-lookup"><span data-stu-id="01ef1-158">A server that gives out access tokens.</span></span>

<span data-ttu-id="01ef1-159">Приложение может действовать как сервер авторизации и сервером ресурсов.</span><span class="sxs-lookup"><span data-stu-id="01ef1-159">An application can act as both authorization server and resource server.</span></span> <span data-ttu-id="01ef1-160">Шаблон проекта веб-API соответствует следующему шаблону.</span><span class="sxs-lookup"><span data-stu-id="01ef1-160">The Web API project template follows this pattern.</span></span>

## <a name="local-login-credential-flow"></a><span data-ttu-id="01ef1-161">Поток учетных данных локального имени входа</span><span class="sxs-lookup"><span data-stu-id="01ef1-161">Local Login Credential Flow</span></span>

<span data-ttu-id="01ef1-162">Для локального имени входа веб-API использует [поток пароль владельца ресурса](http://oauthlib.readthedocs.org/en/latest/oauth2/grants/password.html) определенные в OAuth2.</span><span class="sxs-lookup"><span data-stu-id="01ef1-162">For local login, Web API uses the [resource owner password flow](http://oauthlib.readthedocs.org/en/latest/oauth2/grants/password.html) defined in OAuth2.</span></span>

1. <span data-ttu-id="01ef1-163">Пользователь вводит имя пользователя и пароль в клиент.</span><span class="sxs-lookup"><span data-stu-id="01ef1-163">The user enters a name and password into the client.</span></span>
2. <span data-ttu-id="01ef1-164">Клиент отправляет эти учетные данные серверу авторизации.</span><span class="sxs-lookup"><span data-stu-id="01ef1-164">The client sends these credentials to the authorization server.</span></span>
3. <span data-ttu-id="01ef1-165">Сервер авторизации проверяет подлинность учетных данных и возвращает маркер доступа.</span><span class="sxs-lookup"><span data-stu-id="01ef1-165">The authorization server authenticates the credentials and returns an access token.</span></span>
4. <span data-ttu-id="01ef1-166">Чтобы получить доступ к защищенному ресурсу, клиент включает маркер доступа в заголовок авторизации HTTP-запроса.</span><span class="sxs-lookup"><span data-stu-id="01ef1-166">To access a protected resource, the client includes the access token in the Authorization header of the HTTP request.</span></span>

![](individual-accounts-in-web-api/_static/image3.png)

<span data-ttu-id="01ef1-167">При выборе **отдельным учетным записям** в шаблоне проекта веб-API, проект включает сервер авторизации, который проверяет учетные данные пользователя и выдает маркеры.</span><span class="sxs-lookup"><span data-stu-id="01ef1-167">When you select **Individual accounts** in the Web API project template, the project includes an authorization server that validates user credentials and issues tokens.</span></span> <span data-ttu-id="01ef1-168">В примере ниже показан же поток учетных данных с точки зрения компоненты веб-API.</span><span class="sxs-lookup"><span data-stu-id="01ef1-168">The following diagram shows the same credential flow in terms of Web API components.</span></span>

![](individual-accounts-in-web-api/_static/image4.png)

<span data-ttu-id="01ef1-169">В этом случае контроллеров веб-API в качестве серверов ресурсов.</span><span class="sxs-lookup"><span data-stu-id="01ef1-169">In this scenario, Web API controllers act as resource servers.</span></span> <span data-ttu-id="01ef1-170">Фильтр проверки подлинности проверяет маркеры доступа и **[Authorize]** атрибут используется для защиты ресурса.</span><span class="sxs-lookup"><span data-stu-id="01ef1-170">An authentication filter validates access tokens, and the **[Authorize]** attribute is used to protect a resource.</span></span> <span data-ttu-id="01ef1-171">Если контроллер или действие имеет **[Authorize]** атрибута, все запросы в этот контроллер или действие должен пройти проверку подлинности.</span><span class="sxs-lookup"><span data-stu-id="01ef1-171">When a controller or action has the **[Authorize]** attribute, all requests to that controller or action must be authenticated.</span></span> <span data-ttu-id="01ef1-172">В противном случае авторизации отказано, и веб-API возвращает ошибку 401 (неавторизованный).</span><span class="sxs-lookup"><span data-stu-id="01ef1-172">Otherwise, authorization is denied, and Web API returns a 401 (Unauthorized) error.</span></span>

<span data-ttu-id="01ef1-173">Сервер авторизации и фильтр проверки подлинности, оба вызова [по промежуточного слоя OWIN](../../../aspnet/overview/owin-and-katana/an-overview-of-project-katana.md) компонент, который обрабатывает сведения о OAuth2.</span><span class="sxs-lookup"><span data-stu-id="01ef1-173">The authorization server and the authentication filter both call into an [OWIN middleware](../../../aspnet/overview/owin-and-katana/an-overview-of-project-katana.md) component that handles the details of OAuth2.</span></span> <span data-ttu-id="01ef1-174">Я опишу разработки более подробно далее в этом руководстве.</span><span class="sxs-lookup"><span data-stu-id="01ef1-174">I'll describe the design in more detail later in this tutorial.</span></span>

## <a name="sending-an-unauthorized-request"></a><span data-ttu-id="01ef1-175">Отправка неавторизованный запрос</span><span class="sxs-lookup"><span data-stu-id="01ef1-175">Sending an Unauthorized Request</span></span>

<span data-ttu-id="01ef1-176">Чтобы начать работу, запустите приложение и нажмите кнопку **вызова API** кнопки.</span><span class="sxs-lookup"><span data-stu-id="01ef1-176">To get started, run the app and click the **Call API** button.</span></span> <span data-ttu-id="01ef1-177">По завершении запроса вы увидите сообщение об ошибке в **результат** поле.</span><span class="sxs-lookup"><span data-stu-id="01ef1-177">When the request completes, you should see an error message in the **Result** box.</span></span> <span data-ttu-id="01ef1-178">Том, что запрос не содержит маркер доступа, поэтому запрос не авторизован.</span><span class="sxs-lookup"><span data-stu-id="01ef1-178">That's because the request does not contain an access token, so the request is unauthorized.</span></span>

[![](individual-accounts-in-web-api/_static/image6.png)](individual-accounts-in-web-api/_static/image5.png)

<span data-ttu-id="01ef1-179">**Вызова API** кнопка отправляет запрос AJAX ~/api/значения, вызывающее действие контроллера веб-API.</span><span class="sxs-lookup"><span data-stu-id="01ef1-179">The **Call API** button sends an AJAX request to ~/api/values, which invokes a Web API controller action.</span></span> <span data-ttu-id="01ef1-180">Ниже представлена часть кода JavaScript, который отправляет запрос AJAX.</span><span class="sxs-lookup"><span data-stu-id="01ef1-180">Here is the section of JavaScript code that sends the AJAX request.</span></span> <span data-ttu-id="01ef1-181">В примере приложения весь код приложения JavaScript находится в файле Scripts\app.js.</span><span class="sxs-lookup"><span data-stu-id="01ef1-181">In the sample app, all of the JavaScript app code is located in the Scripts\app.js file.</span></span>

[!code-javascript[Main](individual-accounts-in-web-api/samples/sample1.js)]

<span data-ttu-id="01ef1-182">До входа пользователя отсутствует токен носителя не и поэтому не заголовок авторизации в запросе.</span><span class="sxs-lookup"><span data-stu-id="01ef1-182">Until the user logs in, there is no bearer token, and therefore no Authorization header in the request.</span></span> <span data-ttu-id="01ef1-183">В результате запрос о получении сообщение об ошибке 401.</span><span class="sxs-lookup"><span data-stu-id="01ef1-183">This causes the request to return a 401 error.</span></span>

<span data-ttu-id="01ef1-184">Ниже приведен HTTP-запроса.</span><span class="sxs-lookup"><span data-stu-id="01ef1-184">Here is the HTTP request.</span></span> <span data-ttu-id="01ef1-185">(Я использовал [Fiddler](http://www.telerik.com/fiddler) для записи трафика HTTP.)</span><span class="sxs-lookup"><span data-stu-id="01ef1-185">(I used [Fiddler](http://www.telerik.com/fiddler) to capture the HTTP traffic.)</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample2.cmd)]

<span data-ttu-id="01ef1-186">HTTP-ответа:</span><span class="sxs-lookup"><span data-stu-id="01ef1-186">HTTP response:</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample3.cmd?highlight=1,4)]

<span data-ttu-id="01ef1-187">Обратите внимание на то, что ответ содержит заголовок Www-Authenticate с запросом, значение носителя.</span><span class="sxs-lookup"><span data-stu-id="01ef1-187">Notice that the response includes a Www-Authenticate header with the challenge set to Bearer.</span></span> <span data-ttu-id="01ef1-188">Это указывает, что сервер должен находиться токен носителя.</span><span class="sxs-lookup"><span data-stu-id="01ef1-188">That indicates the server expects a bearer token.</span></span>

## <a name="register-a-user"></a><span data-ttu-id="01ef1-189">Регистрация пользователя</span><span class="sxs-lookup"><span data-stu-id="01ef1-189">Register a User</span></span>

<span data-ttu-id="01ef1-190">В **зарегистрировать** раздела приложения, введите адрес электронной почты и пароль учетной записи и нажмите кнопку **зарегистрировать** кнопки.</span><span class="sxs-lookup"><span data-stu-id="01ef1-190">In the **Register** section of the app, enter an email and password, and click the **Register** button.</span></span>

<span data-ttu-id="01ef1-191">Не нужно использовать допустимый адрес электронной почты для этого примера, но реальное приложение будет подтвердить адрес.</span><span class="sxs-lookup"><span data-stu-id="01ef1-191">You don't need to use a valid email address for this sample, but a real app would confirm the address.</span></span> <span data-ttu-id="01ef1-192">(См. в разделе [создать безопасное веб-приложение ASP.NET MVC 5 со входом, по электронной почте подтверждение и сброс пароля](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md).) Пароль Используйте нечто вроде «Пароль1!», с буквой в верхнем регистре, буквы нижнего регистра, номер и отличные от алфавитно цифровой символ.</span><span class="sxs-lookup"><span data-stu-id="01ef1-192">(See [Create a secure ASP.NET MVC 5 web app with log in, email confirmation and password reset](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md).) For the password, use something like "Password1!", with an upper case letter, lower case letter, number, and non-alpha-numeric character.</span></span> <span data-ttu-id="01ef1-193">Чтобы не усложнять приложение, я оставил out проверки на стороне клиента, поэтому если имеется проблема с формат пароля, вы получите ошибку 400 (неправильный запрос).</span><span class="sxs-lookup"><span data-stu-id="01ef1-193">To keep the app simple, I left out client-side validation, so if there is a problem with the password format, you'll get a 400 (Bad Request) error.</span></span>

[![](individual-accounts-in-web-api/_static/image8.png)](individual-accounts-in-web-api/_static/image7.png)

<span data-ttu-id="01ef1-194">**Зарегистрировать** кнопка отправляет запрос POST к ~/api/Account/Register /.</span><span class="sxs-lookup"><span data-stu-id="01ef1-194">The **Register** button sends a POST request to ~/api/Account/Register/.</span></span> <span data-ttu-id="01ef1-195">Тело запроса представляет собой объект JSON, который содержит имя и пароль.</span><span class="sxs-lookup"><span data-stu-id="01ef1-195">The request body is a JSON object that holds the name and password.</span></span> <span data-ttu-id="01ef1-196">Ниже приведен код JavaScript, который отправляет запрос:</span><span class="sxs-lookup"><span data-stu-id="01ef1-196">Here is the JavaScript code that sends the request:</span></span>

[!code-javascript[Main](individual-accounts-in-web-api/samples/sample4.js)]

<span data-ttu-id="01ef1-197">HTTP-запроса:</span><span class="sxs-lookup"><span data-stu-id="01ef1-197">HTTP request:</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample5.cmd?highlight=5,10)]

<span data-ttu-id="01ef1-198">HTTP-ответа:</span><span class="sxs-lookup"><span data-stu-id="01ef1-198">HTTP response:</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample6.cmd)]

<span data-ttu-id="01ef1-199">Этот запрос обрабатывается `AccountController` класса.</span><span class="sxs-lookup"><span data-stu-id="01ef1-199">This request is handled by the `AccountController` class.</span></span> <span data-ttu-id="01ef1-200">На внутреннем уровне `AccountController` использует для управления базой данных членства ASP.NET Identity.</span><span class="sxs-lookup"><span data-stu-id="01ef1-200">Internally, `AccountController` uses ASP.NET Identity to manage the membership database.</span></span>

<span data-ttu-id="01ef1-201">Если вы запустите приложение локально из Visual Studio, учетные записи пользователей хранятся в LocalDB, в таблице AspNetUsers.</span><span class="sxs-lookup"><span data-stu-id="01ef1-201">If you run the app locally from Visual Studio, user accounts are stored in LocalDB, in the AspNetUsers table.</span></span> <span data-ttu-id="01ef1-202">Чтобы просмотреть таблицы в Visual Studio, нажмите кнопку **представление** меню, выберите **обозревателя серверов**, затем разверните **подключения к данным**.</span><span class="sxs-lookup"><span data-stu-id="01ef1-202">To view the tables in Visual Studio, click the **View** menu, select **Server Explorer**, then expand **Data Connections**.</span></span>

![](individual-accounts-in-web-api/_static/image9.png)

## <a name="get-an-access-token"></a><span data-ttu-id="01ef1-203">Получение токена доступа</span><span class="sxs-lookup"><span data-stu-id="01ef1-203">Get an Access Token</span></span>

<span data-ttu-id="01ef1-204">Пока мы еще не все OAuth, но сейчас мы увидим сервер авторизации OAuth в действии, при запросе маркера доступа.</span><span class="sxs-lookup"><span data-stu-id="01ef1-204">So far we have not done any OAuth, but now we'll see the OAuth authorization server in action, when we request an access token.</span></span> <span data-ttu-id="01ef1-205">В **вход** примера приложения, введите адрес электронной почты и пароль и нажмите кнопку **вход**.</span><span class="sxs-lookup"><span data-stu-id="01ef1-205">In the **Log In** area of the sample app, enter the email and password and click **Log In**.</span></span>

[![](individual-accounts-in-web-api/_static/image11.png)](individual-accounts-in-web-api/_static/image10.png)

<span data-ttu-id="01ef1-206">**Вход** кнопка отправляет запрос в конечную точку маркера.</span><span class="sxs-lookup"><span data-stu-id="01ef1-206">The **Log In** button sends a request to the token endpoint.</span></span> <span data-ttu-id="01ef1-207">Текст запроса содержит следующие данные формы url кодированием.</span><span class="sxs-lookup"><span data-stu-id="01ef1-207">The body of the request contains the following form-url-encoded data:</span></span>

- <span data-ttu-id="01ef1-208">Предоставьте\_типа: «пароль»</span><span class="sxs-lookup"><span data-stu-id="01ef1-208">grant\_type: "password"</span></span>
- <span data-ttu-id="01ef1-209">имя пользователя: &lt;электронной почты пользователя&gt;</span><span class="sxs-lookup"><span data-stu-id="01ef1-209">username: &lt;the user's email&gt;</span></span>
- <span data-ttu-id="01ef1-210">Пароль: &lt;пароль&gt;</span><span class="sxs-lookup"><span data-stu-id="01ef1-210">password: &lt;password&gt;</span></span>

<span data-ttu-id="01ef1-211">Ниже приведен код JavaScript, который отправляет запрос AJAX:</span><span class="sxs-lookup"><span data-stu-id="01ef1-211">Here is the JavaScript code that sends the AJAX request:</span></span>

[!code-javascript[Main](individual-accounts-in-web-api/samples/sample7.js?highlight=14)]

<span data-ttu-id="01ef1-212">Если запрос выполнен успешно, сервер авторизации возвращает маркер доступа в тексте ответа.</span><span class="sxs-lookup"><span data-stu-id="01ef1-212">If the request succeeds, the authorization server returns an access token in the response body.</span></span> <span data-ttu-id="01ef1-213">Обратите внимание на то, что мы сохраняем маркер в хранилище сеанса, для последующего использования при отправке запросов к API.</span><span class="sxs-lookup"><span data-stu-id="01ef1-213">Notice that we store the token in session storage, to use later when sending requests to the API.</span></span> <span data-ttu-id="01ef1-214">В отличие от некоторых форм проверки подлинности (например, проверка подлинности на основе файлов cookie) браузер не будет содержать автоматически маркер доступа в последующих запросах.</span><span class="sxs-lookup"><span data-stu-id="01ef1-214">Unlike some forms of authentication (such as cookie-based authentication), the browser will not automatically include the access token in subsequent requests.</span></span> <span data-ttu-id="01ef1-215">Приложение необходимо делать это явным образом.</span><span class="sxs-lookup"><span data-stu-id="01ef1-215">The application must do so explicitly.</span></span> <span data-ttu-id="01ef1-216">Это удобно, так как она ограничивает [уязвимости CSRF](preventing-cross-site-request-forgery-csrf-attacks.md).</span><span class="sxs-lookup"><span data-stu-id="01ef1-216">That's a good thing, because it limits [CSRF vulnerabilities](preventing-cross-site-request-forgery-csrf-attacks.md).</span></span>

<span data-ttu-id="01ef1-217">HTTP-запроса:</span><span class="sxs-lookup"><span data-stu-id="01ef1-217">HTTP request:</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample8.cmd?highlight=5,10)]

<span data-ttu-id="01ef1-218">Вы увидите, что запрос содержит учетные данные пользователя.</span><span class="sxs-lookup"><span data-stu-id="01ef1-218">You can see that the request contains the user's credentials.</span></span> <span data-ttu-id="01ef1-219">Вы *необходимо* использования протокола HTTPS для обеспечения безопасности транспортного уровня.</span><span class="sxs-lookup"><span data-stu-id="01ef1-219">You *must* use HTTPS to provide transport layer security.</span></span>

<span data-ttu-id="01ef1-220">HTTP-ответа:</span><span class="sxs-lookup"><span data-stu-id="01ef1-220">HTTP response:</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample9.cmd?highlight=8)]

<span data-ttu-id="01ef1-221">Для удобства чтения с отступом JSON и усечен маркер доступа, который является довольно длинными.</span><span class="sxs-lookup"><span data-stu-id="01ef1-221">For readability, I indented the JSON and truncated the access token, which is a quite long.</span></span>

<span data-ttu-id="01ef1-222">`access_token`, `token_type`, И `expires_in` свойства, определенные в спецификации OAuth2. Другие свойства (`userName`, `.issued`, и `.expires`) предназначены только для ознакомительных целей.</span><span class="sxs-lookup"><span data-stu-id="01ef1-222">The `access_token`, `token_type`, and `expires_in` properties are defined by the OAuth2 spec. The other properties (`userName`, `.issued`, and `.expires`) are just for informational purposes.</span></span> <span data-ttu-id="01ef1-223">Можно найти код, который добавляет эти дополнительные свойства в `TokenEndpoint` метод в файле /Providers/ApplicationOAuthProvider.cs.</span><span class="sxs-lookup"><span data-stu-id="01ef1-223">You can find the code that adds those additional properties in the `TokenEndpoint` method, in the /Providers/ApplicationOAuthProvider.cs file.</span></span>

## <a name="send-an-authenticated-request"></a><span data-ttu-id="01ef1-224">Отправить запрос с проверкой подлинности</span><span class="sxs-lookup"><span data-stu-id="01ef1-224">Send an Authenticated Request</span></span>

<span data-ttu-id="01ef1-225">Теперь, когда у нас есть токен носителя, мы можем сделать запрос с проверкой подлинности к API.</span><span class="sxs-lookup"><span data-stu-id="01ef1-225">Now that we have a bearer token, we can make an authenticated request to the API.</span></span> <span data-ttu-id="01ef1-226">Это делается, задав для заголовка авторизации в запросе.</span><span class="sxs-lookup"><span data-stu-id="01ef1-226">This is done by setting the Authorization header in the request.</span></span> <span data-ttu-id="01ef1-227">Нажмите кнопку **вызова API** кнопку еще раз, чтобы увидеть это.</span><span class="sxs-lookup"><span data-stu-id="01ef1-227">Click the **Call API** button again to see this.</span></span>

[![](individual-accounts-in-web-api/_static/image13.png)](individual-accounts-in-web-api/_static/image12.png)

<span data-ttu-id="01ef1-228">HTTP-запроса:</span><span class="sxs-lookup"><span data-stu-id="01ef1-228">HTTP request:</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample10.cmd?highlight=5)]

<span data-ttu-id="01ef1-229">HTTP-ответа:</span><span class="sxs-lookup"><span data-stu-id="01ef1-229">HTTP response:</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample11.cmd)]

## <a name="log-out"></a><span data-ttu-id="01ef1-230">Выход</span><span class="sxs-lookup"><span data-stu-id="01ef1-230">Log Out</span></span>

<span data-ttu-id="01ef1-231">Поскольку обозреватель не кэширует учетные данные или маркер доступа, то при выходе достаточно просто «забыть» токен, удалив его из хранилища сеанса:</span><span class="sxs-lookup"><span data-stu-id="01ef1-231">Because the browser does not cache the credentials or the access token, logging out is simply a matter of "forgetting" the token, by removing it from session storage:</span></span>

[!code-javascript[Main](individual-accounts-in-web-api/samples/sample12.js)]

## <a name="understanding-the-individual-accounts-project-template"></a><span data-ttu-id="01ef1-232">Основные сведения о шаблоне проекта отдельных учетных записей</span><span class="sxs-lookup"><span data-stu-id="01ef1-232">Understanding the Individual Accounts Project Template</span></span>

<span data-ttu-id="01ef1-233">При выборе **отдельным учетным записям** в шаблоне проекта веб-приложения ASP.NET, проект включает:</span><span class="sxs-lookup"><span data-stu-id="01ef1-233">When you select **Individual Accounts** in the ASP.NET Web Application project template, the project includes:</span></span>

- <span data-ttu-id="01ef1-234">Сервер авторизации OAuth2.</span><span class="sxs-lookup"><span data-stu-id="01ef1-234">An OAuth2 authorization server.</span></span>
- <span data-ttu-id="01ef1-235">Конечную точку веб-API управления учетными записями пользователей</span><span class="sxs-lookup"><span data-stu-id="01ef1-235">A Web API endpoint for managing user accounts</span></span>
- <span data-ttu-id="01ef1-236">Модель EF для хранения учетных записей пользователей.</span><span class="sxs-lookup"><span data-stu-id="01ef1-236">An EF model for storing user accounts.</span></span>

<span data-ttu-id="01ef1-237">Ниже приведены классы основного приложения, реализующие эти функции.</span><span class="sxs-lookup"><span data-stu-id="01ef1-237">Here are the main application classes that implement these features:</span></span>

- <span data-ttu-id="01ef1-238">`AccountController`.</span><span class="sxs-lookup"><span data-stu-id="01ef1-238">`AccountController`.</span></span> <span data-ttu-id="01ef1-239">Предоставляет конечную точку веб-API управления учетными записями пользователей.</span><span class="sxs-lookup"><span data-stu-id="01ef1-239">Provides a Web API endpoint for managing user accounts.</span></span> <span data-ttu-id="01ef1-240">`Register` Действие — единственный, который мы использовали в этом руководстве.</span><span class="sxs-lookup"><span data-stu-id="01ef1-240">The `Register` action is the only one that we used in this tutorial.</span></span> <span data-ttu-id="01ef1-241">Другие методы в классе поддерживает сброс пароля, социальные сети и другие функциональные возможности.</span><span class="sxs-lookup"><span data-stu-id="01ef1-241">Other methods on the class support password reset, social logins, and other functionality.</span></span>
- <span data-ttu-id="01ef1-242">`ApplicationUser`, определенный в /Models/IdentityModels.cs.</span><span class="sxs-lookup"><span data-stu-id="01ef1-242">`ApplicationUser`, defined in /Models/IdentityModels.cs.</span></span> <span data-ttu-id="01ef1-243">Этот класс является модель EF для учетных записей пользователей в базе данных членства.</span><span class="sxs-lookup"><span data-stu-id="01ef1-243">This class is the EF model for user accounts in the membership database.</span></span>
- <span data-ttu-id="01ef1-244">`ApplicationUserManager`, определенный в/App\_Start/IdentityConfig.cs, этот класс является производным от [UserManager](https://msdn.microsoft.com/library/dn613290.aspx) автоматически сохраняется и выполняет операции для учетных записей пользователей, таких как создание нового пользователя, проверка того, пароли и т. д. изменения в базе данных.</span><span class="sxs-lookup"><span data-stu-id="01ef1-244">`ApplicationUserManager`, defined in /App\_Start/IdentityConfig.cs This class derives from [UserManager](https://msdn.microsoft.com/library/dn613290.aspx) and performs operations on user accounts, such as creating a new user, verifying passwords, and so forth, and automatically persists changes to the database.</span></span>
- <span data-ttu-id="01ef1-245">`ApplicationOAuthProvider`.</span><span class="sxs-lookup"><span data-stu-id="01ef1-245">`ApplicationOAuthProvider`.</span></span> <span data-ttu-id="01ef1-246">Этот объект подключается по промежуточного слоя OWIN и обрабатывает события, вызываемые по промежуточного слоя.</span><span class="sxs-lookup"><span data-stu-id="01ef1-246">This object plugs into the OWIN middleware, and processes events raised by the middleware.</span></span> <span data-ttu-id="01ef1-247">Он является производным от [OAuthAuthorizationServerProvider](https://msdn.microsoft.com/library/microsoft.owin.security.oauth.oauthauthorizationserverprovider.aspx).</span><span class="sxs-lookup"><span data-stu-id="01ef1-247">It derives from [OAuthAuthorizationServerProvider](https://msdn.microsoft.com/library/microsoft.owin.security.oauth.oauthauthorizationserverprovider.aspx).</span></span>

![](individual-accounts-in-web-api/_static/image14.png)

### <a name="configuring-the-authorization-server"></a><span data-ttu-id="01ef1-248">Настройка сервера авторизации</span><span class="sxs-lookup"><span data-stu-id="01ef1-248">Configuring the Authorization Server</span></span>

<span data-ttu-id="01ef1-249">В StartupAuth.cs приведенный ниже код настраивает сервер авторизации OAuth2.</span><span class="sxs-lookup"><span data-stu-id="01ef1-249">In StartupAuth.cs, the following code configures the OAuth2 authorization server.</span></span>

[!code-csharp[Main](individual-accounts-in-web-api/samples/sample13.cs)]

<span data-ttu-id="01ef1-250">`TokenEndpointPath` Свойство является URL-адрес конечной точки сервера авторизации.</span><span class="sxs-lookup"><span data-stu-id="01ef1-250">The `TokenEndpointPath` property is the URL path to the authorization server endpoint.</span></span> <span data-ttu-id="01ef1-251">Это URL-адрес этого приложения использует для получения токенов носителя.</span><span class="sxs-lookup"><span data-stu-id="01ef1-251">That's the URL that app uses to get the bearer tokens.</span></span>

<span data-ttu-id="01ef1-252">`Provider` Свойство указан поставщик, который подключается к по промежуточного слоя OWIN и обрабатывает события, вызываемые по промежуточного слоя.</span><span class="sxs-lookup"><span data-stu-id="01ef1-252">The `Provider` property specifies a provider that plugs into the OWIN middleware, and processes events raised by the middleware.</span></span>

<span data-ttu-id="01ef1-253">Ниже приведен базовый поток, когда приложение хочет получить маркер.</span><span class="sxs-lookup"><span data-stu-id="01ef1-253">Here is the basic flow when the app wants to get a token:</span></span>

1. <span data-ttu-id="01ef1-254">Чтобы получить маркер доступа, приложение отправляет запрос на ~ / Token.</span><span class="sxs-lookup"><span data-stu-id="01ef1-254">To get an access token, the app sends a request to ~/Token.</span></span>
2. <span data-ttu-id="01ef1-255">Вызовы по промежуточного слоя OAuth `GrantResourceOwnerCredentials` на поставщике.</span><span class="sxs-lookup"><span data-stu-id="01ef1-255">The OAuth middleware calls `GrantResourceOwnerCredentials` on the provider.</span></span>
3. <span data-ttu-id="01ef1-256">Поставщик вызывает метод `ApplicationUserManager` для проверки учетных данных и создания удостоверений утверждений.</span><span class="sxs-lookup"><span data-stu-id="01ef1-256">The provider calls the `ApplicationUserManager` to validate the credentials and create a claims identity.</span></span>
4. <span data-ttu-id="01ef1-257">В случае успеха, поставщик создает билет проверки подлинности, который используется для создания токена.</span><span class="sxs-lookup"><span data-stu-id="01ef1-257">If that succeeds, the provider creates an authentication ticket, which is used to generate the token.</span></span>

[![](individual-accounts-in-web-api/_static/image16.png)](individual-accounts-in-web-api/_static/image15.png)

<span data-ttu-id="01ef1-258">По промежуточного слоя OAuth не знает ничего о учетных записях.</span><span class="sxs-lookup"><span data-stu-id="01ef1-258">The OAuth middleware doesn't know anything about the user accounts.</span></span> <span data-ttu-id="01ef1-259">Поставщик обменивается данными между по промежуточного слоя и ASP.NET Identity.</span><span class="sxs-lookup"><span data-stu-id="01ef1-259">The provider communicates between the middleware and ASP.NET Identity.</span></span> <span data-ttu-id="01ef1-260">Дополнительные сведения о реализации сервера авторизации, см. в разделе [сервер авторизации OAuth 2.0 OWIN](../../../aspnet/overview/owin-and-katana/owin-oauth-20-authorization-server.md).</span><span class="sxs-lookup"><span data-stu-id="01ef1-260">For more information about implementing the authorization server, see [OWIN OAuth 2.0 Authorization Server](../../../aspnet/overview/owin-and-katana/owin-oauth-20-authorization-server.md).</span></span>

### <a name="configuring-web-api-to-use-bearer-tokens"></a><span data-ttu-id="01ef1-261">Настройка веб-API используют токены носителя</span><span class="sxs-lookup"><span data-stu-id="01ef1-261">Configuring Web API to use Bearer Tokens</span></span>

<span data-ttu-id="01ef1-262">В `WebApiConfig.Register` метод, следующий код задает проверку подлинности для веб-API конвейера:</span><span class="sxs-lookup"><span data-stu-id="01ef1-262">In the `WebApiConfig.Register` method, the following code sets up authentication for the Web API pipeline:</span></span>

[!code-csharp[Main](individual-accounts-in-web-api/samples/sample14.cs)]

<span data-ttu-id="01ef1-263">**HostAuthenticationFilter** класс включает проверку подлинности, с помощью токенов носителя.</span><span class="sxs-lookup"><span data-stu-id="01ef1-263">The **HostAuthenticationFilter** class enables authentication using bearer tokens.</span></span>

<span data-ttu-id="01ef1-264">**SuppressDefaultHostAuthentication** метод указывает веб-API, чтобы пропустить проверку подлинности, что происходит, прежде чем они достигнут веб-API конвейера, службами IIS или по промежуточного слоя OWIN.</span><span class="sxs-lookup"><span data-stu-id="01ef1-264">The **SuppressDefaultHostAuthentication** method tells Web API to ignore any authentication that happens before the request reaches the Web API pipeline, either by IIS or by OWIN middleware.</span></span> <span data-ttu-id="01ef1-265">Таким образом, мы можно ограничить веб-API для проверки подлинности только с помощью токенов носителя.</span><span class="sxs-lookup"><span data-stu-id="01ef1-265">That way, we can restrict Web API to authenticate only using bearer tokens.</span></span>

> [!NOTE]
> <span data-ttu-id="01ef1-266">В частности MVC, часть приложения может использовать проверку подлинности форм, которые содержат учетные данные в файле cookie.</span><span class="sxs-lookup"><span data-stu-id="01ef1-266">In particular, the MVC portion of your app might use forms authentication, which stores credentials in a cookie.</span></span> <span data-ttu-id="01ef1-267">На основе файлов cookie проверки подлинности требует использования маркеров защиты от подделки, для предотвращения атак CSRF.</span><span class="sxs-lookup"><span data-stu-id="01ef1-267">Cookie-based authentication requires the use of anti-forgery tokens, to prevent CSRF attacks.</span></span> <span data-ttu-id="01ef1-268">Это проблема для веб-API, так как нет способа удобный для веб-API для отправки клиенту маркер защиты от подделки.</span><span class="sxs-lookup"><span data-stu-id="01ef1-268">That's a problem for web APIs, because there is no convenient way for the web API to send the anti-forgery token to the client.</span></span> <span data-ttu-id="01ef1-269">(Дополнительные сведения об этой проблеме см. в разделе [предотвращение атак CSRF, в веб-API](preventing-cross-site-request-forgery-csrf-attacks.md).) Вызов **SuppressDefaultHostAuthentication** гарантирует, что веб-API не является уязвимым для атак CSRF учетные данные, хранящиеся в файлах cookie.</span><span class="sxs-lookup"><span data-stu-id="01ef1-269">(For more background on this issue, see [Preventing CSRF Attacks in Web API](preventing-cross-site-request-forgery-csrf-attacks.md).) Calling **SuppressDefaultHostAuthentication** ensures that Web API is not vulnerable to CSRF attacks from credentials stored in cookies.</span></span>

<span data-ttu-id="01ef1-270">Когда клиент запрашивает защищенному ресурсу, вот что происходит в конвейере веб-API:</span><span class="sxs-lookup"><span data-stu-id="01ef1-270">When the client requests a protected resource, here is what happens in the Web API pipeline:</span></span>

1. <span data-ttu-id="01ef1-271">**HostAuthentication** фильтр вызывает по промежуточного слоя OAuth для проверки токена.</span><span class="sxs-lookup"><span data-stu-id="01ef1-271">The **HostAuthentication** filter calls the OAuth middleware to validate the token.</span></span>
2. <span data-ttu-id="01ef1-272">По промежуточного слоя преобразует токен в удостоверение утверждений.</span><span class="sxs-lookup"><span data-stu-id="01ef1-272">The middleware converts the token into a claims identity.</span></span>
3. <span data-ttu-id="01ef1-273">На этом этапе запрос является *проверку подлинности* , но не *авторизованных*.</span><span class="sxs-lookup"><span data-stu-id="01ef1-273">At this point, the request is *authenticated* but not *authorized*.</span></span>
4. <span data-ttu-id="01ef1-274">Фильтр авторизации проверяет удостоверение утверждений.</span><span class="sxs-lookup"><span data-stu-id="01ef1-274">The authorization filter examines the claims identity.</span></span> <span data-ttu-id="01ef1-275">Если утверждения авторизации пользователей для этого ресурса, запрос авторизуется.</span><span class="sxs-lookup"><span data-stu-id="01ef1-275">If the claims authorize the user for that resource, the request is authorized.</span></span> <span data-ttu-id="01ef1-276">По умолчанию **[Authorize]** атрибут авторизует запрос, который проходит проверку подлинности.</span><span class="sxs-lookup"><span data-stu-id="01ef1-276">By default, the **[Authorize]** attribute will authorize any request that is authenticated.</span></span> <span data-ttu-id="01ef1-277">Тем не менее можно авторизовать роли или другие утверждения.</span><span class="sxs-lookup"><span data-stu-id="01ef1-277">However, you can authorize by role or by other claims.</span></span> <span data-ttu-id="01ef1-278">Дополнительные сведения см. в разделе [проверки подлинности и авторизации в веб-API](authentication-and-authorization-in-aspnet-web-api.md).</span><span class="sxs-lookup"><span data-stu-id="01ef1-278">For more information, see [Authentication and Authorization in Web API](authentication-and-authorization-in-aspnet-web-api.md).</span></span>
5. <span data-ttu-id="01ef1-279">Если предыдущие шаги выполнены успешно, контроллер возвращает защищенному ресурсу.</span><span class="sxs-lookup"><span data-stu-id="01ef1-279">If the previous steps are successful, the controller returns the protected resource.</span></span> <span data-ttu-id="01ef1-280">В противном случае клиент получает ошибку 401 (неавторизованный).</span><span class="sxs-lookup"><span data-stu-id="01ef1-280">Otherwise, the client receives a 401 (Unauthorized) error.</span></span>

[![](individual-accounts-in-web-api/_static/image18.png)](individual-accounts-in-web-api/_static/image17.png)

## <a name="additional-resources"></a><span data-ttu-id="01ef1-281">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="01ef1-281">Additional Resources</span></span>

- [<span data-ttu-id="01ef1-282">ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="01ef1-282">ASP.NET Identity</span></span>](../../../identity/index.md)
- <span data-ttu-id="01ef1-283">[Основные сведения о функции безопасности в шаблоне SPA для версии-Кандидата VS2013](https://blogs.msdn.com/b/webdev/archive/2013/09/20/understanding-security-features-in-spa-template.aspx).</span><span class="sxs-lookup"><span data-stu-id="01ef1-283">[Understanding Security Features in the SPA Template for VS2013 RC](https://blogs.msdn.com/b/webdev/archive/2013/09/20/understanding-security-features-in-spa-template.aspx).</span></span> <span data-ttu-id="01ef1-284">Блог MSDN для учета Hongye Sun.</span><span class="sxs-lookup"><span data-stu-id="01ef1-284">MSDN blog post by Hongye Sun.</span></span>
- <span data-ttu-id="01ef1-285">[Разбор веб-API отдельные учетные записи шаблона — часть 2: Локальные учетные записи](http://leastprivilege.com/2013/11/26/dissecting-the-web-api-individual-accounts-templatepart-2-local-accounts/).</span><span class="sxs-lookup"><span data-stu-id="01ef1-285">[Dissecting the Web API Individual Accounts Template–Part 2: Local Accounts](http://leastprivilege.com/2013/11/26/dissecting-the-web-api-individual-accounts-templatepart-2-local-accounts/).</span></span> <span data-ttu-id="01ef1-286">Запись блога, Доминик Байер.</span><span class="sxs-lookup"><span data-stu-id="01ef1-286">Blog post by Dominick Baier.</span></span>
- <span data-ttu-id="01ef1-287">[Разместить проверку подлинности и веб-API с OWIN](http://brockallen.com/2013/10/27/host-authentication-and-web-api-with-owin-and-active-vs-passive-authentication-middleware/).</span><span class="sxs-lookup"><span data-stu-id="01ef1-287">[Host authentication and Web API with OWIN](http://brockallen.com/2013/10/27/host-authentication-and-web-api-with-owin-and-active-vs-passive-authentication-middleware/).</span></span> <span data-ttu-id="01ef1-288">Подробное объяснение `SuppressDefaultHostAuthentication` и `HostAuthenticationFilter` по Брок Аллен.</span><span class="sxs-lookup"><span data-stu-id="01ef1-288">A good explanation of `SuppressDefaultHostAuthentication` and `HostAuthenticationFilter` by Brock Allen.</span></span>
- <span data-ttu-id="01ef1-289">[Настройка сведения о профиле в ASP.NET Identity в шаблонах Visual STUDIO 2013](https://blogs.msdn.com/b/webdev/archive/2013/10/16/customizing-profile-information-in-asp-net-identity-in-vs-2013-templates.aspx).</span><span class="sxs-lookup"><span data-stu-id="01ef1-289">[Customizing profile information in ASP.NET Identity in VS 2013 templates](https://blogs.msdn.com/b/webdev/archive/2013/10/16/customizing-profile-information-in-asp-net-identity-in-vs-2013-templates.aspx).</span></span> <span data-ttu-id="01ef1-290">В блоге MSDN с Пранавом Растоги.</span><span class="sxs-lookup"><span data-stu-id="01ef1-290">MSDN blog post by Pranav Rastogi.</span></span>
- <span data-ttu-id="01ef1-291">[Для управления жизненным циклом запроса для класса UserManager в ASP.NET Identity](https://blogs.msdn.com/b/webdev/archive/2014/02/12/per-request-lifetime-management-for-usermanager-class-in-asp-net-identity.aspx).</span><span class="sxs-lookup"><span data-stu-id="01ef1-291">[Per request lifetime management for UserManager class in ASP.NET Identity](https://blogs.msdn.com/b/webdev/archive/2014/02/12/per-request-lifetime-management-for-usermanager-class-in-asp-net-identity.aspx).</span></span> <span data-ttu-id="01ef1-292">В блоге MSDN по Suhas Joshi, с которой подробно объясняется `UserManager` класса.</span><span class="sxs-lookup"><span data-stu-id="01ef1-292">MSDN blog post by Suhas Joshi, with a good explanation of the `UserManager` class.</span></span>
