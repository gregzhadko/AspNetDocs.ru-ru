---
uid: web-pages/overview/performance-and-traffic/15-caching-to-improve-the-performance-of-your-website
title: Кэширование данных на сайте веб-страницы ASP.NET (Razor) для повышения производительности | Документация Майкрософт
author: Rick-Anderson
description: Вы можете ускорить веб-сайт, добавив в него хранилище, то есть результаты, которые обычно занимают значительное время для получения или обработки...
ms.author: riande
ms.date: 02/14/2014
ms.assetid: 961e525b-7700-469e-8a68-d7010b6fb68c
msc.legacyurl: /web-pages/overview/performance-and-traffic/15-caching-to-improve-the-performance-of-your-website
msc.type: authoredcontent
ms.openlocfilehash: 01796d3ca699a6af5d9162b22a926551435c2040
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78521160"
---
# <a name="caching-data-in-an-aspnet-web-pages-razor-site-for-better-performance"></a>Кэширование данных на сайте веб-страницы ASP.NET (Razor) для повышения производительности

от [Tom фитзмаккен](https://github.com/tfitzmac)

> В этой статье объясняется, как использовать вспомогательный метод для кэширования данных для повышения производительности на веб-сайте веб-страницы ASP.NET (Razor). Вы можете ускорить веб-сайт, добавив в &#8212; него кэширование &#8212; результатов, которые обычно требуют слишком много времени для получения или обработки и не меняются часто.
> 
> **Что вы узнаете:** 
> 
> - Использование кэширования для повышения скорости реагирования веб-сайта.
> 
> Это функции ASP.NET, представленные в статье:
> 
> - Вспомогательный метод `WebCache`.
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a>Версии программного обеспечения, используемые в этом руководстве
> 
> 
> - Веб-страницы ASP.NET (Razor) 3
>   
> 
> Этот учебник также работает с веб-страницы ASP.NET 2.

Каждый раз, когда кто-то запрашивает страницу с веб-узла, для выполнения этого запроса необходимо выполнить некоторые действия. Для некоторых страниц сервер может выполнять задачи, которые принимают (сравнительное) длительное время, например получение данных из базы данных. Даже если эти задачи не выполняются в абсолютных условиях, если ваш сайт испытывает большой объем трафика, весь ряд отдельных запросов, которые приводят к тому, что веб-сервер выполняет сложную или медленную задачу, может добавить большую часть работы. Это может в конечном итоге повлиять на производительность сайта.

Одним из способов повышения производительности веб-сайта в таких обстоятельствах является кэширование данных. Если сайт получает повторяющиеся запросы для одних и тех же сведений, а сведения не нужно изменять для каждого пользователя и не учитывают время, вместо повторной выборки или пересчета данных можно получить данные один раз, а затем сохранить результаты. В следующий раз, когда поступает запрос на получение этих сведений, вы просто получите его из кэша.

Как правило, данные кэшируются, которые не меняются часто. При помещении сведений в кэш они хранятся в памяти на веб-сервере. Можно указать продолжительность кэширования (в секундах до суток). По истечении периода кэширования сведения автоматически удаляются из кэша.

> [!NOTE]
> Записи в кэше могут быть удалены по причинам, отличным от истечения срока действия. Например, веб-сервер может временно работать с нехваткой памяти, и одним из способов освободить память является создание записей из кэша. Как вы увидите, даже если вы помещаете информацию в кэш, необходимо убедиться, что она все еще там, где это необходимо.

Представьте, что на веб-сайте есть страница, на которой отображается текущая температура и прогноз погоды. Чтобы получить данные такого типа, можно отправить запрос внешней службе. Так как эти сведения не меняются (например, в течение двух часов), а для внешних вызовов требуется время и пропускная способность, это хороший кандидат на кэширование.

## <a name="adding-caching-to-a-page"></a>Добавление кэширования на страницу

ASP.NET включает вспомогательный модуль `WebCache`, который упрощает добавление кэширования на сайт и добавление данных в кэш. В этой процедуре вы создадите страницу, которая кэширует текущее время. Этот пример не является реальным, так как текущее время — это то, что часто меняется, а более сложно вычислить. Однако это хороший способ продемонстрировать кэширование в действии.

1. Добавьте на веб-сайт новую страницу с именем веб_узел *. cshtml* .
2. Добавьте следующий код и разметку на страницу:

    [!code-cshtml[Main](15-caching-to-improve-the-performance-of-your-website/samples/sample1.cshtml)]

    При кэшировании данных вы поместили их в кэш, используя имя, уникальное для веб-сайта. В этом случае вы будете использовать запись кэша с именем `CachedTime`. Это `cacheItemKey` показано в примере кода.

    Сначала код считывает запись кэша `CachedTime`. Если возвращается значение (то есть если запись кэша не имеет значение null), код просто устанавливает значение переменной времени в данные кэша.

    Однако если запись кэша не существует (то есть имеет значение null), код задает значение времени, добавляет его в кэш и устанавливает значение срока действия равным одной минуте. Через одну минуту запись кэша отклоняется. (Значение срока действия по умолчанию для элемента в кэше составляет 20 минут.) Команда `WebCache.Set(cacheItemKey, time, 1, false)` показывает, как добавить значение текущего времени в кэш и установить срок его действия равным 1 минуте. Установка параметра *slidingExpiration* в значение `false` означает, что срок действия не будет продлен каждый раз, когда он запрашивается. Срок его действия истекает через 1 минуту после того, как он был изначально добавлен в кэш. Если задать для этого параметра значение `true` срок действия 1 минута будет сбрасываться каждый раз, когда значение запрашивается из кэша.

    Этот код иллюстрирует шаблон, который всегда следует использовать при кэшировании данных. Прежде чем извлечь что-либо из кэша, всегда следует сначала проверить, вернул ли метод `WebCache.Get` значение null. Помните, что срок действия записи кэша мог быть истек или она могла быть удалена по какой-либо другой причине, поэтому любая заданная запись никогда не будет гарантирована в кэше.
3. Запустите веб- *кэш. cshtml* в браузере. (Перед выполнением страницы убедитесь, что она выбрана в рабочей области **файлы** .) При первом запросе страницы данные времени не находятся в кэше, и код должен добавить значение времени в кэш.

    ![кэш-1](15-caching-to-improve-the-performance-of-your-website/_static/image1.jpg)
4. Обновите веб *Cache. cshtml* в браузере. На этот раз данные времени находятся в кэше. Обратите внимание, что время не изменилось со времени последнего просмотра страницы.

    ![кэш-2](15-caching-to-improve-the-performance-of-your-website/_static/image2.jpg)
5. Подождите одну минуту, пока кэш будет очищен, а затем обновите страницу. Эта страница снова указывает, что данные времени не были найдены в кэше, а обновленное время добавляется в кэш.

<a id="Additional_Resources"></a>
## <a name="additional-resources"></a>Дополнительные ресурсы

- [Отображение данных в диаграмме](https://go.microsoft.com/fwlink/?LinkId=202895)
- [Справочник по API-кэшу](https://msdn.microsoft.com/library/system.web.helpers.webcache(v=vs.99).aspx) (MSDN)
