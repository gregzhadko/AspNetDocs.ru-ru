---
uid: web-pages/overview/performance-and-traffic/15-caching-to-improve-the-performance-of-your-website
title: Кэширование данных на сайте веб-страницы ASP.NET (Razor) для повышения производительности | Документация Майкрософт
author: Rick-Anderson
description: Вы можете ускорить веб-сайт, добавив в него хранилище, то есть результаты, которые обычно занимают значительное время для получения или обработки...
ms.author: riande
ms.date: 02/14/2014
ms.assetid: 961e525b-7700-469e-8a68-d7010b6fb68c
msc.legacyurl: /web-pages/overview/performance-and-traffic/15-caching-to-improve-the-performance-of-your-website
msc.type: authoredcontent
ms.openlocfilehash: 01796d3ca699a6af5d9162b22a926551435c2040
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78521160"
---
# <a name="caching-data-in-an-aspnet-web-pages-razor-site-for-better-performance"></a><span data-ttu-id="e6f29-103">Кэширование данных на сайте веб-страницы ASP.NET (Razor) для повышения производительности</span><span class="sxs-lookup"><span data-stu-id="e6f29-103">Caching Data in an ASP.NET Web Pages (Razor) Site for Better Performance</span></span>

<span data-ttu-id="e6f29-104">от [Tom фитзмаккен](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="e6f29-104">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="e6f29-105">В этой статье объясняется, как использовать вспомогательный метод для кэширования данных для повышения производительности на веб-сайте веб-страницы ASP.NET (Razor).</span><span class="sxs-lookup"><span data-stu-id="e6f29-105">This article explains how to use a helper to cache information for faster performance in an ASP.NET Web Pages (Razor) website.</span></span> <span data-ttu-id="e6f29-106">Вы можете ускорить веб-сайт, добавив в &#8212; него кэширование &#8212; результатов, которые обычно требуют слишком много времени для получения или обработки и не меняются часто.</span><span class="sxs-lookup"><span data-stu-id="e6f29-106">You can speed up your website by having it store &#8212; that is, cache &#8212; the results of data that ordinarily would take considerable time to retrieve or process and that does not change often.</span></span>
> 
> <span data-ttu-id="e6f29-107">**Что вы узнаете:**</span><span class="sxs-lookup"><span data-stu-id="e6f29-107">**What you'll learn:**</span></span> 
> 
> - <span data-ttu-id="e6f29-108">Использование кэширования для повышения скорости реагирования веб-сайта.</span><span class="sxs-lookup"><span data-stu-id="e6f29-108">How to use caching to improve the responsiveness of your website.</span></span>
> 
> <span data-ttu-id="e6f29-109">Это функции ASP.NET, представленные в статье:</span><span class="sxs-lookup"><span data-stu-id="e6f29-109">These are the ASP.NET features introduced in the article:</span></span>
> 
> - <span data-ttu-id="e6f29-110">Вспомогательный метод `WebCache`.</span><span class="sxs-lookup"><span data-stu-id="e6f29-110">The `WebCache` helper.</span></span>
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a><span data-ttu-id="e6f29-111">Версии программного обеспечения, используемые в этом руководстве</span><span class="sxs-lookup"><span data-stu-id="e6f29-111">Software versions used in the tutorial</span></span>
> 
> 
> - <span data-ttu-id="e6f29-112">Веб-страницы ASP.NET (Razor) 3</span><span class="sxs-lookup"><span data-stu-id="e6f29-112">ASP.NET Web Pages (Razor) 3</span></span>
>   
> 
> <span data-ttu-id="e6f29-113">Этот учебник также работает с веб-страницы ASP.NET 2.</span><span class="sxs-lookup"><span data-stu-id="e6f29-113">This tutorial also works with ASP.NET Web Pages 2.</span></span>

<span data-ttu-id="e6f29-114">Каждый раз, когда кто-то запрашивает страницу с веб-узла, для выполнения этого запроса необходимо выполнить некоторые действия.</span><span class="sxs-lookup"><span data-stu-id="e6f29-114">Every time someone requests a page from your site, the web server has to do some work in order to fulfill the request.</span></span> <span data-ttu-id="e6f29-115">Для некоторых страниц сервер может выполнять задачи, которые принимают (сравнительное) длительное время, например получение данных из базы данных.</span><span class="sxs-lookup"><span data-stu-id="e6f29-115">For some of your pages, the server might have to perform tasks that take a (comparatively) long time, such as retrieving data from a database.</span></span> <span data-ttu-id="e6f29-116">Даже если эти задачи не выполняются в абсолютных условиях, если ваш сайт испытывает большой объем трафика, весь ряд отдельных запросов, которые приводят к тому, что веб-сервер выполняет сложную или медленную задачу, может добавить большую часть работы.</span><span class="sxs-lookup"><span data-stu-id="e6f29-116">Even if these tasks don't take long in absolute terms, if your site experiences a lot of traffic, a whole series of individual requests that cause the web server to perform the complicated or slow task can add up to a lot of work.</span></span> <span data-ttu-id="e6f29-117">Это может в конечном итоге повлиять на производительность сайта.</span><span class="sxs-lookup"><span data-stu-id="e6f29-117">This can ultimately affect the performance of the site.</span></span>

<span data-ttu-id="e6f29-118">Одним из способов повышения производительности веб-сайта в таких обстоятельствах является кэширование данных.</span><span class="sxs-lookup"><span data-stu-id="e6f29-118">One way to improve the performance of your website in circumstances like this is to cache data.</span></span> <span data-ttu-id="e6f29-119">Если сайт получает повторяющиеся запросы для одних и тех же сведений, а сведения не нужно изменять для каждого пользователя и не учитывают время, вместо повторной выборки или пересчета данных можно получить данные один раз, а затем сохранить результаты.</span><span class="sxs-lookup"><span data-stu-id="e6f29-119">If your site gets repeated requests for the same information, and the information does not need to be modified for each person, and it's not time sensitive, instead of re-fetching or recalculating it, you can fetch the data once and then store the results.</span></span> <span data-ttu-id="e6f29-120">В следующий раз, когда поступает запрос на получение этих сведений, вы просто получите его из кэша.</span><span class="sxs-lookup"><span data-stu-id="e6f29-120">The next time a request comes in for that information, you just get it out of the cache.</span></span>

<span data-ttu-id="e6f29-121">Как правило, данные кэшируются, которые не меняются часто.</span><span class="sxs-lookup"><span data-stu-id="e6f29-121">In general, you cache information that doesn't change frequently.</span></span> <span data-ttu-id="e6f29-122">При помещении сведений в кэш они хранятся в памяти на веб-сервере.</span><span class="sxs-lookup"><span data-stu-id="e6f29-122">When you put information in the cache, it's stored in memory on the web server.</span></span> <span data-ttu-id="e6f29-123">Можно указать продолжительность кэширования (в секундах до суток).</span><span class="sxs-lookup"><span data-stu-id="e6f29-123">You can specify how long it should be cached, from seconds to days.</span></span> <span data-ttu-id="e6f29-124">По истечении периода кэширования сведения автоматически удаляются из кэша.</span><span class="sxs-lookup"><span data-stu-id="e6f29-124">When the caching period expires, the information is automatically removed from the cache.</span></span>

> [!NOTE]
> <span data-ttu-id="e6f29-125">Записи в кэше могут быть удалены по причинам, отличным от истечения срока действия.</span><span class="sxs-lookup"><span data-stu-id="e6f29-125">Entries in the cache might be removed for reasons other than that they've expired.</span></span> <span data-ttu-id="e6f29-126">Например, веб-сервер может временно работать с нехваткой памяти, и одним из способов освободить память является создание записей из кэша.</span><span class="sxs-lookup"><span data-stu-id="e6f29-126">For example, the web server might temporarily run low on memory, and one way it can reclaim memory is by throwing entries out of the cache.</span></span> <span data-ttu-id="e6f29-127">Как вы увидите, даже если вы помещаете информацию в кэш, необходимо убедиться, что она все еще там, где это необходимо.</span><span class="sxs-lookup"><span data-stu-id="e6f29-127">As you'll see, even if you've put information into the cache, you have to check to be sure it's still there when you need it.</span></span>

<span data-ttu-id="e6f29-128">Представьте, что на веб-сайте есть страница, на которой отображается текущая температура и прогноз погоды.</span><span class="sxs-lookup"><span data-stu-id="e6f29-128">Imagine your website has a page that displays the current temperature and weather forecast.</span></span> <span data-ttu-id="e6f29-129">Чтобы получить данные такого типа, можно отправить запрос внешней службе.</span><span class="sxs-lookup"><span data-stu-id="e6f29-129">To get this type of information, you might send a request to an external service.</span></span> <span data-ttu-id="e6f29-130">Так как эти сведения не меняются (например, в течение двух часов), а для внешних вызовов требуется время и пропускная способность, это хороший кандидат на кэширование.</span><span class="sxs-lookup"><span data-stu-id="e6f29-130">Since this information doesn't change much (within a two-hour time period, for example) and since external calls require time and bandwidth, it's a good candidate for caching.</span></span>

## <a name="adding-caching-to-a-page"></a><span data-ttu-id="e6f29-131">Добавление кэширования на страницу</span><span class="sxs-lookup"><span data-stu-id="e6f29-131">Adding Caching to a Page</span></span>

<span data-ttu-id="e6f29-132">ASP.NET включает вспомогательный модуль `WebCache`, который упрощает добавление кэширования на сайт и добавление данных в кэш.</span><span class="sxs-lookup"><span data-stu-id="e6f29-132">ASP.NET includes a `WebCache` helper that makes it easy to add caching to your site and add data to the cache.</span></span> <span data-ttu-id="e6f29-133">В этой процедуре вы создадите страницу, которая кэширует текущее время.</span><span class="sxs-lookup"><span data-stu-id="e6f29-133">In this procedure, you'll create a page that caches the current time.</span></span> <span data-ttu-id="e6f29-134">Этот пример не является реальным, так как текущее время — это то, что часто меняется, а более сложно вычислить.</span><span class="sxs-lookup"><span data-stu-id="e6f29-134">This isn't a real-world example, since the current time is something that does change often, and that moreover isn't complex to calculate.</span></span> <span data-ttu-id="e6f29-135">Однако это хороший способ продемонстрировать кэширование в действии.</span><span class="sxs-lookup"><span data-stu-id="e6f29-135">However, it's a good way to illustrate caching in action.</span></span>

1. <span data-ttu-id="e6f29-136">Добавьте на веб-сайт новую страницу с именем веб_узел *. cshtml* .</span><span class="sxs-lookup"><span data-stu-id="e6f29-136">Add a new page named *WebCache.cshtml* to the website.</span></span>
2. <span data-ttu-id="e6f29-137">Добавьте следующий код и разметку на страницу:</span><span class="sxs-lookup"><span data-stu-id="e6f29-137">Add the following code and markup to the page:</span></span>

    [!code-cshtml[Main](15-caching-to-improve-the-performance-of-your-website/samples/sample1.cshtml)]

    <span data-ttu-id="e6f29-138">При кэшировании данных вы поместили их в кэш, используя имя, уникальное для веб-сайта.</span><span class="sxs-lookup"><span data-stu-id="e6f29-138">When you cache data, you put it into the cache using a name this is unique across the website.</span></span> <span data-ttu-id="e6f29-139">В этом случае вы будете использовать запись кэша с именем `CachedTime`.</span><span class="sxs-lookup"><span data-stu-id="e6f29-139">In this case, you'll use a cache entry named `CachedTime`.</span></span> <span data-ttu-id="e6f29-140">Это `cacheItemKey` показано в примере кода.</span><span class="sxs-lookup"><span data-stu-id="e6f29-140">This is the `cacheItemKey` shown in the code example.</span></span>

    <span data-ttu-id="e6f29-141">Сначала код считывает запись кэша `CachedTime`.</span><span class="sxs-lookup"><span data-stu-id="e6f29-141">The code first reads the `CachedTime` cache entry.</span></span> <span data-ttu-id="e6f29-142">Если возвращается значение (то есть если запись кэша не имеет значение null), код просто устанавливает значение переменной времени в данные кэша.</span><span class="sxs-lookup"><span data-stu-id="e6f29-142">If a value is returned (that is, if the cache entry isn't null), the code just sets the value of the time variable to the cache data.</span></span>

    <span data-ttu-id="e6f29-143">Однако если запись кэша не существует (то есть имеет значение null), код задает значение времени, добавляет его в кэш и устанавливает значение срока действия равным одной минуте.</span><span class="sxs-lookup"><span data-stu-id="e6f29-143">However, if the cache entry doesn't exist (that is, it's null), the code sets the time value, adds it to the cache, and sets an expiration value to one minute.</span></span> <span data-ttu-id="e6f29-144">Через одну минуту запись кэша отклоняется.</span><span class="sxs-lookup"><span data-stu-id="e6f29-144">After one minute, the cache entry is discarded.</span></span> <span data-ttu-id="e6f29-145">(Значение срока действия по умолчанию для элемента в кэше составляет 20 минут.) Команда `WebCache.Set(cacheItemKey, time, 1, false)` показывает, как добавить значение текущего времени в кэш и установить срок его действия равным 1 минуте.</span><span class="sxs-lookup"><span data-stu-id="e6f29-145">(The default expiration value for an item in the cache is 20 minutes.) The command `WebCache.Set(cacheItemKey, time, 1, false)` shows how to add the current time value to the cache and set its expiration to 1 minute.</span></span> <span data-ttu-id="e6f29-146">Установка параметра *slidingExpiration* в значение `false` означает, что срок действия не будет продлен каждый раз, когда он запрашивается.</span><span class="sxs-lookup"><span data-stu-id="e6f29-146">Setting the *slidingExpiration* parameter to `false` means the expiration time is not renewed each time it is requested.</span></span> <span data-ttu-id="e6f29-147">Срок его действия истекает через 1 минуту после того, как он был изначально добавлен в кэш.</span><span class="sxs-lookup"><span data-stu-id="e6f29-147">It will expire exactly 1 minute after it was originally added to the cache.</span></span> <span data-ttu-id="e6f29-148">Если задать для этого параметра значение `true` срок действия 1 минута будет сбрасываться каждый раз, когда значение запрашивается из кэша.</span><span class="sxs-lookup"><span data-stu-id="e6f29-148">If you set this value to `true` the 1 minute expiration time is reset each time the value is requested from the cache.</span></span>

    <span data-ttu-id="e6f29-149">Этот код иллюстрирует шаблон, который всегда следует использовать при кэшировании данных.</span><span class="sxs-lookup"><span data-stu-id="e6f29-149">This code illustrates the pattern you should always use when you cache data.</span></span> <span data-ttu-id="e6f29-150">Прежде чем извлечь что-либо из кэша, всегда следует сначала проверить, вернул ли метод `WebCache.Get` значение null.</span><span class="sxs-lookup"><span data-stu-id="e6f29-150">Before you get something out of the cache, always check first whether the `WebCache.Get` method has returned null.</span></span> <span data-ttu-id="e6f29-151">Помните, что срок действия записи кэша мог быть истек или она могла быть удалена по какой-либо другой причине, поэтому любая заданная запись никогда не будет гарантирована в кэше.</span><span class="sxs-lookup"><span data-stu-id="e6f29-151">Remember that the cache entry might have expired or might have been removed for some other reason, so any given entry is never guaranteed to be in the cache.</span></span>
3. <span data-ttu-id="e6f29-152">Запустите веб- *кэш. cshtml* в браузере.</span><span class="sxs-lookup"><span data-stu-id="e6f29-152">Run *WebCache.cshtml* in a browser.</span></span> <span data-ttu-id="e6f29-153">(Перед выполнением страницы убедитесь, что она выбрана в рабочей области **файлы** .) При первом запросе страницы данные времени не находятся в кэше, и код должен добавить значение времени в кэш.</span><span class="sxs-lookup"><span data-stu-id="e6f29-153">(Make sure the page is selected in the **Files** workspace before you run it.) The first time you request the page, the time data isn't in the cache, and the code has to add the time value to the cache.</span></span>

    ![кэш-1](15-caching-to-improve-the-performance-of-your-website/_static/image1.jpg)
4. <span data-ttu-id="e6f29-155">Обновите веб *Cache. cshtml* в браузере.</span><span class="sxs-lookup"><span data-stu-id="e6f29-155">Refresh *WebCache.cshtml* in the browser.</span></span> <span data-ttu-id="e6f29-156">На этот раз данные времени находятся в кэше.</span><span class="sxs-lookup"><span data-stu-id="e6f29-156">This time, the time data is in the cache.</span></span> <span data-ttu-id="e6f29-157">Обратите внимание, что время не изменилось со времени последнего просмотра страницы.</span><span class="sxs-lookup"><span data-stu-id="e6f29-157">Notice that the time hasn't changed since the last time you viewed the page.</span></span>

    ![кэш-2](15-caching-to-improve-the-performance-of-your-website/_static/image2.jpg)
5. <span data-ttu-id="e6f29-159">Подождите одну минуту, пока кэш будет очищен, а затем обновите страницу.</span><span class="sxs-lookup"><span data-stu-id="e6f29-159">Wait one minute for the cache to be emptied, and then refresh the page.</span></span> <span data-ttu-id="e6f29-160">Эта страница снова указывает, что данные времени не были найдены в кэше, а обновленное время добавляется в кэш.</span><span class="sxs-lookup"><span data-stu-id="e6f29-160">The page again indicates that the time data wasn't found in the cache, and the updated time is added to the cache.</span></span>

<a id="Additional_Resources"></a>
## <a name="additional-resources"></a><span data-ttu-id="e6f29-161">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="e6f29-161">Additional Resources</span></span>

- [<span data-ttu-id="e6f29-162">Отображение данных в диаграмме</span><span class="sxs-lookup"><span data-stu-id="e6f29-162">Displaying Data in a Chart</span></span>](https://go.microsoft.com/fwlink/?LinkId=202895)
- <span data-ttu-id="e6f29-163">[Справочник по API-кэшу](https://msdn.microsoft.com/library/system.web.helpers.webcache(v=vs.99).aspx) (MSDN)</span><span class="sxs-lookup"><span data-stu-id="e6f29-163">[WebCache API reference](https://msdn.microsoft.com/library/system.web.helpers.webcache(v=vs.99).aspx) (MSDN)</span></span>
