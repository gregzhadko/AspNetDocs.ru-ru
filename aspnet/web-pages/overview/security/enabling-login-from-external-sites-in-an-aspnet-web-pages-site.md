---
uid: web-pages/overview/security/enabling-login-from-external-sites-in-an-aspnet-web-pages-site
title: Вход с использованием внешних сайтов на сайте веб-страницы ASP.NET (Razor) | Документация Майкрософт
author: Rick-Anderson
description: В этой статье объясняется, как войти на сайт веб-страницы ASP.NET (Razor) с помощью Facebook, Google, Twitter, Yahoo и других сайтов, то есть о поддержке...
ms.author: riande
ms.date: 02/21/2014
ms.assetid: ef852096-a5bf-47b3-9945-125cde065093
msc.legacyurl: /web-pages/overview/security/enabling-login-from-external-sites-in-an-aspnet-web-pages-site
msc.type: authoredcontent
ms.openlocfilehash: 860b75422c3df1d191ed861344963bfc19270e8f
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78518790"
---
# <a name="logging-in-using-external-sites-in-an-aspnet-web-pages-razor-site"></a>Вход с использованием внешних сайтов на сайте веб-страницы ASP.NET (Razor)

от [Tom фитзмаккен](https://github.com/tfitzmac)

> В этой статье объясняется, как войти на сайт веб-страницы ASP.NET (Razor) с помощью Facebook, Google, Twitter, Yahoo и других сайтов, то есть как поддерживать OAuth и OpenID Connect на сайте.
> 
> Из этого руководства вы узнаете, как выполнять такие задачи:
> 
> - Включение входа с других сайтов при использовании шаблона сайта WebMatrix Starter.
> 
> Это функция ASP.NET, представленная в статье:
> 
> - Вспомогательный метод `OAuthWebSecurity`.
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a>Версии программного обеспечения, используемые в этом руководстве
> 
> 
> - Веб-страницы ASP.NET (Razor) 2
> - WebMatrix 3

Веб-страницы ASP.NET включает поддержку поставщиков [OAuth](http://oauth.net/) и [OpenID Connect](http://openid.net/) . Используя эти поставщики, можно разрешить пользователям входить на сайт с помощью существующих учетных данных из Facebook, Twitter, Microsoft и Google. Например, для входа с использованием учетной записи Facebook пользователи могут просто выбрать значок Facebook, который перенаправит их на страницу входа в Facebook, где вводятся сведения о пользователях. Затем они могут связать имя входа Facebook со своей учетной записью на сайте. Связанное усовершенствование функций членства в веб-страницах заключается в том, что пользователи могут связывать несколько имен входа (включая имена входа из сайтов социальных сетей) с одной учетной записью на веб-сайте.

На этом рисунке показана страница входа из шаблона **начального сайта** , где пользователь может выбрать значок Facebook, Twitter, Google или Microsoft, чтобы включить вход с внешней учетной записью:

![внешние поставщики](enabling-login-from-external-sites-in-an-aspnet-web-pages-site/_static/image1.png)

Вы можете включить членство OAuth и OpenID Connect, раскомментируя несколько строк кода в шаблоне **начального сайта** . Методы и свойства, используемые для работы с поставщиками OAuth и OpenID Connect, находятся в классе `WebMatrix.Security.OAuthWebSecurity`. Шаблон **начального сайта** включает в себя полную инфраструктуру членства, полную страницу входа, базу данных членства и весь код, позволяющий пользователям входить на сайт с помощью локальных учетных данных или из другого сайта.

В этом разделе приводится пример того, как разрешить пользователям входить с внешних сайтов на сайт, основанный на шаблоне **начального сайта** . После создания начального сайта вы выполните это действие (см. сведения ниже):

- Для сайтов, использующих поставщик OAuth (Facebook, Twitter и Microsoft), вы создаете приложение на внешнем сайте. Это дает вам ключи приложений, необходимые для вызова функции входа для этих сайтов.
- Для сайтов, использующих поставщик OpenID Connect (Google), нет необходимости создавать приложение. Для всех этих сайтов необходимо иметь учетную запись для входа в систему и создания приложений для разработчиков.

    > [!NOTE]
    > Приложения Майкрософт принимают только URL-адрес рабочего веб-сайта, поэтому вы не можете использовать URL-адрес локального веб-сайта для проверки имен входа.
- Измените несколько файлов на веб-сайте, чтобы указать соответствующий поставщик проверки подлинности и отправить имя входа на сайт, который вы хотите использовать.

В этой статье приводятся отдельные инструкции по выполнению следующих задач.

- [Включение учетных записей Google](#To_enable_Google_logins)
- [Включение имен для входа в Facebook](#To_enable_Facebook_logins)
- [Включение имен для входа в Twitter](#To_enable_Twitter_logins)

<a id="To_enable_Google_logins"></a>
## <a name="enabling-google-logins"></a>Включение учетных записей Google

1. Создайте или откройте веб-страницы ASP.NET сайт, основанный на шаблоне сайта WebMatrix Starter.
2. Откройте страницу *\_AppStart. cshtml* и раскомментируйте следующую строку кода. 

    [!code-css[Main](enabling-login-from-external-sites-in-an-aspnet-web-pages-site/samples/sample1.css)]

### <a name="testing-google-login"></a>Тестирование входа Google

1. Запустите страницу *Default. cshtml* сайта и нажмите кнопку **Вход** .
2. На странице *Вход* в разделе **использовать другую службу для входа в систему** нажмите кнопку Отправить **Google** или **Yahoo** . В этом примере используется имя входа Google. 

    Веб-страница перенаправляет запрос на страницу входа в Google.

    ![Вход Google](enabling-login-from-external-sites-in-an-aspnet-web-pages-site/_static/image2.png)
3. Введите учетные данные для существующей учетной записи Google.
4. Если Google спрашивает, нужно ли разрешить *localhost* использовать данные из учетной записи, нажмите кнопку **Разрешить**.

    Код использует маркер Google для проверки подлинности пользователя, а затем возвращается на эту страницу на веб-сайте. На этой странице пользователи могут связать свое имя входа Google с существующей учетной записью на веб-сайте или зарегистрировать новую учетную запись на сайте, чтобы связать внешнее имя входа с.

    ![OAuth-5](enabling-login-from-external-sites-in-an-aspnet-web-pages-site/_static/image3.png)
5. Нажмите кнопку **связать** . Браузер вернется на домашнюю страницу приложения.

<a id="To_enable_Facebook_logins"></a>
## <a name="enabling-facebook-logins"></a>Включение имен для входа в Facebook

1. Перейдите на [сайт разработчиков Facebook](https://developers.facebook.com/apps) (войдите, если вы еще не вошли в систему).
2. Нажмите кнопку **создать новое приложение** , а затем следуйте инструкциям на экране, чтобы ввести имя и создать новое приложение.
3. В разделе **выберите, как приложение будет интегрироваться с Facebook**, выберите раздел **веб-сайт** .
4. В поле **URL-адрес сайта** введите URL-адрес сайта (например, `http://www.example.com`). Поле **домена** является необязательным; его можно использовать для проверки подлинности всего домена (например, *example.com*). 

    > [!NOTE]
    > Если вы используете сайт на локальном компьютере с URL-адресом, например `http://localhost:12345` (где номер является локальным номером порта), это значение можно добавить в поле URL- **адрес сайта** для тестирования сайта. Однако при каждом изменении номера порта локального сайта необходимо обновить поле **URL-адрес сайта** приложения.
5. Нажмите кнопку **сохранить изменения** .
6. Снова перейдите на вкладку **приложения** и просмотрите начальную страницу приложения.
7. Скопируйте **идентификатор** приложения и значения **секрета** приложения для приложения и вставьте их во временный текстовый файл. Эти значения будут переданы поставщику Facebook в коде веб-сайта.
8. Выйдите из сайта разработчика Facebook.

Теперь вы вносите изменения на две страницы веб-сайта, чтобы пользователи могли войти на сайт с помощью учетных записей Facebook.

1. Создайте или откройте веб-страницы ASP.NET сайт, основанный на шаблоне сайта WebMatrix Starter.
2. Откройте страницу *\_AppStart. cshtml* и раскомментируйте код для поставщика OAuth Facebook. Блок кода с некомментарием выглядит следующим образом: 

    [!code-csharp[Main](enabling-login-from-external-sites-in-an-aspnet-web-pages-site/samples/sample2.cs)]
3. Скопируйте значение **идентификатора приложения** из приложения Facebook в качестве значения параметра `appId` (внутри кавычек).
4. Скопируйте значение **секрета приложения** из приложения Facebook в качестве значения параметра `appSecret`.
5. Сохраните файл и закройте его.

### <a name="testing-facebook-login"></a>Тестирование имени входа Facebook

1. Запустите веб-страницу *Default. cshtml* и нажмите кнопку **Вход** .
2. На странице *Вход* в разделе **использовать другую службу для входа** щелкните значок **Facebook** . 

    Веб-страница перенаправляет запрос на страницу входа Facebook.

    ![OAuth-2](enabling-login-from-external-sites-in-an-aspnet-web-pages-site/_static/image4.png)
3. Войдите в учетную запись Facebook. 

    В коде используется маркер Facebook для проверки подлинности, а затем возвращается страница, на которой можно связать имя входа Facebook с именем входа вашего сайта. Имя пользователя или адрес электронной почты заполняется в поле " **адрес электронной** почты" в форме.

    ![OAuth-5](enabling-login-from-external-sites-in-an-aspnet-web-pages-site/_static/image5.png)
4. Нажмите кнопку **связать** . 

    Браузер вернется на домашнюю страницу и вы вошли в систему.

<a id="To_enable_Twitter_logins"></a>
## <a name="enabling-twitter-logins"></a>Включение имен для входа в Twitter

1. Перейдите на [сайт разработчиков Twitter](https://dev.twitter.com/).
2. Выберите ссылку **создать приложение** , а затем войдите на сайт.
3. В форме **Создание приложения** заполните поля **имя** и **Описание** .
4. В поле **веб-сайт** введите URL-адрес сайта (например, `http://www.example.com`). 

    > [!NOTE]
    > Если вы тестируете сайт локально (используя URL-адрес, например `http://localhost:12345`), то Twitter может не принять этот URL-адрес. Однако вы можете использовать локальный IP-адрес замыкания на себя (например `http://127.0.0.1:12345`). Это упрощает процесс тестирования приложения локально. Однако каждый раз при изменении номера порта локального сайта необходимо обновить поле **веб-сайта** приложения.
5. В поле **URL-адрес обратного вызова** введите URL-адрес страницы на веб-сайте, к которой пользователи будут возвращаться после входа в Twitter. Например, чтобы отправить пользователей на домашнюю страницу начального сайта (который распознает состояние, в котором они были зарегистрированы), введите тот же URL-адрес, который вы указали в поле **веб-сайт** .
6. Примите условия и нажмите кнопку **создать приложение Twitter** .
7. На целевой странице **Мои приложения** выберите созданное приложение.
8. На вкладке **сведения** прокрутите вниз и нажмите кнопку **создать маркер доступа** .
9. На вкладке **сведения** скопируйте значение **ключа** и **секрета потребителя** для своего приложения и вставьте их во временный текстовый файл. Эти значения передаются поставщику Twitter в коде веб-сайта.
10. Выйдите из сайта Twitter.

Теперь вы вносите изменения на две страницы веб-сайта, чтобы пользователи могли входить на сайт с помощью учетных записей Twitter.

1. Создайте или откройте веб-страницы ASP.NET сайт, основанный на шаблоне сайта WebMatrix Starter.
2. Откройте страницу *\_AppStart. cshtml* и раскомментируйте код для поставщика OAuth "Twitter". Блок кода с некомментарием выглядит следующим образом: 

    [!code-csharp[Main](enabling-login-from-external-sites-in-an-aspnet-web-pages-site/samples/sample3.cs)]
3. Скопируйте значение **ключа потребителя** из приложения Twitter в качестве значения параметра `consumerKey` (внутри кавычек).
4. Скопируйте значение **секрета потребителя** из приложения Twitter в качестве значения параметра `consumerSecret`.
5. Сохраните файл и закройте его.

### <a name="testing-twitter-login"></a>Тестирование имени входа Twitter

1. Запустите страницу *Default. cshtml* сайта и нажмите кнопку **Вход** .
2. На странице *Вход* в разделе **использовать другую службу для входа** выберите значок **Twitter** . 

    Веб-страница перенаправляет запрос на страницу входа Twitter для созданного приложения.

    ![OAuth-4](enabling-login-from-external-sites-in-an-aspnet-web-pages-site/_static/image6.png)
3. Войдите в учетную запись Twitter.
4. Код использует токен Twitter для проверки подлинности пользователя, а затем возвращает вас на страницу, на которой можно связать имя входа с учетной записью веб-сайта. Ваше имя или адрес электронной почты заполняется в поле " **адрес электронной** почты" в форме.

    ![OAuth-5](enabling-login-from-external-sites-in-an-aspnet-web-pages-site/_static/image7.png)
5. Нажмите кнопку **связать** . 

    Браузер вернется на домашнюю страницу и вы вошли в систему.

<a id="Additional_Resources"></a>
## <a name="additional-resources"></a>Дополнительные ресурсы

- [Настройка поведения в масштабах сайта](https://go.microsoft.com/fwlink/?LinkId=202906)
- [Добавление безопасности и членства на веб-страницы ASP.NET сайте](https://go.microsoft.com/fwlink/?LinkID=202904)
