---
uid: web-pages/overview/getting-started/11-adding-email-to-your-web-site
title: Отправка электронной почты с веб-ASP.NET страниц узла (Razor) | Документация Майкрософт
author: Rick-Anderson
description: В этой главе объясняется, как отправить сообщение по электронной почте с веб-сайта.
ms.author: riande
ms.date: 02/20/2014
ms.assetid: fc49bcb9-f1a9-4048-8c3f-b60951853200
msc.legacyurl: /web-pages/overview/getting-started/11-adding-email-to-your-web-site
msc.type: authoredcontent
ms.openlocfilehash: 23e9717329525fb5a0ed505c9dc94505d4f9dbbe
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2019
ms.locfileid: "65130547"
---
# <a name="sending-email-from-an-aspnet-web-pages-razor-site"></a>Отправка сообщения электронной почты с сайта ASP.NET Web Pages (Razor)

по [Tom FitzMacken](https://github.com/tfitzmac)

> В этой статье объясняется, как отправлять сообщения электронной почты из веб-сайта, при использовании веб-страниц ASP.NET (Razor).
> 
> Вы узнаете, как:
> 
> - Как отправлять сообщения электронной почты с веб-сайта.
> - Как добавить файл в сообщение электронной почты.
> 
> Это функция ASP.NET, впервые представленная в этой статье:
> 
> - `WebMail` Вспомогательный.
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a>Версии программного обеспечения, используемые в этом руководстве
> 
> 
> - Веб-страниц ASP.NET (Razor) 3
>   
> 
> Этот учебник также работает с ASP.NET Web Pages 2.

<a id="Sending_Email_Messages"></a>
## <a name="sending-email-messages-from-your-website"></a>Отправка сообщений электронной почты с веб-сайта

Существует множество причин, почему может потребоваться отправка электронной почты с веб-сайта. Может отправить подтверждение для пользователей, или может отправлять уведомления для себя (например, что новый пользователь зарегистрировал.) `WebMail` Вспомогательный упрощает для отправки электронной почты.

Чтобы использовать `WebMail` вспомогательного приложения, у вас есть доступ к SMTP-сервер. (Расшифровывается SMTP *протокол SMTP*.) SMTP-сервер — это почтовый сервер, который только перенаправляет сообщения на сервер получателя &#8212; сторона исходящие сообщения электронной почты. При использовании поставщика услуг размещения для веб-сайта, они, скорее всего, настраивается по электронной почте, и они расскажем вам, что такое имя сервера SMTP. Если вы работаете в корпоративной сети, администратор или ваш ИТ-отдел обычно обеспечивает сведения о SMTP-сервер, который можно использовать. Если вы работаете дома, вы даже можно протестировать с помощью поставщика обычные электронной почты, который можно сообщить имя SMTP-сервера. Обычно нужно:

- Имя SMTP-сервера.
- Номер порта. Это почти всегда 25. Тем не менее поставщик услуг Интернета может потребоваться использовать порт 587. Если вы используете протокол SSL (SSL) для электронной почты, может потребоваться другой порт. Обратитесь к поставщику услуг электронной почты.
- Учетные данные (имя пользователя, пароль).

В этой процедуре вы создадите две страницы. Первая страница содержит форму, которая позволяет пользователям вводить описание, как если бы они заполнив форму технической поддержки. Первая страница отправляет данные на вторую страницу. На второй странице код извлекает сведения о пользователе и отправляет сообщение электронной почты. Она также отображает сообщение с подтверждением, что получен отчет о проблеме.

![[изображение]](11-adding-email-to-your-web-site/_static/image1.jpg)

> [!NOTE]
> Для простоты в этом примере, этот код инициализирует `WebMail` вспомогательный справа на странице, где его использовать. Тем не менее для реальных веб-сайтов, лучше поместить следующий код инициализации в глобальный файл, таким образом, необходимо инициализировать `WebMail` вспомогательный класс для всех файлов в веб-сайта. Дополнительные сведения см. в разделе [поведение Настройка сайта для веб-страниц ASP.NET](https://go.microsoft.com/fwlink/?LinkId=202906#Setting_Values_For_Helpers).

1. Создание нового веб-сайта.
2. Добавьте новую страницу с именем *EmailRequest.cshtml* и добавьте следующую разметку: 

    [!code-html[Main](11-adding-email-to-your-web-site/samples/sample1.html)]

    Обратите внимание, что `action` атрибут элемента формы было присвоено *ProcessRequest.cshtml*. Это означает, что форма будет отправлена на эту страницу, вместо возврата в текущей страницы.
3. Добавьте новую страницу с именем *ProcessRequest.cshtml* на веб-сайт и добавьте следующий код и разметки:   

    [!code-cshtml[Main](11-adding-email-to-your-web-site/samples/sample2.cshtml)]

    В коде получить значения поля формы, которые были переданы на страницу. Затем можно вызвать `WebMail` вспомогательного приложения `Send` метод для создания и отправки сообщения электронной почты. В этом случае значения, используемые состоят из текст, который вы можете сцеплять со значениями, которые были переданы из формы.

    Код для этой страницы находится внутри `try/catch` блока. Если для какой-либо причине попытка отправить сообщение электронной почты не работает (например, параметры не требуются справа), код в `catch` блок выполняется и задает `errorMessage` переменной о возникшей ошибке. (Дополнительные сведения о `try/catch` блоки или `<text>` тег, см. в разделе [введение в ASP.NET веб-страниц программирование с использованием синтаксиса Razor](https://go.microsoft.com/fwlink/?LinkID=251587#ID_HandlingErrors).)

    В основной области страницы Если `errorMessage` переменная пуста (по умолчанию), пользователь видит сообщение, которое было отправлено сообщение электронной почты. Если `errorMessage` переменной присвоено значение true, который пользователь видит сообщение, что возникла ошибка при отправке сообщения.

    Обратите внимание, что в области страницы, которая отображает сообщение об ошибке, дополнительной проверки: `if(debuggingFlag)`. Это переменная, которое можно задать значение true, если возникают проблемы при отправке сообщения электронной почты. Когда `debuggingFlag` имеет значение true, и есть ли ошибка при отправке электронной почты, отображается сообщение об ошибке дополнительные, показывающее, все, что при попытке отправить сообщение электронной почты сообщает ASP.NET. Равномерное предупреждение, однако: сообщения об ошибках, которые ASP.NET выдает сообщение, если оно не может отправлять сообщения электронной почты могут быть универсальными. Например если ASP.NET не удается связаться с SMTP-сервера (например, из-за ошибки в имени сервера), ошибка `Failure sending mail`.

    > [!NOTE] 
    > 
    > **Важные** при получении сообщения об ошибке из объекта исключения (`ex` в коде), выполните *не* регулярно передать это сообщение по пользователям. Объекты исключения часто содержат сведения, пользователи не должны видеть и, даже к уязвимости системы безопасности. Вот почему этот код содержит переменную `debuggingFlag` , используемый как переключатель отображение сообщений об ошибках, почему переменной по умолчанию имеет значение false. Следует задавать эту переменную, равным true (и следовательно, будут отображаться сообщение об ошибке) *только* при возникновении проблемы с отправкой электронной почты и необходимо выполнить отладку. После устранения проблемы задайте `debuggingFlag` обратно в значение false.

    Изменить связанные параметры в коде, электронной почты следующее:

   - Задайте `your-SMTP-host` имя SMTP-сервера, у вас есть доступ к.
   - Задайте `your-user-name-here` имени пользователя для учетной записи сервера SMTP.
   - Задайте `your-account-password` на пароль для учетной записи сервера SMTP.
   - Задайте `your-email-address-here` на адрес электронной почты. Это адрес электронной почты, которые отправляются сообщения. (Некоторые поставщики электронной почты не позволяют задать другой `From` адресов и будет использовать имя пользователя как `From` адрес.)

     > [!TIP] 
     > 
     > <a id="configuring_email_settings"></a>
     > ### <a name="configuring-email-settings"></a>Настройка параметров электронной почты
     > 
     > Он может быть сложной задачей, иногда для того, чтобы убедиться в том, что у вас есть нужные параметры для SMTP-сервера, номер порта и т. д. Несколько советов:
     > 
     > - Имя SMTP-сервера часто выглядит примерно так `smtp.provider.com` или `smtp.provider.net`. Однако если вы публикуете веб-узла поставщика услуг размещения, имя SMTP-сервера на этом этапе может быть `localhost`. Это обусловлено тем, после того как вы опубликовали и ваш сайт работает на сервере поставщика, сервера электронной почты может быть локальным с точки зрения приложения. Это изменение в имена серверов могут означать, что необходимо изменить имя SMTP-сервера как часть процесс публикации.
     > - Номер порта, обычно — 25. Тем не менее некоторые поставщики требуют использовать порт 587 или некоторых других портов.
     > - Убедитесь, что используется правильные учетные данные. Если вы опубликовали свой сайт у поставщика услуг размещения, используйте учетные данные, которые поставщик указал специально предназначены для электронной почты. Это может отличаться от учетных данных, используемых для публикации.
     > - Иногда вообще не требуются учетные данные. При отправке электронной почты с помощью ваш поставщик услуг Интернета, поставщика электронной почты могут уже знать свои учетные данные. После публикации, может потребоваться использовать другие учетные данные, чем при тестировании на локальном компьютере.
     > - Если поставщика электронной почты использует шифрование, необходимо установить `WebMail.EnableSsl` для `true`.
4. Запустите *EmailRequest.cshtml* страницу в браузере. (Убедитесь, что выбран страницы **файлы** рабочей области, прежде чем запускать его.)
5. Введите свое имя и описание проблемы, а затем нажмите кнопку **отправить** кнопки. Вы будете перенаправлены *ProcessRequest.cshtml* страницу, подтверждает ваше сообщение и который отправляет сообщение электронной почты. 

    ![[изображение]](11-adding-email-to-your-web-site/_static/image2.jpg)

<a id="Sending_a_File"></a>
## <a name="sending-a-file-using-email"></a>Отправка файла с помощью электронной почты

Вы также можете отправлять файлы, вложенные в сообщения электронной почты. В этой процедуре вы создадите к текстовому файлу и две страницы HTML. Текстовый файл будет использоваться как вложения электронной почты.

1. На веб-сайте, добавьте новый текстовый файл и назовите его *MyFile.txt*.
2. Скопируйте следующий текст и вставьте его в файле: 

    `Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.`
3. Создание страницы с именем *SendFile.cshtml* и добавьте следующую разметку: 

    [!code-html[Main](11-adding-email-to-your-web-site/samples/sample3.html)]
4. Создание страницы с именем *ProcessFile.cshtml* и добавьте следующую разметку: 

    [!code-cshtml[Main](11-adding-email-to-your-web-site/samples/sample4.cshtml)]
5. Изменить связанные параметры в коде из примера, электронной почты следующее:

    - Задайте `your-SMTP-host` имя SMTP-сервера, у вас есть доступ к.
    - Задайте `your-user-name-here` имени пользователя для учетной записи сервера SMTP.
    - Задайте `your-email-address-here` на адрес электронной почты. Это адрес электронной почты, которые отправляются сообщения.
    - Задайте `your-account-password` на пароль для учетной записи сервера SMTP.
    - Задайте `target-email-address-here` на адрес электронной почты. (Как раньше, вы обычно отправляете сообщение электронной почты другому пользователю, но для тестирования, его можно отправить себе.)
6. Запустите *SendFile.cshtml* страницу в браузере.
7. Введите свое имя, тема и имя вкладываемого файла текста (*MyFile.txt*).
8. Нажмите кнопку `Submit`. Как и раньше, вы будете перенаправлены *ProcessFile.cshtml* страницу, подтверждает ваше сообщение и который отправляет вам сообщение электронной почты с вложенный файл.

<a id="Additional_Resources"></a>
## <a name="additional-resources"></a>Дополнительные ресурсы

- [Руководство по устранению неполадок веб-страниц ASP.NET (Razor)](https://go.microsoft.com/fwlink/?LinkId=253001)
- [Протокол SMTP](https://msdn.microsoft.com/library/aa480435.aspx)
- [Настройка поведения сайта веб-страниц ASP.NET](https://go.microsoft.com/fwlink/?LinkId=202906)
