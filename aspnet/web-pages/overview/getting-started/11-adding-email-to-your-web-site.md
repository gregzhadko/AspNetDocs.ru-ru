---
uid: web-pages/overview/getting-started/11-adding-email-to-your-web-site
title: Отправка электронной почты с сайта веб-страницы ASP.NET (Razor) | Документация Майкрософт
author: Rick-Anderson
description: В этой главе объясняется, как отправить автоматизированное сообщение электронной почты с веб-сайта.
ms.author: riande
ms.date: 02/20/2014
ms.assetid: fc49bcb9-f1a9-4048-8c3f-b60951853200
msc.legacyurl: /web-pages/overview/getting-started/11-adding-email-to-your-web-site
msc.type: authoredcontent
ms.openlocfilehash: 23e9717329525fb5a0ed505c9dc94505d4f9dbbe
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78515328"
---
# <a name="sending-email-from-an-aspnet-web-pages-razor-site"></a>Отправка электронной почты с сайта веб-страницы ASP.NET (Razor)

от [Tom фитзмаккен](https://github.com/tfitzmac)

> В этой статье объясняется, как отправить сообщение электронной почты с веб-сайта при использовании веб-страницы ASP.NET (Razor).
> 
> Из этого руководства вы узнаете, как выполнять такие задачи:
> 
> - Отправка сообщения электронной почты с веб-сайта.
> - Как присоединить файл к сообщению электронной почты.
> 
> Это функция ASP.NET, представленная в статье:
> 
> - Вспомогательный метод `WebMail`.
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a>Версии программного обеспечения, используемые в этом руководстве
> 
> 
> - Веб-страницы ASP.NET (Razor) 3
>   
> 
> Этот учебник также работает с веб-страницы ASP.NET 2.

<a id="Sending_Email_Messages"></a>
## <a name="sending-email-messages-from-your-website"></a>Отправка сообщений электронной почты с веб-сайта

Существует ряд причин, по которым может потребоваться отправить электронное сообщение с веб-сайта. Вы можете отправлять пользователям сообщения о подтверждении или отправлять вам уведомления (например, о том, что зарегистрирован новый пользователь). `WebMail` вспомогательное приложение упрощает отправку электронной почты.

Для использования вспомогательного метода `WebMail` необходимо иметь доступ к SMTP-серверу. (SMTP обозначает *протокол простого обмена электронной почтой*.) SMTP-сервер — это сервер электронной почты, который перенаправляет сообщения только на сервер &#8212; получателя. это исходящая сторона электронной почты. Если для веб-сайта используется поставщик услуг размещения, то, скорее всего, он настроил электронную почту и сообщит вам, что такое имя SMTP-сервера. Если вы работаете внутри корпоративной сети, администратор или ИТ-отдел обычно предоставляют сведения о том, что именно вы можете использовать. Если вы работаете дома, вы даже сможете протестировать его с помощью обычного поставщика электронной почты, который может сообщить вам имя своего SMTP-сервера. Обычно требуется:

- Имя SMTP-сервера.
- Номер порта. Это почти всегда 25. Однако поставщик услуг Интернета может потребовать использовать порт 587. Если для электронной почты используется протокол SSL, может потребоваться другой порт. Обратитесь к поставщику электронной почты.
- Учетные данные (имя пользователя, пароль).

В этой процедуре создаются две страницы. Первая страница имеет форму, которая позволяет пользователям ввести описание, как если бы оно заполнило форму технической поддержки. Первая страница отправляет свои сведения на вторую страницу. На второй странице код извлекает сведения о пользователе и отправляет сообщение электронной почты. В нем также отображается сообщение, подтверждающее получение отчета о проблеме.

![[образ]](11-adding-email-to-your-web-site/_static/image1.jpg)

> [!NOTE]
> Чтобы сделать этот пример простым, код инициализирует вспомогательный модуль `WebMail` прямо на странице, где она используется. Однако для реальных веб-сайтов лучше размещать код инициализации, подобный этому, в глобальном файле, чтобы инициализировать вспомогательный модуль `WebMail` для всех файлов на веб-сайте. Дополнительные сведения см. в разделе [Настройка поведения всего сайта для веб-страницы ASP.NET](https://go.microsoft.com/fwlink/?LinkId=202906#Setting_Values_For_Helpers).

1. Создайте новый веб-сайт.
2. Добавьте новую страницу с именем *EmailRequest. cshtml* и добавьте следующую разметку: 

    [!code-html[Main](11-adding-email-to-your-web-site/samples/sample1.html)]

    Обратите внимание, что атрибуту `action` элемента Form присвоено значение *ProcessRequest. cshtml*. Это означает, что форма будет отправлена на эту страницу вместо возврата к текущей странице.
3. Добавьте на веб-сайт новую страницу с именем *ProcessRequest. cshtml* и добавьте следующий код и разметку:   

    [!code-cshtml[Main](11-adding-email-to-your-web-site/samples/sample2.cshtml)]

    В коде вы получаете значения полей формы, которые были отправлены на страницу. Затем вызовите метод `Send` вспомогательного метода `WebMail`, чтобы создать и отправить сообщение электронной почты. В этом случае используемые значения состоят из текста, который объединяется со значениями, отправленными из формы.

    Код для этой страницы находится внутри блока `try/catch`. Если по какой-либо причине попытка отправить сообщение электронной почты не работает (например, неправильные параметры), код в блоке `catch` выполняется и присваивает переменной `errorMessage` значение произошедшей ошибки. (Дополнительные сведения о блоках `try/catch` или тега `<text>` см. в статье [Введение в веб-страницы ASP.NET программирования с помощью синтаксиса Razor](https://go.microsoft.com/fwlink/?LinkID=251587#ID_HandlingErrors).)

    В тексте страницы, если переменная `errorMessage` пуста (значение по умолчанию), пользователь видит сообщение об отправке сообщения электронной почты. Если переменная `errorMessage` имеет значение true, пользователь видит сообщение о том, что возникла проблема при отправке сообщения.

    Обратите внимание, что в части страницы, отображающей сообщение об ошибке, есть дополнительный тест: `if(debuggingFlag)`. Это переменная, которой можно присвоить значение true, если у вас возникают проблемы при отправке электронной почты. Если `debuggingFlag` имеет значение true и при отправке сообщения электронной почты возникла проблема, отображается дополнительное сообщение об ошибке, показывающее, что при попытке отправить сообщение электронной почты было сообщено о ASP.NET. Предупреждение: сообщения об ошибках, ASP.NET отчеты о невозможности отправки сообщений электронной почты, могут быть универсальными. Например, если ASP.NET не удается связаться с сервером SMTP (например, из-за ошибки в имени сервера), то эта ошибка `Failure sending mail`.

    > [!NOTE] 
    > 
    > **Важно!** При получении сообщения об ошибке из объекта исключения (`ex` в коде *) не следует выполнять регулярную* передачу этого сообщения пользователям. Объекты исключений часто содержат сведения, которые не должны видеть пользователи, а также могут представлять собой уязвимости системы безопасности. Вот почему этот код включает переменную `debuggingFlag`, которая используется в качестве параметра для вывода сообщения об ошибке и почему переменная по умолчанию имеет значение false. Следует присвоить этой переменной значение true (и, следовательно, выводить сообщение об ошибке) *только* в том случае, если возникла проблема с отправкой электронной почты и необходимо выполнить отладку. После устранения каких либо проблем присвойте параметру `debuggingFlag` значение false.

    Измените следующие параметры, связанные с электронной почтой, в коде:

   - Присвойте `your-SMTP-host` имя SMTP-сервера, к которому у вас есть доступ.
   - Задайте `your-user-name-here` имя пользователя для учетной записи SMTP-сервера.
   - Задайте `your-account-password` пароль для учетной записи SMTP-сервера.
   - Задайте для `your-email-address-here` собственный адрес электронной почты. Это адрес электронной почты, с которого отправляется сообщение. (Некоторые поставщики электронной почты не позволяют указать другой адрес `From` и будут использовать имя пользователя в качестве адреса `From`.)

     > [!TIP] 
     > 
     > <a id="configuring_email_settings"></a>
     > ### <a name="configuring-email-settings"></a>Настройка параметров электронной почты
     > 
     > Иногда может быть очень трудно убедиться в наличии правильных параметров для SMTP-сервера, номера порта и т. д. Несколько советов:
     > 
     > - Имя SMTP-сервера часто имеет примерно `smtp.provider.com` или `smtp.provider.net`. Однако при публикации сайта у поставщика услуг размещения на этом этапе имя SMTP-сервера может быть `localhost`. Это связано с тем, что после публикации и того, как сайт работает на сервере поставщика, почтовый сервер может быть локальным с точки зрения приложения. Это изменение в именах серверов может означать, что необходимо изменить имя SMTP-сервера как часть процесса публикации.
     > - Номер порта обычно равен 25. Однако для некоторых поставщиков требуется использовать порт 587 или другой порт.
     > - Убедитесь, что используются правильные учетные данные. Если сайт опубликован на поставщике услуг размещения, используйте учетные данные, указанные поставщиком, для электронной почты. Они могут отличаться от учетных данных, используемых для публикации.
     > - Иногда вам не нужны учетные данные. Если вы отправляете электронную почту с помощью личного поставщика услуг Интернета, ваш поставщик электронной почты может уже узнавать ваши учетные данные. После публикации может потребоваться использовать другие учетные данные, чем при тестировании на локальном компьютере.
     > - Если поставщик электронной почты использует шифрование, необходимо задать для `WebMail.EnableSsl` значение `true`.
4. Запустите страницу *EmailRequest. cshtml* в браузере. (Перед выполнением страницы убедитесь, что она выбрана в рабочей области **файлы** .)
5. Введите имя и описание проблемы, а затем нажмите кнопку Submit ( **Отправить** ). Вы будете перенаправлены на страницу *ProcessRequest. cshtml* , которая подтверждает сообщение и отправляет вам сообщение электронной почты. 

    ![[образ]](11-adding-email-to-your-web-site/_static/image2.jpg)

<a id="Sending_a_File"></a>
## <a name="sending-a-file-using-email"></a>Отправка файла по электронной почте

Также можно отправлять файлы, вложенные в сообщения электронной почты. В этой процедуре создается текстовый файл и две страницы HTML. Этот текстовый файл будет использоваться как вложение электронной почты.

1. На веб-сайте добавьте новый текстовый файл и назовите его *MyFile. txt*.
2. Скопируйте следующий текст и вставьте его в файл: 

    `Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.`
3. Создайте страницу с именем *sendfile. cshtml* и добавьте следующую разметку: 

    [!code-html[Main](11-adding-email-to-your-web-site/samples/sample3.html)]
4. Создайте страницу с именем *процессфиле. cshtml* и добавьте следующую разметку: 

    [!code-cshtml[Main](11-adding-email-to-your-web-site/samples/sample4.cshtml)]
5. Измените следующие параметры, связанные с электронной почтой, в коде из примера:

    - Присвойте `your-SMTP-host` имя SMTP-сервера, к которому у вас есть доступ.
    - Задайте `your-user-name-here` имя пользователя для учетной записи SMTP-сервера.
    - Задайте для `your-email-address-here` собственный адрес электронной почты. Это адрес электронной почты, с которого отправляется сообщение.
    - Задайте `your-account-password` пароль для учетной записи SMTP-сервера.
    - Задайте для `target-email-address-here` собственный адрес электронной почты. (Как и раньше, вы обычно отправляете сообщение электронной почты кому-то другому, но для тестирования его можно отправить самому себе.)
6. Запустите страницу *sendfile. cshtml* в браузере.
7. Введите имя, строку темы и имя текстового файла для присоединения (*MyFile. txt*).
8. Нажмите кнопку `Submit`. Как и ранее, вы будете перенаправлены на страницу *процессфиле. cshtml* , которая подтверждает сообщение и отправляет вам сообщение электронной почты с прикрепленным файлом.

<a id="Additional_Resources"></a>
## <a name="additional-resources"></a>Дополнительные ресурсы

- [Руководство по устранению неполадок веб-страниц ASP.NET (Razor)](https://go.microsoft.com/fwlink/?LinkId=253001)
- [Простой протокол обмена электронной почтой](https://msdn.microsoft.com/library/aa480435.aspx)
- [Настройка поведения на уровне сайта для веб-страницы ASP.NET](https://go.microsoft.com/fwlink/?LinkId=202906)
