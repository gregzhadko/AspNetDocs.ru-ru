---
uid: web-pages/overview/getting-started/introducing-aspnet-web-pages-2/entering-data
title: Знакомство с веб-страниц ASP.NET — ввод данных базы данных с помощью форм | Документация Майкрософт
author: Rick-Anderson
description: Этом руководстве показано, как создать форму ввода, а затем введите данные, которые вы получаете из формы в таблицу базы данных при использовании веб-страниц ASP.NET (...)
ms.author: riande
ms.date: 05/28/2015
ms.assetid: d37c93fc-25fd-4e94-8671-0d437beef206
msc.legacyurl: /web-pages/overview/getting-started/introducing-aspnet-web-pages-2/entering-data
msc.type: authoredcontent
ms.openlocfilehash: b9354a7b97a7df9020a681f709e16a92650cfcf0
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2019
ms.locfileid: "65132974"
---
# <a name="introducing-aspnet-web-pages---entering-database-data-by-using-forms"></a>Знакомство с веб-страниц ASP.NET — ввод данных базы данных с помощью форм

по [Tom FitzMacken](https://github.com/tfitzmac)

> Этом руководстве показано, как создать форму ввода, а затем введите данные, которые вы получаете из формы в таблицу базы данных при использовании веб-страниц ASP.NET (Razor). Предполагается, вы выполнили рядов через [основы из HTML-формы ASP.NET Web Pages](https://go.microsoft.com/fwlink/?LinkId=251581).
> 
> Вы узнаете, как:
> 
> - Дополнительные сведения о способах обработки форм ввода.
> - Инструкции по добавлению данных (insert) в базе данных.
> - Как убедиться, что пользователи ввели обязательное значение в форме (как для проверки ввода пользователя).
> - Способ отображения ошибок проверки.
> - Как перейти на другую страницу с текущей страницы.
>   
> 
> Функции и технологии:
> 
> - метод `Database.Execute` ;
> - SQL `Insert Into` инструкции
> - `Validation` Вспомогательный.
> - метод `Response.Redirect` ;

## <a name="what-youll-build"></a>Что вы создадите

В этом руководстве ранее, показано, как создать базу данных, введенные данные базы данных путем изменения базы данных непосредственно в WebMatrix, работа **базы данных** рабочей области. В большинстве приложений, не является удобным способом поместить данные в базу данных, однако. Поэтому в этом руководстве вы создадите веб-интерфейс, который позволяет вам или всем пользователям вводить данные и сохраните его в базу данных.

Вы создадите страницу, где можно ввести новых фильмов. Эта страница будет содержать форму ввода с полями (текстовые поля), где можно ввести название фильма, Жанр и год. Эта страница будет выглядеть страница:

![Страница «Добавление фильма» в браузере](entering-data/_static/image1.png)

Текстовые поля будут HTML `<input>` эту разметку, такие как элементы, которые будут выглядеть:

`<input type="text" name="genre" value="" />`

## <a name="creating-the-basic-entry-form"></a>Создание формы основные операции

Создание страницы с именем *AddMovie.cshtml*.

Замените в файле, используя следующую разметку. Перезаписать все; Вы добавите блок кода в верхней чуть ниже.

[!code-cshtml[Main](entering-data/samples/sample1.cshtml)]

Этот пример показывает типичный HTML для создания формы. Она использует `<input>` элементов для текстовых полей и кнопки отправки. Заголовки для текстовых полей создаются с помощью стандарта `<label>` элементов. `<fieldset>` И `<legend>` элементы обнести неплохо формы.

Обратите внимание, что на этой странице `<form>` элемент использует `post` как значение для `method` атрибута. В предыдущем руководстве вы создали форму, которая используется `get` метод. Это было правильным, так как несмотря на то, что значения на сервер отправить форму, запрос, не вносить изменения. Все, что и было извлекать данные по-разному. Однако в этой странице вы *будет* внести изменения, вы собираетесь добавить новые записи базы данных. Таким образом, следует использовать эту форму `post` метод. (Дополнительные сведения о различиях между `GET` и `POST` операций, см. в разделе[GET, POST и HTTP Verb безопасности](https://go.microsoft.com/fwlink/?LinkId=251581#GET,_POST,_and_HTTP_Verb_Safety) боковой панели в предыдущем руководстве.)

Обратите внимание, что каждое текстовое поле имеет `name` элемент (`title`, `genre`, `year`). Как было показано в предыдущем учебном курсе, эти имена важны, так как необходимо иметь эти имена, чтобы позже получить входные данные пользователя. Можно использовать любые имена. Рекомендуется использовать осмысленные имена, которые помогут вам помните, какие данные, которыми вы работаете.

`value` Каждого элемента `<input>` элемент содержит немного кода Razor (например, `Request.Form["title"]`). Вы узнали версию этот прием в предыдущем руководстве, чтобы сохранить значение, введенное в текстовое поле (если таковые имеются), после отправки формы.

## <a name="getting-the-form-values"></a>Получение значения формы

Добавьте код, обрабатывающий форму. В структуре потребуется следующее:

1. Проверьте, является ли страница передается (отправки). Требуется код для запуска только в том случае, когда пользователи щелкнут кнопки, не в том случае, при первом запуске страницы.
2. Получение значения, введенные пользователем в текстовых полях. В этом случае потому, что использование формы `POST` команды, вы получаете значения формы из `Request.Form` коллекции.
3. Вставить значения в виде новой записи в *фильмы* таблицы базы данных.

В верхней части файла добавьте следующий код:

[!code-cshtml[Main](entering-data/samples/sample2.cshtml)]

Первые несколько строк создайте переменные (`title`, `genre`, и `year`) для хранения значений из текстовых полей. Строки `if(IsPost)` гарантирует, что переменные заданы *только* когда пользователь нажимает кнопку **добавьте фильма** кнопка — то есть, когда после отправки формы.

Как было показано в предыдущем руководстве, вы получаете значение текстового поля с помощью выражения, подобного `Request.Form["name"]`, где *имя* имя `<input>` элемент.

Имена переменных (`title`, `genre`, и `year`) являются произвольными. Нравятся имена, которые назначены `<input>` элементов, их можно вызывать любое название. (Имена переменных не должны совпадать атрибуты name `<input>` элементов в форме.) Но, как с помощью `<input>` элементов не следует использовать имена переменных, отражающие данные, которые они содержат. При написании кода, согласованные имена упрощают помнить какие данные, которыми вы работаете.

## <a name="adding-data-to-the-database"></a>Добавление данных в базу данных

В коде блока вы только что добавленную, просто *внутри* закрывающей фигурной скобкой ( `}` ) из `if` блокировать (не только внутри блока кода), добавьте следующий код:

[!code-csharp[Main](entering-data/samples/sample3.cs)]

Этот пример похож на код, который использовался в предыдущем руководстве, для получения и отображения данных. Строку, начинающуюся с `db =` откроется, базе данных, как и раньше и следующая строка определяет инструкцию SQL, еще раз как мы делали раньше. Тем не менее, это время он определяет SQL `Insert Into` инструкции. В следующем примере показано общий синтаксис `Insert Into` инструкции:

`INSERT INTO table (column1, column2, column3, ...) VALUES (value1, value2, value3, ...)`

Другими словами укажите таблицы для вставки в, затем список столбцов для вставки в, а затем список значений для вставки. (Как было отмечено ранее, SQL выполняется без учета регистра, но некоторые люди реализуйте весь потенциал ключевые слова, чтобы сделать более удобным для чтения, команде).

Столбцы, на которые осуществляется вставка в уже перечисляются в команде — `(Title, Genre, Year)`. Особый интерес представляет как получить значения из текстовых полей в `VALUES` частью команды. Вместо фактических значений, пользователь видит `@0`, `@1`, и `@2`, само собой, которые являются заполнителями. При запуске команды (на `db.Execute` строки), вы передадите эти значения, которые вы получили текстовые поля.

**Важно!** Помните, что единственным способом, никогда не следует включать данные, введенные в интерактивном режиме пользователем в инструкцию SQL использовать заполнители, как показано ниже (`VALUES(@0, @1, @2)`). Если вы объединяйте введенные пользователем данные в одну инструкцию SQL, открытии самостоятельно к атакам путем внедрения кода SQL, как описано в [основы форм в ASP.NET Web Pages](https://go.microsoft.com/fwlink/?LinkId=251581) (предыдущем учебном курсе).

По-прежнему внутри `if` block, добавьте следующую строку после `db.Execute` строки:

[!code-css[Main](entering-data/samples/sample4.css)]

После вставки в базу данных новый фильм, эта строка к блоку вы (перенаправление) *фильмы* странице, чтобы можно было видеть фильма, только что ввели. `~` Оператор означает «root веб-сайта». ( `~` Оператор обычно работает только на страницах ASP.NET, не в формате HTML.)

Законченный блок кода выглядит следующим образом:

[!code-cshtml[Main](entering-data/samples/sample5.cshtml)]

## <a name="testing-the-insert-command-so-far"></a>Тестирование команды вставки (пока)

Вы еще не завершили работу, но сейчас самое время для тестирования.

В представлении в виде дерева файлов в WebMatrix, щелкните правой кнопкой мыши *AddMovie.cshtml* странице и нажмите кнопку **запустить в браузере**.

![Страница «Добавление фильма» в браузере](entering-data/_static/image2.png)

(Если вы получите на другую страницу в браузере, убедитесь, что URL-адрес является `http://localhost:nnnnn/AddMovie`), где *nnnnn* — номер порта, который вы используете.)

Вы получили страницу ошибки? Если Да, следует внимательно прочитать и убедитесь, что код выглядит точно так что было указано ранее.

Введите фильм в форме &mdash; к примеру, используйте «Гражданин Кейн», «Драма» и «1941». (И т. д.) Нажмите кнопку **добавьте фильма**.

Если все работает правильно, вы будете перенаправлены *фильмы* страницы. Убедитесь, что указан новый фильм.

![Страница фильмы, показывающий вновь добавлена фильма](entering-data/_static/image3.png)

## <a name="validating-user-input"></a>Проверка вводимых пользователем данных

Вернитесь к *AddMovie* странице, или запустите ее повторно. Введите другой фильма, но на этот раз, введите только заголовок &mdash; к примеру, введите «"Войти в дождь». Нажмите кнопку **добавьте фильма**.

Вы будете перенаправлены *фильмы* странице еще раз. Можно найти этот новый фильм, но он не полон.

![Фильмы страницы отображение новый фильм, отсутствуют некоторые значения](entering-data/_static/image4.png)

При создании *фильмы* таблицы, вы явным образом сказали, что ни одно из полей может иметь значение null. Здесь имеется форма ввода новых фильмов, и вы тратите поля пустым. Это является ошибкой.

В этом случае не вызывать базы данных фактически (или *throw*) произошла ошибка. Вы не указали жанр или года, поэтому код в *AddMovie* страницы считать эти значения так называемые *пустые строки*. Когда SQL `Insert Into` выполнялась команда, Жанр и год поля не содержат полезные данные в них, но они не были null.

Очевидно, что вы не хотите разрешить пользователям вводить сведения о фильме половину пустым в базу данных. Решение заключается в том, чтобы проверить введенные пользователем данные. Изначально проверка будет просто убедитесь, что пользователь ввел значение для всех полей (таким образом, что ни один из них содержит пустую строку).

> [!TIP]
> 
> **NULL и пустые строки**
> 
> В программировании, нет разницы между разных понятия «нет значения». В общем случае имеет значение *null* если он никогда не были заданы или инициализироваться. Напротив, может быть присвоено переменной, которая ожидает символьных данных (строк) *пустая строка*. В этом случае значение не равно null; она просто была задана явным образом в строку символов, длина которого равна нулю. Следующие два оператора показаны различия:
> 
> [!code-csharp[Main](entering-data/samples/sample6.cs)]
> 
> Это немного сложнее, чем, но важным моментом является то, что `null` представляет собой неопределенном состоянии.
> 
> И это важно понимать точно когда значение равно null, и когда это просто пустая строка. В коде для *AddMovie* будет включать значения из текстовых полей с помощью `Request.Form["title"]` и т. д. При первом запуске страницы (до нажатия кнопки), значение `Request.Form["title"]` имеет значение null. Но при отправке формы, `Request.Form["title"]` получает значение `title` текстовое поле. Это не очевидно, но в пустом текстовом поле не имеет значение null; он просто содержит пустую строку. Поэтому при выполнении кода в ответ на кнопки щелкните, `Request.Form["title"]` содержит пустую строку в нем.
> 
> Почему важно это различие? При создании *фильмы* таблицы, вы явным образом сказали, что ни одно из полей может иметь значение null. Но здесь имеется форма ввода новых фильмов, и вы уходите поля пустым. Можно ожидать достаточно базе возникнут претензии при попытке сохранить новых фильмов, которые не имеют значения для жанра или год. Но, являющийся точкой &mdash; даже если эти текстовые поля оставить пустым, значения не null; они пустые строки. Таким образом, вы сможете сохранить новых фильмов в базе данных с этими столбцами пустой &mdash; , но не null! значения типа &mdash;. Таким образом необходимо убедиться, что пользователи не отправляйте является пустой строкой, что можно сделать путем проверки входных данных пользователя.

### <a name="the-validation-helper"></a>Вспомогательная функция проверке

Веб-страниц ASP.NET включает в себя вспомогательный объект &mdash; `Validation` вспомогательный &mdash; , можно использовать для убедитесь, что пользователи вводят данные, который соответствует вашим требованиям. `Validation` Вспомогательный является одним из вспомогательных методов, который встроен в для веб-страниц в ASP.NET, поэтому не нужно установить его в виде пакета с помощью NuGet, способ установки вспомогательных Gravatar в предыдущем руководстве.

Чтобы проверить введенные пользователем данные, потребуется следующее:

- Используйте код, чтобы указать, что требуются значения в текстовых полях на странице.
- Поместите в код теста, чтобы сведения о фильме добавляется в базу данных только в том случае, если все, что проверяет, правильно.
- Добавьте код в разметку для отображения сообщения об ошибках.

В блоке кода в *AddMovie* странице, прямо в верхней до объявления переменных, добавьте следующий код:

[!code-csharp[Main](entering-data/samples/sample7.cs)]

Вы вызываете `Validation.RequireField` один раз для каждого поля (`<input>` элемент) где требуется запись. Можно также добавить пользовательское сообщение об ошибке для каждого вызова, как показано ниже. (Мы различные сообщения, чтобы показать, что можно поместить любое существует).

Если имеется проблема, вы хотите предотвратить новые сведения о фильме будет вставлена в базу данных. В `if(IsPost)` block, используйте `&&` (логическое и), чтобы добавить другое условие, которое проверяет `Validation.IsValid()`. Когда все будет готово, весь `if(IsPost)` блока выглядит как следующий код:

[!code-csharp[Main](entering-data/samples/sample8.cs)]

Если имеется ошибка проверки в любом из полей, которые зарегистрированы с помощью `Validation` helper, `Validation.IsValid` метод возвращает значение false. И в этом случае ни один из кода в соответствующем блоке будет запущен, поэтому нет записей недопустимый фильм будет вставлен в базе данных. И конечно вы не перейдете *фильмы* страницы.

Законченный блок кода, включая код проверки, теперь выглядит следующим образом:

[!code-cshtml[Main](entering-data/samples/sample9.cshtml?highlight=10)]

## <a name="displaying-validation-errors"></a>Отображение ошибок проверки

Последним шагом является отображение сообщения об ошибках. Можно отобразить отдельных сообщений для каждой ошибки проверки, или можно отобразить сводные данные, или оба. В этом руководстве вы выполните оба таким образом, чтобы можно было увидеть, как это работает.

Рядом с каждым `<input>` элемент, который проверка, вызов `Html.ValidationMessage` метод и передать его имя `<input>` элемент, проверка. Поместить `Html.ValidationMessage` метод точное сообщение об ошибке для отображения. При запуске страницы, `Html.ValidationMessage` метод отрисовывает `<span>` элемент, которому будет переходить к ошибке проверки. (Если ошибки отсутствуют, `<span>` элемент отображается, но в нем отсутствует текст.)

Измените разметку в странице, таким образом, чтобы он включал `Html.ValidationMessage` метод для каждого из трех `<input>` элементов на странице, как показано в примере:

[!code-cshtml[Main](entering-data/samples/sample10.cshtml?highlight=3,8,13)]

Чтобы увидеть, как работает сводки, также добавьте следующую разметку и код сразу после `<h1>Add a Movie</h1>` элемента на странице:

[!code-cshtml[Main](entering-data/samples/sample11.cshtml)]

По умолчанию `Html.ValidationSummary` метод отображает все сообщения проверки в списке ( `<ul>` элемент, который находится внутри `<div>` элемент). Как и в `Html.ValidationMessage` метод, разметку для сводки проверки отображается всегда; при возникновении ошибки, не элементы списка отображаются.

Сводные данные могут быть альтернативный способ отображения сообщений проверки, а не с помощью `Html.ValidationMessage` метод для отображения каждой ошибки конкретных полей. Или можно использовать сводные данные и сведения. Или можно использовать `Html.ValidationSummary` метод для отображения общей ошибки и затем с помощью отдельных `Html.ValidationMessage` вызовы, чтобы отобразить подробные сведения.

Страницы теперь выглядит как в следующем примере:

[!code-cshtml[Main](entering-data/samples/sample12.cshtml)]

Вот и все. Теперь можно проверить страницы путем добавления фильм, но оставив один или несколько полей. При этом может появиться следующая ошибка отображения:

![Добавить страницу фильма, отображение сообщения об ошибках проверки](entering-data/_static/image5.png)

## <a name="styling-the-validation-error-messages"></a>Задание стиля сообщений об ошибках проверки

Вы увидите, что существуют сообщения об ошибках, но не выделяются действительно очень хорошо. Есть простой способ применения стиля сообщения об ошибках, но.

Для стиля сообщения об отдельных ошибках, которые отображаются по `Html.ValidationMessage`, создайте класс стиля CSS, с именем `field-validation-error`. Чтобы определить внешний вид для сводки проверки, необходимо создать класс стиля CSS с именем `validation-summary-errors`.

Чтобы увидеть, как работает этот метод, добавьте `<style>` элемент внутри `<head>` раздел страницы. Затем определите классов с именем `field-validation-error` и `validation-summary-errors` , содержащие следующие правила:

[!code-cshtml[Main](entering-data/samples/sample13.cshtml?highlight=4-17)]

Обычно скорее разместить сведения о стиле в отдельную *.css* файл, но для простоты вы можете поместить их в страницу сейчас. (Позже в рамках этого учебного курса, вы сделаете правила CSS в отдельный *.css* файл.)

При возникновении ошибки проверки, `Html.ValidationMessage` метод отрисовывает `<span>` элемент, который включает в себя `class="field-validation-error"`. Добавление определения стиля для этого класса, можно настроить, как выглядит сообщение. При возникновении ошибок, `ValidationSummary` метод аналогично динамически отображает атрибут `class="validation-summary-errors"`.

Снова запустить страницу и специально оставить несколько полей. Ошибки теперь более заметны. (На самом деле, они все overdone, но это просто для того, чтобы показать, что можно делать.)

![Добавить страницу фильма, отображение ошибок проверки, которые были стиль](entering-data/_static/image6.png)

## <a name="adding-a-link-to-the-movies-page"></a>Добавление ссылки на страницу Movies

Последний шаг — сделать ее удобнее получать для *AddMovie* страницы из исходного списка фильмов.

Откройте *фильмы* странице еще раз. После закрывающего `</div>` тег, который следует за `WebGrid` вспомогательного приложения, добавьте следующую разметку:

[!code-cshtml[Main](entering-data/samples/sample14.cshtml)]

Как мы делали раньше, ASP.NET интерпретирует `~` оператор в корневом веб-сайта. Нет необходимости использовать `~` оператора; можно использовать разметку `<a href="./AddMovie">Add a movie</a>` или другим способом для определения пути, который понимает HTML. Но `~` оператор — хороший общие подход при создании ссылки для Razor pages, так как его узел становится более гибким, при перемещении текущей страницы во вложенную папку, ссылка будет по-прежнему указывать на *AddMovie* страницы. (Помните, что `~` оператор работает только *.cshtml* страниц. ASP.NET понимает его, но это не стандартный HTML.)

Когда все будет готово, запустите *фильмы* страницы. Он имеет вид этой страницы:

![Страницу Movies со ссылкой на страницу «Добавление фильмы»](entering-data/_static/image7.png)

Нажмите кнопку **добавления фильма** ссылку, чтобы убедиться в том, что она ведет к *AddMovie* страницы.

## <a name="coming-up-next"></a>В ближайшее время

В следующем руководстве вы узнаете, как разрешить пользователям редактировать данные, которые уже находится в базе данных.

## <a name="complete-listing-for-addmovie-page"></a>Полный пример для AddMovie страницы

[!code-cshtml[Main](entering-data/samples/sample15.cshtml)]

## <a name="additional-resources"></a>Дополнительные ресурсы

- [Введение в программирование веб-ASP.NET, с помощью синтаксиса Razor](https://go.microsoft.com/fwlink/?LinkID=202890)
- [SQL в инструкции INSERT](http://www.w3schools.com/sql/sql_insert.asp) на сайте W3Schools
- [Проверка вводимых пользователем данных в ASP.NET Web Pages сайты](https://go.microsoft.com/fwlink/?LinkId=253002). Дополнительные сведения о работе с `Validation` вспомогательный.

> [!div class="step-by-step"]
> [Назад](form-basics.md)
> [Вперед](updating-data.md)
