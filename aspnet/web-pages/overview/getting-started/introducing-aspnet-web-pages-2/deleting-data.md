---
uid: web-pages/overview/getting-started/introducing-aspnet-web-pages-2/deleting-data
title: Знакомство с веб-страниц ASP.NET — удаление базы данных | Документация Майкрософт
author: Rick-Anderson
description: Этом руководстве показано, как удалить запись отдельной базы данных. Предполагается, что завершена рядов через обновление базы данных в ASP.NET Web АП...
ms.author: riande
ms.date: 01/02/2018
ms.assetid: 75b5c1cf-84bd-434f-8a86-85c568eb5b09
msc.legacyurl: /web-pages/overview/getting-started/introducing-aspnet-web-pages-2/deleting-data
msc.type: authoredcontent
ms.openlocfilehash: e9ffe0ea3e2bf817675a4a771d3471ec6eb91133
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59406747"
---
# <a name="introducing-aspnet-web-pages---deleting-database-data"></a>Знакомство с веб-страниц ASP.NET — удаление базы данных

по [Tom FitzMacken](https://github.com/tfitzmac)

> Этом руководстве показано, как удалить запись отдельной базы данных. Предполагается, вы выполнили рядов через [обновление базы данных в ASP.NET Web Pages](updating-data.md).
> 
> Вы узнаете, как:
> 
> - Как выбрать отдельную запись из списка записей.
> - Как удалить запись из базы данных.
> - Как проверить, что определенные нажатие кнопки в форме.
>   
> 
> Функции и технологии:
> 
> - `WebGrid` Вспомогательный.
> - SQL `Delete` команды.
> - `Database.Execute` Метод для выполнения SQL `Delete` команды.


## <a name="what-youll-build"></a>Что вы создадите

В предыдущем руководстве вы узнали, как обновить существующую запись базы данных. Это руководство представляет собой подобно, за исключением того, что вместо обновления запись, вы удалите его. Процессы являются практически так же, за исключением того, что удаление проще использовать, поэтому здесь будет короткий.

В *фильмы* обновим страницу, `WebGrid` вспомогательный, потому что он отображается как **удалить** ссылку рядом с каждой фильма, сопровождающее **изменить** ссылку, добавленный ранее.

![Страница ссылки для каждого из фильмов](deleting-data/_static/image1.png)

Как и в редактирования, при нажатии кнопки **удалить** ссылку, откроется на другую страницу, где сведения о фильме уже находится в форме:

![Удалить страницу фильмов с фильмом отображается](deleting-data/_static/image2.png)

Можно затем нажмите кнопку для удаления записи без возможности восстановления.

## <a name="adding-a-delete-link-to-the-movie-listing"></a>Добавление ссылки к списку фильмов

Начнем с добавления **удалить** связать `WebGrid` вспомогательный. Эту ссылку, аналогичную **изменить** ссылка добавлена в предыдущем руководстве.

Откройте *Movies.cshtml* файла.

Изменение `WebGrid` разметки в основной области страницы, добавив столбец. Ниже приведен измененной разметкой.

[!code-html[Main](deleting-data/samples/sample1.html?highlight=9-10)]

Новый столбец является такой:

[!code-html[Main](deleting-data/samples/sample2.html)]

Способ настройки сетки **изменить** столбец крайние левые в сетке и **удалить** крайний правый столбец. (Отсутствует запятая после `Year` столбец, в случае, если можно не заметить, что.) Нет ничего особенного куда эти столбцы ссылку, и можно так же легко, поместить их рядом друг с другом. В этом случае они отдельный, которое затрудняет их смешанным.

![Страница фильмов с помощью ссылки "Изменить" и "сведения о отмечена Показать, что они не являются рядом друг с другом](deleting-data/_static/image3.png)

Новый столбец отображается ссылка (`<a>` элемент), текст которых говорит: «Удалить». Цель ссылки (его `href` атрибут) — это код, который в конечном счете разрешается в нечто вроде этот URL-адрес с `id` значение отличается для каждого фильма:

[!code-css[Main](deleting-data/samples/sample3.css)]

Эта ссылка будет вызывать страницу с именем *DeleteMovie* и передать ему идентификатор фильма, вы выбрали.

Этот учебник не вдаваться в подробности об правила составления эту ссылку, так как это почти идентичен **изменить** ссылку из предыдущего учебного курса ([обновление базы данных в ASP.NET Web Pages](updating-data.md)).

## <a name="creating-the-delete-page"></a>Создание страницы "Delete"

Теперь вы можете создать страницу, которая будет целевой для **удалить** ссылку в сетке.

> [!NOTE] 
> 
> **Важные** метод сначала выбрать запись для удаления, и затем с помощью отдельной странице и кнопки, для подтверждения процесс очень важно для безопасности. Как уже говорилось в предыдущих учебных курсах, делая *любой* изменений на веб-сайт должен *всегда* сделать с помощью формы &mdash; то есть с помощью операции HTTP POST. Если Вы дали изменение сайта только по ссылке (то есть с использованием операции GET), может выполнять простые запросы к веб-узла и удалять данные. Даже поисковой системой, индексирования сайт случайно может вызвать удаление данных только по следующим ссылкам.
> 
> Если приложение разрешает пользователям изменить запись, вам нужно пользователь получает записи для редактирования в любом случае. Но у вас может возникнуть желание пропустить этот шаг для удаления записи. Однако не пропускайте этот шаг. (Это также полезно для пользователей см. запись и убедитесь, что они удалить запись, они предназначены.)
> 
> В последующих учебного набора вы увидите, как добавить функции входа в систему, чтобы пользователю нужно войти, прежде чем удаление записи.


Создание страницы с именем *DeleteMovie.cshtml* и замените в файле, используя следующую разметку:

[!code-cshtml[Main](deleting-data/samples/sample4.cshtml)]

Эта разметка аналогичен *EditMovie* страниц, но вместо использования текстовых полей (`<input type="text">`), разметка включает `<span>` элементов. Нет ничего здесь, чтобы изменить. Что необходимо сделать всего лишь отображения сведений о фильмах, таким образом, пользователи могут убедиться, что они удаления правой фильма.

Разметка уже содержит ссылку, которая дает пользователю возможность вернуться на страницу список фильмов.

Как и в *EditMovie* страницы, идентификатор выбранный фильм сохраняется в скрытом поле. (Он передается на страницу в первую очередь как значения строки запроса.) Существует `Html.ValidationSummary` вызов, который будет отображать ошибки проверки. В этом случае ошибка может быть, что идентификатор фильма, не был передан на страницу или что идентификатор фильма является недопустимым. Такая ситуация может возникать, если кто-то работал эту страницу без его предварительного выбора фильм в *фильмы* страницы.

Подпись кнопки — **удалить фильма**, и его имя атрибута задано значение `buttonDelete`. `name` Атрибут будет использоваться в коде для обозначения кнопки отправки формы.

Вы напишете код для 1) чтения сведений о фильмах, при первом отображении страницы и (2) фактическое удаление фильм, когда пользователь нажимает кнопку.

## <a name="adding-code-to-read-a-single-movie"></a>Добавление кода для чтения одного фильма

В верхней части *DeleteMovie.cshtml* странице, добавьте следующий блок кода:

[!code-cshtml[Main](deleting-data/samples/sample5.cshtml)]

Эта разметка совпадает со значением соответствующий код в *EditMovie* страницы. Он получает идентификатор фильма из строки запроса и использует идентификатор для чтения записи из базы данных. Код включает проверку (`IsInt()` и `row != null`) чтобы убедиться в том, что идентификатор фильма, передаваемого на страницу является допустимым.

Помните, что этот код следует запускать только в первый раз страница выполняется. Вы не хотите повторное чтение запись фильма из базы данных, когда пользователь щелкает **удалить фильма** кнопки. Таким образом, код для чтения фильма находится внутри тест, который говорит `if(!IsPost)` &mdash; т.е *Если запрос не операцию post (отправки формы)*.

## <a name="adding-code-to-delete-the-selected-movie"></a>Добавление кода, чтобы удалить выбранный фильм

Чтобы удалить фильм, когда пользователь нажимает кнопку, добавьте следующий код внутри закрывающую скобку `@` блок:

[!code-csharp[Main](deleting-data/samples/sample6.cs)]

Этот код аналогичен коду для обновления существующей записи, но проще. По сути, код выполняет SQL `Delete` инструкции.

 Как и в *EditMovie* странице код находится в `if(IsPost)` блока. На этот раз `if()` немного сложнее ситуация: 

[!code-csharp[Main](deleting-data/samples/sample7.cs)]

Существует два условия здесь. Во-первых, что идет отправка страницы, как вы уже видели &mdash; `if(IsPost)`.

Второе: `!Request["buttonDelete"].IsEmpty()`, это означает, что запрос содержит объект с именем `buttonDelete`. Конечно он является косвенным способом тестирования, какая кнопка отправки формы. Если форма содержит несколько кнопок отправки, в запросе отображается только имя кнопки, которая была нажата. Таким образом, логически Если имя конкретной кнопки отображается в запросе &mdash; или как указано в коде, если эта кнопка не является пустой &mdash; , при нажатии кнопки отправки формы.

`&&` Означает, что оператор «и» (логическое и). Таким образом весь `if` условие...

*Этот запрос является публикацией (не первого запроса)*  
  
 AND  
  
*`buttonDelete`Была* *кнопка кнопки отправки формы.*

Эта форма (на самом деле, эта страница) содержит только одна кнопка, поэтому проверка значения дополнительных `buttonDelete` технически не является обязательным. Тем не менее которые вы собираетесь выполнить операцию, приведет к окончательному удалению данных. Таким образом вы хотите быть в том, как можно более, что вы выполняете операцию только в том случае, когда пользователь явно запрашивает его. Например предположим, что расширить эту страницу позже и добавить другие кнопки к ним. Даже в таком случае код, который удаляет фильм будет выполняться только в том случае, если `buttonDelete` была нажата кнопка.

Как и в *EditMovie* страницы, получите идентификатор из скрытого поля, а затем выполните команду SQL. Синтаксис `Delete` инструкция является:

`DELETE FROM table WHERE ID = value`

Крайне важно включить `WHERE` предложение и идентификатор. Если опустить предложение WHERE, *будут удалены все записи в таблице*. Как вы уже видели, можно передать значение идентификатора команду SQL с помощью заполнителя.

## <a name="testing-the-movie-delete-process"></a>Тестирование процесса удаления фильма

Теперь можно протестировать. Запустите *фильмы* и нажмите кнопку **удалить** рядом с фильм. Когда *DeleteMovie* появится страница, нажмите кнопку **удалить фильма**.

![Удалить страницу фильма с выделенной кнопкой "Удалить фильма"](deleting-data/_static/image4.png)

При нажатии кнопки код удаляет фильмов и возвращает список фильмов. Там можно найти удаленные фильма и убедитесь, что оно будет удалено.

## <a name="coming-up-next"></a>В ближайшее время

Следующее руководство показано, как предоставить все страницы узла, общий внешний вид и макет.

## <a name="complete-listing-for-movie-page-updated-with-delete-links"></a>Полный пример для страницы фильма (обновление с помощью ссылок удаления)

[!code-cshtml[Main](deleting-data/samples/sample8.cshtml)]

## <a name="complete-listing-for-deletemovie-page"></a>Полный пример для DeleteMovie страницы

[!code-cshtml[Main](deleting-data/samples/sample9.cshtml)]

## <a name="additional-resources"></a>Дополнительные ресурсы

- [Введение в программирование веб-ASP.NET с помощью синтаксиса Razor](../introducing-razor-syntax-c.md)
- [Инструкция DELETE SQL](http://www.w3schools.com/sql/sql_delete.asp) на сайте W3Schools

> [!div class="step-by-step"]
> [Назад](updating-data.md)
> [Вперед](layouts.md)
