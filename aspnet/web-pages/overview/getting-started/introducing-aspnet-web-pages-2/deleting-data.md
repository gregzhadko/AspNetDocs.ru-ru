---
uid: web-pages/overview/getting-started/introducing-aspnet-web-pages-2/deleting-data
title: Введение веб-страницы ASP.NET-удаление данных базы данных | Документация Майкрософт
author: Rick-Anderson
description: В этом учебнике показано, как удалить отдельную запись базы данных. Предполагается, что вы выполнили цикл по обновлению данных базы данных в ASP.NET Web PA...
ms.author: riande
ms.date: 01/02/2018
ms.assetid: 75b5c1cf-84bd-434f-8a86-85c568eb5b09
msc.legacyurl: /web-pages/overview/getting-started/introducing-aspnet-web-pages-2/deleting-data
msc.type: authoredcontent
ms.openlocfilehash: c8620fc1abc61d514bdc039c66f7a84e67e89abe
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78510462"
---
# <a name="introducing-aspnet-web-pages---deleting-database-data"></a>Введение веб-страницы ASP.NET-удаление данных базы данных

от [Tom фитзмаккен](https://github.com/tfitzmac)

> В этом учебнике показано, как удалить отдельную запись базы данных. Предполагается, что вы выполнили цикл по [обновлению данных базы данных в веб-страницы ASP.NET](updating-data.md).
> 
> Из этого руководства вы узнаете, как выполнять такие задачи:
> 
> - Выбор отдельной записи из списка записей.
> - Удаление одной записи из базы данных.
> - Как проверить, была ли нажата определенная кнопка в форме.
>   
> 
> Обсуждаемые функции и технологии:
> 
> - Вспомогательный метод `WebGrid`.
> - Команда SQL `Delete`.
> - Метод `Database.Execute` для выполнения команды SQL `Delete`.

## <a name="what-youll-build"></a>Что вы создадите

В предыдущем руководстве вы узнали, как обновить существующую запись базы данных. Этот учебник аналогичен, но вместо обновления записи вы удалите его. Процессы во многом одинаковы, за исключением того, что удаление упрощается, поэтому этот учебник будет небольшим.

На странице *фильмов* вы обновите вспомогательную функцию `WebGrid`, чтобы она отображала ссылку **Delete (удалить** ) рядом с каждым фильмом, сопровождающую ссылку на **изменение** , добавленную ранее.

![Страница фильмов, на которой показана ссылка для удаления каждого фильма](deleting-data/_static/image1.png)

Как и при редактировании, при щелчке ссылки **Удалить** выполняется переход на другую страницу, где сведения о фильме уже находятся в форме:

![Удаление страницы фильма с отображаемым фильмом](deleting-data/_static/image2.png)

Затем можно нажать кнопку, чтобы удалить запись без возможности восстановления.

## <a name="adding-a-delete-link-to-the-movie-listing"></a>Добавление ссылки на удаление в список фильмов

Начнем с добавления ссылки **Delete** в вспомогательную функцию `WebGrid`. Эта ссылка похожа на ссылку **редактирования** , добавленную в предыдущем руководстве.

Откройте файл *movies. cshtml* .

Измените `WebGrid` разметку в тексте страницы, добавив столбец. Измененная разметка:

[!code-html[Main](deleting-data/samples/sample1.html?highlight=9-10)]

Новый столбец является следующим:

[!code-html[Main](deleting-data/samples/sample2.html)]

Способ настройки сетки, столбец « **Правка** » является крайним левым в сетке, а столбец « **Удаление** » — крайний правый. (В случае, если вы не заметите, есть запятая после `Year` столбца.) Нет ничего особенного, о том, где находятся эти ссылочные столбцы, и можно легко разместить их рядом друг с другом. В этом случае они разделяются, чтобы их было сложнее приступить к изприятию.

![Страница "фильмы" с ссылками "Изменить" и "подробности", помеченными, чтобы показывать, что они не находятся рядом](deleting-data/_static/image3.png)

В новом столбце отображается ссылка (`<a>` элемент), текст которой говорит «DELETE». Целевой объект ссылки (его атрибут `href`) — это код, который, в конечном итоге, разрешается в нечто вроде этого URL-адреса, и `id` значение для каждого фильма отличается.

[!code-css[Main](deleting-data/samples/sample3.css)]

Эта ссылка приведет к вызову страницы с именем *делетемовие* и передаче ей идентификатора выбранного фильма.

В этом учебнике не будет подробно рассмотрено, как создается эта ссылка, так как она почти идентична ссылке **Edit** из предыдущего руководства ([Обновление данных базы данных в веб-страницы ASP.NET](updating-data.md)).

## <a name="creating-the-delete-page"></a>Создание страницы удаления

Теперь можно создать страницу, которая будет целевым объектом для ссылки **Delete** в сетке.

> [!NOTE] 
> 
> **Важно!** Метод сначала выбирает удаляемую запись, а затем использует отдельную страницу и кнопку для подтверждения того, что процесс чрезвычайно важен для обеспечения безопасности. Как вы прочитали в предыдущих учебных курсах, внесение изменений на веб-сайт *всегда* должно выполняться с помощью формы &mdash; *то есть с* помощью операции HTTP POST. Если вы сделали возможным изменение сайта просто щелкнув ссылку (то есть с помощью операции GET), пользователи смогут выполнять простые запросы к сайту и удалять данные. Даже модуль поиска, который индексирует ваш сайт, может случайно удалить данные только по следующим ссылкам.
> 
> Когда приложение позволяет пользователям изменять запись, в любом случае необходимо предоставить пользователю запись для редактирования. Но вы, возможно, пропустите этот шаг, чтобы удалить запись. Но не пропустите этот шаг. (Кроме того, пользователям рекомендуется просматривать записи и подтверждать, что они удаляют записи, которые они предполагали.)
> 
> В последующем наборе руководств вы узнаете, как добавить функции входа в систему, чтобы пользователь мог выполнить вход перед удалением записи.

Создайте страницу с именем *делетемовие. cshtml* и замените содержимое файла следующей разметкой:

[!code-cshtml[Main](deleting-data/samples/sample4.cshtml)]

Эта разметка похожа на страницы *едитмовие* , за исключением того, что вместо использования текстовых полей (`<input type="text">`) разметка включает `<span>` элементы. Здесь нет ничего редактировать. Все, что нужно сделать, — отобразить сведения о фильме, чтобы пользователи могли убедиться, что они удаляют нужный фильм.

Разметка уже содержит ссылку, которая позволяет пользователю вернуться на страницу со списком фильмов.

Как и на странице *едитмовие* , идентификатор выбранного фильма хранится в скрытом поле. (Он передается на страницу в первом месте как значение строки запроса). Есть `Html.ValidationSummary` вызов, который будет отображать ошибки проверки. В этом случае ошибка может быть вызвана тем, что на страницу не был передан идентификатор фильма или что идентификатор фильма недопустим. Такая ситуация может возникнуть, если кто-то запустил эту страницу без предварительного выбора фильма на странице *фильмов* .

Заголовок кнопки — **удалить фильм**, а его атрибут name имеет значение `buttonDelete`. Атрибут `name` будет использоваться в коде для распознавания кнопки, которая отправила форму.

Вам потребуется написать код в 1) прочитать сведения о фильме при первом отображении страницы и 2) удалить фильм, когда пользователь нажмет кнопку.

## <a name="adding-code-to-read-a-single-movie"></a>Добавление кода для чтения одного фильма

В верхней части страницы *делетемовие. cshtml* добавьте следующий блок кода:

[!code-cshtml[Main](deleting-data/samples/sample5.cshtml)]

Эта разметка аналогична соответствующему коду на странице *едитмовие* . Он получает идентификатор фильма из строки запроса и использует идентификатор для чтения записи из базы данных. Код включает проверочный тест (`IsInt()` и `row != null`), чтобы убедиться, что идентификатор фильма, передаваемый на страницу, является допустимым.

Помните, что этот код должен выполняться только при первом запуске страницы. Вы не хотите повторно считывать запись фильма из базы данных, когда пользователь нажимает кнопку **удалить фильм** . Таким образом, код для чтения фильма находится внутри теста, который говорит `if(!IsPost)` &mdash; то есть, *Если запрос не является операцией POST (отправка формы)* .

## <a name="adding-code-to-delete-the-selected-movie"></a>Добавление кода для удаления выбранного фильма

Чтобы удалить фильм при нажатии кнопки, добавьте следующий код непосредственно в закрывающую фигурную скобку блока `@`:

[!code-csharp[Main](deleting-data/samples/sample6.cs)]

Этот код похож на код для обновления существующей записи, но проще. Код, по сути, выполняет инструкцию SQL `Delete`.

 Как и на странице *едитмовие* , код находится в блоке `if(IsPost)`. На этот раз `if()` условие немного сложнее: 

[!code-csharp[Main](deleting-data/samples/sample7.cs)]

Здесь есть два условия. Первый заключается в том, что страница отправляется, как показано выше &mdash; `if(IsPost)`.

Второе условие — `!Request["buttonDelete"].IsEmpty()`, то есть запрос содержит объект с именем `buttonDelete`. Разумеется, это косвенный способ проверки того, какая кнопка отправила форму. Если форма содержит несколько кнопок отправки, в запросе отображается только имя кнопки, которая была нажата. Таким образом, логически, если имя определенной кнопки появляется в запросе &mdash; или как указано в коде, если эта кнопка не пуста &mdash; это кнопка, которая отправляла форму.

Оператор `&&` означает "and" (логическое и). Таким образом, все `if` условие имеет значение...

*Этот запрос является сообщением POST (не запросом в первый раз)*  
  
 AND  
  
Кнопка `buttonDelete`*была отправлена в форму.*

Эта форма (на самом деле, эта страница) содержит только одну кнопку, поэтому дополнительный тест `buttonDelete` технически не является обязательным. Тем не менее вы собираетесь выполнить операцию, которая будет окончательно удалять данные. Так что вы должны быть уверены, что операция выполняется только в том случае, если пользователь явно запросил ее. Например, предположим, что вы развернули эту страницу позже и добавили в нее другие кнопки. Даже после этого код, который удаляет фильм, будет выполняться только в том случае, если была нажата кнопка `buttonDelete`.

Как и на странице *едитмовие* , вы получаете идентификатор из скрытого поля, а затем выполняете команду SQL. Синтаксис инструкции `Delete`:

`DELETE FROM table WHERE ID = value`

Крайне важно включать предложение `WHERE` и идентификатор. Если оставить предложение WHERE, *все записи в таблице будут удалены*. Как вы видите, значение идентификатора передается команде SQL с помощью заполнителя.

## <a name="testing-the-movie-delete-process"></a>Тестирование процесса удаления фильма

Теперь можно протестировать. Запустите страницу *фильмов* и щелкните **Удалить** рядом с фильмом. Когда появится страница *делетемовие* , щелкните **удалить фильм**.

![Удаление страницы фильма с выделенной кнопкой "удалить фильм"](deleting-data/_static/image4.png)

При нажатии кнопки код удаляет фильмы и возвращает их в список фильмов. Там можно найти удаленный фильм и убедиться, что он был удален.

## <a name="coming-up-next"></a>Далее

В следующем учебнике показано, как дать всем страницам на сайте общий вид и макет.

## <a name="complete-listing-for-movie-page-updated-with-delete-links"></a>Полный список для страницы фильмов (обновляется ссылками для удаления)

[!code-cshtml[Main](deleting-data/samples/sample8.cshtml)]

## <a name="complete-listing-for-deletemovie-page"></a>Полный список для страницы Делетемовие

[!code-cshtml[Main](deleting-data/samples/sample9.cshtml)]

## <a name="additional-resources"></a>Дополнительные ресурсы

- [Введение в веб-программирование ASP.NET с помощью синтаксиса Razor](../introducing-razor-syntax-c.md)
- [Инструкция SQL DELETE](http://www.w3schools.com/sql/sql_delete.asp) на сайте W3Schools

> [!div class="step-by-step"]
> [Назад](updating-data.md)
> [Вперед](layouts.md)
