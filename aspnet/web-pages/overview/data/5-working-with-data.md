---
uid: web-pages/overview/data/5-working-with-data
title: Введение в работу с базой данных в ASP.NET Web Pages (Razor) сайтов | Документация Майкрософт
author: Rick-Anderson
description: В этой главе описывается, как для доступа к данным из базы данных и отображения его с помощью веб-страниц ASP.NET.
ms.author: riande
ms.date: 02/18/2014
ms.assetid: 673d502f-2c16-4a6f-bb63-dbfd9a77ef47
msc.legacyurl: /web-pages/overview/data/5-working-with-data
msc.type: authoredcontent
ms.openlocfilehash: 0fc828e39cfcce22d4cc226954cf7d1731b04e42
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/09/2019
ms.locfileid: "59379785"
---
# <a name="introduction-to-working-with-a-database-in-aspnet-web-pages-razor-sites"></a>Введение в работу с базой данных в ASP.NET Web Pages (Razor) узлов

по [Tom FitzMacken](https://github.com/tfitzmac)

> В этой статье описывается, как использовать средства Microsoft WebMatrix для создания базы данных в на веб-сайте ASP.NET Web Pages (Razor), а также способы создания страниц, которые позволяют отображать, добавление, изменение и удаление данных.
> 
> **Вы узнаете, как:** 
> 
> - Как создать базу данных.
> - Сведения о подключении к базе данных.
> - Как отобразить данные на веб-странице.
> - Как вставка, обновление и удаление записей базы данных.
> 
> Ниже приведены функции, представленные в этой статье.
> 
> - Работа с базой данных Microsoft SQL Server Compact Edition.
> - Работа с SQL-запросов.
> - класс `Database`;
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a>Версии программного обеспечения, используемые в этом руководстве
> 
> 
> - Веб-страниц ASP.NET (Razor) 2
> - WebMatrix 2
>   
> 
> Этот учебник также работает с WebMatrix 3. Можно использовать 3 веб-страниц ASP.NET и Visual Studio 2013 (или Visual Studio Express 2013 для Web); Тем не менее пользовательский интерфейс будет отличаться.


## <a name="introduction-to-databases"></a>Введение в базы данных

Представьте себе типичный адресной книги. Для каждой записи в адресной книге (то есть для каждого пользователя) у вас есть несколько блоков информации, такие как имя, Фамилия, адрес, адрес электронной почты и номер телефона.

Типичный способ подобные данные рисунка — как таблицу со строками и столбцами. В терминах баз данных каждая строка часто называется "запись". Каждый столбец (иногда называют полями) содержит значение для каждого типа данных: имя, имя последнего и т. д.

| **ID** | **FirstName** | **LastName** | **Адрес** | **Адрес эл. почты** | **Телефон** |
| --- | --- | --- | --- | --- | --- |
| 1 | Джим | Abrus | 210 разбиении St SE Orcas WA 98031 | jim@contoso.com | 555 0100 |
| 2 | Александр | Адамс | 1234 Main St. Сиэтл WA 99011 | terry@cohowinery.com | 555 0101 |

Для большинства таблиц базы данных она должна содержать столбец, содержащий уникальный идентификатор, например номер заказчика, номер счета, и т.д. Этот процесс известен как таблицы *первичный ключ*, и использовать его для идентификации каждой строки в таблице. В примере идентификатор столбца является первичным ключом для адресной книги.

С этой базовое представление о базах данных, вы будете готовы узнать, как создать простой базы данных и выполнять операции, такие как добавление, изменение и удаление данных.

> [!TIP] 
> 
> **Реляционные базы данных**
> 
> Данные можно хранить во многих ситуациях, включая текстовые файлы и электронные таблицы. Для большинства бизнес-применений Однако данные хранятся в реляционной базе данных.
> 
> В этой статье не могу очень глубоко в базы данных. Тем не менее может оказаться полезно иметь представление о них. В реляционной базе данных сведения логически разделяется отдельных таблицах. Например база данных школы может содержать отдельные таблицы для учащихся, а также для предложений класса. Базы данных программного обеспечения (например, SQL Server) поддерживает командами с широкими возможностями, которые позволяют динамически устанавливать отношения между таблицами. Например можно использовать реляционную базу данных для установления логическую связь между учащимися и классами, чтобы создать расписание. Хранение данных в отдельных таблицах упрощает структуры таблицы и сокращает необходимость сохранять избыточных данных в таблицах.


## <a name="creating-a-database"></a>Создание базы данных

Эта процедура показано, как создать базу данных с именем SmallBakery с помощью средства разработки базы данных SQL Server Compact, включенный в WebMatrix. Несмотря на то, что можно создать базу данных с помощью кода, более типично для создания базы данных и таблицы базы данных с помощью такого средства разработки, как WebMatrix.

1. Запуск WebMatrix, а на странице быстрого запуска, нажмите кнопку **Site From Template**.
2. Выберите **пустой сайт**, а затем в **имя сайта** введите «SmallBakery» и нажмите кнопку **ОК**. Сайт создаются и отображаются в WebMatrix.
3. В левой области щелкните **баз данных** рабочей области.
4. На ленте щелкните **новую базу данных**. Пустая база данных создается с тем же именем, что веб-узла.
5. В левой области разверните **SmallBakery.sdf** узел и нажмите кнопку **таблиц**.
6. На ленте щелкните **новую таблицу**. WebMatrix откроется в конструкторе таблиц.

    ![[изображение]](5-working-with-data/_static/image1.jpg)
7. Щелкните в **имя** столбца и введите &quot;идентификатор&quot;.
8. В **тип данных** столбец, выберите **int**.
9. Задайте **— первичный ключ?** и **— определить?** вариантов для **Да**.

    Как и предполагает имя, **— первичный ключ** сообщает базы данных, что это будет первичный ключ таблицы. **Столбец идентификаторов** указывает базу данных для автоматического создания идентификатор для каждой новой записи и ей присваивается порядковый номер (начиная с 1).
10. Нажмите кнопку в следующей строке. Редактор запускает новое определение столбца.
11. Значение имени, введите &quot;имя&quot;.
12. Для **тип данных**, выберите &quot;nvarchar&quot; и задающий длину равной 50. *Var* частью `nvarchar` сообщает базы данных, что данные для этого столбца будут строку, размер которых может меняться от записи к записи. ( *n* префикса представляет *национальных*, указывающее, что поле может содержать символьные данные, представляющий любой алфавита или системы письма &#8212; то есть, что поле содержит данные в Юникоде.)
13. Задайте **Разрешить значения NULL** равным **нет**. Это обеспечит, *имя* столбца является не пустым.
14. Используя этот же процесс, создайте столбец с именем *описание*. Задайте **тип данных** «nvarchar» и 50 для длины, а также набор **Разрешить значения NULL** значение false.
15. Создать столбец с именем *цена*. Задайте **тип данных для «деньги»** и задайте **Разрешить значения NULL** значение false.
16. В поле в верхней, назовите таблицу &quot;продукта&quot;.

    Когда все будет готово, определение будет выглядеть следующим образом:

    ![[изображение]](5-working-with-data/_static/image2.jpg)
17. Нажмите клавиши Ctrl + S для сохранения таблицы.

## <a name="adding-data-to-the-database"></a>Добавление данных в базу данных

Теперь можно добавить демонстрационные данные в базу данных, которым вы будете работать далее в этой статье.

1. В левой области разверните **SmallBakery.sdf** узел и нажмите кнопку **таблиц**.
2. Щелкните правой кнопкой мыши таблицу Product, а затем нажмите кнопку **данных**.
3. В области редактирования введите следующие записи:

    | **name** | **Описание** | **Цена** |
    | --- | --- | --- |
    | Хлеб | Встроена новая каждый день. | 2.99 |
    | Strawberry Shortcake | Внесены с органических strawberries из наших сада. | 9.99 |
    | Круговой Apple | Второе только в ваша мама круговую диаграмму. | 12.99 |
    | Круговой pecan | Если вам нравится pecans, это для вас. | 10.99 |
    | Лимонная круговая | Внесены с лучшим лимонов в мире. | 11.99 |
    | Кексы | Детей и kid в вам понравится это. | 7.99 |

    Помните, что у вас нет заполнение для *идентификатор* столбца. При создании *идентификатор* набор столбцов, его **Is Identity** присваивается значение true, что приведет к автоматически заполняться.

    Когда вы закончите ввода данных, конструктор таблиц будет выглядеть следующим образом:

    ![[изображение]](5-working-with-data/_static/image3.jpg)
4. Закройте вкладку, содержащую базы данных.

## <a name="displaying-data-from-a-database"></a>Отображение данных из базы данных

После того, как база данных в ней, можно отобразить данные в веб-страницу ASP.NET. Чтобы выбрать строки таблицы для отображения, используйте инструкцию SQL, которое представляет собой команду, передать в базе данных.

1. В левой области щелкните **файлы** рабочей области.
2. В корне веб-сайта, создайте новый CSHTML-странице с именем *ListProducts.cshtml*.
3. Замените существующую разметку следующей:

    [!code-cshtml[Main](5-working-with-data/samples/sample1.cshtml)]

    В первом блоке кода, откройте *SmallBakery.sdf* файла (база данных), который был создан ранее. `Database.Open` Метод предполагает, что *.sdf* файл находится в веб-сайт *приложения\_данных* папки. (Обратите внимание, что не нужно указывать *.sdf* расширение &#8212; на самом деле, в противном случае `Open` метод не будет работать.)

    > [!NOTE]
    > *Приложения\_данных* папку это особая папка, в ASP.NET, который используется для хранения файлов данных. Дополнительные сведения см. в разделе [соединения с базой данных](#SB_ConnectingToADatabase) далее в этой статье.

    Внесите запрос в базе данных, используя следующую команду SQL `Select` инструкции:

    [!code-sql[Main](5-working-with-data/samples/sample2.sql)]

    В операторе `Product` определяет таблицу для запроса. `*` Знак означает, что запрос должен возвращать все столбцы из таблицы. (Можно также указать столбцы по отдельности, разделенные запятыми, если нужно увидеть только некоторые столбцы.) `Order By` Предложение указывает порядок сортировки данных &#8212; таким образом, путем *имя* столбца. Это означает, что данные отсортированы в алфавитном порядке на основе значения *имя* столбца для каждой строки.

    В основной области страницы разметка создает таблицу HTML, который будет использоваться для отображения данных. Внутри `<tbody>` элемент, используйте `foreach` цикла по отдельности получить каждой строки данных, возвращаемых запросом. Для каждой строки данных, создать строку таблицы HTML (`<tr>` элемент). Затем вы создаете ячеек HTML-таблицы (`<td>` элементы) для каждого столбца. Каждый раз, когда вы проходя по циклу, следующую доступную строку из базы данных находится в `row` переменной (его настроить `foreach` инструкции). Чтобы получить отдельный столбец из строки, можно использовать `row.Name` или `row.Description` или имя, которое столбца вы хотите.
4. Откройте страницу в браузере. (Убедитесь, что выбран страницы **файлы** рабочей области, прежде чем запускать его.) На странице отображается список, подобный следующему:

    ![[изображение]](5-working-with-data/_static/image4.jpg)

> [!TIP] 
> 
> **Язык SQL (Structured Query Language)**
> 
> SQL — это язык, который используется в большинство реляционных баз данных для управления данными в базе данных. Она включает команды, которые позволяют получать данные и обновить его, и, которые позволяют создавать, изменять и управлять таблицами базы данных. SQL отличается от языка программирования (как вы используете в WebMatrix) так, как с помощью SQL, суть сообщить базе данных, то, что нужно, что это задание базы данных, чтобы выяснить, как получить данные или выполнять задачи. Ниже приведены примеры некоторых команд SQL и что они делают.
> 
> `SELECT Id, Name, Price FROM Product WHERE Price > 10.00 ORDER BY Name`
> 
> Это извлекает *идентификатор*, *имя*, и *цена* столбцы из записей в *продукта* таблица, если значение *цена* превышает 10 и возвращает результаты в алфавитном порядке по значениям *имя* столбца. Эта команда возвращает результирующий набор, содержащий записи, которые удовлетворяют критериям, или пустой набор, если нет записей, соответствующих.
> 
> `INSERT INTO Product (Name, Description, Price) VALUES ("Croissant", "A flaky delight", 1.99)`
> 
> Это приводит к вставке новой записи в *продукта* таблице, задание *имя* столбец &quot;круассан&quot;, *описание* столбец &quot; Неопределенная удовлетворят&quot;и цена, 1,99.
> 
> `DELETE FROM Product WHERE ExpirationDate < "01/01/2008"`
> 
> Эта команда удаляет записи в *продукта* таблицы, в которой столбец даты окончания срока действия более ранняя, чем 1 января 2008 г. (Предполагается, что *продукта* таблица имеет такой столбец, конечно.) Здесь вводится дата в формате мм/дд/гггг, но должно вводиться в формате, который используется для используемого языкового стандарта.
> 
> `Insert Into` И `Delete` команды не возвращают результирующие наборы. Вместо этого они возвращают число, которое указывает, сколько записей, затронутых командой.
> 
> Для некоторых из этих операций (например, вставка и удаление записей) процесс, который запрашивает операцию должен иметь соответствующие разрешения в базе данных. Именно для рабочих баз данных, обычно требуется ввести имя пользователя и пароль при подключении к базе данных.
> 
> Существует множество команд SQL, но все они следуют шаблону следующим образом. Команды SQL можно использовать для создания таблиц баз данных, подсчитать число записей в таблице, расчета цен и выполнять многие другие операции.


## <a name="inserting-data-in-a-database"></a>Вставка данных в базе данных

В этом разделе показано, как создать страницу, которая позволяет пользователям добавлять новый продукт для *продукта* таблицы базы данных. После вставки новой записи о продукте на странице отображаются обновленные таблицы с помощью *ListProducts.cshtml* страницу, созданную в предыдущем разделе.

Страницы включает проверку, чтобы убедиться в том, что данные, вводимые пользователем является допустимым для базы данных. Например код на странице гарантирует, что значение для всех требуемых столбцов были введены.

1. На веб-сайте, создайте новый файл CSHTML *InsertProducts.cshtml*.
2. Замените существующую разметку следующей:

    [!code-cshtml[Main](5-working-with-data/samples/sample3.cshtml)]

    Текст страницы содержит HTML-формы с тремя текстовыми полями, которые позволяют пользователям вводить имя, описание и цена. Когда пользователь нажимает кнопку **вставить** кнопка, код в верхней части страницы открывает подключение к *SmallBakery.sdf* базы данных. Затем получить значения, которые пользователь отправил с помощью `Request` объект и задать эти значения локальных переменных.

    Чтобы проверить, что пользователь ввел значение для каждого требуемого столбца, зарегистрируйте каждый `<input>` элемент, который вы хотите проверить:

    [!code-csharp[Main](5-working-with-data/samples/sample4.cs)]

    `Validation` Вспомогательный проверяет, существует ли значение в каждое из полей, которые вы зарегистрировали. Вы можете протестировать все поля прошла проверку, установив `Validation.IsValid()`, который обычно выполняется перед обработкой информации, вы получаете от пользователя:

    [!code-csharp[Main](5-working-with-data/samples/sample5.cs)]

    ( `&&` Означает, что оператор AND, этот тест *Если выполняется отправка формы, а все поля прошли проверку с*.)

    Если были проверены все столбцы (ни один не пустой), пойти дальше и создать инструкцию SQL для вставки данных и затем выполнить его, как показано далее:

    [!code-csharp[Main](5-working-with-data/samples/sample6.cs)]

    Для вставки значений, вы местозаполнителями параметров (`@0`, `@1`, `@2`).

    > [!NOTE]
    > По соображениям безопасности всегда передайте значения в инструкцию SQL, с помощью параметров, как показано в предыдущем примере. Это дает возможность проверять данные пользователя, а также он помогает защититься от попытки отправки вредоносных команд к базе данных (иногда называют атаки путем внедрения кода SQL).

    Для выполнения запроса, этот оператор применяется, передавая ему переменные, содержащие значения для замены заполнителей:

    [!code-csharp[Main](5-working-with-data/samples/sample7.cs)]

    После `Insert Into` выполнения инструкции, отправить пользователя на страницу, которая перечисляет продукты, используя следующую строку:

    [!code-javascript[Main](5-working-with-data/samples/sample8.js)]

    Если не удалось выполнить проверку, то пропустить инструкции insert. Вместо этого у вас есть вспомогательный объект на странице, которая может отображать накопленные ошибок (если таковые имеются):

    [!code-cshtml[Main](5-working-with-data/samples/sample9.cshtml)]

    Обратите внимание на то, что блок стиля в разметке включает определение класса CSS с именем `.validation-summary-errors`. Это имя класса CSS, который используется по умолчанию для `<div>` элемент, содержащий все ошибки проверки. В этом случае класс CSS указывает, что сводки ошибки проверки, отображаются красным цветом и отмеченную полужирным шрифтом, но можно определить `.validation-summary-errors` класс, чтобы отобразить все форматирование, вам нравится.

### <a name="testing-the-insert-page"></a>Тестирование страницы Insert

1. Просмотрите страницу в браузере. На странице отображается форму, которая аналогична той, что показано на следующем рисунке.

    ![[изображение]](5-working-with-data/_static/image5.jpg)
2. Введите значения для всех столбцов, но убедитесь, что оставить *цена* пустой столбец.
3. Нажмите кнопку **Вставить**. На странице отображается сообщение об ошибке, как показано на следующем рисунке. (Создается не новая запись).

    ![[изображение]](5-working-with-data/_static/image6.jpg)
4. Полностью заполнить форму и нажмите кнопку **вставить**. На этот раз *ListProducts.cshtml* отображении страницы и показывает новой записи.

## <a name="updating-data-in-a-database"></a>Обновление данных в базе данных

После ввода данных в таблицу, может потребоваться обновить его. Эта процедура показано, как создать две страницы, которые похожи на те, которые вы создали для вставки данных в ранее. Первой странице отображаются продукты и позволяет пользователям выбрать один для изменения. Вторая страница позволяет пользователям фактически внести изменения и сохранить их.

> [!NOTE] 
> 
> **Важные** в рабочем веб-сайте, вы обычно ограничивать доступ для внесения изменений в данные. Дополнительные сведения о том, как настроить членство и о способах авторизации пользователей для выполнения задач на узле, см. в разделе [Добавление безопасности и членство в сайте веб-страниц ASP.NET](https://go.microsoft.com/fwlink/?LinkId=202904).


1. На веб-сайте, создайте новый файл CSHTML *EditProducts.cshtml*.
2. Замените существующую разметку в файле следующим:

    [!code-cshtml[Main](5-working-with-data/samples/sample10.cshtml)]

    Единственное различие между этой странице и *ListProducts.cshtml* страницы из более ранних имеет, включающее дополнительный столбец, отображающий HTML-таблицы на этой странице **изменить** ссылку. Если щелкнуть эту ссылку, откроется *UpdateProducts.cshtml* страницы (которая будет создан далее) где можно изменить выбранную запись.

    Взгляните на код, создающий **изменить** ссылку:

    [!code-cshtml[Main](5-working-with-data/samples/sample11.cshtml)]

    Это создает HTML- `<a>` элемент которого `href` динамически установлен атрибут. `href` Атрибут задает страницы для отображения, когда пользователь щелкает ссылку. Он также передает `Id` значение текущей строки по ссылке. При запуске страницы, исходного кода страницы могут содержать ссылки, подобные этим:

    [!code-html[Main](5-working-with-data/samples/sample12.html)]

    Обратите внимание, что `href` атрибуту присваивается `UpdateProducts/n`, где *n* является номер продукта. Когда пользователь нажимает одну из этих ссылок, полученный URL-адрес будет выглядеть следующим образом:

    `http://localhost:18816/UpdateProducts/6`

    Другими словами номер продукта, для изменения будут переданы в URL-адрес.
3. Просмотрите страницу в браузере. На странице отображаются данные в формате следующим образом.

    ![[изображение]](5-working-with-data/_static/image7.jpg)

    Далее создадим страницу, которая позволяет пользователям, которые фактически обновления данных. Страница обновления включает проверку для проверки данных, вводимых пользователем. Например код на странице гарантирует, что значение для всех требуемых столбцов были введены.
4. На веб-сайте, создайте новый файл CSHTML *UpdateProducts.cshtml*.
5. Замените существующую разметку в файле следующим кодом.

    [!code-cshtml[Main](5-working-with-data/samples/sample13.cshtml)]

    Текст страницы содержит HTML-форму, где отображается продукта и где пользователи могут изменять его. Чтобы получить продукт для отображения, используйте следующую инструкцию SQL:

    [!code-sql[Main](5-working-with-data/samples/sample14.sql)]

    Это будет выбрать продукт, идентификатор которого соответствует значению, которое передается в `@0` параметра. (Поскольку *идентификатор* имеет первичный ключ и поэтому должен быть уникальным, записи только для одного продукта могут когда-либо выбраны таким образом.) Чтобы получить значение идентификатора для передачи это `Select` инструкции, можно прочитать значение, которое передается на страницу как часть URL-адрес, используя следующий синтаксис:

    [!code-csharp[Main](5-working-with-data/samples/sample15.cs)]

    Чтобы фактически выборки записи продукта, используйте `QuerySingle` метод, который будет возвращать только одну запись:

    [!code-csharp[Main](5-working-with-data/samples/sample16.cs)]

    Возвращает одну строку в `row` переменной. Можно получить данные из каждого столбца и назначить ее локальных переменных следующим образом:

    [!code-csharp[Main](5-working-with-data/samples/sample17.cs)]

    В разметке для формы эти значения автоматически отображаются в отдельных текстовых полях с помощью внедренный код, аналогичный следующему:

    [!code-html[Main](5-working-with-data/samples/sample18.html)]

    Этот фрагмент кода отображает записи продукта обновления. После отображения записи, пользователь может редактировать отдельные столбцы.

    Когда пользователь отправляет форму, щелкнув **обновление** кнопку, код в `if(IsPost)` блоке. Это возвращает значения пользователя из `Request` , сохраняет значения в переменных и проверяет, что каждый столбец будет заполнен. Если проверка проходит успешно, код создает следующую инструкцию SQL Update:

    [!code-sql[Main](5-working-with-data/samples/sample19.sql)]

    В SQL `Update` инструкции, укажите каждый столбец для обновления и ему присвоено значение. В этом коде значения указываются с помощью параметров-местозаполнителей `@0`, `@1`, `@2`, и т. д. (Как уже отмечалось ранее, для обеспечения безопасности, всегда следует передавать значения в инструкцию SQL с помощью параметров.)

    При вызове `db.Execute` метод, можно передавать переменные, которые содержат значения в порядке, который соответствует параметрам в инструкции SQL:

    [!code-csharp[Main](5-working-with-data/samples/sample20.cs)]

    После `Update` выполнения инструкции, чтобы перенаправить пользователя обратно на страницу редактирования вызвать следующий метод:

    [!code-cshtml[Main](5-working-with-data/samples/sample21.cshtml)]

    Действует так, пользователь увидит обновленный список данных в базе данных и можно изменить другого продукта.
6. Сохраните страницу.
7. Запустите *EditProducts.cshtml* страницы (не на странице "обновления"), а затем нажмите кнопку **изменить** выбрать продукт для редактирования. *UpdateProducts.cshtml* отображается страница, показывающая выбранная запись.

    ![[изображение]](5-working-with-data/_static/image8.jpg)
8. Внесите изменения и нажмите кнопку **обновления**. Список продуктов отображается снова измененными данными.

## <a name="deleting-data-in-a-database"></a>Удаление данных в базе данных

В этом разделе показано, как разрешить пользователям удалить продукт из *продукта* таблицы базы данных. Пример состоит из двух страниц. На первой странице пользователям выбрать запись для удаления. На второй странице, которое позволит им убедитесь, что они действительно хотите удалить запись отображается запись для удаления.

> [!NOTE] 
> 
> **Важные** в рабочем веб-сайте, вы обычно ограничивать доступ для внесения изменений в данные. Дополнительные сведения о том, как настроить членство и о способах авторизация пользователя для выполнения задач на узле, см. в разделе [Добавление безопасности и членство в сайте веб-страниц ASP.NET](https://go.microsoft.com/fwlink/?LinkId=202904).


1. На веб-сайте, создайте новый файл CSHTML *ListProductsForDelete.cshtml*.
2. Замените существующую разметку следующей:

    [!code-cshtml[Main](5-working-with-data/samples/sample22.cshtml)]

    Эта страница аналогична *EditProducts.cshtml* страницы из ранее. Тем не менее, вместо отображения **изменить** ссылку для каждого продукта отображаются **удалить** ссылку. **Удалить** ссылка создается с помощью следующих внедренный код в разметке:

    [!code-cshtml[Main](5-working-with-data/samples/sample23.cshtml)]

    Это создает URL-адрес, который выглядит следующим образом, когда пользователь щелкает ссылку:

    `http://<server>/DeleteProduct/4`

    URL-адрес вызывает страницу с именем *DeleteProduct.cshtml* (который вы создадите далее) и передает его идентификатор продукта для удаления (в данном примере 4).
3. Сохраните файл, но не закрывайте его.
4. Создайте другой файл CHTML *DeleteProduct.cshtml*. Замените существующее содержимое следующим:

    [!code-cshtml[Main](5-working-with-data/samples/sample24.cshtml)]

    Эта страница вызывается *ListProductsForDelete.cshtml* и позволяет пользователю убедиться, что они действительно хотите удалить продукт. Чтобы получить список продуктов для удаления, получить идентификатор продукта для удаления из URL-адрес следующим образом:

    [!code-csharp[Main](5-working-with-data/samples/sample25.cs)]

    Страницы, затем запрашивает у пользователя нажмите кнопку, чтобы удалить запись. Эта мера важный элемент обеспечения безопасности: при выполнении операций с веб-сайта, например обновления или удаления данных, эти операции всегда должно выполняться с помощью операции POST, а не операция GET. Если сайт настроен таким образом, чтобы операции удаления выполняются с помощью операции GET, любой пользователь может передать URL-адресу вида `http://<server>/DeleteProduct/4` и удалять любые сведения из базы данных. Добавление подтверждения и написании кода страницы, чтобы удаление можно выполнить только с помощью POST, добавьте меру безопасности для веб-узла.

    Фактическая операция удаления выполняется, используя следующий код, который сначала подтверждает, что это операция post и идентификатор не является пустой:

    [!code-csharp[Main](5-working-with-data/samples/sample26.cs)]

    Код выполняет инструкцию SQL, которая удаляет указанную запись и затем перенаправляет пользователя обратно на страницу.
5. Запустите *ListProductsForDelete.cshtml* в браузере.

    ![[изображение]](5-working-with-data/_static/image9.jpg)
6. Нажмите кнопку **удалить** ссылку на один из продуктов. *DeleteProduct.cshtml* отобразится страница, чтобы убедиться, что Вы действительно хотите удалить эту запись.
7. Нажмите кнопку **удалить** кнопки. Удаляется запись о продукте и обновлении страницы со списком обновленные продуктов.

> [!TIP]
> 
> <a id="SB_ConnectingToADatabase"></a>
> ### <a name="connecting-to-a-database"></a>Подключение к базе данных
> 
> Можно соединиться с базой данных, двумя способами. Первый заключается в использовании `Database.Open` метод и указать имя файла базы данных (меньше *.sdf* расширение):
> 
> `var db = Database.Open("SmallBakery");`
> 
> `Open` Метод предполагает, что. *SDF* файл находится в веб сайта *приложения\_данных* папки. Эта папка предназначена для хранения данных. Например он имеет соответствующие разрешения, чтобы разрешить веб-сайт для чтения и записи данных, и из соображений безопасности, WebMatrix не разрешает доступ к файлам из этой папки.
> 
> Вторым способом является использование строки подключения. Строка подключения содержит сведения о том, как соединиться с базой данных. Это может включать путь к файлу, или он может включать имя базы данных SQL Server на локальном или удаленном сервере, а также имя пользователя и пароль для подключения к этому серверу. (Если данные хранятся в централизованной версии SQL Server, например на сайте поставщика услуг размещения, всегда используется строка подключения Указание сведений о подключении базы данных.)
> 
> В WebMatrix, строки подключения, обычно хранятся в XML-файл с именем *Web.config*. Как и предполагает название, вы можете использовать *Web.config* файл в корневом каталоге веб-сайта для хранения сведений о конфигурации сайта, включая любые строки подключения, которые могут потребовать вашего сайта. Пример строки подключения в *Web.config* файл может выглядеть следующим образом:
> 
> [!code-xml[Main](5-working-with-data/samples/sample27.xml)]
> 
> В примере строка подключения указывает на базу данных в экземпляре SQL Server, на котором выполняется на другом сервере (в отличие от локального *.sdf* файла). Необходимо заменить соответствующими именами для `myServer` и `myDatabase`и укажите значения имени входа SQL Server для `username` и `password`. (Имя пользователя и пароль значения не обязательно так же как учетные данные Windows или как значения, которые ваш поставщик услуг размещения вы получили для входа в систему на своих серверах. Обратитесь к администратору для точных значений, что нужно.)
> 
> `Database.Open` Метод обеспечивает высокую гибкость, так как позволяет передавать имя базы данных *.sdf* файла или имя строки подключения, которая хранится в *Web.config* файл. В следующем примере показано, как соединиться с базой данных с помощью строки подключения, показано в предыдущем примере:
> 
> [!code-cshtml[Main](5-working-with-data/samples/sample28.cshtml)]
> 
> Как уже отмечалось, `Database.Open` метод позволяет передать имя базы данных или строку подключения, и он будет выяснить, какой использовать. Это очень полезно при развертывании (публикации) веб-сайта. Можно использовать *.sdf* файл *приложения\_данных* папки при разработке и тестировании веб-узла. При перемещении веб-узла на рабочем сервере, можно использовать строку подключения в *Web.config* файл, который имеет то же имя, что ваш *.sdf* файл, но, что точки с поставщиком услуг размещения базы данных &#8212;все это без необходимости изменять код.
> 
> Наконец, если требуется работать непосредственно с строку подключения, можно вызвать `Database.OpenConnectionString` метод и передайте его фактическое подключение строки вместо имени одного из объектов в *Web.config* файл. Это может быть полезно в ситуациях, когда по некоторым причинам у вас нет доступа к строке подключения (или значения, такие как *.sdf* имя файла) до выполнения страницы. Однако в большинстве случаев можно использовать `Database.Open` как описано в этой статье.


## <a name="additional-resources"></a>Дополнительные ресурсы

- [SQL Server Compact](https://www.microsoft.com/sqlserver/2008/en/us/compact.aspx)
- [Подключение к SQL Server или базе данных MySQL в WebMatrix](https://go.microsoft.com/fwlink/?LinkId=208661)
- [Проверка пользовательского ввода на сайтах веб-страниц ASP.NET](https://go.microsoft.com/fwlink/?LinkId=253002)
