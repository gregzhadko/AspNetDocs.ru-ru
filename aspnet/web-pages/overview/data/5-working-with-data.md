---
uid: web-pages/overview/data/5-working-with-data
title: Введение в работу с базой данных на сайтах веб-страницы ASP.NET (Razor) | Документация Майкрософт
author: Rick-Anderson
description: В этой главе описывается, как получить доступ к данным из базы данных и отобразить их с помощью веб-страницы ASP.NET.
ms.author: riande
ms.date: 02/18/2014
ms.assetid: 673d502f-2c16-4a6f-bb63-dbfd9a77ef47
msc.legacyurl: /web-pages/overview/data/5-working-with-data
msc.type: authoredcontent
ms.openlocfilehash: 45e988d037465e59ad352bb9444af2c69fd3cd70
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78474042"
---
# <a name="introduction-to-working-with-a-database-in-aspnet-web-pages-razor-sites"></a>Общие сведения о работе с базой данных на сайтах веб-страницы ASP.NET (Razor)

от [Tom фитзмаккен](https://github.com/tfitzmac)

> В этой статье описывается, как использовать средства Microsoft WebMatrix для создания базы данных на веб-сайте веб-страницы ASP.NET (Razor) и создания страниц, позволяющих отображать, добавлять, изменять и удалять данные.
> 
> **Что вы узнаете:** 
> 
> - Создание базы данных.
> - Как подключиться к базе данных.
> - Отображение данных на веб-странице.
> - Инструкции по вставке, обновлению и удалению записей базы данных.
> 
> Ниже приведены функции, представленные в этой статье.
> 
> - Работа с базой данных Microsoft SQL Server Compact Edition.
> - Работа с запросами SQL.
> - Класс `Database`.
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a>Версии программного обеспечения, используемые в этом руководстве
> 
> 
> - Веб-страницы ASP.NET (Razor) 2
> - WebMatrix 2
>   
> 
> Этот учебник также работает с WebMatrix 3. Вы можете использовать веб-страницы ASP.NET 3 и Visual Studio 2013 (или Visual Studio Express 2013 для Web). Однако пользовательский интерфейс будет отличаться.

## <a name="introduction-to-databases"></a>Общие сведения о базах данных

Представьте типичную адресную книгу. Для каждой записи в адресной книге (т. е. для каждого пользователя) имеется несколько элементов информации, таких как имя, фамилия, адрес, адрес электронной почты и номер телефона.

Типичный способ изображения таких данных — это таблица со строками и столбцами. В терминах базы данных каждая строка часто называется записью. Каждый столбец (иногда называемый полями) содержит значение для каждого типа данных: имя, фамилия и т. д.

| **Идентификатор** | **FirstName** | **LastName** | **Адрес** | **Электронная почта** | **Номер телефона** |
| --- | --- | --- | --- | --- | --- |
| 1 | Артем | абрус | 210 сотой Сент-Orcas WA 98031 | jim@contoso.com | 555 0100 |
| 2 | Terry | Адамс | 1234. Москва, штат Вашингтон 99011 | terry@cohowinery.com | 555 0101 |

Для большинства таблиц базы данных таблица должна содержать столбец, содержащий уникальный идентификатор, например номер клиента, номер счета и т. д. Это называется *первичным ключом*таблицы и используется для обнаружения каждой строки в таблице. В этом примере столбец ID является первичным ключом для адресной книги.

Благодаря этому базовому пониманию баз данных вы можете научиться создавать простую базу данных и выполнять такие операции, как добавление, изменение и удаление данных.

> [!TIP] 
> 
> **Реляционные базы данных**
> 
> Данные можно хранить множеством способов, включая текстовые файлы и электронные таблицы. Однако для большинства целей бизнеса данные хранятся в реляционной базе данных.
> 
> Эта статья не очень глубока в базах данных. Тем не менее, может оказаться полезным понять их немного. В реляционной базе данных сведения логически делятся на отдельные таблицы. Например, база данных для учебного заведения может содержать отдельные таблицы для учащихся и предложений классов. Программное обеспечение базы данных (например, SQL Server) поддерживает мощные команды, которые позволяют динамически устанавливать связи между таблицами. Например, реляционную базу данных можно использовать для установления логической связи между студентами и классами для создания расписания. Хранение данных в отдельных таблицах снижает сложность структуры таблицы и снижает необходимость хранить избыточные данные в таблицах.

## <a name="creating-a-database"></a>Создание базы данных

В этой процедуре показано, как создать базу данных с именем Смаллбакери с помощью SQL Server Compact средства проектирования баз данных, которое входит в WebMatrix. Несмотря на то, что базу данных можно создать с помощью кода, более типично создать базу данных и таблицы базы данных с помощью средства проектирования, такого как WebMatrix.

1. Запустите WebMatrix, а на странице Быстрое начало щелкните **сайт из шаблона**.
2. Выберите **пустой сайт**и в поле **имя сайта** введите "смаллбакери", а затем нажмите кнопку **ОК**. Сайт создается и отображается в WebMatrix.
3. В левой области щелкните рабочую область **базы данных** .
4. На ленте щелкните **Новая база данных**. Создается пустая база данных с тем же именем, что и у вашего сайта.
5. В левой области разверните узел **смаллбакери. sdf** и выберите пункт **таблицы**.
6. На ленте нажмите кнопку **создать таблицу**. WebMatrix открывает Конструктор таблиц.

    ![[образ]](5-working-with-data/_static/image1.jpg)
7. Щелкните столбец **Name (имя** ) и введите идентификатор &quot;&quot;.
8. В столбце **тип данных** выберите значение **int**.
9. Задать **первичный ключ?** и **определить?** возможные значения **Да**.

    Как и предполагает имя, **первичный ключ** сообщает базе данных, что это будет первичным ключом таблицы. **Удостоверение** указывает, что база данных автоматически создает идентификационный номер для каждой новой записи и присваивает ей следующий последовательный номер (начиная с 1).
10. Щелкните в следующей строке. Редактор запускает новое определение столбца.
11. В качестве значения имя введите &quot;имя&quot;.
12. В **поле Тип данных**выберите &quot;nvarchar&quot; и задайте для параметра длина значение 50. Компонент *var* в `nvarchar` сообщает базе данных, что данные для этого столбца будут строкой, размер которой может отличаться от записи к записи. (Префикс *n* представляет *национальные*символы, указывающие, что поле может содержать символьные данные, представляющие любой алфавит &#8212; или систему записи, то есть поле содержит данные в Юникоде.)
13. Установите для параметра **Разрешить значения NULL** значение **нет**. В этом случае столбец *имя* не останется пустым.
14. Используя этот же процесс, создайте столбец с именем *Description*. Задайте для параметра **тип данных** значение nvarchar и 50 для длины, а для параметра **Разрешить значения NULL** — значение false.
15. Создайте столбец с именем *Price*. Задайте **для параметра Тип данных значение Money** и задайте для параметра **Разрешить значения NULL** значение false.
16. В поле вверху введите имя таблицы &quot;&quot;продукта.

    По завершении определение будет выглядеть следующим образом:

    ![[образ]](5-working-with-data/_static/image2.png)
17. Нажмите клавиши CTRL + S, чтобы сохранить таблицу.

## <a name="adding-data-to-the-database"></a>Добавление данных в базу данных

Теперь можно добавить в базу данных примеры данных, которые будут работать позже в этой статье.

1. В левой области разверните узел **смаллбакери. sdf** и выберите пункт **таблицы**.
2. Щелкните правой кнопкой мыши таблицу Product и выберите пункт **данные**.
3. На панели редактирования введите следующие записи:

    | **Название** | **Описание** | **Позиции** |
    | --- | --- | --- |
    | Хлеб | Помогут каждый день. | 2,99 |
    | Strawberry Песочный торт | Это сделано с клубникаом от нашего сада. | 9.99 |
    | Круговая диаграмма Apple | Второй только для круговой диаграммы MOM. | 12.99 |
    | Пекан круговая диаграмма | Если вы предпочитаете пеканс, это можно делать. | 10.99 |
    | Лемон круговая диаграмма | Это делается с лучшими лемонсами в мире. | 11.99 |
    | Кексы | Ваши дети и детский ребенок понравятся вам. | 7.99 |

    Помните, что для столбца *идентификаторов* ничего вводить не нужно. Когда вы создали столбец *идентификаторов* , задайте для свойства свойство **Identity** значение true, в результате чего оно будет автоматически заполнено.

    Завершив ввод данных, конструктор таблиц будет выглядеть следующим образом:

    ![[образ]](5-working-with-data/_static/image3.jpg)
4. Закройте вкладку, содержащую данные базы данных.

## <a name="displaying-data-from-a-database"></a>Отображение данных из базы данных

После получения базы данных с данными в ней можно отобразить данные на веб-странице ASP.NET. Чтобы выбрать строки таблицы для вывода, используйте инструкцию SQL, которая представляет собой команду, которая передается в базу данных.

1. В левой области щелкните рабочую область **файлы** .
2. В корневом каталоге веб-сайта создайте новую страницу CSHTML с именем *листпродуктс. cshtml*.
3. Замените существующую разметку следующим:

    [!code-cshtml[Main](5-working-with-data/samples/sample1.cshtml)]

    В первом блоке кода откройте файл *смаллбакери. sdf* (базу данных), созданный ранее. Метод `Database.Open` предполагает, что *SDF* -файл находится в папке приложения веб-сайта *\_данных* . (Обратите внимание, что не нужно указывать расширение &#8212; SDF на самом деле, если это так, то метод `Open` не будет работать.)

    > [!NOTE]
    > Папка *данных\_приложений* — это специальная папка в ASP.NET, которая используется для хранения файлов данных. Дополнительные сведения см. в разделе [Подключение к базе данных](#SB_ConnectingToADatabase) далее в этой статье.

    Затем вы выполните запрос на запрос к базе данных, используя следующую инструкцию SQL `Select`:

    [!code-sql[Main](5-working-with-data/samples/sample2.sql)]

    В инструкции `Product` определяет таблицу для запроса. Символ `*` указывает, что запрос должен возвращать все столбцы из таблицы. (Можно также перечислить столбцы по отдельности, разделенные запятыми, если нужно увидеть только некоторые столбцы.) Предложение `Order By` указывает, как в этом случае данные должны &#8212; быть отсортированы по столбцу *имени* . Это означает, что данные сортируются в алфавитном порядке в зависимости от значения столбца *имя* для каждой строки.

    В тексте страницы разметка создает таблицу HTML, которая будет использоваться для вывода данных. Внутри элемента `<tbody>` используется цикл `foreach` для индивидуального получения каждой строки данных, возвращаемой запросом. Для каждой строки данных создается строка таблицы HTML (`<tr>` элемент). Затем создаются ячейки таблицы HTML (`<td>` элементы) для каждого столбца. Каждый раз, когда вы просматриваете цикл, следующая доступная строка из базы данных находится в переменной `row` (она настраивается в инструкции `foreach`). Чтобы получить отдельный столбец из строки, можно использовать `row.Name` или `row.Description` или любое имя из нужного столбца.
4. Запустите страницу в браузере. (Перед выполнением страницы убедитесь, что она выбрана в рабочей области **файлы** .) На странице отобразится список следующего вида:

    ![[образ]](5-working-with-data/_static/image4.jpg)

> [!TIP] 
> 
> **Язык структурированных запросов (SQL)**
> 
> SQL — это язык, который используется в большинстве реляционных баз данных для управления данными в базе данных. Она включает команды, позволяющие извлекать данные и обновлять их, а также создавать, изменять и управлять таблицами базы данных. SQL отличается от языка программирования (например, того, который вы используете в WebMatrix), так как при работе с SQL идея состоит в том, что необходимо сообщить базе данных, что вам нужно, и это задача базы данных, чтобы выяснить, как получить данные или выполнить задачу. Ниже приведены примеры некоторых команд SQL и их действия.
> 
> `SELECT Id, Name, Price FROM Product WHERE Price > 10.00 ORDER BY Name`
> 
> При этом извлекать столбцы *ID*, *Name*и *Price* из записей в таблице *Product* , если значение *Price* больше 10, и возвращает результаты в алфавитном порядке на основе значений столбца *Name* . Эта команда возвращает результирующий набор, который содержит записи, удовлетворяющие критериям, или пустой набор, если записи не совпадают.
> 
> `INSERT INTO Product (Name, Description, Price) VALUES ("Croissant", "A flaky delight", 1.99)`
> 
> При этом в таблицу *Product* будет вставлена новая запись, в которой для столбца *Name* задается значение &quot;круассан&quot;, столбец *Description* для &quot;ненадежных удовлетворения запросов&quot;и цена 1,99.
> 
> `DELETE FROM Product WHERE ExpirationDate < "01/01/2008"`
> 
> Эта команда удаляет записи в таблице *Product* , столбец даты окончания срока действия которых предшествует 1 января 2008. (Предполагается, что таблица *Product* содержит такой столбец, конечно.) Дата вводится в формате мм/дд/гггг, но она должна быть введена в формате, используемом для вашего языкового стандарта.
> 
> Команды `Insert Into` и `Delete` не возвращают результирующие наборы. Вместо этого они возвращают число, которое показывает, сколько записей было затронуто командой.
> 
> Для некоторых из этих операций (например, для вставки и удаления записей) процесс, запрашивающий операцию, должен иметь соответствующие разрешения в базе данных. Именно поэтому для рабочих баз данных часто приходится указывать имя пользователя и пароль при подключении к базе данных.
> 
> Существует десятка команд SQL, но все они следуют подобному шаблону. Команды SQL можно использовать для создания таблиц базы данных, подсчета количества записей в таблице, вычисления цен и выполнения многих других операций.

## <a name="inserting-data-in-a-database"></a>Вставка данных в базу данных

В этом разделе показано, как создать страницу, позволяющую пользователям добавлять новый продукт в таблицу базы данных *Product* . После вставки новой записи продукта на странице отображается обновленная таблица с помощью страницы *листпродуктс. cshtml* , созданной в предыдущем разделе.

Страница включает проверку, чтобы убедиться, что данные, вводимые пользователем, действительны для базы данных. Например, код на странице гарантирует, что для всех обязательных столбцов было введено значение.

1. На веб-сайте создайте новый файл CSHTML с именем *инсертпродуктс. cshtml*.
2. Замените существующую разметку следующим:

    [!code-cshtml[Main](5-working-with-data/samples/sample3.cshtml)]

    Текст страницы содержит HTML-форму с тремя текстовыми полями, которые позволяют ввести имя, описание и цену. Когда пользователь нажимайте кнопку " **Вставить** ", код в верхней части страницы открывает подключение к базе данных *смаллбакери. sdf* . Затем вы получаете значения, отправленные пользователем с помощью объекта `Request`, и назначаете эти значения локальным переменным.

    Чтобы убедиться, что пользователь указал значение для каждого обязательного столбца, необходимо зарегистрировать каждый элемент `<input>`, который требуется проверить:

    [!code-csharp[Main](5-working-with-data/samples/sample4.cs)]

    Модуль поддержки `Validation` проверяет наличие значения в каждом зарегистрированном вами поле. Вы можете проверить, прошли ли все поля проверку, проверив `Validation.IsValid()`, которые обычно выполняется перед обработкой данных, получаемых от пользователя:

    [!code-csharp[Main](5-working-with-data/samples/sample5.cs)]

    (Оператор `&&` означает и — этот тест является *отправкой формы, а все поля прошли проверку*.)

    Если все столбцы проверены (не были пустыми), Создайте инструкцию SQL для вставки данных, а затем выполните ее, как показано далее.

    [!code-csharp[Main](5-working-with-data/samples/sample6.cs)]

    Для вставки значений необходимо включить заполнители параметров (`@0`, `@1`, `@2`).

    > [!NOTE]
    > В качестве меры предосторожности всегда следует передавать значения в инструкцию SQL с помощью параметров, как показано в предыдущем примере. Это дает возможность проверить данные пользователя, а также помогает защититься от попыток отправить вредоносные команды в базу данных (иногда это называется атаками путем внедрения кода SQL).

    Чтобы выполнить запрос, используйте этот оператор, передав ему переменные, содержащие значения для замены заполнителей:

    [!code-csharp[Main](5-working-with-data/samples/sample7.cs)]

    После выполнения инструкции `Insert Into` вы отправляете пользователю на страницу со списком продуктов, использующих эту строку:

    [!code-javascript[Main](5-working-with-data/samples/sample8.js)]

    Если проверка не прошла бы, вы пропускаете вставку. Вместо этого у вас есть вспомогательный метод на странице, который может отображать накопленные сообщения об ошибках (если таковые имеются):

    [!code-cshtml[Main](5-working-with-data/samples/sample9.cshtml)]

    Обратите внимание, что блок style в разметке включает определение класса CSS с именем `.validation-summary-errors`. Это имя класса CSS, используемого по умолчанию для элемента `<div>`, который содержит любые ошибки проверки. В этом случае класс CSS указывает, что сводные ошибки проверки отображаются красным цветом и полужирным шрифтом, но можно определить `.validation-summary-errors` класс для отображения любого форматирования.

### <a name="testing-the-insert-page"></a>Тестирование страницы вставки

1. Просмотр страницы в браузере. На странице отображается форма, похожая на ту, которая показана на следующем рисунке.

    ![[образ]](5-working-with-data/_static/image5.jpg)
2. Введите значения для всех столбцов, но убедитесь, что столбец *Price* не заполнен.
3. Нажмите кнопку **Вставить**. На странице отображается сообщение об ошибке, как показано на следующем рисунке. (Новая запись не создается.)

    ![[образ]](5-working-with-data/_static/image6.jpg)
4. Заполните форму полностью, а затем нажмите кнопку **Вставить**. На этот раз отображается страница *листпродуктс. cshtml* , в которой отображается новая запись.

## <a name="updating-data-in-a-database"></a>Обновление данных в базе данных

После того как данные введены в таблицу, может потребоваться обновить их. В этой процедуре показано, как создать две страницы, похожие на те, которые были созданы ранее для вставки данных. На первой странице отображаются продукты и пользователи могут выбрать одну из них для изменения. Вторая страница позволяет пользователям фактически вносить изменения и сохранять их.

> [!NOTE] 
> 
> **Важно!** На рабочем веб-сайте обычно ограничивается доступ к данным, разрешенным для внесения изменений. Сведения о настройке членства и способах авторизации пользователей для выполнения задач на сайте см. [в разделе Добавление безопасности и членства на веб-страницы ASP.net сайте](https://go.microsoft.com/fwlink/?LinkId=202904).

1. На веб-сайте создайте новый файл CSHTML с именем *едитпродуктс. cshtml*.
2. Замените существующую разметку в файле следующим:

    [!code-cshtml[Main](5-working-with-data/samples/sample10.cshtml)]

    Единственная разница между этой страницей и страницей *листпродуктс. cshtml* из предыдущих версий состоит в том, что таблица HTML на этой странице содержит дополнительный столбец, в котором отображается ссылка для **редактирования** . Если щелкнуть эту ссылку, откроется страница *упдатепродуктс. cshtml* (которую вы создадите далее), где можно изменить выбранную запись.

    Взгляните на код, который создает ссылку **Edit** :

    [!code-cshtml[Main](5-working-with-data/samples/sample11.cshtml)]

    При этом создается элемент `<a>` HTML, атрибут `href` которого задается динамически. Атрибут `href` указывает страницу, отображаемую при щелчке ссылки пользователем. Он также передает `Id` значение текущей строки в ссылку. При выполнении страницы источник страницы может содержать такие ссылки:

    [!code-html[Main](5-working-with-data/samples/sample12.html)]

    Обратите внимание, что атрибуту `href` присвоено значение `UpdateProducts/n`, где *n* — номер продукта. Когда пользователь щелкает одну из этих ссылок, полученный URL-адрес будет выглядеть примерно так:

    `http://localhost:18816/UpdateProducts/6`

    Иными словами, номер изменяемого продукта будет передаваться в URL-адресе.
3. Просмотр страницы в браузере. Страница отображает данные в следующем формате:

    ![[образ]](5-working-with-data/_static/image7.jpg)

    Далее предстоит создать страницу, которая позволит пользователям фактически обновлять данные. Страница обновление включает проверку для проверки вводимых пользователем данных. Например, код на странице гарантирует, что для всех обязательных столбцов было введено значение.
4. На веб-сайте создайте новый файл CSHTML с именем *упдатепродуктс. cshtml*.
5. Замените существующую разметку в файле следующим.

    [!code-cshtml[Main](5-working-with-data/samples/sample13.cshtml)]

    Текст страницы содержит HTML-форму, в которой отображается продукт и где пользователи могут редактировать его. Чтобы получить продукт для вывода, используйте следующую инструкцию SQL:

    [!code-sql[Main](5-working-with-data/samples/sample14.sql)]

    Будет выбран продукт, идентификатор которого соответствует значению, переданному в параметре `@0`. (Поскольку *идентификатор* является первичным ключом и, следовательно, должен быть уникальным, в этом случае можно выбрать только одну запись продукта.) Чтобы получить значение идентификатора для передачи этой инструкции `Select`, можно прочитать значение, которое передается на страницу как часть URL-адреса, используя следующий синтаксис:

    [!code-csharp[Main](5-working-with-data/samples/sample15.cs)]

    Для фактической выборки записи продукта используется метод `QuerySingle`, возвращающий только одну запись:

    [!code-csharp[Main](5-working-with-data/samples/sample16.cs)]

    Одна строка возвращается в переменную `row`. Вы можете получить данные из каждого столбца и назначить их локальным переменным следующим образом:

    [!code-csharp[Main](5-working-with-data/samples/sample17.cs)]

    В разметке для формы эти значения отображаются автоматически в отдельных текстовых полях с помощью внедренного кода, как показано ниже:

    [!code-html[Main](5-working-with-data/samples/sample18.html)]

    В этой части кода отображается обновляемая запись продукта. После отображения записи пользователь может изменять отдельные столбцы.

    Когда пользователь отправляет форму, нажав кнопку **Обновить** , код в блоке `if(IsPost)` выполняется. Получает значения пользователя из объекта `Request`, сохраняет значения в переменных и проверяет, что каждый столбец заполнен. Если проверка пройдена, код создает следующую инструкцию SQL UPDATE:

    [!code-sql[Main](5-working-with-data/samples/sample19.sql)]

    В инструкции SQL `Update` необходимо указать каждый столбец для обновления и задать для него значение. В этом коде значения задаются с помощью заполнителей параметров `@0`, `@1`, `@2`и т. д. (Как отмечалось ранее, для обеспечения безопасности следует всегда передавать значения в инструкцию SQL с помощью параметров.)

    При вызове метода `db.Execute` передаются переменные, содержащие значения в порядке, соответствующем параметрам в инструкции SQL:

    [!code-csharp[Main](5-working-with-data/samples/sample20.cs)]

    После выполнения инструкции `Update` вызовите следующий метод, чтобы перенаправить пользователя обратно на страницу редактирования:

    [!code-cshtml[Main](5-working-with-data/samples/sample21.cshtml)]

    В результате пользователь видит обновленный список данных в базе данных и может изменить другой продукт.
6. Сохраните страницу.
7. Запустите страницу *едитпродуктс. cshtml* (не на странице Обновление) и нажмите кнопку **изменить** , чтобы выбрать продукт для изменения. Отобразится страница *упдатепродуктс. cshtml* , на которой показана выбранная запись.

    ![[образ]](5-working-with-data/_static/image8.jpg)
8. Внесите изменения и нажмите кнопку **Обновить**. Список продуктов снова отобразится с обновленными данными.

## <a name="deleting-data-in-a-database"></a>Удаление данных в базе данных

В этом разделе показано, как разрешить пользователям удалять продукт из таблицы базы данных *Product* . Пример состоит из двух страниц. На первой странице пользователи выбирают удаляемую запись. Затем Удаляемая запись отображается на второй странице, которая позволяет подтвердить удаление записи.

> [!NOTE] 
> 
> **Важно!** На рабочем веб-сайте обычно ограничивается доступ к данным, разрешенным для внесения изменений. Сведения о настройке членства и способах авторизации пользователя для выполнения задач на сайте см. [в разделе Добавление безопасности и членства на веб-страницы ASP.net сайте](https://go.microsoft.com/fwlink/?LinkId=202904).

1. На веб-сайте создайте новый файл CSHTML с именем *листпродуктсфорделете. cshtml*.
2. Замените существующую разметку следующим:

    [!code-cshtml[Main](5-working-with-data/samples/sample22.cshtml)]

    Эта страница похожа на страницу *едитпродуктс. cshtml* ранее. Однако вместо отображения ссылки **Edit** для каждого продукта отображается ссылка **Delete (удалить** ). Ссылка **Delete** создается с помощью следующего внедренного кода в разметке:

    [!code-cshtml[Main](5-working-with-data/samples/sample23.cshtml)]

    При этом создается URL-адрес, который выглядит следующим образом, если пользователь щелкнул ссылку:

    `http://<server>/DeleteProduct/4`

    URL-адрес вызывает страницу с именем *DeleteProduct. cshtml* (которую вы создадите далее) и передает ей идентификатор удаляемого продукта (здесь 4).
3. Сохраните файл, но оставьте его открытым.
4. Создайте другой CHTML файл с именем *DeleteProduct. cshtml*. Замените имеющееся содержимое следующим:

    [!code-cshtml[Main](5-working-with-data/samples/sample24.cshtml)]

    Эта страница вызывается *листпродуктсфорделете. cshtml* и позволяет пользователям подтвердить удаление продукта. Чтобы получить список удаляемого продукта, вы получаете идентификатор продукта, который нужно удалить из URL-адреса, используя следующий код:

    [!code-csharp[Main](5-working-with-data/samples/sample25.cs)]

    Затем на странице пользователю предлагается нажать кнопку, чтобы удалить запись. Это важная мера безопасности: при выполнении конфиденциальных операций на веб-сайте, таких как обновление или удаление данных, эти операции всегда следует выполнять с помощью операции POST, а не операции GET. Если сайт настроен таким образом, что операция удаления может быть выполнена с помощью операции GET, любой пользователь может передать URL-адрес, например `http://<server>/DeleteProduct/4`, и удалить все необходимые данные из базы данных. Добавив подтверждение и записав страницу в код, чтобы удаление можно было выполнить только с помощью записи, вы добавите в сайт меру безопасности.

    Фактическая операция удаления выполняется с помощью следующего кода, который сначала подтверждает, что это операция POST, и что идентификатор не пуст:

    [!code-csharp[Main](5-working-with-data/samples/sample26.cs)]

    Код выполняет инструкцию SQL, которая удаляет указанную запись, а затем перенаправляет пользователя обратно на страницу листинга.
5. Запустите *листпродуктсфорделете. cshtml* в браузере.

    ![[образ]](5-working-with-data/_static/image9.jpg)
6. Щелкните ссылку **Удалить** для одного из продуктов. Отобразится страница *DeleteProduct. cshtml* , на которой подтвердите, что хотите удалить эту запись.
7. Нажмите кнопку **Удалить** . Запись продукта удаляется, а страница обновляется с помощью обновленного списка продуктов.

> [!TIP]
> 
> <a id="SB_ConnectingToADatabase"></a>
> ### <a name="connecting-to-a-database"></a>Соединение с базой данных
> 
> Подключиться к базе данных можно двумя способами. Во-первых, следует использовать метод `Database.Open` и указать имя файла базы данных (меньше расширения *SDF* ):
> 
> `var db = Database.Open("SmallBakery");`
> 
> Метод `Open` предполагает, что. *SDF* -файл находится в папке *данных приложения\_* . Эта папка разработана специально для хранения данных. Например, у него есть соответствующие разрешения, позволяющие веб-сайту считывать и записывать данные, а в качестве меры безопасности WebMatrix не разрешает доступ к файлам из этой папки.
> 
> Второй способ — использовать строку подключения. Строка подключения содержит сведения о том, как подключиться к базе данных. Это может быть путь к файлу или имя базы данных SQL Server на локальном или удаленном сервере, а также имя пользователя и пароль для подключения к этому серверу. (Если данные хранятся в централизованно управляемой версии SQL Server, например на сайте поставщика услуг размещения, для указания сведений о подключении к базе данных всегда используется строка подключения.)
> 
> В WebMatrix строки подключения обычно хранятся в XML-файле с именем *Web. config*. Как следует из названия, можно использовать файл *Web. config* в корневом каталоге веб-сайта для хранения сведений о конфигурации сайта, включая любые строки подключения, которые могут потребоваться вашему сайту. Пример строки подключения в файле *Web. config* может выглядеть следующим образом:
> 
> [!code-xml[Main](5-working-with-data/samples/sample27.xml)]
> 
> В этом примере строка подключения указывает на базу данных в экземпляре SQL Server, которая выполняется на сервере в любом месте (в отличие от локального *SDF* -файла). Необходимо заменить соответствующие имена `myServer` и `myDatabase`и указать SQL Server значения имени входа для `username` и `password`. (Значения имени пользователя и пароля не обязательно совпадают с учетными данными Windows или в качестве значений, предоставленных поставщиком услуг размещения для входа на серверы. Для получения точных нужных значений обратитесь к администратору.)
> 
> Метод `Database.Open` является гибким, так как он позволяет передать либо имя *SDF* -файла базы данных, либо имя строки подключения, которая хранится в файле *Web. config* . В следующем примере показано, как подключиться к базе данных, используя строку подключения, показанную в предыдущем примере.
> 
> [!code-cshtml[Main](5-working-with-data/samples/sample28.cshtml)]
> 
> Как уже отмечалось, метод `Database.Open` позволяет передать имя базы данных или строку подключения, а также определить, какой вариант использовать. Это очень полезно при развертывании (публикации) веб-сайта. Вы можете использовать *SDF* -файл в папке *app\_Data* при разработке и тестировании сайта. Затем при перемещении сайта на рабочий сервер можно использовать строку подключения в файле *Web. config* с тем же именем, что и *SDF* -файл, но который указывает на базу данных &#8212; поставщика размещения, без необходимости изменения кода.
> 
> Наконец, если вы хотите работать непосредственно со строкой подключения, можно вызвать метод `Database.OpenConnectionString` и передать ему фактическую строку подключения, а не только имя одной из них в файле *Web. config* . Это может быть полезно в ситуациях, когда по какой-либо причине у вас нет доступа к строке подключения (или к значениям, таким как имя *SDF* -файла), пока страница не будет запущена. Однако в большинстве случаев можно использовать `Database.Open`, как описано в этой статье.

## <a name="additional-resources"></a>Дополнительные ресурсы

- [SQL Server Compact](https://www.microsoft.com/sqlserver/2008/en/us/compact.aspx)
- [Подключение к базе данных SQL Server или MySQL в WebMatrix](https://go.microsoft.com/fwlink/?LinkId=208661)
- [Проверка пользовательского ввода на сайтах веб-страниц ASP.NET](https://go.microsoft.com/fwlink/?LinkId=253002)
