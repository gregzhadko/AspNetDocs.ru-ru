---
uid: web-pages/overview/data/7-displaying-data-in-a-chart
title: Отображение данных в диаграмме с помощью веб-страницы ASP.NET (Razor) | Документация Майкрософт
author: microsoft
description: В этой главе объясняется, как отображать данные в диаграмме. В предыдущих главах вы узнали, как отображать данные вручную и в сетке. В этой главе объясняется...
ms.author: riande
ms.date: 05/22/2012
ms.assetid: f889fd46-4dac-4ecb-83d8-60e64c22036e
msc.legacyurl: /web-pages/overview/data/7-displaying-data-in-a-chart
msc.type: authoredcontent
ms.openlocfilehash: 6dad67d4e3d38d57a761c567d937d714a3184ea9
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78509136"
---
# <a name="displaying-data-in-a-chart-with-aspnet-web-pages-razor"></a>Отображение данных в диаграмме с помощью веб-страницы ASP.NET (Razor)

по [Майкрософт](https://github.com/microsoft)

> В этой статье объясняется, как использовать диаграмму для отображения данных на веб-сайте веб-страницы ASP.NET (Razor) с помощью вспомогательного метода `Chart`.
> 
> **Что вы**узнаете:
> 
> - Отображение данных в диаграмме.
> - Как использовать стили диаграмм с помощью встроенных тем.
> - Сохранение диаграмм и кэширование их для повышения производительности.
> 
> Это функции программирования ASP.NET, представленные в статье:
> 
> - Вспомогательный метод `Chart`.
> 
> > [!NOTE]
> > Сведения в этой статье относятся к веб-страницы ASP.NET 1,0 и веб-страницам 2.

<a id="The_Chart_Helper"></a>
## <a name="the-chart-helper"></a>Вспомогательная функция диаграммы

Если вы хотите отображать данные в графической форме, можно использовать `Chart` вспомогательное приложение. Вспомогательный модуль `Chart` может визуализировать изображение, которое отображает данные в различных типах диаграмм. Он поддерживает множество вариантов форматирования и добавления меток. Модуль поддержки `Chart` может визуализировать более 30 типов диаграмм, включая все типы диаграмм, которые могут быть знакомы с Microsoft Excel или другими инструментами &#8212; , линейчатыми диаграммами, гистограммами, графиками и круговыми диаграммами, а также более специализированными диаграммами, такими как акции.

| **Диаграмма с областями** ![описание: изображение типа диаграммы с областями](7-displaying-data-in-a-chart/_static/image1.jpg) | **Линейчатая диаграмма** ![описание: изображение типа линейчатой диаграммы](7-displaying-data-in-a-chart/_static/image2.jpg) |
| --- | --- |
| **Гистограмма ![описание** : изображение типа гистограммы](7-displaying-data-in-a-chart/_static/image3.jpg) | **График ![описание** : изображение типа графика](7-displaying-data-in-a-chart/_static/image4.jpg) |
| **Круговая диаграмма** ![описание: изображение типа круговой диаграммы](7-displaying-data-in-a-chart/_static/image5.jpg) | Объемная **диаграмма** ![описание: изображение типа диаграммы "стандартный"](7-displaying-data-in-a-chart/_static/image6.jpg) |

### <a name="chart-elements"></a>Элементы диаграммы

Диаграммы отображают данные и дополнительные элементы, такие как условные обозначения, оси, ряды и т. д. На следующем рисунке показаны многие элементы диаграммы, которые можно настроить при использовании вспомогательного метода `Chart`. В этой статье показано, как задать некоторые (не все) эти элементы.

![Описание: изображение, показывающее элементы диаграммы](7-displaying-data-in-a-chart/_static/image7.jpg)

<a id="Creating_a_Chart"></a>
## <a name="creating-a-chart-from-data"></a>Создание диаграммы на основе данных

Данные, отображаемые в диаграмме, могут быть из массива, из результатов, возвращаемых из базы данных, или из данных, которые находятся в XML-файле.

### <a name="using-an-array"></a>Использование массива

Как описано в статье [Общие сведения о веб-страницы ASP.NET программировании с помощью синтаксиса Razor](https://go.microsoft.com/fwlink/?LinkId=202890), массив позволяет хранить коллекцию схожих элементов в одной переменной. Можно использовать массивы для хранения данных, которые необходимо включить в диаграмму.

Эта процедура показывает, как можно создать диаграмму на основе данных в массивах с использованием типа диаграммы по умолчанию. В нем также показано, как отобразить диаграмму на странице.

1. Создайте новый файл с именем *чартаррайбасик. cshtml*.
2. Замените имеющееся содержимое следующим: 

    [!code-cshtml[Main](7-displaying-data-in-a-chart/samples/sample1.cshtml)]

    Код сначала создает новую диаграмму и задает ее ширину и высоту. Заголовок диаграммы указывается с помощью метода `AddTitle`. Для добавления данных используется метод `AddSeries`. В этом примере используются параметры `name`, `xValue`и `yValues` метода `AddSeries`. Параметр `name` отображается в условных обозначениях диаграммы. Параметр `xValue` содержит массив данных, отображаемых вдоль горизонтальной оси диаграммы. Параметр `yValues` содержит массив данных, используемый для построения вертикальных точек диаграммы.

    Метод `Write` на самом деле визуализирует диаграмму. В этом случае, поскольку тип диаграммы не был указан, вспомогательный объект `Chart` визуализирует диаграмму по умолчанию, которая представляет собой гистограмму.
3. Запустите страницу в браузере. В браузере отобразится диаграмма. 

    ![](7-displaying-data-in-a-chart/_static/image8.jpg)

### <a name="using-a-database-query-for-chart-data"></a>Использование запроса к базе данных для данных диаграммы

Если данные, которые нужно построить, находятся в базе данных, можно выполнить запрос к базе данных, а затем использовать данные из результатов для создания диаграммы. В этой процедуре показано, как считывать и отображать данные из базы данных, созданной в статье [Введение в работу с базой данных на веб-страницы ASP.NET сайтах](https://go.microsoft.com/fwlink/?LinkId=202893).

1. Если папка еще не существует, добавьте папку *Data\_данных* в корневой каталог веб-сайта.
2. В папку *данных приложения\_* добавьте файл базы данных с именем *смаллбакери. sdf* , описанный в статье [Общие сведения о работе с базой данных на сайтах веб-страницы ASP.NET](https://go.microsoft.com/fwlink/?LinkId=202893).
3. Создайте новый файл с именем *чартдатакуери. cshtml*.
4. Замените имеющееся содержимое следующим:   

    [!code-cshtml[Main](7-displaying-data-in-a-chart/samples/sample2.cshtml)]

    Код сначала открывает базу данных Смаллбакери и назначает ее переменной с именем `db`. Эта переменная представляет объект `Database`, который можно использовать для чтения и записи в базу данных. Затем код выполняет SQL-запрос, чтобы получить имя и цену каждого продукта. Код создает новую диаграмму и передает ей запрос к базе данных, вызывая метод `DataBindTable` диаграммы. Этот метод принимает два параметра: параметр `dataSource` предназначен для данных из запроса, а параметр `xField` позволяет задать столбец данных, используемый для оси x диаграммы.

    В качестве альтернативы использованию метода `DataBindTable` можно использовать метод `AddSeries` вспомогательного метода `Chart`. Метод `AddSeries` позволяет задать параметры `xValue` и `yValues`. Например, вместо использования метода `DataBindTable` следующим образом:

    [!code-css[Main](7-displaying-data-in-a-chart/samples/sample3.css)]

    Вы можете использовать метод `AddSeries` следующим образом:

    [!code-html[Main](7-displaying-data-in-a-chart/samples/sample4.html)]

    Оба значения отображают одинаковые результаты. Метод `AddSeries` является более гибким, так как можно явно указать тип диаграммы и данные, но метод `DataBindTable` проще использовать, если не требуется дополнительная гибкость.
5. Запустите страницу в браузере. 

    ![](7-displaying-data-in-a-chart/_static/image9.jpg)

### <a name="using-xml-data"></a>Использование XML-данных

Третьим вариантом для построения диаграммы является использование XML-файла в качестве данных для диаграммы. Это требует, чтобы XML-файл также имел файл схемы (*XSD* -файл), описывающий структуру XML. В этой процедуре показано, как считывать данные из XML-файла.

1. В папке *приложения\_данные* создайте новый XML-файл с именем *Data. XML*.
2. Замените существующий XML на приведенный ниже, который представляет собой некоторые XML-данные о сотрудниках в вымышленной компании. 

    [!code-xml[Main](7-displaying-data-in-a-chart/samples/sample5.xml)]
3. В папке *приложения\_данные* создайте новый XML-файл с именем *Data. xsd*. (Обратите внимание, что это время расширения — *. xsd*.)
4. Замените существующий XML следующим: 

    [!code-xml[Main](7-displaying-data-in-a-chart/samples/sample6.xml)]
5. В корневом каталоге веб-сайта создайте новый файл с именем *чартдатаксмл. cshtml*.
6. Замените имеющееся содержимое следующим: 

    [!code-cshtml[Main](7-displaying-data-in-a-chart/samples/sample7.cshtml)]

    Код сначала создает объект `DataSet`. Этот объект используется для управления данными, которые считываются из XML-файла, и упорядочивают их в соответствии со сведениями в файле схемы. (Обратите внимание, что в верхней части кода содержится оператор `using SystemData`. Это необходимо для того, чтобы иметь возможность работать с объектом `DataSet`. Дополнительные сведения см. в разделе [&quot;использование инструкций&quot; и полных имен](#SB_UsingStatements) далее в этой статье.)

    Затем код создает объект `DataView`, основанный на наборе данных. Представление данных предоставляет объект, к &#8212; которому может быть привязана диаграмма, — чтение и построение. Диаграмма привязывается к данным с помощью метода `AddSeries`, как было показано ранее при создании диаграммы данных массива, за исключением того, что на этот раз параметры `xValue` и `yValues` задаются для объекта `DataView`.

    В этом примере также показано, как указать определенный тип диаграммы. При добавлении данных в метод `AddSeries` параметр `chartType` также устанавливается для показа круговой диаграммы.
7. Запустите страницу в браузере. 

    ![](7-displaying-data-in-a-chart/_static/image10.jpg)

> [!TIP]
> 
> <a id="SB_UsingStatements"></a>
> ### <a name="using-statements-and-fully-qualified-names"></a>Операторы using и полные имена
> 
> .NET Framework, который веб-страницы ASP.NET с синтаксис Razor, состоит из множества тысяч компонентов (классов). Чтобы обеспечить управляемость для работы со всеми этими классами, они организованы в *пространства имен*, которые в некоторой степени похожи на библиотеки. Например, пространство имен `System.Web` содержит классы, поддерживающие взаимодействие между браузером и сервером, пространство имен `System.Xml` содержит классы, используемые для создания и чтения XML-файлов, а пространство имен `System.Data` содержит классы, позволяющие работать с данными.
> 
> Чтобы получить доступ к любому заданному классу в .NET Framework, код должен быть в курсе не только имени класса, но и пространства имен, в котором находится класс. Например, чтобы использовать вспомогательный метод `Chart`, код должен найти `System.Web.Helpers.Chart` класс, который объединяет пространство имен (`System.Web.Helpers`) с именем класса (`Chart`). Это известно как *полное* имя &#8212; класса полное, однозначное расположение в пределах числа .NET Framework. В коде это будет выглядеть следующим образом:
> 
> `var myChart = new System.Web.Helpers.Chart(width: 600, height: 400) // etc.`
> 
> Однако это громоздкий (и подверженный ошибкам) способ использования этих длинных полных имен каждый раз, когда необходимо сослаться на класс или вспомогательную функцию. Таким образом, чтобы упростить использование имен классов, можно *импортировать* нужные пространства имен, что обычно представляет собой несколько из множества пространств имен в .NET Framework. Если вы импортировали пространство имен, можно использовать только имя класса (`Chart`) вместо полного имени (`System.Web.Helpers.Chart`). Когда код выполняется и находит имя класса, оно может искать только те пространства имен, которые вы импортировали для поиска этого класса.
> 
> При использовании веб-страницы ASP.NET с синтаксис Razor для создания веб-страниц обычно используется один набор классов каждый раз, включая класс `WebPage`, различные вспомогательные методы и т. д. Чтобы сохранить работу по импорту соответствующих пространств имен при каждом создании веб-сайта, ASP.NET настроен таким образом, что он автоматически импортирует набор основных пространств имен для каждого веб-сайта. Вот почему вам не пришлось работать с пространствами имен или импортировать до этого момента; все классы, с которыми вы работали, находятся в пространствах имен, которые уже импортированы.
> 
> Однако иногда требуется работать с классом, который не находится в пространстве имен, которое автоматически импортируется. В этом случае можно либо использовать полное имя этого класса, либо вручную импортировать пространство имен, содержащее класс. Чтобы импортировать пространство имен, используйте инструкцию `using` (`import` в Visual Basic), как показано в примере выше этой статьи.
> 
> Например, класс `DataSet` находится в пространстве имен `System.Data`. Пространство имен `System.Data` не доступно автоматически для ASP.NET страниц Razor. Поэтому для работы с классом `DataSet`, используя его полное имя, можно использовать следующий код:
> 
> `var dataSet = new System.Data.DataSet();`
> 
> Если необходимо многократно использовать класс `DataSet`, можно импортировать пространство имен следующим образом, а затем использовать только имя класса в коде:
> 
> [!code-cshtml[Main](7-displaying-data-in-a-chart/samples/sample8.cshtml)]
> 
> Можно добавить `using` операторы для любых других .NET Framework пространств имен, на которые вы хотите создать ссылку. Однако, как уже отмечалось, это не потребуется делать часто, так как большинство классов, с которыми вы будете работать, находятся в пространствах имен, которые автоматически импортируются ASP.NET для использования в страницах *. cshtml* и *. vbhtml* .

<a id="Displaying_Charts"></a>
## <a name="displaying-charts-inside-a-web-page"></a>Отображение диаграмм внутри веб-страницы

В приведенных выше примерах создается диаграмма, а затем диаграмма отображается непосредственно в браузере в виде графика. Однако во многих случаях требуется отобразить диаграмму как часть страницы, а не только саму себя в браузере. Для этого требуется двухэтапный процесс. Первым шагом является создание страницы, которая создает диаграмму, как уже показано.

Второй шаг — Отображение полученного изображения на другой странице. Для вывода изображения используется HTML-элемент `<img>` так же, как и любое изображение. Однако вместо ссылки на файл *JPG* или *PNG* элемент `<img>` ссылается на *CSHTML* -файл, содержащий вспомогательный метод `Chart`, который создает диаграмму. При запуске страницы отображения элемент `<img>` получает выходные данные вспомогательного метода `Chart` и готовит диаграмму к просмотру.

![](7-displaying-data-in-a-chart/_static/image11.jpg)

1. Создайте файл с именем *шовчарт. cshtml*.
2. Замените имеющееся содержимое следующим: 

    [!code-html[Main](7-displaying-data-in-a-chart/samples/sample9.html)]

    В коде используется элемент `<img>` для вывода диаграммы, созданной ранее в файле *чартаррайбасик. cshtml* .
3. Запустите веб-страницу в браузере. В файле *шовчарт. cshtml* отображается изображение диаграммы на основе кода, содержащегося в файле *чартаррайбасик. cshtml* .

<a id="Styling_a_Chart"></a>
## <a name="styling-a-chart"></a>Стилизация диаграммы

Вспомогательный модуль `Chart` поддерживает большое количество параметров, позволяющих настроить внешний вид диаграммы. Можно задать цвета, шрифты, границы и т. д. Простой способ настроить внешний вид диаграммы — использовать *тему*. Темы — это коллекции данных, задающие способ визуализации диаграммы с указанием шрифтов, цветов, меток, палитр, границ и эффектов. (Обратите внимание, что стиль диаграммы не указывает на тип диаграммы.)

В следующей таблице перечислены встроенные темы.

| Тема | Description |
| --- | --- |
| `Vanilla` | Отображает красные столбцы на белом фоне. |
| `Blue` | Отображает синие столбцы на фоне синего градиента. |
| `Green` | Отображает синие столбцы на фоне зеленого градиента. |
| `Yellow` | Отображает оранжевые столбцы на фоне желтого градиента. |
| `Vanilla3D` | Отображает трехмерные красные столбцы на белом фоне. |

Можно указать тему, которая будет использоваться при создании новой диаграммы.

1. Создайте новый файл с именем *чартстилегрин. cshtml*.
2. Замените существующее содержимое на странице следующим:

    [!code-cshtml[Main](7-displaying-data-in-a-chart/samples/sample10.cshtml)]

    Этот код аналогичен предыдущему примеру, который использует базу данных для данных, но добавляет параметр `theme` при создании объекта `Chart`. Ниже показан измененный код.

    [!code-csharp[Main](7-displaying-data-in-a-chart/samples/sample11.cs)]
3. Запустите страницу в браузере. Вы увидите те же данные, что и раньше, но диаграмма более безупречна: 

    ![](7-displaying-data-in-a-chart/_static/image12.jpg)

<a id="Saving_a_Chart"></a>
## <a name="saving-a-chart"></a>Сохранение диаграммы

При использовании вспомогательного приложения `Chart`, как было показано до сих пор в этой статье, вспомогательная функция повторно создает диаграмму с нуля при каждом вызове. При необходимости код для диаграммы также повторно запрашивает базу данных или повторно считывает XML-файл для получения данных. В некоторых случаях это может быть сложной операцией, например, если база данных, к которой выполняется запрос, имеет большой размер, или если XML-файл содержит много данных. Даже если диаграмма не требует большого объема данных, процесс динамического создания образа занимает ресурсы сервера, и если многие пользователи запрашивают страницу или страницы, отображающие диаграмму, это может повлиять на производительность веб-сайта.

Чтобы уменьшить потенциальное влияние на производительность создания диаграммы, можно создать диаграмму в первый раз, когда она потребуется, а затем сохранить ее. Когда диаграмма снова понадобится, вместо ее повторного создания можно просто получить сохраненную версию и подготовить ее к просмотру.

Диаграмму можно сохранить следующими способами:

- Кэширование диаграммы в памяти компьютера (на сервере).
- Сохраните диаграмму как файл изображения.
- Сохраните диаграмму в виде XML-файла. Этот параметр позволяет изменить диаграмму перед сохранением.

### <a name="caching-a-chart"></a>Кэширование диаграммы

После создания диаграммы ее можно кэшировать. Кэширование диаграммы означает, что ее не нужно создавать повторно, если ее нужно отобразить снова. При сохранении диаграммы в кэше ей присваивается ключ, который должен быть уникальным для этой диаграммы.

Диаграммы, сохраненные в кэше, могут быть удалены, если на сервере не хватает памяти. Кроме того, кэш удаляется, если приложение по какой-либо причине перезапускается. Таким образом, стандартный способ работы с кэшированной диаграммой — всегда проверять, доступен ли он в кэше, и, если нет, создать или повторно создать его.

1. В корне веб-сайта создайте файл с именем *шовкачедчарт. cshtml*.
2. Замените имеющееся содержимое следующим: 

    [!code-html[Main](7-displaying-data-in-a-chart/samples/sample12.html)]

    Тег `<img>` содержит атрибут `src`, указывающий на файл *чартсаветокаче. cshtml* , и передает ключ на страницу в виде строки запроса. Ключ содержит значение &quot;Мичарткэй&quot;. Файл *чартсаветокаче. cshtml* содержит вспомогательный модуль `Chart`, который создает диаграмму. Вы создадите эту страницу чуть позже.

    В конце страницы есть ссылка на страницу с именем *ClearCache. cshtml*. Это страница, которая также будет создана вскоре. *ClearCache. cshtml* требуется только для тестирования кэширования в этом примере — это не ссылка или страница, которые обычно включаются при работе с кэшированными диаграммами.
3. В корне веб-сайта создайте новый файл с именем *чартсаветокаче. cshtml*.
4. Замените имеющееся содержимое следующим:

    [!code-cshtml[Main](7-displaying-data-in-a-chart/samples/sample13.cshtml)]

    Код сначала проверяет, было ли что-либо передано в качестве значения ключа в строке запроса. В этом случае код пытается прочитать диаграмму из кэша, вызвав метод `GetFromCache` и передав ему ключ. Если оказалось, что в кэше нет ничего (что произойдет при первом запросе диаграммы), код создаст диаграмму обычным образом. Когда диаграмма будет завершена, код сохранит его в кэше, вызвав `SaveToCache`. Этот метод требует ключа (поэтому диаграмма может быть запрошена позже) и время, в течение которого диаграмма должна быть сохранена в кэше. (Точное время кэширования диаграммы зависит от того, как часто изменяются данные, которые она представляет.) Для метода `SaveToCache` также требуется параметр &#8212; `slidingExpiration` Если задано значение true, счетчик времени ожидания сбрасывается при каждом обращении к диаграмме. В этом случае это означает, что срок действия записи кэша диаграммы истекает через 2 минуты после последнего обращения к диаграмме. (Альтернатива скользящего срока действия является абсолютным сроком действия, то есть срок действия записи кэша будет составлять ровно 2 минуты после помещения в кэш, независимо от частоты доступа к ней.)

    Наконец, в коде используется метод `WriteFromCache` для выборки и отрисовки диаграммы из кэша. Обратите внимание, что этот метод находится за пределами блока `if`, который проверяет кэш, так как он получит диаграмму из кэша, будет ли она начинаться с или потребовалась бы ее создания и сохранения в кэше.

    Обратите внимание, что в примере метод `AddTitle` включает метку времени. (В заголовок добавляются текущие дата и &#8212; время &#8212; `DateTime.Now`.)
5. Создайте новую страницу с именем *ClearCache. cshtml* и замените ее содержимое следующим:

    [!code-cshtml[Main](7-displaying-data-in-a-chart/samples/sample14.cshtml)]

    На этой странице для удаления диаграммы, которая кэшируется в *чартсаветокаче. cshtml*, используется вспомогательный модуль `WebCache`. Как отмечалось ранее, обычно не требуется страница, подобная этой. Вы создаете его, только чтобы упростить тестирование кэширования.
6. Запустите веб-страницу *шовкачедчарт. cshtml* в браузере. На странице отображается изображение диаграммы на основе кода, содержащегося в файле *чартсаветокаче. cshtml* . Обратите внимание на то, что метка времени имеет в названии диаграммы. 

    ![Описание: рисунок базовой диаграммы с меткой времени в заголовке диаграммы](7-displaying-data-in-a-chart/_static/image13.jpg)
7. Закройте браузер.
8. Снова запустите *шовкачедчарт. cshtml* . Обратите внимание, что метка времени та же, что и раньше, что указывает на то, что диаграмма не была воссоздана, но вместо этого была считана из кэша.
9. В *шовкачедчарт. cshtml*щелкните ссылку **очистить кэш** . Откроется *ClearCache. cshtml*, который сообщает, что кэш был удален.
10. Щелкните ссылку **Return to шовкачедчарт. cshtml** или повторно запустите *шовкачедчарт. cshtml* из WebMatrix. Обратите внимание, что на этот раз отметка времени изменилась, так как кэш был удален. Поэтому в коде пришлось бы повторно создать диаграмму и вернуть ее в кэш.

### <a name="saving-a-chart-as-an-image-file"></a>Сохранение диаграммы как файла изображения

Можно также сохранить диаграмму в виде файла изображения (например, в виде *JPG* -файла) на сервере. После этого файл изображения можно использовать так же, как любой образ. Преимущество заключается в том, что файл сохраняется, а не сохраняется во временном кэше. Можно сохранить новое изображение диаграммы в разное время (например, каждый час), а затем сохранить постоянную запись изменений, произошедших с течением времени. Обратите внимание, что веб-приложение должно иметь разрешение на сохранение файла в папку на сервере, куда нужно поместить файл изображения.

1. В корне веб-сайта создайте папку с именем *\_чартфилес* , если она еще не существует.
2. В корне веб-сайта создайте новый файл с именем *чартсаве. cshtml*.
3. Замените имеющееся содержимое следующим:

    [!code-cshtml[Main](7-displaying-data-in-a-chart/samples/sample15.cshtml)]

    Код сначала проверяет, существует ли файл *. jpg* , вызывая метод `File.Exists`. Если файл не существует, код создает новый `Chart` из массива. На этот раз код вызывает метод `Save` и передает параметр `path`, чтобы указать путь к файлу и имя файла для сохранения диаграммы. В тексте страницы элемент `<img>` использует путь для указания на отображаемый *JPG* -файл.
4. Запустите файл *чартсаве. cshtml* .
5. Вернитесь в WebMatrix. Обратите внимание, что файл изображения с именем *chart01. jpg* был сохранен в папке *\_чартфилес* .

### <a name="saving-a-chart-as-an-xml-file"></a>Сохранение диаграммы в виде XML-файла

Наконец, можно сохранить диаграмму в виде XML-файла на сервере. Преимущество использования этого метода при кэшировании диаграммы или сохранении диаграммы в файл заключается в том, что можно изменить XML перед отображением диаграммы, если это необходимо. Приложение должно иметь разрешения на чтение и запись для папки на сервере, куда нужно поместить файл образа.

1. В корне веб-сайта создайте новый файл с именем *чартсавексмл. cshtml*.
2. Замените имеющееся содержимое следующим:

    [!code-cshtml[Main](7-displaying-data-in-a-chart/samples/sample16.cshtml)]

    Этот код похож на код, который вы видели ранее для хранения диаграммы в кэше, за исключением того, что он использует XML-файл. Код сначала проверяет, существует ли XML-файл, вызывая метод `File.Exists`. Если файл существует, код создает новый объект `Chart` и передает имя файла в качестве параметра `themePath`. При этом создается диаграмма на основе любых данных в XML-файле. Если XML-файл еще не существует, код создает диаграмму, такую как обычная, а затем вызывает `SaveXml`, чтобы сохранить его. Диаграмма готовится к просмотру с помощью метода `Write`, как показано выше.

    Как и на странице с кэшированием, этот код содержит метку времени в заголовке диаграммы.
3. Создайте новую страницу с именем *чартдисплайксмлчарт. cshtml* и добавьте в нее следующую разметку: 

    [!code-html[Main](7-displaying-data-in-a-chart/samples/sample17.html)]
4. Запустите страницу *чартдисплайксмлчарт. cshtml* . Отобразится диаграмма. Запишите метку времени в заголовке диаграммы.
5. Закройте браузер.
6. В WebMatrix щелкните правой кнопкой мыши папку *\_чартфилес* , выберите пункт **Обновить**, а затем откройте папку. Файл *ксмлчарт. XML* в этой папке создан вспомогательным модулем `Chart`. 

    ![Описание: папка _ChartFiles, в которой показан файл Ксмлчарт. XML, созданный вспомогательным модулем диаграммы.](7-displaying-data-in-a-chart/_static/image14.jpg)
7. Снова запустите страницу *чартдисплайксмлчарт. cshtml* . На диаграмме показана та же метка времени, что и при первом запуске страницы. Это обусловлено тем, что диаграмма создается из XML-файла, сохраненного ранее.
8. В WebMatrix откройте папку *\_чартфилес* и удалите файл *ксмлчарт. XML* .
9. Запустите страницу *чартдисплайксмлчарт. cshtml* еще раз. На этот раз отметка времени обновляется, так как вспомогательному модулю `Chart` пришлось воссоздать XML-файл. При необходимости проверьте папку *\_чартфилес* и убедитесь, что XML-файл возвращен.

<a id="Additional_Resources"></a>
## <a name="additional-resources"></a>Дополнительные ресурсы

- [Введение в работу с базой данных на веб-страницы ASP.NET сайтах](https://go.microsoft.com/fwlink/?LinkId=202893)
- [Использование кэширования на сайтах веб-страницы ASP.NET для повышения производительности](https://go.microsoft.com/fwlink/?LinkId=202903)
- [Класс Chart](https://msdn.microsoft.com/library/system.web.helpers.chart(v=vs.99)) (справочник по веб-страницы ASP.NET API на сайте MSDN)
