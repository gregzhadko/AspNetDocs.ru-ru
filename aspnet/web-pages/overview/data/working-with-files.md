---
uid: web-pages/overview/data/working-with-files
title: Работа с файлами на сайте ASP.NET Web Pages (Razor) | Документация Майкрософт
author: Rick-Anderson
description: В этой главе объясняется, как для чтения, записи, добавление, удаление и передачи файлов.
ms.author: riande
ms.date: 02/20/2014
ms.assetid: eee916e4-ba4c-439a-a24e-68df7d45a569
msc.legacyurl: /web-pages/overview/data/working-with-files
msc.type: authoredcontent
ms.openlocfilehash: 4a62cce3af57b507882744f948ce208becdb03ac
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/09/2019
ms.locfileid: "59382307"
---
# <a name="working-with-files-in-an-aspnet-web-pages-razor-site"></a>Работа с файлами на сайте ASP.NET Web Pages (Razor)

по [Tom FitzMacken](https://github.com/tfitzmac)

> В этой статье объясняется, как для чтения, записи, добавление, удаление и передачи файлов на сайте веб-страниц ASP.NET (Razor).
> 
> > [!NOTE]
> > Если вы хотите отправлять изображения и управление ими (например, перевернуть или изменить их размер), см. в разделе [работа с изображениями на сайте веб-страниц ASP.NET](https://go.microsoft.com/fwlink/?LinkId=202897).
> 
> 
> **Вы узнаете, как:** 
> 
> - Как создать текстовый файл и записать на него данные.
> - Как добавлять данные в существующий файл.
> - Как чтение данных из файла и отобразить его.
> - Как удалить файлы с веб-сайта.
> - Как разрешить пользователям отправлять одного или нескольких файлов.
> 
> Ниже перечислены возможности, представленные в этой статье программирования ASP.NET:
> 
> - `File` Объект, который предоставляет способ для управления файлами.
> - `FileUpload` Вспомогательный.
> - `Path` Объект, который предоставляет методы, позволяющие управлять путь и имена файлов.
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a>Версии программного обеспечения, используемые в этом руководстве
> 
> 
> - Веб-страниц ASP.NET (Razor) 2
> - WebMatrix 2
>   
> 
> Этот учебник также работает с WebMatrix 3.


<a id="Creating_a_Text_File"></a>
## <a name="creating-a-text-file-and-writing-data-to-it"></a>Создание текстового файла и запись в нее данных

Помимо использования базы данных в веб-сайта, может работать с файлами. Например можно использовать текстовые файлы как простой способ хранения данных для сайта. (Текстовый файл, который используется для хранения данных иногда называют *неструктурированного файла*.) Текстовые файлы можно представлять в различных форматах, например *.txt*, *.xml*, или *.csv* (значения с разделителями запятыми).

Если вы хотите хранить данные в текстовый файл, можно использовать `File.WriteAllText` метод, чтобы задать его для создания и данные для записи в него. В этой процедуре вы создадите страницу, содержащую простая форма с тремя `input` элементы (имя, фамилию и адрес электронной почты) и **отправить** кнопки. Когда пользователь отправляет форму, введенные пользователем данные будут храниться в текстовом файле.

1. Создайте новую папку с именем *приложения\_данных*, если она еще не существует.
2. В корне веб-сайта, создайте файл с именем *UserData.cshtml*.
3. Замените существующее содержимое следующим: 

    [!code-cshtml[Main](working-with-files/samples/sample1.cshtml)]

    HTML-разметка создается форма с тремя текстовыми полями. В коде, используйте `IsPost` свойства, чтобы определить, отправлен ли страницы перед началом обработки.

    Первым делом следует получить входные данные пользователя и его назначение переменных. Код затем присоединяет значения отдельных переменных в одну строку с разделителями запятыми, который сохраняется в другую переменную. Обратите внимание, что разделителем в виде запятой строку, содержащуюся в кавычки («,»), так как вы выполняете внедрение буквально запятую в больших строку, который вы создаете. В конце данные, которые можно сцепить друг с другом, добавлении `Environment.NewLine`. Это добавляет разрыв строки (символ перевода строки). Что вы создаете с помощью этого объединения — это строка, выглядит следующим образом:

    [!code-css[Main](working-with-files/samples/sample2.css)]

    (С невидимым разрыва строки в конце.)

    Затем создается переменная (`dataFile`), содержащий расположение и имя файла для хранения данных. Задание расположения требует особого обращения. В веб-сайтов, не рекомендуется для ссылки в коде в абсолютные пути, например *C:\Folder\File.txt* для файлов на веб-сервере. При перемещении веб-сайт, абсолютный путь будет работать неправильно. Кроме того для размещенного узла (а не на своем компьютере) вы обычно даже неизвестен правильный путь при написании кода.

    Но иногда (например, теперь для записи в файл) вам нужен полный путь. Решением является использование `MapPath` метод `Server` объекта. Это возвращает полный путь к веб-сайту. Для получения пути к корню веб-сайта, пользователь `~` оператор (для represen сайта виртуального корневого) для `MapPath`. (Можно также передать имя вложенной папки, например *~/App\_данных /*, чтобы получить путь к этой вложенной папке.) Затем можно сцепить Дополнительные сведения на любой метод возвращает для создания полного пути. В этом примере добавьте имя файла. (Дополнительные сведения о том, как работать с пути файлов и папок в [введение в ASP.NET веб-страниц программирование с использованием синтаксиса Razor](https://go.microsoft.com/fwlink/?LinkId=195205#ID_WorkingWithFileAndFolderPaths).)

    Файл сохраняется в *приложения\_данных* папки. Эта папка это особая папка, в ASP.NET, который используется для хранения файлов данных, как описано в разделе [введение в работу с базой данных в веб-узлы веб-страниц ASP.NET](https://go.microsoft.com/fwlink/?LinkId=195209).

    `WriteAllText` Метод `File` объект записывает данные в файл. Этот метод принимает два параметра: имя файла для записи и данные для записи (с путем). Обратите внимание, что в имени первого параметра `@` символ в качестве префикса. Это сообщает ASP.NET, что вы создаете буквального строкового литерала, а знаки, такие как «/» не должны интерпретироваться особым образом. (Дополнительные сведения см. в разделе [введение в ASP.NET веб-программирование с помощью синтаксиса Razor](https://go.microsoft.com/fwlink/?LinkId=195205#ID_WorkingWithFileAndFolderPaths).)

    > [!NOTE]
    > Чтобы код, чтобы сохранять файлы в *приложения\_данных* папки, приложение должно чтения и записи разрешения для этой папки. На компьютере разработчика не обычно это проблема. Тем не менее при публикации сайта поставщика услуг размещения веб-сервер, может потребоваться явно задать эти разрешения. Если вы запустите этот код на сервере поставщика услуг размещения и ошибки, проверьте с помощью поставщика услуг размещения, чтобы узнать, как задать эти разрешения.

- Откройте страницу в браузере. 

    ![](working-with-files/_static/image1.jpg)
- Введите значения в поля и нажмите кнопку **отправить**.
- Закройте браузер.
- Вернитесь к проекту и обновите представление.
- Откройте *data.txt* файла. Данные, переданные в форме находится в файле. 

    ![[изображение]](working-with-files/_static/image2.jpg)
- Закрыть *data.txt* файла.

<a id="Appending_Data"></a>
## <a name="appending-data-to-an-existing-file"></a>Добавление данных в существующий файл

В предыдущем примере вы использовали `WriteAllText` для создания текстового файла, в нем есть лишь одна часть данных. Если вы снова вызвать метод и передать его в то же имя файла, существующий файл перезаписывается полностью. Тем не менее после создания файла часто требуется добавлять новые данные в конец файла. Можно сделать с помощью `AppendAllText` метод `File` объекта.

1. На веб-сайте, создается копия *UserData.cshtml* файл и назовите ее *UserDataMultiple.cshtml*.
2. Замените блок кода перед открывающим `<!DOCTYPE html>` тег с приведенным ниже кодом: 

    [!code-cshtml[Main](working-with-files/samples/sample3.cshtml)]

    Этот код содержит одно изменение из предыдущего примера. Вместо использования `WriteAllText`, он использует `the AppendAllText` метод. Методы похожи, за исключением того, что `AppendAllText` добавляет данные в конец файла. Как и в `WriteAllText`, `AppendAllText` создает файл, если он еще не существует.
3. Откройте страницу в браузере.
4. Введите значения для полей и нажмите кнопку **отправить**.
5. Добавить дополнительные данные и снова отправить форму.
6. Вернитесь в проект, щелкните правой кнопкой мыши папку проекта и нажмите кнопку **обновить**.
7. Откройте *data.txt* файла. Теперь в нем новых данных, который вы только что ввели. 

    ![[изображение]](working-with-files/_static/image3.jpg)

<a id="Reading_and_Displaying_Data"></a>
## <a name="reading-and-displaying-data-from-a-file"></a>Чтение и отображение данных из файла

Даже если не нужно записывать данные в текстовый файл, возможно, иногда необходимо считывать данные из одного. Чтобы сделать это, можно снова использовать `File` объекта. Можно использовать `File` для считывания каждой строки по отдельности (разделенных точкой разрывы строк) или для чтения отдельный элемент, независимо от того, как они разделены.

Эта процедура показано, как для чтения и отображения данных, созданный в предыдущем примере.

1. В корне веб-сайта, создайте файл с именем *DisplayData.cshtml*.
2. Замените существующее содержимое следующим: 

    [!code-cshtml[Main](working-with-files/samples/sample4.cshtml)]

    Код начинается с чтении файла, созданного в предыдущем примере в переменной с именем `userData`, используя вызов этого метода:

    [!code-css[Main](working-with-files/samples/sample5.css)]

    Для этого код находится внутри `if` инструкции. Если вы хотите прочитать файл, рекомендуется использовать `File.Exists` метод определить, доступен ли файл. Код также проверяет, является ли файл пустой.

    Текст страницы содержит два `foreach` циклы, вложенных друг друга. Внешний `foreach` цикл получает одну строку за раз из файла данных. В этом случае строки определяются разрывы строк в файле &#8212; каждого элемента данных является на отдельной строке. Внешний цикл создает новый элемент (`<li>` элемент) внутри упорядоченный список (`<ol>` элемент).

    Внутренний цикл разбивает каждую строку данных на элементы (поля), используя запятую в качестве разделителя. (Исходя из предыдущего примера, это означает, что каждая строка содержит три поля &#8212; имя, фамилию и адрес электронной почты, разделенные запятыми.) Внутренний цикл также создает `<ul>` списков и отображает один элемент для каждого поля в строке данных.

    Код показывает, как использовать два типа данных массива и `char` тип данных. Массив является обязательным, поскольку `File.ReadAllLines` метод возвращает данные в виде массива. `char` Тип данных является обязательным, поскольку `Split` возвращает `array` в которой каждый элемент имеет тип `char`. (Сведения о массивах см. в разделе [введение в ASP.NET веб-программирование с помощью синтаксиса Razor](https://go.microsoft.com/fwlink/?LinkId=202890#ID_CollectionsAndObjects).)
3. Откройте страницу в браузере. Отображаются данные, введенный в предыдущих примерах. 

    ![[изображение]](working-with-files/_static/image4.jpg)

> [!TIP] 
> 
> **Отображение данных из файла с разделителями запятыми Microsoft Excel**
> 
> Можно использовать Microsoft Excel, чтобы сохранить данные, содержащиеся в электронную таблицу в формате с разделителями запятыми (*.csv* файла). При этом файл сохраняется в виде обычного текста, а не в формате Excel. Каждая строка в таблице, разделенные разрыв строки в текстовом файле и каждого элемента данных, разделенные запятой. Код, показанный в предыдущем примере можно использовать для чтения файла с разделителями запятыми Excel так же, изменив имя файла данных в коде.


<a id="Deleting_Files"></a>
## <a name="deleting-files"></a>Удаление файлов

Чтобы удалить файлы с веб-сайта, можно использовать `File.Delete` метод. Эта процедура показано, как разрешить пользователям удалять изображения (*.jpg* файла) из *образы* папку, если они знают имя файла.

> [!NOTE] 
> 
> **Важные** в рабочем веб-сайте, вы обычно ограничивать доступ для внесения изменений в данные. Дополнительные сведения о том, как настроить членство и о способах авторизации пользователей для выполнения задач на узле, см. в разделе [Добавление безопасности и членство в сайте веб-страниц ASP.NET](https://go.microsoft.com/fwlink/?LinkId=202904).


1. На веб-сайте, создайте вложенную папку с именем *образы*.
2. Скопируйте один или несколько *.jpg* файлы в *образы* папки.
3. В корне веб-сайта, создайте новый файл с именем *FileDelete.cshtml*.
4. Замените существующее содержимое следующим: 

    [!code-cshtml[Main](working-with-files/samples/sample6.cshtml)]

    Эта страница содержит форму для ввода имени файла изображения. Они не вводите *.jpg* расширение имени файла; ограничивая имя файла, следующим образом, которые помогут запрещает пользователям удалять произвольные файлы на вашем сайте.

    Код считывает имя файла, что пользователь ввел и затем создает полный путь. Чтобы создать путь, в коде используется текущий путь к веб-сайта (возвращенная `Server.MapPath` метод), *образы* имя папки, имя, которое пользователь предоставил и «.jpg» как строковый литерал.

    Для удаления файла, код вызывает метод `File.Delete` , передавая его полный путь, который вы только что создан. В конце разметку выводится сообщение с подтверждением удаления файла.
5. Откройте страницу в браузере. 

    ![[изображение]](working-with-files/_static/image5.jpg)
6. Введите имя файла для удаления и нажмите кнопку **отправить**. Если файл был удален, имя файла отображается в нижней части страницы.

<a id="Letting_Users_Upload_a_File"></a>
## <a name="letting-users-upload-a-file"></a>Позволяя пользователям отправлять файл

`FileUpload` Вспомогательный позволяет пользователям отправлять файлы на веб-сайт. Следующей процедуре показано, как пользователи могут передать один файл.

1. Добавьте библиотеку ASP.NET на веб-сайт, как описано в [Установка вспомогательных функций на сайте веб-страниц ASP.NET](https://go.microsoft.com/fwlink/?LinkId=252372), если вы не добавили ранее.
2. В *приложения\_данных* папки, создайте новую папку и назовите его *UploadedFiles*.
3. В корне, создайте новый файл с именем *FileUpload.cshtml*.
4. Замените существующее содержимое на странице следующее: 

    [!code-cshtml[Main](working-with-files/samples/sample7.cshtml)]

    Часть тела страницы приложения использует `FileUpload` вспомогательный метод для создания, передачи и кнопки, вы, вероятно, знакомы с:

    ![[изображение]](working-with-files/_static/image6.jpg)

    Свойства, заданные для `FileUpload` вспомогательный укажите, что один флажок для файла, отправляемого и возникает необходимость «отправить» для чтения **отправить**. (Вы добавите дополнительные поля чуть позже.)

    Когда пользователь щелкает **отправить**, получает файл кода в верхней части страницы и сохраняет его. `Request` Объекта, который обычно используется для получения значений из полей формы также имеет `Files` массив, содержащий файл (или файлы), были переданы. Вы можете получить отдельные файлы из определенной позиции в массиве &#8212; к примеру, чтобы получить первый загруженный файл, вы получаете `Request.Files[0]`, чтобы получить второй файл, вы получаете `Request.Files[1]`, и т. д. (Помните, что в программировании инвентаризации обычно начинается с нуля).

    При извлечении отправленного файла, можно поместить его в переменной (здесь `uploadedFile`), что можно манипулировать ими. Чтобы определить имя отправленного файла, просто получить его `FileName` свойство. Тем не менее, в том случае, когда пользователь отправляет файл, `FileName` содержит исходное имя пользователя, который содержит весь путь. Он может выглядеть следующим образом:

    *C:\Users\Public\Sample.txt*

    Вы не хотите пути данных, однако, потому что это путь на компьютере пользователя, а не для сервера. Необходимо просто фактическим именем файла (*Sample.txt*). Только файл из пути можно убрать с помощью `Path.GetFileName` метод следующим образом:

    [!code-csharp[Main](working-with-files/samples/sample8.cs)]

    `Path` Объект — это программа, имеет ряд методов следующим образом, можно использовать для удаления путей, объединение контуров и т. д.

    Когда вы азы имя отправленного файла, вы можете создать новый путь, для которых требуется сохранить загруженный файл в веб-сайта. В этом случае вы объединить `Server.MapPath`, имена папок (*приложения\_данных/UploadedFiles*) и имя только что удаленный файл, чтобы создать новый путь. Затем можно вызвать отправленный файл `SaveAs` метод фактически сохранить файл.
5. Откройте страницу в браузере. 

    ![[изображение]](working-with-files/_static/image7.jpg)
6. Нажмите кнопку **Обзор** и выберите файл для передачи. 

    ![[изображение]](working-with-files/_static/image8.jpg)

    Текстовое поле рядом с полем **Обзор** кнопка будет содержать путь к файлу и расположение.

    ![[изображение]](working-with-files/_static/image9.jpg)
7. Нажмите кнопку **Выгрузка**.
8. В веб-сайт, щелкните правой кнопкой мыши папку проекта и нажмите кнопку **обновить**.
9. Откройте *UploadedFiles* папки. Загруженный файл находится в папке. 

    ![[изображение]](working-with-files/_static/image10.jpg)

<a id="Letting_Users_Upload_Multiple_Files"></a>
## <a name="letting-users-upload-multiple-files"></a>Позволяя пользователям отправить несколько файлов

В предыдущем примере пользователи передать один файл. Но вы можете использовать `FileUpload` вспомогательный метод для отправки нескольких файлов одновременно. Это удобно для таких сценариев, как передача фотографий, где загружать по одному файлу за раз становится утомительным. (Сведения о передача фотографий в [работа с изображениями на сайте веб-страниц ASP.NET](https://go.microsoft.com/fwlink/?LinkId=202897).) В этом примере показано, как разрешить пользователям отправлять два за один раз несмотря на то, что для передачи более того, можно использовать тот же метод.

1. Добавьте библиотеку ASP.NET на веб-сайт, как описано в [Установка вспомогательных функций на сайте веб-страниц ASP.NET](https://go.microsoft.com/fwlink/?LinkId=252372), если у вас еще нет.
2. Создать новую страницу с именем *FileUploadMultiple.cshtml*.
3. Замените существующее содержимое на странице следующее:  

    [!code-cshtml[Main](working-with-files/samples/sample9.cshtml)]

    В этом примере `FileUpload` пользователям загрузить два файла по умолчанию настроен вспомогательная функция в основной области страницы. Так как `allowMoreFilesToBeAdded` присваивается `true`, вспомогательное приложение отображает ссылку, которая позволяет пользователю добавлять дополнительные поля, передачи:

    ![[изображение]](working-with-files/_static/image11.jpg)

    Для обработки файлов, которые пользователь отправляет на сервер, в коде используется единая базовая методика, которая использовалась в предыдущем примере &#8212; получения файла из `Request.Files` и сохраните его. (Включая различные моменты необходимо сделать, чтобы получить правильное имя файла и путь.) Инновации сейчас том, что пользователь может быть передачу нескольких файлов и вы не знаете многие. Чтобы узнать, можно получить `Request.Files.Count`.

    С этим номером в руке можно перебирать `Request.Files`, в свою очередь выборки каждый файл и сохраните его. Если необходимо применить цикл известных несколько раз в коллекции, можно использовать `for` цикл, следующим образом:

    [!code-csharp[Main](working-with-files/samples/sample10.cs)]

    Переменная `i` просто переходит от нуля до любой верхний предел, можно задать временной счетчик. В этом случае верхний предел — количество файлов. Но поскольку счетчика начинается с нуля, что является типичным для подсчета сценариев в ASP.NET, верхний предел фактически один меньше, чем количество файлов. (Если передаются три файла, число составляет от 0 до 2).

    `uploadedCount` Переменной суммирует все файлы, которые были успешно загружены и сохранены. Этот код учетных записей для вероятность того, что файл ожидаемый не сможете отправить.
4. Откройте страницу в браузере. В браузере отобразится страница и его отправки два поля.
5. Выберите два файла для отправки.
6. Нажмите кнопку **добавьте еще один файл**. На странице отображается новое окно отправки. 

    ![[изображение]](working-with-files/_static/image12.jpg)
7. Нажмите кнопку **Выгрузка**.
8. В веб-сайт, щелкните правой кнопкой мыши папку проекта и нажмите кнопку **обновить**.
9. Откройте *UploadedFiles* папку для просмотра файлов успешно отправлен.

<a id="Additional_Resources"></a>
## <a name="additional-resources"></a>Дополнительные ресурсы


[Работа с изображениями на сайте страниц ASP.NET Web](https://go.microsoft.com/fwlink/?LinkId=202897)

[Экспорт в CSV-файл](https://msdn.microsoft.com/library/ms155919.aspx)
