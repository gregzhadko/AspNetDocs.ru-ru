---
uid: web-pages/overview/data/working-with-files
title: Работа с файлами на сайте веб-страницы ASP.NET (Razor) | Документация Майкрософт
author: Rick-Anderson
description: В этой главе объясняется, как читать, записывать, добавлять, удалять и отправлять файлы.
ms.author: riande
ms.date: 02/20/2014
ms.assetid: eee916e4-ba4c-439a-a24e-68df7d45a569
msc.legacyurl: /web-pages/overview/data/working-with-files
msc.type: authoredcontent
ms.openlocfilehash: 684c47a8a8480dc040e5144144577c94c35d39e5
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78521886"
---
# <a name="working-with-files-in-an-aspnet-web-pages-razor-site"></a>Работа с файлами на сайте веб-страницы ASP.NET (Razor)

от [Tom фитзмаккен](https://github.com/tfitzmac)

> В этой статье объясняется, как читать, записывать, добавлять, удалять и отправлять файлы на сайте веб-страницы ASP.NET (Razor).
> 
> > [!NOTE]
> > Если требуется передать изображения и управлять ими (например, отразить или изменить их размер), см. статью [Работа с образами на веб-страницы ASP.net сайте](/aspnet/web-pages/overview/ui-layouts-and-themes/9-working-with-images).
> 
> 
> **Что вы узнаете:** 
> 
> - Создание текстового файла и запись в него данных.
> - Добавление данных в существующий файл.
> - Как читать файл и отображать его из него.
> - Удаление файлов с веб-сайта.
> - Как разрешить пользователям отправлять один файл или несколько файлов.
> 
> Это функции программирования ASP.NET, представленные в статье:
> 
> - Объект `File`, который предоставляет способ управления файлами.
> - Вспомогательный метод `FileUpload`.
> - Объект `Path`, предоставляющий методы, позволяющие управлять путями и именами файлов.
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a>Версии программного обеспечения, используемые в этом руководстве
> 
> 
> - Веб-страницы ASP.NET (Razor) 2
> - WebMatrix 2
>   
> 
> Этот учебник также работает с WebMatrix 3.

<a id="Creating_a_Text_File"></a>
## <a name="creating-a-text-file-and-writing-data-to-it"></a>Создание текстового файла и запись в него данных

Помимо использования базы данных на веб-сайте, вы можете работать с файлами. Например, текстовые файлы можно использовать как простой способ хранения данных для сайта. (Текстовый файл, используемый для хранения данных, иногда называется *неструктурированным файлом*.) Текстовые файлы могут быть в разных форматах, например *txt*, *XML*или *CSV* (значения, разделенные запятыми).

Если требуется хранить данные в текстовом файле, можно использовать метод `File.WriteAllText`, чтобы указать создаваемый файл и данные для записи в него. В этой процедуре вы создадите страницу, содержащую простую форму с тремя `input` элементами (имя, фамилия и адрес электронной почты) и кнопку **Submit (отправить** ). Когда пользователь отправляет форму, входные данные пользователя сохраняются в текстовом файле.

1. Создайте новую папку с именем *App\_Data*(если она еще не существует).
2. В корне веб-сайта создайте новый файл с именем *UserData. cshtml*.
3. Замените имеющееся содержимое следующим: 

    [!code-cshtml[Main](working-with-files/samples/sample1.cshtml)]

    Разметка HTML создает форму с тремя текстовыми полями. В коде используйте свойство `IsPost`, чтобы определить, была ли страница отправлена перед началом обработки.

    Первая задача — получить входные данные пользователя и присвоить ее переменным. Затем код объединяет значения отдельных переменных в одну строку с разделителями-запятыми, которая затем сохраняется в другой переменной. Обратите внимание, что разделитель-запятая — это строка, заключенная в кавычки (","), так как вы буквально внедряете запятую в создаваемую большую строку. В конце данных, объединяемых вместе, добавьте `Environment.NewLine`. Это добавляет разрыв строки (символ новой строки). То, что вы создаете при этом объединении, — это строка, которая выглядит следующим образом:

    [!code-css[Main](working-with-files/samples/sample2.css)]

    (С невидимым разрывом строки в конце.)

    Затем создается переменная (`dataFile`), которая содержит расположение и имя файла для хранения данных. Для настройки расположения требуется специальная обработка. На веб-сайтах неплохой практикой является ссылка в коде на абсолютные пути, например *к:\фолдер\филе.ткст* для файлов на веб-сервере. Если веб-сайт перемещен, абсолютный путь будет неверным. Кроме того, для размещенного сайта (а не на своем компьютере) обычно не известно, какой именно путь используется при написании кода.

    Но иногда (как и сейчас для записи файла) требуется полный путь. Решение заключается в использовании метода `MapPath` объекта `Server`. Это возвращает полный путь к веб-сайту. Чтобы получить путь к корневому каталогу веб-сайта, пользователь должен выполнить оператор `~` (чтобы репресен виртуальный корневой каталог сайта) для `MapPath`. (Можно также передать имя вложенной папки, например *~/апп\_Data/* , чтобы получить путь для этой вложенной папки.) Затем можно объединить дополнительные сведения в метод, возвращаемый методом, чтобы создать полный путь. В этом примере вы добавите имя файла. (Дополнительные сведения о работе с путями к файлам и папкам см. в статье [Введение в веб-страницы ASP.NET программирование с помощью синтаксиса Razor](https://go.microsoft.com/fwlink/?LinkId=195205#ID_WorkingWithFileAndFolderPaths)).

    Файл сохраняется в папке *приложения\_данных* . Эта папка является особой папкой в ASP.NET, используемой для хранения файлов данных, как описано в статье [Общие сведения о работе с базой данных на веб-страницы ASP.NET сайтах](https://go.microsoft.com/fwlink/?LinkId=195209).

    Метод `WriteAllText` объекта `File` записывает данные в файл. Этот метод принимает два параметра: имя (с путем) файла для записи и фактические данные для записи. Обратите внимание, что имя первого параметра содержит символ `@` в качестве префикса. Это говорит ASP.NET, что вы предоставляете Буквальный строковый литерал, и такие символы, как «/», не должны интерпретироваться особым образом. (Дополнительные сведения см. [в статье Введение в веб-программирование ASP.NET с использованием синтаксиса Razor](https://go.microsoft.com/fwlink/?LinkId=195205#ID_WorkingWithFileAndFolderPaths)).

    > [!NOTE]
    > Чтобы код сохранял файлы в папке Application *\_Data* , приложению требуются разрешения на чтение и запись для этой папки. На компьютере разработки это обычно не является проблемой. Однако при публикации сайта на веб-сервере поставщика услуг размещения может потребоваться явно задать эти разрешения. Если запустить этот код на сервере поставщика услуг размещения и получить ошибки, обратитесь к поставщику услуг размещения, чтобы узнать, как задать эти разрешения.

- Запустите страницу в браузере. 

    ![](working-with-files/_static/image1.jpg)
- Введите значения в поля и нажмите кнопку **Отправить**.
- Закройте браузер.
- Вернитесь к проекту и обновите представление.
- Откройте файл *Data. txt* . Данные, отправленные в форме, находятся в файле. 

    ![[образ]](working-with-files/_static/image2.jpg)
- Закройте файл *Data. txt* .

<a id="Appending_Data"></a>
## <a name="appending-data-to-an-existing-file"></a>Добавление данных в существующий файл

В предыдущем примере вы использовали `WriteAllText`, чтобы создать текстовый файл, в котором имеется только один фрагмент данных. Если вызвать метод еще раз и передать ему то же имя файла, существующий файл будет полностью перезаписан. Однако после создания файла часто требуется добавить новые данные в конец файла. Это можно сделать с помощью метода `AppendAllText` объекта `File`.

1. На веб-сайте создайте копию файла *UserData. cshtml* и назовите копию *усердатамултипле. cshtml*.
2. Замените блок кода перед открывающим тегом `<!DOCTYPE html>` следующим блоком кода: 

    [!code-cshtml[Main](working-with-files/samples/sample3.cshtml)]

    Этот код имеет одно изменение в нем из предыдущего примера. Вместо использования `WriteAllText`используется метод `the AppendAllText`. Методы похожи, за исключением того, что `AppendAllText` добавляет данные в конец файла. Как и в случае с `WriteAllText`, `AppendAllText` создает файл, если он еще не создан.
3. Запустите страницу в браузере.
4. Введите значения для полей и нажмите кнопку **Отправить**.
5. Добавьте дополнительные данные и отправьте форму еще раз.
6. Вернитесь к проекту, щелкните правой кнопкой мыши папку проекта и выберите команду **Обновить**.
7. Откройте файл *Data. txt* . Теперь он содержит только что введенные новые данные. 

    ![[образ]](working-with-files/_static/image3.jpg)

<a id="Reading_and_Displaying_Data"></a>
## <a name="reading-and-displaying-data-from-a-file"></a>Чтение и отображение данных из файла

Даже если вам не нужно записывать данные в текстовый файл, скорее всего, иногда требуется считывать данные из них. Для этого можно снова использовать объект `File`. Можно использовать объект `File` для чтения каждой отдельной строки (разделенных разрывами строк) или для чтения отдельных элементов независимо от того, как они разделены.

В этой процедуре показано, как считывать и отображать данные, созданные в предыдущем примере.

1. В корне веб-сайта создайте новый файл с именем *дисплайдата. cshtml*.
2. Замените имеющееся содержимое следующим: 

    [!code-cshtml[Main](working-with-files/samples/sample4.cshtml)]

    Код начинается с считывания файла, созданного в предыдущем примере, в переменную с именем `userData`, используя этот вызов метода:

    [!code-css[Main](working-with-files/samples/sample5.css)]

    Код для этого можно выполнить в операторе `if`. Если требуется считать файл, рекомендуется использовать метод `File.Exists`, чтобы определить, доступен ли файл. Код также проверяет, является ли файл пустым.

    Текст страницы содержит два цикла `foreach`, один из которых вложен в другой. Внешний цикл `foreach` получает по одной строке за раз из файла данных. В этом случае строки определяются разрывами строк в файле &#8212; , т. е. каждый элемент данных находится в отдельной строке. Внешний цикл создает новый элемент (`<li>` элемент) в упорядоченном списке (элемент`<ol>`).

    Внутренний цикл разделяет каждую строку данных на элементы (поля), используя запятую в качестве разделителя. (На основе предыдущего примера это означает, что каждая строка содержит три поля &#8212; : имя, фамилия и адрес электронной почты, разделенные запятыми.) Во внутреннем цикле также создается список `<ul>` и отображается один элемент списка для каждого поля в строке данных.

    В коде показано, как использовать два типа данных: массив и тип данных `char`. Массив является обязательным, так как метод `File.ReadAllLines` возвращает данные в виде массива. Тип данных `char` является обязательным, так как метод `Split` возвращает `array`, в котором каждый элемент имеет тип `char`. (Дополнительные сведения о массивах см. в статье [Введение в веб-программирование ASP.NET с использованием синтаксиса Razor](https://go.microsoft.com/fwlink/?LinkId=202890#ID_CollectionsAndObjects)).
3. Запустите страницу в браузере. Отобразятся данные, введенные для предыдущих примеров. 

    ![[образ]](working-with-files/_static/image4.jpg)

> [!TIP] 
> 
> **Отображение данных из файла с разделителями-запятыми Microsoft Excel**
> 
> Microsoft Excel можно использовать для сохранения данных, содержащихся в электронной таблице, в виде файла с разделителями-запятыми (*CSV* ). В этом случае файл сохраняется в виде обычного текста, а не в формате Excel. Каждая строка листа отделяется разрывом строки в текстовом файле, а каждый элемент данных отделяется запятой. Код, приведенный в предыдущем примере, можно использовать для чтения файла с разделителями-запятыми Excel только путем изменения имени файла данных в коде.

<a id="Deleting_Files"></a>
## <a name="deleting-files"></a>Удаление файлов

Чтобы удалить файлы с веб-сайта, можно использовать метод `File.Delete`. В этой процедуре показано, как разрешить пользователям удалять образ (*JPG* -файл) из папки *Images* , если он знает имя файла.

> [!NOTE] 
> 
> **Важно!** На рабочем веб-сайте обычно ограничивается доступ к данным, разрешенным для внесения изменений. Сведения о настройке членства и способах авторизации пользователей для выполнения задач на сайте см. [в разделе Добавление безопасности и членства на веб-страницы ASP.net сайте](https://go.microsoft.com/fwlink/?LinkId=202904).

1. На веб-сайте создайте вложенную папку с именем *Images*.
2. Скопируйте один или несколько *JPG* файлов в папку *Images* .
3. В корневом каталоге веб-сайта создайте новый файл с именем *выполнить операцию filedelete. cshtml*.
4. Замените имеющееся содержимое следующим: 

    [!code-cshtml[Main](working-with-files/samples/sample6.cshtml)]

    Эта страница содержит форму, в которой пользователи могут ввести имя файла изображения. Они не вводят расширение имени файла *. jpg* ; ограничение имени файла позволит предотвратить удаление пользователями произвольных файлов на сайте.

    Код считывает имя файла, которое пользователь указал, а затем формирует полный путь. Чтобы создать путь, код использует текущий путь веб-сайта (возвращенный методом `Server.MapPath`), имя папки *изображений* , имя, предоставленное пользователем, и ". jpg" как литеральную строку.

    Чтобы удалить файл, код вызывает метод `File.Delete`, передавая ему полный путь, который был только что создан. В конце разметки код выводит сообщение с подтверждением об удалении файла.
5. Запустите страницу в браузере. 

    ![[образ]](working-with-files/_static/image5.jpg)
6. Введите имя файла, который нужно удалить, и нажмите кнопку **Отправить**. Если файл был удален, имя файла отображается в нижней части страницы.

<a id="Letting_Users_Upload_a_File"></a>
## <a name="letting-users-upload-a-file"></a>Предоставление пользователям возможности отправки файла

Вспомогательный модуль `FileUpload` позволяет пользователям отправлять файлы на веб-сайт. В следующей процедуре показано, как разрешить пользователям отправлять один файл.

1. Добавьте библиотеку вспомогательных веб-функций ASP.NET на веб-сайт, как описано в разделе [Установка вспомогательных функций на веб-страницы ASP.net сайте](https://go.microsoft.com/fwlink/?LinkId=252372), если он не был добавлен ранее.
2. В папке *приложения\_данные* создайте новую папку и назовите ее *уплоадедфилес*.
3. В корневом каталоге создайте новый файл с именем *FileUpload. cshtml*.
4. Замените существующее содержимое на странице следующим: 

    [!code-cshtml[Main](working-with-files/samples/sample7.cshtml)]

    В текстовой части страницы используется вспомогательная функция `FileUpload` для создания поля отправки и кнопок, которые, скорее всего, уже знакомы:

    ![[образ]](working-with-files/_static/image6.jpg)

    Свойства, заданные для вспомогательного метода `FileUpload`, указывают, что необходимо передать одно поле для файла и чтобы кнопка отправки **была доступна для**чтения. (Далее в этой статье вы добавите дополнительные поля.)

    Когда пользователь нажимает кнопку **Отправить**, код в верхней части страницы получает файл и сохраняет его. Объект `Request`, который обычно используется для получения значений из полей формы, также имеет `Files` массив, содержащий файл (или файлы), который был отправлен. Можно получить отдельные файлы из определенных позиций в массиве &#8212; . Например, чтобы получить первый отправленный файл, вы получаете `Request.Files[0]`, получите второй файл, `Request.Files[1]`и т. д. (Помните, что при программировании подсчет обычно начинается с нуля.)

    При выборе отправленного файла он помещается в переменную (здесь `uploadedFile`), что позволяет управлять ею. Чтобы определить имя отправленного файла, достаточно получить его свойство `FileName`. Однако когда пользователь отправляет файл, `FileName` содержит исходное имя пользователя, включающее весь путь. Он может выглядеть следующим образом:

    *к:\усерс\публик\сампле.ткст*

    Но вам не нужно ничего делать с данными о пути, так как это путь на компьютере пользователя, а не для сервера. Вам нужно только действительное имя файла (*Sample. txt*). Можно извлечь только файл из пути с помощью метода `Path.GetFileName`, как это происходит:

    [!code-csharp[Main](working-with-files/samples/sample8.cs)]

    Объект `Path` — это служебная программа с несколькими методами, такими как, которые можно использовать для чередования путей, объединения контуров и т. д.

    После получения имени отправленного файла можно создать новый путь, по которому нужно сохранить отправленный файл на веб-сайте. В этом случае вы объединяете `Server.MapPath`, имена папок (*App\_Data/уплоадедфилес*) и имя созданного файла, чтобы создать новый путь. Затем можно вызвать метод `SaveAs` отправленного файла, чтобы фактически сохранить файл.
5. Запустите страницу в браузере. 

    ![[образ]](working-with-files/_static/image7.jpg)
6. Нажмите кнопку **Обзор** и выберите файл для отправки. 

    ![[образ]](working-with-files/_static/image8.jpg)

    Текстовое поле рядом с кнопкой **Обзор** будет содержать путь и расположение файла.

    ![[образ]](working-with-files/_static/image9.jpg)
7. Щелкните **Отправить**.
8. На веб-сайте щелкните правой кнопкой мыши папку проекта и выберите команду **Обновить**.
9. Откройте папку *уплоадедфилес* . Отправленный файл находится в папке. 

    ![[образ]](working-with-files/_static/image10.jpg)

<a id="Letting_Users_Upload_Multiple_Files"></a>
## <a name="letting-users-upload-multiple-files"></a>Предоставление пользователям возможности отправки нескольких файлов

В предыдущем примере вы разрешите пользователям отправлять один файл. Однако можно использовать вспомогательный метод `FileUpload` для отправки нескольких файлов за раз. Это удобно в таких сценариях, как передача фотографий, когда отправка одного файла за раз выполняется утомительно. (Вы можете ознакомиться с отправкой фотографий в [работе с изображениями на веб-страницы ASP.net сайте](https://go.microsoft.com/fwlink/?LinkId=202897)). В этом примере показано, как разрешить пользователям отправлять два элемента за раз, хотя для их отправки можно использовать один и тот же метод.

1. Добавьте библиотеку вспомогательных веб-функций ASP.NET на веб-сайт, как описано в разделе [Установка вспомогательных функций на веб-страницы ASP.net сайте](https://go.microsoft.com/fwlink/?LinkId=252372), если вы этого еще не сделали.
2. Создайте новую страницу с именем *филеуплоадмултипле. cshtml*.
3. Замените существующее содержимое на странице следующим:  

    [!code-cshtml[Main](working-with-files/samples/sample9.cshtml)]

    В этом примере вспомогательный модуль `FileUpload` в тексте страницы настроен таким образом, чтобы пользователи могли отправлять два файла по умолчанию. Так как `allowMoreFilesToBeAdded` имеет значение `true`, вспомогательный объект визуализирует ссылку, которая позволяет пользователю добавить дополнительные поля отправки:

    ![[образ]](working-with-files/_static/image11.jpg)

    Для обработки файлов, которые отправляет пользователь, код использует ту же базовую методику, которая использовалась в предыдущем примере &#8212; , чтобы получить файл из `Request.Files` и сохранить его. (Включая различные вещи, необходимые для получения правильного имени и пути к файлу.) В этом случае пользователь может отправить несколько файлов, и вы не знакомы с ним много. Чтобы узнать это, можно получить `Request.Files.Count`.

    С учетом этого номера можно прокручивать `Request.Files`, выбирать каждый файл в свою очередь и сохранять его. Если вы хотите циклически прокручивать заданное число раз через коллекцию, можно использовать цикл `for` следующим образом:

    [!code-csharp[Main](working-with-files/samples/sample10.cs)]

    Переменная `i` является просто временным счетчиком, который перейдет от нуля к любому заданному вами верхнему пределу. В этом случае верхний предел — число файлов. Но поскольку счетчик начинается с нуля, как типично для сценариев инвентаризации в ASP.NET, верхний предел на самом деле меньше, чем число файлов. (Если передаются три файла, счетчик равен нулю.)

    `uploadedCount` переменная суммирует все файлы, которые успешно отправлены и сохранены. Этот код учетных записей может привести к невозможности отправки ожидаемого файла.
4. Запустите страницу в браузере. В браузере отобразится страница и два поля отправки.
5. Выберите два файла для отправки.
6. Щелкните **Добавить другой файл**. На странице отображается новое поле отправки. 

    ![[образ]](working-with-files/_static/image12.jpg)
7. Щелкните **Отправить**.
8. На веб-сайте щелкните правой кнопкой мыши папку проекта и выберите команду **Обновить**.
9. Откройте папку *уплоадедфилес* , чтобы просмотреть успешно отправленные файлы.

<a id="Additional_Resources"></a>
## <a name="additional-resources"></a>Дополнительные ресурсы

[Работа с изображениями на веб-страницы ASP.NET сайте](https://go.microsoft.com/fwlink/?LinkId=202897)

[Экспорт в CSV-файл](https://msdn.microsoft.com/library/ms155919.aspx)
