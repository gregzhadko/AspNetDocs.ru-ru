---
uid: web-pages/overview/ui-layouts-and-themes/validating-user-input-in-aspnet-web-pages-sites
title: Проверка вводимых пользователем данных в ASP.NET Web Pages сайтов (Razor) | Документация Майкрософт
author: Rick-Anderson
description: В этой статье рассматриваются способы проверки информации, полученной от пользователей &mdash; то есть, убедитесь, что пользователи вводят допустимые сведения в формате HTML forms в AS...
ms.author: riande
ms.date: 02/20/2014
ms.assetid: 4eb060cc-cf14-41ae-bab1-14a2c15332d0
msc.legacyurl: /web-pages/overview/ui-layouts-and-themes/validating-user-input-in-aspnet-web-pages-sites
msc.type: authoredcontent
ms.openlocfilehash: fd3ba36891aa66f78c28c538a4d3ba0da6736765
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/09/2019
ms.locfileid: "59392993"
---
# <a name="validating-user-input-in-aspnet-web-pages-razor-sites"></a>Проверка пользовательского ввода на сайтах ASP.NET Web Pages (Razor)

по [Tom FitzMacken](https://github.com/tfitzmac)

> В этой статье рассматриваются способы проверки информации, полученной от пользователей &mdash; то есть, убедитесь, что пользователи вводят допустимые сведения в формате HTML forms на сайте веб-страниц ASP.NET (Razor).
> 
> Вы узнаете, как:
> 
> - Как проверить, что пользовательского ввода соответствуют критериям проверки, определенных вами.
> - Как определить, прошли ли все проверочные тесты.
> - Способ отображения ошибок проверки (и форматировать их).
> - Как проверить данные, которые не поступают непосредственно из пользователей.
> 
> Ниже приведены основные понятия, представленные в этой статье программирования ASP.NET.
> 
> - `Validation` Вспомогательный.
> - `Html.ValidationSummary` И `Html.ValidationMessage` методы.
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a>Версии программного обеспечения, используемые в этом руководстве
> 
> 
> - Веб-страниц ASP.NET (Razor) 3
>   
> 
> Этот учебник также работает с ASP.NET Web Pages 2.


В этом разделе содержатся следующие подразделы:

- [Обзор проверка введенных пользователем данных](#Overview_of_User_Input_Validation)
- [Проверка вводимых пользователем данных](#Validating_User_Input)
- [Добавление проверки на стороне клиента](#Adding_Client-Side_Validation)
- [Форматирование ошибки проверки](#Formatting_Validation_Errors)
- [Проверка данных, который не поступают непосредственно из пользователей](#Validating_Data_That_Doesnt_Come_Directly_from_Users)

<a id="Overview_of_User_Input_Validation"></a>
## <a name="overview-of-user-input-validation"></a>Обзор проверка введенных пользователем данных

Если вы запрос на ввод сведений на странице — например, в форму, очень важно, чтобы убедиться в том, что значения, которые они вводят являются допустимыми. Например вы не хотите обрабатывать формы, в которой отсутствуют критически важные сведения.

При вводе значений в HTML-форму, они вводят значения строки. Во многих случаях необходимые значения других типов данных, таких как целые числа или даты. Таким образом необходимо также убедиться, что значения, которые пользователи вводят может быть правильно преобразован в соответствующие типы данных.

Кроме того, возможны некоторые ограничения на значения. Даже если пользователи неправильно вводят целое число, например, может потребоваться убедиться, что значение находится в пределах определенного диапазона.

![Ошибки проверки, которые используют классы стилей CSS](validating-user-input-in-aspnet-web-pages-sites/_static/image1.png)

> [!NOTE] 
> 
> **Важные** проверка вводимых пользователем данных также важна для обеспечения безопасности. Если вы ограничите значения, которые пользователи могут вводить в формах, снижается вероятность того, что кто-то можно ввести значение, которое может скомпрометировать безопасность веб-сайта.


<a id="Validating_User_Input"></a>
## <a name="validating-user-input"></a>Проверка вводимых пользователем данных

В ASP.NET Web Pages 2 можно использовать `Validator` вспомогательный метод для поля ввода. Основной подход заключается в том, выполнив следующие действия:

1. Определите, какие входные элементы (поля), которые требуется проверить.

    Вы обычно проверяете значения в `<input>` элементов в форму. Тем не менее, рекомендуется проверяйте весь ввод, даже входные данные, поступающие от ограниченного элемент, подобный `<select>` списка. Это позволяет убедиться, что пользователи не обхода элементов управления на странице и отправить форму.
2. В коде страницы добавьте отдельные проверки для каждого входного элемента с помощью методов класса `Validation` вспомогательный.

    Чтобы проверить наличие обязательных полей, используйте `Validation.RequireField(field, [error message])` (для отдельных полей) или `Validation.RequireFields(field1, field2, ...))` (для получения списка полей). Другие виды проверок используйте `Validation.Add(field, ValidationType)`. Для `ValidationType`, можно использовать следующие параметры:

    `Validator.DateTime ([error message])`  
   `Validator.Decimal([error message])`  
   `Validator.EqualsTo(otherField [, error message])`  
   `Validator.Float([error message])`  
   `Validator.Integer([error message])`  
   `Validator.Range(min, max [, error message])`  
   `Validator.RegEx(pattern [, error message])`  
   `Validator.Required([error message])`  
   `Validator.StringLength(length)`  
   `Validator.Url([error message])`
3. При отправке страницы, проверить, прошел ли проверку путем проверки `Validation.IsValid`:

    [!code-csharp[Main](validating-user-input-in-aspnet-web-pages-sites/samples/sample1.cs)]

    При возникновении ошибок проверки, то пропустить обработки обычных страниц. Например если страница предназначена для обновления базы данных, этого не сделать, пока не будут исправлены все ошибки проверки.
4. При возникновении ошибки проверки, отображение сообщения об ошибках в разметке страницы с помощью `Html.ValidationSummary` или `Html.ValidationMessage`, или оба.

В следующем примере страница, на которой показаны все эти шаги.

[!code-cshtml[Main](validating-user-input-in-aspnet-web-pages-sites/samples/sample2.cshtml)]

Чтобы увидеть, как работает проверка, запустите эту страницу и намеренно совершают ошибки. Например, вот как если вы забыли ввести название курса, если ввести выглядит страницы, и если ввести недопустимую дату:

![Ошибки проверки в отображаемой странице](validating-user-input-in-aspnet-web-pages-sites/_static/image2.png)

<a id="Adding_Client-Side_Validation"></a>
## <a name="adding-client-side-validation"></a>Добавление проверки на стороне клиента

По умолчанию проверяется ввод данных пользователем, после отправки страницы — то есть проверка выполняется в серверном коде. Недостаток этого подхода является то, что пользователи не знают, что они сделали ошибку до после их отправки страницы. Если форма является длинное или сложное, отчетов об ошибках только в том случае, после отправки страницы может быть неудобно для пользователя.

Вы можете добавить поддержку для выполнения проверки из клиентского скрипта. В этом случае проверка выполняется при работе в браузере. Например предположим, что можно указать, что значение должно быть целым. Если пользователь вводит нецелочисленное значение, ошибка, как только пользователь уходит из поля ввода. Пользователям получать немедленные отзывы, что удобно для них. Проверка на основе клиента можно также уменьшить количество раз, которые пользователь должен отправить форму, чтобы устранить несколько ошибок.

> [!NOTE]
> Даже если вы используете клиентскую проверку, в серверном коде всегда также выполняется проверка. Выполнение проверки в серверном коде является мерой безопасности, в случае, если пользователи пропустить проверку на стороне клиента.


1. Зарегистрируйте следующие библиотеки JavaScript на странице:  

    [!code-html[Main](validating-user-input-in-aspnet-web-pages-sites/samples/sample3.html)]

   Двух библиотек может быть загружено из сети доставки содержимого (CDN), поэтому вам не обязательно отобразить их на компьютере или сервере. Тем не менее, необходимо иметь локальную копию *jquery.validate.unobtrusive.js*. Если вы уже работаете не с помощью WebMatrix шаблона (например **начального сайта** ), содержит библиотеку, создание веб-страниц сайта, который основан на **начального сайта**. Затем скопируйте *.js* файла для текущего веб-узла.
2. В разметке, для каждого элемента, который проверка, добавьте вызов `Validation.For(field)`. Этот метод создает атрибуты, используемые для проверки на стороне клиента. (Вместо того чтобы выпуска фактического кода JavaScript, метод выдает атрибутов, таких как `data-val-...`. Эти атрибуты поддерживают ненавязчивой клиентской проверки, который использует jQuery для выполнения работы.)

Следующая страница демонстрирует добавление функции проверки клиента для примера, приведенного ранее.

[!code-cshtml[Main](validating-user-input-in-aspnet-web-pages-sites/samples/sample4.cshtml?highlight=35-39,51,61,71)]

Не все проверки запуска на клиенте. В частности проверка типа данных (целое число, Дата и т. д.) не выполняются на клиенте. На клиенте и сервере работают следующие проверки:

- `Required`
- `Range(minValue, maxValue)`
- `StringLength(maxLength[, minLength])`
- `Regex(pattern)`
- `EqualsTo(otherField)`

В этом примере теста для допустимой датой не будет работать в клиентском коде. Тем не менее тест будет выполняться в серверном коде.

<a id="Formatting_Validation_Errors"></a>
## <a name="formatting-validation-errors"></a>Форматирование ошибки проверки

Можно задать способ отображения ошибок проверки, определяя классы CSS, которые имеют следующие зарезервированные имена:

- `field-validation-error`. Определяет выходные данные `Html.ValidationMessage` метод, когда он отображает ошибку.
- `field-validation-valid`. Определяет выходные данные `Html.ValidationMessage` метод при отсутствии ошибок.
- `input-validation-error`. Определяет как `<input>` элементы отображаются в том случае, когда возникает ошибка. (Например, этот класс можно использовать, чтобы задать цвет фона &lt;входной&gt; элемент на другой цвет, если его значение является недопустимым.) Этот класс CSS используется только во время проверки клиента (в ASP.NET Web Pages 2).
- `input-validation-valid`. Определяет внешний вид `<input>` элементов при отсутствии ошибок.
- `validation-summary-errors`. Определяет выходные данные `Html.ValidationSummary` метод, он отображает список ошибок.
- `validation-summary-valid`. Определяет выходные данные `Html.ValidationSummary` метод при отсутствии ошибок.

Следующие `<style>` блока отображаются правила для условий ошибок.

[!code-css[Main](validating-user-input-in-aspnet-web-pages-sites/samples/sample5.css)]

Если включить этот блок стиля в примере страницы из ранее в этой статье, отображение ошибок будет выглядеть как на следующем рисунке:

![Ошибки проверки, которые используют классы стилей CSS](validating-user-input-in-aspnet-web-pages-sites/_static/image3.png)

> [!NOTE]
> Если вы не используете клиентская проверка в ASP.NET Web Pages 2, CSS классы для `<input>` элементы (`input-validation-error` и `input-validation-valid` не оказывает никакого воздействия.


### <a name="static-and-dynamic-error-display"></a>Отображение статических и динамических ошибок

Правила CSS возникают попарно, например `validation-summary-errors` и `validation-summary-valid`. Эти пары позволяют определить правила для обоих условий: ошибки и условие «Обычная работа» (без ошибок). Важно понимать, что разметка для отображения ошибок отображается всегда, даже если ошибок нет. Например, если страница содержит `Html.ValidationSummary` метод в разметке, исходный код страницы будет содержать следующую разметку даже в том случае, если страница запрашивается в первый раз:

`<div class="validation-summary-valid" data-valmsg-summary="true"><ul></ul></div>`

Другими словами `Html.ValidationSummary` метод всегда отображает `<div>` элемента и списка, даже если в списке ошибок является пустым. Аналогичным образом `Html.ValidationMessage` метод всегда отображает `<span>` элемент как заполнитель для ошибку отдельного поля, даже в том случае, если ошибки отсутствуют.

В некоторых ситуациях, отображая сообщение об ошибке может привести к странице, чтобы перекомпоновать и может привести к элементов на странице, чтобы перемещать. Правила CSS, которые заканчиваются на `-valid` позволяют определить макет, который может помочь предотвратить возникновение этой проблемы. Например, можно определить `field-validation-error` и `field-validation-valid` на оба имеют же фиксированный размер. Таким образом, отображаемую область для поля является статическим и поток страниц не изменится, если отображается сообщение об ошибке.

<a id="Validating_Data_That_Doesnt_Come_Directly_from_Users"></a>
## <a name="validating-data-that-doesnt-come-directly-from-users"></a>Проверка данных, который не поступают непосредственно из пользователей

Иногда необходимо проверить сведения, которые не поступают непосредственно из формы HTML. Типичным примером является страницей, где значение передается в строке запроса, как показано в следующем примере:

`http://server/myapp/EditClassInformation?classid=1022`

В этом случае необходимо убедиться, что значение, которое передается на страницу (здесь 1022 значения `classid`) является допустимым. Нельзя напрямую использовать `Validation` вспомогательный метод для выполнения этой проверки. Тем не менее можно использовать другие функции проверки системы, такие как возможность отображения сообщений об ошибках проверки.

> [!NOTE] 
> 
> **Важные** всегда проверяйте значения, получаемые из *любой* источника, включая значения поля формы, значения строки запроса и значений файла cookie. Это легко изменять эти значения (возможно злонамеренных целях). Поэтому необходимо проверить эти значения для защиты приложения.


В следующем примере показано, как может проверить значение, которое передается в строке запроса. Код проверяет, что значение не пустое, и что это целое число.

[!code-csharp[Main](validating-user-input-in-aspnet-web-pages-sites/samples/sample6.cs)]

Обратите внимание на то, что данная проверка выполняется, если запрос не является отправка формы (`if(!IsPost)`). Этот тест будет передан при первом запросе страницы, но не в том случае, если запрос имеет отправки формы.

Чтобы отобразить эту ошибку, можно добавить ошибки к списку ошибок проверки, вызвав `Validation.AddFormError("message")`. Если страница содержит вызов `Html.ValidationSummary` метод, ошибка отображается как ошибка проверки входных данных пользователя.

<a id="AdditionalResources"></a>
## <a name="additional-resources"></a>Дополнительные ресурсы

[Работа с HTML-форм в ASP.NET веб-страниц узлов](https://go.microsoft.com/fwlink/?LinkID=202892)
