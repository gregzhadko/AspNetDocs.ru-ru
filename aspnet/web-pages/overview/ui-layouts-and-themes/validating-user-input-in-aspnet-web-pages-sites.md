---
uid: web-pages/overview/ui-layouts-and-themes/validating-user-input-in-aspnet-web-pages-sites
title: Проверка вводимых пользователем данных на сайтах веб-страницы ASP.NET (Razor) | Документация Майкрософт
author: Rick-Anderson
description: В этой статье описано, как проверить сведения, получаемые от пользователей, &mdash; то есть убедиться, что пользователи вводят действительную информацию в HTML-формы как...
ms.author: riande
ms.date: 02/20/2014
ms.assetid: 4eb060cc-cf14-41ae-bab1-14a2c15332d0
msc.legacyurl: /web-pages/overview/ui-layouts-and-themes/validating-user-input-in-aspnet-web-pages-sites
msc.type: authoredcontent
ms.openlocfilehash: e6f8e1051d09d11f1756bfada44a73ba7c2a1db2
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78454302"
---
# <a name="validating-user-input-in-aspnet-web-pages-razor-sites"></a>Проверка вводимых пользователем данных на сайтах веб-страницы ASP.NET (Razor)

от [Tom фитзмаккен](https://github.com/tfitzmac)

> В этой статье описано, как проверить сведения, получаемые от пользователей, &mdash; то есть убедиться, что пользователи вводят действительную информацию в HTML-формы на сайте веб-страницы ASP.NET (Razor).
> 
> Из этого руководства вы узнаете, как выполнять такие задачи:
> 
> - Проверка того, соответствуют ли входные данные пользователя определенным условиям проверки.
> - Как определить, пройдены ли все проверочные тесты.
> - Как отобразить ошибки проверки (и способ их форматирования).
> - Проверка данных, которые не поступают непосредственно от пользователей.
> 
> Ниже приведены основные понятия программирования ASP.NET, представленные в статье:
> 
> - Вспомогательный метод `Validation`.
> - Методы `Html.ValidationSummary` и `Html.ValidationMessage`.
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a>Версии программного обеспечения, используемые в этом руководстве
> 
> 
> - Веб-страницы ASP.NET (Razor) 3
>   
> 
> Этот учебник также работает с веб-страницы ASP.NET 2.

Эта статья состоит из следующих разделов:

- [Общие сведения о проверке вводимых пользователем данных](#Overview_of_User_Input_Validation)
- [Проверка вводимых пользователем данных](#Validating_User_Input)
- [Добавление проверки на стороне клиента](#Adding_Client-Side_Validation)
- [Ошибки проверки форматирования](#Formatting_Validation_Errors)
- [Проверка данных, которые не приходят непосредственно от пользователей](#Validating_Data_That_Doesnt_Come_Directly_from_Users)

<a id="Overview_of_User_Input_Validation"></a>
## <a name="overview-of-user-input-validation"></a>Общие сведения о проверке вводимых пользователем данных

Если вы запрашиваете у пользователей ввод информации на странице (например, в форму), важно убедиться, что введенные значения допустимы. Например, вы не хотите обрабатывать форму, в которой отсутствуют важные сведения.

Когда пользователь вводит значения в HTML-форму, вводимые им значения являются строками. Во многих случаях нужными значениями являются другие типы данных, такие как целые числа или даты. Поэтому необходимо также убедиться, что значения, вводимые пользователями, могут быть правильно преобразованы в соответствующие типы данных.

Кроме того, могут иметься определенные ограничения на значения. Даже если пользователи правильно вводят целое число, например, может потребоваться убедиться в том, что значение попадает в определенный диапазон.

![Ошибки проверки, использующие классы стилей CSS](validating-user-input-in-aspnet-web-pages-sites/_static/image1.png)

> [!NOTE] 
> 
> **Важно!** Проверка вводимых пользователем данных также важна для обеспечения безопасности. Если ограничить значения, которые пользователи могут вводить в формы, можно уменьшить вероятность того, что кто-то сможет ввести значение, которое может нарушить безопасность вашего сайта.

<a id="Validating_User_Input"></a>
## <a name="validating-user-input"></a>Проверка введенного пользователем

В веб-страницы ASP.NET 2 можно использовать вспомогательный метод `Validator` для проверки вводимых пользователем данных. Базовый подход состоит в следующем:

1. Определите, какие элементы ввода (поля) необходимо проверить.

    Обычно значения проверяются в элементах `<input>` в форме. Однако рекомендуется проверять все входные данные, даже входные данные, поступающие из ограниченного элемента, такого как список `<select>`. Это помогает убедиться, что пользователи не обходят элементы управления на странице и не отправляют форму.
2. В коде страницы добавьте отдельные проверки для каждого элемента ввода с помощью методов вспомогательного метода `Validation`.

    Чтобы проверить обязательные поля, используйте `Validation.RequireField(field, [error message])` (для отдельного поля) или `Validation.RequireFields(field1, field2, ...))` (для списка полей). Для других типов проверки используйте `Validation.Add(field, ValidationType)`. Для `ValidationType`можно использовать следующие параметры:

    `Validator.DateTime ([error message])`  
   `Validator.Decimal([error message])`  
   `Validator.EqualsTo(otherField [, error message])`  
   `Validator.Float([error message])`  
   `Validator.Integer([error message])`  
   `Validator.Range(min, max [, error message])`  
   `Validator.RegEx(pattern [, error message])`  
   `Validator.Required([error message])`  
   `Validator.StringLength(length)`  
   `Validator.Url([error message])`
3. При отправке страницы проверьте, пройдена ли проверка, проверив `Validation.IsValid`:

    [!code-csharp[Main](validating-user-input-in-aspnet-web-pages-sites/samples/sample1.cs)]

    При наличии каких-либо ошибок проверки обработка страниц пропускается. Например, если целью страницы является обновление базы данных, это не делается, пока не будут исправлены все ошибки проверки.
4. При наличии ошибок проверки выведите сообщения об ошибках в разметке страницы с помощью `Html.ValidationSummary` или `Html.ValidationMessage`или и того, и другого.

В следующем примере показана страница, на которой показаны эти шаги.

[!code-cshtml[Main](validating-user-input-in-aspnet-web-pages-sites/samples/sample2.cshtml)]

Чтобы узнать, как работает проверка, запустите эту страницу и намеренно выполните ошибки. Например, вот как выглядит страница, если вы забыли ввести название курса, если ввести и ввести недопустимую дату:

![Ошибки проверки на странице, подготовленной для просмотра](validating-user-input-in-aspnet-web-pages-sites/_static/image2.png)

<a id="Adding_Client-Side_Validation"></a>
## <a name="adding-client-side-validation"></a>Добавление клиентской проверки

По умолчанию вводимые пользователем данные проверяются после того, как пользователи отправляют страницу — то есть проверка выполняется в коде сервера. Недостаток этого подхода заключается в том, что пользователи не узнают, что они сделали ошибку до отправки страницы. Если форма является длинной или сложной, отчеты об ошибках могут быть неудобными для пользователя только после отправки страницы.

Вы можете добавить поддержку для выполнения проверки в клиентском скрипте. В этом случае проверка выполняется по мере работы пользователей в браузере. Например, предположим, что значение должно быть целым числом. Если пользователь вводит нецелочисленное значение, сообщение об ошибке выводится сразу после того, как пользователь покидает поле ввода. Пользователи получают немедленную обратную связь, которая удобна для них. Проверка на основе клиента может также сократить число попыток пользователя отправить форму для исправления нескольких ошибок.

> [!NOTE]
> Даже если используется проверка на стороне клиента, проверка всегда выполняется в коде сервера. Выполнение проверки в коде сервера — это мера безопасности, если пользователи обходят проверку на основе клиента.

1. Зарегистрируйте следующие библиотеки JavaScript на странице:  

    [!code-html[Main](validating-user-input-in-aspnet-web-pages-sites/samples/sample3.html)]

   Две библиотеки доступны для загрузки из сети доставки содержимого (CDN), поэтому они не обязательно должны находиться на компьютере или сервере. Однако необходимо иметь локальную копию *jQuery. Validate. unobtrusive. js*. Если вы еще не работаете с шаблоном WebMatrix (например, **начальным сайтом** ), включающим библиотеку, создайте сайт веб-страниц, основанный на **начальном сайте**. Затем скопируйте *JS* -файл на текущий сайт.
2. В разметке для каждого проверяемого элемента добавьте вызов `Validation.For(field)`. Этот метод выдает атрибуты, используемые при проверке на стороне клиента. (Вместо того, чтобы выдавать фактический код JavaScript, метод выдает такие атрибуты, как `data-val-...`. Эти атрибуты поддерживают ненавязчивую проверку клиента, которая использует jQuery для выполнения работы.)

На следующей странице показано, как добавить функции проверки клиента в приведенный выше пример.

[!code-cshtml[Main](validating-user-input-in-aspnet-web-pages-sites/samples/sample4.cshtml?highlight=35-39,51,61,71)]

Не все проверки выполняются на клиенте. В частности, проверка типа данных (целое число, Дата и т. д.) не выполняется на клиенте. Следующие проверки работают и на клиенте, и на сервере:

- `Required`
- `Range(minValue, maxValue)`
- `StringLength(maxLength[, minLength])`
- `Regex(pattern)`
- `EqualsTo(otherField)`

В этом примере тест для допустимой даты не будет работать в клиентском коде. Однако тест будет выполняться в коде сервера.

<a id="Formatting_Validation_Errors"></a>
## <a name="formatting-validation-errors"></a>Ошибки проверки форматирования

Вы можете управлять отображением ошибок проверки, определив классы CSS, которые имеют следующие зарезервированные имена:

- `field-validation-error`. Определяет выходные данные метода `Html.ValidationMessage` при отображении ошибки.
- `field-validation-valid`. Определяет выходные данные метода `Html.ValidationMessage` при отсутствии ошибок.
- `input-validation-error`. Определяет, как `<input>` подготавливать элементы при возникновении ошибки. (Например, с помощью этого класса можно задать цвет фона &lt;входного элемента&gt;, который имеет другой цвет, если его значение недопустимо.) Этот класс CSS используется только во время проверки клиента (в веб-страницы ASP.NET 2).
- `input-validation-valid`. Определяет внешний вид элементов `<input>` при отсутствии ошибок.
- `validation-summary-errors`. Определяет выходные данные метода `Html.ValidationSummary`, в котором отображается список ошибок.
- `validation-summary-valid`. Определяет выходные данные метода `Html.ValidationSummary` при отсутствии ошибок.

В следующем блоке `<style>` показаны правила для условий ошибки.

[!code-css[Main](validating-user-input-in-aspnet-web-pages-sites/samples/sample5.css)]

Если включить этот блок стиля в примеры страниц, описанные ранее в этой статье, то отображение ошибок будет выглядеть, как на следующем рисунке:

![Ошибки проверки, использующие классы стилей CSS](validating-user-input-in-aspnet-web-pages-sites/_static/image3.png)

> [!NOTE]
> Если клиентская проверка не используется в веб-страницы ASP.NET 2, классы CSS для элементов `<input>` (`input-validation-error` и `input-validation-valid` не имеют никакого влияния.

### <a name="static-and-dynamic-error-display"></a>Статическое и динамическое отображение ошибок

Правила CSS поставляются в виде пар, таких как `validation-summary-errors` и `validation-summary-valid`. Эти пары позволяют определять правила для обоих условий: условие ошибки и условие "нормальное (не ошибка)". Важно понимать, что разметка для отображения ошибок всегда отображается, даже если ошибок нет. Например, если на странице имеется `Html.ValidationSummary` метод в разметке, то источник страницы будет содержать следующую разметку, даже если страница запрашивается в первый раз:

`<div class="validation-summary-valid" data-valmsg-summary="true"><ul></ul></div>`

Иными словами, метод `Html.ValidationSummary` всегда отображает элемент `<div>` и список, даже если список ошибок пуст. Аналогичным образом, метод `Html.ValidationMessage` всегда отображает элемент `<span>` в качестве заполнителя для ошибки отдельного поля, даже если нет ошибки.

В некоторых ситуациях отображение сообщения об ошибке может вызвать перекомпоновку страницы и может вызвать перемещение элементов на странице. Правила CSS, которые заканчиваются `-valid` позволяют определить макет, который может помочь предотвратить эту проблему. Например, можно определить, `field-validation-error` и `field-validation-valid` оба имеют одинаковый фиксированный размер. Таким образом, область отображения для поля является статической и не будет изменяться при отображении сообщения об ошибке.

<a id="Validating_Data_That_Doesnt_Come_Directly_from_Users"></a>
## <a name="validating-data-that-doesnt-come-directly-from-users"></a>Проверка данных, которые не приходят непосредственно от пользователей

Иногда необходимо проверить сведения, которые не поступают непосредственно из HTML-формы. Типичным примером является страница, в которой значение передается в строке запроса, как показано в следующем примере:

`http://server/myapp/EditClassInformation?classid=1022`

В этом случае необходимо убедиться, что значение, передаваемое на страницу (здесь 1022 для значения `classid`), является допустимым. Для выполнения этой проверки нельзя напрямую использовать вспомогательный метод `Validation`. Однако можно использовать другие функции системы проверки, например возможность отображать сообщения об ошибках проверки.

> [!NOTE] 
> 
> **Важно!** Всегда проверяйте значения, получаемые из *любого* источника, включая значения полей форм, значения строк запросов и значения файлов cookie. Пользователям легко изменить эти значения (возможно, для вредоносных целей). Поэтому необходимо проверить эти значения, чтобы защитить приложение.

В следующем примере показано, как можно проверить значение, передаваемое в строку запроса. Код проверяет, что значение не пусто и является целым числом.

[!code-csharp[Main](validating-user-input-in-aspnet-web-pages-sites/samples/sample6.cs)]

Обратите внимание, что тест выполняется, если запрос не является отправкой формы (`if(!IsPost)`). Этот тест будет пройден при первом запросе страницы, но не в том случае, если запрос является отправкой формы.

Чтобы отобразить эту ошибку, можно добавить ошибку в список ошибок проверки, вызвав `Validation.AddFormError("message")`. Если страница содержит вызов метода `Html.ValidationSummary`, отображается ошибка, аналогично ошибке проверки ввода пользователем.

<a id="AdditionalResources"></a>
## <a name="additional-resources"></a>Дополнительные ресурсы

[Работа с HTML-формами на веб-страницы ASP.NET сайтах](https://go.microsoft.com/fwlink/?LinkID=202892)
