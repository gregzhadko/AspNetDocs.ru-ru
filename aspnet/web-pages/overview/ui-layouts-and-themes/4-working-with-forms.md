---
uid: web-pages/overview/ui-layouts-and-themes/4-working-with-forms
title: Работа с формами HTML на сайтах веб-страницы ASP.NET (Razor) | Документация Майкрософт
author: Rick-Anderson
description: Форма — это раздел HTML-документа, в котором можно размещать пользовательские элементы управления, например текстовые поля, флажки, переключатели и раскрывающиеся списки. Вы используете формы, что...
ms.author: riande
ms.date: 02/10/2014
ms.assetid: f3f4b8c8-e8f6-4474-ad94-69228a6c01ee
msc.legacyurl: /web-pages/overview/ui-layouts-and-themes/4-working-with-forms
msc.type: authoredcontent
ms.openlocfilehash: c7d4802063c8610a246afe67bd15eea429f7304a
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78519606"
---
# <a name="working-with-html-forms-in-aspnet-web-pages-razor-sites"></a>Работа с формами HTML на сайтах веб-страницы ASP.NET (Razor)

от [Tom фитзмаккен](https://github.com/tfitzmac)

> В этой статье описывается обработка формы HTML (с помощью текстовых полей и кнопок) при работе на веб-сайте веб-страницы ASP.NET (Razor).
> 
> **Что вы узнаете:** 
> 
> - Создание HTML-формы.
> - Чтение вводимых пользователем данных из формы.
> - Проверка ввода данных пользователем.
> - Восстановление значений формы после отправки страницы.
> 
> Ниже приведены основные понятия программирования ASP.NET, представленные в статье:
> 
> - Объект `Request`.
> - Проверка входных данных.
> - Кодировка HTML.
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a>Версии программного обеспечения, используемые в этом руководстве
> 
> 
> - Веб-страницы ASP.NET (Razor) 3
>   
> 
> Этот учебник также работает с веб-страницы ASP.NET 2.

## <a name="creating-a-simple-html-form"></a>Создание простой HTML-формы

1. Создайте новый веб-сайт.
2. В корневой папке создайте веб-страницу с именем *Form. cshtml* и введите следующую разметку:

    [!code-html[Main](4-working-with-forms/samples/sample1.html)]
3. Откройте страницу в браузере. (В WebMatrix в рабочей области **файлы** щелкните правой кнопкой мыши файл и выберите **запустить в браузере**.) Отображается простая форма с тремя полями ввода и кнопками **отправки** .

    ![Снимок экрана формы с тремя текстовыми полями.](4-working-with-forms/_static/image1.png)

    На этом этапе при нажатии кнопки **Submit** ничего не происходит. Чтобы сделать форму полезной, необходимо добавить код, который будет выполняться на сервере.

## <a name="reading-user-input-from-the-form"></a>Чтение вводимых пользователем данных из формы

Для обработки формы необходимо добавить код, считывающий отправленные значения полей и выполняющий с ними какие-либо действия. В этой процедуре показано, как считывать поля и отображать вводимые пользователем данные на странице. (В рабочем приложении, как правило, вы выполняете более интересные действия с вводом данных пользователем. Это можно сделать в статье о работе с базами данных.)

1. В верхней части файла *Form. cshtml* введите следующий код:

    [!code-cshtml[Main](4-working-with-forms/samples/sample2.cshtml)]

    Когда пользователь впервые запрашивает страницу, отображается только пустая форма. Пользователь (который будет вам) заполняет форму, а затем нажимает кнопку **Отправить**. Он отправляет (отправляет) входные данные пользователя на сервер. По умолчанию запрос переходит на ту же страницу (а именно, *Form. cshtml*).

    При отправке страницы на этот раз введенные значения отображаются непосредственно над формой:

    ![Снимок экрана, на котором отображаются значения, введенные на странице.](4-working-with-forms/_static/image2.png)

    Взгляните на код страницы. Сначала используется метод `IsPost`, чтобы определить, выполняется ли отправка страницы &#8212; , то есть ли пользователь щелкнул кнопку Submit ( **Отправить** ). Если это POST, `IsPost` возвращает значение true. Это стандартный способ веб-страницы ASP.NET определить, работаете ли вы с первоначальным запросом (запрос GET) или обратная передача (запрос POST). (Дополнительные сведения о GET и POST см. в боковой панели "HTTP GET and POST и свойство" Post "статьи [Введение в веб-страницы ASP.NET программирование с использованием синтаксиса Razor](https://go.microsoft.com/fwlink/?LinkId=202890#SB_HttpGetPost)).

    Далее вы получаете значения, введенные пользователем из объекта `Request.Form`, и помещаете их в переменные для последующего использования. Объект `Request.Form` содержит все значения, отправленные со страницей, каждый из которых определяется ключом. Ключ эквивалентен атрибуту `name` поля формы, которое необходимо считать. Например, чтобы прочитать поле `companyname` (текстовое поле), используйте `Request.Form["companyname"]`.

    Значения формы хранятся в объекте `Request.Form` в виде строк. Поэтому, если необходимо работать со значением как с числом или с датой, так и с другим типом, необходимо преобразовать его из строки в этот тип. В этом примере метод `AsInt` `Request.Form` используется для преобразования значения поля Employees (который содержит число сотрудников) в целое число.
2. Откройте страницу в браузере, заполните поля формы и нажмите кнопку **Отправить**. На странице отображаются введенные значения.

> [!TIP] 
> 
> <a id="SB_HTMLEncoding"></a>
> ### <a name="html-encoding-for-appearance-and-security"></a>Кодировка HTML для внешнего вида и безопасности
> 
> HTML имеет специальное использование для таких символов, как `<`, `>`и `&`. Если эти специальные символы отображаются там, где они не ожидались, они могут насмарку внешний вид и функциональность веб-страницы. Например, браузер интерпретирует `<`ный символ (если за ним не следует пробел) в начале HTML-элемента, например `<b>` или `<input ...>`. Если браузер не распознает элемент, он просто отбрасывает строку, которая начинается с `<`, пока не достигнет того, что оно снова распознает. Очевидно, что это может привести к некоторому отображению на странице.
> 
> В кодировке HTML эти зарезервированные символы заменяются кодом, который браузер интерпретирует как правильный символ. Например, `<` символ заменяется `&lt;`, а `>` символ заменяется на `&gt;`. Браузер отображает эти строки замены в виде символов, которые необходимо просмотреть.
> 
> Рекомендуется использовать кодировку HTML при каждом отображении строк (входных данных), полученных от пользователя. В противном случае пользователь может попытаться получить веб-страницу для запуска вредоносного сценария или выполнить какие-либо другие действия, которые принарушат безопасность веб-сайта или не только то, что вам нужно. (Это особенно важно, если вы принимаете ввод пользователя, сохраняете его в любом расположении, &#8212; а затем отображаете его позже, например, в виде комментария к блогу, проверки пользователя или что-то вроде этого.)
> 
> Чтобы предотвратить возникновение этих проблем, веб-страницы ASP.NET автоматически кодирует любое текстовое содержимое, полученное из кода, в формате HTML. Например, при отображении содержимого переменной или выражения с помощью кода, такого как `@MyVar`, веб-страницы ASP.NET автоматически кодирует выходные данные.

## <a name="validating-user-input"></a>Проверка введенного пользователем

Пользователи делают ошибки. Вы попросите их заполнить поле, и они забывают, или попросите их ввести число сотрудников, а вместо этого ввести имя. Чтобы убедиться в правильности заполнения формы перед ее обработкой, проверьте входные данные пользователя.

В этой процедуре показано, как проверить все три поля формы, чтобы убедиться, что пользователь не оставляет их пустыми. Кроме того, проверяется, является ли значение количество сотрудников числом. При наличии ошибок отобразится сообщение об ошибке, сообщающее пользователю, какие значения не прошли проверку.

1. В файле *Form. cshtml* Замените первый блок кода следующим кодом: 

    [!code-cshtml[Main](4-working-with-forms/samples/sample3.cshtml)]

    Для проверки вводимых пользователем данных используется вспомогательная функция `Validation`. Обязательные поля регистрируются путем вызова `Validation.RequireField`. Вы регистрируете другие типы проверки, вызывая `Validation.Add` и указывая поле для проверки и тип выполняемой проверки.

    При запуске страницы ASP.NET выполняет всю проверку. Результаты можно проверить, вызвав `Validation.IsValid`, который возвращает значение true, если все передано, и false, если какое бы то ни было поле не прошло проверку. Как правило, вызывается `Validation.IsValid` перед выполнением обработки на входе пользователя.
2. Обновите элемент `<body>`, добавив три вызова метода `Html.ValidationMessage` следующим образом:

    [!code-cshtml[Main](4-working-with-forms/samples/sample4.cshtml?highlight=8,13,18)]

    Чтобы отобразить сообщения об ошибках проверки, можно вызвать HTML.`ValidationMessage` и передайте ему имя поля, для которого должно быть получено сообщение.
3. Запустите страницу. Оставьте поля пустыми и нажмите кнопку **Отправить**. Отображаются сообщения об ошибках.

    ![Снимок экрана, на котором отображаются сообщения об ошибках, если ввод пользователя не прошел проверку.](4-working-with-forms/_static/image3.jpg)
4. Добавьте строку (например, "ABC") в поле " **число сотрудников** " и нажмите кнопку **Отправить** еще раз. На этот раз отображается ошибка, указывающая, что строка не имеет правильный формат, а именно целое число.

    ![Снимок экрана, на котором показаны сообщения об ошибках, отображаемые при вводе пользователем строки для поля Employees.](4-working-with-forms/_static/image4.jpg)

Веб-страницы ASP.NET предоставляет дополнительные возможности для проверки вводимых пользователем данных, включая возможность автоматического выполнения проверки с помощью клиентского скрипта, чтобы пользователи могли немедленно получить отзыв в браузере. Дополнительные сведения см. в разделе [Дополнительные ресурсы](#Additional_Resources) .

## <a name="restoring-form-values-after-postbacks"></a>Восстановление значений форм после обратных передач

Проверив страницу в предыдущем разделе, вы могли заметить, что при возникновении ошибки проверки все введенные вами данные (не только недопустимые) были потеряны, и пришлось повторно вводить значения для всех полей. Это иллюстрирует важный момент: когда вы отправляете страницу, обрабатываете ее, а затем снова отображаете страницу, страница повторно создается с нуля. Как вы видели, это означает, что все значения, которые были на странице при отправке, теряются.

Однако это легко исправить. У вас есть доступ к значениям, которые были отправлены (в объекте `Request.Form`, поэтому эти значения можно заполнить в полях формы при подготовке страницы к просмотру.

1. В файле *Form. cshtml* замените атрибуты `value` элементов `<input>` с помощью атрибута `value`.: 

    [!code-cshtml[Main](4-working-with-forms/samples/sample5.cshtml?highlight=13,19,25)]

    Атрибут `value` элементов `<input>` был задан для динамического считывания значения поля из объекта `Request.Form`. При первом запросе страницы значения в объекте `Request.Form` будут пустыми. Это нормально, так как форма пуста.
2. Откройте страницу в браузере, заполните поля формы или оставьте их пустыми и нажмите кнопку **Отправить**. Отобразится страница, на которой отображаются отправленные значения.

    ![Forms-5](4-working-with-forms/_static/image5.jpg)

<a id="Additional_Resources"></a>
## <a name="additional-resources"></a>Дополнительные ресурсы

- [1 001. способы получения входных данных от веб-пользователей](https://msdn.microsoft.com/library/ms971057.aspx)
- [Использование форм и обработка пользовательского ввода](https://msdn.microsoft.com/library/ms525182(VS.90).aspx)
- [Проверка пользовательского ввода на сайтах веб-страниц ASP.NET](https://go.microsoft.com/fwlink/?LinkId=253002)
- [Использование автозаполнения в формах HTML](https://msdn.microsoft.com/library/ms533032(VS.85).aspx)
