---
uid: web-pages/overview/ui-layouts-and-themes/9-working-with-images
title: Работа с изображениями на сайте веб-страницы ASP.NET (Razor) | Документация Майкрософт
author: Rick-Anderson
description: В этой главе показано, как добавлять, отображать и обрабатывать изображения (изменение размера, отражение и Добавление водяных знаков) на веб-сайте.
ms.author: riande
ms.date: 02/20/2014
ms.assetid: 778c4e58-4372-4d25-bab9-aec4a8d8e38d
msc.legacyurl: /web-pages/overview/ui-layouts-and-themes/9-working-with-images
msc.type: authoredcontent
ms.openlocfilehash: 53514b3c314fc182a43c82974ffcfa8158a636a1
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78512880"
---
# <a name="working-with-images-in-an-aspnet-web-pages-razor-site"></a>Работа с изображениями на сайте веб-страницы ASP.NET (Razor)

от [Tom фитзмаккен](https://github.com/tfitzmac)

> В этой статье показано, как добавлять, отображать и изменять изображения (изменение размера, отражение и Добавление водяных знаков) на веб-сайте веб-страницы ASP.NET (Razor).
> 
> Из этого руководства вы узнаете, как выполнять такие задачи:
> 
> - Динамическое добавление изображения на страницу.
> - Как разрешить пользователям отправлять изображение.
> - Изменение размера изображения.
> - Как отразить или повернуть изображение.
> - Добавление водяного знака к изображению.
> - Использование изображения в качестве водяного знака.
> 
> Это функции программирования ASP.NET, представленные в статье:
> 
> - Вспомогательный метод `WebImage`.
> - Объект `Path`, предоставляющий методы, позволяющие управлять путями и именами файлов.
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a>Версии программного обеспечения, используемые в этом руководстве
> 
> 
> - Веб-страницы ASP.NET (Razor) 2
> - WebMatrix 2
>   
> 
> Этот учебник также работает с WebMatrix 3.

<a id="Adding_an_Image"></a>
## <a name="adding-an-image-to-a-web-page-dynamically"></a>Динамическое добавление изображения на веб-страницу

Вы можете добавлять изображения на веб-сайт и на отдельные страницы во время разработки веб-сайта. Можно также разрешить пользователям отправлять изображения, что может оказаться полезным для таких задач, как Добавление фотографии профиля.

Если изображение уже доступно на сайте и его нужно отобразить на странице, используйте HTML-элемент `<img>` следующим образом:

[!code-html[Main](9-working-with-images/samples/sample1.html)]

Однако иногда необходимо иметь возможность отображать изображения динамически &#8212; , то есть вы не будете знать, какой образ отображать, пока страница не будет запущена.

Процедура в этом разделе показывает, как отобразить изображение на лету, где пользователи указывают имя файла изображения из списка имен образов. Они выбирают имя изображения из раскрывающегося списка, и при отправке страницы отображается выбранное изображение.

![Эскиз](9-working-with-images/_static/image1.jpg "ch9images-1. jpg")

1. В WebMatrix создайте новый веб-сайт.
2. Добавьте новую страницу с именем *динамиЦимаже. cshtml*.
3. В корневой папке веб-сайта добавьте новую папку и назовите ее *Images*.
4. Добавьте четыре изображения в только что созданную папку *Images* . (Все изображения, которые вы имеете под рукой, будут выполнены, но они должны попадать на страницу.) Переименуйте образы *Photo1. jpg*, *Photo2. jpg*, *Photo3. jpg*и *Photo4. jpg*. (В этой процедуре вы не будете использовать *Photo4. jpg* , но вы будете использовать его позже в этой статье.)
5. Убедитесь, что четыре изображения не помечены как доступные только для чтения.
6. Замените существующее содержимое на странице следующим:

    [!code-cshtml[Main](9-working-with-images/samples/sample2.cshtml)]

    В тексте страницы имеется раскрывающийся список (элемент `<select>`) с именем `photoChoice`. Список имеет три параметра, а атрибут `value` каждого параметра списка имеет имя одного из образов, помещаемых в папку *Images* . По сути, список позволяет пользователю выбрать понятное имя, например &quot;Photo 1&quot;, а затем передает имя *JPG* -файла при отправке страницы.

    В коде можно получить выбор пользователя (иными словами, имя файла изображения) из списка, прочитав `Request["photoChoice"]`. Прежде всего, вы увидите, есть ли выбор. Если это так, для образа создается путь, состоящий из имени папки для изображений и имени файла образа пользователя. (Если вы попытались создать путь, но в `Request["photoChoice"]`не было ничего, возникнет ошибка.) В результате получается относительный путь следующего вида:

    *Images/Photo1. jpg*

    Путь хранится в переменной с именем `imagePath`, которая понадобится позже на странице.

    В теле также имеется элемент `<img>`, который используется для вывода изображения, подобранного пользователем. Атрибуту `src` не присвоено имя или URL-адрес файла, например, для вывода статического элемента. Вместо этого ему присваивается значение `@imagePath`, означающее, что оно получает его из пути, заданного в коде.

    Однако при первом запуске страницы нет изображения, которое можно отобразить, так как пользователь ничего не выбрал. Обычно это означает, что атрибут `src` будет пустым, а изображение будет отображаться как красный &quot;x&quot; (или что угодно, когда обозреватель не сможет найти изображение). Чтобы избежать этого, поставьте элемент `<img>` в блок `if`, который проверяет, содержит ли переменная `imagePath` какое-либо значение. Если пользователь сделал выбор, `imagePath` содержит путь. Если пользователь не выберет изображение или если страница отображается впервые, элемент `<img>` не отображается.
7. Сохраните файл и запустите страницу в браузере. (Перед выполнением страницы убедитесь, что она выбрана в рабочей области **файлы** .)
8. Выберите изображение из раскрывающегося списка и щелкните **образец изображения**. Убедитесь, что для разных вариантов отображаются разные образы.

<a id="Uploading_an_Image"></a>
## <a name="uploading-an-image"></a>Отправка изображения

В предыдущем примере показано, как динамически отобразить изображение, но оно работало только с изображениями, которые уже были на вашем веб-сайте. В этой процедуре показано, как разрешить пользователям отправлять изображение, которое затем отображается на странице. В ASP.NET можно управлять образами на лету с помощью вспомогательного метода `WebImage`, который содержит методы, позволяющие создавать изображения, управлять ими и сохранять их. Вспомогательный модуль `WebImage` поддерживает все общие типы файлов веб-изображений, включая *JPG*, *PNG*и *BMP*. В этой статье вы будете использовать *JPG* изображения, но можете использовать любой из типов изображений.

![Эскиз](9-working-with-images/_static/image2.jpg "ch9images-2. jpg")

1. Добавьте новую страницу и назовите ее *уплоадимаже. cshtml*.
2. Замените существующее содержимое на странице следующим: 

    [!code-cshtml[Main](9-working-with-images/samples/sample3.cshtml)]

    Текст текста содержит элемент `<input type="file">`, который позволяет пользователям выбрать файл для отправки. Когда они нажимайте кнопку **Отправить**, выбранный файл отправляется вместе с формой.

    Для получения отправленного изображения используется вспомогательное средство `WebImage`, которое имеет все виды полезных методов для работы с образами. В частности, используйте `WebImage.GetImageFromRequest`, чтобы получить переданный образ (при наличии) и сохранить его в переменной с именем `photo`.

    Большая часть работы в этом примере включает в себя получение и задание имен файлов и путей. Эта ошибка заключается в том, что необходимо получить имя образа (и только имя) изображения, которое было отправлено пользователем, а затем создать новый путь, по которому будет храниться образ. Так как пользователи потенциально могут передавать несколько образов с одинаковыми именами, для создания уникальных имен можно использовать немного дополнительного кода и гарантировать, что пользователи не перезапишут существующие изображения.

    Если изображение на самом деле было отправлено (`if (photo != null)`тестирования), вы получаете имя образа из свойства `FileName` изображения. Когда пользователь отправляет образ, `FileName` содержит исходное имя пользователя, которое содержит путь от компьютера пользователя. Он может выглядеть следующим образом:

    *C:\Users\Joe\Pictures\SamplePhoto1.jpg*

    Вы не хотите использовать всю информацию о пути, &#8212; хотя вам нужно только действительное имя файла (*SamplePhoto1. jpg*). Можно извлечь только файл из пути с помощью метода `Path.GetFileName`, как это происходит:

    [!code-csharp[Main](9-working-with-images/samples/sample4.cs)]

    Затем можно создать новое уникальное имя файла, добавив идентификатор GUID к исходному имени. (Дополнительные сведения об идентификаторах GUID см. в подразделе [об идентификаторах GUID](#SB_AboutGUIDs) далее в этой статье.) Затем создается полный путь, который можно использовать для сохранения изображения. Путь сохранения состоит из нового имени файла, папки (изображений) и текущего расположения веб-сайта.

    > [!NOTE]
    > Чтобы в коде сохранялись файлы в папке *Images* , приложению требуются разрешения на чтение и запись для этой папки. На компьютере разработки это обычно не является проблемой. Однако при публикации сайта на веб-сервере поставщика услуг размещения может потребоваться явно задать эти разрешения. Если запустить этот код на сервере поставщика услуг размещения и получить ошибки, обратитесь к поставщику услуг размещения, чтобы узнать, как задать эти разрешения.

    Наконец, необходимо передать путь сохранения в метод `Save` вспомогательного метода `WebImage`. В этом случае отправленный образ будет сохранен под новым именем. Метод Save выглядит следующим образом: `photo.Save(@"~\" + imagePath)`. К `@"~\"`у добавляется полный путь, который является текущим расположением веб-сайта. (Дополнительные сведения об операторе `~` см. [в разделе Введение в веб-программирование ASP.NET с использованием синтаксиса Razor](https://go.microsoft.com/fwlink/?LinkId=202890#ID_WorkingWithFileAndFolderPaths).)

    Как и в предыдущем примере, текст страницы содержит элемент `<img>` для вывода изображения. Если `imagePath` задано, то элемент `<img>` готовится к просмотру, а его атрибуту `src` присваивается значение `imagePath`.
3. Запустите страницу в браузере.
4. Передайте изображение и убедитесь, что оно отображается на странице.
5. На сайте откройте папку *Images* . Вы увидите, что добавлен новый файл, имя файла которого выглядит примерно так: 

    *45ea4527-7ddd-4965-b9ca-c6444982b342\_Мифото. png*

    Это образ, который вы передавали с префиксом GUID и именем. (Собственный файл будет иметь другой GUID и, вероятно, будет называться что-то, что отличается от *мифото. png*.)

> [!TIP] 
> 
> <a id="SB_AboutGUIDs"></a>
> ### <a name="about-guids"></a>Сведения об идентификаторах GUID
> 
> GUID (глобальный уникальный идентификатор) — это идентификатор, который обычно подготавливается к просмотру в следующем формате: `936DA01F-9ABD-4d9d-80C7-02AF85C822A8`. Цифры и буквы (от A-F) отличаются для каждого идентификатора GUID, но все они следуют шаблону использования групп из 8-4-4-4-12 символов. (Технически идентификатор GUID представляет собой 16-байтовый или 128-разрядный номер.) Если вам нужен идентификатор GUID, можно вызвать Специальный код, создающий идентификатор GUID. Идея в идентификаторах GUID заключается в том, что между огромным размером числа (3,4 x 10<sup>38</sup>) и алгоритмом его создания, полученный номер гарантированно может быть одним из видов. Таким образом, идентификаторы GUID являются хорошим способом создания имен для объектов, когда необходимо гарантировать, что одно и то же имя не будет использоваться дважды. Недостаток этого подхода состоит в том, что идентификаторы GUID не особенно понятны для пользователей, поэтому они обычно используются, когда имя используется только в коде.

<a id="Resizing_an_Image"></a>
## <a name="resizing-an-image"></a>Изменение размера изображения

Если веб-сайт принимает изображения от пользователя, может потребоваться изменить размер изображений перед их отображением или сохранением. Для этого можно снова использовать вспомогательный метод `WebImage`.

В этой процедуре показано, как изменить размер отправленного изображения, чтобы создать эскиз, а затем сохранить эскиз и исходное изображение на веб-сайте. Эскиз отображается на странице и используется гиперссылка для перенаправления пользователей в образ с полным размером.

![Эскиз](9-working-with-images/_static/image3.jpg "ch9images-3. jpg")

1. Добавьте новую страницу с именем *thumbnail. cshtml*.
2. В папке *Images* создайте вложенную папку с именем *Thumbs*.
3. Замените существующее содержимое на странице следующим: 

    [!code-cshtml[Main](9-working-with-images/samples/sample5.cshtml)]

    Этот код похож на код из предыдущего примера. Разница заключается в том, что этот код сохраняет изображение дважды, как обычно и один раз после создания эскиза изображения. Сначала вы получаете отправленное изображение и сохраняете его в папке *Images* . Затем создается новый путь к эскизу. Чтобы создать эскиз, вызовите метод `Resize` вспомогательного метода `WebImage`, чтобы создать изображение размером 60 пикселей на 60 пикселей. В этом примере показано, как сохранить пропорции и как можно предотвратить увеличение изображения (в случае, если новый размер окажется больше, чем изображение будет увеличено). После этого изображение с измененным размером сохраняется во вложенной папке *Thumbs* .

    В конце разметки используется тот же элемент `<img>` с атрибутом Dynamic `src`, который вы видели в предыдущих примерах для условного отображения изображения. В этом случае отображается эскиз. Вы также используете элемент `<a>`, чтобы создать гиперссылку на большую версию изображения. Как и атрибут `src` элемента `<img>`, динамически устанавливается атрибут `href` элемента `<a>` в `imagePath`. Чтобы убедиться, что путь может работать в качестве URL-адреса, передается `imagePath` методу `Html.AttributeEncode`, который преобразует зарезервированные символы в пути в символы, которые в URL-адресе имеют значение OK.
4. Запустите страницу в браузере.
5. Отправьте фотографию и убедитесь, что эскиз отображается.
6. Щелкните эскиз, чтобы увидеть изображение с полным размером.
7. Обратите внимание, что в *изображениях* и *изображениях*и на эскизах добавлены новые файлы.

<a id="Rotating_and_Flipping"></a>
## <a name="rotating-and-flipping-an-image"></a>Поворот и зеркальное отображение изображения

Вспомогательный модуль `WebImage` также позволяет переворачивать изображения и перемещать их. В этой процедуре показано, как получить изображение с сервера, вернуть изображение вниз по вертикали (вертикально), сохранить его, а затем отобразить перевернутое изображение на странице. В этом примере используется файл, уже имеющийся на сервере (*Photo2. jpg*). В реальном приложении вы, вероятно, передумаетее образ, имя которого вы получаете динамически, как в предыдущих примерах.

![Эскиз](9-working-with-images/_static/image4.jpg "ch9images-4. jpg")

1. Добавьте новую страницу с именем *флипимаже. cshtml*.
2. Замените существующее содержимое на странице следующим: 

    [!code-cshtml[Main](9-working-with-images/samples/sample6.cshtml)]

    Код использует вспомогательный модуль `WebImage` для получения образа с сервера. Путь к изображению создается с помощью той же методики, которая использовалась в предыдущих примерах для сохранения изображений, и при создании образа с помощью `WebImage`:

    [!code-javascript[Main](9-working-with-images/samples/sample7.js)]

    Если изображение найдено, создается новый путь и имя файла, как в предыдущих примерах. Чтобы перевернуть изображение, вызовите метод `FlipVertical`, а затем сохраните изображение еще раз.

    Изображение снова отображается на странице с помощью элемента `<img>` с атрибутом `src`, для которого задано значение `imagePath`.
3. Запустите страницу в браузере. Изображение для *Photo2. jpg* отображается сверху вниз.
4. Обновите страницу или снова запросите страницу, чтобы снова отобразить изображение.

Для поворота изображения используется тот же код, за исключением того, что вместо вызова `FlipVertical` или `FlipHorizontal`вызывается `RotateLeft` или `RotateRight`.

<a id="Adding_a_Watermark"></a>
## <a name="adding-a-watermark-to-an-image"></a>Добавление водяного знака к изображению

При добавлении изображений на веб-сайт может потребоваться добавить в изображение водяной знак, прежде чем сохранить его или отобразить на странице. Пользователи часто используют водяные знаки для добавления сведений об авторских правах к изображению или для объявления их названия.

![Эскиз](9-working-with-images/_static/image5.jpg "ch9images-5. jpg")

1. Добавьте новую страницу с именем *водяной знак. cshtml*.
2. Замените существующее содержимое на странице следующим: 

    [!code-cshtml[Main](9-working-with-images/samples/sample8.cshtml)]

    Этот код похож на код на странице *флипимаже. cshtml* ранее (хотя в этот раз используется файл *Photo3. jpg* ). Чтобы добавить водяной знак, перед сохранением изображения вызовите метод `AddTextWatermark` вспомогательного метода `WebImage`. В вызове `AddTextWatermark`вы передаете текст &quot;мой водяной знак&quot;, устанавливаете цвет шрифта желтый и устанавливаете для семейства шрифтов значение Arial. (Хотя это не показано здесь, `WebImage` вспомогательное приложение также позволяет указать непрозрачность, семейство шрифтов и размер шрифта и расположение текста водяного знака.) При сохранении изображения оно не должно быть доступно только для чтения.

    Как вы видели ранее, изображение отображается на странице с помощью элемента `<img>` с атрибутом src, имеющим значение `@imagePath`.
3. Запустите страницу в браузере. Обратите внимание на текст "My водяной знак" в правом нижнем углу изображения.

<a id="Using_an_Image_as_a_Watermark"></a>
## <a name="using-an-image-as-a-watermark"></a>Использование изображения в качестве водяного знака

Вместо использования текста для водяного знака можно использовать другое изображение. Иногда люди используют изображения, например эмблему компании, в качестве водяного знака, а вместо текста для сведений об авторских правах используют изображение водяного знака, а не текст.

![Эскиз](9-working-with-images/_static/image6.jpg "ch9images-6. jpg")

1. Добавьте новую страницу с именем *имажеватермарк. cshtml*.
2. Добавьте образ в папку *Images* , которую можно использовать в качестве логотипа, и переименуйте образ *микомпанилого. jpg*. Это изображение должно быть изображением, которое можно увидеть, если оно имеет значение 80 пикселей в ширину и 20 пикселей в высоком масштабе.
3. Замените существующее содержимое на странице следующим: 

    [!code-cshtml[Main](9-working-with-images/samples/sample9.cshtml)]

    Это еще один вариант кода из предыдущих примеров. В этом случае вы вызываете `AddImageWatermark`, чтобы добавить изображение водяного знака в целевой образ (*Photo3. jpg*) перед сохранением изображения. При вызове `AddImageWatermark`устанавливается ширина 80 пикселей, а высота — 20 пикселей. Изображение *микомпанилого. jpg* горизонтально выравнивается по центру и выравнивается по вертикали в нижней части целевого изображения. Для параметра Opacity задано значение 100%, а для заполнения задано значение 10 пикселей. Если изображение водяного знака больше целевого изображения, ничего не произойдет. Если изображение водяного знака больше целевого изображения, а заполнение для водяного знака изображения равно нулю, водяной знак игнорируется.

    Как и ранее, изображение отображается с помощью элемента `<img>` и атрибута dynamic `src`.
4. Запустите страницу в браузере. Обратите внимание, что изображение водяного знака отображается в нижней части основного изображения.

<a id="Additional_Resources"></a>
## <a name="additional-resources"></a>Дополнительные ресурсы

[Работа с файлами на веб-страницы ASP.NET сайте](https://go.microsoft.com/fwlink/?LinkId=202896)

[Введение в программирование веб-страницы ASP.NET с помощью синтаксиса Razor](https://go.microsoft.com/fwlink/?LinkID=251587)
