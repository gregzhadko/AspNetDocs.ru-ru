---
uid: web-pages/overview/ui-layouts-and-themes/18-customizing-site-wide-behavior
title: Настройка поведения сайта для сайтов веб-страницы ASP.NET (Razor) | Документация Майкрософт
author: Rick-Anderson
description: В этой главе объясняется, как выполнять параметры для всего веб-сайта или всей папки, а не только для страницы.
ms.author: riande
ms.date: 02/17/2014
ms.assetid: e158bed7-226f-4275-b02e-7553bd58c669
msc.legacyurl: /web-pages/overview/ui-layouts-and-themes/18-customizing-site-wide-behavior
msc.type: authoredcontent
ms.openlocfilehash: f05e05f725d9209bce283ce18659ae5efe4de2ee
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78515250"
---
# <a name="customizing-site-wide-behavior-for-aspnet-web-pages-razor-sites"></a><span data-ttu-id="c8be1-103">Настройка поведения сайта для сайтов веб-страницы ASP.NET (Razor)</span><span class="sxs-lookup"><span data-stu-id="c8be1-103">Customizing Site-Wide Behavior for ASP.NET Web Pages (Razor) Sites</span></span>

<span data-ttu-id="c8be1-104">от [Tom фитзмаккен](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="c8be1-104">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="c8be1-105">В этой статье объясняется, как создавать параметры на стороне сайта для страниц на веб-сайте веб-страницы ASP.NET (Razor).</span><span class="sxs-lookup"><span data-stu-id="c8be1-105">This article explains how to make site-side settings for pages in an ASP.NET Web Pages (Razor) website.</span></span>
> 
> <span data-ttu-id="c8be1-106">Из этого руководства вы узнаете, как выполнять такие задачи:</span><span class="sxs-lookup"><span data-stu-id="c8be1-106">What you'll learn:</span></span>
> 
> - <span data-ttu-id="c8be1-107">Запуск кода, который позволяет задавать значения (глобальные значения или вспомогательные параметры) для всех страниц сайта.</span><span class="sxs-lookup"><span data-stu-id="c8be1-107">How to run code that lets you set values (global values or helper settings) for all pages in a site.</span></span>
> - <span data-ttu-id="c8be1-108">Выполнение кода, который позволяет задавать значения для всех страниц в папке.</span><span class="sxs-lookup"><span data-stu-id="c8be1-108">How to run code that lets you set values for all pages in a folder.</span></span>
> - <span data-ttu-id="c8be1-109">Выполнение кода до и после загрузки страницы.</span><span class="sxs-lookup"><span data-stu-id="c8be1-109">How to run code before and after a page loads.</span></span>
> - <span data-ttu-id="c8be1-110">Отправка ошибок на центральную страницу ошибки.</span><span class="sxs-lookup"><span data-stu-id="c8be1-110">How to send errors to a central error page.</span></span>
> - <span data-ttu-id="c8be1-111">Добавление проверки подлинности ко всем страницам в папке.</span><span class="sxs-lookup"><span data-stu-id="c8be1-111">How to add authentication to all pages in a folder.</span></span>
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a><span data-ttu-id="c8be1-112">Версии программного обеспечения, используемые в этом руководстве</span><span class="sxs-lookup"><span data-stu-id="c8be1-112">Software versions used in the tutorial</span></span>
> 
> 
> - <span data-ttu-id="c8be1-113">Веб-страницы ASP.NET (Razor) 2</span><span class="sxs-lookup"><span data-stu-id="c8be1-113">ASP.NET Web Pages (Razor) 2</span></span>
> - <span data-ttu-id="c8be1-114">WebMatrix 3</span><span class="sxs-lookup"><span data-stu-id="c8be1-114">WebMatrix 3</span></span>
> - <span data-ttu-id="c8be1-115">Библиотека вспомогательных веб-функций ASP.NET (пакет NuGet)</span><span class="sxs-lookup"><span data-stu-id="c8be1-115">ASP.NET Web Helpers Library (NuGet package)</span></span>
>   
> 
> <span data-ttu-id="c8be1-116">Этот учебник также работает с веб-страницы ASP.NET 3 и Visual Studio 2013 (или Visual Studio Express 2013 для Web), за исключением того, что нельзя использовать библиотеку веб-вспомогательных функций ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="c8be1-116">This tutorial also works with ASP.NET Web Pages 3 and Visual Studio 2013 (or Visual Studio Express 2013 for Web), except you cannot use the ASP.NET Web Helpers Library.</span></span>

<a id="Adding_Website_Startup_Code"></a>
## <a name="adding-website-startup-code-for-aspnet-web-pages"></a><span data-ttu-id="c8be1-117">Добавление кода запуска веб-сайта для веб-страницы ASP.NET</span><span class="sxs-lookup"><span data-stu-id="c8be1-117">Adding Website Startup Code for ASP.NET Web Pages</span></span>

<span data-ttu-id="c8be1-118">Для большей части кода, который вы пишете в веб-страницы ASP.NET, отдельная страница может содержать весь код, необходимый для этой страницы.</span><span class="sxs-lookup"><span data-stu-id="c8be1-118">For much of the code that you write in ASP.NET Web Pages, an individual page can contain all the code that's required for that page.</span></span> <span data-ttu-id="c8be1-119">Например, если страница отправляет сообщение электронной почты, можно разместить весь код для этой операции на одной странице.</span><span class="sxs-lookup"><span data-stu-id="c8be1-119">For example, if a page sends an email message, it's possible to put all the code for that operation in a single page.</span></span> <span data-ttu-id="c8be1-120">Это может быть код для инициализации параметров отправки электронной почты (то есть для SMTP-сервера) и отправки сообщения электронной почты.</span><span class="sxs-lookup"><span data-stu-id="c8be1-120">This can include the code to initialize the settings for sending email (that is, for the SMTP server) and for sending the email message.</span></span>

<span data-ttu-id="c8be1-121">Однако в некоторых ситуациях может потребоваться выполнить некоторый код перед выполнением любой страницы на сайте.</span><span class="sxs-lookup"><span data-stu-id="c8be1-121">However, in some situations, you might want to run some code before any page on the site runs.</span></span> <span data-ttu-id="c8be1-122">Это полезно для настройки значений, которые можно использовать в любом месте сайта (называемых *глобальными значениями*). Например, некоторые вспомогательные методы потребовали указать такие значения, как параметры электронной почты или ключи учетной записи.</span><span class="sxs-lookup"><span data-stu-id="c8be1-122">This is useful for setting values that can be used anywhere in the site (referred to as *global values*.) For example, some helpers require you to provide values like email settings or account keys.</span></span> <span data-ttu-id="c8be1-123">Может быть удобно хранить эти параметры в глобальных значениях.</span><span class="sxs-lookup"><span data-stu-id="c8be1-123">It can be handy to keep these settings in global values.</span></span>

<span data-ttu-id="c8be1-124">Это можно сделать, создав страницу с именем *\_AppStart. cshtml* в корне сайта.</span><span class="sxs-lookup"><span data-stu-id="c8be1-124">You can do this by creating a page named *\_AppStart.cshtml* in the root of the site.</span></span> <span data-ttu-id="c8be1-125">Если эта страница существует, она выполняется в первый раз, когда запрашивается любая страница на сайте.</span><span class="sxs-lookup"><span data-stu-id="c8be1-125">If this page exists, it runs the first time any page in the site is requested.</span></span> <span data-ttu-id="c8be1-126">Поэтому рекомендуется выполнять код для установки глобальных значений.</span><span class="sxs-lookup"><span data-stu-id="c8be1-126">Therefore, it's a good place to run code to set global values.</span></span> <span data-ttu-id="c8be1-127">(Поскольку *\_AppStart. cshtml* имеет префикс подчеркивания, ASP.NET не отправляет страницу в браузер, даже если пользователи запрашивают его напрямую.)</span><span class="sxs-lookup"><span data-stu-id="c8be1-127">(Because *\_AppStart.cshtml* has an underscore prefix, ASP.NET won't send the page to a browser even if users request it directly.)</span></span>

<span data-ttu-id="c8be1-128">На следующей схеме показано, как работает страница *\_AppStart. cshtml* .</span><span class="sxs-lookup"><span data-stu-id="c8be1-128">The following diagram shows how the *\_AppStart.cshtml* page works.</span></span> <span data-ttu-id="c8be1-129">Когда запрос поступает на страницу, и если это первый запрос для любой страницы сайта, ASP.NET сначала проверяет, существует ли страница *\_AppStart. cshtml* .</span><span class="sxs-lookup"><span data-stu-id="c8be1-129">When a request comes in for a page, and if this is the first request for any page in the site, ASP.NET first checks whether a *\_AppStart.cshtml* page exists.</span></span> <span data-ttu-id="c8be1-130">В этом случае выполняется любой код на странице *\_AppStart. cshtml* , после чего выполняется запрошенная страница.</span><span class="sxs-lookup"><span data-stu-id="c8be1-130">If so, any code in the *\_AppStart.cshtml* page runs, and then the requested page runs.</span></span>

![[образ]](18-customizing-site-wide-behavior/_static/image1.jpg)

## <a name="setting-global-values-for-your-website"></a><span data-ttu-id="c8be1-132">Настройка глобальных значений для веб-сайта</span><span class="sxs-lookup"><span data-stu-id="c8be1-132">Setting Global Values for Your Website</span></span>

1. <span data-ttu-id="c8be1-133">В корневой папке веб-сайта WebMatrix создайте файл с именем *\_AppStart. cshtml*.</span><span class="sxs-lookup"><span data-stu-id="c8be1-133">In the root folder of a WebMatrix website, create a file named *\_AppStart.cshtml*.</span></span> <span data-ttu-id="c8be1-134">Файл должен находиться в корневом каталоге сайта.</span><span class="sxs-lookup"><span data-stu-id="c8be1-134">The file must be in the root of the site.</span></span>
2. <span data-ttu-id="c8be1-135">Замените имеющееся содержимое следующим:</span><span class="sxs-lookup"><span data-stu-id="c8be1-135">Replace the existing content with the following:</span></span> 

    [!code-cshtml[Main](18-customizing-site-wide-behavior/samples/sample1.cshtml)]

    <span data-ttu-id="c8be1-136">Этот код сохраняет значение в словаре `AppState`, который автоматически доступен для всех страниц сайта.</span><span class="sxs-lookup"><span data-stu-id="c8be1-136">This code stores a value in the `AppState` dictionary, which is automatically available to all pages in the site.</span></span> <span data-ttu-id="c8be1-137">Обратите внимание, что файл *\_AppStart. cshtml* не имеет разметки.</span><span class="sxs-lookup"><span data-stu-id="c8be1-137">Notice that the *\_AppStart.cshtml* file does not have any markup in it.</span></span> <span data-ttu-id="c8be1-138">Страница запустит код, а затем перенаправит на первоначально запрошенную страницу.</span><span class="sxs-lookup"><span data-stu-id="c8be1-138">The page will run the code and then redirect to the page that was originally requested.</span></span>

    > [!NOTE]
    > <span data-ttu-id="c8be1-139">Будьте внимательны при помещении кода в файл *\_AppStart. cshtml* .</span><span class="sxs-lookup"><span data-stu-id="c8be1-139">Be careful when you put code in the *\_AppStart.cshtml* file.</span></span> <span data-ttu-id="c8be1-140">Если в коде файла *\_AppStart. cshtml* возникли ошибки, веб-сайт не запустится.</span><span class="sxs-lookup"><span data-stu-id="c8be1-140">If any errors occur in code in the *\_AppStart.cshtml* file, the website won't start.</span></span>
3. <span data-ttu-id="c8be1-141">В корневой папке создайте новую страницу с именем *AppName. cshtml*.</span><span class="sxs-lookup"><span data-stu-id="c8be1-141">In the root folder, create a new page named *AppName.cshtml*.</span></span>
4. <span data-ttu-id="c8be1-142">Замените разметку и код по умолчанию следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="c8be1-142">Replace the default markup and code with the following:</span></span> 

    [!code-html[Main](18-customizing-site-wide-behavior/samples/sample2.html)]

    <span data-ttu-id="c8be1-143">Этот код извлекает значение из объекта `AppState`, заданного на странице *\_AppStart. cshtml* .</span><span class="sxs-lookup"><span data-stu-id="c8be1-143">This code extracts the value from the `AppState` object that you set in the *\_AppStart.cshtml* page.</span></span>
5. <span data-ttu-id="c8be1-144">Запустите страницу *AppName. cshtml* в браузере.</span><span class="sxs-lookup"><span data-stu-id="c8be1-144">Run the *AppName.cshtml* page in a browser.</span></span> <span data-ttu-id="c8be1-145">(Перед выполнением страницы убедитесь, что она выбрана в рабочей области **файлы** .) На странице отображается глобальное значение.</span><span class="sxs-lookup"><span data-stu-id="c8be1-145">(Make sure the page is selected in the **Files** workspace before you run it.) The page displays the global value.</span></span> 

    ![[образ]](18-customizing-site-wide-behavior/_static/image2.jpg)

<a id="Setting_Values_For_Helpers"></a>
## <a name="setting-values-for-helpers"></a><span data-ttu-id="c8be1-147">Настройка значений для вспомогательных функций</span><span class="sxs-lookup"><span data-stu-id="c8be1-147">Setting Values for Helpers</span></span>

<span data-ttu-id="c8be1-148">Хорошим использованием файла *\_AppStart. cshtml* является установка значений для вспомогательных функций, используемых на сайте и которые должны быть инициализированы.</span><span class="sxs-lookup"><span data-stu-id="c8be1-148">A good use for the *\_AppStart.cshtml* file is to set values for helpers that you use in your site and that have to be initialized.</span></span> <span data-ttu-id="c8be1-149">Типичными примерами являются параметры электронной почты для вспомогательного метода `WebMail`, а также закрытый и открытый ключи для вспомогательного метода `ReCaptcha`.</span><span class="sxs-lookup"><span data-stu-id="c8be1-149">Typical examples are email settings for the `WebMail` helper and the private and public keys for the `ReCaptcha` helper.</span></span> <span data-ttu-id="c8be1-150">В таких случаях значения можно задать один раз в *\_AppStart. cshtml* , а затем они уже заданы для всех страниц на сайте.</span><span class="sxs-lookup"><span data-stu-id="c8be1-150">In cases like these, you can set the values once in the *\_AppStart.cshtml* and then they're already set for all the pages in your site.</span></span>

<span data-ttu-id="c8be1-151">В этой процедуре показано, как настроить глобальные параметры `WebMail`.</span><span class="sxs-lookup"><span data-stu-id="c8be1-151">This procedure shows you how to set `WebMail` settings globally.</span></span> <span data-ttu-id="c8be1-152">(Дополнительные сведения об использовании вспомогательного метода `WebMail` см. [в разделе Добавление сообщения электронной почты на сайт веб-страницы ASP.NET](../getting-started/11-adding-email-to-your-web-site.md).)</span><span class="sxs-lookup"><span data-stu-id="c8be1-152">(For more information about using the `WebMail` helper, see [Adding Email to an ASP.NET Web Pages Site](../getting-started/11-adding-email-to-your-web-site.md).)</span></span>

1. <span data-ttu-id="c8be1-153">Добавьте библиотеку вспомогательных веб-функций ASP.NET на веб-сайт, как описано в разделе [Установка вспомогательных функций на веб-страницы ASP.net сайте](https://go.microsoft.com/fwlink/?LinkId=252372), если вы еще не добавили его.</span><span class="sxs-lookup"><span data-stu-id="c8be1-153">Add the ASP.NET Web Helpers Library to your website as described in [Installing Helpers in an ASP.NET Web Pages Site](https://go.microsoft.com/fwlink/?LinkId=252372), if you haven't already added it.</span></span>
2. <span data-ttu-id="c8be1-154">Если у вас еще нет файла *\_AppStart. cshtml* , в корневой папке веб-сайта создайте файл с именем *\_AppStart. cshtml*.</span><span class="sxs-lookup"><span data-stu-id="c8be1-154">If you don't already have a *\_AppStart.cshtml* file, in the root folder of a website create a file named *\_AppStart.cshtml*.</span></span>
3. <span data-ttu-id="c8be1-155">Добавьте следующие параметры `WebMail` в файл *\_AppStart. cshtml* :</span><span class="sxs-lookup"><span data-stu-id="c8be1-155">Add the following `WebMail` settings to the *\_AppStart.cshtml* file:</span></span> 

    [!code-cshtml[Main](18-customizing-site-wide-behavior/samples/sample3.cshtml?highlight=2-7)]

    <span data-ttu-id="c8be1-156">Измените следующие параметры, связанные с электронной почтой, в коде:</span><span class="sxs-lookup"><span data-stu-id="c8be1-156">Modify the following email related settings in the code:</span></span>

   - <span data-ttu-id="c8be1-157">Присвойте `your-SMTP-host` имя SMTP-сервера, к которому у вас есть доступ.</span><span class="sxs-lookup"><span data-stu-id="c8be1-157">Set `your-SMTP-host` to the name of the SMTP server that you have access to.</span></span>
   - <span data-ttu-id="c8be1-158">Задайте `your-user-name-here` имя пользователя для учетной записи SMTP-сервера.</span><span class="sxs-lookup"><span data-stu-id="c8be1-158">Set `your-user-name-here` to the user name for your SMTP server account.</span></span>
   - <span data-ttu-id="c8be1-159">Задайте `your-account-password` пароль для учетной записи SMTP-сервера.</span><span class="sxs-lookup"><span data-stu-id="c8be1-159">Set `your-account-password` to the password for your SMTP server account.</span></span>
   - <span data-ttu-id="c8be1-160">Задайте для `your-email-address-here` собственный адрес электронной почты.</span><span class="sxs-lookup"><span data-stu-id="c8be1-160">Set `your-email-address-here` to your own email address.</span></span> <span data-ttu-id="c8be1-161">Это адрес электронной почты, с которого отправляется сообщение.</span><span class="sxs-lookup"><span data-stu-id="c8be1-161">This is the email address that the message is sent from.</span></span> <span data-ttu-id="c8be1-162">(Некоторые поставщики электронной почты не позволяют указать другой адрес `From` и будут использовать имя пользователя в качестве адреса `From`.)</span><span class="sxs-lookup"><span data-stu-id="c8be1-162">(Some email providers don't let you specify a different `From` address and will use your user name as the `From` address.)</span></span>

     <span data-ttu-id="c8be1-163">Дополнительные сведения о параметрах SMTP см. в разделе [Настройка параметров электронной почты](https://go.microsoft.com/fwlink/?LinkID=202899#configuring_email_settings) в статье [Отправка сообщения электронной почты с сайта веб-страницы ASP.NET (Razor)](https://go.microsoft.com/fwlink/?LinkID=202899) и [проблемы с отправкой электронной почты](https://go.microsoft.com/fwlink/?LinkId=253001#email) в [руководстве по устранению неполадок веб-страницы ASP.NET (Razor)](https://go.microsoft.com/fwlink/?LinkId=253001).</span><span class="sxs-lookup"><span data-stu-id="c8be1-163">For more information about SMTP settings, see [Configuring Email Settings](https://go.microsoft.com/fwlink/?LinkID=202899#configuring_email_settings) in the article [Sending Email from an ASP.NET Web Pages (Razor) Site](https://go.microsoft.com/fwlink/?LinkID=202899) and [Issues with Sending Email](https://go.microsoft.com/fwlink/?LinkId=253001#email) in the [ASP.NET Web Pages (Razor) Troubleshooting Guide](https://go.microsoft.com/fwlink/?LinkId=253001).</span></span>
4. <span data-ttu-id="c8be1-164">Сохраните файл *\_AppStart. cshtml* и закройте его.</span><span class="sxs-lookup"><span data-stu-id="c8be1-164">Save the *\_AppStart.cshtml* file and close it.</span></span>
5. <span data-ttu-id="c8be1-165">В корневой папке веб-сайта создайте новую страницу с именем *тестемаил. cshtml*.</span><span class="sxs-lookup"><span data-stu-id="c8be1-165">In the root folder of a website, create new page named *TestEmail.cshtml*.</span></span>
6. <span data-ttu-id="c8be1-166">Замените имеющееся содержимое следующим:</span><span class="sxs-lookup"><span data-stu-id="c8be1-166">Replace the existing content with the following:</span></span> 

     [!code-cshtml[Main](18-customizing-site-wide-behavior/samples/sample4.cshtml)]
7. <span data-ttu-id="c8be1-167">Запустите страницу *тестемаил. cshtml* в браузере.</span><span class="sxs-lookup"><span data-stu-id="c8be1-167">Run the *TestEmail.cshtml* page in a browser.</span></span>
8. <span data-ttu-id="c8be1-168">Заполните поля, чтобы отправить себе сообщение электронной почты, а затем нажмите кнопку **Отправить**.</span><span class="sxs-lookup"><span data-stu-id="c8be1-168">Fill in the fields to send yourself an email message and then click **Send**.</span></span>
9. <span data-ttu-id="c8be1-169">Проверьте свой адрес электронной почты, чтобы убедиться, что вы получили сообщение.</span><span class="sxs-lookup"><span data-stu-id="c8be1-169">Check your email to make sure you've gotten the message.</span></span>

<span data-ttu-id="c8be1-170">Важной частью этого примера является то, что параметры, которые обычно не изменяются (например, имя SMTP-сервера и учетные данные электронной почты), задаются в файле *\_AppStart. cshtml* .</span><span class="sxs-lookup"><span data-stu-id="c8be1-170">The important part of this example is that the settings that you don't usually change — like the name of your SMTP server and your email credentials — are set in the *\_AppStart.cshtml* file.</span></span> <span data-ttu-id="c8be1-171">Таким образом, вам не нужно снова задавать их на каждой странице, где вы отправляете электронную почту.</span><span class="sxs-lookup"><span data-stu-id="c8be1-171">That way you don't need to set them again in each page where you send email.</span></span> <span data-ttu-id="c8be1-172">(Хотя по каким-либо причинам необходимо изменить эти параметры, их можно настроить по отдельности на странице.) На странице задаются только значения, которые обычно изменяются каждый раз, как получатель и текст сообщения электронной почты.</span><span class="sxs-lookup"><span data-stu-id="c8be1-172">(Although if for some reason you need to change those settings, you can set them individually in a page.) In the page, you only set the values that typically change each time, like the recipient and the body of the email message.</span></span>

<a id="Running_Code_Before_and_After"></a>
## <a name="running-code-before-and-after-files-in-a-folder"></a><span data-ttu-id="c8be1-173">Выполнение кода до и после файлов в папке</span><span class="sxs-lookup"><span data-stu-id="c8be1-173">Running Code Before and After Files in a Folder</span></span>

<span data-ttu-id="c8be1-174">Так же, как можно использовать *\_AppStart. cshtml* для написания кода перед выполнением страниц на сайте, можно написать код, который будет выполняться до (и после) любой страницы в определенной папке.</span><span class="sxs-lookup"><span data-stu-id="c8be1-174">Just like you can use *\_AppStart.cshtml* to write code before pages in the site run, you can write code that runs before (and after) any page in a particular folder run.</span></span> <span data-ttu-id="c8be1-175">Это полезно при настройке одной и той же страницы макета для всех страниц в папке или при проверке того, что пользователь вошел в систему перед запуском страницы в папке.</span><span class="sxs-lookup"><span data-stu-id="c8be1-175">This is useful for things like setting the same layout page for all the pages in a folder, or for checking that a user is logged in before running a page in the folder.</span></span>

<span data-ttu-id="c8be1-176">Для страниц в определенных папках можно создать код в файле с именем *\_пажестарт. cshtml*.</span><span class="sxs-lookup"><span data-stu-id="c8be1-176">For pages in particular folders, you can create code in a file named *\_PageStart.cshtml*.</span></span> <span data-ttu-id="c8be1-177">На следующей схеме показано, как работает страница *\_пажестарт. cshtml* .</span><span class="sxs-lookup"><span data-stu-id="c8be1-177">The following diagram shows how the *\_PageStart.cshtml* page works.</span></span> <span data-ttu-id="c8be1-178">Когда запрос поступает на страницу, ASP.NET сначала проверяет страницу *\_AppStart. cshtml* и выполняет ее.</span><span class="sxs-lookup"><span data-stu-id="c8be1-178">When a request comes in for a page, ASP.NET first checks for a *\_AppStart.cshtml* page and runs that.</span></span> <span data-ttu-id="c8be1-179">Затем ASP.NET проверяет, имеется ли страница *\_пажестарт. cshtml* , и, если да, выполняет ее.</span><span class="sxs-lookup"><span data-stu-id="c8be1-179">Then ASP.NET checks whether there's a *\_PageStart.cshtml* page, and if so, runs that.</span></span> <span data-ttu-id="c8be1-180">Затем запускается запрошенная страница.</span><span class="sxs-lookup"><span data-stu-id="c8be1-180">It then runs the requested page.</span></span>

<span data-ttu-id="c8be1-181">На странице *\_пажестарт. cshtml* можно указать, где во время обработки необходимо запустить запрашиваемую страницу, включив метод `RunPage`.</span><span class="sxs-lookup"><span data-stu-id="c8be1-181">Inside the *\_PageStart.cshtml* page, you can specify where during processing you want the requested page to run by including a `RunPage` method.</span></span> <span data-ttu-id="c8be1-182">Это позволяет выполнять код до выполнения запрашиваемой страницы и затем снова после него.</span><span class="sxs-lookup"><span data-stu-id="c8be1-182">This lets you run code before the requested page runs and then again after it.</span></span> <span data-ttu-id="c8be1-183">Если вы не включаете `RunPage`, выполняется весь код в *\_пажестарт. cshtml* , а затем запрашиваемая страница запускается автоматически.</span><span class="sxs-lookup"><span data-stu-id="c8be1-183">If you don't include `RunPage`, all the code in *\_PageStart.cshtml* runs, and then the requested page runs automatically.</span></span>

![[образ]](18-customizing-site-wide-behavior/_static/image3.jpg)

<span data-ttu-id="c8be1-185">ASP.NET позволяет создать иерархию файлов *\_пажестарт. cshtml* .</span><span class="sxs-lookup"><span data-stu-id="c8be1-185">ASP.NET lets you create a hierarchy of *\_PageStart.cshtml* files.</span></span> <span data-ttu-id="c8be1-186">Файл *\_пажестарт. cshtml* можно разместить в корневом каталоге сайта и во всех вложенных папках.</span><span class="sxs-lookup"><span data-stu-id="c8be1-186">You can put a *\_PageStart.cshtml* file in the root of the site and in any subfolder.</span></span> <span data-ttu-id="c8be1-187">При запросе страницы выполняется *\_файл пажестарт. cshtml* на самом верхнем уровне (ближайший к корню сайта), за которым следует файл *\_пажестарт. cshtml* в следующей вложенной папке и так далее, пока запрос не достигнет папки, содержащей запрошенную страницу.</span><span class="sxs-lookup"><span data-stu-id="c8be1-187">When a page is requested, the *\_PageStart.cshtml* file at the top-most level (nearest to the site root) runs, followed by the *\_PageStart.cshtml* file in the next subfolder, and so on down the subfolder structure until the request reaches the folder that contains the requested page.</span></span> <span data-ttu-id="c8be1-188">После выполнения всех применимых файлов *\_пажестарт. cshtml* выполняется запрошенная страница.</span><span class="sxs-lookup"><span data-stu-id="c8be1-188">After all the applicable *\_PageStart.cshtml* files have run, the requested page runs.</span></span>

<span data-ttu-id="c8be1-189">Например, может иметься следующее сочетание файлов *\_пажестарт. cshtml* и файла *Default. cshtml* :</span><span class="sxs-lookup"><span data-stu-id="c8be1-189">For example, you might have the following combination of *\_PageStart.cshtml* files and *Default.cshtml* file:</span></span>

[!code-cshtml[Main](18-customizing-site-wide-behavior/samples/sample5.cshtml)]

[!code-cshtml[Main](18-customizing-site-wide-behavior/samples/sample6.cshtml)]

[!code-cshtml[Main](18-customizing-site-wide-behavior/samples/sample7.cshtml)]

<span data-ttu-id="c8be1-190">При запуске */мифолдер/дефаулт.кштмл*вы увидите следующее:</span><span class="sxs-lookup"><span data-stu-id="c8be1-190">When you run */myfolder/default.cshtml*, you'll see the following:</span></span>

[!code-console[Main](18-customizing-site-wide-behavior/samples/sample8.cmd)]

## <a name="running-initialization-code-for-all-pages-in-a-folder"></a><span data-ttu-id="c8be1-191">Выполнение кода инициализации для всех страниц в папке</span><span class="sxs-lookup"><span data-stu-id="c8be1-191">Running Initialization Code for All Pages in a Folder</span></span>

<span data-ttu-id="c8be1-192">Хорошим использованием файлов *\_пажестарт. cshtml* является инициализация одной и той же страницы макета для всех файлов в одной папке.</span><span class="sxs-lookup"><span data-stu-id="c8be1-192">A good use for *\_PageStart.cshtml* files is to initialize the same layout page for all files in a single folder.</span></span>

1. <span data-ttu-id="c8be1-193">В корневой папке создайте новую папку с именем *инитпажес*.</span><span class="sxs-lookup"><span data-stu-id="c8be1-193">In the root folder, create a new folder named *InitPages*.</span></span>
2. <span data-ttu-id="c8be1-194">В папке *инитпажес* веб-сайта создайте файл с именем *\_пажестарт. cshtml* и замените разметку и код по умолчанию следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="c8be1-194">In the *InitPages* folder of your website, create a file named *\_PageStart.cshtml* and replace the default markup and code with the following:</span></span> 

    [!code-cshtml[Main](18-customizing-site-wide-behavior/samples/sample9.cshtml)]
3. <span data-ttu-id="c8be1-195">В корневом каталоге веб-сайта создайте папку с именем *Shared*.</span><span class="sxs-lookup"><span data-stu-id="c8be1-195">In the root of the website, create a folder named *Shared*.</span></span>
4. <span data-ttu-id="c8be1-196">В *общей* папке создайте файл с именем *\_layout1. cshtml* и замените разметку и код по умолчанию следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="c8be1-196">In the *Shared* folder, create a file named *\_Layout1.cshtml* and replace the default markup and code with the following:</span></span> 

    [!code-cshtml[Main](18-customizing-site-wide-behavior/samples/sample10.cshtml)]
5. <span data-ttu-id="c8be1-197">В папке *инитпажес* создайте файл с именем *Content1. cshtml* и замените имеющееся содержимое следующим:</span><span class="sxs-lookup"><span data-stu-id="c8be1-197">In the *InitPages* folder, create a file named *Content1.cshtml* and replace the existing content with the following:</span></span> 

    [!code-html[Main](18-customizing-site-wide-behavior/samples/sample11.html)]
6. <span data-ttu-id="c8be1-198">В папке *инитпажес* создайте другой файл с именем *Content2. cshtml* и замените разметку по умолчанию следующим:</span><span class="sxs-lookup"><span data-stu-id="c8be1-198">In the *InitPages* folder, create another file named *Content2.cshtml* and replace the default markup with the following:</span></span> 

    [!code-html[Main](18-customizing-site-wide-behavior/samples/sample12.html)]
7. <span data-ttu-id="c8be1-199">Запустите *Content1. cshtml* в браузере.</span><span class="sxs-lookup"><span data-stu-id="c8be1-199">Run *Content1.cshtml* in a browser.</span></span> 

    ![[образ]](18-customizing-site-wide-behavior/_static/image4.jpg)

    <span data-ttu-id="c8be1-201">При запуске страницы *Content1. cshtml* файл *\_пажестарт. cshtml* задается `Layout` а также задает для `PageData["MyBackground"]` цвет.</span><span class="sxs-lookup"><span data-stu-id="c8be1-201">When the *Content1.cshtml* page runs, the *\_PageStart.cshtml* file sets `Layout` and also sets `PageData["MyBackground"]` to a color.</span></span> <span data-ttu-id="c8be1-202">В *Content1. cshtml*применяются макет и цвет.</span><span class="sxs-lookup"><span data-stu-id="c8be1-202">In *Content1.cshtml*, the layout and color are applied.</span></span>
8. <span data-ttu-id="c8be1-203">Отобразить *Content2. cshtml* в браузере.</span><span class="sxs-lookup"><span data-stu-id="c8be1-203">Display *Content2.cshtml* in a browser.</span></span> 

    <span data-ttu-id="c8be1-204">Макет одинаков, так как обе страницы используют одну и ту же страницу и цвет макета, инициализированные в *\_пажестарт. cshtml*.</span><span class="sxs-lookup"><span data-stu-id="c8be1-204">The layout is the same, because both pages use the same layout page and color as initialized in *\_PageStart.cshtml*.</span></span>

## <a name="using-_pagestartcshtml-to-handle-errors"></a><span data-ttu-id="c8be1-205">Использование \_Пажестарт. cshtml для обработки ошибок</span><span class="sxs-lookup"><span data-stu-id="c8be1-205">Using \_PageStart.cshtml to Handle Errors</span></span>

<span data-ttu-id="c8be1-206">Еще одним хорошим применением файла *\_пажестарт. cshtml* является создание способа для управления ошибками программирования (исключениями), которые могут возникнуть в любой странице. *CSHTML* в папке.</span><span class="sxs-lookup"><span data-stu-id="c8be1-206">Another good use for the *\_PageStart.cshtml* file is to create a way to handle programming errors (exceptions) that might occur in any *.cshtml* page in a folder.</span></span> <span data-ttu-id="c8be1-207">В этом примере показан один из способов.</span><span class="sxs-lookup"><span data-stu-id="c8be1-207">This example shows you one way to do this.</span></span>

1. <span data-ttu-id="c8be1-208">В корневой папке создайте папку с именем *иниткатч*.</span><span class="sxs-lookup"><span data-stu-id="c8be1-208">In the root folder, create a folder named *InitCatch*.</span></span>
2. <span data-ttu-id="c8be1-209">В папке *иниткатч* веб-сайта создайте файл с именем *\_пажестарт. cshtml* и замените существующую разметку и код следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="c8be1-209">In the *InitCatch* folder of your website, create a file named *\_PageStart.cshtml* and replace the existing markup and code with the following:</span></span> 

    [!code-cshtml[Main](18-customizing-site-wide-behavior/samples/sample13.cshtml)]

    <span data-ttu-id="c8be1-210">В этом коде вы попробуете явно запустить запрошенную страницу, вызвав метод `RunPage` внутри блока `try`.</span><span class="sxs-lookup"><span data-stu-id="c8be1-210">In this code, you try running the requested page explicitly by calling the `RunPage` method inside a `try` block.</span></span> <span data-ttu-id="c8be1-211">Если на запрошенной странице возникли ошибки программирования, код в блоке `catch` выполняется.</span><span class="sxs-lookup"><span data-stu-id="c8be1-211">If any programming errors occur in the requested page, the code inside the `catch` block runs.</span></span> <span data-ttu-id="c8be1-212">В этом случае код перенаправляется на страницу (*Error. cshtml*) и передает имя файла, который вызвал ошибку, в составе URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="c8be1-212">In this case, the code redirects to a page (*Error.cshtml*) and passes the name of the file that experienced the error as part of the URL.</span></span> <span data-ttu-id="c8be1-213">(Вскоре вы создадите страницу.)</span><span class="sxs-lookup"><span data-stu-id="c8be1-213">(You'll create the page shortly.)</span></span>
3. <span data-ttu-id="c8be1-214">В папке *иниткатч* веб-сайта создайте файл с именем *Exception. cshtml* и замените существующий код разметки следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="c8be1-214">In the *InitCatch* folder of your website, create a file named *Exception.cshtml* and replace the existing markup and code with the following:</span></span> 

    [!code-cshtml[Main](18-customizing-site-wide-behavior/samples/sample14.cshtml)]

    <span data-ttu-id="c8be1-215">В этом примере, что вы делаете на этой странице, намеренно создает ошибку, пытаясь открыть несуществующий файл базы данных.</span><span class="sxs-lookup"><span data-stu-id="c8be1-215">For purposes of this example, what you're doing in this page is deliberately creating an error by trying to open a database file that doesn't exist.</span></span>
4. <span data-ttu-id="c8be1-216">В корневой папке создайте файл с именем *Error. cshtml* и замените существующую разметку и код следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="c8be1-216">In the root folder, create a file named *Error.cshtml* and replace the existing markup and code with the following:</span></span> 

    [!code-html[Main](18-customizing-site-wide-behavior/samples/sample15.html)]

    <span data-ttu-id="c8be1-217">На этой странице выражение `@Request["source"]` получает значение из URL-адреса и отображает его.</span><span class="sxs-lookup"><span data-stu-id="c8be1-217">In this page, the expression `@Request["source"]` gets the value out of the URL and displays it.</span></span>
5. <span data-ttu-id="c8be1-218">На панели инструментов нажмите кнопку **сохранить**.</span><span class="sxs-lookup"><span data-stu-id="c8be1-218">In the toolbar, click **Save**.</span></span>
6. <span data-ttu-id="c8be1-219">Запустите *Exception. cshtml* в браузере.</span><span class="sxs-lookup"><span data-stu-id="c8be1-219">Run *Exception.cshtml* in a browser.</span></span> 

    ![[образ]](18-customizing-site-wide-behavior/_static/image5.jpg)

    <span data-ttu-id="c8be1-221">Поскольку в *Exception. cshtml*возникает ошибка, страница *\_пажестарт. cshtml* выполняет перенаправление к файлу *Error. cshtml* , который отображает сообщение.</span><span class="sxs-lookup"><span data-stu-id="c8be1-221">Because an error occurs in *Exception.cshtml*, the *\_PageStart.cshtml* page redirects to the *Error.cshtml* file, which displays the message.</span></span>

    <span data-ttu-id="c8be1-222">Дополнительные сведения об исключениях см. в статье [Введение в веб-страницы ASP.NET программирование с помощью синтаксиса Razor](https://go.microsoft.com/fwlink/?LinkID=251587).</span><span class="sxs-lookup"><span data-stu-id="c8be1-222">For more information about exceptions, see [Introduction to ASP.NET Web Pages Programming Using the Razor Syntax](https://go.microsoft.com/fwlink/?LinkID=251587).</span></span>

<a id="Using__PageStart.cshtml_to_Restrict_Folder_Access"></a>
## <a name="using-_pagestartcshtml-to-restrict-folder-access"></a><span data-ttu-id="c8be1-223">Использование \_Пажестарт. cshtml для ограничения доступа к папке</span><span class="sxs-lookup"><span data-stu-id="c8be1-223">Using \_PageStart.cshtml to Restrict Folder Access</span></span>

<span data-ttu-id="c8be1-224">Можно также использовать файл *\_пажестарт. cshtml* для ограничения доступа ко всем файлам в папке.</span><span class="sxs-lookup"><span data-stu-id="c8be1-224">You can also use the *\_PageStart.cshtml* file to restrict access to all the files in a folder.</span></span>

1. <span data-ttu-id="c8be1-225">В WebMatrix создайте новый веб-сайт с помощью параметра **сайт из шаблона** .</span><span class="sxs-lookup"><span data-stu-id="c8be1-225">In WebMatrix, create a new website using the **Site From Template** option.</span></span>
2. <span data-ttu-id="c8be1-226">В списке Доступные шаблоны выберите **Начальная сайт**.</span><span class="sxs-lookup"><span data-stu-id="c8be1-226">From the available templates, select **Starter Site**.</span></span>
3. <span data-ttu-id="c8be1-227">В корневой папке создайте папку с именем *аусентикатедконтент*.</span><span class="sxs-lookup"><span data-stu-id="c8be1-227">In the root folder, create a folder named *AuthenticatedContent*.</span></span>
4. <span data-ttu-id="c8be1-228">В папке *аусентикатедконтент* создайте файл с именем *\_пажестарт. cshtml* и замените существующую разметку и код следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="c8be1-228">In the *AuthenticatedContent* folder, create a file named *\_PageStart.cshtml* and replace the existing markup and code with the following:</span></span> 

    [!code-cshtml[Main](18-customizing-site-wide-behavior/samples/sample16.cshtml)]

    <span data-ttu-id="c8be1-229">Код начинается с предотвращения кэширования всех файлов в папке.</span><span class="sxs-lookup"><span data-stu-id="c8be1-229">The code starts by preventing all files in the folder from being cached.</span></span> <span data-ttu-id="c8be1-230">(Это необходимо для таких сценариев, как общедоступные компьютеры, где не нужно, чтобы кэшированные страницы одного пользователя были доступны следующему пользователю.) Затем код определяет, вошел ли пользователь на сайт, прежде чем он сможет просматривать какие-либо страницы в папке.</span><span class="sxs-lookup"><span data-stu-id="c8be1-230">(This is required for scenarios like public computers, where you don't want one user's cached pages to be available to the next user.) Next, the code determines whether the user has signed in to the site before they can view any of the pages in the folder.</span></span> <span data-ttu-id="c8be1-231">Если пользователь не вошел в систему, код перенаправляется на страницу входа.</span><span class="sxs-lookup"><span data-stu-id="c8be1-231">If the user is not signed in, the code redirects to the login page.</span></span> <span data-ttu-id="c8be1-232">Страница входа может вернуть пользователя на страницу, которая была первоначально запрошена, если включить значение строки запроса с именем `ReturnUrl`.</span><span class="sxs-lookup"><span data-stu-id="c8be1-232">The login page can return the user to the page that was originally requested if you include a query string value named `ReturnUrl`.</span></span>
5. <span data-ttu-id="c8be1-233">Создайте новую страницу в папке *аусентикатедконтент* с именем *Page. cshtml*.</span><span class="sxs-lookup"><span data-stu-id="c8be1-233">Create a new page in the *AuthenticatedContent* folder named *Page.cshtml*.</span></span>
6. <span data-ttu-id="c8be1-234">Замените разметку по умолчанию следующим:</span><span class="sxs-lookup"><span data-stu-id="c8be1-234">Replace the default markup with the following:</span></span>  

    [!code-cshtml[Main](18-customizing-site-wide-behavior/samples/sample17.cshtml)]
7. <span data-ttu-id="c8be1-235">Запустите *страницу. cshtml* в браузере.</span><span class="sxs-lookup"><span data-stu-id="c8be1-235">Run *Page.cshtml* in a browser.</span></span> <span data-ttu-id="c8be1-236">Код перенаправляет вас на страницу входа.</span><span class="sxs-lookup"><span data-stu-id="c8be1-236">The code redirects you to a login page.</span></span> <span data-ttu-id="c8be1-237">Необходимо зарегистрироваться перед входом в систему.</span><span class="sxs-lookup"><span data-stu-id="c8be1-237">You must register before logging in.</span></span> <span data-ttu-id="c8be1-238">После регистрации и входа в систему можно перейти к странице и просмотреть ее содержимое.</span><span class="sxs-lookup"><span data-stu-id="c8be1-238">After you've registered and logged in, you can navigate to the page and view its contents.</span></span>

<a id="Additional_Resources"></a>
## <a name="additional-resources"></a><span data-ttu-id="c8be1-239">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="c8be1-239">Additional Resources</span></span>

[<span data-ttu-id="c8be1-240">Введение в программирование веб-страницы ASP.NET с помощью синтаксиса Razor</span><span class="sxs-lookup"><span data-stu-id="c8be1-240">Introduction to ASP.NET Web Pages Programming Using the Razor Syntax</span></span>](https://go.microsoft.com/fwlink/?LinkID=251587)
