---
uid: web-forms/overview/moving-to-aspnet-20/membership
title: Членство | Документация Майкрософт
author: microsoft
description: Членство ASP.NET основывается на Успех модели проверки подлинности форм из ASP.NET 1.x. Проверка подлинности форм ASP.NET предоставляет удобный способ incorp...
ms.author: riande
ms.date: 02/20/2005
ms.assetid: f2339485-5d78-4c5e-8c0a-dc9b8a315345
msc.legacyurl: /web-forms/overview/moving-to-aspnet-20/membership
msc.type: authoredcontent
ms.openlocfilehash: d4fab68555eeb27420e60a28aca2f2c0fb9a73e3
ms.sourcegitcommit: 289e051cc8a90e8f7127e239fda73047bde4de12
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/25/2019
ms.locfileid: "58421522"
---
<a name="membership"></a>Членство
====================
по [Microsoft](https://github.com/microsoft)

> Членство ASP.NET основывается на Успех модели проверки подлинности форм из ASP.NET 1.x. Проверка подлинности форм ASP.NET предоставляет удобный способ включения форму входа в приложение ASP.NET и проверки пользователей от базы данных или другого хранилища данных.


Членство ASP.NET основывается на Успех модели проверки подлинности форм из ASP.NET 1.x. Проверка подлинности форм ASP.NET предоставляет удобный способ включения форму входа в приложение ASP.NET и проверки пользователей от базы данных или другого хранилища данных. Члены класса FormsAuthentication позволяют обрабатывать файлы cookie для проверки подлинности, проверки является допустимым именем входа, входа пользователя, и т.д. Однако реализации в приложениях ASP.NET 1.x формы проверки подлинности может потребоваться значительный объем кода.

Членство в ASP.NET 2.0 — это значительное усовершенствование по сравнению с использованием только проверки подлинности форм. (Членство самые надежные в сочетании с формами проверки подлинности, но с помощью форм не обязательно). Как вы скоро увидите, можно использовать членства ASP.NET и элементы управления входом в ASP.NET 2.0 для реализации системы членства мощные без необходимости писать много кода, вообще.

## <a name="implementing-membership-in-aspnet-20"></a>Реализация членства в ASP.NET 2.0

Членство реализуют следующие четыре действия. Имейте в виду, что существует множество действий, а также дополнительная конфигурация, который можно реализовать также участвующих. Эти действия предназначены для демонстрации картина настройки членства.

1. Создание базы данных членства (если SQL Server используется как хранилище данных членства.)
2. Укажите параметры членства в файлах конфигурации приложения. (Членство включен по умолчанию).
3. Определите тип хранилища членства, которую вы хотите использовать. Параметры: 

    - Microsoft SQL Server (версии 7.0 или более поздней версии)
    - Active Directory Store
    - Пользовательского поставщика членства
4. Настройте приложение для проверки подлинности форм ASP.NET. Опять же членства позволяет воспользоваться преимуществами проверки подлинности форм, но с помощью форм не является обязательным.
5. Определение учетных записей пользователей для членства и Настройка роли при необходимости.

## <a name="creating-the-membership-database"></a>Создание базы данных членства

Если вы используете SQL Server 7.0 или более поздней версии в качестве хранилища членства, можно использовать aspnet\_regsql программы (проще всего из Visual Studio .NET 2005 командной строки) для настройки базы данных. Aspnet\_regsql программа может использоваться как средство командной строки или с помощью мастера графического интерфейса пользователя. Метод мастера — самый простой способ настроить базу данных. Чтобы открыть мастер, просто выполните следующую команду:

`aspnet_regsql W`

После выполнения этой команды откроется с помощью мастера установки SQL Server ASP.NET как показано ниже.


![](membership/_static/image1.jpg)

**Рис. 1**


Мастер установки SQL Server ASP.NET создает веб-сайта в экземпляре, заданные в мастере. Тем не менее ASP.NET использует строку подключения в файле machine.config для подключения к базе данных. По умолчанию будет указывать эту строку подключения к экземпляру SQL Server 2005, поэтому если вы используете экземпляр SQL Server 2000 или SQL Server 7.0, необходимо изменить строку подключения в файле machine.config. Эту строку подключения можно найти здесь:

[!code-xml[Main](membership/samples/sample1.xml)]

К сожалению Если не изменить строку подключения, ASP.NET не обеспечит описанием ошибки. Она будет продолжать просто быть сообщение о том, что вы еще не создали базу данных. В приведенном выше примере я изменил строку подключения, чтобы она указывала на мой локальный экземпляр SQL Server 2000.

## <a name="specifying-configuration-and-adding-users-and-roles"></a>Указание конфигурации и добавление пользователей и ролей

На следующем этапе настройки членства является добавление необходимой информации в файл web.config приложения. В ASP.NET 1.x, изменив файл web.config был иногда трудно из-за использования lowerCamelCase и отсутствие Intellisense. Visual Studio .NET 2005 упрощает задачу с поддержкой технологии Intellisense для файлов конфигурации, но в ASP.NET 2.0 делает больше, предоставляя веб-интерфейс для редактирования файлов конфигурации.

Веб-интерфейса можно запустить, нажав кнопку Конфигурация ASP.NET на панели инструментов обозревателя решений, как показано ниже. Можно также запустить веб-интерфейса с помощью всплывающих окон, отображаемых при вставке элементы управления входом.


![](membership/_static/image2.jpg)

**Рис. 2**


Запустится средство администрирования веб-узла ASP.NET, показано ниже. Администрирование веб-сайта ASP.NET — это интерфейс четыре вкладки, который упрощает управление параметрами приложения. Доступны следующие вкладки:

- **Корневая папка**
- **Безопасность** настройки пользователей, роли и доступ.
- **Приложение** Настройка параметров приложения.
- **Поставщик** настроить и проверить поставщик членства для приложения.

Средство администрирования веб-сайт позволяет легко создавать новых пользователей, создать новые роли, а также для управления пользователями и ролями. Эта возможность недоступна в интерфейсе Windows. Интерфейс Windows позволяет легко определить параметры авторизации и добавление, удаление и управление поставщиками, возможности, не входящие в средство администрирования веб-сайта.

Чтобы запустить интерфейс Windows, откройте оснастку служб IIS, щелкните правой кнопкой мыши на приложение и выберите пункт Свойства. Перейдите на вкладку ASP.NET и затем нажмите кнопку Изменить конфигурацию. (Приложение должно выполняться под ASP.NET 2.0 для кнопки "изменить конфигурацию", чтобы включить. Вы можете настроить версию ASP.NET в диалоговом окне ASP.NET.) Диалоговое окно Параметры конфигурации ASP.NET отображается в том случае, как показано ниже.


![](membership/_static/image3.jpg)

**Рис. 3**


На вкладке «Общие», перечислены строки подключения и параметры приложения. Все параметры, выделенные курсивом определены в родительском файле конфигурации (machine.config или web.config на более высоком уровне) и параметров не курсивом из файла конфигурации приложения. Если добавляется параметр, удалены или изменены на уровне приложения ASP.NET будет добавить, удалить или изменить параметр в web.config уровня приложения вместо удаление настройки из файла конфигурации, из которого он унаследован.

Ниже показана вкладка проверки подлинности. Это происходит, когда вы настроите параметры членства. Формирует поставщиков членства, параметры проверки подлинности и поставщиков ролей можно настроить здесь.


![](membership/_static/image4.jpg)

**Рис. 4**


## <a name="implementing-membership-in-your-application"></a>Реализации членства в приложении

Самый простой способ реализовать членства ASP.NET 2.0 в приложении является использование предоставленного элементов управления входа в систему. Этот метод позволяет реализовать основы членства ASP.NET 2.0 без написания кода, вообще.

В ASP.NET 2.0 доступны следующие элементы управления входа в систему:

## <a name="login-control"></a>Элемент управления Login

Элемент управления Login предоставляет интерфейс для пользователей выполнять вход в систему членства. Он позволяет использовать текстовое поле имени пользователя и пароля и кнопки входа. Многие другие общие возможности, такие как ссылка для регистрации для тех, кто еще не сделано, флажок, пользователь может автоматически имя входа при последующих посещениях, ссылку для напоминания пароля и т. д. Все функции элемента управления Login можно настраивать с помощью свойств элемента управления.

В ASP.NET 1.x, разработчикам приходилось писать много кода выполняться поиск, при использовании проверки подлинности форм. С помощью членства в ASP.NET 2.0 можно выполнять проверку без написания кода, вообще. ASP.NET автоматически будут выполнять поиск пользователя для вас. (Если вы используете элемент управления Login без использования членства ASP.NET, можно использовать **OnAuthenticate** метод для проверки пользователя.)

## <a name="loginview-control"></a>Элемент управления LoginView

Элемент управления LoginView является шаблонный элемент управления, который предоставляет два шаблона по умолчанию. AnonymousTemplate и LoggedInTemplate. Шаблон, который отображается, зависит ли пользователь вошел в систему членства. Этот элемент управления обычно используется для отображения элемент управления Login, если пользователь еще не выполнил вход и элемент управления LoginStatus и/или других элементов управления входа, когда пользователь выполнил вход. Если вы используете управление ролями в приложении ASP.NET, элемент управления LoginView можно отобразить определенного шаблона на основе ролей пользователей. (Более на ASP.NET управление ролями будут рассмотрены ниже.)

## <a name="passwordrecovery-control"></a>Элемент управления PasswordRecovery

Управления PasswordRecovery позволяет пользователям получать сообщение электронной почты с свой текущий пароль или сбросить свой пароль. Открытым текстом и зашифрованные пароли можно восстановить и отправлены по электронной почте пользователей. Если пароль хэширован, его будет невозможно. Вместо этого он потребуется для выполнения сброса пароля.

## <a name="loginstatus-control"></a>Элемент управления LoginStatus

Элемент управления LoginStatus используется для отображения Признак имя входа для пользователей, которые не регистрируются в и индикатор выхода для пользователей, которые вошли в. Свойство Request.IsAuthenticated используется, чтобы определить, какие индикатор для отображения. Значок, отображаемый элементом управления LoginStatus может быть текстом (реализуются с помощью **LoginText** и **LogoutText** свойства) или изображения (реализуются с помощью **LoginImageUrl**и **LogoutImageUrl** свойства.)

После выхода пользователя с помощью элемента управления LoginStatus, он перенаправляется на URL-адрес, определяемое **LogoutPageUrl** свойство. Если это свойство не установлено, текущая страница обновляется. Так как, скорее всего, сайт защищен с помощью проверки подлинности форм, обновление текущей страницы будет перенаправлять пользователя на страницу входа для сайта.

## <a name="loginname-control"></a>Элемент управления LoginName

Элемент управления LoginName отображает имя пользователя, вошедшего на сайт.

## <a name="createuserwizard-control"></a>Элемент управления CreateUserWizard

Элемент управления CreateUserWizard предоставляет пользователям удобный способ регистрации для вашей системы членства. Можно добавить шаги (реализованную как коллекция WizardSteps) через интерфейс, подобный приведенному ниже.


![](membership/_static/image5.jpg)

**Рис. 5**


CreateUserWizard-это шаблонного элемента управления, производный от класса мастера и предоставляет следующие шаблоны:

- **HeaderTemplate** этот шаблон определяет отображение заголовка мастера.
- **SidebarTemplate** этот шаблон определяет отображение мастера боковой панели.
- **StartNavigationTemplate** этот шаблон определяет внешний вид панели навигации находятся на этапе запуска мастера.
- **StepNavigationTemplate** этот шаблон определяет внешний вид области навигации в случае начала или окончания шага.
- **FinishNavigationTemplate** этот шаблон определяет внешний вид области навигации, если на завершающем этапе.

Кроме того для каждого шага, добавляемой к мастеру, ASP.NET будет создавать пользовательский шаблон, который содержит ContentTemplate и CustomNavigationTemplate для данного шага. Подробные сведения о настройке CreateUserWizard см. в документации VS.NET 2005:

## <a name="changepassword-control"></a>Элемент управления ChangePassword

Элемент управления ChangePassword позволяет пользователям изменять свой пароль. Если свойство DisplayUserName равно true (значение по умолчанию: false), пользователь может изменить свой пароль, не вошедшие. Если пользователь *является* входа в систему и свойство DisplayUserName имеет значение true, пользователь будет иметь возможность изменять пароль другого пользователя, который не регистрируются в предоставлении знакомых идентификатор этого пользователя.

Имейте в виду, что если требуется, чтобы пользователи могли менять пароли не требуется входить, необходимо будет убедитесь, что страница, на котором отображается элемент управления ChangePassword разрешает анонимный доступ. Очевидно, что пользователям придется указать старый пароль, чтобы изменить свой пароль.

## <a name="role-management"></a>Управление ролями

Управление ролями позволяет пользователям назначать определенной роли и затем ограничить доступ к некоторым файла или папки на базе этой роли. Управление ролями также предоставляет API, чтобы программно определить роли someones или определения всех пользователей в определенной роли и реагировать соответствующим образом.

Управление ролями не является обязательным в членства ASP.NET, и не является требованием для использования управления ролями членства. Тем не менее двух отлично дополняют друг с другом, и вполне вероятно, что разработчики будут использовать их в сочетании друг с другом.

Чтобы включить управление ролями в приложении, внести следующие изменения в файле web.config:

[!code-xml[Main](membership/samples/sample2.xml)]

Когда **cacheRolesInCookie** атрибут имеет значение true, ASP.NET кэширует членство в роли пользователей в файле cookie на клиентском компьютере. Это позволяет уточняющие запросы роли происходит без вызовов в RoleProvider. При использовании этого атрибута, разработчики должны убедиться, что **cookieProtection** атрибута установлено значение All. (Это параметр по умолчанию). Это гарантирует, что данные cookie шифруются и позволяет гарантировать, что файлы cookie содержимое еще не были изменены. Роли могут добавляться с помощью средства администрирования веб-сайта. Он позволяет легко определить роли, настроить доступ к элементам узла, на основании этих ролей и назначать пользователей ролям.


![](membership/_static/image6.jpg)

**Рис. 6**


Как показано выше, можно добавить новые роли, просто введите имя роли и нажмите кнопку Добавить роль. Существующие роли можно управлять или удалить, щелкнув соответствующую ссылку в списке существующих ролей.

При управлении роли, можно добавить или удалить пользователей, как показано ниже.


![](membership/_static/image7.jpg)

**Рис. 7**


Установив флажок пользователь в роли, можно легко добавить пользователя в указанную роль. ASP.NET автоматически замените соответствующие записи базы данных членства. Необходимо также настроить правила доступа для приложения. ASP.NET 1.x разработчики знакомы с это с помощью &lt;авторизации&gt; элемент в файле web.config и этот параметр по-прежнему доступен в ASP.NET 2.0. Тем не менее проще управлять доступом правил, средство веб-сайта администрирования как показано ниже.


![](membership/_static/image8.jpg)

**Рис. 8**


В этом случае будет выделен в папку администрирования (его несложно увидеть, так как средство выделяет его светло-серый цвет) и роли "Администраторы" был предоставлен доступ. Все остальные пользователи — нет. Можно щелкнуть значок "головной" выберите правило, а затем использовать кнопки перемещения вверх и вниз, чтобы настроить правила. Как и в ASP.NET &lt;авторизации&gt; элемент, правила обрабатываются в порядке, в котором они появляются. Другими словами Если порядок правил на снимке выше были отменены, никто бы иметь доступ в папку администрирования поскольку первое правило, у них ASP.NET, может быть правило, которое запрещает всем пользователям в папку.

ASP.NET 2.0 добавляет файл web.config в папку, для которого вы определяете правило доступа. Правила доступа можно изменить с помощью файла конфигурации или средство администрирования веб-сайта. Другими словами средство администрирования веб-сайта — это просто интерфейс, через который можно изменить файл конфигурации в среде понятное.

## <a name="using-roles-in-code"></a>С помощью ролей в коде

API для управления ролями не изменился с момента выпуска версии 1.x. **IsInRole** метод используется для определения, является ли пользователь в определенной роли.

[!code-csharp[Main](membership/samples/sample3.cs)]

ASP.NET также создает экземпляр RolePrincipal как член текущего контекста. Объект RolePrincipal может использоваться для получения всех ролей, к которым принадлежит пользователь следующим образом:

[!code-csharp[Main](membership/samples/sample4.cs)]

## <a name="using-rolegroups-with-the-loginview-control"></a>С помощью групп ролей с помощью элемента управления LoginView

Теперь, когда у вас есть понимание управление ролями и членство, позволяет мы кратко обсудим, как элемент управления LoginView позволяет пользоваться преимуществами этой возможности в ASP.NET 2.0. Как уже говорилось ранее элемент управления LoginView является шаблонного элемента управления, содержащий два шаблона по умолчанию. AnonymousTemplate и LoggedInTemplate. В рамках LoginView задачи, которые диалоговое окно является ссылкой (см. ниже), позволяющий изменить группы ролей.


![](membership/_static/image9.jpg)

**Рис. 9**


Каждый объект группы ролей содержит массив строк, который определяет, какие роли, группы ролей, к которым применяется к. Добавление новой группы ролей в элемент управления LoginView, щелкните ссылку Изменить группы ролей. В приведенном выше рисунке видно, что я добавил новой группы ролей для администраторов. Выбрав, группы ролей (RoleGroup[0]) из раскрывающегося списка представлений можно настроить шаблон, который будет отображаться только членами роли "Администраторы". На рисунке ниже я добавил новой группы ролей, к которому применяется члены роли Sales и роль распространения. Это добавляет второй группы ролей в раскрывающийся список представления в диалоговом окне Задачи LoginView и ничего добавлен в этот шаблон будет отображаться ни одним пользователем продаж или распространения роли.


![](membership/_static/image10.jpg)

**Рис. 10**


## <a name="overriding-the-existing-membership-provider"></a>Переопределение существующего поставщика членства

Существует два способа, можно расширить функциональные возможности членства ASP.NET. Во-первых очевидно, что можно изменить существующие функциональные возможности класса SqlMembershipProvider, унаследованный от него и переопределения его методов. Например если вы хотите реализовывать собственные функции при их создании, можно создать свой собственный класс, наследуемый от SqlMembershipProvider следующим образом:

[!code-csharp[Main](membership/samples/sample5.cs)]

Если, с другой стороны, вы хотите создать собственный поставщик (для хранения информация о вашем членстве в базе данных Access, например), можно создать собственного поставщика.

## <a name="creating-your-own-membership-provider"></a>Создание собственного поставщика членства

Чтобы создать собственный поставщик членства, необходимо сначала создать класс, наследующий от класса MembershipProvider. Если вы используете VB.NET, Visual Studio 2005 добавит заглушки для всех методов, которые необходимо переопределить. Если вы используете C#, все зависит только добавить заглушки.

Необходимо переопределить следующие:

- Свойство ApplicationName
- Функция ChangePassword
- Функция ChangePasswordQuestionAndAnswer
- Функция CreateUser
- Функция DeleteUser
- Свойство EnablePasswordReset
- Свойство EnablePasswordRetrieval
- Функция FindUsersByEmail
- Функция FindUsersByName
- Функция GetAllUsers
- Функция GetNumberOfUsersOnline
- Функция GetPassword
- Функция GetUser
- Функция GetUserNameByEmail
- Свойство MaxInvalidPasswordAttempts
- Свойство MinRequiredNonAlphanumericCharacters
- Свойство MinRequiredPasswordLength
- Свойство PasswordAttemptWindow
- Свойство PasswordFormat
- Свойство PasswordStrengthRegularExpression
- Свойства RequiresQuestionAndAnswer
- Свойство RequiresUniqueEmail
- Функция ResetPassword
- Разблокировать пользователя-функция
- Функция UpdateUser
- Функция ValidateUser

Thats список для реализации как разработчик C#. Может показаться проще создать класс на языке VB.NET без какой-либо реализации и затем использовать .NET Reflector или аналогичное средство на преобразование кода на C#.

Строка подключения и другие свойства должно быть присвоено их значения по умолчанию в методе Initialize. (Метод Initialize возникает, когда поставщик загружается во время выполнения.) Второй параметр метода Initialize имеет тип System.Collections.Specialized.NameValueCollection и является ссылкой на &lt;добавить&gt; элемента, связанного с помощью пользовательского поставщика в файле web.config. Этот элемент выглядит следующим образом:

[!code-xml[Main](membership/samples/sample6.xml)]

Ниже приведен пример метода инициализации.

[!code-csharp[Main](membership/samples/sample7.cs)]

Чтобы проверить пользователя, при отправке формы входа, необходимо использовать метод ValidateUser. Этот метод применяется, когда пользователь нажимает кнопку входа в элемент управления Login. Поместите код, выполняющий поиск пользователя в этом методе.

Как вы видите, написание собственного поставщика членства не сложно и позволяет расширить эту полезную функциональность ASP.NET 2.0.
