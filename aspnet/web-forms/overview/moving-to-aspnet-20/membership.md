---
uid: web-forms/overview/moving-to-aspnet-20/membership
title: Членство в программе Документы Майкрософт
author: rick-anderson
description: ASP.NET членство основывается на успехе модели аутентификации Форм от ASP.NET 1.x. ASP.NET формы аутентификации обеспечивает удобный способ incorp ...
ms.author: riande
ms.date: 02/20/2005
ms.assetid: f2339485-5d78-4c5e-8c0a-dc9b8a315345
msc.legacyurl: /web-forms/overview/moving-to-aspnet-20/membership
msc.type: authoredcontent
ms.openlocfilehash: ed48c11cbd483de088239bad7c2452b7fc60a1cf
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2020
ms.locfileid: "81543773"
---
# <a name="membership"></a>Членство

[корпорацией Майкрософт](https://github.com/microsoft)

> ASP.NET членство основывается на успехе модели аутентификации Форм от ASP.NET 1.x. проверка подлинности ASP.NET Forms обеспечивает удобный способ включения формы входа в приложение ASP.NET и проверки пользователей на базе данных или другом хранилище данных.

ASP.NET членство основывается на успехе модели аутентификации Форм от ASP.NET 1.x. проверка подлинности ASP.NET Forms обеспечивает удобный способ включения формы входа в приложение ASP.NET и проверки пользователей на базе данных или другом хранилище данных. Члены класса FormsAuthentication позволяют обрабатывать файлы cookie для проверки подлинности, проверять наличие действительного входа, регистрировать пользователя и т.д. Однако для реализации проверки подлинности форм в приложении ASP.NET 1.x может потребоваться достаточное количество кода.

Членство в ASP.NET 2.0 является важным достижением по сравнению с использованием формы аутентификации в одиночку. (Членство является наиболее надежным в сочетании с аутентификацией форм, но использование проверки подлинности форм не является обязательным требованием.) Как вы скоро увидите, вы можете использовать ASP.NET членство и элементы управления в ASP.NET 2.0 для реализации мощной системы членства без написания большого кода вообще.

## <a name="implementing-membership-in-aspnet-20"></a>Осуществление членства в ASP.NET 2.0

Членство осуществляется четырьмя шагами. Имейте в виду, что Есть много подшагов, которые участвуют, а также дополнительная конфигурация, которая может быть реализована, а также. Эти шаги призваны проиллюстрировать общую картину настройки членства.

1. Создайте свою базу данных о членстве (если сервер S'L используется в качестве хранилища членства).
2. Укажите параметры членства в файлах конфигурации приложений. (Членство включено по умолчанию.)
3. Определите тип магазина членства, который вы хотите использовать. Возможные варианты: 

    - Сервер Microsoft S'L (версия 7.0 или более поздней версии)
    - Активный магазин каталогов
    - Пользовательский поставщик членства
4. Нанастройка приложения для проверки подлинности ASP.NET форм. Опять же, Членство предназначено для того, чтобы воспользоваться преимуществами проверки подлинности Форм, но использование проверки подлинности Форм не является обязательным требованием.
5. Определите учетные записи пользователей для членства и настраиваете роли при желании.

## <a name="creating-the-membership-database"></a>Создание базы данных о членстве

Если вы используете S'L Server 7.0 или позже в качестве\_хранилища членства, вы можете использовать утилиту aspnet regsql (наиболее легко доступна из визуальной студии .NET 2005 Command Prompt) для настройки базы данных. Утилита aspnet\_regsql может быть использована в качестве инструмента оперативного управления или через мастера GUI. Метод мастера — это самый простой способ настройки базы данных. Чтобы получить доступ к мастеру, просто запустите следующую команду:

`aspnet_regsql W`

После запуска этой команды вам будет представлен ASP.NET мастером настройки сервера S'L, как показано ниже.

![](membership/_static/image1.jpg)

**Рисунок 1**

Мастер ASP.NET настройки сервера S'L создает веб-узел в экземпляре, указанном в мастере. Тем не менее, ASP.NET будет использовать строку соединения в файле machine.config для подключения к вашей базе данных. По умолчанию эта строка соединения будет указывать на экземпляр S'L Server 2005, так что если вы используете экземпляр S'L Server 2000 или S'L Server 7.0, вам необходимо будет изменить строку соединения в файле machine.config. Эта строка соединения может быть расположена здесь:

[!code-xml[Main](membership/samples/sample1.xml)]

К сожалению, если вы не измените строку соединения, ASP.NET не даст вам описательную ошибку. Он будет просто продолжать жаловаться, говоря, что вы не создали базу данных. В приведенном выше случае я изменил строку соединения, чтобы указать на локальный экземпляр S'L Server 2000.

## <a name="specifying-configuration-and-adding-users-and-roles"></a>Определение конфигурации и добавление пользователей и ролей

Следующим шагом в настройке членства является добавление необходимой информации в файл web.config приложения. В ASP.NET 1.x, изменение web.config архива иногда было трудно из-за пользы lowerCamelCase и отсутсвия Intellisense. Visual Studio .NET 2005 значительно упрощает задачу с Помощью Intellisense для файлов конфигураций, но ASP.NET 2.0 идет еще дальше, предоставляя веб-интерфейс для редактирования файлов конфигурации.

Вы можете запустить веб-интерфейс, нажав кнопку ASP.NET конфигурации на панели инструментов Solution Explorer, как показано ниже. Вы также можете запустить веб-интерфейс с помощью всплывающих ups, которые отображаются при вставке управления логином.

![](membership/_static/image2.jpg)

**Рисунок 2**

Это запускает ASP.NET инструмент администрации веб-сайта показано ниже. Администрация веб-узла ASP.NET — это четырехтактный интерфейс, который упрощает управление настройками приложения. Доступны следующие вкладки:

- **Главная**
- **Безопасность** Настройка пользователей, ролей и доступа.
- **Заявка** Настройка настроек приложения.
- **Поставщик** Наймите и проверьте поставщика заявок.

Инструмент администрирования веб-узла позволяет легко создавать новых пользователей, создавать новые роли и управлять пользователями и ролями. Эта возможность недоступна в интерфейсе Windows. Интерфейс Windows позволяет легко определить настройки авторизации и добавить, удалить и управлять провайдерами, возможности, которые не входят в инструмент администрирования веб-сайта.

Чтобы запустить интерфейс Windows, откройте пакет Интернет-информационных служб, нажмите правой кнопкой мыши на ваше приложение и выберите Свойства. Нажмите на ASP.NET вкладку, а затем нажмите кнопку конфигурации edit. (Приложение должно работать под ASP.NET 2.0 для включения кнопки «Конфигурация отсваги». Вы можете настроить ASP.NET версию в ASP.NET диалоге, а также.) Диалог ASP.NET настройки конфигурации отображается в приведенном ниже.

![](membership/_static/image3.jpg)

**Рисунок 3**

На вкладке «Общая» перечислены строки соединения и настройки приложения. Любые настройки курсивом определяются в файле родительской конфигурации (либо machine.config, либо web.config на более высоком уровне), а настройки не курсивом — в файле конфигурации приложений. Если параметр добавлен, удален или отредактирован на уровне приложения, ASP.NET добавит, удалит или изменит настройку на уровнях приложения web.config вместо удаления параметра из файла конфигурации, из которого она наследуется.

Вкладка «Проверка подлинности» приведена ниже. Здесь вы наберете настройки членства. Здесь можно настроить настройки проверки подлинности, провайдеры членства и ролевые поставщики.

![](membership/_static/image4.jpg)

**Рисунок 4**

## <a name="implementing-membership-in-your-application"></a>Реализация членства в вашем приложении

Самый простой способ реализовать ASP.NET 2.0 членство в приложении — использовать предоставленные элементы управления Logon. Этот метод позволяет реализовать основы членства ASP.NET 2.0 без написания какого-либо кода вообще.

Следующие элементы управления Логон доступны в ASP.NET 2.0:

## <a name="login-control"></a>Управление логином

Управление логина предоставляет интерфейс для кого-то, чтобы войти в вашу систему членства. Он предоставляет вам имя пользователя и текстовый ящик с паролем и кнопку входа. Многие другие общие функции, такие как ссылка для регистрации для людей, которые еще не сделали этого, флажок, который позволяет пользователю автоматически войти в систему на последующие посещения, ссылка на пароль напоминание и т.д. Все функции управления логином настраиваются через свойства элемента управления.

В ASP.NET 1.x разработчики должны были написать изрядное количество кода, чтобы сделать поиск при использовании проверки подлинности Forms. С ASP.NET 2.0 членство, вы можете проверить пользователей без написания какого-либо кода на всех. ASP.NET автоматически будет искать пользователя для вас. (Если вы используете элемент управления входа без использования ASP.NET членства, вы можете использовать метод **OnAuthenticate** для проверки пользователя.)

## <a name="loginview-control"></a>Элемент управления LoginView

Элемент управления LoginView — это шаблонный элемент управления, который предоставляет два шаблона по умолчанию; AnonymousTemplate и LoggedInTemplate. Отображается шаблон, который отображается по тому, входит ли пользователь в вашу систему членства. Этот элемент управления обычно используется для отображения элемента управления входа, когда пользователь еще не вошел в систему и элемент управления LoginStatus и/или других элементов управления входа, когда пользователь вошел в систему. Если вы используете управление ролью в ASP.NET приложении, управление LoginView может отображать определенный шаблон, основанный на роли пользователей. (Подробнее о ASP.NET управлении ролью будет рассмотрено позже.)

## <a name="passwordrecovery-control"></a>Управление паролейRecovery

Контроль PasswordRecovery позволяет пользователям получать электронное письмо с его или ее текущий пароль или сбросить свой пароль. Четкий текст и зашифрованные пароли могут быть восстановлены и отправлены пользователям по электронной почте. Если пароль хэширован, он не может быть восстановлен. Вместо этого пользователь должен будет выполнить сбросить пароль.

## <a name="loginstatus-control"></a>Управление логином статусом

Элемент управления LoginStatus используется для отображения индикатора входа для пользователей, которые не вошли в систему, и индикатора выхода для пользователей, которые в настоящее время вошли в систему. Свойство Request.IsAuthenticated используется для определения того, какой индикатор для отображения. Индикатор, отображаемый управлением LoginStatus, может быть текстовым (реализованным через свойства **LoginText** и **LogoutText)** или изображениями (реализованными через свойства **LoginImageUrl** и **LogoutImageUrl).**

Когда пользователь выходит из системы управления LoginStatus, он или она перенаправляются на URL, указанный свойством **LogoutPageUrl.** Если это свойство не установлено, текущая страница обновляется. Поскольку сайт, скорее всего, защищен аутентификацией Форм, обновление текущей страницы перенаправит пользователя на страницу входа для сайта.

## <a name="loginname-control"></a>Управление Логином Именем

Управление LoginName отображает имя пользователя, в настоящее время входе в сайт.

## <a name="createuserwizard-control"></a>Создание УправленияUserWizard

Элемент управления CreateUserWizard предоставляет пользователям удобный способ зарегистрироваться для вашей системы членства. Вы можете добавить шаги (реализованные как коллекция WizardSteps) через интерфейс, показанный ниже.

![](membership/_static/image5.jpg)

**Рисунок 5**

CreateUserWizard — это шаблонный элемент управления, который вытекает из класса Wizard и предоставляет следующие шаблоны:

- **ЗаголовокШаблон** Этот шаблон контролирует внешний вид заголовка мастера.
- **Боковая панельШаблон** Этот шаблон контролирует внешний вид боковой панели мастера.
- **StartNavigationTemplate** Этот шаблон контролирует внешний вид навигации мастера на начальном этапе.
- **StepNavigationTemplate** Этот шаблон контролирует внешний вид области навигации, когда не в начальной или финишной ступени.
- **FinishNavigationTemplate** Этот шаблон контролирует внешний вид области навигации, когда на финише.

Кроме того, для каждого шага, который вы добавляете в Мастера, ASP.NET создам пользовательский шаблон, который содержит как ContentTemplate, так и CustomNavigationTemplate для этого шага. Для получения подробной информации о настройке CreateUserWizard, см VS.NET документации 2005 года:

## <a name="changepassword-control"></a>Контроль изменения пароля

Контроль ChangePassword позволяет пользователям изменять свой пароль. Если свойство DisplayUserName верно (это ложно по умолчанию), пользователь может изменить свой пароль, когда он не вошел в систему. Если *пользователь* уже зарегистрирован и свойство DisplayUserName верно, пользователь сможет изменить пароль другого пользователя, который не входит в систему при условии, что они знают идентификатор пользователя этого пользователя.

Имейте в виду, что если вы хотите, чтобы пользователи могли менять пароли без входа в систему, вам необходимо убедиться, что страница, на которой отображается элемент управления ChangePassword, позволяет анонимный доступ. Очевидно, что пользователи должны будут предоставить свой старый пароль для того, чтобы изменить свой пароль.

## <a name="role-management"></a>Управление ролями

Управление роями позволяет назначить пользователям определенную роль, а затем ограничить доступ к определенным файлам или папкам на основе этой роли. Управление ролью также предоставляет API, так что вы можете программно определить роль кого-то или определить всех пользователей в определенной роли и реагировать соответствующим образом.

Управление ролью не является требованием в ASP.NET членства, равно как и членство не является требованием для использования управления ролью. Тем не менее, два дополняют друг друга красиво, и вполне вероятно, что разработчики будут использовать их в сочетании друг с другом.

Чтобы включить управление ролью в приложении, внесделай следующее изменение в файл web.config:

[!code-xml[Main](membership/samples/sample2.xml)]

Когда атрибут **cacheRolesInCookie** становится верным, ASP.NET кэширует членство в роли пользователя в файле cookie-файлов на клиенте. Это позволяет выполнять поиск ролей без вызовов в RoleProvider. При использовании этого атрибута разработчикам рекомендуется обеспечить набор атрибута **cookieProtection** для всех. (Это параметр по умолчанию.) Это гарантирует, что данные cookie зашифрованы, и помогает гарантировать, что содержимое файлов cookie не было изменено. Роли могут быть добавлены с помощью инструмента администрирования веб-сайта. Это позволяет легко определить роли, настроить доступ к частям сайта на основе этих ролей и назначить пользователей ролей.

![](membership/_static/image6.jpg)

**Рисунок 6**

Как показано выше, новые роли могут быть добавлены, просто введя имя роли, а затем нажав Добавить роль. Существующие роли можно управлять или удалять, нажав на соответствующую ссылку в списке существующих ролей.

Когда вы управляете ролью, вы можете добавить или удалить пользователей, как показано ниже.

![](membership/_static/image7.jpg)

**Рис. 7**

Проверяя флажок пользователя Is In Role, вы можете легко добавить пользователя к определенной роли. ASP.NET автоматически обновит базу данных о членстве с соответствующими записями. Вы также хотите настроить правила доступа для вашего приложения. ASP.NET 1.x разработчики знакомы с &lt;&gt; делать это через элемент авторизации в файле web.config, и эта опция по-прежнему доступна в ASP.NET 2.0. Тем не менее, его легче управлять правилами доступа с помощью инструмента администрирования веб-сайта, как показано ниже.

![](membership/_static/image8.jpg)

**Рис. 8**

В этом случае выделена папка администрации (ее трудно разосмотреть, поскольку инструмент выделяет ее в светло-серый цвет), а роль администраторов получила доступ. Всем остальным пользователям отказано. Вы можете нажать на значок головы, чтобы выбрать правило, а затем использовать кнопки Move Up и Move Down для организации правил. Как и &lt;в&gt; ASP.NET элемент авторизации, правила обрабатываются в порядке, в котором они отображаются. Другими словами, если бы порядок правил в приведенном выше выстреле был отменен, никто не будет иметь доступа к папке Администрации, поскольку первым правилом, с которым ASP.NET столкнется, было бы правилом, которое лишает всех папку.

ASP.NET 2.0 добавляет файл web.config в папку, для которой вы указываете правило доступа. Правила доступа можно редактировать через файл конфигурации или через инструмент администрирования веб-сайта. Другими словами, инструмент администрирования веб-узла — это просто интерфейс, с помощью которого файл конфигурации может быть отредактирован в удобной для пользователя среде.

## <a name="using-roles-in-code"></a>Использование ролей в коде

API для управления роями не изменился с версии 1.x. Метод **IsInRole** используется для определения того, находится ли пользователь в определенной роли.

[!code-csharp[Main](membership/samples/sample3.cs)]

ASP.NET также создает экземпляр RolePrincipal в качестве члена текущего контекста. Объект RolePrincipal может быть использован для получения всех ролей, к которым принадлежит пользователь:

[!code-csharp[Main](membership/samples/sample4.cs)]

## <a name="using-rolegroups-with-the-loginview-control"></a>Использование групп ролей с помощью управления LoginView

Теперь, когда у вас есть понимание управления ролью и членства, давайте кратко обсудить, как управление LoginView использует эту возможность в ASP.NET 2.0. Как уже говорилось ранее, элемент управления LoginView является шаблонным элементом управления, содержащим два шаблона по умолчанию; AnonymousTemplate и LoggedInTemplate. В диалоге ЛогинВью задачи есть ссылка (см. ниже), которая позволяет отображывать RoleGroups.

![](membership/_static/image9.jpg)

**Рисунок 9**

Каждый объект RoleGroup содержит массив строк, определяющих, к каким ролям относится RoleGroup. Чтобы добавить новую RoleGroup в управление LoginView, щелкните по ссылке Edit RoleGroups. На рисунке выше видно, что я добавил новую RoleGroup для администраторов. Выбрав RoleGroup (RoleGroup) из выпадения представлений, я могу настроить шаблон, который будет отображаться только для членов роли администраторов. На рисунке ниже я добавил новую RoleGroup, которая применяется к членам роли продаж и роли распределения. Это добавляет вторую RoleGroup к выпадению просмотров в диалоге задач LoginView, и все, что добавляется к этому шаблону, будет видно любому пользователю в роли продаж или распределения.

![](membership/_static/image10.jpg)

**Рис. 10**

## <a name="overriding-the-existing-membership-provider"></a>Переопределение существующего поставщика членства

Есть несколько способов, которые можно расширить функциональность ASP.NET членства. Прежде всего, можно, очевидно, изменить существующую функциональность класса SqlMembershipProvider, наследовав от него и переопределив его методы. Например, если вы хотите реализовать свою собственную функциональность при создании пользователей, можно создать свой собственный класс, который следует из SqlMembershipProvider следующим образом:

[!code-csharp[Main](membership/samples/sample5.cs)]

Если, с другой стороны, вы хотите создать свой собственный провайдер (для хранения информации о членстве в базе данных Access, например), вы можете создать свой собственный провайдер.

## <a name="creating-your-own-membership-provider"></a>Создание собственного поставщика членства

Чтобы создать собственного поставщика членства, сначала необходимо создать класс, который наследует от класса MembershipProvider. Если вы используете VB.NET, Visual Studio 2005 добавит заглушки для всех методов, которые вам нужно переопределить. Если вы используете C, его до вас, чтобы добавить заглушки.

Вам нужно будет переопределить следующее:

- Свойство ApplicationName
- Функция ChangePassword
- Функция ChangePasswordQuestionandanswer
- Создание функции пользователя
- Функция удаления пользователя
- Свойство EnablePasswordReset
- Свойство EnablePasswordRetrieval
- Функция FindUsersByEmail
- Функция FindUsersByName
- Функция GetAllUsers
- Функция GetNumberOfUsersOnline
- Функция GetPassword
- Функция GetUser
- Функция GetUserNamebyEmail
- Свойство MaxInvalidPasswordПопытки
- MinRequiredNonAlphanumericcharacters собственности
- MinRequiredPasswordLength собственности
- Свойство PasswordAttemptWindow
- Свойство PasswordFormat
- Свойство PasswordStrengthRegularExpression
- ТребуетПодсомнениеиответ собственности
- RequiresUniqueEmail собственности
- Функция СброситьПароль
- Разблокировать функцию пользователя
- Функция UpdateUser
- Функция ValidateUser

Это довольно список для реализации в качестве разработчика C. Возможно, вам будет проще создать класс в VB.NET без реализации, а затем использовать .NET Reflector или аналогичный инструмент для преобразования кода в C..

Строка соединения и другие свойства должны быть установлены на их по умолчанию в методе Инициализации. (Метод Инициализации запускается при загрузке поставщика во время выполнения.) Второй параметр метода Инициализации — тип System.Collections.Specialized.NameValueCollection и является отсылкой к элементу &lt;добавления,&gt; который связан с вашим пользовательским поставщиком в файле web.config. Эта запись выглядит следующим образом:

[!code-xml[Main](membership/samples/sample6.xml)]

Вот пример метода инициализации.

[!code-csharp[Main](membership/samples/sample7.cs)]

Для проверки пользователя при отправке формы входа необходимо использовать метод ValidateUser. Этот метод запускается, когда пользователь нажимает кнопку входа в управление входа. Вы разместите свой код, который делает поиск пользователя в этом методе.

Как вы можете видеть, писать свой собственный поставщик членства не сложно и позволяет расширить эту мощную функциональность ASP.NET 2.0.
