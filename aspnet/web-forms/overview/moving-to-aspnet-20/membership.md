---
uid: web-forms/overview/moving-to-aspnet-20/membership
title: Членство | Документация Майкрософт
author: microsoft
description: Членство в ASP.NET построено на успешности модели проверки подлинности на основе форм из ASP.NET 1. x. ASP.NET Forms Authentication предоставляет удобный способ для Организации...
ms.author: riande
ms.date: 02/20/2005
ms.assetid: f2339485-5d78-4c5e-8c0a-dc9b8a315345
msc.legacyurl: /web-forms/overview/moving-to-aspnet-20/membership
msc.type: authoredcontent
ms.openlocfilehash: da6fc205bd852a818d65425586cec38fdb08d310
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78521706"
---
# <a name="membership"></a>Членство

по [Майкрософт](https://github.com/microsoft)

> Членство в ASP.NET построено на успешности модели проверки подлинности на основе форм из ASP.NET 1. x. ASP.NET Forms Authentication — это удобный способ включения формы входа в приложение ASP.NET и проверки пользователей в базе данных или другом хранилище данных.

Членство в ASP.NET построено на успешности модели проверки подлинности на основе форм из ASP.NET 1. x. ASP.NET Forms Authentication — это удобный способ включения формы входа в приложение ASP.NET и проверки пользователей в базе данных или другом хранилище данных. Члены класса FormsAuthentication позволяют управлять файлами cookie для проверки подлинности, проверять допустимость имени входа, регистрировать пользователя и т. д. Однако реализация проверки подлинности с помощью форм в приложении ASP.NET 1. x может потребовать достаточного объема кода.

Членство в ASP.NET 2,0 является значительным перебором только проверки подлинности с помощью форм. (Членство в наиболее надежном сочетании с проверкой подлинности с помощью форм, но использование проверки подлинности на основе форм не является обязательным.) Как вы вскоре увидите, вы можете использовать членство ASP.NET и элементы управления входа в ASP.NET 2,0 для реализации мощной системы членства без написания большого объема кода.

## <a name="implementing-membership-in-aspnet-20"></a>Реализация членства в ASP.NET 2,0

Членство реализуется в следующих четырех шагах. Помните, что существует множество подшагов, а также дополнительная настройка, которую также можно реализовать. Эти шаги предназначены для иллюстрации общей картины настройки членства.

1. Создайте базу данных членства (если SQL Server используется в качестве хранилища членства.)
2. Укажите параметры членства в файлах конфигурации приложений. (Членство включено по умолчанию.)
3. Определите тип хранилища членства, которое вы хотите использовать. Возможные варианты: 

    - Microsoft SQL Server (версия 7,0 или более поздняя)
    - Хранилище Active Directory
    - Пользовательский поставщик членства
4. Настройте приложение для проверки подлинности с помощью ASP.NET Forms. Опять же, членство призвано воспользоваться преимуществами проверки подлинности на основе форм, но использование проверки подлинности с помощью форм не является обязательным.
5. Определите учетные записи пользователей для членства и при необходимости настройте роли.

## <a name="creating-the-membership-database"></a>Создание базы данных членства

Если вы используете SQL Server 7,0 или более поздней версии в качестве вашего хранилища членства, вы можете настроить базу данных с помощью служебной программы ASPNET\_регскл (которая легко доступна в командной строке Visual Studio .NET 2005). Служебную программу ASPNET\_регскл можно использовать в качестве средства командной строки или с помощью мастера графического пользовательского интерфейса. Метод мастера является самым простым способом настройки базы данных. Для доступа к мастеру просто выполните следующую команду:

`aspnet_regsql W`

После выполнения этой команды вы увидите мастер установки ASP.NET SQL Server, как показано ниже.

![](membership/_static/image1.jpg)

**Рисунок 1**

Мастер установки SQL Server ASP.NET создает веб-сайт в экземпляре, указанном в мастере. Однако ASP.NET будет использовать строку подключения в файле Machine. config для подключения к базе данных. По умолчанию эта строка подключения указывает на экземпляр SQL Server 2005, поэтому при использовании экземпляра SQL Server 2000 или SQL Server 7,0 необходимо будет изменить строку подключения в файле Machine. config. Эту строку подключения можно найти здесь:

[!code-xml[Main](membership/samples/sample1.xml)]

К сожалению, если не изменить строку подключения, ASP.NET не даст вам описательные ошибки. Он просто будет сообщать о том, что вы еще не создали базу данных. В приведенном выше примере я изменил строку подключения так, чтобы она указывала на мой локальный экземпляр SQL Server 2000.

## <a name="specifying-configuration-and-adding-users-and-roles"></a>Указание конфигурации и Добавление пользователей и ролей

Следующим шагом в настройке членства является добавление необходимых сведений в файл Web. config приложения. В ASP.NET 1. x изменение файла Web. config иногда усложняется из-за использования Ловеркамелкасе и отсутствия технологии IntelliSense. Visual Studio .NET 2005 значительно упрощает задачу с помощью технологии IntelliSense для файлов конфигурации, но ASP.NET 2,0 переходит на один шаг вперед, предоставляя веб-интерфейс для редактирования файлов конфигурации.

Чтобы запустить веб-интерфейс, нажмите кнопку Конфигурация ASP.NET на панели инструментов обозреватель решений, как показано ниже. Также можно запустить веб-интерфейс с помощью всплывающих окон, отображаемых при вставке элементов управления входа.

![](membership/_static/image2.jpg)

**Рис. 2**

Запустится средство администрирования веб-сайта ASP.NET, показанное ниже. Администрирование веб-узла ASP.NET — это интерфейс с четырьмя вкладками, который упрощает управление параметрами приложения. Доступны следующие вкладки:

- **Главная**
- **Безопасность** Настройка пользователей, ролей и доступа.
- **Приложение** Настройка параметров приложения.
- **Поставщик услуг** Настройка и тестирование поставщика членства в приложениях.

Средство администрирования веб-сайтов позволяет легко создавать новых пользователей, создавать новые роли и управлять пользователями и ролями. Эта возможность недоступна в интерфейсе Windows. Интерфейс Windows позволяет легко определять параметры авторизации, а также добавлять, удалять и управлять поставщиками, возможностями, которые не входят в средство администрирования веб-сайта.

Чтобы запустить интерфейс Windows, откройте оснастку службы IIS, щелкните правой кнопкой мыши приложение и выберите пункт Свойства. Перейдите на вкладку ASP.NET и нажмите кнопку Edit Configuration (изменить конфигурацию). (Чтобы включить кнопку "изменить конфигурацию", приложение должно работать под ASP.NET 2,0. Можно также настроить версию ASP.NET в диалоговом окне ASP.NET.) Откроется диалоговое окно Параметры конфигурации ASP.NET, как показано ниже.

![](membership/_static/image3.jpg)

**Рис. 3**

На вкладке Общие отображаются строки подключения и параметры приложения. Все параметры курсивом задаются в родительском файле конфигурации (Machine. config или Web. config на более высоком уровне), а параметры, не заданные курсивом, — из файла конфигурации приложений. Если параметр добавляется, удаляется или изменяется на уровне приложения, ASP.NET добавляет, удаляет или изменяет параметр на уровнях приложения Web. config, а не удаляет параметр из файла конфигурации, из которого он унаследован.

Вкладка Проверка подлинности показана ниже. Здесь вы будете настраивать параметры членства. Параметры проверки подлинности на формах, поставщиков членства и поставщиков ролей можно настроить здесь.

![](membership/_static/image4.jpg)

**Рис. 4**

## <a name="implementing-membership-in-your-application"></a>Реализация членства в приложении

Самым простым способом реализации членства ASP.NET 2,0 в приложении является использование указанных элементов управления входом в систему. Этот метод позволяет реализовать основы членства в ASP.NET 2,0 без написания кода.

В ASP.NET 2,0 доступны следующие элементы управления входом:

## <a name="login-control"></a>Элемент управления Login

Элемент управления Login предоставляет интерфейс для входа в систему членства. Он предоставляет текстовое поле имя пользователя и пароль и кнопку входа. Многие другие распространенные функции, такие как ссылка для регистрации пользователей, которые еще не сделали этого, — флажок, позволяющий пользователю автоматически войти в систему при последующих посещениях, ссылку на напоминание о пароле и т. д. Все функции элемента управления Login можно настраивать с помощью свойств элемента управления.

В ASP.NET 1. x разработчикам пришлось писать адекватный объем кода для уточняющего запроса при использовании проверки подлинности с помощью форм. Членство в ASP.NET 2,0 позволяет проверять подлинность пользователей без написания кода. ASP.NET автоматически выполняет поиск пользователя. (Если вы используете элемент управления Login без использования членства ASP.NET, для проверки пользователя можно использовать метод **onauthenticat** .)

## <a name="loginview-control"></a>Элемент управления LoginView

Элемент управления LoginView — это шаблонный элемент управления, который по умолчанию предоставляет два шаблона. Анонимаустемплате и Логжединтемплате. Отображаемый шаблон определяется тем, входит ли пользователь в систему членства. Этот элемент управления обычно используется для вывода элемента управления Login, когда пользователь еще не вошел в систему, а также элемент управления LoginStatus и (или) другие элементы управления входом, когда пользователь выполнил вход. Если вы используете управление ролями в приложении ASP.NET, элемент управления LoginView может отображать конкретный шаблон на основе роли пользователей. (Дополнительные сведения об управлении ролями ASP.NET будут рассмотрены позже.)

## <a name="passwordrecovery-control"></a>Элемент управления Пассвордрековери

Элемент управления Пассвордрековери позволяет пользователям получить сообщение электронной почты с его текущим паролем или сбросить свой пароль. Открытый текст и зашифрованные пароли могут быть восстановлены и отправлены пользователям по электронной почте. Если пароль хэширован, восстановить его невозможно. Вместо этого пользователю потребуется выполнить сброс пароля.

## <a name="loginstatus-control"></a>Элемент управления LoginStatus

Элемент управления LoginStatus используется для отображения индикатора входа для пользователей, которые не выполнили вход, и индикатора выхода для пользователей, которые в данный момент вошли в систему. Свойство Request. Authenticator используется для определения отображаемого индикатора. Индикатором, отображаемым элементом управления LoginStatus, может быть текст (реализован через свойства **логинтекст** и **логауттекст** ) или изображения (реализованные с помощью свойств **логинимажеурл** и **логаутимажеурл** ).

Когда пользователь выходит через элемент управления LoginStatus, он перенаправляется на URL-адрес, указанный свойством **логаутпажеурл** . Если это свойство не задано, обновляется текущая страница. Поскольку сайт, вероятно, защищен проверкой подлинности с помощью форм, обновление текущей страницы перенаправит пользователя на страницу входа для сайта.

## <a name="loginname-control"></a>Элемент управления LoginName

Элемент управления LoginName отображает имя пользователя, который в данный момент вошел в систему сайта.

## <a name="createuserwizard-control"></a>Элемент управления CreateUserWizard

Элемент управления CreateUserWizard предоставляет пользователям удобный способ регистрации в системе членства. Вы можете добавить шаги (реализованные в виде коллекции WizardSteps) через интерфейс, показанный ниже.

![](membership/_static/image5.jpg)

**Рис. 5**

CreateUserWizard — это шаблонный элемент управления, производный от класса Wizard, который предоставляет следующие шаблоны:

- **HeaderTemplate** Этот шаблон управляет внешним видом заголовка мастера.
- **SidebarTemplate** Этот шаблон управляет внешним видом боковой панели мастера.
- **Стартнавигатионтемплате** Этот шаблон определяет внешний вид навигации в мастере на шаге "начало".
- **StepNavigationTemplate** Этот шаблон управляет внешним видом области навигации, если не находится на шаге начало или конец.
- **FinishNavigationTemplate** Этот шаблон управляет внешним видом области навигации на этапе завершения.

Кроме того, для каждого шага, добавляемого в мастер, ASP.NET создаст пользовательский шаблон, который содержит как ContentTemplate, так и CustomNavigationTemplate для этого шага. Полные сведения о настройке CreateUserWizard см. в документации по VS.NET 2005:

## <a name="changepassword-control"></a>ChangePassword, элемент управления

Элемент управления ChangePassword позволяет пользователям изменять свой пароль. Если свойство DisplayUserName имеет значение true (по умолчанию имеет значение false), пользователь может изменить свой пароль, если он не вошел в систему. Если *пользователь уже выполнил* вход и свойство DisplayUserName имеет значение true, пользователь сможет изменить пароль другого пользователя, который не вошел в систему, ПРЕДОСТАВИВ ему идентификатор пользователя.

Помните, что если нужно, чтобы пользователи могли изменять пароли без входа в систему, необходимо убедиться, что страница, на которой отображается элемент управления ChangePassword, разрешает анонимный доступ. Очевидно, чтобы изменить пароль, пользователям придется предоставить свой старый пароль.

## <a name="role-management"></a>Управление ролями

Управление ролями позволяет назначить пользователей определенной роли, а затем ограничить доступ к определенным файлам и папкам на основе этой роли. Управление ролями также предоставляет API, чтобы можно было программным образом определить роль пользователя или определить всех пользователей в определенной роли и ответить соответствующим образом.

Управление ролями не является обязательным для членства в ASP.NET и не является обязательным для использования управления ролями. Тем не менее, эти два дополнения к друг другу хорошо, и вполне вероятно, что разработчики будут использовать их совместно друг с другом.

Чтобы включить управление ролями в приложении, внесите следующее изменение в файл Web. config:

[!code-xml[Main](membership/samples/sample2.xml)]

Если атрибут **качеролесинкукие** имеет значение true, ASP.NET кэширует членство в роли пользователей в файле cookie на клиенте. Это позволяет выполнять поиск ролей без вызова RoleProvider. При использовании этого атрибута разработчики должны убедиться, что атрибут **кукиепротектион** имеет значение ALL. (Это значение по умолчанию.) Это обеспечивает шифрование данных файлов cookie и помогает гарантировать, что содержимое файлов cookie не было изменено. Роли можно добавлять с помощью средства администрирования веб-сайта. Он позволяет легко определять роли, настраивать доступ к частям сайта на основе этих ролей и назначать пользователей ролям.

![](membership/_static/image6.jpg)

**Рис. 6**

Как показано выше, новые роли можно добавить, просто введя имя роли и нажав кнопку Добавить роль. Существующие роли можно управлять или удалять, щелкнув соответствующую ссылку в списке существующих ролей.

При управлении ролью можно добавлять или удалять пользователей, как показано ниже.

![](membership/_static/image7.jpg)

**Рис. 7**

Установив флажок пользователь входит в роль, можно легко добавить пользователя в определенную роль. ASP.NET автоматически обновит вашу базу данных членства соответствующими записями. Кроме того, необходимо настроить правила доступа для приложения. Разработчики ASP.NET 1. x знакомы с этим, используя элемент&gt; авторизации &lt;в файле Web. config, и этот параметр по-прежнему доступен в ASP.NET 2,0. Однако проще управлять правилами доступа с помощью средства администрирования веб-сайта, как показано ниже.

![](membership/_static/image8.jpg)

**Рис. 8**

В этом случае папка администрирования выделяется (ее трудно увидеть, поскольку она выделяется светло-серым цветом), а роли "Администраторы" предоставлен доступ. Все остальные пользователи отклоняются. Можно щелкнуть значок заголовка, чтобы выбрать правило, а затем воспользоваться кнопками вверх и вниз, чтобы расположить правила. Как и в случае с элементом&gt; авторизации ASP.NET &lt;, правила обрабатываются в том порядке, в котором они отображаются. Иными словами, если порядок правил на приведенном выше снимке был изменен, никто не будет иметь доступа к папке администрирования, так как первым правилом, которое ASP.NET бы, является правило, запрещающее всех пользователей в папке.

ASP.NET 2,0 добавляет файл Web. config в папку, для которой указывается правило доступа. Правила доступа можно изменять с помощью файла конфигурации или средства администрирования веб-сайта. Иными словами, средство администрирования веб-сайта — это просто интерфейс, с помощью которого файл конфигурации можно редактировать в удобной для пользователя среде.

## <a name="using-roles-in-code"></a>Использование ролей в коде

API для управления ролями не изменился с версии 1. x. Метод **IsInRole** используется для определения того, входит ли пользователь в конкретную роль.

[!code-csharp[Main](membership/samples/sample3.cs)]

ASP.NET также создает экземпляр РолепринЦипал в качестве члена текущего контекста. Объект РолепринЦипал можно использовать для получения всех ролей, к которым принадлежит пользователь, следующим образом.

[!code-csharp[Main](membership/samples/sample4.cs)]

## <a name="using-rolegroups-with-the-loginview-control"></a>Использование группы ролей с элементом управления LoginView

Теперь, когда у вас есть знания об управлении ролями и членстве в нем, можно обсудить, как элемент управления LoginView использует преимущества этой возможности в ASP.NET 2,0. Как уже говорилось, элемент управления LoginView является шаблонным элементом управления, который по умолчанию содержит два шаблона. Анонимаустемплате и Логжединтемплате. В диалоговом окне Задачи LoginView находится ссылка (показана ниже), позволяющая изменить группы ролей.

![](membership/_static/image9.jpg)

**Рис. 9**

Каждый объект группы ролей содержит массив строк, который определяет, к каким ролям применяется группы ролей. Чтобы добавить новый группы ролей в элемент управления LoginView, щелкните ссылку Edit группы ролей (изменить). На приведенном выше рисунке видно, что я добавил новый группы ролей для администраторов. Выбрав этот группы ролей (группы ролей [0]) в раскрывающемся списке представления, можно настроить шаблон, который будет отображаться только членам роли "Администраторы". На приведенном ниже рисунке я добавил новый группы ролей, который применяется к членам роли Sales и роли распределения. Это добавляет второй группы ролей в раскрывающийся список "представления" в диалоговом окне "Задачи LoginView" и все, что добавляется в этот шаблон, будет отображаться любым пользователем в роли "продажи" или "распределение".

![](membership/_static/image10.jpg)

**Рис. 10**

## <a name="overriding-the-existing-membership-provider"></a>Переопределение существующего поставщика членства

Существует несколько способов расширения функциональности членства в ASP.NET. Во – первых, можно изменить существующие функциональные возможности класса SqlMembershipProvider, наследуя от него наследование и переопределив его методы. Например, если вы хотите реализовать собственные функции при создании пользователей, можно создать собственный класс, наследующий от SqlMembershipProvider, следующим образом:

[!code-csharp[Main](membership/samples/sample5.cs)]

Если, с другой стороны, нужно создать собственный поставщик (например, для хранения сведений о членстве в базе данных Access), можно создать собственный поставщик.

## <a name="creating-your-own-membership-provider"></a>Создание собственного поставщика членства

Для создания собственного поставщика членства сначала необходимо создать класс, наследующий от класса MembershipProvider. Если вы используете VB.NET, Visual Studio 2005 добавит заглушки для всех методов, которые необходимо переопределить. Если вы используете C#, добавьте заглушки.

Необходимо переопределить следующее:

- Свойство ApplicationName
- Функция ChangePassword
- Функция Чанжепассвордкуестионандансвер
- Функция CreateUser
- Функция Делетеусер
- Енаблепассвордресет, свойство
- Енаблепассвордретриевал, свойство
- Функция Финдусерсбемаил
- Функция Финдусерсбинаме
- Функция Жеталлусерс
- Функция Жетнумберофусерсонлине
- Функция onpassword
- Функция onuser
- Функция Жетусернамебемаил
- Максинвалидпассвордаттемптс, свойство
- Минрекуиредноналфанумерикчарактерс, свойство
- Минрекуиредпассвордленгс, свойство
- Пассвордаттемптвиндов, свойство
- Пассвордформат, свойство
- Пассвордстренгсрегуларекспрессион, свойство
- Рекуирескуестионандансвер, свойство
- Рекуиресуникуимаил, свойство
- Функция Ресетпассворд
- Разблокировать пользовательскую функцию
- Функция Упдатеусер
- Функция ValidateUser

Поддерживающие аттестацию список для реализации в качестве C# разработчика. Может оказаться проще создать класс в VB.NET без какой-либо реализации, а затем использовать отражатель .NET или аналогичное средство для преобразования кода в C#.

Для строки подключения и других свойств следует задать значения по умолчанию в методе Initialize. (Метод Initialize срабатывает, когда поставщик загружается во время выполнения.) Второй параметр метода Initialize имеет тип System. Collections. Custom. NameValueCollection и является ссылкой на &lt;добавить&gt; элемент, связанный с настраиваемым поставщиком в файле Web. config. Эта запись выглядит следующим образом:

[!code-xml[Main](membership/samples/sample6.xml)]

Ниже приведен пример метода Initialize.

[!code-csharp[Main](membership/samples/sample7.cs)]

Чтобы проверить пользователя при отправке формы входа, необходимо использовать метод ValidateUser. Этот метод срабатывает, когда пользователь нажимает кнопку входа в элементе управления Login. В этом методе будет размещен код, который выполняет поиск пользователя.

Как видите, написание собственного поставщика членства не является сложным и позволяет расширить эту функциональность ASP.NET 2,0.
