---
uid: web-forms/overview/moving-to-aspnet-20/configuration-and-instrumentation
title: Конфигурация и инструментирование | Документация Майкрософт
author: microsoft
description: Существуют значительные изменения в конфигурации и инструментарий в среде ASP.NET 2.0. Новый API конфигурации ASP.NET позволяет сделать запрос на Вытягивание изменения конфигурации...
ms.author: riande
ms.date: 02/20/2005
ms.assetid: 21ebbaee-7ed8-45ae-b6c1-c27c88342e48
msc.legacyurl: /web-forms/overview/moving-to-aspnet-20/configuration-and-instrumentation
msc.type: authoredcontent
ms.openlocfilehash: b06f105b16087f97788e0ab360af41f538d2c1ac
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/09/2019
ms.locfileid: "59400806"
---
# <a name="configuration-and-instrumentation"></a>Конфигурация и инструментирование

по [Microsoft](https://github.com/microsoft)

> Существуют значительные изменения в конфигурации и инструментарий в среде ASP.NET 2.0. Новый API конфигурации ASP.NET позволяет производить программно, изменения конфигурации. Кроме того, существует много новых параметров конфигурации разрешить для новой конфигурации и инструментирования.


Существуют значительные изменения в конфигурации и инструментарий в среде ASP.NET 2.0. Новый API конфигурации ASP.NET позволяет производить программно, изменения конфигурации. Кроме того, существует много новых параметров конфигурации разрешить для новой конфигурации и инструментирования.

В этом модуле мы обсудим конфигурации API ASP.NET его связь с чтения и записи к файлам конфигурации ASP.NET, а также рассмотрены инструментирования ASP.NET. Мы также рассмотрим новых функций, доступных в трассировке ASP.NET.

## <a name="aspnet-configuration-api"></a>API конфигурации ASP.NET

API конфигурации ASP.NET позволяет разработку, развертывание и управление данными конфигурации приложения с помощью единого интерфейса программирования. API конфигурации можно использовать для разработки и изменения всей конфигурации ASP.NET программными средствами без непосредственного редактирования XML-данные в файлах конфигурации. Кроме того можно использовать API конфигурации в консольных приложениях и скриптах, разрабатываемых, веб средства управления и оснастки консоли управления (MMC).

Следующие два средства управления конфигурацией, используйте API конфигурации и входят в состав .NET Framework версии 2.0:

- Оснастки консоли MMC ASP.NET, которая использует API конфигурации для упрощения выполнения задач администрирования, предоставляя интегрированное представление локальных данных со всех уровней иерархии конфигурации.
- Средство администрирования веб-сайта, которая позволяет управлять параметрами конфигурации для локальных и удаленных приложений, включая размещенные узлы.

API конфигурации ASP.NET состоит из набора объектов управления ASP.NET, которые можно использовать для программной настройки веб-сайтов и приложений. Объекты управления реализуются как библиотеки классов .NET Framework. Модель программирования API-Интерфейс настройки гарантирует согласованность и надежность кода с применением типов данных во время компиляции. Чтобы упростить управление конфигурациями приложений API конфигурации дает возможность просмотра данных, который создается объединением всех точек в иерархии конфигурации виде единой коллекции, вместо Просмотр данных в виде отдельных коллекций из разных файлы конфигурации. Кроме того API конфигурации позволяет управлять всей конфигурацией приложения без непосредственного редактирования XML-данные в файлах конфигурации. Наконец API упрощает задачи по настройке, поддержке административных средств, таких как средство администрирования веб-сайта. API конфигурации упрощает разработку за счет поддержки создания файлов конфигурации на компьютере и выполнения скриптов конфигурации на нескольких компьютерах.

> [!NOTE]
> Конфигурация API не поддерживает создание приложений IIS.


## <a name="working-with-local-and-remote-configuration-settings"></a>Работа с параметрами локальной и удаленной конфигурации

Объект конфигурации представляет объединенное представление параметры конфигурации, применяемые к определенной физической сущности, например компьютер, или логической сущности, например приложение или веб-сайта. Указанная логическая сущность может существовать на локальном компьютере или на удаленном сервере. Если файл конфигурации не существует для указанной сущности, объект конфигурации представляет параметры конфигурации по умолчанию, как определено в файле Machine.config.

Объект конфигурации можно получить с помощью одного из методов открыть конфигурацию из следующих классов:

1. Класс ConfigurationManager, если ваше учреждение — это клиентское приложение.
2. Класс WebConfigurationManager, если сущностью является веб-приложения.

Эти методы возвращают объект конфигурации, который в свою очередь предоставляет необходимые методы и свойства для обработки базовых файлов конфигурации. Можно получить доступ к этим файлам для чтения или записи.

### <a name="reading"></a>Чтение

Метод GetSection или GetSectionGroup позволяет считать сведения конфигурации. Пользователь или процесс, который считывает необходимо иметь разрешения на чтение всех файлов конфигурации в иерархии.

> [!NOTE]
> Если вы используете статический метод GetSection, который принимает параметр пути, параметр path должен ссылаться в приложение, в котором выполняется код. В противном случае параметр игнорируется, и возвращается информация о конфигурации для текущего выполняемого приложения.


### <a name="writing"></a>Запись

Вы можете использовать один из методов Save для записи сведений о конфигурации. Пользователь или процесс, который должен иметь запись записи разрешения на файл конфигурации и каталог на текущем уровне иерархии конфигурации, а также разрешения на чтение всех файлов конфигурации в иерархии.

Чтобы создать файл конфигурации, представляющий унаследованные параметры конфигурации для указанной сущности, используйте один из следующих методов сохранения конфигурации:

1. Метод Save, чтобы создать новый файл конфигурации.
2. Метод SaveAs для создания нового файла конфигурации в другом расположении.

## <a name="configuration-classes-and-namespaces"></a>Классы конфигурации и пространства имен

Многие классы и методы конфигурации похожи друг с другом. Ниже перечислены наиболее часто используемые конфигурации классы и пространства имен.

| **Класс конфигурации или пространство имен** | **Описание** |
| --- | --- |
| [System.Configuration](https://msdn.microsoft.com/library/system.configuration.aspx) пространства имен | Содержит классы основной конфигурации для всех приложений .NET Framework. Для получения данных конфигурации для раздела из методов, например GetSection и GetSectionGroup используются классы обработки. Эти два метода не являются статическими. |
| Класс System.Configuration.Configuration | Представляет набор данных конфигурации для компьютера, приложения, веб-каталога или других ресурсов. Этот класс содержит методы, такие как GetSection и GetSectionGroup, для обновления параметров конфигурации и получения ссылок на разделы и группы разделов. Этот класс используется в качестве возвращаемого типа для методов получения данных конфигурации времени разработки, например методы классов WebConfigurationManager и ConfigurationManager. |
| Пространство имен System.Web.Configuration | Содержит классы обработки разделов конфигурации ASP.NET, определенных в [параметры конфигурации ASP.NET](https://msdn.microsoft.com/library/b5ysx397.aspx). Для получения данных конфигурации для раздела из методов, например GetSection и GetSectionGroup используются классы обработки. |
| Класс System.Web.Configuration.WebConfigurationManager | Предоставляет методы для получения ссылки на параметры конфигурации времени выполнения и во время разработки. Эти методы используют класс System.Configuration.Configuration как тип возвращаемого значения. Статический метод GetSection этого класса или нестатический метод GetSection System.Configuration.ConfigurationManager класса можно использовать как взаимозаменяемые. Для конфигураций веб-приложений рекомендуется использовать класс System.Web.Configuration.WebConfigurationManager вместо класса System.Configuration.ConfigurationManager. |
| [System.Configuration.Provider](https://msdn.microsoft.com/library/system.configuration.provider.aspx) пространства имен | Предоставляет способ для настройки и расширения поставщика конфигурации. Это базовый класс для всех классов поставщиков в системе конфигурации. |
| [System.Web.Management](https://msdn.microsoft.com/library/system.web.management.aspx) пространства имен | Содержит классы и интерфейсы для управления и наблюдения за работоспособностью веб-приложений. Строго говоря это пространство имен не считаются частью API конфигурации. Например трассировка и запуск события достигается путем классы в этом пространстве имен. |
| [System.Management.Instrumentation](https://msdn.microsoft.com/library/system.management.instrumentation.aspx) пространства имен | Предоставляет классы, необходимые для инструментирования приложений для предоставления информации и событий посредством инструментария управления Windows (WMI) для потенциальных потребителей. Наблюдение за работоспособностью ASP.NET использует WMI для доставки событий. Строго говоря это пространство имен не считаются частью API конфигурации. |

## <a name="reading-from-aspnet-configuration-files"></a>Чтение из файлов конфигурации ASP.NET

Класс WebConfigurationManager является основным классом для чтения из файлов конфигурации ASP.NET. По сути из трех этапов для чтения файлов конфигурации ASP.NET:

1. Получите объект конфигурации, с помощью метода OpenWebConfiguration.
2. Получите ссылку на нужный раздел в файле конфигурации.
3. Чтение нужные сведения из файла конфигурации.

Конфигурации, который представляет объект не представляет определенного файла конфигурации. Вместо этого он представляет объединенное представление конфигурации компьютера, приложения или веб-сайта. В следующем образце кода создает объект конфигурации, представляющий конфигурацию веб-приложения вызывается *ProductInfo*.

[!code-csharp[Main](configuration-and-instrumentation/samples/sample1.cs)]

> [!NOTE]
> Обратите внимание, что если /ProductInfo путь не существует, приведенный выше код будет возвращать конфигурации по умолчанию, как указано в файле machine.config.


Получив объект конфигурации, можно затем использовать метод GetSection или GetSectionGroup для детализации в параметры конфигурации. Следующий пример возвращает ссылку на параметры олицетворения для приложения выше ProductInfo:

[!code-csharp[Main](configuration-and-instrumentation/samples/sample2.cs)]

## <a name="writing-to-aspnet-configuration-files"></a>Запись в файлы конфигурации ASP.NET

Как и чтение из файлов конфигурации, класс WebConfigurationManager — основным для записи в файлах конфигурации Asp.NET. Существуют три шага для записи в файлах конфигурации ASP.NET.

1. Получите объект конфигурации, с помощью метода OpenWebConfiguration.
2. Получите ссылку на нужный раздел в файле конфигурации.
3. Записывать нужные сведения из файла конфигурации, с помощью «сохранить» или «сохранить как метод.

Следующий код изменяет **Отладка** атрибут &lt;компиляции&gt; элемента значение false:

[!code-csharp[Main](configuration-and-instrumentation/samples/sample3.cs)]

При выполнении этого кода **Отладка** атрибут &lt;компиляции&gt; элемент будет иметь значение false для *webApp* в файле web.config.

## <a name="systemwebmanagement-namespace"></a>Пространство имен System.Web.Management

System.Web.Management пространство имен предоставляет классы и интерфейсы для управления и наблюдения за работоспособностью приложений ASP.NET.

Ведение журнала выполняется с помощью определения правило, которое связывает события с помощью поставщика. Правило определяет тип событий, которые отправляются в службу. Следующие базовые события доступны для входа:

| **WebBaseEvent** | Класс базовое событие для всех событий. Содержит необходимые свойства для всех событий, таких как код события, подробный код события, дату и время возникновения события, порядковый номер, сообщение о событии и сведения о событии. |
| --- | --- |
| **WebManagementEvent** | Класс базового событий для событий управления, таких как время существования приложения, запрос, ошибки и события аудита. |
| **WebHeartbeatEvent** | События, созданные приложением через равные интервалы, получать сведения о состоянии полезные среды выполнения. |
| **WebAuditEvent** | Базовый класс для событий аудита безопасности, которые используются для обозначения условий, таких как сбой авторизации, ошибка расшифровки *и т.д.* |
| **WebRequestEvent** | Базовый класс для всех событий информационное запроса. |
| **WebBaseErrorEvent** | Базовый класс для всех событий, указывающих условия ошибок. |

Типы поставщиков, доступных позволяют отправлять выходные данные событий в средстве просмотра событий, SQL Server, инструментария управления Windows (WMI) и адрес электронной почты. Предварительно настроенные поставщики и сопоставления событий уменьшить объем работы, необходимо получить выходные данные событий в журнал.

ASP.NET 2.0 использует журнал событий поставщика out-of--box для ведения журнала событий на основе доменов приложения, запуск и остановка, а также ведение журнала все необработанные исключения. Это помогает рассматриваются некоторые основные сценарии. Например предположим, что приложение создает исключение, но пользователь не сохраняет ошибки и вы не сможете воспроизвести. Правила по умолчанию журнал событий вы сможет собирать информацию исключения и стек, чтобы понять, какого рода ошибка произошла. Еще один пример применяется, если приложение теряет состояние сеанса. В этом случае можно просмотреть в журнале событий, чтобы определить ли перезапуск домена приложения, и почему домена приложения в первую очередь остановлена.

Кроме того система наблюдения за работоспособностью является расширяемой. Например можно определить пользовательские веб-события, их запуска в приложении и затем определите правила для отправки сведений о событии для поставщика, такого как ваш адрес электронной почты. Это позволяет легко связать инструментирования для поставщиков мониторинга работоспособности. Например может инициировать событие каждый раз, заказ обрабатывается и настроить правило, которое отправляет каждое событие в базу данных SQL Server. Кроме того, может также запускать событие, когда пользователь не сможет вход несколько раз подряд, а также настроить события для использования поставщиков по электронной почте.

Конфигурация для поставщиков по умолчанию и событий хранится в глобальном файле Web.config. Глобальный файл Web.config хранит все веб-параметры, которые были сохранены в файле Machine.config, в ASP.NET 1 x. Глобальный файл Web.config находится в следующем каталоге:

`%windir%\Microsoft.Net\Framework\v2.0.*\config\Web.config`

&lt;HealthMonitoring&gt; раздел глобальный файл Web.config содержит значение по умолчанию параметры конфигурации. Вы можете переопределить эти параметры или настроить собственные параметры, реализовав &lt;healthMonitoring&gt; раздел в файле Web.config для приложения.

&lt;HealthMonitoring&gt; раздел глобальный файл Web.config содержит следующие элементы:

| **поставщики** | Содержит поставщики для просмотра событий, WMI и SQL Server. |
| --- | --- |
| **eventMappings** | Содержит сопоставления для различных классов WebBase. Вы можете расширить этот список, при создании собственного класса событий. Создание собственного класса событий дает большей степенью детализации через поставщиков, которые отправки данных. Например можно настроить необработанные исключения отправки на SQL Server, при отправке электронной почты пользовательские события. |
| **правила** | Связывает eventMappings к поставщику. |
| **буферизация** | Используется с поставщиками SQL Server и электронной почты для определения часто записи на диск события поставщику. |

Ниже приведен пример кода из глобального файла Web.config.

[!code-xml[Main](configuration-and-instrumentation/samples/sample4.xml)]

## <a name="how-to-store-events-to-event-viewer"></a>Как хранить события в средство просмотра событий

Как упоминалось ранее, для ведения журнала событий поставщик событий средства просмотра настраивается автоматически в глобальном файле Web.config. По умолчанию на основе всех событий **WebBaseErrorEvent** и **WebFailureAuditEvent** регистрируются. Можно добавить дополнительные правила в журнал Дополнительные сведения в журнале событий. Например, если требуется записывать все события (*т. е.*, на основе каждого события **WebBaseEvent**), можно добавить следующее правило в файл Web.config:

[!code-xml[Main](configuration-and-instrumentation/samples/sample5.xml)]

Это правило будет связать **все события** события сопоставляются поставщик журнала событий. EventMapping и поставщика, включаются в глобальном файле Web.config.

## <a name="how-to-store-events-to-sql-server"></a>Как хранить события в SQL Server

Этот метод использует **ASPNETDB** базы данных, созданный программой Aspnet\_regsql.exe средство. Поставщик по умолчанию используется строка подключения LocalSqlServer, которая использует либо файловое базу данных в приложении\_папку данных или локальный экземпляр SQLExpress для SQL Server. Строка подключения LocalSqlServer и SqlProvider настраиваются в глобальном файле Web.config.

Строка подключения LocalSqlServer в глобальном файле Web.config выглядит следующим образом:

[!code-xml[Main](configuration-and-instrumentation/samples/sample6.xml)]

Если вы хотите использовать другой экземпляр SQL Server, необходимо использовать Aspnet\_regsql.exe средство, которое можно найти в % windir%\Microsoft.Net\Framework\v2.0.\* папки. Использовать Aspnet\_regsql.exe средство для создания пользовательского **ASPNETDB** базы данных на экземпляре SQL Server, а затем добавьте строку подключения в файле конфигурации приложения и добавьте поставщика с помощью нового Строка подключения. При наличии **ASPNETDB** создания базы данных, вам потребуется установить правило, чтобы связать eventMapping sqlProvider.

Используйте значение по умолчанию SqlProvider или настроить собственный поставщик, необходимо добавить правило, поставщик с картой событий связывания. Следующее правило связывает новый поставщик, созданный выше **все события** схема событий. Это правило будет записывать все события, на основе **WebBaseEvent** и их отправку MySqlWebEventProvider, который будет использовать строку подключения MYASPNETDB. Следующий код добавляет правило для связывания поставщика с картой событий:

[!code-xml[Main](configuration-and-instrumentation/samples/sample7.xml)]

Если вы хотите отправлять ошибки в SQL Server, можно добавить следующее правило:

[!code-xml[Main](configuration-and-instrumentation/samples/sample8.xml)]

## <a name="how-to-forward-events-to-wmi"></a>Как перенаправить события WMI

Также вы можете направлять события в WMI. Поставщик WMI, настроенных для вас в глобальный файл Web.config по умолчанию.

В следующем примере кода добавляется правило для пересылки событий WMI:

[!code-xml[Main](configuration-and-instrumentation/samples/sample9.xml)]

Необходимо добавить правило, чтобы связать eventMapping для поставщика, а также прослушиватель для прослушивания событий WMI. В следующем примере кода добавляется правило для связывания поставщика WMI для **все события** схема событий:

[!code-xml[Main](configuration-and-instrumentation/samples/sample10.xml)]

## <a name="how-to-forward-events-to-email"></a>Как перенаправить события на адрес электронной почты

Можно также передавать события к электронной почте. Соблюдайте осторожность какие правила события сопоставляются поставщика электронной почты, как можно случайно отправить себе массу информации, возможно, лучше всего подходят для SQL Server или журнале событий. Существует два поставщика электронной почты; SimpleMailWebEventProvider и TemplatedMailWebEventProvider. Каждый имеет те же атрибуты конфигурации, за исключением «шаблон» и «detailedTemplateErrors» атрибуты, которые доступны только на TemplatedMailWebEventProvider.

> [!NOTE]
> Ни один из этих поставщиков электронной почты настраивается автоматически. Необходимо добавить их в файл Web.config.


Основное различие между поставщиками два сообщения электронной почты является то, что SimpleMailWebEventProvider отправляет сообщения электронной почты в универсальный шаблон, который не может быть изменен. Пример файла Web.config добавляет этот поставщик электронной почты в список настроенных поставщиков, используя следующее правило:

[!code-xml[Main](configuration-and-instrumentation/samples/sample11.xml)]

Чтобы связать службу электронной почты, чтобы также добавляется следующее правило **все события** схема событий:

[!code-xml[Main](configuration-and-instrumentation/samples/sample12.xml)]

## <a name="aspnet-20-tracing"></a>ASP.NET 2.0 трассировки

Существуют три основные усовершенствования трассировки в ASP.NET 2.0.

1. Функции интегрированной трассировки.
2. Программный доступ к сообщения трассировки
3. Улучшенная трассировка на уровне приложения

## <a name="integrated-tracing-functionality"></a>Функции интегрированной трассировки.

Теперь можно направить сообщения классом System.Diagnostics.Trace для ASP.NET, выходные данные трассировки и маршрутизации сообщений трассировки ASP.NET для System.Diagnostics.Trace. Кроме того, вы можете направлять события инструментария ASP.NET в System.Diagnostics.Trace. Эта функциональность обеспечивается по новому **writeToDiagnosticsTrace** атрибут &lt;трассировки&gt; элемент. При этом логическое значение равно true, сообщения трассировки ASP.NET, перенаправляются System.Diagnostics инфраструктуры для использования прослушивателями, которые зарегистрированы для отображения сообщений трассировки.

## <a name="programmatic-access-to-trace-messages"></a>Программный доступ к сообщения трассировки

Обеспечивает программный доступ ко всем сообщениям трассировки с помощью ASP.NET 2.0 **TraceContextRecord** класс и **TraceRecords** коллекции. Наиболее эффективный способ доступа к сообщения трассировки является регистрация **TraceContextEventHandler** делегат (еще одна новая возможность в ASP.NET 2.0) для обработки нового **TraceFinished** событий. Затем можно перебирать сообщения трассировки по своему усмотрению.

Это показано в следующем образце кода:

[!code-csharp[Main](configuration-and-instrumentation/samples/sample13.cs)]

В приведенном выше примере я циклический перебор коллекции TraceRecords и затем записывать каждое сообщение в поток ответа.

## <a name="improved-application-level-tracing"></a>Улучшенная трассировка на уровне приложения

Трассировку на уровне приложения повышается через общие сведения о новой **mostRecent** атрибут &lt;трассировки&gt; элемент. Этот атрибут указывает, отображаются последние данные трассировки на уровне приложения и выходят за установленные пределы, которые обозначаются requestLimit старые данные удаляются. Если значение равно false, данные трассировки отображаются для запросов до достижения requestLimit атрибута.

## <a name="aspnet-command-line-tools"></a>Средства командной строки ASP.NET

Существует несколько средств командной строки для упрощения конфигурации ASP.NET. Разработчики ASP.NET должны быть знакомы с aspnet\_regiis.exe средство. ASP.NET 2.0 предоставляет три средств, помогающих в конфигурации.

Доступны следующие средства командной строки:

| **Средство** | **Использовать** |
| --- | --- |
| **aspnet\_regiis.exe** | Позволяет зарегистрировать ASP.NET со службами IIS. Существует две версии этого средства, которые входят в состав ASP.NET 2.0: для 32-разрядных систем (в папке Framework) и для 64-разрядных систем (в папке Framework64.) 64-разрядной версии не будут устанавливаться на 32-разрядной операционной системе. |
| **aspnet\_regsql.exe** | Средство регистрации ASP.NET SQL Server используется для создания базы данных Microsoft SQL Server для использования с поставщиками SQL Server в ASP.NET, добавить или удалить параметры из существующей базы данных. Aspnet\_regsql.exe файл находится в папке «[drive:]\WINDOWS\Microsoft.NET\Framework\versionNumber» на веб-сервере. |
| **aspnet\_regbrowsers.exe** | Средство регистрации браузера ASP.NET выполняет синтаксический анализ и компилирует все определения браузера на уровне системы в сборку и устанавливает сборку в глобальный кэш сборок. Средство использует файлы описания браузеров (. Файлы БРАУЗЕРА) из подкаталога браузеры .NET Framework. Это средство можно найти в каталоге %SystemRoot%\Microsoft.NET\Framework\version\. |
| **ASPNET\_compiler.exe** | Средство компиляции ASP.NET позволяет компилировать веб-приложения ASP.NET, на месте или для развертывания в целевом расположении, например на рабочем сервере. Компиляции на месте позволяет повысить производительность приложения, так как конечные пользователи не вызывает проблем, задержка при первом запросе к приложению во время компиляции приложения. |

Поскольку aspnet\_regiis.exe средство не является новым для ASP.NET 2.0, мы не буду обсуждать его здесь.

## <a name="aspnet-sql-server-registration-tool---aspnetregsqlexe"></a>Средство регистрации сервера ASP.NET SQL - aspnet\_regsql.exe

Можно задать несколько типов параметров, с помощью средства регистрации ASP.NET SQL Server. Можно указать подключение SQL, указать, какие службы приложений ASP.NET использовать SQL Server для управления информацией, указать, какие базы данных или таблицы используются для зависимости кэша SQL и добавить или удалить поддержку с помощью SQL Server для хранения процедур и состояния сеанса.

Несколько служб приложения ASP.NET используют поставщик для управления, хранения и извлечения данных из источника данных. Каждый поставщик относится только к источнику данных. ASP.NET содержит поставщик SQL Server для следующих возможностей ASP.NET:

- Членство ( [SqlMembershipProvider](https://msdn.microsoft.com/library/system.web.security.sqlmembershipprovider.aspx) класса).
- Управление ролями ( [SqlRoleProvider](https://msdn.microsoft.com/library/system.web.security.sqlroleprovider.aspx) класса).
- Профиль ( [SqlProfileProvider](https://msdn.microsoft.com/library/system.web.profile.sqlprofileprovider.aspx) класса).
- Персонализация веб-частей ( [SqlPersonalizationProvider](https://msdn.microsoft.com/library/system.web.ui.webcontrols.webparts.sqlpersonalizationprovider.aspx) класса).
- Веб-событий ( [SqlWebEventProvider](https://msdn.microsoft.com/library/system.web.management.sqlwebeventprovider.aspx) класса).

При установке ASP.NET, файл Machine.config для сервера включает элементы конфигурации, определяющие поставщиков SQL Server для каждой функции ASP.NET, которые зависят от поставщика. Эти поставщики настроены по умолчанию, чтобы подключиться к экземпляру SQL Server Express 2005 локального пользователя. Если изменить строку подключения по умолчанию, используемые поставщиками, затем перед использованием функциями ASP.NET, настроенными в конфигурации компьютера, необходимо установить базу данных SQL Server и элементы базы данных для выбранного компонента с помощью Aspnet\_regsql.exe. Если в базе данных, указанный с помощью инструмента регистрации SQL еще не существует (aspnetdb будет базы данных по умолчанию, если тип не задан в командной строке), то текущий пользователь должен иметь права на создание баз данных в SQL Server и создать схемы e элементам в базе данных.

### <a name="sql-cache-dependency"></a>Зависимость кэша SQL

Дополнительной возможностью кэширования выходных данных ASP.NET является зависимость кэша SQL. Зависимость кэша SQL поддерживает два разных режима работы: один, который использует реализацию ASP.NET опроса таблицы, а втором режиме, который использует функции уведомления о запросах SQL Server 2005. Средство регистрации SQL можно использовать для настройки режима опроса таблиц операции.

### <a name="session-state"></a>Состояние сеанса

По умолчанию значения состояния сеанса и сведения хранятся в памяти в процессе ASP.NET. Кроме того можно хранить данные сеанса в базе данных SQL Server, где его можно использовать совместно с нескольких веб-серверов. Если базе данных, выбранном для состояния сеанса с помощью средства регистрации SQL еще не существует, то текущий пользователь должен иметь права на создание баз данных в SQL Server, а также создание элементов схемы в базе данных. Если база данных существует, то текущий пользователь должен иметь права на создание элементов схемы в существующей базе данных.

Чтобы установить базы данных состояния сеанса на сервере SQL Server, запустите Aspnet\_regsql.exe средство и укажите следующие сведения с помощью команды:

- Имя сервера SQL Server экземпляра, с помощью **-S** параметр.
- Учетные данные для входа для учетной записи, имеющей разрешение на создание базы данных на компьютере под управлением SQL Server. Используйте **-E** используется имя пользователя, вошедшего в систему, или воспользоваться **- U** параметр, чтобы указать идентификатор пользователя вместе с **-P** параметр, чтобы указать пароль.
- **- Ssadd** параметр командной строки для добавления базы данных состояния сеанса.

По умолчанию нельзя использовать Aspnet\_regsql.exe средство для установки базы данных состояния сеанса на компьютере под управлением SQL Server 2005 Express Edition.

### <a name="the-aspnet-browser-registration-tool---aspnetregbrowsersexe"></a>Средство регистрации ASP.NET браузера - aspnet\_regbrowsers.exe

В ASP.NET версии 1.1, файл Machine.config содержится раздел &lt;browserCaps&gt;. В этом разделе содержится ряд записей XML, определенные настройки для различных обозревателей на основе регулярного выражения. Для ASP.NET версии 2.0 новый. Файл БРАУЗЕРА определяет параметры того или иного браузера, с помощью записи XML. Добавьте сведения о новом окне браузера, добавив новое. Файл БРАУЗЕРА к папке, расположенный %SystemRoot%\Microsoft.NET\Framework\version\CONFIG\Browsers в вашей системе.

Поскольку приложение не выполняет чтение файла .config каждый раз, он требует, чтобы информация для браузера, можно создать новый. Файл БРАУЗЕРА и выполнения Aspnet\_regbrowsers.exe для добавления необходимых изменений к сборке. Это позволит серверу мгновенно получить доступ к новым данным обозревателя, необходимо завершить работу каких-либо приложений для получения сведений. Приложение может получать доступ к возможностей браузера через свойство браузера текущего HttpRequest.

Следующие параметры доступны при выполнении aspnet\_regbrowser.exe:

| **Параметр** | **Описание** |
| --- | --- |
| **-?** | Отображает Aspnet\_regbbrowsers.exe текст справки в окне командной строки. |
| **-i** | Создает сборку возможностей обозревателя среды выполнения и устанавливает ее в глобальный кэш сборок. |
| **-u** | Удаляет сборку возможностей браузера среды выполнения из глобального кэша сборок. |

## <a name="the-aspnet-compilation-tool---aspnetcompilerexe"></a>Средство компиляции ASP.NET - aspnet\_compiler.exe

Средство компиляции ASP.NET можно использовать двумя способами: для компиляции на месте и компиляции для развертывания, где указан целевой выходной каталог.

### [<a name="compiling-an-application-in-place"></a>Компиляция приложения на месте](https://msdn.microsoft.com/library/ms229863.aspx)

Средство компиляции ASP.NET можно компилировать приложение на месте, то есть он имитирует поведение выполнения нескольких запросов к приложению, что приводит к обычной компиляции. Пользователи предварительно скомпилированного сайта не столкнется с задержкой, вызвано компиляцией страницы при первом запросе.

При предварительной компиляции узла на месте, применяются следующие элементы:

- Узел сохраняет его структуру файлов и каталогов.
- Необходимо наличие компиляторов для всех языков программирования, используемый узлом на сервере.
- Если происходит сбой компиляции любого файла, компиляция завершается всего сайта.

Также можно перекомпилировать приложение на месте после добавления новых исходных файлов в него. Средство компилирует только новые или измененные файлы, если не включить **- c** параметр.

> [!NOTE]
> Компиляция приложения, содержащего вложенные приложение не компилируется вложенного приложения. Вложенного приложения должны быть скомпилированы отдельно.


### [<a name="compiling-an-application-for-deployment"></a>Компиляция приложения для развертывания](https://msdn.microsoft.com/library/ms229863.aspx)

С помощью параметра targetDir компилировать приложение для развертывания (компиляция в целевом расположении). TargetDir может быть конечное расположение для веб-приложения или скомпилированное приложение может быть развернуто Далее. С помощью **-u** компилирует приложение таким образом, можно внести изменения к некоторым файлам в скомпилированном приложении без перекомпиляции. ASPNET\_compiler.exe различает статические и динамические типы файлов и обрабатывает их по-разному при создании результирующего приложения.

- Статические типы файлов — это те, которые не имеют связанного компилятора или поставщика компоновки, таких как файлы, именованный имеют расширения, такие как .css, .gif, .htm, .html, .jpg, .js и т. д. Эти файлы просто копируются в целевое расположение, с помощью относительных мест в структуре каталогов.
- Динамические типы файлов — те, которые имеют связанный компилятор или поставщик компоновки, включая файлы с расширениями имен файлов относящиеся к ASP.NET, например .asax, .ascx, .ashx, .aspx, с расширением BROWSER, master и т. д. Средство компиляции ASP.NET создает сборки из этих файлов. Если **-u** параметр указан, средство также создает файлы с расширением имени файла. COMPILED, сопоставить исходные файлы для своей сборки. Чтобы убедиться, что структура каталогов источника приложения сохраняется, инструмент создает файлы заполнителя в соответствующих расположениях в целевом приложении.

Необходимо использовать **-u** параметр, чтобы указать, что содержимое скомпилированное приложение может быть изменено. В противном случае последующие изменения учитываются или привести к ошибкам во время выполнения.

В следующей таблице описаны как другой файл дескрипторы средства компиляции ASP типов при **-u** параметр включен.

| **Тип файла** | **Действие компилятора** |
| --- | --- |
| .ascx, .aspx, .master | Эти файлы разделены на разметку и исходный код, который включает в себя файлы с выделенным кодом и любой код, заключенный в &lt;скрипт runat = «server»&gt; элементов. Исходный код компилируется в сборки, имена которых получены с помощью алгоритма хэширования и сборки размещаются в каталоге Bin. Любой встроенный код, то есть, код заключенные между **&lt; %** и **% &gt;** квадратные скобки, входит в состав разметки и не компилируются. Новые файлы с тем же именем, что и исходные файлы создаются для содержания разметки и помещаются в соответствующие папки выходных данных. |
| .ashx, .asmx | Эти файлы не компилируются и перемещаются в выходные каталоги, как и без компиляции. Если вы хотите иметь компилировать код обработки, поместите его в файлы исходного кода в приложении\_каталог кода. |
| .cs, .vb, расширением JSL, .cpp (не включая файлы с выделенным кодом для типов файлов, перечисленных выше) | Эти файлы компилируются и включаются в качестве ресурсов в сборках, которые на них ссылаются. Исходные файлы не копируются в выходной каталог. Если не ссылка на файл кода, он не компилируется. |
| Пользовательских типов файлов | Эти файлы не компилируются. Эти файлы копируются в соответствующие каталоги выходных данных. |
| Файлы исходного кода в приложении\_подкаталога для кода | Эти файлы компилируются в сборки и размещаются в каталоге Bin. |
| файлы RESX и Resource в приложении\_подкаталог GlobalResources | Эти файлы компилируются в сборки и размещаются в каталоге Bin. Приложение не\_GlobalResources подкаталог создается в каталоге основного выходного файла, а не файлы RESX или RESOURCES, расположенные в исходном каталоге копируются выходные каталоги. |
| файлы RESX и Resource в приложении\_подкаталог LocalResources | Эти файлы не компилируются и копируются в соответствующие каталоги выходных данных. |
| файлы обложки в приложении\_подкаталог темы | Файлы обложки и темы, статические файлы не компилируются и копируются в соответствующие каталоги выходных данных. |
| с расширением BROWSER файл Web.config статические типы сборок, уже присутствующего в каталоге Bin | Эти файлы копируются, так как выходные каталоги. |

В следующей таблице описаны как другой файл дескрипторы средства компиляции ASP типов при **-u** опущен параметр.

| **Тип файла** | **Действие компилятора** |
| --- | --- |
| .aspx, .asmx, .ashx, .master | Эти файлы разделены на разметку и исходный код, который включает в себя файлы с выделенным кодом и любой код, заключенный в &lt;скрипт runat = «server»&gt; элементов. Исходный код компилируется в сборки, имена которых получены с помощью алгоритма хэширования. Полученные сборки размещаются в каталоге Bin. Любой встроенный код, то есть, код заключенные между **&lt; %** и **% &gt;** квадратные скобки, входит в состав разметки и не компилируются. Компилятор создает новые файлы для содержания разметки с тем же именем, что и исходные файлы. Эти итоговые файлы помещаются в каталог Bin. Компилятор также создает файлы с тем же именем, что и исходные файлы, но с расширением. COMPILED, содержат сведения о сопоставлении. . СКОМПИЛИРОВАННЫЕ файлы помещаются в выходные каталоги, соответствующий в исходное расположение исходных файлов. |
| .ascx | Эти файлы разбиваются на разметку и исходный код. Исходный код компилируется в сборки и размещаются в каталоге Bin с именами, которые являются производными от хэш-алгоритма. Файлы разметки не создаются. |
| .cs, .vb, расширением JSL, .cpp (не включая файлы с выделенным кодом для типов файлов, перечисленных выше) | Исходный код, на который ссылается сборкам, созданным из .ascx, .ashx или ASPX-файлы компилируются в сборки и поместить в каталог Bin. Исходные файлы не копируются. |
| Пользовательских типов файлов | Эти файлы компилируются как динамические. В зависимости от типа файла, в которых они основаны компилятор может разместить файлы сопоставления в выходные каталоги. |
| Файлы в приложении\_подкаталога для кода | Файлы исходного кода в этом подкаталоге компилируются в сборки и помещается в каталог Bin. |
| Файлы в приложении\_подкаталог GlobalResources | Эти файлы компилируются в сборки и размещаются в каталоге Bin. Приложение не\_GlobalResources подкаталог создается в каталоге основного выходного файла. Если в файле конфигурации указываются appliesTo = «Все», resx- и RESOURCES-файлы будут копироваться выходные каталоги. Они не копируются, если они ссылаются [BuildProvider](https://msdn.microsoft.com/library/system.web.configuration.buildprovider.aspx). |
| файлы RESX и Resource в приложении\_подкаталог LocalResources | Эти файлы компилируются в сборки с уникальными именами и размещаются в каталоге Bin. Отсутствуют файлы RESX или Resource копируются выходные каталоги. |
| файлы обложки в приложении\_подкаталог темы | Темы компилируются в сборки и помещается в каталог Bin. Файлы заглушки создаются для файлы обложки и помещается в соответствующий каталог выходных данных. Статические файлы (например, .css) копируются в выходные каталоги. |
| с расширением BROWSER файл Web.config статические типы сборок, уже присутствующего в каталоге Bin | Эти файлы копируются, так как в выходной каталог. |

### [<a name="fixed-assembly-names"></a>Фиксированные имена сборок](https://msdn.microsoft.com/library/ms229863.aspx##)

Некоторые сценарии, такие как развертывание веб-приложения с помощью установщика Windows MSI, требуют использования согласованных имен файлов и содержимое, а также согласованных структур каталогов для определения сборки или параметры конфигурации для обновления. В таких случаях можно использовать **- fixednames** параметр, чтобы указать, что средство компиляции ASP.NET должен компилировать сборку для каждого исходного файла, вместо использования where несколько страниц, компилируются в сборки. Это может привести к большое число сборок, поэтому если вы беспокоитесь с масштабируемостью, этот параметр следует использовать с осторожностью.

### [<a name="strong-name-compilation"></a>Компиляция с использованием строгого имени](https://msdn.microsoft.com/library/ms229863.aspx##)

**- Aptca**, **- delaysign**, **- keycontainer** и **- keyfile** предоставляются параметры, которые можно использовать Aspnet\_ Compiler.exe создавать строго с именем сборки без использования [средство строгих имен (Sn.exe)](https://msdn.microsoft.com/library/k5b5tt23.aspx) отдельно. Эти параметры соответствуют свойствам, соответственно, чтобы **AllowPartiallyTrustedCallersAttribute**, **AssemblyDelaySignAttribute**, **AssemblyKeyNameAttribute**и  **AssemblyKeyFileAttribute**.

Обсуждение этих атрибутов находится за пределами этого курса.

## <a name="labs"></a>Лабораторные занятия

Каждый из следующих labs лежит предыдущего занятия. Необходимо будет выполнить их последовательно.

## <a name="lab-1-using-the-configuration-api"></a>Практическое занятие 1. С помощью API конфигурации

1. Создайте новый веб-сайт, который называется *mod9lab*.
2. Добавьте новый файл веб-конфигурации к узлу.
3. Добавьте следующую строку в файл web.config:


[!code-xml[Main](configuration-and-instrumentation/samples/sample14.xml)]

Это гарантирует, что имеется разрешение на сохранение изменений в файл web.config.

1. Добавление нового элемента управления Label к странице Default.aspx и измените идентификатор на **lblDebugStatus**.
2. Добавление нового элемента управления кнопки к странице Default.aspx.
3. Изменение идентификатора элемента управления Button для **btnToggleDebug** и текст, который **отладка/открепить**.
4. Откройте представление кода для кода в файл Default.aspx и добавьте **с помощью** инструкции для **System.Web.Configuration** следующим образом:


[!code-csharp[Main](configuration-and-instrumentation/samples/sample15.cs)]

1. Добавьте две закрытых переменных к классу и страницей\_метод Init, как показано ниже:


[!code-csharp[Main](configuration-and-instrumentation/samples/sample16.cs)]

1. Добавьте следующий код к странице\_нагрузки:


[!code-csharp[Main](configuration-and-instrumentation/samples/sample17.cs)]

1. Сохраните и обзор default.aspx. Обратите внимание на то, что элемент управления Label отображает текущее состояние отладки.
2. Дважды щелкните элемент управления в конструктор и добавьте следующий код для события нажатия для кнопки:


[!code-csharp[Main](configuration-and-instrumentation/samples/sample18.cs)]

1. Сохраните и обзор default.aspx и нажмите кнопку.
2. Откройте файл web.config после каждой кнопки, нажмите кнопку и просмотрите **Отладка** атрибут в &lt;компиляции&gt; раздел.

## <a name="lab-2-logging-application-restarts"></a>Лабораторное занятие 2. Ведение журнала повторного запуска приложения

В этой лабораторной работе будет создан код, который позволит вам регистрацию завершения работы приложения, начинающих компаний и перекомпиляции в средстве просмотра событий.

1. Добавление элемента управления DropDownList к странице default.aspx и измените идентификатор на ddlLogAppEvents.
2. Задайте **AutoPostBack** свойства для элемента управления DropDownList для **true**.
3. Добавьте три элемента в коллекцию элементов для элемента управления DropDownList. Сделать **текст** для первого элемента *Select Value* и значение -1. Сделать **текст** и **значение** второго элемента **True** и **текст** и **значение** третьего элемента **False**.
4. Добавьте новую метку к странице default.aspx. Измените идентификатор на **lblLogAppEvents**.
5. Откройте представление кода для default.aspx и добавьте нового объявления для переменной типа HealthMonitoringSection, как показано ниже:


[!code-csharp[Main](configuration-and-instrumentation/samples/sample19.cs)]

1. Добавьте следующий код в существующий код на странице\_Init:


[!code-csharp[Main](configuration-and-instrumentation/samples/sample20.cs)]

1. Дважды щелкните DropDownList и добавьте следующий код в событие SelectedIndexChanged:


[!code-csharp[Main](configuration-and-instrumentation/samples/sample21.cs)]

1. Обзор default.aspx.
2. Значение раскрывающегося списка **False**.
3. Очистите журнал приложений в средстве просмотра событий.
4. Нажмите кнопку, чтобы изменить атрибут отладки для приложения.
5. Обновите журнал приложения в средстве просмотра событий. 

    1. Зарегистрированные события?
    2. Почему или почему нет?
6. Значение раскрывающегося списка **значение True.**
7. Нажмите кнопку для переключения атрибута отладки для приложения.
8. Обновите имя входа приложения средство просмотра событий. 

    1. Зарегистрированные события?
    2. Какова причина завершения работы приложения?
9. Поэкспериментируйте с Включение и выключение ведения журнала и просмотрите изменения, внесенные в файл web.config.

## <a name="more-information"></a>Дополнительные сведения:

ASP.NET 2.0 поставщик модели позволяет создавать собственные поставщики, не только для инструментирования приложений, но для многих других целей также например членства, профилей и т. д. Подробные сведения о создании пользовательского поставщика в журнал событий приложения в текстовый файл, см. в статье [эту ссылку](https://msdn.microsoft.com/library/default.asp?url=/library/dnaspp/html/ASPNETProvMod_Prt6.asp).
