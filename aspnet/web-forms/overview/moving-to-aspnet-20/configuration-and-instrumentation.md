---
uid: web-forms/overview/moving-to-aspnet-20/configuration-and-instrumentation
title: Конфигурация и инструментирование Документы Майкрософт
author: rick-anderson
description: В ASP.NET 2.0 произошли значительные изменения в конфигурации и приборах. Новый API конфигурации ASP.NET позволяет вносить изменения конфигурации pr...
ms.author: riande
ms.date: 02/20/2005
ms.assetid: 21ebbaee-7ed8-45ae-b6c1-c27c88342e48
msc.legacyurl: /web-forms/overview/moving-to-aspnet-20/configuration-and-instrumentation
msc.type: authoredcontent
ms.openlocfilehash: 30ea2ffd3d055c5373a33615bc19a8f68fb568ab
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2020
ms.locfileid: "81543058"
---
# <a name="configuration-and-instrumentation"></a>Конфигурация и инструментирование

[корпорацией Майкрософт](https://github.com/microsoft)

> В ASP.NET 2.0 произошли значительные изменения в конфигурации и приборах. Новый API конфигурации ASP.NET позволяет осуществлять программные изменения конфигурации. Кроме того, многие новые настройки конфигурации позволяют новые конфигурации и приборы.

В ASP.NET 2.0 произошли значительные изменения в конфигурации и приборах. Новый API конфигурации ASP.NET позволяет осуществлять программные изменения конфигурации. Кроме того, многие новые настройки конфигурации позволяют новые конфигурации и приборы.

В этом модуле мы обсудим ASP.NET API конфигурации, как это относится к чтению и записи в ASP.NET файлов конфигурации, и мы также рассмотрим ASP.NET приборы. Мы также рассмотрим новые функции, доступные в ASP.NET отслеживания.

## <a name="aspnet-configuration-api"></a>API ASP.NET конфигурации

API ASP.NET конфигурации позволяет разрабатывать, развертывать и управлять данными конфигурации приложений с помощью единого интерфейса программирования. Можно использовать API конфигурации для разработки и изменения полных ASP.NET конфигураций программно без непосредственного редактирования XML в файлах конфигурации. Кроме того, вы можете использовать API конфигурации в консольных приложениях и скриптах, которые вы разрабатываете, в веб-инструментах управления и в привязках Microsoft Management Console (MMC).

Следующие два инструмента управления конфигурацией используют API конфигурации и включены в версию .NET Framework 2.0:

- В ASP.NET MMC snap-in, который использует API конфигурации для упрощения административных задач, обеспечивая интегрированное представление данных локальной конфигурации со всех уровней иерархии конфигурации.
- Инструмент администрирования веб-узла, который позволяет управлять настройками конфигурации для локальных и удаленных приложений, включая размещенные сайты.

API конфигурации ASP.NET включает в себя набор объектов управления ASP.NET, которые можно использовать для настройки веб-сайтов и приложений в программном порядке. Объекты управления реализованы в виде библиотеки класса .NET Framework. Модель программирования API конфигурации помогает обеспечить согласованность и надежность кода, применяя типы данных во время компиляции. Чтобы упростить управление конфигурациями приложений, API конфигурации позволяет просматривать данные, которые объединены со всех точек иерархии конфигурации, в единую коллекцию, вместо того, чтобы просматривать данные как отдельные коллекции из разных файлов конфигурации. Кроме того, API конфигурации позволяет манипулировать всей конфигурацией приложений без непосредственного редактирования XML в файлах конфигурации. Наконец, API упрощает задачи конфигурации, поддерживая административные инструменты, такие как инструмент администрирования веб-узла. API конфигурации упрощает развертывание, поддерживая создание файлов конфигурации на компьютере и запуск скриптов конфигурации на нескольких компьютерах.

> [!NOTE]
> API конфигурации не поддерживает создание приложений IIS.

## <a name="working-with-local-and-remote-configuration-settings"></a>Работа с настройками локальной и удаленной конфигурации

Объект конфигурации представляет собой объединенное представление параметров конфигурации, которые применяются к определенной физической сущности, например компьютеру, или к логической сущности, такой как приложение или веб-узел. Указанная логическая сущность может существовать на локальном компьютере или на удаленном сервере. Когда для указанной сущности файл конфигурации не существует, объект конфигурации представляет параметры конфигурации по умолчанию, определенные файлом Machine.config.

Объект конфигурации можно получить, используя один из методов открытой конфигурации из следующих классов:

1. Класс ConfigurationManager, если ваша сущность является клиентским приложением.
2. Класс WebConfigurationManager, если ваша сущность является веб-приложением.

Эти методы вернут объект конфигурации, который, в свою очередь, предоставляет необходимые методы и свойства для обработки базовых файлов конфигурации. Вы можете получить доступ к этим файлам для чтения или записи.

### <a name="reading"></a>Чтение

Для чтения информации о конфигурации используется метод GetSection или GetSectionGroup. Пользователь или считыватель должен иметь разрешения на чтение всех файлов конфигурации в иерархии.

> [!NOTE]
> Если вы используете статический метод GetSection, который принимает параметр пути, параметр пути должен относиться к приложению, в котором работает код. В противном случае параметр игнорируется и информация о конфигурации для работаемого в настоящее время приложения возвращается.

### <a name="writing"></a>Запись

Для записи информации о конфигурации используется один из методов сохранения. Пользователь или процесс, который пишет, должен иметь разрешения на запись в файле конфигурации и каталоге на текущем уровне иерархии конфигурации, а также разрешения на чтение всех файлов конфигурации в иерархии.

Для создания файла конфигурации, представляющего параметры наследуемой конфигурации для указанной сущности, используйте один из следующих методов сохранения конфигурации:

1. Метод сохранения для создания нового файла конфигурации.
2. Метод SaveAs для создания нового файла конфигурации в другом месте.

## <a name="configuration-classes-and-namespaces"></a>Классы конфигурации и области имен

Многие классы конфигурации и методы похожи друг на друга. В следующей таблице описаны наиболее часто используемые классы конфигурации и области имен.

| **Класс конфигурации или пространство имен** | **Описание** |
| --- | --- |
| Пространство имен [System.Configuration](https://msdn.microsoft.com/library/system.configuration.aspx) | Содержит основные классы конфигурации для всех приложений .NET Framework. Классы обработчиков секций используются для получения данных конфигурации для раздела из таких методов, как GetSection и GetSectionGroup. Эти два метода не являются статичными. |
| Класс System.Configuration.Configuration | Представляет набор данных конфигурации для компьютера, приложения, веб-каталога или другого ресурса. Этот класс содержит полезные методы, такие как GetSection и GetSectionGroup, для обновления настроек конфигурации и получения ссылок на разделы и группы разделов. Этот класс используется в качестве типа возврата для методов, которые получают данные конфигурации времени проектирования, такие как методы классов WebConfigurationManager и ConfigurationManager. |
| Пространство имен System.Web.Configuration | Содержит классы обработчика разделов для разделов конфигурации ASP.NET, определенных в [ASP.NET настройках конфигурации.](https://msdn.microsoft.com/library/b5ysx397.aspx) Классы обработчиков секций используются для получения данных конфигурации для раздела из таких методов, как GetSection и GetSectionGroup. |
| Класс System.Web.Configuration.WebConfigurationManager | Предоставляет полезные методы для получения ссылок на настройки конфигурации времени выполнения и проектирования. Эти методы используют класс System.Configuration.Configuration в качестве типа возврата. Вы можете использовать статический метод GetSection этого класса или нестатический метод GetSection класса System.Configuration.ConfigurationManager. Для конфигураций веб-приложений класс System.Web.Configuration.ConfigurationManager рекомендуется посещать класс System.Configuration.ConfigurationManager. |
| Пространство имен [System.Configuration.Provider](https://msdn.microsoft.com/library/system.configuration.provider.aspx) | Предоставляет способ настройки и расширения поставщика конфигурации. Это базовый класс для всех классов поставщиков в системе конфигурации. |
| Пространство имен [System.Web.Management](https://msdn.microsoft.com/library/system.web.management.aspx) | Содержит классы и интерфейсы для управления и мониторинга работоспособности веб-приложений. Строго говоря, это пространство имен не считается частью API конфигурации. Например, отслеживание и стрельба событиями осуществляется классами в этом пространстве имен. |
| Пространство имен [System.Management.Instrumentation](https://msdn.microsoft.com/library/system.management.instrumentation.aspx) | Предоставляет классы, необходимые для приборов приложений, чтобы разоблачить их управленческую информацию и события через инструмент управления Windows (WMI) для потенциальных потребителей. ASP.NET мониторинг здоровья использует WMI для проведения мероприятий. Строго говоря, это пространство имен не считается частью API конфигурации. |

## <a name="reading-from-aspnet-configuration-files"></a>Чтение файлов конфигурации ASP.NET

Класс WebConfigurationManager является основным классом для чтения из файлов конфигурации ASP.NET. Есть по существу три шага к чтению ASP.NET файлов конфигурации:

1. Получите объект конфигурации с помощью метода OpenWebConfiguration.
2. Получите ссылку на нужный раздел в файле конфигурации.
3. Прочитайте нужную информацию из файла конфигурации.

Объект конфигурации не представляет определенный файл конфигурации. Вместо этого он представляет собой объединенное представление конфигурации компьютера, приложения или веб-узла. Следующий пример кода мгновенно настраивает объект конфигурации, представляющий конфигурацию веб-приложения под названием *ProductInfo.*

[!code-csharp[Main](configuration-and-instrumentation/samples/sample1.cs)]

> [!NOTE]
> Обратите внимание, что если путь /ProductInfo не существует, вышеуказанный код возвращает конфигурацию по умолчанию, указанную в файле machine.config.

После того, как у вас есть объект конфигурации, вы можете использовать метод GetSection или GetSectionGroup для сверления в настройках конфигурации. Следующий пример приводится в ссылку на настройки олицетворения для вышеупомянутого приложения ProductInfo:

[!code-csharp[Main](configuration-and-instrumentation/samples/sample2.cs)]

## <a name="writing-to-aspnet-configuration-files"></a>Запись для ASP.NET файлов конфигурации

Как и в чтении из файлов конфигурации, класс WebConfigurationManager является ядром для записи для Asp.NET файлов конфигурации. Есть также три шага к написанию ASP.NET файлов конфигурации.

1. Получите объект конфигурации с помощью метода OpenWebConfiguration.
2. Получите ссылку на нужный раздел в файле конфигурации.
3. Напишите нужную информацию из файла конфигурации с помощью метода Save or SaveAs.

Следующий код изменяет атрибут &lt; **отладки** элемента компиляции&gt; на ложный:

[!code-csharp[Main](configuration-and-instrumentation/samples/sample3.cs)]

Когда этот код будет выполнен, атрибут &lt; **отладки** элемента компиляции&gt; будет установлен на ложный для веб-файла web.app приложения web.config. *webApp*

## <a name="systemwebmanagement-namespace"></a>System.Web.Management Namespace

В пространстве имен System.Web.Management представлены классы и интерфейсы для управления и мониторинга работоспособности ASP.NET приложений.

Регистрация достигается путем определения правила, которое связывает события с поставщиком. Правило определяет тип событий, отправляемых поставщику. Для входа в систему доступны следующие базовые события:

| **WebBaseEvent** | Базовый класс событий для всех событий. Содержит необходимые свойства для всех событий, таких как код события, код детали события, дата и время поднятия события, номер последовательности, сообщение события и детали события. |
| --- | --- |
| **WebManagementEvent** | Базовый класс событий для событий управления, таких как срок службы приложения, запрос, ошибка и события аудита. |
| **WebHeartbeatEvent** | Событие, генерируемое приложением через регулярные промежутки времени для сбора полезной информации о состоянии выполнения. |
| **WebAuditEvent** | Базовый класс для событий аудита безопасности, которые используются для обозначения таких условий, как сбой авторизации, сбой расшифровки *и т.д.* |
| **WebRequestEvent** | Базовый класс для всех событий информационного запроса. |
| **WebBaseErrorEvent** | Базовый класс для всех событий, указывающих на условия ошибки. |

Доступные типы провайдеров позволяют отправлять выходные события в Event Viewer, сервер S'L, инструмент управления Windows (WMI) и электронную почту. Предварительно настроенные поставщики и картографирование событий уменьшают объем работы, необходимой для регистрации вывода событий.

ASP.NET 2.0 использует поставщика событий Log out-of-the-box для регистрации событий на основе доменов приложений, начиная и останавливаясь, а также регистрируя любые необработанные исключения. Это помогает охватить некоторые из основных сценариев. Например, предположим, что приложение бросает исключение, но пользователь не сохраняет ошибку, и вы не можете воспроизвести ее. С правилом журнала событий по умолчанию можно будет собрать информацию об исключениях и сложить, чтобы получить более хорошее представление о том, какая ошибка произошла. Другой пример применяется, если приложение теряет состояние сеанса. В этом случае вы можете посмотреть в журнале событий, чтобы определить, является ли домен приложения рециркуляцией, и почему домен приложения остановился в первую очередь.

Кроме того, система мониторинга состояния здоровья является расширяемой. Например, можно определить пользовательские веб-события, запустить их в приложении, а затем определить правило для отправки информации о событии поставщику, например вашей электронной почте. Это позволяет легко связать ваши приборы с поставщиками медицинских мониторинга. В качестве другого примера можно запустить событие при обработке заказа и настроить правило, которое отправляет каждое событие в базу данных сервера S'L Server. Вы также можете запустить событие, когда пользователь не может войти в систему несколько раз подряд, и настроить событие для использования на основе электронной почты провайдеров.

Конфигурация для поставщиков и событий по умолчанию хранится в глобальном файле Web.config. Глобальный файл Web.config хранит все веб-настройки, которые хранились в файле Machine.config в ASP.NET 1x. Глобальный файл Web.config расположен в следующем каталоге:

`%windir%\Microsoft.Net\Framework\v2.0.*\config\Web.config`

Раздел &lt;мониторинга работоспособности&gt; глобального файла Web.config предоставляет настройки конфигурации по умолчанию. Вы можете переопределить эти настройки или настроить свои &lt;собственные&gt; настройки, внедрив раздел healthMonitoring в файле Web.config для вашего приложения.

Раздел &lt;HealthMonitoring&gt; глобального файла Web.config содержит следующие элементы:

| **Поставщиков** | Содержит провайдеры, настроенные для просмотра событий, WMI и сервера S'L. |
| --- | --- |
| **eventMappings** | Содержит отображения для различных классов WebBase. Вы можете расширить этот список, если вы создаете свой собственный класс событий. Создание собственного класса событий дает вам более тонкую детализацию по сравнению с поставщиками, к которые вы отправляете информацию. Например, можно настроить необработанные исключения для отправки на сервер S'L, отправив собственные пользовательские события по электронной почте. |
| **Правила** | Ссылки eventMappings с поставщиком. |
| **Буферизации** | Используется с помощью s'L Server и поставщиков электронной почты, чтобы определить, как часто можно смыть события с поставщиком. |

Ниже приведен пример кода из глобального файла Web.config.

[!code-xml[Main](configuration-and-instrumentation/samples/sample4.xml)]

## <a name="how-to-store-events-to-event-viewer"></a>Как хранить события для просмотра событий

Как упоминалось ранее, поставщик для событий регистрации в Viewer событий настроен для вас в глобальном файле Web.config. По умолчанию все события, основанные на **WebBaseErrorEvent** и **WebFailureAuditEvent,** регистрируются. Вы можете добавить дополнительные правила для входа дополнительной информации в журнал событий. Например, если вы хотите войти во все события *(т.е.* каждое событие на основе **WebBaseEvent),** вы можете добавить следующее правило в файл Web.config:

[!code-xml[Main](configuration-and-instrumentation/samples/sample5.xml)]

Это правило свяжет карту событий **«Все события»** с поставщиком журнала событий. Как eventMapping, так и поставщик включены в глобальный файл Web.config.

## <a name="how-to-store-events-to-sql-server"></a>Как хранить события на сервере S'L

Этот метод использует базу данных **ASPNETDB,** которая\_генерируется инструментом Aspnet regsql.exe. Поставщик по умолчанию использует строку подключения LocalSqlServer, которая использует\_либо файловую базу данных в папке данных приложения, либо локальный экземпляр s'LExpress сервера S'L. Строка подключения LocalSqlServer и SqlProvider настроены в глобальном файле Web.config.

Строка подключения LocalSqlServer в глобальном файле Web.config выглядит следующим образом:

[!code-xml[Main](configuration-and-instrumentation/samples/sample6.xml)]

Если вы хотите использовать другой экземпляр сервера S'L, вам\_нужно будет использовать инструмент Aspnet regsql.exe, который можно найти в %windir% »Microsoft.Net-Framework-v2.0. \* папка. Используйте инструмент\_Aspnet regsql.exe для создания пользовательской базы данных **ASPNETDB** в экземпляре s'L Server, затем добавьте строку соединения в файл конфигурации приложений, а затем добавьте поставщика с помощью новой строки соединения. После создания базы данных **ASPNETDB** необходимо установить правило, связывающее eventMapping с sqlProvider.

Независимо от того, используете ли вы SqlProvider по умолчанию или настраиваете собственного поставщика, необходимо добавить правило, связывающее поставщика с картой событий. Следующее правило связывает нового поставщика, созданного выше, с картой событий **«Все события».** Это правило будет регистрировать все события на основе **WebBaseEvent** и отправлять их в MySqlWebEventProvider, который будет использовать строку подключения MYASPNETDB. Следующий код добавляет правило, связывающее поставщика с картой событий:

[!code-xml[Main](configuration-and-instrumentation/samples/sample7.xml)]

Если вы хотите отправлять ошибки только на сервер S'L, вы можете добавить следующее правило:

[!code-xml[Main](configuration-and-instrumentation/samples/sample8.xml)]

## <a name="how-to-forward-events-to-wmi"></a>Как перенаправить события в WMI

Вы также можете направить события в WMI. Поставщик WMI настроен для вас в глобальном файле Web.config по умолчанию.

Следующий пример кода добавляет правило для переноса событий в WMI:

[!code-xml[Main](configuration-and-instrumentation/samples/sample9.xml)]

Вам нужно будет добавить правило, чтобы связать eventMapping с поставщиком, а также приложение слушателя WMI, чтобы прослушать события. Следующий пример кода добавляет правило, связывающее поставщика WMI с картой событий **All Events:**

[!code-xml[Main](configuration-and-instrumentation/samples/sample10.xml)]

## <a name="how-to-forward-events-to-email"></a>Как пересылать события по электронной почте

Вы также можете пересылать события по электронной почте. Будьте осторожны с правилами события, которые вы отображаете на ваш поставщик услуг электронной почты, так как вы можете непреднамеренно отправить себе много информации, которая может быть лучше подходит для сервера S или журнала событий. Есть два поставщика электронной почты; SimpleMailWebEventProvider и TemplatedMailWebEventProvider. Каждый из них имеет одинаковые атрибуты конфигурации, за исключением атрибутов "шаблон" и "detailedTemplateErrors", оба из которых доступны только на TemplatedMailWebEventProvider.

> [!NOTE]
> Ни один из этих поставщиков электронной почты настроен для вас. Вам нужно будет добавить их в файл Web.config.

Основное различие между этими двумя поставщиками электронной почты является то, что SimpleMailWebEventProvider отправляет электронные письма в общий шаблон, который не может быть изменен. Образец файла Web.config добавляет этот поставщик электронной почты в список настроенных поставщиков, используя следующее правило:

[!code-xml[Main](configuration-and-instrumentation/samples/sample11.xml)]

Также добавляется следующее правило, чтобы связать поставщика электронной почты с картой событий **All Events:**

[!code-xml[Main](configuration-and-instrumentation/samples/sample12.xml)]

## <a name="aspnet-20-tracing"></a>ASP.NET 2.0 Трассировка

Есть три основных усовершенствования для отслеживания в ASP.NET 2.0.

1. Интегрированная функциональность отслеживания
2. Программный доступ к следам сообщений
3. Улучшенная отслеживание уровня приложений

## <a name="integrated-tracing-functionality"></a>Интегрированная функция отслеживания

Теперь можно направлять сообщения, испускаемые классом System.Diagnostics.Trace, чтобы ASP.NET отслеживание вывода и маршрутсообщений, излучаемый ASP.NET на System.Diagnostics.Trace. Вы также можете переслать события ASP.NET приборов на System.Diagnostics.Trace. Эта функциональность обеспечивается новым атрибутом **writeToDiagnosticsTrace** элемента. &lt;&gt; Когда это значение Boolean верно, ASP.NET сообщения Trace направляются в инфраструктуру отслеживания System.Diagnostics для использования любыми слушателями, которые зарегистрированы для отображения сообщений Trace.

## <a name="programmatic-access-to-trace-messages"></a>Программный доступ к сообщениям о слечении

ASP.NET 2.0 позволяет осуществлять программный доступ ко всем следовым сообщениям через класс **TraceContextRecord** и коллекцию **TraceRecords.** Наиболее эффективным способом доступа к микросообщениям является регистрация делегата **TraceContextEventHandler** (также нового в ASP.NET 2.0) для обработки нового события **TraceFinished.** Затем вы можете цикл через след сообщения, как вы хотите.

Следующий пример кода иллюстрирует это:

[!code-csharp[Main](configuration-and-instrumentation/samples/sample13.cs)]

В приведенном выше примере я просматриваю коллекцию TraceRecords, а затем записываю каждое сообщение в поток ответа.

## <a name="improved-application-level-tracing"></a>Улучшенная трассировка уровня приложений

Отслеживание уровня приложения улучшается за счет введения нового **наиболее важного** атрибута &lt;микроэлемента.&gt; Этот атрибут определяет, отображается ли последний выход отслеживания уровня приложения и отбрасываются старые данные трассировки за пределами, указанными в requestLimit. Если они ложны, данные трассировки отображаются для запросов до тех пор, пока не будет достигнут атрибут requestLimit.

## <a name="aspnet-command-line-tools"></a>инструменты ASP.NET командной линии

Есть несколько командных строк инструментов, чтобы помочь в конфигурации ASP.NET. ASP.NET разработчики должны быть знакомы\_с инструментом aspnet regiis.exe. ASP.NET 2.0 предоставляет три других командных инструмента для оказания помощи в настройке.

Доступны следующие инструменты командной строки:

| **Инструмент** | **Использовать** |
| --- | --- |
| **aspnet\_regiis.exe** | Позволяет регистрировать ASP.NET с ИИС. Есть две версии этих инструментов, которые походят с ASP.NET 2.0, один для 32-битных систем (в папке Рамочной) и один для 64-битных систем (в папке Framework64.) 64-битная версия не будет установлена на 32-битную ОС. |
| **aspnet\_regsql.exe** | Инструмент ASP.NET sL Server Registration используется для создания базы данных Microsoft S'L Server для использования поставщиками серверов s'L в ASP.NET, а также для добавления или удаления параметров из существующей базы данных. Файл Aspnet\_regsql.exe находится в папке «диск: »WINDOWS»Microsoft.NET-Framework-versionNumber На вашем веб-сервере. |
| **aspnet\_regbrowsers.exe** | Инструмент ASP.NET регистрации браузеров разбирает и компилирует все общесистемные определения браузера в сборку и устанавливает сборку в глобальный кэш сборки. Инструмент использует файлы определения браузера (. BROWSER файлы) из субдиректоров .NET Framework Browsers. Инструмент можно найти в каталоге %SystemRoot% (Microsoft.NET)Framework-версия. |
| **aspnet\_compiler.exe** | Инструмент ASP.NET компиляции позволяет компилировать ASP.NET веб-приложении, либо на месте, либо для развертывания в целевом месте, например на производственном сервере. Компиляция на месте помогает производительности приложения, поскольку конечные пользователи не сталкиваются с задержкой при первом запросе в приложение во время компиляции приложения. |

Поскольку инструмент\_aspnet regiis.exe не новичок в ASP.NET 2.0, мы не будем обсуждать его здесь.

## <a name="aspnet-sql-server-registration-tool---aspnet_regsqlexe"></a>ASP.NET инструмент регистрации серверов\_S'L - aspnet regsql.exe

Вы можете установить несколько типов опций с помощью инструмента ASP.NET S'L Server Registration. Можно указать соединение с СЗЛ, указать, какие ASP.NET службы приложения используют S'L Server для управления информацией, указать, какая база данных или таблица используется для зависимости кэша S'L, а также добавить или удалить поддержку для использования сервера S'L для хранения процедур и состояния сеанса.

Несколько ASP.NET службы приложений полагаются на поставщика для управления хранением и извлечением данных из источника данных. Каждый поставщик специфичен для источника данных. ASP.NET включает в себя поставщик серверов S'L для следующих функций ASP.NET:

- Членство (класс [SqlMembershipProvider).](https://msdn.microsoft.com/library/system.web.security.sqlmembershipprovider.aspx)
- Управление ролевой лостью (класс [SqlRoleProvider).](https://msdn.microsoft.com/library/system.web.security.sqlroleprovider.aspx)
- Профиль (класс [SqlProfileProvider).](https://msdn.microsoft.com/library/system.web.profile.sqlprofileprovider.aspx)
- Персонализация веб-запчастей (класс [SqlPersonalizationprovider).](https://msdn.microsoft.com/library/system.web.ui.webcontrols.webparts.sqlpersonalizationprovider.aspx)
- Веб-события (класс [SqlWebEventProvider).](https://msdn.microsoft.com/library/system.web.management.sqlwebeventprovider.aspx)

При установке ASP.NET файл Machine.config для вашего сервера включает элементы конфигурации, которые определяют поставщиков сервера s'L для каждой из ASP.NET функций, которые полагаются на поставщика. Эти провайдеры настроены по умолчанию для подключения к локальному экземпляру пользователя S'L Server Express 2005. Если вы измените строку подключения по умолчанию, используемую поставщиками, то, прежде чем использовать любую из ASP.NET функций, настроенных в конфигурации машины, необходимо установить базу данных сервера S'L и элементы базы данных для выбранной функции Спомощьу Спомощьу с помощью Aspnet\_regsql.exe. Если база данных, указанная с помощью инструмента регистрации S'L, уже не существует (aspnetdb будет базой данных по умолчанию, если она не указана в командной строке), то текущий пользователь должен иметь права на создание баз данных в сервере S'L, а также на создание элементов схемы в базе данных.

### <a name="sql-cache-dependency"></a>Зависимость кэша SQL

Расширенная особенность кэширования вывода ASP.NET — это зависимость кэша кэша s'L. Зависимость кэша s'L поддерживает два различных режима работы: один, который использует ASP.NET реализации опроса таблицы, и второй режим, который использует функции уведомления запроса s'L Server 2005. Для настройки режима работы таблицы-опроса можно использовать инструмент регистрации S'L.

### <a name="session-state"></a>Состояние сеанса

По умолчанию значения состояния сеанса и информация сохраняются в памяти в процессе ASP.NET. Кроме того, вы можете хранить данные сеанса в базе данных сервера S'L Server, где они могут быть общими для нескольких веб-серверов. Если база данных, указанная для состояния сеанса с помощью инструмента регистрации S'L, уже не существует, то текущий пользователь должен иметь права на создание баз данных в сервере S'L, а также на создание элементов схемы в базе данных. Если база данных существует, то текущий пользователь должен иметь права на создание элементов схемы в существующей базе данных.

Чтобы установить базу данных состояния сеанса на\_сервере S'L, запустите инструмент Aspnet regsql.exe и предоставите следующую информацию с командой:

- Название экземпляра сервера S'L, используя опцию **-S.**
- Учетные данные logon для учетной записи, которая имеет разрешение на создание базы данных на компьютере под управлением сервера S'L. Используйте опцию **-E,** чтобы использовать в настоящее время зарегистрированного пользователя, или использовать опцию **-U,** чтобы указать идентификатор пользователя вместе с **опцией -P** для указания пароля.
- Опция **командной строки -ssadd** для добавления базы данных состояния сеанса.

По умолчанию вы не можете\_использовать инструмент Aspnet regsql.exe для установки базы данных состояния сеанса на компьютерпод управлением S'L Server 2005 Express Edition.

### <a name="the-aspnet-browser-registration-tool---aspnet_regbrowsersexe"></a>Инструмент регистрации ASP.NET браузера\_- aspnet regbrowsers.exe

В ASP.NET версии 1.1 файл Machine.config &lt;содержал&gt;раздел под названием browserCaps . Этот раздел содержал серию записей XML, которые определяли конфигурации для различных браузеров на основе регулярного выражения. Для ASP.NET версии 2.0, новый . Файл BROWSER определяет параметры конкретного браузера с помощью записей XML. Вы добавляете информацию о новом браузере, добавляя новый . БРАУЗЕР файл ассоциируется в папку, расположенную по адресу :SystemRoot% -Microsoft.NET-Framework-версия -CONFIG-Браузеры в вашей системе.

Поскольку приложение не читает файл .config каждый раз, когда требуется информация о браузере, можно создать новый . BROWSER файл и запустить\_Aspnet regbrowsers.exe, чтобы добавить необходимые изменения в сборку. Это позволяет серверу получить доступ к новой информации браузера немедленно, так что вам не придется закрыть любое из ваших приложений, чтобы забрать информацию. Приложение может получить доступ к возможностям браузера через свойство браузера текущего HttpRequest.

Следующие варианты доступны при\_запуске aspnet regbrowser.exe:

| **Параметр** | **Описание** |
| --- | --- |
| **-?** | Отображает текст справки\_Aspnet regbbrowsers.exe в окне команды. |
| **-i** | Создает сборку возможностей браузера в течение выполнения и устанавливает его в глобальный сборочный кэш. |
| **-u** | Удаляет сборку возможностей браузера времени выполнения из глобального кэша сборки. |

## <a name="the-aspnet-compilation-tool---aspnet_compilerexe"></a>Инструмент ASP.NET компиляции\_- аспнет compiler.exe

Инструмент ASP.NET компиляции может использоваться двумя общими способами: для компиляции на месте и компиляции для развертывания, где указан целевой каталог вывода.

### <a name="compiling-an-application-in-place"></a>[Составление приложения на месте](https://msdn.microsoft.com/library/ms229863.aspx)

Инструмент ASP.NET компиляции может компилировать приложение на месте, то есть он имитирует поведение нескольких запросов в приложение, вызывая тем самым регулярную компиляцию. Пользователи предварительно составленного сайта не будут испытывать задержки, вызванные компиляцией страницы по первому запросу.

При предварительном составлении сайта применяются следующие элементы:

- Сайт сохраняет свои файлы и структуру каталога.
- Необходимо иметь компиляторы для всех языков программирования, используемых сайтом на сервере.
- Если какой-либо файл не завершает компиляцию, весь сайт не завершает компиляцию.

Вы также можете пересоставить приложение после добавления в него новых исходных файлов. Инструмент компилирует только новые или измененные файлы, если вы не включаете опцию **-c.**

> [!NOTE]
> Компиляция приложения, содержащего вложенное приложение, не компилирует вложенное приложение. Вложенное приложение должно быть составлено отдельно.

### <a name="compiling-an-application-for-deployment"></a>[Составление приложения для развертывания](https://msdn.microsoft.com/library/ms229863.aspx)

Вы компилируете приложение для развертывания (компиляция в целевом местоположении) путем указания параметра targetDir. TargetDir может быть окончательным местом для веб-приложения, или компилированное приложение может быть развернуто далее. Использование опции **-u** компилирует приложение таким образом, что вы можете вносить изменения в определенные файлы в скомпилированном приложении без его перекомпивания. Aspnet\_compiler.exe проводит различие между статичными и динамическими типами файлов и обрабатывает их по-разному при создании полученного приложения.

- Статические типы файлов — это типы, которые не имеют связанного компилятора или поставщика сборки, такие как файлы, названные с такими расширениями, как .css, .gif, .htm, .html, .jpg, .js и так далее. Эти файлы просто копируются в целевом месте, при этом их относительные места в структуре каталога сохраняются.
- Динамические типы файлов — это типы, которые имеют связанный компилятор или поставщик сборки, включая файлы с ASP.NET конкретными расширениями имени файла, такими как .asax, .ascx, .ashx, .aspx, .browser, .master и так далее. Инструмент ASP.NET компиляции генерирует сборки из этих файлов. Если опция **-u** опущена, инструмент также создает файлы с расширением имени файла. COMPILED, что карта исходных файлов источника для их сборки. Чтобы сохранить структуру каталога источника приложения, инструмент генерирует файлы заполнителей в соответствующих местах в целевом приложении.

Необходимо использовать опцию **-u,** чтобы указать, что содержимое скомпилированного приложения может быть изменено. В противном случае последующие изменения игнорируются или приводят к ошибкам времени выполнения.

В следующей таблице описывается, как инструмент ASP.NET сборника обрабатывает различные типы файлов при включении опции **-u.**

| **Тип файла** | **Действие компилятора** |
| --- | --- |
| .ascx, .aspx, .master | Эти файлы разделены на разметку и исходный код, который включает &lt;в себя как файлы с кодом, так и любой код, заключенный в элементы скрипта runat'"server"&gt; . Исходный код компилируется в сборки, с именами, которые являются производными от алгоритма хэширования, и сборки помещаются в каталог Бин. Любой входящий код, т.е. ** &lt; ** ** % ** код, заключенный между скобками, включается с разметкой и не компилируется. Новые файлы с тем же именем, что и исходные файлы, создаются для хранения разметки и размещаются в соответствующих каталогах вывода. |
| .ashx, .asmx | Эти файлы не компилируются и перемещаются в каталоги вывода как есть, так и не компилируются. Если вы хотите, чтобы код обработчика был компилирован, поместите код в файлы исходного кода в каталоге App\_Code. |
| .cs, .vb, .jsl, .cpp (не включая файлы с кодом для типов файлов, перечисленных ранее) | Эти файлы компилируются и включаются в качестве ресурса в сборках, которые ссылаются на них. Исходные файлы не копируются в каталог вывода. Если файл кода не ссылается, он не компилируется. |
| Пользовательские типы файлов | Эти файлы не компилируются. Эти файлы копируются в соответствующие выходные каталоги. |
| Файлы исходного\_кода в подкаталоге App Code | Эти файлы компилируются в сборки и помещаются в каталог Бин. |
| файлы .resx и .ресурса в подкаталоге App\_GlobalResources | Эти файлы компилируются в сборки и помещаются в каталог Бин. В\_основном каталоге вывода не создается субдиректоров App GlobalResources, и файлы .resx или .resources, расположенные в исходном каталоге, не скопированы в каталоги вывода. |
| файлы .resx и .resource в подкаталоге App\_LocalResources | Эти файлы не компилируются и копируются в соответствующие выходные каталоги. |
| файлы .skin\_в подкаталоге App Themes | Файлы .skin и статичные тематические файлы не компилируются и копируются в соответствующие выходные каталоги. |
| .browser Web.config Static типы файлов Сборки уже присутствуют в каталоге Бин | Эти файлы копируются как в каталогах вывода. |

В следующей таблице описывается, как инструмент ASP.NET компиляции обрабатывает различные типы файлов при опущении опции **-u.**

| **Тип файла** | **Действие компилятора** |
| --- | --- |
| .aspx, .asmx, .ashx, .master | Эти файлы разделены на разметку и исходный код, который включает &lt;в себя как файлы с кодом, так и любой код, заключенный в элементы скрипта runat'"server"&gt; . Исходный код компилируется в сборки, с именами, которые являются производными от алгоритма хэширования. Полученные сборки помещаются в каталог Бин. Любой входящий код, т.е. ** &lt; ** ** % ** код, заключенный между скобками, включается с разметкой и не компилируется. Компилятор создает новые файлы для хранения разметки с тем же именем, что и исходные файлы. Полученные файлы помещаются в каталог Бин. Компилятор также создает файлы с тем же именем, что и исходные файлы, но с расширением. COMPILED, которые содержат картографируемую информацию. Teh. Файлы COMPILED размещаются в каталогах вывода, соответствующих исходному местоположению исходных файлов. |
| .ascx | Эти файлы разделены на разметку и исходный код. Исходный код компилируется в сборки и помещается в каталог Бин, с именами, которые являются производными от алгоритма хэширования. Файлы разметки не генерируются. |
| .cs, .vb, .jsl, .cpp (не включая файлы с кодом для типов файлов, перечисленных ранее) | Исходный код, на который ссылаются сборки, генерируемые из файлов .ascx, .ashx или .aspx, компилируется в сборки и помещается в каталог Бин. Исходные файлы не копируются. |
| Пользовательские типы файлов | Эти файлы компилируются как динамические файлы. В зависимости от типа файла, на который они основаны, компилятор может размещать файлы отображения в каталогах вывода. |
| Файлы в\_подкаталоге App Code | Файлы исходного кода в этом подкаталоге компилируются в сборки и помещаются в каталог Бин. |
| Файлы в\_подкаталоге App GlobalResources | Эти файлы компилируются в сборки и помещаются в каталог Бин. В\_основном каталоге вывода не создается субдиректоров App GlobalResources. Если файл конфигурации указывает на то, что файлы "Все", файлы .resx и .resources копируются в каталоги вывода. Они не копируются, если на них ссылается [BuildProvider.](https://msdn.microsoft.com/library/system.web.configuration.buildprovider.aspx) |
| файлы .resx и .resource в подкаталоге App\_LocalResources | Эти файлы компилируются в сборки с уникальными именами и помещаются в каталог Бин. Файлы .resx или .resource не копируются в каталогах вывода. |
| файлы .skin\_в подкаталоге App Themes | Темы компилируются в сборки и размещаются в каталоге Бин. Файлы Stub создаются для файлов .skin и помещаются в соответствующий каталог вывода. Статические файлы (например, .css) копируются в каталоги вывода. |
| .browser Web.config Static типы файлов Сборки уже присутствуют в каталоге Бин | Эти файлы копируются как в каталоге вывода. |

### <a name="fixed-assembly-names"></a>[Фиксированные имена сборки](https://msdn.microsoft.com/library/ms229863.aspx##)

Некоторые сценарии, такие как развертывание веб-приложения с помощью установки MSI Windows, требуют использования согласованных имен файлов и содержимого, а также согласованных структур каталогов для определения сборок или параметров конфигурации для обновлений. В этих случаях можно использовать опцию **-fixednames,** чтобы указать, что инструмент ASP.NET компиляции должен компилировать сборку для каждого исходного файла вместо того, чтобы использовать, где несколько страниц компилируются в сборки. Это может привести к большому количеству сборок, поэтому, если вы обеспокоены масштабируемостью, вы должны использовать эту опцию с осторожностью.

### <a name="strong-name-compilation"></a>[Сборник сильных имен](https://msdn.microsoft.com/library/ms229863.aspx##)

**Варианты Aptca** **, -delaysign** **-keycontainer** и **-keyfile** предоставляются так,\_что вы можете использовать компилятор Aspnet.exe для создания сильно названных сборок без отдельного использования [инструмента Strong Name Tool (Sn.exe).](https://msdn.microsoft.com/library/k5b5tt23.aspx) Эти варианты соответствуют, соответственно, **AllowPartiallyTrustedCallersAttribute**, **AssemblyDelaySignAttribute**, **AssemblyKeyNameAttribute**, и **AssemblyKeyFileAttribute**.

Обсуждение этих атрибутов выходит за рамки данного курса.

## <a name="labs"></a>Тестовые службы

Каждая из следующих лабораторий строится на предыдущих лабораториях. Вам нужно будет сделать их в порядке.

## <a name="lab-1-using-the-configuration-api"></a>Лаборатория 1: Использование API конфигурации

1. Создайте новый веб-узел под названием *mod9lab*.
2. Добавьте на сайт новый файл конфигурации веб-
3. Добавьте следующее в файл web.config:

[!code-xml[Main](configuration-and-instrumentation/samples/sample14.xml)]

Это гарантирует, что у вас есть разрешение на сохранение изменений в файле web.config.

1. Добавьте новый элемент управления этикеткой в Default.aspx и измените идентификатор на **lblDebugStatus.**
2. Добавьте новый элемент управления кнопками в Default.aspx.
3. Измените идентификатор управления кнопками на **btnToggleDebug** и текст для **переключения состояния debug.**
4. Откройте представление кода для файла по умолчанию.aspx и добавьте **заявление об использовании** для **System.Web.Configuration** следующим образом:

[!code-csharp[Main](configuration-and-instrumentation/samples/sample15.cs)]

1. Добавьте две частные переменные\_в класс и метод Page Init, как показано ниже:

[!code-csharp[Main](configuration-and-instrumentation/samples/sample16.cs)]

1. Добавьте следующий\_код в Загрузку страницы:

[!code-csharp[Main](configuration-and-instrumentation/samples/sample17.cs)]

1. Сохранить и просматривать default.aspx. Обратите внимание, что элемент управления метки отображает текущий статус отладки.
2. Дважды нажмите на элемент управления кнопкой в конструкторе и добавьте следующий код в событие Click для управления кнопкой:

[!code-csharp[Main](configuration-and-instrumentation/samples/sample18.cs)]

1. Сохранить и просматривать default.aspx и нажмите кнопку.
2. Откройте файл web..config после каждого нажатия кнопки&gt; и наблюдайте атрибут **отладки** в разделе &lt;компиляции.

## <a name="lab-2-logging-application-restarts"></a>Лаборатория 2: Перезагрузка приложений для регистрации

В этой лаборатории будет создан код, который позволит вам переключать журналы выключений приложений, запусков и перекомпиляций в Viewer событий.

1. Добавьте DropDownList в default.aspx и измените идентификатор на ddlLogAppEvents.
2. Установите свойство **AutoPostBack** для DropDownList на **истину.**
3. Добавьте три элемента в коллекцию элементов для DropDownList. Сделать **текст** для первого элемента *Выберите значение* и значение -1. Сделать **текст** и **значение** второго элемента **Правда** и **текст** и **значение** третьего элемента **ложные**.
4. Добавьте новую метку по умолчанию.aspx. Измените идентификатор на **lblLogAppEvents**.
5. Откройте представление позади кода для значения default.aspx и добавьте новую декларацию для переменной типа HealthMonitoringSection, как показано ниже:

[!code-csharp[Main](configuration-and-instrumentation/samples/sample19.cs)]

1. Добавьте следующий код к\_существующему коду в Page Init:

[!code-csharp[Main](configuration-and-instrumentation/samples/sample20.cs)]

1. Дважды нажмите на DropDownList и добавьте следующий код в событие SelectedIndexChanged:

[!code-csharp[Main](configuration-and-instrumentation/samples/sample21.cs)]

1. Просмотр по умолчанию.aspx.
2. Установите падение на **ложные**.
3. Очистите журнал приложения в Viewer события.
4. Нажмите кнопку, чтобы изменить атрибут Debug для приложения.
5. Обновите журнал приложения в Viewer события. 

    1. Были ли зарегистрированы какие-либо события?
    2. Почему или почему нет?
6. Установите падение на **True.**
7. Нажмите кнопку, чтобы переключить атрибут Debug для приложения.
8. Обновите приложение, ввизай в Viewer события. 

    1. Были ли зарегистрированы какие-либо события?
    2. Что послужило причиной отключения приложения?
9. Экспериментируйте с включением и выключением журналов и посмотрите на изменения, внесенные в файл web.config.

## <a name="more-information"></a>Дополнительные сведения:

ASP.NET модель провайдера 2.0 позволяет создавать собственные провайдеры не только для приборов приложений, но и для многих других видов использования, таких как членство, профили и т.д. Для получения подробной информации о написании пользовательского поставщика для регистрации событий приложения в текстовый файл, посетите [эту ссылку.](https://msdn.microsoft.com/library/default.asp?url=/library/dnaspp/html/ASPNETProvMod_Prt6.asp)
