---
uid: web-forms/overview/moving-to-aspnet-20/data-bound-controls
title: Элементы управления с привязкой к данным | Документация Майкрософт
author: microsoft
description: Большинство ASP.NET приложений полагаются на некоторую степень представления данных из серверного источника данных. Элементы управления с привязкой к данным были сведенной частью взаимодействия w...
ms.author: riande
ms.date: 02/20/2005
ms.assetid: 0e23ff32-646d-43f3-8bec-6b2313d3abd6
msc.legacyurl: /web-forms/overview/moving-to-aspnet-20/data-bound-controls
msc.type: authoredcontent
ms.openlocfilehash: 1154b38e0fa3d9d56cb407ae659c3b0d69871fda
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78488874"
---
# <a name="data-bound-controls"></a>Элементы управления привязкой к данным

по [Майкрософт](https://github.com/microsoft)

> Большинство ASP.NET приложений полагаются на некоторую степень представления данных из серверного источника данных. Элементы управления с привязкой к данным были сведенной частью взаимодействия с данными в динамических веб-приложениях. ASP.NET 2,0 вносит некоторые существенные улучшения в элементы управления с привязкой к данным, в том числе новый класс Баседатабаундконтрол и декларативный синтаксис.

Большинство ASP.NET приложений полагаются на некоторую степень представления данных из серверного источника данных. Элементы управления с привязкой к данным были сведенной частью взаимодействия с данными в динамических веб-приложениях. ASP.NET 2,0 вносит некоторые существенные улучшения в элементы управления с привязкой к данным, в том числе новый класс Баседатабаундконтрол и декларативный синтаксис.

Баседатабаундконтрол выступает в качестве базового класса для класса для DataBoundControl включено и класса Хиерарчикалдатабаундконтрол. В этом модуле будут обсуждаться следующие классы, производные от для DataBoundControl включено:

- AdRotator
- Элементы управления "список"
- GridView
- C
- DetailsView

Мы также рассмотрим следующие классы, производные от класса Хиерарчикалдатабаундконтрол:

- TreeView
- Меню
- SiteMapPath

## <a name="databoundcontrol-class"></a>Класс для DataBoundControl включено

Класс для DataBoundControl включено является абстрактным классом (с модификатором MustInherit в VB), используемым для взаимодействия с табличными данными или со списками данных в стиле. Ниже перечислены некоторые элементы управления, производные от для DataBoundControl включено.

## <a name="adrotator"></a>AdRotator

Элемент управления AdRotator позволяет отображать графический баннер на веб-странице, связанной с конкретным URL-адресом. Отображаемый рисунок поворачивается с помощью свойств элемента управления. Частоту конкретного баннера, отображаемого на странице, можно настроить с помощью свойства **впечатления** , и объявления можно фильтровать с помощью фильтрации по ключевым словам.

Элементы управления AdRotator используют либо XML-файл, либо таблицу в базе данных для данных. Следующие атрибуты используются в XML-файлах для настройки элемента управления AdRotator.

### <a name="imageurl"></a>ImageUrl
URL изображения, отображаемого для рекламы.

### <a name="navigateurl"></a>NavigateUrl
URL-адрес, по которому должен быть сделан пользователь при щелчке баннера. Это должен быть URL-адрес в кодировке.

### <a name="alternatetext"></a>AlternateText данного
Альтернативный текст, который отображается в подсказке и читается программами чтения с экрана. Также отображается, если изображение, заданное параметром ImageUrl, недоступно.

### <a name="keyword"></a>Ключевое слово
Определяет ключевое слово, которое может использоваться при фильтрации по ключевым словам. Если этот параметр указан, будут отображаться только объявления с ключевым словом, соответствующим фильтру ключевого слова.

### <a name="impressions"></a>Показ
Взвешенное число, определяющее, как часто может отображаться конкретное рекламное объявление. Оно связано с впечатлениеми других рекламных объявлений в том же файле. Максимальное значение общего количества просмотров для всех баннеров в XML-файле — 2 048 000 000 1.

### <a name="height"></a>Высота:
Высота рекламы в пикселях.

### <a name="width"></a>Ширина
Ширина рекламной рекламы в пикселях.

> [!NOTE]
> Атрибуты Height и Width переопределяют высоту и ширину элемента управления AdRotator.

Стандартный XML-файл может выглядеть следующим образом:

[!code-xml[Main](data-bound-controls/samples/sample1.xml)]

В приведенном выше примере рекламное объявление для Contoso, скорее всего, будет выглядеть как рекламное объявление для веб-сайта ASP.NET, поскольку значение атрибута «впечатления».

Чтобы отобразить рекламу из приведенного выше XML-файла, добавьте на страницу элемент управления AdRotator и задайте свойство **AdvertisementFile** , чтобы оно указывало на XML-файл, как показано ниже:

[!code-aspx[Main](data-bound-controls/samples/sample2.aspx)]

Если вы решили использовать таблицу базы данных в качестве источника данных для элемента управления AdRotator, сначала необходимо настроить базу данных, используя следующую схему:

| **Имя столбца** | **Data type** | **Описание** |
| --- | --- | --- |
| ID | INT | Первичный ключ. Этот столбец может иметь любое имя. |
| ImageUrl | nvarchar (*Длина*) | Относительный или абсолютный URL-адрес изображения, отображаемого для рекламы. |
| NavigateUrl | nvarchar (*Длина*) | Целевой URL-адрес для AD. Если значение не указано, то баннер не является гиперссылкой. |
| AlternateText данного | nvarchar (*Длина*) | Текст, отображаемый, если изображение не найдено. В некоторых браузерах текст отображается как подсказка. Кроме того, альтернативный текст используется для специальных возможностей, чтобы пользователи, которые не видят изображение, могли услышать его описание как прочитанное вслух. |
| Ключевое слово | nvarchar (*Длина*) | Категория объявления, по которой может быть отфильтрована страница. |
| Показ | int (4) | Число, указывающее вероятность отображения баннера. Чем больше это число, тем чаще будет отображаться баннер. Сумма всех значений просмотров в XML-файле не может превышать 2 048 000 000-1. |
| Ширина | int (4) | Ширина изображения в пикселях. |
| Высота: | int (4) | Высота изображения в пикселях. |

В случаях, когда у вас уже есть база данных с другой схемой, можно использовать свойства **алтернатетекстфиелд**, **имажеурлфиелд**и **Навигатеурлфиелд** , чтобы сопоставлять атрибуты AdRotator с существующей базой данных. Чтобы отобразить данные из базы данных в элементе управления AdRotator, добавьте на страницу элемент управления источником данных, настройте строку подключения для элемента управления источником данных, чтобы она указывала на базу данных, и присвойте свойству **DataSourceID** элемента управления AdRotator идентификатор элемента управления источника данных. В случаях, когда требуется настроить объявления AdRotator программным образом, используйте событие Адкреатед. Событие Адкреатед принимает два параметра: один объект, а другой — экземпляр Адкреатедевентаргс. Адкреатедевентаргс — это ссылка на создаваемый баннер.

В следующем фрагменте кода программным путем задается ImageUrl, NavigateUrl и AlternateText данного для AD:

[!code-csharp[Main](data-bound-controls/samples/sample3.cs)]

## <a name="list-controls"></a>Элементы управления "список"

Элементы управления "список" включают списки ListBox, DropDownList, CheckBoxList, RadioButtonList и маркированного списка. Каждый из этих элементов управления может быть связан с источником данных. Они используют одно поле в источнике данных в качестве отображаемого текста и при необходимости могут использовать второе поле в качестве значения элемента. Элементы также можно добавлять статически во время разработки, а статические элементы и динамические элементы, добавленные из источника данных, можно смешивать.

Чтобы связать данные с элементом управления "список", добавьте на страницу элемент управления источником данных. Укажите команду SELECT для элемента управления источником данных, а затем присвойте свойству DataSourceID элемента управления списка идентификатор элемента управления источника данных. Используйте свойства **TextField** и **датавалуефиелд** , чтобы определить отображаемый текст и значение для элемента управления. Кроме того, можно использовать свойство **дататекстформатстринг** для управления внешним видом отображаемого текста следующим образом:

| **Выражение** | **Описание** |
| --- | --- |
| Цена: {0:C} | Для числовых и десятичных данных. Отображает литерал "Price:", за которым следуют числа в формате валюты. Формат валюты зависит от параметра языка и региональных параметров, указанного в атрибуте Culture в директиве **Page** или в файле Web. config. |
| {0:D4} | Для целочисленных данных. Не может использоваться с десятичными числами. Целые числа отображаются в поле с нулевым отступом, которое имеет ширину 4 символов. |
| {0:N2}% | Для числовых данных. Отображает число с точностью до 2 знаков после запятой, за которым следует литерал "%". |
| {0:000.0} | Для числовых и десятичных данных. Числа округляются до одного десятичного знака. Числа, меньшие чем трехзначные, заполняются нулями. |
| {0:D} | Для данных даты-времени. Отображает длинный формат даты ("Четверг, Август 06, 1996"). Формат даты зависит от параметра языка и региональных параметров в файле Web.config. |
| {0:d} | Для данных даты-времени. Отображает короткий формат даты ("12/31/99"). |
| {0:гг-мм-дд} | Для данных даты-времени. Отображает дату в числовом формате "год-месяц-день" (96-08-06) |

## <a name="gridview"></a>GridView

Элемент управления GridView позволяет отображать табличные данные и изменять их с помощью декларативного подхода и является последовательным элементом управления DataGrid. В элементе управления GridView доступны следующие функции.

- Привязка к элементам управления источниками данных, например SqlDataSource.
- Встроенные возможности сортировки.
- Встроенные возможности обновления и удаления.
- Встроенные возможности разбиения на страницы.
- Встроенные возможности выбора строк.
- Программный доступ к объектной модели GridView для динамического задания свойств, управления событиями и т. д.
- Несколько ключевых полей.
- Несколько полей данных для столбцов гиперссылок.
- Настраиваемый внешний вид с помощью тем и стилей.

**Поля столбцов**

Каждый столбец в элементе управления GridView представлен объектом DataControlField. По умолчанию свойство Аутоженератеколумнс имеет значение **true**, которое создает объект аутоженератедфиелд для каждого поля в источнике данных. Затем каждое поле подготавливается к просмотру как столбец в элементе управления GridView в том порядке, в котором каждое поле отображается в источнике данных. Можно также вручную управлять отображением полей столбцов в элементе управления **GridView** , задав для свойства **аутоженератеколумнс** **значение false** , а затем определив собственную коллекцию полей столбцов. Различные типы полей столбцов определяют поведение столбцов в элементе управления.

В следующей таблице перечислены различные типы полей столбцов, которые можно использовать.

| **Тип поля столбца** | **Описание** |
| --- | --- |
| BoundField | Отображает значение поля в источнике данных. Это тип столбца по умолчанию для элемента управления GridView. |
| ButtonField | Отображает кнопку команды для каждого элемента в элементе управления GridView. Это позволяет создать столбец пользовательских элементов управления "Кнопка", таких как кнопка "Добавить" или "Удалить". |
| CheckBoxField | Отображает флажок для каждого элемента в элементе управления GridView. Этот тип поля столбца обычно используется для вывода полей с логическим значением. |
| CommandField | Отображает предопределенные командные кнопки для выполнения операций выбора, изменения или удаления. |
| HyperLinkField | Отображает значение поля в источнике данных в виде гиперссылки. Этот тип поля столбца позволяет привязать второе поле к URL-адресу гиперссылки. |
| ImageField | Отображает изображение для каждого элемента в элементе управления GridView. |
| TemplateField | Отображает определяемое пользователем содержимое для каждого элемента в элементе управления GridView в соответствии с заданным шаблоном. Этот тип поля столбца позволяет создать настраиваемое поле столбца. |

Чтобы декларативно определить коллекцию полей столбцов, сначала добавьте открывающие и закрывающие **&lt;столбцы&gt;** теги между открывающим и закрывающим тегами элемента управления GridView. Затем перечислите поля столбцов, которые необходимо включить между открывающим и закрывающим **&lt;столбцами&gt;** тегами. Указанные столбцы добавляются в коллекцию Columns в указанном порядке. Коллекция **Columns** хранит все поля столбцов в элементе управления и позволяет программно управлять полями столбцов в элементе управления GridView.

Явно объявленные поля столбцов могут отображаться в сочетании с автоматически создаваемыми полями столбцов. При использовании обоих типов сначала выводятся явно объявленные поля столбцов, за которыми следуют автоматически создаваемые поля столбцов.

## <a name="binding-to-data"></a>Привязка к данным

Элемент управления GridView может быть привязан к элементу управления источника данных (например, **SqlDataSource**, **ObjectDataSource**и т. д.), а также к любому источнику данных, реализующему интерфейс System. Collections. IEnumerable (например, System. Data. DataView, System. Collections. ArrayList или System. Collections. Hashtable). Используйте один из следующих методов для привязки элемента управления GridView к соответствующему типу источника данных:

- Чтобы выполнить привязку к элементу управления источником данных, задайте для свойства DataSourceID элемента управления GridView значение идентификатора элемента управления источника данных. Элемент управления GridView автоматически привязывается к заданному элементу управления источником данных и может использовать преимущества возможностей элемента управления источниками данных для выполнения сортировки, обновления, удаления и разбиения на страницы. Это предпочтительный метод для привязки к данным.
- Чтобы выполнить привязку к источнику данных, реализующему интерфейс System. Collections. IEnumerable, программно установите свойство DataSource элемента управления GridView в источник данных, а затем вызовите метод DataBind. При использовании этого метода элемент управления GridView не предоставляет встроенные функции сортировки, обновления, удаления и разбиения на страницы. Эти функции необходимо предоставить самостоятельно.

## <a name="data-operations"></a>Операции с данными

Элемент управления GridView предоставляет множество встроенных возможностей, позволяющих пользователю сортировать, обновлять, удалять, выбирать и пролистывать элементы в элементе управления. Когда элемент управления GridView привязан к элементу управления источником данных, элемент управления GridView может использовать возможности элемента управления источниками данных и обеспечивать автоматическую сортировку, обновление и удаление функций.

> [!NOTE]
> Элемент управления GridView обеспечивает поддержку сортировки, обновления и удаления с другими типами источников данных. Тем не менее необходимо предоставить соответствующий обработчик событий с реализацией для этих операций.

Сортировка позволяет пользователю сортировать элементы в элементе управления GridView по отношению к определенному столбцу, щелкая заголовок столбца. Чтобы включить сортировку, задайте для свойства GridView значение **true**.

Функции автоматического обновления, удаления и выбора включены при нажатии кнопки в поле столбца **буттонфиелд** или **TemplateField** с именем команды "Изменить", "Удалить" и "выбрать" соответственно. Элемент управления GridView может автоматически добавить поле столбца **CommandField** с кнопкой "Изменить", "Удалить" или "выбрать", если свойство Аутоженератидитбуттон, Аутоженератеделетебуттон или аутоженератеселектбуттон имеет значение **true**соответственно.

> [!NOTE]
> Вставка записей в источник данных напрямую не поддерживается элементом управления GridView. Однако можно вставить записи с помощью элемента управления GridView в сочетании с элементом управления DetailsView или FormView.

Вместо одновременного отображения всех записей в источнике данных элемент управления GridView может автоматически разбивать записи на страницы. Чтобы включить разбиение на страницы, присвойте свойству AllowPaging **значение true**.

## <a name="customizing-the-user-interface"></a>Настройка пользовательского интерфейса

Внешний вид элемента управления GridView можно настроить, задав свойства стиля для различных частей элемента управления. В следующей таблице перечислены различные свойства стиля.

| **Свойство Style** | **Описание** |
| --- | --- |
| алтернатингровстиле | Параметры стиля для чередующихся строк данных в элементе управления GridView. Если это свойство задано, строки данных отображаются с чередованием между параметрами Ровстиле и **алтернатингровстиле** . |
| едитровстиле | Параметры стиля для строки, редактируемой в элементе управления GridView. |
| емптидатаровстиле | Параметры стиля для пустой строки данных, отображаемой в элементе управления GridView, если источник данных не содержит записей. |
| футерстиле | Параметры стиля для строки нижнего колонтитула элемента управления GridView. |
| хеадерстиле | Параметры стиля для строки заголовка элемента управления GridView. |
| пажерстиле | Параметры стиля для строки пейджера элемента управления GridView. |
| ровстиле | Параметры стиля для строк данных в элементе управления GridView. Если также задано свойство **алтернатингровстиле** , строки данных отображаются между параметрами **ровстиле** и **алтернатингровстиле** . |
| селектедровстиле | Параметры стиля для выбранной строки в элементе управления GridView. |

Можно также показать или скрыть различные части элемента управления. В следующей таблице перечислены свойства, управляющие отображением или скрытием отображаемых частей.

| **Свойство** | **Описание** |
| --- | --- |
| шовфутер | Показывает или скрывает раздел нижнего колонтитула элемента управления GridView. |
| шовхеадер | Показывает или скрывает раздел заголовка элемента управления GridView. |

### <a name="events"></a>События

Элемент управления GridView предоставляет несколько событий, по которым можно программировать. Это позволяет запускать пользовательскую подпрограммы при каждом возникновении события. В следующей таблице перечислены события, поддерживаемые элементом управления GridView.

| **Событие** | **Описание** |
| --- | --- |
| пажеиндексчанжед | Происходит при нажатии одной из кнопок страничного навигатора, но после того, как элемент управления GridView обрабатывает операцию разбиения по страницам. Это событие часто используется, когда необходимо выполнить задачу после перехода пользователя на другую страницу в элементе управления. |
| пажеиндексчангинг | Происходит при нажатии одной из кнопок страничного навигатора, но до того, как элемент управления GridView обрабатывает операцию разбиения по страницам. Это событие часто используется для отмены операции разбиения на страницы. |
| ровканцелинжедит | Происходит при нажатии кнопки отмены строки, но до того, как элемент управления GridView выходит из режима редактирования. Это событие часто используется для прекращения отмены операции. |
| ровкомманд | Происходит при нажатии кнопки в элементе управления GridView. Это событие часто используется для выполнения задачи при нажатии кнопки в элементе управления. |
| ровкреатед | Происходит при создании новой строки в элементе управления GridView. Это событие часто используется для изменения содержимого строки при создании строки. |
| RowDataBound | Происходит, когда строка данных привязана к данным в элементе управления GridView. Это событие часто используется для изменения содержимого строки, когда строка привязана к данным. |
| RowDeleted | Происходит при нажатии кнопки удаления строки, но после того, как элемент управления GridView удаляет запись из источника данных. Это событие часто используется для проверки результатов операции удаления. |
| ровделетинг | Происходит при нажатии кнопки удаления строки, но до того, как элемент управления GridView удаляет запись из источника данных. Это событие часто используется для отмены операции удаления. |
| роведитинг | Происходит при нажатии кнопки Edit строки, но до того, как элемент управления GridView переходит в режим редактирования. Это событие часто используется для отмены операции редактирования. |
| RowUpdated | Происходит при нажатии кнопки обновления строки, но после того, как элемент управления GridView обновляет строку. Это событие часто используется для проверки результатов операции обновления. |
| RowUpdating | Происходит при нажатии кнопки обновления строки, но до того, как элемент управления GridView обновляет строку. Это событие часто используется для отмены операции обновления. |
| SelectedIndexChanged | Происходит при нажатии кнопки выбора строки, но после того, как элемент управления GridView обрабатывает операцию SELECT. Это событие часто используется для выполнения задачи после выбора строки в элементе управления. |
| селектединдексчангинг | Происходит при нажатии кнопки выбора строки, но до того, как элемент управления GridView обрабатывает операцию SELECT. Это событие часто используется для отмены операции выбора. |
| Сортированные. | Происходит при щелчке гиперссылки для сортировки столбца, но после того, как элемент управления GridView обрабатывает операцию сортировки. Это событие обычно используется для выполнения задачи после того, как пользователь щелкнет гиперссылку для сортировки столбца. |
| Сортировка | Происходит при щелчке гиперссылки для сортировки столбца, но до того, как элемент управления GridView обрабатывает операцию сортировки. Это событие часто используется для отмены операции сортировки или выполнения пользовательской подпрограммы сортировки. |

## <a name="formview"></a>C

Элемент управления FormView используется для вывода одной записи из источника данных. Он аналогичен элементу управления DetailsView, за исключением того, что он отображает определяемые пользователем шаблоны вместо полей строк. Создание собственных шаблонов обеспечивает большую гибкость в управлении отображением данных. Элемент управления FormView поддерживает следующие функции:

- Привязка к элементам управления источниками данных, таким как SqlDataSource и ObjectDataSource.
- Встроенные возможности вставки.
- Встроенные возможности обновления и удаления.
- Встроенные возможности разбиения на страницы.
- Программный доступ к объектной модели FormView для динамического задания свойств, управления событиями и т. д.
- Настраиваемый внешний вид с помощью определяемых пользователем шаблонов, тем и стилей.

## <a name="templates"></a>Шаблоны

Чтобы элемент управления FormView отображал содержимое, необходимо создать шаблоны для различных частей элемента управления. Большинство шаблонов являются необязательными. Однако необходимо создать шаблон для режима, в котором настроен элемент управления. Например, для элемента управления FormView, поддерживающего вставку записей, должен быть определен шаблон элемента INSERT. В следующей таблице перечислены различные шаблоны, которые можно создать.

| **Тип шаблона** | **Описание** |
| --- | --- |
| EditItemTemplate | Определяет содержимое для строки данных, если элемент управления FormView находится в режиме редактирования. Этот шаблон обычно содержит элементы управления вводом и командные кнопки, с помощью которых пользователь может изменять существующую запись. |
| емптидататемплате | Определяет содержимое для пустой строки данных, отображаемой, если элемент управления FormView привязан к источнику данных, который не содержит записей. Этот шаблон обычно содержит содержимое, чтобы предупредить пользователя о том, что источник данных не содержит записей. |
| футертемплате | Определяет содержимое для строки нижнего колонтитула. Этот шаблон обычно содержит любое дополнительное содержимое, которое вы хотите отобразить в строке нижнего колонтитула. В качестве альтернативы можно просто указать текст, отображаемый в строке нижнего колонтитула, задав свойство Футертекст. |
| HeaderTemplate | Определяет содержимое для строки заголовка. Этот шаблон обычно содержит любое дополнительное содержимое, которое вы хотите отобразить в строке заголовка. В качестве альтернативы можно просто указать текст, отображаемый в строке заголовка, задав свойство Хеадертекст. |
| ItemTemplate | Определяет содержимое для строки данных, если элемент управления FormView находится в режиме только для чтения. Этот шаблон обычно содержит содержимое для вывода значений существующей записи. |
| InsertItemTemplate | Определяет содержимое для строки данных, если элемент управления FormView находится в режиме вставки. Этот шаблон обычно содержит элементы управления вводом и командные кнопки, с помощью которых пользователь может добавить новую запись. |
| пажертемплате | Определяет содержимое строки пейджера, отображаемой при включенной функции разбиения по страницам (если свойство AllowPaging имеет значение **true**). Этот шаблон обычно содержит элементы управления, с помощью которых пользователь может переходить к другой записи. |

Элементы управления вводом в шаблоне "изменить шаблон элемента" и "вставить элемент" можно привязать к полям источника данных с помощью выражения двусторонней привязки. Это позволяет элементу управления FormView автоматически извлекать значения элемента управления вводом для операции обновления или вставки. Выражения с двумя способами привязки также позволяют элементам управления вводом в шаблоне элемента редактирования автоматически отображать исходные значения полей.

### <a name="binding-to-data"></a>Привязка к данным

Элемент управления FormView может быть привязан к элементу управления источника данных (например, **SqlDataSource**, AccessDataSource, **ObjectDataSource** и т. д.) или к любому источнику данных, реализующему интерфейс System. Collections. IEnumerable (например, System. Data. DataView, System. Collections. ArrayList и System. Collections. Hashtable). Используйте один из следующих методов для привязки элемента управления FormView к соответствующему типу источника данных:

- Чтобы выполнить привязку к элементу управления источником данных, задайте для свойства DataSourceID элемента управления FormView значение идентификатора элемента управления источника данных. Элемент управления FormView автоматически привязывается к заданному элементу управления источником данных и может использовать преимущества возможностей элемента управления источниками данных для выполнения операций вставки, обновления, удаления и разбиения на страницы. Это предпочтительный метод для привязки к данным.
- Чтобы выполнить привязку к источнику данных, реализующему интерфейс **System. Collections. IEnumerable** , программно установите свойство DataSource элемента управления FormView на источник данных, а затем вызовите метод DataBind. При использовании этого метода элемент управления FormView не предоставляет встроенные функции вставки, обновления, удаления и разбиения на страницы. Эти функции необходимо предоставить с помощью соответствующего события.

## <a name="data-operations"></a>Операции с данными

Элемент управления FormView предоставляет множество встроенных возможностей, позволяющих пользователю обновлять, удалять, вставлять и пролистывать элементы в элементе управления. Когда элемент управления FormView привязан к элементу управления источником данных, элемент управления FormView может использовать возможности элемента управления источниками данных и предоставлять функции автоматического обновления, удаления, вставки и разбиения на страницы. Элемент управления FormView может обеспечивать поддержку операций обновления, удаления, вставки и разбиения на страницы с другими типами источников данных. Однако необходимо предоставить соответствующий обработчик событий с реализацией для этих операций.

Поскольку элемент управления FormView использует шаблоны, он не предоставляет способ автоматического создания командных кнопок для выполнения операций обновления, удаления или вставки. Вы должны вручную включить эти командные кнопки в соответствующий шаблон. Элемент управления FormView распознает определенные кнопки, свойства **CommandName** которых установлены на определенные значения. В следующей таблице перечислены командные кнопки, распознаваемые элементом управления FormView.

| **Кнопка** | **CommandName, значение** | **Описание** |
| --- | --- | --- |
| Отмена | Отмены | Используется в операциях обновления или вставки для отмены операции и для отмены значений, вводимых пользователем. Затем элемент управления FormView возвращается в режим, заданный свойством DefaultMode. |
| DELETE | "Удалить" | Используется в операциях удаления для удаления отображаемой записи из источника данных. Вызывает события Итемделетинг и Итемделетед. |
| Изменить | Редактор | Используется в операциях обновления для помещения элемента управления FormView в режим редактирования. Содержимое, указанное в свойстве **EditItemTemplate** , отображается для строки данных. |
| Вставить | Вставляет | Используется в операциях вставки, чтобы попытаться вставить новую запись в источник данных, используя значения, предоставленные пользователем. Вызывает события Итеминсертинг и Итеминсертед. |
| Создать | Новую | Используется в операциях вставки для помещения элемента управления FormView в режим вставки. Содержимое, указанное в свойстве **InsertItemTemplate** , отображается для строки данных. |
| Страница | Страниц | Используется в операциях подкачки для представления кнопки в строке пейджера, которая выполняет разбиение на страницы. Чтобы указать операцию разбиения по страницам, задайте для свойства **CommandArgument** кнопки значение "Далее", "назад", "первый", "последний" или индекс страницы, к которой осуществляется переход. Вызывает события Пажеиндексчангинг и Пажеиндексчанжед. |
| Update | Обновляют | Используется в операциях обновления, чтобы попытаться обновить отображаемую запись в источнике данных значениями, предоставленными пользователем. Вызывает события ItemUpdating и Итемупдатед. |

В отличие от кнопки Удалить (которая немедленно удаляет отображаемую запись) при нажатии кнопки изменить или создать элемент управления FormView переходит в режим редактирования или вставки соответственно. В режиме редактирования содержимое, содержащееся в свойстве **EditItemTemplate** , отображается для текущего элемента данных. Как правило, шаблон элемента редактирования определяется таким, что кнопка "Изменить" заменяется кнопкой "Обновить" и "Отмена". Элементы управления вводом, соответствующие типу данных поля (например, TextBox или элементу управления CheckBox), обычно отображаются со значением поля, которое пользователь должен изменить. Нажатие кнопки Обновить обновляет запись в источнике данных, а при нажатии кнопки Отмена все изменения отменяются.

Аналогично, содержимое, содержащееся в свойстве **InsertItemTemplate** , отображается для элемента данных, когда элемент управления находится в режиме вставки. Шаблон элемента вставки обычно определяется таким, что кнопка «Создать» заменяется кнопкой «Вставить» и «Отмена» и отображаются пустые элементы управления вводом, чтобы пользователь вводил значения для новой записи. При нажатии кнопки Вставить в источник данных вставляется запись, а при нажатии кнопки Отмена все изменения отменяются.

Элемент управления FormView предоставляет функцию разбиения по страницам, которая позволяет пользователю переходить к другим записям в источнике данных. Если этот параметр включен, строка страничного навигатора отображается в элементе управления FormView, который содержит элементы управления навигацией по страницам. Чтобы включить разбиение на страницы, присвойте свойству **AllowPaging** **значение true**. Можно настроить строку страничного навигатора, задав свойства объектов, содержащихся в свойствах Пажерстиле и Пажерсеттингс. Вместо использования встроенного пользовательского интерфейса строки страничного навигатора можно создать собственный пользовательский интерфейс с помощью свойства **пажертемплате** .

## <a name="customizing-the-user-interface"></a>Настройка пользовательского интерфейса

Внешний вид элемента управления FormView можно настроить, задав свойства стиля для различных частей элемента управления. В следующей таблице перечислены различные свойства стиля.

| **Свойство Style** | **Описание** |
| --- | --- |
| едитровстиле | Параметры стиля для строки данных, если элемент управления FormView находится в режиме редактирования. |
| емптидатаровстиле | Параметры стиля для пустой строки данных, отображаемой в элементе управления FormView, если источник данных не содержит записей. |
| футерстиле | Параметры стиля для строки нижнего колонтитула элемента управления FormView. |
| хеадерстиле | Параметры стиля для строки заголовка элемента управления FormView. |
| инсертровстиле | Параметры стиля для строки данных, если элемент управления FormView находится в режиме вставки. |
| пажерстиле | Параметры стиля строки страничного навигатора, отображаемой в элементе управления FormView, если включена функция разбиения по страницам. |
| ровстиле | Параметры стиля для строки данных, если элемент управления FormView находится в режиме только для чтения. |

## <a name="events"></a>События

Элемент управления FormView предоставляет несколько событий, по которым можно программировать. Это позволяет запускать пользовательскую подпрограммы при каждом возникновении события. В следующей таблице перечислены события, поддерживаемые элементом управления FormView.

| **Событие** | **Описание** |
| --- | --- |
| ItemCommand | Происходит при щелчке кнопки в элементе управления FormView. Это событие часто используется для выполнения задачи при нажатии кнопки в элементе управления. |
| ItemCreated | Происходит после создания всех объектов Формвиевров в элементе управления FormView. Это событие часто используется для изменения значений записи перед ее отображением. |
| итемделетед | Возникает, когда нажата кнопка удаления (кнопка со свойством **CommandName** , равная "Удалить"), но после того, как элемент управления FormView удалит запись из источника данных. Это событие часто используется для проверки результатов операции удаления. |
| итемделетинг | Происходит при нажатии кнопки удаления, но до того, как элемент управления FormView удалит запись из источника данных. Это событие часто используется для отмены операции удаления. |
| итеминсертед | Возникает, когда нажата кнопка вставки (кнопка со свойством **CommandName** , равная INSERT), но после вставки записи в элемент управления FormView. Это событие часто используется для проверки результатов операции вставки. |
| итеминсертинг | Происходит при нажатии кнопки вставки, но до вставки записи в элемент управления FormView. Это событие часто используется для отмены операции вставки. |
| итемупдатед | Возникает при нажатии кнопки обновления (кнопка со свойством **CommandName** , равным "Обновить"), но после того, как элемент управления FormView обновляет строку. Это событие часто используется для проверки результатов операции обновления. |
| ItemUpdating | Происходит при нажатии кнопки обновления, но до того, как элемент управления FormView обновляет запись. Это событие часто используется для отмены операции обновления. |
| модечанжед | Происходит после изменения режимов элемента управления FormView (для редактирования, вставки или режима только для чтения). Это событие часто используется для выполнения задачи при изменении режима элемента управления FormView. |
| модечангинг | Происходит перед изменением режимов в элементе управления FormView (для редактирования, вставки или режима только для чтения). Это событие часто используется для отмены изменения режима. |
| пажеиндексчанжед | Происходит при нажатии одной из кнопок страничного навигатора, но после того, как элемент управления FormView обрабатывает операцию разбиения по страницам. Это событие часто используется, когда необходимо выполнить задачу после перехода пользователя к другой записи в элементе управления. |
| пажеиндексчангинг | Происходит при нажатии одной из кнопок страничного навигатора, но до того, как элемент управления FormView обрабатывает операцию разбиения по страницам. Это событие часто используется для отмены операции разбиения на страницы. |

## <a name="detailsview"></a>DetailsView

Элемент управления DetailsView используется для отображения одной записи из источника данных в таблице, где каждое поле записи отображается в строке таблицы. Его можно использовать в сочетании с элементом управления GridView для сценариев "основной/подробности". Элемент управления DetailsView поддерживает следующие функции:

- Привязка к элементам управления источниками данных, например SqlDataSource.
- Встроенные возможности вставки.
- Встроенные возможности обновления и удаления.
- Встроенные возможности разбиения на страницы.
- Программный доступ к объектной модели DetailsView для динамического задания свойств, управления событиями и т. д.
- Настраиваемый внешний вид с помощью тем и стилей.

## <a name="row-fields"></a>Поля строк

Каждая строка данных в элементе управления DetailsView создается путем объявления элемента управления поля. Различные типы полей строк определяют поведение строк в элементе управления. Элементы управления полями являются производными от DataControlField. В следующей таблице перечислены различные типы полей строк, которые можно использовать.

| **Тип поля столбца** | **Описание** |
| --- | --- |
| BoundField | Отображает значение поля в источнике данных в виде текста. |
| ButtonField | Отображает кнопку команды в элементе управления DetailsView. Это позволяет отобразить строку с пользовательским элементом управления "Кнопка", например "Добавить" или "Удалить". |
| CheckBoxField | Отображает флажок в элементе управления DetailsView. Этот тип поля строки обычно используется для вывода полей с логическим значением. |
| CommandField | Отображает встроенные командные кнопки для выполнения операций правки, вставки или удаления в элементе управления DetailsView. |
| HyperLinkField | Отображает значение поля в источнике данных в виде гиперссылки. Этот тип поля строки позволяет привязать второе поле к URL-адресу гиперссылки. |
| ImageField | Отображает изображение в элементе управления DetailsView. |
| TemplateField | Отображает определяемое пользователем содержимое для строки в элементе управления DetailsView в соответствии с заданным шаблоном. Этот тип поля строки позволяет создать настраиваемое поле строки. |

По умолчанию свойство Аутоженератеровс имеет значение **true**, которое автоматически создает привязанный объект поля строки для каждого поля связываемого типа в источнике данных. Допустимые типы, допускающие привязку, — String, DateTime, Decimal, GUID и набор типов-примитивов. Каждое поле затем отображается в строке в виде текста в том порядке, в котором каждое поле отображается в источнике данных.

Автоматическое создание строк предоставляет быстрый и простой способ отобразить каждое поле в записи. Однако, чтобы использовать расширенные возможности элемента управления DetailsView, необходимо явно объявить поля строк для включения в элемент управления DetailsView. Чтобы объявить поля строк, сначала установите для свойства **аутоженератеровс** **значение false**. Затем добавьте открывающие и закрывающие **поля&lt;&gt;** теги между открывающим и закрывающим тегами элемента управления DetailsView. Наконец, перечислите поля строк, которые необходимо включить между открывающим и закрывающим **полями&lt;&gt;** тегами. Указанные поля строк добавляются в коллекцию Fields в указанном порядке. Коллекция **Fields** позволяет программно управлять полями строк в элементе управления DetailsView.

> [!NOTE]
> Автоматически созданные поля строк не добавляются в коллекцию Fields.

## <a name="binding-to-data"></a>Привязка к данным

Элемент управления DetailsView может быть привязан к элементу управления источника данных, например **SqlDataSource** или AccessDataSource, или к любому источнику данных, реализующему интерфейс System. Collections. IEnumerable, например System. Data. DataView, System. Collections. ArrayList и System. Collections. Hashtable.

Используйте один из следующих методов для привязки элемента управления DetailsView к соответствующему типу источника данных:

- Чтобы выполнить привязку к элементу управления источником данных, задайте для свойства DataSourceID элемента управления DetailsView значение идентификатора элемента управления источника данных. Элемент управления DetailsView автоматически привязывается к указанному элементу управления источником данных. Это предпочтительный метод для привязки к данным.
- Чтобы выполнить привязку к источнику данных, реализующему интерфейс **System. Collections. IEnumerable** , программно установите свойство DataSource элемента управления DetailsView на источник данных, а затем вызовите метод DataBind.

## <a name="security"></a>безопасность

Этот элемент управления можно использовать для вывода вводимых пользователем данных, которые могут включать вредоносный клиентский скрипт. Проверьте все данные, отправляемые клиентом для исполняемого скрипта, инструкций SQL или другого кода, прежде чем отображать его в приложении. ASP.NET предоставляет функцию проверки входных запросов, которая блокирует скрипты и HTML-код при вводе данных пользователем.

## <a name="data-operations"></a>Операции с данными

Элемент управления DetailsView предоставляет встроенные возможности, позволяющие пользователю обновлять, удалять, вставлять и пролистывать элементы в элементе управления. Когда элемент управления DetailsView привязан к элементу управления источником данных, элемент управления DetailsView может использовать преимущества возможностей элемента управления источниками данных и предоставлять функции автоматического обновления, удаления, вставки и разбиения на страницы.

Элемент управления DetailsView может обеспечить поддержку операций обновления, удаления, вставки и разбиения на страницы с другими типами источников данных. Однако необходимо предоставить реализацию для этих операций в соответствующем обработчике событий.

Элемент управления DetailsView может автоматически добавить поле строки **CommandField** с кнопкой "Изменить", "Удалить" или "создать", задав для свойств Аутоженератидитбуттон, Аутоженератеделетебуттон или аутоженератеинсертбуттон **значение true**соответственно. В отличие от кнопки «Удалить» (которая немедленно удаляет выбранную запись) при нажатии кнопки «изменить» или «создать» элемент управления DetailsView переходит в режим «изменить» или «вставить» соответственно. В режиме редактирования кнопка "Изменить" заменяется кнопкой "Обновить" и "Отмена". Элементы управления вводом, соответствующие типу данных поля (например, TextBox или элементу управления CheckBox), отображаются со значением поля, которое пользователь должен изменить. Нажатие кнопки Обновить обновляет запись в источнике данных, а при нажатии кнопки Отмена все изменения отменяются. Аналогично, в режиме вставки кнопка "создать" заменяется кнопкой "вставить" и "Отмена", а также отображаются пустые элементы управления вводом, чтобы пользователь вводил значения для новой записи.

Элемент управления DetailsView предоставляет функцию разбиения по страницам, которая позволяет пользователю переходить к другим записям в источнике данных. Если этот флажок установлен, элементы управления навигацией по страницам отображаются в строке страничного навигатора. Чтобы включить разбиение на страницы, присвойте свойству AllowPaging **значение true**. Строку страничного навигатора можно настроить с помощью свойств Пажерстиле и Пажерсеттингс.

## <a name="customizing-the-user-interface"></a>Настройка пользовательского интерфейса

Внешний вид элемента управления DetailsView можно настроить, задав свойства стиля для различных частей элемента управления. В следующей таблице перечислены различные свойства стиля.

| **Свойство Style** | **Описание** |
| --- | --- |
| алтернатингровстиле | Параметры стиля для чередующихся строк данных в элементе управления DetailsView. Если это свойство задано, строки данных отображаются с чередованием между параметрами Ровстиле и **алтернатингровстиле** . |
| коммандровстиле | Параметры стиля для строки, содержащей встроенные кнопки команд в элементе управления DetailsView. |
| едитровстиле | Параметры стиля для строк данных, когда элемент управления DetailsView находится в режиме редактирования. |
| емптидатаровстиле | Параметры стиля для пустой строки данных, отображаемой в элементе управления DetailsView, если источник данных не содержит записей. |
| футерстиле | Параметры стиля для строки нижнего колонтитула элемента управления DetailsView. |
| хеадерстиле | Параметры стиля для строки заголовка элемента управления DetailsView. |
| инсертровстиле | Параметры стиля для строк данных, когда элемент управления DetailsView находится в режиме вставки. |
| пажерстиле | Параметры стиля для строки страничного навигатора элемента управления DetailsView. |
| ровстиле | Параметры стиля для строк данных в элементе управления DetailsView. Если также задано свойство **алтернатингровстиле** , строки данных отображаются между параметрами **ровстиле** и **алтернатингровстиле** . |
| фиелдхеадерстиле | Параметры стиля для столбца заголовка элемента управления DetailsView. |

## <a name="events"></a>События

Элемент управления DetailsView предоставляет несколько событий, по которым можно программировать. Это позволяет запускать пользовательскую подпрограммы при каждом возникновении события. В следующей таблице перечислены события, поддерживаемые элементом управления DetailsView. Элемент управления DetailsView также наследует эти события от своих базовых классов: DataBinding, DataBound, Disposed, init, Load, PreRender и Render.

| **Событие** | **Описание** |
| --- | --- |
| ItemCommand | Происходит при нажатии кнопки в элементе управления DetailsView. |
| ItemCreated | Происходит после создания всех объектов Детаилсвиевров в элементе управления DetailsView. Это событие часто используется для изменения значений записи перед ее отображением. |
| итемделетед | Происходит при нажатии кнопки удаления, но после того, как элемент управления DetailsView удаляет запись из источника данных. Это событие часто используется для проверки результатов операции удаления. |
| итемделетинг | Происходит при нажатии кнопки удаления, но до того, как элемент управления DetailsView удалит запись из источника данных. Это событие часто используется для отмены операции удаления. |
| итеминсертед | Происходит при нажатии кнопки вставки, но после вставки записи элементом управления DetailsView. Это событие часто используется для проверки результатов операции вставки. |
| итеминсертинг | Происходит при нажатии кнопки вставки, но до того, как элемент управления DetailsView вставит запись. Это событие часто используется для отмены операции вставки. |
| итемупдатед | Происходит при нажатии кнопки обновления, но после того, как элемент управления DetailsView обновляет строку. Это событие часто используется для проверки результатов операции обновления. |
| ItemUpdating | Происходит при нажатии кнопки обновления, но до того, как элемент управления DetailsView обновляет запись. Это событие часто используется для отмены операции обновления. |
| модечанжед | Происходит после изменения режима элемента управления DetailsView (редактирование, вставка или режим только для чтения). Это событие часто используется для выполнения задачи, когда элемент управления DetailsView изменяет режимы. |
| модечангинг | Происходит перед изменением режимов в элементе управления DetailsView (режим правки, вставки или режима только для чтения). Это событие часто используется для отмены изменения режима. |
| пажеиндексчанжед | Происходит при нажатии одной из кнопок страничного навигатора, но после того, как элемент управления DetailsView обрабатывает операцию разбиения по страницам. Это событие часто используется, когда необходимо выполнить задачу после перехода пользователя к другой записи в элементе управления. |
| пажеиндексчангинг | Происходит при нажатии одной из кнопок страничного навигатора, но до того, как элемент управления DetailsView обрабатывает операцию разбиения по страницам. Это событие часто используется для отмены операции разбиения на страницы. |

## <a name="the-menu-control"></a>Элемент управления Menu

Элемент управления Menu в ASP.NET 2,0 разработан как полнофункциональная система навигации. Можно легко привязать данные к иерархическим источникам данных, таким как SiteMapDataSource.

Структура элементов управления меню может быть определена декларативно или динамически и состоит из одного корневого узла и любого количества дочерних узлов. Следующий код декларативно определяет меню для элемента управления Menu.

[!code-aspx[Main](data-bound-controls/samples/sample4.aspx)]

В приведенном выше примере узлом Home. aspx является корневой узел. Все остальные узлы вкладываются в корневой узел на различных уровнях.

Существует два типа меню, которые может визуализировать элемент управления Menu. статические меню и динамические меню. Статические меню состоят из пунктов меню, которые всегда видимы. Динамические меню состоят из пунктов меню, которые видны, только когда пользователь наводит указатель мыши на них. Клиенты часто могут путать статические меню с меню, определенными декларативно и динамическими меню, с меню, которые привязаны к данным во время выполнения. Фактически динамические и статические меню не связаны с методом заполнения. Термины *static* и *dynamic* ссылаются только на то, отображается ли меню статически по умолчанию или отображается, только когда пользователь выполняет какое-либо действие.

Свойство **статикдисплайлевелс** используется для настройки того, сколько уровней меню является статическим, и, следовательно, отображается по умолчанию. В приведенном выше примере установка для свойства **статикдисплайлевелс** значения 2 приведет к тому, что меню будет статически отображать домашний узел, музыкальный узел и узел фильмы. Все остальные узлы будут динамически отображаться, когда пользователь наводит указатель мыши на родительский узел.

Свойство **максимумдинамикдисплайлевелс** настраивает максимальное число динамических уровней, которое может отображаться в меню. Все динамические меню на уровне выше, чем значение, заданное свойством **максимумдинамикдисплайлевелс** , отбрасываются.

> [!NOTE]
> Почти в некоторых случаях могут возникнуть ситуации, когда меню не отображаются для отображения из-за свойства Максимумдинамикдисплайлевелс. В таких случаях убедитесь, что свойство установлено достаточно, чтобы иметь возможность отображать меню заказчики.

## <a name="data-binding-the-menu-control"></a>Привязка данных к элементу управления Menu

Элемент управления Menu можно привязать к любому иерархическому источнику данных, например SiteMapDataSource или XMLDataSource. SiteMapDataSource является наиболее часто используемым методом привязки данных к элементу управления Menu, так как он выходит за пределы файла Web. Sitemap и его схемы предоставляет известный API для элемента управления Menu. В приведенном ниже списке показан простой файл Web. sitemap.

[!code-xml[Main](data-bound-controls/samples/sample5.xml)]

Обратите внимание, что существует только один корневой элемент siteMapNode, в данном случае элемент Home. Для каждого siteMapNode можно настроить несколько атрибутов. Чаще всего используются следующие атрибуты:

- **URL-адрес** Указывает URL-адрес, отображаемый при нажатии пользователем пункта меню. Если этот атрибут отсутствует, при нажатии узла будет просто выполнен обратный вызов.
- **название** Задает текст, отображаемый в пункте меню.
- **Описание** Используется в качестве документации для узла. Также отображается как всплывающая подсказка при наведении указателя мыши на узел.
- **ситемапфиле** Допускает наличие вложенных карт Sitemap. Этот атрибут должен указывать на файл ASP.NET карты правильного формата.
- **роли** Позволяет управлять внешним видом узла с помощью ASP.NETного усечения безопасности.

Обратите внимание, что хотя эти атрибуты являются необязательными, поведение меню может отличаться от ожидаемого, если они не указаны. Например, если атрибут *URL-адреса* указан, а атрибут *Description* — нет, узел не будет виден, а переходить к указанному URL-адресу будет невозможно.

## <a name="controlling-a-menus-operation"></a>Управление операцией с меню

Существует несколько свойств, влияющих на работу элемента управления Menu ASP.NET. Свойство **Orientation** , свойство **Дисаппеарафтер** , свойство **статиЦитемформатстринг** и свойство **статикпопаутимажеурл** являются лишь небольшими из них.

- **Ориентация** может быть задана *горизонтально* или *вертикально* и определяет, располагаются ли статические элементы меню горизонтально в строке или вертикально и помещаются друг над другом. Это свойство не влияет на динамические меню.
- Свойство **дисаппеарафтер** определяет время, в течение которого динамическое меню должно оставаться видимым после перемещения мыши из него. Значение указывается в миллисекундах, а по умолчанию — 500. Установка этого свойства в значение-1 приведет к тому, что меню никогда не исчезнет автоматически. В этом случае меню будет исчезать, только когда пользователь щелкнет за пределами меню.
- Свойство **статиЦитемформатстринг** упрощает поддержание единообразных формулировках в системе меню. При указании этого свойства *{0}* следует ввести вместо описания, отображаемого в источнике данных. Например, чтобы получить пункт меню из упражнения 1, перейдите на страницу Products и т. д., вы можете указать посетить нашу {0} страницу для СтатиЦитемформатстринг. Во время выполнения ASP.NET заменит все вхождения {0} с правильным описанием для пункта меню.
- Свойство **статикпопаутимажеурл** указывает изображение, которое используется для указания того, что определенный узел меню имеет дочерние узлы, к которым можно получить доступ, наведя на него указатель мыши. Динамические меню продолжат использовать изображение по умолчанию.

## <a name="templated-menu-controls"></a>Элементы управления шаблонным меню

Элемент управления Menu является шаблонным элементом управления и допускает два различных ItemTemplate; StaticItemTemplate и DynamicItemTemplate. С помощью этих шаблонов можно легко добавлять в меню элементы управления сервера или пользовательские элементы управления.

Чтобы изменить шаблоны в Visual Studio .NET, нажмите кнопку смарт-тег в меню и либо выберите изменить шаблоны. Затем можно выбрать между изменением StaticItemTemplate или DynamicItemTemplate.

Все элементы управления, добавленные в StaticItemTemplate, будут отображаться в статическом меню при загрузке страницы. Все элементы управления, добавленные в DynamicItemTemplate, будут отображаться во всех всплывающих меню.

## <a name="menu-events"></a>События меню

Элемент управления Menu содержит два уникальных события. **менуитемкликкед** и событие **менуитемдатабаунд** .

Событие Менуитемкликкед возникает при щелчке пункта меню. Событие Менуитемдатабаунд возникает, когда элемент меню имеет привязку к данным. **Менуевентаргс** , который передается обработчику событий, предоставляет доступ к элементу меню через свойство Item.

## <a name="controlling-a-menus-appearance"></a>Управление внешним видом меню

Можно также повлиять на внешний вид элемента управления Menu, используя один или несколько стилей, доступных для форматирования меню. К таким элементам относятся **статикменустиле**, **динамикменустиле**, **динамикменуитемстиле**, **динамикселектедстиле**и **динамичоверстиле**. Эти свойства настраиваются с помощью стандартной строки стиля HTML. Например, следующее повлияет на стиль динамических меню.

[!code-aspx[Main](data-bound-controls/samples/sample6.aspx)]

> [!NOTE]
> Если вы используете любой из стилей наведения, необходимо добавить элемент &lt;Head&gt; на страницу, если элемент *runat* установлен в значение *Server*.

Элементы управления Menu также поддерживают использование тем ASP.NET 2,0.

## <a name="the-treeview-control"></a>Элемент управления TreeView

Элемент управления TreeView отображает данные в древовидной структуре. Как и в случае с элементом управления Menu, он может быть легко привязан к любому иерархическому источнику данных, например SiteMapDataSource.

Первый вопрос, с которым заказчики, скорее всего, запросят об элементе управления TreeView в ASP.NET 2,0 — независимо от того, связан ли он с обозревателем Internet Explorer WebControl, доступным для ASP.NET 1. x. Нет. Элемент управления TreeView ASP.NET 2,0 был написан с нуля и предлагает значительное улучшение по сравнению с ранее доступной в IE TreeView.

Я не буду подробно рассматривать, как привязать элемент управления TreeView к карте узла, так как он выполняется точно так же, как и элемент управления Menu. Однако у элемента управления TreeView есть несколько различий в том, как он работает.

По умолчанию элемент управления TreeView отображается полностью развернутым. Чтобы изменить уровень расширения после начальной загрузки, измените свойство **експанддепс** элемента управления. Это особенно важно в случаях, когда TreeView имеет привязку к данным при раскрытии определенных узлов.

## <a name="databinding-the-treeview-control"></a>Привязка данных к элементу управления TreeView

В отличие от элемента управления Menu, TreeView хорошо подходит для обработки больших объемов данных. Таким образом, помимо привязки к SiteMapDataSource или XMLDataSource, TreeView часто привязывает данные к набору данных или другим реляционным данным. В случаях, когда элемент управления TreeView привязан к большим объемам данных, лучше привязывать его только к данным, которые на самом деле видны в элементе управления. Затем можно выполнить привязку данных к дополнительным данным, так как узлы TreeView развернуты.

В этих случаях свойство **PopulateOnDemand** дерева должно иметь значение *true*. Затем необходимо будет предоставить реализацию для метода **тринодепопулате** .

## <a name="data-binding-without-postback"></a>Привязка данных без обратной передачи

Обратите внимание, что при первом развертывании узла в предыдущем примере выполняется обратная передача и обновление страницы. Поддерживающие аттестацию не проблемой в этом примере, но можно предположить, что она может находиться в рабочей среде с большим объемом данных. Лучшим сценарием будет тот, в котором TreeView будет по-прежнему динамически заполнять свои узлы, но без обратной передачи на сервер.

Установив для свойств **популатенодесфромклиент** и **PopulateOnDemand** значение true, элемент управления TreeView будет динамически заполнять узлы без обратной передачи. Когда родительский узел развернут, выполняется запрос XMLHttp от клиента и инициируется событие Онтринодепопулате. Сервер реагирует на остров XML-данных, который затем используется для привязки данных дочерних узлов.

ASP.NET динамически создает клиентский код, реализующий эту функцию. Сценарий &lt;&gt; теги, которые содержат скрипт, создаются с указанием файла AXD. Например, в приведенном ниже списке показаны ссылки на скрипты для кода скрипта, который создает запрос XMLHttp.

[!code-html[Main](data-bound-controls/samples/sample7.html)]

Если вы просматриваете файл AXD выше в браузере и открыли его, вы увидите код, реализующий запрос XMLHttp. Этот метод не позволяет клиентам изменять файл скрипта.

## <a name="controlling-the-operation-of-the-treeview-control"></a>Управление работой элемента управления TreeView

Элемент управления TreeView имеет несколько свойств, влияющих на работу элемента управления. Наиболее очевидными являются свойства **шовчеккбоксес**, **шовекспандколлапсе**и **шовлинес**.

Свойство **шовчеккбоксес** определяет, отображает ли узлы флажок при подготовке к просмотру. Допустимыми значениями для этого свойства являются **None**, **root**, **Parent**, **листьев**и **ALL**. Они влияют на элемент управления TreeView следующим образом:

| **Значение свойства** | **Эффект** |
| --- | --- |
| None | Флажки не отображаются ни на одном узле. Это параметр по умолчанию. |
| Root | Флажок отображается только на корневом узле. |
| Parent | Флажок отображается только на тех узлах, которые имеют дочерние узлы. Эти дочерние узлы могут быть родительскими или конечными узлами. |
| Конечный элемент | Флажок отображается только для тех узлов, у которых нет дочерних узлов. |
| All | Флажок отображается на всех узлах. |

Когда используются флажки, свойство **чеккеднодес** Возвращает коллекцию узлов TreeView, которые проверяются при обратной передаче.

Свойство **шовекспандколлапсе** определяет внешний вид изображения развертывания и свертывания рядом с корневым и родительским узлами. Если это свойство имеет значение **false**, узлы TreeView подготавливаются к просмотру как гиперссылки и разворачиваются или сворачиваются путем щелчка по ссылке.

Свойство **шовлинес** определяет, отображаются ли линии, соединяющие родительские узлы с дочерними. Если **значение равно false** (значение по умолчанию), строки не отображаются. Если **значение равно true**, элемент управления TreeView будет использовать графики в папке, заданной свойством **линеимажесфолдер** .

Чтобы настроить внешний вид линий TreeView, в Visual Studio .NET 2005 имеется инструмент линейного конструктора. Доступ к этому средству можно получить с помощью кнопки смарт-тега в элементе управления TreeView, как показано ниже.

![](data-bound-controls/_static/image1.jpg)

**Рисунок 1**

Если выбрать пункт меню **Настройка изображений линий** , будет запущен инструмент линейный конструктор, позволяющий настроить внешний вид линий TreeView.

## <a name="treeview-events"></a>События TreeView

Элемент управления TreeView имеет следующие уникальные события:

- Селектеднодечанжед возникает при выборе узла на основе свойства **селектактион** .
- Тринодечеккчанжед возникает при изменении состояния флажков узлов.
- Тринодикспандед происходит при расширении узла на основе свойства **селектактион** .
- Тринодеколлапсед происходит при сворачивании узла.
- Тринодедатабаунд возникает, когда узел привязан к данным.
- Тринодепопулате происходит при заполнении узла.

Свойство **селектактион** позволяет настроить, какое событие запускается при выборе узла. Свойство Селектактион предоставляет следующие действия.

- Тринодеселектактион. Expand вызывает Тринодикспандед при выборе узла.
- Тринодеселектактион. None не создает событие при выборе узла.
- Тринодеселектактион. SELECT вызывает событие Селектеднодечанжед при выборе узла.
- Тринодеселектактион. SelectExpand вызывает событие Селектеднодечанжед и событие Тринодикспандед при выборе узла.

## <a name="controlling-appearance-with-styles"></a>Управление внешним видом с помощью стилей

Элемент управления TreeView предоставляет множество свойств для контроля внешнего вида элемента управления с помощью стилей. Доступны следующие свойства:

| **Имя свойства** | **Элементы управления** |
| --- | --- |
| ховернодестиле | Управляет стилем узлов при наведении указателя мыши на них. |
| леафнодестиле | Управляет стилем конечных узлов. |
| нодестиле | Управляет стилем для всех узлов. Определенные стили узлов (например, Леафнодестиле) переопределяют этот стиль. |
| парентнодестиле | Управляет стилем для всех родительских узлов. |
| рутнодестиле | Управляет стилем корневого узла. |
| селектеднодестиле | Управляет стилем выбранного узла. |

Каждое из этих свойств доступно только для чтения. Однако они будут возвращать объект **тринодестиле** , а свойства этого объекта можно изменить с помощью формата свойств *свойства* . Например, чтобы задать свойство **ForeColor** для **селектеднодестиле**, используйте следующий синтаксис:

[!code-aspx[Main](data-bound-controls/samples/sample8.aspx)]

Обратите внимание, что тег выше не закрыт. Это связано с тем, что при использовании декларативного синтаксиса, показанного здесь, необходимо также включить узлы TreeView в код HTML.

Свойства стиля также можно указать в коде, используя формат *Свойства. подсвойства* . Например, чтобы задать свойство **ForeColor** для **рутнодестиле** в коде, используйте следующий синтаксис:

[!code-csharp[Main](data-bound-controls/samples/sample9.cs)]

> [!NOTE]
> Полный список различных свойств стиля см. в документации MSDN по объекту Тринодестиле.

## <a name="the-sitemappath-control"></a>Элемент управления SiteMapPath

Элемент управления SiteMapPath предоставляет элемент управления навигации с навигацией для разработчиков ASP.NET. Как и другие элементы управления навигацией, они могут легко привязывать данные к иерархическим источникам данных, таким как SiteMapDataSource или XmlDataSource.

Элемент управления SiteMapPath состоит из объектов Ситемапнодеитем. Существует три типа узлов. Корневой узел, родительские узлы и текущий узел. Корневой узел — это узел в верхней части иерархической структуры. Текущий узел представляет текущую страницу. Все остальные узлы являются родительскими узлами.

## <a name="controlling-the-operation-of-the-sitemappath-control"></a>Управление работой элемента управления SiteMapPath

Ниже перечислены свойства, управляющие работой элемента управления SiteMapPath.

| **Свойство** | **Описание свойства** |
| --- | --- |
| парентлевелсдисплайед | Определяет, сколько родительских узлов отображается. Значение по умолчанию равно-1, что не накладывает ограничений на количество отображаемых родительских узлов. |
| пасдиректион | Управляет направлением SiteMapPath. Допустимые значения: Руттокуррент (по умолчанию) и Куррентторут. |
| пассепаратор | Строка, управляющая символом, разделяющем узлы в элементе управления SiteMapPath. Значение по умолчанию:. |
| рендеркуррентнодеаслинк | Логическое значение, которое определяет, визуализируется ли текущий узел как ссылка. Значение по умолчанию — False. |
| скиплинктекст | Помогает со специальными возможностями при просмотре страницы средствами чтения с экрана. Это свойство позволяет средствам чтения с экрана пропустить элемент управления SiteMapPath. Чтобы отключить эту функцию, присвойте свойству значение String. Empty. |

## <a name="templated-sitemappath-controls"></a>Шаблонные элементы управления SiteMapPath

Ситемапконтрол является шаблонным элементом управления и, таким образом, можно определить различные шаблоны для использования при отображении элемента управления. Чтобы изменить шаблоны в элементе управления SiteMapPath, нажмите кнопку смарт-тега на элементе управления и выберите пункт изменить шаблоны в меню. Откроется меню Ситемаптаскс, как показано ниже, где можно выбрать различные доступные шаблоны.

![](data-bound-controls/_static/image2.jpg)

**Рис. 2**

Шаблон **нодетемплате** ссылается на любой узел в SiteMapPath. Если узел является корневым или текущим узлом, а **рутнодетемплате** или **Куррентнодетемплате** настроен, нодетемплате переопределяется.

## <a name="sitemappath-events"></a>События SiteMapPath

Элемент управления SiteMapPath имеет два события, которые не являются производными от класса Control; событие **ItemCreated** и событие **ItemDataBound** . Событие ItemCreated возникает при создании элемента SiteMapPath. Исключение ItemDataBound возникает, когда метод DataBind вызывается во время привязки данных узла SiteMapPath. Объект **ситемапнодеитемевентаргс** предоставляет доступ к определенному ситемапнодеитем через свойство Item.

## <a name="controlling-appearance-with-styles"></a>Управление внешним видом с помощью стилей

Для форматирования элемента управления SiteMapPath доступны следующие стили.

| **Имя свойства** | **Элементы управления** |
| --- | --- |
| куррентнодестиле | Управляет стилем текста для текущего узла. |
| рутнодестиле | Управляет стилем текста для корневого узла. |
| нодестиле | Управляет стилем текста для всех узлов при условии, что Куррентнодестиле или Рутнодестиле не применяются. |

Свойство Нодестиле переопределяется как Куррентнодестиле, так и Рутнодестиле. Каждое из этих свойств доступно только для чтения и возвращает объект **стиля** . Чтобы повлиять на внешний вид узла с помощью одного из этих свойств, необходимо задать свойства объекта стиля, который будет возвращен. Например, приведенный ниже код изменяет свойство ForeColor текущего узла.

[!code-aspx[Main](data-bound-controls/samples/sample10.aspx)]

Свойство также может быть применено программным способом следующим образом:

[!code-csharp[Main](data-bound-controls/samples/sample11.cs)]

> [!NOTE]
> При применении шаблона стиль не будет применен.

## <a name="lab-1-configuring-an-aspnet-menu-control"></a>Лаборатория 1. Настройка элемента управления меню ASP.NET

1. Создайте новый веб-сайт.
2. Добавьте файл схемы узла, выбрав файл, создать, файл, а затем выберите пункт Схема сайта в списке шаблонов файлов.
3. Откройте карту веб-узла (Web. Sitemap по умолчанию) и измените ее, чтобы она выглядела так, как показано ниже. Страницы, на которые осуществляется связывание в файле сопоставления узла, не существуют, но это не будет проблемой для этого упражнения.

    [!code-xml[Main](data-bound-controls/samples/sample12.xml)]
4. Откройте веб-форму по умолчанию в представление конструирования.
5. Из раздела Навигация панели элементов добавьте новый элемент управления Menu на страницу.
6. В разделе данные области элементов добавьте новое поле SiteMapDataSource. SiteMapDataSource автоматически будет использовать файл Web. Sitemap на сайте. (Файл Web. Sitemap *должен* находиться в корневой папке сайта.)
7. Щелкните элемент управления меню, а затем нажмите кнопку смарт-тег, чтобы открыть диалоговое окно задачи меню.
8. В раскрывающемся списке Выбор источника данных выберите SiteMapDataSource1.
9. Щелкните ссылку Автоформат и выберите формат меню.
10. На панели Свойства присвойте свойству **статикдисплайлевелс** значение 2. Теперь элемент управления "меню" должен отобразить узел "Домашняя страница", "продукты" и "службы" в конструкторе.
11. Просмотрите страницу в браузере, чтобы использовать меню. (Поскольку страницы, добавленные в карту узла, на самом деле не существуют, при попытке перейти к ним появится сообщение об ошибке.)

Поэкспериментируйте с изменением свойств Статикдисплайлевелс и Максимумдинамикдисплайлевелс и Узнайте, как они влияют на отображение меню.

## <a name="lab-2-dynamically-binding-a-treeview-control"></a>Лаборатория 2. Динамическая привязка элемента управления TreeView

В этом упражнении предполагается, что у вас SQL Server выполняется локально и что база данных Northwind существует на экземпляре SQL Server. Если эти условия не выполняются, измените строку подключения в примере. Обратите внимание, что вместо доверенного соединения может также потребоваться указать SQL Server проверку подлинности.

1. Создайте новый веб-сайт.
2. Перейдите в представление кода Default. aspx и замените весь код приведенным ниже кодом. 

    [!code-aspx[Main](data-bound-controls/samples/sample13.aspx)]
3. Сохраните страницу как TreeView. aspx.
4. Просмотрите страницу.
5. При первом отображении страницы просмотрите исходный код страницы в браузере. Обратите внимание, что клиенту были отправлены только видимые узлы.
6. Щелкните знак «плюс» рядом с любым узлом.
7. Снова просмотрите исходный код на странице. Обратите внимание, что теперь отображаются только что отображаемые узлы.

## <a name="lab-3-details-view-and-editing-data-using-a-gridview-and-detailsview"></a>Лаборатория 3. Просмотр подробных сведений и изменение данных с помощью элементов управления GridView и DetailsView

1. Создайте новый веб-сайт.
2. Добавьте новый файл Web. config на веб-сайт.
3. Добавьте строку подключения в файл Web. config, как показано ниже. 

    [!code-xml[Main](data-bound-controls/samples/sample14.xml)]

    > [!NOTE]
    > Может потребоваться изменить строку подключения на основе среды.
4. Сохраните изменения и закройте файл web.config.
5. Откройте Default. aspx и добавьте новый элемент управления SqlDataSource.
6. Измените идентификатор элемента управления SqlDataSource на **Products**.
7. В меню **Задачи SqlDataSource** щелкните **Настройка источника данных**.
8. Выберите **Northwind** в раскрывающемся списке подключение и нажмите кнопку Далее.
9. Выберите **продукты** в раскрывающемся списке **имя** и установите флажки **ProductID**, **ProductName**, **UnitPrice**и **UnitsInStock** , как показано ниже. 

![](data-bound-controls/_static/image3.jpg)

    **Figure 3**
10. Щелкните **Далее**.
11. Нажмите кнопку **Готово**.
12. Перейдите в представление исходного кода и изучите созданный код. Обратите внимание на **SelectCommand**, **DeleteCommand**, **InsertCommand**и **UpdateCommand** , которые были добавлены в элемент управления SqlDataSource. Также обратите внимание на добавленные параметры.
13. Переключитесь на представление конструирования и добавьте новый элемент управления GridView на страницу.
14. В раскрывающемся списке **Выбор источника данных** выберите **продукты** .
15. Установите флажок **включить разбиение по страницам** и **включить выделение** , как показано ниже. 

![](data-bound-controls/_static/image4.jpg)

    **Figure 4**
16. Щелкните ссылку **изменить столбцы** и убедитесь, что флажок **автоматически создавать поля** установлен.
17. Нажмите кнопку **ОК**.
18. Выбрав элемент управления GridView, нажмите кнопку рядом со свойством **DataKeyNames** на панели свойств.
19. Выберите **ProductID** в списке **Доступные поля данных** и нажмите кнопку **&gt;** , чтобы добавить его.
20. Нажмите кнопку «ОК».
21. Добавьте новый элемент управления SqlDataSource на страницу.
22. Измените идентификатор элемента управления SqlDataSource на **Details**.
23. В меню Задачи SqlDataSource выберите пункт **настроить источник данных**.
24. Выберите **Northwind** в раскрывающемся списке и нажмите кнопку **Далее**.
25. Выберите <strong>продукты</strong> в раскрывающемся списке <strong>имя</strong> и установите флажок <strong>\</strong > * в списке <strong>столбцы</strong> .
26. Нажмите кнопку **WHERE** .
27. Выберите **ProductID** из раскрывающегося списка **столбцов** .
28. Выберите **=** в раскрывающемся списке Оператор.
29. Выберите **элемент управления** из раскрывающегося списка **источник** .
30. Выберите **GridView1** в раскрывающемся списке **идентификатор элемента управления** .
31. Нажмите кнопку **Добавить** , чтобы добавить предложение WHERE.
32. Нажмите кнопку **ОК**.
33. Нажмите кнопку " **Дополнительно** " и установите флажок " **создать ОПЕРАТОРЫ вставки, обновления и удаления** ".
34. Нажмите кнопку **ОК**.
35. Нажмите кнопку **Далее** и кнопку **Готово**.
36. Добавьте на страницу элемент управления DetailsView.
37. В раскрывающемся списке **Выбор источника данных** выберите **сведения**.
38. Установите флажок **включить редактирование** , как показано ниже. 

![](data-bound-controls/_static/image1.gif)

    **Figure 5**
39. Сохраните страницу и перейдите по умолчанию. aspx.
40. Щелкните ссылку **выбрать** рядом с другими записями, чтобы увидеть обновление DetailsView автоматически.
41. Щелкните ссылку **Edit (изменить** ) в элементе управления DetailsView.
42. Внесите изменения в запись и нажмите кнопку **Обновить**.
