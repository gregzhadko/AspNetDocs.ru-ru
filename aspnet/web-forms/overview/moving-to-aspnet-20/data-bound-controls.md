---
uid: web-forms/overview/moving-to-aspnet-20/data-bound-controls
title: Контроль связанных данных (ru) Документы Майкрософт
author: rick-anderson
description: Большинство ASP.NET приложений полагаются на некоторую степень представления данных из резервного источника данных. Управление, связанное с данными, является ключевой частью взаимодействия w. .
ms.author: riande
ms.date: 02/20/2005
ms.assetid: 0e23ff32-646d-43f3-8bec-6b2313d3abd6
msc.legacyurl: /web-forms/overview/moving-to-aspnet-20/data-bound-controls
msc.type: authoredcontent
ms.openlocfilehash: 941e2ed15b3da28991e7b06cbab570eb1b5b8899
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2020
ms.locfileid: "81543084"
---
# <a name="data-bound-controls"></a>Элементы управления привязкой к данным

[корпорацией Майкрософт](https://github.com/microsoft)

> Большинство ASP.NET приложений полагаются на некоторую степень представления данных из резервного источника данных. Контроль, связанный с данными, является ключевой частью взаимодействия с данными в динамических web-приложениях. ASP.NET 2.0 вносит некоторые существенные улучшения в управление, связанное с данными, включая новый класс BaseDataBoundControl и декларативный синтаксис.

Большинство ASP.NET приложений полагаются на некоторую степень представления данных из резервного источника данных. Контроль, связанный с данными, является ключевой частью взаимодействия с данными в динамических web-приложениях. ASP.NET 2.0 вносит некоторые существенные улучшения в управление, связанное с данными, включая новый класс BaseDataBoundControl и декларативный синтаксис.

Базовый базовый класс BaseDataBoundControl выступает в качестве базового класса для класса DataBoundControl и класса HierarchicalDataBoundControl. В этом модуле мы обсудим следующие классы, вытекающие из DataBoundControl:

- AdRotator
- Элементы управления списками
- GridView
- Formview
- Detailsview

Мы также обсудим следующие классы, которые вытекают из класса HierarchicalDataBoundControl:

- TreeView
- Меню
- SiteMapPath

## <a name="databoundcontrol-class"></a>DataBoundControl Класс

Класс DataBoundControl — это абстрактный класс (отмеченный MustInherit в VB), используемый для взаимодействия с табликами или данными в стиле списка. Следующие элементы управления являются некоторые из элементов управления, которые вытекают из DataBoundControl.

## <a name="adrotator"></a>AdRotator

Управление AdRotator позволяет отображать графический баннер на веб-странице, которая связана с определенным URL. Отображаемый график вращается с использованием свойств для управления. Частота отображения конкретного объявления на странице может быть настроена с помощью свойства **"Впечатления",** а объявления можно отфильтровать с помощью фильтрации ключевых слов.

Элементы управления AdRotator используют файл XML или таблицу в базе данных для данных. Следующие атрибуты используются в файлах XML для настройки управления AdRotator.

### <a name="imageurl"></a>ImageUrl
URL-адрес изображения для отображения для рекламы.

### <a name="navigateurl"></a>Navigateurl
URL-адрес, на который пользователь должен быть доставлен при нажатии на объявление. Это должно быть закодировано URL.

### <a name="alternatetext"></a>AlternateText
Альтернативный текст, отображаемый в наборе инструментов и прочитанный читателями экрана. Также отображает, когда изображение, указанное ImageUrl не доступно.

### <a name="keyword"></a>Ключевое слово
Определяет ключевое слово, которое может быть использовано при использовании фильтрации ключевых слов. Если указано, будут отображаться только те объявления с ключевым словом, соответствующим фильтру ключевого слова.

### <a name="impressions"></a>Просмотры
Номер взвешивания, определяющий, как часто может появиться конкретное объявление. Это относительно впечатления от других объявлений в том же файле. Максимальная стоимость коллективных показов для всех объявлений в файле XML составляет 2 048 000 000 1.

### <a name="height"></a>Высота:
Высота рекламы в пикселях.

### <a name="width"></a>Ширина
Ширина рекламы в пикселях.

> [!NOTE]
> Атрибуты высоты и ширины переопределяют высоту и ширину для самого управления AdRotator.

Типичный файл XML может выглядеть следующим образом:

[!code-xml[Main](data-bound-controls/samples/sample1.xml)]

В приведенном выше примере объявление для Contoso в два раза чаще появляется, чем объявление для веб-сайта ASP.NET из-за значения атрибута «Впечатления».

Чтобы отобразить рекламу из вышеупомянутого файла XML, добавьте элемент управления AdRotator на страницу и установите свойство **AdvertisementFile,** чтобы указать на файл XML, как показано ниже:

[!code-aspx[Main](data-bound-controls/samples/sample2.aspx)]

Если вы решите использовать таблицу базы данных в качестве источника данных для управления AdRotator, сначала необходимо настроить базу данных, используя следующую схему:

| **Название колонки** | **Тип данных** | **Описание** |
| --- | --- | --- |
| ID | INT | Первичный ключ. Этот столбец может иметь любое имя. |
| ImageUrl | nvarchar *(длина)* | Относительный или абсолютный URL изображения для отображения для рекламы. |
| Navigateurl | nvarchar *(длина)* | Целевой URL для рекламы. Если вы не предоставляете значение, объявление не является гиперссылкой. |
| AlternateText | nvarchar *(длина)* | Текст отображается, если изображение не может быть найдено. В некоторых браузерах текст отображается в виде ToolTip. Альтернативный текст также используется для доступности, так что пользователи, которые не могут видеть графический может услышать его описание читать вслух. |
| Ключевое слово | nvarchar *(длина)* | Категория для объявления, на которой страница может фильтровать. |
| Просмотры | int (4) | Номер, указывающий вероятность отображения частого показа рекламы. Чем больше число, тем чаще будет отображаться объявление. Общее количество значений всех показов в файле XML не может превышать 2 048 000 000 - 1. |
| Ширина | int (4) | Ширина изображения в пикселях. |
| Высота: | int (4) | Высота изображения в пикселях. |

В тех случаях, когда у вас уже есть база данных с другой схемой, вы можете использовать свойства **AlternateTextField,** **ImageUrlField**и **NavigateUrlField** для отображения атрибутов AdRotator в существующую базу данных. Чтобы отобразить данные из базы данных в управлении AdRotator, добавьте элемент управления источником данных на страницу, настройте строку соединения для управления источником данных, чтобы указать на базу данных, и установите свойство **DataSourceID** управления AdRotator в идентификатор управления исходным элементом данных. В тех случаях, когда вам необходимо настраивать объявления AdRotator программно, используйте событие AdCreated. Событие AdCreated занимает два параметра; один объект, а другой экземпляр AdCreatedEventArgs. AdCreatedEventArgs является отсылкой к создаваемому рекламе.

Следующий фрагмент кода устанавливает ImageUrl, NavigateUrl и AlternateText для рекламы программно:

[!code-csharp[Main](data-bound-controls/samples/sample3.cs)]

## <a name="list-controls"></a>Элементы управления списками

Элементы управления списками включают ListBox, DropDownList, CheckBoxList, RadioButtonList и BulletedList. Каждый из этих элементов управления может быть данными, связанными с источником данных. Они используют одно поле в источнике данных в качестве текста отображения и могут дополнительно использовать второе поле в качестве значения элемента. Элементы также могут быть добавлены статично во время проектирования, и вы можете смешивать статические элементы и динамические элементы, добавленные из источника данных.

Чтобы данные связывали элемент управления список, добавьте элемент управления источниками данных на страницу. Укажите команду SELECT для управления источником данных, а затем установите свойство DataSourceID управления списком в идентификатор управления источником данных. Для определения текста дисплея и значения элемента управления используйте свойства **DataTextField** и **DataValueField.** Кроме того, вы можете использовать свойство **DataTextFormatString** для управления внешним видом текста дисплея следующим образом:

| **Выражение** | **Описание** |
| --- | --- |
| Цена:{0:C} | Для численных/десятичных данных. Отображает буквальную "Цена:" с последующими номерами в валютном формате. Формат валюты зависит от настройки культуры, указанной в атрибуте культуры в директиве **Страницы** или в файле Web.config. |
| {0:D4} | Для неопроменяемых данных. Не может быть использован с десятичными числами. В поле с нулевым проложени, шириной четыре символа, отображаются ряды. |
| {0:N2}% | Для числовых данных. Отображает номер с точностью 2-десятичной места, а затем буквальное "%". |
| {0:000.0} | Для численных/десятичных данных. Числа округлены в одно десятичное место. Числа, меньшие чем трехзначные, заполняются нулями. |
| {0:D} | Для данных о дате/времени. Отображает формат длинной даты ("Четверг, 06 августа 1996"). Формат даты зависит от параметра языка и региональных параметров в файле Web.config. |
| {0:d} | Для данных о дате/времени. Отображает короткий формат даты ("12/31/99"). |
| {0:гг-мм-дд} | Для данных о дате/времени. Дата отображения в формате числового месяца (96-08-06) |

## <a name="gridview"></a>GridView

Контроль GridView позволяет отображать и редактировать табулярные данные с использованием декларативного подхода и является преемником управления DataGrid. Следующие функции доступны в управлении GridView.

- Привязка к элементам управления источниками данных, таким как SqlDataSource.
- Встроенные возможности сортировки.
- Встроенные возможности обновления и удаляния.
- Встроенные возможности paging.
- Встроенные возможности выбора строки.
- Программный доступ к объектной модели GridView динамически устанавливает свойства, обрабатывает события и так далее.
- Несколько ключевых полей.
- Несколько полей данных для столбцов гиперссылок.
- Настраиваемый внешний вид через темы и стили.

**Полей колонн**

Каждая колонка в управлении GridView представлена объектом DataControlField. По умолчанию свойство AutoGenerateColumns настроено на **достоверность,** что создает объект AutoGeneratedField для каждого поля в источнике данных. Каждое поле затем отображается в качестве столбца в управлении GridView в порядке, который каждое поле отображается в источнике данных. Вы также можете вручную управлять полями столбцов, которые отображаются в управлении **GridView,** установив свойство **AutoGenerateColumns** на **ложное** и определив собственную коллекцию полей столбцов. Различные типы полей столбцов определяют поведение столбцов в элементе управления.

В следующей таблице перечислены различные типы полей столбцов, которые могут быть использованы.

| **Тип поля столбца** | **Описание** |
| --- | --- |
| BoundField | Отображает значение поля в источнике данных. Это тип столбца по умолчанию управления GridView. |
| ButtonField | Отображает кнопку команды для каждого элемента в управлении GridView. Это позволяет создать столбец пользовательских элементов управления кнопками, таких как кнопка Добавить или Удалить. |
| CheckBoxField | Отображает флажок для каждого элемента в элементе управления GridView. Этот тип поля столбца обычно используется для отображения полей со значением Boolean. |
| CommandField | Отображает предопределенные кнопки команды для выполнения операций выбора, редактирования или удаляния. |
| HyperLinkField | Отображает значение поля в источнике данных в качестве гиперссылки. Этот тип поля столбца позволяет привязать второе поле к URL-адресу гиперссылки. |
| ImageField | Отображает изображение для каждого элемента в управлении GridView. |
| ШаблонФилд | Отображает пользовательский контент для каждого элемента в управлении GridView в соответствии с указанным шаблоном. Этот тип поля столбцов позволяет создать пользовательское поле столбцов. |

Чтобы декларативно определить собрание полей столбцов, сначала добавьте ** &lt;теги&gt; ** открытия и закрытия столбцов между тегами открытия и закрытия управления GridView. Далее перечислите поля столбцов, которые необходимо включить между тегами открытия и закрытия ** &lt;столбцов.&gt; ** Указанные столбцы добавляются в коллекцию колонн в перечисленном порядке. Коллекция **столбцов** хранит все поля столбцов в элементе управления и позволяет программно управлять полями столбцов в управлении GridView.

Явно заявленные поля столбцов могут отображаться в сочетании с автоматически генерируемыми полями столбцов. При использовании обоих полей явно объявленные столбцовы отображаются сначала, за которыми следуют автоматически генерируемые поля столбцов.

## <a name="binding-to-data"></a>Привязка к данным

Контроль GridView может быть привязан к управлению исходным элементом данных (например, **SqlDataSource,** **ObjectDataSource**и так далее), а также с любым источником данных, который реализует интерфейс System.Collections.IEnumerable (например, System.Data.DataView, System.Collections.ArrayList или System.Collections.Hashtable). Используйте один из следующих методов, чтобы связать элемент управления GridView с соответствующим типом источника данных:

- Чтобы привязаться к управлению источником данных, установите свойство DataSourceID управления GridView к идентификатору значения управления источником данных. Контроль GridView автоматически привязывается к указанному элементу управления источниками данных и может воспользоваться возможностями управления источниками данных для выполнения функций сортировки, обновления, удаляния и paging. Это предпочтительный способ привязки к данным.
- Чтобы привязаться к источнику данных, который реализует интерфейс System.Collections.IEnumerable, программно установите свойство DataSource управления GridView к источнику данных, а затем вызовите метод DataBind. При использовании этого метода элемент управления GridView не обеспечивает встроенную сортировку, обновление, удаляние и функциональность paging. Вы должны предоставить эту функциональность самостоятельно.

## <a name="data-operations"></a>Операции с данными

Контроль GridView предоставляет множество встроенных возможностей, которые позволяют пользователю сортировать, обновлять, удалять, выбирать и просматривать элементы управления. Когда управление GridView привязано к управлению источником данных, элемент управления GridView может воспользоваться возможностями управления источниками данных и обеспечить автоматическую сортировку, обновление и удаляние функциональности.

> [!NOTE]
> Элемент управления GridView может обеспечить поддержку сортировки, обновления и удаляния с помощью других типов источников данных; однако необходимо предоставить соответствующий обработчик событий с реализацией этих операций.

Сортировка позволяет пользователю сортировать элементы в управлении GridView по отношению к определенной колонке, нажав на заголовок столбца. Для обеспечения сортировки установите **true**свойство AllowSorting.

Функции автоматического обновления, удаления и выбора включены при нажатии кнопки в поле столбца **ButtonField** или **TemplateField** с названием команды "Edit", "Delete" и "Select". Элемент управления GridView может автоматически добавлять поле столбца **CommandField** с кнопкой «Отображчик, удаление или выберите», если свойство AutoGenerateEditButton, AutoGenerateDeleteButton или AutoGenerateSelectButton будет **соответствовать действительности,** соответственно.

> [!NOTE]
> Вставка записей в источник данных напрямую не поддерживается управлением GridView. Тем не менее, можно вставить записи с помощью управления GridView в сочетании с управлением DetailsView или FormView.

Вместо того, чтобы отображать все записи в источнике данных одновременно, контроль GridView может автоматически разбивать записи на страницы. Для включения в действие paging установите свойство AllowPaging **true.**

## <a name="customizing-the-user-interface"></a>Настройка пользовательского интерфейса

Вы можете настроить внешний вид управления GridView, установив свойства стиля для различных частей управления. В следующей таблице перечислены различные свойства стиля.

| **Стиль собственности** | **Описание** |
| --- | --- |
| ЧередованиеРоустиль | Настройки стиля для чередующихся строк данных в управлении GridView. При наборе этого свойства строки данных отображаются поочередно между настройками RowStyle и настройками **AlternatingRowStyle.** |
| EditRowStyle | Настройки стиля для строки, редактируемые в управлении GridView. |
| EmptyDataRowStyle | Параметры стиля для пустой строки данных, отображаемые в элементе управления GridView, когда источник данных не содержит записей. |
| FooterStyle | Настройки стиля для колонтитула управления GridView. |
| ЗаголовокСтиль | Настройки стиля для строки заголовка управления GridView. |
| PagerStyle | Настройки стиля для строки пейджера управления GridView. |
| РоуСтиль | Настройки стилей для строк данных в управлении GridView. При установке свойства **AlternatingRowStyle** строки данных отображаются между настройками **RowStyle** и настройками **AlternatingRowStyle.** |
| ВыбранныйРоуСтиль | Настройки стиля для выбранной строки в управлении GridView. |

Вы также можете показать или скрыть различные части элемента управления. В следующей таблице перечислены свойства, контролирующие, какие части отображаются или скрыты.

| **Свойство** | **Описание** |
| --- | --- |
| Шоуфутер | Показывает или скрывает секцию колонтитула управления GridView. |
| ShowHeader | Отображает или скрывает заголовок раздела управления GridView. |

### <a name="events"></a>События

Контроль GridView предоставляет несколько событий, которые можно запрограммировать против. Это позволяет запускать пользовательские рутины всякий раз, когда происходит событие. В следующей таблице перечислены события, поддерживаемые управлением GridView.

| **событие** | **Описание** |
| --- | --- |
| PageIndexChanged | Происходит при нажатии одной из кнопок пейджера, но после того, как управление GridView обрабатывает операцию paging. Это событие обычно используется, когда вам нужно выполнить задачу после того, как пользователь переходит на другую страницу в элементе управления. |
| PageIndexChanging | Происходит при нажатии одной из кнопок пейджера, но до того, как управление GridView обрабатывает операцию paging. Это событие часто используется для отмены операции paging. |
| РоуКнесингЭдит | Происходит при нажатии кнопки отмены строки, но до того, как управление GridView выходит из режима отодевать. Это событие часто используется для остановки операции отмены. |
| РоуКомот | Происходит при нажатии кнопки в управлении GridView. Это событие часто используется для выполнения задачи при нажатии кнопки в элементе управления. |
| RowCreated | Происходит при создании новой строки в управлении GridView. Это событие часто используется для изменения содержимого строки при создании строки. |
| RowDataBound | Происходит, когда строка данных привязана к данным в управлении GridView. Это событие часто используется для изменения содержимого строки, когда строка привязана к данным. |
| РоуУдалд | Происходит при нажатии кнопки «Удалить строку», но после того, как элемент gridView удаляет запись из источника данных. Это событие часто используется для проверки результатов операции удаления. |
| РоуДелединг | Происходит при нажатии кнопки «Удалить строку», но до того, как элемент управления GridView удаляет запись из источника данных. Это событие часто используется для отмены операции дегтирования. |
| СтрокаРедактирование | Происходит при нажатии кнопки "Отметка" строки, но до того, как управление GridView вводит режим отодевного элемента. Это событие часто используется для отмены операции редактирования. |
| RowUpdated | Происходит при нажатии кнопки обновления строки, но после того, как управление GridView обновляет строку. Это событие часто используется для проверки результатов операции обновления. |
| РоуUpdating | Происходит при нажатии кнопки обновления строки, но до того, как управление GridView обновляет строку. Это событие часто используется для отмены операции обновления. |
| SelectedIndexChanged | Происходит при нажатии кнопки «Выбрать строку», но после того, как управление GridView обрабатывает операцию выбора. Это событие часто используется для выполнения задачи после выбора строки в элементе управления. |
| Выбранныйиндекс | Происходит при нажатии кнопки «Выбрать строку», но до того, как управление GridView обрабатывает операцию выбора. Это событие часто используется для отмены операции выбора. |
| Сортированные. | Происходит, когда гиперссылка для сортировки столбца нажата, но после того, как управление GridView обрабатывает операцию сортировки. Это событие обычно используется для выполнения задачи после того, как пользователь нажимает на гиперссылку для сортировки столбца. |
| Сортировка | Происходит, когда гиперссылка для сортировки столбца нажата, но перед управлением GridView обрабатывает операцию сортировки. Это событие часто используется для отмены операции сортировки или выполнения пользовательской сортировки. |

## <a name="formview"></a>Formview

Элемент управления FormView используется для отображения одной записи из источника данных. Он похож на управление DetailsView, за исключением того, что вместо полей строкотображается шаблоны, определяемые пользователем. Создание собственных шаблонов дает вам большую гибкость в управлении отображением данных. Элемент управления FormView поддерживает следующие функции:

- Привязка к элементам управления источниками данных, таким как SqlDataSource и ObjectDataSource.
- Встроенные вставки.
- Встроенные возможности обновления и удаляния.
- Встроенные возможности paging.
- Программный доступ к модели объектов FormView динамически устанавливает свойства, обрабатывает события и так далее.
- Настраиваемый внешний вид с помощью пользовательских шаблонов, тем и стилей.

## <a name="templates"></a>Шаблоны

Для отображения содержимого в элементе управления FormView необходимо создать шаблоны для различных частей управления. Большинство шаблонов не являются обязательными; однако необходимо создать шаблон для режима настройки элемента управления. Например, элемент formView, поддерживающий вставку записей, должен быть определен шаблон элемента вставки. В следующей таблице перечислены различные шаблоны, которые можно создать.

| **Тип шаблона** | **Описание** |
| --- | --- |
| EditItemTemplate | Определяет содержимое строки данных, когда элемент управления FormView находится в режиме отправления модуля. Этот шаблон обычно содержит элементы управления ввода и кнопки команд, с помощью которых пользователь может отсеивать существующую запись. |
| ПустыеДанныеШаблон | Определяет содержимое пустого строки данных, отображаемый при привязке управления FormView к источнику данных, который не содержит записей. Этот шаблон обычно содержит содержимое, чтобы предупредить пользователя, что источник данных не содержит никаких записей. |
| ФутерШаблон | Определяет содержимое строки для колонтитула. Этот шаблон обычно содержит любое дополнительное содержимое, вы хотели бы отобразить в строке колонтитула. В качестве альтернативы можно просто указать текст для отображения в строке колонтитула, установив свойство FooterText. |
| ЗаголовокШаблон | Определяет содержимое строки заголовка. Этот шаблон обычно содержит любое дополнительное содержимое, вы хотите отобразить в строке заголовка. В качестве альтернативы можно просто указать текст для отображения в строке заголовка, установив свойство HeaderText. |
| ItemTemplate | Определяет содержимое строки данных, когда элемент управления FormView находится в режиме только для чтения. Этот шаблон обычно содержит содержимое для отображения значений существующей записи. |
| InsertItemTemplate | Определяет содержимое строки данных, когда элемент управления FormView находится в режиме вставки. Этот шаблон обычно содержит элементы управления ввода и кнопки команд, с помощью которых пользователь может добавить новую запись. |
| PagerTemplate | Определяет содержимое строки пейджера, отображаемое при включении функции paging (когда свойство AllowPaging настроено на **истину).** Этот шаблон обычно содержит элементы управления, с помощью которых пользователь может перейти на другую запись. |

Элемент ввода в шаблоне элемента отодевания и вставки шаблона элемента может быть привязан к полям источника данных с помощью двустороннего связывающего выражения. Это позволяет элементу управления FormView автоматически извлекать значения элемента управления ввода для операции обновления или вставки. Двусторонние обязательные выражения также позволяют элементам управления вводами в шаблоне элемента для элементов отображения исходного значения поля.

### <a name="binding-to-data"></a>Привязка к данным

Контроль FormView может быть связан с управлением источниками данных (например, **SqlDataSource,** AccessDataSource, **ObjectDataSource** и так далее), или к любому источнику данных, который реализует интерфейс System.Collections.IEnumerable (например, System.Data.DataView, System.Collections.ArrayList и System.Collections.Hashtable). Используйте один из следующих методов, чтобы связать элемент управления FormView с соответствующим типом источника данных:

- Чтобы привязаться к управлению источником данных, установите свойство DataSourceID элемента управления FormView к идентификатору значения управления источником данных. Элемент formView автоматически привязывается к указанному элементу управления источниками данных и может воспользоваться возможностями управления источниками данных для выполнения функций вставки, обновления, удаляния и paging. Это предпочтительный способ привязки к данным.
- Чтобы привязаться к источнику данных, который реализует интерфейс **System.Collections.IEnumerable,** программно установите свойство DataSource управления FormView к источнику данных, а затем вызовите метод DataBind. При использовании этого метода элемент управления FormView не обеспечивает встроенную функцию вставки, обновления, удаления и paging. Эту функциональность необходимо предоставить с помощью соответствующего события.

## <a name="data-operations"></a>Операции с данными

Элемент FormView предоставляет множество встроенных возможностей, которые позволяют пользователю обновлять, удалять, вставлять и просматривать элементы управления. Когда элемент управления FormView связан с управлением источниками данных, элемент управления FormView может воспользоваться возможностями управления источниками данных и обеспечить автоматическое обновление, удаляние, вставку и функциональность paging. Элемент formView может обеспечить поддержку операций обновления, удаления, вставки и paging с другими типами источников данных; однако необходимо предоставить соответствующему обработчику событий реализацию этих операций.

Поскольку в управлении FormView используются шаблоны, он не предоставляет способ автоматического генерирования командных кнопок для выполнения операций обновления, удаляния или вставки. Вы должны вручную включить эти кнопки команды в соответствующий шаблон. Управление FormView распознает определенные кнопки, которые имеют свои свойства **CommandName,** настроенные на определенные значения. В следующей таблице перечислены кнопки команды, распознающие элементуправления FormView.

| **Кнопку** | **Значение командного имени** | **Описание** |
| --- | --- | --- |
| Отмена | "Отмена" | Используется при обновлении или вставке операций для отмены операции и отбрасывания значений, введенных пользователем. Затем элемент управления FormView возвращается в режим, указанный свойством DefaultMode. |
| DELETE | "Удалить" | Используется при удалении операций для удаления отображаемых записей из источника данных. Поднимает события ItemDeleting и ItemDeleted. |
| Изменить | "Отек" | Используется при обновлении операций для размещения элемента formView в режиме отправления действия. Содержимое, указанное в свойстве **EditItemTemplate,** отображается для строки данных. |
| Вставить | "Вставить" | Используется при вставке операций для вставки новой записи в источник данных с использованием значений, предоставляемых пользователем. Поднимает события ItemInserting и ItemInserted. |
| Оператор new | "Новый" | Используется при вставке операций для включения элемента управления FormView в режим вставки. Содержимое, указанное в свойстве **InsertItemTemplate,** отображается для строки данных. |
| Страница | "Пейдж" | Используется в операциях paging для представления кнопки в строке пейджера, выполняющей промывку. Чтобы указать операцию paging, установите свойство **CommandArgument** кнопки на "Следующий", "Prev", "Первый", "Последний", или индекс страницы, на которую можно ориентироваться. Поднимает события PageIndexChanging и PageIndexChanged. |
| Обновление | "Обновление" | Используется при обновлении операций для обновления отображаемых записей в источнике данных со значениями, предоставленными пользователем. Поднимает события ItemUpdating и ItemUpdated. |

В отличие от кнопки «Удалить» (которая удаляет отображаемую запись немедленно), при нажатии кнопки «Отображение» или «Новая» элемент управления FormView переходит в режим отображения или вставки соответственно. В режиме отображения содержимого, содержащегося в свойстве **EditItemTemplate,** отображается для текущего элемента данных. Как правило, шаблон элемента для элементов отсечения определяется таким образом, что кнопка «Отодытить» заменяется кнопкой «Обновление» и «Отмена». Элементы ввода, подходящие для типа данных поля (например, TextBox или контроль CheckBox), также обычно отображаются с значением поля для изменения пользователя. Нажатие кнопки обновления обновляет запись в источнике данных, при нажатии кнопки «Отмена» отменяет любые изменения.

Кроме того, содержимое, содержащееся в свойстве **InsertItemTemplate,** отображается для элемента данных, когда элемент управления находится в режиме вставки. Шаблон элемента вставки обычно определяется таким образом, что новая кнопка заменяется кнопкой Insert и Cancel, и пустые элементы ввода отображаются для пользователя для ввода значений для новой записи. Нажатие кнопки Insert вставляет запись в источник данных, при нажатии кнопки «Отмена» отменяет любые изменения.

Элемент управления FormView обеспечивает функцию paging, которая позволяет пользователю перемещаться по другим записям в источнике данных. При включении строка пейджера отображается в элементе управления FormView, содержащем элементы управления навигацией страницы. Для включения в действие paging установите свойство **AllowPaging** **true.** Вы можете настроить строку пейджера, установив свойства объектов, содержащихся в свойстве PagerStyle и PagerSettings. Вместо использования встроенного шаблона строки пейджера можно создать свой собственный ui, используя свойство **PagerTemplate.**

## <a name="customizing-the-user-interface"></a>Настройка пользовательского интерфейса

Вы можете настроить внешний вид управления FormView, установив свойства стиля для различных частей управления. В следующей таблице перечислены различные свойства стиля.

| **Стиль собственности** | **Описание** |
| --- | --- |
| EditRowStyle | Настройки стиля для строки данных при элементе управления FormView в режиме отодевание. |
| EmptyDataRowStyle | Параметры стиля для пустой строки данных, отображаемые в элементе управления FormView, когда источник данных не содержит записей. |
| FooterStyle | Настройки стиля для колонтитула в элементе управления FormView. |
| ЗаголовокСтиль | Настройки стиля для строки заголовка элемента управления FormView. |
| InsertRowStyle | Настройки стиля для строки данных при управлении FormView в режиме вставки. |
| PagerStyle | Настройки стиля для строки пейджера, отображаемые в элементе управления FormView при включении функции paging. |
| РоуСтиль | Настройки стиля для строки данных, когда элемент управления FormView находится в режиме только для чтения. |

## <a name="events"></a>События

Элемент управления FormView предоставляет несколько событий, которые можно запрограммировать против. Это позволяет запускать пользовательские рутины всякий раз, когда происходит событие. В следующей таблице перечислены события, поддерживаемые управлением FormView.

| **событие** | **Описание** |
| --- | --- |
| Itemcommand | Происходит при нажатии кнопки в элементе управления FormView. Это событие часто используется для выполнения задачи при нажатии кнопки в элементе управления. |
| Элементсозданный | Происходит после того, как все объекты FormViewRow создаются в элементе управления FormView. Это событие часто используется для изменения значений записи перед ее отображением. |
| ЭлементУдален | Происходит при нажатии кнопки «Удалить» (кнопка с свойством **CommandName,** настроенной на «Удалить»), но после того, как элемент управления FormView удаляет запись из источника данных. Это событие часто используется для проверки результатов операции удаления. |
| ЭлементОзадейдинг | Происходит при нажатии кнопки «Удалить», но до того, как элемент formView удаляет запись из источника данных. Это событие часто используется для отмены операции удаления. |
| ПунктВставка | Происходит, когда кнопка вставки (кнопка с свойством **CommandName,** установленным на "Вставить") нажата, но после того, как управление FormView вставляет запись. Это событие часто используется для проверки результатов операции вставки. |
| Элементвейная вставка | Происходит при нажатии кнопки «Вставка», но перед тем, как элемент formView вставляет запись. Это событие часто используется для отмены операции вставки. |
| ПунктОбновлено | Происходит при нажатии кнопки обновления (кнопка с свойством **CommandName,** настроенной на "Обновление"), но после того, как управление FormView обновляет строку. Это событие часто используется для проверки результатов операции обновления. |
| ПунктОбновление | Происходит при нажатии кнопки обновления, но до того, как управление FormView обновляет запись. Это событие часто используется для отмены операции обновления. |
| ModeChanged | Происходит после того, как режим управления FormView изменяет режимы (для редот-вставки или режима только для чтения). Это событие часто используется для выполнения задачи при изменении режима управления FormView. |
| Изменение режима | Происходит до того, как режим управления FormView изменяет режимы (для редикации, вставки или режима только для чтения). Это событие часто используется для отмены изменения режима. |
| PageIndexChanged | Происходит при нажатии одной из кнопок пейджера, но после того, как управление FormView обрабатывает операцию paging. Это событие обычно используется, когда вам нужно выполнить задачу после того, как пользователь переходит к другой записи в элементе управления. |
| PageIndexChanging | Происходит при нажатии одной из кнопок пейджера, но до того, как управление FormView обрабатывает операцию paging. Это событие часто используется для отмены операции paging. |

## <a name="detailsview"></a>Detailsview

Элемент управления DetailsView используется для отображения одной записи из источника данных в таблице, где каждое поле записи отображается в ряду таблицы. Он может быть использован в сочетании с управлением GridView для мастер-детали сценариев. Элемент управления DetailsView поддерживает следующие функции:

- Привязка к элементам управления источниками данных, таким как SqlDataSource.
- Встроенные вставки.
- Встроенные возможности обновления и удаляния.
- Встроенные возможности paging.
- Программный доступ к объектной модели DetailsView динамически устанавливает свойства, обрабатывает события и так далее.
- Настраиваемый внешний вид через темы и стили.

## <a name="row-fields"></a>Рядполя

Каждая строка данных в элементе управления DetailsView создается путем объявления управления полем. Различные типы полей строк определяют поведение строк в элементе управления. Элементы управления полями происходят из DataControlField. В следующей таблице перечислены различные типы полей строки, которые могут быть использованы.

| **Тип поля столбца** | **Описание** |
| --- | --- |
| BoundField | Отображает значение поля в источнике данных в виде текста. |
| ButtonField | Отображает кнопку команды в управлении DetailsView. Это позволяет отображать строку с пользовательским управлением кнопкой, например, кнопку Добавить или удалить. |
| CheckBoxField | Отображает флажок в управлении DetailsView. Этот тип поля строкобычно обычно используется для отображения полей со значением Boolean. |
| CommandField | Отображает встроенные кнопки команд для выполнения операций по отдействию, вставке или удалению операций в управлении DetailsView. |
| HyperLinkField | Отображает значение поля в источнике данных в качестве гиперссылки. Этот тип поля строки позволяет привязать второе поле к URL-адресу гиперссылки. |
| ImageField | Отображает изображение в управлении DetailsView. |
| ШаблонФилд | Отображает контент, определяемый пользователем, для строки в управлении DetailsView в соответствии с указанным шаблоном. Этот тип поля строки позволяет создать пользовательское поле строки. |

По умолчанию свойство AutoGenerateRows настроено на **достоверность,** которая автоматически генерирует объект поля связанного ряда для каждого поля связываемого типа в источнике данных. Действительными связываемыми типами являются String, DateTime, Десятинная, Guid и набор примитивных типов. Каждое поле затем отображается в строке в виде текста, в порядке, в котором каждое поле отображается в источнике данных.

Автоматическое создание строк обеспечивает быстрый и простой способ отображения каждого поля в записи. Однако для использования расширенных возможностей управления DetailsView необходимо прямо объявить поля строки для включения в управление DetailsView. Чтобы объявить поля строки, сначала установите свойство **AutoGenerateRows** на **ложное.** Затем добавьте теги открытия и закрытия ** &lt;полей&gt; ** между тегами открытия и закрытия управления DetailsView. Наконец, перечислите поля строки, которые вы хотите включить между ** &lt;тегами&gt; ** поля открытия и закрытия. Указанные поля строки добавляются в коллекцию Полей в перечисленном порядке. Коллекция **Fields** позволяет программно управлять полями строк в управлении DetailsView.

> [!NOTE]
> Автоматически генерируемые поля строки не добавляются в коллекцию Полей.

## <a name="binding-to-data"></a>Привязка к данным

Контроль DetailsView может быть связан с управлением источниками данных, таким как **SqlDataSource** или AccessDataSource, или с любым источником данных, который реализует интерфейс System.Collections.IEnumerable, такой как System.Data.DataView, System.Collections.ArrayList и System.Collections.Hashtable.

Используйте один из следующих методов, чтобы связать управление DetailsView с соответствующим типом источника данных:

- Чтобы привязаться к управлению источником данных, установите свойство DataSourceID управления DatasView на идентификаторное значение управления источником данных. Контроль DatasView автоматически привязывается к указанному элементу управления источниками данных. Это предпочтительный способ привязки к данным.
- Чтобы привязаться к источнику данных, который реализует интерфейс **System.Collections.IEnumerable,** программно установите свойство DataSource управления DetailsView к источнику данных, а затем вызовите метод DataBind.

## <a name="security"></a>Безопасность

Этот элемент управления может использоваться для отображения пользовательского ввода, который может включать вредоносный клиентский скрипт. Перед тем, как отобразить ее в приложении, проверьте любую информацию, отправленную клиенту, на наличие исполняемого сценария, заявлений s-L или другого кода. ASP.NET предоставляет функцию проверки запроса на ввод для блокировки скрипта и HTML в пользовательских вводах.

## <a name="data-operations"></a>Операции с данными

Контроль DetailsView предоставляет встроенные возможности, которые позволяют пользователю обновлять, удалять, вставлять и просматривать элементы управления. Когда управление DetailsView привязано к управлению источником данных, управление DetailsView может воспользоваться возможностями управления источниками данных и обеспечить автоматическое обновление, удаляние, вставку и функциональность paging.

Контроль DatasView может обеспечить поддержку операций обновления, удаления, вставки и paging с другими типами источников данных; однако необходимо предоставить реализацию этих операций в соответствующем обработчике событий.

Управление DetailsView может автоматически добавлять поле строки **CommandField** с кнопкой Edit, Delete или New, установив свойства AutoGenerateEditButton, AutoGenerateDeleteButton или AutoGenerateInsertButton, соответственно. **true** В отличие от кнопки «Удалить» (которая немедленно удаляет выбранную запись), при нажатии кнопки «Отображим» или «Новая» управление DetailsView переходит в режим отобрачения или вставки соответственно. В режиме отодвилость кнопка «Отодвито» заменяется кнопкой «Обновление» и «Отмена». Элементы ввода, подходящие для типа данных поля (например, TextBox или контроль CheckBox), отображаются с значением поля для изменения пользователя. Нажатие кнопки обновления обновляет запись в источнике данных, при нажатии кнопки «Отмена» отменяет любые изменения. Аналогичным образом, в режиме вставки новая кнопка заменяется кнопкой Insert и Cancel, а пустые элементы управления ввозаотились для пользователя для ввода значений для новой записи.

Управление DetailsView обеспечивает функцию paging, которая позволяет пользователю перемещаться по другим записям в источнике данных. При включении элементы управления навигацией страниц отображаются в строке пейджера. Для включения в действие paging установите свойство AllowPaging **true.** Строка пейджера может быть настроена с помощью свойств PagerStyle и PagerSettings.

## <a name="customizing-the-user-interface"></a>Настройка пользовательского интерфейса

Вы можете настроить внешний вид управления DetailsView, установив свойства стиля для различных частей управления. В следующей таблице перечислены различные свойства стиля.

| **Стиль собственности** | **Описание** |
| --- | --- |
| ЧередованиеРоустиль | Настройки стиля для чередующихся строк данных в управлении DetailsView. При наборе этого свойства строки данных отображаются поочередно между настройками RowStyle и настройками **AlternatingRowStyle.** |
| CommandRowStyle | Настройки стиля для строки, содержащие встроенные кнопки команды в управлении DetailsView. |
| EditRowStyle | Настройки стилей для строк данных при управлении DatasView в режиме отодвилость. |
| EmptyDataRowStyle | Параметры стиля для пустой строки данных, отображаемые в управлении DatasView, когда источник данных не содержит записей. |
| FooterStyle | Настройки стиля для колонтитула управления DetailsView. |
| ЗаголовокСтиль | Настройки стиля для строки заголовка управления DetailsView. |
| InsertRowStyle | Настройки стиля для строк данных при управлении DetailsView в режиме вставки. |
| PagerStyle | Настройки стиля для строки пейджера управления DetailsView. |
| РоуСтиль | Настройки стилей для строк данных в управлении DatasView. При установке свойства **AlternatingRowStyle** строки данных отображаются между настройками **RowStyle** и настройками **AlternatingRowStyle.** |
| ФилдХедерСтиль | Настройки стиля для столбца заголовка управления DetailsView. |

## <a name="events"></a>События

Элемент управления DetailsView предоставляет несколько событий, которые можно запрограммировать против. Это позволяет запускать пользовательские рутины всякий раз, когда происходит событие. В следующей таблице перечислены события, поддерживаемые управлением DetailsView. Контроль DatasView также наследует эти события из базовых классов: DataBinding, DataBound, Disposed, Init, Load, PreRender и Render.

| **событие** | **Описание** |
| --- | --- |
| Itemcommand | Происходит при нажатии кнопки в управлении DetailsView. |
| Элементсозданный | Происходит после того, как все объекты DetailViewRow создаются в управлении DetailsView. Это событие часто используется для изменения значений записи перед ее отображением. |
| ЭлементУдален | Происходит при нажатии кнопки «Удалить», но после того, как управление DatasView удаляет запись из источника данных. Это событие часто используется для проверки результатов операции удаления. |
| ЭлементОзадейдинг | Происходит при нажатии кнопки «Удалить», но перед тем, как управление DatasView удаляет запись из источника данных. Это событие часто используется для отмены операции удаления. |
| ПунктВставка | Происходит при нажатии кнопки «Вставка», но после того, как управление DetailsView вставляет запись. Это событие часто используется для проверки результатов операции вставки. |
| Элементвейная вставка | Происходит при нажатии кнопки «Вставка», но перед управлением DetailsView вставляет запись. Это событие часто используется для отмены операции вставки. |
| ПунктОбновлено | Происходит при нажатии кнопки обновления, но после того, как управление DetailsView обновляет строку. Это событие часто используется для проверки результатов операции обновления. |
| ПунктОбновление | Происходит при нажатии кнопки обновления, но до того, как управление DetailsView обновляет запись. Это событие часто используется для отмены операции обновления. |
| ModeChanged | Происходит после того, как режимуправления Управления DetailsView (изменить, вставить или прочитать только режим). Это событие часто используется для выполнения задачи при изменении режима управления DetailsView. |
| Изменение режима | Происходит до того, как режимы управления DetailsView (изменить, вставить или прочитать только режим). Это событие часто используется для отмены изменения режима. |
| PageIndexChanged | Происходит при нажатии одной из кнопок пейджера, но после того, как управление DetailsView обрабатывает операцию paging. Это событие обычно используется, когда вам нужно выполнить задачу после того, как пользователь переходит к другой записи в элементе управления. |
| PageIndexChanging | Происходит при нажатии одной из кнопок пейджера, но перед управлением DetailsView обрабатывает операцию paging. Это событие часто используется для отмены операции paging. |

## <a name="the-menu-control"></a>Контроль меню

Управление меню в ASP.NET 2.0 разработано как полнофункционная навигационная система. Он может быть легко связан с иерархическими источниками данных, такими как SiteMapDataSource.

Структура управления меню может быть определена декларативно или динамически и состоит из одного корневого узла и любого количества подузлов. Следующий код декларативно определяет меню для управления меню.

[!code-aspx[Main](data-bound-controls/samples/sample4.aspx)]

В приведенном выше примере узло Home.aspx является корневым узлом. Все остальные узлы вложены в корневой узлы на различных уровнях.

Существует два типа меню, которые может отобразить элемент управления меню; статическое меню и динамическое меню. Статические меню состоят из элементов меню, которые всегда видны. Динамическое меню состоит из элементов меню, которые видны только тогда, когда пользователь парит над ними с помощью мыши. Клиенты часто путают статические меню с меню, определенными декларативно, и динамическими меню с меню, которые связаны с данными во время выполнения. На самом деле, динамические и статические меню не связаны с методом популяции. Термины *статические* и *динамические* относятся только к тому, статически ли меню отображается по умолчанию или отображается только тогда, когда пользователь предпринимает какие-либо действия.

Свойство **StaticDisplayLevels** используется для настройки количества уровней меню статичны и поэтому отображается по умолчанию. В приведенном выше примере установка свойства **StaticDisplayLevels** на значение 2 приведет к статичному отображению меню домашнего узла, музыкального узла и узла Фильмов. Все остальные узлы будут динамически отображаться, когда пользователь парит над родительским узлам.

Свойство **MaximumDynamicDisplayLevels** настраивает максимальное количество динамических уровней, которые меню способно отображать. Любые динамические меню на уровне, превышающем значение, указанное свойством **MaximumDynamicDisplayLevels,** отбрасываются.

> [!NOTE]
> Почти наверняка вы можете столкнуться с ситуациями, когда меню не отображаются из-за свойства MaximumDynamicDisplayLevels. В этих случаях убедитесь, что свойство настроено достаточно, чтобы обеспечить отображение меню клиентов.

## <a name="data-binding-the-menu-control"></a>Связывание данных с управлением меню

Элемент управления меню может быть привязан к любому иерархическому источнику данных, например SiteMapDataSource или XMLDataSource. SiteMapDataSource является наиболее часто используемым методом привязки данных к управлению меню, поскольку он питается от файла Web.sitemap и его схема обеспечивает известный API для управления меню. В приведенном ниже списке показан простой файл Web.sitemap.

[!code-xml[Main](data-bound-controls/samples/sample5.xml)]

Обратите внимание, что есть только один корневой элементMapNode, в данном случае элемент Home. Для каждого сайта можно настроить несколько атрибутовMapNode. Наиболее часто используемыми атрибутами являются:

- **URL** Укажите URL для отображения при нажатии пользователя на пункт меню. Если этого атрибута нет, узел просто отправится назад при нажатии.
- **титул** Упоняет текст, отображаемый в пункте меню.
- **описание** Используется в качестве документации для узла. Также отображается в качестве наконечника инструмента, когда мышь зависла над узла.
- **сайтMapFile** Позволяет для вложенных карт site. Этот атрибут должен указывать на хорошо сформировавшийся ASP.NET файл сайта.
- **роли** Позволяет контролировать внешний вид узла ASP.NET обрезки безопасности.

Обратите внимание, что, хотя все эти атрибуты являются необязательными, поведение меню может быть не таким, как ожидается, если они не указаны. Например, если атрибут *URL* указан, а атрибут *описания* нет, узел не будет виден и переход на указанный URL не будет.

## <a name="controlling-a-menus-operation"></a>Управление операцией меню

Есть несколько свойств, которые влияют на работу управления ASP.NET меню; **Свойства ориентации,** **свойство DisappearAfter,** **свойство StaticItemFormatString** и свойство **StaticPopoutImageUrl** — это лишь некоторые из них.

- **Ориентация** может быть установлена на *горизонтальную* или *вертикальную* и контролирует, выкладываются ли элементы статического меню горизонтально в ряд или вертикально и укладываются друг на друга. Это свойство не влияет на динамическое меню.
- Свойство **DisappearAfter** настраивает, как долго динамическое меню должно оставаться видимым после того, как мышь была отодвинута от него. Значение указывается в миллисекундах и по умолчанию до 500. Установка этого свойства на значение -1 приведет к тому, что меню никогда не исчезнет автоматически. В этом случае меню исчезнет только тогда, когда пользователь нажимает вне меню.
- Свойство **StaticItemFormatString** упрощает поддержание последовательного слова в системе меню. При указании *{0}* этого свойства следует вводить вместо описания, которое отображается в источнике данных. Например, для того, чтобы пункт меню из упражнения 1 сказать Посетить наши {0} продукты Страницы и т.д., вы бы указать Посетить нашу страницу для StaticItemFormatString. Во время выполнения ASP.NET заменим {0} любое появление с правильным описанием элемента меню.
- Свойство **StaticPopoutImageUrl** определяет изображение, используемое для указания на то, что определенный узлы меню имеют детские узлы, к которым можно получить доступ, паря над ним. Динамическое меню будет продолжать использовать изображение по умолчанию.

## <a name="templated-menu-controls"></a>Шаблонные элементы управления меню

Элемент управления является шаблонным управлением и позволяет для двух различных ItemTemplates; StaticItemTemplate и DynamicItemTemplate. Используя эти шаблоны, вы можете легко добавить элементы управления сервера или пользовательские элементы управления в меню.

Чтобы отсеивать шаблоны в Visual Studio .NET, нажмите кнопку Smart Tag в меню и выберите шаблоны edit. Затем можно выбрать между редактированием StaticItemTemplate или DynamicItemTemplate.

Любые элементы управления, добавленные в StaticItemTemplate, будут отображаться в статическом меню при загрузке страницы. Любые элементы управления, добавленные в DynamicItemTemplate, будут отображаться во всех всплывающих меню.

## <a name="menu-events"></a>Меню События

Элемент управления меню имеет два события, которые являются уникальными для него; **MenuItemClicked** и **событие MenuItemDatabound.**

Событие MenuItemClicked поднимается при нажатии элемента меню. Событие MenuItemDatabound повышается при смыве элемента меню с данными. **MenuEventArgs,** который передается обработчику событий, предоставляет доступ к элементу меню через свойство Пункта.

## <a name="controlling-a-menus-appearance"></a>Управление появлением меню

Вы также можете повлиять на внешний вид управления меню, используя один или несколько из многих стилей, доступных для форматного меню. Среди них **StaticMenuStyle**, **DynamicMenuStyle**, **DynamicMenuStyle , DynamicSelectedStyle**, **DynamicSelectedStyle**, и **DynamicHoverStyle**. Эти свойства настроены с помощью стандартной строки HTML Style. Например, на стиль динамических меню повлияет следующее.

[!code-aspx[Main](data-bound-controls/samples/sample6.aspx)]

> [!NOTE]
> Если вы используете какой-либо из стилей &lt;Hover, вам нужно будет добавить элемент головы&gt; на страницу с элементом *runat,* установленным на *сервере.*

Элементы управления меню также поддерживают использование ASP.NET 2.0 тем.

## <a name="the-treeview-control"></a>Управление TreeView

Элемент управления TreeView отображает данные в древоподобной структуре. Как и в случае с управлением меню, это могут быть легко данные, связанные с любым иерархическим источником данных, таким как SiteMapDataSource.

Первый вопрос, который клиенты, вероятно, спросить о управлении TreeView в ASP.NET 2.0 является ли это связано с TreeView IE WebControl, который был доступен для ASP.NET 1.x. Нет. Управление ASP.NET 2.0 TreeView было написано с нуля и предлагает значительное улучшение по сравнению с IE TreeView WebControl, который был ранее доступен.

Я не буду ввязываться в подробности о том, как связать управление TreeView с картой сайта, поскольку он выполняется точно так же, как элемент управления меню. Тем не менее, управление TreeView имеет некоторые явные различия в том, как он работает.

По умолчанию элемент управления TreeView полностью расширяется. Чтобы изменить уровень расширения при начальной нагрузке, измените свойство **управления ExpandDepth.** Это особенно важно в тех случаях, когда TreeView связан с данными при расширении определенных узлов.

## <a name="databinding-the-treeview-control"></a>Обвязка данных в управлении TreeView

В отличие от управления меню, TreeView хорошо поддается обработке больших объемов данных. Таким образом, в дополнение к набору данных на SiteMapDataSource или XMLDataSource, TreeView часто данные связаны с DataSet или других реляционных данных. В тех случаях, когда элемент управления TreeView связан с большими объемами данных, лучше всего связываться только с данными, которые на самом деле видны в элементе управления. Затем данные могут связываться с дополнительными данными по мере расширения узлов TreeView.

В этих случаях свойство **PopulateOnDemand** TreeView должно быть установлено в соответствии с *истиной.* Затем необходимо будет предоставить реализацию для метода **TreeNodePopulate.**

## <a name="data-binding-without-postback"></a>Связывание данных без PostBack

Обратите внимание, что при первом расширении узла в предыдущем примере страница публикует и обновляется. Это не проблема в этом примере, но вы можете себе представить, что это может быть в производственной среде с большим объемом данных. Лучшим сценарием был бы сценарий, в котором TreeView будет по-прежнему динамически заполнять свои узлы, но без поста обратно на сервер.

Установив **PopulateNodesFromClient** и **populateOnDemand** свойства верны, ASP.NET управления TreeView будет динамически заполнить узлы без поста назад. При расширении родительского узла от клиента делается запрос XMLHttp и высаживается событие OnTreeNodePopulate. Сервер отвечает островом данных XML, который затем используется для связывания данных узлов ребенка.

ASP.NET динамически создает клиентский код, который реализует эту функциональность. &lt;Теги&gt; скрипта, содержащие скрипт, генерируются, указывая на файл AXD. Например, в приведенном ниже списке показаны ссылки на сценарий для кода скрипта, генерируемого запросом XMLHttp.

[!code-html[Main](data-bound-controls/samples/sample7.html)]

Если вы просмотрите файл AXD выше в браузере и откроете его, вы увидите код, который реализует запрос XMLHttp. Этот метод не позволяет клиентам изменять файл скрипта.

## <a name="controlling-the-operation-of-the-treeview-control"></a>Управление работой управления TreeView

Элемент управления TreeView имеет несколько свойств, влияющих на работу элемента управления. Наиболее очевидными свойствами являются **ShowCheckBoxes**, **ShowExpandCollapse**, и **ShowLines**.

Свойство **ShowCheckBoxes** влияет на то, отображаются ли узлы при визуализации в контрольном поле. Действительные значения для этого свойства **нет**, **корень**, **родитель**, **лист**, и **все**. Они влияют на управление TreeView следующим образом:

| **Значение свойства** | **Действие** |
| --- | --- |
| None | Чекбоксы не отображаются ни на одном узлах. Это параметр по умолчанию. |
| Root | Флажок отображается только на корневом узлах. |
| Parent | Флажок отображается только на тех узлах, которые имеют детские узлы. Эти детские узлы могут быть родительскими узлами или узлами листьев. |
| Конечный элемент | Чекбокс отображается только на тех узлах, которые не имеют детских узлов. |
| Все | На всех узлах отображается флажок. |

При использовании флажков свойство **CheckedNodes** возвращает коллекцию узлов TreeView, которые проверяются при послебеке.

Свойство **ShowExpandCollapse** контролирует внешний вид изображения расширения/коллапса рядом с корневыми и родительскими узлами. Если это свойство настроено на **ложное,** узлы TreeView отображаются как гиперссылки и расширяются/разрушаются, нажав на ссылку.

Свойство **ShowLines** контролирует, отображаются ли строки, соединяющие родительские узлы с детскими узлами. При **ложном** (по умолчанию) строки не отображаются. При **действительности**элемент управления TreeView будет использовать изображения строк в папке, указанной свойством **LineImagesFolder.**

Чтобы настроить внешний вид линий TreeView, Visual Studio .NET 2005 включает в себя инструмент Line Designer. Вы можете получить доступ к этому инструменту с помощью кнопки Smart Tag на управлении TreeView, как показано ниже.

![](data-bound-controls/_static/image1.jpg)

**Рисунок 1**

При выборе опции **меню настроить линию изображения** будет запущен инструмент Line Designer, позволяющий настроить внешний вид линий TreeView.

## <a name="treeview-events"></a>События TreeView

Управление TreeView имеет следующие уникальные события:

- ВыбранныйNodeChanged происходит, когда узла выбирают на основе свойства **SelectAction.**
- TreeNodeCheckChanged происходит при изменении состояния флажков узлов.
- TreeNodeExpandedПроисходит, когда узла расширяется на основе свойства **SelectAction.**
- TreeNodeCollapsed происходит, когда узла разрушается.
- TreeNodeDataBound возникает, когда узла связывают данные.
- TreeNodePopulate происходит, когда узла заселены.

Свойство **SelectAction** позволяет настроить событие, когда выбранный узла. Свойство SelectAction предоставляет следующие действия:

- TreeNodeSelectAction.Expand поднимает TreeNodeExpanded, когда узла выбрана.
- TreeNodeSelectAction.None не вызывает события при выборе узла.
- TreeNodeSelectAction.Select поднимает событие SelectedNodeChanged при выборе узла.
- TreeNodeSelectAction.SelectExpand повышает как событие SelectedNodeChanged, так и событие TreeNodeExpanded при выборе узла.

## <a name="controlling-appearance-with-styles"></a>Контроль внешнего вида со стилями

Управление TreeView предоставляет множество свойств для управления внешним видом управления стилями. Доступны следующие свойства:

| **Имя свойства** | **Элементы управления** |
| --- | --- |
| HoverNodeStyle | Управляет стилем узлов, когда мышь зависает над ними. |
| LeafNodeStyle | Контролирует стиль листовых узлов. |
| NodeStyle | Управляет стилем для всех узлов. Специфические стили узлов (например, LeafNodeStyle) переопределяют этот стиль. |
| ParentNodeStyle | Управляет стилем для всех родительских узлов. |
| RootNodeStyle | Управляет стилем для корневого узла. |
| ВыбранныйNodeStyle | Управляет стилем для выбранного узла. |

Каждое из этих свойств читается только для чтения. Однако каждый из них вернет объект **TreeNodeStyle,** и свойства этого объекта могут быть изменены с помощью формата *свойств-субсобственности.* Например, для установки свойства **ForeColor** **ВизуаnodeStyle**— можно использовать следующий синтаксис:

[!code-aspx[Main](data-bound-controls/samples/sample8.aspx)]

Обратите внимание, что приведенный выше тег не закрыт. Это потому, что при использовании декларативного синтаксиса показано здесь, вы бы включить узлы TreeViews в HTML-код, а также.

Свойства стиля также могут быть указаны в коде с использованием формата *property.subproperty.* Например, чтобы установить свойство **ForeColor** **RootNodeStyle** в коде, можно использовать следующий синтаксис:

[!code-csharp[Main](data-bound-controls/samples/sample9.cs)]

> [!NOTE]
> Полный список различных свойств стиля можно узнать из документации MSDN на объекте TreeNodeStyle.

## <a name="the-sitemappath-control"></a>Контроль SiteMapPath

Контроль SiteMapPath обеспечивает контроль навигации хлебных крошек для разработчиков ASP.NET. Как и другие элементы управления навигацией, это могут быть легко данные, связанные с иерархическими источниками данных, такими как SiteMapDataSource или XmlDataSource.

Контроль SiteMapPath состоит из объектов SiteMapNodeItem. Существует три типа узлов; Корневой узла, родительских узлов и текущего узла. Корневой узла является узлавом в верхней части иерархической структуры. Текущий узлы представляет текущую страницу. Все остальные узлы являются родительскими узлами.

## <a name="controlling-the-operation-of-the-sitemappath-control"></a>Управление работой siteMapPath Control

Свойства, контролирующие работу управления SiteMapPath, следующие:

| **Свойство** | **Описание свойства** |
| --- | --- |
| ParentLevelsDisplayed | Контролирую, сколько родительских узлов отображается. По умолчанию -1, что не накладывает ограничений на количество отображаемых родительских узлов. |
| ПутьНаправление | Контролирует направление SiteMapPath. Допустимые значения RootToCurrent (по умолчанию) и CurrentToRoot. |
| PathSeparator | Строка, которая управляет символом, отделяющей узлы в управлении SiteMapPath. Значение по умолчанию :. |
| RenderCurrentCurrentNodeAsLink | Значение Boolean, которое контролирует, отображается ли текущий узел в качестве ссылки. Значение по умолчанию — False. |
| SkipLinkТекст | Помогает с доступностью, когда страница просматривается читателями экрана. Это свойство позволяет читателям экрана пропустить управление SiteMapPath. Чтобы отключить эту функцию, установите свойство на String.Empty. |

## <a name="templated-sitemappath-controls"></a>Шаблонные элементы управления SiteMapPath

SiteMapControl является шаблонным элементом управления, и как таковой, вы можете определить различные шаблоны для использования в отображении элемента управления. Чтобы отсеивать шаблоны в управлении SiteMapPath, нажмите кнопку Smart Tag на элементе управления и выберите шаблоны edit из меню. При этом отображается меню SiteMapTasks, как показано ниже, где вы можете выбрать между различными доступными шаблонами.

![](data-bound-controls/_static/image2.jpg)

**Рисунок 2**

Шаблон **NodeTemplate** относится к любому узелу в SiteMapPath. Если узла является корневым узлами или текущим угомом, а **RootNodeTemplate** или **CurrentNodeTemplate** настроены, узла переопределяется.

## <a name="sitemappath-events"></a>События SiteMapPath

Управление SiteMapPath имеет два события, которые не являются производными от класса управления; **Событие ItemCreated** и событие **ItemDataBound.** Событие ItemCreated возникает при создании элемента SiteMapPath. ItemDataBound возникает при вызове метода DataBind во время связывания данных узла SiteMapPath. Объект **SiteMapMapItemEventArgArgs** предоставляет доступ к конкретному SiteMapNodeItem через свойство пункта.

## <a name="controlling-appearance-with-styles"></a>Контроль внешнего вида со стилями

Для форматирования управления SiteMapPath доступны следующие стили.

| **Имя свойства** | **Элементы управления** |
| --- | --- |
| ТекущийNodeStyle | Управляет стилем текста для текущего узла. |
| RootNodeStyle | Контролирует стиль текста для корневого узла. |
| NodeStyle | Контролирует стиль текста для всех узлов при условии, что CurrentNodeStyle или RootNodeStyle не применяется. |

Свойство NodeStyle переопределяется либо CurrentNodeStyle, либо RootNodeStyle. Каждое из этих свойств читается только и возвращает объект **стиля.** Чтобы повлиять на внешний вид узла с помощью одного из этих свойств, необходимо установить свойства возвращенного объекта стиля. Например, приведенный ниже код изменяет свойство предцвета текущего узла.

[!code-aspx[Main](data-bound-controls/samples/sample10.aspx)]

Свойство также может быть применено программно следующим образом:

[!code-csharp[Main](data-bound-controls/samples/sample11.cs)]

> [!NOTE]
> Если шаблон применен, стиль не будет применен.

## <a name="lab-1-configuring-an-aspnet-menu-control"></a>Лаборатория 1: Настройка ASP.NET управления меню

1. Создайте новый веб-узел.
2. Добавьте файл Карты Сайта, выбрав файл, новый, файл и выбрав карту сайта из списка шаблонов файлов.
3. Откройте карту сайта (Web.sitemap по умолчанию) и измените ее так, чтобы она выглядела как приведенное ниже перечисление. Страниц, на которые вы ссылаетесь в файл карты сайта на самом деле не существует, но это не будет проблемой для этого упражнения.

    [!code-xml[Main](data-bound-controls/samples/sample12.xml)]
4. Откройте веб-форму по умолчанию в представлении Design.
5. Из раздела Навигация в наборе инструментов добавьте на страницу новый элемент управления меню.
6. Из раздела данных в наборе инструментов добавьте новый SiteMapDataSource. SiteMapDataSource будет автоматически использовать файл Web.sitemap на вашем сайте. (Файл Web.sitemap *должен* быть в корневой папке сайта.)
7. Нажмите на элемент управления меню, а затем нажмите кнопку Smart Tag для отображения диалога меню задач.
8. При выпадении исходного кода Выберите SiteMapDataSource1.
9. Нажмите на ссылку AutoFormat и выберите формат меню.
10. В панели свойств установите свойство **StaticDisplayLevels** до 2. Теперь элемент управления меню должен отображать узло «Дом, продукты и услуги» в конструкторе.
11. Просмотрите страницу в браузере, чтобы использовать меню. (Поскольку страниц, которые вы добавили на карту сайта, на самом деле не существует, вы увидите ошибку при попытке просмотреть их.)

Поэкспериментируйте с изменением свойств StaticDisplayLevels и MaximumDynamicDisplayLevels и посмотрите, как они влияют на отображение меню.

## <a name="lab-2-dynamically-binding-a-treeview-control"></a>Лаборатория 2: Динамическисвязвая элемент управления TreeView

Это упражнение предполагает, что у вас есть сервер S'L, работающий локально, и что база данных Northwind присутствует в экземпляре сервера S'L. Если эти условия не выполнены, пожалуйста, измените строку соединения в образце. Обратите внимание, что вам также может потребоваться указать аутентификацию сервера S'L, а не доверенное соединение.

1. Создайте новый веб-узел.
2. Переключитесь на представление кода для Default.aspx и замените весь код кодом, перечисленным ниже. 

    [!code-aspx[Main](data-bound-controls/samples/sample13.aspx)]
3. Сохранить страницу как treeview.aspx.
4. Просмотрите страницу.
5. Когда страница отображается впервые, просмотр источника страницы в вашем браузере. Обратите внимание, что клиенту были отправлены только видимые узлы.
6. Нажмите знак плюс рядом с любым узелом.
7. Снова посмотреть источник на странице. Обратите внимание, что вновь отображаемые узлы теперь присутствуют.

## <a name="lab-3-details-view-and-editing-data-using-a-gridview-and-detailsview"></a>Лаборатория 3: Подробная информация Просмотр и редактирование данных с помощью GridView и Подробная информацияПосмотреть

1. Создайте новый веб-узел.
2. Добавьте новый веб.конфигурацию на веб-узел.
3. Добавьте строку подключения в файл web.config, показанный ниже: 

    [!code-xml[Main](data-bound-controls/samples/sample14.xml)]

    > [!NOTE]
    > Возможно, вам придется изменить строку соединения на основе вашей среды.
4. Сохраните изменения и закройте файл web.config.
5. Откройте default.aspx и добавьте новый элемент управления SqlDataSource.
6. Измените идентификатор элемента управления SqlDataSource на **продукты.**
7. В меню **задач SqlDataSource** нажмите **Наконфигурировать источник данных**.
8. Выберите **Northwind** в сбросе соединения и нажмите Далее.
9. Выберите **продукты** из **name** dropdown и проверьте **ProductID,** **ProductName,** **UnitPrice**и чекбоксы **UnitsInStock,** как показано ниже. 

![](data-bound-controls/_static/image3.jpg)

    **Figure 3**
10. Щелкните **Далее**.
11. Нажмите кнопку **Готово**.
12. Переключитесь на представление Исходного кода и изучите созданный код. Обратите внимание на **SelectCommand**, **DeleteCommand**, **InsertCommand**и **UpdateCommand,** которые были добавлены в управление SqlDataSource. Также обратите внимание на добавленные параметры.
13. Переключитесь на представление design view и добавьте на страницу новый элемент управления GridView.
14. Выберите **продукты** из выпадения **исходного кода** выбора.
15. Проверьте **включение Paging** и **выбор включить,** как показано ниже. 

![](data-bound-controls/_static/image4.jpg)

    **Figure 4**
16. Нажмите на ссылку **Edit Columns** и убедитесь, что **полей автоматического генераза** проверено.
17. Нажмите кнопку **ОК**.
18. При выборе управления GridView нажмите кнопку рядом с свойством **DataKeyNames** в панели Свойств.
19. Выберите **ProductID** из списка **доступных полей данных** и нажмите кнопку, **&gt;** чтобы добавить его.
20. Щелкните ОК.
21. Добавьте на страницу новый элемент управления SqlDataSource.
22. Измените идентификатор элемента управления SqlDataSource на **детали.**
23. Из меню задач SqlDataSource выберите **Источник данных.**
24. Выберите **Northwind** из падения и нажмите **Далее.**
25. Выберите <strong>Продукты</strong> из выпадения <strong> \< <strong>имен</strong> и проверьте флажок /strong> в списке <strong>столбцов.</strong>
26. Нажмите кнопку **WHERE.**
27. Выберите **ProductID** из выпадения **столбца.**
28. Выберите **=** в выпадении оператора.
29. Выберите **элемент управления** из выпадения **источника.**
30. Выберите **GridView1** из системы идентификатора **управления.**
31. Нажмите кнопку **Добавить,** чтобы добавить пункт WHERE.
32. Нажмите кнопку **ОК**.
33. Нажмите кнопку **Advanced** и проверьте **чекбокс инструкций Generate INSERT, UPDATE и DELETE.**
34. Нажмите кнопку **ОК**.
35. Нажмите **далее** и нажмите **Закончить**.
36. Добавьте элемент управления ДеталиПросмотр на страницу.
37. При выпадении **источника данных** выберите **Подробную информацию**.
38. Проверьте флажок **Редактирования включить,** как показано ниже. 

![](data-bound-controls/_static/image1.gif)

    **Figure 5**
39. Сохранить страницу и просматривать Default.aspx.
40. Нажмите на ссылку **Select** рядом с различными записями, чтобы увидеть обновление DetailsView автоматически.
41. Нажмите на ссылку **Edit** в управлении DetailsView.
42. Внести изменения в запись и нажмите **обновление**.
