---
uid: web-forms/overview/moving-to-aspnet-20/caching
title: Кэширование Документы Майкрософт
author: rick-anderson
description: Понимание кэширования важно для хорошо работающего приложения ASP.NET. ASP.NET 1.x предложил три различных варианта кэширования; кэширование вывода,...
ms.author: riande
ms.date: 02/20/2005
ms.assetid: 2bb109d2-e299-46ea-9054-fa0263b59165
msc.legacyurl: /web-forms/overview/moving-to-aspnet-20/caching
msc.type: authoredcontent
ms.openlocfilehash: a199a9c0352dfb054e8d4e5e67652db9bd38851c
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2020
ms.locfileid: "81542941"
---
# <a name="caching"></a>Caching

[корпорацией Майкрософт](https://github.com/microsoft)

> Понимание кэширования важно для хорошо работающего приложения ASP.NET. ASP.NET 1.x предложил три различных варианта кэширования; кэширование вывода, кэширование фрагментов и API кэша.

Понимание кэширования важно для хорошо работающего приложения ASP.NET. ASP.NET 1.x предложил три различных варианта кэширования; кэширование вывода, кэширование фрагментов и API кэша. ASP.NET 2.0 предлагает все три из этих методов, но он добавляет некоторые значительные дополнительные функции. Существует несколько новых зависимостей кэша, и разработчики также имеют возможность создавать пользовательские зависимости кэша. Конфигурация кэширования также значительно улучшилась в ASP.NET 2.0.

## <a name="new-features"></a>Новые функции

## <a name="cache-profiles"></a>Профили кэша

Профили кэша позволяют разработчикам определить определенные параметры кэша, которые затем могут быть применены к отдельным страницам. Например, если у вас есть несколько страниц, срок действия которых должен быть из кэша через 12 часов, можно легко создать профиль кэша, который можно применить к этим страницам. Чтобы добавить новый профиль &lt;кэша,&gt; используйте раздел outputCacheSettings в файле конфигурации. Например, ниже приведена конфигурация профиля кэша, называемого *"двухдневный",* который настраивает продолжительность кэша в 12 часов.

[!code-xml[Main](caching/samples/sample1.xml)]

Чтобы применить этот профиль кэша на определенной странице, используйте атрибут CacheProfile директивы OutputCache, как показано ниже:

[!code-aspx[Main](caching/samples/sample2.aspx)]

## <a name="custom-cache-dependencies"></a>Пользовательские зависимости кэша

ASP.NET 1.x разработчики закричали для пользовательских зависимостей кэша. В ASP.NET 1.x класс CacheDependency был запечатан, что не позволило разработчикам высвоить свои собственные классы из него. В ASP.NET 2.0 это ограничение устраняется, и разработчики могут свободно разрабатывать свои собственные пользовательские зависимости кэша. Класс CacheDependency позволяет создавать пользовательскую зависимость кэша на основе файлов, каталогов или ключей кэша.

Например, приведенный ниже код создает новую пользовательскую зависимость кэша на основе файла, называемого stuff.xml, расположенного в корне веб-приложения:

[!code-csharp[Main](caching/samples/sample3.cs)]

В этом случае при изменении файла stuff.xml элемент кэшированного элемента аннулируется.

Также можно создать пользовательскую зависимость кэша с помощью ключей кэша. Используя этот метод, удаление ключа кэша приведет к аннулированию кэшированных данных. Проиллюстрируем это на примере.

[!code-csharp[Main](caching/samples/sample4.cs)]

Чтобы вывести элемент из валид, который был вставлен выше, просто удалите элемент, который был вставлен в кэш, чтобы выступить в качестве ключа кэша.

[!code-csharp[Main](caching/samples/sample5.cs)]

Обратите внимание, что ключ элемента, который действует как ключ кэша, должен быть таким же, как и добавленная стоимость массива ключей кэша.

## <a name="polling-based-sql-cache-dependenciesalso-called-table-based-dependencies"></a>Зависимости кэша на основе опроса s'L (также называемые зависимостями на основе таблицы)

В модели кэша, основанной на опросах, используется модель, основанная на опросах. Модель, основанная на опросах, использует триггер в таблице базы данных, который срабатывает при изменении данных в таблице. Этот триггер обновляет поле **changeId** в таблице уведомлений, которое периодически ASP.NET проверки. Если поле **changeId** было обновлено, ASP.NET знает, что данные изменились, и это аннулирует кэшированные данные.

> [!NOTE]
> Модель, основанная на опросах, также может использоваться на основе опроса, рекомендуется использовать модель на основе запросов, рекомендуется использовать модель на основе запросов (обсуждается позже) с s'L Server 2005.

Для правильной работы зависимости кэша s-L с помощью модели, основанной на опросах, в таблицах должны быть включены уведомления. Это может быть достигнуто программно с помощью класса SqlCacheDependencyAdmin\_или с помощью утилиты aspnet regsql.exe.

Следующая командная строка регистрирует таблицу Продуктов в базе данных Northwind, расположенную в экземпляре s'L Server, названном *dbase* для зависимости кэша S'L.

[!code-console[Main](caching/samples/sample6.cmd)]

Ниже приводится объяснение коммутаторов командной строки, используемых в приведенной выше команде:

| **Коммутатор командной строки** | **Цель** |
| --- | --- |
| -S *server* | Указывает имя сервера. |
| -ed | Упомяните, что база данных должна быть включена для зависимости кэша S'L. |
| имя *базы\_данных* -d | Уотек имени базы данных, которое должно быть включено для зависимости кэша S'L. |
| -E | Уточняется, что aspnet\_regsql должен использовать аутентификацию Windows при подключении к базе данных. |
| -et | Упорядит, что мы включим таблицу баз данных для зависимости кэша S'L. |
| -t *\_название таблицы* | Упоньте имя таблицы базы данных для включения зависимости кэша S'L. |

> [!NOTE]
> Есть и другие переключатели,\_доступные для aspnet regsql.exe. Для полного списка, запустить\_aspnet regsql.exe -? с командной строки.

При запуске этой команды в базу данных сервера S'L Server вносятся следующие изменения:

- Добавлена таблица **AspNet\_SqlCacheTablesForChangeNotification.** Эта таблица содержит по одной строке для каждой таблицы в базе данных, для которой была включена зависимость кэша.
- В базе данных создаются следующие сохраненные процедуры:

| AspNet\_SqlCachePollingStoredProcedure | Запрашивает таблицу\_AspNet SqlCacheTablesForChangeNotification и возвращает все таблицы, включенные для зависимости кэша S'L и значения changeId для каждой таблицы. Этот сохраненный proc используется для опроса, чтобы определить, изменились ли данные. |
| --- | --- |
| AspNet\_SqlCache-КериРегистрацияСохраненяПроцедура | Возвращает все таблицы, включенные для зависимости кэша S'L, задав запрос в таблицу AspNet\_SqcacheTablesForChangeNotification и вернет все таблицы, включенные для зависимости кэша S'L. |
| AspNet\_SqlCacheRegisterХранитьПроцедура | Регистрирует таблицу для зависимости кэша S'L, добавляя необходимую запись в таблицу уведомлений и добавляя триггер. |
| AspNet\_SqlCacheUnRegisterTableStoredProcedure | Отменить таблицу для зависимости кэша S'L, удалив запись в таблице уведомлений и удалив триггер. |
| AspNet\_SqlCacheUpdateChangeIdStoredProcedure | Обновление таблицы уведомлений путем приращения changeId для измененной таблицы. ASP.NET использует это значение, чтобы определить, изменились ли данные. Как указано ниже, этот сохраненный proc выполняется триггером, созданным при включении таблицы. |

- Для таблицы создается триггер сервера S'L, называемый ** _\_названием_\_таблицы AspNet\_SqlCacheNotification Trigger.\_** Этот триггер выполняет AspNet\_SqlCacheUpdateChangeIdStoredProcedure, когда INSERT, UPDATE, или DELETE выполняется на столе.
- Роль сервера S'L, называемая **aspnet\_ChangeNotification\_ReceiveNotificationsOnlyAccess,** добавлена в базу данных.

**Aspnet\_ChangeNotification\_ReceiveNotificationsOnlyAccess** S'L Server роль EXEC разрешений на AspNet\_SqlCachePollingStoredProcedure. Для правильной работы модели опроса необходимо добавить свою учетную\_запись\_процесса в роль Aspnet ChangeNotification ReceiveNotificationsOnlyAccess. Инструмент aspnet\_regsql.exe не сделает это за вас.

### <a name="configuring-polling-based-sql-cache-dependencies"></a>Настройка зависимостей кэша на основе опросов на основе S'L

Для настройки зависимостей кэша на основе опросов на основе S'L требуется несколько шагов. Первым шагом является включение базы данных и таблицы, как обэтом говорилось выше. Как только этот шаг будет завершен, остальная часть конфигурации будет следующей:

- Настройка файла конфигурации ASP.NET.
- Настройка SqlCacheЗависимость

### <a name="configuring-the-aspnet-configuration-file"></a>Настройка файла конфигурации ASP.NET

В дополнение к добавлению строки соединения, как это &lt;обсуждалось&gt; в &lt;предыдущем модуле,&gt; необходимо также настроить элемент кэша с элементом sqlCacheDependency, как показано ниже:

[!code-xml[Main](caching/samples/sample7.xml)]

Эта конфигурация позволяет получить зависимость к эшеля s'L от базы данных *пабов.* Обратите внимание, что атрибут &lt;pollTime в&gt; элементе sqlCacheDependency по умолчанию до 60000 миллисекунд или 1 минуты. (Это значение не может быть меньше 500 миллисекунд.) В этом &lt;примере&gt; элемент добавления добавляет новую базу данных и переопределяет время опроса, установив его на 9000000 миллисекунд.

#### <a name="configuring-the-sqlcachedependency"></a>Настройка SqlCacheЗависимость

Следующим шагом является настройка SqlCacheDependency. Самый простой способ сделать это — указать значение для атрибута SqlDependency в директиве Outcache следующим образом:

[!code-aspx[Main](caching/samples/sample8.aspx)]

В приведенной выше директиве OutputCache для *авторов* в базе данных *пабов* настраивается зависимость ккэша S'L. Несколько зависимостей можно настроить, разделив их с полуколонной, как:

[!code-aspx[Main](caching/samples/sample9.aspx)]

Другой метод настройки SqlCacheDependency заключается в том, чтобы сделать это программно. Следующий код создает новую зависимость кэша s'L от таблицы *авторов* в базе данных *пабов.*

[!code-csharp[Main](caching/samples/sample10.cs)]

Одним из преимуществ программного определения зависимости кэша является то, что можно обрабатывать любые возможные исключения. Например, если вы попытаетесь определить зависимость кэша s'L для базы данных, которая не была включена для уведомления, будет брошено исключение **DatabaseNotEnabledForNotificationException.** В этом случае можно попытаться включить базу данных для уведомлений, позвонив в метод **SqlCacheDependencyAdmin.EnableNotifications** и передав ему имя базы данных.

Аналогичным образом, если вы попытаетесь определить зависимость кэша s'L для таблицы, которая не была включена для уведомления, будет **брошена таблицаTableNotEnabledForNotificationException.** Затем можно позвонить в **метод SqlCacheDependencyAdmin.EnableTableForNotifications,** передав ему имя базы данных и название таблицы.

Следующий пример кода иллюстрирует, как правильно настроить обработку исключений при настройке зависимости кэша S'L.

[!code-csharp[Main](caching/samples/sample11.cs)]

Дополнительная информация:[https://msdn.microsoft.com/library/t9x04ed2.aspx](https://msdn.microsoft.com/library/t9x04ed2.aspx)

## <a name="query-based-sql-cache-dependencies-sql-server-2005-only"></a>Зависимости кэша на основе запросов на основе S'L (только сервер S'L 2005)

При использовании s'L Server 2005 для зависимости кэша S'L модель на основе опроса не требуется. При использовании с помощью S'L Server 2005 зависимости кэша S'L напрямую передаются через соединения s'L Server в экземпляре сервера S'L (не требуется дальнейшая конфигурация) с помощью уведомлений запросов S'L Server 2005.

Самый простой способ включить уведомление на основе запроса — сделать это декларативно, установив атрибут **SqlCacheDependency** объекта источника данных в **CommandNotification** и установив атрибут **EnableCaching** на **истину.** Используя этот метод, код не требуется. Если результат команды, выполненной против источника данных, изменяется, он аннулирует данные кэша.

Следующий пример настраивает элемент управления исходом данных для зависимости кэша кэша:

[!code-aspx[Main](caching/samples/sample12.aspx)]

В этом случае, если запрос, указанный в **SelectCommand,** возвращает другой результат, чем первоначально, результаты, которые кэшируются, аннулируются.

Вы также можете указать, что все ваши источники данных будут включены для зависимостей кэша S'L, установив атрибут **SqlDependency** директивы **OutputCache** в **CommandNotification.** Приведенный ниже пример иллюстрирует это.

[!code-aspx[Main](caching/samples/sample13.aspx)]

> [!NOTE]
> Для получения более подробной информации об уведомлениях о запросах в S'L Server 2005, см.

Другой метод настройки зависимости кэша на основе запроса, основанная на S'L, заключается в программном использовании класса SqlCacheDependency. Следующий пример кода иллюстрирует, как это достигается.

[!code-csharp[Main](caching/samples/sample14.cs)]

Дополнительная информация:[https://msdn.microsoft.com/library/default.asp?url=/library/enus/dnvs05/html/querynotification.asp](https://msdn.microsoft.com/library/default.asp?url=/library/enus/dnvs05/html/querynotification.asp)

## <a name="post-cache-substitution"></a>Замена после кэша

Кэширование страницы может значительно повысить производительность веб-приложения. Однако в некоторых случаях для кэша большая часть страницы требуется, а некоторые фрагменты страницы — динамические. Например, если вы создаете страницу новостей, которая полностью статична для определенных периодов времени, можно настроить всю страницу для кэша. Если вы хотите включить вращающийся рекламный баннер, который изменялся на каждом запросе страницы, то часть страницы, содержащей рекламу, должна быть динамичной. Чтобы позволить кэшировать страницу, но динамически заменить некоторые содержимое, можно использовать ASP.NET замену после кэша. При замене после кэша вся страница кэшируется с определенными частями, помеченными как освобожденные от кэширования. На примере рекламных баннеров управление AdRotator позволяет воспользоваться преимуществами замены после кэша, чтобы объявления динамически создавались для каждого пользователя и для обновления каждой страницы.

Существует три способа реализации замены после кэша:

- Декларативно, используя контроль замены.
- Программно, используя API управления заменой.
- Неявно, используя управление AdRotator.

### <a name="substitution-control"></a>Контроль замещения

Управление ASP.NET замена определяет раздел кэшированной страницы, который создается динамически, а не кэшируется. Вы размещаете элемент управления замены в месте на странице, где вы хотите, чтобы динамическое содержимое отображалось. Во время выполнения элемент управления замены вызывает метод, указанный с свойством MethodName. Метод должен вернуть строку, которая затем заменяет содержимое элемента замены. Метод должен быть статическим методом на управлении, содержащем Страницу или UserControl. Использование элемента управления заменой приводит к изменению кэшируемости клиентского кэша на кэшируемость сервера, так что страница не будет кэшироваться на клиенте. Это гарантирует, что будущие запросы на страницу снова вызовут метод для создания динамического содержимого.

### <a name="substitution-api"></a>Замена API

Для создания динамического контента для кэшированной страницы можно назвать метод [WriteSubstitution](https://msdn.microsoft.com/library/system.web.httpresponse.writesubstitution.aspx) в коде страницы, передав его в качестве параметра. Метод, обрабатывая создание динамического содержимого, принимает один параметр [HttpContext](https://msdn.microsoft.com/library/system.web.httpcontext.aspx) и возвращает строку. Строка возврата — это содержимое, которое будет заменено в данном месте. Преимущество вызова метода WriteSubstitution вместо декларативного использования элемента замены заключается в том, что можно вызвать метод любого произвольного объекта, а не вызывать статический метод Страницы или объект UserControl.

Вызов метода WriteSubstitution приводит к изменению кэшируемости клиентской стороны на кэшируемость сервера, так что страница не будет кэшироваться на клиенте. Это гарантирует, что будущие запросы на страницу снова вызовут метод для создания динамического содержимого.

### <a name="adrotator-control"></a>Управление адРотатором

Управление сервером AdRotator осуществляет поддержку замены пост-кэша внутри компании. Если вы разместите элемент управления AdRotator на вашей странице, он будет отображать уникальную рекламу на каждом запросе, независимо от того, является ли кэширована родительская страница. В результате страница, соотвествующая элемент управления AdRotator, кэшируется только на стороне сервера.

## <a name="controlcachepolicy-class"></a>Класс ControlCachePolicy

Класс ControlCachePolicy позволяет осуществлять программный контроль кэширования фрагментов с помощью пользовательских элементов управления. ASP.NET встраивает элементы управления пользователем в экземпляр [BasePartialCachingControl.](https://msdn.microsoft.com/library/system.web.ui.basepartialcachingcontrol.aspx) Класс BasePartialCachingControl представляет пользовательский элемент управления с включенным кэшированием на выходе.

При доступе к свойству [BasePartialCachingControl.CachePolicy,](https://msdn.microsoft.com/library/system.web.ui.basepartialcachingcontrol.cachepolicy.aspx) управляющему [partialCachingControl,](https://msdn.microsoft.com/library/system.web.ui.partialcachingcontrol.aspx) вы всегда получите действительный объект ControlCachePolicy. Однако, если вы получаете доступ к свойству [UserControl.CachePolicy](https://msdn.microsoft.com/library/system.web.ui.usercontrol.cachepolicy.aspx) элементуправления [UserControl,](https://msdn.microsoft.com/library/system.web.ui.usercontrol.aspx) вы получаете действительный объект ControlCachePolicy только в том случае, если пользовательский контроль уже обернут элементом управления BasePartialCachingControl. Если он не обернут, объект ControlCachePolicy, возвращенный свойством, будет бросать исключения при попытке манипулировать им, поскольку у него нет связанного BasePartialCachingControl. Чтобы определить, поддерживает ли экземпляр UserControl кэширование без создания исключений, проинспектировать свойство [SupportsCaching.](https://msdn.microsoft.com/library/system.web.ui.controlcachepolicy.supportscaching.aspx)

Использование класса ControlCachePolicy является одним из нескольких способов включения кэширования выходных данных. В следующем списке описаны методы, которые можно использовать для включения кэширования выходов:

- Используйте директиву [OutputCache,](https://msdn.microsoft.com/library/hdxfb6cy.aspx) чтобы обеспечить кэширование выходных данных в декларативных сценариях.
- Используйте атрибут [PartialCachingAttribute](https://msdn.microsoft.com/library/system.web.ui.partialcachingattribute.aspx) для включения кэширования для управления пользователем в файле с кодом.
- Используйте класс ControlCachePolicy для указания настроек кэша в программных сценариях, в которых вы работаете с экземплярами BasePartialCachingControl, которые были включены в кэш с помощью одного из предыдущих методов и динамически загружены с помощью метода [System.Web.UI.TemplateControl.LoadControl.](https://msdn.microsoft.com/library/system.web.ui.templatecontrol.loadcontrol.aspx)

Экземпляр ControlCachePolicy может успешно управляться только между этапами Init и PreRender жизненного цикла управления. Если вы измените объект ControlCachePolicy после фазы PreRender, ASP.NET выбрасывает исключение, поскольку любые изменения, внесенные после визы управления, не могут повлиять на настройки кэша (элемент кэшируется на этапе Рендера). Наконец, экземпляр управления пользователем (и, следовательно, его объект ControlCachePolicy) доступен только для программных манипуляций, когда он фактически отображается.

## <a name="changes-to-caching-configuration---the-ltcachinggt-element"></a>Изменения в конфигурации &lt;кэширования - Элемент кэширования&gt;

Есть несколько изменений конфигурации кэширования в ASP.NET 2.0. Элемент &lt;кэширования&gt; является новым в ASP.NET 2.0 и позволяет вносить изменения конфигурации кэширования в файл конфигурации. Доступны следующие атрибуты.

| **Элемент** | **Описание** |
| --- | --- |
| **Кэша** | Необязательный элемент. Определяет глобальные настройки кэша приложений. |
| **выходCache** | Необязательный элемент. Определяет настройки выходных кэша в масштабах всего приложения. |
| **outputCacheSettings** | Необязательный элемент. Определяет настройки вывода кэша, которые могут быть применены к страницам приложения. |
| **sqlCacheDependency** | Необязательный элемент. Настраивает зависимости кэш-памяти SQL для приложения ASP.NET. |

### <a name="the-ltcachegt-element"></a>Элемент &lt;кэша&gt;

В элементе &lt;кэша&gt; доступны следующие атрибуты:

| **attribute** | **Описание** |
| --- | --- |
| **отключитьПамятьКоллекция** | Дополнительный атрибут **Boolean.** Получает или устанавливает значение, указывающее, отключена ли коллекция памяти кэша, возникая при давлении памяти. |
| **отключитьэкспирация** | Дополнительный атрибут **Boolean.** Получает или устанавливает значение, указывающее, отключен ли срок действия кэша. При отключении кэшированные элементы не истекают, а пределенкровка элементов с истекшим сроком действия кэша не происходит. |
| **privateBytesLimit** | Дополнительный атрибут **Int64.** Получает или устанавливает значение, указывающее максимальный размер частных байтов приложения до того, как кэш начнет промывку просроченных элементов и попытки вернуть память. Это ограничение включает в себя как память, используемую кэше, так и обычные накладные расходы памяти из запущенного приложения. Установка нуля указывает на то, что ASP.NET будет использовать свою собственную эвристику для определения того, когда начать восстановление памяти. |
| **percentagePhysicalMemoryUsedLimit** | Дополнительный атрибут **Int32.** Получает или устанавливает значение, указывающее на максимальный процент физической памяти машины, который может быть использован приложением до того, как кэш начинает промывку просроченных элементов и пытается восстановить память Это использование памяти включает в себя как память, используемую кэша, так и нормальное использование памяти работающего приложения. Установка нуля указывает на то, что ASP.NET будет использовать свою собственную эвристику для определения того, когда начать восстановление памяти. |
| **privateBytesPollTime** | Дополнительный атрибут **TimeSpan.** Получает или устанавливает значение, указывающее временной интервал между опросом для использования памяти частных байтов приложения. |

### <a name="the-ltoutputcachegt-element"></a>Элемент &lt;выводаCache&gt;

Для элемента &lt;outputCache&gt; доступны следующие атрибуты.

|       <strong>attribute</strong>        |                                                                                                                                                                                                                                                       <strong>Описание</strong>                                                                                                                                                                                                                                                       |
|-----------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|   <strong>включитьOutputCache</strong>    |                                                                                                                                                          Дополнительный атрибут <strong>Boolean.</strong> Позволяет/отстраняет кэш вывода страницы. Если отключено, ни одна страница не кэшируется независимо от программных или декларативных настроек. Значение по умолчанию <strong>верно.</strong>                                                                                                                                                           |
|  <strong>включитьФрагментКэш</strong>   |                                                Дополнительный атрибут <strong>Boolean.</strong> Позволяет/отражает кэш фрагмента приложения. При отключении страницы не кэшируются независимо от используемой директивы [OutputCache](https://msdn.microsoft.com/library/hdxfb6cy.aspx) или используемого профиля кэширования. Включает в себя заголовок управления кэша, указывающий на то, что прокси-серверы вверх по течению, а также клиенты браузера не должны пытаться кэшировать выход страницы. Значение по умолчанию <strong>является ложным.</strong>                                                 |
| <strong>отправитьCacheControlHeader</strong> |                                                                                                                                                      Дополнительный атрибут <strong>Boolean.</strong> Получает или устанавливает значение, указывающее, отправляется ли <strong>контроль кэша: частный</strong> заголовок по умолчанию отправляется модулем вывода кэша. Значение по умолчанию <strong>является ложным.</strong>                                                                                                                                                      |
|      <strong>omitVaryStar</strong>      | Дополнительный атрибут <strong>Boolean.</strong> Включает/отменяет отправку http<strong>" \<Vary: /сильный><em>" заголовок в ответе. При настройке по умолчанию ложного, заголовок</em> \*«Вари:» <strong>отправляется на кэшированные страницы вывода. При отправке заголовка Vary позволяет кэшировать различные версии в зависимости от того, что указано в заголовке Vary. Например, <em>Vary:User-Agents</em> будет хранить различные версии страницы на основе запроса агента пользователя. Значение по умолчанию является ложным</strong>. |

### <a name="the-ltoutputcachesettingsgt-element"></a>Элемент &lt;outputCacheSettings&gt;

Элемент &lt;outputCacheSettings&gt; позволяет создавать профили кэша, как описано ранее. &lt;Единственным элементом элемента&gt; выводаCacheSettings &lt;является элемент outputCacheProfiles&gt; для настройки профилей кэша.

### <a name="the-ltsqlcachedependencygt-element"></a>Элемент &lt;sqlCacheDependency&gt;

Следующие атрибуты доступны &lt;для элемента sqlCacheDependency.&gt;

| **attribute** | **Описание** |
| --- | --- |
| **Включен** | Требуется атрибут **Булеан.** Указывает, опрошены ли изменения. |
| **опросВремя** | Дополнительный атрибут **Int32.** Устанавливает частоту, с которой SqlCacheDependency осмоты таблице базы данных для изменений. Это значение соответствует количеству миллисекунд между последовательными опросами. Он не может быть установлен до менее чем 500 миллисекунд. Значение по умолчанию составляет 1 минуту. |

### <a name="more-information"></a>Дополнительные сведения

Существует некоторая дополнительная информация, о которой следует знать о конфигурации кэша.

- Если лимит на закрытые байты рабочего не установлен, кэш будет использовать один из следующих ограничений: 

    - x86 2 ГБ: 800 МБ или 60% физической оперативной памяти, в зависимости от того, что меньше
    - x86 3ГБ: 1800Mb или 60% физической оперативной памяти, в зависимости от того, меньше
    - x64: 1 терабайт или 60% физической оперативной памяти, в зависимости от того, что меньше
- Если оба процесса работы частные байты предел &lt;&gt; и кэш privateBytesLimit/ установлены, кэш будет использовать минимум двух.
- Так же, как в 1.x, мы сбрасываем записи кэша и вызываем GC. Сбор по двум причинам: 

    - Мы очень близки к пределу частных байтов
    - Доступная память близка или менее 10%
- Вы можете эффективно отключить отделку и кэш для &lt;низкодоступных условий&gt; памяти, установив кэш-процентPhysicalMemoryUseLimit/ до 100.
- В отличие от 1.x, 2.0 приостанавливает отделку и собирает звонки, если последний GC. Сбор не уменьшил частные байты или размер управляемых кучи более чем на 1% от (кэша) предела памяти.

## <a name="lab1-custom-cache-dependencies"></a>Lab1: Пользовательские зависимости кэша

1. Создайте новый веб-узел.
2. Добавьте новый файл XML под названием cache.xml и сохраните его в корне веб-приложения.
3. Добавьте следующий код\_в метод загрузки страницы в коде за по умолчанию.aspx: 

    [!code-csharp[Main](caching/samples/sample15.cs)]
4. Добавьте следующее в верхней части значения default.aspx в исходном представлении: 

    [!code-aspx[Main](caching/samples/sample16.aspx)]
5. Просмотр По умолчанию.aspx. Что говорит время?
6. Обновите приложение браузера. Что говорит время?
7. Откройте cache.xml и добавьте следующий код: 

    [!code-xml[Main](caching/samples/sample17.xml)]
8. Сохранить cache.xml.
9. Обновите свой браузер. Что говорит время?
10. Объясните, почему время обновляется вместо отображения ранее кэшированных значений:

## <a name="lab-2-using-polling-based-cache-dependencies"></a>Лаборатория 2: Использование зависимостей кэша на основе опросов

Эта лаборатория использует проект, созданный в предыдущем модуле, который позволяет редактировать данные в базе данных Northwind с помощью управления GridView и DetailsView.

1. Откройте проект в Visual Studio 2005.
2. Запустите утилиту\_aspnet regsql против базы данных Northwind, чтобы включить базу данных и таблицу Продуктов. Используйте следующую команду из команды Visual Studio: 

    [!code-console[Main](caching/samples/sample18.cmd)]
3. Добавьте следующее в файл web.config: 

    [!code-xml[Main](caching/samples/sample19.xml)]
4. Добавьте новую веб-форму под названием showdata.aspx.
5. Добавьте следующую директиву outputcache на страницу showdata.aspx: 

    [!code-aspx[Main](caching/samples/sample20.aspx)]
6. Добавьте следующий код\_в Page Load of showdata.aspx: 

    [!code-html[Main](caching/samples/sample21.html)]
7. Добавьте новый элемент управления SqlDataSource для showdata.aspx и настройте его на использование соединения базы данных Northwind. Нажмите кнопку Далее.
8. Выберите флажки ProductName и ProductID и нажмите далее.
9. Нажмите кнопку «Готово».
10. Добавьте новую страницу GridView на страницу showdata.aspx.
11. Выберите SqlDataSource1 из выпадения.
12. Сохранить и просматривать showdata.aspx. Обратите внимание на отображаемые времена.
