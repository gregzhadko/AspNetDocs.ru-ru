---
uid: web-forms/overview/moving-to-aspnet-20/caching
title: Кэширование | Документация Майкрософт
author: microsoft
description: Понимание кэширования важно для высокопроизводительных приложений ASP.NET. ASP.NET 1.x предлагаются три различных варианта для кэширования; кэширование, вывода...
ms.author: riande
ms.date: 02/20/2005
ms.assetid: 2bb109d2-e299-46ea-9054-fa0263b59165
msc.legacyurl: /web-forms/overview/moving-to-aspnet-20/caching
msc.type: authoredcontent
ms.openlocfilehash: 5e16415df5bd4203995bec943ffa682f7da82357
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/09/2019
ms.locfileid: "59400208"
---
# <a name="caching"></a>Кэширование

по [Microsoft](https://github.com/microsoft)

> Понимание кэширования важно для высокопроизводительных приложений ASP.NET. ASP.NET 1.x предлагаются три различных варианта для кэширования; кэширование вывода, фрагментарное кэширование и интерфейс API кэша.


Понимание кэширования важно для высокопроизводительных приложений ASP.NET. ASP.NET 1.x предлагаются три различных варианта для кэширования; кэширование вывода, фрагментарное кэширование и интерфейс API кэша. ASP.NET 2.0 предлагает все три из этих методов, но он добавляет некоторые существенные дополнительные возможности. Существует несколько новые зависимости кэша и у разработчиков теперь есть возможность создания пользовательских зависимостей кэша также. Конфигурация кэширования также значительно улучшено в ASP.NET 2.0.

## <a name="new-features"></a>Новые функции

## <a name="cache-profiles"></a>Профили кэша

Профили кэша позволяют разработчикам определять параметры конкретного кэша, которые затем могут применяться к отдельным страницам. Например если у вас есть несколько страниц, срок действия из кэша через 12 часов, можно легко создать профиль кэша, которые могут применяться к этим страницам. Чтобы добавить новый профиль кэша, используйте &lt;outputCacheSettings&gt; раздел в файле конфигурации. Например, ниже приведен конфигурации профиль кэша, который называется *twoday* , предназначенный для настройки кэша в течение 12 часов.

[!code-xml[Main](caching/samples/sample1.xml)]

Чтобы применить этот профиль кэша на определенной странице, используйте атрибут CacheProfile директивы @ OutputCache, как показано ниже:

[!code-aspx[Main](caching/samples/sample2.aspx)]

## <a name="custom-cache-dependencies"></a>Пользовательских зависимостей кэша

Разработчики ASP.NET 1.x пришел для пользовательских зависимостей кэша. В ASP.NET 1.x, класс CacheDependency был запечатанный какие не позволяло разработчикам наследования свои собственные классы из него. В ASP.NET 2.0 это ограничение будет удален, и разработчики могут разрабатывать собственные пользовательских зависимостей кэша. Класс CacheDependency позволяет создавать зависимости пользовательского кэша на основе файлов, каталогов или ключей кэша.

Например приведенный ниже код создает новую зависимость пользовательского кэша на основе файла, вызывается stuff.xml, расположенный в корневом каталоге веб-приложения:

[!code-csharp[Main](caching/samples/sample3.cs)]

В этом случае при изменении файла stuff.xml, кэшированный элемент становится недействительным.

Можно также создать зависимость пользовательского кэша с помощью ключей кэша. При использовании этого метода для удаления ключа кэша станут недействительными кэшированные данные. Это показано в приведенном ниже примере.

[!code-csharp[Main](caching/samples/sample4.cs)]

Чтобы сделать недействительным элемент, который был вставлен выше, просто удалите элемент, который был помещен в кэш в качестве ключа кэша.

[!code-csharp[Main](caching/samples/sample5.cs)]

Обратите внимание, что ключ элемента, который выступает в качестве ключа кэша должен быть таким же, как значение, добавляемое к массив ключей кэша.

## <a name="polling-based-sql-cache-dependenciesalso-called-table-based-dependencies"></a>На основе опроса Dependencies(Also called Table-Based Dependencies) кэша SQL

SQL Server 7 и 2000 используют модель на основе опроса для зависимости кэша SQL. Модель на основе опроса использует триггер на таблицу базы данных, которая активируется при изменении данных в таблице. Запускать обновления **changeId** в таблице уведомлений, которая периодически проверяет ASP.NET. Если **changeId** поле было обновлено, ASP.NET знает, что данные были изменены, и делает недействительными кэшированные данные.

> [!NOTE]
> SQL Server 2005 можно также использовать модель на основе опроса, но так как модель на основе опроса не самым эффективным модели, рекомендуется использовать модель на основе запроса (описываемый ниже) с SQL Server 2005.


В порядке для зависимости кэша SQL, используя модель на основе опроса для правильной работы таблицы должны содержать включены уведомления. Это можно сделать программно с помощью класса SqlCacheDependencyAdmin или с помощью aspnet\_regsql.exe служебной программы.

Следующая команда регистрирует таблицы Products в базе данных Northwind, размещенной на экземпляре SQL Server с именем *dbase* зависимости кэша SQL.

[!code-console[Main](caching/samples/sample6.cmd)]

Ниже приведено описание параметров командной строки, используемые в приведенной выше команде.

| **Параметр командной строки** | **Цель** |
| --- | --- |
| -S *сервера* | Указывает имя сервера. |
| -ed | Указывает, что база данных должна быть включена для зависимости кэша SQL. |
| -d *базы данных\_имя* | Указывает имя базы данных, которые должны быть разрешены для зависимости кэша SQL. |
| -E | Указывает, что aspnet\_regsql следует использовать проверку подлинности Windows при подключении к базе данных. |
| -et | Указывает, что мы поощряем таблицу базы данных для зависимости кэша SQL. |
| -t *таблицы\_имя* | Указывает имя таблицы базы данных, чтобы включить для зависимости кэша SQL. |

> [!NOTE]
> Существуют другие параметры для aspnet\_regsql.exe. Полный список, выполните aspnet\_regsql.exe-? из командной строки.


При выполнении этой команды к базе данных SQL Server вносятся следующие изменения:

- **AspNet\_SqlCacheTablesForChangeNotification** таблица добавляется. Эта таблица содержит по одной строке для каждой таблицы в базе данных, для которой включена зависимость кэша SQL.
- Следующие хранимые процедуры создаются внутри базы данных:


| AspNet\_SqlCachePollingStoredProcedure | Запрашивает AspNet\_SqlCacheTablesForChangeNotification таблицы и возвращает все таблицы, которые включены для зависимости кэша SQL и значение changeId для каждой таблицы. Данная хранимая процедура используется для опроса для определения того, если данные были изменены. |
| --- | --- |
| AspNet\_SqlCacheQueryRegisteredTablesStoredProcedure | Возвращает все таблицы включен для зависимости кэша SQL, запросив AspNet\_SqlCacheTablesForChangeNotification таблицы и возвращает все таблицы, поддержка SQL зависимости кэша. |
| AspNet\_SqlCacheRegisterTableStoredProcedure | Регистрирует зависимости кэша SQL для таблицы, добавив необходимые записи в таблице уведомлений и добавляет триггер. |
| AspNet\_SqlCacheUnRegisterTableStoredProcedure | Отменяет регистрацию зависимости кэша SQL для таблицы, удалив записи в таблице уведомлений и удаляет триггер. |
| AspNet\_SqlCacheUpdateChangeIdStoredProcedure | Обновляет таблицу уведомлений, увеличивая changeId с измененной таблицей. ASP.NET использует это значение, чтобы определить, если данные были изменены. Как показано ниже, данная хранимая процедура выполняется с помощью триггера, который создается при включении таблицы. |


- Триггер SQL Server вызывается ***таблицы\_имя *\_AspNet\_SqlCacheNotification\_триггера** создается для таблицы. Этот триггер выполняет AspNet\_SqlCacheUpdateChangeIdStoredProcedure при выполнении инструкции INSERT, UPDATE или DELETE для таблицы.
- Роль SQL Server называется **aspnet\_ChangeNotification\_ReceiveNotificationsOnlyAccess** добавляется в базу данных.

**Aspnet\_ChangeNotification\_ReceiveNotificationsOnlyAccess** роль SQL Server имеет разрешения EXEC для AspNet\_SqlCachePollingStoredProcedure. Чтобы модель опроса работал правильно, необходимо добавить учетной записи процесса для aspnet\_ChangeNotification\_ReceiveNotificationsOnlyAccess роли. Aspnet\_regsql.exe средство не сделает это за вас.

### <a name="configuring-polling-based-sql-cache-dependencies"></a>Настройка зависимостей кэша SQL на основе опроса

Существуют несколько шагов, которые требуются для настройки на основе опроса зависимости кэша SQL. Первым шагом является включение базы данных и таблицы, как описано выше. По завершении этого шага, остальной части конфигурации выглядит следующим образом:

- Настройка файла конфигурации ASP.NET.
- Настройка SqlCacheDependency

### <a name="configuring-the-aspnet-configuration-file"></a>Настройка файла конфигурации ASP.NET

Помимо добавления строки подключения, как описано в предыдущем модуле, необходимо также настроить &lt;кэша&gt; элемент с &lt;sqlCacheDependency&gt; элемент, как показано ниже:

[!code-xml[Main](caching/samples/sample7.xml)]

Такая конфигурация позволяет зависимость кэша SQL на *pubs* базы данных. Обратите внимание, что атрибут pollTime &lt;sqlCacheDependency&gt; элемент по умолчанию на 60 000 миллисекунд и 1 минуту. (Это значение не может быть меньше, чем 500 миллисекунд). В этом примере &lt;добавить&gt; элемент добавляет новую базу данных и переопределяет pollTime, задав для него 9000000 миллисекунд.

#### <a name="configuring-the-sqlcachedependency"></a>Настройка SqlCacheDependency

Следующим шагом является настройка SqlCacheDependency. Для этого проще всего указать значение для атрибута SqlDependency в директиве @ Outcache следующим образом:

[!code-aspx[Main](caching/samples/sample8.aspx)]

В директиве @ OutputCache выше зависимость кэша SQL настроена для *авторов* в таблицу *pubs* базы данных. Можно настроить несколько зависимостей, разделяя их точкой с запятой следующим образом:

[!code-aspx[Main](caching/samples/sample9.aspx)]

Еще одним методом настройки SqlCacheDependency — сделать это программным способом. Следующий код создает новый зависимость кэша SQL на *авторов* в таблицу *pubs* базы данных.

[!code-csharp[Main](caching/samples/sample10.cs)]

Одним из преимуществ программно, путем определения зависимостей кэша SQL — это, что вы можете обрабатывать все исключения, которые могут возникнуть. Например, при попытке определить зависимость кэша SQL для базы данных, которая не была включена для уведомлений **DatabaseNotEnabledForNotificationException** будет создано исключение. В этом случае можно попытаться разрешить для базы данных уведомления путем вызова **SqlCacheDependencyAdmin.EnableNotifications** метод и передает имя базы данных.

Аналогичным образом, при попытке определить зависимость кэша SQL для таблицы, которая не была включена для уведомлений, **TableNotEnabledForNotificationException** будет создано. Затем можно вызвать **SqlCacheDependencyAdmin.EnableTableForNotifications** метод, передавая ему имя базы данных и имя таблицы.

В следующем образце кода показано, как правильно настроить обработку исключений при настройке зависимость кэша SQL.

[!code-csharp[Main](caching/samples/sample11.cs)]

Дополнительные сведения: [https://msdn.microsoft.com/library/t9x04ed2.aspx](https://msdn.microsoft.com/library/t9x04ed2.aspx)

## <a name="query-based-sql-cache-dependencies-sql-server-2005-only"></a>Зависимости кэша SQL на основе запроса (только для SQL Server 2005)

При использовании SQL Server 2005 для зависимости кэша SQL, модель на основе опроса необязателен. При использовании с SQL Server 2005, зависимости кэша SQL обмениваться данными напрямую через подключения SQL к экземпляру SQL Server (дальнейшая настройка не требуется) с помощью уведомлений о запросах SQL Server 2005.

Включение уведомления на основе запроса проще всего сделать декларативно, задав **SqlCacheDependency** атрибут объекта источника данных для **CommandNotification** и **EnableCaching** атрибут **true**. При использовании этого метода код не является обязательным. Если результатом выполнения команды выполняется с данными источника изменений, он сделает данные кэша.

В следующем примере настраивается элемент управления источником данных для зависимости кэша SQL:

[!code-aspx[Main](caching/samples/sample12.aspx)]

В данном случае, если в запросе указана в **SelectCommand** возвращает другой результат, чем он был первоначально, результаты которых кэшируются становятся недействительными.

Можно также указать, что все источники данных включить для зависимости кэша SQL, задав **SqlDependency** атрибут **@ OutputCache** директиву **CommandNotification** . Это показано в следующем примере.

[!code-aspx[Main](caching/samples/sample13.aspx)]

> [!NOTE]
> Дополнительные сведения о уведомления о запросах в SQL Server 2005 см. в разделе SQL Server Books Online.


Еще одним методом настройки зависимостей кэша SQL на основе запроса — сделать это программным способом с помощью класса SqlCacheDependency. В следующем образце кода показано, как это происходит.

[!code-csharp[Main](caching/samples/sample14.cs)]

Дополнительные сведения: [https://msdn.microsoft.com/library/default.asp?url=/library/enus/dnvs05/html/querynotification.asp](https://msdn.microsoft.com/library/default.asp?url=/library/enus/dnvs05/html/querynotification.asp)

## <a name="post-cache-substitution"></a>Подстановка пост-кэша

Страница «кэширование» могут значительно повысить производительность веб-приложения. Тем не менее в некоторых случаях требуется большая часть страницы должен быть помещен в кэш и некоторые фрагменты страницы динамическим. Например при создании страницы новостей, который является полностью статической в течение заданного периода времени, можно задать всей страницы должен быть помещен в кэш. Если вы хотите включить чередующееся баннер, который изменен при каждом запросе страницы, часть страницы, содержащей объявление необходимо быть динамическими. Чтобы разрешить кэшировать страницу, но заменять часть содержимого динамически, можно использовать подстановку пост-кэша ASP.NET. С помощью Подстановка пост-кэша вся страница кэшируется с определенными частями, помечаются как исключенные из кэширования. В примере с рекламными объявлениями элемента управления AdRotator позволяет воспользоваться преимуществами Подстановка пост-кэша для создания рекламы динамически для каждого пользователя и для каждого обновления страницы.

Существует три способа реализации Подстановка пост-кэша:

- Декларативно используя элемент управления Substitution.
- Программно с помощью API управления подстановки.
- Неявно с помощью элемента управления AdRotator.

### <a name="substitution-control"></a>Элемент управления Substitution

Элемент управления ASP.NET Substitution задает раздел кэшированные страницы, которая будет создана динамически, а не кэшируются. Рекомендуется размещать элемент управления Substitution в место на странице для отображения динамического содержимого. Во время выполнения элемент управления Substitution вызывает метод, который указывается с помощью свойства MethodName. Метод должен возвращать строку, которая заменит содержимое элемента управления подстановки. Метод должен быть статический метод для содержащегося элемента управления страницы или UserControl. Используя элемент управления substitution приводит к возможности кэширования на стороне клиента на сервер кэширования, таким образом, чтобы страница не будет кэшироваться на клиенте. Это гарантирует, что будущие запросы на странице вызывать метод, чтобы создать динамическое содержимое.

### <a name="substitution-api"></a>Подстановка API

Чтобы создать динамическое содержимое для кэшированных страниц программными средствами, можно вызвать [WriteSubstitution](https://msdn.microsoft.com/library/system.web.httpresponse.writesubstitution.aspx) метод в коде страницы, передав имя метода как параметр. Метод, обрабатывающий создание динамического содержимого принимает один [HttpContext](https://msdn.microsoft.com/library/system.web.httpcontext.aspx) параметр и возвращает строку. Возвращаемая строка представляет содержимое, которое будут заменены в заданном расположении. Преимуществом вызова метода WriteSubstitution вместо того чтобы использовать элемент управления Substitution декларативно является то, что можно вызвать метод любой произвольный объект, а не вызов статического метода страницы или объекта UserControl.

Вызов метода WriteSubstitution приводит к возможности кэширования на стороне клиента на сервер кэширования, таким образом, чтобы страница не будет кэшироваться на клиенте. Это гарантирует, что будущие запросы на странице вызывать метод, чтобы создать динамическое содержимое.

### <a name="adrotator-control"></a>Элемента управления AdRotator

Подстановка пост-кэша поддержка реализуемый серверного элемента управления AdRotator внутренним образом. Если поместить элемент управления AdRotator на странице, он будет отображать уникальные баннеры при каждом запросе, независимо от того, кэшируется ли родительская страница. Таким образом содержит элемент управления AdRotator — только кэшированные на сервере.

## <a name="controlcachepolicy-class"></a>Класс ControlCachePolicy

Класс ControlCachePolicy обеспечивает программный контроль фрагмента кэширования с помощью пользовательских элементов управления. ASP.NET внедряет пользовательских элементов управления в пределах [BasePartialCachingControl](https://msdn.microsoft.com/library/system.web.ui.basepartialcachingcontrol.aspx) экземпляра. Класс BasePartialCachingControl представляет пользовательский элемент управления, который содержит выходные включено кэширование.

При доступе к [BasePartialCachingControl.CachePolicy](https://msdn.microsoft.com/library/system.web.ui.basepartialcachingcontrol.cachepolicy.aspx) свойство [PartialCachingControl](https://msdn.microsoft.com/library/system.web.ui.partialcachingcontrol.aspx) элемента управления, вы всегда будете получать допустимый объект ControlCachePolicy. Тем не менее если доступ к [UserControl.CachePolicy](https://msdn.microsoft.com/library/system.web.ui.usercontrol.cachepolicy.aspx) свойство [UserControl](https://msdn.microsoft.com/library/system.web.ui.usercontrol.aspx) элемента управления, появляется допустимый объект ControlCachePolicy только в том случае, если уже имеется оболочка пользовательского элемента управления Элемент управления BasePartialCachingControl. Если он не переносится, ControlCachePolicy объект, возвращаемый этим свойством, исключения при попытке управлять ею, так как он не имеет связанного BasePartialCachingControl. Чтобы определить, поддерживает ли экземпляр UserControl, кэширование без создания исключений, проверить [SupportsCaching](https://msdn.microsoft.com/library/system.web.ui.controlcachepolicy.supportscaching.aspx) свойство.

С помощью класса ControlCachePolicy является одним из следующих способов, вы можете включить кэширование вывода. Ниже перечислены методы, которые можно использовать для включения кэширования выходных данных.

- Используйте [@ OutputCache](https://msdn.microsoft.com/library/hdxfb6cy.aspx) директивы для включения кэширования в декларативных сценариях выходных данных.
- Используйте [PartialCachingAttribute](https://msdn.microsoft.com/library/system.web.ui.partialcachingattribute.aspx) атрибут, чтобы включить кэширование для пользовательского элемента управления в файле кода.
- Класс ControlCachePolicy используется для указания параметров кэша в программных сценариях, в которых вы работаете с экземплярами BasePartialCachingControl, кэш включен с помощью одного из предыдущих методов и динамически загружается с помощью [System.Web.UI.TemplateControl.LoadControl](https://msdn.microsoft.com/library/system.web.ui.templatecontrol.loadcontrol.aspx) метод.

Экземпляр ControlCachePolicy успешно осуществляется только между стадиями Init и PreRender жизненного цикла элемента управления. Если вы изменяете объект ControlCachePolicy после фазе, ASP.NET создает исключение, так как любые изменения, внесенные после отрисовки элемента управления не окажет воздействия на самом деле параметры кэша (элемент управления кэшируется на этапе отрисовки). Наконец пользовательский экземпляр элемента управления (и, следовательно, его объекта ControlCachePolicy) доступен только для программной обработки при фактической визуализации.

## <a name="changes-to-caching-configuration---the-ltcachinggt-element"></a>Изменяет конфигурацию кэширования - &lt;кэширование&gt; элемент

Существуют некоторые изменения в конфигурацию кэширования в ASP.NET 2.0. &lt;Кэширование&gt; элемент появился в ASP.NET 2.0 и позволяет изменять кэширования конфигурацию в файле конфигурации. Доступны следующие атрибуты.

| **Элемент** | **Описание** |
| --- | --- |
| **кэш** | Необязательный элемент. Определяет параметры кэша глобальных приложений. |
| **outputCache** | Необязательный элемент. Задает параметры кэша вывода на уровне приложения. |
| **outputCacheSettings** | Необязательный элемент. Задает параметры кэша вывода, которые могут применяться к страницам в приложении. |
| **sqlCacheDependency** | Необязательный элемент. Настраивает зависимости кэша SQL для приложения ASP.NET. |

### <a name="the-ltcachegt-element"></a>&lt;Кэша&gt; элемент

Доступны следующие атрибуты в &lt;кэша&gt; элемент:

| **Атрибут** | **Описание** |
| --- | --- |
| **disableMemoryCollection** | Необязательный **логическое** атрибута. Возвращает или задает значение, отражающее отключение коллекции памяти кэша, возникающее при нехватке памяти машины. |
| **disableExpiration** | Необязательный **логическое** атрибута. Возвращает или задает значение, указывающее, отключен ли истечение срока действия кэша. При отключении кэшированных элементов не истекает, и фоновой очистки элементов с истекшим сроком действия кэша не выполняется. |
| **privateBytesLimit** | Необязательный **Int64** атрибута. Возвращает или задает значение, указывающее максимальное число байт исключительного приложения, прежде чем начинается удаление из кэша, истек срок действия элементов и попытке освобождения памяти. Это ограничение включает память, занятая кэша как на обычной памяти из запущенного приложения. Значение 0 указывает, что ASP.NET будет использовать собственную эвристику для определения, когда следует запускать освобождение памяти. |
| **percentagePhysicalMemoryUsedLimit** | Необязательный **Int32** атрибута. Возвращает или задает значение, указывающее максимальный процент физической памяти компьютера, которые могут использоваться приложением, прежде чем начинается удаление из кэша, истек срок действия элементов и попытке освобождения памяти, что оба памяти, используемой в кэш, а также включает в себя использование этой памяти использование обычной памяти выполняющегося приложения. Значение 0 указывает, что ASP.NET будет использовать собственную эвристику для определения, когда следует запускать освобождение памяти. |
| **privateBytesPollTime** | Необязательный **TimeSpan** атрибута. Возвращает или задает значение, указывающее временной интервал между опросами для использования памяти в байтах исключительного приложения. |

### <a name="the-ltoutputcachegt-element"></a>&lt;OutputCache&gt; элемент

Следующие атрибуты, доступные для &lt;outputCache&gt; элемент.


|       <strong>Атрибут</strong>        |                                                                                                                                                                                                                                                       <strong>Описание</strong>                                                                                                                                                                                                                                                       |
|-----------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|   <strong>enableOutputCache</strong>    |                                                                                                                                                          Необязательный <strong>логическое</strong> атрибута. Включает или отключает кэшем вывода страниц. Если отключены, кэширование страниц не выполняется независимо от того, программные или декларативные параметры. Значение по умолчанию — <strong>true</strong>.                                                                                                                                                           |
|  <strong>enableFragmentCache</strong>   |                                                Необязательный <strong>логическое</strong> атрибута. Включает или отключает кэширование фрагмента приложения. Если отключены, кэширование страниц не выполняется вне зависимости от [@ OutputCache](https://msdn.microsoft.com/library/hdxfb6cy.aspx) директива или использовать профиль кэша. Включает в себя заголовка управления кэшем, указывающее, что вышестоящие прокси-серверы, а также клиентов браузера не следует пытаться вывода страниц кэша. Значение по умолчанию — <strong>false</strong>.                                                 |
| <strong>sendCacheControlHeader</strong> |                                                                                                                                                      Необязательный <strong>логическое</strong> атрибута. Возвращает или задает значение, указывающее, является ли <strong>кэша-элемент управления: private</strong> модулем выходного кэша по умолчанию отсылается заголовок. Значение по умолчанию — <strong>false</strong>.                                                                                                                                                      |
|      <strong>omitVaryStar</strong>      | Необязательный <strong>логическое</strong> атрибута. Включает или отключает отправку Http "<strong>Vary: \</ strong ><em>" заголовка в ответе. По умолчанию равным false, "</em>* Vary: \* <strong>" Заголовок отправляется для кэшированных страниц. При отправке Заголовок Vary, он позволяет для различных версий должен быть помещен в кэш на основе заданное в Заголовок Vary. Например <em>Vary: пользователь-агентов</em> будут храниться разные версии страницы, на основе агента пользователя, отправившего запрос. Значение по умолчанию — ** false</strong>. |

### <a name="the-ltoutputcachesettingsgt-element"></a>&lt;OutputCacheSettings&gt; элемент

&lt;OutputCacheSettings&gt; элемент позволяет создавать кэш профилей, как описано выше. Только дочерний элемент для &lt;outputCacheSettings&gt; элемент является &lt;outputCacheProfiles&gt; элемент для настройки кэша профилей.

### <a name="the-ltsqlcachedependencygt-element"></a>&lt;SqlCacheDependency&gt; элемент

Следующие атрибуты, доступные для &lt;sqlCacheDependency&gt; элемент.

| **Атрибут** | **Описание** |
| --- | --- |
| **enabled** | Требуется **логическое** атрибута. Указывает, являются ли изменения выполняется опрос на наличие. |
| **pollTime** | Необязательный **Int32** атрибута. Задает частоту, с которой SqlCacheDependency опрашивает таблицу базы данных для изменений. Это значение соответствует число миллисекунд между последовательными pollings. Он не может быть присвоено меньше, чем 500 миллисекунд. Значение по умолчанию — 1 минута. |

### <a name="more-information"></a>Дополнительные сведения

Есть некоторые дополнительные сведения, вы должны помнить о конфигурации кэша.

- Если задано ограничение числа байтов исключительного пользования рабочих процессов, кэш будет использовать одну из следующих ограничений: 

    - x86 2 ГБ: 800 МБ или 60% физической памяти ОЗУ, какое значение меньше
    - x86 3 ГБ: 1800 МБ или 60% физической памяти ОЗУ, какое значение меньше
    - x64: 1 ТБ или 60% физической памяти ОЗУ, какое значение меньше
- Если оба рабочий процесс закрытый ограничить байт и &lt;кэшировать privateBytesLimit /&gt; задаются, которую будет использовать кэш минимальное из двух.
- Так же, как в версии 1.x, мы удалите записей кэша и вызвать GC. Сбор по двум причинам: 

    - Мы при очень близко к лимиту байтов исключительного пользования
    - Объем доступной памяти, практически или меньше, чем на 10%
- Фактически, можно отключить trim и кэшировать для условий недостаток доступной памяти, задав &lt;кэшировать percentagePhysicalMemoryUseLimit /&gt; до 100.
- В отличие от 1.x, 2.0 будет приостановлено trim и сбор вызовов, если последняя сборка Мусора. Сбор не был уменьшению счетчика байтов исключительного пользования или размер управляемых куч в более чем на 1% от предельного объема памяти (кэш).

## <a name="lab1-custom-cache-dependencies"></a>Lab1: Пользовательских зависимостей кэша

1. Создайте новый веб-сайт.
2. Добавьте новый файл XML с именем cache.xml и сохраните его в корневой каталог веб-приложения.
3. Добавьте следующий код к странице\_метод в коде программной части default.aspx нагрузки: 

    [!code-csharp[Main](caching/samples/sample15.cs)]
4. Добавьте следующий в верхнюю часть default.aspx в представлении источника: 

    [!code-aspx[Main](caching/samples/sample16.aspx)]
5. Обзор Default.aspx. Что сказать время?
6. Обновите приложение в браузере. Что сказать время?
7. Откройте cache.xml и добавьте следующий код: 

    [!code-xml[Main](caching/samples/sample17.xml)]
8. Сохраните cache.xml.
9. Обновите страницу в браузере. Что сказать время?
10. Объясните, почему время изменений вместо отображения ранее кэшированных значений:

## <a name="lab-2-using-polling-based-cache-dependencies"></a>Лабораторное занятие 2. Использование зависимостей кэша на основе опроса

Это лабораторное занятие использует проект, созданный в предыдущем модуле, позволяющей правку данных в базе данных "Борей" с помощью элемента управления GridView и DetailsView.

1. Откройте проект в Visual Studio 2005.
2. Запустите aspnet\_regsql служебной программы в базе данных "Борей", чтобы включить базы данных и таблицы Products. Используйте следующую команду из командной строки Visual Studio: 

    [!code-console[Main](caching/samples/sample18.cmd)]
3. Добавьте следующую строку в файл web.config: 

    [!code-xml[Main](caching/samples/sample19.xml)]
4. Добавьте новый веб-форма вызывается showdata.aspx.
5. Добавьте следующие @ outputcache-директива страницы showdata.aspx: 

    [!code-aspx[Main](caching/samples/sample20.aspx)]
6. Добавьте следующий код к странице\_нагрузку showdata.aspx: 

    [!code-html[Main](caching/samples/sample21.html)]
7. Добавление нового элемента управления SqlDataSource showdata.aspx и настройте его для использования подключения к базе данных "Борей". Нажмите кнопку Далее.
8. Установите флажки ProductName и ProductID и нажмите кнопку Далее.
9. Нажмите кнопку «Готово».
10. Добавление нового элемента управления GridView на страницу showdata.aspx.
11. Выберите SqlDataSource1 из раскрывающегося списка.
12. Сохраните и обзор showdata.aspx. Запишите время, отображаемое.
