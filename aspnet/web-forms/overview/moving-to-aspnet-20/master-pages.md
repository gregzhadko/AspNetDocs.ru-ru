---
uid: web-forms/overview/moving-to-aspnet-20/master-pages
title: Мастер Страницы Документы Майкрософт
author: rick-anderson
description: Одним из ключевых компонентов успешного веб-узла является последовательный внешний вид. В ASP.NET 1.x разработчики использовали элементы управления пользователем для воспроизведения общей страницы elem...
ms.author: riande
ms.date: 02/20/2005
ms.assetid: 9c0cce4d-efd9-4c14-b0e8-a1a140abb3f4
msc.legacyurl: /web-forms/overview/moving-to-aspnet-20/master-pages
msc.type: authoredcontent
ms.openlocfilehash: b493feb21d2e3d6429f0a23df5aab66e0c4c5b07
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2020
ms.locfileid: "81543188"
---
# <a name="master-pages"></a>Эталонные страницы

[корпорацией Майкрософт](https://github.com/microsoft)

> Одним из ключевых компонентов успешного веб-узла является последовательный внешний вид. В ASP.NET 1.x разработчики использовали элементы управления пользователем для воспроизведения общих элементов страницы в веб-приложении. Хотя это, безусловно, работоспособное решение, использование элементов управления пользователями имеет некоторые недостатки. Например, изменение позиции управления пользователем требует изменения нескольких страниц на сайте. Элементы управления пользователями также не отображаются в представлении Design после вставки на странице.

Одним из ключевых компонентов успешного веб-узла является последовательный внешний вид. В ASP.NET 1.x разработчики использовали элементы управления пользователем для воспроизведения общих элементов страницы в веб-приложении. Хотя это, безусловно, работоспособное решение, использование элементов управления пользователями имеет некоторые недостатки. Например, изменение позиции управления пользователем требует изменения нескольких страниц на сайте. Элементы управления пользователями также не отображаются в представлении Design после вставки на странице.

ASP.NET 2.0 представляет страницы Master как способ поддержания последовательного взгляда и ощущения, и, как вы скоро увидите, страницы Master представляют собой значительное улучшение по сравнению с методом управления пользователем.

## <a name="why-master-pages"></a>Почему Мастер Страницы?

Вы можете быть удивлены, почему мастер страницы были необходимы в ASP.NET 2.0. В конце концов, разработчики веб-узлов уже используют элементы управления пользователем в ASP.NET 1.x для обмена областями содержимого между страницами. На самом деле существует несколько причин, по которым пользовательские элементы управления являются менее оптимальным решением для создания общего макета.

Элементы управления пользователями фактически не определяют расположение страницы. Вместо этого они определяют макет и функциональность для части страницы. Различие между этими двумя важно, поскольку это делает управляемость решения управления пользователем гораздо сложнее. Например, если требуется изменить положение элемента управления пользователем на странице, необходимо отсеить фактическую страницу, на которой отображается элемент управления пользователем. Это хорошо, если у вас есть только несколько страниц, но в больших сайтах, он быстро становится кошмаром управления сайтом!

Еще один недостаток использования пользовательских элементов управления для определения общего макета коренится в архитектуре самой ASP.NET. Если какой-либо публичный элемент управления пользователем изменен, он требует, чтобы вы перекомпилировать все страницы, которые используют пользовательский контроль. В свою очередь, ASP.NET будет повторно JIT ваши страницы, когда они впервые доступны. Это, опять же, создает немасштабируемую архитектуру и проблему управления сайтом для больших сайтов.

Обе эти проблемы (и многие другие) красиво рассматриваются мастер-страниц в ASP.NET 2.0.

## <a name="how-master-pages-work"></a>Как работают мастер-страницы

Главная страница аналогична шаблону для других страниц. Элементы страницы, которые должны быть общими среди других страниц (наоборот, меню, границы и т.д.), добавляются на главную страницу. При добавлении на сайт новых страниц можно связать их с главной страницей. Страница, связанная с главной страницей, называется **страницей содержимого.** По умолчанию страница содержимого приобретает внешний вид с главной страницы. Однако при создании главной страницы можно определить части страницы, которые страница содержимого может заменить собственным контентом. Эти части определяются с помощью нового элемента управления, введенного в ASP.NET 2.0; контроль **ContentPlaceHolder.**

Главная страница может содержать любое количество элементов управления ContentPlaceHolder (или вообще нет). На странице содержимого содержимое элементов управления ContentPlaceHolder отображается внутри элементов управления **контентом,** еще один новый элемент управления в ASP.NET 2.0. По умолчанию элементы управления контентом содержимого являются пустыми, так что вы можете предоставить свой собственный контент. Если вы хотите использовать содержимое с главной страницы внутри элементов управления контентом, вы можете сделать это, как вы увидите позже в этом модуле. Элемент управления контентом отображается в элементе управления ContentPlaceHolder через атрибут ContentPlaceHolderID управления контентом. Приведенный ниже код отображает элемент управления контентом с управлением ContentPlaceHolder, называемый mainBody на главной странице.

[!code-aspx[Main](master-pages/samples/sample1.aspx)]

> [!NOTE]
> Вы часто будете слышать, как люди описывают мастер-страницы как базовый класс для других страниц. Это на самом деле не так. Взаимосвязь между мастер-страницами и страницами содержимого не является наследованием.

**На рисунке 1 показана** главная страница и страница связанного с ним содержимого, когда они появляются в Visual Studio 2005. Вы можете увидеть элемент управления ContentPlaceHolder на главной странице и соответствующий элемент управления контентом на странице содержимого. Обратите внимание, что содержимое на master pages, находящимся за пределами ContentPlaceHolder, видно, но сеет на странице содержимого. Только содержимое внутри ContentPlaceHolder может быть вытеснено страницей содержимого. Все другое содержимое, которое исходит от главной страницы, неизменяемо.

![Главная страница и страница связанного с ним содержимого](master-pages/_static/image1.jpg)

**Рисунок 1**: Главная страница и связанная с ней страница контента

## <a name="creating-a-master-page"></a>Создание главной страницы

Для создания новой главной страницы:

1. Открыть Visual Studio 2005 и создать новый веб-сайт.
2. Нажмите файл, Новый, Файл.
3. Выберите Master File из диалога Добавить новый элемент, как показано на **рисунке 2**.
4. Нажмите кнопку «Добавить».

![Создание новой страницы мастера](master-pages/_static/image2.jpg)

**Рисунок 2**: Создание новой страницы мастера

Обратите внимание, что расширение файла для главной страницы *является .master*. Это один из способов, которым главная страница отличается от обычной страницы. Другое основное отличие заключается @Page в том, что @Master вместо директивы на главной странице содержится директива. Переключитесь на исходный вид для только что созданной страницы и просмотрите код.

Новая главная страница будет иметь один элемент управления ContentPlaceHolder по умолчанию. В большинстве случаев имеет смысл сначала создавать элементы общей страницы, а затем вставлять элементы управления ContentPlaceHolder там, где пожелает пользовательский контент. В этих случаях разработчики захотят удалить элемент управления ContentPlaceHolder по умолчанию и вставить новые по мере разработки страницы. Элементы управления ContentPlaceHolder не изменяются, несмотря на то, что они отображают ручки размеров. Размеры управления ContentPlaceHolder автоматически основаны на содержании, содержащем его, за одним исключением; если вы разместите элемент ContentPlaceHolder внутри элемента блока, такого как ячейка таблицы, он будет размерв в зависимости от размера элемента.

## <a name="lab-1-working-with-master-pages"></a>Лаборатория 1 Работа с мастер-страницами

В этой лаборатории вы создадите новую страницу и определите три элемента управления ContentPlaceHolder. Затем вы создадите новую страницу Содержимого и замените его по крайней мере из одного из элементов управления ContentPlaceHolder.

1. Создайте главную страницу и вставьте элементы управления ContentPlaceHolder. 

    1. Создайте новую главную страницу, описанную выше.
    2. Удалите элемент управления ContentPlaceHolder по умолчанию.
    3. Выберите элемент управления ContentPlaceHolder, нажав на затененные верхние границы управления, а затем удалите его, нажав клавишу DEL на клавиатуре.
    4. Вставьте новую таблицу, используя шаблон *заголовка и боковой,* как показано на рисунке 3. Измените ширину и высоту до 90% каждый, чтобы вся таблица была видна в конструкторе.

![](master-pages/_static/image3.jpg)

**Рисунок 3**

1. Поместите курсор в каждую ячейку таблицы и установите *свойство valign* к *началу.*
2. Из ящика инструментов вставьте элемент управления ContentPlaceHolder в верхней ячейке таблицы (ячейка заголовка).
3. При вставке этого элемента управления ContentPlaceHolder вы заметите, что высота строки займет почти всю страницу, как показано на рисунке 4. Не беспокойтесь об этом на данный момент.

![Пустое пространство находится в той же ячейке, что и ContentPlaceHolder](master-pages/_static/image1.gif)

**Рисунок 4**: Пустое пространство находится в той же ячейке, что и ContentPlaceHolder

1. Поместите контроль ContentPlaceHolder в двух других ячейках. После того, как другие элементы управления ContentPlaceHolder были вставлены, размер ячейки таблицы должен быть таким, как вы ожидаете. Страница теперь должна выглядеть как страница, показанная на **рисунке 5**.

![Мастер со всеми элементами управления ContentPlaceHolder. Обратите внимание, что высота ячейки для ячейки заголовка теперь то, что она должна быть](master-pages/_static/image2.gif)

**Рисунок 5**: Мастер со всеми элементами управления ContentPlaceHolder. Обратите внимание, что высота ячейки для ячейки заголовка теперь то, что она должна быть

1. Введите текст по своему выбору в каждый из трех элементов управления ContentPlaceHolder.
2. Сохранить главную страницу в качестве exercise1.master.
3. Создайте новую веб-форму и свяжете ее со страницей мастера exercise1.master.
4. Выберите файл, Новый, Файл в визуальной студии 2005.
5. Выберите **веб-форму** в диалоге Добавить новый элемент.
6. Убедитесь, что чекбокс мастер-страницы Select проверяется, как показано на рисунке 6.

![Добавление новой Страницы содержимого](master-pages/_static/image3.gif)

**Рисунок 6**: Добавление новой страницы содержимого

1. Нажмите кнопку «Добавить».
2. Выберите exercise1.master в диалоге главной страницы, как показано на рисунке 7.
3. Нажмите OK, чтобы добавить новую страницу содержимого.

Новая страница контента отображается в Visual Studio с одним элементом управления контентом для каждого управления ContentPlaceHolder на главной странице. По умолчанию элементы управления содержимого пусты, так что вы можете добавить свой собственный контент. Если вы хотите, чтобы они использовали содержимое из управления ContentPlaceHolder на главной странице, просто нажмите на символ смарт-тега (маленькая черная стрелка в правом верхнем углу управления) и выберите *по умолчанию для Masters Content* из смарт-тега, как показано на **рисунке 8**. При этом элемент меню изменяется для *создания пользовательского содержимого.* Нажав на него в этот момент удаляет содержимое с главной страницы, что позволяет определить пользовательский контент для этого конкретного управления контентом.

![Установка элемента управления контентом на значение для содержимого "Мастер-страниц"](master-pages/_static/image4.gif)

**Рисунок 7**: Установка элемента управления контентом по умолчанию содержимому госстраниц

## <a name="connecting-master-page-and-content-pages"></a>Подключение страницы Master и Страницы содержимого

Связь между главной страницей и страницей содержимого может быть настроена одним из четырех способов:

- Атрибут @Page <strong>директивы MasterPageFile</strong>
- Настройка свойства **Page.MasterPageFile** в коде.
- Элемент ** &lt;&gt; страниц** в файле конфигурации приложений (web.config в корневой папке приложения)
- Элемент ** &lt;&gt; страниц** в файле конфигурации subfolders (web.config в subfolder)

## <a name="masterpagefile-attribute"></a>Атрибут MasterPageFile

Атрибут MasterPageFile упрощает применение главной страницы к определенной странице ASP.NET. Это также метод, используемый для применения главной страницы при проверке **чекбокса Select Master Page,** как это было в упражнении 1.

## <a name="setting-pagemasterpagefile-in-code"></a>Настройка Page.MasterPageFile в коде

Установив свойство MasterPageFile в коде, можно применить определенную страницу к содержимому во время выполнения. Это полезно в тех случаях, когда вам может потребоваться применить определенную главную страницу, основанную на роли пользователя или некоторых других критериях. Свойство MasterPageFile должно быть установлено в методе PreInit. Если он установлен после метода PreInit, будет брошен InvalidOperationException. Страница, на которой устанавливается это свойство, также должна иметь элемент управления содержимого в качестве элемента управления верхнего уровня для страницы. В противном случае httpexception будет брошен при установке свойства MasterPageFile.

## <a name="using-the-ltpagesgt-element"></a>Использование &lt;страниц&gt; Элемент

Вы можете настроить главную страницу для своих страниц, &lt;установив&gt; атрибут masterPageFile в элементе страниц файла web..config. При использовании этого метода имейте в виду, что файлы web.config ниже в структуре приложения могут переопределить эту настройку. Любой атрибут MasterPageFile, установленный в директиве, @Page также переопределить эту настройку. Использование &lt;элемента страниц&gt; упрощает создание *главной* страницы, которая может быть перекрыта в случае необходимости в определенных папках или файлах.

## <a name="properties-in-master-pages"></a>Свойства в мастер-страницах

Главная страница может подвергать свойства, просто делая эти свойства общедоступными на главной странице. Например, следующий код определяет свойство под названием SomeProperty:

[!code-csharp[Main](master-pages/samples/sample2.cs)]

Чтобы получить доступ к свойству SomeProperty со страницы Content, необходимо использовать свойство Master следующим образом:

[!code-csharp[Main](master-pages/samples/sample3.cs)]

## <a name="nesting-master-pages"></a>Страницы мастера гнездования

Мастер-страницы являются идеальным решением для обеспечения общего взгляда и ощущения через большое веб-приложение. Тем не менее, это не редкость, чтобы некоторые части большого сайта имеют общий интерфейс в то время как другие части имеют другой интерфейс. Для решения этой потребности, несколько мастер-страниц являются идеальным решением. Однако это по-прежнему не учитывает тот факт, что большое приложение может иметь определенные компоненты (например, меню), которые являются общими между всеми страницами и другими компонентами, которые являются общими только между определенными разделами сайта. Для такого рода ситуации, вложенные страницы мастер заполнить потребность красиво. Как вы видели, обычная главная страница состоит из главной страницы и страницы содержимого. В вложенной ситуации главной страницы есть две главные страницы; родительский мастер и детский мастер. Страница детского мастера также является страницей содержимого, а ее основной — родительской главной страницей.

Вот код для типичной главной страницы:

[!code-aspx[Main](master-pages/samples/sample4.aspx)]

В вложенном сценарии это будет родительский мастер. Другая главная страница будет использовать эту страницу в качестве главной страницы, и этот код будет выглядеть следующим образом:

[!code-aspx[Main](master-pages/samples/sample5.aspx)]

Обратите внимание, что в этом сценарии мастер содержимого также является страницей содержимого для родительского мастера. Все содержимое детского мастера отображается внутри элемента управления содержимого, который получает его содержимое из-под контроля ContentPlaceHolder.

> [!NOTE]
> Поддержка конструктора недоступна для вложенных страниц. Когда вы разрабатываете с помощью вложенных мастеров, вам нужно будет использовать исходный вид.

Это видео показывает пошаговое пошаговое походе использования вложенных страниц мастер.

![](master-pages/_static/image1.png)

[Открытое полноэкранное видео](master-pages/_static/nested1.wmv)

![Выбор страницы «Мастер»](master-pages/_static/image4.jpg)

**Рисунок 8**: Выбор главной страницы
