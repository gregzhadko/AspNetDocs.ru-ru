---
uid: web-forms/overview/moving-to-aspnet-20/master-pages
title: Главные страницы | Документация Майкрософт
author: microsoft
description: Одним из ключевых компонентов успешного веб-узла является единообразный внешний вид и поведение. В ASP.NET 1. x разработчики использовали пользовательские элементы управления для репликации общей страницы Elem...
ms.author: riande
ms.date: 02/20/2005
ms.assetid: 9c0cce4d-efd9-4c14-b0e8-a1a140abb3f4
msc.legacyurl: /web-forms/overview/moving-to-aspnet-20/master-pages
msc.type: authoredcontent
ms.openlocfilehash: 36f2caf7c2c9bcafd22c8f6681c1d6b19fe5078a
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78457584"
---
# <a name="master-pages"></a>Эталонные страницы

по [Майкрософт](https://github.com/microsoft)

> Одним из ключевых компонентов успешного веб-узла является единообразный внешний вид и поведение. В ASP.NET 1. x разработчики использовали пользовательские элементы управления для репликации общих элементов страницы в веб-приложении. Хотя это и является работоспособным решением, использование пользовательских элементов управления имеет определенные недостатки. Например, изменение расположения пользовательского элемента управления требует изменения нескольких страниц на сайте. Пользовательские элементы управления также не подготавливаются к просмотру в представление конструирования после вставки на страницу.

Одним из ключевых компонентов успешного веб-узла является единообразный внешний вид и поведение. В ASP.NET 1. x разработчики использовали пользовательские элементы управления для репликации общих элементов страницы в веб-приложении. Хотя это и является работоспособным решением, использование пользовательских элементов управления имеет определенные недостатки. Например, изменение расположения пользовательского элемента управления требует изменения нескольких страниц на сайте. Пользовательские элементы управления также не подготавливаются к просмотру в представление конструирования после вставки на страницу.

ASP.NET 2,0 представляет собой главную страницу как способ поддержания согласованного внешнего вида и поведения, как вы вскоре увидите, главные страницы представляют значительное улучшение по сравнению с методом пользовательского элемента управления.

## <a name="why-master-pages"></a>Зачем нужны главные страницы

Возможно, вас интересует, почему главные страницы были необходимы в ASP.NET 2,0. В конце концов, разработчики веб-узлов уже используют пользовательские элементы управления в ASP.NET 1. x для совместного использования областей содержимого между страницами. Существует несколько причин, по которым пользовательские элементы управления являются менее оптимальным решением для создания общего макета.

Пользовательские элементы управления не определяют макет страницы. Вместо этого они определяют макет и функциональные возможности для части страницы. Различие между этими двумя важными данными важно, поскольку это значительно усложняет управляемость решения для пользовательских элементов управления. Например, если необходимо изменить расположение пользовательского элемента управления на странице, необходимо изменить фактическую страницу, на которой отображается пользовательский элемент управления. Поддерживающие аттестацию, если у вас всего несколько страниц, но на больших сайтах он быстро станет кошмаром для управления сайтом!

Другим недостатком использования пользовательских элементов управления для определения общего макета является корень в архитектуре самого ASP.NET. При изменении любого открытого члена пользовательского элемента управления требуется повторная компиляция всех страниц, использующих пользовательский элемент управления. В свою очередь, ASP.NET повторно выполняет JIT-компиляцию страниц при первом обращении к ним. Это, опять же, создает немасштабируемую архитектуру и проблему управления сайтом для больших сайтов.

Обе эти проблемы (и многие другие) хорошо решаются главными страницами в ASP.NET 2,0.

## <a name="how-master-pages-work"></a>Как работают главные страницы

Главная страница аналогична шаблону для других страниц. Элементы страницы, которые должны совместно использоваться другими страницами (т. е. меню, границами и т. д.), добавляются на главную страницу. При добавлении новых страниц на сайт их можно связать с главной страницей. Страница, связанная с главной страницей, называется **страницей содержимого**. По умолчанию страница содержимого на главной странице принимает внешний вид. Однако при создании главной страницы можно определить части страницы, которые можно заменить страницей содержимого на собственное содержимое. Эти части определяются с помощью нового элемента управления, появившегося в ASP.NET 2,0; элемент управления **ContentPlaceHolder** .

Главная страница может содержать любое количество элементов управления ContentPlaceHolder (или вообще ничего). На странице содержимого содержимое из элементов управления ContentPlaceHolder отображается внутри элементов управления **содержимым** , еще одного нового элемента управления в ASP.NET 2,0. По умолчанию элементы управления содержимым страниц содержимого пусты, поэтому вы можете предоставить собственное содержимое. Если вы хотите использовать содержимое из главной страницы в элементах управления содержимым, можно сделать это, как будет показано далее в этом модуле. Элемент управления содержимым сопоставляется с элементом управления ContentPlaceHolder через атрибут ContentPlaceHolderID элемента управления содержимым. Приведенный ниже код сопоставляет элемент управления содержимым с элементом управления ContentPlaceHolder, именуемым Маинбоди, на главной странице.

[!code-aspx[Main](master-pages/samples/sample1.aspx)]

> [!NOTE]
> Часто вы слышите людей, которые описывают главные страницы как базовый класс для других страниц. Поддерживающие аттестацию на самом деле не верно. Связь между главными страницами и страницами содержимого не является одним из наследования.

На **рис. 1** показана эталонная страница и связанная с ним страница содержимого, отображаемая в Visual Studio 2005. Элемент управления ContentPlaceHolder можно увидеть на главной странице и соответствующем элементе управления содержимым на странице содержимое. Обратите внимание, что содержимое главных страниц, расположенное за пределами ContentPlaceHolder, видимо, но неактивно на странице содержимое. Только содержимое внутри ContentPlaceHolder может быть переопределено страницей содержимого. Все остальные материалы, поступающие из главной страницы, являются неизменяемыми.

![Эталонная страница и связанная с ней страница содержимого](master-pages/_static/image1.jpg)

**Рис. 1**. Эталонная страница и связанная с ней страница содержимого

## <a name="creating-a-master-page"></a>Создание главной страницы

Чтобы создать новую главную страницу, выполните следующие действия.

1. Откройте Visual Studio 2005 и создайте новый веб-сайт.
2. Щелкните файл, создать, файл.
3. Выберите главный файл в диалоговом окне Добавление нового элемента, как показано на **рис. 2**.
4. Нажмите кнопку «Добавить».

![Создание новой главной страницы](master-pages/_static/image2.jpg)

**Рис. 2**. Создание новой главной страницы

Обратите внимание, что расширение файла для главной страницы — *master*. Это один из способов, которым Главная страница отличается от обычной страницы. Другое основное отличие заключается в том, что вместо директивы @Page Главная страница содержит директиву @Master. Перейдите в представление исходного кода для только что созданной главной страницы и просмотрите код.

На новой главной странице по умолчанию будет по одному элементу управления ContentPlaceHolder. В большинстве случаев имеет смысл сначала создать общие элементы страницы, а затем вставить элементы управления ContentPlaceHolder, где требуется пользовательское содержимое. В таких случаях разработчикам нужно будет удалить элемент управления ContentPlaceHolder по умолчанию и вставить новые, как только страница разрабатывается. Размеры элементов управления ContentPlaceHolder не могут изменяться, несмотря на то, что они отображают маркеры изменения размера. Размеры элемента управления ContentPlaceHolder автоматически зависят от содержимого, которое он содержит, с одним исключением; Если поместить элемент управления ContentPlaceHolder внутри элемента блока, такого как ячейка таблицы, он будет иметь размер в соответствии с размером элемента.

## <a name="lab-1-working-with-master-pages"></a>Лаборатория 1 работа с главными страницами

В этой лабораторной работе вы создадите новую главную страницу и определите три элемента управления ContentPlaceHolder. Затем нужно будет создать новую страницу содержимого и заменить содержимое по крайней мере одним из элементов управления ContentPlaceHolder.

1. Создание главной страницы и вставка элементов управления ContentPlaceHolder. 

    1. Создайте новую главную страницу, как описано выше.
    2. Удалите элемент управления ContentPlaceHolder по умолчанию.
    3. Выберите элемент управления ContentPlaceHolder, щелкнув затененную верхнюю границу элемента управления, а затем удалите его, нажав клавишу DEL на клавиатуре.
    4. Вставьте новую таблицу, используя шаблон *Header и Side* , как показано на рис. 3. Измените ширину и высоту на 90%, чтобы вся таблица была видна в конструкторе.

![](master-pages/_static/image3.jpg)

**Рис. 3**

1. Поместите курсор в каждую ячейку таблицы и задайте для свойства *VAlign* значение *Top*.
2. В области элементов вставьте элемент управления ContentPlaceHolder в верхнюю ячейку таблицы (ячейка заголовка).
3. При вставке этого элемента управления ContentPlaceHolder вы увидите, что высота строки займет почти всю страницу, как показано на рис. 4. Не стоит беспокоиться об этом на этом этапе.

![Пустое пространство находится в той же ячейке, что и ContentPlaceHolder](master-pages/_static/image1.gif)

**Рис. 4**. пустое пространство находится в той же ячейке, что и ContentPlaceHolder

1. Поместите элемент управления ContentPlaceHolder в две другие ячейки. После вставки других элементов управления ContentPlaceHolder размер ячеек таблицы должен быть таким же, как и при ожидании. Теперь страница должна выглядеть, как на странице, показанной на **рис. 5**.

![Главный элемент управления ContentPlaceHolder. Обратите внимание, что высота ячейки для ячейки заголовка теперь должна быть](master-pages/_static/image2.gif)

**Рис. 5**. Главный элемент управления ContentPlaceHolder. Обратите внимание, что высота ячейки для ячейки заголовка теперь должна быть

1. Введите нужный текст в каждый из трех элементов управления ContentPlaceHolder.
2. Сохраните главную страницу как Exercise1. master.
3. Создайте новую веб-форму и свяжите ее с главной страницей Exercise1. master.
4. Выберите файл, создать, файл в Visual Studio 2005.
5. Выберите **веб-форму** в диалоговом окне Добавление нового элемента.
6. Убедитесь, что флажок Выбрать главную страницу установлен, как показано на рис. 6.

![Добавление новой страницы содержимого](master-pages/_static/image3.gif)

**Рис. 6**. Добавление новой страницы содержимого

1. Нажмите кнопку «Добавить».
2. Выберите Exercise1. master в диалоговом окне Выбор главной страницы, как показано на рис. 7.
3. Нажмите кнопку ОК, чтобы добавить страницу новое содержимое.

Страница новое содержимое отображается в Visual Studio с одним элементом управления содержимым для каждого элемента управления ContentPlaceHolder на главной странице. По умолчанию элементы управления содержимым пусты, поэтому можно добавить собственное содержимое. Если вы хотите, чтобы они использовали содержимое из элемента управления ContentPlaceHolder на главной странице, просто щелкните символ смарт-тега (маленькая черная стрелка в правом верхнем углу элемента управления) и выберите *значение по умолчанию для образца содержимого* из смарт-тега, как показано на **рис. 8**. После этого пункт меню изменится на *Создание пользовательского содержимого*. Щелкнув его в этой точке, вы удаляете содержимое с главной страницы, что позволяет определить пользовательское содержимое для конкретного элемента управления содержимым.

![Установка для элемента управления содержимым значения по умолчанию для содержимого главных страниц](master-pages/_static/image4.gif)

**Рис. 7**. Установка элемента управления содержимым по умолчанию на содержимое главных страниц

## <a name="connecting-master-page-and-content-pages"></a>Соединение главной страницы и страниц содержимого

Связь между главной страницей и страницей содержимого можно настроить одним из четырех способов.

- Атрибут <strong>MasterPageFile</strong> директивы @Page
- Установка свойства **Page. MasterPageFile** в коде.
- Элемент **&lt;pages&gt;** в файле конфигурации приложений (Web. config в корневой папке приложения)
- **&lt;страниц&gt;** в файле конфигурации вложенных папок (Web. config во вложенной папке)

## <a name="masterpagefile-attribute"></a>Атрибут MasterPageFile

Атрибут MasterPageFile упрощает применение главной страницы к определенной ASP.NET странице. Этот метод также используется для применения главной страницы при установке флажка **Выбрать главную страницу** , как описано в упражнении 1.

## <a name="setting-pagemasterpagefile-in-code"></a>Задание Page. MasterPageFile в коде

Установив свойство MasterPageFile в коде, можно применить определенную главную страницу к содержимому во время выполнения. Это полезно в тех случаях, когда может потребоваться применить определенную главную страницу на основе роли пользователя или других критериев. Свойство MasterPageFile должно быть задано в методе init. Если он задан после метода инициализации, будет создано исключение InvalidOperationException. Страница, на которой устанавливается это свойство, также должна иметь элемент управления содержимым в качестве элемента управления верхнего уровня для страницы. В противном случае при задании свойства MasterPageFile будет выдано исключение HttpException.

## <a name="using-the-ltpagesgt-element"></a>Использование элемента&gt; &lt;Pages

Можно настроить эталонную страницу для страниц, задав атрибут masterPageFile на &lt;страницах&gt; файла Web. config. При использовании этого метода следует помнить, что файлы Web. config, расположенные ниже в структуре приложения, могут переопределять этот параметр. Любой атрибут MasterPageFile, заданный в директиве @Page, также переопределяет этот параметр. Использование элемента&gt; &lt;Pages упрощает создание *главной* главной страницы, которую можно переопределить при необходимости в определенных папках или файлах.

## <a name="properties-in-master-pages"></a>Свойства на главных страницах

Главная страница может предоставлять свойства, просто делая эти свойства общедоступными на главной странице. Например, следующий код определяет свойство с именем Сомепроперти:

[!code-csharp[Main](master-pages/samples/sample2.cs)]

Чтобы получить доступ к свойству Сомепроперти со страницы содержимого, необходимо использовать свойство Master следующим образом:

[!code-csharp[Main](master-pages/samples/sample3.cs)]

## <a name="nesting-master-pages"></a>Вложенные главные страницы

Главные страницы — это идеальное решение для обеспечения общего внешнего вида и поведения в большом веб-приложении. Однако зачастую некоторые части большого сайта имеют общий интерфейс, тогда как другие части совместно используют другой интерфейс. Для решения этой проблемы несколько главных страниц являются идеальным решением. Тем не менее, это по-прежнему не решает тот факт, что крупные приложения могут иметь определенные компоненты (например, меню), которые являются общими для всех страниц и других компонентов, которые являются общими только в определенных разделах сайта. Для такого типа ситуации вложенные главные страницы должны прекрасно заполняться. Как вы видели, обычная Главная страница состоит из главной страницы и страницы содержимого. Во вложенной ситуации с главной страницей существует две главные страницы. Родительский главный и дочерний главный. Дочерняя главная страница также является страницей содержимого, а ее главной страницей является родительская Главная страница.

Ниже приведен код для обычной главной страницы:

[!code-aspx[Main](master-pages/samples/sample4.aspx)]

Во вложенном главном сценарии это будет родительская главная реплика. Другая эталонная страница будет использовать эту страницу в качестве главной страницы, и этот код будет выглядеть следующим образом:

[!code-aspx[Main](master-pages/samples/sample5.aspx)]

Обратите внимание, что в этом сценарии дочерняя главная страница также является страницей содержимого для родительской главной реплики. Все содержимое дочернего главного мастера отображается внутри элемента управления содержимым, получающего его содержимое из элемента управления ContentPlaceHolder родителя.

> [!NOTE]
> Поддержка конструктора недоступна для вложенных главных страниц. При разработке с использованием вложенных образцов необходимо использовать представление исходного кода.

В этом видео показано пошаговое руководство по использованию вложенных главных страниц.

![](master-pages/_static/image1.png)

[Открыть полноэкранное видео](master-pages/_static/nested1.wmv)

![Выбор главной страницы](master-pages/_static/image4.jpg)

**Рис. 8**. Выбор главной страницы
