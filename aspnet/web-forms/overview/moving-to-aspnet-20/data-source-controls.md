---
uid: web-forms/overview/moving-to-aspnet-20/data-source-controls
title: Элементы управления источником данных | Документация Майкрософт
author: microsoft
description: Элемент управления DataGrid в ASP.NET 1.x, помеченные значительным улучшением в доступ к данным в веб-приложений. Тем не менее не так же прост, как могло бы быть...
ms.author: riande
ms.date: 02/20/2005
ms.assetid: 78fd0e92-f9c6-4e96-a5e9-0375b307a828
msc.legacyurl: /web-forms/overview/moving-to-aspnet-20/data-source-controls
msc.type: authoredcontent
ms.openlocfilehash: a2e2cfbec3e5aebf42a2de30bab7d45b4b610298
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2019
ms.locfileid: "65109575"
---
# <a name="data-source-controls"></a>Элементы управления источником данных

по [Microsoft](https://github.com/microsoft)

> Элемент управления DataGrid в ASP.NET 1.x, помеченные значительным улучшением в доступ к данным в веб-приложений. Тем не менее он не был же прост, как могло бы быть. Он по-прежнему требуется значительный объем кода можно получить много полезных функций из него. Это модель в все попытки доступа к данных в версии 1.x.

Элемент управления DataGrid в ASP.NET 1.x, помеченные значительным улучшением в доступ к данным в веб-приложений. Тем не менее он не был же прост, как могло бы быть. Он по-прежнему требуется значительный объем кода можно получить много полезных функций из него. Это модель в все попытки доступа к данных в версии 1.x.

ASP.NET 2.0 решает эту проблему с частично с помощью элементов управления источниками данных. Элементы управления источниками данных в ASP.NET 2.0 предоставляют разработчикам декларативную модель для получения данных, отображение данных и изменения данных. Элементы управления источником данных предназначена для обеспечения согласованного представления данных к элементам управления с привязкой к данным независимо от источника этих данных. В сердце элементов управления источниками данных в ASP.NET 2.0 является абстрактным классом DataSourceControl. Класс DataSourceControl предоставляет базовую реализацию интерфейса IDataSource и интерфейса IListSource, которое позволяет назначить элемент управления источником данных в качестве источника данных элемента управления с привязкой к данным (через свойство DataSourceId описываемый ниже) и предоставлять эти данные, указанные в виде списка. Каждый список данных из элемента управления источником данных указывается в виде объекта DataSourceView. Доступ к экземплярам DataSourceView предоставляется интерфейс IDataSource. Например метод GetViewNames возвращает ICollection, который позволяет перечислять DataSourceViews связанного с элементом управления источником данных, а метод GetView обеспечивает доступ к конкретному экземпляру DataSourceView по имени.

Элементы управления источника данных имеют без интерфейса пользователя. Они реализуются как серверные элементы управления, таким образом, они могут поддерживать декларативный синтаксис. Кроме того, они имеют доступ к состоянию страницы при необходимости. Элементы управления источником данных не отображают разметку HTML для клиента.

> [!NOTE]
> Как вы увидите позже, существует также кэшируется преимущества, полученных с помощью элементов управления источниками данных.

## <a name="storing-connection-strings"></a>Хранение строк подключений

Прежде чем мы рассмотрим методы для настройки элементов управления источниками данных, мы должны охватывать новую возможность в ASP.NET 2.0, касающиеся строки подключения. В ASP.NET 2.0 введен новый раздел в файле конфигурации, который позволяет легко хранить строки подключения, которые могут считываться динамически во время выполнения. &lt;ConnectionStrings&gt; разделе упрощает для хранения строки подключения.

Приведенный ниже фрагмент кода добавляет новую строку соединения.

[!code-xml[Main](data-source-controls/samples/sample1.xml)]

> [!NOTE]
> Так же как &lt;appSettings&gt; разделе &lt;connectionStrings&gt; появится раздел за пределами &lt;system.web&gt; раздел в файле конфигурации.

Чтобы использовать эту строку подключения, можно использовать следующий синтаксис при задании атрибута ConnectionString серверного элемента управления.

[!code-aspx[Main](data-source-controls/samples/sample2.aspx)]

&lt;ConnectionStrings&gt; раздел может быть также зашифрован, чтобы конфиденциальные сведения не предоставляются. Эту возможность будут освещены в более поздней версии модуля.

## <a name="caching-data-sources"></a>Кэширование источников данных

Каждый DataSourceControl предоставляет четыре свойства для настройки кэширования; EnableCaching CacheDuration, CacheExpirationPolicy и CacheKeyDependency.

## <a name="enablecaching"></a>EnableCaching

EnableCaching — это логическое свойство, которое определяет ли кэширование включено для элемента управления источником данных.

## <a name="cacheduration-property"></a>Свойство CacheDuration

Свойства CacheDuration задает количество секунд, кэш остается допустимым. Этому свойству присвоить **0** вызывает кэш остается действительным, пока не будет явно недействительным.

## <a name="cacheexpirationpolicy-property"></a>Свойство CacheExpirationPolicy

Свойство CacheExpirationPolicy можно задать значение **абсолютный** или **скользящий**. Установка абсолютного означает, что количество секунд, указанного в свойстве CacheDuration максимальное количество времени, что данные будут кэшироваться. Присвойте ему значение скользящий, время окончания срока действия сбрасывается при каждой операции.

## <a name="cachekeydependency-property"></a>Свойство CacheKeyDependency

Если для свойства CacheKeyDependency задано строковое значение, ASP.NET будет установлен новый зависимость кэша на основе этой строки. Это позволяет явно делают кэш недействительным, просто изменяя или удаляя CacheKeyDependency.

**Важно**. Если олицетворение включено и доступ к источнику данных и/или содержимое данных основаны на учетных данных клиента, мы советуем, что кэширование отключено, задав EnableCaching значение false. Если включено кэширование в этом сценарии, пользователя, отличного от пользователя, запросившего данные изначально выдает запрос авторизации к источнику данных не применяется. Данные будут обслуживаться просто из кэша.

## <a name="the-sqldatasource-control"></a>Элемента управления SqlDataSource

Элемента управления SqlDataSource позволяет разработчику для доступа к данным, хранящихся в реляционной базе данных, поддерживающий ADO.NET. Его можно использовать поставщик System.Data.SqlClient для доступа к базу данных SQL Server, поставщик System.Data.OleDb, поставщик System.Data.Odbc или System.Data.OracleClient поставщик для доступа к Oracle. Таким образом элемента управления SqlDataSource определенно не используется только для доступа к данным в базе данных SQL Server.

Для использования элемента управления SqlDataSource, вы просто указать значение для свойства ConnectionString и указать команду SQL или хранимой процедуры. Элемента управления SqlDataSource берет на себя работу с базовой архитектуры ADO.NET. Он открывается соединение, запрашивает источник данных или выполняет хранимую процедуру, возвращает данные и затем закрывает подключение.

> [!NOTE]
> Так как класс DataSourceControl автоматически закрывает соединение автоматически, его следует уменьшить число вызовов клиента, созданные утечка подключений к базе данных.

Приведенный ниже фрагмент кода привязывает элемент управления DropDownList для элемента управления SqlDataSource, с помощью строки подключения, которая хранится в файле конфигурации, как показано выше.

[!code-aspx[Main](data-source-controls/samples/sample3.aspx)]

Как показано выше, свойство DataSourceMode элемента управления SqlDataSource режим для источника данных. В приведенном выше примере DataSourceMode присваивается DataReader. В этом случае элемента управления SqlDataSource вернет объект IDataReader использования курсора последовательного доступа и только для чтения. Указанный тип объекта, который возвращается управляется поставщиком, который используется. В этом случае, я использую поставщика System.Data.SqlClient как указано в &lt;connectionStrings&gt; раздел файла web.config. Таким образом, возвращаемый объект будет иметь тип SqlDataReader. Указав значение DataSourceMode набора данных, данные могут храниться в наборе данных на сервере. Этот режим позволяет добавить функции, такие как сортировка, разбиение на страницы и т. д. Если я участвовал привязки данных к элементу управления GridView элемента управления SqlDataSource, я бы выбрали режим набора данных. Тем не менее в случае элемента управления DropDownList, режим DataReader — правильный выбор.

> [!NOTE]
> При кэшировании SqlDataSource или AccessDataSource, свойство DataSourceMode должно быть присвоено набора данных. Исключение возникнет в том случае, если включено кэширование с DataSourceMode объекта DataReader.

## <a name="sqldatasource-properties"></a>Свойства элемента управления SqlDataSource

Ниже приведены некоторые свойства элемента управления SqlDataSource.

### <a name="cancelselectonnullparameter"></a>CancelSelectOnNullParameter

Логическое значение, указывающее, отменяется ли команды select, если один из параметров имеет значение null. Значение true означает, что по умолчанию.

### <a name="conflictdetection"></a>ConflictDetection

В ситуации, где несколько пользователей могут обновления источника данных в то же время свойство ConflictDetection определяет поведение элемента управления SqlDataSource. Значение этого свойства равно одно из значений перечисления ConflictOptions. Эти значения являются **CompareAllValues** и **OverwriteChanges**. Если задано OverwriteChanges последнего пользователя для записи данных в источнике данных перезаписывает все предыдущие изменения. Тем не менее если свойство ConflictDetection присвоено CompareAllValues, параметры создаются для столбцов, возвращаемых методом SelectCommand и параметры также создаются для хранения исходных значений в каждом из этих столбцов, разрешение для элемента управления SqlDataSource Определите, изменились ли значения с момента выполнения SelectCommand.

### <a name="deletecommand"></a>DeleteCommand

Задает или возвращает строку SQL, используемую для удаления строк из базы данных. Это может быть SQL-запрос или имя хранимой процедуры.

### <a name="deletecommandtype"></a>DeleteCommandType

Задает или возвращает тип команды delete, либо SQL-запрос (текст) или хранимую процедуру (Хранимая_процедура).

### <a name="deleteparameters"></a>DeleteParameters

Возвращает параметры, используемые DeleteCommand SqlDataSourceView объекта, связанного с элементом управления SqlDataSource.

### <a name="oldvaluesparameterformatstring"></a>OldValuesParameterFormatString

Это свойство используется для указания формата исходные значения параметров в случаях, где свойство ConflictDetection присваивается CompareAllValues. По умолчанию используется {0} это означает, что исходные значения параметров будет иметь то же имя, что исходный параметр. Другими словами, если имя поля EmployeeID, исходное значение параметра будет @EmployeeID.

### <a name="selectcommand"></a>SelectCommand

Задает или получает строку SQL, которая используется для получения данных из базы данных. Это может быть SQL-запрос или имя хранимой процедуры.

### <a name="selectcommandtype"></a>SelectCommandType

Задает или возвращает тип команды select, либо SQL-запрос (текст) или хранимую процедуру (Хранимая_процедура).

### <a name="selectparameters"></a>SelectParameters

Возвращает параметры, используемые SelectCommand SqlDataSourceView объекта, связанного с элементом управления SqlDataSource.

### <a name="sortparametername"></a>SortParameterName

Получает или задает имя параметра хранимой процедуры, который используется при извлечении сортировка данных элементом управления источником данных. Данный параметр является допустимым, только в том случае, если SelectCommandType присвоено StoredProcedure.

### <a name="sqlcachedependency"></a>SqlCacheDependency

Разделенный точками с запятой строка, указывающая баз данных и таблиц, используемых в зависимость кэша SQL Server. (Зависимости кэша SQL будут рассматриваться в модуле более поздней версии.)

### <a name="updatecommand"></a>UpdateCommand

Задает или получает строку SQL, который используется при обновлении данных в базе данных. Это может быть SQL-запрос или имя хранимой процедуры.

### <a name="updatecommandtype"></a>UpdateCommandType

Задает или возвращает тип команды update, либо SQL-запрос (текст) или хранимую процедуру (Хранимая_процедура).

### <a name="updateparameters"></a>UpdateParameters

Возвращает параметры, используемые UpdateCommand SqlDataSourceView объекта, связанного с элементом управления SqlDataSource.

## <a name="the-accessdatasource-control"></a>Элемент управления AccessDataSource

Элемент управления AccessDataSource является производным от класса элемента управления SqlDataSource и используется для привязки данных к базе данных Microsoft Access. Свойство ConnectionString для элемента управления AccessDataSource является свойством только для чтения. Вместо использования свойства ConnectionString, свойство файла данных используется для указания в базу данных Access, как показано ниже.

[!code-aspx[Main](data-source-controls/samples/sample4.aspx)]

AccessDataSource всегда будет значение ProviderName базового элемента управления SqlDataSource System.Data.OleDb и подключается к базе данных с помощью поставщика Microsoft.Jet.OLEDB.4.0 OLE DB. Элемент управления AccessDataSource нельзя использовать для подключения к защищенной паролем базы данных Access. Если необходимо соединиться с базой данных защищен паролем, следует использовать элемент управления SqlDataSource.

> [!NOTE]
> Доступ к базам данных, хранящихся в веб-сайт должен размещаться в приложении\_каталог данных. ASP.NET не позволит сохранять файлы в этом каталоге, доступные для просмотра. Необходимо будет предоставить разрешения на чтение и запись в приложение учетной записи процесса\_каталог данных при использовании базы данных Access.

## <a name="the-xmldatasource-control"></a>Элемент управления XmlDataSource

XmlDataSource используется для привязки к данным XML-данных к элементам управления с привязкой к данным. Можно привязать к XML-файл с помощью свойства файла данных или можно привязать к XML-строку, используя свойство данных. XmlDataSource предоставляет атрибуты XML в виде связывания поля. В случаях, когда необходимо привязать к значениям, которые не представлены в виде атрибутов необходимо использовать XSLT-файл. Можно также использовать выражения XPath к XML-данные фильтра.

Рассмотрим следующий XML-файл:

[!code-xml[Main](data-source-controls/samples/sample5.xml)]

Обратите внимание на то, что XmlDataSource использует свойство XPath из *людей или пользователя* для фильтрации на только что &lt;Person&gt; узлов. DropDownList затем привязывает данные в атрибут LastName, используя свойство DataTextField.

Хотя элемент управления XmlDataSource используется главным образом для привязки данных к XML-данных только для чтения, это можно изменить XML-файле данных. Обратите внимание на то, что в таком случае автоматическая вставка, обновление и удаление данных в XML-файле не происходит автоматически как в случае с другими элементами управления источника данных. Вместо этого необходимо написать код, чтобы вручную изменять данные, используя следующие методы элемента управления XmlDataSource.

### <a name="getxmldocument"></a>GetXmlDocument

Извлекает объект XmlDocument, содержащий XML-код полученных XmlDataSource.

### <a name="save"></a>Сохранение

Сохраняет в памяти XmlDocument обратно к источнику данных.

Важно понимать, что метод Save будет работать только в том случае, если выполняются два следующих условия:

1. XmlDataSource, использует свойство файла данных для привязки в XML-файл, а не свойство данных для привязки к данным XML в памяти.
2. Преобразования не указываются с помощью преобразования или TransformFile свойство.

Обратите внимание, что метод Save может привести к непредсказуемым результатам при вызове несколькими пользователями одновременно.

## <a name="the-objectdatasource-control"></a>Элемент управления ObjectDataSource

Элементов управления источниками данных, которые мы рассмотрели до сих пор являются отличные возможности для 2 уровневого приложения, где взаимодействует элемент управления источником данных непосредственно в хранилище данных. Однако во многих реальных приложениях, многоуровневые приложения где элементу управления источником данных может понадобиться для взаимодействия с бизнес-объект, который, в свою очередь, взаимодействует с уровнем данных. В таких ситуациях спецификации хорошо заполняет элемент управления ObjectDataSource. Элемент управления ObjectDataSource работает совместно с исходным объектом. Элемент управления ObjectDataSource будет создать экземпляр исходного объекта, вызов указанного метода и dispose экземпляра объекта в область одного запроса, если объект имеет методы экземпляра вместо статических методов (Shared в Visual Basic). Таким образом ваш объект должен быть без отслеживания состояния. То есть объект должен получить и освободить все необходимые ресурсы в пределах одного запроса. Вы можете управлять, как исходный объект создается путем обработки события ObjectCreating элемента управления ObjectDataSource. Можно создать экземпляр объекта источника и задайте свойство ObjectInstance — класса ObjectDataSourceEventArgs к этому экземпляру. Элемент управления ObjectDataSource будет использовать экземпляр, который создается в событии ObjectCreating вместо того чтобы создавать экземпляр самостоятельно.

Если исходный объект для элемента управления ObjectDataSource предоставляет общие статические методы (Shared в Visual Basic), которые могут быть вызваны для извлечения и изменения данных, элемент управления ObjectDataSource будет вызывать эти методы напрямую. Если элемент управления ObjectDataSource должен создать экземпляр объекта источника для вызова метода, то объект должен включать открытый конструктор, который не принимает никаких параметров. Элемент управления ObjectDataSource вызывает этот конструктор при создании нового экземпляра объекта источника.

Если исходный объект не содержит открытый конструктор без параметров, можно создать экземпляр объекта источника, который будет использоваться элементом управления ObjectDataSource в событии ObjectCreating.

## <a name="specifying-object-methods"></a>Указание методов объекта

Исходный объект для элемента управления ObjectDataSource может содержать любое число методов, которые используются для выбора, вставки, обновления или удаления данных. Эти методы вызываются с помощью элемента управления ObjectDataSource, на основе имени метода, определяемого с помощью свойства SelectMethod, InsertMethod, UpdateMethod или DeleteMethod элемента управления ObjectDataSource. Исходный объект также может включать необязательный SelectCount метод, который определяется с помощью свойства SelectCountMethod, которое возвращает количество, общее число объектов в источнике данных элемента управления ObjectDataSource. Элемент управления ObjectDataSource будет вызывать метод SelectCount после вызова метода Select для получения общее число записей в источнике данных для использования в том случае, если разбиение по страницам.

## <a name="lab-using-data-source-controls"></a>Лаборатории с помощью элементов управления источниками данных

## <a name="exercise-1---displaying-data-with-the-sqldatasource-control"></a>Упражнение 1 - отображение данных с помощью элемента управления SqlDataSource

Следующее упражнение использует элемента управления SqlDataSource для подключения к базе данных "Борей". Предполагается, что имеется доступ к базе данных "Борей" в экземпляре SQL Server 2000.

1. Создайте новый веб-узел ASP.NET.
2. Добавьте новый файл web.config.

    1. Правой кнопкой мыши проект в обозревателе решений и нажмите кнопку Add New Item.
    2. Выберите файл веб-конфигурации из списка шаблонов и щелкните "Добавить".
3. Изменить &lt;connectionStrings&gt; разделе следующим образом: 

    [!code-aspx[Main](data-source-controls/samples/sample6.aspx)]
4. Переключитесь в представление кода и добавьте атрибут ConnectionString и атрибут SelectCommand для &lt;asp: SqlDataSource&gt; управления следующим образом: 

    [!code-aspx[Main](data-source-controls/samples/sample7.aspx)]
5. В режиме конструктора добавьте новый элемент управления GridView.
6. Из раскрывающегося списка выберите источник данных, в меню Задачи GridView выберите SqlDataSource1.
7. Щелкните правой кнопкой мыши файл Default.aspx и выберите в меню View в браузере. Когда будет предложено сохранить, нажмите кнопку "Да".
8. Элемент GridView отображает данные из таблицы Products.

## <a name="exercise-2---editing-data-with-the-sqldatasource-control"></a>Упражнение 2 - изменение данных с помощью элемента управления SqlDataSource

Следующее упражнение демонстрирует, как для привязки данных элемента управления DropDownList управления с помощью декларативного синтаксиса позволяет редактировать данные, представленные в элементе управления DropDownList.

1. В режиме конструктора удалите элемент управления GridView из Default.aspx. 

    **Важно**. Оставьте на странице элемента управления SqlDataSource.
2. Добавление элемента управления DropDownList Default.aspx.
3. Переключитесь в представление источника.
4. Добавьте атрибут DataSourceId DataTextField и DataValueField используются, чтобы &lt;asp: DropDownList&gt; управления следующим образом: 

    [!code-aspx[Main](data-source-controls/samples/sample8.aspx)]
5. Сохраните файл Default.aspx и откройте его в браузере. Обратите внимание на то, что DropDownList содержит все продукты из базы данных "Борей".
6. Закройте браузер.
7. В представлении исходного кода Default.aspx добавьте новый элемент управления TextBox ниже элемента управления DropDownList. Измените свойство ID текстового поля на txtProductName.
8. В разделе управления TextBox добавьте новый элемент управления Button. Измените свойство ID кнопки на btnUpdate и свойство Text на **имя продукта обновления**.
9. В представлении исходного кода Default.aspx добавьте свойство UpdateCommand и два новых UpdateParameters тега элемента управления SqlDataSource следующим образом: 

    [!code-aspx[Main](data-source-controls/samples/sample9.aspx)]

    > [!NOTE]
    > Обратите внимание, что два обновления параметров (ProductName и ProductID), добавленных в этот код. Эти параметры сопоставляются свойству Text элемента txtProductName текстовое поле и свойство SelectedValue ddlProducts DropDownList.
10. Переключитесь в конструктор и дважды щелкните элемент управления Button, чтобы добавить обработчик событий.
11. Добавьте следующий код к btnUpdate\_щелкните код: 

    [!code-csharp[Main](data-source-controls/samples/sample10.cs)]
12. Щелкните правой кнопкой мыши файл Default.aspx и выберите для просмотра в браузере. Когда будет предложено сохранить все изменения, нажмите кнопку "Да".
13. ASP.NET 2.0 разделяемые классы обеспечения компиляции во время выполнения. Не бывает необходимо создать приложение, чтобы увидеть изменения кода вступают в силу.
14. Выберите продукт в элементе управления DropDownList.
15. Введите новое имя для выбранного продукта в текстовом поле и нажмите кнопку кнопкой "Обновить".
16. Имя продукта обновляется в базе данных.

## <a name="exercise-3-using-the-objectdatasource-control"></a>Упражнение 3. Использование элемента управления ObjectDataSource

В этом упражнении будет показано, как использовать элемент управления ObjectDataSource и исходный объект для взаимодействия с базой данных "Борей".

1. Правой кнопкой мыши проект в обозревателе решений и выберите команду Добавить новый элемент.
2. Выберите веб-форму в списке шаблонов. Измените имя на object.aspx и щелкните "Добавить".
3. Правой кнопкой мыши проект в обозревателе решений и выберите команду Добавить новый элемент.
4. Выберите класс в списке шаблонов. Измените имя класса на NorthwindData.cs и щелкните "Добавить".
5. Нажмите "Да" при появлении предложения добавить класс в приложение\_папке кода.
6. Добавьте следующий код в файл NorthwindData.cs: 

    [!code-csharp[Main](data-source-controls/samples/sample11.cs)]
7. Добавьте следующий код в представлении источника object.aspx: 

    [!code-aspx[Main](data-source-controls/samples/sample12.aspx)]
8. Сохраните все файлы и найдите object.aspx.
9. Взаимодействовать с интерфейсом, Просмотр подробных сведений, редактирования сотрудников, добавление сотрудников и удаления сотрудников.
