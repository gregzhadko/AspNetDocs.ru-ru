---
uid: web-forms/overview/moving-to-aspnet-20/data-source-controls
title: Элементы управления источниками данных | Документация Майкрософт
author: microsoft
description: Элемент управления DataGrid в ASP.NET 1. x помечается отличным улучшением доступа к данным в веб-приложениях. Однако это было не так понятно, как было бы...
ms.author: riande
ms.date: 02/20/2005
ms.assetid: 78fd0e92-f9c6-4e96-a5e9-0375b307a828
msc.legacyurl: /web-forms/overview/moving-to-aspnet-20/data-source-controls
msc.type: authoredcontent
ms.openlocfilehash: a2e2cfbec3e5aebf42a2de30bab7d45b4b610298
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78519354"
---
# <a name="data-source-controls"></a>Элементы управления источником данных

по [Майкрософт](https://github.com/microsoft)

> Элемент управления DataGrid в ASP.NET 1. x помечается отличным улучшением доступа к данным в веб-приложениях. Однако это было бы не так, как было бы понятно. Он по-прежнему требует значительного объема кода для получения значительной полезной функциональности. Это модель во всем доступе к данным в 1. x.

Элемент управления DataGrid в ASP.NET 1. x помечается отличным улучшением доступа к данным в веб-приложениях. Однако это было бы не так, как было бы понятно. Он по-прежнему требует значительного объема кода для получения значительной полезной функциональности. Это модель во всем доступе к данным в 1. x.

ASP.NET 2,0 разрешается с помощью в части с элементами управления источниками данных. Элементы управления источниками данных в ASP.NET 2,0 предоставляют разработчикам декларативную модель для извлечения данных, отображения данных и редактирования данных. Целью элементов управления источниками данных является обеспечение единообразного представления данных для элементов управления с привязкой к данным независимо от источника этих данных. Основой элементов управления источниками данных в ASP.NET 2,0 является абстрактный класс Датасаурцеконтрол. Класс Датасаурцеконтрол предоставляет базовую реализацию интерфейса IDataSource и интерфейса IListSource, второй из которых позволяет назначить элемент управления источником данных в качестве DataSource элемента управления с привязкой к данным (через новое свойство DataSourceId Вы обсуждали позже) и предоставляете данные в виде списка. Каждый список данных из элемента управления источника данных предоставляется как объект DataSourceView. Доступ к экземплярам DataSourceView предоставляется интерфейсом IDataSource. Например, метод Жетвиевнамес Возвращает ICollection, который позволяет перечислить DataSourceViews, связанные с определенным элементом управления источниками данных, и метод GetEnumerator позволяет получить доступ к определенному экземпляру DataSourceView по имени.

Элементы управления источниками данных не имеют пользовательского интерфейса. Они реализуются как серверные элементы управления, чтобы они поддерживали декларативный синтаксис и имели доступ к состоянию страницы при необходимости. Элементы управления источниками данных не отображают HTML-разметку клиенту.

> [!NOTE]
> Как вы увидите позже, существуют также кэшированные преимущества, получаемые с помощью элементов управления источниками данных.

## <a name="storing-connection-strings"></a>Хранение строк подключения

Прежде чем приступить к рассмотрению настройки элементов управления источниками данных, мы должны охватить новую возможность в ASP.NET 2,0, касающуюся строк подключения. В ASP.NET 2,0 появился новый раздел в файле конфигурации, который позволяет легко хранить строки подключения, которые можно динамически считывать во время выполнения. Раздел &lt;connectionStrings&gt; упрощает хранение строк подключения.

В приведенном ниже фрагменте кода добавляется новая строка подключения.

[!code-xml[Main](data-source-controls/samples/sample1.xml)]

> [!NOTE]
> Как и в разделе &lt;appSettings&gt;, раздел &lt;connectionStrings&gt; находится за пределами раздела &lt;System. Web&gt; в файле конфигурации.

Чтобы использовать эту строку подключения, при установке атрибута ConnectionString серверного элемента управления можно использовать следующий синтаксис.

[!code-aspx[Main](data-source-controls/samples/sample2.aspx)]

&lt;connectionString&gt; можно также зашифровать, чтобы конфиденциальные сведения не раскрываются. Эта возможность будет рассмотрена в более позднем модуле.

## <a name="caching-data-sources"></a>Кэширование источников данных

Каждый Датасаурцеконтрол предоставляет четыре свойства для настройки кэширования. Енаблекачинг, Качедуратион, Качикспиратионполици и Качекэйдепенденци.

## <a name="enablecaching"></a>енаблекачинг

Енаблекачинг — это логическое свойство, определяющее, включено ли кэширование для элемента управления источника данных.

## <a name="cacheduration-property"></a>Качедуратион, свойство

Свойство Качедуратион задает количество секунд, в течение которых кэш остается действительным. Установка этого свойства равным **0** приводит к тому, что кэш остается действительным до тех пор, пока не станет явно недействительным.

## <a name="cacheexpirationpolicy-property"></a>Качикспиратионполици, свойство

Для свойства Качикспиратионполици можно задать значение **Absolute** или **скользящее**. Если задать для него значение Absolute, то максимальное количество времени, в течение которого кэшируются данные, будет равно количеству секунд, заданному в свойстве Качедуратион. Если задать для него значение скользящее, то время истечения срока действия сбрасывается, когда выполняется каждая операция.

## <a name="cachekeydependency-property"></a>Качекэйдепенденци, свойство

Если строковое значение задано для свойства Качекэйдепенденци, ASP.NET настроит новую зависимость кэша на основе этой строки. Это позволяет явно сделать кэш недействительным, просто изменив или удалив Качекэйдепенденци.

**Важно!** если олицетворение включено и доступ к источнику данных и (или) содержимому данных основывается на удостоверении клиента, рекомендуется отключить кэширование, установив для Енаблекачинг значение false. Если в этом сценарии включено кэширование и пользователь, отличный от пользователя, который первоначально запросил данные, выдает запрос, авторизация в источнике данных не применяется. Данные будут просто обрабатываться из кэша.

## <a name="the-sqldatasource-control"></a>Элемент управления SqlDataSource

Элемент управления SqlDataSource позволяет разработчику получить доступ к данным, хранящимся в любой реляционной базе данных, которая поддерживает ADO.NET. Он может использовать поставщик System. Data. SqlClient для доступа к базе данных SQL Server, поставщику System. Data. OleDb, поставщику System. Data. ODBC или System. Data. OracleClient для доступа к Oracle. Таким образом, SqlDataSource не только используется для доступа к данным в базе данных SQL Server.

Чтобы использовать SqlDataSource, просто укажите значение для свойства ConnectionString и укажите команду SQL или хранимую процедуру. Элемент управления SqlDataSource берет на себя работу с базовой архитектурой ADO.NET. Он открывает подключение, запрашивает источник данных или выполняет хранимую процедуру, возвращает данные, а затем закрывает подключение.

> [!NOTE]
> Так как класс Датасаурцеконтрол автоматически закрывает подключение, он должен уменьшить количество вызовов клиентов, созданных при утечке подключений к базе данных.

Приведенный ниже фрагмент кода привязывает элемент управления DropDownList к элементу управления SqlDataSource, используя строку подключения, которая хранится в файле конфигурации, как показано выше.

[!code-aspx[Main](data-source-controls/samples/sample3.aspx)]

Как показано выше, свойство DataSourceMode элемента SqlDataSource указывает режим для источника данных. В приведенном выше примере для DataSourceMode задано значение DataReader. В этом случае SqlDataSource возвращает объект IDataReader, используя однопроходный курсор и указатель только для чтения. Указанный тип возвращаемого объекта управляется используемым поставщиком. В этом случае я использую поставщик System. Data. SqlClient, как указано в &lt;connectionString&gt; в разделе файла Web. config. Таким образом, возвращаемый объект будет иметь тип SqlDataReader. Указав значение DataSourceMode набора данных, данные могут храниться в наборе данных на сервере. Этот режим позволяет добавлять такие функции, как сортировка, разбиение на страницы и т. д. Если бы я привязать к данным SqlDataSource к элементу управления GridView, я бы выбрал режим набора данных. Однако в случае с DropDownList режим DataReader является правильным выбором.

> [!NOTE]
> При кэшировании элемента SqlDataSource или AccessDataSource свойству DataSourceMode должно быть присвоено значение DataSet. При включении кэширования с DataSourceMode объекта DataReader возникнет исключение.

## <a name="sqldatasource-properties"></a>Свойства SqlDataSource

Ниже приведены некоторые свойства элемента управления SqlDataSource.

### <a name="cancelselectonnullparameter"></a>канцелселектоннуллпараметер

Логическое значение, указывающее, отменяется ли команда SELECT, если один из параметров имеет значение null. По умолчанию имеет значение TRUE.

### <a name="conflictdetection"></a>конфликтдетектион

В ситуации, когда несколько пользователей могут одновременно обновлять источник данных, свойство Конфликтдетектион определяет поведение элемента управления SqlDataSource. Это свойство принимает одно из значений перечисления Конфликтоптионс. Эти значения — **компареаллвалуес** и **овервритечанжес**. Если задано значение Овервритечанжес, последний пользователь, записывающий данные в источник данных, перезаписывает все предыдущие изменения. Однако если свойство Конфликтдетектион имеет значение Компареаллвалуес, то для столбцов, возвращаемых SelectCommand, создаются параметры Get, а параметры — для хранения исходных значений в каждом из этих столбцов, позволяя SqlDataSource Определите, изменились ли значения с момента выполнения SelectCommand.

### <a name="deletecommand"></a>Команда

Задает или возвращает строку SQL, используемую при удалении строк из базы данных. Это может быть либо SQL-запрос, либо имя хранимой процедуры.

### <a name="deletecommandtype"></a>делетекоммандтипе

Задает или возвращает тип команды Delete: SQL-запрос (текст) или хранимая процедура (StoredProcedure).

### <a name="deleteparameters"></a>делетепараметерс

Возвращает параметры, используемые DeleteCommand объекта Склдатасаурцевиев, связанного с элементом управления SqlDataSource.

### <a name="oldvaluesparameterformatstring"></a>OldValuesParameterFormatString

Это свойство используется для указания формата параметров исходного значения в случаях, когда свойство Конфликтдетектион имеет значение Компареаллвалуес. Значение по умолчанию — {0} то есть параметры исходного значения будут иметь то же имя, что и исходный параметр. Иными словами, если имя поля — EmployeeID, то исходный параметр значения будет @EmployeeID.

### <a name="selectcommand"></a>SelectCommand

Возвращает или задает строку SQL, используемую для получения данных из базы данных. Это может быть либо SQL-запрос, либо имя хранимой процедуры.

### <a name="selectcommandtype"></a>селекткоммандтипе

Задает или возвращает тип команды SELECT: SQL-запрос (текст) или хранимая процедура (StoredProcedure).

### <a name="selectparameters"></a>SelectParameters

Возвращает параметры, используемые SelectCommand объекта Склдатасаурцевиев, связанного с элементом управления SqlDataSource.

### <a name="sortparametername"></a>SortParameterName

Возвращает или задает имя параметра хранимой процедуры, используемой при сортировке данных, полученных элементом управления источниками данных. Допустимо, только если Селекткоммандтипе имеет значение StoredProcedure.

### <a name="sqlcachedependency"></a>SqlCacheDependency

Строка с разделителями-двоеточием, указывающая базы данных и таблицы, используемые в зависимости кэша SQL Server. (Зависимости кэша SQL будут обсуждаться в более позднем модуле.)

### <a name="updatecommand"></a>Имел

Возвращает или задает строку SQL, используемую при обновлении данных в базе данных. Это может быть либо SQL-запрос, либо имя хранимой процедуры.

### <a name="updatecommandtype"></a>упдатекоммандтипе

Задает или возвращает тип команды Update: SQL-запрос (текст) или хранимая процедура (StoredProcedure).

### <a name="updateparameters"></a>UpdateParameters

Возвращает параметры, используемые UpdateCommand объекта Склдатасаурцевиев, связанного с элементом управления SqlDataSource.

## <a name="the-accessdatasource-control"></a>Элемент управления AccessDataSource

Элемент управления AccessDataSource является производным от класса SqlDataSource и используется для привязки данных к базе данных Microsoft Access. Свойство ConnectionString для элемента управления AccessDataSource является свойством, предназначенным только для чтения. Вместо использования свойства ConnectionString для указания базы данных Access используется свойство «File», как показано ниже.

[!code-aspx[Main](data-source-controls/samples/sample4.aspx)]

AccessDataSource всегда установит ProviderName для базового элемента SqlDataSource в System. Data. OleDb и подключится к базе данных с помощью поставщика OLE DB Microsoft. Jet. OLEDB. 4.0. Элемент управления AccessDataSource нельзя использовать для подключения к защищенной паролем базе данных Access. Если необходимо подключиться к базе данных, защищенной паролем, следует использовать элемент управления SqlDataSource.

> [!NOTE]
> Базы данных Access, хранящиеся на веб-сайте, должны размещаться в каталоге данных приложения\_. ASP.NET не позволяет просматривать файлы в этом каталоге. При использовании баз данных Access необходимо предоставить учетной записи процесса разрешения на чтение и запись для каталога данных приложения\_.

## <a name="the-xmldatasource-control"></a>Элемент управления XmlDataSource

XmlDataSource используется для привязки данных XML к элементам управления с привязкой к данным. Можно выполнить привязку к XML-файлу с помощью свойства файла данных или выполнить привязку к XML-строке с помощью свойства Data. XmlDataSource предоставляет атрибуты XML как связываемые поля. В случаях, когда необходимо выполнить привязку к значениям, не представленным в виде атрибутов, необходимо использовать преобразование XSL. Можно также использовать выражения XPath для фильтрации XML-данных.

Рассмотрим следующий XML-файл:

[!code-xml[Main](data-source-controls/samples/sample5.xml)]

Обратите внимание, что XmlDataSource использует свойство XPath persons */Person* для фильтрации только &lt;человека&gt; узлов. Затем DropDownList привязывает данные к атрибуту LastName с помощью свойства TextField.

Хотя элемент управления XmlDataSource в основном используется для привязки данных к XML-данным только для чтения, можно изменить XML-файл данных. Обратите внимание, что в таких случаях автоматическая вставка, обновление и удаление данных в XML-файле не происходит автоматически, как это делается с другими элементами управления источниками данных. Вместо этого потребуется написать код для ручного редактирования данных с помощью следующих методов элемента управления XmlDataSource.

### <a name="getxmldocument"></a>XmlDocument

Извлекает объект XmlDocument, содержащий XML-код, полученный с помощью XmlDataSource.

### <a name="save"></a>Сохранять

Сохраняет в памяти XmlDocument обратно в источник данных.

Важно понимать, что метод Save будет работать только при выполнении следующих двух условий:

1. XmlDataSource использует свойство файла данных для привязки к XML-файлу, а не к свойству Data для привязки к XML-данным в памяти.
2. Преобразование не указано с помощью свойства Transform или Трансформфиле.

Обратите внимание, что метод Save может привести к непредвиденным результатам при одновременном вызове нескольких пользователей.

## <a name="the-objectdatasource-control"></a>Элемент управления ObjectDataSource

Элементы управления источниками данных, которые мы охвачени этой точкой, являются отличным выбором для двухуровневых приложений, в которых элемент управления источника данных взаимодействует непосредственно с хранилищем данных. Однако многие реальные приложения — многоуровневые приложения, в которых элементу управления источником данных может потребоваться взаимодействовать с бизнес-объектом, который, в свою очередь, взаимодействует с уровнем данных. В таких ситуациях элемент управления ObjectDataSource заполняет счет прекрасно. Элемент управления ObjectDataSource работает вместе с исходным объектом. Элемент управления ObjectDataSource создает экземпляр исходного объекта, вызывает указанный метод и удаляет экземпляр объекта из области одного запроса, если у объекта есть методы экземпляра, а не статические методы (Shared в Visual Basic). Поэтому объект должен быть без отслеживания состояния. То есть объект должен получить и освободить все необходимые ресурсы в пределах одного запроса. Способ создания исходного объекта можно контролировать, обрабатывая событие Обжекткреатинг элемента управления ObjectDataSource. Можно создать экземпляр исходного объекта, а затем присвоить свойству ObjectInstance класса Обжектдатасаурцеевентаргс значение этого экземпляра. Элемент управления ObjectDataSource будет использовать экземпляр, созданный в событии Обжекткреатинг, вместо создания собственного экземпляра.

Если исходный объект элемента управления ObjectDataSource предоставляет открытые статические методы (Shared в Visual Basic), которые могут быть вызваны для получения и изменения данных, элемент управления ObjectDataSource будет вызывать эти методы напрямую. Если элемент управления ObjectDataSource должен создать экземпляр исходного объекта для выполнения вызовов метода, объект должен включать открытый конструктор, который не принимает параметров. Элемент управления ObjectDataSource будет вызывать этот конструктор при создании нового экземпляра исходного объекта.

Если исходный объект не содержит общий конструктор без параметров, можно создать экземпляр исходного объекта, который будет использоваться элементом управления ObjectDataSource в событии Обжекткреатинг.

## <a name="specifying-object-methods"></a>Указание методов объекта

Исходный объект для элемента управления ObjectDataSource может содержать любое количество методов, используемых для выбора, вставки, обновления или удаления данных. Эти методы вызываются элементом управления ObjectDataSource на основе имени метода, как определено с помощью свойства SelectMethod, InsertMethod, UpdateMethod или DeleteMethod элемента управления ObjectDataSource. Исходный объект может также включать необязательный метод SelectCount, который определяется элементом управления ObjectDataSource с помощью свойства Селекткаунтмесод, возвращающего количество общего числа объектов в источнике данных. Элемент управления ObjectDataSource вызывает метод SelectCount после вызова метода Select, чтобы получить общее число записей в источнике данных, которое будет использоваться при разбиении на страницы.

## <a name="lab-using-data-source-controls"></a>Лаборатория, использующая элементы управления источниками данных

## <a name="exercise-1---displaying-data-with-the-sqldatasource-control"></a>Упражнение 1. Отображение данных с помощью элемента управления SqlDataSource

В следующем упражнении для подключения к базе данных Northwind используется элемент управления SqlDataSource. Предполагается, что у вас есть доступ к базе данных Northwind на экземпляре SQL Server 2000.

1. Создание нового веб-сайта ASP.NET.
2. Добавьте новый файл Web. config.

    1. Щелкните правой кнопкой мыши проект в обозреватель решений и выберите команду Добавить новый элемент.
    2. В списке шаблонов выберите файл веб-конфигурации и нажмите кнопку Добавить.
3. Измените &lt;connectionString&gt;, как показано ниже. 

    [!code-aspx[Main](data-source-controls/samples/sample6.aspx)]
4. Перейдите в представление кода и добавьте атрибут ConnectionString и атрибут SelectCommand в &lt;элемент управления ASP: SqlDataSource&gt; следующим образом: 

    [!code-aspx[Main](data-source-controls/samples/sample7.aspx)]
5. В представление конструирования добавьте новый элемент управления GridView.
6. В раскрывающемся списке Выбор источника данных в меню Задачи GridView выберите SqlDataSource1.
7. Щелкните правой кнопкой мыши Default. aspx и выберите в меню пункт Просмотреть в браузере. Нажмите кнопку Да при появлении запроса на сохранение.
8. Элемент управления GridView отображает данные из таблицы Products.

## <a name="exercise-2---editing-data-with-the-sqldatasource-control"></a>Упражнение 2. изменение данных с помощью элемента управления SqlDataSource

В следующем упражнении показано, как выполнить привязку данных элемента управления DropDownList с помощью декларативного синтаксиса и позволяет изменять данные, представленные в элементе управления DropDownList.

1. В представление конструирования удалите элемент управления GridView из default. aspx. 

    **Важно!** не оставляйте на странице элемент управления SqlDataSource.
2. Добавьте элемент управления DropDownList в Default. aspx.
3. Переключитесь в представление исходного кода.
4. Добавьте атрибут DataSourceId, TextField и Датавалуефиелд в элемент управления &lt;ASP: DropDownList&gt; следующим образом: 

    [!code-aspx[Main](data-source-controls/samples/sample8.aspx)]
5. Сохраните Default. aspx и просмотрите его в браузере. Обратите внимание, что DropDownList содержит все продукты из базы данных Northwind.
6. Закройте браузер.
7. В представлении исходного кода Default. aspx добавьте новый элемент управления TextBox под элементом управления DropDownList. Измените свойство ID текстового окна на Ткстпродуктнаме.
8. В элементе управления TextBox добавьте новый элемент управления Button. Измените свойство ID кнопки на Бтнупдате, а свойство Text — на **Обновить имя продукта**.
9. В представлении исходного кода Default. aspx добавьте свойство UpdateCommand и два новых UpdateParameters в тег SqlDataSource следующим образом: 

    [!code-aspx[Main](data-source-controls/samples/sample9.aspx)]

    > [!NOTE]
    > Обратите внимание, что в этом коде Добавлено два параметра обновления (ProductName и ProductID). Эти параметры сопоставляются со свойством Text текстового поля Ткстпродуктнаме и свойством SelectedValue элемента DropDownList Ддлпродуктс.
10. Переключитесь на представление конструирования и дважды щелкните элемент управления "Кнопка", чтобы добавить обработчик событий.
11. Добавьте следующий код в Бтнупдате\_щелкните код: 

    [!code-csharp[Main](data-source-controls/samples/sample10.cs)]
12. Щелкните правой кнопкой мыши Default. aspx и выберите Просмотр в браузере. Нажмите кнопку Да при появлении запроса на сохранение всех изменений.
13. ASP.NET 2,0 разделяемые классы позволяют выполнять компиляцию во время выполнения. Нет необходимости создавать приложение, чтобы увидеть, что изменения кода вступают в силу.
14. Выберите продукт в DropDownList.
15. Введите новое имя для выбранного продукта в текстовое поле, а затем нажмите кнопку Обновить.
16. Название продукта обновляется в базе данных.

## <a name="exercise-3-using-the-objectdatasource-control"></a>Упражнение 3. Использование элемента управления ObjectDataSource

В этом упражнении будет продемонстрировано, как использовать элемент управления ObjectDataSource и исходный объект для взаимодействия с базой данных Northwind.

1. Щелкните правой кнопкой мыши проект в обозреватель решений и выберите пункт Добавить новый элемент.
2. В списке Шаблоны выберите пункт веб-форма. Измените имя на Object. aspx и нажмите кнопку Добавить.
3. Щелкните правой кнопкой мыши проект в обозреватель решений и выберите пункт Добавить новый элемент.
4. В списке шаблонов выберите класс. Измените имя класса на NorthwindData.cs и нажмите кнопку Добавить.
5. Нажмите кнопку Да при появлении запроса на добавление класса в папку приложения\_Code.
6. Добавьте следующий код в файл NorthwindData.cs: 

    [!code-csharp[Main](data-source-controls/samples/sample11.cs)]
7. Добавьте следующий код в представление исходного кода объекта Object. aspx: 

    [!code-aspx[Main](data-source-controls/samples/sample12.aspx)]
8. Сохраните все файлы и просмотрите файл Object. aspx.
9. Взаимодействуйте с интерфейсом, просматривая сведения, редактируя сотрудников, добавляя сотрудников и удаляя сотрудников.
