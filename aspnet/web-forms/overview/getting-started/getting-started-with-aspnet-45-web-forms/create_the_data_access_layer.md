---
uid: web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/create_the_data_access_layer
title: Создание уровня доступа к данным | Документация Майкрософт
author: Erikre
description: В этой серии руководств будет основы создания приложений веб-форм ASP.NET с помощью ASP.NET 4.5 и Microsoft Visual Studio Express 2013 для мы...
ms.author: riande
ms.date: 09/08/2014
ms.assetid: 0bbf7a6e-d7eb-4091-91e4-fff892777f32
msc.legacyurl: /web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/create_the_data_access_layer
msc.type: authoredcontent
ms.openlocfilehash: 61a9dae22efed9cb7e8957a8c131396cbdeea3c9
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2019
ms.locfileid: "65131357"
---
# <a name="create-the-data-access-layer"></a>Создание уровня доступа к данным

по [Erik Reitan](https://github.com/Erikre)

[Скачайте пример проекта Wingtip Toys (C#)](http://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) или [скачайте электронную книгу (PDF)](http://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20ASP.NET%204.5%20Web%20Forms%20and%20Visual%20Studio%202013.pdf)

> В этой серии руководств будет основы создания приложений веб-форм ASP.NET с помощью ASP.NET 4.5 и Microsoft Visual Studio Express 2013 для Web. Visual Studio 2013 [проект с исходным кодом C#](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) доступен на следующей странице этой серии руководств.

Это руководство содержит инструкции для создания, доступа и просмотра данных из базы данных с помощью веб-форм ASP.NET и Entity Framework Code First. Этот учебник основан на предыдущем учебном курсе «Создать проект» и является частью серии руководств Store Toy Wingtip. Если после завершения данного учебника, вы сможете создать группу классов доступа к данным, которые находятся в *моделей* папку проекта.

## <a name="what-youll-learn"></a>Вы узнаете, как:

- Инструкции по созданию моделей данных.
- Как инициализировать и заполнение базы данных.
- Как обновить и настроить приложение для поддержки базы данных.

### <a name="these-are-the-features-introduced-in-the-tutorial"></a>Ниже приведены функции, представленные в этом руководстве.

- Платформа Entity Framework Code First
- LocalDB
- Заметки к данным

## <a name="creating-the-data-models"></a>Создание моделей данных

[Платформа Entity Framework](https://msdn.microsoft.com/data/aa937723) — это платформа объектно реляционного сопоставления (ORM). Он позволяет работать с реляционными данными как с объектами, устраняя большую часть кода доступа к данным, обычно необходимо для записи. С помощью Entity Framework, можно выполнять запросы с помощью [LINQ](https://msdn.microsoft.com/library/bb397926.aspx), затем извлечь и обработать данные в виде строго типизированных объектов. LINQ предоставляет шаблоны для запроса и обновления данных. С помощью Entity Framework позволяет сосредоточиться на создании остальной части приложения, а не посвященный основы доступа к данным. Далее в этой серии руководств мы покажем, как использовать данные для заполнения запросов навигации и продукта.

Платформа Entity Framework поддерживает парадигму разработки, в вызове *Code First*. Код сначала позволяет определять модели данных с помощью классов. Класс — это конструкция, которая позволяет создавать собственные настраиваемые типы путем группирования переменных других типов, методов и событий. Можно сопоставить классы для существующей базы данных или использовать их для создания базы данных. В этом руководстве вы создадите моделей данных, написав классы модели данных. Затем вы разрешаете Entity Framework создавать базы данных на лету от этих новых классов.

Сначала путем создания классов сущностей, которые определяют модели данных для приложения веб-форм. Затем вы создадите класс контекста, который управляет классы сущностей и предоставляет доступ к данным к базе данных. Вы также создадите инициализатор класса, который будет использоваться для заполнения базы данных.

### <a name="entity-framework-and-references"></a>Entity Framework и ссылки

По умолчанию Entity Framework включается при создании нового **веб-приложение ASP.NET** с помощью **веб-форм** шаблона. Entity Framework можно установлен, удаления и обновления в виде пакета NuGet.

Этот пакет NuGet входят следующие **среды выполнения** сборки в проекте:

- EntityFramework.dll — все распространенные код среды выполнения, используемый платформой Entity Framework
- EntityFramework.SqlServer.dll — поставщик Microsoft SQL Server для Entity Framework

### <a name="entity-classes"></a>Классы сущностей

Классы, создаваемые для определения схемы данных, называются классами сущностей. Если вы не знакомы с проектированием баз данных, считать классы сущностей определения таблиц базы данных. Каждое свойство в классе определяет столбец в таблице базы данных. Эти классы предоставляют упрощенный, объектно реляционного интерфейс между кодом, объектно ориентированного и структура таблицы реляционной базы данных.

В этом руководстве начните с добавления простого объекта классов, представляющих схемы для категорий и продуктов. Класс продуктов будет содержать определения для каждого продукта. Каждый из членов класса product будет называться `ProductID`, `ProductName`, `Description`, `ImagePath`, `UnitPrice`, `CategoryID`, и `Category`. Класс категории будет содержать определения для каждой категории, продукт может принадлежать к, таких как автомобиль, яхту или плоскости. Имя каждого из членов класса категории будет `CategoryID`, `CategoryName`, `Description`, и `Products`. Каждый продукт будет принадлежать к одной из категорий. Эти классы сущностей, которые будут добавляться к существующим проекта *моделей* папки.

1. В **обозревателе решений**, щелкните правой кнопкой мыши *моделей* папку, а затем выберите **добавить**  - &gt; **новый элемент**. 

    ![Создание уровня доступа к данным — новый элемент меню](create_the_data_access_layer/_static/image1.png)

   Откроется диалоговое окно **Добавление нового элемента**.
2. В разделе **Visual C#** из **установленные** панели слева, выберите **кода**. 

    ![Создание уровня доступа к данным — новый элемент меню](create_the_data_access_layer/_static/image2.png)
3. Выберите **класс** в средней области и назовите этот новый класс *Product.cs*.
4. Нажмите кнопку **Добавить**.  
   Новый файл класса отображается в редакторе.
5. Замените код по умолчанию следующим кодом:   

    [!code-csharp[Main](create_the_data_access_layer/samples/sample1.cs)]
6. Создайте еще один класс, повторив шаги 1 – 4, тем не менее, назовите новый класс *Category.cs* и замените код по умолчанию следующим кодом:  

    [!code-csharp[Main](create_the_data_access_layer/samples/sample2.cs)]

Как упоминалось ранее, `Category` класс представляет тип продукта, в которой оно будет предназначен для продажи (такие как <a id="a"> </a> &quot;автомобили&quot;, &quot;лодок&quot;, &quot;Rockets&quot;, и так далее) и `Product` класс представляет отдельные продукты (toys) в базе данных. Каждый экземпляр `Product` объект будет соответствовать ряду в таблице реляционной базы данных, а каждое свойство класса продуктов будет сопоставить со столбцом в таблице реляционной базы данных. Далее в этом учебнике вы изучите данные продуктов, содержащихся в базе данных.

### <a name="data-annotations"></a>Заметки к данным

Вы заметите, что определенные члены классов имеют атрибуты, указав сведения об элементе, например `[ScaffoldColumn(false)]`. Это *заметок к данным*. Атрибуты примечаний к данным можно описать как проверки пользовательского ввода для этого элемента, чтобы задать формат для него, а также указать, каким образом оно моделируется при создании базы данных.

### <a name="context-class"></a>Класс Context

Чтобы начать использовать классы для доступа к данным, необходимо определить класс контекста. Как упоминалось ранее, этот класс контекста управляет классы сущностей (такие как `Product` класс и `Category` класс) и предоставляет доступ к данным к базе данных.

Эта процедура добавляет новый класс C# контекст для *моделей* папки.

1. Щелкните правой кнопкой мыши *моделей* папку, а затем выберите **добавить**  - &gt; **новый элемент**.   
   Откроется диалоговое окно **Добавление нового элемента**.
2. Выберите **класс** в средней области, назовите его *ProductContext.cs* и нажмите кнопку **добавить**.
3. Замените код по умолчанию, содержащиеся в классе следующим кодом:   

    [!code-csharp[Main](create_the_data_access_layer/samples/sample3.cs)]

Этот код добавляет `System.Data.Entity` пространства имен таким образом, чтобы у вас есть доступ ко всем функциям core, Entity Framework, которая включает возможность запроса, вставки, обновления и удаления данных, работая с строго типизированных объектов.

`ProductContext` Класс представляет контекст базы данных Entity Framework продукта, который обрабатывает получение, хранения и обновления `Product` экземпляров в базе данных класса. `ProductContext` Класс является производным от `DbContext` базового класса, предоставляемых платформой Entity Framework.

### <a name="initializer-class"></a>Инициализатор класса

Необходимо будет выполнить определенную настраиваемую логику для инициализации базы данных при первом использовании контекст. Это позволит заполнить данными добавляются в базу данных, таким образом, чтобы сразу же можно отобразить продукты и категории.

Эта процедура добавляет новый класс C# инициализатор для *моделей* папки.

1. Создайте другой `Class` в *моделей* папки и назовите его *ProductDatabaseInitializer.cs*.
2. Замените код по умолчанию, содержащиеся в классе следующим кодом:   

    [!code-csharp[Main](create_the_data_access_layer/samples/sample4.cs)]

Как показано в приведенном выше коде при базе данных создается и инициализируется, `Seed` свойство переопределено и задано. Когда `Seed` имеет значение свойства, значения из категорий и продуктов используются для заполнения базы данных. Если вы попытаетесь обновить начальные данные, изменив приведенный выше код, после создания базы данных, вы не увидите обновлений при запуске веб-приложения. Причина заключается в приведенный выше код использует реализацию `DropCreateDatabaseIfModelChanges` класс для распознавания, изменилась ли модель (схему), перед сбросом начальные данные. Если изменения не вносятся в `Category` и `Product` классы сущностей, базы данных будет не будут повторно инициализированы с помощью начальные данные.

> [!NOTE] 
> 
> При желании базе, чтобы создать заново при каждом запуске приложения, вы можете использовать `DropCreateDatabaseAlways` вместо класса `DropCreateDatabaseIfModelChanges` класса. Тем не менее для этой серии руководств, используйте `DropCreateDatabaseIfModelChanges` класса.

На этом этапе в этом руководстве будет иметь *моделей* папки с помощью четырех новых классов и класса одно значение по умолчанию:

![Создание уровня доступа к данным — папку Models](create_the_data_access_layer/_static/image3.png)

### <a name="configuring-the-application-to-use-the-data-model"></a>Настройка приложения для использования модели данных

Теперь, когда вы создали классы, представляющие данные, необходимо настроить приложение для использования классов. В *Global.asax* файл, добавьте код, который инициализирует модель. В *Web.config* файл, добавьте информацию, которая сообщает приложению о том, что база данных будет использоваться для хранения данных, представленного новые классы данных. *Global.asax* файл может использоваться для обработки событий или методов приложения. *Web.config* файл позволяет управлять конфигурацией веб-приложения ASP.NET.

#### <a name="updating-the-globalasax-file"></a>Обновление файла Global.asax

Чтобы инициализировать моделей данных, при запуске приложения, мы обновим `Application_Start` обработчик в *Global.asax.cs* файл.

> [!NOTE] 
> 
> В обозревателе решений, можно выбрать либо *Global.asax* файл или *Global.asax.cs* файл для изменения *Global.asax.cs* файл.

1. Добавьте следующий код, они выделены желтым цветом, чтобы `Application_Start` метод в *Global.asax.cs* файл.   

    [!code-csharp[Main](create_the_data_access_layer/samples/sample5.cs?highlight=9-10,22-23)]

> [!NOTE] 
> 
> В браузере должен поддерживать HTML5 для просмотра кода выделены желтым цветом при просмотре этой серии руководств в браузере.

Как показано в приведенном выше коде, при запуске приложения, приложения указывает, что осуществляется инициализатора, который будет выполняться при первом данные. Две дополнительные пространства имен являются обязательными для доступа к `Database` объекта и `ProductDatabaseInitializer` объекта.

 Изменение файла Web.Config 

Несмотря на то, что Entity Framework Code First создаст базу данных для вас в расположении по умолчанию при заполнении базы данных с начального значения данных, добавление в приложение данные подключения позволяет выбрать расположение базы данных. Укажите это подключение базы данных, используя строку подключения в приложении *Web.config* файл в корневой папке проекта. Добавляя новую строку подключения, вы можете указать расположение базы данных (*wingtiptoys.mdf*) должны быть простроены в каталог данных приложения (*приложения\_данных*), а не по умолчанию расположение. Это изменение позволит вам найти и проверить файл базы данных далее в этом руководстве.

1. В **обозревателе решений**найдите и откройте *Web.config* файл.
2. Добавьте строку подключения, выделены желтым цветом, позволяя `<connectionStrings>` раздел *Web.config* файл следующим образом:  

    [!code-xml[Main](create_the_data_access_layer/samples/sample6.xml?highlight=4-7)]

При первом запуске приложения, сборка будет базы данных в расположении, указанном в строке подключения. Но прежде чем запускать приложение, давайте сначала скомпилировать его.

## <a name="building-the-application"></a>Построение приложения

Чтобы убедиться в том, что все классы и изменения в веб-приложение работает, следует построить приложение.

1. Из **Отладка** меню, выберите **построения WingtipToys**.  
 **Вывода** отображается окно, и если все прошло успешно, вы увидите *успешно* сообщения.  

    ![Создание уровня доступа к данным - вывод Windows](create_the_data_access_layer/_static/image4.png)

При возникновении ошибки, еще раз проверьте описанные выше действия. Сведения в **вывода** окно сообщит, какой файл возникли проблемы и где необходима изменения в файле. Эта информация позволит вам определить, какая часть описанные выше действия для просмотра и фиксированной в своем проекте.

## <a name="summary"></a>Сводка

В этом руководстве из серии вы создания модели данных, а также, дополнительный код, который будет использоваться для инициализации и заполнение базы данных. Вы также настроили приложение для работы с моделями данных при запуске приложения.

В следующем учебном курсе будет обновить пользовательский Интерфейс, добавить навигации и получения данных из базы данных. Это приведет к базе данных автоматически на основе создавать классы сущностей, которые созданы в этом руководстве.

## <a name="additional-resources"></a>Дополнительные ресурсы

[Общие сведения об Entity Framework](https://msdn.microsoft.com/library/bb399567.aspx)   
[Руководство для начинающих на платформу ADO.NET Entity Framework](https://msdn.microsoft.com/data/ee712907)   
[Код первого разработки с помощью Entity Framework](http://www.msteched.com/2010/Europe/DEV212) (видео)   
[Связи Fluent API для Code First](https://msdn.microsoft.com/data/hh134698)   
[Заметки данных Code First](https://msdn.microsoft.com/data/gg193958)  
[Улучшение функций для Entity Framework](https://blogs.msdn.com/b/efdesign/archive/2010/06/21/productivity-improvements-for-the-entity-framework.aspx?wa=wsignin1.0)

> [!div class="step-by-step"]
> [Назад](create-the-project.md)
> [Вперед](ui_and_navigation.md)
