---
uid: web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/create_the_data_access_layer
title: Создание уровня доступа к данным | Документация Майкрософт
author: Erikre
description: В этой серии руководств будет основы создания приложений веб-форм ASP.NET с помощью ASP.NET 4.5 и Microsoft Visual Studio Express 2013 для мы...
ms.author: riande
ms.date: 09/08/2014
ms.assetid: 0bbf7a6e-d7eb-4091-91e4-fff892777f32
msc.legacyurl: /web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/create_the_data_access_layer
msc.type: authoredcontent
ms.openlocfilehash: bc91eba17938de15f03ecc1e745aac57c7eac7a1
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/09/2019
ms.locfileid: "59419500"
---
# <a name="create-the-data-access-layer"></a><span data-ttu-id="baa36-103">Создание уровня доступа к данным</span><span class="sxs-lookup"><span data-stu-id="baa36-103">Create the Data Access Layer</span></span>

<span data-ttu-id="baa36-104">по [Erik Reitan](https://github.com/Erikre)</span><span class="sxs-lookup"><span data-stu-id="baa36-104">by [Erik Reitan](https://github.com/Erikre)</span></span>

<span data-ttu-id="baa36-105">[Скачайте пример проекта Wingtip Toys (C#)](http://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) или [скачайте электронную книгу (PDF)](http://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20ASP.NET%204.5%20Web%20Forms%20and%20Visual%20Studio%202013.pdf)</span><span class="sxs-lookup"><span data-stu-id="baa36-105">[Download Wingtip Toys Sample Project (C#)](http://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) or [Download E-book (PDF)](http://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20ASP.NET%204.5%20Web%20Forms%20and%20Visual%20Studio%202013.pdf)</span></span>

> <span data-ttu-id="baa36-106">В этой серии руководств будет основы создания приложений веб-форм ASP.NET с помощью ASP.NET 4.5 и Microsoft Visual Studio Express 2013 для Web.</span><span class="sxs-lookup"><span data-stu-id="baa36-106">This tutorial series will teach you the basics of building an ASP.NET Web Forms application using ASP.NET 4.5 and Microsoft Visual Studio Express 2013 for Web.</span></span> <span data-ttu-id="baa36-107">Visual Studio 2013 [проект с исходным кодом C#](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) доступен на следующей странице этой серии руководств.</span><span class="sxs-lookup"><span data-stu-id="baa36-107">A Visual Studio 2013 [project with C# source code](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) is available to accompany this tutorial series.</span></span>


<span data-ttu-id="baa36-108">Это руководство содержит инструкции для создания, доступа и просмотра данных из базы данных с помощью веб-форм ASP.NET и Entity Framework Code First.</span><span class="sxs-lookup"><span data-stu-id="baa36-108">This tutorial describes how to create, access, and review data from a database using ASP.NET Web Forms and Entity Framework Code First.</span></span> <span data-ttu-id="baa36-109">Этот учебник основан на предыдущем учебном курсе «Создать проект» и является частью серии руководств Store Toy Wingtip.</span><span class="sxs-lookup"><span data-stu-id="baa36-109">This tutorial builds on the previous tutorial "Create the Project" and is part of the Wingtip Toy Store tutorial series.</span></span> <span data-ttu-id="baa36-110">Если после завершения данного учебника, вы сможете создать группу классов доступа к данным, которые находятся в *моделей* папку проекта.</span><span class="sxs-lookup"><span data-stu-id="baa36-110">When you've completed this tutorial, you will have built a group of data-access classes that are in the *Models* folder of the project.</span></span>

## <a name="what-youll-learn"></a><span data-ttu-id="baa36-111">Вы узнаете, как:</span><span class="sxs-lookup"><span data-stu-id="baa36-111">What you'll learn:</span></span>

- <span data-ttu-id="baa36-112">Инструкции по созданию моделей данных.</span><span class="sxs-lookup"><span data-stu-id="baa36-112">How to create the data models.</span></span>
- <span data-ttu-id="baa36-113">Как инициализировать и заполнение базы данных.</span><span class="sxs-lookup"><span data-stu-id="baa36-113">How to initialize and seed the database.</span></span>
- <span data-ttu-id="baa36-114">Как обновить и настроить приложение для поддержки базы данных.</span><span class="sxs-lookup"><span data-stu-id="baa36-114">How to update and configure the application to support the database.</span></span>

### <a name="these-are-the-features-introduced-in-the-tutorial"></a><span data-ttu-id="baa36-115">Ниже приведены функции, представленные в этом руководстве.</span><span class="sxs-lookup"><span data-stu-id="baa36-115">These are the features introduced in the tutorial:</span></span>

- <span data-ttu-id="baa36-116">Платформа Entity Framework Code First</span><span class="sxs-lookup"><span data-stu-id="baa36-116">Entity Framework Code First</span></span>
- <span data-ttu-id="baa36-117">LocalDB</span><span class="sxs-lookup"><span data-stu-id="baa36-117">LocalDB</span></span>
- <span data-ttu-id="baa36-118">Заметки к данным</span><span class="sxs-lookup"><span data-stu-id="baa36-118">Data Annotations</span></span>

## <a name="creating-the-data-models"></a><span data-ttu-id="baa36-119">Создание моделей данных</span><span class="sxs-lookup"><span data-stu-id="baa36-119">Creating the Data Models</span></span>

<span data-ttu-id="baa36-120">[Платформа Entity Framework](https://msdn.microsoft.com/data/aa937723) — это платформа объектно реляционного сопоставления (ORM).</span><span class="sxs-lookup"><span data-stu-id="baa36-120">[Entity Framework](https://msdn.microsoft.com/data/aa937723) is an object-relational mapping (ORM) framework.</span></span> <span data-ttu-id="baa36-121">Он позволяет работать с реляционными данными как с объектами, устраняя большую часть кода доступа к данным, обычно необходимо для записи.</span><span class="sxs-lookup"><span data-stu-id="baa36-121">It lets you work with relational data as objects, eliminating most of the data-access code that you'd usually need to write.</span></span> <span data-ttu-id="baa36-122">С помощью Entity Framework, можно выполнять запросы с помощью [LINQ](https://msdn.microsoft.com/library/bb397926.aspx), затем извлечь и обработать данные в виде строго типизированных объектов.</span><span class="sxs-lookup"><span data-stu-id="baa36-122">Using Entity Framework, you can issue queries using [LINQ](https://msdn.microsoft.com/library/bb397926.aspx), then retrieve and manipulate data as strongly typed objects.</span></span> <span data-ttu-id="baa36-123">LINQ предоставляет шаблоны для запроса и обновления данных.</span><span class="sxs-lookup"><span data-stu-id="baa36-123">LINQ provides patterns for querying and updating data.</span></span> <span data-ttu-id="baa36-124">С помощью Entity Framework позволяет сосредоточиться на создании остальной части приложения, а не посвященный основы доступа к данным.</span><span class="sxs-lookup"><span data-stu-id="baa36-124">Using Entity Framework allows you to focus on creating the rest of your application, rather than focusing on the data access fundamentals.</span></span> <span data-ttu-id="baa36-125">Далее в этой серии руководств мы покажем, как использовать данные для заполнения запросов навигации и продукта.</span><span class="sxs-lookup"><span data-stu-id="baa36-125">Later in this tutorial series, we'll show you how to use the data to populate navigation and product queries.</span></span>

<span data-ttu-id="baa36-126">Платформа Entity Framework поддерживает парадигму разработки, в вызове *Code First*.</span><span class="sxs-lookup"><span data-stu-id="baa36-126">Entity Framework supports a development paradigm called *Code First*.</span></span> <span data-ttu-id="baa36-127">Код сначала позволяет определять модели данных с помощью классов.</span><span class="sxs-lookup"><span data-stu-id="baa36-127">Code First lets you define your data models using classes.</span></span> <span data-ttu-id="baa36-128">Класс — это конструкция, которая позволяет создавать собственные настраиваемые типы путем группирования переменных других типов, методов и событий.</span><span class="sxs-lookup"><span data-stu-id="baa36-128">A class is a construct that enables you to create your own custom types by grouping together variables of other types, methods and events.</span></span> <span data-ttu-id="baa36-129">Можно сопоставить классы для существующей базы данных или использовать их для создания базы данных.</span><span class="sxs-lookup"><span data-stu-id="baa36-129">You can map classes to an existing database or use them to generate a database.</span></span> <span data-ttu-id="baa36-130">В этом руководстве вы создадите моделей данных, написав классы модели данных.</span><span class="sxs-lookup"><span data-stu-id="baa36-130">In this tutorial, you'll create the data models by writing data model classes.</span></span> <span data-ttu-id="baa36-131">Затем вы разрешаете Entity Framework создавать базы данных на лету от этих новых классов.</span><span class="sxs-lookup"><span data-stu-id="baa36-131">Then, you'll let Entity Framework create the database on the fly from these new classes.</span></span>

<span data-ttu-id="baa36-132">Сначала путем создания классов сущностей, которые определяют модели данных для приложения веб-форм.</span><span class="sxs-lookup"><span data-stu-id="baa36-132">You will begin by creating the entity classes that define the data models for the Web Forms application.</span></span> <span data-ttu-id="baa36-133">Затем вы создадите класс контекста, который управляет классы сущностей и предоставляет доступ к данным к базе данных.</span><span class="sxs-lookup"><span data-stu-id="baa36-133">Then you will create a context class that manages the entity classes and provides data access to the database.</span></span> <span data-ttu-id="baa36-134">Вы также создадите инициализатор класса, который будет использоваться для заполнения базы данных.</span><span class="sxs-lookup"><span data-stu-id="baa36-134">You will also create an initializer class that you will use to populate the database.</span></span>

### <a name="entity-framework-and-references"></a><span data-ttu-id="baa36-135">Entity Framework и ссылки</span><span class="sxs-lookup"><span data-stu-id="baa36-135">Entity Framework and References</span></span>

<span data-ttu-id="baa36-136">По умолчанию Entity Framework включается при создании нового **веб-приложение ASP.NET** с помощью **веб-форм** шаблона.</span><span class="sxs-lookup"><span data-stu-id="baa36-136">By default, Entity Framework is included when you create a new **ASP.NET Web Application** using the **Web Forms** template.</span></span> <span data-ttu-id="baa36-137">Entity Framework можно установлен, удаления и обновления в виде пакета NuGet.</span><span class="sxs-lookup"><span data-stu-id="baa36-137">Entity Framework can be installed, uninstalled, and updated as a NuGet package.</span></span>

<span data-ttu-id="baa36-138">Этот пакет NuGet входят следующие **среды выполнения** сборки в проекте:</span><span class="sxs-lookup"><span data-stu-id="baa36-138">This NuGet package includes the following **runtime** assemblies within your project:</span></span>

- <span data-ttu-id="baa36-139">EntityFramework.dll — все распространенные код среды выполнения, используемый платформой Entity Framework</span><span class="sxs-lookup"><span data-stu-id="baa36-139">EntityFramework.dll – All the common runtime code used by Entity Framework</span></span>
- <span data-ttu-id="baa36-140">EntityFramework.SqlServer.dll — поставщик Microsoft SQL Server для Entity Framework</span><span class="sxs-lookup"><span data-stu-id="baa36-140">EntityFramework.SqlServer.dll – The Microsoft SQL Server provider for Entity Framework</span></span>

### <a name="entity-classes"></a><span data-ttu-id="baa36-141">Классы сущностей</span><span class="sxs-lookup"><span data-stu-id="baa36-141">Entity Classes</span></span>

<span data-ttu-id="baa36-142">Классы, создаваемые для определения схемы данных, называются классами сущностей.</span><span class="sxs-lookup"><span data-stu-id="baa36-142">The classes you create to define the schema of the data are called entity classes.</span></span> <span data-ttu-id="baa36-143">Если вы не знакомы с проектированием баз данных, считать классы сущностей определения таблиц базы данных.</span><span class="sxs-lookup"><span data-stu-id="baa36-143">If you're new to database design, think of the entity classes as table definitions of a database.</span></span> <span data-ttu-id="baa36-144">Каждое свойство в классе определяет столбец в таблице базы данных.</span><span class="sxs-lookup"><span data-stu-id="baa36-144">Each property in the class specifies a column in the table of the database.</span></span> <span data-ttu-id="baa36-145">Эти классы предоставляют упрощенный, объектно реляционного интерфейс между кодом, объектно ориентированного и структура таблицы реляционной базы данных.</span><span class="sxs-lookup"><span data-stu-id="baa36-145">These classes provide a lightweight, object-relational interface between object-oriented code and the relational table structure of the database.</span></span>

<span data-ttu-id="baa36-146">В этом руководстве начните с добавления простого объекта классов, представляющих схемы для категорий и продуктов.</span><span class="sxs-lookup"><span data-stu-id="baa36-146">In this tutorial, you'll start out by adding simple entity classes representing the schemas for products and categories.</span></span> <span data-ttu-id="baa36-147">Класс продуктов будет содержать определения для каждого продукта.</span><span class="sxs-lookup"><span data-stu-id="baa36-147">The products class will contain definitions for each product.</span></span> <span data-ttu-id="baa36-148">Каждый из членов класса product будет называться `ProductID`, `ProductName`, `Description`, `ImagePath`, `UnitPrice`, `CategoryID`, и `Category`.</span><span class="sxs-lookup"><span data-stu-id="baa36-148">The name of each of the members of the product class will be `ProductID`, `ProductName`, `Description`, `ImagePath`, `UnitPrice`, `CategoryID`, and `Category`.</span></span> <span data-ttu-id="baa36-149">Класс категории будет содержать определения для каждой категории, продукт может принадлежать к, таких как автомобиль, яхту или плоскости.</span><span class="sxs-lookup"><span data-stu-id="baa36-149">The category class will contain definitions for each category that a product can belong to, such as Car, Boat, or Plane.</span></span> <span data-ttu-id="baa36-150">Имя каждого из членов класса категории будет `CategoryID`, `CategoryName`, `Description`, и `Products`.</span><span class="sxs-lookup"><span data-stu-id="baa36-150">The name of each of the members of the category class will be `CategoryID`, `CategoryName`, `Description`, and `Products`.</span></span> <span data-ttu-id="baa36-151">Каждый продукт будет принадлежать к одной из категорий.</span><span class="sxs-lookup"><span data-stu-id="baa36-151">Each product will belong to one of the categories.</span></span> <span data-ttu-id="baa36-152">Эти классы сущностей, которые будут добавляться к существующим проекта *моделей* папки.</span><span class="sxs-lookup"><span data-stu-id="baa36-152">These entity classes will be added to the project's existing *Models* folder.</span></span>

1. <span data-ttu-id="baa36-153">В **обозревателе решений**, щелкните правой кнопкой мыши *моделей* папку, а затем выберите **добавить**  - &gt; **новый элемент**.</span><span class="sxs-lookup"><span data-stu-id="baa36-153">In **Solution Explorer**, right-click the *Models* folder and then select **Add** -&gt; **New Item**.</span></span> 

    ![Создание уровня доступа к данным — новый элемент меню](create_the_data_access_layer/_static/image1.png)

   <span data-ttu-id="baa36-155">Откроется диалоговое окно **Добавление нового элемента**.</span><span class="sxs-lookup"><span data-stu-id="baa36-155">The **Add New Item** dialog box is displayed.</span></span>
2. <span data-ttu-id="baa36-156">В разделе **Visual C#** из **установленные** панели слева, выберите **кода**.</span><span class="sxs-lookup"><span data-stu-id="baa36-156">Under **Visual C#** from the **Installed** pane on the left, select **Code**.</span></span> 

    ![Создание уровня доступа к данным — новый элемент меню](create_the_data_access_layer/_static/image2.png)
3. <span data-ttu-id="baa36-158">Выберите **класс** в средней области и назовите этот новый класс *Product.cs*.</span><span class="sxs-lookup"><span data-stu-id="baa36-158">Select **Class** from the middle pane and name this new class *Product.cs*.</span></span>
4. <span data-ttu-id="baa36-159">Нажмите кнопку **Добавить**.</span><span class="sxs-lookup"><span data-stu-id="baa36-159">Click **Add**.</span></span>  
   <span data-ttu-id="baa36-160">Новый файл класса отображается в редакторе.</span><span class="sxs-lookup"><span data-stu-id="baa36-160">The new class file is displayed in the editor.</span></span>
5. <span data-ttu-id="baa36-161">Замените код по умолчанию следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="baa36-161">Replace the default code with the following code:</span></span>   

    [!code-csharp[Main](create_the_data_access_layer/samples/sample1.cs)]
6. <span data-ttu-id="baa36-162">Создайте еще один класс, повторив шаги 1 – 4, тем не менее, назовите новый класс *Category.cs* и замените код по умолчанию следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="baa36-162">Create another class by repeating steps 1 through 4, however, name the new class *Category.cs* and replace the default code with the following code:</span></span>  

    [!code-csharp[Main](create_the_data_access_layer/samples/sample2.cs)]

<span data-ttu-id="baa36-163">Как упоминалось ранее, `Category` класс представляет тип продукта, в которой оно будет предназначен для продажи (такие как <a id="a"> </a> &quot;автомобили&quot;, &quot;лодок&quot;, &quot;Rockets&quot;, и так далее) и `Product` класс представляет отдельные продукты (toys) в базе данных.</span><span class="sxs-lookup"><span data-stu-id="baa36-163">As previously mentioned, the `Category` class represents the type of product that the application is designed to sell (such as <a id="a"></a>&quot;Cars&quot;, &quot;Boats&quot;, &quot;Rockets&quot;, and so on), and the `Product` class represents the individual products (toys) in the database.</span></span> <span data-ttu-id="baa36-164">Каждый экземпляр `Product` объект будет соответствовать ряду в таблице реляционной базы данных, а каждое свойство класса продуктов будет сопоставить со столбцом в таблице реляционной базы данных.</span><span class="sxs-lookup"><span data-stu-id="baa36-164">Each instance of a `Product` object will correspond to a row within a relational database table, and each property of the Product class will map to a column in the relational database table.</span></span> <span data-ttu-id="baa36-165">Далее в этом учебнике вы изучите данные продуктов, содержащихся в базе данных.</span><span class="sxs-lookup"><span data-stu-id="baa36-165">Later in this tutorial, you'll review the product data contained in the database.</span></span>

### <a name="data-annotations"></a><span data-ttu-id="baa36-166">Заметки к данным</span><span class="sxs-lookup"><span data-stu-id="baa36-166">Data Annotations</span></span>

<span data-ttu-id="baa36-167">Вы заметите, что определенные члены классов имеют атрибуты, указав сведения об элементе, например `[ScaffoldColumn(false)]`.</span><span class="sxs-lookup"><span data-stu-id="baa36-167">You may have noticed that certain members of the classes have attributes specifying details about the member, such as `[ScaffoldColumn(false)]`.</span></span> <span data-ttu-id="baa36-168">Это *заметок к данным*.</span><span class="sxs-lookup"><span data-stu-id="baa36-168">These are *data annotations*.</span></span> <span data-ttu-id="baa36-169">Атрибуты примечаний к данным можно описать как проверки пользовательского ввода для этого элемента, чтобы задать формат для него, а также указать, каким образом оно моделируется при создании базы данных.</span><span class="sxs-lookup"><span data-stu-id="baa36-169">The data annotation attributes can describe how to validate user input for that member, to specify formatting for it, and to specify how it is modeled when the database is created.</span></span>

### <a name="context-class"></a><span data-ttu-id="baa36-170">Класс Context</span><span class="sxs-lookup"><span data-stu-id="baa36-170">Context Class</span></span>

<span data-ttu-id="baa36-171">Чтобы начать использовать классы для доступа к данным, необходимо определить класс контекста.</span><span class="sxs-lookup"><span data-stu-id="baa36-171">To start using the classes for data access, you must define a context class.</span></span> <span data-ttu-id="baa36-172">Как упоминалось ранее, этот класс контекста управляет классы сущностей (такие как `Product` класс и `Category` класс) и предоставляет доступ к данным к базе данных.</span><span class="sxs-lookup"><span data-stu-id="baa36-172">As mentioned previously, the context class manages the entity classes (such as the `Product` class and the `Category` class) and provides data access to the database.</span></span>

<span data-ttu-id="baa36-173">Эта процедура добавляет новый класс C# контекст для *моделей* папки.</span><span class="sxs-lookup"><span data-stu-id="baa36-173">This procedure adds a new C# context class to the *Models* folder.</span></span>

1. <span data-ttu-id="baa36-174">Щелкните правой кнопкой мыши *моделей* папку, а затем выберите **добавить**  - &gt; **новый элемент**.</span><span class="sxs-lookup"><span data-stu-id="baa36-174">Right-click the *Models* folder and then select **Add** -&gt; **New Item**.</span></span>   
   <span data-ttu-id="baa36-175">Откроется диалоговое окно **Добавление нового элемента**.</span><span class="sxs-lookup"><span data-stu-id="baa36-175">The **Add New Item** dialog box is displayed.</span></span>
2. <span data-ttu-id="baa36-176">Выберите **класс** в средней области, назовите его *ProductContext.cs* и нажмите кнопку **добавить**.</span><span class="sxs-lookup"><span data-stu-id="baa36-176">Select **Class** from the middle pane, name it *ProductContext.cs* and click **Add**.</span></span>
3. <span data-ttu-id="baa36-177">Замените код по умолчанию, содержащиеся в классе следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="baa36-177">Replace the default code contained in the class with the following code:</span></span>   

    [!code-csharp[Main](create_the_data_access_layer/samples/sample3.cs)]

<span data-ttu-id="baa36-178">Этот код добавляет `System.Data.Entity` пространства имен таким образом, чтобы у вас есть доступ ко всем функциям core, Entity Framework, которая включает возможность запроса, вставки, обновления и удаления данных, работая с строго типизированных объектов.</span><span class="sxs-lookup"><span data-stu-id="baa36-178">This code adds the `System.Data.Entity` namespace so that you have access to all the core functionality of Entity Framework, which includes the capability to query, insert, update, and delete data by working with strongly typed objects.</span></span>

<span data-ttu-id="baa36-179">`ProductContext` Класс представляет контекст базы данных Entity Framework продукта, который обрабатывает получение, хранения и обновления `Product` экземпляров в базе данных класса.</span><span class="sxs-lookup"><span data-stu-id="baa36-179">The `ProductContext` class represents Entity Framework product database context, which handles fetching, storing, and updating `Product` class instances in the database.</span></span> <span data-ttu-id="baa36-180">`ProductContext` Класс является производным от `DbContext` базового класса, предоставляемых платформой Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="baa36-180">The `ProductContext` class derives from the `DbContext` base class provided by Entity Framework.</span></span>

### <a name="initializer-class"></a><span data-ttu-id="baa36-181">Инициализатор класса</span><span class="sxs-lookup"><span data-stu-id="baa36-181">Initializer Class</span></span>

<span data-ttu-id="baa36-182">Необходимо будет выполнить определенную настраиваемую логику для инициализации базы данных при первом использовании контекст.</span><span class="sxs-lookup"><span data-stu-id="baa36-182">You will need to run some custom logic to initialize the database the first time the context is used.</span></span> <span data-ttu-id="baa36-183">Это позволит заполнить данными добавляются в базу данных, таким образом, чтобы сразу же можно отобразить продукты и категории.</span><span class="sxs-lookup"><span data-stu-id="baa36-183">This will allow seed data to be added to the database so that you can immediately display products and categories.</span></span>

<span data-ttu-id="baa36-184">Эта процедура добавляет новый класс C# инициализатор для *моделей* папки.</span><span class="sxs-lookup"><span data-stu-id="baa36-184">This procedure adds a new C# initializer class to the *Models* folder.</span></span>

1. <span data-ttu-id="baa36-185">Создайте другой `Class` в *моделей* папки и назовите его *ProductDatabaseInitializer.cs*.</span><span class="sxs-lookup"><span data-stu-id="baa36-185">Create another `Class` in the *Models* folder and name it *ProductDatabaseInitializer.cs*.</span></span>
2. <span data-ttu-id="baa36-186">Замените код по умолчанию, содержащиеся в классе следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="baa36-186">Replace the default code contained in the class with the following code:</span></span>   

    [!code-csharp[Main](create_the_data_access_layer/samples/sample4.cs)]

<span data-ttu-id="baa36-187">Как показано в приведенном выше коде при базе данных создается и инициализируется, `Seed` свойство переопределено и задано.</span><span class="sxs-lookup"><span data-stu-id="baa36-187">As you can see from the above code, when the database is created and initialized, the `Seed` property is overridden and set.</span></span> <span data-ttu-id="baa36-188">Когда `Seed` имеет значение свойства, значения из категорий и продуктов используются для заполнения базы данных.</span><span class="sxs-lookup"><span data-stu-id="baa36-188">When the `Seed` property is set, the values from the categories and products are used to populate the database.</span></span> <span data-ttu-id="baa36-189">Если вы попытаетесь обновить начальные данные, изменив приведенный выше код, после создания базы данных, вы не увидите обновлений при запуске веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="baa36-189">If you attempt to update the seed data by modifying the above code after the database has been created, you won't see any updates when you run the Web application.</span></span> <span data-ttu-id="baa36-190">Причина заключается в приведенный выше код использует реализацию `DropCreateDatabaseIfModelChanges` класс для распознавания, изменилась ли модель (схему), перед сбросом начальные данные.</span><span class="sxs-lookup"><span data-stu-id="baa36-190">The reason is the above code uses an implementation of the `DropCreateDatabaseIfModelChanges` class to recognize if the model (schema) has changed before resetting the seed data.</span></span> <span data-ttu-id="baa36-191">Если изменения не вносятся в `Category` и `Product` классы сущностей, базы данных будет не будут повторно инициализированы с помощью начальные данные.</span><span class="sxs-lookup"><span data-stu-id="baa36-191">If no changes are made to the `Category` and `Product` entity classes, the database will not be reinitialized with the seed data.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="baa36-192">При желании базе, чтобы создать заново при каждом запуске приложения, вы можете использовать `DropCreateDatabaseAlways` вместо класса `DropCreateDatabaseIfModelChanges` класса.</span><span class="sxs-lookup"><span data-stu-id="baa36-192">If you wanted the database to be recreated every time you ran the application, you could use the `DropCreateDatabaseAlways` class instead of the `DropCreateDatabaseIfModelChanges` class.</span></span> <span data-ttu-id="baa36-193">Тем не менее для этой серии руководств, используйте `DropCreateDatabaseIfModelChanges` класса.</span><span class="sxs-lookup"><span data-stu-id="baa36-193">However for this tutorial series, use the `DropCreateDatabaseIfModelChanges` class.</span></span>


<span data-ttu-id="baa36-194">На этом этапе в этом руководстве будет иметь *моделей* папки с помощью четырех новых классов и класса одно значение по умолчанию:</span><span class="sxs-lookup"><span data-stu-id="baa36-194">At this point in this tutorial, you will have a *Models* folder with four new classes and one default class:</span></span>

![Создание уровня доступа к данным — папку Models](create_the_data_access_layer/_static/image3.png)

### <a name="configuring-the-application-to-use-the-data-model"></a><span data-ttu-id="baa36-196">Настройка приложения для использования модели данных</span><span class="sxs-lookup"><span data-stu-id="baa36-196">Configuring the Application to Use the Data Model</span></span>

<span data-ttu-id="baa36-197">Теперь, когда вы создали классы, представляющие данные, необходимо настроить приложение для использования классов.</span><span class="sxs-lookup"><span data-stu-id="baa36-197">Now that you've created the classes that represent the data, you must configure the application to use the classes.</span></span> <span data-ttu-id="baa36-198">В *Global.asax* файл, добавьте код, который инициализирует модель.</span><span class="sxs-lookup"><span data-stu-id="baa36-198">In the *Global.asax* file, you add code that initializes the model.</span></span> <span data-ttu-id="baa36-199">В *Web.config* файл, добавьте информацию, которая сообщает приложению о том, что база данных будет использоваться для хранения данных, представленного новые классы данных.</span><span class="sxs-lookup"><span data-stu-id="baa36-199">In the *Web.config* file you add information that tells the application what database you'll use to store the data that's represented by the new data classes.</span></span> <span data-ttu-id="baa36-200">*Global.asax* файл может использоваться для обработки событий или методов приложения.</span><span class="sxs-lookup"><span data-stu-id="baa36-200">The *Global.asax* file can be used to handle application events or methods.</span></span> <span data-ttu-id="baa36-201">*Web.config* файл позволяет управлять конфигурацией веб-приложения ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="baa36-201">The *Web.config* file allows you to control the configuration of your ASP.NET web application.</span></span>

#### <a name="updating-the-globalasax-file"></a><span data-ttu-id="baa36-202">Обновление файла Global.asax</span><span class="sxs-lookup"><span data-stu-id="baa36-202">Updating the Global.asax file</span></span>

<span data-ttu-id="baa36-203">Чтобы инициализировать моделей данных, при запуске приложения, мы обновим `Application_Start` обработчик в *Global.asax.cs* файл.</span><span class="sxs-lookup"><span data-stu-id="baa36-203">To initialize the data models when the application starts, you will update the `Application_Start` handler in the *Global.asax.cs* file.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="baa36-204">В обозревателе решений, можно выбрать либо *Global.asax* файл или *Global.asax.cs* файл для изменения *Global.asax.cs* файл.</span><span class="sxs-lookup"><span data-stu-id="baa36-204">In Solution Explorer, you can select either the *Global.asax* file or the *Global.asax.cs* file to edit the *Global.asax.cs* file.</span></span>


1. <span data-ttu-id="baa36-205">Добавьте следующий код, они выделены желтым цветом, чтобы `Application_Start` метод в *Global.asax.cs* файл.</span><span class="sxs-lookup"><span data-stu-id="baa36-205">Add the following code highlighted in yellow to the `Application_Start` method in the *Global.asax.cs* file.</span></span>   

    [!code-csharp[Main](create_the_data_access_layer/samples/sample5.cs?highlight=9-10,22-23)]

> [!NOTE] 
> 
> <span data-ttu-id="baa36-206">В браузере должен поддерживать HTML5 для просмотра кода выделены желтым цветом при просмотре этой серии руководств в браузере.</span><span class="sxs-lookup"><span data-stu-id="baa36-206">Your browser must support HTML5 to view the code highlighted in yellow when viewing this tutorial series in a browser.</span></span>


<span data-ttu-id="baa36-207">Как показано в приведенном выше коде, при запуске приложения, приложения указывает, что осуществляется инициализатора, который будет выполняться при первом данные.</span><span class="sxs-lookup"><span data-stu-id="baa36-207">As shown in the above code, when the application starts, the application specifies the initializer that will run during the first time the data is accessed.</span></span> <span data-ttu-id="baa36-208">Две дополнительные пространства имен являются обязательными для доступа к `Database` объекта и `ProductDatabaseInitializer` объекта.</span><span class="sxs-lookup"><span data-stu-id="baa36-208">The two additional namespaces are required to access the `Database` object and the `ProductDatabaseInitializer` object.</span></span>

 <span data-ttu-id="baa36-209">Изменение файла Web.Config</span><span class="sxs-lookup"><span data-stu-id="baa36-209">Modifying the Web.Config File</span></span> 

<span data-ttu-id="baa36-210">Несмотря на то, что Entity Framework Code First создаст базу данных для вас в расположении по умолчанию при заполнении базы данных с начального значения данных, добавление в приложение данные подключения позволяет выбрать расположение базы данных.</span><span class="sxs-lookup"><span data-stu-id="baa36-210">Although Entity Framework Code First will generate a database for you in a default location when the database is populated with seed data, adding your own connection information to your application gives you control of the database location.</span></span> <span data-ttu-id="baa36-211">Укажите это подключение базы данных, используя строку подключения в приложении *Web.config* файл в корневой папке проекта.</span><span class="sxs-lookup"><span data-stu-id="baa36-211">You specify this database connection using a connection string in the application's *Web.config* file at the root of the project.</span></span> <span data-ttu-id="baa36-212">Добавляя новую строку подключения, вы можете указать расположение базы данных (*wingtiptoys.mdf*) должны быть простроены в каталог данных приложения (*приложения\_данных*), а не по умолчанию расположение.</span><span class="sxs-lookup"><span data-stu-id="baa36-212">By adding a new connection string, you can direct the location of the database (*wingtiptoys.mdf*) to be built in the application's data directory (*App\_Data*), rather than its default location.</span></span> <span data-ttu-id="baa36-213">Это изменение позволит вам найти и проверить файл базы данных далее в этом руководстве.</span><span class="sxs-lookup"><span data-stu-id="baa36-213">Making this change will allow you to find and inspect the database file later in this tutorial.</span></span>

1. <span data-ttu-id="baa36-214">В **обозревателе решений**найдите и откройте *Web.config* файл.</span><span class="sxs-lookup"><span data-stu-id="baa36-214">In **Solution Explorer**, find and open the *Web.config* file.</span></span>
2. <span data-ttu-id="baa36-215">Добавьте строку подключения, выделены желтым цветом, позволяя `<connectionStrings>` раздел *Web.config* файл следующим образом:</span><span class="sxs-lookup"><span data-stu-id="baa36-215">Add the connection string highlighted in yellow to the `<connectionStrings>` section of the *Web.config* file as follows:</span></span>  

    [!code-xml[Main](create_the_data_access_layer/samples/sample6.xml?highlight=4-7)]

<span data-ttu-id="baa36-216">При первом запуске приложения, сборка будет базы данных в расположении, указанном в строке подключения.</span><span class="sxs-lookup"><span data-stu-id="baa36-216">When the application is run for the first time, it will build the database at the location specified by the connection string.</span></span> <span data-ttu-id="baa36-217">Но прежде чем запускать приложение, давайте сначала скомпилировать его.</span><span class="sxs-lookup"><span data-stu-id="baa36-217">But before running the application, let's build it first.</span></span>

## <a name="building-the-application"></a><span data-ttu-id="baa36-218">Построение приложения</span><span class="sxs-lookup"><span data-stu-id="baa36-218">Building the Application</span></span>

<span data-ttu-id="baa36-219">Чтобы убедиться в том, что все классы и изменения в веб-приложение работает, следует построить приложение.</span><span class="sxs-lookup"><span data-stu-id="baa36-219">To make sure that all the classes and changes to your Web application work, you should build the application.</span></span>

1. <span data-ttu-id="baa36-220">Из **Отладка** меню, выберите **построения WingtipToys**.</span><span class="sxs-lookup"><span data-stu-id="baa36-220">From the **Debug** menu, select **Build WingtipToys**.</span></span>  
 <span data-ttu-id="baa36-221">**Вывода** отображается окно, и если все прошло успешно, вы увидите *успешно* сообщения.</span><span class="sxs-lookup"><span data-stu-id="baa36-221">The **Output** window is displayed, and if all went well, you see a *succeeded* message.</span></span>  

    ![Создание уровня доступа к данным - вывод Windows](create_the_data_access_layer/_static/image4.png)

<span data-ttu-id="baa36-223">При возникновении ошибки, еще раз проверьте описанные выше действия.</span><span class="sxs-lookup"><span data-stu-id="baa36-223">If you run into an error, re-check the above steps.</span></span> <span data-ttu-id="baa36-224">Сведения в **вывода** окно сообщит, какой файл возникли проблемы и где необходима изменения в файле.</span><span class="sxs-lookup"><span data-stu-id="baa36-224">The information in the **Output** window will indicate which file has a problem and where in the file a change is required.</span></span> <span data-ttu-id="baa36-225">Эта информация позволит вам определить, какая часть описанные выше действия для просмотра и фиксированной в своем проекте.</span><span class="sxs-lookup"><span data-stu-id="baa36-225">This information will enable you to determine what part of the above steps need to be reviewed and fixed in your project.</span></span>

## <a name="summary"></a><span data-ttu-id="baa36-226">Сводка</span><span class="sxs-lookup"><span data-stu-id="baa36-226">Summary</span></span>

<span data-ttu-id="baa36-227">В этом руководстве из серии вы создания модели данных, а также, дополнительный код, который будет использоваться для инициализации и заполнение базы данных.</span><span class="sxs-lookup"><span data-stu-id="baa36-227">In this tutorial of the series you have created the data model, as well as, added the code that will be used to initialize and seed the database.</span></span> <span data-ttu-id="baa36-228">Вы также настроили приложение для работы с моделями данных при запуске приложения.</span><span class="sxs-lookup"><span data-stu-id="baa36-228">You have also configured the application to use the data models when the application is run.</span></span>

<span data-ttu-id="baa36-229">В следующем учебном курсе будет обновить пользовательский Интерфейс, добавить навигации и получения данных из базы данных.</span><span class="sxs-lookup"><span data-stu-id="baa36-229">In the next tutorial, you'll update the UI, add navigation, and retrieve data from the database.</span></span> <span data-ttu-id="baa36-230">Это приведет к базе данных автоматически на основе создавать классы сущностей, которые созданы в этом руководстве.</span><span class="sxs-lookup"><span data-stu-id="baa36-230">This will result in the database being automatically created based on the entity classes that you created in this tutorial.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="baa36-231">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="baa36-231">Additional Resources</span></span>

[<span data-ttu-id="baa36-232">Общие сведения об Entity Framework</span><span class="sxs-lookup"><span data-stu-id="baa36-232">Entity Framework Overview</span></span>](https://msdn.microsoft.com/library/bb399567.aspx)   
[<span data-ttu-id="baa36-233">Руководство для начинающих на платформу ADO.NET Entity Framework</span><span class="sxs-lookup"><span data-stu-id="baa36-233">Beginner's Guide to the ADO.NET Entity Framework</span></span>](https://msdn.microsoft.com/data/ee712907)   
<span data-ttu-id="baa36-234">[Код первого разработки с помощью Entity Framework](http://www.msteched.com/2010/Europe/DEV212) (видео)</span><span class="sxs-lookup"><span data-stu-id="baa36-234">[Code First Development with Entity Framework](http://www.msteched.com/2010/Europe/DEV212) (video)</span></span>   
[<span data-ttu-id="baa36-235">Связи Fluent API для Code First</span><span class="sxs-lookup"><span data-stu-id="baa36-235">Code First Relationships Fluent API</span></span>](https://msdn.microsoft.com/data/hh134698)   
[<span data-ttu-id="baa36-236">Заметки данных Code First</span><span class="sxs-lookup"><span data-stu-id="baa36-236">Code First Data Annotations</span></span>](https://msdn.microsoft.com/data/gg193958)  
[<span data-ttu-id="baa36-237">Улучшение функций для Entity Framework</span><span class="sxs-lookup"><span data-stu-id="baa36-237">Productivity Improvements for the Entity Framework</span></span>](https://blogs.msdn.com/b/efdesign/archive/2010/06/21/productivity-improvements-for-the-entity-framework.aspx?wa=wsignin1.0)

> [!div class="step-by-step"]
> <span data-ttu-id="baa36-238">[Назад](create-the-project.md)
> [Вперед](ui_and_navigation.md)</span><span class="sxs-lookup"><span data-stu-id="baa36-238">[Previous](create-the-project.md)
[Next](ui_and_navigation.md)</span></span>
