---
uid: web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/create_the_data_access_layer
title: Создание уровня доступа к данным | Документация Майкрософт
author: Erikre
description: В этой серии руководств вы узнаете об основах создания приложения ASP.NET Web Forms с помощью ASP.NET 4,5 и Microsoft Visual Studio Express 2013...
ms.author: riande
ms.date: 09/08/2014
ms.assetid: 0bbf7a6e-d7eb-4091-91e4-fff892777f32
msc.legacyurl: /web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/create_the_data_access_layer
msc.type: authoredcontent
ms.openlocfilehash: 0fcf050474a57be9ed53ec0783a6d6b7dde2bf4c
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/28/2019
ms.locfileid: "74575752"
---
# <a name="create-the-data-access-layer"></a><span data-ttu-id="642c9-103">Создание уровня доступа к данным</span><span class="sxs-lookup"><span data-stu-id="642c9-103">Create the Data Access Layer</span></span>

<span data-ttu-id="642c9-104">по [Эрик Реитан](https://github.com/Erikre)</span><span class="sxs-lookup"><span data-stu-id="642c9-104">by [Erik Reitan](https://github.com/Erikre)</span></span>

<span data-ttu-id="642c9-105">[Скачайте образец проекта Wingtip Toys (C#)](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) или [Загрузите электронную книгу (PDF)](https://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20ASP.NET%204.5%20Web%20Forms%20and%20Visual%20Studio%202013.pdf)</span><span class="sxs-lookup"><span data-stu-id="642c9-105">[Download Wingtip Toys Sample Project (C#)](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) or [Download E-book (PDF)](https://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20ASP.NET%204.5%20Web%20Forms%20and%20Visual%20Studio%202013.pdf)</span></span>

> <span data-ttu-id="642c9-106">В этой серии руководств вы узнаете об основах создания приложения ASP.NET Web Forms с помощью ASP.NET 4,5 и Microsoft Visual Studio Express 2013 для Web.</span><span class="sxs-lookup"><span data-stu-id="642c9-106">This tutorial series will teach you the basics of building an ASP.NET Web Forms application using ASP.NET 4.5 and Microsoft Visual Studio Express 2013 for Web.</span></span> <span data-ttu-id="642c9-107">Для этой серии руководств доступен [проект Visual Studio 2013 с C# исходным кодом](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) .</span><span class="sxs-lookup"><span data-stu-id="642c9-107">A Visual Studio 2013 [project with C# source code](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) is available to accompany this tutorial series.</span></span>

<span data-ttu-id="642c9-108">В этом учебнике описывается создание, доступ и проверка данных из базы данных с помощью веб-форм ASP.NET и Entity Framework Code First.</span><span class="sxs-lookup"><span data-stu-id="642c9-108">This tutorial describes how to create, access, and review data from a database using ASP.NET Web Forms and Entity Framework Code First.</span></span> <span data-ttu-id="642c9-109">Это руководство построено на предыдущем учебном курсе «создание проекта» и входит в серию руководств по магазину Wingtip Toy Store.</span><span class="sxs-lookup"><span data-stu-id="642c9-109">This tutorial builds on the previous tutorial "Create the Project" and is part of the Wingtip Toy Store tutorial series.</span></span> <span data-ttu-id="642c9-110">По завершении работы с этим руководством вы будете создавать группу классов доступа к данным, которые находятся в папке *Models* проекта.</span><span class="sxs-lookup"><span data-stu-id="642c9-110">When you've completed this tutorial, you will have built a group of data-access classes that are in the *Models* folder of the project.</span></span>

## <a name="what-youll-learn"></a><span data-ttu-id="642c9-111">Что вы узнаете:</span><span class="sxs-lookup"><span data-stu-id="642c9-111">What you'll learn:</span></span>

- <span data-ttu-id="642c9-112">Создание моделей данных.</span><span class="sxs-lookup"><span data-stu-id="642c9-112">How to create the data models.</span></span>
- <span data-ttu-id="642c9-113">Инициализация и заполнение базы данных.</span><span class="sxs-lookup"><span data-stu-id="642c9-113">How to initialize and seed the database.</span></span>
- <span data-ttu-id="642c9-114">Обновление и настройка приложения для поддержки базы данных.</span><span class="sxs-lookup"><span data-stu-id="642c9-114">How to update and configure the application to support the database.</span></span>

### <a name="these-are-the-features-introduced-in-the-tutorial"></a><span data-ttu-id="642c9-115">Ниже приведены функции, представленные в этом учебнике.</span><span class="sxs-lookup"><span data-stu-id="642c9-115">These are the features introduced in the tutorial:</span></span>

- <span data-ttu-id="642c9-116">Entity Framework Code First</span><span class="sxs-lookup"><span data-stu-id="642c9-116">Entity Framework Code First</span></span>
- <span data-ttu-id="642c9-117">LocalDB</span><span class="sxs-lookup"><span data-stu-id="642c9-117">LocalDB</span></span>
- <span data-ttu-id="642c9-118">Заметки к данным</span><span class="sxs-lookup"><span data-stu-id="642c9-118">Data Annotations</span></span>

## <a name="creating-the-data-models"></a><span data-ttu-id="642c9-119">Создание моделей данных</span><span class="sxs-lookup"><span data-stu-id="642c9-119">Creating the Data Models</span></span>

<span data-ttu-id="642c9-120">[Entity Framework](https://msdn.microsoft.com/data/aa937723) — это платформа объектно-реляционного СОПОСТАВЛЕНИЯ (ORM).</span><span class="sxs-lookup"><span data-stu-id="642c9-120">[Entity Framework](https://msdn.microsoft.com/data/aa937723) is an object-relational mapping (ORM) framework.</span></span> <span data-ttu-id="642c9-121">Он позволяет работать с реляционными данными как с объектами, устраняя большую часть кода доступа к данным, который обычно требуется написать.</span><span class="sxs-lookup"><span data-stu-id="642c9-121">It lets you work with relational data as objects, eliminating most of the data-access code that you'd usually need to write.</span></span> <span data-ttu-id="642c9-122">С помощью Entity Framework можно выдавать запросы с помощью [LINQ](https://msdn.microsoft.com/library/bb397926.aspx), а затем получать и манипулировать данными в виде строго типизированных объектов.</span><span class="sxs-lookup"><span data-stu-id="642c9-122">Using Entity Framework, you can issue queries using [LINQ](https://msdn.microsoft.com/library/bb397926.aspx), then retrieve and manipulate data as strongly typed objects.</span></span> <span data-ttu-id="642c9-123">LINQ предоставляет шаблоны для запросов и обновления данных.</span><span class="sxs-lookup"><span data-stu-id="642c9-123">LINQ provides patterns for querying and updating data.</span></span> <span data-ttu-id="642c9-124">Использование Entity Framework позволяет сосредоточиться на создании оставшейся части приложения, а не на основных понятиях доступа к данным.</span><span class="sxs-lookup"><span data-stu-id="642c9-124">Using Entity Framework allows you to focus on creating the rest of your application, rather than focusing on the data access fundamentals.</span></span> <span data-ttu-id="642c9-125">Далее в этой серии руководств мы покажем, как использовать данные для заполнения переходов и запросов продуктов.</span><span class="sxs-lookup"><span data-stu-id="642c9-125">Later in this tutorial series, we'll show you how to use the data to populate navigation and product queries.</span></span>

<span data-ttu-id="642c9-126">Entity Framework поддерживает парадигму разработки, именуемую *Code First*.</span><span class="sxs-lookup"><span data-stu-id="642c9-126">Entity Framework supports a development paradigm called *Code First*.</span></span> <span data-ttu-id="642c9-127">Code First позволяет определять модели данных с помощью классов.</span><span class="sxs-lookup"><span data-stu-id="642c9-127">Code First lets you define your data models using classes.</span></span> <span data-ttu-id="642c9-128">Класс — это конструкция, позволяющая создавать собственные пользовательские типы, объединяя переменные других типов, методов и событий.</span><span class="sxs-lookup"><span data-stu-id="642c9-128">A class is a construct that enables you to create your own custom types by grouping together variables of other types, methods and events.</span></span> <span data-ttu-id="642c9-129">Можно сопоставлять классы с существующей базой данных или использовать их для создания базы данных.</span><span class="sxs-lookup"><span data-stu-id="642c9-129">You can map classes to an existing database or use them to generate a database.</span></span> <span data-ttu-id="642c9-130">В этом руководстве вы создадите модели данных, создав классы модели данных.</span><span class="sxs-lookup"><span data-stu-id="642c9-130">In this tutorial, you'll create the data models by writing data model classes.</span></span> <span data-ttu-id="642c9-131">Затем вы разрешите Entity Framework создать базу данных на лету на основе этих новых классов.</span><span class="sxs-lookup"><span data-stu-id="642c9-131">Then, you'll let Entity Framework create the database on the fly from these new classes.</span></span>

<span data-ttu-id="642c9-132">Начнем с создания классов сущностей, определяющих модели данных для приложения веб-форм.</span><span class="sxs-lookup"><span data-stu-id="642c9-132">You will begin by creating the entity classes that define the data models for the Web Forms application.</span></span> <span data-ttu-id="642c9-133">Затем будет создан класс контекста, управляющий классами сущностей и предоставляющий доступ к базе данных.</span><span class="sxs-lookup"><span data-stu-id="642c9-133">Then you will create a context class that manages the entity classes and provides data access to the database.</span></span> <span data-ttu-id="642c9-134">Также будет создан класс инициализатора, который будет использоваться для заполнения базы данных.</span><span class="sxs-lookup"><span data-stu-id="642c9-134">You will also create an initializer class that you will use to populate the database.</span></span>

### <a name="entity-framework-and-references"></a><span data-ttu-id="642c9-135">Entity Framework и ссылки</span><span class="sxs-lookup"><span data-stu-id="642c9-135">Entity Framework and References</span></span>

<span data-ttu-id="642c9-136">По умолчанию Entity Framework включается при создании нового **веб-приложения ASP.NET** с помощью шаблона **веб-форм** .</span><span class="sxs-lookup"><span data-stu-id="642c9-136">By default, Entity Framework is included when you create a new **ASP.NET Web Application** using the **Web Forms** template.</span></span> <span data-ttu-id="642c9-137">Entity Framework можно установить, удалить и обновить как пакет NuGet.</span><span class="sxs-lookup"><span data-stu-id="642c9-137">Entity Framework can be installed, uninstalled, and updated as a NuGet package.</span></span>

<span data-ttu-id="642c9-138">Этот пакет NuGet включает в проект следующие сборки **среды выполнения** :</span><span class="sxs-lookup"><span data-stu-id="642c9-138">This NuGet package includes the following **runtime** assemblies within your project:</span></span>

- <span data-ttu-id="642c9-139">EntityFramework. dll — весь распространенный код среды выполнения, используемый Entity Framework</span><span class="sxs-lookup"><span data-stu-id="642c9-139">EntityFramework.dll – All the common runtime code used by Entity Framework</span></span>
- <span data-ttu-id="642c9-140">EntityFramework. SqlServer. dll — поставщик Microsoft SQL Server для Entity Framework</span><span class="sxs-lookup"><span data-stu-id="642c9-140">EntityFramework.SqlServer.dll – The Microsoft SQL Server provider for Entity Framework</span></span>

### <a name="entity-classes"></a><span data-ttu-id="642c9-141">Классы сущностей</span><span class="sxs-lookup"><span data-stu-id="642c9-141">Entity Classes</span></span>

<span data-ttu-id="642c9-142">Классы, создаваемые для определения схемы данных, называются классами сущностей.</span><span class="sxs-lookup"><span data-stu-id="642c9-142">The classes you create to define the schema of the data are called entity classes.</span></span> <span data-ttu-id="642c9-143">Если вы не знакомы с проектированием базы данных, подумайте о классах сущностей в качестве определений таблиц базы данных.</span><span class="sxs-lookup"><span data-stu-id="642c9-143">If you're new to database design, think of the entity classes as table definitions of a database.</span></span> <span data-ttu-id="642c9-144">Каждое свойство в классе указывает столбец в таблице базы данных.</span><span class="sxs-lookup"><span data-stu-id="642c9-144">Each property in the class specifies a column in the table of the database.</span></span> <span data-ttu-id="642c9-145">Эти классы предоставляют упрощенный объектно-реляционный интерфейс между объектно-ориентированным кодом и реляционной табличной структурой базы данных.</span><span class="sxs-lookup"><span data-stu-id="642c9-145">These classes provide a lightweight, object-relational interface between object-oriented code and the relational table structure of the database.</span></span>

<span data-ttu-id="642c9-146">В этом руководстве мы начнем с добавления простых классов сущностей, представляющих схемы для продуктов и категорий.</span><span class="sxs-lookup"><span data-stu-id="642c9-146">In this tutorial, you'll start out by adding simple entity classes representing the schemas for products and categories.</span></span> <span data-ttu-id="642c9-147">Класс Products будет содержать определения для каждого продукта.</span><span class="sxs-lookup"><span data-stu-id="642c9-147">The products class will contain definitions for each product.</span></span> <span data-ttu-id="642c9-148">Имя каждого из членов класса Product будет `ProductID`, `ProductName`, `Description`, `ImagePath`, `UnitPrice`, `CategoryID`и `Category`.</span><span class="sxs-lookup"><span data-stu-id="642c9-148">The name of each of the members of the product class will be `ProductID`, `ProductName`, `Description`, `ImagePath`, `UnitPrice`, `CategoryID`, and `Category`.</span></span> <span data-ttu-id="642c9-149">Класс category будет содержать определения для каждой категории, к которой может принадлежать продукт, например автомобиля, в форме самолета или плоскости.</span><span class="sxs-lookup"><span data-stu-id="642c9-149">The category class will contain definitions for each category that a product can belong to, such as Car, Boat, or Plane.</span></span> <span data-ttu-id="642c9-150">Имя каждого из членов класса category будет `CategoryID`, `CategoryName`, `Description`и `Products`.</span><span class="sxs-lookup"><span data-stu-id="642c9-150">The name of each of the members of the category class will be `CategoryID`, `CategoryName`, `Description`, and `Products`.</span></span> <span data-ttu-id="642c9-151">Каждый продукт будет принадлежать к одной из категорий.</span><span class="sxs-lookup"><span data-stu-id="642c9-151">Each product will belong to one of the categories.</span></span> <span data-ttu-id="642c9-152">Эти классы сущностей будут добавлены в папку существующих *моделей* проекта.</span><span class="sxs-lookup"><span data-stu-id="642c9-152">These entity classes will be added to the project's existing *Models* folder.</span></span>

1. <span data-ttu-id="642c9-153">В **Обозреватель решений**щелкните правой кнопкой мыши папку *Models* и выберите **добавить** -&gt; **новый элемент**.</span><span class="sxs-lookup"><span data-stu-id="642c9-153">In **Solution Explorer**, right-click the *Models* folder and then select **Add** -&gt; **New Item**.</span></span> 

    ![Создание уровня доступа к данным — меню "создать элемент"](create_the_data_access_layer/_static/image1.png)

   <span data-ttu-id="642c9-155">Откроется диалоговое окно **Добавление нового элемента**.</span><span class="sxs-lookup"><span data-stu-id="642c9-155">The **Add New Item** dialog box is displayed.</span></span>
2. <span data-ttu-id="642c9-156">В **разделе C# визуальный** элемент на панели **установленные** слева выберите **код**.</span><span class="sxs-lookup"><span data-stu-id="642c9-156">Under **Visual C#** from the **Installed** pane on the left, select **Code**.</span></span> 

    ![Создание уровня доступа к данным — меню "создать элемент"](create_the_data_access_layer/_static/image2.png)
3. <span data-ttu-id="642c9-158">Выберите **класс** из средней области и назовите этот новый класс *Product.CS*.</span><span class="sxs-lookup"><span data-stu-id="642c9-158">Select **Class** from the middle pane and name this new class *Product.cs*.</span></span>
4. <span data-ttu-id="642c9-159">Нажмите кнопку **Добавить**.</span><span class="sxs-lookup"><span data-stu-id="642c9-159">Click **Add**.</span></span>  
   <span data-ttu-id="642c9-160">В редакторе отобразится новый файл класса.</span><span class="sxs-lookup"><span data-stu-id="642c9-160">The new class file is displayed in the editor.</span></span>
5. <span data-ttu-id="642c9-161">Замените код по умолчанию следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="642c9-161">Replace the default code with the following code:</span></span>   

    [!code-csharp[Main](create_the_data_access_layer/samples/sample1.cs)]
6. <span data-ttu-id="642c9-162">Создайте другой класс, повторив шаги 1 – 4, но назовите новый класс *Category.CS* и замените код по умолчанию следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="642c9-162">Create another class by repeating steps 1 through 4, however, name the new class *Category.cs* and replace the default code with the following code:</span></span>  

    [!code-csharp[Main](create_the_data_access_layer/samples/sample2.cs)]

<span data-ttu-id="642c9-163">Как упоминалось выше, класс `Category` представляет тип продукта, предназначенного для продажи приложением (например, <a id="a"></a>&quot;автомобили&quot;, &quot;Боатс&quot;, &quot;Роккетс&quot;и т. д.), а класс `Product` представляет отдельные продукты (Toys) в базе данных.</span><span class="sxs-lookup"><span data-stu-id="642c9-163">As previously mentioned, the `Category` class represents the type of product that the application is designed to sell (such as <a id="a"></a>&quot;Cars&quot;, &quot;Boats&quot;, &quot;Rockets&quot;, and so on), and the `Product` class represents the individual products (toys) in the database.</span></span> <span data-ttu-id="642c9-164">Каждый экземпляр объекта `Product` будет соответствовать строке в таблице реляционной базы данных, а каждое свойство класса Product будет сопоставляться со столбцом в таблице реляционной базы данных.</span><span class="sxs-lookup"><span data-stu-id="642c9-164">Each instance of a `Product` object will correspond to a row within a relational database table, and each property of the Product class will map to a column in the relational database table.</span></span> <span data-ttu-id="642c9-165">Далее в этом учебнике вы просматриваете данные о продуктах, содержащиеся в базе данных.</span><span class="sxs-lookup"><span data-stu-id="642c9-165">Later in this tutorial, you'll review the product data contained in the database.</span></span>

### <a name="data-annotations"></a><span data-ttu-id="642c9-166">Заметки к данным</span><span class="sxs-lookup"><span data-stu-id="642c9-166">Data Annotations</span></span>

<span data-ttu-id="642c9-167">Вы могли заметить, что некоторые члены классов имеют атрибуты, указывающие сведения об элементе, например `[ScaffoldColumn(false)]`.</span><span class="sxs-lookup"><span data-stu-id="642c9-167">You may have noticed that certain members of the classes have attributes specifying details about the member, such as `[ScaffoldColumn(false)]`.</span></span> <span data-ttu-id="642c9-168">Это *заметки к данным*.</span><span class="sxs-lookup"><span data-stu-id="642c9-168">These are *data annotations*.</span></span> <span data-ttu-id="642c9-169">Атрибуты аннотации данных могут описывать, как проверить вводимые пользователем данные для этого элемента, задать для него форматирование и указать, как он моделируется при создании базы данных.</span><span class="sxs-lookup"><span data-stu-id="642c9-169">The data annotation attributes can describe how to validate user input for that member, to specify formatting for it, and to specify how it is modeled when the database is created.</span></span>

### <a name="context-class"></a><span data-ttu-id="642c9-170">Класс Context</span><span class="sxs-lookup"><span data-stu-id="642c9-170">Context Class</span></span>

<span data-ttu-id="642c9-171">Чтобы приступить к использованию классов для доступа к данным, необходимо определить класс контекста.</span><span class="sxs-lookup"><span data-stu-id="642c9-171">To start using the classes for data access, you must define a context class.</span></span> <span data-ttu-id="642c9-172">Как упоминалось ранее, класс контекста управляет классами сущностей (например, классом `Product` и классом `Category`) и предоставляет доступ к базе данных.</span><span class="sxs-lookup"><span data-stu-id="642c9-172">As mentioned previously, the context class manages the entity classes (such as the `Product` class and the `Category` class) and provides data access to the database.</span></span>

<span data-ttu-id="642c9-173">Эта процедура добавляет новый C# класс контекста в папку *Models* .</span><span class="sxs-lookup"><span data-stu-id="642c9-173">This procedure adds a new C# context class to the *Models* folder.</span></span>

1. <span data-ttu-id="642c9-174">Щелкните правой кнопкой мыши папку *Models* и выберите **Добавить** -&gt; **новый элемент**.</span><span class="sxs-lookup"><span data-stu-id="642c9-174">Right-click the *Models* folder and then select **Add** -&gt; **New Item**.</span></span>   
   <span data-ttu-id="642c9-175">Откроется диалоговое окно **Добавление нового элемента**.</span><span class="sxs-lookup"><span data-stu-id="642c9-175">The **Add New Item** dialog box is displayed.</span></span>
2. <span data-ttu-id="642c9-176">Выберите **класс** в средней области, назовите его *ProductContext.CS* и нажмите кнопку **добавить**.</span><span class="sxs-lookup"><span data-stu-id="642c9-176">Select **Class** from the middle pane, name it *ProductContext.cs* and click **Add**.</span></span>
3. <span data-ttu-id="642c9-177">Замените код по умолчанию, содержащийся в классе, следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="642c9-177">Replace the default code contained in the class with the following code:</span></span>   

    [!code-csharp[Main](create_the_data_access_layer/samples/sample3.cs)]

<span data-ttu-id="642c9-178">Этот код добавляет пространство имен `System.Data.Entity`, чтобы иметь доступ ко всем основным функциональным возможностям Entity Framework, включая возможность запросов, вставки, обновления и удаления данных путем работы со строго типизированными объектами.</span><span class="sxs-lookup"><span data-stu-id="642c9-178">This code adds the `System.Data.Entity` namespace so that you have access to all the core functionality of Entity Framework, which includes the capability to query, insert, update, and delete data by working with strongly typed objects.</span></span>

<span data-ttu-id="642c9-179">Класс `ProductContext` представляет контекст базы данных продукта Entity Framework, который обрабатывает выборку, хранение и обновление экземпляров класса `Product` в базе данных.</span><span class="sxs-lookup"><span data-stu-id="642c9-179">The `ProductContext` class represents Entity Framework product database context, which handles fetching, storing, and updating `Product` class instances in the database.</span></span> <span data-ttu-id="642c9-180">Класс `ProductContext` является производным от базового класса `DbContext`, предоставляемого Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="642c9-180">The `ProductContext` class derives from the `DbContext` base class provided by Entity Framework.</span></span>

### <a name="initializer-class"></a><span data-ttu-id="642c9-181">Класс инициализатора</span><span class="sxs-lookup"><span data-stu-id="642c9-181">Initializer Class</span></span>

<span data-ttu-id="642c9-182">Для инициализации базы данных при первом использовании контекста необходимо выполнить определенную пользовательскую логику.</span><span class="sxs-lookup"><span data-stu-id="642c9-182">You will need to run some custom logic to initialize the database the first time the context is used.</span></span> <span data-ttu-id="642c9-183">Это позволит добавить начальные данные в базу данных, чтобы можно было сразу же отображать продукты и категории.</span><span class="sxs-lookup"><span data-stu-id="642c9-183">This will allow seed data to be added to the database so that you can immediately display products and categories.</span></span>

<span data-ttu-id="642c9-184">Эта процедура добавляет новый C# класс инициализатора в папку *Models* .</span><span class="sxs-lookup"><span data-stu-id="642c9-184">This procedure adds a new C# initializer class to the *Models* folder.</span></span>

1. <span data-ttu-id="642c9-185">Создайте еще одну `Class` в папке *Models* и назовите ее *ProductDatabaseInitializer.CS*.</span><span class="sxs-lookup"><span data-stu-id="642c9-185">Create another `Class` in the *Models* folder and name it *ProductDatabaseInitializer.cs*.</span></span>
2. <span data-ttu-id="642c9-186">Замените код по умолчанию, содержащийся в классе, следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="642c9-186">Replace the default code contained in the class with the following code:</span></span>   

    [!code-csharp[Main](create_the_data_access_layer/samples/sample4.cs)]

<span data-ttu-id="642c9-187">Как видно из приведенного выше кода, при создании и инициализации базы данных свойство `Seed` переопределяется и задается.</span><span class="sxs-lookup"><span data-stu-id="642c9-187">As you can see from the above code, when the database is created and initialized, the `Seed` property is overridden and set.</span></span> <span data-ttu-id="642c9-188">Если задано свойство `Seed`, для заполнения базы данных используются значения из категорий и продуктов.</span><span class="sxs-lookup"><span data-stu-id="642c9-188">When the `Seed` property is set, the values from the categories and products are used to populate the database.</span></span> <span data-ttu-id="642c9-189">При попытке обновить данные начального значения путем изменения приведенного выше кода после создания базы данных никакие обновления не будут отображаться при запуске веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="642c9-189">If you attempt to update the seed data by modifying the above code after the database has been created, you won't see any updates when you run the Web application.</span></span> <span data-ttu-id="642c9-190">Причина в том, что приведенный выше код использует реализацию класса `DropCreateDatabaseIfModelChanges`, чтобы распознать, изменилась ли модель (схема) перед сбросом начальных данных.</span><span class="sxs-lookup"><span data-stu-id="642c9-190">The reason is the above code uses an implementation of the `DropCreateDatabaseIfModelChanges` class to recognize if the model (schema) has changed before resetting the seed data.</span></span> <span data-ttu-id="642c9-191">Если `Category` и `Product` классы сущностей не были изменены, то база данных не будет повторно инициализирована с начальными данными.</span><span class="sxs-lookup"><span data-stu-id="642c9-191">If no changes are made to the `Category` and `Product` entity classes, the database will not be reinitialized with the seed data.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="642c9-192">Если требуется, чтобы база данных была создана заново при каждом запуске приложения, можно использовать класс `DropCreateDatabaseAlways` вместо класса `DropCreateDatabaseIfModelChanges`.</span><span class="sxs-lookup"><span data-stu-id="642c9-192">If you wanted the database to be recreated every time you ran the application, you could use the `DropCreateDatabaseAlways` class instead of the `DropCreateDatabaseIfModelChanges` class.</span></span> <span data-ttu-id="642c9-193">Однако в этой серии руководств используется класс `DropCreateDatabaseIfModelChanges`.</span><span class="sxs-lookup"><span data-stu-id="642c9-193">However for this tutorial series, use the `DropCreateDatabaseIfModelChanges` class.</span></span>

<span data-ttu-id="642c9-194">На этом этапе в этом учебнике у вас будет папка *Models* с четырьмя новыми классами и одним классом по умолчанию:</span><span class="sxs-lookup"><span data-stu-id="642c9-194">At this point in this tutorial, you will have a *Models* folder with four new classes and one default class:</span></span>

![Создание уровня доступа к данным — папка "модели"](create_the_data_access_layer/_static/image3.png)

### <a name="configuring-the-application-to-use-the-data-model"></a><span data-ttu-id="642c9-196">Настройка приложения для использования модели данных</span><span class="sxs-lookup"><span data-stu-id="642c9-196">Configuring the Application to Use the Data Model</span></span>

<span data-ttu-id="642c9-197">Теперь, когда вы создали классы, представляющие данные, необходимо настроить приложение для использования классов.</span><span class="sxs-lookup"><span data-stu-id="642c9-197">Now that you've created the classes that represent the data, you must configure the application to use the classes.</span></span> <span data-ttu-id="642c9-198">В файле *Global. asax* добавляется код, который инициализирует модель.</span><span class="sxs-lookup"><span data-stu-id="642c9-198">In the *Global.asax* file, you add code that initializes the model.</span></span> <span data-ttu-id="642c9-199">В файле *Web. config* добавьте сведения, указывающие приложению, какая база данных будет использоваться для хранения данных, представленных новыми классами данных.</span><span class="sxs-lookup"><span data-stu-id="642c9-199">In the *Web.config* file you add information that tells the application what database you'll use to store the data that's represented by the new data classes.</span></span> <span data-ttu-id="642c9-200">Файл *Global. asax* можно использовать для управления событиями или методами приложения.</span><span class="sxs-lookup"><span data-stu-id="642c9-200">The *Global.asax* file can be used to handle application events or methods.</span></span> <span data-ttu-id="642c9-201">Файл *Web. config* позволяет управлять конфигурацией веб-приложения ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="642c9-201">The *Web.config* file allows you to control the configuration of your ASP.NET web application.</span></span>

#### <a name="updating-the-globalasax-file"></a><span data-ttu-id="642c9-202">Обновление файла Global. asax</span><span class="sxs-lookup"><span data-stu-id="642c9-202">Updating the Global.asax file</span></span>

<span data-ttu-id="642c9-203">Чтобы инициализировать модели данных при запуске приложения, необходимо обновить обработчик `Application_Start` в файле *Global.asax.CS* .</span><span class="sxs-lookup"><span data-stu-id="642c9-203">To initialize the data models when the application starts, you will update the `Application_Start` handler in the *Global.asax.cs* file.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="642c9-204">В обозреватель решений можно выбрать либо файл *Global. asax* , либо файл *Global.asax.CS* , чтобы изменить файл *Global.asax.CS* .</span><span class="sxs-lookup"><span data-stu-id="642c9-204">In Solution Explorer, you can select either the *Global.asax* file or the *Global.asax.cs* file to edit the *Global.asax.cs* file.</span></span>

1. <span data-ttu-id="642c9-205">Добавьте следующий код, выделенный желтым цветом, в метод `Application_Start` в файле *Global.asax.CS* .</span><span class="sxs-lookup"><span data-stu-id="642c9-205">Add the following code highlighted in yellow to the `Application_Start` method in the *Global.asax.cs* file.</span></span>   

    [!code-csharp[Main](create_the_data_access_layer/samples/sample5.cs?highlight=9-10,22-23)]

> [!NOTE] 
> 
> <span data-ttu-id="642c9-206">Браузер должен поддерживать HTML5 для просмотра кода, выделенного желтым цветом, при просмотре этой серии руководств в браузере.</span><span class="sxs-lookup"><span data-stu-id="642c9-206">Your browser must support HTML5 to view the code highlighted in yellow when viewing this tutorial series in a browser.</span></span>

<span data-ttu-id="642c9-207">Как показано в приведенном выше коде, при запуске приложения в приложении указывается инициализатор, который будет выполняться во время первого обращения к данным.</span><span class="sxs-lookup"><span data-stu-id="642c9-207">As shown in the above code, when the application starts, the application specifies the initializer that will run during the first time the data is accessed.</span></span> <span data-ttu-id="642c9-208">Для доступа к объекту `Database` и объекту `ProductDatabaseInitializer` требуются два дополнительных пространства имен.</span><span class="sxs-lookup"><span data-stu-id="642c9-208">The two additional namespaces are required to access the `Database` object and the `ProductDatabaseInitializer` object.</span></span>

 <span data-ttu-id="642c9-209">Изменение файла Web. config</span><span class="sxs-lookup"><span data-stu-id="642c9-209">Modifying the Web.Config File</span></span> 

<span data-ttu-id="642c9-210">Несмотря на то, что Entity Framework Code First создаст базу данных в расположении по умолчанию, когда база данных заполняется начальными данными, добавление в приложение собственных сведений о подключении позволяет управлять расположением базы данных.</span><span class="sxs-lookup"><span data-stu-id="642c9-210">Although Entity Framework Code First will generate a database for you in a default location when the database is populated with seed data, adding your own connection information to your application gives you control of the database location.</span></span> <span data-ttu-id="642c9-211">Это подключение к базе данных указывается с помощью строки подключения в файле *Web. config* приложения в корне проекта.</span><span class="sxs-lookup"><span data-stu-id="642c9-211">You specify this database connection using a connection string in the application's *Web.config* file at the root of the project.</span></span> <span data-ttu-id="642c9-212">Добавив новую строку подключения, можно указать расположение базы данных (*wingtiptoys. mdf*), которая должна быть создана в каталоге данных приложения (*Данные приложения\_* ), а не его расположение по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="642c9-212">By adding a new connection string, you can direct the location of the database (*wingtiptoys.mdf*) to be built in the application's data directory (*App\_Data*), rather than its default location.</span></span> <span data-ttu-id="642c9-213">Внесение этого изменения позволит найти и проверить файл базы данных далее в этом руководстве.</span><span class="sxs-lookup"><span data-stu-id="642c9-213">Making this change will allow you to find and inspect the database file later in this tutorial.</span></span>

1. <span data-ttu-id="642c9-214">В **Обозреватель решений**найдите и откройте файл *Web. config* .</span><span class="sxs-lookup"><span data-stu-id="642c9-214">In **Solution Explorer**, find and open the *Web.config* file.</span></span>
2. <span data-ttu-id="642c9-215">Добавьте строку подключения, выделенную желтым цветом, в раздел `<connectionStrings>` файла *Web. config* следующим образом:</span><span class="sxs-lookup"><span data-stu-id="642c9-215">Add the connection string highlighted in yellow to the `<connectionStrings>` section of the *Web.config* file as follows:</span></span>  

    [!code-xml[Main](create_the_data_access_layer/samples/sample6.xml?highlight=4-7)]

<span data-ttu-id="642c9-216">При первом запуске приложения будет построена база данных в расположении, указанном в строке подключения.</span><span class="sxs-lookup"><span data-stu-id="642c9-216">When the application is run for the first time, it will build the database at the location specified by the connection string.</span></span> <span data-ttu-id="642c9-217">Но перед запуском приложения создадим его первым.</span><span class="sxs-lookup"><span data-stu-id="642c9-217">But before running the application, let's build it first.</span></span>

## <a name="building-the-application"></a><span data-ttu-id="642c9-218">Сборка приложения</span><span class="sxs-lookup"><span data-stu-id="642c9-218">Building the Application</span></span>

<span data-ttu-id="642c9-219">Чтобы убедиться, что все классы и изменения в веб-приложении работают, следует создать приложение.</span><span class="sxs-lookup"><span data-stu-id="642c9-219">To make sure that all the classes and changes to your Web application work, you should build the application.</span></span>

1. <span data-ttu-id="642c9-220">В меню **Отладка** выберите команду **построить WingtipToys**.</span><span class="sxs-lookup"><span data-stu-id="642c9-220">From the **Debug** menu, select **Build WingtipToys**.</span></span>  
 <span data-ttu-id="642c9-221">Появится окно вывод, и если все прошло успешно, появится сообщение об *успешной* **отводе** .</span><span class="sxs-lookup"><span data-stu-id="642c9-221">The **Output** window is displayed, and if all went well, you see a *succeeded* message.</span></span>  

    ![Создание уровня доступа к данным — окна вывода](create_the_data_access_layer/_static/image4.png)

<span data-ttu-id="642c9-223">При возникновении ошибки повторно проверьте указанные выше шаги.</span><span class="sxs-lookup"><span data-stu-id="642c9-223">If you run into an error, re-check the above steps.</span></span> <span data-ttu-id="642c9-224">Информация в окне **вывод** указывает на то, какой файл имеет ошибку, и в каком файле требуется изменение.</span><span class="sxs-lookup"><span data-stu-id="642c9-224">The information in the **Output** window will indicate which file has a problem and where in the file a change is required.</span></span> <span data-ttu-id="642c9-225">Эта информация позволит вам определить, какую часть описанных действий необходимо проверить и исправить в проекте.</span><span class="sxs-lookup"><span data-stu-id="642c9-225">This information will enable you to determine what part of the above steps need to be reviewed and fixed in your project.</span></span>

## <a name="summary"></a><span data-ttu-id="642c9-226">Сводка</span><span class="sxs-lookup"><span data-stu-id="642c9-226">Summary</span></span>

<span data-ttu-id="642c9-227">В этом руководстве по ряду вы создали модель данных, а также добавили код, который будет использоваться для инициализации и заполнения базы данных.</span><span class="sxs-lookup"><span data-stu-id="642c9-227">In this tutorial of the series you have created the data model, as well as, added the code that will be used to initialize and seed the database.</span></span> <span data-ttu-id="642c9-228">Вы также настроили приложение для использования моделей данных при запуске приложения.</span><span class="sxs-lookup"><span data-stu-id="642c9-228">You have also configured the application to use the data models when the application is run.</span></span>

<span data-ttu-id="642c9-229">В следующем руководстве вы обновите пользовательский интерфейс, добавите навигацию и получите данные из базы данных.</span><span class="sxs-lookup"><span data-stu-id="642c9-229">In the next tutorial, you'll update the UI, add navigation, and retrieve data from the database.</span></span> <span data-ttu-id="642c9-230">Это приведет к тому, что база данных будет автоматически создана на основе классов сущностей, созданных в этом руководстве.</span><span class="sxs-lookup"><span data-stu-id="642c9-230">This will result in the database being automatically created based on the entity classes that you created in this tutorial.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="642c9-231">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="642c9-231">Additional Resources</span></span>

<span data-ttu-id="642c9-232">[Обзор Entity Framework](https://msdn.microsoft.com/library/bb399567.aspx) </span><span class="sxs-lookup"><span data-stu-id="642c9-232">[Entity Framework Overview](https://msdn.microsoft.com/library/bb399567.aspx) </span></span>  
<span data-ttu-id="642c9-233">[Руководство для начинающих по Entity Framework ADO.NET](https://msdn.microsoft.com/data/ee712907) </span><span class="sxs-lookup"><span data-stu-id="642c9-233">[Beginner's Guide to the ADO.NET Entity Framework](https://msdn.microsoft.com/data/ee712907) </span></span>  
<span data-ttu-id="642c9-234">[Разработка Code First с помощью Entity Framework](http://www.msteched.com/2010/Europe/DEV212) (видео)</span><span class="sxs-lookup"><span data-stu-id="642c9-234">[Code First Development with Entity Framework](http://www.msteched.com/2010/Europe/DEV212) (video)</span></span>   
<span data-ttu-id="642c9-235">[Code First связей API Fluent](https://msdn.microsoft.com/data/hh134698) </span><span class="sxs-lookup"><span data-stu-id="642c9-235">[Code First Relationships Fluent API](https://msdn.microsoft.com/data/hh134698) </span></span>  
[<span data-ttu-id="642c9-236">Code First заметок к данным</span><span class="sxs-lookup"><span data-stu-id="642c9-236">Code First Data Annotations</span></span>](https://msdn.microsoft.com/data/gg193958)  
[<span data-ttu-id="642c9-237">Улучшения производительности для Entity Framework</span><span class="sxs-lookup"><span data-stu-id="642c9-237">Productivity Improvements for the Entity Framework</span></span>](https://blogs.msdn.com/b/efdesign/archive/2010/06/21/productivity-improvements-for-the-entity-framework.aspx?wa=wsignin1.0)

> [!div class="step-by-step"]
> <span data-ttu-id="642c9-238">[Назад](create-the-project.md)
> [Вперед](ui_and_navigation.md)</span><span class="sxs-lookup"><span data-stu-id="642c9-238">[Previous](create-the-project.md)
[Next](ui_and_navigation.md)</span></span>
