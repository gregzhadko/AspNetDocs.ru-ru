---
uid: web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/membership-and-administration
title: Членство и Администрирование | Документация Майкрософт
author: Erikre
description: В этой серии руководств будет основы создания приложений веб-форм ASP.NET с помощью ASP.NET 4.5 и Microsoft Visual Studio Express 2013 для мы...
ms.author: riande
ms.date: 09/08/2014
ms.assetid: 732a2316-e49f-4f72-becd-0cd72f14457e
msc.legacyurl: /web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/membership-and-administration
msc.type: authoredcontent
ms.openlocfilehash: 7263a7d7ee791be8a1369934aac4d091736a658b
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59417485"
---
# <a name="membership-and-administration"></a><span data-ttu-id="ecf39-103">Членство и администрирование</span><span class="sxs-lookup"><span data-stu-id="ecf39-103">Membership and Administration</span></span>

<span data-ttu-id="ecf39-104">по [Erik Reitan](https://github.com/Erikre)</span><span class="sxs-lookup"><span data-stu-id="ecf39-104">by [Erik Reitan](https://github.com/Erikre)</span></span>

<span data-ttu-id="ecf39-105">[Скачайте пример проекта Wingtip Toys (C#)](http://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) или [скачайте электронную книгу (PDF)](http://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20ASP.NET%204.5%20Web%20Forms%20and%20Visual%20Studio%202013.pdf)</span><span class="sxs-lookup"><span data-stu-id="ecf39-105">[Download Wingtip Toys Sample Project (C#)](http://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) or [Download E-book (PDF)](http://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20ASP.NET%204.5%20Web%20Forms%20and%20Visual%20Studio%202013.pdf)</span></span>

> <span data-ttu-id="ecf39-106">В этой серии руководств будет основы создания приложений веб-форм ASP.NET с помощью ASP.NET 4.5 и Microsoft Visual Studio Express 2013 для Web.</span><span class="sxs-lookup"><span data-stu-id="ecf39-106">This tutorial series will teach you the basics of building an ASP.NET Web Forms application using ASP.NET 4.5 and Microsoft Visual Studio Express 2013 for Web.</span></span> <span data-ttu-id="ecf39-107">Visual Studio 2013 [проект с исходным кодом C#](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) доступен на следующей странице этой серии руководств.</span><span class="sxs-lookup"><span data-stu-id="ecf39-107">A Visual Studio 2013 [project with C# source code](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) is available to accompany this tutorial series.</span></span>


<span data-ttu-id="ecf39-108">Этом руководстве показано, как обновить пример приложения Wingtip Toys, чтобы добавить пользовательскую роль и использовать ASP.NET Identity.</span><span class="sxs-lookup"><span data-stu-id="ecf39-108">This tutorial shows you how to update the Wingtip Toys sample application to add a custom role and use ASP.NET Identity.</span></span> <span data-ttu-id="ecf39-109">Он также показано, как реализовать страницу администрирования, из которого пользователь с пользовательской роли можно добавлять и удалять продукты с веб-сайта.</span><span class="sxs-lookup"><span data-stu-id="ecf39-109">It also shows you how to implement an administration page from which the user with a custom role can add and remove products from the website.</span></span>

<span data-ttu-id="ecf39-110">[ASP.NET Identity](../../../../identity/overview/getting-started/introduction-to-aspnet-identity.md) является система членства, используемая для создания веб-приложения ASP.NET и доступен в ASP.NET 4.5.</span><span class="sxs-lookup"><span data-stu-id="ecf39-110">[ASP.NET Identity](../../../../identity/overview/getting-started/introduction-to-aspnet-identity.md) is the membership system used to build ASP.NET web application and is available in ASP.NET 4.5.</span></span> <span data-ttu-id="ecf39-111">ASP.NET Identity используется в шаблоне проекта Visual Studio 2013 веб-форм, а также шаблоны для [ASP.NET MVC](../../../../mvc/index.md), [веб-API ASP.NET](../../../../web-api/index.md), и [приложения ASP.NET](../../../../single-page-application/index.md).</span><span class="sxs-lookup"><span data-stu-id="ecf39-111">ASP.NET Identity is used in the Visual Studio 2013 Web Forms project template, as well as the templates for [ASP.NET MVC](../../../../mvc/index.md), [ASP.NET Web API](../../../../web-api/index.md), and [ASP.NET Single Page Application](../../../../single-page-application/index.md).</span></span> <span data-ttu-id="ecf39-112">Можно также специально установить системы удостоверений ASP.NET с помощью NuGet, начав с пустой веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="ecf39-112">You can also specifically install the ASP.NET Identity system using NuGet when you start with an empty Web application.</span></span> <span data-ttu-id="ecf39-113">Тем не менее, в этой серии руководств используется **веб-форм**projecttemplate, включая систему ASP.NET Identity.</span><span class="sxs-lookup"><span data-stu-id="ecf39-113">However, in this tutorial series you use the **Web Forms**projecttemplate, which includes the ASP.NET Identity system.</span></span> <span data-ttu-id="ecf39-114">ASP.NET Identity позволяет легко интегрировать данные профиля пользователя с данными приложения.</span><span class="sxs-lookup"><span data-stu-id="ecf39-114">ASP.NET Identity makes it easy to integrate user-specific profile data with application data.</span></span> <span data-ttu-id="ecf39-115">Кроме того ASP.NET Identity позволяет выбирать модель сохраняемости для профилей пользователей в приложении.</span><span class="sxs-lookup"><span data-stu-id="ecf39-115">Also, ASP.NET Identity allows you to choose the persistence model for user profiles in your application.</span></span> <span data-ttu-id="ecf39-116">Данные можно сохранить в базе данных SQL Server или другом хранилище данных, включая *NoSQL* хранит данные, такие как Windows Azure Storage Tables.</span><span class="sxs-lookup"><span data-stu-id="ecf39-116">You can store the data in a SQL Server database or another data store, including *NoSQL* data stores such as Windows Azure Storage Tables.</span></span>

<span data-ttu-id="ecf39-117">Этот учебник основан на предыдущем руководстве под названием «Извлечение и оплаты с PayPal» в этой серии руководств Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="ecf39-117">This tutorial builds on the previous tutorial titled "Checkout and Payment with PayPal" in the Wingtip Toys tutorial series.</span></span>

## <a name="what-youll-learn"></a><span data-ttu-id="ecf39-118">Вы узнаете, как:</span><span class="sxs-lookup"><span data-stu-id="ecf39-118">What you'll learn:</span></span>

- <span data-ttu-id="ecf39-119">Как использовать код для добавления пользовательской роли и пользователя в приложение.</span><span class="sxs-lookup"><span data-stu-id="ecf39-119">How to use code to add a custom role and a user to the application.</span></span>
- <span data-ttu-id="ecf39-120">Как ограничить доступ к папке администрирования и страницы.</span><span class="sxs-lookup"><span data-stu-id="ecf39-120">How to restrict access to the administration folder and page.</span></span>
- <span data-ttu-id="ecf39-121">Как обеспечить навигации для пользователя, которому принадлежит настраиваемой роли.</span><span class="sxs-lookup"><span data-stu-id="ecf39-121">How to provide navigation for the user that belongs to the custom role.</span></span>
- <span data-ttu-id="ecf39-122">Как использовать привязки модели для заполнения [DropDownList](https://msdn.microsoft.com/library/system.web.ui.webcontrols.dropdownlist(v=vs.110).aspx) элемента управления с помощью категорий продуктов.</span><span class="sxs-lookup"><span data-stu-id="ecf39-122">How to use model binding to populate a [DropDownList](https://msdn.microsoft.com/library/system.web.ui.webcontrols.dropdownlist(v=vs.110).aspx) control with product categories.</span></span>
- <span data-ttu-id="ecf39-123">Отправка файла в веб-приложения с помощью [FileUpload](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload(v=vs.110).aspx) элемента управления.</span><span class="sxs-lookup"><span data-stu-id="ecf39-123">How to upload a file to the web application using the [FileUpload](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload(v=vs.110).aspx) control.</span></span>
- <span data-ttu-id="ecf39-124">Способы использования элементов управления проверки к внедрите проверку входных данных.</span><span class="sxs-lookup"><span data-stu-id="ecf39-124">How to use validation controls to implement input validation.</span></span>
- <span data-ttu-id="ecf39-125">Как добавлять и удалять продукты из приложения.</span><span class="sxs-lookup"><span data-stu-id="ecf39-125">How to add and remove products from the application.</span></span>

## <a name="these-features-are-included-in-the-tutorial"></a><span data-ttu-id="ecf39-126">Эти компоненты включены в этом руководстве:</span><span class="sxs-lookup"><span data-stu-id="ecf39-126">These features are included in the tutorial:</span></span>

- <span data-ttu-id="ecf39-127">ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="ecf39-127">ASP.NET Identity</span></span>
- <span data-ttu-id="ecf39-128">Конфигурация и авторизации</span><span class="sxs-lookup"><span data-stu-id="ecf39-128">Configuration and Authorization</span></span>
- <span data-ttu-id="ecf39-129">Привязка модели</span><span class="sxs-lookup"><span data-stu-id="ecf39-129">Model Binding</span></span>
- <span data-ttu-id="ecf39-130">Малозаметная проверка</span><span class="sxs-lookup"><span data-stu-id="ecf39-130">Unobtrusive Validation</span></span>

<span data-ttu-id="ecf39-131">Веб-формы ASP.NET предоставляет возможности членства.</span><span class="sxs-lookup"><span data-stu-id="ecf39-131">ASP.NET Web Forms provides membership capabilities.</span></span> <span data-ttu-id="ecf39-132">С помощью шаблона по умолчанию, вы получает встроенную функциональность членства, которые можно немедленно использовать при выполнении приложения.</span><span class="sxs-lookup"><span data-stu-id="ecf39-132">By using the default template, you have built-in membership functionality that you can immediately use when the application runs.</span></span> <span data-ttu-id="ecf39-133">Этом руководстве показано, как использовать ASP.NET Identity для добавления пользовательской роли и назначение пользователю эту роль.</span><span class="sxs-lookup"><span data-stu-id="ecf39-133">This tutorial shows you how to use ASP.NET Identity to add a custom role and assign a user to that role.</span></span> <span data-ttu-id="ecf39-134">Вы узнаете, как ограничить доступ к папке администрирования.</span><span class="sxs-lookup"><span data-stu-id="ecf39-134">You will learn how to restrict access to the administration folder.</span></span> <span data-ttu-id="ecf39-135">Вы добавите страницы в папку администрирования, пользователь, обладающий пользовательской роли для добавления и удаления продуктов и просмотреть продукта после его добавления.</span><span class="sxs-lookup"><span data-stu-id="ecf39-135">You'll add a page to the administration folder that allows a user with a custom role to add and remove products, and to preview a product after it has been added.</span></span>

## <a name="adding-a-custom-role"></a><span data-ttu-id="ecf39-136">Добавление пользовательской роли</span><span class="sxs-lookup"><span data-stu-id="ecf39-136">Adding a Custom Role</span></span>

<span data-ttu-id="ecf39-137">С помощью удостоверения ASP.NET, можно добавить пользовательскую роль и назначение пользователю эту роль с помощью кода.</span><span class="sxs-lookup"><span data-stu-id="ecf39-137">Using ASP.NET Identity, you can add a custom role and assign a user to that role using code.</span></span>

1. <span data-ttu-id="ecf39-138">В **обозревателе решений**, щелкните правой кнопкой мыши *логики* папки и создайте новый класс.</span><span class="sxs-lookup"><span data-stu-id="ecf39-138">In **Solution Explorer**, right-click on the *Logic* folder and create a new class.</span></span>
2. <span data-ttu-id="ecf39-139">Назовите новый класс *RoleActions.cs*.</span><span class="sxs-lookup"><span data-stu-id="ecf39-139">Name the new class *RoleActions.cs*.</span></span>
3. <span data-ttu-id="ecf39-140">Измените код таким образом, чтобы он выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="ecf39-140">Modify the code so that it appears as follows:</span></span>  

    [!code-csharp[Main](membership-and-administration/samples/sample1.cs?highlight=8)]
4. <span data-ttu-id="ecf39-141">В **обозревателе решений**откройте *Global.asax.cs* файл.</span><span class="sxs-lookup"><span data-stu-id="ecf39-141">In **Solution Explorer**, open the *Global.asax.cs* file.</span></span>
5. <span data-ttu-id="ecf39-142">Изменить *Global.asax.cs* файла путем добавления кода, выделены желтым цветом, таким образом, чтобы он выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="ecf39-142">Modify the *Global.asax.cs* file by adding the code highlighted in yellow so that it appears as follows:</span></span>  

    [!code-csharp[Main](membership-and-administration/samples/sample2.cs?highlight=11,26-28)]
6. <span data-ttu-id="ecf39-143">Обратите внимание, что `AddUserAndRole` подчеркнуто красной чертой.</span><span class="sxs-lookup"><span data-stu-id="ecf39-143">Notice that `AddUserAndRole` is underlined in red.</span></span> <span data-ttu-id="ecf39-144">Дважды щелкните AddUserAndRole кода.</span><span class="sxs-lookup"><span data-stu-id="ecf39-144">Double-click the AddUserAndRole code.</span></span>  
   <span data-ttu-id="ecf39-145">Буквы «A» в начале выделенный метод будет подчеркиваться.</span><span class="sxs-lookup"><span data-stu-id="ecf39-145">The letter "A" at the beginning of the highlighted method will be underlined.</span></span>
7. <span data-ttu-id="ecf39-146">Наведите указатель мыши буквы «A» и щелкните пользовательский Интерфейс, который позволяет создать заглушку метода для `AddUserAndRole` метод.</span><span class="sxs-lookup"><span data-stu-id="ecf39-146">Hover over the letter "A" and click the UI that allows you to generate a method stub for the `AddUserAndRole` method.</span></span> 

    ![Членство и администрирование - Создание заглушки метода](membership-and-administration/_static/image1.png)
8. <span data-ttu-id="ecf39-148">Щелкните параметр:</span><span class="sxs-lookup"><span data-stu-id="ecf39-148">Click the option titled:</span></span>  
    `Generate method stub for "AddUserAndRole" in "WingtipToys.Logic.RoleActions"`
9. <span data-ttu-id="ecf39-149">Откройте *RoleActions.cs* файла из *логики* папки.</span><span class="sxs-lookup"><span data-stu-id="ecf39-149">Open the *RoleActions.cs* file from the *Logic* folder.</span></span>  
   <span data-ttu-id="ecf39-150">`AddUserAndRole` Был добавлен метод в файл класса.</span><span class="sxs-lookup"><span data-stu-id="ecf39-150">The `AddUserAndRole` method has been added to the class file.</span></span>
10. <span data-ttu-id="ecf39-151">Изменить *RoleActions.cs* файла путем удаления `NotImplementedException` и добавления кода, выделенное желтым цветом, таким образом, чтобы он выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="ecf39-151">Modify the *RoleActions.cs* file by removing the `NotImplementedException` and adding the code highlighted in yellow, so that it appears as follows:</span></span>  

    [!code-csharp[Main](membership-and-administration/samples/sample3.cs?highlight=5-7,15-51)]

<span data-ttu-id="ecf39-152">Приведенный выше код сначала устанавливает контекст базы данных для базы данных членства.</span><span class="sxs-lookup"><span data-stu-id="ecf39-152">The above code first establishes a database context for the membership database.</span></span> <span data-ttu-id="ecf39-153">Базы данных членства также хранится в виде *.mdf* файл *приложения\_данных* папки.</span><span class="sxs-lookup"><span data-stu-id="ecf39-153">The membership database is also stored as an *.mdf* file in the *App\_Data* folder.</span></span> <span data-ttu-id="ecf39-154">Можно просмотреть эту базу данных, когда первый пользователь вошел в это веб-приложение.</span><span class="sxs-lookup"><span data-stu-id="ecf39-154">You will be able to view this database once the first user has signed in to this web application.</span></span> 

> [!NOTE] 
> 
> <span data-ttu-id="ecf39-155">Если вы хотите хранить данные членства вместе с данными продукта, можно с помощью одного **DbContext** вы использовали для хранения данных продуктов в приведенном выше коде.</span><span class="sxs-lookup"><span data-stu-id="ecf39-155">If you wish to store the membership data along with the product data, you can consider using the same **DbContext** that you used to store the product data in the above code.</span></span>


 <span data-ttu-id="ecf39-156">*Внутренней* ключевое слово является модификатором доступа для типов (таких как классы) и членов типов (например, методы или свойства).</span><span class="sxs-lookup"><span data-stu-id="ecf39-156">The *internal* keyword is an access modifier for types (such as classes) and type members (such as methods or properties).</span></span> <span data-ttu-id="ecf39-157">Внутренние типы или члены доступны только внутри файлов, содержащихся в той же сборке *(.dll* файла).</span><span class="sxs-lookup"><span data-stu-id="ecf39-157">Internal types or members are accessible only within files contained in the same assembly *(.dll* file).</span></span> <span data-ttu-id="ecf39-158">При сборке приложения, файл сборки *(.dll*) создается, содержащий код, который выполняется при запуске приложения.</span><span class="sxs-lookup"><span data-stu-id="ecf39-158">When you build your application, an assembly file *(.dll*) is created that contains the code that is executed when you run your application.</span></span> 

<span data-ttu-id="ecf39-159">Объект `RoleStore` объектом, который предоставляет управление ролями, создан на основе контекста базы данных.</span><span class="sxs-lookup"><span data-stu-id="ecf39-159">A `RoleStore` object, which provides role management, is created based on the database context.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="ecf39-160">Обратите внимание, что при `RoleStore` создания объекта он использует универсальный `IdentityRole` типа.</span><span class="sxs-lookup"><span data-stu-id="ecf39-160">Notice that when the `RoleStore` object is created it uses a Generic `IdentityRole` type.</span></span> <span data-ttu-id="ecf39-161">Это означает, что `RoleStore` допускается только для хранения `IdentityRole` объектов.</span><span class="sxs-lookup"><span data-stu-id="ecf39-161">This means that the `RoleStore` is only allowed to contain `IdentityRole` objects.</span></span> <span data-ttu-id="ecf39-162">Также с помощью универсальных типов, в памяти обработки ресурсов лучше.</span><span class="sxs-lookup"><span data-stu-id="ecf39-162">Also by using Generics, resources in memory are handled better.</span></span>


<span data-ttu-id="ecf39-163">Далее, `RoleManager` объекта, создается на основе `RoleStore` объект, который вы только что создали.</span><span class="sxs-lookup"><span data-stu-id="ecf39-163">Next, the `RoleManager` object, is created based on the `RoleStore` object that you just created.</span></span> <span data-ttu-id="ecf39-164">`RoleManager` объект предоставляет связанные с ролями API, который может использоваться для автоматического сохранения изменения `RoleStore`.</span><span class="sxs-lookup"><span data-stu-id="ecf39-164">the `RoleManager` object exposes role related API which can be used to automatically save changes to the `RoleStore`.</span></span> <span data-ttu-id="ecf39-165">`RoleManager` Допускается только для хранения `IdentityRole` объекты, так как в коде используется `<IdentityRole>` универсального типа.</span><span class="sxs-lookup"><span data-stu-id="ecf39-165">The `RoleManager` is only allowed to contain `IdentityRole` objects because the code uses the `<IdentityRole>` Generic type.</span></span>

<span data-ttu-id="ecf39-166">Вы вызываете `RoleExists` метод, чтобы определить, присутствует ли на роль «canEdit» в базе данных членства.</span><span class="sxs-lookup"><span data-stu-id="ecf39-166">You call the `RoleExists` method to determine if the "canEdit" role is present in the membership database.</span></span> <span data-ttu-id="ecf39-167">Если это не так, вы создадите роль.</span><span class="sxs-lookup"><span data-stu-id="ecf39-167">If it is not, you create the role.</span></span>

<span data-ttu-id="ecf39-168">Создание `UserManager` объект выглядит как быть сложнее, чем `RoleManager` управления, однако он практически ничем не отличается.</span><span class="sxs-lookup"><span data-stu-id="ecf39-168">Creating the `UserManager` object appears to be more complicated than the `RoleManager` control, however it is nearly the same.</span></span> <span data-ttu-id="ecf39-169">Она используется только в коде на одной строке, а не несколько.</span><span class="sxs-lookup"><span data-stu-id="ecf39-169">It is just coded on one line rather than several.</span></span> <span data-ttu-id="ecf39-170">Здесь является создание экземпляра параметра, передаваемые как новый объект, содержащийся в скобки.</span><span class="sxs-lookup"><span data-stu-id="ecf39-170">Here, the parameter that you are passing is instantiating as a new object contained in the parenthesis.</span></span>

<span data-ttu-id="ecf39-171">Далее создайте пользователя «canEditUser» путем создания нового `ApplicationUser` объекта.</span><span class="sxs-lookup"><span data-stu-id="ecf39-171">Next you create the "canEditUser" user by creating a new `ApplicationUser` object.</span></span> <span data-ttu-id="ecf39-172">Затем при успешном создании пользователя, добавьте пользователя в новую роль.</span><span class="sxs-lookup"><span data-stu-id="ecf39-172">Then, if you successfully create the user, you add the user to the new role.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="ecf39-173">Обработка ошибок будет обновляться при прохождении учебника «Обработка ошибок ASP.NET» далее в этой серии руководств.</span><span class="sxs-lookup"><span data-stu-id="ecf39-173">The error handling will be updated during the "ASP.NET Error Handling" tutorial later in this tutorial series.</span></span>


<span data-ttu-id="ecf39-174">При следующем запуске приложения пользователя с именем «canEditUser» добавляется как роль с именем «canEdit» приложения.</span><span class="sxs-lookup"><span data-stu-id="ecf39-174">The next time the application starts, the user named "canEditUser" will be added as the role named "canEdit" of the application.</span></span> <span data-ttu-id="ecf39-175">Далее в этом руководстве вы позволит входить в систему как пользователь «canEditUser» для отображения дополнительных возможностей, которые будут добавлены в рамках этого руководства.</span><span class="sxs-lookup"><span data-stu-id="ecf39-175">Later in this tutorial, you will login as the "canEditUser" user to display additional capabilities that you will added during this tutorial.</span></span> <span data-ttu-id="ecf39-176">Дополнительные сведения об ASP.NET Identity API см. в разделе [пространство имен Microsoft.AspNet.Identity](https://msdn.microsoft.com/library/microsoft.aspnet.identity(v=vs.111).aspx).</span><span class="sxs-lookup"><span data-stu-id="ecf39-176">For API details about ASP.NET Identity, see the [Microsoft.AspNet.Identity Namespace](https://msdn.microsoft.com/library/microsoft.aspnet.identity(v=vs.111).aspx).</span></span> <span data-ttu-id="ecf39-177">Дополнительные сведения об инициализации системы удостоверений ASP.NET см. в разделе [AspnetIdentitySample](https://github.com/rustd/AspnetIdentitySample/blob/master/AspnetIdentitySample/App_Start/IdentityConfig.cs).</span><span class="sxs-lookup"><span data-stu-id="ecf39-177">For additional details about initializing the ASP.NET Identity system, see the [AspnetIdentitySample](https://github.com/rustd/AspnetIdentitySample/blob/master/AspnetIdentitySample/App_Start/IdentityConfig.cs).</span></span>

### <a name="restricting-access-to-the-administration-page"></a><span data-ttu-id="ecf39-178">Ограничение доступа к странице администрирования</span><span class="sxs-lookup"><span data-stu-id="ecf39-178">Restricting Access to the Administration Page</span></span>

<span data-ttu-id="ecf39-179">Пример приложения Wingtip Toys позволяет анонимным пользователям и выполнившим вход пользователям просматривать и покупать продукты.</span><span class="sxs-lookup"><span data-stu-id="ecf39-179">The Wingtip Toys sample application allows both anonymous users and logged-in users to view and purchase products.</span></span> <span data-ttu-id="ecf39-180">Тем не менее вошедшего в систему пользователя с ролью пользовательских «canEdit» можно получить доступ к странице с ограниченным доступом для добавления и удаления продуктов.</span><span class="sxs-lookup"><span data-stu-id="ecf39-180">However, the logged-in user that has the custom "canEdit" role can access a restricted page in order to add and remove products.</span></span>

#### <a name="add-an-administration-folder-and-page"></a><span data-ttu-id="ecf39-181">Добавьте папку администрирования и страницы</span><span class="sxs-lookup"><span data-stu-id="ecf39-181">Add an Administration Folder and Page</span></span>

<span data-ttu-id="ecf39-182">Далее вы создадите папку с именем *администратора* для пользователя «canEditUser», в пользовательскую роль Wingtip Toys пример приложения.</span><span class="sxs-lookup"><span data-stu-id="ecf39-182">Next, you will create a folder named *Admin* for the "canEditUser" user belonging to the custom role of the Wingtip Toys sample application.</span></span>

1. <span data-ttu-id="ecf39-183">Щелкните правой кнопкой мыши имя проекта (**Wingtip Toys**) в **обозревателе решений** и выберите **добавить**  - &gt; **новую папку**.</span><span class="sxs-lookup"><span data-stu-id="ecf39-183">Right-click the project name (**Wingtip Toys**) in **Solution Explorer** and select **Add** -&gt; **New Folder**.</span></span>
2. <span data-ttu-id="ecf39-184">Назовите новую папку *администратора*.</span><span class="sxs-lookup"><span data-stu-id="ecf39-184">Name the new folder *Admin*.</span></span>
3. <span data-ttu-id="ecf39-185">Щелкните правой кнопкой мыши *администратора* папку, а затем выберите **добавить**  - &gt; **новый элемент**.</span><span class="sxs-lookup"><span data-stu-id="ecf39-185">Right-click the *Admin* folder and then select **Add** -&gt; **New Item**.</span></span>   
   <span data-ttu-id="ecf39-186">Откроется диалоговое окно **Добавление нового элемента**.</span><span class="sxs-lookup"><span data-stu-id="ecf39-186">The **Add New Item** dialog box is displayed.</span></span>
4. <span data-ttu-id="ecf39-187">Выберите <strong>Visual C#</strong> - &gt; <strong>Web</strong> группы шаблонов в левой части.</span><span class="sxs-lookup"><span data-stu-id="ecf39-187">Select the <strong>Visual C#</strong>-&gt; <strong>Web</strong> templates group on the left.</span></span> <span data-ttu-id="ecf39-188">В среднем списке выберите <strong>веб-форма с главной страницы</strong>, назовите его <em>AdminPage.aspx</em><strong>,</strong> , а затем выберите <strong>добавить</strong>.</span><span class="sxs-lookup"><span data-stu-id="ecf39-188">From the middle list, select <strong>Web Form with Master Page</strong>,name it <em>AdminPage.aspx</em><strong>,</strong> and then select <strong>Add</strong>.</span></span>
5. <span data-ttu-id="ecf39-189">Выберите *Site.Master* файл в формате главной страницы, а затем выберите **ОК**.</span><span class="sxs-lookup"><span data-stu-id="ecf39-189">Select the *Site.Master* file as the master page, and then choose **OK**.</span></span>

#### <a name="add-a-webconfig-file"></a><span data-ttu-id="ecf39-190">Добавьте файл Web.config</span><span class="sxs-lookup"><span data-stu-id="ecf39-190">Add a Web.config File</span></span>

<span data-ttu-id="ecf39-191">Добавив *Web.config* файл *администратора* папки, можно ограничить доступ к странице, содержащиеся в папке.</span><span class="sxs-lookup"><span data-stu-id="ecf39-191">By adding a *Web.config* file to the *Admin* folder, you can restrict access to the page contained in the folder.</span></span>

1. <span data-ttu-id="ecf39-192">Щелкните правой кнопкой мыши *администратора* папку и выберите **добавить**  - &gt; **новый элемент**.</span><span class="sxs-lookup"><span data-stu-id="ecf39-192">Right-click the *Admin* folder and select **Add** -&gt; **New Item**.</span></span>  
   <span data-ttu-id="ecf39-193">Откроется диалоговое окно **Добавление нового элемента**.</span><span class="sxs-lookup"><span data-stu-id="ecf39-193">The **Add New Item** dialog box is displayed.</span></span>
2. <span data-ttu-id="ecf39-194">В списке веб-шаблонов Visual C#, выберите <strong>файл веб-конфигурации</strong>из списке по центру, примите имя по умолчанию <em>Web.config</em><strong>,</strong> , а затем выберите <strong>Добавить</strong>.</span><span class="sxs-lookup"><span data-stu-id="ecf39-194">From the list of Visual C# web templates, select <strong>Web Configuration File</strong>from the middle list, accept the default name of <em>Web.config</em><strong>,</strong> and then select <strong>Add</strong>.</span></span>
3. <span data-ttu-id="ecf39-195">Замените существующий XML-содержимое в *Web.config* файл со следующими:</span><span class="sxs-lookup"><span data-stu-id="ecf39-195">Replace the existing XML content in the *Web.config* file with the following:</span></span>  

    [!code-xml[Main](membership-and-administration/samples/sample4.xml)]

<span data-ttu-id="ecf39-196">Сохранить *Web.config* файл.</span><span class="sxs-lookup"><span data-stu-id="ecf39-196">Save the *Web.config* file.</span></span> <span data-ttu-id="ecf39-197">*Web.config* указывает файл, только пользователь, принадлежащих роли «canEdit» приложения можно получить доступ к странице, содержащихся в *администратора* папки.</span><span class="sxs-lookup"><span data-stu-id="ecf39-197">The *Web.config* file specifies that only user belonging to the "canEdit" role of the application can access the page contained in the *Admin* folder.</span></span>

### <a name="including-custom-role-navigation"></a><span data-ttu-id="ecf39-198">Включая навигации пользовательской роли</span><span class="sxs-lookup"><span data-stu-id="ecf39-198">Including Custom Role Navigation</span></span>

<span data-ttu-id="ecf39-199">Чтобы разрешить пользователю роли пользовательских «canEdit» перейдите в раздел администрирования приложения, необходимо добавить ссылку на *Site.Master* страницы.</span><span class="sxs-lookup"><span data-stu-id="ecf39-199">To enable the user of the custom "canEdit" role to navigate to the administration section of the application, you must add a link to the *Site.Master* page.</span></span> <span data-ttu-id="ecf39-200">Пользователям, принадлежащим к роли «canEdit», будут видеть только **администратора** связь и получить доступ к области администрирования.</span><span class="sxs-lookup"><span data-stu-id="ecf39-200">Only users that belong to the "canEdit" role will be able to see the **Admin** link and access the administration section.</span></span>

1. <span data-ttu-id="ecf39-201">В обозревателе решений, найдите и откройте *Site.Master* страницы.</span><span class="sxs-lookup"><span data-stu-id="ecf39-201">In Solution Explorer, find and open the *Site.Master* page.</span></span>
2. <span data-ttu-id="ecf39-202">Чтобы создать связь для пользователя на роль «canEdit», добавьте разметку, выделена желтым в следующем неупорядоченный список `<ul>` элемент для отображения списка как следует:</span><span class="sxs-lookup"><span data-stu-id="ecf39-202">To create a link for the user of the "canEdit" role, add the markup highlighted in yellow to the following unordered list `<ul>` element so that the list appears as follows:</span></span>  

    [!code-html[Main](membership-and-administration/samples/sample5.html?highlight=2-3)]
3. <span data-ttu-id="ecf39-203">Откройте *Site.Master.cs* файла.</span><span class="sxs-lookup"><span data-stu-id="ecf39-203">Open the *Site.Master.cs* file.</span></span> <span data-ttu-id="ecf39-204">Сделать **администратора** видимы только пользователю «canEditUser» путем добавления кода, они выделены желтым цветом, чтобы ссылка `Page_Load` обработчика.</span><span class="sxs-lookup"><span data-stu-id="ecf39-204">Make the **Admin** link visible only to the "canEditUser" user by adding the code highlighted in yellow to the `Page_Load` handler.</span></span> <span data-ttu-id="ecf39-205">`Page_Load` Обработчик будет выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="ecf39-205">The `Page_Load` handler will appear as follows:</span></span>   

    [!code-csharp[Main](membership-and-administration/samples/sample6.cs?highlight=3-6)]

<span data-ttu-id="ecf39-206">При загрузке страницы, код проверяет, имеет ли пользователь войти в роль «canEdit».</span><span class="sxs-lookup"><span data-stu-id="ecf39-206">When the page loads, the code checks whether the logged-in user has the role of "canEdit".</span></span> <span data-ttu-id="ecf39-207">Если пользователь принадлежит к роли «canEdit», элемент span, содержащий ссылку, чтобы *AdminPage.aspx* страница (и, следовательно, ссылки внутри диапазона) является видимым.</span><span class="sxs-lookup"><span data-stu-id="ecf39-207">If the user belongs to the "canEdit" role, the span element containing the link to the *AdminPage.aspx* page (and consequently the link inside the span) is made visible.</span></span>

### <a name="enabling-product-administration"></a><span data-ttu-id="ecf39-208">Включение администрирования продукта</span><span class="sxs-lookup"><span data-stu-id="ecf39-208">Enabling Product Administration</span></span>

<span data-ttu-id="ecf39-209">На данный момент вы создали на роль «canEdit» и добавили пользователь с правами «canEditUser», в папку администрирования и страницу администрирования.</span><span class="sxs-lookup"><span data-stu-id="ecf39-209">So far, you have created the "canEdit" role and added an "canEditUser" user, an administration folder, and an administration page.</span></span> <span data-ttu-id="ecf39-210">Вы задали права доступа для администрирования папки и страницы и добавили ссылку навигации для пользователя на роль «canEdit» в приложение.</span><span class="sxs-lookup"><span data-stu-id="ecf39-210">You have set access rights for the administration folder and page, and have added a navigation link for the user of the "canEdit" role to the application.</span></span> <span data-ttu-id="ecf39-211">Далее, добавьте разметку для *AdminPage.aspx* странице и кода для *AdminPage.aspx.cs* файл с выделенным кодом, который позволит пользователям с ролью «canEdit» для добавления и удаления продуктов.</span><span class="sxs-lookup"><span data-stu-id="ecf39-211">Next, you will add markup to the *AdminPage.aspx* page and code to the *AdminPage.aspx.cs* code-behind file that will enable the user with the "canEdit" role to add and remove products.</span></span>

1. <span data-ttu-id="ecf39-212">В **обозревателе решений**откройте *AdminPage.aspx* файла из *администратора* папки.</span><span class="sxs-lookup"><span data-stu-id="ecf39-212">In **Solution Explorer**, open the *AdminPage.aspx* file from the *Admin* folder.</span></span>
2. <span data-ttu-id="ecf39-213">Замените существующую разметку следующей:</span><span class="sxs-lookup"><span data-stu-id="ecf39-213">Replace the existing markup with the following:</span></span>  

    [!code-aspx[Main](membership-and-administration/samples/sample7.aspx)]
3. <span data-ttu-id="ecf39-214">Затем откройте *AdminPage.aspx.cs* файл с выделенным кодом щелкните правой кнопкой мыши *AdminPage.aspx* и щелкнув **Просмотр кода**.</span><span class="sxs-lookup"><span data-stu-id="ecf39-214">Next, open the *AdminPage.aspx.cs* code-behind file by right-clicking the *AdminPage.aspx* and clicking **View Code**.</span></span>
4. <span data-ttu-id="ecf39-215">Замените существующий код в *AdminPage.aspx.cs* файл с выделенным кодом следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="ecf39-215">Replace the existing code in the *AdminPage.aspx.cs* code-behind file with the following code:</span></span>  

    [!code-csharp[Main](membership-and-administration/samples/sample8.cs)]

<span data-ttu-id="ecf39-216">В коде, который был выбран для *AdminPage.aspx.cs* файл кода программной части класс с именем `AddProducts` выполняет фактическую работу добавления продуктов в базе данных.</span><span class="sxs-lookup"><span data-stu-id="ecf39-216">In the code that you entered for the *AdminPage.aspx.cs* code-behind file, a class called `AddProducts` does the actual work of adding products to the database.</span></span> <span data-ttu-id="ecf39-217">Этот класс еще не создан, можно будет создать его сейчас.</span><span class="sxs-lookup"><span data-stu-id="ecf39-217">This class doesn't exist yet, so you will create it now.</span></span>

1. <span data-ttu-id="ecf39-218">В **обозревателе решений**, щелкните правой кнопкой мыши *логики* папку, а затем выберите **добавить**  - &gt; **новый элемент**.</span><span class="sxs-lookup"><span data-stu-id="ecf39-218">In **Solution Explorer**, right-click the *Logic* folder and then select **Add** -&gt; **New Item**.</span></span>   
   <span data-ttu-id="ecf39-219">Откроется диалоговое окно **Добавление нового элемента**.</span><span class="sxs-lookup"><span data-stu-id="ecf39-219">The **Add New Item** dialog box is displayed.</span></span>
2. <span data-ttu-id="ecf39-220">Выберите **Visual C#**  - &gt; **кода** группы шаблонов в левой части.</span><span class="sxs-lookup"><span data-stu-id="ecf39-220">Select the **Visual C#** -&gt; **Code** templates group on the left.</span></span> <span data-ttu-id="ecf39-221">Выберите **класс**из середины списка и назовите его *AddProducts.cs*.</span><span class="sxs-lookup"><span data-stu-id="ecf39-221">Then, select **Class**from the middle list and name it *AddProducts.cs*.</span></span>   
   <span data-ttu-id="ecf39-222">Откроется новый файл класса.</span><span class="sxs-lookup"><span data-stu-id="ecf39-222">The new class file is displayed.</span></span>
3. <span data-ttu-id="ecf39-223">Замените существующий код следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="ecf39-223">Replace the existing code with the following:</span></span>  

    [!code-csharp[Main](membership-and-administration/samples/sample9.cs)]

<span data-ttu-id="ecf39-224">*AdminPage.aspx* страница позволяет пользователям, принадлежащих роли «canEdit», для добавления и удаления продуктов.</span><span class="sxs-lookup"><span data-stu-id="ecf39-224">The *AdminPage.aspx* page allows the user belonging to the "canEdit" role to add and remove products.</span></span> <span data-ttu-id="ecf39-225">При добавлении нового продукта, сведения о продукте, проверяются и затем вводить в базу данных.</span><span class="sxs-lookup"><span data-stu-id="ecf39-225">When a new product is added, the details about the product are validated and then entered into the database.</span></span> <span data-ttu-id="ecf39-226">Новый продукт сразу становятся доступными для всех пользователей веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="ecf39-226">The new product is immediately available to all users of the web application.</span></span>

#### <a name="unobtrusive-validation"></a><span data-ttu-id="ecf39-227">Малозаметная проверка</span><span class="sxs-lookup"><span data-stu-id="ecf39-227">Unobtrusive Validation</span></span>

<span data-ttu-id="ecf39-228">Сведения о продукте, предоставленные пользователем на *AdminPage.aspx* страницы проверяются с помощью элементов управления проверки (`RequiredFieldValidator` и `RegularExpressionValidator`).</span><span class="sxs-lookup"><span data-stu-id="ecf39-228">The product details that the user provides on the *AdminPage.aspx* page are validated using validation controls (`RequiredFieldValidator` and `RegularExpressionValidator`).</span></span> <span data-ttu-id="ecf39-229">Эти элементы управления автоматически использовать скрипт ненавязчивой проверки.</span><span class="sxs-lookup"><span data-stu-id="ecf39-229">These controls automatically use unobtrusive validation.</span></span> <span data-ttu-id="ecf39-230">Малозаметная проверка позволяет использовать JavaScript для логики проверки на стороне клиента, это означает, что страницы требует обработки на сервер для проверки элементов управления проверки.</span><span class="sxs-lookup"><span data-stu-id="ecf39-230">Unobtrusive validation allows the validation controls to use JavaScript for client-side validation logic, which means the page does not require a trip to the server to be validated.</span></span> <span data-ttu-id="ecf39-231">По умолчанию скрипт ненавязчивой проверки включается в *Web.config* файла на основании следующий параметр конфигурации:</span><span class="sxs-lookup"><span data-stu-id="ecf39-231">By default, unobtrusive validation is included in the *Web.config* file based on the following configuration setting:</span></span>

[!code-xml[Main](membership-and-administration/samples/sample10.xml)]

#### <a name="regular-expressions"></a><span data-ttu-id="ecf39-232">Регулярные выражения</span><span class="sxs-lookup"><span data-stu-id="ecf39-232">Regular Expressions</span></span>

<span data-ttu-id="ecf39-233">Цена продукта на *AdminPage.aspx* страницы проверяется с использованием **RegularExpressionValidator** элемента управления.</span><span class="sxs-lookup"><span data-stu-id="ecf39-233">The product price on the *AdminPage.aspx* page is validated using a **RegularExpressionValidator** control.</span></span> <span data-ttu-id="ecf39-234">Этот элемент управления проверяет, является ли значение связанного элемента управления ввода (текстовое поле «AddProductPrice») соответствует шаблону, заданному регулярным выражением.</span><span class="sxs-lookup"><span data-stu-id="ecf39-234">This control validates whether the value of the associated input control (the "AddProductPrice" TextBox) matches the pattern specified by the regular expression.</span></span> <span data-ttu-id="ecf39-235">Регулярное выражение представляет нотация сопоставления шаблонов, позволяющий быстро находить и соответствует определенных шаблонов символов.</span><span class="sxs-lookup"><span data-stu-id="ecf39-235">A regular expression is a pattern-matching notation that enables you to quickly find and match specific character patterns.</span></span> <span data-ttu-id="ecf39-236">**RegularExpressionValidator** управления включает в себя свойство с именем `ValidationExpression` , содержащий регулярное выражение, используемое для проверки ввода цены, как показано ниже:</span><span class="sxs-lookup"><span data-stu-id="ecf39-236">The **RegularExpressionValidator** control includes a property named `ValidationExpression` that contains the regular expression used to validate price input, as shown below:</span></span>

[!code-aspx[Main](membership-and-administration/samples/sample11.aspx)]

#### <a name="fileupload-control"></a><span data-ttu-id="ecf39-237">Элемента управления fileUpload</span><span class="sxs-lookup"><span data-stu-id="ecf39-237">FileUpload Control</span></span>

<span data-ttu-id="ecf39-238">В дополнение к ввод и проверку элементов управления, вы добавили **FileUpload** управления *AdminPage.aspx* страницы.</span><span class="sxs-lookup"><span data-stu-id="ecf39-238">In addition to the input and validation controls, you added the **FileUpload** control to the *AdminPage.aspx* page.</span></span> <span data-ttu-id="ecf39-239">Этот элемент управления предоставляет возможность передачи файлов.</span><span class="sxs-lookup"><span data-stu-id="ecf39-239">This control provides the capability to upload files.</span></span> <span data-ttu-id="ecf39-240">В этом случае только позволяет пользователям файлы изображений для отправки.</span><span class="sxs-lookup"><span data-stu-id="ecf39-240">In this case, you are only allowing image files to be uploaded.</span></span> <span data-ttu-id="ecf39-241">В файл с выделенным кодом (*AdminPage.aspx.cs*), когда `AddProductButton` выбран, этот код проверяет `HasFile` свойство **FileUpload** элемента управления.</span><span class="sxs-lookup"><span data-stu-id="ecf39-241">In the code-behind file (*AdminPage.aspx.cs*), when the `AddProductButton` is clicked, the code checks the `HasFile` property of the **FileUpload** control.</span></span> <span data-ttu-id="ecf39-242">Если элемент управления имеет файл, и если разрешено тип файла (с учетом расширения файла), изображение будет сохранен *образы* папки и *изображений и эскизов* папку приложения.</span><span class="sxs-lookup"><span data-stu-id="ecf39-242">If the control has a file and if the file type (based on file extension) is allowed, the image is saved to the *Images* folder and the *Images/Thumbs* folder of the application.</span></span>

#### <a name="model-binding"></a><span data-ttu-id="ecf39-243">Привязка модели</span><span class="sxs-lookup"><span data-stu-id="ecf39-243">Model Binding</span></span>

<span data-ttu-id="ecf39-244">Ранее в этой серии руководств используется привязка модели для заполнения **ListView** управления **FormsView** управления **GridView** элемента управления и  **DetailView** элемента управления.</span><span class="sxs-lookup"><span data-stu-id="ecf39-244">Earlier in this tutorial series you used model binding to populate a **ListView** control, a **FormsView** control, a **GridView** control, and a **DetailView** control.</span></span> <span data-ttu-id="ecf39-245">В этом руководстве используется привязка модели для заполнения **DropDownList** управления со списком категорий продуктов.</span><span class="sxs-lookup"><span data-stu-id="ecf39-245">In this tutorial, you use model binding to populate a **DropDownList** control with a list of product categories.</span></span>

<span data-ttu-id="ecf39-246">Разметка, добавленный к *AdminPage.aspx* файл содержит **DropDownList** элемент управления под названием `DropDownAddCategory`:</span><span class="sxs-lookup"><span data-stu-id="ecf39-246">The markup that you added to the *AdminPage.aspx* file contains a **DropDownList** control called `DropDownAddCategory`:</span></span>

[!code-aspx[Main](membership-and-administration/samples/sample12.aspx)]

<span data-ttu-id="ecf39-247">Привязка модели используется для заполнения это **DropDownList** , задав `ItemType` атрибут и `SelectMethod` атрибута.</span><span class="sxs-lookup"><span data-stu-id="ecf39-247">You use model binding to populate this **DropDownList** by setting the `ItemType` attribute and the `SelectMethod` attribute.</span></span> <span data-ttu-id="ecf39-248">`ItemType` Атрибут указывает, что используется `WingtipToys.Models.Category` введите при заполнении элемента управления.</span><span class="sxs-lookup"><span data-stu-id="ecf39-248">The `ItemType` attribute specifies that you use the `WingtipToys.Models.Category` type when populating the control.</span></span> <span data-ttu-id="ecf39-249">Определен этот тип в начале этой серии руководств, создав `Category` класса (см. ниже).</span><span class="sxs-lookup"><span data-stu-id="ecf39-249">You defined this type at the beginning of this tutorial series by creating the `Category` class (shown below).</span></span> <span data-ttu-id="ecf39-250">`Category` Класс находится в *моделей* папки внутри *Category.cs* файла.</span><span class="sxs-lookup"><span data-stu-id="ecf39-250">The `Category` class is in the *Models* folder inside the *Category.cs* file.</span></span>

[!code-csharp[Main](membership-and-administration/samples/sample13.cs)]

<span data-ttu-id="ecf39-251">`SelectMethod` Атрибут **DropDownList** управления указывает, что `GetCategories` метод (см. ниже) то есть включен в файл с выделенным кодом (*AdminPage.aspx.cs*).</span><span class="sxs-lookup"><span data-stu-id="ecf39-251">The `SelectMethod` attribute of the **DropDownList** control specifies that you use the `GetCategories` method (shown below) that is included in the code-behind file (*AdminPage.aspx.cs*).</span></span>

[!code-csharp[Main](membership-and-administration/samples/sample14.cs)]

<span data-ttu-id="ecf39-252">Этот метод указывает, что `IQueryable` интерфейс используется для оценки нужно выполнить запрос `Category` типа.</span><span class="sxs-lookup"><span data-stu-id="ecf39-252">This method specifies that an `IQueryable` interface is used to evaluate a query against a `Category` type.</span></span> <span data-ttu-id="ecf39-253">Возвращаемое значение используется для заполнения **DropDownList** в разметке страницы (*AdminPage.aspx*).</span><span class="sxs-lookup"><span data-stu-id="ecf39-253">The returned value is used to populate the **DropDownList** in the markup of the page (*AdminPage.aspx*).</span></span>

<span data-ttu-id="ecf39-254">Текст, отображаемый для каждого элемента в списке указывается, задав `DataTextField` атрибута.</span><span class="sxs-lookup"><span data-stu-id="ecf39-254">The text displayed for each item in the list is specified by setting the `DataTextField` attribute.</span></span> <span data-ttu-id="ecf39-255">`DataTextField` Атрибут использует `CategoryName` из `Category` (как показано выше) для отображения каждой категории в класс **DropDownList** элемента управления.</span><span class="sxs-lookup"><span data-stu-id="ecf39-255">The `DataTextField` attribute uses the `CategoryName` of the `Category` class (shown above) to display each category in the **DropDownList** control.</span></span> <span data-ttu-id="ecf39-256">Фактическое значение, которое передается при выборе элемента в **DropDownList** управления основан на `DataValueField` атрибута.</span><span class="sxs-lookup"><span data-stu-id="ecf39-256">The actual value that is passed when an item is selected in the **DropDownList** control is based on the `DataValueField` attribute.</span></span> <span data-ttu-id="ecf39-257">`DataValueField` Атрибуту присваивается `CategoryID` определении в `Category` класс (как показано выше).</span><span class="sxs-lookup"><span data-stu-id="ecf39-257">The `DataValueField` attribute is set to the `CategoryID` as define in the `Category` class (shown above).</span></span>

### <a name="how-the-application-will-work"></a><span data-ttu-id="ecf39-258">Как приложение будет работать</span><span class="sxs-lookup"><span data-stu-id="ecf39-258">How the Application Will Work</span></span>

<span data-ttu-id="ecf39-259">Когда пользователь, принадлежащий к роли «canEdit» переход к странице в первый раз `DropDownAddCategory` **DropDownList** управления заполняется в том случае, как описано выше.</span><span class="sxs-lookup"><span data-stu-id="ecf39-259">When the user belonging to the "canEdit" role navigates to the page for the first time, the `DropDownAddCategory`**DropDownList** control is populated as described above.</span></span> <span data-ttu-id="ecf39-260">`DropDownRemoveProduct` **DropDownList** продуктов, используя тот же подход также заполнением элемента управления.</span><span class="sxs-lookup"><span data-stu-id="ecf39-260">The `DropDownRemoveProduct`**DropDownList** control is also populated with products using the same approach.</span></span> <span data-ttu-id="ecf39-261">Пользователь, принадлежащий к роли «canEdit» выбирает тип категории и добавляет сведения о продукте (**имя**, **описание**, **цена**, и **файл изображения**).</span><span class="sxs-lookup"><span data-stu-id="ecf39-261">The user belonging to the "canEdit" role selects the category type and adds product details (**Name**, **Description**, **Price**, and **Image File**).</span></span> <span data-ttu-id="ecf39-262">При нажатии пользователем, принадлежащих роли «canEdit» **добавить продукт** кнопки `AddProductButton_Click` активируется, обработчик событий.</span><span class="sxs-lookup"><span data-stu-id="ecf39-262">When the user belonging to the "canEdit" role clicks the **Add Product** button, the `AddProductButton_Click` event handler is triggered.</span></span> <span data-ttu-id="ecf39-263">`AddProductButton_Click` Обработчик событий находится в файле кода (*AdminPage.aspx.cs*) проверяет файл изображения, чтобы убедитесь, что он соответствует допустимые типы файлов *(.gif*, *.png*, *.jpeg*, или *.jpg*).</span><span class="sxs-lookup"><span data-stu-id="ecf39-263">The `AddProductButton_Click` event handler located in the code-behind file (*AdminPage.aspx.cs*) checks the image file to make sure it matches the allowed file types *(.gif*, *.png*, *.jpeg*, or *.jpg*).</span></span> <span data-ttu-id="ecf39-264">Выберите файл изображения сохраняется в папку образца приложения Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="ecf39-264">Then, the image file is saved into a folder of the Wingtip Toys sample application.</span></span> <span data-ttu-id="ecf39-265">После этого нового продукта добавляется в базу данных.</span><span class="sxs-lookup"><span data-stu-id="ecf39-265">Next, the new product is added to the database.</span></span> <span data-ttu-id="ecf39-266">Чтобы добавить новый продукт, новый экземпляр класса `AddProducts` класса с именами продуктов.</span><span class="sxs-lookup"><span data-stu-id="ecf39-266">To accomplish adding a new product, a new instance of the `AddProducts` class is created and named products.</span></span> <span data-ttu-id="ecf39-267">`AddProducts` Класс содержит метод с именем `AddProduct`, и объект продуктов вызывает этот метод, чтобы добавить продукты в базу данных.</span><span class="sxs-lookup"><span data-stu-id="ecf39-267">The `AddProducts` class has a method named `AddProduct`, and the products object calls this method to add products to the database.</span></span>

[!code-csharp[Main](membership-and-administration/samples/sample15.cs)]

<span data-ttu-id="ecf39-268">Если код успешно добавляет новый продукт в базу данных, с помощью значения строки запроса перезагрузке страницы `ProductAction=add`.</span><span class="sxs-lookup"><span data-stu-id="ecf39-268">If the code successfully adds the new product to the database, the page is reloaded with the query string value `ProductAction=add`.</span></span>

[!code-csharp[Main](membership-and-administration/samples/sample16.cs)]

<span data-ttu-id="ecf39-269">Когда страница повторно загружается, строка запроса включается в URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="ecf39-269">When the page reloads, the query string is included in the URL.</span></span> <span data-ttu-id="ecf39-270">Путем перезагрузки страницы, пользователя, принадлежащего к роли «canEdit» сразу можно увидеть обновления в **DropDownList** элементов управления в *AdminPage.aspx* страницы.</span><span class="sxs-lookup"><span data-stu-id="ecf39-270">By reloading the page, the user belonging to the "canEdit" role can immediately see the updates in the **DropDownList** controls on the *AdminPage.aspx* page.</span></span> <span data-ttu-id="ecf39-271">Кроме того, включая строку запроса URL-адрес, на странице может отображаться сообщение об успешном выполнении пользователю, принадлежащему к роли «canEdit».</span><span class="sxs-lookup"><span data-stu-id="ecf39-271">Also, by including the query string with the URL, the page can display a success message to the user belonging to the "canEdit" role.</span></span>

<span data-ttu-id="ecf39-272">Когда *AdminPage.aspx* странице перезагрузок, `Page_Load` вызова события.</span><span class="sxs-lookup"><span data-stu-id="ecf39-272">When the *AdminPage.aspx* page reloads, the `Page_Load` event is called.</span></span>

[!code-csharp[Main](membership-and-administration/samples/sample17.cs)]

<span data-ttu-id="ecf39-273">`Page_Load` Обработчик событий проверяет значение строки запроса и определяет, следует ли отображать сообщение об успешном выполнении.</span><span class="sxs-lookup"><span data-stu-id="ecf39-273">The `Page_Load` event handler checks the query string value and determines whether to show a success message.</span></span>

## <a name="running-the-application"></a><span data-ttu-id="ecf39-274">Запуск приложения</span><span class="sxs-lookup"><span data-stu-id="ecf39-274">Running the Application</span></span>

<span data-ttu-id="ecf39-275">В корзине можно запустить приложение сейчас, чтобы увидеть, как можно добавить, удаления и обновления элементов.</span><span class="sxs-lookup"><span data-stu-id="ecf39-275">You can run the application now to see how you can add, delete, and update items in the shopping cart.</span></span> <span data-ttu-id="ecf39-276">Корзина для покупок всего будет отражать Общая стоимость всех элементов в корзине.</span><span class="sxs-lookup"><span data-stu-id="ecf39-276">The shopping cart total will reflect the total cost of all items in the shopping cart.</span></span>

1. <span data-ttu-id="ecf39-277">В обозревателе решений нажмите клавишу **F5** запустить пример приложения Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="ecf39-277">In Solution Explorer, press **F5** to run the Wingtip Toys sample application.</span></span>  
   <span data-ttu-id="ecf39-278">Откроется браузер и показывает *Default.aspx* страницы.</span><span class="sxs-lookup"><span data-stu-id="ecf39-278">The browser opens and shows the *Default.aspx* page.</span></span>
2. <span data-ttu-id="ecf39-279">Нажмите кнопку **вход** ссылку в верхней части страницы.</span><span class="sxs-lookup"><span data-stu-id="ecf39-279">Click the **Log in** link at the top of the page.</span></span> 

    ![Членство и Администрирование - журнала в ссылке](membership-and-administration/_static/image2.png)

   <span data-ttu-id="ecf39-281">*Login.aspx* откроется страница.</span><span class="sxs-lookup"><span data-stu-id="ecf39-281">The *Login.aspx* page is displayed.</span></span>
3. <span data-ttu-id="ecf39-282">Используйте следующие имя пользователя и пароль:</span><span class="sxs-lookup"><span data-stu-id="ecf39-282">Use the following user name and password:</span></span>  
   <span data-ttu-id="ecf39-283">Имя пользователя: canEditUser@wingtiptoys.com</span><span class="sxs-lookup"><span data-stu-id="ecf39-283">User name: canEditUser@wingtiptoys.com</span></span>  
   <span data-ttu-id="ecf39-284">Пароль. PA$ $word1</span><span class="sxs-lookup"><span data-stu-id="ecf39-284">Password: Pa$$word1</span></span> 

    ![Членство и администрирование - страница входа](membership-and-administration/_static/image3.png)
4. <span data-ttu-id="ecf39-286">Нажмите кнопку **вход** кнопки в нижней части страницы.</span><span class="sxs-lookup"><span data-stu-id="ecf39-286">Click the **Log in** button near the bottom of the page.</span></span>
5. <span data-ttu-id="ecf39-287">В верхней части следующей страницы, выберите **администратора** ссылку для перехода к *AdminPage.aspx* страницы.</span><span class="sxs-lookup"><span data-stu-id="ecf39-287">At the top of the next page, select the **Admin** link to navigate to the *AdminPage.aspx* page.</span></span> 

    ![Членство и администрирование - Admin ссылку](membership-and-administration/_static/image4.png)
6. <span data-ttu-id="ecf39-289">Чтобы протестировать проверку входных данных, нажмите кнопку **добавить продукт** кнопки без добавления любые сведения о продукте.</span><span class="sxs-lookup"><span data-stu-id="ecf39-289">To test the input validation, click the **Add Product** button without adding any product details.</span></span> 

    ![Членство и администрирование - страницы администрирования](membership-and-administration/_static/image5.png)

   <span data-ttu-id="ecf39-291">Обратите внимание на то, что отображаются сообщения обязательное поле.</span><span class="sxs-lookup"><span data-stu-id="ecf39-291">Notice that the required field messages are displayed.</span></span>
7. <span data-ttu-id="ecf39-292">Добавьте сведения для нового продукта и нажмите кнопку **добавить продукт** кнопки.</span><span class="sxs-lookup"><span data-stu-id="ecf39-292">Add the details for a new product, and then click the **Add Product** button.</span></span> 

    ![Членство и администрирование: Добавление продукта](membership-and-administration/_static/image6.png)
8. <span data-ttu-id="ecf39-294">Выберите **продуктов** из меню навигации вверху, чтобы просмотреть новый продукт был добавлен.</span><span class="sxs-lookup"><span data-stu-id="ecf39-294">Select **Products** from the top navigation menu to view the new product you added.</span></span> 

    ![Членство и администрирование - Показать новый продукт](membership-and-administration/_static/image7.png)
9. <span data-ttu-id="ecf39-296">Нажмите кнопку **администратора** ссылку, чтобы вернуться на страницу администрирования.</span><span class="sxs-lookup"><span data-stu-id="ecf39-296">Click the **Admin** link to return to the administration page.</span></span>
10. <span data-ttu-id="ecf39-297">В **удалить продукт** раздел страницы, выберите новый продукт, добавленный в **DropDownListBox**.</span><span class="sxs-lookup"><span data-stu-id="ecf39-297">In the **Remove Product** section of the page, select the new product you added in the **DropDownListBox**.</span></span>
11. <span data-ttu-id="ecf39-298">Нажмите кнопку **удалить продукт** кнопку, чтобы удалить новый продукт из приложения.</span><span class="sxs-lookup"><span data-stu-id="ecf39-298">Click the **Remove Product** button to remove the new product from the application.</span></span> 

    ![Членство и администрирование — удаление продукта](membership-and-administration/_static/image8.png)
12. <span data-ttu-id="ecf39-300">Выберите **продуктов** в меню навигации вверху, чтобы убедиться, что продукт был удален.</span><span class="sxs-lookup"><span data-stu-id="ecf39-300">Select **Products** from the top navigation menu to confirm that the product has been removed.</span></span>
13. <span data-ttu-id="ecf39-301">Нажмите кнопку **выйти** существует режим администрирования.</span><span class="sxs-lookup"><span data-stu-id="ecf39-301">Click **Log off** to exist administration mode.</span></span>   
    <span data-ttu-id="ecf39-302">Обратите внимание, что больше не отображается на панели навигации вверху **администратора** пункта меню.</span><span class="sxs-lookup"><span data-stu-id="ecf39-302">Notice that the top navigation pane no longer shows the **Admin** menu item.</span></span>

## <a name="summary"></a><span data-ttu-id="ecf39-303">Сводка</span><span class="sxs-lookup"><span data-stu-id="ecf39-303">Summary</span></span>

<span data-ttu-id="ecf39-304">В этом руководстве вы добавили настраиваемую роль и пользователя, принадлежащего к настраиваемой роли, ограниченный доступ к папке администрирования и странице и предоставляются навигации для пользователя, принадлежащего к настраиваемой роли.</span><span class="sxs-lookup"><span data-stu-id="ecf39-304">In this tutorial, you added a custom role and a user belonging to the custom role, restricted access to the administration folder and page, and provided navigation for the user belonging to the custom role.</span></span> <span data-ttu-id="ecf39-305">Привязка модели используется для заполнения **DropDownList** элемента управления данными.</span><span class="sxs-lookup"><span data-stu-id="ecf39-305">You used model binding to populate a **DropDownList** control with data.</span></span> <span data-ttu-id="ecf39-306">Реализованные вами **FileUpload** управления и элементов управления проверки.</span><span class="sxs-lookup"><span data-stu-id="ecf39-306">You implemented the **FileUpload** control and validation controls.</span></span> <span data-ttu-id="ecf39-307">Кроме того вы узнали, как добавлять и удалять продукты из базы данных.</span><span class="sxs-lookup"><span data-stu-id="ecf39-307">Also, you have learned how to add and remove products from a database.</span></span> <span data-ttu-id="ecf39-308">В следующем руководстве вы узнаете, как реализовать маршрутизации ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="ecf39-308">In the next tutorial, you'll learn how to implement ASP.NET routing.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="ecf39-309">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="ecf39-309">Additional Resources</span></span>

<span data-ttu-id="ecf39-310">[Web.config — элемент authorization](https://msdn.microsoft.com/library/8d82143t(v=vs.100).aspx)</span><span class="sxs-lookup"><span data-stu-id="ecf39-310">[Web.config - authorization Element](https://msdn.microsoft.com/library/8d82143t(v=vs.100).aspx)</span></span>  
[<span data-ttu-id="ecf39-311">ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="ecf39-311">ASP.NET Identity</span></span>](../../../../identity/overview/getting-started/introduction-to-aspnet-identity.md)  
[<span data-ttu-id="ecf39-312">Развертывание безопасного веб-форм приложение ASP.NET с членством, OAuth и базой данных SQL Azure веб-узел</span><span class="sxs-lookup"><span data-stu-id="ecf39-312">Deploy a Secure ASP.NET Web Forms App with Membership, OAuth, and SQL Database to an Azure Web Site</span></span>](https://azure.microsoft.com/documentation/articles/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/)  
[<span data-ttu-id="ecf39-313">Microsoft Azure — бесплатная пробная версия</span><span class="sxs-lookup"><span data-stu-id="ecf39-313">Microsoft Azure - Free Trial</span></span>](https://azure.microsoft.com/pricing/free-trial/)

> [!div class="step-by-step"]
> <span data-ttu-id="ecf39-314">[Назад](checkout-and-payment-with-paypal.md)
> [Вперед](url-routing.md)</span><span class="sxs-lookup"><span data-stu-id="ecf39-314">[Previous](checkout-and-payment-with-paypal.md)
[Next](url-routing.md)</span></span>
