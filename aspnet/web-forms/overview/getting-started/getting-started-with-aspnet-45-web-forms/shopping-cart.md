---
uid: web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/shopping-cart
title: Корзина для покупок | Документация Майкрософт
author: Erikre
description: В этой серии руководств будет основы создания приложений веб-форм ASP.NET с помощью ASP.NET 4.5 и Microsoft Visual Studio Express 2013 для мы...
ms.author: riande
ms.date: 09/08/2014
ms.assetid: 6898c601-6c31-432f-8388-e6843f8a17cb
msc.legacyurl: /web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/shopping-cart
msc.type: authoredcontent
ms.openlocfilehash: 1c54449e778eac96133cccdc90d86cbbaf05a70f
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2019
ms.locfileid: "65132112"
---
# <a name="shopping-cart"></a>Корзина для покупок

по [Erik Reitan](https://github.com/Erikre)

[Скачайте пример проекта Wingtip Toys (C#)](http://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) или [скачайте электронную книгу (PDF)](http://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20ASP.NET%204.5%20Web%20Forms%20and%20Visual%20Studio%202013.pdf)

> В этой серии руководств будет основы создания приложений веб-форм ASP.NET с помощью ASP.NET 4.5 и Microsoft Visual Studio Express 2013 для Web. Visual Studio 2013 [проект с исходным кодом C#](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) доступен на следующей странице этой серии руководств.

В данном учебнике бизнес-логику, потребуется для добавления в корзину веб-форм ASP.NET пример приложения Wingtip Toys. Этот учебник основан на предыдущем учебном курсе «Отображение элементов и сведения о данных» и является частью серии руководств Store Toy Wingtip. После завершения этого учебника, пользователей примера приложения будет иметь возможность добавлять, удалять и изменять продукты в корзину.

## <a name="what-youll-learn"></a>Вы узнаете, как:

1. Как создать в корзину веб-приложения.
2. Как разрешить пользователям добавлять элементы в корзину для покупок.
3. Как добавить [GridView](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview(v=vs.110).aspx#introduction) управления для отображения сведений корзину для покупок.
4. Как и отображении итоговой суммы заказа.
5. Удаление и обновление элементов в корзине.
6. Как включить корзину для покупок счетчика.

## <a name="code-features-in-this-tutorial"></a>Код функции в этом руководстве:

1. Платформа Entity Framework Code First
2. Заметки к данным
3. Строго типизированные элементы управления данными
4. Привязка модели

## <a name="creating-a-shopping-cart"></a>Создание корзины для покупок

Ранее в этой серии руководств вы добавили страницы и код для просмотра сведений о продуктах из базы данных. В этом руководстве вы создадите корзины для управления продуктами, что пользователи заинтересованы в приобретении. Пользователи смогут просматривать и добавлять элементы в корзину покупок, даже если они не зарегистрированы или не вошел в систему. Для управления доступом корзины для покупок, можно будет назначить пользователей уникальный `ID` с помощью глобально уникальный идентификатор (GUID), когда пользователь обращается к корзине корзину в первый раз. Мы сохраним это `ID` использования состояния сеанса ASP.NET.

> [!NOTE] 
> 
> Состояние сеанса ASP.NET — удобное место для хранения данных конкретного пользователя, которой истечет после пользователь оставляет сайт. Неправильное использование состояния сеанса может негативно влиять на производительность на больших сайтах, работают и используйте работает состояния сеанса для демонстрационных целей. Пример проекта Wingtip Toys демонстрируется использование состояния сеанса без внешнего поставщика, где хранимая в процессе на сервере веб-сайта состояние сеанса. Для больших сайтах, которые предоставляют несколько экземпляров приложения и сайты, использующие несколько экземпляров приложения на разных серверах, рассмотрите возможность использования **службы кэша Windows Azure**. Эта служба кэширования предоставляет службы распределенного кэширования, внешним по отношению к веб-сайта и позволяет решить проблему с помощью состояния сеанса в процессе. Дополнительные сведения см. [Практическое использование состояния сеанса ASP.NET с помощью Windows Azure Web Sites](https://docs.microsoft.com/azure/redis-cache/cache-aspnet-session-state-provider).

### <a name="add-cartitem-as-a-model-class"></a>Добавить CartItem в качестве класса модели

Ранее в этой серии руководств вы определили схему для данных category и product, создав `Category` и `Product` классы в *моделей* папки. Теперь добавьте новый класс, чтобы определить схему для корзины покупок. Далее в этом учебнике вы добавите класс для обработки доступа к данным `CartItem` таблицы. Этот класс предоставит бизнес-логики, чтобы добавлять, удалять и обновлять элементы в корзине.

1. Щелкните правой кнопкой мыши *моделей* папку и выберите **добавить**  - &gt; **новый элемент**. 

    ![Корзина для покупок - новый элемент](shopping-cart/_static/image1.png)
2. Откроется диалоговое окно **Добавление нового элемента**. Выберите **кода**, а затем выберите **класс**. 

    ![Корзина - новый диалоговое окно добавления элемента](shopping-cart/_static/image2.png)
3. Назовите этот новый класс *CartItem.cs*.
4. Нажмите кнопку **Добавить**.  
   Новый файл класса отображается в редакторе.
5. Замените код по умолчанию следующим кодом:   

    [!code-csharp[Main](shopping-cart/samples/sample1.cs)]

`CartItem` Класс содержит схему, определяющий каждый продукт, пользователь добавляет в корзину покупок. Этот класс похож на другие классы схемы, созданной ранее в этой серии руководств. По соглашению Entity Framework Code First ожидает, что первичный ключ для `CartItem` таблица будет иметь значение `CartItemId` или `ID`. Тем не менее, код переопределяет поведение по умолчанию с помощью заметок к данным `[Key]` атрибута. `Key` Атрибут свойства ItemId указывает, что `ItemID` свойство является первичным ключом.

`CartId` Указывает свойство `ID` пользователя, связанный с элементом для приобретения. Вы добавите код для создания этого пользователя `ID` доступа к корзине для покупок. Это `ID` также будут храниться в виде переменной сеанса ASP.NET.

### <a name="update-the-product-context"></a>Обновить контекст продукта

Помимо добавления `CartItem` класса, необходимо будет обновить класс контекста базы данных, который управляет классы сущностей и который предоставляет доступ к данным к базе данных. Для этого необходимо добавить только что созданный `CartItem` класс для модели `ProductContext` класса.

1. В **обозревателе решений**найдите и откройте *ProductContext.cs* файл *моделей* папки.
2. Добавьте выделенный код, который *ProductContext.cs* файл следующим образом:  

    [!code-csharp[Main](shopping-cart/samples/sample2.cs?highlight=14)]

Как упоминалось ранее в этой серии руководств, код в *ProductContext.cs* добавляет файл `System.Data.Entity` пространства имен таким образом, чтобы у вас есть доступ ко всем функциям платформы Entity Framework core. Эта функция включает в себя возможность запроса, вставки, обновления и удаления данных, работая с строго типизированных объектов. `ProductContext` Класс добавляет доступ к только что добавленного `CartItem` класс модели.

### <a name="managing-the-shopping-cart-business-logic"></a>Управление бизнес-логика корзину для покупок

Далее вы создадите `ShoppingCart` класса в новом *логики* папки. `ShoppingCart` Класс обрабатывает доступ к данным `CartItem` таблицы. Класс также будет включать бизнес-логики, чтобы добавлять, удалять и обновлять элементы в корзине.

Корзина для покупок логику, вы добавите будет содержать функциональные возможности управления следующие действия:

1. Добавление элементов в корзину покупок
2. Удаление элементов из корзины
3. Начало идентификатор корзины для покупок
4. Получение элементов из корзины
5. Группировка объем всех элементов корзины покупок
6. Обновление данных корзины

Корзина для покупок (*ShoppingCart.aspx*) и класс покупательской корзины будет использоваться совместно для доступа к данных корзины. Корзина для покупок эквивалентно отображению всех элементов, которые пользователь добавляет в корзину покупок. Кроме корзины страницы и класса, вы создадите страницу (*AddToCart.aspx*) чтобы добавить продукты в корзину покупок. Также будет добавлен код для *ProductList.aspx* страницы и *ProductDetails.aspx* страницы, который предоставит ссылку *AddToCart.aspx* странице, чтобы добавить пользователя продукты в корзину покупок.

В примере ниже показан базовый процесс, когда пользователь добавляет продукт в корзину покупок.

![Корзина для покупок - Добавление в корзину для покупок](shopping-cart/_static/image3.png)

Когда пользователь щелкает **Add To Cart** ссылку на одном *ProductList.aspx* страницы или *ProductDetails.aspx* страницы, приложение будет переходить к *AddToCart.aspx* страницы и затем автоматически как *ShoppingCart.aspx* страницы. *AddToCart.aspx* страницы будет добавление выберите продукт в корзину покупок путем вызова метода в классе ShoppingCart. *ShoppingCart.aspx* страницы будут отображаться продукты, которые были добавлены в корзину покупок.

#### <a name="creating-the-shopping-cart-class"></a>Создание класс покупательской корзины

`ShoppingCart` Класса будут добавляться в отдельный каталог в приложении, таким образом будет четкое различие между моделью (папку Models), страниц (корневой папке) и логику (папка логики).

1. В **обозревателе решений**, щелкните правой кнопкой мыши **WingtipToys**проекта и выберите **добавить**-&gt;**новую папку**. Назовите новую папку *логики*.
2. Щелкните правой кнопкой мыши *логики* папку, а затем выберите **добавить**  - &gt; **новый элемент**.
3. Добавьте новый файл класса с именем *ShoppingCartActions.cs*.
4. Замените код по умолчанию следующим кодом:   

    [!code-csharp[Main](shopping-cart/samples/sample3.cs)]

`AddToCart` Метод, который позволяет отдельные продукты для включения в список покупок по продукту, `ID`. Добавления продукта в корзину, или если для покупок уже содержит элемент для данного продукта, количество увеличивается.

`GetCartId` Метод возвращает один и тот покупок `ID` для пользователя. Для покупок `ID` используется для отслеживания элементов, которые пользователь имеет в его корзине. Если пользователь не имеет существующих корзины для покупок `ID`, новой корзины для покупок `ID` создается для них. Если пользователь вошел качестве зарегистрированного пользователя, для покупок `ID` имеет значение имени пользователя. Тем не менее если пользователь не выполнил в корзине `ID` присваивается уникальное значение (GUID). Идентификатор GUID гарантирует, что для каждого пользователя, в зависимости от сеанса создается, только один корзины для покупок.

`GetCartItems` Метод возвращает список номенклатуры корзины для покупок для пользователя. Далее в этом руководстве, вы увидите, что привязка модели используется для отображения элементов корзины для покупок в корзину для покупок с помощью `GetCartItems` метод.

### <a name="creating-the-add-to-cart-functionality"></a>Создание функции Add To Cart

Как упоминалось ранее, вы создадите страницу обработки с именем *AddToCart.aspx* , будет использоваться для добавления новых продуктов в корзину пользователя. Эта страница будет вызывать `AddToCart` метод в `ShoppingCart` класс, который вы только что создали. *AddToCart.aspx* страницы ожидают, что продукт `ID` передается в него. Этот продукт `ID` будет использоваться при вызове `AddToCart` метод в `ShoppingCart` класса.

> [!NOTE] 
> 
> Изменение кода (*AddToCart.aspx.cs*) для этой страницы, а не на странице пользовательского интерфейса (*AddToCart.aspx*).

#### <a name="to-create-the-add-to-cart-functionality"></a>Для создания Add-To-Cart функциональные возможности:

1. В **обозревателе решений**, щелкните правой кнопкой мыши **WingtipToys**проекта, щелкните **добавить**  - &gt; **новый элемент**.  
   Откроется диалоговое окно **Добавление нового элемента**.
2. Добавьте стандартный новую страницу (веб-формы) в приложение с именем *AddToCart.aspx*. 

    ![Корзина - добавьте веб-форму](shopping-cart/_static/image4.png)
3. В **обозревателе решений**, щелкните правой кнопкой мыши *AddToCart.aspx* странице и нажмите кнопку **Просмотр кода**. *AddToCart.aspx.cs* кода файл открывается в редакторе.
4. Замените существующий код в *AddToCart.aspx.cs* кода следующим:   

    [!code-csharp[Main](shopping-cart/samples/sample4.cs)]

Когда *AddToCart.aspx* загрузки страницы продукта `ID` извлекается из строки запроса. Далее создается и используется для вызова экземпляра класс покупательской корзины `AddToCart` метод, который вы добавили ранее в этом учебнике. `AddToCart` Метод, содержащихся в *ShoppingCartActions.cs* файл, содержит логику для добавления выбранного продукта в корзину покупок, или увеличить количество продуктов выбранного продукта. Если продукт еще не добавлен в корзину покупок, продукта добавляется в `CartItem` таблицы в базе данных. Если продукт уже добавлен в корзину покупок и пользователь добавляет еще один элемент того же продукта, количество продуктов увеличивается в `CartItem` таблицы. Наконец, страница перенаправляет обратно на *ShoppingCart.aspx* страницы, которую вы добавите в следующем шаге, где пользователь видит обновленный список элементов в корзине.

Как упоминалось ранее, пользователь `ID` используется для определения продуктов, которые связаны с конкретным пользователем. Это `ID` добавляется в строку в `CartItem` таблицы при каждом добавлении продукта в корзину покупок.

### <a name="creating-the-shopping-cart-ui"></a>Создание пользовательского интерфейса в корзину

*ShoppingCart.aspx* страницы будут отображаться продукты, которые пользователь был добавлен в корзину. Также обеспечивается возможность добавлять, удалять и обновлять элементы в корзине.

1. В **обозревателе решений**, щелкните правой кнопкой мыши **WingtipToys**, нажмите кнопку **добавить**  - &gt; **новый элемент**.  
   Откроется диалоговое окно **Добавление нового элемента**.
2. Добавьте новую страницу (веб-формы), который включает эталонную страницу, выбрав **веб-форма, использующая главную страницу**. Имя новой страницы *ShoppingCart.aspx*.
3. Выберите **Site.Master** для присоединения главной страницы к только что созданный *.aspx* страницы.
4. В *ShoppingCart.aspx* страницы, замените существующую разметку следующей разметкой:   

    [!code-aspx[Main](shopping-cart/samples/sample5.aspx)]

*ShoppingCart.aspx* страница содержит **GridView** управления с именем `CartList`. Этот элемент управления использует привязку модели для привязки данных корзины из базы данных, **GridView** элемента управления. При задании `ItemType` свойство **GridView** управления, выражение привязки данных `Item` доступен в разметку элемента управления и элемент управления становится строго типизированными. Как упоминалось ранее в этой серии руководств, можно выбрать сведения о `Item` с помощью IntelliSense. Чтобы настроить элемент управления данные для использования привязки модели для выбора данных, установите `SelectMethod` свойство элемента управления. В приведенный выше код разметки, можно задать `SelectMethod` использовать GetShoppingCartItems метод, возвращающий список `CartItem` объектов. **GridView** управления данных вызывает метод в соответствующее время жизненного цикла страницы и автоматически связывает возвращаемых данных. `GetShoppingCartItems` Метод по-прежнему должен быть добавлен.

#### <a name="retrieving-the-shopping-cart-items"></a>Получение элементов корзины покупок

Затем добавьте код, чтобы *ShoppingCart.aspx.cs* кода для получения и заполнения пользовательский Интерфейс корзины для покупок.

1. В **обозревателе решений**, щелкните правой кнопкой мыши *ShoppingCart.aspx* странице и нажмите кнопку **Просмотр кода**. *ShoppingCart.aspx.cs* кода файл открывается в редакторе.
2. Замените существующий код следующим кодом:  

    [!code-csharp[Main](shopping-cart/samples/sample6.cs)]

Как упоминалось выше, `GridView` вызовы элемент управления данными `GetShoppingCartItems` метод в соответствующее время существования страницы цикла и автоматически связывает возвращаемых данных. `GetShoppingCartItems` Метод создает экземпляр класса `ShoppingCartActions` объекта. Затем код использует этот экземпляр, чтобы вернуть элементы в корзине, вызвав `GetCartItems` метод.

### <a name="adding-products-to-the-shopping-cart"></a>Добавление продукты в корзину для покупок

При любом *ProductList.aspx* или *ProductDetails.aspx* откроется страница, пользователь сможет добавить продукт в корзину покупок, с помощью ссылки. При переходе по ссылке, приложение переходит к странице обработки с именем *AddToCart.aspx*. *AddToCart.aspx* страница будет вызывать `AddToCart` метод в `ShoppingCart` класс, который вы добавили ранее в этом учебнике.

Теперь мы добавим **добавить в корзину** ссылку, чтобы оба *ProductList.aspx* страницы и *ProductDetails.aspx* страницы. Эта ссылка будет включать продукта `ID` , извлекается из базы данных.

1. В **обозревателе решений**найдите и откройте страницу, с именем *ProductList.aspx*.
2. Добавьте разметку, выделены желтым цветом, позволяя *ProductList.aspx* странице таким образом, чтобы вся страница выглядит следующим образом:  

    [!code-aspx[Main](shopping-cart/samples/sample7.aspx?highlight=50-54)]

### <a name="testing-the-shopping-cart"></a>Тестирование в корзину для покупок

Запустите приложение, чтобы увидеть, как добавить продукты в корзину покупок.

1. Нажмите клавишу **F5** для запуска приложения.  
 После проекта повторно создает базу данных, браузер и отобразится *Default.aspx* страницы.
2. Выберите **автомобили** меню навигации категории.  
 *ProductList.aspx* откроется страница отображается только продукты, включенные в категории «Автомобили». 

    ![Корзина для покупок - автомобили](shopping-cart/_static/image5.png)
3. Нажмите кнопку **добавить в корзину** ссылку рядом с первым продуктом в списке (можно преобразовать автомобиль).   
 *ShoppingCart.aspx* отображается страница, показывающая выделение в корзине для покупок. 

    ![Корзина для покупок - корзины для покупок](shopping-cart/_static/image6.png)
4. Просмотреть дополнительные продукты, выбрав **плоскостей** меню навигации категории.
5. Нажмите кнопку **добавить в корзину** ссылку рядом с первым продуктом в списке.  
 *ShoppingCart.aspx* страница отображается с еще один элемент.
6. Закройте браузер.

### <a name="calculating-and-displaying-the-order-total"></a>Вычисление и отображение итогов

Помимо добавления продукты в корзину покупок, вы добавите `GetTotal` метод `ShoppingCart` класса и отображение Общая сумма заказа в корзину для покупок.

1. В **обозревателе решений**откройте *ShoppingCartActions.cs* файл *логики* папки.
2. Добавьте следующий `GetTotal` выделены желтым цветом, чтобы метод `ShoppingCart` класса, таким образом, класс выглядит следующим образом:   

    [!code-csharp[Main](shopping-cart/samples/sample8.cs?highlight=85-97)]

Во-первых, `GetTotal` метод получает идентификатор Корзина для покупок для пользователя. Затем метод возвращает общее корзины для покупок путем умножения цены товара на количество продуктов для каждого продукта, перечисленного в корзине.

> [!NOTE] 
> 
> Приведенный выше код использует обнуляемый тип "`int?`«. Обнуляемые типы могут представлять все значения базового типа, а также как значение null. Дополнительные сведения см. [обнуляемые типы, с помощью](https://msdn.microsoft.com/library/2cf62fcy(v=vs.110).aspx).

### <a name="modify-the-shopping-cart-display"></a>Изменить отображение корзины для покупок

Далее вы измените код для *ShoppingCart.aspx* страницу для вызова `GetTotal` метод и отображения эту сумму на *ShoppingCart.aspx* странице при загрузке страницы.

1. В **обозревателе решений**, щелкните правой кнопкой мыши *ShoppingCart.aspx* и укажите **Просмотр кода**.
2. В *ShoppingCart.aspx.cs* обновите `Page_Load` обработчик, добавив следующий код, выделены желтым цветом:   

    [!code-csharp[Main](shopping-cart/samples/sample9.cs?highlight=16-31)]

Когда *ShoppingCart.aspx* загрузке страницы, он загружает объект корзину для покупок, а затем извлекает общее корзину для покупок путем вызова `GetTotal` метод `ShoppingCart` класса. Если корзина покупок пуста, сообщение об ошибке отображается.

### <a name="testing-the-shopping-cart-total"></a>Тестирование общее корзину для покупок

Запустите приложение и увидеть, как можно не только добавить продукт в корзину покупок, но вы видите общее корзину для покупок.

1. Нажмите клавишу **F5** для запуска приложения.  
 Браузер и отобразится *Default.aspx* страницы.
2. Выберите **автомобили** меню навигации категории.
3. Нажмите кнопку **Add To Cart** ссылку рядом с первым продуктом.   
 *ShoppingCart.aspx* страница отображается с итоговой суммы заказа. 

    ![Корзина для покупок - всего корзины для покупок](shopping-cart/_static/image7.png)
4. Добавьте в корзину некоторыми другими продуктами (например, плоскости).
5. *ShoppingCart.aspx* отображение страницы с обновленной итог для всех продуктов, которые вы добавили. 

    ![Корзина для покупок - несколько продуктов](shopping-cart/_static/image8.png)
6. Остановите выполняющееся приложение, закрыв окно браузера.

### <a name="adding-update-and-checkout-buttons-to-the-shopping-cart"></a>Добавление в корзину покупок обновления и извлечения кнопки

Чтобы разрешить пользователям изменять в корзину для покупок, мы добавим **обновление** кнопку и **извлечения** кнопку на страницу корзины для покупок. **Извлечения** кнопка не используется до более поздней версии в этой серии руководств.

1. В **обозревателе решений**откройте *ShoppingCart.aspx* страницу в корневом каталоге проекта веб-приложения.
2. Чтобы добавить **обновления** кнопку и **извлечения** кнопки *ShoppingCart.aspx* странице, добавьте разметку, выделена желтым в существующую разметку, как показано в Следующий код:   

    [!code-aspx[Main](shopping-cart/samples/sample10.aspx?highlight=36-45)]

Когда пользователь щелкает **обновление** кнопки `UpdateBtn_Click` будет вызван обработчик событий. Этот обработчик событий вызывает код, который вы добавите в следующем шаге.

Затем можно обновить код, содержащийся в *ShoppingCart.aspx.cs* файл для прохождения цикла по элементам корзины покупок и вызвать `RemoveItem` и `UpdateItem` методы.

1. В **обозревателе решений**откройте *ShoppingCart.aspx.cs* файл в корневом каталоге проекта веб-приложения.
2. Добавьте следующие разделы кода, они выделены желтым цветом, чтобы *ShoppingCart.aspx.cs* файла:   

    [!code-csharp[Main](shopping-cart/samples/sample11.cs?highlight=9-11,33,44-89)]

Когда пользователь щелкает **обновления** кнопку *ShoppingCart.aspx* страницы, вызывается метод UpdateCartItems. Метод UpdateCartItems получает обновленные значения для каждого элемента в список покупок. Затем вызывает метод UpdateCartItems `UpdateShoppingCartDatabase` метод (добавляемые и описано в следующем шаге) для добавления или удаления элементов из корзины для покупок. После обновления базы данных для отражения изменений в корзину покупок **GridView** управления обновляется на странице корзины для покупок, вызвав `DataBind` метод **GridView**. Кроме того Общая сумма заказа на странице корзины для покупок обновляется для отражения обновленного списка элементов.

### <a name="updating-and-removing-shopping-cart-items"></a>Обновление и удаление номенклатуры корзины для покупок

На *ShoppingCart.aspx* страницы, можно увидеть, были добавлены элементы управления для обновления количества товара и удалении элементов. Теперь добавьте код, который сделает эти элементы управления, работать.

1. В **обозревателе решений**откройте *ShoppingCartActions.cs* файл *логики* папки.
2. Добавьте следующий код, они выделены желтым цветом, чтобы *ShoppingCartActions.cs* файл класса:   

    [!code-csharp[Main](shopping-cart/samples/sample12.cs?highlight=99-213)]

`UpdateShoppingCartDatabase` Метод, именуемый из `UpdateCartItems` метод *ShoppingCart.aspx.cs* странице, содержит логику для обновления или удаления элементов из корзины для покупок. `UpdateShoppingCartDatabase` Метод проходит все строки в списке корзину для покупок. Если элемент корзину для покупок была помечена для удаления, или количество меньше единицы, `RemoveItem` вызывается метод. В противном случае проверяется элемент корзину для покупок обновлений при `UpdateItem` вызывается метод. После удаления или обновления элемента корзину для покупок сохраняются изменений в базе данных.

`ShoppingCartUpdates` Структура используется для хранения всех элементов корзины покупок. `UpdateShoppingCartDatabase` Использует метод `ShoppingCartUpdates` структуры, чтобы определить, какие-либо элементы необходимость обновления или удаления.

В следующем руководстве вы воспользуетесь `EmptyCart` метод, чтобы очистить корзину корзину после приобретения продуктов. Но сейчас, вы воспользуетесь `GetCount` метод, который только что добавленные *ShoppingCartActions.cs* файл, чтобы определить, сколько элементов находятся в корзине.

### <a name="adding-a-shopping-cart-counter"></a>Добавление счетчика корзину для покупок

Чтобы разрешить пользователю просматривать общее число элементов в корзине, вы добавите счетчика *Site.Master* страницы. Этот счетчик также будет выступать в качестве ссылки в корзину покупок.

1. В **обозревателе решений**откройте *Site.Master* страницы.
2. Измените разметку путем добавления счетчика ссылку на корзину покупок, как показано желтым в раздел переходов, поэтому он выглядит следующим образом:  

    [!code-html[Main](shopping-cart/samples/sample13.html?highlight=6)]
3. Затем обновите кода из *Site.Master.cs* файла путем добавления кода, выделены желтым цветом, следующим образом:  

    [!code-csharp[Main](shopping-cart/samples/sample14.cs?highlight=11,77-84)]

Перед переходом к просмотру страницы как HTML, `Page_PreRender` события. В `Page_PreRender` обработчик, общее количество покупок определяется вызовом `GetCount` метод. Возвращаемое значение добавляется к `cartCount` диапазон, включенные в разметке *Site.Master* страницы. `<span>` Тегов позволяет внутренних элементов, чтобы были правильно визуализированы. При отображении любой странице узла будет отображаться общее корзину для покупок. Кроме того, пользователь может щелкнуть корзину для покупок итог для отображения в корзину для покупок.

## <a name="testing-the-completed-shopping-cart"></a>Тестирование завершенного корзины

В корзине можно запустить приложение сейчас, чтобы увидеть, как можно добавить, удаления и обновления элементов. Корзина для покупок всего будет отражать Общая стоимость всех элементов в корзине.

1. Нажмите клавишу **F5** для запуска приложения.  
 Откроется браузер и показывает *Default.aspx* страницы.
2. Выберите **автомобили** меню навигации категории.
3. Нажмите кнопку **Add To Cart** ссылку рядом с первым продуктом.   
 *ShoppingCart.aspx* страница отображается с итоговой суммы заказа.
4. Выберите **плоскостей** меню навигации категории.
5. Нажмите кнопку **Add To Cart** ссылку рядом с первым продуктом.
6. Укажите количество первого элемента в корзину для покупок 3 и выберите **удалить элемент** флажок второго элемента.<a id="a"></a>
7. Нажмите кнопку **обновление** кнопку, чтобы обновить страницу в корзину для покупок и отображения новых итоговой суммы заказа. 

    ![Корзину для покупок - обновление корзины для покупок](shopping-cart/_static/image9.png)

## <a name="summary"></a>Сводка

В этом руководстве вы создали корзины для примера приложения Wingtip Toys веб-форм. С помощью этого учебника вы использовали Entity Framework Code First, заметки к данным, строго типизированные элементы управления данными и привязки модели.

Корзина для покупок поддерживает добавление, удаление и обновление элементов, которые пользователь выбрал для покупки. Помимо реализации функцию корзины для покупок, вы узнали, как для отображения элементов корзины покупок в **GridView** управления и вычисления суммы заказа.

## <a name="addition-information"></a>Дополнительную информацию

[Общие сведения о состоянии сеанса ASP.NET](https://msdn.microsoft.com/library/ms178581.aspx)

> [!div class="step-by-step"]
> [Назад](display_data_items_and_details.md)
> [Вперед](checkout-and-payment-with-paypal.md)
