---
uid: web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/url-routing
title: Маршрутизация URL-адресов | Документация Майкрософт
author: Erikre
description: В этой серии руководств вы узнаете об основах создания приложения ASP.NET Web Forms с помощью ASP.NET 4,5 и Microsoft Visual Studio Express 2013...
ms.author: riande
ms.date: 09/08/2014
ms.assetid: 4f4bf092-c400-471f-a876-78fda0417890
msc.legacyurl: /web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/url-routing
msc.type: authoredcontent
ms.openlocfilehash: 66b727b69ca4f9a3d35b67f492f9a554146e09ef
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/28/2019
ms.locfileid: "74590713"
---
# <a name="url-routing"></a>Маршрутизация URL-адресов

по [Эрик Реитан](https://github.com/Erikre)

[Скачайте образец проекта Wingtip Toys (C#)](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) или [Загрузите электронную книгу (PDF)](https://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20ASP.NET%204.5%20Web%20Forms%20and%20Visual%20Studio%202013.pdf)

> В этой серии руководств вы узнаете об основах создания приложения ASP.NET Web Forms с помощью ASP.NET 4,5 и Microsoft Visual Studio Express 2013 для Web. Для этой серии руководств доступен [проект Visual Studio 2013 с C# исходным кодом](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) .

В этом руководстве вы измените пример приложения Wingtip Toys для поддержки маршрутизации URL-адресов. Маршрутизация позволяет веб-приложению использовать URL-адреса, которые понятны, проще запоминать и лучше поддерживаются поисковыми механизмами. Это руководство построено на предыдущем учебном курсе «членство и администрирование» и входит в серию руководств по Wingtip Toys.

## <a name="what-youll-learn"></a>Что вы узнаете:

- Как зарегистрировать маршруты для приложения веб-форм ASP.NET.
- Добавление маршрутов на веб-страницу.
- Выбор данных из базы данных для поддержки маршрутов.

## <a name="aspnet-routing-overview"></a>Общие сведения о маршрутизации ASP.NET

Маршрутизация URL-адресов позволяет настроить приложение для приема URL-адресов запросов, которые не сопоставляются с физическими файлами. URL-адрес запроса — это просто URL-адрес, который пользователь вводит в свой браузер для поиска страницы на веб-сайте. Маршрутизация используется для определения URL-адресов, которые семантически понятны для пользователей и могут помочь в оптимизации механизма поиска (SEO).

По умолчанию шаблон веб-форм содержит [ASP.NET понятные URL-адреса](http://www.nuget.org/packages/Microsoft.AspNet.FriendlyUrls/). Большая часть базовой работы по маршрутизации будет реализована с помощью *удобных URL-адресов*. Однако в этом учебнике будут добавлены настраиваемые возможности маршрутизации.

Перед настройкой маршрутизации URL-адреса пример приложения Wingtip Toys можно связать с продуктом по следующему URL-адресу:

`https://localhost:44300/ProductDetails.aspx?productID=2`

Настроив маршрутизацию URL-адресов, пример приложения Wingtip Toys будет ссылаться на тот же продукт с помощью URL-адреса с более легким чтением:

`https://localhost:44300/Product/Convertible%20Car`

### <a name="routes"></a>Маршруты

Маршрут — это шаблон URL-адреса, сопоставленный с обработчиком. Обработчик может быть физическим файлом, таким как ASPX-файл в приложении Web Forms. Обработчик также может быть классом, обрабатывающим запрос. Чтобы определить маршрут, необходимо создать экземпляр класса Route, указав шаблон URL-адреса, обработчик и, при необходимости, имя маршрута.

Чтобы добавить маршрут к приложению, добавьте `Route` объект в статическое свойство `Routes` класса `RouteTable`. Свойство Routes — это `RouteCollection` объект, в котором хранятся все маршруты для приложения.

### <a name="url-patterns"></a>Шаблоны URL-адресов

Шаблон URL-адреса может содержать литеральные значения и заполнители переменных (которые называются параметрами URL-адреса). Литералы и заполнители находятся в сегментах URL-адреса, разделенных символом косой черты (`/`).

При выполнении запроса к веб-приложению URL-адрес разбирается в сегменты и заполнители, а значения переменных передаются обработчику запросов. Этот процесс аналогичен тому, как данные в строке запроса анализируются и передаются в обработчик запроса. В обоих случаях сведения о переменных включаются в URL-адрес и передаются в обработчик в виде пар "ключ-значение". Для строк запроса ключи и значения находятся в URL-адресе. Для маршрутов ключи являются именами заполнителей, определенными в шаблоне URL-адреса, и только значения находятся в URL-адресе.

В шаблоне URL-адреса можно определить заполнители, заключив их в фигурные скобки (`{` и `}`). В сегменте можно определить более одного заполнителя, но заполнители должны быть разделены литеральным значением. Например, `{language}-{country}/{action}` является допустимым шаблоном маршрута. Однако `{language}{country}/{action}` не является допустимым шаблоном, так как между заполнителями нет литерального значения или разделителя. Таким образом, маршрутизация не может определить, где следует отделять значение заполнителя языка от значения заполнителя страны.

### <a name="mapping-and-registering-routes"></a>Сопоставление и регистрация маршрутов

Прежде чем можно будет включать маршруты на страницы примера приложения Wingtip Toys, необходимо зарегистрировать маршруты при запуске приложения. Чтобы зарегистрировать маршруты, измените обработчик событий `Application_Start`.

1. В **Обозреватель решений**Visual Studio найдите и откройте файл *Global.asax.CS* .
2. Добавьте код, выделенный желтым цветом, в файл *Global.asax.CS* следующим образом:   

    [!code-csharp[Main](url-routing/samples/sample1.cs?highlight=30-31,34-46)]

При запуске примера приложения Wingtip Toys вызывается обработчик событий `Application_Start`. В конце этого обработчика событий вызывается метод `RegisterCustomRoutes`. Метод `RegisterCustomRoutes` добавляет каждый маршрут, вызывая метод `MapPageRoute` объекта `RouteCollection`. Маршруты определяются с помощью имени маршрута, URL-адреса маршрута и физического URL-адреса.

Первым параметром ("`ProductsByCategoryRoute`") является имя маршрута. Он используется для вызова маршрута, когда он необходим. Второй параметр ("`Category/{categoryName}`") определяет понятный URL-адрес замены, который может быть динамическим в зависимости от кода. Этот маршрут используется при заполнении элемента управления данными ссылками, созданными на основе данных. Маршрут отображается следующим образом:

[!code-csharp[Main](url-routing/samples/sample2.cs)]

Второй параметр маршрута включает динамическое значение, заданное фигурными скобками (`{ }`). В этом случае `categoryName` представляет собой переменную, которая будет использоваться для определения правильного пути маршрутизации.

> [!NOTE] 
> 
> **Необязательный**
> 
> Вы можете упростить управление кодом, переместив метод `RegisterCustomRoutes` в отдельный класс. В папке *Logic* создайте отдельный класс `RouteActions`. Переместите приведенный выше метод `RegisterCustomRoutes` из файла *Global.asax.CS* в новый класс `RoutesActions`. Используйте класс `RoleActions` и метод `createAdmin` как пример вызова метода `RegisterCustomRoutes` из файла *Global.asax.CS* .

Вы также можете обратить внимание на вызов метода `RegisterRoutes`, используя объект `RouteConfig` в начале обработчика событий `Application_Start`. Этот вызов выполняется для реализации маршрутизации по умолчанию. Он был добавлен в качестве кода по умолчанию при создании приложения с помощью шаблона веб-форм Visual Studio.

## <a name="retrieving-and-using-route-data"></a>Получение и использование данных маршрута

Как упоминалось выше, можно определить маршруты. Код, добавленный в обработчик событий `Application_Start` в файле *Global.asax.CS* , загружает определяемые маршруты.

### <a name="setting-routes"></a>Настройка маршрутов

Для маршрутов требуется добавить дополнительный код. В этом руководстве вы будете использовать привязку модели для получения объекта `RouteValueDictionary`, который используется при создании маршрутов с использованием данных из элемента управления данными. Объект `RouteValueDictionary` будет содержать список названий продуктов, относящихся к определенной категории продуктов. Для каждого продукта создается ссылка на основе данных и маршрута.

#### <a name="enable-routes-for-categories-and-products"></a>Включение маршрутов для категорий и продуктов

Далее вы обновите приложение, чтобы использовать `ProductsByCategoryRoute`, чтобы определить правильный маршрут для каждой связи категории продуктов. Вы также обновите страницу *ProductList. aspx* , включив в нее маршрутную ссылку для каждого продукта. Ссылки будут отображаться так, как будто они были до изменения, однако ссылки теперь будут использовать маршрутизацию URL-адресов.

1. В **Обозреватель решений**откройте страницу *site. master* , если она еще не открыта.
2. Обновите элемент управления **ListView** с именем "`categoryList`", чтобы изменения выделены желтым цветом, поэтому разметка выглядит следующим образом:   

    [!code-aspx[Main](url-routing/samples/sample3.aspx?highlight=7-9)]
3. В **Обозреватель решений**откройте страницу *ProductList. aspx* .
4. Обновите элемент `ItemTemplate` страницы *ProductList. aspx* , дополнив обновления, выделенные желтым цветом, поэтому разметка будет выглядеть следующим образом:   

    [!code-aspx[Main](url-routing/samples/sample4.aspx?highlight=6-9,14-16)]
5. Откройте код программной части *ProductList.aspx.CS* и добавьте следующее пространство имен, выделенное желтым цветом:  

    [!code-csharp[Main](url-routing/samples/sample5.cs?highlight=9)]
6. Замените метод `GetProducts` кода программной части (*ProductList.aspx.CS*) следующим кодом:   

    [!code-csharp[Main](url-routing/samples/sample6.cs)]

#### <a name="add-code-for-product-details"></a>Добавление кода для сведений о продукте

Теперь обновите код программной части (*ProductDetails.aspx.CS*) для страницы *продуктдетаилс. aspx* , чтобы использовать данные маршрута. Обратите внимание, что новый метод `GetProduct` также принимает значение строки запроса для случая, когда пользователь имеет ссылку с закладкой, которая использует старый непонятный URL-адрес, отличный от маршрутизации.

1. Замените метод `GetProduct` кода программной части (*ProductDetails.aspx.CS*) следующим кодом:   

    [!code-csharp[Main](url-routing/samples/sample7.cs)]

## <a name="running-the-application"></a>Запуск приложения

Вы можете запустить приложение, чтобы увидеть обновленные маршруты.

1. Нажмите клавишу **F5** , чтобы запустить пример приложения Wingtip Toys.  
 Откроется браузер и отобразится страница *Default. aspx* .
2. Щелкните ссылку **Products (продукты** ) в верхней части страницы.  
 Все продукты отображаются на странице *ProductList. aspx* . В браузере отобразится следующий URL-адрес (с использованием номера порта):  
    `https://localhost:44300/ProductList`
3. Затем щелкните ссылку категория **автомобилей** в верхней части страницы.  
 На странице *ProductList. aspx* отображаются только автомобили. В браузере отобразится следующий URL-адрес (с использованием номера порта):  
    `https://localhost:44300/Category/Cars`
4. Щелкните ссылку, содержащую имя первого автомобиля, указанного на странице ("преобразование**автомобиля**"), чтобы просмотреть сведения о продукте.  
 В браузере отобразится следующий URL-адрес (с использованием номера порта):  
    `https://localhost:44300/Product/Convertible%20Car`
5. Затем в браузере введите следующий ненаправленный URL-адрес (используя номер порта):  
    `https://localhost:44300/ProductDetails.aspx?productID=2`  
 Код по-прежнему распознает URL-адрес, включающий строку запроса, для случая, когда пользователь имеет ссылку с закладкой.

## <a name="summary"></a>Сводка

В этом руководстве вы добавили маршруты для категорий и продуктов. Вы узнали, как можно интегрировать маршруты с элементами управления данными, использующими привязку модели. В следующем учебнике будет реализована Глобальная обработка ошибок.

## <a name="additional-resources"></a>Дополнительные ресурсы

[ASP.NET понятные URL-адреса](http://www.nuget.org/packages/Microsoft.AspNet.FriendlyUrls/)  
[Развертывание безопасного приложения веб-форм ASP.NET с членством, OAuth и базой данных SQL в службе приложений Azure](https://azure.microsoft.com/documentation/articles/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/)  
[Бесплатная пробная версия Microsoft Azure](https://azure.microsoft.com/pricing/free-trial/)

> [!div class="step-by-step"]
> [Назад](membership-and-administration.md)
> [Вперед](aspnet-error-handling.md)
