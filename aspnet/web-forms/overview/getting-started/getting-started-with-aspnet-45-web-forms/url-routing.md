---
uid: web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/url-routing
title: Маршрутизация URL-адресов | Документация Майкрософт
author: Erikre
description: В этой серии руководств будет основы создания приложений веб-форм ASP.NET с помощью ASP.NET 4.5 и Microsoft Visual Studio Express 2013 для мы...
ms.author: riande
ms.date: 09/08/2014
ms.assetid: 4f4bf092-c400-471f-a876-78fda0417890
msc.legacyurl: /web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/url-routing
msc.type: authoredcontent
ms.openlocfilehash: f8a374be79a41b34dc8f17fa8d44c6e0680984d7
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2019
ms.locfileid: "65108603"
---
# <a name="url-routing"></a>Маршрутизация URL-адресов

по [Erik Reitan](https://github.com/Erikre)

[Скачайте пример проекта Wingtip Toys (C#)](http://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) или [скачайте электронную книгу (PDF)](http://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20ASP.NET%204.5%20Web%20Forms%20and%20Visual%20Studio%202013.pdf)

> В этой серии руководств будет основы создания приложений веб-форм ASP.NET с помощью ASP.NET 4.5 и Microsoft Visual Studio Express 2013 для Web. Visual Studio 2013 [проект с исходным кодом C#](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) доступен на следующей странице этой серии руководств.

В этом руководстве вы измените пример приложения Wingtip Toys для поддержки маршрутизации URL-адрес. Маршрутизация позволяет использовать URL-адреса, которые являются понятное, легче для запоминания и лучше поддерживается поисковыми веб-приложения. Этот учебник основан на предыдущем учебном курсе «Членство и администрирование» и является частью серии руководств Wingtip Toys.

## <a name="what-youll-learn"></a>Вы узнаете, как:

- Как зарегистрировать маршруты для приложения веб-форм ASP.NET.
- Как добавить маршруты на веб-страницу.
- Способ выбора данных из базы данных для поддержки маршруты.

## <a name="aspnet-routing-overview"></a>Общие сведения о маршрутизации ASP.NET

Маршрутизация URL-адресов можно настроить приложение для принятия URL-адреса, которые не сопоставлены с физическими файлами запросов. URL-адрес запроса — это просто URL-адрес, пользователь вводит в браузер, чтобы найти страницу на веб-сайт. Маршрутизация используется для определения URL-адреса, которые семантически значимые для пользователей и, которые могут помочь в оптимизации поисковой системы (SEO).

По умолчанию в шаблоне веб-форм есть [ASP.NET Friendly URLs](http://www.nuget.org/packages/Microsoft.AspNet.FriendlyUrls/). Большую часть основных маршрутизации работы будут реализованы с помощью *Friendly URLs*. Тем не менее в этом руководстве вы добавите настраиваемые возможности маршрутизации.

Перед началом настройки маршрутизации URL-адресов, пример приложения Wingtip Toys можно связать с продукта с помощью следующих URL-адрес:

`https://localhost:44300/ProductDetails.aspx?productID=2`

Настраивая маршрутизации URL-адресов, пример приложения Wingtip Toys будет ссылка на тот же продукт, с помощью более удобную для восприятия URL-адрес:

`https://localhost:44300/Product/Convertible%20Car`

### <a name="routes"></a>Маршруты

Маршрут — это шаблон URL-адрес, который сопоставляется с обработчиком. Обработчик может быть физический файл, например ASPX-файл в приложении Web Forms. Обработчик также может быть класс, который обрабатывает запрос. Для определения маршрута, создайте экземпляр класса Route, указав шаблон URL-адреса, обработчик и при необходимости имя маршрута.

Чтобы добавить маршрут в приложение, добавив `Route` объекту статического `Routes` свойство `RouteTable` класса. Свойство маршруты `RouteCollection` объект, который хранит все маршруты для приложения.

### <a name="url-patterns"></a>Шаблоны URL-адресов

Шаблон URL-адрес может содержать литеральные значения и заполнители переменных (которые называются параметрами URL-адрес). Литералы и заполнители, находятся в сегменты URL-адреса, которые разделяются косой черты (`/`) символов.

При запросе в веб-приложение, URL-адрес анализируется на сегменты и заполнители, и значения переменных, позволяющих обработчик запроса. Этот процесс аналогично тому, как данные в строку запроса анализируется и передается в обработчик запроса. В обоих случаях сведения о переменных включен в URL-адрес и передается обработчику в виде пар "ключ значение". Для строк запросов ключи и значения находятся в URL-адрес. Для маршрутов ключами являются имена-заполнители, определенной в шаблоне URL-адрес, а только значения находятся в URL-адрес.

В шаблоне URL-адрес, заполнители задаются путем их заключения в фигурные скобки ( `{` и `}` ). Можно определить несколько заполнителей в сегментах, но заполнители должны разделяться литералом. Например `{language}-{country}/{action}` является допустимым шаблоном маршрута. Тем не менее `{language}{country}/{action}` не является допустимым шаблоном, так как нет литеральное значение или заполнители в качестве разделителя. Таким образом маршрутизация не может указать, где для разделения значения заполнителя языка из значения заполнителя страны.

### <a name="mapping-and-registering-routes"></a>Сопоставление и регистрации маршрутов

Прежде чем можно включить маршруты к страницам пример приложения Wingtip Toys, необходимо зарегистрировать маршруты при запуске приложения. Чтобы зарегистрировать маршруты, вы измените `Application_Start` обработчик событий.

1. В **обозревателе решений**Visual Studio, найдите и откройте *Global.asax.cs* файл.
2. Добавьте код, они выделены желтым цветом, чтобы *Global.asax.cs* файл следующим образом:   

    [!code-csharp[Main](url-routing/samples/sample1.cs?highlight=30-31,34-46)]

Когда Wingtip Toys примере запускается приложение, он вызывает `Application_Start` обработчик событий. В конце этого обработчика событий `RegisterCustomRoutes` вызывается метод. `RegisterCustomRoutes` Метод добавляет каждый маршрут путем вызова `MapPageRoute` метод `RouteCollection` объекта. Маршруты определяются, используя имя маршрута, URL-адрес маршрута и физический URL-адрес.

Первый параметр (»`ProductsByCategoryRoute`«) — имя маршрута. Он используется для вызова маршрут, когда он необходим. Второй параметр (»`Category/{categoryName}`«) Определяет понятное замены, URL-адрес, который может быть динамическим на основе кода. При заполнении данных со ссылками, которые создаются на основе данных, используйте этот маршрут. Маршрут отображается следующим образом:

[!code-csharp[Main](url-routing/samples/sample2.cs)]

Второй параметр маршрута включает в себя динамическое значение, указанное в фигурные скобки (`{ }`). В этом случае `categoryName` является переменной, которая будет использоваться для определения правильного пути маршрутизации.

> [!NOTE] 
> 
> **Необязательный**
> 
> Может оказаться проще управлять кодом, переместив `RegisterCustomRoutes` метод в отдельном классе. В *логики* папки, создайте отдельное `RouteActions` класса. Перемещение выше `RegisterCustomRoutes` метода из *Global.asax.cs* файл в новый `RoutesActions` класса. Используйте `RoleActions` класс и `createAdmin` метод в качестве примера того, как вызвать `RegisterCustomRoutes` метода из *Global.asax.cs* файл.

Вы также могли заметить, `RegisterRoutes` вызов метода с помощью `RouteConfig` объект, находящийся в начале `Application_Start` обработчик событий. Этот вызов выполняется для маршрутизации по умолчанию. Она включалась в код по умолчанию, при создании приложения с помощью шаблона веб-форм Visual Studio.

## <a name="retrieving-and-using-route-data"></a>Получение и использование данных маршрута

Как упоминалось выше, можно определить маршруты. Код, который вы добавили `Application_Start` обработчик событий в *Global.asax.cs* определяемые маршруты загружает файл.

### <a name="setting-routes"></a>Настройка маршрутов

Маршруты необходимо добавить дополнительный код. В этом руководстве используется привязка модели для получения `RouteValueDictionary` объект, используемый при создании маршрутов, используя данные из данных элемента управления. `RouteValueDictionary` Объект будет содержать список названий продуктов, принадлежащих к определенной категории продуктов. Для каждого продукта на основе данных и маршрут создается связь.

#### <a name="enable-routes-for-categories-and-products"></a>Включить маршруты для категорий и продуктов

Далее вы обновите приложение, чтобы использовать `ProductsByCategoryRoute` для определения правильного маршрута для включения для каждого канала категории продукта. Мы также обновим *ProductList.aspx* страницу, чтобы включить перенаправленного ссылку для каждого продукта. Ссылки отображается как до изменения, однако ссылки, теперь будут использовать маршрутизацию URL-адрес.

1. В **обозревателе решений**откройте *Site.Master* странице, если он еще не открыт.
2. Обновление **ListView** управления с именем "`categoryList`" с изменениями, выделены желтым цветом, поэтому разметку выглядит следующим образом:   

    [!code-aspx[Main](url-routing/samples/sample3.aspx?highlight=7-9)]
3. В **обозревателе решений**откройте *ProductList.aspx* страницы.
4. Обновление `ItemTemplate` элемент *ProductList.aspx* страницы с обновлениями, выделенное желтым цветом, поэтому разметку выглядит следующим образом:   

    [!code-aspx[Main](url-routing/samples/sample4.aspx?highlight=6-9,14-16)]
5. Открытие кода из *ProductList.aspx.cs* и добавьте следующее пространство имен выделены желтым цветом:  

    [!code-csharp[Main](url-routing/samples/sample5.cs?highlight=9)]
6. Замените `GetProducts` метод из кода (*ProductList.aspx.cs*) следующим кодом:   

    [!code-csharp[Main](url-routing/samples/sample6.cs)]

#### <a name="add-code-for-product-details"></a>Добавьте код для сведений о продукте

Теперь обновите код программной части (*ProductDetails.aspx.cs*) для *ProductDetails.aspx* страницу, чтобы использовать данные о маршруте. Обратите внимание, что новый `GetProduct` метод также принимает значение строки запроса для случая, которых пользователь имеет связь с закладками, который использует более старых не с поддержкой, без маршрутизации URL-адрес.

1. Замените `GetProduct` метод из кода (*ProductDetails.aspx.cs*) следующим кодом:   

    [!code-csharp[Main](url-routing/samples/sample7.cs)]

## <a name="running-the-application"></a>Запуск приложения

Можно запустить приложение и просмотреть обновленный маршруты.

1. Нажмите клавишу **F5** запустить пример приложения Wingtip Toys.  
 Откроется браузер и показывает *Default.aspx* страницы.
2. Нажмите кнопку **продуктов** ссылку в верхней части страницы.  
 Все продукты, отображаются на *ProductList.aspx* страницы. Для браузера отображается следующий URL-адрес (используя свой номер порта).  
    `https://localhost:44300/ProductList`
3. Затем щелкните **автомобили** ссылку в верхней части страницы.  
 Только автомобили, отображаются на *ProductList.aspx* страницы. Для браузера отображается следующий URL-адрес (используя свой номер порта).  
    `https://localhost:44300/Category/Cars`
4. Щелкните ссылку, содержащую имя первый автомобиль, перечисленные на странице («**автомобиль преобразуемыми**«) для получения сведений о продукте.  
 Для браузера отображается следующий URL-адрес (используя свой номер порта).  
    `https://localhost:44300/Product/Convertible%20Car`
5. Затем введите следующие без маршрутизации URL-адрес (используя свой номер порта) в браузер:  
    `https://localhost:44300/ProductDetails.aspx?productID=2`  
 Код по-прежнему распознает URL-адрес, который включает строку запроса, в случае, когда у пользователя есть ссылка с закладками.

## <a name="summary"></a>Сводка

В этом руководстве вы добавили маршруты для категорий и продуктов. Вы узнали, как маршруты можно интегрировать с элементами управления данными, которые используют привязку модели. В следующем руководстве вы реализуете глобальной обработки ошибок.

## <a name="additional-resources"></a>Дополнительные ресурсы

[ASP.NET Friendly URLs](http://www.nuget.org/packages/Microsoft.AspNet.FriendlyUrls/)  
[Развертывание безопасного веб-форм приложение ASP.NET с членством, OAuth и базой данных SQL в службе приложений Azure](https://azure.microsoft.com/documentation/articles/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/)  
[Microsoft Azure — бесплатная пробная версия](https://azure.microsoft.com/pricing/free-trial/)

> [!div class="step-by-step"]
> [Назад](membership-and-administration.md)
> [Вперед](aspnet-error-handling.md)
