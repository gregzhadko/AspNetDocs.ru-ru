---
uid: web-forms/overview/presenting-and-managing-data/model-binding/updating-deleting-and-creating-data
title: Обновление, удаление и создание данных с помощью привязки модели и веб-форм | Документация Майкрософт
author: Rick-Anderson
description: В этой серии руководств показано основными аспектами с помощью привязки модели с проектом веб-форм ASP.NET. Привязка модели позволяет взаимодействие с данными более прямой-...
ms.author: riande
ms.date: 02/27/2014
ms.assetid: 602baa94-5a4f-46eb-a717-7a9e539c1db4
msc.legacyurl: /web-forms/overview/presenting-and-managing-data/model-binding/updating-deleting-and-creating-data
msc.type: authoredcontent
ms.openlocfilehash: 0ac1982a9476ea324f2faea0bf06f9406f9af1cf
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/09/2019
ms.locfileid: "59389327"
---
# <a name="updating-deleting-and-creating-data-with-model-binding-and-web-forms"></a>Обновление, удаление и создание данных с помощью привязки модели и веб-форм

по [Tom FitzMacken](https://github.com/tfitzmac)

> В этой серии руководств показано основными аспектами с помощью привязки модели с проектом веб-форм ASP.NET. Привязка модели упрощает взаимодействие с данными более эффективную чем работа с данными объектов источника (например, элемент управления ObjectDataSource и SqlDataSource). Эта серия начинается с вводный материал и перемещает до более продвинутых в последующих руководствах.
> 
> Этом руководстве показано, как создание, обновление и удаление данных с помощью привязки модели. Будут заданы следующие свойства:
> 
> - DeleteMethod
> - InsertMethod
> - UpdateMethod
> 
> Эти свойства получают имя метода, который обрабатывает соответствующей операции. В этом методе обеспечивают логику для взаимодействия с данными.
> 
> Этот учебник основан на проект, созданный в первом [часть](retrieving-data.md) ряда.
> 
> Вы можете [загрузить](https://go.microsoft.com/fwlink/?LinkId=286116) весь проект полностью на C# или Visual Basic. Загружаемый код работает с Visual Studio 2012 или Visual Studio 2013. Он использует шаблон Visual Studio 2012, который немного отличается от шаблона Visual Studio 2013, в этом учебнике.


## <a name="what-youll-build"></a>Вы создадите

В этом руководстве вам потребуется:

1. Добавление шаблонов динамических данных
2. Включить обновление и удаление данных через методы привязки модели
3. Применение правил проверки данных — Включение создания новой записи в базе данных

## <a name="add-dynamic-data-templates"></a>Добавление шаблонов динамических данных

Для обеспечения удобства работы пользователей и сократить повторы в коде, будет использовать шаблоны динамических данных. Вы легко можете интегрировать шаблоны готовых динамических данных в существующий узел, установив пакет NuGet.

Из **управление пакетами NuGet**, установить **DynamicDataTemplatesCS**.

![шаблоны динамических данных](updating-deleting-and-creating-data/_static/image1.png)

Обратите внимание на то, что проект сейчас содержит папку с именем **DynamicData**. В этой папке вы найдете шаблоны, которые автоматически применяются к динамическим элементам управления в web forms.

![Папка динамических данных](updating-deleting-and-creating-data/_static/image2.png)

## <a name="enable-updating-and-deleting"></a>Включение обновления и удаления

Предоставление пользователям возможности обновления и удаления записей в базе данных очень похожа на процедуру для извлечения данных. В **UpdateMethod** и **DeleteMethod** свойства, укажите имена методов, которые выполняют эти операции. С элементом управления GridView можно также указать автоматическое создание перегруженных вариантов редактирования и удалить кнопки. Следующий выделенный код показывает дополнения кода GridView.

[!code-aspx[Main](updating-deleting-and-creating-data/samples/sample1.aspx?highlight=4-5)]

В файле кода, добавьте с помощью инструкции для **System.Data.Entity.Infrastructure**.

[!code-csharp[Main](updating-deleting-and-creating-data/samples/sample2.cs)]

Затем добавьте следующее обновление и удаление методов.

[!code-csharp[Main](updating-deleting-and-creating-data/samples/sample3.cs)]

**TryUpdateModel** метод применим совпадающих значений привязкой к данным из веб-формы к элементу данных. Элемент данных извлекаются на основе значения параметра id.

## <a name="enforce-validation-requirements"></a>Принудительно применить требования к проверке

Атрибуты проверки, которые были применены к свойствам класса Student FirstName, LastName и года будут применяться автоматически при обновлении данных. Элементы управления DynamicField добавить клиентские и серверные проверяющих элементов управления на основе атрибутов проверки. Свойства FirstName и LastName, как требуется. Имя не может превышать 20 символов и LastName не может превышать 40 символов. Год должен быть является допустимым значением для перечисления AcademicYear.

Если он нарушает одно из требований проверки, обновление не продолжит работу. Чтобы увидеть сообщение об ошибке, добавьте элемент управления ValidationSummary над элементом управления GridView. Для отображения ошибок проверки из привязки модели, задайте **ShowModelStateErrors** свойство значение **true**. 

[!code-aspx[Main](updating-deleting-and-creating-data/samples/sample4.aspx)]

Запустите веб-приложение и обновление и удаление всех записей.

![обновление данных](updating-deleting-and-creating-data/_static/image3.png)

Обратите внимание, что когда в режиме правки значение для свойства год автоматически отображается в виде раскрывающегося списка. Свойство Year является значением перечисления, а шаблон динамических данных для значения перечисления указывает раскрывающийся список для редактирования. Этот шаблон можно найти, открыв **перечисления\_Edit.ascx платформы** файл **DynamicData**/**FieldTemplates** папки.

Если указать допустимые значения, обновление завершается успешно. Если Вы нарушаете одно из требований проверки, обновление не запускается, и сообщение об ошибке отображается над сеткой.

![Сообщение об ошибке](updating-deleting-and-creating-data/_static/image4.png)

## <a name="add-new-records"></a>Добавление новых записей

Элемент управления GridView не включает **InsertMethod** свойство и поэтому не может использоваться для добавления новой записи с помощью привязки модели. Можно найти свойство InsertMethod в **FormView**, **DetailsView**, или **ListView** элементов управления. В этом руководстве используется элемент управления FormView для добавления новой записи.

Во-первых необходимо добавьте ссылку на новую страницу, которая создается для добавления новой записи. Добавьте над ValidationSummary:

[!code-aspx[Main](updating-deleting-and-creating-data/samples/sample5.aspx)]

Новая ссылка появится в верхней части содержимого на страницу учащихся.

![Новая ссылка](updating-deleting-and-creating-data/_static/image5.png)

Затем добавьте новую веб-форму, с помощью главной страницы и назовите его **AddStudent**. Выберите в качестве главной странице Site.Master.

Отрисовка поля для добавления нового учащегося с помощью **DynamicEntity** элемента управления. Элемент управления DynamicEntity визуализирует, редактируемых свойств в классе, указанном в свойстве ItemType. Свойство StudentID был помечен атрибутом **[ScaffoldColumn(false)]** атрибут, поэтому он не отображается. В заполнителе MainContent AddStudent страницы добавьте следующий код.

[!code-aspx[Main](updating-deleting-and-creating-data/samples/sample6.aspx)]

Добавьте в файл кода (AddStudent.aspx.cs), **с помощью** инструкции для **ContosoUniversityModelBinding.Models** пространства имен.

[!code-csharp[Main](updating-deleting-and-creating-data/samples/sample7.cs)]

Затем добавьте следующие методы для вставки новой записи и обработчик событий для кнопки "Отмена".

[!code-csharp[Main](updating-deleting-and-creating-data/samples/sample8.cs)]

Сохраните все изменения.

Запустите веб-приложения и создания нового учащегося.

![Добавление нового учащегося](updating-deleting-and-creating-data/_static/image6.png)

Нажмите кнопку **вставить** и обратите внимание на то, будет создана нового учащегося.

![Отображение нового учащегося](updating-deleting-and-creating-data/_static/image7.png)

## <a name="conclusion"></a>Заключение

В этом руководстве вы включили, обновление, удаление и создание данных. Вы уверены в том, что правила проверки применяются при взаимодействии с данными.

В следующем [руководстве](sorting-paging-and-filtering-data.md) в этой серии, вы включите сортировка, разбиение по страницам и фильтрация данных.

> [!div class="step-by-step"]
> [Назад](retrieving-data.md)
> [Вперед](sorting-paging-and-filtering-data.md)
