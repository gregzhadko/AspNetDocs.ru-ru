---
uid: web-forms/overview/presenting-and-managing-data/model-binding/updating-deleting-and-creating-data
title: Обновление, удаление и создание данных с помощью привязки модели и веб-форм | Документация Майкрософт
author: Rick-Anderson
description: В этой серии руководств демонстрируются основные аспекты использования привязки модели с проектом веб-форм ASP.NET. Привязка модели делает взаимодействие данных более прямым-...
ms.author: riande
ms.date: 02/27/2014
ms.assetid: 602baa94-5a4f-46eb-a717-7a9e539c1db4
msc.legacyurl: /web-forms/overview/presenting-and-managing-data/model-binding/updating-deleting-and-creating-data
msc.type: authoredcontent
ms.openlocfilehash: 11dc52ec79ca91119b37ea60e08164eb1b1d0e2b
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78474138"
---
# <a name="updating-deleting-and-creating-data-with-model-binding-and-web-forms"></a>Обновление, удаление и создание данных с помощью привязки модели и веб-форм

от [Tom фитзмаккен](https://github.com/tfitzmac)

> В этой серии руководств демонстрируются основные аспекты использования привязки модели с проектом веб-форм ASP.NET. Привязка модели делает взаимодействие данных более прямым, чем работа с объектами источника данных (например, ObjectDataSource или SqlDataSource). Эта серия начинается с вводного материала и переходит к более сложным концепциям в последующих руководствах.
> 
> В этом руководстве показано, как создавать, обновлять и удалять данные с помощью привязки модели. Будут заданы следующие свойства:
> 
> - DeleteMethod
> - InsertMethod
> - UpdateMethod
> 
> Эти свойства получают имя метода, обрабатывающего соответствующую операцию. В этом методе вы предоставляете логику для взаимодействия с данными.
> 
> Это руководство строится на проекте, созданном в первой [части](retrieving-data.md) серии.
> 
> Вы можете [скачать](https://go.microsoft.com/fwlink/?LinkId=286116) полный проект в C# или VB. Загружаемый код работает как с Visual Studio 2012, так и с Visual Studio 2013. В нем используется шаблон Visual Studio 2012, который немного отличается от шаблона Visual Studio 2013, показанного в этом руководстве.

## <a name="what-youll-build"></a>Что будет построено

В этом руководстве вы выполните следующие действия.

1. Добавление шаблонов динамических данных
2. Включение обновления и удаления данных с помощью методов привязки модели
3. Применение правил проверки данных — включение создания новой записи в базе данных

## <a name="add-dynamic-data-templates"></a>Добавление шаблонов динамических данных

Чтобы обеспечить оптимальное взаимодействие с пользователем и избежать повторения кода, вы будете использовать динамические шаблоны данных. Предварительно созданные шаблоны динамических данных можно легко интегрировать в существующий сайт, установив пакет NuGet.

В окне **Управление пакетами NuGet**установите **динамикдататемплатескс**.

![Шаблоны динамических данных](updating-deleting-and-creating-data/_static/image1.png)

Обратите внимание, что теперь проект включает папку с именем **DynamicData**. В этой папке вы найдете шаблоны, которые автоматически применяются к динамическим элементам управления в веб-формах.

![Папка динамических данных](updating-deleting-and-creating-data/_static/image2.png)

## <a name="enable-updating-and-deleting"></a>Включить обновление и удаление

Предоставление пользователям возможности обновлять и удалять записи в базе данных очень похоже на процесс извлечения данных. В свойствах **UpdateMethod** и **DeleteMethod** указываются имена методов, которые выполняют эти операции. С помощью элемента управления GridView можно также указать автоматическое создание кнопок «изменить» и «удалить». В следующем выделенном коде показаны дополнения к коду GridView.

[!code-aspx[Main](updating-deleting-and-creating-data/samples/sample1.aspx?highlight=4-5)]

В файле кода программной части добавьте инструкцию using для **System. Data. Entity. Infrastructure**.

[!code-csharp[Main](updating-deleting-and-creating-data/samples/sample2.cs)]

Затем добавьте следующие методы Update и DELETE.

[!code-csharp[Main](updating-deleting-and-creating-data/samples/sample3.cs)]

Метод **трюпдатемодел** применяет соответствующие значения, привязанные к данным, из веб-формы к элементу данных. Элемент данных извлекается на основе значения параметра ID.

## <a name="enforce-validation-requirements"></a>Соблюдение требований к проверке

Атрибуты проверки, которые были применены к свойствам FirstName, LastName и year в классе Student, автоматически применяются при обновлении данных. Элементы управления Динамикфиелд добавляют средства проверки клиента и сервера на основе атрибутов проверки. Свойства FirstName и LastName являются обязательными. Длина имени не может превышать 20 символов, а имя LastName не должно превышать 40 символов. Год должен быть допустимым значением для перечисления Академициеар.

Если пользователь нарушает одно из требований проверки, обновление не выполняется. Чтобы увидеть сообщение об ошибке, добавьте элемент управления ValidationSummary над элементом GridView. Чтобы отобразить ошибки проверки из привязки модели, установите для свойства **шовмоделстатиррорс** значение **true**. 

[!code-aspx[Main](updating-deleting-and-creating-data/samples/sample4.aspx)]

Запустите веб-приложение и обновите и удалите все записи.

![Обновление данных](updating-deleting-and-creating-data/_static/image3.png)

Обратите внимание, что в режиме редактирования значение свойства Year автоматически подготавливается к просмотру в виде раскрывающегося списка. Свойство year является значением перечисления, а шаблон динамических данных для значения перечисления указывает раскрывающийся список для редактирования. Этот шаблон можно найти, открыв **Перечисление\_файл Edit. ascx** в папке **DynamicData**/**фиелдтемплатес** .

Если указать допустимые значения, обновление завершается успешно. Если вы нарушаете одно из требований проверки, обновление не выполняется, а над сеткой отображается сообщение об ошибке.

![сообщение об ошибке](updating-deleting-and-creating-data/_static/image4.png)

## <a name="add-new-records"></a>Добавить новые записи

Элемент управления GridView не включает свойство **InsertMethod** и поэтому не может использоваться для добавления новой записи с привязкой модели. Свойство InsertMethod можно найти в элементе управления **FormView**, **DetailsView**или **ListView** . В этом учебнике для добавления новой записи будет использоваться элемент управления FormView.

Сначала добавьте ссылку на новую страницу, которая будет создана для добавления новой записи. Над ValidationSummary добавьте:

[!code-aspx[Main](updating-deleting-and-creating-data/samples/sample5.aspx)]

Новая ссылка появится в верхней части содержимого страницы учащихся.

![создать ссылку](updating-deleting-and-creating-data/_static/image5.png)

Затем добавьте новую веб-форму с помощью главной страницы и назовите ее **аддстудент**. Выберите Site. master в качестве главной страницы.

Вы будете отображать поля для добавления нового учащегося с помощью элемента управления **DynamicControl** . Элемент управления DynamicControl визуализирует эти редактируемые свойства в классе, указанном в свойстве ItemType. Свойство StudentID было помечено атрибутом **[скаффолдколумн (false)]** , поэтому он не подготавливается к просмотру. В заполнитель MainContent страницы Аддстудент добавьте следующий код.

[!code-aspx[Main](updating-deleting-and-creating-data/samples/sample6.aspx)]

В файле кода программной части (AddStudent.aspx.cs) добавьте инструкцию **using** для пространства имен **контосауниверситимоделбиндинг. Models** .

[!code-csharp[Main](updating-deleting-and-creating-data/samples/sample7.cs)]

Затем добавьте следующие методы, чтобы указать, как вставить новую запись и обработчик событий для кнопки Отмена.

[!code-csharp[Main](updating-deleting-and-creating-data/samples/sample8.cs)]

Сохраните все изменения.

Запустите веб-приложение и создайте учащийся.

![добавить нового учащегося](updating-deleting-and-creating-data/_static/image6.png)

Нажмите кнопку **Вставить** и обратите внимание, что создан новый учащийся.

![Показать нового учащегося](updating-deleting-and-creating-data/_static/image7.png)

## <a name="conclusion"></a>Заключение

В этом руководстве вы включили обновление, удаление и создание данных. Гарантируется, что правила проверки применяются при взаимодействии с данными.

В следующем [руководстве](sorting-paging-and-filtering-data.md) этой серии вы включите сортировку, разбиение по страницам и фильтрацию данных.

> [!div class="step-by-step"]
> [Назад](retrieving-data.md)
> [Вперед](sorting-paging-and-filtering-data.md)
