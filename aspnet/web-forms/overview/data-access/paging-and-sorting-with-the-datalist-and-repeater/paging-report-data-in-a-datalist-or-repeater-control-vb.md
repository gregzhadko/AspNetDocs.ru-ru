---
uid: web-forms/overview/data-access/paging-and-sorting-with-the-datalist-and-repeater/paging-report-data-in-a-datalist-or-repeater-control-vb
title: Подкачка данных отчета в элементе управления DataList или Repeater (VB) | Документация Майкрософт
author: rick-anderson
description: Хотя ни элемент управления DataList, ни Repeater не поддерживают автоматическую подкачку или сортировку, в этом руководстве показано, как добавить поддержку разбиения по страницам в элемент управления DataList или Repeater,...
ms.author: riande
ms.date: 11/13/2006
ms.assetid: bbd6b7f7-b98a-48b4-93f3-341d6a4f53c0
msc.legacyurl: /web-forms/overview/data-access/paging-and-sorting-with-the-datalist-and-repeater/paging-report-data-in-a-datalist-or-repeater-control-vb
msc.type: authoredcontent
ms.openlocfilehash: 5c65ca1f263e41748d99323dbdf1c28fdd077246
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/28/2019
ms.locfileid: "74570240"
---
# <a name="paging-report-data-in-a-datalist-or-repeater-control-vb"></a>Разбиение по страницам данных отчета в элементе управления DataList или Repeater (VB)

по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Скачивание примера приложения](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_44_VB.exe) или [Загрузка PDF-файла](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/datatutorial44vb1.pdf)

> Хотя ни элемент управления DataList, ни Repeater не поддерживают автоматическую подкачку или сортировку, в этом учебнике показано, как добавить поддержку разбиения по страницам в элемент управления DataList или Repeater, что обеспечивает гораздо более гибкие интерфейсы разбиения по страницам и отображения данных.

## <a name="introduction"></a>Введение

Разбиение на страницы и сортировка — две очень распространенные функции при отображении данных в интерактивном приложении. Например, при поиске книг ASP.NET в книжном магазине могут содержаться сотни таких книг, но в отчете, в котором отображаются результаты поиска, отображается только десять соответствий на страницу. Кроме того, результаты можно отсортировать по заголовку, цене, количеству страниц, имени автора и т. д. Как мы обсуждали в учебнике по [данным отчета о разбиении по страницам и сортировке](../paging-and-sorting/paging-and-sorting-report-data-vb.md) , все элементы управления GridView, DetailsView и FormView предоставляют встроенную поддержку разбиения на страницы, которая может быть включена в такте флажка. GridView также включает поддержку сортировки.

К сожалению, ни элемент управления DataList, ни повторитель не поддерживают автоматическое разбиение по страницам или сортировку. В этом учебнике мы рассмотрим, как добавить поддержку разбиения по страницам в DataList или Repeater. Необходимо вручную создать интерфейс разбиения по страницам, отобразить соответствующую страницу записей и запомнить страницу, которая посещается во время обратной передачи. Хотя это занимает больше времени и кода, чем в GridView, DetailsView или FormView, элемент управления DataList и Repeater обеспечивает гораздо более гибкие интерфейсы разбиения по страницам и вывода данных.

> [!NOTE]
> В этом учебнике основное внимание уделяется только разбиению на страницы. В следующем учебном курсе мы вернем внимание к добавлению возможностей сортировки.

## <a name="step-1-adding-the-paging-and-sorting-tutorial-web-pages"></a>Шаг 1. Добавление веб-страниц учебника по разбиению по страницам и сортировке

Прежде чем приступить к работе с этим руководством, давайте сначала добавим страницы ASP.NET, которые понадобятся для работы с этим руководством и следующего. Начните с создания новой папки в проекте с именем `PagingSortingDataListRepeater`. Затем добавьте в эту папку следующие пять страниц ASP.NET, чтобы все они были настроены для использования главной страницы `Site.master`:

- `Default.aspx`
- `Paging.aspx`
- `Sorting.aspx`
- `SortingWithDefaultPaging.aspx`
- `SortingWithCustomPaging.aspx`

![Создание папки Пагингсортингдаталистрепеатер и добавление страниц Tutorial ASP.NET](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image1.png)

**Рис. 1**. Создание `PagingSortingDataListRepeater` папки и добавление страниц Tutorial ASP.NET

Затем откройте страницу `Default.aspx` и перетащите `SectionLevelTutorialListing.ascx` пользовательский элемент управления из папки `UserControls` в область конструктора. Этот пользовательский элемент управления, созданный при работе с [главными страницами и](../introduction/master-pages-and-site-navigation-vb.md) руководством по навигации по сайту, перечисляет карту узла и отображает эти руководства в текущем разделе в маркированном списке.

[![добавить пользовательский элемент управления SectionLevelTutorialListing. ascx в Default. aspx](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image3.png)](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image2.png)

**Рис. 2**. Добавление пользовательского элемента управления `SectionLevelTutorialListing.ascx` в `Default.aspx` ([щелкните, чтобы просмотреть изображение с полным размером](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image4.png))

Чтобы в маркированном списке отображались учебники по разбиению на страницы и сортировка, которые будут созданы, необходимо добавить их на карту узла. Откройте файл `Web.sitemap` и добавьте следующую разметку после изменения и удаления с помощью разметки узла схемы узла DataList:

[!code-xml[Main](paging-report-data-in-a-datalist-or-repeater-control-vb/samples/sample1.xml)]

![Обновление схемы узла для включения новых страниц ASP.NET](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image5.png)

**Рис. 3**. обновление схемы узла для включения новых страниц ASP.NET

## <a name="a-review-of-paging"></a>Проверка постраничного просмотра

В предыдущих руководствах мы увидели, как пролистывать данные в элементах управления GridView, DetailsView и FormView. Эти три элемента управления предлагают простую форму разбиения на страницы *по умолчанию* , которую можно реализовать, просто установив флажок Включить разбиение по страницам в смарт-теге элемента управления. При использовании разбиения по страницам по умолчанию каждый раз, когда страница данных запрашивается либо на первой странице, либо когда пользователь переходит на другую страницу данных, элемент управления GridView, DetailsView или FormView повторно запрашивает *все* данные из ObjectDataSource. Затем он выводит определенный набор записей для последующего просмотра с учетом запрошенного индекса страницы и количества записей, отображаемых на странице. По умолчанию мы обсуждали разбиение по страницам в учебнике по [просмотру и сортировке данных отчета](../paging-and-sorting/paging-and-sorting-report-data-vb.md) .

Так как разбиение по страницам по умолчанию повторно запрашивает все записи для каждой страницы, это непрактично при разбивке достаточно большого объема данных. Например, представьте подкачку 50 000 записей с размером страницы 10. Каждый раз, когда пользователь переходит на новую страницу, все записи 50 000 должны быть получены из базы данных, несмотря на то, что отображаются только десять из них.

*Пользовательское разбиение* на страницы решает проблемы с производительностью разбиения по страницам по умолчанию, заменяя только точное подмножество записей, отображаемых на запрошенной странице. При реализации пользовательского разбиения на страницы необходимо написать запрос SQL, который будет эффективно возвращать только правильный набор записей. Мы узнали, как создать такой запрос с помощью SQL Server 2005 s New [`ROW_NUMBER()` ключевое слово](http://www.4guysfromrolla.com/webtech/010406-1.shtml) обратно в [рамках эффективного разбиения по большим объемам данных](../paging-and-sorting/efficiently-paging-through-large-amounts-of-data-vb.md) .

Чтобы реализовать разбиение по страницам по умолчанию в элементах управления DataList или Repeater, можно использовать [класс`PagedDataSource`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.aspx) в качестве оболочки для `ProductsDataTable`, содержимое которого размещается на пейджер. Класс `PagedDataSource` имеет свойство `DataSource`, которое может быть назначено любому перечислимому объекту, а также свойства [`PageSize`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.pagesize.aspx) и [`CurrentPageIndex`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.currentpageindex.aspx) , указывающие количество записей, отображаемых на странице, и индекс текущей страницы. После установки этих свойств `PagedDataSource` можно использовать в качестве источника данных для любого веб-элемента управления данными. `PagedDataSource`при перечислении будет возвращать соответствующее подмножество записей внутреннего `DataSource` на основе свойств `PageSize` и `CurrentPageIndex`. На рис. 4 показана функциональность класса `PagedDataSource`.

![Пажеддатасаурце упаковывает перечислимый объект с помощью страничного интерфейса.](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image6.png)

**Рис. 4**. `PagedDataSource` переносит перечислимый объект на многостраничный интерфейс

Объект `PagedDataSource` можно создать и настроить непосредственно на уровне бизнес-логики, а также привязать к элементу управления DataList или Repeater через элемент управления ObjectDataSource или создать и настроить непосредственно в классе кода программной части ASP.NET Page s. Если используется второй подход, нам необходимо отказаться от с помощью ObjectDataSource и привязать данные, постранично, к DataList или Repeater программным способом.

Объект `PagedDataSource` также имеет свойства для поддержки пользовательского разбиения на страницы. Однако можно обойти использование `PagedDataSource` для пользовательского разбиения на страницы, так как у нас уже есть методы BLL в классе `ProductsBLL`, предназначенные для пользовательского разбиения на страницы, которые возвращают точные отображаемые записи.

В этом учебнике мы рассмотрим реализацию разбиения по страницам по умолчанию в DataList, добавив новый метод в класс `ProductsBLL`, который возвращает соответствующий настроенный объект `PagedDataSource`. В следующем учебном курсе будет показано, как использовать пользовательское разбиение по страницам.

## <a name="step-2-adding-a-default-paging-method-in-the-business-logic-layer"></a>Шаг 2. Добавление метода разбиения по страницам по умолчанию на уровне бизнес-логики

В настоящее время класс `ProductsBLL` содержит метод для возврата всех сведений о продукте `GetProducts()` и один для возврата определенного подмножества продуктов в начальный `GetProductsPaged(startRowIndex, maximumRows)`индекса. При использовании разбиения по страницам по умолчанию все элементы управления GridView, DetailsView и FormView используют метод `GetProducts()` для получения всех продуктов, а затем используют `PagedDataSource` внутренне для вывода только правильного подмножества записей. Чтобы реплицировать эту функцию с помощью элементов управления DataList и Repeater, мы можем создать в BLL новый метод, имитирующий это поведение.

Добавьте метод в класс `ProductsBLL` с именем `GetProductsAsPagedDataSource`, который принимает два целочисленных входных параметра:

- `pageIndex` индекс страницы для вывода, индексирования с нулевым значением и
- `pageSize` число записей, отображаемых на странице.

`GetProductsAsPagedDataSource` начинается с получения *всех* записей из `GetProducts()`. Затем он создает объект `PagedDataSource`, устанавливая свойства `CurrentPageIndex` и `PageSize` в значения переданного `pageIndex` и `pageSize` параметров. Метод завершается возвратом этого настроенного `PagedDataSource`:

[!code-vb[Main](paging-report-data-in-a-datalist-or-repeater-control-vb/samples/sample2.vb)]

## <a name="step-3-displaying-product-information-in-a-datalist-using-default-paging"></a>Шаг 3. Отображение сведений о продукте в элементе управления DataList с помощью разбиения по страницам по умолчанию

После добавления метода `GetProductsAsPagedDataSource` в класс `ProductsBLL` можно создать элемент управления DataList или Repeater, который обеспечивает разбиение по страницам по умолчанию. Для начала откройте страницу `Paging.aspx` в папке `PagingSortingDataListRepeater` и перетащите элемент управления DataList с панели инструментов в конструктор, установив для свойства DataList `ID` значение `ProductsDefaultPaging`. Из смарт-тега DataList создайте новый объект ObjectDataSource с именем `ProductsDefaultPagingDataSource` и настройте его таким образом, чтобы он получал данные с помощью метода `GetProductsAsPagedDataSource`.

[![создать ObjectDataSource и настроить его для использования метода Жетпродуктсаспажеддатасаурце ()](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image8.png)](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image7.png)

**Рис. 5**. Создание ObjectDataSource и настройка его для использования метода `GetProductsAsPagedDataSource` `()` ([щелкните, чтобы просмотреть изображение с полным размером](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image9.png))

Установите в раскрывающихся списках на вкладках обновления, вставки и удаления значение (нет).

[![установить в раскрывающихся списках на вкладках обновления, вставки и удаления значение (нет)](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image11.png)](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image10.png)

**Рис. 6**. Установка раскрывающихся списков на вкладках «обновить», «вставить» и «удалить» (нет) ([щелкните, чтобы просмотреть изображение с полным размером](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image12.png))

Так как метод `GetProductsAsPagedDataSource` ожидает два входных параметра, мастер запрашивает у нас источник этих значений параметров.

Значения индекса страницы и размера страницы должны быть сохранены во всех обратных передачах. Они могут храниться в состоянии представления, сохраняться в строке запроса, храниться в переменных сеанса или запоминать с помощью какой бы то ни было другой методики. В этом учебнике мы будем использовать строку запроса, которая имеет преимущество предоставления определенной страницы данных закладками.

В частности, используйте поля QueryString, pageIndex и pageSize для параметров `pageIndex` и `pageSize` соответственно (см. рис. 7). Задайте значения по умолчанию для этих параметров, так как значения строк запроса не будут представлены при первом посещении страницы пользователем. Для `pageIndex`установите значение по умолчанию 0 (которое будет показывать первую страницу данных) и `pageSize` s по умолчанию равным 4.

[![использовать строку запроса в качестве источника для параметров pageIndex и pageSize](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image14.png)](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image13.png)

**Рис. 7**. Использование строки запроса в качестве источника для параметров `pageIndex` и `pageSize` ([щелкните, чтобы просмотреть изображение с полным размером](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image15.png))

После настройки ObjectDataSource Visual Studio автоматически создает `ItemTemplate` для DataList. Настройте `ItemTemplate` таким образом, чтобы отображались только название, Категория и поставщик продукта. Также задайте свойству `RepeatColumns` DataList s значение 2, его `Width` 100%, а `ItemStyle` s `Width` 50%. Эти параметры ширины будут предоставлять одинаковые интервалы для двух столбцов.

После внесения этих изменений разметка DataList и ObjectDataSource должна выглядеть следующим образом:

[!code-aspx[Main](paging-report-data-in-a-datalist-or-repeater-control-vb/samples/sample3.aspx)]

> [!NOTE]
> Поскольку в этом учебнике не выполняются какие-либо функции обновления или удаления, можно отключить состояние представления DataList, чтобы уменьшить размер отображаемой страницы.

При первом посещении этой страницы в браузере не указаны параметры строки запроса `pageIndex` и `pageSize`. Поэтому используются значения по умолчанию 0 и 4. Как показано на рис. 8, это приводит к отображению элемента управления DataList, отображающего первые четыре продукта.

[![перечислены четыре первых продукта](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image17.png)](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image16.png)

**Рис. 8**. список первых четырех продуктов ([щелкните, чтобы просмотреть изображение с полным размером](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image18.png))

Без интерфейса разбиения по страницам в настоящее время нет простых средств, позволяющих пользователю переходить на вторую страницу данных. На шаге 4 мы создадим интерфейс разбиения по страницам. Но пока вы можете выполнить разбиение на страницы только путем непосредственного указания условия разбиения по страницам в строке запроса. Например, чтобы просмотреть вторую страницу, измените URL-адрес в адресной строке браузера с `Paging.aspx` на `Paging.aspx?pageIndex=2` и нажмите клавишу ВВОД. Это приводит к отображению второй страницы данных (см. рис. 9).

[![отображается вторая страница данных](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image20.png)](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image19.png)

**Рис. 9**. Отображение второй страницы данных ([щелкните, чтобы просмотреть изображение с полным размером](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image21.png))

## <a name="step-4-creating-the-paging-interface"></a>Шаг 4. Создание интерфейса разбиения по страницам

Существует множество различных интерфейсов разбиения на страницы, которые можно реализовать. Элементы управления GridView, DetailsView и FormView предоставляют четыре различных интерфейса для выбора:

- **Затем предыдущие** пользователи могут перемещаться по одной странице за раз, либо на следующую или предыдущую.
- **Следующий, предыдущий, первый, последний** в дополнение к кнопкам "Далее" и "назад" Этот интерфейс включает в себя первую и последнюю кнопки для перехода на первую или последнюю страницу.
- **Числовой** список номеров страниц в интерфейсе разбиения на страницы, позволяющий пользователю быстро перейти к определенной странице.
- **Числовой, первый, последний** в дополнение к числу номеров страниц содержит кнопки для перехода на первую или последнюю страницу.

Для элементов управления DataList и Repeater мы обязаны выбрать интерфейс разбиения по страницам и реализовать его. Это подразумевает создание необходимых веб-элементов управления на странице и отображение запрашиваемой страницы при нажатии на определенную кнопку интерфейса разбиения по страницам. Кроме того, может потребоваться отключить некоторые элементы управления "интерфейс разбиения на страницы". Например, при просмотре первой страницы данных с помощью следующего, предыдущего, последнего интерфейса, кнопки Первая и Предыдущная будут отключены.

В этом руководстве мы будем использовать следующий, предыдущий, первый, последний интерфейс. Добавьте на страницу четыре веб-элемента управления Button и задайте для их `ID` s значения `FirstPage`, `PrevPage`, `NextPage`и `LastPage`. Задайте для свойств `Text` значение &lt;&lt; First, &lt; назад, далее &gt;и Last &gt;&gt;.

[!code-aspx[Main](paging-report-data-in-a-datalist-or-repeater-control-vb/samples/sample4.aspx)]

Затем создайте обработчик событий `Click` для каждой из этих кнопок. Сейчас мы добавим код, необходимый для вывода запрошенной страницы.

## <a name="remembering-the-total-number-of-records-being-paged-through"></a>Запоминание общего числа записей, продаваемых по страницам

Независимо от выбранного интерфейса разбиения по страницам необходимо вычислить и запомнить общее число записей, на которые размещается страница. Общее число строк (в сочетании с размером страницы) определяет, сколько всего страниц данных размещается по страницам, что определяет добавление или включение элементов управления интерфейса разбиения на страницы. В следующем, предыдущем и первом последнем интерфейсе, который мы создаем, число страниц используется двумя способами:

- Чтобы определить, просматривается ли последняя страница, в этом случае кнопки Next и Last отключаются.
- Если пользователь нажимает последнюю кнопку, необходимо перенесет их на последнюю страницу, индекс которой меньше, чем число страниц.

Число страниц вычисляется как самое верхнее общее число строк, деленное на размер страницы. Например, если выполняется разбиение на страницы 79 записей с четырьмя записями на страницу, то число страниц будет равно 20 (потолок 79/4). При использовании числового интерфейса разбиения по страницам эта информация информирует нас о том, сколько числовых кнопок страницы отображать; Если интерфейс разбиения по страницам включает кнопки «Далее» и «последняя», то количество страниц используется для определения момента отключения кнопок «Далее» и «последняя».

Если интерфейс разбиения по страницам включает последнюю кнопку, то крайне важно, чтобы общее количество записей, разбитых на страницы, запомнилось между обратными передачами, чтобы при нажатии последней кнопки можно было определить последний индекс страницы. Чтобы упростить это, создайте свойство `TotalRowCount` в классе кода программной части ASP.NET Page s, сохраняющем его значение в состоянии представления:

[!code-vb[Main](paging-report-data-in-a-datalist-or-repeater-control-vb/samples/sample5.vb)]

Помимо `TotalRowCount`, создайте минуту, чтобы создать свойства уровня страницы только для чтения для простого доступа к индексу страницы, размеру страницы и количеству страниц:

[!code-vb[Main](paging-report-data-in-a-datalist-or-repeater-control-vb/samples/sample6.vb)]

## <a name="determining-the-total-number-of-records-being-paged-through"></a>Определение общего числа записей, на которые размещается страница

Объект `PagedDataSource`, возвращаемый из метода ObjectDataSource `Select()`, содержит *все* записи продукта, хотя в DataList отображаются только их подмножества. Свойство `PagedDataSource` s [`Count`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.count.aspx) возвращает только число элементов, которые будут отображаться в DataList. [свойство`DataSourceCount`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.datasourcecount.aspx) возвращает общее число элементов в `PagedDataSource`. Поэтому необходимо назначить свойству ASP.NET Pages `TotalRowCount` значение свойства `DataSourceCount` `PagedDataSource` s.

Для этого создайте обработчик событий для события `Selected` ObjectDataSource. В обработчике событий `Selected` есть доступ к возвращаемому значению метода ObjectDataSource s `Select()` в данном случае — `PagedDataSource`.

[!code-vb[Main](paging-report-data-in-a-datalist-or-repeater-control-vb/samples/sample7.vb)]

## <a name="displaying-the-requested-page-of-data"></a>Отображение запрошенной страницы данных

Когда пользователь нажимает одну из кнопок в интерфейсе разбиения по страницам, необходимо отобразить запрошенную страницу данных. Так как параметры разбиения по страницам указываются с помощью строки запроса, для отображения запрошенной страницы данных используйте `Response.Redirect(url)`, чтобы браузер пользователя повторно запрашивал страницу `Paging.aspx` с соответствующими параметрами разбиения по страницам. Например, чтобы отобразить вторую страницу данных, необходимо перенаправить пользователя в `Paging.aspx?pageIndex=1`.

Чтобы упростить это, создайте метод `RedirectUser(sendUserToPageIndex)`, который перенаправляет пользователя на `Paging.aspx?pageIndex=sendUserToPageIndex`. Затем вызовите этот метод из четырех кнопок `Click` обработчиков событий. В обработчике событий `FirstPage` `Click` вызовите метод `RedirectUser(0)`, чтобы отправить их на первую страницу. в обработчике событий `PrevPage` `Click` используйте `PageIndex - 1` в качестве индекса страницы. и т. д.

[!code-vb[Main](paging-report-data-in-a-datalist-or-repeater-control-vb/samples/sample8.vb)]

После завершения обработчиков событий `Click` можно пролистывать записи DataList-s, нажимая кнопки. Уделите немного времени для пробного использования!

## <a name="disabling-paging-interface-controls"></a>Отключение элементов управления интерфейса разбиения по страницам

В настоящее время все четыре кнопки включены независимо от просматриваемой страницы. Однако мы хотим отключить первую и предыдущую кнопки при отображении первой страницы данных, а также кнопки «Следующая» и «последняя» при отображении последней страницы. Объект `PagedDataSource`, возвращаемый методом `Select()` ObjectDataSource, имеет свойства [`IsFirstPage`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.isfirstpage.aspx) и [`IsLastPage`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.islastpage.aspx) , которые можно проверить, чтобы определить, просматривается ли первая или последняя страница данных.

Добавьте следующий элемент в обработчик событий `Selected` ObjectDataSource:

[!code-vb[Main](paging-report-data-in-a-datalist-or-repeater-control-vb/samples/sample9.vb)]

При таком добавлении первая и предыдущая кнопки будут отключены при просмотре первой страницы, а следующая и Последняя кнопки будут отключены при просмотре последней страницы.

Давайте добавим интерфейс разбиения по страницам, уведомляя пользователя о том, на какой странице он просматривался в данный момент и сколько всего страниц. Добавьте на страницу веб-элемент управления Label и задайте для его свойства `ID` значение `CurrentPageNumber`. Установите свойство `Text` в обработчике событий ObjectDataSource, чтобы он включал текущую просматриваемую страницу (`PageIndex + 1`) и общее число страниц (`PageCount`).

[!code-vb[Main](paging-report-data-in-a-datalist-or-repeater-control-vb/samples/sample10.vb)]

На рис. 10 показан `Paging.aspx` при первом посещении. Так как строка запроса пуста, элемент управления DataList по умолчанию отображает первые четыре продукта; Первая и предыдущая кнопки отключены. При нажатии кнопки Далее отображаются четыре следующие записи (см. рис. 11). кнопки Первая и Предыдущая теперь включены.

[![отображается первая страница данных](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image23.png)](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image22.png)

**Рис. 10**. Отображение первой страницы данных ([щелкните, чтобы просмотреть изображение с полным размером](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image24.png))

[![отображается вторая страница данных](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image26.png)](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image25.png)

**Рис. 11**. Отображение второй страницы данных ([щелкните, чтобы просмотреть изображение с полным размером](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image27.png))

> [!NOTE]
> Интерфейс разбиения по страницам можно дополнительно улучшить, разрешая пользователю указать количество страниц для просмотра на странице. Например, DropDownList может быть добавлен список параметров размера страницы, например 5, 10, 25, 50 и все. При выборе размера страницы необходимо перенаправить пользователя обратно в `Paging.aspx?pageIndex=0&pageSize=selectedPageSize`. Я оставлю за реализацию этого улучшения в качестве упражнения для читателя.

## <a name="using-custom-paging"></a>Использование пользовательского разбиения на страницы

Страницы DataList по данным с использованием неэффективного метода разбиения по страницам по умолчанию. При разбиении на страницы достаточно большого объема данных необходимо использовать настраиваемое разбиение по страницам. Несмотря на то, что сведения о реализации немного отличаются, основные понятия, связанные с реализацией пользовательского разбиения по страницам в DataList, такие же, как и по умолчанию. При использовании пользовательского разбиения на страницы используйте метод `ProductBLL` классов `GetProductsPaged` (вместо `GetProductsAsPagedDataSource`). Как обсуждалось в [рамках эффективного разбиения по большим объемам данных](../paging-and-sorting/efficiently-paging-through-large-amounts-of-data-vb.md) , `GetProductsPaged` должен быть передан Индекс начальной строки и максимальное число возвращаемых строк. Эти параметры можно поддерживать через строку запроса, как и параметры `pageIndex` и `pageSize`, используемые при разбиении по страницам по умолчанию.

Поскольку нет `PagedDataSource` с пользовательским разбиением на страницы, необходимо использовать альтернативные методы для определения общего количества записей, продаваемых по страницам, и сведения о том, следует ли повторно отобразить первую или последнюю страницу данных. Метод `TotalNumberOfProducts()` в классе `ProductsBLL` возвращает общее количество продуктов, на которых размещается страница. Чтобы определить, просматривается ли первая страница данных, проверьте Индекс начальной строки, если он равен нулю, а затем просматривается первая страница. Последняя страница просматривается, если индекс начальной строки плюс максимальное число возвращаемых строк больше или равно общему количеству записей, на которые размещается страница.

В следующем руководстве мы подробно рассмотрим реализацию пользовательского разбиения по страницам.

## <a name="summary"></a>Сводка

Хотя ни DataList, ни Repeater не предлагают встроенную поддержку разбиения по страницам в элементах управления GridView, DetailsView и FormView, такие функции можно добавлять с минимальными усилиями. Самым простым способом реализации разбиения по страницам по умолчанию является заключение всего набора продуктов в `PagedDataSource`, а затем привязка `PagedDataSource` к элементу управления DataList или Repeater. В этом руководстве мы добавили метод `GetProductsAsPagedDataSource` в класс `ProductsBLL` для возврата `PagedDataSource`. Класс `ProductsBLL` уже содержит методы, необходимые для пользовательского разбиения на страницы `GetProductsPaged` и `TotalNumberOfProducts`.

Вместе с извлечением точного набора записей, отображаемых для пользовательского разбиения на страницы, или всех записей в `PagedDataSource` для разбиения по страницам по умолчанию также необходимо добавить интерфейс разбиения по страницам вручную. В этом учебнике мы создали новый, предыдущий, последний интерфейс с четырьмя веб-элементами управления "Кнопка". Кроме того, элемент управления Label, отображающий текущий номер страницы и общее число страниц, был добавлен.

В следующем учебном курсе будет показано, как добавить поддержку сортировки в DataList и Repeater. Также будет показано, как создать элемент управления DataList, который может быть одновременно выведен на страницы и отсортирован (с примерами по умолчанию и пользовательским разбиением по страницам).

Поздравляем с программированием!

## <a name="about-the-author"></a>Об авторе

[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи книг по ASP/ASP. NET и основатель [4GuysFromRolla.com](http://www.4guysfromrolla.com), работал с веб-технологиями Майкрософт с 1998. Скотт работает как независимый консультант, преподаватель и модуль записи. Его последняя книга — [*Sams обучать себя ASP.NET 2,0 за 24 часа*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco). Он доступен по адресу [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) или через его блог, который можно найти по адресу [http://ScottOnWriting.NET](http://ScottOnWriting.NET).

## <a name="special-thanks-to"></a>Специальная благодарность

Эта серия руководств была рассмотрена многими полезными рецензентами. Потенциальные рецензенты для этого руководства были основными рецензентами, Кен Песписа и Бернадетте Леигх. Хотите ознакомиться с моими будущими статьями MSDN? Если это так, расположите строку в [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)

> [!div class="step-by-step"]
> [Назад](sorting-data-in-a-datalist-or-repeater-control-cs.md)
> [Вперед](sorting-data-in-a-datalist-or-repeater-control-vb.md)
