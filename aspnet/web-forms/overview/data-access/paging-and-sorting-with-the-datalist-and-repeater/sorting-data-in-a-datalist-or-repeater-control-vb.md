---
uid: web-forms/overview/data-access/paging-and-sorting-with-the-datalist-and-repeater/sorting-data-in-a-datalist-or-repeater-control-vb
title: Сортировка данных в элементе управления DataList или Repeater (VB) | Документация Майкрософт
author: rick-anderson
description: В этом учебнике мы рассмотрим, как включить поддержку сортировки в DataList и Repeater, а также как создать элемент управления DataList или Repeater, данные которого могут...
ms.author: riande
ms.date: 11/13/2006
ms.assetid: 97c13898-0741-45f9-b3fa-7540ab1679e6
msc.legacyurl: /web-forms/overview/data-access/paging-and-sorting-with-the-datalist-and-repeater/sorting-data-in-a-datalist-or-repeater-control-vb
msc.type: authoredcontent
ms.openlocfilehash: 81e07bec8569b9ee987dfaa84dec9eec95a2692f
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/28/2019
ms.locfileid: "74638536"
---
# <a name="sorting-data-in-a-datalist-or-repeater-control-vb"></a><span data-ttu-id="eaaa1-103">Сортировка данных в элементе управления DataList или Repeater (VB)</span><span class="sxs-lookup"><span data-stu-id="eaaa1-103">Sorting Data in a DataList or Repeater Control (VB)</span></span>

<span data-ttu-id="eaaa1-104">по [Скотт Митчелл](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="eaaa1-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="eaaa1-105">[Скачивание примера приложения](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_45_VB.exe) или [Загрузка PDF-файла](sorting-data-in-a-datalist-or-repeater-control-vb/_static/datatutorial45vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="eaaa1-105">[Download Sample App](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_45_VB.exe) or [Download PDF](sorting-data-in-a-datalist-or-repeater-control-vb/_static/datatutorial45vb1.pdf)</span></span>

> <span data-ttu-id="eaaa1-106">В этом учебнике мы рассмотрим, как включить поддержку сортировки в DataList и Repeater, а также как создать элемент управления DataList или Repeater, данные которого могут быть страничными и отсортированными.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-106">In this tutorial we'll examine how to include sorting support in the DataList and Repeater, as well as how to construct a DataList or Repeater whose data can be paged and sorted.</span></span>

## <a name="introduction"></a><span data-ttu-id="eaaa1-107">Введение</span><span class="sxs-lookup"><span data-stu-id="eaaa1-107">Introduction</span></span>

<span data-ttu-id="eaaa1-108">В [предыдущем учебном курсе](paging-report-data-in-a-datalist-or-repeater-control-vb.md) мы рассмотрели, как добавить поддержку разбиения по страницам в DataList.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-108">In the [previous tutorial](paging-report-data-in-a-datalist-or-repeater-control-vb.md) we examined how to add paging support to a DataList.</span></span> <span data-ttu-id="eaaa1-109">Мы создали новый метод в классе `ProductsBLL` (`GetProductsAsPagedDataSource`), который вернул объект `PagedDataSource`.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-109">We created a new method in the `ProductsBLL` class (`GetProductsAsPagedDataSource`) that returned a `PagedDataSource` object.</span></span> <span data-ttu-id="eaaa1-110">При привязке к элементу управления DataList или Repeater в элементе управления DataList или Repeater отображается только запрошенная страница данных.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-110">When bound to a DataList or Repeater, the DataList or Repeater would display just the requested page of data.</span></span> <span data-ttu-id="eaaa1-111">Этот метод аналогичен тому, который используется внутренне элементами управления GridView, DetailsView и FormView для предоставления встроенных функций разбиения по страницам по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-111">This technique is similar to what is used internally by the GridView, DetailsView, and FormView controls to provide their built-in default paging functionality.</span></span>

<span data-ttu-id="eaaa1-112">Помимо поддержки разбиения по страницам, GridView также включает поддержку сортировки Box.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-112">In addition to offering paging support, the GridView also includes out of the box sorting support.</span></span> <span data-ttu-id="eaaa1-113">Ни DataList, ни Repeater не предоставляют встроенные функции сортировки. Однако функции сортировки можно добавлять с помощью ряда кода.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-113">Neither the DataList nor Repeater provides built-in sorting functionality; however, sorting features can be added with a bit of code.</span></span> <span data-ttu-id="eaaa1-114">В этом учебнике мы рассмотрим, как включить поддержку сортировки в DataList и Repeater, а также как создать элемент управления DataList или Repeater, данные которого могут быть страничными и отсортированными.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-114">In this tutorial we'll examine how to include sorting support in the DataList and Repeater, as well as how to construct a DataList or Repeater whose data can be paged and sorted.</span></span>

## <a name="a-review-of-sorting"></a><span data-ttu-id="eaaa1-115">Проверка сортировки</span><span class="sxs-lookup"><span data-stu-id="eaaa1-115">A Review of Sorting</span></span>

<span data-ttu-id="eaaa1-116">Как мы видели в учебнике по [данным отчета о разбиении на страницы и сортировке](../paging-and-sorting/paging-and-sorting-report-data-vb.md) , элемент управления GridView обеспечивает поддержку сортировки в виде полей.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-116">As we saw in the [Paging and Sorting Report Data](../paging-and-sorting/paging-and-sorting-report-data-vb.md) tutorial, the GridView control provides out of the box sorting support.</span></span> <span data-ttu-id="eaaa1-117">Каждое поле GridView может иметь связанный `SortExpression`, который указывает поле данных, по которому сортируются данные.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-117">Each GridView field can have an associated `SortExpression`, which indicates the data field by which to sort the data.</span></span> <span data-ttu-id="eaaa1-118">Если свойство `AllowSorting` GridView s имеет значение `true`, то каждое поле GridView со значением свойства `SortExpression` имеет заголовок, отображаемый в качестве элемента управления LinkButton.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-118">When the GridView s `AllowSorting` property is set to `true`, each GridView field that has a `SortExpression` property value has its header rendered as a LinkButton.</span></span> <span data-ttu-id="eaaa1-119">Когда пользователь щелкает определенный заголовок поля GridView, происходит обратная передача, а данные сортируются в соответствии с выбранными полями `SortExpression`.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-119">When a user clicks a particular GridView field s header, a postback occurs and the data is sorted according to the clicked field s `SortExpression`.</span></span>

<span data-ttu-id="eaaa1-120">Элемент управления GridView также имеет свойство `SortExpression`, в котором хранится `SortExpression` поля GridView, по которому сортируются данные.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-120">The GridView control has a `SortExpression` property as well, which stores the `SortExpression` of the GridView field the data is sorted by.</span></span> <span data-ttu-id="eaaa1-121">Кроме того, свойство `SortDirection` указывает, должны ли данные быть отсортированы по возрастанию или убыванию (если пользователь дважды щелкает определенную ссылку заголовка поля GridView, то порядок сортировки переключается).</span><span class="sxs-lookup"><span data-stu-id="eaaa1-121">Additionally, a `SortDirection` property indicates whether the data is to be sorted in ascending or descending order (if a user clicks a particular GridView field s header link twice in succession, the sort order is toggled).</span></span>

<span data-ttu-id="eaaa1-122">Когда GridView привязан к своему элементу управления источниками данных, он передает `SortExpression` и `SortDirection` свойства элементу управления источником данных.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-122">When the GridView is bound to its data source control, it hands off its `SortExpression` and `SortDirection` properties to the data source control.</span></span> <span data-ttu-id="eaaa1-123">Элемент управления источника данных получает данные, а затем сортирует их в соответствии с предоставленными свойствами `SortExpression` и `SortDirection`.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-123">The data source control retrieves the data and then sorts it according to the supplied `SortExpression` and `SortDirection` properties.</span></span> <span data-ttu-id="eaaa1-124">После сортировки данных элемент управления источника данных возвращает его в GridView.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-124">After sorting the data, the data source control returns it to the GridView.</span></span>

<span data-ttu-id="eaaa1-125">Чтобы реплицировать эту функцию с помощью элементов управления DataList или Repeater, необходимо:</span><span class="sxs-lookup"><span data-stu-id="eaaa1-125">To replicate this functionality with the DataList or Repeater controls, we must:</span></span>

- <span data-ttu-id="eaaa1-126">Создание интерфейса сортировки</span><span class="sxs-lookup"><span data-stu-id="eaaa1-126">Create a sorting interface</span></span>
- <span data-ttu-id="eaaa1-127">Запомните поле данных, по которому нужно выполнить сортировку, а также порядок сортировки по возрастанию или убыванию.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-127">Remember the data field to sort by and whether to sort in ascending or descending order</span></span>
- <span data-ttu-id="eaaa1-128">Попросите ObjectDataSource отсортировать данные по определенному полю данных</span><span class="sxs-lookup"><span data-stu-id="eaaa1-128">Instruct the ObjectDataSource to sort the data by a particular data field</span></span>

<span data-ttu-id="eaaa1-129">Эти три задачи мы будем решать в шагах 3 и 4.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-129">We'll tackle these three tasks in steps 3 and 4.</span></span> <span data-ttu-id="eaaa1-130">Далее мы рассмотрим, как включить поддержку разбиения по страницам и сортировки в DataList или Repeater.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-130">Following that, we'll examine how to include both paging and sorting support in a DataList or Repeater.</span></span>

## <a name="step-2-displaying-the-products-in-a-repeater"></a><span data-ttu-id="eaaa1-131">Шаг 2. Отображение продуктов в элементе Repeater</span><span class="sxs-lookup"><span data-stu-id="eaaa1-131">Step 2: Displaying the Products in a Repeater</span></span>

<span data-ttu-id="eaaa1-132">Прежде чем беспокоиться о реализации какой-либо функции сортировки, начнем с перечисления продуктов в элементе управления Repeater.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-132">Before we worry about implementing any of the sorting-related functionality, let s start by listing the products in a Repeater control.</span></span> <span data-ttu-id="eaaa1-133">Для начала откройте страницу `Sorting.aspx` в папке `PagingSortingDataListRepeater`.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-133">Start by opening the `Sorting.aspx` page in the `PagingSortingDataListRepeater` folder.</span></span> <span data-ttu-id="eaaa1-134">Добавьте на веб-страницу элемент управления Repeater, задав для его свойства `ID` значение `SortableProducts`.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-134">Add a Repeater control to the web page, setting its `ID` property to `SortableProducts`.</span></span> <span data-ttu-id="eaaa1-135">В смарт-теге Repeater s создайте новый объект ObjectDataSource с именем `ProductsDataSource` и настройте его для получения данных из `ProductsBLL` класса s `GetProducts()` метода.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-135">From the Repeater s smart tag, create a new ObjectDataSource named `ProductsDataSource` and configure it to retrieve data from the `ProductsBLL` class s `GetProducts()` method.</span></span> <span data-ttu-id="eaaa1-136">Выберите параметр (нет) в раскрывающихся списках на вкладках Вставка, обновление и удаление.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-136">Select the (None) option from the drop-down lists in the INSERT, UPDATE, and DELETE tabs.</span></span>

<span data-ttu-id="eaaa1-137">[![создать ObjectDataSource и настроить его для использования метода Жетпродуктсаспажеддатасаурце ()](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image2.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="eaaa1-137">[![Create an ObjectDataSource and Configure it to Use the GetProductsAsPagedDataSource() Method](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image2.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image1.png)</span></span>

<span data-ttu-id="eaaa1-138">**Рис. 1**. Создание ObjectDataSource и настройка его для использования метода `GetProductsAsPagedDataSource()` ([щелкните, чтобы просмотреть изображение с полным размером](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="eaaa1-138">**Figure 1**: Create an ObjectDataSource and Configure it to Use the `GetProductsAsPagedDataSource()` Method ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image3.png))</span></span>

<span data-ttu-id="eaaa1-139">[![установить в раскрывающихся списках на вкладках обновления, вставки и удаления значение (нет)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image5.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="eaaa1-139">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE tabs to (None)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image5.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image4.png)</span></span>

<span data-ttu-id="eaaa1-140">**Рис. 2**. Настройка раскрывающихся списков на вкладках "Обновить", "вставить" и "Удалить" (нет) ([щелкните, чтобы просмотреть изображение с полным размером](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="eaaa1-140">**Figure 2**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE tabs to (None) ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image6.png))</span></span>

<span data-ttu-id="eaaa1-141">В отличие от DataList, Visual Studio не создает `ItemTemplate` для элемента управления Repeater автоматически, после того как привязывает его к источнику данных.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-141">Unlike with the DataList, Visual Studio does not automatically create an `ItemTemplate` for the Repeater control after binding it to a data source.</span></span> <span data-ttu-id="eaaa1-142">Более того, мы должны добавить эту `ItemTemplate` декларативно, так как смарт-тег элемента управления Repeater не имеет параметра Edit Templates в DataList s.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-142">Furthermore, we must add this `ItemTemplate` declaratively, as the Repeater control s smart tag lacks the Edit Templates option found in the DataList s.</span></span> <span data-ttu-id="eaaa1-143">Разрешите использовать тот же `ItemTemplate` из предыдущего руководства, в котором отображалось имя, поставщик и Категория продукта.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-143">Let s use the same `ItemTemplate` from the previous tutorial, which displayed the product s name, supplier, and category.</span></span>

<span data-ttu-id="eaaa1-144">После добавления `ItemTemplate`декларативная разметка Repeater и ObjectDataSource должна выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="eaaa1-144">After adding the `ItemTemplate`, the Repeater and ObjectDataSource s declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample1.aspx)]

<span data-ttu-id="eaaa1-145">На рис. 3 показана эта страница при просмотре в браузере.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-145">Figure 3 shows this page when viewed through a browser.</span></span>

<span data-ttu-id="eaaa1-146">[![отображается название, поставщик и Категория продукта.](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image8.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="eaaa1-146">[![Each Product s Name, Supplier, and Category is Displayed](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image8.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image7.png)</span></span>

<span data-ttu-id="eaaa1-147">**Рис. 3**. отображается название, поставщик и Категория каждого продукта ([щелкните, чтобы просмотреть изображение с полным размером](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image9.png)).</span><span class="sxs-lookup"><span data-stu-id="eaaa1-147">**Figure 3**: Each Product s Name, Supplier, and Category is Displayed ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image9.png))</span></span>

## <a name="step-3-instructing-the-objectdatasource-to-sort-the-data"></a><span data-ttu-id="eaaa1-148">Шаг 3. указание элементу управления ObjectDataSource на сортировку данных</span><span class="sxs-lookup"><span data-stu-id="eaaa1-148">Step 3: Instructing the ObjectDataSource to Sort the Data</span></span>

<span data-ttu-id="eaaa1-149">Чтобы отсортировать данные, отображаемые в элементе управления Repeater, необходимо сообщить элементу ObjectDataSource выражения сортировки, по которому должны быть отсортированы данные.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-149">To sort the data displayed in the Repeater, we need to inform the ObjectDataSource of the sort expression by which the data should be sorted.</span></span> <span data-ttu-id="eaaa1-150">Прежде чем ObjectDataSource получит свои данные, он сначала выдает [событие`Selecting`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.selecting.aspx), которое предоставляет возможность указать выражение сортировки.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-150">Before the ObjectDataSource retrieves its data, it first fires its [`Selecting` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.selecting.aspx), which provides an opportunity for us to specify a sort expression.</span></span> <span data-ttu-id="eaaa1-151">Обработчику `Selecting` событий передается объект типа [`ObjectDataSourceSelectingEventArgs`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasourceselectingeventargs.aspx), который имеет свойство с именем [`Arguments`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasourceselectingeventargs.arguments.aspx) типа [`DataSourceSelectArguments`](https://msdn.microsoft.com/library/system.web.ui.datasourceselectarguments.aspx).</span><span class="sxs-lookup"><span data-stu-id="eaaa1-151">The `Selecting` event handler is passed an object of type [`ObjectDataSourceSelectingEventArgs`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasourceselectingeventargs.aspx), which has a property named [`Arguments`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasourceselectingeventargs.arguments.aspx) of type [`DataSourceSelectArguments`](https://msdn.microsoft.com/library/system.web.ui.datasourceselectarguments.aspx).</span></span> <span data-ttu-id="eaaa1-152">Класс `DataSourceSelectArguments` предназначен для передачи запросов, связанных с данными, от потребителя данных к элементу управления источника данных и включает [свойство`SortExpression`](https://msdn.microsoft.com/library/system.web.ui.datasourceselectarguments.sortexpression.aspx).</span><span class="sxs-lookup"><span data-stu-id="eaaa1-152">The `DataSourceSelectArguments` class is designed to pass data-related requests from a consumer of data to the data source control, and includes a [`SortExpression` property](https://msdn.microsoft.com/library/system.web.ui.datasourceselectarguments.sortexpression.aspx).</span></span>

<span data-ttu-id="eaaa1-153">Чтобы передать сведения о сортировке со страницы ASP.NET в ObjectDataSource, создайте обработчик событий для события `Selecting` и используйте следующий код:</span><span class="sxs-lookup"><span data-stu-id="eaaa1-153">To pass sorting information from the ASP.NET page to the ObjectDataSource, create an event handler for the `Selecting` event and use the following code:</span></span>

[!code-vb[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample2.vb)]

<span data-ttu-id="eaaa1-154">Значение *sortExpression* должно быть присвоено имени поля данных для сортировки данных (например, ProductName).</span><span class="sxs-lookup"><span data-stu-id="eaaa1-154">The *sortExpression* value should be assigned the name of the data field to sort the data by (such as ProductName ).</span></span> <span data-ttu-id="eaaa1-155">Свойство, связанное с направлением сортировки, отсутствует, поэтому если нужно отсортировать данные в убывающем порядке, добавьте строку DESC к значению *sortExpression* (например, ProductName DESC).</span><span class="sxs-lookup"><span data-stu-id="eaaa1-155">There is no sort direction-related property, so if you want to sort the data in descending order, append the string DESC to the *sortExpression* value (such as ProductName DESC ).</span></span>

<span data-ttu-id="eaaa1-156">Попробуйте выполнить некоторые другие жестко запрограммированные значения для *sortExpression* и проверьте результаты в браузере.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-156">Go ahead and try some different hard-coded values for *sortExpression* and test the results in a browser.</span></span> <span data-ttu-id="eaaa1-157">Как показано на рис. 4, при использовании ProductName DESC в качестве *sortExpression*продукты сортируются по имени в противоположном алфавитном порядке.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-157">As Figure 4 shows, when using ProductName DESC as the *sortExpression*, the products are sorted by their name in reverse alphabetical order.</span></span>

<span data-ttu-id="eaaa1-158">[![продукты сортируются по имени в обратный алфавитный порядок](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image11.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="eaaa1-158">[![The Products are Sorted by their Name in Reverse Alphabetical Order](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image11.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image10.png)</span></span>

<span data-ttu-id="eaaa1-159">**Рис. 4**. продукты сортируются по именам в алфавитном порядке ([щелкните, чтобы просмотреть изображение с полным размером](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="eaaa1-159">**Figure 4**: The Products are Sorted by their Name in Reverse Alphabetical Order ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image12.png))</span></span>

## <a name="step-4-creating-the-sorting-interface-and-remembering-the-sort-expression-and-direction"></a><span data-ttu-id="eaaa1-160">Шаг 4. Создание интерфейса сортировки и запоминание выражения сортировки и направления</span><span class="sxs-lookup"><span data-stu-id="eaaa1-160">Step 4: Creating the Sorting Interface and Remembering the Sort Expression and Direction</span></span>

<span data-ttu-id="eaaa1-161">Включение поддержки сортировки в GridView преобразует каждый текст заголовка поля с возможностью сортировки в элемент управления LinkButton, который при щелчке сортирует данные соответствующим образом.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-161">Turning on sorting support in the GridView converts each sortable field s header text into a LinkButton that, when clicked, sorts the data accordingly.</span></span> <span data-ttu-id="eaaa1-162">Такой интерфейс сортировки имеет смысл для элемента управления GridView, где его данные четко располагаются в столбцах.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-162">Such a sorting interface makes sense for the GridView, where its data is neatly laid out in columns.</span></span> <span data-ttu-id="eaaa1-163">Однако для элементов управления DataList и Repeater требуется другой интерфейс сортировки.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-163">For the DataList and Repeater controls, however, a different sorting interface is needed.</span></span> <span data-ttu-id="eaaa1-164">Общий интерфейс сортировки для списка данных (в отличие от сетки данных) — это раскрывающийся список, предоставляющий поля, по которым можно сортировать данные.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-164">A common sorting interface for a list of data (as opposed to a grid of data), is a drop-down list that provides the fields by which the data can be sorted.</span></span> <span data-ttu-id="eaaa1-165">Давайте добавим такой интерфейс для этого руководства.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-165">Let s implement such an interface for this tutorial.</span></span>

<span data-ttu-id="eaaa1-166">Добавьте веб-элемент управления DropDownList выше `SortableProducts` Repeater и задайте для его свойства `ID` значение `SortBy`.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-166">Add a DropDownList Web control above the `SortableProducts` Repeater and set its `ID` property to `SortBy`.</span></span> <span data-ttu-id="eaaa1-167">В окно свойств нажмите кнопку с многоточием в свойстве `Items`, чтобы открыть редактор коллекции ListItem.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-167">From the Properties window, click the ellipses in the `Items` property to bring up the ListItem Collection Editor.</span></span> <span data-ttu-id="eaaa1-168">Добавьте `ListItem` s, чтобы отсортировать данные по полям `ProductName`, `CategoryName`и `SupplierName`.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-168">Add `ListItem` s to sort the data by the `ProductName`, `CategoryName`, and `SupplierName` fields.</span></span> <span data-ttu-id="eaaa1-169">Кроме того, добавьте `ListItem`, чтобы сортировать продукты по именам в алфавитном порядке.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-169">Also add a `ListItem` to sort the products by their name in reverse alphabetical order.</span></span>

<span data-ttu-id="eaaa1-170">Для свойств `ListItem` `Text` можно задать любое значение (например, имя), но свойства `Value` должны быть заданы как имя поля данных (например, ProductName).</span><span class="sxs-lookup"><span data-stu-id="eaaa1-170">The `ListItem` `Text` properties can be set to any value (such as Name ), but the `Value` properties must be set to the name of the data field (such as ProductName ).</span></span> <span data-ttu-id="eaaa1-171">Чтобы отсортировать результаты в убывающем порядке, добавьте строку DESC в имя поля данных, например ProductName.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-171">To sort the results in descending order, append the string DESC to the data field name, like ProductName DESC .</span></span>

![Добавление ListItem для каждого поля данных, допускающего сортировку](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image13.png)

<span data-ttu-id="eaaa1-173">**Рис. 5**. Добавление `ListItem` для каждого поля данных, допускающего сортировку</span><span class="sxs-lookup"><span data-stu-id="eaaa1-173">**Figure 5**: Add a `ListItem` for Each of the Sortable Data Fields</span></span>

<span data-ttu-id="eaaa1-174">Наконец, добавьте веб-элемент управления Button справа от DropDownList.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-174">Finally, add a Button Web control to the right of the DropDownList.</span></span> <span data-ttu-id="eaaa1-175">Задайте для его `ID` значение `RefreshRepeater` и его свойство `Text` для обновления.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-175">Set its `ID` to `RefreshRepeater` and its `Text` property to Refresh .</span></span>

<span data-ttu-id="eaaa1-176">После создания `ListItem` и добавления кнопки «Обновить» декларативный синтаксис элемента DropDownList и Button должен выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="eaaa1-176">After creating the `ListItem` s and adding the Refresh button, the DropDownList and Button s declarative syntax should look similar to the following:</span></span>

[!code-aspx[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample3.aspx)]

<span data-ttu-id="eaaa1-177">После завершения работы DropDownList необходимо обновить обработчик событий ObjectDataSource `Selecting`, чтобы в нем использовалось выбранное свойство `SortBy``ListItem` s `Value`, а не жестко заданное выражение сортировки.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-177">With the sorting DropDownList complete, we next need to update the ObjectDataSource s `Selecting` event handler so that it uses the selected `SortBy``ListItem` s `Value` property as opposed to a hard-coded sort expression.</span></span>

[!code-vb[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample4.vb)]

<span data-ttu-id="eaaa1-178">На этом этапе при первом посещении страницы товары изначально сортируются по полю `ProductName` данные, как `SortBy` `ListItem` выбрано по умолчанию (см. рис. 6).</span><span class="sxs-lookup"><span data-stu-id="eaaa1-178">At this point when first visiting the page the products will initially be sorted by the `ProductName` data field, as it s the `SortBy` `ListItem` selected by default (see Figure 6).</span></span> <span data-ttu-id="eaaa1-179">Выбор другого варианта сортировки, например Категория, и нажатие кнопки Обновить приведет к обратной передаче и повторной сортировке данных по имени категории, как показано на рис. 7.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-179">Selecting a different sorting option such as Category and clicking Refresh will cause a postback and re-sort the data by the category name, as Figure 7 shows.</span></span>

<span data-ttu-id="eaaa1-180">[![продукты изначально сортируются по имени](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image15.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image14.png)</span><span class="sxs-lookup"><span data-stu-id="eaaa1-180">[![The Products are Initially Sorted by their Name](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image15.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image14.png)</span></span>

<span data-ttu-id="eaaa1-181">**Рис. 6**. первоначально отсортированные продукты по имени ([щелкните, чтобы просмотреть изображение с полным размером](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="eaaa1-181">**Figure 6**: The Products are Initially Sorted by their Name ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image16.png))</span></span>

<span data-ttu-id="eaaa1-182">[![продукты теперь сортируются по категориям](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image18.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="eaaa1-182">[![The Products are Now Sorted by Category](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image18.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image17.png)</span></span>

<span data-ttu-id="eaaa1-183">**Рис. 7**. Теперь продукты сортируются по категориям ([щелкните, чтобы просмотреть изображение с полным размером](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image19.png))</span><span class="sxs-lookup"><span data-stu-id="eaaa1-183">**Figure 7**: The Products are Now Sorted by Category ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image19.png))</span></span>

> [!NOTE]
> <span data-ttu-id="eaaa1-184">Нажатие кнопки «Обновить» приводит к автоматическому пересортировке данных, так как состояние представления Repeater s было отключено, что приводит к повторной привязке Repeater к своему источнику данных при каждой обратной передаче.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-184">Clicking the Refresh button causes the data to automatically be re-sorted because the Repeater s view state has been disabled, thereby causing the Repeater to rebind to its data source on every postback.</span></span> <span data-ttu-id="eaaa1-185">Если оставить состояние представления Repeater s включенным, изменение раскрывающегося списка сортировка не повлияет на порядок сортировки.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-185">If you ve left the Repeater s view state enabled, changing the sorting drop-down list won't have any affect on the sort order.</span></span> <span data-ttu-id="eaaa1-186">Чтобы устранить эту проблему, создайте обработчик событий для кнопки обновления `Click` событие и повторно привяжите Repeater к своему источнику данных (вызвав метод Repeater s `DataBind()`).</span><span class="sxs-lookup"><span data-stu-id="eaaa1-186">To remedy this, create an event handler for the Refresh Button s `Click` event and rebind the Repeater to its data source (by calling the Repeater s `DataBind()` method).</span></span>

## <a name="remembering-the-sort-expression-and-direction"></a><span data-ttu-id="eaaa1-187">Запоминание выражения и направления сортировки</span><span class="sxs-lookup"><span data-stu-id="eaaa1-187">Remembering the Sort Expression and Direction</span></span>

<span data-ttu-id="eaaa1-188">При создании сортируемого элемента управления DataList или Repeater на странице, где могут возникать обратные передачи, не относящиеся к сортировке, крайне важно, чтобы выражение сортировки и направление были сохранены в обратных передачах.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-188">When creating a sortable DataList or Repeater on a page where non-sort related postbacks may occur, it s imperative that the sort expression and direction be remembered across postbacks.</span></span> <span data-ttu-id="eaaa1-189">Например, предположим, что мы обновили Repeater в этом учебнике, чтобы включить кнопку «Удалить» для каждого продукта.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-189">For example, imagine that we updated the Repeater in this tutorial to include a Delete button with each product.</span></span> <span data-ttu-id="eaaa1-190">Когда пользователь нажимает кнопку "Удалить", мы выполняем код, чтобы удалить выбранный продукт, а затем повторно привязать данные к элементу Repeater.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-190">When the user clicks the Delete button we d run some code to delete the selected product and then rebind the data to the Repeater.</span></span> <span data-ttu-id="eaaa1-191">Если сведения о сортировке не сохраняются в обратной передаче, то данные, отображаемые на экране, будут возвращаться к исходному порядку сортировки.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-191">If the sort details are not persisted across postback, the data displayed on screen will revert to the original sort order.</span></span>

<span data-ttu-id="eaaa1-192">В этом руководстве DropDownList неявно сохраняет выражение сортировки и направление в своем состоянии просмотра для нас.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-192">For this tutorial, the DropDownList implicitly saves the sort expression and direction in its view state for us.</span></span> <span data-ttu-id="eaaa1-193">Если бы мы использовали другой интерфейс сортировки, например LinkButton, который предоставил различные варианты сортировки, нам нужно помнить, что порядок сортировки для обратных передач должен быть важен.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-193">If we were using a different sorting interface one with, say, LinkButtons that provided the various sorting options we d need to take care to remember the sort order across postbacks.</span></span> <span data-ttu-id="eaaa1-194">Это можно сделать, сохранив параметры сортировки в состоянии просмотра страницы, включив параметр Sort в строку запроса или используя другой метод сохранения состояния.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-194">This could be accomplished by storing the sorting parameters in the page s view state, by including the sort parameter in the querystring, or through some other state persistence technique.</span></span>

<span data-ttu-id="eaaa1-195">В будущих примерах этого учебника рассматривается сохранение сведений о сортировке в состоянии просмотра страницы.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-195">Future examples in this tutorial explore how to persist the sorting details in the page s view state.</span></span>

## <a name="step-5-adding-sorting-support-to-a-datalist-that-uses-default-paging"></a><span data-ttu-id="eaaa1-196">Шаг 5. Добавление поддержки сортировки в DataList, который использует разбиение по страницам по умолчанию</span><span class="sxs-lookup"><span data-stu-id="eaaa1-196">Step 5: Adding Sorting Support to a DataList that Uses Default Paging</span></span>

<span data-ttu-id="eaaa1-197">В [предыдущем учебном курсе](paging-report-data-in-a-datalist-or-repeater-control-vb.md) мы рассмотрели, как реализовать разбиение по страницам по умолчанию с помощью DataList.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-197">In the [preceding tutorial](paging-report-data-in-a-datalist-or-repeater-control-vb.md) we examined how to implement default paging with a DataList.</span></span> <span data-ttu-id="eaaa1-198">Добавим этот предыдущий пример, чтобы включить возможность сортировки данных, находящихся на странице.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-198">Let s extend this previous example to include the ability to sort the paged data.</span></span> <span data-ttu-id="eaaa1-199">Для начала откройте `SortingWithDefaultPaging.aspx` и `Paging.aspx` страницы в папке `PagingSortingDataListRepeater`.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-199">Start by opening the `SortingWithDefaultPaging.aspx` and `Paging.aspx` pages in the `PagingSortingDataListRepeater` folder.</span></span> <span data-ttu-id="eaaa1-200">На странице `Paging.aspx` нажмите кнопку Источник, чтобы просмотреть декларативную разметку страницы s.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-200">From the `Paging.aspx` page, click on the Source button to view the page s declarative markup.</span></span> <span data-ttu-id="eaaa1-201">Скопируйте выделенный текст (см. рис. 8) и вставьте его в декларативную разметку `SortingWithDefaultPaging.aspx` между тегами `<asp:Content>`.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-201">Copy the selected text (see Figure 8) and paste it into the declarative markup of `SortingWithDefaultPaging.aspx` between the `<asp:Content>` tags.</span></span>

<span data-ttu-id="eaaa1-202">[![реплицировать декларативную разметку в теги &lt;ASP: Content&gt; тегами из файла paging. aspx в Сортингвисдефаултпагинг. aspx.](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image21.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image20.png)</span><span class="sxs-lookup"><span data-stu-id="eaaa1-202">[![Replicate the Declarative Markup in the &lt;asp:Content&gt; Tags from Paging.aspx to SortingWithDefaultPaging.aspx](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image21.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image20.png)</span></span>

<span data-ttu-id="eaaa1-203">**Рис. 8**. репликация декларативной разметки в теги `<asp:Content>` из `Paging.aspx` в `SortingWithDefaultPaging.aspx` ([щелкните, чтобы просмотреть изображение с полным размером](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="eaaa1-203">**Figure 8**: Replicate the Declarative Markup in the `<asp:Content>` Tags from `Paging.aspx` to `SortingWithDefaultPaging.aspx` ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image22.png))</span></span>

<span data-ttu-id="eaaa1-204">После копирования декларативной разметки скопируйте методы и свойства в класс кода программной части `Paging.aspx` Pages в класс кода программной части для `SortingWithDefaultPaging.aspx`.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-204">After copying the declarative markup, copy the methods and properties in the `Paging.aspx` page s code-behind class to the code-behind class for `SortingWithDefaultPaging.aspx`.</span></span> <span data-ttu-id="eaaa1-205">Затем просмотрите страницу `SortingWithDefaultPaging.aspx` в браузере.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-205">Next, take a moment to view the `SortingWithDefaultPaging.aspx` page in a browser.</span></span> <span data-ttu-id="eaaa1-206">Она должна демонстрировать те же функциональные возможности и внешний вид, что и `Paging.aspx`.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-206">It should exhibit the same functionality and appearance as `Paging.aspx`.</span></span>

## <a name="enhancing-productsbll-to-include-a-default-paging-and-sorting-method"></a><span data-ttu-id="eaaa1-207">Улучшение ProductsBLL для включения метода разбиения по страницам и сортировки по умолчанию</span><span class="sxs-lookup"><span data-stu-id="eaaa1-207">Enhancing ProductsBLL to Include a Default Paging and Sorting Method</span></span>

<span data-ttu-id="eaaa1-208">В предыдущем учебном курсе мы создали метод `GetProductsAsPagedDataSource(pageIndex, pageSize)` в классе `ProductsBLL`, который вернул объект `PagedDataSource`.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-208">In the previous tutorial we created a `GetProductsAsPagedDataSource(pageIndex, pageSize)` method in the `ProductsBLL` class that returned a `PagedDataSource` object.</span></span> <span data-ttu-id="eaaa1-209">Этот объект `PagedDataSource` был заполнен *всеми* продуктами (с помощью метода `GetProducts()` BLL), но при привязке к DataList отображались только те записи, которые соответствуют указанным входным параметрам *pageIndex* и *pageSize* .</span><span class="sxs-lookup"><span data-stu-id="eaaa1-209">This `PagedDataSource` object was populated with *all* of the products (via the BLL s `GetProducts()` method), but when bound to the DataList only those records corresponding to the specified *pageIndex* and *pageSize* input parameters were displayed.</span></span>

<span data-ttu-id="eaaa1-210">Ранее в этом руководстве мы добавили поддержку сортировки, указав выражение сортировки из обработчика событий ObjectDataSource `Selecting`.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-210">Earlier in this tutorial we added sorting support by specifying the sort expression from the ObjectDataSource s `Selecting` event handler.</span></span> <span data-ttu-id="eaaa1-211">Это хорошо работает, когда ObjectDataSource возвращает объект, который можно сортировать, например `ProductsDataTable`, возвращаемый методом `GetProducts()`.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-211">This works well when the ObjectDataSource is returned an object that can be sorted, like the `ProductsDataTable` returned by the `GetProducts()` method.</span></span> <span data-ttu-id="eaaa1-212">Однако объект `PagedDataSource`, возвращаемый методом `GetProductsAsPagedDataSource`, не поддерживает сортировку внутреннего источника данных.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-212">However, the `PagedDataSource` object returned by the `GetProductsAsPagedDataSource` method does not support sorting of its inner data source.</span></span> <span data-ttu-id="eaaa1-213">Вместо этого необходимо отсортировать результаты, возвращенные методом `GetProducts()`, *перед* помещением их в `PagedDataSource`.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-213">Instead, we need to sort the results returned from the `GetProducts()` method *before* we put it in the `PagedDataSource`.</span></span>

<span data-ttu-id="eaaa1-214">Чтобы сделать это, создайте новый метод в классе `ProductsBLL` `GetProductsSortedAsPagedDataSource(sortExpression, pageIndex, pageSize)`.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-214">To accomplish this, create a new method in the `ProductsBLL` class, `GetProductsSortedAsPagedDataSource(sortExpression, pageIndex, pageSize)`.</span></span> <span data-ttu-id="eaaa1-215">Чтобы отсортировать `ProductsDataTable`, возвращаемый методом `GetProducts()`, укажите свойство `Sort` `DataTableView`по умолчанию:</span><span class="sxs-lookup"><span data-stu-id="eaaa1-215">To sort the `ProductsDataTable` returned by the `GetProducts()` method, specify the `Sort` property of its default `DataTableView`:</span></span>

[!code-vb[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample5.vb)]

<span data-ttu-id="eaaa1-216">Метод `GetProductsSortedAsPagedDataSource` немного отличается от метода `GetProductsAsPagedDataSource`, созданного в предыдущем руководстве.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-216">The `GetProductsSortedAsPagedDataSource` method differs only slightly from the `GetProductsAsPagedDataSource` method created in the previous tutorial.</span></span> <span data-ttu-id="eaaa1-217">В частности, `GetProductsSortedAsPagedDataSource` принимает дополнительный входной параметр `sortExpression` и присваивает это значение свойству `Sort` `ProductDataTable` `DefaultView`.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-217">In particular, `GetProductsSortedAsPagedDataSource` accepts an additional input parameter `sortExpression` and assigns this value to the `Sort` property of the `ProductDataTable` s `DefaultView`.</span></span> <span data-ttu-id="eaaa1-218">После нескольких строк кода источнику DataSource `PagedDataSource` Object s назначается `ProductDataTable` s `DefaultView`.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-218">A few lines of code later, the `PagedDataSource` object s DataSource is assigned the `ProductDataTable` s `DefaultView`.</span></span>

## <a name="calling-the-getproductssortedaspageddatasource-method-and-specifying-the-value-for-the-sortexpression-input-parameter"></a><span data-ttu-id="eaaa1-219">Вызов метода Жетпродуктссортедаспажеддатасаурце и указание значения для входного параметра SortExpression</span><span class="sxs-lookup"><span data-stu-id="eaaa1-219">Calling the GetProductsSortedAsPagedDataSource Method and Specifying the Value for the SortExpression Input Parameter</span></span>

<span data-ttu-id="eaaa1-220">После завершения метода `GetProductsSortedAsPagedDataSource` необходимо предоставить значение для этого параметра.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-220">With the `GetProductsSortedAsPagedDataSource` method complete, the next step is to provide the value for this parameter.</span></span> <span data-ttu-id="eaaa1-221">ObjectDataSource в `SortingWithDefaultPaging.aspx` в настоящее время настроен для вызова метода `GetProductsAsPagedDataSource` и передает два входных параметра через два `QueryStringParameters`, которые указаны в коллекции `SelectParameters`.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-221">The ObjectDataSource in `SortingWithDefaultPaging.aspx` is currently configured to call the `GetProductsAsPagedDataSource` method and passes in the two input parameters through its two `QueryStringParameters`, which are specified in the `SelectParameters` collection.</span></span> <span data-ttu-id="eaaa1-222">Эти два `QueryStringParameters` указывают, что источник для параметров `GetProductsAsPagedDataSource` методов *pageIndex* и *pageSize* взят из полей QueryString `pageIndex` и `pageSize`.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-222">These two `QueryStringParameters` indicate that the source for the `GetProductsAsPagedDataSource` method s *pageIndex* and *pageSize* parameters come from the querystring fields `pageIndex` and `pageSize`.</span></span>

<span data-ttu-id="eaaa1-223">Обновите свойство `SelectMethod` ObjectDataSource s таким образом, чтобы оно вызывало новый метод `GetProductsSortedAsPagedDataSource`.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-223">Update the ObjectDataSource s `SelectMethod` property so that it invokes the new `GetProductsSortedAsPagedDataSource` method.</span></span> <span data-ttu-id="eaaa1-224">Затем добавьте новый `QueryStringParameter`, чтобы получить доступ к входному параметру *sortExpression* из поля QueryString `sortExpression`.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-224">Then, add a new `QueryStringParameter` so that the *sortExpression* input parameter is accessed from the querystring field `sortExpression`.</span></span> <span data-ttu-id="eaaa1-225">Задайте для `QueryStringParameter` s `DefaultValue` значение ProductName.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-225">Set the `QueryStringParameter` s `DefaultValue` to ProductName .</span></span>

<span data-ttu-id="eaaa1-226">После этих изменений декларативная разметка ObjectDataSource s должна выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="eaaa1-226">After these changes, the ObjectDataSource s declarative markup should look like:</span></span>

[!code-aspx[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample6.aspx)]

<span data-ttu-id="eaaa1-227">На этом этапе страница `SortingWithDefaultPaging.aspx` сортирует результаты в алфавитном порядке по названию продукта (см. рис. 9).</span><span class="sxs-lookup"><span data-stu-id="eaaa1-227">At this point, the `SortingWithDefaultPaging.aspx` page will sort its results alphabetically by the product name (see Figure 9).</span></span> <span data-ttu-id="eaaa1-228">Это связано с тем, что по умолчанию значение ProductName передается в качестве параметра `GetProductsSortedAsPagedDataSource` Method s *sortExpression* .</span><span class="sxs-lookup"><span data-stu-id="eaaa1-228">This is because, by default, a value of ProductName is passed in as the `GetProductsSortedAsPagedDataSource` method s *sortExpression* parameter.</span></span>

<span data-ttu-id="eaaa1-229">[![по умолчанию результаты сортируются по ProductName](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image24.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="eaaa1-229">[![By Default, the Results are Sorted by ProductName](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image24.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image23.png)</span></span>

<span data-ttu-id="eaaa1-230">**Рис. 9**. по умолчанию результаты сортируются по `ProductName` ([щелкните, чтобы просмотреть изображение с полным размером](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image25.png))</span><span class="sxs-lookup"><span data-stu-id="eaaa1-230">**Figure 9**: By Default, the Results are Sorted by `ProductName` ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image25.png))</span></span>

<span data-ttu-id="eaaa1-231">Если вручную добавить поле `sortExpression` QueryString, например `SortingWithDefaultPaging.aspx?sortExpression=CategoryName` результаты будут отсортированы по указанному `sortExpression`.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-231">If you manually add a `sortExpression` querystring field such as `SortingWithDefaultPaging.aspx?sortExpression=CategoryName` the results will be sorted by the specified `sortExpression`.</span></span> <span data-ttu-id="eaaa1-232">Однако этот параметр `sortExpression` не включается в строку запроса при переходе на другую страницу данных.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-232">However, this `sortExpression` parameter is not included in the querystring when moving to a different page of data.</span></span> <span data-ttu-id="eaaa1-233">На самом деле, нажатие кнопок «Следующая» или «последняя страница» вернет нас к `Paging.aspx`!</span><span class="sxs-lookup"><span data-stu-id="eaaa1-233">In fact, clicking on the Next or Last page buttons takes us back to `Paging.aspx`!</span></span> <span data-ttu-id="eaaa1-234">Кроме того, в настоящее время нет интерфейса сортировки.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-234">Furthermore, there s currently no sorting interface.</span></span> <span data-ttu-id="eaaa1-235">Единственный способ, которым пользователь может изменить порядок сортировки данных на странице, заключается в непосредственном управлении строкой запроса.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-235">The only way a user can change the sort order of the paged data is by manipulating the querystring directly.</span></span>

## <a name="creating-the-sorting-interface"></a><span data-ttu-id="eaaa1-236">Создание интерфейса сортировки</span><span class="sxs-lookup"><span data-stu-id="eaaa1-236">Creating the Sorting Interface</span></span>

<span data-ttu-id="eaaa1-237">Сначала необходимо обновить метод `RedirectUser`, чтобы отправить пользователю `SortingWithDefaultPaging.aspx` (а не `Paging.aspx`) и включить значение `sortExpression` в строку запроса.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-237">We first need to update the `RedirectUser` method to send the user to `SortingWithDefaultPaging.aspx` (instead of `Paging.aspx`) and to include the `sortExpression` value in the querystring.</span></span> <span data-ttu-id="eaaa1-238">Также следует добавить свойство `SortExpression`, доступное только для чтения, с именем уровня страницы.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-238">We should also add a read-only, page-level named `SortExpression` property.</span></span> <span data-ttu-id="eaaa1-239">Это свойство аналогично свойствам `PageIndex` и `PageSize`, созданным в предыдущем руководстве, возвращает значение поля `sortExpression` QueryString, если оно существует, и значение по умолчанию (ProductName) в противном случае.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-239">This property, similar to the `PageIndex` and `PageSize` properties created in the previous tutorial, returns the value of the `sortExpression` querystring field if it exists, and the default value ( ProductName ) otherwise.</span></span>

<span data-ttu-id="eaaa1-240">В настоящее время метод `RedirectUser` принимает только один входной параметр, который является индексом отображаемой страницы.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-240">Currently the `RedirectUser` method accepts only a single input parameter the index of the page to display.</span></span> <span data-ttu-id="eaaa1-241">Однако иногда требуется перенаправить пользователя на определенную страницу данных с помощью выражения сортировки, отличного от того, что указано в строке запроса.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-241">However, there may be times when we want to redirect the user to a particular page of data using a sort expression other than what s specified in the querystring.</span></span> <span data-ttu-id="eaaa1-242">Сейчас мы создадим интерфейс сортировки для этой страницы, который будет включать ряд веб-элементов управления "Кнопка" для сортировки данных по указанному столбцу.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-242">In a moment we'll create the sorting interface for this page, which will include a series of Button Web controls for sorting the data by a specified column.</span></span> <span data-ttu-id="eaaa1-243">При нажатии одной из этих кнопок необходимо перенаправить пользователя, передав ему соответствующее значение выражения сортировки.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-243">When one of those Buttons is clicked, we want to redirect the user passing in the appropriate sort expression value.</span></span> <span data-ttu-id="eaaa1-244">Чтобы обеспечить эту функциональность, создайте две версии метода `RedirectUser`.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-244">To provide this functionality, create two versions of the `RedirectUser` method.</span></span> <span data-ttu-id="eaaa1-245">Первый из них должен принимать только индекс страницы для вывода, а второй принимает индекс страницы и выражение сортировки.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-245">The first one should accept just the page index to display, while the second one accepts the page index and sort expression.</span></span>

[!code-vb[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample7.vb)]

<span data-ttu-id="eaaa1-246">В первом примере в этом руководстве мы создали интерфейс сортировки с помощью DropDownList.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-246">In the first example in this tutorial, we created a sorting interface using a DropDownList.</span></span> <span data-ttu-id="eaaa1-247">В этом примере мы будем использовать три веб-элемента управления "Кнопка", расположенные над элементом DataList, для сортировки по `ProductName`, один для `CategoryName`и один для `SupplierName`.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-247">For this example, let s use three Button Web controls positioned above the DataList one for sorting by `ProductName`, one for `CategoryName`, and one for `SupplierName`.</span></span> <span data-ttu-id="eaaa1-248">Добавьте три веб-элемента управления "Кнопка", задав их `ID` и свойства `Text` соответствующим образом:</span><span class="sxs-lookup"><span data-stu-id="eaaa1-248">Add the three Button Web controls, setting their `ID` and `Text` properties appropriately:</span></span>

[!code-aspx[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample8.aspx)]

<span data-ttu-id="eaaa1-249">Затем создайте обработчик событий `Click` для каждого из них.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-249">Next, create a `Click` event handler for each.</span></span> <span data-ttu-id="eaaa1-250">Обработчики событий должны вызывать метод `RedirectUser`, возвращая пользователя на первую страницу с помощью соответствующего выражения сортировки.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-250">The event handlers should call the `RedirectUser` method, returning the user to the first page using the appropriate sort expression.</span></span>

[!code-vb[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample9.vb)]

<span data-ttu-id="eaaa1-251">При первом посещении страницы данные сортируются по названию продукта в алфавитном порядке (см. рис. 9).</span><span class="sxs-lookup"><span data-stu-id="eaaa1-251">When first visiting the page, the data is sorted by the product name alphabetically (refer back to Figure 9).</span></span> <span data-ttu-id="eaaa1-252">Нажмите кнопку Далее, чтобы перейти на вторую страницу данных, а затем нажмите кнопку Сортировать по категории.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-252">Click the Next button to advance to the second page of data and then click the Sort by Category button.</span></span> <span data-ttu-id="eaaa1-253">Это возвращает нам первую страницу данных, отсортированную по имени категории (см. рис. 10).</span><span class="sxs-lookup"><span data-stu-id="eaaa1-253">This returns us to the first page of data, sorted by category name (see Figure 10).</span></span> <span data-ttu-id="eaaa1-254">Аналогичным образом, при нажатии кнопки Сортировать по поставщику данные сортируются по поставщикам, начиная с первой страницы данных.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-254">Likewise, clicking the Sort by Supplier button sorts the data by supplier starting from the first page of data.</span></span> <span data-ttu-id="eaaa1-255">Вариант сортировки запоминается по мере постраничного просмотра данных.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-255">The sort choice is remembered as the data is paged through.</span></span> <span data-ttu-id="eaaa1-256">На рис. 11 показана страница после сортировки по категории, а затем переводится на страницу тринадцатого данных.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-256">Figure 11 shows the page after sorting by category and then advancing to the thirteenth page of data.</span></span>

<span data-ttu-id="eaaa1-257">[![продукты сортируются по категориям](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image27.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image26.png)</span><span class="sxs-lookup"><span data-stu-id="eaaa1-257">[![The Products are Sorted by Category](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image27.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image26.png)</span></span>

<span data-ttu-id="eaaa1-258">**Рис. 10**. продукты сортируются по категориям ([щелкните, чтобы просмотреть изображение с полным размером](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image28.png))</span><span class="sxs-lookup"><span data-stu-id="eaaa1-258">**Figure 10**: The Products are Sorted by Category ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image28.png))</span></span>

<span data-ttu-id="eaaa1-259">[![выражение сортировки запоминается при разбиении по страницам данных](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image30.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="eaaa1-259">[![The Sort Expression is Remembered When Paging Through the Data](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image30.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image29.png)</span></span>

<span data-ttu-id="eaaa1-260">**Рис. 11**. выражение сортировки запоминается при разбиении по страницам данных ([щелкните, чтобы просмотреть изображение с полным размером](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image31.png))</span><span class="sxs-lookup"><span data-stu-id="eaaa1-260">**Figure 11**: The Sort Expression is Remembered When Paging Through the Data ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image31.png))</span></span>

## <a name="step-6-custom-paging-through-records-in-a-repeater"></a><span data-ttu-id="eaaa1-261">Шаг 6. пользовательское разбиение по записям в элементе Repeater</span><span class="sxs-lookup"><span data-stu-id="eaaa1-261">Step 6: Custom Paging Through Records in a Repeater</span></span>

<span data-ttu-id="eaaa1-262">Пример элемента управления DataList, проверенный на шаге 5, просматривает данные с помощью неэффективного метода разбиения по страницам по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-262">The DataList example examined in step 5 pages through its data using the inefficient default paging technique.</span></span> <span data-ttu-id="eaaa1-263">При разбиении на страницы достаточно большого объема данных необходимо использовать настраиваемое разбиение по страницам.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-263">When paging through sufficiently large amounts of data, it is imperative that custom paging be used.</span></span> <span data-ttu-id="eaaa1-264">Вернувшись к [эффективному разбиению на страницы больших объемов данных](../paging-and-sorting/efficiently-paging-through-large-amounts-of-data-vb.md) и [сортировку пользовательских](../paging-and-sorting/sorting-custom-paged-data-vb.md) учебных курсов по данным, мы рассматривали различия между стандартным и пользовательским разбиением по страницам и созданными методами в BLL для использования пользовательского разбиения на страницы и сортировки данных, настраиваемых на странице.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-264">Back in the [Efficiently Paging Through Large Amounts of Data](../paging-and-sorting/efficiently-paging-through-large-amounts-of-data-vb.md) and [Sorting Custom Paged Data](../paging-and-sorting/sorting-custom-paged-data-vb.md) tutorials, we examined the differences between default and custom paging and created methods in the BLL for utilizing custom paging and sorting custom paged data.</span></span> <span data-ttu-id="eaaa1-265">В частности, в этих двух предыдущих учебных курсах мы добавили в класс `ProductsBLL` следующие три метода:</span><span class="sxs-lookup"><span data-stu-id="eaaa1-265">In particular, in these two previous tutorials we added the following three methods to the `ProductsBLL` class:</span></span>

- <span data-ttu-id="eaaa1-266">`GetProductsPaged(startRowIndex, maximumRows)` возвращает определенное подмножество записей, начиная с *startRowIndex* и не превышающих *maximumRows*.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-266">`GetProductsPaged(startRowIndex, maximumRows)` returns a particular subset of records starting at *startRowIndex* and not exceeding *maximumRows*.</span></span>
- <span data-ttu-id="eaaa1-267">`GetProductsPagedAndSorted(sortExpression, startRowIndex, maximumRows)` возвращает конкретное подмножество записей, отсортированных по указанному входному параметру *sortExpression* .</span><span class="sxs-lookup"><span data-stu-id="eaaa1-267">`GetProductsPagedAndSorted(sortExpression, startRowIndex, maximumRows)` returns a particular subset of records sorted by the specified *sortExpression* input parameter.</span></span>
- <span data-ttu-id="eaaa1-268">`TotalNumberOfProducts()` предоставляет общее количество записей в таблице `Products` базы данных.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-268">`TotalNumberOfProducts()` provides the total number of records in the `Products` database table.</span></span>

<span data-ttu-id="eaaa1-269">Эти методы можно использовать для эффективной страницы и сортировки данных с помощью элемента управления DataList или Repeater.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-269">These methods can be used to efficiently page and sort through data using a DataList or Repeater control.</span></span> <span data-ttu-id="eaaa1-270">Чтобы проиллюстрировать это, давайте начнем с создания элемента управления Repeater с поддержкой пользовательского разбиения по страницам. Затем мы добавим возможности сортировки.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-270">To illustrate this, let s start by creating a Repeater control with custom paging support; we'll then add sorting capabilities.</span></span>

<span data-ttu-id="eaaa1-271">Откройте страницу `SortingWithCustomPaging.aspx` в папке `PagingSortingDataListRepeater` и добавьте к странице элемент Repeater, установив для свойства `ID` значение `Products`.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-271">Open the `SortingWithCustomPaging.aspx` page in the `PagingSortingDataListRepeater` folder and add a Repeater to the page, setting its `ID` property to `Products`.</span></span> <span data-ttu-id="eaaa1-272">В смарт-теге Repeater s создайте новый элемент управления ObjectDataSource с именем `ProductsDataSource`.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-272">From the Repeater s smart tag, create a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="eaaa1-273">Настройте его для выбора данных из `GetProductsPaged` метода `ProductsBLL` классов.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-273">Configure it to select its data from the `ProductsBLL` class s `GetProductsPaged` method.</span></span>

<span data-ttu-id="eaaa1-274">[![настроить ObjectDataSource для использования метода GetProductsPaged класса ProductsBLL](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image33.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image32.png)</span><span class="sxs-lookup"><span data-stu-id="eaaa1-274">[![Configure the ObjectDataSource to Use the ProductsBLL Class s GetProductsPaged Method](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image33.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image32.png)</span></span>

<span data-ttu-id="eaaa1-275">**Рис. 12**. Настройка ObjectDataSource для использования метода `GetProductsPaged` `ProductsBLL` классов ([щелкните, чтобы просмотреть изображение с полным размером](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image34.png))</span><span class="sxs-lookup"><span data-stu-id="eaaa1-275">**Figure 12**: Configure the ObjectDataSource to Use the `ProductsBLL` Class s `GetProductsPaged` Method ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image34.png))</span></span>

<span data-ttu-id="eaaa1-276">Задайте для раскрывающихся списков на вкладках обновление, вставить и удалить значение (нет), а затем нажмите кнопку Далее.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-276">Set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) and then click the Next button.</span></span> <span data-ttu-id="eaaa1-277">Мастер настройки источников данных теперь запрашивает источники `GetProductsPaged` Method s *startRowIndex* и *maximumRows* input Parameters.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-277">The Configure Data Source wizard now prompts for the sources of the `GetProductsPaged` method s *startRowIndex* and *maximumRows* input parameters.</span></span> <span data-ttu-id="eaaa1-278">В действительности эти входные параметры не учитываются.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-278">In actuality, these input parameters are ignored.</span></span> <span data-ttu-id="eaaa1-279">Вместо этого значения *startRowIndex* и *maximumRows* будут передаваться через свойство `Arguments` в обработчике событий ObjectDataSource `Selecting`, точно так же, как мы указали *sortExpression* в этом учебнике первой демонстрацией.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-279">Instead, the *startRowIndex* and *maximumRows* values will be passed in through the `Arguments` property in the ObjectDataSource s `Selecting` event handler, just like how we specified the *sortExpression* in this tutorial s first demo.</span></span> <span data-ttu-id="eaaa1-280">Поэтому не задавайте в раскрывающихся списках источник параметров в мастере значение нет.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-280">Therefore, leave the parameter source drop-down lists in the wizard set at None .</span></span>

<span data-ttu-id="eaaa1-281">[![оставьте для источников параметров значение нет.](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image36.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="eaaa1-281">[![Leave the Parameter Sources Set to None](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image36.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image35.png)</span></span>

<span data-ttu-id="eaaa1-282">**Рис. 13**. Оставьте для источников параметров значение None ([щелкните, чтобы просмотреть изображение с полным размером](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image37.png)).</span><span class="sxs-lookup"><span data-stu-id="eaaa1-282">**Figure 13**: Leave the Parameter Sources Set to None ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image37.png))</span></span>

> [!NOTE]
> <span data-ttu-id="eaaa1-283">*Не* устанавливайте для свойства ObjectDataSource `EnablePaging` значение `true`.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-283">Do *not* set the ObjectDataSource s `EnablePaging` property to `true`.</span></span> <span data-ttu-id="eaaa1-284">Это приведет к тому, что ObjectDataSource автоматически включит собственные параметры *startRowIndex* и *maximumRows* в список существующих параметров `SelectMethod` s.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-284">This will cause the ObjectDataSource to automatically include its own *startRowIndex* and *maximumRows* parameters to the `SelectMethod` s existing parameter list.</span></span> <span data-ttu-id="eaaa1-285">Свойство `EnablePaging` удобно использовать при привязке настраиваемых данных с страничными данными к элементу управления GridView, DetailsView или FormView, поскольку эти элементы управления предполагают определенное поведение от ObjectDataSource, которое доступно только при `true`свойства `EnablePaging`.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-285">The `EnablePaging` property is useful when binding custom paged data to a GridView, DetailsView, or FormView control because these controls expect certain behavior from the ObjectDataSource that s only available when `EnablePaging` property is `true`.</span></span> <span data-ttu-id="eaaa1-286">Поскольку необходимо вручную добавить поддержку разбиения по страницам для элементов управления DataList и Repeater, оставьте для этого свойства значение `false` (по умолчанию), так как мы внедрить в необходимой функциональности непосредственно на странице ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-286">Since we have to manually add the paging support for the DataList and Repeater, leave this property set to `false` (the default), as we'll bake in the needed functionality directly within our ASP.NET page.</span></span>

<span data-ttu-id="eaaa1-287">Наконец, определите `ItemTemplate` Repeater s, чтобы отображались название, Категория и поставщик продукта.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-287">Finally, define the Repeater s `ItemTemplate` so that the product s name, category, and supplier are shown.</span></span> <span data-ttu-id="eaaa1-288">После этих изменений декларативный синтаксис Repeater и ObjectDataSource должен выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="eaaa1-288">After these changes, the Repeater and ObjectDataSource s declarative syntax should look similar to the following:</span></span>

[!code-aspx[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample10.aspx)]

<span data-ttu-id="eaaa1-289">Уделите время посетить страницу в браузере и обратите внимание, что записи не возвращаются.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-289">Take a moment to visit the page through a browser and note that no records are returned.</span></span> <span data-ttu-id="eaaa1-290">Это связано с тем, что мы еще не указали значения параметров *startRowIndex* и *maximumRows* . Таким образом, значения 0 передаются в обоих случаях.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-290">This is because we ve yet to specify the *startRowIndex* and *maximumRows* parameter values; therefore, values of 0 are being passed in for both.</span></span> <span data-ttu-id="eaaa1-291">Чтобы указать эти значения, создайте обработчик событий для события `Selecting` ObjectDataSource и задайте значения этих параметров программным путем в жестко запрограммированные значения 0 и 5 соответственно:</span><span class="sxs-lookup"><span data-stu-id="eaaa1-291">To specify these values, create an event handler for the ObjectDataSource s `Selecting` event and set these parameters values programmatically to hard-coded values of 0 and 5, respectively:</span></span>

[!code-vb[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample11.vb)]

<span data-ttu-id="eaaa1-292">При таком изменении на странице при просмотре в браузере отображаются первые пять продуктов.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-292">With this change, the page, when viewed through a browser, shows the first five products.</span></span>

<span data-ttu-id="eaaa1-293">[![отображаются первые пять записей](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image39.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image38.png)</span><span class="sxs-lookup"><span data-stu-id="eaaa1-293">[![The First Five Records are Displayed](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image39.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image38.png)</span></span>

<span data-ttu-id="eaaa1-294">**Рис. 14**. Отображение первых пяти записей ([щелкните, чтобы просмотреть изображение с полным размером](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image40.png))</span><span class="sxs-lookup"><span data-stu-id="eaaa1-294">**Figure 14**: The First Five Records are Displayed ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image40.png))</span></span>

> [!NOTE]
> <span data-ttu-id="eaaa1-295">Продукты, перечисленные на рис. 14, сортируются по названию продукта, так как хранимая процедура `GetProductsPaged`, выполняющая эффективный пользовательский запрос разбиения на страницы, упорядочивает результаты по `ProductName`.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-295">The products listed in Figure 14 happen to be sorted by product name because the `GetProductsPaged` stored procedure that performs the efficient custom paging query orders the results by `ProductName`.</span></span>

<span data-ttu-id="eaaa1-296">Чтобы позволить пользователю проходить по шагам страниц, необходимо отследить индексы начальной и максимальной строк и запоминать эти значения во всех обратных передачах.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-296">In order to allow the user to step through the pages, we need to keep track of the start row index and maximum rows and remember these values across postbacks.</span></span> <span data-ttu-id="eaaa1-297">В примере с подкачкой по умолчанию мы использовали поля QueryString для сохранения этих значений. для этой демонстрации позвольте нам сохранить эти сведения в состоянии просмотра страницы.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-297">In the default paging example we used querystring fields to persist these values; for this demo, let s persist this information in the page s view state.</span></span> <span data-ttu-id="eaaa1-298">Создайте следующие два свойства:</span><span class="sxs-lookup"><span data-stu-id="eaaa1-298">Create the following two properties:</span></span>

[!code-vb[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample12.vb)]

<span data-ttu-id="eaaa1-299">Затем обновите код в обработчике событий выбора, чтобы он использовал свойства `StartRowIndex` и `MaximumRows`, а не жестко запрограммированные значения 0 и 5.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-299">Next, update the code in the Selecting event handler so that it uses the `StartRowIndex` and `MaximumRows` properties instead of the hard-coded values of 0 and 5:</span></span>

[!code-vb[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample13.vb)]

<span data-ttu-id="eaaa1-300">На этом этапе страница по-прежнему показывает только первые пять записей.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-300">At this point our page still shows just the first five records.</span></span> <span data-ttu-id="eaaa1-301">Тем не менее, с этими свойствами мы повторно готовы к созданию интерфейса разбиения по страницам.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-301">However, with these properties in place, we re ready to create our paging interface.</span></span>

## <a name="adding-the-paging-interface"></a><span data-ttu-id="eaaa1-302">Добавление интерфейса разбиения на страницы</span><span class="sxs-lookup"><span data-stu-id="eaaa1-302">Adding the Paging Interface</span></span>

<span data-ttu-id="eaaa1-303">Позвольте использовать тот же самый первый, предыдущий, последний интерфейс разбиения по страницам, используемый в примере по умолчанию, включая веб-элемент управления Label, отображающий просматриваемую страницу данных и общее количество страниц.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-303">Let s use the same First, Previous, Next, Last paging interface used in the default paging example, including the Label Web control that displays what page of data is being viewed and how many total pages exist.</span></span> <span data-ttu-id="eaaa1-304">Добавьте четыре веб-элемента управления "Кнопка" и метку под элементом Repeater.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-304">Add the four Button Web controls and Label below the Repeater.</span></span>

[!code-aspx[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample14.aspx)]

<span data-ttu-id="eaaa1-305">Затем создайте обработчики событий `Click` для четырех кнопок.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-305">Next, create `Click` event handlers for the four Buttons.</span></span> <span data-ttu-id="eaaa1-306">При нажатии одной из этих кнопок необходимо обновить `StartRowIndex` и повторно привязать данные к элементу Repeater.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-306">When one of these Buttons is clicked, we need to update the `StartRowIndex` and rebind the data to the Repeater.</span></span> <span data-ttu-id="eaaa1-307">Код для первой, предыдущей и следующей кнопок достаточно прост, но для последней кнопки как определить индекс начальной строки для последней страницы данных?</span><span class="sxs-lookup"><span data-stu-id="eaaa1-307">The code for the First, Previous, and Next buttons is simple enough, but for the Last button how do we determine the start row index for the last page of data?</span></span> <span data-ttu-id="eaaa1-308">Чтобы вычислить этот индекс, а также определить, должны ли быть включены кнопки «Следующая» и «последняя», необходимо знать, сколько записей в общем объеме страницы.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-308">To compute this index as well as being able to determine whether the Next and Last buttons should be enabled we need to know how many records in total are being paged through.</span></span> <span data-ttu-id="eaaa1-309">Это можно определить, вызвав метод `ProductsBLL` класса s `TotalNumberOfProducts()`.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-309">We can determine this by calling the `ProductsBLL` class s `TotalNumberOfProducts()` method.</span></span> <span data-ttu-id="eaaa1-310">Давайте создадим свойство уровня страницы, доступное только для чтения, с именем `TotalRowCount`, которое возвращает результаты метода `TotalNumberOfProducts()`:</span><span class="sxs-lookup"><span data-stu-id="eaaa1-310">Let s create a read-only, page-level property named `TotalRowCount` that returns the results of the `TotalNumberOfProducts()` method:</span></span>

[!code-vb[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample15.vb)]

<span data-ttu-id="eaaa1-311">С помощью этого свойства теперь можно определить индекс начальной строки последней страницы.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-311">With this property we can now determine the last page s start row index.</span></span> <span data-ttu-id="eaaa1-312">В частности, это целочисленный результат `TotalRowCount` минус 1, разделенный на `MaximumRows`, умноженный на `MaximumRows`.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-312">Specifically, it s the integer result of the `TotalRowCount` minus 1 divided by `MaximumRows`, multiplied by `MaximumRows`.</span></span> <span data-ttu-id="eaaa1-313">Теперь можно написать обработчики событий `Click` для четырех кнопок интерфейса разбиения на страницы:</span><span class="sxs-lookup"><span data-stu-id="eaaa1-313">We can now write the `Click` event handlers for the four paging interface buttons:</span></span>

[!code-vb[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample16.vb)]

<span data-ttu-id="eaaa1-314">Наконец, необходимо отключить первую и предыдущую кнопки в интерфейсе разбиения по страницам при просмотре первой страницы данных и кнопок «Далее» и «последняя» при просмотре последней страницы.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-314">Finally, we need to disable the First and Previous buttons in the paging interface when viewing the first page of data and the Next and Last buttons when viewing the last page.</span></span> <span data-ttu-id="eaaa1-315">Для этого добавьте следующий код в обработчик событий ObjectDataSource `Selecting`:</span><span class="sxs-lookup"><span data-stu-id="eaaa1-315">To accomplish this, add the following code to the ObjectDataSource s `Selecting` event handler:</span></span>

[!code-vb[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample17.vb)]

<span data-ttu-id="eaaa1-316">После добавления этих `Click` обработчиков событий и кода для включения или отключения элементов интерфейса разбиения на страницы на основе текущего индекса начальной строки проверьте страницу в браузере.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-316">After adding these `Click` event handlers and the code to enable or disable the paging interface elements based on the current start row index, test the page in a browser.</span></span> <span data-ttu-id="eaaa1-317">Как показано на рис. 15, при первом посещении страницы будут отключены первая и предыдущая кнопки.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-317">As Figure 15 illustrates, when first visiting the page the First and Previous buttons will are disabled.</span></span> <span data-ttu-id="eaaa1-318">При нажатии кнопки Далее отображается вторая страница данных, а при нажатии кнопки последний отображается последняя страница (см. рис. 16 и 17).</span><span class="sxs-lookup"><span data-stu-id="eaaa1-318">Clicking Next shows the second page of data, while clicking Last displays the final page (see Figures 16 and 17).</span></span> <span data-ttu-id="eaaa1-319">При просмотре последней страницы данных отключаются обе кнопки: Следующая и последняя.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-319">When viewing the last page of data both the Next and Last buttons are disabled.</span></span>

<span data-ttu-id="eaaa1-320">[![кнопки "Предыдущая" и "Последняя" отключены при просмотре первой страницы продуктов](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image42.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image41.png)</span><span class="sxs-lookup"><span data-stu-id="eaaa1-320">[![The Previous and Last Buttons are Disabled When Viewing the First Page of Products](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image42.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image41.png)</span></span>

<span data-ttu-id="eaaa1-321">**Рис. 15**. кнопки "Предыдущий" и "последний" отключены при просмотре первой страницы продуктов ([щелкните, чтобы просмотреть изображение с полным размером](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image43.png))</span><span class="sxs-lookup"><span data-stu-id="eaaa1-321">**Figure 15**: The Previous and Last Buttons are Disabled When Viewing the First Page of Products ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image43.png))</span></span>

<span data-ttu-id="eaaa1-322">[![отображается вторая страница продуктов](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image45.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image44.png)</span><span class="sxs-lookup"><span data-stu-id="eaaa1-322">[![The Second Page of Products are Displayed](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image45.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image44.png)</span></span>

<span data-ttu-id="eaaa1-323">**Рис. 16**. Отображение второй страницы продуктов ([щелкните, чтобы просмотреть изображение с полным размером](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image46.png))</span><span class="sxs-lookup"><span data-stu-id="eaaa1-323">**Figure 16**: The Second Page of Products are Displayed ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image46.png))</span></span>

<span data-ttu-id="eaaa1-324">[![нажатии кнопки Last отображает последнюю страницу данных](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image48.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image47.png)</span><span class="sxs-lookup"><span data-stu-id="eaaa1-324">[![Clicking Last Displays the Final Page of Data](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image48.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image47.png)</span></span>

<span data-ttu-id="eaaa1-325">**Рис. 17**. нажатие кнопки Last отображает последнюю страницу данных ([щелкните, чтобы просмотреть изображение с полным размером](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image49.png))</span><span class="sxs-lookup"><span data-stu-id="eaaa1-325">**Figure 17**: Clicking Last Displays the Final Page of Data ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image49.png))</span></span>

## <a name="step-7-including-sorting-support-with-the-custom-paged-repeater"></a><span data-ttu-id="eaaa1-326">Шаг 7. Включение поддержки сортировки с помощью настраиваемого повторителя на страницы</span><span class="sxs-lookup"><span data-stu-id="eaaa1-326">Step 7: Including Sorting Support with the Custom Paged Repeater</span></span>

<span data-ttu-id="eaaa1-327">Теперь, когда пользовательское разбиение по страницам реализовано, мы повторно готовы к включению поддержки сортировки.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-327">Now that custom paging has been implemented, we re ready to include sorting support.</span></span> <span data-ttu-id="eaaa1-328">Метод `ProductsBLL` классов `GetProductsPagedAndSorted` имеет те же входные параметры *startRowIndex* и *maximumRows* , что и `GetProductsPaged`, но допускает дополнительный входной параметр *sortExpression* .</span><span class="sxs-lookup"><span data-stu-id="eaaa1-328">The `ProductsBLL` class s `GetProductsPagedAndSorted` method has the same *startRowIndex* and *maximumRows* input parameters as `GetProductsPaged`, but permits an additional *sortExpression* input parameter.</span></span> <span data-ttu-id="eaaa1-329">Чтобы использовать метод `GetProductsPagedAndSorted` из `SortingWithCustomPaging.aspx`, необходимо выполнить следующие действия.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-329">To use the `GetProductsPagedAndSorted` method from `SortingWithCustomPaging.aspx`, we need to perform the following steps:</span></span>

1. <span data-ttu-id="eaaa1-330">Измените свойство `SelectMethod` ObjectDataSource s с `GetProductsPaged` на `GetProductsPagedAndSorted`.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-330">Change the ObjectDataSource s `SelectMethod` property from `GetProductsPaged` to `GetProductsPagedAndSorted`.</span></span>
2. <span data-ttu-id="eaaa1-331">Добавьте объект `Parameter` *sortExpression* в коллекцию `SelectParameters` ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-331">Add a *sortExpression* `Parameter` object to the ObjectDataSource s `SelectParameters` collection.</span></span>
3. <span data-ttu-id="eaaa1-332">Создайте закрытое свойство `SortExpression` на уровне страницы, сохраняющее свое значение во всех обратных передачах через состояние просмотра страницы.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-332">Create a private, page-level `SortExpression` property that persists its value across postbacks through the page s view state.</span></span>
4. <span data-ttu-id="eaaa1-333">Обновите обработчик событий `Selecting` ObjectDataSource s, чтобы назначить параметру ObjectDataSource *sortExpression* значение свойства `SortExpression` уровня страницы.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-333">Update the ObjectDataSource s `Selecting` event handler to assign the ObjectDataSource s *sortExpression* parameter the value of the page-level `SortExpression` property.</span></span>
5. <span data-ttu-id="eaaa1-334">Создайте интерфейс сортировки.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-334">Create the sorting interface.</span></span>

<span data-ttu-id="eaaa1-335">Начните с обновления свойства `SelectMethod` ObjectDataSource s и добавления `Parameter`*sortExpression* .</span><span class="sxs-lookup"><span data-stu-id="eaaa1-335">Start by updating the ObjectDataSource s `SelectMethod` property and adding a *sortExpression* `Parameter`.</span></span> <span data-ttu-id="eaaa1-336">Убедитесь, что свойство *sortExpression* `Parameter` s `Type` имеет значение `String`.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-336">Make sure that the *sortExpression* `Parameter` s `Type` property is set to `String`.</span></span> <span data-ttu-id="eaaa1-337">После выполнения этих первых двух задач декларативная разметка ObjectDataSource s должна выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="eaaa1-337">After completing these first two tasks, the ObjectDataSource s declarative markup should look like the following:</span></span>

[!code-aspx[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample18.aspx)]

<span data-ttu-id="eaaa1-338">Далее нам нужно свойство `SortExpression` уровня страницы, значение которого сериализуется в состояние представления.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-338">Next, we need a page-level `SortExpression` property whose value is serialized to view state.</span></span> <span data-ttu-id="eaaa1-339">Если значение выражения сортировки не задано, используйте ProductName в качестве значения по умолчанию:</span><span class="sxs-lookup"><span data-stu-id="eaaa1-339">If no sort expression value has been set, use ProductName as the default:</span></span>

[!code-vb[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample19.vb)]

<span data-ttu-id="eaaa1-340">Прежде чем ObjectDataSource вызовет метод `GetProductsPagedAndSorted`, необходимо установить `Parameter` *sortExpression* в значение свойства `SortExpression`.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-340">Before the ObjectDataSource invokes the `GetProductsPagedAndSorted` method we need to set the *sortExpression* `Parameter` to the value of the `SortExpression` property.</span></span> <span data-ttu-id="eaaa1-341">В обработчике событий `Selecting` добавьте следующую строку кода:</span><span class="sxs-lookup"><span data-stu-id="eaaa1-341">In the `Selecting` event handler, add the following line of code:</span></span>

[!code-vb[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample20.vb)]

<span data-ttu-id="eaaa1-342">Остается только реализовать интерфейс сортировки.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-342">All that remains is to implement the sorting interface.</span></span> <span data-ttu-id="eaaa1-343">Как и в последнем примере, пусть интерфейс сортировки реализован с помощью трех веб-элементов управления "Кнопка", которые позволяют пользователю сортировать результаты по названию продукта, категории или поставщику.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-343">As we did in the last example, let s have the sorting interface implemented using three Button Web controls that allow the user to sort the results by product name, category, or supplier.</span></span>

[!code-aspx[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample21.aspx)]

<span data-ttu-id="eaaa1-344">Создайте `Click` обработчиков событий для этих трех элементов управления "Кнопка".</span><span class="sxs-lookup"><span data-stu-id="eaaa1-344">Create `Click` event handlers for these three Button controls.</span></span> <span data-ttu-id="eaaa1-345">В обработчике событий сбросьте `StartRowIndex` в значение 0, присвойте `SortExpression` подходящему значению и выполните повторную привязку данных к элементу Repeater:</span><span class="sxs-lookup"><span data-stu-id="eaaa1-345">In the event handler, reset the `StartRowIndex` to 0, set the `SortExpression` to the appropriate value, and rebind the data to the Repeater:</span></span>

[!code-vb[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample22.vb)]

<span data-ttu-id="eaaa1-346">Вот и все!</span><span class="sxs-lookup"><span data-stu-id="eaaa1-346">That s all there is to it!</span></span> <span data-ttu-id="eaaa1-347">Хотя существует ряд действий по реализации пользовательского разбиения по страницам и сортировки, шаги были очень похожи на те, что были необходимы для разбиения по страницам по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-347">While there were a number of steps to get custom paging and sorting implemented, the steps were very similar to those needed for default paging.</span></span> <span data-ttu-id="eaaa1-348">На рис. 18 показаны продукты при просмотре последней страницы данных при сортировке по категории.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-348">Figure 18 shows the products when viewing the last page of data when sorted by category.</span></span>

<span data-ttu-id="eaaa1-349">[![на последней странице данных, отсортированной по категории, отображается](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image51.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image50.png)</span><span class="sxs-lookup"><span data-stu-id="eaaa1-349">[![The Last Page of Data, Sorted by Category, is Displayed](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image51.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image50.png)</span></span>

<span data-ttu-id="eaaa1-350">**Рис. 18**. Отображение последней страницы данных, отсортированных по категориям ([щелкните, чтобы просмотреть изображение с полным размером](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image52.png))</span><span class="sxs-lookup"><span data-stu-id="eaaa1-350">**Figure 18**: The Last Page of Data, Sorted by Category, is Displayed ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image52.png))</span></span>

> [!NOTE]
> <span data-ttu-id="eaaa1-351">В предыдущих примерах при сортировке по поставщику SupplierName был использован в качестве выражения сортировки.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-351">In previous examples, when sorting by the supplier SupplierName was used as the sort expression.</span></span> <span data-ttu-id="eaaa1-352">Однако для реализации пользовательского разбиения по страницам необходимо использовать CompanyName.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-352">However, for the custom paging implementation, we need to use CompanyName.</span></span> <span data-ttu-id="eaaa1-353">Это происходит потому, что хранимая процедура, отвечающая за реализацию пользовательского разбиения `GetProductsPagedAndSorted` по страницам, передает выражение сортировки в ключевое слово `ROW_NUMBER()`, ключевому слову `ROW_NUMBER()` требуется фактическое имя столбца, а не псевдоним.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-353">This is because the stored procedure responsible for implementing custom paging `GetProductsPagedAndSorted` passes the sort expression into the `ROW_NUMBER()` keyword, The `ROW_NUMBER()` keyword requires the actual column name rather than an alias.</span></span> <span data-ttu-id="eaaa1-354">Поэтому необходимо использовать `CompanyName` (имя столбца в `Suppliers` таблице) вместо псевдонима, используемого в запросе `SELECT` (`SupplierName`) для выражения сортировки.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-354">Therefore, we must use `CompanyName` (the name of the column in the `Suppliers` table) rather than the alias used in the `SELECT` query (`SupplierName`) for the sort expression.</span></span>

## <a name="summary"></a><span data-ttu-id="eaaa1-355">Сводка</span><span class="sxs-lookup"><span data-stu-id="eaaa1-355">Summary</span></span>

<span data-ttu-id="eaaa1-356">Ни элемент управления DataList, ни Repeater не поддерживают встроенную поддержку сортировки, но с небольшой частью кода и пользовательского интерфейса сортировки, такие функциональные возможности можно добавить.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-356">Neither the DataList nor Repeater offer built-in sorting support, but with a bit of code and a custom sorting interface, such functionality can be added.</span></span> <span data-ttu-id="eaaa1-357">При реализации сортировки, но без разбиения по страницам выражение сортировки можно указать с помощью объекта `DataSourceSelectArguments`, переданного в метод `Select` ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-357">When implementing sorting, but not paging, the sort expression can be specified through the `DataSourceSelectArguments` object passed into the ObjectDataSource s `Select` method.</span></span> <span data-ttu-id="eaaa1-358">Это свойство `DataSourceSelectArguments` `SortExpression` объекта можно назначить в обработчике событий ObjectDataSource `Selecting`.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-358">This `DataSourceSelectArguments` object s `SortExpression` property can be assigned in the ObjectDataSource s `Selecting` event handler.</span></span>

<span data-ttu-id="eaaa1-359">Чтобы добавить возможности сортировки в элемент управления DataList или Repeater, который уже обеспечивает поддержку разбиения по страницам, самый простой подход заключается в настройке уровня бизнес-логики для включения метода, принимающего выражение сортировки.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-359">To add sorting capabilities to a DataList or Repeater that already provides paging support, the easiest approach is to customize the Business Logic Layer to include a method that accepts a sort expression.</span></span> <span data-ttu-id="eaaa1-360">Эти сведения затем можно передать с помощью параметра в `SelectParameters`ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-360">This information can then be passed in through a parameter in the ObjectDataSource s `SelectParameters`.</span></span>

<span data-ttu-id="eaaa1-361">Этот учебник завершает изучение разбиения по страницам и сортировку с помощью элементов управления DataList и Repeater.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-361">This tutorial completes our examination of paging and sorting with the DataList and Repeater controls.</span></span> <span data-ttu-id="eaaa1-362">В следующем и последнем учебнике рассматривается добавление веб-элементов управления "Кнопка" в шаблоны DataList и Repeater s для предоставления некоторых пользовательских функций, инициированных пользователем, для отдельных элементов.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-362">Our next and final tutorial will examine how to add Button Web controls to the DataList and Repeater s templates in order to provide some custom, user-initiated functionality on a per-item basis.</span></span>

<span data-ttu-id="eaaa1-363">Поздравляем с программированием!</span><span class="sxs-lookup"><span data-stu-id="eaaa1-363">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="eaaa1-364">Об авторе</span><span class="sxs-lookup"><span data-stu-id="eaaa1-364">About the Author</span></span>

<span data-ttu-id="eaaa1-365">[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи книг по ASP/ASP. NET и основатель [4GuysFromRolla.com](http://www.4guysfromrolla.com), работал с веб-технологиями Майкрософт с 1998.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-365">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="eaaa1-366">Скотт работает как независимый консультант, преподаватель и модуль записи.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-366">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="eaaa1-367">Его последняя книга — [*Sams обучать себя ASP.NET 2,0 за 24 часа*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="eaaa1-367">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="eaaa1-368">Он доступен по адресу [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="eaaa1-368">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="eaaa1-369">или через его блог, который можно найти по адресу [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="eaaa1-369">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="eaaa1-370">Специальная благодарность</span><span class="sxs-lookup"><span data-stu-id="eaaa1-370">Special Thanks To</span></span>

<span data-ttu-id="eaaa1-371">Эта серия руководств была рассмотрена многими полезными рецензентами.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-371">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="eaaa1-372">Специалистом по интересу для работы с этим руководством был Дэвид суру.</span><span class="sxs-lookup"><span data-stu-id="eaaa1-372">Lead reviewer for this tutorial was David Suru.</span></span> <span data-ttu-id="eaaa1-373">Хотите ознакомиться с моими будущими статьями MSDN?</span><span class="sxs-lookup"><span data-stu-id="eaaa1-373">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="eaaa1-374">Если это так, расположите строку в [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="eaaa1-374">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="eaaa1-375">Назад</span><span class="sxs-lookup"><span data-stu-id="eaaa1-375">Previous</span></span>](paging-report-data-in-a-datalist-or-repeater-control-vb.md)
