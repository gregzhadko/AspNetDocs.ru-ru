---
uid: web-forms/overview/data-access/introduction/master-pages-and-site-navigation-cs
title: Главные страницы и Навигация по сайтуC#() | Документация Майкрософт
author: rick-anderson
description: Одной из распространенных характеристик удобных для пользователя веб-сайтов является то, что они имеют единообразный макет страниц и схему навигации на уровне всего сайта. В этом учебнике рассматривается, как y...
ms.author: riande
ms.date: 03/31/2010
ms.assetid: 5aee8202-a4e3-4aa9-8a95-cd5d156cea4c
msc.legacyurl: /web-forms/overview/data-access/introduction/master-pages-and-site-navigation-cs
msc.type: authoredcontent
ms.openlocfilehash: e1ddd43524a61ff2e012171eba1a8dc8efbf8f1d
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/28/2019
ms.locfileid: "74587716"
---
# <a name="master-pages-and-site-navigation-c"></a>Эталонные страницы и структура навигации веб-сайта (C#)

по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Скачивание примера приложения](https://download.microsoft.com/download/4/6/3/463cf87c-4724-4cbc-b7b5-3f866f43ba50/ASPNET_Data_Tutorial_3_CS.exe) или [Загрузка PDF-файла](master-pages-and-site-navigation-cs/_static/datatutorial03cs1.pdf)

> Одной из распространенных характеристик удобных для пользователя веб-сайтов является то, что они имеют единообразный макет страниц и схему навигации на уровне всего сайта. В этом учебнике рассматривается создание согласованного внешнего вида и поведения на всех страницах, которые можно легко обновить.

## <a name="introduction"></a>Введение

Одной из распространенных характеристик удобных для пользователя веб-сайтов является то, что они имеют единообразный макет страниц и схему навигации на уровне всего сайта. В ASP.NET 2,0 появились две новые функции, которые значительно упрощают реализацию макета страницы и схемы навигации на уровне всего сайта: главные страницы и Навигация по веб-узлу. Главные страницы позволяют разработчикам создавать шаблоны на уровне сайта с назначенными редактируемыми областями. Затем этот шаблон можно применить к страницам ASP.NET на сайте. Такие страницы ASP.NET должны предоставлять только содержимое для изменяемых регионов главной страницы. вся остальная разметка главной страницы идентична на всех страницах ASP.NET, использующих эту главную страницу. Эта модель позволяет разработчикам определять и централизовать макет страниц на уровне всего сайта, тем самым упрощая создание единообразного внешнего вида и поведения на всех страницах, которые можно легко обновлять.

[Система навигации по веб-узлу](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx) предоставляет разработчикам страниц механизм, позволяющий определить карту узла и API-интерфейс для этой схемы узла для программного запроса. Новые навигационные веб-элементы управления — меню, TreeView и SiteMapPath позволяют легко отображать карту узла или ее часть в общем элементе пользовательского интерфейса навигации. Мы будем использовать поставщик навигации по веб-узлу по умолчанию, что означает, что наша схема узла будет определяться в файле формата XML.

Чтобы проиллюстрировать эти понятия и сделать наш веб-сайт учебных материалов более удобным, давайте проверим, что это занятие, определяющее макет страницы на уровне сайта, реализуя карту узла и добавив Пользовательский интерфейс навигации. По завершении работы с этим руководством у нас будет готовая разработка веб-страниц для создания наших руководств.

[![конечный результат работы с этим руководством](master-pages-and-site-navigation-cs/_static/image2.png)](master-pages-and-site-navigation-cs/_static/image1.png)

**Рис. 1**. конечный результат этого учебника ([щелкните, чтобы просмотреть изображение с полным размером](master-pages-and-site-navigation-cs/_static/image3.png))

## <a name="step-1-creating-the-master-page"></a>Шаг 1. Создание главной страницы

Первым шагом является создание главной страницы для сайта. Сейчас наш веб-сайт состоит только из типизированного набора данных (`Northwind.xsd`, в папке `App_Code`), классов BLL (`ProductsBLL.cs`, `CategoriesBLL.cs`и т. д., всех в папке `App_Code`), базы данных (`NORTHWND.MDF`, в папке `App_Data`), файла конфигурации (`Web.config`) и файла таблицы стилей CSS (`Styles.css`). Я удалил эти страницы и файлы, демонстрирующие использование DAL и BLL из первых двух руководств, так как мы будем изучать эти примеры более подробно в следующих учебных курсах.

![Файлы в нашем проекте](master-pages-and-site-navigation-cs/_static/image4.png)

**Рис. 2**. файлы в нашем проекте

Чтобы создать главную страницу, щелкните правой кнопкой мыши имя проекта в обозреватель решений и выберите команду Добавить новый элемент. Затем выберите тип главной страницы из списка шаблонов и назовите его `Site.master`.

[![добавить на веб-сайт новую главную страницу](master-pages-and-site-navigation-cs/_static/image6.png)](master-pages-and-site-navigation-cs/_static/image5.png)

**Рис. 3**. Добавление новой главной страницы на веб-сайт ([щелкните, чтобы просмотреть изображение с полным размером](master-pages-and-site-navigation-cs/_static/image7.png))

Определите макет страницы для всего сайта на главной странице. Вы можете использовать представление конструирования и добавлять необходимые макеты или веб-элементы управления, или вручную добавить разметку в представлении источника. На главной странице я использую [каскадные таблицы стилей](http://www.w3schools.com/css/default.asp) для позиционирования и стилей с параметрами CSS, определенными во внешнем файле `Style.css`. Хотя вы не можете понять приведенную ниже разметку, правила CSS определены таким образом, что содержимое `<div>`навигации имеет абсолютное позиционирование, чтобы оно отображалось слева и имеет фиксированную ширину 200 пикселей.

Site. master

[!code-aspx[Main](master-pages-and-site-navigation-cs/samples/sample1.aspx)]

Эталонная страница определяет как статический макет страницы, так и регионы, которые можно изменять с помощью страниц ASP.NET, использующих главную страницу. Эти изменяемые регионы обозначаются элементом управления ContentPlaceHolder, который можно увидеть в `<div>`содержимого. Наша главная страница имеет один элемент ContentPlaceHolder (`MainContent`), но у главной страницы может быть несколько элементов управления ContentPlaceHolder.

После того, как была указана разметка, переход на представление конструирования отображает макет главной страницы. Все страницы ASP.NET, использующие эту эталонную страницу, будут иметь такой единообразный макет с возможностью указать разметку для `MainContent` региона.

[![главную страницу при просмотре в режиме конструктора](master-pages-and-site-navigation-cs/_static/image9.png)](master-pages-and-site-navigation-cs/_static/image8.png)

**Рис. 4**. Главная страница при просмотре в режиме конструктора ([щелкните, чтобы просмотреть изображение с полным размером](master-pages-and-site-navigation-cs/_static/image10.png))

## <a name="step-2-adding-a-homepage-to-the-website"></a>Шаг 2. Добавление домашней страницы на веб-сайт

После определения главной страницы мы готовы добавить страницы ASP.NET для веб-сайта. Начнем с добавления `Default.aspx`, домашней страницы веб-сайта. Щелкните правой кнопкой мыши имя проекта в обозреватель решений и выберите команду Добавить новый элемент. Выберите параметр веб-форма из списка шаблонов и присвойте файлу имя `Default.aspx`. Также установите флажок "выбрать главную страницу".

[![добавить новую веб-форму, установив флажок Выбрать главную страницу](master-pages-and-site-navigation-cs/_static/image12.png)](master-pages-and-site-navigation-cs/_static/image11.png)

**Рис. 5**. Добавление новой веб-формы и установка флажка «выбор главной страницы» ([щелкните, чтобы просмотреть изображение с полным размером](master-pages-and-site-navigation-cs/_static/image13.png))

После нажатия кнопки "ОК" вам будет предложено выбрать главную страницу, которую должна использовать эта новая страница ASP.NET. Хотя в проекте может быть несколько главных страниц, у нас есть только одна.

[![выбрать главную страницу, которую должна использовать Эта страница ASP.NET](master-pages-and-site-navigation-cs/_static/image15.png)](master-pages-and-site-navigation-cs/_static/image14.png)

**Рис. 6**. Выбор главной страницы, которую должна использовать эта страница ASP.NET ([щелкните, чтобы просмотреть изображение с полным размером](master-pages-and-site-navigation-cs/_static/image16.png))

После выбора главной страницы новые страницы ASP.NET будут содержать следующую разметку:

Default.aspx

[!code-aspx[Main](master-pages-and-site-navigation-cs/samples/sample2.aspx)]

В директиве `@Page` имеется ссылка на используемый файл главной страницы (`MasterPageFile="~/Site.master"`), а разметка страницы ASP.NET содержит элемент управления содержимым для каждого элемента управления ContentPlaceHolder, определенного на главной странице, и `ContentPlaceHolderID` элемента управления, сопоставляя элемент управления Content с определенным элементом ContentPlaceHolder. Элемент управления содержимым позволяет поместить разметку, которая будет отображаться в соответствующем элементе ContentPlaceHolder. Задайте для `Title`ной директивы `@Page` атрибут Home и добавьте некоторое содержимое дружелюбны в элемент управления содержимым:

Default.aspx

[!code-aspx[Main](master-pages-and-site-navigation-cs/samples/sample3.aspx)]

Атрибут `Title` в директиве `@Page` позволяет нам задать заголовок страницы на странице ASP.NET, даже если элемент `<title>` определен на главной странице. Можно также задать заголовок программно с помощью `Page.Title`. Также обратите внимание, что ссылки на эталонную страницу таблиц стилей (например, `Style.css`) автоматически обновляются, чтобы они работали на любой странице ASP.NET, независимо от каталога, в котором находится страница ASP.NET, относительно главной страницы.

Перейдя к представление конструирования можно увидеть, как страница будет выглядеть в браузере. Обратите внимание на то, что в представление конструирования для страницы ASP.NET, что изменяемая разметка, не относящаяся к элементу ContentPlaceHolder, определенная на главной странице, неактивна.

[![режиме конструктора для страницы ASP.NET отображаются изменяемые и неизменяемые регионы.](master-pages-and-site-navigation-cs/_static/image18.png)](master-pages-and-site-navigation-cs/_static/image17.png)

**Рис. 7**. в представлении конструктора для страницы ASP.NET отображаются редактируемые и нередактируемые регионы ([щелкните, чтобы просмотреть изображение с полным размером](master-pages-and-site-navigation-cs/_static/image19.png)).

Когда браузер посещает страницу `Default.aspx`, подсистема ASP.NET автоматически объединяет содержимое главной страницы страницы и ASP. И готовит содержимое к просмотру в окончательном HTML-коде, который отправляется в запрашивающий браузер. При обновлении содержимого главной страницы содержимое всех ASP.NET страниц, использующих эту эталонную страницу, будет объединено с новым содержимым главной страницы при следующем запросе. Вкратце, модель главной страницы позволяет определить один шаблон макета страницы (главную страницу), изменения которого немедленно отражаются на всем сайте.

## <a name="adding-additional-aspnet-pages-to-the-website"></a>Добавление дополнительных страниц ASP.NET на веб-сайт

Давайте попробуем добавить дополнительные заглушки страниц ASP.NET на сайт, где в конечном итоге будут храниться различные демонстрационные версии отчетов. Общее количество демонстраций будет более 35, поэтому, вместо того чтобы создавать все страницы-заглушки, создадим только первые. Так как также будет много категорий демонстраций, чтобы лучше управлять демонстрационными роликами, добавьте папку для категорий. Для этого добавьте следующие три папки:

- `BasicReporting`
- `Filtering`
- `CustomFormatting`

Наконец, добавьте новые файлы, как показано на обозреватель решений рис. 8. При добавлении каждого файла не забудьте установить флажок "выбрать главную страницу".

![Добавьте следующие файлы:](master-pages-and-site-navigation-cs/_static/image20.png)

**Рис. 8**. добавление следующих файлов

## <a name="step-2-creating-a-site-map"></a>Шаг 2. Создание схемы узла

Одной из задач управления веб-сайтом, состоящей из более чем нескольких страниц, является простой способ перемещения посетителей по сайту. Для начала необходимо определить структуру навигации сайта. Затем эта структура должна быть преобразована в элементы пользовательского интерфейса, такие как меню или пути. Наконец, весь процесс должен поддерживаться и обновляться по мере добавления новых страниц на сайт и удаления существующих. До ASP.NET 2,0 разработчикам приходилось самостоятельно создавать структуру навигации сайта, поддерживать ее и переводить в элементы пользовательского интерфейса. Однако с помощью ASP.NET 2,0 разработчики могут использовать очень гибкую встроенную систему навигации по сайту.

Система навигации по сайтам ASP.NET 2,0 предоставляет разработчикам средства для определения карт веб-узлов и доступа к этим сведениям через программный API. ASP.NET поставляется с поставщиком карт узла, который должен хранить данные карт узла в XML-файле, отформатированном определенным образом. Но поскольку система навигации по сайту построена на основе [модели поставщика](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx) , ее можно расширить для поддержки альтернативных способов сериализации сведений о карте узла. В статье «Джефф Просайз» [поставщик схемы узла SQL, который вы ожидаете](https://msdn.microsoft.com/msdnmag/issues/06/02/WickedCode/default.aspx) , показывает, как создать поставщик карт узла, хранящий карту узла в базе данных SQL Server; другой вариант — создать [поставщик карт узла на основе структуры файловой системы](http://aspnet.4guysfromrolla.com/articles/020106-1.aspx).

Однако в этом руководстве мы будем использовать поставщик карт узла по умолчанию, который поставляется с ASP.NET 2,0. Чтобы создать карту узла, просто щелкните правой кнопкой мыши имя проекта в обозреватель решений, выберите команду Добавить новый элемент и выберите параметр Схема узла. Оставьте имя `Web.sitemap` и нажмите кнопку Добавить.

[![добавить карту сайта в проект](master-pages-and-site-navigation-cs/_static/image22.png)](master-pages-and-site-navigation-cs/_static/image21.png)

**Рис. 9**. Добавление в проект схемы узла ([щелкните, чтобы просмотреть изображение с полным размером](master-pages-and-site-navigation-cs/_static/image23.png))

Файл схемы узла является XML-файлом. Обратите внимание, что Visual Studio предоставляет IntelliSense для структуры карт узла. Файл схемы узла должен иметь узел `<siteMap>` в качестве корневого узла, который должен содержать ровно один дочерний элемент `<siteMapNode>`. Первый `<siteMapNode>` элемент может содержать произвольное число элементов `<siteMapNode>` потомков.

Определите карту узла, чтобы имитировать структуру файловой системы. То есть добавьте элемент `<siteMapNode>` для каждой из трех папок и дочерние элементы `<siteMapNode>` для каждой из ASP.NET страниц в этих папках следующим образом:

Web. Sitemap

[!code-xml[Main](master-pages-and-site-navigation-cs/samples/sample4.xml)]

На карте узла определяется структура навигации веб-сайта, которая представляет собой иерархию, описывающую различные разделы сайта. Каждый элемент `<siteMapNode>` в `Web.sitemap` представляет раздел структуры навигации сайта.

[![схема узла представляет иерархическую структуру навигации](master-pages-and-site-navigation-cs/_static/image25.png)](master-pages-and-site-navigation-cs/_static/image24.png)

**Рис. 10**. схема узла представляет иерархическую структуру навигации ([щелкните, чтобы просмотреть изображение с полным размером](master-pages-and-site-navigation-cs/_static/image26.png))

ASP.NET предоставляет структуру карты узла через [класс SiteMap](https://msdn.microsoft.com/library/system.web.sitemap.aspx).NET Framework. Этот класс имеет свойство `CurrentNode`, которое возвращает сведения о разделе, который в данный момент посещает пользователь; Свойство `RootNode` возвращает корневой элемент схемы узла (Домашняя страница в карте сайта). Свойства `CurrentNode` и `RootNode` возвращают экземпляры [SiteMapNode](https://msdn.microsoft.com/library/system.web.sitemapnode.aspx) , имеющие такие свойства, как `ParentNode`, `ChildNodes`, `NextSibling`, `PreviousSibling`и т. д., которые позволяют выполнять обход иерархии карт узла.

## <a name="step-3-displaying-a-menu-based-on-the-site-map"></a>Шаг 3. Отображение меню на основе схемы узла

Доступ к данным в ASP.NET 2,0 можно выполнить программным способом, например в ASP.NET 1. x, или декларативно, с помощью новых [элементов управления источниками данных](https://msdn.microsoft.com/library/ms227679.aspx). Существует несколько встроенных элементов управления источниками данных, таких как элемент управления SqlDataSource, для доступа к данным реляционной базы данных, элемента управления ObjectDataSource для доступа к данным из классов и других. Вы даже можете создавать собственные [пользовательские элементы управления источниками данных](https://msdn.microsoft.com/asp.net/reference/data/default.aspx?pull=/library/dnvs05/html/DataSourceCon1.asp).

Элементы управления источниками данных служат посредником между страницей ASP.NET и базовыми данными. Чтобы отобразить извлеченные данные элемента управления источника данных, мы обычно добавим на страницу еще один веб-элемент управления и привязали его к элементу управления источником данных. Чтобы привязать веб-элемент управления к элементу управления источником данных, просто задайте свойству `DataSourceID` веб-элемента управления значение свойства `ID` элемента управления источника данных.

Чтобы помочь в работе с данными схемы узла, ASP.NET включает элемент управления SiteMapDataSource, позволяющий нам привязать веб-элемент управления к карте веб-сайта. Два веб-элемента управления — TreeView и Menu обычно используются для предоставления пользовательского интерфейса навигации. Чтобы привязать данные схемы узла к одному из этих двух элементов управления, просто добавьте на страницу SiteMapDataSource, а также элемент управления TreeView или Menu, свойство `DataSourceID` которого задано соответствующим образом. Например, можно добавить элемент управления Menu на главную страницу с помощью следующей разметки:

[!code-aspx[Main](master-pages-and-site-navigation-cs/samples/sample5.aspx)]

Чтобы более точно контролировать создаваемый HTML-код, можно привязать элемент управления SiteMapDataSource к элементу управления Repeater следующим образом:

[!code-aspx[Main](master-pages-and-site-navigation-cs/samples/sample6.aspx)]

Элемент управления SiteMapDataSource возвращает иерархию карт сайта на один уровень за раз, начиная с корневого узла карт сайтов (Главная, на карте сайта), затем на следующем уровне (базовая отчетность, фильтрация отчетов и настраиваемое форматирование) и т. д. При привязке SiteMapDataSource к элементу Repeater он перечислит первый возвращенный уровень и создаст экземпляр `ItemTemplate` для каждого экземпляра `SiteMapNode` на первом уровне. Чтобы получить доступ к определенному свойству `SiteMapNode`, мы можем использовать `Eval(propertyName)`, то есть, как мы получаем свойства `Url` и `Title` для каждого `SiteMapNode`элемента управления HyperLink.

В приведенном выше примере Repeater будет отображаться следующая разметка:

[!code-html[Main](master-pages-and-site-navigation-cs/samples/sample7.html)]

Эти узлы карт узла (базовый отчет, фильтрация отчетов и настраиваемое форматирование) составляют *второй* уровень отображаемой схемы узла, а не первый. Это связано с тем, что свойство `ShowStartingNode` SiteMapDataSource имеет значение false, в результате чего SiteMapDataSource будет обходить корневой узел схемы сайта и начать с возврата второго уровня в иерархии карт узла.

Чтобы отобразить дочерние элементы для базовых отчетов, фильтрации отчетов и настраиваемого форматирования `SiteMapNode` s, можно добавить еще один элемент Repeater в `ItemTemplate`исходного элемента Repeater. Второй элемент Repeater будет привязан к свойству `ChildNodes` экземпляра `SiteMapNode`, вот так:

[!code-aspx[Main](master-pages-and-site-navigation-cs/samples/sample8.aspx)]

Эти два повтора приводят к следующему разметке (для краткости была удалена часть разметки):

[!code-html[Main](master-pages-and-site-navigation-cs/samples/sample9.html)]

С помощью стилей CSS, выбранных из книги [Рейчел Эндрю](http://www.rachelandrew.co.uk/) [Антология: 101. советы, приемы &amp; хакеров](https://www.amazon.com/gp/product/0957921888/qid=1137565739/sr=8-1/ref=pd_bbs_1/103-0562306-3386214?n=507846&amp;s=books&amp;v=glance), `<ul>` и `<li>` элементы имеют стиль, что разметка создает следующие визуальные выходные данные:

![Меню, состоящее из двух повторяющихся и некоторых CSS](master-pages-and-site-navigation-cs/_static/image27.png)

**Рис. 11**. меню, состоящее из двух повторяющихся и некоторых CSS

Это меню находится на главной странице и привязано к карте узла, определенной в `Web.sitemap`, что означает, что любые изменения в карте узла будут немедленно отражены на всех страницах, использующих главную страницу `Site.master`.

## <a name="disabling-viewstate"></a>Отключение ViewState

Все элементы управления ASP.NET могут сохранять свое состояние в [состоянии представления](https://msdn.microsoft.com/msdnmag/issues/03/02/CuttingEdge/), которое сериализуется как скрытое поле формы в отображаемом HTML-коде. Состояние представления используется элементами управления, чтобы запоминать их программно измененное состояние во всех обратных передачах, например данные, привязанные к веб-элементу управления данными. В то время как состояние представления позволяет сохранять информацию между обратными передачами, она увеличивает размер разметки, которая должна быть отправлена клиенту, и может привести к серьезному увеличению страничного состояния, если не будет тщательно отслеживаться. Веб-элементы управления данными, особенно применяющие GridView, особенно известны для добавления десятков дополнительных килобайтов разметки на страницу. Хотя такое увеличение может быть незначительным для пользователей широкополосной сети или интрасети, состояние просмотра может добавить несколько секунд в цикл обработки для удаленных пользователей.

Чтобы увидеть влияние состояния представления, откройте страницу в браузере и просмотрите исходный код, отправленный веб-страницей (в Internet Explorer перейдите в меню Вид и выберите параметр источник). Можно также включить [трассировку страниц](https://msdn.microsoft.com/library/sfbfw58f.aspx) , чтобы просмотреть выделение состояния представления, используемое каждым из элементов управления на странице. Сведения о состоянии представления сериализуются в скрытом поле формы с именем `__VIEWSTATE`, расположенном в элементе `<div>` сразу после открывающего тега `<form>`. Состояние представления сохраняется только при использовании веб-формы. Если страница ASP.NET не содержит `<form runat="server">` в декларативном синтаксисе, в отображаемой разметке не будет `__VIEWSTATE` скрытого поля формы.

Поле формы `__VIEWSTATE`, созданное главной страницей, добавляет примерно 1 800 байт к создаваемой разметке страницы. Это очень неувеличенное значение связано с элементом управления Repeater, так как содержимое элемента управления SiteMapDataSource сохраняется в состоянии представления. Хотя дополнительные 1 800 байта могут не показаться очень удобным, при использовании элемента управления GridView с множеством полей и записей состояние представления может легко разрастаются с множителем 10 или более.

Состояние представления может быть отключено на уровне страницы или элемента управления путем присвоения свойству `EnableViewState` значения `false`, тем самым уменьшая размер отображаемой разметки. Поскольку состояние представления для веб-элемента управления данными сохраняет данные, привязанные к веб-элементу управления данными во время обратной передачи, при отключении состояния представления для веб-элемента управления данными необходимо привязать данные к каждой обратной передаче. В ASP.NET версии 1. x эта ответственность лежит на плечие разработчика страницы; Однако при использовании ASP.NET 2,0 веб-элементы управления данными при необходимости будут повторно привязаны к своему элементу управления источниками данных при каждой обратной передаче.

Чтобы уменьшить состояние представления страницы, задайте для свойства `EnableViewState` элемента управления Repeater значение `false`. Это можно сделать с помощью окно свойств в конструкторе или декларативно в представлении исходного кода. После внесения этого изменения декларативная разметка Repeater должна выглядеть следующим образом:

[!code-aspx[Main](master-pages-and-site-navigation-cs/samples/sample10.aspx)]

После этого изменения размер состояния представления, отображаемого для просмотра страницы, сокращается до 52 байт, а 97% — на размер состояния представления. В учебниках по всей этой серии мы отключим состояние представления веб-элементов управления данными по умолчанию, чтобы уменьшить размер отображаемой разметки. В большинстве примеров свойству `EnableViewState` будет присвоено значение `false` и сделать это без упоминания. В сценариях, где для веб-элемента управления данными необходимо включить требуемые функциональные возможности, будет рассмотрено единственное состояние представления времени.

## <a name="step-4-adding-breadcrumb-navigation"></a>Шаг 4. Добавление навигации по навигатору

Чтобы завершить главную страницу, добавим в каждую страницу навигаторный элемент пользовательского интерфейса навигации. Навигатор быстро показывает пользователей с текущей позицией в иерархии сайта. Добавление элемента управления "Навигатор" в ASP.NET 2,0 позволяет просто добавить на страницу управляющий элемент SiteMapPath. код не требуется.

Для нашего сайта добавьте этот элемент управления в заголовок `<div>`:

[!code-aspx[Main](master-pages-and-site-navigation-cs/samples/sample11.aspx)]

Навигатор показывает текущую страницу, которую пользователь посещает в иерархии карт узла, а также родительский элемент узла схемы узла, который соответствует корневому элементу (Домашняя страница в карте узла).

![Навигатор отображает текущую страницу и ее предков в иерархии карт узла.](master-pages-and-site-navigation-cs/_static/image28.png)

**Рис. 12**. Навигатор отображает текущую страницу и ее предков в иерархии карт сайта

## <a name="step-5-adding-the-default-page-for-each-section"></a>Шаг 5. Добавление страницы по умолчанию для каждого раздела

Руководства на нашем сайте разбиваются на различные категории: основные отчеты, фильтрация, пользовательское форматирование и т. д. с папкой для каждой категории и соответствующими руководствами в качестве ASP.NET страниц в этой папке. Кроме того, в каждой папке содержится страница `Default.aspx`. Для этой страницы по умолчанию давайте выберем все руководства для текущего раздела. Это значит, что для `Default.aspx` в папке `BasicReporting` имеются ссылки на `SimpleDisplay.aspx`, `DeclarativeParams.aspx`и `ProgrammaticParams.aspx`. Здесь, опять же, мы можем использовать класс `SiteMap` и веб-элемент управления данными для отображения этих сведений на основе схемы узла, определенной в `Web.sitemap`.

Давайте снова выберем неупорядоченный список с помощью повторителя, но на этот раз мы будем отображать название и описание руководств. Поскольку разметка и код для выполнения этой задачи потребуется повторить для каждой `Default.aspx` страницы, мы можем инкапсулировать эту логику пользовательского интерфейса в [Пользовательский элемент управления](https://msdn.microsoft.com/library/y6wb1a0e.aspx). Создайте на веб-сайте папку с именем `UserControls` и добавьте в нее новый элемент типа пользовательский веб-элемент управления с именем `SectionLevelTutorialListing.ascx`и добавьте следующую разметку:

[![добавить новый пользовательский веб-элемент управления в папку UserControls](master-pages-and-site-navigation-cs/_static/image30.png)](master-pages-and-site-navigation-cs/_static/image29.png)

**Рис. 13**. Добавление нового пользовательского веб-элемента управления в папку `UserControls` ([щелкните, чтобы просмотреть изображение с полным размером](master-pages-and-site-navigation-cs/_static/image31.png))

SectionLevelTutorialListing. ascx

[!code-aspx[Main](master-pages-and-site-navigation-cs/samples/sample12.aspx)]

SectionLevelTutorialListing.ascx.cs

[!code-csharp[Main](master-pages-and-site-navigation-cs/samples/sample13.cs)]

В предыдущем примере с Repeater мы декларативно привязываете `SiteMap`ные данные к элементу Repeater. Однако `SectionLevelTutorialListing` пользовательский элемент управления выполняется программным способом. В обработчике событий `Page_Load` выполняется проверка того, что URL-адрес этой страницы сопоставляется с узлом на карте сайта. Если этот пользовательский элемент управления используется на странице, не имеющей соответствующей записи `<siteMapNode>`, `SiteMap.CurrentNode` вернет `null`, а данные не будут привязаны к элементу Repeater. При условии, что у нас есть `CurrentNode`, можно привязать `ChildNodes`ную коллекцию к элементу Repeater. Так как наша схема узла настроена таким образом, что страница `Default.aspx` в каждом разделе является родительским узлом всех руководств в этом разделе, в этом коде будут отображаться ссылки на все руководства раздела, как показано на снимке экрана ниже.

После создания этого элемента управления Repeater откройте `Default.aspx` страницы в каждой из папок, перейдите к представление конструирования и просто перетащите пользовательский элемент контроля из обозреватель решений в область конструктора, где должен отображаться список учебников.

[![пользовательский элемент управления добавлен в Default. aspx](master-pages-and-site-navigation-cs/_static/image33.png)](master-pages-and-site-navigation-cs/_static/image32.png)

**Рис. 14**. пользовательский элемент управления добавлен в `Default.aspx` ([щелкните, чтобы просмотреть изображение с полным размером](master-pages-and-site-navigation-cs/_static/image34.png))

[![перечислены основные руководства по отчетам](master-pages-and-site-navigation-cs/_static/image36.png)](master-pages-and-site-navigation-cs/_static/image35.png)

**Рис. 15**. список основных руководств по отчетам ([щелкните, чтобы просмотреть изображение с полным размером](master-pages-and-site-navigation-cs/_static/image37.png))

## <a name="summary"></a>Сводка

После определения схемы узла и завершения главной страницы теперь есть единообразный макет страницы и схема навигации для наших руководств, связанных с данными. Независимо от того, сколько страниц мы добавляем на наш сайт, обновление макета страницы для всего сайта или сведений о переходе к веб-узлу является быстрым и простым процессом из-за централизованной информации. В частности, сведения о макете страницы определяются на главной странице `Site.master` и карте узла в `Web.sitemap`. Нам не пришлось писать *код* для реализации макета страницы и механизма навигации на уровне сайта, и мы сохранили полную поддержку WYSIWYG Designer в Visual Studio.

Выполняя уровень доступа к данным и уровень бизнес-логики и определив единообразный макет страницы и структуру навигации по сайту, мы готовы приступить к изучению общих шаблонов отчетов. В [следующих](../basic-reporting/displaying-data-with-the-objectdatasource-cs.md) трех учебниках мы рассмотрим основные задачи создания отчетов, отображающие данные, полученные из BLL, в элементах управления GridView, DetailsView и FormView.

Поздравляем с программированием!

## <a name="further-reading"></a>Дополнительные сведения

Дополнительные сведения о разделах, обсуждаемых в этом руководстве, см. в следующих ресурсах:

- [Общие сведения о главных страницах ASP.NET](https://msdn.microsoft.com/library/wtxbf3hh.aspx)
- [Главные страницы в ASP.NET 2,0](http://odetocode.com/Articles/419.aspx)
- [Шаблоны проектирования ASP.NET 2,0](https://msdn.microsoft.com/asp.net/reference/design/templates/default.aspx)
- [Обзор навигации по сайту ASP.NET](https://msdn.microsoft.com/library/e468hxky.aspx)
- [Изучение навигации по веб-узлу ASP.NET 2.0](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx)
- [Функции навигации по сайтам ASP.NET 2,0](https://weblogs.asp.net/scottgu/archive/2005/11/20/431019.aspx)
- [Основные сведения о состоянии представления ASP.NET](https://msdn.microsoft.com/library/default.asp?url=/library/dnaspp/html/viewstate.asp)
- [Как включить трассировку для страницы ASP.NET](https://msdn.microsoft.com/library/94c55d08%28VS.80%29.aspx)
- [ASP.NET пользовательские элементы управления](https://msdn.microsoft.com/library/y6wb1a0e.aspx)

## <a name="about-the-author"></a>Об авторе

[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи книг по ASP/ASP. NET и основатель [4GuysFromRolla.com](http://www.4guysfromrolla.com), работал с веб-технологиями Майкрософт с 1998. Скотт работает как независимый консультант, преподаватель и модуль записи. Его последняя книга — [*Sams обучать себя ASP.NET 2,0 за 24 часа*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco). Он доступен по адресу [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) или через его блог, который можно найти по адресу [http://ScottOnWriting.NET](http://ScottOnWriting.NET).

## <a name="special-thanks-to"></a>Специальная благодарность

Эта серия руководств была рассмотрена многими полезными рецензентами. Потенциальные рецензенты для этого руководства: основными рецензентами, Деннис Patterson и Хилтон Гизнау. Хотите ознакомиться с моими будущими статьями MSDN? Если это так, расположите строку в [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)

> [!div class="step-by-step"]
> [Назад](creating-a-business-logic-layer-cs.md)
> [Вперед](creating-a-data-access-layer-vb.md)
