---
uid: web-forms/overview/data-access/introduction/master-pages-and-site-navigation-cs
title: Главные страницы и структуру переходов узла (C#) | Документация Майкрософт
author: rick-anderson
description: Отличительной особенностью эргономичного веб является наличие согласованный, сайта страницы макета и схему переходов. Этот учебник рассказывает, как y...
ms.author: riande
ms.date: 03/31/2010
ms.assetid: 5aee8202-a4e3-4aa9-8a95-cd5d156cea4c
msc.legacyurl: /web-forms/overview/data-access/introduction/master-pages-and-site-navigation-cs
msc.type: authoredcontent
ms.openlocfilehash: 13bf64919e8068f44b20120400f62eecbd3cace9
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2019
ms.locfileid: "65134678"
---
# <a name="master-pages-and-site-navigation-c"></a>Эталонные страницы и структура навигации веб-сайта (C#)

по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Скачайте пример приложения](http://download.microsoft.com/download/4/6/3/463cf87c-4724-4cbc-b7b5-3f866f43ba50/ASPNET_Data_Tutorial_3_CS.exe) или [скачать PDF](master-pages-and-site-navigation-cs/_static/datatutorial03cs1.pdf)

> Отличительной особенностью эргономичного веб является наличие согласованный, сайта страницы макета и схему переходов. Этом руководстве рассматривается создание согласованного внешнего вида и поведения на всех страницах, которые легко могут быть обновлены.

## <a name="introduction"></a>Вступление

Отличительной особенностью эргономичного веб является наличие согласованный, сайта страницы макета и схему переходов. ASP.NET 2.0 появились две новые функции, которые сильно упрощают реализацию обеих страницы для всего макета и схему переходов: главные страницы и навигация по сайту. Главные страницы позволяют разработчикам создавать шаблон сайта области, подлежащие изменению. Затем этот шаблон применим к страниц веб-узла ASP.NET. Такие страницы ASP.NET должна предоставить только содержимое, изменяемые области, указанной с главной страницы все остальные элементы главной страницы будут одинаковыми для всех страниц ASP.NET, испольузющими эту главную станицу. Эта модель позволяет разработчикам определять и централизовать макета страницы сайта, тем самым облегчая создание согласованного внешнего вида и поведения на всех страницах, которые легко могут быть обновлены.

[Система навигации сайта](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx) предоставляет механизм для разработчиков страниц определить карту узла и API для этой карты узла должны запрашиваться программным способом. Новые элементы управления Web навигации, Menu, TreeView и SiteMapPath облегчают визуализации всей или части карты узла в распространенных навигации элемент пользовательского интерфейса. Мы будем использовать значение по умолчанию поставщик переходов по узлу, это означает, что карта узла будет определяться в файле формата XML.

Для иллюстрации этих основных понятий и сделать наш учебный веб-узел более удобным, давайте на этом уроке, определения макета страницы для всего, карту узла и добавления пользовательского интерфейса навигации. В конце этого руководства мы у нас будет великолепные веб-сайт для создания части учебника веб-страниц.

[![В результате этого учебника](master-pages-and-site-navigation-cs/_static/image2.png)](master-pages-and-site-navigation-cs/_static/image1.png)

**Рис. 1**: Конечный результат из этого руководства ([Просмотр полноразмерного изображения](master-pages-and-site-navigation-cs/_static/image3.png))

## <a name="step-1-creating-the-master-page"></a>Шаг 1. Создание главной страницы

Первым шагом является создание главной страницы для сайта. Сейчас наш веб-сайт содержит только типизированный набор DataSet (`Northwind.xsd`в `App_Code` папку), классов BLL (`ProductsBLL.cs`, `CategoriesBLL.cs`, и т. д., на `App_Code` папку), базы данных (`NORTHWND.MDF`в `App_Data` папка), файл конфигурации (`Web.config`) и таблицы стилей CSS-файла (`Styles.css`). Мы удалили файлы, демонстрирующие использование DAL и BLL из первых двух учебниках, так как мы будет которыми более подробно в последующих учебных курсах.

![Файлы проекта](master-pages-and-site-navigation-cs/_static/image4.png)

**Рис. 2**: Файлы проекта

Чтобы создать главную страницу, щелкните правой кнопкой мыши имя проекта в обозревателе решений и выберите Add New Item. Затем выберите тип главной страницы в списке шаблонов и назовите его `Site.master`.

[![Добавление новой главной страницы на веб-сайт](master-pages-and-site-navigation-cs/_static/image6.png)](master-pages-and-site-navigation-cs/_static/image5.png)

**Рис. 3**: Добавление новой главной страницы на веб-сайт ([Просмотр полноразмерного изображения](master-pages-and-site-navigation-cs/_static/image7.png))

Определение макета страницы для всего здесь на главной странице. Можно использовать представление проектирования и добавьте любые макета или веб-элементы управления, или можно вручную добавить разметку вручную в представлении источника. На главной странице я использую [каскадных таблиц стилей](http://www.w3schools.com/css/default.asp) для определения положения и стили CSS параметры, определенные во внешнем файле `Style.css`. Хотя из приведенной ниже разметки этого невозможно определить, правила CSS определены таким образом, чтобы навигации `<div>`элемента (абсолютное) положение, что отображается слева и имеет фиксированную ширину 200 пикселей.

Site.master

[!code-aspx[Main](master-pages-and-site-navigation-cs/samples/sample1.aspx)]

На главной странице определяются как статические, так и регионов, которые могут изменяться страницами ASP.NET, испольузющими эту главную станицу. Изменяемые области обозначаются элементом управления ContentPlaceHolder, который можно увидеть в содержимом `<div>`. Нас на главной странице имеет единый ContentPlaceHolder (`MainContent`), но главной страницы может быть и несколько.

С помощью введете указанную выше разметку переключение в режим конструктора показан макет главной страницы. Любая страница ASP.NET, использующая эту главную страницу будет иметь этот единообразного расположения, с возможностью указать разметку для `MainContent` регион.

[![Главной страницы, при просмотре в режиме конструктора](master-pages-and-site-navigation-cs/_static/image9.png)](master-pages-and-site-navigation-cs/_static/image8.png)

**Рис. 4**: Главной страницы, при просмотре через конструктор ([Просмотр полноразмерного изображения](master-pages-and-site-navigation-cs/_static/image10.png))

## <a name="step-2-adding-a-homepage-to-the-website"></a>Шаг 2. Добавление домашнюю страницу на веб-сайт

С главную страницу мы готовы к созданию страниц ASP.NET, веб-сайта. Начнем с добавления `Default.aspx`, домашняя страница наш веб-сайт. Щелкните правой кнопкой мыши имя проекта в обозревателе решений и выберите Add New Item. Выберите вариант веб-формы, в списке шаблон и имя файла `Default.aspx`. Кроме того установите флажок «Выбрать главную страницу».

[![Добавление новой веб-формы, проверка выбрать главную страницу флажок](master-pages-and-site-navigation-cs/_static/image12.png)](master-pages-and-site-navigation-cs/_static/image11.png)

**Рис. 5**: Добавление новой веб-формы, проверка выбрать главную страницу флажок ([Просмотр полноразмерного изображения](master-pages-and-site-navigation-cs/_static/image13.png))

После нажатия кнопки "ОК", вам будет предложено выбрать главную страницу для создаваемой страницы ASP.NET следует использовать. Хотя в проекте может быть несколько главных страниц, у нас есть только один.

[![Выбор главной страницы для страницы ASP.NET](master-pages-and-site-navigation-cs/_static/image15.png)](master-pages-and-site-navigation-cs/_static/image14.png)

**Рис. 6**: Выбор главной страницы для этого использования следует страницы ASP.NET ([Просмотр полноразмерного изображения](master-pages-and-site-navigation-cs/_static/image16.png))

Когда вы выберете главную страницу, на странице ASP.NET будет содержать следующую разметку:

Default.aspx

[!code-aspx[Main](master-pages-and-site-navigation-cs/samples/sample2.aspx)]

В `@Page` директива является ссылкой на файл используемой главной страницы (`MasterPageFile="~/Site.master"`), и разметка страницы ASP.NET содержит элемент управления содержимым для каждого из элементов управления ContentPlaceHolder, определенных на главной странице, с помощью элемента управления `ContentPlaceHolderID` Сопоставляет элемент Content конкретному элементу ContentPlaceHolder. Элемент управления содержимым — это расположение разметка будет отображаться соответствующего элемента ContentPlaceHolder. Задайте `@Page` директивы `Title` Домашняя страница и добавьте в элемент управления содержимым Приветствуем содержимое:

Default.aspx

[!code-aspx[Main](master-pages-and-site-navigation-cs/samples/sample3.aspx)]

`Title` Атрибут в `@Page` директива позволяет задать заголовок страницы из страницы ASP.NET, даже если `<title>` элемент определен в главной страницы. Мы также заголовок можно установить программно, с помощью `Page.Title`. Также Обратите внимание, что на главной странице ссылки на таблицы стилей (такие как `Style.css`) автоматически обновляются, чтобы они работали на любой странице ASP.NET независимо от положения относительно главной страницы ASP.NET выполняется.

Переключение в режим конструктора, то увидите, как созданная страница будет выглядеть в браузере. Обратите внимание, что в конструкторе просмотра страницы ASP.NET, что только изменяемые области редактируются стоящая вне элемента ContentPlaceHolder разметки, определенные на главной странице неактивна.

[![Изменяемые и неизменяемые области показан режим конструктора для страницы ASP.NET](master-pages-and-site-navigation-cs/_static/image18.png)](master-pages-and-site-navigation-cs/_static/image17.png)

**Рис. 7**: Режим конструктора для ASP.NET страницы показано, как редактируемое и Non-Editable регионов ([Просмотр полноразмерного изображения](master-pages-and-site-navigation-cs/_static/image19.png))

Когда `Default.aspx` посещенные страницы в браузере, механизм ASP.NET автоматически объединяет содержимое главной страницы на страницы и ASP. NET содержимое и преобразует результат объединения в окончательный код HTML, который и отправляется браузеру. При обновлении содержимого главной страницы всех страниц ASP.NET с использованием этой главной страницы будет выполнено содержимое главной страницы Обновить в следующий раз они запрашиваются. Короче говоря, такая модель позволяет одной страницы (главную страницу) определен шаблон макета, чтобы быть которого изменения немедленно отражаются на всем сайте.

## <a name="adding-additional-aspnet-pages-to-the-website"></a>Добавление других страниц ASP.NET на веб-сайт

Давайте немного, чтобы добавить дополнительные заглушки страницы ASP.NET на сайт, со временем будут размещаться демонстрационные материалы. У нас будет 35 примеров в целом, поэтому вместо того чтобы создавать все страницы, давайте просто, чем создание несколькими. Поскольку также будет множество категорий демонстрационных программ, для лучшего управления демонстрации добавить папку для категорий. Добавьте следующие три папки сейчас:

- `BasicReporting`
- `Filtering`
- `CustomFormatting`

Наконец добавьте новые файлы, как показано в обозревателе решений на рис. 8. При добавлении каждого файла, не забудьте установите флажок «Выбрать главную страницу».

![Добавьте следующие файлы](master-pages-and-site-navigation-cs/_static/image20.png)

**Рис. 8**: Добавьте следующие файлы

## <a name="step-2-creating-a-site-map"></a>Шаг 2. Создание карты узла

Одной из проблем при управлении веб-сайта, большее, чем просто горсть страниц является предоставление простым способом для посетителей понятную схему перемещения по узлу. Начнем с того необходимо определить структуру переходов узла. Затем эта структура должны быть переведены в рабочих элементах интерфейса, такие как меню или деревьях. Наконец весь процесс должен поддерживать и обновлять по мере добавления новых страниц к сайту и удаления старых. До ASP.NET 2.0 разработчикам приходилось самим создавать структуру переходов, поддерживать ее и преобразует их в рабочих элементах интерфейса. С помощью ASP.NET 2.0 тем не менее, разработчики могут использовать весьма гибкую встроенные переходов по узлу.

Системой перемещения ASP.NET 2.0 позволяет разработчику определить карту узла и работать с полученной информацией через программный интерфейс API. ASP.NET поставляется с поставщиком карты узла, который ожидает данных карты узла для сохранения в XML-файл в формате определенным образом. Но, поскольку структура переходов строится на [модель поставщика](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx) ее можно расширить для поддержки альтернативные способы для сериализации информации карты узла. Статье Джефа Просайза [SQL сайта карты поставщика вы кто уже были ожидания для](https://msdn.microsoft.com/msdnmag/issues/06/02/WickedCode/default.aspx) показано, как создать поставщик карты узла, хранящего карту в базе данных SQL Server; другой вариант — Создать [на основе поставщика карты узла Структура файловой системы](http://aspnet.4guysfromrolla.com/articles/020106-1.aspx).

Для этого руководства, тем не менее, мы будем использовать поставщик карты узла по умолчанию, который поставляется с ASP.NET 2.0. Чтобы создать карту узла, просто щелкните правой кнопкой мыши имя проекта в обозревателе решений, выберите Add New Item и выберите «карта узла». Оставьте имя по `Web.sitemap` и нажмите кнопку "Добавить".

[![Добавление карты узла в проект](master-pages-and-site-navigation-cs/_static/image22.png)](master-pages-and-site-navigation-cs/_static/image21.png)

**Рис. 9**: Добавление карты узла в проект ([Просмотр полноразмерного изображения](master-pages-and-site-navigation-cs/_static/image23.png))

Файл карты узла — это XML-файл. Обратите внимание на то, что Visual Studio предоставляет IntelliSense для структуры карты. Файл карты узла должен иметь `<siteMap>` узел в качестве корневого узла, который должен быть ровно один `<siteMapNode>` дочерний элемент. Первый элемент `<siteMapNode>` элемент может содержать неограниченное число вложенных `<siteMapNode>` элементов.

Определите карты узла следует опираться на структуру файловой системы. То есть добавьте `<siteMapNode>` элемент для каждого из трех папок и дочерних `<siteMapNode>` элементы для каждой из страниц ASP.NET в этих папках следующим образом:

Web.sitemap

[!code-xml[Main](master-pages-and-site-navigation-cs/samples/sample4.xml)]

Карта узла определяет структуру переходов веб сайта, — это иерархия, который описывает различные разделы веб-узла. Каждый `<siteMapNode>` элемент `Web.sitemap` соответствует некоторому разделу структуры переходов веб-узла.

[![Карта узла — иерархическая структура переходов](master-pages-and-site-navigation-cs/_static/image25.png)](master-pages-and-site-navigation-cs/_static/image24.png)

**Рис. 10**: Карта узла — иерархическая структура переходов ([Просмотр полноразмерного изображения](master-pages-and-site-navigation-cs/_static/image26.png))

ASP.NET предоставляет структуре карты узла через .NET Framework [класс SiteMap](https://msdn.microsoft.com/library/system.web.sitemap.aspx). Этот класс имеет `CurrentNode` свойство, которое возвращает сведения о разделе, пользователь в настоящее время использует; `RootNode` возвращает корневой элемент карты узла (Домашняя страница, в нашем примере). Как `CurrentNode` и `RootNode` возвращают свойства [SiteMapNode](https://msdn.microsoft.com/library/system.web.sitemapnode.aspx) экземпляров, которые имеют свойства как `ParentNode`, `ChildNodes`, `NextSibling`, `PreviousSibling`и так далее, обеспечивающие карты узла иерархия, который необходимо рассмотреть.

## <a name="step-3-displaying-a-menu-based-on-the-site-map"></a>Шаг 3. Отображение меню на основе карты сайта

Доступ к данным в ASP.NET 2.0 может быть осуществляться программными способами, как в ASP.NET 1.x, или декларативно, используя новый [элементами управления источниками данных](https://msdn.microsoft.com/library/ms227679.aspx). Существует несколько встроенных данных таких элементов управления: SqlDataSource для доступа к реляционным базам данных, элемент управления ObjectDataSource, для доступа к данным из классов и другие. Можно даже создать собственные [элементами управления источниками данных, пользовательских](https://msdn.microsoft.com/asp.net/reference/data/default.aspx?pull=/library/dnvs05/html/DataSourceCon1.asp).

Элементы управления источником данных выступают в роли посредника между страницей ASP.NET и базовых данных. Чтобы отобразить полученные данные элементу управления источником данных, мы обычно добавить другой веб-элемента управления на страницу и привязать его к элементу управления источника данных. Чтобы привязать веб-элемент управления к элементу управления источником данных, просто установите веб-элемента управления `DataSourceID` значение элемента управления источника данных `ID` свойство.

Для облегчения работы с данными карты узла, ASP.NET предлагает элемент управления SiteMapDataSource, которые позволяет привязать веб-элемент управления от карты узла наш веб-сайт. Для обеспечения навигации пользовательского интерфейса обычно используются два веб-элементы управления TreeView и Menu. Чтобы привязать данные карты узла к одному из этих двух элементов управления, просто добавьте SiteMapDataSource к странице и элемент TreeView или элемент управления меню `DataSourceID` свойству соответствующим образом. Например мы добавим элемент управления Menu на главную страницу, используя следующую разметку:

[!code-aspx[Main](master-pages-and-site-navigation-cs/samples/sample5.aspx)]

Для большей степени контроля над полученным кодом HTML, мы привязать элемент управления SiteMapDataSource к элементу управления Repeater, следующим образом:

[!code-aspx[Main](master-pages-and-site-navigation-cs/samples/sample6.aspx)]

Элемент управления SiteMapDataSource Возвращает уровень иерархии одной карты сайта одновременно, начиная с корневого узла (Домашняя страница, в нашем примере), затем уровня (Basic Reporting, Filtering Reports и Customized Formatting) и т. д. Если привязать SiteMapDataSource к элементу Repeater, он перечисляет первый уровень возвращаются и создает экземпляр `ItemTemplate` для каждого `SiteMapNode` экземпляр на первом уровне. Для доступа к конкретному свойству элемента `SiteMapNode`, мы можем использовать `Eval(propertyName)`, который является, получить, к примеру `SiteMapNode`в `Url` и `Title` свойства для элемента управления HyperLink.

Приведенный выше пример элемента управления Repeater будет следующую разметку:

[!code-html[Main](master-pages-and-site-navigation-cs/samples/sample7.html)]

Этих узлов карты (Basic Reporting, Filtering Reports и Customized Formatting) составляют *второй* карты узла, от первого уровня. Это обусловлено SiteMapDataSource `ShowStartingNode` свойство имеет значение False, поэтому элемент SiteMapDataSource для обхода корневой узел карты и начинает на втором уровне в структуре карты узла.

Чтобы отобразить дочерние элементы для Basic Reporting, Filtering Reports и Customized Formatting `SiteMapNode` s, мы можем добавить еще один элемент Repeater внутрь элемента `ItemTemplate`. Второй Repeater будет привязан к `SiteMapNode` экземпляра `ChildNodes` свойство, следующим образом:

[!code-aspx[Main](master-pages-and-site-navigation-cs/samples/sample8.aspx)]

Этих двух элементов Repeater привести следующую разметку (некоторые разметки удалены для краткости):

[!code-html[Main](master-pages-and-site-navigation-cs/samples/sample9.html)]

Помощи стилей CSS, выбранный из [Рейчел Эндрю](http://www.rachelandrew.co.uk/)забронировать [Anthology CSS: 101 важные советы, приемы, &amp; Hacks](https://www.amazon.com/gp/product/0957921888/qid=1137565739/sr=8-1/ref=pd_bbs_1/103-0562306-3386214?n=507846&amp;s=books&amp;v=glance), `<ul>` и `<li>` оформляются таким образом, создания разметки мы получаем следующие visual выходные данные:

![Меню, состоящий из двух элементов Repeater и некоторого количества CSS](master-pages-and-site-navigation-cs/_static/image27.png)

**Рис. 11**: Меню, состоящий из двух элементов Repeater и некоторого количества CSS

Это меню является на главной странице и привязаны к карте узла, определенной в `Web.sitemap`, что означает, что любое изменение карты узла немедленно отразится на всех страниц, использующих `Site.master` главной страницы.

## <a name="disabling-viewstate"></a>Отключение элемента ViewState

Все элементы управления ASP.NET при необходимости можно сохраняют свое состояние в [состояния представления](https://msdn.microsoft.com/msdnmag/issues/03/02/CuttingEdge/), который сериализуется в качестве скрытого поля формы в формате HTML. Состояние представления используется элементами управления запомнить их программным способом изменения состояния во время обратной передачи, такие как данные, привязанные к веб-элемент данных. Хотя состояние представления позволяет сведения, чтобы запоминать, увеличивает размер кода, должны быть отправлены клиенту и может привести к раздуванию страницы при отсутствии должного контроля. Данные веб-элементов управления в первую очередь GridView имеют дурную особенность добавлять десятки килобайтов к разметке на страницу. Хотя такое увеличение может быть незначительно пользователи широкополосных каналов или интрасети, состояние представления можно добавить несколько секунд обмен данными для удаленных пользователей.

Чтобы увидеть влияние состояния представления, посетите страницу в браузере и просмотрите исходный код веб-страницы (в Internet Explorer, перейдите к меню "Вид" и выберите параметр источника). Также можно включить [трассировку](https://msdn.microsoft.com/library/sfbfw58f.aspx) для см. в разделе выделение состояний представления, используемых каждым из элементов управления на странице. Сведения о состоянии представления сериализуется в скрытом поле с именем `__VIEWSTATE`, который находится в `<div>` сразу же после открывающего элемента `<form>` тега. Состояние представления сохраняется только в том случае, если имеется веб-форма; Если к странице ASP.NET включает в себя `<form runat="server">` его декларативный синтаксис, не будет `__VIEWSTATE` скрытого поля формы в созданной разметке.

`__VIEWSTATE` , Созданное главной страницей добавляет созданной разметки страницы примерно на 1800 байт. Это объясняется в основном элементе управления Repeater, как содержимое элемента управления SiteMapDataSource, сохраняются в состоянии представления. Может показаться, 1800 байт не так уж переживать о, при использовании элемента управления GridView с множество полей и записи, состояние представления может запросто увеличиваться с коэффициентом 10 или более.

Состояние представления можно отключить на уровне страницы или элемента управления, задав `EnableViewState` свойства `false`, тем самым уменьшая размер создаваемого кода HTML. Поскольку в состоянии представления для данных Web, сохранение данных, привязанных к данным веб-элемента управления во время обратной передачи элемента управления при отключении состояния представления для данных элемента управления веб-данных должен быть привязан при каждой обратной передаче. В ASP.NET версии 1.x эта обязанность ложилась на плечи разработчика. с помощью ASP.NET 2.0 Однако управления data Web controls повторная привязка для элемента управления источника данных при каждой обратной передаче при необходимости.

Чтобы уменьшить состояние представления страницы, давайте значение элемента управления Repeater `EnableViewState` свойства `false`. Это можно сделать в окне свойств в конструкторе, или декларативно в представлении источника. После внесения этого изменения элемента Repeater должна выглядеть как:

[!code-aspx[Main](master-pages-and-site-navigation-cs/samples/sample10.aspx)]

После этого изменения страницы подготовки к просмотру для уменьшает уменьшился размер состояния представления размер в представлении состояния 52 байтов, то это экономия 97%! Во всех примерах в этой серии руководств будет отключено состояние представления данных веб-элементов управления по умолчанию для сокращения объема создаваемой разметки. В большинстве примеров `EnableViewState` свойству будет присвоено `false` и сделано без всякого предупреждения. Единственный случай, когда является просмотр состояния будет рассказано в сценариях, где его необходимо включить в данные веб-элемента управления для правильной работы.

## <a name="step-4-adding-breadcrumb-navigation"></a>Шаг 4. Создание иерархической схемы перемещения

Для завершения главной страницы, давайте добавим элемент иерархической навигации пользовательского интерфейса для каждой страницы. Навигатор быстро показывает пользователей их текущую позицию в иерархии сайтов. Добавление навигатора в ASP.NET 2.0 легко, просто добавьте элемент управления SiteMapPath на страницу; код не требуется.

Мы добавим этот элемент управления заголовка `<div>`:

[!code-aspx[Main](master-pages-and-site-navigation-cs/samples/sample11.aspx)]

Навигатор показывает текущую страницу, пользователь использует в иерархии карты узла, а также узла карты узла «предков,» вплоть до корневого (Домашняя страница, в нашем примере).

![Эта панель перехода выводит текущую страницу и его предков узла сопоставления иерархии](master-pages-and-site-navigation-cs/_static/image28.png)

**Рис. 12**: Эта панель перехода выводит текущую страницу и его предков узла сопоставления иерархии

## <a name="step-5-adding-the-default-page-for-each-section"></a>Шаг 5. Добавление страницы по умолчанию для каждого раздела

Учебники на нашем сайте разбиваются на различные категории Базовые отчеты, фильтрация, настраиваемое форматирование, и т. д с папкой для каждой категории и руководства страница ASP.NET в этой папке. Кроме того, каждая папка содержит `Default.aspx` страницы. Для этой страницы по умолчанию давайте отобразим всех руководств, имеющихся в данном разделе. То есть для `Default.aspx` в `BasicReporting` папку бы нам ссылки на `SimpleDisplay.aspx`, `DeclarativeParams.aspx`, и `ProgrammaticParams.aspx`. Здесь, опять же, можно использовать `SiteMap` класс и данных веб-элемента управления для отображения этих сведений, в зависимости от карты узла, определенный на `Web.sitemap`.

Давайте отобразим неупорядоченный список с помощью элемента управления Repeater еще раз, но на этот раз мы будем отображать заголовок и описание руководства. Так как разметка и код для выполнения этого будет необходимо будет повторить для каждого `Default.aspx` страницы, мы может инкапсулировать эту логику пользовательского интерфейса в [пользовательский элемент управления](https://msdn.microsoft.com/library/y6wb1a0e.aspx). Создание папки в веб-узле `UserControls` и добавьте в новый элемент типа веб-элемента управления пользователя с именем `SectionLevelTutorialListing.ascx`и добавьте следующую разметку:

[![Добавить новый пользовательский элемент управления Web папки UserControls](master-pages-and-site-navigation-cs/_static/image30.png)](master-pages-and-site-navigation-cs/_static/image29.png)

**Рис. 13**: Добавить нового пользователя веб-элемента управления к `UserControls` папку ([Просмотр полноразмерного изображения](master-pages-and-site-navigation-cs/_static/image31.png))

SectionLevelTutorialListing.ascx

[!code-aspx[Main](master-pages-and-site-navigation-cs/samples/sample12.aspx)]

SectionLevelTutorialListing.ascx.cs

[!code-csharp[Main](master-pages-and-site-navigation-cs/samples/sample13.cs)]

В предыдущем примере элемент управления Repeater мы привязаны `SiteMap` данных к элементу управления Repeater декларативно; `SectionLevelTutorialListing` пользовательский элемент управления, но делает это программным способом. В `Page_Load` обработчик событий, проверяется, чтобы убедиться, что эта страница s, сопоставляет URL-адрес узла карты сайта. Если данный пользовательский элемент управления используется на странице, не имеет соответствующего `<siteMapNode>` запись `SiteMap.CurrentNode` вернет `null` и данные не будут привязаны к элементу управления Repeater. При условии, что у нас есть `CurrentNode`, выполняется привязка его `ChildNodes` к элементу управления Repeater. Поскольку карта узла у нас настроена таким образом, чтобы `Default.aspx` в каждом разделе является родительским узлом для всех руководств в пределах этого раздела, этот код будет отображать ссылки на и описания всех руководства данного раздела, как показано на снимке экрана ниже.

После создания этого элемента управления Repeater, откройте `Default.aspx` страниц в каждой папке, перейдите в режим конструктора и просто перетащите пользовательский элемент управления из обозревателя решений в область конструктора место список руководств.

[![Пользовательский элемент управления был добавлен к странице Default.aspx](master-pages-and-site-navigation-cs/_static/image33.png)](master-pages-and-site-navigation-cs/_static/image32.png)

**Рис. 14**: Пользовательский элемент управления был добавлен `Default.aspx` ([Просмотр полноразмерного изображения](master-pages-and-site-navigation-cs/_static/image34.png))

[![Перечислены базовые учебники по службам Reporting](master-pages-and-site-navigation-cs/_static/image36.png)](master-pages-and-site-navigation-cs/_static/image35.png)

**Рис. 15**: Перечислены базовые учебники по службам Reporting ([Просмотр полноразмерного изображения](master-pages-and-site-navigation-cs/_static/image37.png))

## <a name="summary"></a>Сводка

После определения карты узла и создания главных страниц теперь у нас есть согласованные страницы макета и схему переходов для наших руководств. Независимо от того, сколько страниц, мы добавим наш веб-узел обновление всех страниц узла навигации — это простой и быстрый процесс, из-за централизованности. В частности, сведения о макете страницы определяется на главной странице `Site.master` и сопоставления в сайт `Web.sitemap`. Нам не нужно писать *любой* кода для достижения этого механизма макет и навигации страницы для всего, и мы храним полной сохранили поддержку конструктора WYSIWYG в Visual Studio.

Оформили уровень доступа к данным и бизнес-логики и иметь согласованные страницы макета и сайт определили структуру переходов, мы готовы к работе с распространенными шаблонами отчетов. В [Далее](../basic-reporting/displaying-data-with-the-objectdatasource-cs.md) три учебника мы рассмотрим основные задачи создания отчетов, отображение данных, полученных из BLL при GridView, DetailsView и FormView.

Счастливого вам программирования!

## <a name="further-reading"></a>Дополнительные сведения

Дополнительные сведения по темам, обсуждавшимся в этом руководстве см. в следующих ресурсах:

- [Обзор ASP.NET главных страниц](https://msdn.microsoft.com/library/wtxbf3hh.aspx)
- [Главные страницы в ASP.NET 2.0](http://odetocode.com/Articles/419.aspx)
- [Шаблоны ASP.NET 2.0 разработки](https://msdn.microsoft.com/asp.net/reference/design/templates/default.aspx)
- [Общие сведения о навигации узла ASP.NET](https://msdn.microsoft.com/library/e468hxky.aspx)
- [Изучение ASP.NET 2.0 переходы по узлу](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx)
- [Возможности переходов по ASP.NET 2.0 узлу](https://weblogs.asp.net/scottgu/archive/2005/11/20/431019.aspx)
- [Общие сведения о состоянии представления ASP.NET](https://msdn.microsoft.com/library/default.asp?url=/library/dnaspp/html/viewstate.asp)
- [Практическое руководство. Включение трассировки для страницы ASP.NET](https://msdn.microsoft.com/library/94c55d08%28VS.80%29.aspx)
- [Пользовательские элементы управления ASP.NET](https://msdn.microsoft.com/library/y6wb1a0e.aspx)

## <a name="about-the-author"></a>Об авторе

[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи книг по ASP/ASP.NET и основатель веб- [4GuysFromRolla.com](http://www.4guysfromrolla.com), работает с веб-технологиями Microsoft с 1998 года. Скотт — независимый консультант, преподаватель и автор. Его последняя книга — [ *Sams Teach ASP.NET 2.0 in 24 часа*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco). Ним можно связаться по адресу [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) или через его блог, который можно найти в [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).

## <a name="special-thanks-to"></a>Особая благодарность

В этой серии руководств пособий рецензировалась многими компетентными редакторами. (Liz Shulok), Деннис Patterson и (Hilton giesenow), стали Лиз Шалок в этом руководстве. Хотите поработать с моих последующих статей для MSDN? Если Да, напишите мне [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)

> [!div class="step-by-step"]
> [Назад](creating-a-business-logic-layer-cs.md)
> [Вперед](creating-a-data-access-layer-vb.md)
