---
uid: web-forms/overview/data-access/introduction/creating-a-business-logic-layer-cs
title: Создание уровня бизнес-логики (C#) | Документация Майкрософт
author: rick-anderson
description: В этом руководстве мы рассмотрим централизовать бизнес-правилам в слой бизнес-логики (BLL), выступающем в качестве посредника при обмене данными между t...
ms.author: riande
ms.date: 03/31/2010
ms.assetid: 85554606-47cb-4e4f-9848-eed9da579056
msc.legacyurl: /web-forms/overview/data-access/introduction/creating-a-business-logic-layer-cs
msc.type: authoredcontent
ms.openlocfilehash: 0db90f1e87bcaac51ca08ef1a8b258c93be8f613
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/01/2019
ms.locfileid: "57027881"
---
<a name="creating-a-business-logic-layer-c"></a><span data-ttu-id="75f1d-103">Создание уровня бизнес-логики (C#)</span><span class="sxs-lookup"><span data-stu-id="75f1d-103">Creating a Business Logic Layer (C#)</span></span>
====================
<span data-ttu-id="75f1d-104">по [Скотт Митчелл](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="75f1d-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="75f1d-105">[Скачайте пример приложения](http://download.microsoft.com/download/4/6/3/463cf87c-4724-4cbc-b7b5-3f866f43ba50/ASPNET_Data_Tutorial_2_CS.exe) или [скачать PDF](creating-a-business-logic-layer-cs/_static/datatutorial02cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="75f1d-105">[Download Sample App](http://download.microsoft.com/download/4/6/3/463cf87c-4724-4cbc-b7b5-3f866f43ba50/ASPNET_Data_Tutorial_2_CS.exe) or [Download PDF](creating-a-business-logic-layer-cs/_static/datatutorial02cs1.pdf)</span></span>

> <span data-ttu-id="75f1d-106">В этом руководстве будет показано, как централизовать бизнес-правилам в слой бизнес-логики (BLL), выступающем в качестве посредника при обмене данными между слоем представления и слоем DAL.</span><span class="sxs-lookup"><span data-stu-id="75f1d-106">In this tutorial we'll see how to centralize your business rules into a Business Logic Layer (BLL) that serves as an intermediary for data exchange between the presentation layer and the DAL.</span></span>


## <a name="introduction"></a><span data-ttu-id="75f1d-107">Вступление</span><span class="sxs-lookup"><span data-stu-id="75f1d-107">Introduction</span></span>

<span data-ttu-id="75f1d-108">Уровень доступа к данным (DAL) создан в [руководства по использованию](creating-a-data-access-layer-cs.md) четко разделяет данные доступа логики от логики представления.</span><span class="sxs-lookup"><span data-stu-id="75f1d-108">The Data Access Layer (DAL) created in the [first tutorial](creating-a-data-access-layer-cs.md) cleanly separates the data access logic from the presentation logic.</span></span> <span data-ttu-id="75f1d-109">Тем не менее хотя DAL четко отделяет сведения о данных доступа от слоя представления, любой бизнес-правила, которые могут применяться не реализуется.</span><span class="sxs-lookup"><span data-stu-id="75f1d-109">However, while the DAL cleanly separates the data access details from the presentation layer, it does not enforce any business rules that may apply.</span></span> <span data-ttu-id="75f1d-110">Например, для нашего приложения мы может потребоваться запретить `CategoryID` или `SupplierID` поля `Products` таблицы, если для `Discontinued` поле имеет значение 1 или нам может понадобиться принудительное применение правил старшинства, запрещающих ситуации, в котором Сотрудник управляется человек, который был принят на работу позже него.</span><span class="sxs-lookup"><span data-stu-id="75f1d-110">For example, for our application we may want to disallow the `CategoryID` or `SupplierID` fields of the `Products` table to be modified when the `Discontinued` field is set to 1, or we might want to enforce seniority rules, prohibiting situations in which an employee is managed by someone who was hired after them.</span></span> <span data-ttu-id="75f1d-111">Другим распространенным сценарием является авторизации может быть только пользователи в определенной роли, могут удалять продукты или можно изменить `UnitPrice` значение.</span><span class="sxs-lookup"><span data-stu-id="75f1d-111">Another common scenario is authorization perhaps only users in a particular role can delete products or can change the `UnitPrice` value.</span></span>

<span data-ttu-id="75f1d-112">В этом руководстве будет показано, как для централизации этих бизнес-правил в слой бизнес-логики (BLL), выступающем в качестве посредника при обмене данными между слоем представления и слоем DAL.</span><span class="sxs-lookup"><span data-stu-id="75f1d-112">In this tutorial we'll see how to centralize these business rules into a Business Logic Layer (BLL) that serves as an intermediary for data exchange between the presentation layer and the DAL.</span></span> <span data-ttu-id="75f1d-113">В реальном приложении слой бизнес-ЛОГИКИ должен быть реализован как отдельный проект библиотеки классов; Однако этих руководствах мы реализуем BLL как ряд классов в наших `App_Code` папки для упрощения структуры проекта.</span><span class="sxs-lookup"><span data-stu-id="75f1d-113">In a real-world application, the BLL should be implemented as a separate Class Library project; however, for these tutorials we'll implement the BLL as a series of classes in our `App_Code` folder in order to simplify the project structure.</span></span> <span data-ttu-id="75f1d-114">Рис. 1 показаны связи архитектуры между слоя представления, BLL и DAL.</span><span class="sxs-lookup"><span data-stu-id="75f1d-114">Figure 1 illustrates the architectural relationships among the presentation layer, BLL, and DAL.</span></span>


![BLL отделяет слой представления от уровня доступа к данным и налагает бизнес-правила](creating-a-business-logic-layer-cs/_static/image1.png)

<span data-ttu-id="75f1d-116">**Рис. 1**: BLL отделяет слой представления от уровня доступа к данным и налагает бизнес-правила</span><span class="sxs-lookup"><span data-stu-id="75f1d-116">**Figure 1**: The BLL Separates the Presentation Layer from the Data Access Layer and Imposes Business Rules</span></span>


## <a name="step-1-creating-the-bll-classes"></a><span data-ttu-id="75f1d-117">Шаг 1. Создание классов BLL</span><span class="sxs-lookup"><span data-stu-id="75f1d-117">Step 1: Creating the BLL Classes</span></span>

<span data-ttu-id="75f1d-118">Наш слой BLL будет состоять из четырех классов, по одному для каждого адаптера TableAdapter в слое DAL; Каждый из этих классов BLL будет содержать методы извлечения, вставки, обновления и удаления из соответствующего TableAdapter в слое DAL, применяющие соответствующие бизнес-правила.</span><span class="sxs-lookup"><span data-stu-id="75f1d-118">Our BLL will be composed of four classes, one for each TableAdapter in the DAL; each of these BLL classes will have methods for retrieving, inserting, updating, and deleting from the respective TableAdapter in the DAL, applying the appropriate business rules.</span></span>

<span data-ttu-id="75f1d-119">Для большей четкости разделения классов, связанных с DAL и BLL, создадим две вложенные папки в `App_Code` папке `DAL` и `BLL`.</span><span class="sxs-lookup"><span data-stu-id="75f1d-119">To more cleanly separate the DAL- and BLL-related classes, let's create two subfolders in the `App_Code` folder, `DAL` and `BLL`.</span></span> <span data-ttu-id="75f1d-120">Просто щелкните правой кнопкой мыши `App_Code` папку в обозревателе решений и выберите новую папку.</span><span class="sxs-lookup"><span data-stu-id="75f1d-120">Simply right-click on the `App_Code` folder in the Solution Explorer and choose New Folder.</span></span> <span data-ttu-id="75f1d-121">После создания этих двух папок переместите типизированный набор DataSet, созданный в первом руководстве в `DAL` во вложенную папку.</span><span class="sxs-lookup"><span data-stu-id="75f1d-121">After creating these two folders, move the Typed DataSet created in the first tutorial into the `DAL` subfolder.</span></span>

<span data-ttu-id="75f1d-122">Создайте четыре файла классов BLL во `BLL` во вложенную папку.</span><span class="sxs-lookup"><span data-stu-id="75f1d-122">Next, create the four BLL class files in the `BLL` subfolder.</span></span> <span data-ttu-id="75f1d-123">Для этого щелкните правой кнопкой мыши `BLL` во вложенную папку, выберите команду Добавить новый элемент и выберите шаблон класса.</span><span class="sxs-lookup"><span data-stu-id="75f1d-123">To accomplish this, right-click on the `BLL` subfolder, choose Add a New Item, and choose the Class template.</span></span> <span data-ttu-id="75f1d-124">Присвойте имя этим четырем классам `ProductsBLL`, `CategoriesBLL`, `SuppliersBLL`, и `EmployeesBLL`.</span><span class="sxs-lookup"><span data-stu-id="75f1d-124">Name the four classes `ProductsBLL`, `CategoriesBLL`, `SuppliersBLL`, and `EmployeesBLL`.</span></span>


![Добавьте четыре новых класса в папку App_Code](creating-a-business-logic-layer-cs/_static/image2.png)

<span data-ttu-id="75f1d-126">**Рис. 2**: Добавьте четыре новых класса в `App_Code` папки</span><span class="sxs-lookup"><span data-stu-id="75f1d-126">**Figure 2**: Add Four New Classes to the `App_Code` Folder</span></span>


<span data-ttu-id="75f1d-127">Далее добавим методы к каждому из классов, чтобы просто перенести методы, определенные для TableAdapters из первого руководства.</span><span class="sxs-lookup"><span data-stu-id="75f1d-127">Next, let's add methods to each of the classes to simply wrap the methods defined for the TableAdapters from the first tutorial.</span></span> <span data-ttu-id="75f1d-128">Пока эти методы будут просто вызываться непосредственно из DAL; впоследствии мы вернемся Добавление любые необходимые бизнес-логики.</span><span class="sxs-lookup"><span data-stu-id="75f1d-128">For now, these methods will just call directly into the DAL; we'll return later to add any needed business logic.</span></span>

> [!NOTE]
> <span data-ttu-id="75f1d-129">Если вы используете Visual Studio Standard Edition или более поздней версии (то есть вы *не* с помощью Visual Web Developer), существует возможность проектировать классы визуально с помощью [конструктор классов](https://msdn.microsoft.com/library/default.asp?url=/library/dv_vstechart/html/clssdsgnr.asp).</span><span class="sxs-lookup"><span data-stu-id="75f1d-129">If you are using Visual Studio Standard Edition or above (that is, you're *not* using Visual Web Developer), you can optionally design your classes visually using the [Class Designer](https://msdn.microsoft.com/library/default.asp?url=/library/dv_vstechart/html/clssdsgnr.asp).</span></span> <span data-ttu-id="75f1d-130">Ссылаться на [блог конструктор класса](https://blogs.msdn.com/classdesigner/default.aspx) Дополнительные сведения об этой новой возможности в Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="75f1d-130">Refer to the [Class Designer Blog](https://blogs.msdn.com/classdesigner/default.aspx) for more information on this new feature in Visual Studio.</span></span>


<span data-ttu-id="75f1d-131">Для `ProductsBLL` придется добавить целых семь методов:</span><span class="sxs-lookup"><span data-stu-id="75f1d-131">For the `ProductsBLL` class we need to add a total of seven methods:</span></span>

- <span data-ttu-id="75f1d-132">`GetProducts()` Возвращает все продукты</span><span class="sxs-lookup"><span data-stu-id="75f1d-132">`GetProducts()` returns all products</span></span>
- <span data-ttu-id="75f1d-133">`GetProductByProductID(productID)` Возвращает продукт с указанным Идентификатором продукта</span><span class="sxs-lookup"><span data-stu-id="75f1d-133">`GetProductByProductID(productID)` returns the product with the specified product ID</span></span>
- <span data-ttu-id="75f1d-134">`GetProductsByCategoryID(categoryID)` Возвращает все продукты указанной категории</span><span class="sxs-lookup"><span data-stu-id="75f1d-134">`GetProductsByCategoryID(categoryID)` returns all products from the specified category</span></span>
- <span data-ttu-id="75f1d-135">`GetProductsBySupplier(supplierID)` Возвращает все продукты указанного поставщика</span><span class="sxs-lookup"><span data-stu-id="75f1d-135">`GetProductsBySupplier(supplierID)` returns all products from the specified supplier</span></span>
- <span data-ttu-id="75f1d-136">`AddProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued)` Вставляет новый продукт в базе данных с использованием значений переданное; Возвращает `ProductID` значение вновь вставленной записи</span><span class="sxs-lookup"><span data-stu-id="75f1d-136">`AddProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued)` inserts a new product into the database using the values passed-in; returns the `ProductID` value of the newly inserted record</span></span>
- <span data-ttu-id="75f1d-137">`UpdateProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued, productID)` обновляет существующий продукт в базе данных, используя переданные значения; Возвращает `true` Если точности одна строка была обновлена, `false` в противном случае</span><span class="sxs-lookup"><span data-stu-id="75f1d-137">`UpdateProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued, productID)` updates an existing product in the database using the passed-in values; returns `true` if precisely one row was updated, `false` otherwise</span></span>
- <span data-ttu-id="75f1d-138">`DeleteProduct(productID)` Удаляет указанный продукт из базы данных</span><span class="sxs-lookup"><span data-stu-id="75f1d-138">`DeleteProduct(productID)` deletes the specified product from the database</span></span>

<span data-ttu-id="75f1d-139">ProductsBLL.cs</span><span class="sxs-lookup"><span data-stu-id="75f1d-139">ProductsBLL.cs</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample1.cs)]

<span data-ttu-id="75f1d-140">Методы, которые просто возвращают данные `GetProducts`, `GetProductByProductID`, `GetProductsByCategoryID`, и `GetProductBySuppliersID` являются крайне простыми, так как они напрямую обращаются к слою методу DAL.</span><span class="sxs-lookup"><span data-stu-id="75f1d-140">The methods that simply return data `GetProducts`, `GetProductByProductID`, `GetProductsByCategoryID`, and `GetProductBySuppliersID` are fairly straightforward as they simply call down into the DAL.</span></span> <span data-ttu-id="75f1d-141">Хотя в некоторых сценариях может быть бизнес-правила, которые должны быть реализованы на этом уровне (например, правила авторизации на основе текущего пользователя или роли, к которой принадлежит пользователь), мы просто оставим эти методы, как-является.</span><span class="sxs-lookup"><span data-stu-id="75f1d-141">While in some scenarios there may be business rules that need to be implemented at this level (such as authorization rules based on the currently logged on user or the role to which the user belongs), we'll simply leave these methods as-is.</span></span> <span data-ttu-id="75f1d-142">Для этих методов выберите слой BLL будет выступать в качестве прокси-сервера, через который слой представления получает доступ к данным из уровня доступа к данным.</span><span class="sxs-lookup"><span data-stu-id="75f1d-142">For these methods, then, the BLL serves merely as a proxy through which the presentation layer accesses the underlying data from the Data Access Layer.</span></span>

<span data-ttu-id="75f1d-143">`AddProduct` И `UpdateProduct` методов и принимают в качестве параметров значения различных полей продукта и добавляют новый продукт или обновляет существующий, соответственно.</span><span class="sxs-lookup"><span data-stu-id="75f1d-143">The `AddProduct` and `UpdateProduct` methods both take in as parameters the values for the various product fields and add a new product or update an existing one, respectively.</span></span> <span data-ttu-id="75f1d-144">Поскольку многие из `Product` столбцы таблицы могут принимать `NULL` значения (`CategoryID`, `SupplierID`, и `UnitPrice`, некоторые), для тех входных параметров `AddProduct` и `UpdateProduct` , сопоставленные с таким столбцам, используются [обнуляемые типы](https://msdn.microsoft.com/library/1t3y8s4s(v=vs.80).aspx).</span><span class="sxs-lookup"><span data-stu-id="75f1d-144">Since many of the `Product` table's columns can accept `NULL` values (`CategoryID`, `SupplierID`, and `UnitPrice`, to name a few), those input parameters for `AddProduct` and `UpdateProduct` that map to such columns use [nullable types](https://msdn.microsoft.com/library/1t3y8s4s(v=vs.80).aspx).</span></span> <span data-ttu-id="75f1d-145">Обнуляемые типы не знакомы с .NET 2.0 и дают возможность указать, для, указывающее, является ли тип значения должен, вместо этого быть `null`.</span><span class="sxs-lookup"><span data-stu-id="75f1d-145">Nullable types are new to .NET 2.0 and provide a technique for indicating whether a value type should, instead, be `null`.</span></span> <span data-ttu-id="75f1d-146">В C#, можно пометить тип значения как тип, допускающий значение NULL, добавив `?` после типа (например `int? x;`).</span><span class="sxs-lookup"><span data-stu-id="75f1d-146">In C# you can flag a value type as a nullable type by adding `?` after the type (like `int? x;`).</span></span> <span data-ttu-id="75f1d-147">Ссылаться на [обнуляемые типы](https://msdn.microsoft.com/library/1t3y8s4s.aspx) статьи [руководство по программированию C#](https://msdn.microsoft.com/library/67ef8sbd%28VS.80%29.aspx) Дополнительные сведения.</span><span class="sxs-lookup"><span data-stu-id="75f1d-147">Refer to the [Nullable Types](https://msdn.microsoft.com/library/1t3y8s4s.aspx) section in the [C# Programming Guide](https://msdn.microsoft.com/library/67ef8sbd%28VS.80%29.aspx) for more information.</span></span>

<span data-ttu-id="75f1d-148">Все три метода возвращают логическое значение, указывающее, был ли строки вставки, обновления или удалить, так как операция может не привести к над соответствующей строкой.</span><span class="sxs-lookup"><span data-stu-id="75f1d-148">All three methods return a Boolean value indicating whether a row was inserted, updated, or deleted since the operation may not result in an affected row.</span></span> <span data-ttu-id="75f1d-149">Например, если разработчик страницы вызывает `DeleteProduct` передавая `ProductID` для несуществующего продукта, `DELETE` обращенное к базе данных не оказывает влияния и, следовательно, `DeleteProduct` метод возвратит `false`.</span><span class="sxs-lookup"><span data-stu-id="75f1d-149">For example, if the page developer calls `DeleteProduct` passing in a `ProductID` for a non-existent product, the `DELETE` statement issued to the database will have no affect and therefore the `DeleteProduct` method will return `false`.</span></span>

<span data-ttu-id="75f1d-150">Обратите внимание, что при добавлении нового продукта или обновляется существующая мы берем в продукт новых или измененных значений полей как список скалярных выражений, в отличие от принятия `ProductsRow` экземпляра.</span><span class="sxs-lookup"><span data-stu-id="75f1d-150">Note that when adding a new product or updating an existing one we take in the new or modified product's field values as a list of scalars as opposed to accepting a `ProductsRow` instance.</span></span> <span data-ttu-id="75f1d-151">Такой подход был выбран, так как `ProductsRow` класс является производным `DataRow` класс, который не имеет конструктора по умолчанию без параметров.</span><span class="sxs-lookup"><span data-stu-id="75f1d-151">This approach was chosen because the `ProductsRow` class derives from the ADO.NET `DataRow` class, which doesn't have a default parameterless constructor.</span></span> <span data-ttu-id="75f1d-152">Для создания нового экземпляра `ProductsRow` экземпляра, необходимо сначала создать `ProductsDataTable` и затем вызвать его `NewProductRow()` метода (который мы делаем в `AddProduct`).</span><span class="sxs-lookup"><span data-stu-id="75f1d-152">In order to create a new `ProductsRow` instance, we must first create a `ProductsDataTable` instance and then invoke its `NewProductRow()` method (which we do in `AddProduct`).</span></span> <span data-ttu-id="75f1d-153">Этот недостаток начинает себя проявлять при обращении ко вставке и обновлению продуктов с помощью элемента управления ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="75f1d-153">This shortcoming rears its head when we turn to inserting and updating products using the ObjectDataSource.</span></span> <span data-ttu-id="75f1d-154">Короче говоря ObjectDataSource пытается создать экземпляр входных параметров.</span><span class="sxs-lookup"><span data-stu-id="75f1d-154">In short, the ObjectDataSource will try to create an instance of the input parameters.</span></span> <span data-ttu-id="75f1d-155">Если метод BLL ожидает `ProductsRow` экземпляра, ObjectDataSource пытается создать его, но завершиться ошибкой из-за отсутствия конструктора без параметров по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="75f1d-155">If the BLL method expects a `ProductsRow` instance, the ObjectDataSource will try to create one, but fail due to the lack of a default parameterless constructor.</span></span> <span data-ttu-id="75f1d-156">Дополнительные сведения по этой проблеме см. в следующих двух форумах по ASP.NET: [Обновление элементов управления ObjectDataSource с помощью строго типизированных наборов данных](https://forums.asp.net/1098630/ShowPost.aspx), и [проблема с ObjectDataSource и строго типизированный набор DataSet](https://forums.asp.net/1048212/ShowPost.aspx).</span><span class="sxs-lookup"><span data-stu-id="75f1d-156">For more information on this problem, refer to the following two ASP.NET Forums posts: [Updating ObjectDataSources with Strongly-Typed DataSets](https://forums.asp.net/1098630/ShowPost.aspx), and [Problem With ObjectDataSource and Strongly-Typed DataSet](https://forums.asp.net/1048212/ShowPost.aspx).</span></span>

<span data-ttu-id="75f1d-157">Далее, в обоих `AddProduct` и `UpdateProduct`, код создает `ProductsRow` экземпляра и заполняется только что переданными значениями.</span><span class="sxs-lookup"><span data-stu-id="75f1d-157">Next, in both `AddProduct` and `UpdateProduct`, the code creates a `ProductsRow` instance and populates it with the values just passed in.</span></span> <span data-ttu-id="75f1d-158">При присвоении значений объектам DataColumn класса DataRow возможны различные проверки на уровне полей.</span><span class="sxs-lookup"><span data-stu-id="75f1d-158">When assigning values to DataColumns of a DataRow various field-level validation checks can occur.</span></span> <span data-ttu-id="75f1d-159">Таким образом Вставка вручную переданных значений обратно в строку DataRow облегчает обеспечение допустимости данных, передаваемые в метод BLL.</span><span class="sxs-lookup"><span data-stu-id="75f1d-159">Therefore, manually putting the passed in values back into a DataRow helps ensure the validity of the data being passed to the BLL method.</span></span> <span data-ttu-id="75f1d-160">К сожалению, строго типизированные классы DataRow, созданные Visual Studio не используют обнуляемые типы.</span><span class="sxs-lookup"><span data-stu-id="75f1d-160">Unfortunately the strongly-typed DataRow classes generated by Visual Studio do not use nullable types.</span></span> <span data-ttu-id="75f1d-161">Скорее чтобы указать, что конкретный объект DataColumn в DataRow должен соответствовать `NULL` базы данных необходимо использовать `SetColumnNameNull()` метод.</span><span class="sxs-lookup"><span data-stu-id="75f1d-161">Rather, to indicate that a particular DataColumn in a DataRow should correspond to a `NULL` database value we must use the `SetColumnNameNull()` method.</span></span>

<span data-ttu-id="75f1d-162">В `UpdateProduct` сначала загружается обновляемый продукт с помощью `GetProductByProductID(productID)`.</span><span class="sxs-lookup"><span data-stu-id="75f1d-162">In `UpdateProduct` we first load in the product to update using `GetProductByProductID(productID)`.</span></span> <span data-ttu-id="75f1d-163">Хотя это может показаться необязательным обращением к базе данных, этот дополнительный проход, будет доказана осмысленность в следующих учебных пособиях, исследующих оптимистичный параллелизм.</span><span class="sxs-lookup"><span data-stu-id="75f1d-163">While this may seem like an unnecessary trip to the database, this extra trip will prove worthwhile in future tutorials that explore optimistic concurrency.</span></span> <span data-ttu-id="75f1d-164">Оптимистическая блокировка — это метод, чтобы убедиться, что случайно двух пользователей, которые одновременно работают над теми же данными не перезаписать изменения друг друга.</span><span class="sxs-lookup"><span data-stu-id="75f1d-164">Optimistic concurrency is a technique to ensure that two users who are simultaneously working on the same data don't accidentally overwrite one another's changes.</span></span> <span data-ttu-id="75f1d-165">Захват записи целиком также упрощает создание методов обновления в BLL, изменяющих только подмножество столбцов DataRow.</span><span class="sxs-lookup"><span data-stu-id="75f1d-165">Grabbing the entire record also makes it easier to create update methods in the BLL that only modify a subset of the DataRow's columns.</span></span> <span data-ttu-id="75f1d-166">При изучении `SuppliersBLL` класс, мы рассмотрим такой пример.</span><span class="sxs-lookup"><span data-stu-id="75f1d-166">When we explore the `SuppliersBLL` class we'll see such an example.</span></span>

<span data-ttu-id="75f1d-167">Наконец, обратите внимание, что `ProductsBLL` класс имеет [к нему атрибут DataObject](https://msdn.microsoft.com/library/system.componentmodel.dataobjectattribute.aspx) применения к нему ( `[System.ComponentModel.DataObject]` непосредственно предшествующий оператору класса поблизости верхней части файла) и методы имеют [ Атрибуты DataObjectMethodAttribute](https://msdn.microsoft.com/library/system.componentmodel.dataobjectmethodattribute.aspx).</span><span class="sxs-lookup"><span data-stu-id="75f1d-167">Finally, note that the `ProductsBLL` class has the [DataObject attribute](https://msdn.microsoft.com/library/system.componentmodel.dataobjectattribute.aspx) applied to it (the `[System.ComponentModel.DataObject]` syntax right before the class statement near the top of the file) and the methods have [DataObjectMethodAttribute attributes](https://msdn.microsoft.com/library/system.componentmodel.dataobjectmethodattribute.aspx).</span></span> <span data-ttu-id="75f1d-168">`DataObject` Атрибут помечает класс как объект, подходящий для привязки к [элемента управления ObjectDataSource](https://msdn.microsoft.com/library/9a4kyhcx.aspx), тогда как `DataObjectMethodAttribute` указывает назначение метода.</span><span class="sxs-lookup"><span data-stu-id="75f1d-168">The `DataObject` attribute marks the class as being an object suitable for binding to an [ObjectDataSource control](https://msdn.microsoft.com/library/9a4kyhcx.aspx), whereas the `DataObjectMethodAttribute` indicates the purpose of the method.</span></span> <span data-ttu-id="75f1d-169">Как мы увидим в последующих руководствах, элемент управления ObjectDataSource ASP.NET 2.0 облегчает декларативный доступ к данным из класса.</span><span class="sxs-lookup"><span data-stu-id="75f1d-169">As we'll see in future tutorials, ASP.NET 2.0's ObjectDataSource makes it easy to declaratively access data from a class.</span></span> <span data-ttu-id="75f1d-170">Для облегчения фильтрации списка возможных классов для привязки к в мастере ObjectDataSource, по умолчанию только классы, помеченные как `DataObjects` отображаются в раскрывающемся списке мастера.</span><span class="sxs-lookup"><span data-stu-id="75f1d-170">To help filter the list of possible classes to bind to in the ObjectDataSource's wizard, by default only those classes marked as `DataObjects` are shown in the wizard's drop-down list.</span></span> <span data-ttu-id="75f1d-171">`ProductsBLL` Класс будет работать точно так же без этих атрибутов, но их добавление облегчает работу в мастере ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="75f1d-171">The `ProductsBLL` class will work just as well without these attributes, but adding them makes it easier to work with in the ObjectDataSource's wizard.</span></span>

## <a name="adding-the-other-classes"></a><span data-ttu-id="75f1d-172">Добавление других классов</span><span class="sxs-lookup"><span data-stu-id="75f1d-172">Adding the Other Classes</span></span>

<span data-ttu-id="75f1d-173">С помощью `ProductsBLL` полный класс, по-прежнему необходимо добавить классы для работы с категориями, поставщиками и сотрудниками.</span><span class="sxs-lookup"><span data-stu-id="75f1d-173">With the `ProductsBLL` class complete, we still need to add the classes for working with categories, suppliers, and employees.</span></span> <span data-ttu-id="75f1d-174">Уделите минуту, чтобы создать следующие классы и методы, с использованием концепции из приведенного выше примера.</span><span class="sxs-lookup"><span data-stu-id="75f1d-174">Take a moment to create the following classes and methods using the concepts from the example above:</span></span>

- <span data-ttu-id="75f1d-175">**CategoriesBLL.cs**</span><span class="sxs-lookup"><span data-stu-id="75f1d-175">**CategoriesBLL.cs**</span></span>

    - `GetCategories()`
    - `GetCategoryByCategoryID(categoryID)`
- <span data-ttu-id="75f1d-176">**SuppliersBLL.cs**</span><span class="sxs-lookup"><span data-stu-id="75f1d-176">**SuppliersBLL.cs**</span></span>

    - `GetSuppliers()`
    - `GetSupplierBySupplierID(supplierID)`
    - `GetSuppliersByCountry(country)`
    - `UpdateSupplierAddress(supplierID, address, city, country)`
- <span data-ttu-id="75f1d-177">**EmployeesBLL.cs**</span><span class="sxs-lookup"><span data-stu-id="75f1d-177">**EmployeesBLL.cs**</span></span>

    - `GetEmployees()`
    - `GetEmployeeByEmployeeID(employeeID)`
    - `GetEmployeesByManager(managerID)`

<span data-ttu-id="75f1d-178">Достоин упоминания метод является `SuppliersBLL` класса `UpdateSupplierAddress` метод.</span><span class="sxs-lookup"><span data-stu-id="75f1d-178">The one method worth noting is the `SuppliersBLL` class's `UpdateSupplierAddress` method.</span></span> <span data-ttu-id="75f1d-179">Этот метод предоставляет интерфейс для обновления только сведения о адрес поставщика.</span><span class="sxs-lookup"><span data-stu-id="75f1d-179">This method provides an interface for updating just the supplier's address information.</span></span> <span data-ttu-id="75f1d-180">На внутреннем уровне этот метод считывает в `SupplierDataRow` для указанного `supplierID` (с помощью `GetSupplierBySupplierID`), задает его свойства, связанные с адресом и затем вызывается метод `SupplierDataTable` `Update` метод.</span><span class="sxs-lookup"><span data-stu-id="75f1d-180">Internally, this method reads in the `SupplierDataRow` object for the specified `supplierID` (using `GetSupplierBySupplierID`), sets its address-related properties, and then calls down into the `SupplierDataTable`'s `Update` method.</span></span> <span data-ttu-id="75f1d-181">`UpdateSupplierAddress` Метод следующим образом:</span><span class="sxs-lookup"><span data-stu-id="75f1d-181">The `UpdateSupplierAddress` method follows:</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample2.cs)]

<span data-ttu-id="75f1d-182">См. в этой статье загрузки для Завершенная реализация классов BLL.</span><span class="sxs-lookup"><span data-stu-id="75f1d-182">Refer to this article's download for my complete implementation of the BLL classes.</span></span>

## <a name="step-2-accessing-the-typed-datasets-through-the-bll-classes"></a><span data-ttu-id="75f1d-183">Шаг 2. Доступ к типизированным наборам данных посредством классов BLL</span><span class="sxs-lookup"><span data-stu-id="75f1d-183">Step 2: Accessing the Typed DataSets Through the BLL Classes</span></span>

<span data-ttu-id="75f1d-184">В первом учебном курсе были рассмотрены примеры работы непосредственно с типизированный набор DataSet, программными средствами, но с добавлением наши классы BLL, уровень представления предназначен для работы с BLL вместо этого.</span><span class="sxs-lookup"><span data-stu-id="75f1d-184">In the first tutorial we saw examples of working directly with the Typed DataSet programmatically, but with the addition of our BLL classes, the presentation tier should work against the BLL instead.</span></span> <span data-ttu-id="75f1d-185">В `AllProducts.aspx` пример из руководства по использованию `ProductsTableAdapter` использовался для привязки списка продуктов к GridView, как показано в следующем коде:</span><span class="sxs-lookup"><span data-stu-id="75f1d-185">In the `AllProducts.aspx` example from the first tutorial, the `ProductsTableAdapter` was used to bind the list of products to a GridView, as shown in the following code:</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample3.cs)]

<span data-ttu-id="75f1d-186">Для использования нового BLL классы, все, которые необходимо изменить — первая часть кода просто заменить `ProductsTableAdapter` со `ProductBLL` объекта:</span><span class="sxs-lookup"><span data-stu-id="75f1d-186">To use the new BLL classes, all that needs to be changed is the first line of code simply replace the `ProductsTableAdapter` object with a `ProductBLL` object:</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample4.cs)]

<span data-ttu-id="75f1d-187">Классы BLL может осуществляться с помощью элемента управления ObjectDataSource также декларативно (что может типизированный набор DataSet).</span><span class="sxs-lookup"><span data-stu-id="75f1d-187">The BLL classes can also be accessed declaratively (as can the Typed DataSet) by using the ObjectDataSource.</span></span> <span data-ttu-id="75f1d-188">Здесь мы рассмотрим ObjectDataSource более подробно в следующих руководствах.</span><span class="sxs-lookup"><span data-stu-id="75f1d-188">We'll be discussing the ObjectDataSource in greater detail in the following tutorials.</span></span>


<span data-ttu-id="75f1d-189">[![Список продуктов, отображаемый в GridView](creating-a-business-logic-layer-cs/_static/image4.png)](creating-a-business-logic-layer-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="75f1d-189">[![The List of Products is Displayed in a GridView](creating-a-business-logic-layer-cs/_static/image4.png)](creating-a-business-logic-layer-cs/_static/image3.png)</span></span>

<span data-ttu-id="75f1d-190">**Рис. 3**: Список продуктов, отображаемый в элементе управления GridView ([Просмотр полноразмерного изображения](creating-a-business-logic-layer-cs/_static/image5.png))</span><span class="sxs-lookup"><span data-stu-id="75f1d-190">**Figure 3**: The List of Products is Displayed in a GridView ([Click to view full-size image](creating-a-business-logic-layer-cs/_static/image5.png))</span></span>


## <a name="step-3-adding-field-level-validation-to-the-datarow-classes"></a><span data-ttu-id="75f1d-191">Шаг 3. Добавление проверки на уровне полей к классам DataRow</span><span class="sxs-lookup"><span data-stu-id="75f1d-191">Step 3: Adding Field-Level Validation to the DataRow Classes</span></span>

<span data-ttu-id="75f1d-192">Проверки на уровне полей являются проверками, которые относятся к значениям свойств бизнес-объектов, при вставке или обновлении.</span><span class="sxs-lookup"><span data-stu-id="75f1d-192">Field-level validation are checks that pertains to the property values of the business objects when inserting or updating.</span></span> <span data-ttu-id="75f1d-193">Включают несколько правил проверки на уровне полей для продуктов:</span><span class="sxs-lookup"><span data-stu-id="75f1d-193">Some field-level validation rules for products include:</span></span>

- <span data-ttu-id="75f1d-194">`ProductName` Должна превышать 40 символов длиной</span><span class="sxs-lookup"><span data-stu-id="75f1d-194">The `ProductName` field must be 40 characters or less in length</span></span>
- <span data-ttu-id="75f1d-195">`QuantityPerUnit` Должна превышать 20 символов длиной</span><span class="sxs-lookup"><span data-stu-id="75f1d-195">The `QuantityPerUnit` field must be 20 characters or less in length</span></span>
- <span data-ttu-id="75f1d-196">`ProductID`, `ProductName`, И `Discontinued` поля являются обязательными, но все остальные поля являются необязательными</span><span class="sxs-lookup"><span data-stu-id="75f1d-196">The `ProductID`, `ProductName`, and `Discontinued` fields are required, but all other fields are optional</span></span>
- <span data-ttu-id="75f1d-197">`UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, И `ReorderLevel` поля должны быть больше или равно нулю</span><span class="sxs-lookup"><span data-stu-id="75f1d-197">The `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, and `ReorderLevel` fields must be greater than or equal to zero</span></span>

<span data-ttu-id="75f1d-198">Эти правила могут и должны быть выражены на уровне базы данных.</span><span class="sxs-lookup"><span data-stu-id="75f1d-198">These rules can and should be expressed at the database level.</span></span> <span data-ttu-id="75f1d-199">Ограничение символов на `ProductName` и `QuantityPerUnit` поля регистрируются по типам данных тех столбцов `Products` таблицы (`nvarchar(40)` и `nvarchar(20)`, соответственно).</span><span class="sxs-lookup"><span data-stu-id="75f1d-199">The character limit on the `ProductName` and `QuantityPerUnit` fields are captured by the data types of those columns in the `Products` table (`nvarchar(40)` and `nvarchar(20)`, respectively).</span></span> <span data-ttu-id="75f1d-200">Являются ли поля обязательные и необязательные выражается посредством допустимости для столбца таблицы базы данных позволяет `NULL` s.</span><span class="sxs-lookup"><span data-stu-id="75f1d-200">Whether fields are required and optional are expressed by if the database table column allows `NULL` s.</span></span> <span data-ttu-id="75f1d-201">Четыре [проверочные ограничения](https://msdn.microsoft.com/library/ms188258.aspx) существует, убедитесь, что только значения больше или равно нулю могут выполнять его в `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, или `ReorderLevel` столбцов.</span><span class="sxs-lookup"><span data-stu-id="75f1d-201">Four [check constraints](https://msdn.microsoft.com/library/ms188258.aspx) exist that ensure that only values greater than or equal to zero can make it into the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, or `ReorderLevel` columns.</span></span>

<span data-ttu-id="75f1d-202">Помимо обязательного выполнения этих правил в базе данных они должны также обязательно выполняться на уровне объекта DataSet.</span><span class="sxs-lookup"><span data-stu-id="75f1d-202">In addition to enforcing these rules at the database they should also be enforced at the DataSet level.</span></span> <span data-ttu-id="75f1d-203">На самом деле длина поля и является ли значение обязательного уже определены для каждого объекта DataTable набора DataColumns объекта.</span><span class="sxs-lookup"><span data-stu-id="75f1d-203">In fact, the field length and whether a value is required or optional are already captured for each DataTable's set of DataColumns.</span></span> <span data-ttu-id="75f1d-204">Чтобы просмотреть существующие проверки уровня полей автоматически, перейдите в конструктор DataSet, выберите поле из одного из DataTable, а затем выберите окно "Свойства".</span><span class="sxs-lookup"><span data-stu-id="75f1d-204">To see the existing field-level validation automatically provided, go to the DataSet Designer, select a field from one of the DataTables and then go to the Properties window.</span></span> <span data-ttu-id="75f1d-205">Как показано на рис. 4, `QuantityPerUnit` DataColumn в `ProductsDataTable` имеет максимальную длину 20 символов и допускает `NULL` значения.</span><span class="sxs-lookup"><span data-stu-id="75f1d-205">As Figure 4 shows, the `QuantityPerUnit` DataColumn in the `ProductsDataTable` has a maximum length of 20 characters and does allow `NULL` values.</span></span> <span data-ttu-id="75f1d-206">Если для свойства `ProductsDataRow` `QuantityPerUnit` строковое значение длиннее 20 символов `ArgumentException` будет создано.</span><span class="sxs-lookup"><span data-stu-id="75f1d-206">If we attempt to set the `ProductsDataRow`'s `QuantityPerUnit` property to a string value longer than 20 characters an `ArgumentException` will be thrown.</span></span>


<span data-ttu-id="75f1d-207">[![DataColumn обеспечивает базовую проверку на уровне полей](creating-a-business-logic-layer-cs/_static/image7.png)](creating-a-business-logic-layer-cs/_static/image6.png)</span><span class="sxs-lookup"><span data-stu-id="75f1d-207">[![The DataColumn Provides Basic Field-Level Validation](creating-a-business-logic-layer-cs/_static/image7.png)](creating-a-business-logic-layer-cs/_static/image6.png)</span></span>

<span data-ttu-id="75f1d-208">**Рис. 4**: DataColumn обеспечивает базовую на уровне полей проверку ([Просмотр полноразмерного изображения](creating-a-business-logic-layer-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="75f1d-208">**Figure 4**: The DataColumn Provides Basic Field-Level Validation ([Click to view full-size image](creating-a-business-logic-layer-cs/_static/image8.png))</span></span>


<span data-ttu-id="75f1d-209">К сожалению, мы не может указать проверяются границы, например `UnitPrice` значение должно быть больше или равно нулю, в окне «Свойства».</span><span class="sxs-lookup"><span data-stu-id="75f1d-209">Unfortunately, we can't specify bounds checks, such as the `UnitPrice` value must be greater than or equal to zero, through the Properties window.</span></span> <span data-ttu-id="75f1d-210">Для обеспечения этого типа проверки на уровне полей необходимо создать обработчик событий для объекта DataTable [ColumnChanging](https://msdn.microsoft.com/library/system.data.datatable.columnchanging%28VS.80%29.aspx) событий.</span><span class="sxs-lookup"><span data-stu-id="75f1d-210">In order to provide this type of field-level validation we need to create an event handler for the DataTable's [ColumnChanging](https://msdn.microsoft.com/library/system.data.datatable.columnchanging%28VS.80%29.aspx) event.</span></span> <span data-ttu-id="75f1d-211">Как упоминалось в [предыдущем учебном курсе](creating-a-data-access-layer-cs.md), объекты DataSet, DataTables и DataRow, создаваемые типизированный набор DataSet можно расширить посредством использования частичных классов.</span><span class="sxs-lookup"><span data-stu-id="75f1d-211">As mentioned in the [preceding tutorial](creating-a-data-access-layer-cs.md), the DataSet, DataTables, and DataRow objects created by the Typed DataSet can be extended through the use of partial classes.</span></span> <span data-ttu-id="75f1d-212">С помощью этой методики, мы можем создать `ColumnChanging` обработчик событий для `ProductsDataTable` класса.</span><span class="sxs-lookup"><span data-stu-id="75f1d-212">Using this technique we can create a `ColumnChanging` event handler for the `ProductsDataTable` class.</span></span> <span data-ttu-id="75f1d-213">Начните с создания класса в `App_Code` папку с именем `ProductsDataTable.ColumnChanging.cs`.</span><span class="sxs-lookup"><span data-stu-id="75f1d-213">Start by creating a class in the `App_Code` folder named `ProductsDataTable.ColumnChanging.cs`.</span></span>


<span data-ttu-id="75f1d-214">[![Добавьте новый класс в папку App_Code](creating-a-business-logic-layer-cs/_static/image10.png)](creating-a-business-logic-layer-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="75f1d-214">[![Add a New Class to the App_Code Folder](creating-a-business-logic-layer-cs/_static/image10.png)](creating-a-business-logic-layer-cs/_static/image9.png)</span></span>

<span data-ttu-id="75f1d-215">**Рис. 5**: Добавьте новый класс к `App_Code` папку ([Просмотр полноразмерного изображения](creating-a-business-logic-layer-cs/_static/image11.png))</span><span class="sxs-lookup"><span data-stu-id="75f1d-215">**Figure 5**: Add a New Class to the `App_Code` Folder ([Click to view full-size image](creating-a-business-logic-layer-cs/_static/image11.png))</span></span>


<span data-ttu-id="75f1d-216">Создайте обработчик событий для `ColumnChanging` событие, которое гарантирует, что `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, и `ReorderLevel` значения столбцов (в противном случае `NULL`) больше или равно нулю.</span><span class="sxs-lookup"><span data-stu-id="75f1d-216">Next, create an event handler for the `ColumnChanging` event that ensures that the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, and `ReorderLevel` column values (if not `NULL`) are greater than or equal to zero.</span></span> <span data-ttu-id="75f1d-217">Если любой из таких столбцов выходит за пределы диапазона, возникает исключение `ArgumentException`.</span><span class="sxs-lookup"><span data-stu-id="75f1d-217">If any such column is out of range, throw an `ArgumentException`.</span></span>

<span data-ttu-id="75f1d-218">ProductsDataTable.ColumnChanging.cs</span><span class="sxs-lookup"><span data-stu-id="75f1d-218">ProductsDataTable.ColumnChanging.cs</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample5.cs)]

## <a name="step-4-adding-custom-business-rules-to-the-blls-classes"></a><span data-ttu-id="75f1d-219">Шаг 4. Добавление пользовательских бизнес-правил к классам BLL</span><span class="sxs-lookup"><span data-stu-id="75f1d-219">Step 4: Adding Custom Business Rules to the BLL's Classes</span></span>

<span data-ttu-id="75f1d-220">Помимо проверки на уровне полей могут существовать высокого уровня пользовательских бизнес-правил, которые включают в себя различные объекты или концепции которые невозможно выразить на уровне столбца, такие как:</span><span class="sxs-lookup"><span data-stu-id="75f1d-220">In addition to field-level validation, there may be high-level custom business rules that involve different entities or concepts not expressible at the single column level, such as:</span></span>

- <span data-ttu-id="75f1d-221">Если продукт снят с производства, его `UnitPrice` не может быть обновлен</span><span class="sxs-lookup"><span data-stu-id="75f1d-221">If a product is discontinued, its `UnitPrice` cannot be updated</span></span>
- <span data-ttu-id="75f1d-222">Страна проживания сотрудников должна совпадать с именем страной проживания их руководителя</span><span class="sxs-lookup"><span data-stu-id="75f1d-222">An employee's country of residence must be the same as their manager's country of residence</span></span>
- <span data-ttu-id="75f1d-223">Продукт не может прекратить в случае, если это единственный продукт, предоставляемый данным поставщиком</span><span class="sxs-lookup"><span data-stu-id="75f1d-223">A product cannot be discontinued if it is the only product provided by the supplier</span></span>

<span data-ttu-id="75f1d-224">Классы BLL должны содержать проверки, обеспечивающие соблюдение бизнес-правил приложения.</span><span class="sxs-lookup"><span data-stu-id="75f1d-224">The BLL classes should contain checks to ensure adherence to the application's business rules.</span></span> <span data-ttu-id="75f1d-225">Эти проверки можно добавить непосредственно в методы, к которым они применяются.</span><span class="sxs-lookup"><span data-stu-id="75f1d-225">These checks can be added directly to the methods to which they apply.</span></span>

<span data-ttu-id="75f1d-226">Представьте себе, что наши бизнес-правила требуют, что продукт не может быть помечена неподдерживаемые Если это единственный продукт данного производителя.</span><span class="sxs-lookup"><span data-stu-id="75f1d-226">Imagine that our business rules dictate that a product could not be marked discontinued if it was the only product from a given supplier.</span></span> <span data-ttu-id="75f1d-227">То есть если продукта *X* единственный продукт, приобретавшимся у поставщика *Y*, нельзя помечать *X* как снятые с продажи; Если, тем не менее, поставщик *Y*поставлял три продукта, *объект*, *B*, и *C*, можно помечать любые и все их них как более не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="75f1d-227">That is, if product *X* was the only product we purchased from supplier *Y*, we could not mark *X* as discontinued; if, however, supplier *Y* supplied us with three products, *A*, *B*, and *C*, then we could mark any and all of these as discontinued.</span></span> <span data-ttu-id="75f1d-228">Странное бизнес-правило, но бизнес-правила и здравый смысл не всегда совпадают!</span><span class="sxs-lookup"><span data-stu-id="75f1d-228">An odd business rule, but business rules and common sense aren't always aligned!</span></span>

<span data-ttu-id="75f1d-229">Для принудительного применения этого бизнес-правила в `UpdateProducts` может начинаться с проверки, если метод `Discontinued` было присвоено `true` и, таким образом, мы вызовем `GetProductsBySupplierID` чтобы определить, сколько продуктов было приобретено у этого поставщика продуктов.</span><span class="sxs-lookup"><span data-stu-id="75f1d-229">To enforce this business rule in the `UpdateProducts` method we'd start by checking if `Discontinued` was set to `true` and, if so, we'd call `GetProductsBySupplierID` to determine how many products we purchased from this product's supplier.</span></span> <span data-ttu-id="75f1d-230">Если только один продукт приобретается у этого поставщика, мы выдаем `ApplicationException`.</span><span class="sxs-lookup"><span data-stu-id="75f1d-230">If only one product is purchased from this supplier, we throw an `ApplicationException`.</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample6.cs)]

## <a name="responding-to-validation-errors-in-the-presentation-tier"></a><span data-ttu-id="75f1d-231">Реакция на ошибки проверки в слое представления</span><span class="sxs-lookup"><span data-stu-id="75f1d-231">Responding to Validation Errors in the Presentation Tier</span></span>

<span data-ttu-id="75f1d-232">При обращении к BLL из слоя представления мы можно решить, следует ли пытаться обрабатывать все исключения, которые могут возникнуть, или позволить им обнаружиться ASP.NET (который создает событие `HttpApplication`в `Error` событий).</span><span class="sxs-lookup"><span data-stu-id="75f1d-232">When calling the BLL from the presentation tier we can decide whether to attempt to handle any exceptions that might be raised or let them bubble up to ASP.NET (which will raise the `HttpApplication`'s `Error` event).</span></span> <span data-ttu-id="75f1d-233">Для обработки исключения при работе со слоем BLL программно, мы используем [try... catch](https://msdn.microsoft.com/library/0yd65esw.aspx) блока, как показано в следующем примере:</span><span class="sxs-lookup"><span data-stu-id="75f1d-233">To handle an exception when working with the BLL programmatically, we can use a [try...catch](https://msdn.microsoft.com/library/0yd65esw.aspx) block, as the following example shows:</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample7.cs)]

<span data-ttu-id="75f1d-234">Как мы увидим в последующих учебных курсах, обработка исключений, которые поднимаются из BLL при использовании данных веб-элемент управления для вставки, обновления или удаления данных могут обрабатываться непосредственно в обработчике событий вместо необходимости включать код в `try...catch` блоков.</span><span class="sxs-lookup"><span data-stu-id="75f1d-234">As we'll see in future tutorials, handling exceptions that bubble up from the BLL when using a data Web control for inserting, updating, or deleting data can be handled directly in an event handler as opposed to having to wrap code in `try...catch` blocks.</span></span>

## <a name="summary"></a><span data-ttu-id="75f1d-235">Сводка</span><span class="sxs-lookup"><span data-stu-id="75f1d-235">Summary</span></span>

<span data-ttu-id="75f1d-236">Приложение с хорошо продуманной архитектурой состоит из различных слоев, каждый из которых заключена конкретная роль.</span><span class="sxs-lookup"><span data-stu-id="75f1d-236">A well architected application is crafted into distinct layers, each of which encapsulates a particular role.</span></span> <span data-ttu-id="75f1d-237">В первом руководстве этой серии статей мы создали слой доступа к данным, использование типизированных наборов DataSet; в этом руководстве мы создали слой бизнес-логики как ряд классов в нашем приложении `App_Code` вызов DAL папку.</span><span class="sxs-lookup"><span data-stu-id="75f1d-237">In the first tutorial of this article series we created a Data Access Layer using Typed DataSets; in this tutorial we built a Business Logic Layer as a series of classes in our application's `App_Code` folder that call down into our DAL.</span></span> <span data-ttu-id="75f1d-238">BLL реализует логику на уровне полей и бизнес уровня для нашего приложения.</span><span class="sxs-lookup"><span data-stu-id="75f1d-238">The BLL implements the field-level and business-level logic for our application.</span></span> <span data-ttu-id="75f1d-239">Кроме создания отдельного слоя BLL, как мы делали это в этом руководстве, другим вариантом является расширение методов элемента управления TableAdapter посредством использования частичных классов.</span><span class="sxs-lookup"><span data-stu-id="75f1d-239">In addition to creating a separate BLL, as we did in this tutorial, another option is to extend the TableAdapters' methods through the use of partial classes.</span></span> <span data-ttu-id="75f1d-240">Тем не менее при использовании этого метода позволяет переопределять существующие методы, ни разделять слои DAL и BLL так же четко, как подход, использованный в этой статье.</span><span class="sxs-lookup"><span data-stu-id="75f1d-240">However, using this technique does not allow us to override existing methods nor does it separate our DAL and our BLL as cleanly as the approach we've taken in this article.</span></span>

<span data-ttu-id="75f1d-241">DAL и BLL мы можем приступить к слоя представления.</span><span class="sxs-lookup"><span data-stu-id="75f1d-241">With the DAL and BLL complete, we're ready to start on our presentation layer.</span></span> <span data-ttu-id="75f1d-242">В [следующему руководству](master-pages-and-site-navigation-cs.md) мы ненадолго отвлечемся из статьи о доступе к данным и определения согласованного макета страницы для использования на протяжении всего руководства.</span><span class="sxs-lookup"><span data-stu-id="75f1d-242">In the [next tutorial](master-pages-and-site-navigation-cs.md) we'll take a brief detour from data access topics and define a consistent page layout for use throughout the tutorials.</span></span>

<span data-ttu-id="75f1d-243">Счастливого вам программирования!</span><span class="sxs-lookup"><span data-stu-id="75f1d-243">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="75f1d-244">Об авторе</span><span class="sxs-lookup"><span data-stu-id="75f1d-244">About the Author</span></span>

<span data-ttu-id="75f1d-245">[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи книг по ASP/ASP.NET и основатель веб- [4GuysFromRolla.com](http://www.4guysfromrolla.com), работает с веб-технологиями Microsoft с 1998 года.</span><span class="sxs-lookup"><span data-stu-id="75f1d-245">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="75f1d-246">Скотт — независимый консультант, преподаватель и автор.</span><span class="sxs-lookup"><span data-stu-id="75f1d-246">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="75f1d-247">Его последняя книга — [ *Sams Teach ASP.NET 2.0 in 24 часа*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="75f1d-247">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="75f1d-248">Ним можно связаться по адресу [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="75f1d-248">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="75f1d-249">или через его блог, который можно найти в [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="75f1d-249">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="75f1d-250">Особая благодарность</span><span class="sxs-lookup"><span data-stu-id="75f1d-250">Special Thanks To</span></span>

<span data-ttu-id="75f1d-251">В этой серии руководств пособий рецензировалась многими компетентными редакторами.</span><span class="sxs-lookup"><span data-stu-id="75f1d-251">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="75f1d-252">(Liz Shulok), Деннис Patterson, Карлос Сантос и (Hilton giesenow), стали Лиз Шалок в этом руководстве.</span><span class="sxs-lookup"><span data-stu-id="75f1d-252">Lead reviewers for this tutorial were Liz Shulok, Dennis Patterson, Carlos Santos, and Hilton Giesenow.</span></span> <span data-ttu-id="75f1d-253">Хотите поработать с моих последующих статей для MSDN?</span><span class="sxs-lookup"><span data-stu-id="75f1d-253">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="75f1d-254">Если Да, напишите мне [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="75f1d-254">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="75f1d-255">[Назад](creating-a-data-access-layer-cs.md)
> [Вперед](master-pages-and-site-navigation-cs.md)</span><span class="sxs-lookup"><span data-stu-id="75f1d-255">[Previous](creating-a-data-access-layer-cs.md)
[Next](master-pages-and-site-navigation-cs.md)</span></span>
