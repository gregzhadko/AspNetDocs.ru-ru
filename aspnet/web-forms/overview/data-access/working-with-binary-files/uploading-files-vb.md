---
uid: web-forms/overview/data-access/working-with-binary-files/uploading-files-vb
title: Отправка файлов (Visual Basic) | Документация Майкрософт
author: rick-anderson
description: Узнайте, как разрешить пользователям отправлять двоичные файлы (например, документы Word или PDF) на веб-сайт, где они могут храниться в файловой системе ни для сервера...
ms.author: riande
ms.date: 03/27/2007
ms.assetid: f7c00fbd-652c-433d-8ed3-0e5168a4d4df
msc.legacyurl: /web-forms/overview/data-access/working-with-binary-files/uploading-files-vb
msc.type: authoredcontent
ms.openlocfilehash: fdf7b351152d9c64b0ac4b1bc9d558962e704543
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/01/2019
ms.locfileid: "57033551"
---
<a name="uploading-files-vb"></a>Отправка файлов (VB)
====================
по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Скачайте пример приложения](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_54_VB.exe) или [скачать PDF](uploading-files-vb/_static/datatutorial54vb1.pdf)

> Узнайте, как разрешить пользователям отправлять двоичные файлы (например, документы Word или PDF) на веб-сайт, где они могут храниться в файловой системе сервера или базы данных.


## <a name="introduction"></a>Вступление

Все учебные мы ve проверяется в данный момент работали только с текстовыми данными. Тем не менее многие приложения имеют моделей данных, отображающие текст и двоичные данные. Узел online dating может разрешить пользователям передавать изображения, чтобы связать с профилем. Вербовки веб-сайт может позволить пользователям отправлять свои резюме как документ Microsoft Word или PDF.

Работа с двоичными данными добавляет новый набор проблем. Необходимо решить, как двоичные данные хранятся в приложении. Интерфейс, используемый для вставки новых записей должен обновляться, чтобы разрешить пользователю отправить файл с компьютера, и необходимо выполнить дополнительные действия для отображения или предоставляют средства для загрузки запись s связанными двоичными данными. В этом учебнике и трех последующих мы рассмотрим выделив эти проблемы. В конце этих учебниках мы будем создали полностью функциональное приложение, которое связывает изображений и брошюре формата PDF с каждой категорией. В этом руководстве определенного мы рассмотрели различные методы для хранения двоичных данных и о том, как разрешить пользователям необходимо отправить файл с компьютера, и сохранили его в файловой системе web server s.

> [!NOTE]
> Двоичные данные, который является частью модели данных приложения s иногда называется [BLOB-ОБЪЕКТОВ](http://en.wikipedia.org/wiki/Binary_large_object), аббревиатура для большого двоичного объекта. В этих учебниках я решил использовать терминология двоичные данные, несмотря на то, что термин BLOB-ОБЪЕКТОВ является синонимом.


## <a name="step-1-creating-the-working-with-binary-data-web-pages"></a>Шаг 1. Создание рабочего с двоичными данными веб-страниц

Прежде чем начать для изучения проблем, связанных с добавлением поддержки для двоичных данных, позволяют s уделим несколько минут созданию страниц ASP.NET в нашем проекте веб-сайта, что нам понадобится для изучения этого учебника и следующие три. Начните с добавления новой папки с именем `BinaryData`. Добавьте следующие страницы ASP.NET в этой папке, не забывая связывать каждую с `Site.master` главной страницы:

- `Default.aspx`
- `FileUpload.aspx`
- `DisplayOrDownloadData.aspx`
- `UploadInDetailsView.aspx`
- `UpdatingAndDeleting.aspx`


![Добавление страниц ASP.NET двоичные данные, связанные учебники](uploading-files-vb/_static/image1.gif)

**Рис. 1**: Добавление страниц ASP.NET двоичные данные, связанные учебники


Как и в других папках, `Default.aspx` в `BinaryData` папку перечислит учебные курсы в своем разделе. Помните, что `SectionLevelTutorialListing.ascx` пользовательский элемент управления предоставляет следующие функциональные возможности. Поэтому добавьте данный пользовательский элемент управления для `Default.aspx` , перетащив его из обозревателя решений на странице s режиме конструктора.


[![Добавление элемента управления Sectionleveltutoriallisting.ascx к странице Default.aspx](uploading-files-vb/_static/image2.gif)](uploading-files-vb/_static/image1.png)

**Рис. 2**: Добавить `SectionLevelTutorialListing.ascx` для пользовательского элемента управления `Default.aspx` ([Просмотр полноразмерного изображения](uploading-files-vb/_static/image2.png))


Наконец, добавьте эти страницы как записи для `Web.sitemap` файла. В частности, добавьте следующую разметку после увеличение GridView `<siteMapNode>`:


[!code-xml[Main](uploading-files-vb/samples/sample1.xml)]

После обновления `Web.sitemap`, Отвлекитесь и просмотрите учебный веб-узел в обозревателе. В меню слева теперь есть элементы для работы с учебниками двоичных данных.


![Карта узла теперь включают записи для работы с учебниками двоичных данных](uploading-files-vb/_static/image3.gif)

**Рис. 3**: Карта узла теперь включают записи для работы с учебниками двоичных данных


## <a name="step-2-deciding-where-to-store-the-binary-data"></a>Шаг 2. Выбор места для Store двоичные данные

Двоичные данные, связанные с моделью данных s приложения могут храниться в одном из двух мест: в файловой системе сервера s web со ссылкой на файл, хранящийся в базе данных; или непосредственно в самой базе данных (см. рис. 4). Каждый подход имеет свои достоинства и недостатки и заслуживает более подробное рассмотрение.


[![Двоичные данные могут храниться в файловой системе или непосредственно в базе данных](uploading-files-vb/_static/image4.gif)](uploading-files-vb/_static/image3.png)

**Рис. 4**: Двоичные данные могут храниться в файловой системе или непосредственно в базе данных ([Просмотр полноразмерного изображения](uploading-files-vb/_static/image4.png))


Представьте себе, что мы хотели бы расширить базы данных "Борей" должен быть сопоставлен изображение каждого продукта. Один из вариантов будет хранить эти файлы изображений в файловой системе web server s и запишите путь в `Products` таблицы. При таком подходе d добавим `ImagePath` столбец `Products` таблицы типа `varchar(200)`, возможно. При отправке пользователем рисунка для продукта Chai этот рисунок может храниться в файловой системе web server s в `~/Images/Tea.jpg`, где `~` представляет s физический путь к приложению. То есть если веб-сайт находится в физический путь к папке `C:\Websites\Northwind\`, `~/Images/Tea.jpg` равнозначно `C:\Websites\Northwind\Images\Tea.jpg`. После отправки файла образа, мы d обновить запись Chai в `Products` таблицы, чтобы его `ImagePath` путь нового образа, ссылки на столбец. Мы могли бы использовать `~/Images/Tea.jpg` или просто `Tea.jpg` Если мы решили, что все изображения товаров, будут добавлены в приложение s `Images` папки.

Ниже перечислены основные преимущества хранения двоичных данных в файловой системе.

- **Простота реализации** как скоро можно будет увидеть, хранение и извлечение двоичных данных, хранящиеся непосредственно в базе данных включает в себя немного больше кода, чем при работе с данными через файловую систему. Кроме того пользователю для просмотра или загрузки двоичных данных они должны согласиться с URL-адрес к этим данным. Если данные находятся в файловой системе web server s, URL-адрес достаточно прост. Если данные хранятся в базе данных, однако с веб-страницами необходимо создать, которые будут извлекать и возвращать данные из базы данных.
- **Широкий доступ к двоичным данным** двоичные данные могут должны быть доступны для других служб или приложений, тех, которые не удается извлечь данные из базы данных. Например, изображений, связанных с каждого продукта может также должны быть доступны пользователям через [FTP](http://en.wikipedia.org/wiki/File_Transfer_Protocol), в этом случае d необходимо хранить двоичные данные в файловой системе.
- **Производительность** если двоичные данные хранятся в файловой системе, перегрузки спроса и сети между сервером базы данных и веб-сервер будет меньше, чем если двоичные данные хранятся непосредственно в базе данных.

Хранение двоичных данных в файловой системе основной недостаток заключается в том, что он разделяет данные из базы данных. Если запись удалена из `Products` таблицы, связанный файл в файловой системе web server s не удаляется автоматически. Нам необходимо написать дополнительный код для удаления файла или файловой системы будет стать загроможденными неиспользуемые, потерянных файлов. Кроме того при резервном копировании базы данных, мы должны обязательно делать резервные копии связанных двоичных данных в файловой системе, а также. Перемещение базы данных на другой сайт или сервер создает аналогичные проблемы.

Кроме того, двоичные данные могут храниться непосредственно в базе данных Microsoft SQL Server 2005, создав для столбца типа `varbinary`. Как и с другими типами данных переменной длины, можно указать Максимальная длина двоичных данных, находящихся в этом столбце. Например, для резервирования не более 5 000 байтов использовать `varbinary(5000)`; `varbinary(MAX)` обеспечивает максимальный размер при хранении, около 2 ГБ.

Основное преимущество хранения двоичных данных непосредственно в базе данных является тесной связи между двоичные данные и запись в базе данных. Это значительно упрощает задачи администрирования базы данных, таких как резервное копирование или перемещение базы данных на другой сайт или сервер. Кроме того при удалении записи автоматически удаляет соответствующие двоичные данные. Существуют также дополнительные незначительные преимущества хранения двоичных данных в базе данных. См. в разделе [хранение двоичных файлов непосредственно в базе данных с помощью ASP.NET 2.0](http://aspnet.4guysfromrolla.com/articles/120606-1.aspx) более подробно рассмотреть.

> [!NOTE]
> В Microsoft SQL Server 2000 и более ранних версий `varbinary` тип данных имеет максимальное ограничение в 8 000 байт. Для хранения двоичных данных до 2 ГБ [ `image` тип данных](https://msdn.microsoft.com/library/ms187993.aspx) необходимо использовать вместо этого. С появлением `MAX` в SQL Server 2005, однако `image` тип данных является устаревшим. Он s по-прежнему поддерживается для обратной совместимости, но корпорация Майкрософт объявила, `image` тип данных будет исключена в будущей версии SQL Server.


Если вы работаете с более старая модель данных может появиться `image` тип данных. База данных "Борей" s `Categories` таблица имеет `Picture` столбец, который может использоваться для хранения двоичных данных файла изображения для категории. Так как в базе данных "Борей" впервые появилась в Microsoft Access и более ранних версиях SQL Server, этот столбец имеет тип `image`.

В этом учебнике и следующие три мы будем использовать оба подхода. `Categories` Таблице уже есть `Picture` столбец для хранения двоичного содержимого изображения для категории. Мы добавим дополнительный столбец, `BrochurePath`для хранения пути в PDF-файл в файловой системе web server s, чтобы представить Обзор качество печати, профессиональный категории можно использовать.

## <a name="step-3-adding-thebrochurepathcolumn-to-thecategoriestable"></a>Шаг 3. Добавление`BrochurePath`столбец`Categories`таблицы

В настоящее время в таблице категорий имеет только четыре столбца: `CategoryID`, `CategoryName`, `Description`, и `Picture`. Помимо этих полей необходимо добавить новый, который будет указывать брошюры категории s (если он существует). Чтобы добавить этот столбец, перейдите в проводник по серверам, детализировать таблиц, щелкните правой кнопкой мыши `Categories` таблицы и выберите Открыть определение таблицы (см. рис. 5). Если вы не видите обозреватель серверов, открыть его, выбрав параметр Server Explorer из меню "Вид" или нажмите сочетание клавиш Ctrl + Alt + S.

Добавьте новый `varchar(200)` столбец `Categories` таблицу с именем `BrochurePath` и позволяет `NULL` s и щелкните значок "Сохранить" (или нажмите сочетание клавиш Ctrl + S).


[![Добавить столбец BrochurePath в таблицу Categories](uploading-files-vb/_static/image5.gif)](uploading-files-vb/_static/image5.png)

**Рис. 5**: Добавить `BrochurePath` столбец `Categories` таблицы ([Просмотр полноразмерного изображения](uploading-files-vb/_static/image6.png))


## <a name="step-4-updating-the-architecture-to-use-thepictureandbrochurepathcolumns"></a>Шаг 4. Обновление для использования архитектуры`Picture`и`BrochurePath`столбцов

`CategoriesDataTable` В слой доступа к данным (DAL) в настоящее время имеет четыре `DataColumn` s определен: `CategoryID`, `CategoryName`, `Description`, и `NumberOfProducts`. Когда мы изначально разработано этому объекту DataTable в [создание уровня доступа к данным](../introduction/creating-a-data-access-layer-vb.md) руководстве `CategoriesDataTable` составляла только первые три столбца; `NumberOfProducts` столбец был добавлен в [«основной/подробности» с помощью маркированный Список основных записей с элементом управления DataList сведения](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-vb.md) руководства.

Как уже говорилось в *создание уровня доступа к данным*, DataTables в типизированном наборе DataSet составляющих бизнес-объектов. TableAdapters отвечают за взаимодействие с базой данных и заполнения бизнес-объектов с результатами запроса. `CategoriesDataTable` Заполняется `CategoriesTableAdapter`, который имеет три метода извлечения данных:

- `GetCategories()` выполняет s основного запроса адаптера таблицы и возвращает `CategoryID`, `CategoryName`, и `Description` поля всех записей в `Categories` таблицы. Основной запрос — используемые ресурсы, автоматически созданные `Insert` и `Update` методы.
- `GetCategoryByCategoryID(categoryID)` Возвращает `CategoryID`, `CategoryName`, и `Description` поля категории которого `CategoryID` равно *categoryID*.
- `GetCategoriesAndNumberOfProducts()` — Возвращает `CategoryID`, `CategoryName`, и `Description` поля для всех записей в `Categories` таблицы. Также используется вложенный запрос для возврата количества продуктов, связанных с каждой категорией.

Обратите внимание на то, что ни один из этих возвращаемых запросами `Categories` таблицы s `Picture` или `BrochurePath` столбцы; и не `CategoriesDataTable` предоставляют `DataColumn` s для этих полей. Для работы с изображением и `BrochurePath` свойства, необходимо предварительно добавить их в `CategoriesDataTable` и обновите `CategoriesTableAdapter` класса, чтобы возвращать значения этих столбцов.

## <a name="adding-thepictureandbrochurepathdatacolumn-s"></a>Добавление`Picture`и`BrochurePath``DataColumn` s

Начните с добавления этих двух столбцов, чтобы `CategoriesDataTable`. Щелкните правой кнопкой мыши `CategoriesDataTable` s заголовок, выберите в контекстном меню Add, а затем выберите параметр столбец. Это создаст новый `DataColumn` таблицы данных с именем `Column1`. Переименуйте этот столбец в `Picture`. В окне «Свойства» задайте `DataColumn` s `DataType` свойства `System.Byte[]` (это не вариант в раскрывающемся списке, вам нужно ввести его в).


[![Создание рисунка DataColumn с именем, типом данных является System.Byte[]](uploading-files-vb/_static/image6.gif)](uploading-files-vb/_static/image7.png)

**Рис. 6**: Создание `DataColumn` именованные `Picture` которого `DataType` — `System.Byte[]` ([Просмотр полноразмерного изображения](uploading-files-vb/_static/image8.png))


Добавьте еще один `DataColumn` к таблице DataTable, назовите его `BrochurePath` по умолчанию `DataType` значение (`System.String`).

## <a name="returning-thepictureandbrochurepathvalues-from-the-tableadapter"></a>Возвращение`Picture`и`BrochurePath`значения из TableAdapter

С помощью этих двух `DataColumn` добавленными к `CategoriesDataTable`, мы будет готов для обновления `CategoriesTableAdapter`. Мы может иметь оба этих значения столбцов, возвращаемых в основном запросе адаптера таблицы, но это будет вернуть двоичные данные каждый раз `GetCategories()` метод был вызван. Let s обновляете основного запроса адаптера таблицы, чтобы вернуть `BrochurePath` и создается метод получения дополнительных данных, который возвращает определенной категории s `Picture` столбца.

Чтобы обновить основной запрос адаптера таблицы, щелкните правой кнопкой мыши `CategoriesTableAdapter` s заголовка и выберите настройку в контекстном меню. Откроется мастер настройки адаптера таблицы, которые мы ve в число предыдущих учебных курсах. Обновить запрос, чтобы вернуть `BrochurePath` и нажмите кнопку Готово.


[![Обновление списка столбцов в инструкции SELECT инструкции также вернет значение BrochurePath](uploading-files-vb/_static/image7.gif)](uploading-files-vb/_static/image9.png)

**Рис. 7**: Обновление списка столбцов в `SELECT` инструкция также возвращает `BrochurePath` ([Просмотр полноразмерного изображения](uploading-files-vb/_static/image10.png))


При использовании специализированные инструкции SQL для TableAdapter, обновление списка столбцов в основном запросе обновляет список столбцов для всех `SELECT` методов запросов в адаптер таблицы. Это означает `GetCategoryByCategoryID(categoryID)` метод был обновлен для возврата `BrochurePath` столбец, который может быть, мы планировали. Однако он также обновляется список столбцов в `GetCategoriesAndNumberOfProducts()` метод, удалить вложенный запрос, возвращающий количество продуктов для каждой категории! Таким образом, необходимо обновить этот метод s `SELECT` запроса. Щелкните правой кнопкой мыши `GetCategoriesAndNumberOfProducts()` метод, выбрать Настройка и восстановить `SELECT` запрос обратно в исходное значение:


[!code-sql[Main](uploading-files-vb/samples/sample2.sql)]

Создайте новый метод TableAdapter, который возвращает определенной категории s `Picture` значение столбца. Щелкните правой кнопкой мыши `CategoriesTableAdapter` s заголовка и выберите пункт Добавить запрос, чтобы запустить мастер настройки запроса адаптера таблицы. На первом шаге работы этот мастер спрашивает нас, если мы хотим выполнить запрос данных с помощью инструкции SQL ad-hoc, новая хранимая процедура, уже существующий. Выберите использовать инструкции SQL и нажмите кнопку Далее. Поскольку мы будет возвращать строку, выберите SELECT, которая возвращает параметр строки из второй шаг.


[![Выберите параметр использовать SQL-инструкции](uploading-files-vb/_static/image8.gif)](uploading-files-vb/_static/image11.png)

**Рис. 8**: Выберите инструкции SQL используйте параметр ([Просмотр полноразмерного изображения](uploading-files-vb/_static/image12.png))


[![Так как запрос вернет записи из таблицы Categories, выбор SELECT, возвращающая строки](uploading-files-vb/_static/image9.gif)](uploading-files-vb/_static/image13.png)

**Рис. 9**: Так как запрос вернет записи из таблицы Categories, выберите выбрать, какие возвращает строки ([Просмотр полноразмерного изображения](uploading-files-vb/_static/image14.png))


На третьем шаге введите следующий SQL-запрос и нажмите кнопку Далее.


[!code-sql[Main](uploading-files-vb/samples/sample3.sql)]

Последним шагом является для выбора имени нового метода. Используйте `FillCategoryWithBinaryDataByCategoryID` и `GetCategoryWithBinaryDataByCategoryID` для заполнения таблицы данных и возвращают объект DataTable шаблоны, соответственно. Нажмите кнопку Готово, чтобы завершить работу мастера.


[![Выберите имена для методов класса TableAdapter s](uploading-files-vb/_static/image10.gif)](uploading-files-vb/_static/image15.png)

**Рис. 10**: Выберите имена для адаптера таблицы s методы ([Просмотр полноразмерного изображения](uploading-files-vb/_static/image16.png))


> [!NOTE]
> После завершения работы мастера настройки запроса адаптера таблицы может появиться диалоговое окно, информирующее о том, что новый текст команды возвращает данные с помощью схемы отличается от схемы основного запроса. Короче говоря, мастер отметить, что основного запроса адаптера таблицы s `GetCategories()` возвращает другую схему, отличного от того, мы только что создали. Но это мы хотим, чтобы это сообщение можно пропустить.


Кроме того, следует помнить, что если вы используете специализированные инструкции SQL и использовать мастер для изменения основного запроса адаптера таблицы s через некоторое время, он будет изменять `GetCategoryWithBinaryDataByCategoryID` метод s `SELECT` инструкцию s список столбцов, чтобы включить только те столбцы из основной запрос (то есть он удалит `Picture` столбца из запроса). Необходимо будет вручную обновить список столбцов, чтобы вернуть `Picture` столбца, как мы сделали с `GetCategoriesAndNumberOfProducts()` метод ранее на этом шаге.

После добавления двух `DataColumn` s, чтобы `CategoriesDataTable` и `GetCategoryWithBinaryDataByCategoryID` метод `CategoriesTableAdapter`, эти классы в конструкторе типизированных наборов данных должен выглядеть как на снимке экрана, на рис. 11.


![Конструктор DataSet входят новые столбцы и метод](uploading-files-vb/_static/image11.gif)

**Рис. 11**: Конструктор DataSet входят новые столбцы и метод


## <a name="updating-the-business-logic-layer-bll"></a>Обновление уровня бизнес-логики (BLL)

С помощью обновления DAL, остается лишь для дополнения для включения метода для нового слоя бизнес-логики (BLL) `CategoriesTableAdapter` метод. Добавьте следующий метод в `CategoriesBLL` класса:


[!code-vb[Main](uploading-files-vb/samples/sample4.vb)]

## <a name="step-5-uploading-a-file-from-the-client-to-the-web-server"></a>Шаг 5. Отправка файла от клиента на веб-сервер

Если сбор двоичных данных, очень часто эти данные передаются конечным пользователем. Для сохранения этих данных, пользователь должен иметь возможность отправить файл с компьютера, на веб-сервер. Переданные данные необходимо интегрировать с моделью данных, которая может означать, что сохранение файла web server s файловой системы и добавление пути к файлу базы данных или написания двоичное содержимое непосредственно в базу данных. На этом шаге мы рассмотрим том, как разрешить пользователю загружать файлы с компьютера на сервере. В следующем учебном курсе мы обратим наше внимание интеграции загруженный файл с моделью данных.

ASP.NET 2.0 новых [FileUpload веб-элемента управления](https://msdn.microsoft.com/library/ms227677(VS.80).aspx) предоставляет механизм для пользователей отправить файл с компьютера на веб-сервер. Выполняет визуализацию элемента управления FileUpload в виде `<input>` элемент которого `type` атрибуту присваивается файл, который браузеры отображают как текстовое поле с кнопкой "Обзор". Нажав кнопку обзора, появится диалоговое окно, из которого пользователь может выбрать файл. Когда форма передается обратно, содержимое выбранного файла s отправляются вместе с обратной передачи. На стороне сервера сведения о отправленный файл доступен через s свойства элемента управления FileUpload.

Для демонстрации отправки файлов, откройте `FileUpload.aspx` странице в `BinaryData` папки, перетащите элемент управления FileUpload из инструментария в конструктор и задать элемент управления s `ID` свойства `UploadTest`. Затем добавьте кнопку веб-элемент управления параметр его `ID` и `Text` свойства `UploadButton` и отправьте файл выбранные соответственно. Наконец, поместите элемент управления Label Web под кнопкой, очистите его `Text` и установите его `ID` свойства `UploadDetails`.


[![Добавление элемента управления FileUpload страницы ASP.NET](uploading-files-vb/_static/image12.gif)](uploading-files-vb/_static/image17.png)

**Рис. 12**: Добавление элемента управления FileUpload страницы ASP.NET ([Просмотр полноразмерного изображения](uploading-files-vb/_static/image18.png))


Рис. 13 показана эта страница при просмотре через браузер. Обратите внимание, что нажатие кнопки обзора можно открыть диалоговое окно выбора файла, позволяя пользователю выбрать файл со своего компьютера. После выбора файла нажмите кнопку Отправить выбранный файл вызывает обратную передачу, отправляет двоичное содержимое s выбранный файл веб-сервер.


[![Пользователь может выбрать файл для передачи со своего компьютера к серверу](uploading-files-vb/_static/image13.gif)](uploading-files-vb/_static/image19.png)

**Рис. 13**: Пользователь может выбрать файл для передачи со своего компьютера к серверу ([Просмотр полноразмерного изображения](uploading-files-vb/_static/image20.png))


При обратной передаче можно сохранить загруженный файл в файловой системе или двоичные данные можно работать напрямую с помощью Stream. Например, позволяют создать s `~/Brochures` папку и сохранить отправленный файл существует. Начните с добавления `Brochures` папку к сайту как вложенную папку корневой папки. Создайте обработчик событий для `UploadButton` s `Click` событий и добавьте следующий код:


[!code-vb[Main](uploading-files-vb/samples/sample5.vb)]

Элемента управления FileUpload предоставляет широкий набор свойств для работы с загруженные данные. Например [ `HasFile` свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload.hasfile.aspx) указывает, передаются ли файл пользователем, хотя [ `FileBytes` свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload.filebytes.aspx) предоставляет доступ к отправленного двоичных данных как массив байтов. `Click` Запускает обработчик событий, гарантируя, что файл отправлен. Если файл был загружен, метка отображает имя отправленного файла, его размер в байтах и типа содержимого.

> [!NOTE]
> Чтобы убедиться, что пользователь отправляет файл, вы можете проверить `HasFile` свойства и отображается предупреждение, если он s `False`, или вы можете использовать [управления RequiredFieldValidator](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/validation/default.aspx) вместо этого.


FileUpload s `SaveAs(filePath)` сохраняет переданный файл в указанном *filePath*. *filePath* должно быть *физический путь* (`C:\Websites\Brochures\SomeFile.pdf`), а не *виртуального* *путь* (`/Brochures/SomeFile.pdf`). [ `Server.MapPath(virtPath)` Метод](https://msdn.microsoft.com/library/system.web.httpserverutility.mappath.aspx) использует виртуальный путь и возвращает его соответствующий физический путь. Здесь — виртуальный путь `~/Brochures/fileName`, где *fileName* имя отправленного файла. См. в разделе [используя Server.MapPath](http://www.4guysfromrolla.com/webtech/121799-1.shtml) узнать больше о виртуального и физического пути и с помощью `Server.MapPath`.

После завершения `Click` обработчик событий, пора протестировать страницу в браузере. Нажмите кнопку обзора и выберите файл с жесткого диска и нажмите кнопку Отправить выбранный файл. Обратная передача будет отправлять содержимое выбранного файла на веб-сервер, который затем будет отображать сведения о файле, прежде чем сохранить его для `~/Brochures` папки. После отправки файла, вернитесь в Visual Studio, а затем нажмите кнопку "Обновить" в обозревателе решений. Вы увидите файл, загруженный в папке ~/Brochures!


[![Файл EvolutionValley.jpg будут переданы на веб-сервер](uploading-files-vb/_static/image14.gif)](uploading-files-vb/_static/image21.png)

**Рис. 14**: Файл `EvolutionValley.jpg` будут переданы на веб-сервер ([Просмотр полноразмерного изображения](uploading-files-vb/_static/image22.png))


![EvolutionValley.jpg была сохранена в папке ~/Brochures](uploading-files-vb/_static/image15.gif)

**Рис. 15**: `EvolutionValley.jpg` Было сохранено в `~/Brochures` папки


## <a name="subtleties-with-saving-uploaded-files-to-the-file-system"></a>Тонкости с сохранением переданные файлы в файловой системе

Есть несколько тонкостей, которые должны учитываться при сохранении, передача файлов в файловой системе web server s. Во-первых, здесь s проблему безопасности. Чтобы сохранить файл в файловой системе, контекст безопасности, в котором выполняется на странице ASP.NET необходимо обладать разрешением. Веб-сервера разработки ASP.NET выполняется в контексте текущей учетной записи пользователя. При использовании s Microsoft Internet Information Services (IIS) веб-сервер, контекст безопасности зависит от версии IIS и его конфигурации.

Еще одна проблема сохранения файлов в файловой системе вращается вокруг именовании файлов. В настоящее время нашей странице сохраняет все загруженные файлы для `~/Brochures` каталог с тем же именем, что и файл на компьютере клиента s. Если пользователь А отправляет буклета с именем `Brochure.pdf`, файл будет сохранен как `~/Brochure/Brochure.pdf`. Но что делать, если когда-нибудь более поздней версии пользователь Б передает файл разных буклет с тем же именем файла (`Brochure.pdf`)? С помощью кода у нас есть теперь пользователя s-файл будет перезаписан с передачей s пользователь Б.

Существует несколько способов для разрешения конфликтов имен файлов. Один из вариантов — запретить, отправив файл в том случае, если уже существует с тем же именем. При таком подходе, когда пользователь Б пытается отправить файл с именем `Brochure.pdf`, система может не сохранить их в файл и выведет сообщение о том, пользователь Б, переименуйте файл и повторите попытку. Другой подход заключается в сохранить файл, используя уникальное имя файла, который может быть [глобальный уникальный идентификатор (GUID)](http://en.wikipedia.org/wiki/Globally_Unique_Identifier) или значение из соответствующего базе данных столбцы первичного ключа записи s (предполагая, что передача связан с отдельную строку в модели данных). В следующем учебном курсе мы рассмотрим эти параметры более подробно.

## <a name="challenges-involved-with-very-large-amounts-of-binary-data"></a>Трудностей, связанных с очень больших объемов двоичных данных

В этих учебниках предполагается, что двоичные данные скромные размеры. Работа с очень большим объемам двоичных данных файлов, которые являются несколько мегабайт или больше создает новые проблемы, которые выходят за рамки данных учебных курсов. Например, по умолчанию ASP.NET будет отклонять передач превышает 4 МБ, несмотря на то, что это можно настроить с помощью [ `<httpRuntime>` элемент](https://msdn.microsoft.com/library/e1f13641.aspx) в `Web.config`. IIS слишком налагает собственные ограничения размера файла отправки. См. в разделе [размера передаваемого файла IIS](http://vandamme.typepad.com/development/2005/09/iis_upload_file.html) Дополнительные сведения. Кроме того время, необходимое для передачи больших файлов может превышать значение по умолчанию 110 секунд ожидания ASP.NET для запроса. Кроме того, существуют также памятью и производительностью проблемы, возникающие при работе с большими файлами.

Элемента управления FileUpload непрактично для передачи больших файлов. Как содержимое файла s передаются на сервер, конечному пользователю необходимо терпеливо ожидания без подтверждения, выполняет их отправки. Это не так много проблема, при работе с файлами, которые могут быть отправлены в несколько секунд, но может быть проблема, при работе с большими файлами, которые может потребоваться минут для отправки. Существует множество сторонних файла загрузки элементов управления, которые лучше подходят для обработки больших объемов и многие из этих поставщиков предоставляют индикаторы хода выполнения и ActiveX передачи диспетчеры, гораздо более великолепные условия работы пользователей.

Если приложению для обработки больших файлов, необходимо тщательно исследовать проблемы и найти подходящего решения для конкретных потребностей.

## <a name="summary"></a>Сводка

Построение приложения, которое нужно зафиксировать двоичных данных представляет ряд проблем. В этом руководстве мы изучили первые два: выборе места для хранения двоичных данных и дает пользователям возможность отправить двоичное содержимое через веб-страницы. На трех следующих руководствах мы увидим, как связать передаваемые данные с помощью записи в базе данных, а также отображение двоичных данных вместе с его текстовые поля данных.

Счастливого вам программирования!

## <a name="further-reading"></a>Дополнительные сведения

Дополнительные сведения по темам, обсуждавшимся в этом руководстве см. в следующих ресурсах:

- [Использование типов данных больших значений](https://msdn.microsoft.com/library/ms178158.aspx)
- [Примеры использования элемента управления fileUpload](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/standard/fileupload.aspx)
- [Серверный элемент управления ASP.NET 2.0 FileUpload](http://www.wrox.com/WileyCDA/Section/id-292158.html)
- [Оборотная сторона передаваемых файлов](http://www.aspnetresources.com/articles/dark_side_of_file_uploads.aspx)

## <a name="about-the-author"></a>Об авторе

[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи книг по ASP/ASP.NET и основатель веб- [4GuysFromRolla.com](http://www.4guysfromrolla.com), работает с веб-технологиями Microsoft с 1998 года. Скотт — независимый консультант, преподаватель и автор. Его последняя книга — [ *Sams Teach ASP.NET 2.0 in 24 часа*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco). Ним можно связаться по адресу [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) или через его блог, который можно найти в [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).

## <a name="special-thanks-to"></a>Особая благодарность

В этой серии руководств пособий рецензировалась многими компетентными редакторами. Терезой Мерфи и Екатерина Leigh, стали Лиз Шалок в этом руководстве. Хотите поработать с моих последующих статей для MSDN? Если Да, напишите мне [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)

> [!div class="step-by-step"]
> [Назад](updating-and-deleting-existing-binary-data-cs.md)
> [Вперед](displaying-binary-data-in-the-data-web-controls-vb.md)
