---
uid: web-forms/overview/data-access/working-with-binary-files/displaying-binary-data-in-the-data-web-controls-vb
title: Отображение двоичных данных в веб-данных управляет (Visual Basic) | Документация Майкрософт
author: rick-anderson
description: В этом руководстве мы рассмотрим параметры для представления двоичных данных на веб-странице, включая отображение файла изображения и предоставление f ссылку «Скачать»...
ms.author: riande
ms.date: 03/27/2007
ms.assetid: 9201656a-e1c2-4020-824b-18fb632d2925
msc.legacyurl: /web-forms/overview/data-access/working-with-binary-files/displaying-binary-data-in-the-data-web-controls-vb
msc.type: authoredcontent
ms.openlocfilehash: 19c377e0f0cd9b27ac7c05af0ab050d8e213fe69
ms.sourcegitcommit: 289e051cc8a90e8f7127e239fda73047bde4de12
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/25/2019
ms.locfileid: "58424655"
---
<a name="displaying-binary-data-in-the-data-web-controls-vb"></a><span data-ttu-id="43bc8-103">Отображение двоичных данных в веб-элементах управления данными (VB)</span><span class="sxs-lookup"><span data-stu-id="43bc8-103">Displaying Binary Data in the Data Web Controls (VB)</span></span>
====================
<span data-ttu-id="43bc8-104">по [Скотт Митчелл](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="43bc8-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="43bc8-105">[Скачайте пример приложения](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_55_VB.exe) или [скачать PDF](displaying-binary-data-in-the-data-web-controls-vb/_static/datatutorial55vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="43bc8-105">[Download Sample App](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_55_VB.exe) or [Download PDF](displaying-binary-data-in-the-data-web-controls-vb/_static/datatutorial55vb1.pdf)</span></span>

> <span data-ttu-id="43bc8-106">В этом руководстве мы рассмотрим параметры для представления двоичных данных на веб-странице, включая отображение файла изображения и предоставление ссылку «Скачать» для PDF-файла.</span><span class="sxs-lookup"><span data-stu-id="43bc8-106">In this tutorial we look at the options to present binary data on a Web page, including the display of an image file and the provision of a 'Download' link for a PDF file.</span></span>


## <a name="introduction"></a><span data-ttu-id="43bc8-107">Вступление</span><span class="sxs-lookup"><span data-stu-id="43bc8-107">Introduction</span></span>

<span data-ttu-id="43bc8-108">В предыдущем учебном курсе мы изучили два различных способа для двоичных данных, связанной с s приложения базовую модель данных и позволяет передать файлы из браузера в файловой системе web server s элемента управления FileUpload.</span><span class="sxs-lookup"><span data-stu-id="43bc8-108">In the preceding tutorial we explored the two techniques for associating binary data with an application s underlying data model and used the FileUpload control to upload files from a browser to the web server s file system.</span></span> <span data-ttu-id="43bc8-109">Мы ve еще для того, чтобы узнать, как должен быть сопоставлен отправленного двоичные данные в модель данных.</span><span class="sxs-lookup"><span data-stu-id="43bc8-109">We ve yet to see how to associate the uploaded binary data with the data model.</span></span> <span data-ttu-id="43bc8-110">То есть после передачи файла и сохранен в файловой системе, путь к файлу должен храниться в соответствующей базе данных записи.</span><span class="sxs-lookup"><span data-stu-id="43bc8-110">That is, after a file has been uploaded and saved to the file system, a path to the file must be stored in the appropriate database record.</span></span> <span data-ttu-id="43bc8-111">Если данные хранятся непосредственно в базе данных, отправленных двоичных данных нет необходимости сохранять в файловой системе, но необходимо вставлять события в базу данных.</span><span class="sxs-lookup"><span data-stu-id="43bc8-111">If the data is being stored directly in the database, then the uploaded binary data need not be saved to the file system, but must be injected into the database.</span></span>

<span data-ttu-id="43bc8-112">Прежде чем мы рассмотрим связь данных с моделью данных, однако позволяют s сначала посмотрим, как обеспечить двоичные данные для конечного пользователя.</span><span class="sxs-lookup"><span data-stu-id="43bc8-112">Before we look at associating the data with the data model, though, let s first look at how to provide the binary data to the end user.</span></span> <span data-ttu-id="43bc8-113">Представления текстовых данных является достаточно простым, но следует двоичные данные представления?</span><span class="sxs-lookup"><span data-stu-id="43bc8-113">Presenting text data is simple enough, but how should binary data be presented?</span></span> <span data-ttu-id="43bc8-114">Он зависит, само собой, тип двоичных данных.</span><span class="sxs-lookup"><span data-stu-id="43bc8-114">It depends, of course, on the type of binary data.</span></span> <span data-ttu-id="43bc8-115">Для образов скорее всего нужно вывести на изображения. для файлов PDF документы Microsoft Word, ZIP-файлы и другие виды двоичных данных, предоставляя ссылку для скачивания, вероятно, более подходящим.</span><span class="sxs-lookup"><span data-stu-id="43bc8-115">For images, we likely want to display the image; for PDFs, Microsoft Word documents, ZIP files, and other types of binary data, providing a Download link is probably more appropriate.</span></span>

<span data-ttu-id="43bc8-116">В этом учебном курсе мы рассмотрим способ представления двоичных данных вместе с его данными связанный текст, с помощью данных веб-элементов управления GridView и DetailsView.</span><span class="sxs-lookup"><span data-stu-id="43bc8-116">In this tutorial we will look at how to present the binary data alongside its associated text data using data Web controls like the GridView and DetailsView.</span></span> <span data-ttu-id="43bc8-117">В следующем учебном курсе мы обратим наше внимание сопоставления файлов, отправляемых с базой данных.</span><span class="sxs-lookup"><span data-stu-id="43bc8-117">In the next tutorial we'll turn our attention to associating an uploaded file with the database.</span></span>

## <a name="step-1-providingbrochurepathvalues"></a><span data-ttu-id="43bc8-118">Шаг 1. Предоставляя`BrochurePath`значения</span><span class="sxs-lookup"><span data-stu-id="43bc8-118">Step 1: Providing`BrochurePath`Values</span></span>

<span data-ttu-id="43bc8-119">`Picture` Столбца в `Categories` таблица уже содержит двоичные данные для различных категорий изображений.</span><span class="sxs-lookup"><span data-stu-id="43bc8-119">The `Picture` column in the `Categories` table already contains binary data for the various category images.</span></span> <span data-ttu-id="43bc8-120">В частности `Picture` столбец для каждой записи содержит двоичное содержимое повышенную зернистость, низкого качества, 16 цветов точечного рисунка.</span><span class="sxs-lookup"><span data-stu-id="43bc8-120">Specifically, the `Picture` column for each record holds the binary contents of a grainy, low-quality, 16-color bitmap image.</span></span> <span data-ttu-id="43bc8-121">Каждый образ категории — 172 пикселей в ширину и 120 пикселей и занимает приблизительно 11 КБ.</span><span class="sxs-lookup"><span data-stu-id="43bc8-121">Each category image is 172 pixels wide and 120 pixels tall and consumes roughly 11 KB.</span></span> <span data-ttu-id="43bc8-122">Какие дополнительные s, двоичное содержимое в `Picture` столбца включает в себя 78 байтов [OLE](http://en.wikipedia.org/wiki/Object_Linking_and_Embedding) заголовок, который должен быть удалены перед отображением изображения.</span><span class="sxs-lookup"><span data-stu-id="43bc8-122">What s more, the binary content in the `Picture` column includes a 78-byte [OLE](http://en.wikipedia.org/wiki/Object_Linking_and_Embedding) header that must be stripped before displaying the image.</span></span> <span data-ttu-id="43bc8-123">Эта информация заголовка присутствует, так как в базе данных "Борей" впервые появилась в Microsoft Access.</span><span class="sxs-lookup"><span data-stu-id="43bc8-123">This header information is present because the Northwind database has its roots in Microsoft Access.</span></span> <span data-ttu-id="43bc8-124">В режиме доступа двоичных данных хранится с использованием тип данных объекта OLE, который добавляет к на этот заголовок.</span><span class="sxs-lookup"><span data-stu-id="43bc8-124">In Access, binary data is stored using the OLE Object data type, which tacks on this header.</span></span> <span data-ttu-id="43bc8-125">Сейчас узнаете, как удалить заголовки из эти изображения для отображения на рисунке.</span><span class="sxs-lookup"><span data-stu-id="43bc8-125">For now, we'll see how to strip the headers from these low-quality images in order to display the picture.</span></span> <span data-ttu-id="43bc8-126">В следующем учебном курсе мы создадим интерфейс для обновления категории s `Picture` столбца и заменить эти точечных рисунков, которые используют заголовки OLE с эквивалентное изображения JPG без ненужных заголовки OLE.</span><span class="sxs-lookup"><span data-stu-id="43bc8-126">In a future tutorial we'll build an interface for updating a category s `Picture` column and replace these bitmap images that use OLE headers with equivalent JPG images without the unnecessary OLE headers.</span></span>

<span data-ttu-id="43bc8-127">В предыдущем учебном курсе мы рассмотрели использование элемента управления FileUpload.</span><span class="sxs-lookup"><span data-stu-id="43bc8-127">In the preceding tutorial we saw how to use the FileUpload control.</span></span> <span data-ttu-id="43bc8-128">Таким образом можно пойти дальше и добавить буклет файлы в файловой системе web server s.</span><span class="sxs-lookup"><span data-stu-id="43bc8-128">Therefore, you can go ahead and add brochure files to the web server s file system.</span></span> <span data-ttu-id="43bc8-129">Таким образом, однако не обновляет `BrochurePath` столбца в `Categories` таблицы.</span><span class="sxs-lookup"><span data-stu-id="43bc8-129">Doing so, however, does not update the `BrochurePath` column in the `Categories` table.</span></span> <span data-ttu-id="43bc8-130">В следующем учебном курсе мы рассмотрим, как выполнить эту задачу, но сейчас нам нужно вручную указать значения для этого столбца.</span><span class="sxs-lookup"><span data-stu-id="43bc8-130">In the next tutorial we'll see how to accomplish this, but for now we need to manually provide values for this column.</span></span>

<span data-ttu-id="43bc8-131">В этом учебнике s вы найдете семь файлов PDF буклет в `~/Brochures` папки, по одному для каждой из категорий, за исключением морепродуктов.</span><span class="sxs-lookup"><span data-stu-id="43bc8-131">In this tutorial s download you'll find seven PDF brochure files in the `~/Brochures` folder, one for each of the categories except Seafood.</span></span> <span data-ttu-id="43bc8-132">Я намеренно опущен, добавление буклета Морепродукты Демонстрация обработки сценариев, где не все записи связаны двоичных данных.</span><span class="sxs-lookup"><span data-stu-id="43bc8-132">I purposefully omitted adding a Seafood brochure to illustrate how to handle scenarios where not all records have associated binary data.</span></span> <span data-ttu-id="43bc8-133">Чтобы обновить `Categories` таблица со следующими значениями, щелкните правой кнопкой мыши `Categories` узла из обозревателя сервера и выберите Показать таблицу данных.</span><span class="sxs-lookup"><span data-stu-id="43bc8-133">To update the `Categories` table with these values, right-click on the `Categories` node from Server Explorer and choose Show Table Data.</span></span> <span data-ttu-id="43bc8-134">Затем введите виртуальные пути к файлам буклет для каждой категории, имеющий буклета, как показано на рис. 1.</span><span class="sxs-lookup"><span data-stu-id="43bc8-134">Then, enter the virtual paths to the brochure files for each category that has a brochure, as Figure 1 shows.</span></span> <span data-ttu-id="43bc8-135">Так как не буклет для категории морепродуктов, оставьте его `BrochurePath` значение столбца s в виде `NULL`.</span><span class="sxs-lookup"><span data-stu-id="43bc8-135">Since there is no brochure for the Seafood category, leave its `BrochurePath` column s value as `NULL`.</span></span>


<span data-ttu-id="43bc8-136">[![Вручную введите значения в столбце категорий таблицы s BrochurePath](displaying-binary-data-in-the-data-web-controls-vb/_static/image1.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="43bc8-136">[![Manually Enter the Values for the Categories Table s BrochurePath Column](displaying-binary-data-in-the-data-web-controls-vb/_static/image1.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image1.png)</span></span>

<span data-ttu-id="43bc8-137">**Рис. 1**: Вручную введите значения для `Categories` таблицы s `BrochurePath` столбца ([Просмотр полноразмерного изображения](displaying-binary-data-in-the-data-web-controls-vb/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="43bc8-137">**Figure 1**: Manually Enter the Values for the `Categories` Table s `BrochurePath` Column ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-vb/_static/image2.png))</span></span>


## <a name="step-2-providing-a-download-link-for-the-brochures-in-a-gridview"></a><span data-ttu-id="43bc8-138">Шаг 2. Предоставляя ссылку для скачивания для брошюр в элементе управления GridView</span><span class="sxs-lookup"><span data-stu-id="43bc8-138">Step 2: Providing a Download Link for the Brochures in a GridView</span></span>

<span data-ttu-id="43bc8-139">С помощью `BrochurePath` значения, предоставляемые для `Categories` таблицы, мы будет готов для создания элемента GridView, каждой категории, а также ссылку на загрузку брошюры категории s.</span><span class="sxs-lookup"><span data-stu-id="43bc8-139">With the `BrochurePath` values provided for the `Categories` table, we re ready to create a GridView that lists each category along with a link to download the category s brochure.</span></span> <span data-ttu-id="43bc8-140">На шаге 4 мы расширим этот GridView будет также отображаться изображение категории s.</span><span class="sxs-lookup"><span data-stu-id="43bc8-140">In Step 4 we'll extend this GridView to also display the category s image.</span></span>

<span data-ttu-id="43bc8-141">Начнем с перетаскивания элемента управления GridView с панели инструментов в конструктор `DisplayOrDownloadData.aspx` странице в `BinaryData` папку.</span><span class="sxs-lookup"><span data-stu-id="43bc8-141">Start by dragging a GridView from the Toolbox onto the Designer of the `DisplayOrDownloadData.aspx` page in the `BinaryData` folder.</span></span> <span data-ttu-id="43bc8-142">Набор GridView s `ID` для `Categories` и через s смарт-тега GridView, выберите привязать его к новому источнику данных.</span><span class="sxs-lookup"><span data-stu-id="43bc8-142">Set the GridView s `ID` to `Categories` and through the GridView s smart tag, choose to bind it to a new data source.</span></span> <span data-ttu-id="43bc8-143">В частности, привязать его к элементу ObjectDataSource с именем `CategoriesDataSource` , получающий данные с помощью `CategoriesBLL` объект s `GetCategories()` метод.</span><span class="sxs-lookup"><span data-stu-id="43bc8-143">Specifically, bind it to an ObjectDataSource named `CategoriesDataSource` that retrieves data using the `CategoriesBLL` object s `GetCategories()` method.</span></span>


<span data-ttu-id="43bc8-144">[![Создайте новый ObjectDataSource, именуемый CategoriesDataSource](displaying-binary-data-in-the-data-web-controls-vb/_static/image2.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="43bc8-144">[![Create a New ObjectDataSource Named CategoriesDataSource](displaying-binary-data-in-the-data-web-controls-vb/_static/image2.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image3.png)</span></span>

<span data-ttu-id="43bc8-145">**Рис. 2**: Создайте новый ObjectDataSource с именем `CategoriesDataSource` ([Просмотр полноразмерного изображения](displaying-binary-data-in-the-data-web-controls-vb/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="43bc8-145">**Figure 2**: Create a New ObjectDataSource Named `CategoriesDataSource` ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-vb/_static/image4.png))</span></span>


<span data-ttu-id="43bc8-146">[![Настройка ObjectDataSource на использование класса CategoriesBLL](displaying-binary-data-in-the-data-web-controls-vb/_static/image3.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="43bc8-146">[![Configure the ObjectDataSource to Use the CategoriesBLL Class](displaying-binary-data-in-the-data-web-controls-vb/_static/image3.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image5.png)</span></span>

<span data-ttu-id="43bc8-147">**Рис. 3**: Настройка ObjectDataSource для использования `CategoriesBLL` класс ([Просмотр полноразмерного изображения](displaying-binary-data-in-the-data-web-controls-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="43bc8-147">**Figure 3**: Configure the ObjectDataSource to Use the `CategoriesBLL` Class ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-vb/_static/image6.png))</span></span>


<span data-ttu-id="43bc8-148">[![Получение списка категорий с помощью метода GetCategories()](displaying-binary-data-in-the-data-web-controls-vb/_static/image4.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="43bc8-148">[![Retrieve the List of Categories Using the GetCategories() Method](displaying-binary-data-in-the-data-web-controls-vb/_static/image4.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image7.png)</span></span>

<span data-ttu-id="43bc8-149">**Рис. 4**: Получить список из категории с помощью `GetCategories()` метод ([Просмотр полноразмерного изображения](displaying-binary-data-in-the-data-web-controls-vb/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="43bc8-149">**Figure 4**: Retrieve the List of Categories Using the `GetCategories()` Method ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-vb/_static/image8.png))</span></span>


<span data-ttu-id="43bc8-150">После завершения работы мастера настройки источников данных Visual Studio автоматически добавит поле BoundField в `Categories` GridView для `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, и `BrochurePath` `DataColumn` s.</span><span class="sxs-lookup"><span data-stu-id="43bc8-150">After completing the Configure Data Source wizard, Visual Studio will automatically add a BoundField to the `Categories` GridView for the `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, and `BrochurePath` `DataColumn` s.</span></span> <span data-ttu-id="43bc8-151">Продолжить и удалить `NumberOfProducts` BoundField с момента `GetCategories()` запроса метода s не получить эту информацию.</span><span class="sxs-lookup"><span data-stu-id="43bc8-151">Go ahead and remove the `NumberOfProducts` BoundField since the `GetCategories()` method s query does not retrieve this information.</span></span> <span data-ttu-id="43bc8-152">Также удалите `CategoryID` BoundField и переименуйте `CategoryName` и `BrochurePath` поля BoundField, кроме `HeaderText` свойства в категории и брошюры, соответственно.</span><span class="sxs-lookup"><span data-stu-id="43bc8-152">Also remove the `CategoryID` BoundField and rename the `CategoryName` and `BrochurePath` BoundFields `HeaderText` properties to Category and Brochure, respectively.</span></span> <span data-ttu-id="43bc8-153">После внесения этих изменений, к GridView и ObjectDataSource s декларативная разметка должна выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="43bc8-153">After making these changes, your GridView and ObjectDataSource s declarative markup should look like the following:</span></span>


[!code-aspx[Main](displaying-binary-data-in-the-data-web-controls-vb/samples/sample1.aspx)]

<span data-ttu-id="43bc8-154">Просмотреть эту страницу через обозреватель (см. рис. 5).</span><span class="sxs-lookup"><span data-stu-id="43bc8-154">View this page through a browser (see Figure 5).</span></span> <span data-ttu-id="43bc8-155">Каждая из этих восьми категорий указан.</span><span class="sxs-lookup"><span data-stu-id="43bc8-155">Each of the eight categories is listed.</span></span> <span data-ttu-id="43bc8-156">Семь категорий с `BrochurePath` значения имеют `BrochurePath` значением, отображаемым в соответствующих BoundField.</span><span class="sxs-lookup"><span data-stu-id="43bc8-156">The seven categories with `BrochurePath` values have the `BrochurePath` value displayed in the respective BoundField.</span></span> <span data-ttu-id="43bc8-157">Морепродукты, имеющая `NULL` значение для его `BrochurePath`, отображает пустую ячейку.</span><span class="sxs-lookup"><span data-stu-id="43bc8-157">Seafood, which has a `NULL` value for its `BrochurePath`, displays an empty cell.</span></span>


<span data-ttu-id="43bc8-158">[![Показаны все категории — имя, описание и значение BrochurePath](displaying-binary-data-in-the-data-web-controls-vb/_static/image5.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="43bc8-158">[![Each Category s Name, Description, and BrochurePath Value is Listed](displaying-binary-data-in-the-data-web-controls-vb/_static/image5.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image9.png)</span></span>

<span data-ttu-id="43bc8-159">**Рис. 5**: Каждая категория — имя, описание, и `BrochurePath` перечислены значения ([Просмотр полноразмерного изображения](displaying-binary-data-in-the-data-web-controls-vb/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="43bc8-159">**Figure 5**: Each Category s Name, Description, and `BrochurePath` Value is Listed ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-vb/_static/image10.png))</span></span>


<span data-ttu-id="43bc8-160">Вместо вывода текста `BrochurePath` столбец, необходимо создать ссылку на брошюры.</span><span class="sxs-lookup"><span data-stu-id="43bc8-160">Rather than displaying the text of the `BrochurePath` column, we want to create a link to the brochure.</span></span> <span data-ttu-id="43bc8-161">Чтобы выполнить это, удалите `BrochurePath` BoundField и замените его поля HyperLinkField.</span><span class="sxs-lookup"><span data-stu-id="43bc8-161">To accomplish this, remove the `BrochurePath` BoundField and replace it with a HyperLinkField.</span></span> <span data-ttu-id="43bc8-162">Задайте новое ре HyperLinkField `HeaderText` свойства брошюр, его `Text` брошюр представление, свойства и его `DataNavigateUrlFields` свойства `BrochurePath`.</span><span class="sxs-lookup"><span data-stu-id="43bc8-162">Set the new HyperLinkField s `HeaderText` property to Brochure, its `Text` property to View Brochure, and its `DataNavigateUrlFields` property to `BrochurePath`.</span></span>


![Добавление поля HyperLinkField для BrochurePath](displaying-binary-data-in-the-data-web-controls-vb/_static/image6.gif)

<span data-ttu-id="43bc8-164">**Рис. 6**: Добавление поля HyperLinkField для `BrochurePath`</span><span class="sxs-lookup"><span data-stu-id="43bc8-164">**Figure 6**: Add a HyperLinkField for `BrochurePath`</span></span>


<span data-ttu-id="43bc8-165">Это будет добавлен столбец ссылок к GridView, как показано на рис. 7.</span><span class="sxs-lookup"><span data-stu-id="43bc8-165">This will add a column of links to the GridView, as Figure 7 shows.</span></span> <span data-ttu-id="43bc8-166">Щелкните ссылку на представление буклет будет отображаться PDF-ФАЙЛ непосредственно в браузере или запрашивать пользователя, чтобы скачать файл, в зависимости от того, установлено ли средство чтения PDF и параметров браузера s.</span><span class="sxs-lookup"><span data-stu-id="43bc8-166">Clicking a View Brochure link will either display the PDF directly in the browser or prompt the user to download the file, depending on whether a PDF reader is installed and the browser s settings.</span></span>


<span data-ttu-id="43bc8-167">[![Буклета s категории можно просмотреть, щелкнув ссылку буклет представления](displaying-binary-data-in-the-data-web-controls-vb/_static/image7.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="43bc8-167">[![A Category s Brochure Can Be Viewed by Clicking the View Brochure Link](displaying-binary-data-in-the-data-web-controls-vb/_static/image7.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image11.png)</span></span>

<span data-ttu-id="43bc8-168">**Рис. 7**: Категории s буклет можно просмотреть, щелкнув ссылку Просмотр Буклет ([Просмотр полноразмерного изображения](displaying-binary-data-in-the-data-web-controls-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="43bc8-168">**Figure 7**: A Category s Brochure Can Be Viewed by Clicking the View Brochure Link ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-vb/_static/image12.png))</span></span>


<span data-ttu-id="43bc8-169">[![Категория s буклет PDF отображается](displaying-binary-data-in-the-data-web-controls-vb/_static/image8.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="43bc8-169">[![The Category s Brochure PDF is Displayed](displaying-binary-data-in-the-data-web-controls-vb/_static/image8.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image13.png)</span></span>

<span data-ttu-id="43bc8-170">**Рис. 8**: Категория s буклет PDF отображается ([Просмотр полноразмерного изображения](displaying-binary-data-in-the-data-web-controls-vb/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="43bc8-170">**Figure 8**: The Category s Brochure PDF is Displayed ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-vb/_static/image14.png))</span></span>


## <a name="hiding-the-view-brochure-text-for-categories-without-a-brochure"></a><span data-ttu-id="43bc8-171">Скрытие текста буклет представления для категорий без буклета</span><span class="sxs-lookup"><span data-stu-id="43bc8-171">Hiding the View Brochure Text for Categories Without a Brochure</span></span>

<span data-ttu-id="43bc8-172">Как показано на рис. 7, `BrochurePath` HyperLinkField отображает его `Text` значение свойства (представление буклет) для всех записей, независимо от того, следует ли там s отличный от`NULL` значение `BrochurePath`.</span><span class="sxs-lookup"><span data-stu-id="43bc8-172">As Figure 7 shows, the `BrochurePath` HyperLinkField displays its `Text` property value ( View Brochure ) for all records, regardless of whether there s a non-`NULL` value for `BrochurePath`.</span></span> <span data-ttu-id="43bc8-173">Само собой Если `BrochurePath` — `NULL`, то ссылка отображается в виде текста, как в случае с категории «Seafood» (см. рис. 7).</span><span class="sxs-lookup"><span data-stu-id="43bc8-173">Of course, if `BrochurePath` is `NULL`, then the link is displayed as text only, as is the case with the Seafood category (refer back to Figure 7).</span></span> <span data-ttu-id="43bc8-174">Вместо вывода текст брошюры представление, было бы здорово иметь эти категории без `BrochurePath` значение отображения альтернативный текст, как доступные буклет нет.</span><span class="sxs-lookup"><span data-stu-id="43bc8-174">Rather than displaying the text View Brochure, it might be nice to have those categories without a `BrochurePath` value display some alternate text, like No Brochure Available.</span></span>

<span data-ttu-id="43bc8-175">Чтобы обеспечить такое поведение, нам нужно использовать поле TemplateField, содержимое которых создается путем вызова метода страницы, создает соответствующие выходные данные на основе `BrochurePath` значение.</span><span class="sxs-lookup"><span data-stu-id="43bc8-175">In order to provide this behavior, we need to use a TemplateField whose content is generated via a call to a page method that emits the appropriate output based on the `BrochurePath` value.</span></span> <span data-ttu-id="43bc8-176">Мы сначала изучили это форматирование прием в [использование полей TemplateField в элементе управления GridView](../custom-formatting/using-templatefields-in-the-gridview-control-vb.md) руководства.</span><span class="sxs-lookup"><span data-stu-id="43bc8-176">We first explored this formatting technique back in the [Using TemplateFields in the GridView Control](../custom-formatting/using-templatefields-in-the-gridview-control-vb.md) tutorial.</span></span>

<span data-ttu-id="43bc8-177">Чтобы включить поле HyperLinkField в поле TemplateField, установите `BrochurePath` HyperLinkField и выбрав Convert это поле в TemplateField ссылку в диалоговом окне Правка столбцов.</span><span class="sxs-lookup"><span data-stu-id="43bc8-177">Turn the HyperLinkField into a TemplateField by selecting the `BrochurePath` HyperLinkField and then clicking on the Convert this field into a TemplateField link in the Edit Columns dialog box.</span></span>


![Преобразовать поле HyperLinkField в поле TemplateField](displaying-binary-data-in-the-data-web-controls-vb/_static/image9.gif)

<span data-ttu-id="43bc8-179">**Рис. 9**: Преобразовать поле HyperLinkField в поле TemplateField</span><span class="sxs-lookup"><span data-stu-id="43bc8-179">**Figure 9**: Convert the HyperLinkField into a TemplateField</span></span>


<span data-ttu-id="43bc8-180">Это создаст TemplateField с `ItemTemplate` , содержащее гиперссылку веб-узла со свойством `NavigateUrl` свойство привязано к `BrochurePath` значение.</span><span class="sxs-lookup"><span data-stu-id="43bc8-180">This will create a TemplateField with an `ItemTemplate` that contains a HyperLink Web control whose `NavigateUrl` property is bound to the `BrochurePath` value.</span></span> <span data-ttu-id="43bc8-181">Замените эту разметку с помощью вызова метода `GenerateBrochureLink`, передавая значение `BrochurePath`:</span><span class="sxs-lookup"><span data-stu-id="43bc8-181">Replace this markup with a call to the method `GenerateBrochureLink`, passing in the value of `BrochurePath`:</span></span>


[!code-aspx[Main](displaying-binary-data-in-the-data-web-controls-vb/samples/sample2.aspx)]

<span data-ttu-id="43bc8-182">Создайте `Protected` метод в ASP.NET страницы класса вспомогательного кода s с именем `GenerateBrochureLink` , возвращающий `String` и принимает `Object` как входной параметр.</span><span class="sxs-lookup"><span data-stu-id="43bc8-182">Next, create a `Protected` method in the ASP.NET page s code-behind class named `GenerateBrochureLink` that returns a `String` and accepts an `Object` as an input parameter.</span></span>


[!code-vb[Main](displaying-binary-data-in-the-data-web-controls-vb/samples/sample3.vb)]

<span data-ttu-id="43bc8-183">Этот метод определяет, если переданный `Object` значение — это база данных `NULL` и, если это так, возвращает сообщение о том, что категория отсутствует буклета.</span><span class="sxs-lookup"><span data-stu-id="43bc8-183">This method determines if the passed-in `Object` value is a database `NULL` and, if so, returns a message indicating that the category lacks a brochure.</span></span> <span data-ttu-id="43bc8-184">В противном случае, если имеется `BrochurePath` значение, он, отображаемых в гиперссылку.</span><span class="sxs-lookup"><span data-stu-id="43bc8-184">Otherwise, if there is a `BrochurePath` value, it s displayed in a hyperlink.</span></span> <span data-ttu-id="43bc8-185">Обратите внимание, что если `BrochurePath` значение — представить их s, переданные [ `ResolveUrl(url)` метод](https://msdn.microsoft.com/library/system.web.ui.control.resolveurl.aspx).</span><span class="sxs-lookup"><span data-stu-id="43bc8-185">Note that if the `BrochurePath` value is present it s passed into the [`ResolveUrl(url)` method](https://msdn.microsoft.com/library/system.web.ui.control.resolveurl.aspx).</span></span> <span data-ttu-id="43bc8-186">Этот метод разрешает переданный *URL-адрес*, заменив `~` символ с соответствующий виртуальный путь.</span><span class="sxs-lookup"><span data-stu-id="43bc8-186">This method resolves the passed-in *url*, replacing the `~` character with the appropriate virtual path.</span></span> <span data-ttu-id="43bc8-187">Например, если приложение находится в папке `/Tutorial55`, `ResolveUrl("~/Brochures/Meats.pdf")` вернет `/Tutorial55/Brochures/Meat.pdf`.</span><span class="sxs-lookup"><span data-stu-id="43bc8-187">For example, if the application is rooted at `/Tutorial55`, `ResolveUrl("~/Brochures/Meats.pdf")` will return `/Tutorial55/Brochures/Meat.pdf`.</span></span>

<span data-ttu-id="43bc8-188">Рис. 10 показана страница после внесения этих изменений.</span><span class="sxs-lookup"><span data-stu-id="43bc8-188">Figure 10 shows the page after these changes have been applied.</span></span> <span data-ttu-id="43bc8-189">Обратите внимание, что категории морепродуктов s `BrochurePath` поле теперь отображает текст нет буклета доступны.</span><span class="sxs-lookup"><span data-stu-id="43bc8-189">Note that the Seafood category s `BrochurePath` field now displays the text No Brochure Available .</span></span>


<span data-ttu-id="43bc8-190">[![Текст нет буклет доступных отображается те категории без буклета](displaying-binary-data-in-the-data-web-controls-vb/_static/image10.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="43bc8-190">[![The Text No Brochure Available is Displayed for Those Categories Without a Brochure](displaying-binary-data-in-the-data-web-controls-vb/_static/image10.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image15.png)</span></span>

<span data-ttu-id="43bc8-191">**Рис. 10**: Текст нет буклет доступных отображается те категории без буклета ([Просмотр полноразмерного изображения](displaying-binary-data-in-the-data-web-controls-vb/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="43bc8-191">**Figure 10**: The Text No Brochure Available is Displayed for Those Categories Without a Brochure ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-vb/_static/image16.png))</span></span>


## <a name="step-3-adding-a-web-page-to-display-a-category-s-picture"></a><span data-ttu-id="43bc8-192">Шаг 3. Добавление веб-страницы для отображения рисунков s категории</span><span class="sxs-lookup"><span data-stu-id="43bc8-192">Step 3: Adding a Web Page to Display a Category s Picture</span></span>

<span data-ttu-id="43bc8-193">При посещении пользователем страницы ASP.NET, они получают s HTML страницы ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="43bc8-193">When a user visits an ASP.NET page, they receive the ASP.NET page s HTML.</span></span> <span data-ttu-id="43bc8-194">Полученный HTML только текст и не содержат любые двоичные данные.</span><span class="sxs-lookup"><span data-stu-id="43bc8-194">The received HTML is just text and does not contain any binary data.</span></span> <span data-ttu-id="43bc8-195">Любые дополнительные двоичные данные, такие как изображения, звуковые файлы, приложений Macromedia Flash, внедренные видео проигрывателя Windows Media и т. д. существуют как отдельные ресурсы на веб-сервере.</span><span class="sxs-lookup"><span data-stu-id="43bc8-195">Any additional binary data, such as images, sound files, Macromedia Flash applications, embedded Windows Media Player videos, and so forth, exist as separate resources on the web server.</span></span> <span data-ttu-id="43bc8-196">HTML-код содержит ссылки на эти файлы, но не включает фактическое содержимое файлов.</span><span class="sxs-lookup"><span data-stu-id="43bc8-196">The HTML contains references to these files, but does not include the actual contents of the files.</span></span>

<span data-ttu-id="43bc8-197">Например, в формате HTML `<img>` элемент используется для ссылки на изображения, с помощью `src` атрибут, указывающий на файл изображения следующим образом:</span><span class="sxs-lookup"><span data-stu-id="43bc8-197">For example, in HTML the `<img>` element is used to reference a picture, with the `src` attribute pointing to the image file like so:</span></span>


[!code-html[Main](displaying-binary-data-in-the-data-web-controls-vb/samples/sample4.html)]

<span data-ttu-id="43bc8-198">Когда браузер получает следующий код HTML, он выполняет другой запрос на веб-сервер для получения двоичного содержимого файла изображения, которые затем отображаются в браузере.</span><span class="sxs-lookup"><span data-stu-id="43bc8-198">When a browser receives this HTML, it makes another request to the web server to retrieve the binary contents of the image file, which it then displays in the browser.</span></span> <span data-ttu-id="43bc8-199">То же самое относится к любые двоичные данные.</span><span class="sxs-lookup"><span data-stu-id="43bc8-199">The same concept applies to any binary data.</span></span> <span data-ttu-id="43bc8-200">На шаге 2 брошюры не было отправлено в браузер как часть HTML-разметку страницы s.</span><span class="sxs-lookup"><span data-stu-id="43bc8-200">In Step 2, the brochure was not sent down to the browser as part of the page s HTML markup.</span></span> <span data-ttu-id="43bc8-201">Вместо этого готовый для просмотра HTML-код представлена гиперссылок, при щелчке, вызвавшего браузер для запроса непосредственно в PDF-документе.</span><span class="sxs-lookup"><span data-stu-id="43bc8-201">Rather, the rendered HTML provided hyperlinks that, when clicked, caused the browser to request the PDF document directly.</span></span>

<span data-ttu-id="43bc8-202">Для отображения или разрешить пользователям загрузку двоичных данных, который находится в базе данных, необходимо создать отдельный веб-страницы, которая возвращает данные.</span><span class="sxs-lookup"><span data-stu-id="43bc8-202">To display or allow users to download binary data that resides within the database, we need to create a separate web page that returns the data.</span></span> <span data-ttu-id="43bc8-203">Для нашего приложения там s хранятся непосредственно в базу данных категории s рисунок только одно поле двоичных данных.</span><span class="sxs-lookup"><span data-stu-id="43bc8-203">For our application, there s only one binary data field stored directly in the database the category s picture.</span></span> <span data-ttu-id="43bc8-204">Таким образом, нам нужно страницы, при вызове возвращает данные изображения для определенной категории.</span><span class="sxs-lookup"><span data-stu-id="43bc8-204">Therefore, we need a page that, when called, returns the image data for a particular category.</span></span>

<span data-ttu-id="43bc8-205">Добавьте новую страницу ASP.NET к `BinaryData` папку с именем `DisplayCategoryPicture.aspx`.</span><span class="sxs-lookup"><span data-stu-id="43bc8-205">Add a new ASP.NET page to the `BinaryData` folder named `DisplayCategoryPicture.aspx`.</span></span> <span data-ttu-id="43bc8-206">При этом выбрать главную страницу установить флажок.</span><span class="sxs-lookup"><span data-stu-id="43bc8-206">When doing so, leave the Select master page checkbox unchecked.</span></span> <span data-ttu-id="43bc8-207">Эта страница ожидает `CategoryID` значение в строке запроса и возвращает двоичные данные из этой категории s `Picture` столбца.</span><span class="sxs-lookup"><span data-stu-id="43bc8-207">This page expects a `CategoryID` value in the querystring and returns the binary data of that category s `Picture` column.</span></span> <span data-ttu-id="43bc8-208">Так как эта страница возвращает двоичные данные и ничего более, любую разметку в разделе HTML не требуется.</span><span class="sxs-lookup"><span data-stu-id="43bc8-208">Since this page returns binary data and nothing else, it does not need any markup in the HTML section.</span></span> <span data-ttu-id="43bc8-209">Таким образом, щелкните на вкладке "источник" в левом нижнем углу и удалить все разметки страницы s, за исключением `<%@ Page %>` директива.</span><span class="sxs-lookup"><span data-stu-id="43bc8-209">Therefore, click on the Source tab in the lower left corner and remove all of the page s markup except for the `<%@ Page %>` directive.</span></span> <span data-ttu-id="43bc8-210">То есть `DisplayCategoryPicture.aspx` s декларативная разметка должна состоять из одной строки:</span><span class="sxs-lookup"><span data-stu-id="43bc8-210">That is, `DisplayCategoryPicture.aspx` s declarative markup should consist of a single line:</span></span>


[!code-aspx[Main](displaying-binary-data-in-the-data-web-controls-vb/samples/sample5.aspx)]

<span data-ttu-id="43bc8-211">Если вы видите `MasterPageFile` атрибут в `<%@ Page %>` директивы, удалите его.</span><span class="sxs-lookup"><span data-stu-id="43bc8-211">If you see the `MasterPageFile` attribute in the `<%@ Page %>` directive, remove it.</span></span>

<span data-ttu-id="43bc8-212">В классе фонового кода страницы s, добавьте следующий код, чтобы `Page_Load` обработчик событий:</span><span class="sxs-lookup"><span data-stu-id="43bc8-212">In the page s code-behind class, add the following code to the `Page_Load` event handler:</span></span>


[!code-vb[Main](displaying-binary-data-in-the-data-web-controls-vb/samples/sample6.vb)]

<span data-ttu-id="43bc8-213">Начинается этот код, считывая `CategoryID` значение строки запроса в переменную с именем `categoryID`.</span><span class="sxs-lookup"><span data-stu-id="43bc8-213">This code starts by reading in the `CategoryID` querystring value into a variable named `categoryID`.</span></span> <span data-ttu-id="43bc8-214">Затем извлекаются данные рисунок через вызов `CategoriesBLL` класс s `GetCategoryWithBinaryDataByCategoryID(categoryID)` метод.</span><span class="sxs-lookup"><span data-stu-id="43bc8-214">Next, the picture data is retrieved via a call to the `CategoriesBLL` class s `GetCategoryWithBinaryDataByCategoryID(categoryID)` method.</span></span> <span data-ttu-id="43bc8-215">Эти данные возвращаются клиенту с помощью `Response.BinaryWrite(data)` метод, но прежде чем это называется `Picture` заголовка OLE значение s столбец должен быть удален.</span><span class="sxs-lookup"><span data-stu-id="43bc8-215">This data is returned to the client by using the `Response.BinaryWrite(data)` method, but before this is called, the `Picture` column value s OLE header must be removed.</span></span> <span data-ttu-id="43bc8-216">Это достигается путем создания `Byte` массив с именем `strippedImageData` , будет содержать точно 78 символов меньше, чем `Picture` столбца.</span><span class="sxs-lookup"><span data-stu-id="43bc8-216">This is accomplished by creating a `Byte` array named `strippedImageData` that will hold precisely 78 characters less than what is in the `Picture` column.</span></span> <span data-ttu-id="43bc8-217">[ `Array.Copy` Метод](https://msdn.microsoft.com/library/z50k9bft.aspx) используется для копирования данных из `category.Picture` начиная с позиции 78 через для `strippedImageData`.</span><span class="sxs-lookup"><span data-stu-id="43bc8-217">The [`Array.Copy` method](https://msdn.microsoft.com/library/z50k9bft.aspx) is used to copy the data from `category.Picture` starting at position 78 over to `strippedImageData`.</span></span>

<span data-ttu-id="43bc8-218">`Response.ContentType` Указывает свойство [тип MIME](http://en.wikipedia.org/wiki/MIME) возвращаемых таким образом, чтобы обозреватель знает, как визуализировать его содержимого.</span><span class="sxs-lookup"><span data-stu-id="43bc8-218">The `Response.ContentType` property specifies the [MIME type](http://en.wikipedia.org/wiki/MIME) of the content being returned so that the browser knows how to render it.</span></span> <span data-ttu-id="43bc8-219">Так как `Categories` таблицы s `Picture` столбца является точечным рисунком, растровое изображение, тип MIME здесь (изображение/bmp).</span><span class="sxs-lookup"><span data-stu-id="43bc8-219">Since the `Categories` table s `Picture` column is a bitmap image, the bitmap MIME type is used here (image/bmp).</span></span> <span data-ttu-id="43bc8-220">Если не указан тип MIME, большинство браузеров будут по-прежнему отображаться изображение правильно так, как они может вывести тип, на основе содержимого образа файла s двоичных данных.</span><span class="sxs-lookup"><span data-stu-id="43bc8-220">If you omit the MIME type, most browsers will still display the image correctly because they can infer the type based on the contents of the image file s binary data.</span></span> <span data-ttu-id="43bc8-221">Тем не менее его полезным включать MIME s введите по возможности.</span><span class="sxs-lookup"><span data-stu-id="43bc8-221">However, it s prudent to include the MIME type when possible.</span></span> <span data-ttu-id="43bc8-222">См. в разделе [веб-сайта Internet Assigned Numbers Authority](http://www.iana.org/) полный список [типах носителей MIME](http://www.iana.org/assignments/media-types/).</span><span class="sxs-lookup"><span data-stu-id="43bc8-222">See the [Internet Assigned Numbers Authority s website](http://www.iana.org/) for a complete listing of [MIME media types](http://www.iana.org/assignments/media-types/).</span></span>

<span data-ttu-id="43bc8-223">С этой страницей создан, можно просмотреть рисунок определенной категории s, посетив `DisplayCategoryPicture.aspx?CategoryID=categoryID`.</span><span class="sxs-lookup"><span data-stu-id="43bc8-223">With this page created, a particular category s picture can be viewed by visiting `DisplayCategoryPicture.aspx?CategoryID=categoryID`.</span></span> <span data-ttu-id="43bc8-224">Рис. 11 показана рисунок категории s «Напитки», который можно просмотреть в `DisplayCategoryPicture.aspx?CategoryID=1`.</span><span class="sxs-lookup"><span data-stu-id="43bc8-224">Figure 11 shows the Beverages category s picture, which can be viewed from `DisplayCategoryPicture.aspx?CategoryID=1`.</span></span>


<span data-ttu-id="43bc8-225">[![S категории «Напитки», появится изображение](displaying-binary-data-in-the-data-web-controls-vb/_static/image11.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="43bc8-225">[![The Beverages Category s Picture is Displayed](displaying-binary-data-in-the-data-web-controls-vb/_static/image11.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image17.png)</span></span>

<span data-ttu-id="43bc8-226">**Рис. 11**: S категории «Напитки», изображения ([Просмотр полноразмерного изображения](displaying-binary-data-in-the-data-web-controls-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="43bc8-226">**Figure 11**: The Beverages Category s Picture is Displayed ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-vb/_static/image18.png))</span></span>


<span data-ttu-id="43bc8-227">Если при просмотре `DisplayCategoryPicture.aspx?CategoryID=categoryID`, возникает исключение, которое считывает не удалось привести объект типа «System.DBNull» к типу «System.Byte []», есть две вещи, которые могут вызывать это.</span><span class="sxs-lookup"><span data-stu-id="43bc8-227">If, when visiting `DisplayCategoryPicture.aspx?CategoryID=categoryID`, you get an exception that reads Unable to cast object of type 'System.DBNull' to type 'System.Byte[]', there are two things that may be causing this.</span></span> <span data-ttu-id="43bc8-228">Во-первых, `Categories` таблицы s `Picture` столбец допускает `NULL` значения.</span><span class="sxs-lookup"><span data-stu-id="43bc8-228">First, the `Categories` table s `Picture` column does allow `NULL` values.</span></span> <span data-ttu-id="43bc8-229">`DisplayCategoryPicture.aspx` Страницы, тем не менее, предполагается, что имеется отличный от`NULL` имеется значение.</span><span class="sxs-lookup"><span data-stu-id="43bc8-229">The `DisplayCategoryPicture.aspx` page, however, assumes there is a non-`NULL` value present.</span></span> <span data-ttu-id="43bc8-230">`Picture` Свойство `CategoriesDataTable` невозможно открыть напрямую, если он имеет `NULL` значение.</span><span class="sxs-lookup"><span data-stu-id="43bc8-230">The `Picture` property of the `CategoriesDataTable` cannot be directly accessed if it has a `NULL` value.</span></span> <span data-ttu-id="43bc8-231">Если вы хотите разрешить `NULL` значений в параметре `Picture` столбце d необходимо включить следующее условие:</span><span class="sxs-lookup"><span data-stu-id="43bc8-231">If you do want to allow `NULL` values for the `Picture` column, you d want to include the following condition:</span></span>


[!code-vb[Main](displaying-binary-data-in-the-data-web-controls-vb/samples/sample7.vb)]

<span data-ttu-id="43bc8-232">Приведенный выше код предполагает, что s некоторые изображений в файл с именем `NoPictureAvailable.gif` в `Images` папку, которая будет отображаться для этих категорий без рисунка.</span><span class="sxs-lookup"><span data-stu-id="43bc8-232">The above code assumes that there s some image file named `NoPictureAvailable.gif` in the `Images` folder that you want to display for those categories without a picture.</span></span>

<span data-ttu-id="43bc8-233">Это исключение также может быть вызвано, если `CategoriesTableAdapter` s `GetCategoryWithBinaryDataByCategoryID` метод s `SELECT` инструкции возвращена обратно к основного запроса s столбца списка, которая может произойти, если вы используете специализированные инструкции SQL и ve вы повторно запустите мастер для TableAdapter s основной запрос.</span><span class="sxs-lookup"><span data-stu-id="43bc8-233">This exception could also be caused if the `CategoriesTableAdapter` s `GetCategoryWithBinaryDataByCategoryID` method s `SELECT` statement has reverted back to the main query s column list, which can happen if you are using ad-hoc SQL statements and you ve re-run the wizard for the TableAdapter s main query.</span></span> <span data-ttu-id="43bc8-234">Проверка того, что `GetCategoryWithBinaryDataByCategoryID` метод s `SELECT` инструкция по-прежнему содержит `Picture` столбца.</span><span class="sxs-lookup"><span data-stu-id="43bc8-234">Check to ensure that `GetCategoryWithBinaryDataByCategoryID` method s `SELECT` statement still includes the `Picture` column.</span></span>

> [!NOTE]
> <span data-ttu-id="43bc8-235">Каждый раз `DisplayCategoryPicture.aspx` будет посещен, базы данных доступна и возвращаются данные рисунка указанной категории s.</span><span class="sxs-lookup"><span data-stu-id="43bc8-235">Every time the `DisplayCategoryPicture.aspx` is visited, the database is accessed and the specified category s picture data is returned.</span></span> <span data-ttu-id="43bc8-236">Если рисунок s категории не изменилось, так как последнего просмотра пользователей, однако это затрачивать минимальные усилия.</span><span class="sxs-lookup"><span data-stu-id="43bc8-236">If the category s picture hasn't changed since the user has last viewed it, though, this is wasted effort.</span></span> <span data-ttu-id="43bc8-237">К счастью, HTTP позволяет *условного получает*.</span><span class="sxs-lookup"><span data-stu-id="43bc8-237">Fortunately, HTTP allows for *conditional GETs*.</span></span> <span data-ttu-id="43bc8-238">С помощью условного GET, клиент, посылающий запрос HTTP отправляет вдоль [ `If-Modified-Since` заголовок HTTP](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html) , предоставляющий дату и время, клиент последнего извлечения ресурс с веб-сервера.</span><span class="sxs-lookup"><span data-stu-id="43bc8-238">With a conditional GET, the client making the HTTP request sends along an [`If-Modified-Since` HTTP header](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html) that provides the date and time the client last retrieved this resource from the web server.</span></span> <span data-ttu-id="43bc8-239">Если содержимое не изменилось, так как указанная дата, веб-сервер может отправить в ответ [код состояния не изменено (304)](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html) и отказ от отправляет содержимое запрошенный ресурс.</span><span class="sxs-lookup"><span data-stu-id="43bc8-239">If the content has not changed since this specified date, the web server may respond with a [Not Modified status code (304)](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html) and forgo sending back the requested resource s content.</span></span> <span data-ttu-id="43bc8-240">Короче говоря этот метод освобождает обойтись без отправки содержимого для ресурса, если он не был изменен с момента последнего обращения к клиентам его веб-сервере.</span><span class="sxs-lookup"><span data-stu-id="43bc8-240">In short, this technique relieves the web server from having to send back content for a resource if it has not been modified since the client last accessed it.</span></span>


<span data-ttu-id="43bc8-241">Для реализации такого поведения, тем не менее, необходимо добавить `PictureLastModified` столбец `Categories` таблицу для фиксации, когда `Picture` а также код для проверки последнего обновления столбца `If-Modified-Since` заголовка.</span><span class="sxs-lookup"><span data-stu-id="43bc8-241">To implement this behavior, however, requires that you add a `PictureLastModified` column to the `Categories` table to capture when the `Picture` column was last updated as well as code to check for the `If-Modified-Since` header.</span></span> <span data-ttu-id="43bc8-242">Дополнительные сведения о `If-Modified-Since` заголовка и условном рабочем процессе GET, см. в разделе [HTTP условного GET для хакеров RSS](http://fishbowl.pastiche.org/2002/10/21/http_conditional_get_for_rss_hackers) и [глубже рассмотрим выполнение HTTP-запросы на странице ASP.NET](http://aspnet.4guysfromrolla.com/articles/122204-1.aspx).</span><span class="sxs-lookup"><span data-stu-id="43bc8-242">For more information on the `If-Modified-Since` header and the conditional GET workflow, see [HTTP Conditional GET for RSS Hackers](http://fishbowl.pastiche.org/2002/10/21/http_conditional_get_for_rss_hackers) and [A Deeper Look at Performing HTTP Requests in an ASP.NET Page](http://aspnet.4guysfromrolla.com/articles/122204-1.aspx).</span></span>

## <a name="step-4-displaying-the-category-pictures-in-a-gridview"></a><span data-ttu-id="43bc8-243">Шаг 4. Отображение изображений категории в элементе управления GridView</span><span class="sxs-lookup"><span data-stu-id="43bc8-243">Step 4: Displaying the Category Pictures in a GridView</span></span>

<span data-ttu-id="43bc8-244">Теперь, когда у нас есть веб-страницы для отображения определенной категории s рисунка, можно отобразить с помощью [образа веб-элемента управления](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/standard/image.aspx) или HTML `<img>` элемент, указывающий на `DisplayCategoryPicture.aspx?CategoryID=categoryID`.</span><span class="sxs-lookup"><span data-stu-id="43bc8-244">Now that we have a web page to display a particular category s picture, we can display it using the [Image Web control](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/standard/image.aspx) or an HTML `<img>` element pointing to `DisplayCategoryPicture.aspx?CategoryID=categoryID`.</span></span> <span data-ttu-id="43bc8-245">Изображения, URL-адреса которых определяется базы данных могут отображаться в GridView и DetailsView, с помощью ImageField.</span><span class="sxs-lookup"><span data-stu-id="43bc8-245">Images whose URL is determined by database data can be displayed in the GridView or DetailsView using the ImageField.</span></span> <span data-ttu-id="43bc8-246">Содержит ImageField `DataImageUrlField` и `DataImageUrlFormatString` свойства, которые работают как HyperLinkField s `DataNavigateUrlFields` и `DataNavigateUrlFormatString` свойства.</span><span class="sxs-lookup"><span data-stu-id="43bc8-246">The ImageField contains `DataImageUrlField` and `DataImageUrlFormatString` properties that work like the HyperLinkField s `DataNavigateUrlFields` and `DataNavigateUrlFormatString` properties.</span></span>

<span data-ttu-id="43bc8-247">Позволяют дополнять s `Categories` GridView в `DisplayOrDownloadData.aspx` путем добавления ImageField отображения каждого рисунка категории s.</span><span class="sxs-lookup"><span data-stu-id="43bc8-247">Let s augment the `Categories` GridView in `DisplayOrDownloadData.aspx` by adding an ImageField to show each category s picture.</span></span> <span data-ttu-id="43bc8-248">Просто добавьте ImageField и задайте его `DataImageUrlField` и `DataImageUrlFormatString` свойства `CategoryID` и `DisplayCategoryPicture.aspx?CategoryID={0}`, соответственно.</span><span class="sxs-lookup"><span data-stu-id="43bc8-248">Simply add the ImageField and set its `DataImageUrlField` and `DataImageUrlFormatString` properties to `CategoryID` and `DisplayCategoryPicture.aspx?CategoryID={0}`, respectively.</span></span> <span data-ttu-id="43bc8-249">Это создаст столбец GridView, отображающий `<img>` элемент которого `src` ссылки на атрибуты `DisplayCategoryPicture.aspx?CategoryID={0}`, где {0} заменяется строке GridView s `CategoryID` значение.</span><span class="sxs-lookup"><span data-stu-id="43bc8-249">This will create a GridView column that renders an `<img>` element whose `src` attribute references `DisplayCategoryPicture.aspx?CategoryID={0}`, where {0} is replaced with the GridView row s `CategoryID` value.</span></span>


![Добавить ImageField к GridView](displaying-binary-data-in-the-data-web-controls-vb/_static/image12.gif)

<span data-ttu-id="43bc8-251">**Рис. 12**: Добавить ImageField к GridView</span><span class="sxs-lookup"><span data-stu-id="43bc8-251">**Figure 12**: Add an ImageField to the GridView</span></span>


<span data-ttu-id="43bc8-252">После добавления ImageField, декларативный синтаксис s GridView должна выглядеть, как soothe следующие:</span><span class="sxs-lookup"><span data-stu-id="43bc8-252">After adding the ImageField, your GridView s declarative syntax should look like soothe following:</span></span>


[!code-aspx[Main](displaying-binary-data-in-the-data-web-controls-vb/samples/sample8.aspx)]

<span data-ttu-id="43bc8-253">Отвлекитесь и просмотреть эту страницу через обозреватель.</span><span class="sxs-lookup"><span data-stu-id="43bc8-253">Take a moment to view this page through a browser.</span></span> <span data-ttu-id="43bc8-254">Обратите внимание на то, как каждая запись теперь включает рисунка для категории.</span><span class="sxs-lookup"><span data-stu-id="43bc8-254">Note how each record now includes a picture for the category.</span></span>


<span data-ttu-id="43bc8-255">[![Категория s рисунок отображается для каждой строки](displaying-binary-data-in-the-data-web-controls-vb/_static/image13.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="43bc8-255">[![The Category s Picture is Displayed for Each Row](displaying-binary-data-in-the-data-web-controls-vb/_static/image13.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image19.png)</span></span>

<span data-ttu-id="43bc8-256">**Рис. 13**: Категория s рисунок отображается для каждой строки ([Просмотр полноразмерного изображения](displaying-binary-data-in-the-data-web-controls-vb/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="43bc8-256">**Figure 13**: The Category s Picture is Displayed for Each Row ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-vb/_static/image20.png))</span></span>


## <a name="summary"></a><span data-ttu-id="43bc8-257">Сводка</span><span class="sxs-lookup"><span data-stu-id="43bc8-257">Summary</span></span>

<span data-ttu-id="43bc8-258">В этом учебнике мы рассмотрели способ представления двоичных данных.</span><span class="sxs-lookup"><span data-stu-id="43bc8-258">In this tutorial we examined how to present binary data.</span></span> <span data-ttu-id="43bc8-259">Способ представления данных зависит от типа данных.</span><span class="sxs-lookup"><span data-stu-id="43bc8-259">How the data is presented depends on the type of data.</span></span> <span data-ttu-id="43bc8-260">Для файлов PDF буклета, мы предлагали пользователь буклета представление связи, при нажатии заняло пользователя непосредственно в PDF-файл.</span><span class="sxs-lookup"><span data-stu-id="43bc8-260">For the PDF brochure files, we offered the user a View Brochure link that, when clicked, took the user directly to the PDF file.</span></span> <span data-ttu-id="43bc8-261">Рисунка s категории мы сначала создали страницу, чтобы извлечь и вернуть двоичные данные из базы данных и затем используется этой страницы для отображения каждого изображения s категории в элементе управления GridView.</span><span class="sxs-lookup"><span data-stu-id="43bc8-261">For the category s picture, we first created a page to retrieve and return the binary data from the database and then used that page to display each category s picture in a GridView.</span></span>

<span data-ttu-id="43bc8-262">Теперь, мы ve изучали отображение двоичных данных, мы будет готов к рассмотрению для выполнения вставки, обновления и удаления в базе данных с двоичными данными.</span><span class="sxs-lookup"><span data-stu-id="43bc8-262">Now that we ve looked at how to display binary data, we re ready to examine how to perform insert, updates, and deletes against the database with the binary data.</span></span> <span data-ttu-id="43bc8-263">В следующем учебном курсе мы рассмотрим сопоставление файлов, отправляемых с его соответствующей записи базы данных.</span><span class="sxs-lookup"><span data-stu-id="43bc8-263">In the next tutorial we'll look at how to associate an uploaded file with its corresponding database record.</span></span> <span data-ttu-id="43bc8-264">В этом руководстве, после этого мы рассмотрим, как обновить существующих двоичных данных, а также способ удаления двоичных данных, когда удаляется его связанную запись.</span><span class="sxs-lookup"><span data-stu-id="43bc8-264">In the tutorial after that, we'll see how to update existing binary data as well as how to delete the binary data when its associated record is removed.</span></span>

<span data-ttu-id="43bc8-265">Счастливого вам программирования!</span><span class="sxs-lookup"><span data-stu-id="43bc8-265">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="43bc8-266">Об авторе</span><span class="sxs-lookup"><span data-stu-id="43bc8-266">About the Author</span></span>

<span data-ttu-id="43bc8-267">[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи книг по ASP/ASP.NET и основатель веб- [4GuysFromRolla.com](http://www.4guysfromrolla.com), работает с веб-технологиями Microsoft с 1998 года.</span><span class="sxs-lookup"><span data-stu-id="43bc8-267">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="43bc8-268">Скотт — независимый консультант, преподаватель и автор.</span><span class="sxs-lookup"><span data-stu-id="43bc8-268">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="43bc8-269">Его последняя книга — [ *Sams Teach ASP.NET 2.0 in 24 часа*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="43bc8-269">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="43bc8-270">Ним можно связаться по адресу [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="43bc8-270">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="43bc8-271">или через его блог, который можно найти в [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="43bc8-271">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="43bc8-272">Особая благодарность</span><span class="sxs-lookup"><span data-stu-id="43bc8-272">Special Thanks To</span></span>

<span data-ttu-id="43bc8-273">В этой серии руководств пособий рецензировалась многими компетентными редакторами.</span><span class="sxs-lookup"><span data-stu-id="43bc8-273">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="43bc8-274">Терезой Мерфи и Дейв Gardner, стали Лиз Шалок в этом руководстве.</span><span class="sxs-lookup"><span data-stu-id="43bc8-274">Lead reviewers for this tutorial were Teresa Murphy and Dave Gardner.</span></span> <span data-ttu-id="43bc8-275">Хотите поработать с моих последующих статей для MSDN?</span><span class="sxs-lookup"><span data-stu-id="43bc8-275">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="43bc8-276">Если Да, напишите мне [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="43bc8-276">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="43bc8-277">[Назад](uploading-files-vb.md)
> [Вперед](including-a-file-upload-option-when-adding-a-new-record-vb.md)</span><span class="sxs-lookup"><span data-stu-id="43bc8-277">[Previous](uploading-files-vb.md)
[Next](including-a-file-upload-option-when-adding-a-new-record-vb.md)</span></span>
