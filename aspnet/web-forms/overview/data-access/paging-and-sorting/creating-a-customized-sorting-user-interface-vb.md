---
uid: web-forms/overview/data-access/paging-and-sorting/creating-a-customized-sorting-user-interface-vb
title: Создание интерфейса настраиваемого упорядочения (Visual Basic) | Документация Майкрософт
author: rick-anderson
description: При отображении длинных списков данных, бывает удобно сгруппировать связанные данные, между группами разделяющие строки. В этом руководстве будет показано, как соз...
ms.author: riande
ms.date: 08/15/2006
ms.assetid: f3897a74-cc6a-4032-8f68-465f155e296a
msc.legacyurl: /web-forms/overview/data-access/paging-and-sorting/creating-a-customized-sorting-user-interface-vb
msc.type: authoredcontent
ms.openlocfilehash: b12baa5075b4e67018d8a98a92e807d1778737c8
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/01/2019
ms.locfileid: "57054701"
---
<a name="creating-a-customized-sorting-user-interface-vb"></a>Создание интерфейса настраиваемого упорядочения (VB)
====================
по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Скачайте пример приложения](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_27_VB.exe) или [скачать PDF](creating-a-customized-sorting-user-interface-vb/_static/datatutorial27vb1.pdf)

> При отображении длинных списков данных, бывает удобно сгруппировать связанные данные, между группами разделяющие строки. В этом руководстве будет показано, как создать такой интерфейс сортировки.


## <a name="introduction"></a>Вступление

При отображении длинного списка отсортированных данных там, где есть лишь небольшое число различных значений в одном из столбцов, конечный пользователь может оказаться трудно, точно, границу между группами возникновения. Например, существуют из 81 наименования продуктов в базе данных, но только девять вариантов разных категорий (восемь именованных категорий, а также `NULL` параметр). Рассмотрим случай, который нужно просмотреть продукты, которые относятся к категории морепродуктов. Из страницу со списком *все* продуктов в одном GridView, пользователь может решить, ее лучше всего сортировать результаты по категории, которая будет сгруппировать все Морепродукты. После сортировки по категориям, пользователь затем необходимо просмотреть весь список, ищете где продукты нужной начала и окончания. Так как результаты сортируются в алфавитном порядке по имени категории, найти нужную не сложнее, но все равно требуется внимательно просматривать список элементов в сетке.

Для выделения границ между группами, многие веб-сайтов использовать пользовательский интерфейс, который служит разделителем между группами. Разделители, подобным показанным на рис. 1 позволяет пользователю быстро найти нужную группу и определить его границы, а также выяснить, какие группы вообще входят в данных.


[![Каждой группы категорий имеет четко определены](creating-a-customized-sorting-user-interface-vb/_static/image2.png)](creating-a-customized-sorting-user-interface-vb/_static/image1.png)

**Рис. 1**: Каждой группы категорий имеет четко определены ([Просмотр полноразмерного изображения](creating-a-customized-sorting-user-interface-vb/_static/image3.png))


В этом руководстве будет показано, как создать такой интерфейс сортировки.

## <a name="step-1-creating-a-standard-sortable-gridview"></a>Шаг 1. Создание стандартной страницы и сортировки элемента управления GridView

Перед тем как добавить к элементу GridView для предоставления нужный режим сортировки, позвольте s сначала создать стандартный, сортируемой GridView, которая перечисляет продукты. Сначала откройте `CustomSortingUI.aspx` странице в `PagingAndSorting` папку. Добавьте элемент управления GridView на страницу, задайте его `ID` свойства `ProductList`и привязать его к элементу управления ObjectDataSource. Настройка ObjectDataSource на использование `ProductsBLL` класс s `GetProducts()` для выбора нужных записей.

Затем настройте GridView, таким образом, что он содержит только `ProductName`, `CategoryName`, `SupplierName`, и `UnitPrice` поля BoundFields и CheckBoxField более не поддерживается. Наконец, настройте GridView для поддержки сортировки, установив флажок Включить сортировку в смарт-теге GridView s (или установив его `AllowSorting` свойства `true`). После внесения этих изменений `CustomSortingUI.aspx` страница, декларативная разметка должна выглядеть следующим образом:


[!code-aspx[Main](creating-a-customized-sorting-user-interface-vb/samples/sample1.aspx)]

Отвлекитесь и просмотрите полученный промежуточный результат в браузере. Рис. 2 показан сортируемый GridView при отсортированы по категории в алфавитном порядке.


[![S поддерживает сортировку GridView отсортированы по категории](creating-a-customized-sorting-user-interface-vb/_static/image5.png)](creating-a-customized-sorting-user-interface-vb/_static/image4.png)

**Рис. 2**: S поддерживает сортировку GridView, данные упорядочиваются по категориям ([Просмотр полноразмерного изображения](creating-a-customized-sorting-user-interface-vb/_static/image6.png))


## <a name="step-2-exploring-techniques-for-adding-the-separator-rows"></a>Шаг 2. Изучение методов для добавления разделяющих строк

С помощью универсального, сортируемой GridView полный остается только чтобы иметь возможность добавить разделяющие строки в GridView перед каждой уникальной отсортированный группы. Но как можно такие строки внедряться в GridView? По сути нам нужна для прохода по строкам s GridView, определить отличия между значениями в одном из столбцов и затем добавить соответствующие разделяющие строки. Размышляя об этой проблеме, кажется естественным, что решение лежит где-то в GridView s `RowDataBound` обработчик событий. Как уже говорилось в [форматирование на основе по данным](../custom-formatting/custom-formatting-based-upon-data-vb.md) руководства, этот обработчик событий обычно используется при форматировании на уровне строк на основе строк данных. Тем не менее `RowDataBound` не сможет помочь нам, как строки нельзя добавить к элементу GridView программным способом из этого обработчика событий. GridView s `Rows` коллекции, на самом деле, только для чтения.

Чтобы добавить дополнительные строки GridView у нас есть три варианта:

- Добавить разделяющие метаданные к фактическим данным, привязанный к элементу GridView
- После привязки GridView к данным, добавьте дополнительные `TableRow` экземпляров GridView s управлять сбором
- Создание пользовательского серверного элемента управления, который расширяет элемент управления GridView и переопределяющий методы, которые отвечают за создание структуры s GridView

Создание пользовательского серверного элемента управления бы лучше, если эта функциональность была нужна на многих веб-страницах или в несколько веб-сайтов. Тем не менее он требует написания совсем немного кода и подробного разъяснения глубине о внутренних механизмах s GridView. Таким образом мы выберем соответствующий параметр в этом руководстве.

Две другие параметры добавление разделяющих строк к фактических данных, привязываются к GridView и управления в коллекцию элементов управления GridView s после его был привязан — по-разному подходят к задаче и заслуживают отдельной дискуссии.

## <a name="adding-rows-to-the-data-bound-to-the-gridview"></a>Добавление строк к данным, связанным с элементом GridView

Если GridView привязан к источнику данных, он создает `GridViewRow` для каждой записи, возвращаемых источником данных. Таким образом можно ввести необходимые разделяющие строки путем добавления разделитель записей в источнике данных до их привязки к GridView. Этот принцип показан на рис. 3.


![Первый вариант предполагает добавление разделяющих строк к источнику данных](creating-a-customized-sorting-user-interface-vb/_static/image7.png)

**Рис. 3**: Первый вариант предполагает добавление разделяющих строк к источнику данных


Я использую термин разделитель записей в кавычки, поскольку нет специальной записи; Вместо этого мы должны как-либо пометить конкретной записи в источнике данных служит в качестве разделителя, а не обычной строки данных. В нашем примере мы повторно привязки `ProductsDataTable` экземпляра к GridView, который представляет собой `ProductRows`. Пометить запись как за строкой-разделителем, задав его `CategoryID` свойства `-1` (поскольку такие t удалось значение обычно существует).

Чтобы реализовать этот подход d необходимо выполнить следующие действия:

1. Программно получить данные, привязываемые к элементу GridView ( `ProductsDataTable` экземпляра)
2. Сортировать данные с учетом GridView s `SortExpression` и `SortDirection` свойства
3. Итерации по `ProductsRows` в `ProductsDataTable`, которым нужен где лежат различия в одном из столбцов
4. На границе каждой группы, внедрить разделяющих записей `ProductsRow` экземпляра в объект DataTable, один, где он s `CategoryID` присвоено `-1` (или любым другим способом было решено после пометить запись как запись разделитель)
5. После добавления разделяющих строк, программно привязать данные к GridView

Помимо этих пяти шагов d также необходимо предоставить обработчик событий для GridView s `RowDataBound` событий. Здесь мы d проверка каждой `DataRow` и определить, было ли разделитель строк, один которого `CategoryID` был `-1`. Если Да, d, скорее всего, необходимо изменить форматирование или текст, отображаемый в ячейках.

При использовании этого метода для вставки границ групп сортировки нам требуется немного больше усилий, чем описанные выше, так как необходимо также предоставить обработчик событий для GridView s `Sorting` событий и следить за `SortExpression` и `SortDirection` значения.

## <a name="manipulating-the-gridview-s-control-collection-after-it-s-been-databound"></a>Управление GridView s управлять сбором после него s были с привязкой к данным

Вместо обращения к данным до их привязки к элементу GridView, можно добавить разделяющие строки *после* привязки данных к GridView. В процессе привязки данных создается иерархия s иерархию элементов управления GridView, который на самом деле является просто `Table` экземпляр, состоящие из коллекции строк, каждая из которых представляет собой коллекцию ячеек. В частности, содержит коллекцию элементов управления GridView s `Table` в качестве корня `GridViewRow` (который является производным от `TableRow` класс) для каждой записи в `DataSource` привязываются к GridView и `TableCell` объекта в каждом `GridViewRow` экземпляр для каждого поля данных в `DataSource`.

Чтобы добавить разделяющие строки между всеми группами сортировки, мы может напрямую манипулировать этой иерархии элементов управления после его создания. Мы может быть уверены в том, что иерархии элементов управления GridView s был создан в последний раз, когда страница отображается. Таким образом, переопределить метод `Page` класс s `Render` метода, после чего иерархии конечный элемент управления GridView s обновляется для включения ней необходимые разделяющие строки. Этот процесс показан на рис. 4.


[![Второй подход предполагает изменение иерархии элементов управления GridView s](creating-a-customized-sorting-user-interface-vb/_static/image9.png)](creating-a-customized-sorting-user-interface-vb/_static/image8.png)

**Рис. 4**: Второй подход предполагает изменение иерархии элемента GridView s ([Просмотр полноразмерного изображения](creating-a-customized-sorting-user-interface-vb/_static/image10.png))


В этом учебнике мы будем использовать этот метод для настройки сортировки.

> [!NOTE]
> Код я m представления в этом руководстве основан на примере, приведенном на [Keiski Теему](http://aspadvice.com/blogs/joteke/default.aspx) запись в блоге s [настраиваем группирования сортировки GridView](http://aspadvice.com/blogs/joteke/archive/2006/02/11/15130.aspx).


## <a name="step-3-adding-the-separator-rows-to-the-gridview-s-control-hierarchy"></a>Шаг 3. Добавление разделяющих строк к иерархии элементов управления GridView s

Поскольку мы хотим только добавление разделяющих строк к иерархии элементов управления GridView s после создания собственной иерархии элементов управления и создания в последний раз посещении страницы, мы хотим выполнить это дополнение в конце жизненного цикла страницы, но до фактического c GridView Иерархия с записными книжками визуализирован в формат HTML. — Последний момент скорость этого можно достичь `Page` класс s `Render` событие, которое мы переопределим наш класс кода, используя следующую сигнатуру метода:


[!code-vb[Main](creating-a-customized-sorting-user-interface-vb/samples/sample2.vb)]

Когда `Page` класс исходное `Render` вызывается метод `base.Render(writer)` всех элементов управления на странице будут отображаться, создание разметка, соответствующая иерархии элемента. Поэтому крайне важно что нам нужно вызвать `base.Render(writer)`, так что страница отображается, и что мы управления GridView s управления до вызова метода `base.Render(writer)`, так что иерархию элементов управления GridView s перед ним были добавлены разделяющих строк s был к просмотру.

Чтобы внедрить заголовки групп необходимо сначала убедитесь, что пользователь запросил что сортироваться данные. По умолчанию не выполнена сортировка содержимого s GridView, и таким образом мы кое t требуется ввести любую группу, добавлять заголовки.

> [!NOTE]
> GridView для сортировки по одному из столбцов при первой загрузке страницы, вызвать GridView s `Sort` метод при первом посещении страницы (но не при последующих обратных передачах). Для этого необходимо добавить этот вызов в `Page_Load` обработчик событий в пределах `if (!Page.IsPostBack)` условного. Вернуться к [разбиение по страницам и сортировка данных отчета](paging-and-sorting-report-data-vb.md) сведений дополнительную информацию о `Sort` метод.


При условии, что данные были отсортированы, теперь нам необходимо определить столбец данные были отсортированы по, и затем перебрать все строки, поиск различий в этом столбце s значения. Следующий код гарантирует, что данные были отсортированы и обнаружить соответствующий столбец, по которому были отсортированы данные:


[!code-vb[Main](creating-a-customized-sorting-user-interface-vb/samples/sample3.vb)]

Если у GridView есть еще быть отсортированы, GridView s `SortExpression` свойство будет не задано. Таким образом необходимо только добавить разделяющие строки, если это свойство имеет какое-либо значение. В этом случае мы затем необходимо определить индекс столбца, по которому сортировались данные. Это достигается путем циклическое GridView s `Columns` и находим столбец, `SortExpression` свойство имеет значение GridView s `SortExpression` свойство. Помимо индекса столбца s, мы получаем `HeaderText` свойство, которое будет использоваться для отображения разделяющих строк.

С помощью индекс столбца, по которому сортируется данные последним шагом является перебрать все строки элемента GridView. Для каждой строки, нам нужно определить, отличается ли значение s отсортированного столбца с предыдущего значения s столбец s отсортированных строк. Если таким образом, нам нужно внедрять новый `GridViewRow` экземпляра в иерархии элементов управления. Это выполняется следующим кодом:


[!code-vb[Main](creating-a-customized-sorting-user-interface-vb/samples/sample4.vb)]

Этот код начинается с программного обращения `Table` объект найден в корне иерархии элементов управления GridView s и создания строковой переменной с именем `lastValue`. `lastValue` используется для сравнения текущее значение столбца строки s отсортированы с предыдущим значением строк. Далее, GridView s `Rows` коллекция перечисляется и для каждой строки значение в отсортированном столбце сохраняется в `currentValue` переменной.

> [!NOTE]
> Для определения значения столбца сортируются s конкретной строки, мы используем свойство ячейки s `Text` свойство. Это хорошо работает для полей BoundField, но будут не работает надлежащим образом, для поля TemplateField, CheckBoxFields и так далее. Мы рассмотрим к решению для альтернативного полей GridView чуть ниже.


`currentValue` И `lastValue` сравниваются. Если они не совпадают, нам нужно добавить строку разделителя для иерархию элементов управления. Это достигается путем определения индекс `GridViewRow` в `Table` объект s `Rows` , создаем новые `GridViewRow` и `TableCell` экземпляров, а затем добавив `TableCell` и `GridViewRow` для иерархии элементов управления.

Обратите внимание, что разделителя в строке s одиночному `TableCell` форматируется таким образом, что занимает всю ширину элемента GridView, форматируется с использованием `SortHeaderRowStyle` класс CSS и имеет его `Text` , которое содержит группы имя свойства (такие как категории) и Значение s группы (например, «Напитки»). Наконец `lastValue` присваивается значение `currentValue`.

Класс CSS, используемый для форматирования заголовка группы `SortHeaderRowStyle` должен быть указан в `Styles.css` файл. Вы можете использовать любые параметры стиля подходят для вас; Я использовал следующий:


[!code-css[Main](creating-a-customized-sorting-user-interface-vb/samples/sample5.css)]

С помощью кодовой страницы, интерфейс сортировки добавляет заголовки групп при сортировке по любой BoundField (см. рис. 5 показан снимок экрана при сортировке по поставщикам). Тем не менее при сортировке по полям других типов (например, CheckBoxField или TemplateField), заголовки групп брать будет неоткуда (см. рис. 6) являются.


[![Интерфейс сортировки включает заголовки сортировки групп при сортировке по полю BoundFields](creating-a-customized-sorting-user-interface-vb/_static/image12.png)](creating-a-customized-sorting-user-interface-vb/_static/image11.png)

**Рис. 5**: Сортировка интерфейс включает сортировки группы заголовки при сортировке по полю BoundFields ([Просмотр полноразмерного изображения](creating-a-customized-sorting-user-interface-vb/_static/image13.png))


[![Отсутствует при сортировке по полю CheckBoxField заголовки групп не отображаются](creating-a-customized-sorting-user-interface-vb/_static/image15.png)](creating-a-customized-sorting-user-interface-vb/_static/image14.png)

**Рис. 6**: Отсутствует при сортировке по полю CheckBoxField заголовки групп не отображаются ([Просмотр полноразмерного изображения](creating-a-customized-sorting-user-interface-vb/_static/image16.png))


При сортировке по полю CheckBoxField заголовки групп отсутствуют, так как код в настоящее время использует только `TableCell` s `Text` свойство для определения значения в отсортированном столбце для каждой строки. Для CheckBoxFields `TableCell` s `Text` свойство является пустой строкой; вместо этого значение можно получить через флажок веб-элемент, который находится в пределах `TableCell` s `Controls` коллекции.

Чтобы обрабатывать поля, кроме полей BoundField, нам нужно дополнить код где `currentValue` переменной присваивается проверить существование флажка в `TableCell` s `Controls` коллекции. Вместо использования `currentValue = gvr.Cells(sortColumnIndex).Text`, замените этот код на следующий:


[!code-vb[Main](creating-a-customized-sorting-user-interface-vb/samples/sample6.vb)]

Этот код выполняет проверку ячейку `TableCell` для текущей строки определить наличие любых элементов управления в `Controls` коллекции. Если есть, и первый элемент управления CheckBox, `currentValue` переменной устанавливается значение Да или нет, в зависимости от s флажок `Checked` свойство. В противном случае — значение берется из `TableCell` s `Text` свойство. Эту логику можно реплицировать в сортировке любого поля TemplateField, которые могут существовать в GridView.

Выше код, заголовки групп, включая теперь при сортировке по CheckBoxField более не поддерживается (см. рис. 7).


[![Теперь есть при сортировке по полю CheckBoxField заголовки групп не отображаются](creating-a-customized-sorting-user-interface-vb/_static/image18.png)](creating-a-customized-sorting-user-interface-vb/_static/image17.png)

**Рис. 7**: Теперь есть при сортировке по полю CheckBoxField заголовки групп не отображаются ([Просмотр полноразмерного изображения](creating-a-customized-sorting-user-interface-vb/_static/image19.png))


> [!NOTE]
> Если у вас есть продукты с `NULL` базы данных значения для `CategoryID`, `SupplierID`, или `UnitPrice` поля, эти значения будут отображаться как пустые строки в GridView по умолчанию, то есть текст разделителя строк для этих продуктов с `NULL`будет выглядеть как категория: (то есть существует s нет имя после категории: с категорией, такие как: «Напитки»). Если вы не хотите отображаемые здесь вы можете задать полей BoundFields [ `NullDisplayText` свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.boundfield.nulldisplaytext.aspx) текст должен отображаться, или можно добавить условный оператор в метод Render, при назначении `currentValue` для разделителя Строка s `Text` свойство.


## <a name="summary"></a>Сводка

GridView включает множество встроенных возможностей для настройки интерфейса сортировки. Тем не менее, применив немного кода нижнего уровня его можно настроить иерархию элементов управления GridView s для создания более функциональный интерфейс s. В этом руководстве мы увидели, как добавить строку разделителя группы сортировки для сортируемого GridView, который позволяет быстрее находить отдельные группы и этих групп границ. Дополнительные примеры доработки интерфейсов, ознакомьтесь с [Скотт Гатри](https://weblogs.asp.net/scottgu/) s [несколько ASP.NET 2.0 GridView сортировки советы и рекомендации](https://weblogs.asp.net/scottgu/archive/2006/02/11/437995.aspx) запись в блоге.

Счастливого вам программирования!

## <a name="about-the-author"></a>Об авторе

[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи книг по ASP/ASP.NET и основатель веб- [4GuysFromRolla.com](http://www.4guysfromrolla.com), работает с веб-технологиями Microsoft с 1998 года. Скотт — независимый консультант, преподаватель и автор. Его последняя книга — [ *Sams Teach ASP.NET 2.0 in 24 часа*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco). Ним можно связаться по адресу [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) или через его блог, который можно найти в [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).

> [!div class="step-by-step"]
> [Назад](sorting-custom-paged-data-vb.md)
