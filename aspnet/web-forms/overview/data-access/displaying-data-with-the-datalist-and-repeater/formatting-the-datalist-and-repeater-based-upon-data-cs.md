---
uid: web-forms/overview/data-access/displaying-data-with-the-datalist-and-repeater/formatting-the-datalist-and-repeater-based-upon-data-cs
title: Форматирование элементов управления DataList и Repeater на основе данных (C#) | Документация Майкрософт
author: rick-anderson
description: В этом учебнике мы рассмотрим примеры форматирования внешнего вида элементов управления DataList и Repeater с помощью функций форматирования с...
ms.author: riande
ms.date: 09/13/2006
ms.assetid: 83e3d759-82b8-41e6-8d62-f0f4b3edec41
msc.legacyurl: /web-forms/overview/data-access/displaying-data-with-the-datalist-and-repeater/formatting-the-datalist-and-repeater-based-upon-data-cs
msc.type: authoredcontent
ms.openlocfilehash: 68de3450ed97fc7bd0efb27e089d9db8e3e85fb0
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/28/2019
ms.locfileid: "74633275"
---
# <a name="formatting-the-datalist-and-repeater-based-upon-data-c"></a>Форматирование элементов управления DataList и Repeater в зависимости от данных (C#)

по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Скачивание примера приложения](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_30_CS.exe) или [Загрузка PDF-файла](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/datatutorial30cs1.pdf)

> В этом учебнике мы рассмотрим примеры форматирования внешнего вида элементов управления DataList и Repeater с помощью функций форматирования в шаблонах или обработки события DataBound.

## <a name="introduction"></a>Введение

Как было показано в предыдущем учебном курсе, DataList предлагает ряд свойств, связанных со стилем, которые влияют на его внешний вид. В частности, мы увидели, как назначить классы CSS по умолчанию свойствам DataList `HeaderStyle`, `ItemStyle`, `AlternatingItemStyle`и `SelectedItemStyle`. В дополнение к этим четырем свойствам DataList содержит ряд других свойств, связанных с стилем, таких как `Font`, `ForeColor`, `BackColor`и `BorderWidth`, для нескольких имен. Элемент управления Repeater не содержит свойств, связанных со стилем. Все такие параметры стиля должны быть сделаны непосредственно в разметке в шаблонах Repeater s.

Однако часто форматирование данных зависит от самих данных. Например, при перечислении продуктов может потребоваться отобразить сведения о продукте в светло-сером цвете шрифта, если он снят, или же можно выделить `UnitsInStock` значение, если оно равно нулю. Как мы видели в предыдущих руководствах, GridView, DetailsView и FormView предлагают два различных способа форматирования своего внешнего вида на основе их данных:

- **Событие `DataBound`** создает обработчик событий для соответствующего события `DataBound`, которое срабатывает после привязки данных к каждому элементу (для GridView это событие `RowDataBound`; для элементов управления DataList и Repeater это событие `ItemDataBound`). В этом обработчике событий можно проанализировать и отформатировать решения, связанные только с данными. Мы рассматривали этот метод в [пользовательском форматировании, основанном](../custom-formatting/custom-formatting-based-upon-data-cs.md) на руководстве по данным.
- **Функции форматирования в шаблонах** при использовании полей TemplateField в элементах управления DetailsView или GridView или в шаблоне элемента управления FormView можно добавить функцию форматирования в класс кода программной части ASP.NET Page, уровень бизнес-логики или любую другую библиотеку классов, доступную из веб-приложения. Эта функция форматирования может принимать произвольное число входных параметров, но должна возвращать HTML-код для отрисовки в шаблоне. Функции форматирования сначала были проверены в [с помощью полей TemplateField в руководстве по элементу управления GridView](../custom-formatting/using-templatefields-in-the-gridview-control-cs.md) .

Оба способа форматирования доступны в элементах управления DataList и Repeater. В этом учебнике мы рассмотрим примеры использования обоих методов для обоих элементов управления.

## <a name="using-theitemdataboundevent-handler"></a>Использование обработчика событий`ItemDataBound`

Когда данные привязываются к элементу управления DataList, как из элемента источника данных, так и путем программного назначения данных свойству `DataSource` управления и вызова метода `DataBind()`, вызывается событие DataList `DataBinding`, источник данных перечислено, а каждая запись данных привязывается к DataList. Для каждой записи в источнике данных DataList создает объект [`DataListItem`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalistitem.aspx) , который затем привязывается к текущей записи. Во время этого процесса DataList вызывает два события:

- **`ItemCreated`** срабатывает после создания `DataListItem`
- **`ItemDataBound`** срабатывает после привязки текущей записи к `DataListItem`

Следующие шаги описывают процесс привязки данных для элемента управления DataList.

1. Порождается [событие`DataBinding`](https://msdn.microsoft.com/library/system.web.ui.control.databinding.aspx) DataList s
2. Данные привязаны к DataList  
  
   Для каждой записи в источнике данных 

    1. Создание объекта `DataListItem`
    2. Запустить [событие`ItemCreated`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.itemcreated.aspx)
    3. Привязка записи к `DataListItem`
    4. Запустить [событие`ItemDataBound`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.itemdatabound.aspx)
    5. Добавление `DataListItem` в коллекцию `Items`

При привязке данных к элементу управления Repeater он проходит точную последовательность шагов. Единственное отличие заключается в том, что вместо создаваемых экземпляров `DataListItem`, Repeater использует [`RepeaterItem`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.repeateritem(VS.80).aspx)s.

> [!NOTE]
> Читатель внимательный мог заметить незначительную аномалию между последовательностью действий, которые возникают, когда элемент управления DataList и Repeater привязаны к данным, а элемент управления GridView привязан к данным. В заключительном конце процесса привязки данных GridView вызывает событие `DataBound`; Однако ни элемент управления DataList, ни Repeater не имеют такого события. Это связано с тем, что элементы управления DataList и Repeater были созданы обратно в период ASP.NET 1. x, до того, как шаблон обработчика событий до и после этого был распространен.

Как и в случае с GridView, одним из вариантов форматирования на основе данных является создание обработчика для события `ItemDataBound`. Этот обработчик событий проверит данные, которые были только что привязаны к `DataListItem` или `RepeaterItem` и влияет на форматирование элемента управления по мере необходимости.

Для элемента управления DataList изменения форматирования для всего элемента можно реализовать с помощью свойств, связанных со стилем `DataListItem` s, которые включают стандартные `Font`, `ForeColor`, `BackColor`, `CssClass`и т. д. Чтобы повлиять на форматирование определенных веб-элементов управления в шаблоне DataList, необходимо программно получить доступ и изменить стиль этих веб-элементов управления. Мы увидели, как это сделать в *пользовательском форматировании, основанном* на руководстве по данным. Как и элемент управления Repeater, класс `RepeaterItem` не имеет свойств, связанных со стилем; Таким образом, все изменения, связанные с стилями, внесенные в `RepeaterItem` в обработчике событий `ItemDataBound`, должны быть выполнены программным доступом и обновлением веб-элементов управления в шаблоне.

Так как методика форматирования `ItemDataBound` для DataList и Repeater практически идентичны, наш пример будет сосредоточиться на использовании DataList.

## <a name="step-1-displaying-product-information-in-the-datalist"></a>Шаг 1. Отображение сведений о продукте в DataList

Прежде чем беспокоиться о форматировании, давайте сначала создадим страницу, которая использует элемент управления DataList для вывода сведений о продукте. В [предыдущем учебном курсе](displaying-data-with-the-datalist-and-repeater-controls-cs.md) мы создали элемент управления DataList, на котором `ItemTemplate` отображалось название, категория, поставщик, количество на единицу и цена. Давайте повторим эту функциональность в этом руководстве. Для этого можно либо повторно создать элемент управления DataList, либо его ObjectDataSource с нуля, либо скопировать их на страницу, созданную в предыдущем учебнике (`Basics.aspx`), и вставить их на страницу этого учебника (`Formatting.aspx`).

После того как функции DataList и ObjectDataSource были реплицированы из `Basics.aspx` в `Formatting.aspx`, необходимо изменить свойство `ID` DataList s с `DataList1` на более описательное `ItemDataBoundFormattingExample`. Затем просмотрите элемент управления DataList в браузере. Как показано на рис. 1, единственное различие форматирования между каждым продуктом заключается в том, что цвет фона является альтернативой.

[![продукты перечислены в элементе управления DataList](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image2.png)](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image1.png)

**Рис. 1**. продукты перечислены в элементе управления DataList ([щелкните, чтобы просмотреть изображение с полным размером](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image3.png))

В этом руководстве мы будем форматировать элемент управления DataList так, чтобы для всех продуктов, цена которых меньше $20,00, были выбраны желтые названия и цена за единицу.

## <a name="step-2-programmatically-determining-the-value-of-the-data-in-the-itemdatabound-event-handler"></a>Шаг 2. Программное определение значения данных в обработчике событий ItemDataBound

Поскольку только продукты с ценой в $20,00 будут иметь настраиваемое форматирование, необходимо иметь возможность определить цену за каждый продукт. При привязке данных к элементу управления DataList перечисляет записи в источнике данных, а для каждой записи создает экземпляр `DataListItem`, привязывая запись источника данных к `DataListItem`. После привязки данных записи к текущему объекту `DataListItem` срабатывает событие `ItemDataBound` DataList. Можно создать обработчик событий для этого события, чтобы проверить значения данных для текущего `DataListItem` и, основываясь на этих значениях, внести необходимые изменения форматирования.

Создайте событие `ItemDataBound` для DataList и добавьте следующий код:

[!code-csharp[Main](formatting-the-datalist-and-repeater-based-upon-data-cs/samples/sample1.cs)]

В то время как концепция и семантика для обработчика событий DataList `ItemDataBound` совпадают с теми, которые используются обработчиком событий GridView s `RowDataBound` в *пользовательском форматировании, основанном* на руководстве по данным, синтаксис немного различается. При срабатывании события `ItemDataBound` `DataListItem`, только что привязанные к данным, передаются в соответствующий обработчик событий через `e.Item` (вместо `e.Row`, как в обработчике событий GridView `RowDataBound`). Обработчик событий DataList `ItemDataBound` вызывается для *каждой* строки, добавленной в DataList, включая строки заголовков, нижние колонтитулы и разделительные строки. Однако сведения о продукте привязываются только к строкам данных. Поэтому при использовании события `ItemDataBound` для проверки данных, привязанных к DataList, сначала необходимо убедиться, что мы переработали с элементом данных. Это можно сделать, проверив [свойство `DataListItem``ItemType`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalistitem.itemtype.aspx), которое может иметь одно из [следующих восьми значений](https://msdn.microsoft.com/library/system.web.ui.webcontrols.listitemtype.aspx):

- `AlternatingItem`
- `EditItem`
- `Footer`
- `Header`
- `Item`
- `Pager`
- `SelectedItem`
- `Separator`

Как `Item`, так и `AlternatingItem``DataListItem` s описывающего элементы данных DataList. При условии, что мы переработали `Item` или `AlternatingItem`, мы доступим к реальному экземпляру `ProductsRow`, который был привязан к текущему `DataListItem`. Свойство `DataListItem` s [`DataItem`](https://msdn.microsoft.com/system.web.ui.webcontrols.datalistitem.dataitem.aspx) содержит ссылку на объект `DataRowView`, свойство `Row` которого предоставляет ссылку на фактический объект `ProductsRow`.

Далее мы проверяем свойство `ProductsRow` экземпляра `UnitPrice`. Так как таблица Products s `UnitPrice` допускает `NULL` значений, прежде чем пытаться получить доступ к свойству `UnitPrice`, необходимо сначала проверить, имеет ли оно значение `NULL` с помощью метода `IsUnitPriceNull()`. Если значение `UnitPrice` не `NULL`, то проверяется, меньше ли его $20,00. Если он действительно находится в $20,00, необходимо применить пользовательское форматирование.

## <a name="step-3-highlighting-the-product-s-name-and-price"></a>Шаг 3. выделение имени и цены продукта

Когда мы понимаем, что цена продукта меньше $20,00, остается только выделить ее название и цену. Для этого необходимо сначала программно ссылаться на элементы управления Label в `ItemTemplate`, отображающих название и цену продукта. Далее необходимо, чтобы в них отображался желтый фон. Эти сведения о форматировании могут быть применены путем непосредственного изменения меток `BackColor` свойствами (`LabelID.BackColor = Color.Yellow`). Однако в идеале все вопросы, связанные с отображением, должны выражаться в каскадных таблицах стилей. На самом деле, у нас уже есть таблица стилей, предоставляющая требуемое форматирование, определенное в `Styles.css` - `AffordablePriceEmphasis`, которое было создано и рассмотрено в руководстве по работе с *данными в пользовательском формате* .

Чтобы применить форматирование, просто задайте для двух веб-элементов управления Label `CssClass` свойства `AffordablePriceEmphasis`, как показано в следующем коде:

[!code-csharp[Main](formatting-the-datalist-and-repeater-based-upon-data-cs/samples/sample2.cs)]

После завершения обработчика `ItemDataBound` событий перейдите на страницу `Formatting.aspx` в браузере. Как показано на рис. 2, продукты с ценой ниже $20,00 имеют выделенное имя и цену.

[![выделены эти продукты меньше $20,00](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image5.png)](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image4.png)

**Рис. 2**. выделены продукты, размер которых меньше $20,00 ([щелкните, чтобы просмотреть изображение с полным размером](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image6.png))

> [!NOTE]
> Поскольку элемент управления DataList подготавливается к просмотру как HTML-`<table>`, его экземпляры `DataListItem` имеют свойства, связанные со стилем, которые можно задать для применения определенного стиля ко всему элементу. Например, если нужно выделить *желтый элемент,* если его цена меньше $20,00, можно было бы заменить код, на который ссылаются метки, и задать свойства `CssClass` с помощью следующей строки кода: `e.Item.CssClass = "AffordablePriceEmphasis"` (см. рис. 3).

Однако `RepeaterItem`, которые составляют элемент управления Repeater, не предоставляют такие свойства на уровне стиля. Таким образом, применение пользовательского форматирования к элементу управления Repeater требует применения свойств стиля к веб-элементам, которые находятся в шаблонах Repeater, точно так же, как показано на рис. 2.

[![весь элемент продукта выделяется для продуктов под управлением $20,00](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image8.png)](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image7.png)

**Рис. 3**. весь элемент продукта выделяется для продуктов под заголовком $20,00 ([щелкните, чтобы просмотреть изображение с полным размером](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image9.png))

## <a name="using-formatting-functions-from-within-the-template"></a>Использование функций форматирования в шаблоне

В учебнике *Использование полей TemplateField в руководстве по элементу управления GridView* мы увидели, как использовать функцию форматирования в GridView TemplateField для применения пользовательского форматирования на основе данных, привязанных к строкам GridView s. Функция форматирования — это метод, который может быть вызван из шаблона и возвращать HTML, который будет выдаваться на его месте. Функции форматирования могут находиться в классе кода программной части ASP.NET Page s или могут быть централизованы в файлы классов в папке `App_Code` или в отдельном проекте библиотеки классов. Перемещение функции форматирования из класса кода программной части ASP.NET Pages идеально подходит, если вы планируете использовать ту же функцию форматирования на нескольких ASP.NET страницах или в других веб-приложениях ASP.NET.

Чтобы продемонстрировать функции форматирования, добавим в сведения о продукте текст [снят с производства] рядом с названием продукта, если оно больше не поддерживается. Кроме того, пусть Цена выделена желтым цветом, если она меньше $20,00 (как в примере обработчика событий `ItemDataBound`); Если цена $20,00 или более поздняя, не выводит фактическую цену, а вместо текста вызовите предложение с расценками цены. На рис. 4 показан снимок экрана со списком продуктов с примененными правилами форматирования.

[![для дорогостоящих продуктов цена заменяется текстом, вызовите для предложения цены.](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image11.png)](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image10.png)

**Рис. 4**. для дорогостоящих продуктов цена заменяется текстом, вызовите предложение с расценками цены ([щелкните, чтобы просмотреть изображение с полным размером](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image12.png)).

## <a name="step-1-create-the-formatting-functions"></a>Шаг 1. Создание функций форматирования

В этом примере нам нужны две функции форматирования, одна из которых отображает название продукта вместе с текстом [снят с производства], если это необходимо, а другая, отображающая выделенную цену, если она меньше $20,00 или текста, в противном случае вызовите предложение цены. Давайте создадим эти функции в классе кода программной части ASP.NET Page s и назовем их `DisplayProductNameAndDiscontinuedStatus` и `DisplayPrice`. Оба метода должны возвращать HTML-код для отображения в виде строки и должны быть помечены как `Protected` (или `Public`), чтобы вызываться из части декларативного синтаксиса страниц ASP.NET. Ниже приведен код для этих двух методов:

[!code-csharp[Main](formatting-the-datalist-and-repeater-based-upon-data-cs/samples/sample3.cs)]

Обратите внимание, что метод `DisplayProductNameAndDiscontinuedStatus` принимает значения полей данных `productName` и `discontinued` в виде скалярных значений, тогда как метод `DisplayPrice` принимает экземпляр `ProductsRow` (а не `unitPrice` скалярное значение). Любой из этих подходов будет работать. Однако если функция форматирования работает со скалярными значениями, которые могут содержать значения `NULL` базы данных (например, `UnitPrice`; ни `ProductName`, ни `Discontinued` не допускают `NULL` значений), при обработке этих скалярных входных данных необходимо уделить особое внимание.

В частности, входной параметр должен иметь тип `Object`, так как входящее значение может быть `DBNull`ным экземпляром, а не ожидаемым типом данных. Кроме того, необходимо выполнить проверку, чтобы определить, является ли входящее значение значением `NULL` базы данных. То есть, если нам требовалось, чтобы метод `DisplayPrice` принимал цену как скалярное значение, нам нужно использовать следующий код:

[!code-csharp[Main](formatting-the-datalist-and-repeater-based-upon-data-cs/samples/sample4.cs)]

Обратите внимание, что `unitPrice` входной параметр имеет тип `Object` и условный оператор был изменен, чтобы убедиться, что `unitPrice` `DBNull`. Кроме того, поскольку входной параметр `unitPrice` передается в качестве `Object`, он должен быть приведен к десятичному значению.

## <a name="step-2-calling-the-formatting-function-from-the-datalist-s-itemtemplate"></a>Шаг 2. вызов функции форматирования из DataList s ItemTemplate

С помощью функций форматирования, добавленных в наш класс кода программной части ASP.NET Page s, остается только вызвать эти функции форматирования из `ItemTemplate`DataList. Чтобы вызвать функцию форматирования из шаблона, поместите вызов функции в синтаксис DataBinding:

[!code-aspx[Main](formatting-the-datalist-and-repeater-based-upon-data-cs/samples/sample5.aspx)]

В DataList s `ItemTemplate` веб-элемент управления Labels `ProductNameLabel` отображает имя продукта, назначив его свойство `Text` результату `<%# Eval("ProductName") %>`. Чтобы отобразить имя и текст [СНЯТо с учета], обновите декларативный синтаксис таким образом, чтобы он назначил свойству `Text` значение метода `DisplayProductNameAndDiscontinuedStatus`. При этом необходимо передать имя продукта и неподдерживаемые значения с помощью синтаксиса `Eval("columnName")`. `Eval` возвращает значение типа `Object`, но метод `DisplayProductNameAndDiscontinuedStatus` ждет входные параметры типа `String` и `Boolean`; Поэтому необходимо привести значения, возвращаемые методом `Eval`, к ожидаемым типам входных параметров, например так:

[!code-aspx[Main](formatting-the-datalist-and-repeater-based-upon-data-cs/samples/sample6.aspx)]

Чтобы отобразить цену, можно просто установить для свойства `UnitPriceLabel` Label `Text` значение, возвращаемое методом `DisplayPrice`, точно так же, как и для отображения имени продукта и текста [СНЯТо с производства]. Однако вместо передачи `UnitPrice` в качестве скалярного входного параметра мы передаем весь экземпляр `ProductsRow`:

[!code-aspx[Main](formatting-the-datalist-and-repeater-based-upon-data-cs/samples/sample7.aspx)]

Используя вызовы функций форматирования на месте, уделите время для просмотра хода выполнения в браузере. Экран должен выглядеть примерно так, как показано на рис. 5, с неподдерживаемыми продуктами, включая текст [СНЯТо с производства], и товары, стоимость которых превышает $20,00, если их цена заменена текстом, обратитесь в ценовую квоту.

[![для дорогостоящих продуктов цена заменяется текстом, вызовите для предложения цены.](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image14.png)](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image13.png)

**Рис. 5**. для дорогостоящих продуктов цена заменяется текстом, вызовите предложение с расценками цены ([щелкните, чтобы просмотреть изображение с полным размером](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image15.png)).

## <a name="summary"></a>Сводка

Форматирование содержимого элемента управления DataList или Repeater на основе данных может быть выполнено с помощью двух методов. Первым методом является создание обработчика для события `ItemDataBound`, которое срабатывает, когда каждая запись в источнике данных привязывается к новому `DataListItem` или `RepeaterItem`. В обработчике `ItemDataBound` событий можно просмотреть текущие данные элементов, а затем применить форматирование к содержимому шаблона или, для `DataListItem` s, ко всему элементу.

Кроме того, пользовательское форматирование можно реализовать с помощью функций форматирования. Функция форматирования — это метод, который может быть вызван из шаблонов DataList или Repeater, который возвращает HTML-код для порождения на своем месте. Часто HTML-код, возвращаемый функцией форматирования, определяется значениями, привязанными к текущему элементу. Эти значения можно передать в функцию форматирования либо в виде скалярных значений, либо передавая весь объект, привязанный к элементу (например, `ProductsRow` экземпляр).

Поздравляем с программированием!

## <a name="about-the-author"></a>Об авторе

[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи книг по ASP/ASP. NET и основатель [4GuysFromRolla.com](http://www.4guysfromrolla.com), работал с веб-технологиями Майкрософт с 1998. Скотт работает как независимый консультант, преподаватель и модуль записи. Его последняя книга — [*Sams обучать себя ASP.NET 2,0 за 24 часа*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco). Он доступен по адресу [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) или через его блог, который можно найти по адресу [http://ScottOnWriting.NET](http://ScottOnWriting.NET).

## <a name="special-thanks-to"></a>Специальная благодарность

Эта серия руководств была рассмотрена многими полезными рецензентами. Потенциальные рецензенты для этого руководства: Яааков yaakov Ellis), Рэнди Шмидт и основными рецензентами. Хотите ознакомиться с моими будущими статьями MSDN? Если это так, расположите строку в [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)

> [!div class="step-by-step"]
> [Назад](displaying-data-with-the-datalist-and-repeater-controls-cs.md)
> [Вперед](showing-multiple-records-per-row-with-the-datalist-control-cs.md)
