---
uid: web-forms/overview/data-access/caching-data/caching-data-with-the-objectdatasource-vb
title: Кэширование данных с помощью ObjectDataSource (VB) | Документация Майкрософт
author: rick-anderson
description: Кэширование может означать разницу между медленное и быстрый веб-приложения. Это руководство представляет собой первое из четырех подробных взгляните на кэширование в ASP.NET...
ms.author: riande
ms.date: 05/30/2007
ms.assetid: 2e56a733-5512-48a6-9276-70a65bbe4d5d
msc.legacyurl: /web-forms/overview/data-access/caching-data/caching-data-with-the-objectdatasource-vb
msc.type: authoredcontent
ms.openlocfilehash: 6bde070dae3b295c8d7a04098b874d41fab54830
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59380214"
---
# <a name="caching-data-with-the-objectdatasource-vb"></a>Кэширование данных с помощью ObjectDataSource (VB)

по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Скачайте пример приложения](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_58_VB.exe) или [скачать PDF](caching-data-with-the-objectdatasource-vb/_static/datatutorial58vb1.pdf)

> Кэширование может означать разницу между медленное и быстрый веб-приложения. Это руководство представляет собой первый из четырех, рассмотрим подробные кэширования в ASP.NET. Узнайте основные понятия кэширования и кэшировать на уровень представления данных через элемент управления ObjectDataSource.


## <a name="introduction"></a>Вступление

В теории *кэширование* — это процесс получения данными или сведениями затратна для получения и хранения его копию в расположении, которое выполняется быстрее, чтобы получить доступ к. Для приложений, управляемых данными больших и сложных запросов часто потребляют большую часть времени выполнения приложения s. Такие s производительности приложения, затем, часто можно улучшить путем сохранения результатов запросов ресурсоемкие базы данных в память s приложения.

ASP.NET 2.0 предлагает широкий набор параметров кэширования. Всего веб-страницу или пользовательский элемент управления отображался разметки могут кэшироваться через *кэширование вывода*. Эти элементы управления ObjectDataSource и SqlDataSource обеспечивают возможности кэширования также, тем самым позволяя данных должен быть помещен в кэш на уровне управления. И ASP.NET s *кэш данных* предоставляет богатый API кэширования, который позволяет разработчикам программным образом объектов кэша. В этом руководстве и следующие три, который будет рассматриваться использование ObjectDataSource s кэширование функций, а также кэш данных. Также будут рассмотрены способы кэшировать данные уровня приложения во время запуска и постоянно кэшированные данные при помощи зависимости кэша SQL. В этих руководствах, не рассматриваются кэширования выходных данных. Подробный обзор кэширования выходных данных, см. в разделе [кэширования выводимых данных в ASP.NET 2.0](http://aspnet.4guysfromrolla.com/articles/121306-1.aspx).

Кэширование могут применяться в любом месте в архитектуре, от уровня доступа к данным вверх через уровень представления данных. В этом руководстве мы рассмотрим применение кэширования на уровень представления данных через элемент управления ObjectDataSource. В следующем учебном курсе, который будет рассмотрен кэширования данных на уровне бизнес-логики.

## <a name="key-caching-concepts"></a>Ключ, кэшировании

Может значительно повысить производительность приложения s общую производительность и масштабируемость данных затратна для создания и хранения его копию в расположении, которое может осуществляться более эффективно. Так как кэш содержит только копию фактического, базовые данные, он может стать устаревшей, или *устаревших*, при изменении базовых данных. Для решения этой проблемы, разработчик страницы можно указать критерии, по которым элемент кэша будет *вытеснения* из кэша, используя:

- **Критериев на основе времени** элемента могут добавляться в кэш для абсолютный или скользящий длительность. Например разработчик может указывать длительность, скажем, 60 секунд. С абсолютным длительности кэшируемый элемент удаляется 60 секунд, после добавления к кэшу, независимо от частоты обращения к нему. Скользящее длительностью кэшированный элемент удаляется 60 секунд после последнего доступа.
- **Критериев на основе зависимостей** зависимость может быть связан с элементом при добавлении в кэш. При изменении зависимость элемент s он удаляется из кэша. Зависимость может быть файл, другого элемента кэша или сочетание двух. ASP.NET 2.0 также поддерживает зависимости кэша SQL, которые разработчики могут добавить элемент в кэш, который будет удален при изменении основной базы данных. Мы рассмотрим зависимостей кэша SQL готовится к выпуску [использование зависимостей кэша SQL](using-sql-cache-dependencies-vb.md) руководства.

Независимо от того, вытеснения критерию, возможно, элемент в кэше *очистки для* перед выполнены условия по времени или на основе зависимостей. Если кэш достиг емкости, существующие элементы необходимо удалить перед добавлением новых. Следовательно при программным способом с помощью кэшированных данных s жизненно важных, что вы всегда предполагается, что кэшированные данные могут отсутствовать. Мы рассмотрим шаблон, используемый при доступе к данным из кэша программным способом в нашем следующем учебном курсе *кэширование данных в архитектуре*.

Кэширование предоставляет экономичные средства для сжатие большей производительности из приложения. Как [Смит Стивен](http://aspadvice.com/blogs/ssmith/) четкие в своей статье [кэширования ASP.NET: Техник и передовых методик](https://msdn.microsoft.com/library/aa478965.aspx):

Кэширование может быть хорошим способом для получения хорошей достаточную производительность без большой объем времени и анализа. Не требует больших затрат памяти, так что если вы можете получить производительности, путем кэширования выходных данных для 30 секунд, вместо того чтобы тратить в день или неделю, оптимизации кода или базы данных, постарайтесь решения кэширования (при условии, что 30 - старых секунду данных — ОК) и перейти. В конечном счете, плохое проектирование будет, вероятно, догонит, поэтому курса следует правильно проектировать свои приложения. Но если необходимо получить хороший достаточную производительность сегодня, кэширование может быть отличным [подход] приобретение время рефакторинг приложения на более позднюю дату, когда у вас есть время, чтобы сделать это.

Хотя кэширования могут обеспечить достаточное усовершенствований, он не применим во всех ситуациях, например с приложениями, которые используют данные в режиме реального времени, часто обновляет или которых недопустима даже вскоре жили устаревшие данные. Но для большинства приложений, следует использовать кэширование. Дополнительные сведения о кэшировании в ASP.NET 2.0, см. в разделе [кэширования для повышения производительности](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/caching/default.aspx) раздел [ASP.NET 2.0 краткие руководства](https://quickstarts.asp.net/QuickStartv20/aspnet/).

## <a name="step-1-creating-the-caching-web-pages"></a>Шаг 1. Создание кэширования веб-страниц

Прежде чем приступать к исследование функций кэширования s ObjectDataSource, позвольте s уделим несколько минут созданию страниц ASP.NET в нашем проекте веб-сайта, что нам понадобится для изучения этого учебника и следующие три. Начните с добавления новой папки с именем `Caching`. Добавьте следующие страницы ASP.NET в этой папке, не забывая связывать каждую с `Site.master` главной страницы:

- `Default.aspx`
- `ObjectDataSource.aspx`
- `FromTheArchitecture.aspx`
- `AtApplicationStartup.aspx`
- `SqlCacheDependencies.aspx`


![Добавление страниц ASP.NET для кэширования руководств](caching-data-with-the-objectdatasource-vb/_static/image1.png)

**Рис. 1**: Добавление страниц ASP.NET для кэширования руководств


Как и в других папках, `Default.aspx` в `Caching` папку перечислит учебные курсы в своем разделе. Помните, что `SectionLevelTutorialListing.ascx` пользовательский элемент управления предоставляет следующие функциональные возможности. Поэтому добавьте данный пользовательский элемент управления для `Default.aspx` , перетащив его из обозревателя решений на странице s режиме конструктора.


[![Рис. 2. Добавление элемента управления Sectionleveltutoriallisting.ascx к странице Default.aspx](caching-data-with-the-objectdatasource-vb/_static/image3.png)](caching-data-with-the-objectdatasource-vb/_static/image2.png)

**Рис. 2**: Рис. 2. Добавить `SectionLevelTutorialListing.ascx` для пользовательского элемента управления `Default.aspx` ([Просмотр полноразмерного изображения](caching-data-with-the-objectdatasource-vb/_static/image4.png))


Наконец, добавьте эти страницы как записи для `Web.sitemap` файла. В частности, добавьте следующую разметку после работы с двоичными данными `<siteMapNode>`:


[!code-xml[Main](caching-data-with-the-objectdatasource-vb/samples/sample1.xml)]

После обновления `Web.sitemap`, Отвлекитесь и просмотрите учебный веб-узел в обозревателе. В меню слева теперь есть элементы для кэширования учебники.


![Карта узла теперь включают записи для кэширования учебники](caching-data-with-the-objectdatasource-vb/_static/image5.png)

**Рис. 3**: Карта узла теперь включают записи для кэширования учебники


## <a name="step-2-displaying-a-list-of-products-in-a-web-page"></a>Шаг 2. Отображение списка продуктов на веб-странице

В этом руководстве рассматриваются способы использования ObjectDataSource управления s встроенных функций кэширования. Перед рассмотрением эти функции, необходимо сначала страницы для работы с. S позволяют создавать веб-страницы, который использует элемент управления GridView для сведений о продукте получить при помощи элемента ObjectDataSource из `ProductsBLL` класса.

Сначала откройте `ObjectDataSource.aspx` странице в `Caching` папку. Перетащите элемент управления GridView с панели инструментов в конструктор, задайте его `ID` свойства `Products`и в его смарт-тега выберите, чтобы привязать его к новый элемент управления ObjectDataSource с именем `ProductsDataSource`. Настройте элемент ObjectDataSource для работы с `ProductsBLL` класса.


[![Настройка ObjectDataSource на использование класса ProductsBLL](caching-data-with-the-objectdatasource-vb/_static/image7.png)](caching-data-with-the-objectdatasource-vb/_static/image6.png)

**Рис. 4**: Настройка ObjectDataSource для использования `ProductsBLL` класс ([Просмотр полноразмерного изображения](caching-data-with-the-objectdatasource-vb/_static/image8.png))


Для этой страницы позволяют создать изменяемого элемента управления GridView, чтобы мы рассмотрим, что происходит при изменении данных, кэшированных в коллекции через интерфейс s GridView s. Оставьте стрелку раскрывающегося списка на вкладке ВЫБЕРИТЕ значение по умолчанию `GetProducts()`, но изменения выбранного элемента на вкладке "обновления" для `UpdateProduct` перегрузку, которая принимает `productName`, `unitPrice`, и `productID` как его входные параметры.


[![Установить обновления вкладку s раскрывающегося списка список по перегрузке UpdateProduct соответствующие](caching-data-with-the-objectdatasource-vb/_static/image10.png)](caching-data-with-the-objectdatasource-vb/_static/image9.png)

**Рис. 5**: Значение s вкладку обновление с раскрывающимся списком приемлемым `UpdateProduct` перегрузки ([Просмотр полноразмерного изображения](caching-data-with-the-objectdatasource-vb/_static/image11.png))


Наконец раскрывающиеся списки на вкладках INSERT и DELETE (нет) и нажмите кнопку Готово. После завершения работы мастера настройки источника данных, Visual Studio задает ObjectDataSource s `OldValuesParameterFormatString` свойства `original_{0}`. Как уже говорилось в [Обзор Вставка, обновление и удаление данных](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md) руководстве, это свойство должно быть удалены из декларативного синтаксиса или установить обратно к значению по умолчанию `{0}`, в порядке для рабочего процесса обновления для Продолжить без ошибок.

Кроме того по завершении работы мастера Visual Studio добавляет поле к GridView для каждого из полей данных продукта. Удалите все, кроме `ProductName`, `CategoryName`, и `UnitPrice` полей BoundField. Затем обновите `HeaderText` свойства каждой из этих полей BoundField продукта, категория и цена, соответственно. Так как `ProductName` поле является обязательным, преобразовать поле типа BoundField в поле TemplateField и добавьте RequiredFieldValidator к `EditItemTemplate`. Аналогичным образом, преобразовать `UnitPrice` BoundField в поле TemplateField и добавьте элемент управления CompareValidator чтобы убедиться, что введенное пользователем значение является допустимым валюты значение s больше или равно нулю. Помимо этих изменений, вы можете выполнять любые изменения внешнего вида, например с правым `UnitPrice` значение, или указать форматирование для `UnitPrice` текста в его интерфейсы только для чтения и редактирования.

Разрешить изменение GridView, установив флажок Enable Editing в смарт-теге GridView s. Также установите флажки включить разбиение по страницам и включить сортировку.

> [!NOTE]
> Требуется проверка того, как настройка интерфейса правки s GridView? Если Да, обращаться к [Настройка интерфейса изменения данных](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) руководства.


[![Включите поддержку GridView для редактирования, сортировку и разбиение по страницам](caching-data-with-the-objectdatasource-vb/_static/image13.png)](caching-data-with-the-objectdatasource-vb/_static/image12.png)

**Рис. 6**: Включить поддержку GridView для редактирования, сортировку и разбиение по страницам ([Просмотр полноразмерного изображения](caching-data-with-the-objectdatasource-vb/_static/image14.png))


После внесения этих изменений GridView, GridView и ObjectDataSource s декларативная разметка должен выглядеть следующим образом:


[!code-aspx[Main](caching-data-with-the-objectdatasource-vb/samples/sample2.aspx)]

Как показано на рис. 7, изменяемого элемента управления GridView содержит имя, категорию и цену каждого из продуктов в базе данных. Отвлекитесь и протестировать функции сортировки страницы s результаты, страницы по ним и изменить запись.


[![Каждого продукта — имя, категория и цена указана в сортируемый, Pageable, изменяемого элемента управления GridView](caching-data-with-the-objectdatasource-vb/_static/image16.png)](caching-data-with-the-objectdatasource-vb/_static/image15.png)

**Рис. 7**: Каждого продукта — имя, категория и цена указана в сортируемый, Pageable, изменяемого элемента управления GridView ([Просмотр полноразмерного изображения](caching-data-with-the-objectdatasource-vb/_static/image17.png))


## <a name="step-3-examining-when-the-objectdatasource-is-requesting-data"></a>Шаг 3. Проверка при ObjectDataSource является запрос данных

`Products` GridView извлекает свои данные для отображения, вызвав `Select` метод `ProductsDataSource` ObjectDataSource. Данный элемент управления ObjectDataSource создает экземпляр класса s уровня бизнес-логики `ProductsBLL` класс и вызывает его `GetProducts()` метод, который в свою очередь вызывает s уровня доступа к данным `ProductsTableAdapter` s `GetProducts()` метод. Метод DAL подключается к базе данных Northwind и выдает настроенного `SELECT` запроса. Эти данные затем возвращается в слой DAL, который упаковывает их в `NorthwindDataTable`. Объект DataTable возвращается BLL, который возвращает его к элементу ObjectDataSource, который возвращает его к GridView. Затем создает GridView `GridViewRow` для каждой `DataRow` таблицы данных, а для каждого `GridViewRow` в конечном итоге превращается в HTML-код, который возвращается клиенту и отображается в браузере посетителя s.

Эта последовательность событий происходит каждый раз, когда GridView требуется выполнить привязку для базовых данных. Это происходит при первом посещении страницы, при переходе от одной страницы данных в другую, при сортировке GridView, или при изменении данных s GridView по его встроенному, изменение или удаление интерфейсов. Если состояние представления GridView s отключена, при каждой обратной передаче также будет привязывается GridView. GridView может также явно привязывается к данным путем вызова его `DataBind()` метод.

Чтобы полностью оценить частоту, с помощью которого данные извлекаются из базы данных, позволяют отображать сообщение о том, когда данные повторно получаются s. Добавление элемента управления Label Web над элементом управления GridView с именем `ODSEvents`. Очистите его `Text` и установите его `EnableViewState` свойства `False`. Под метку, добавьте кнопку веб-элемент управления и задайте его `Text` значение обратной передачи.


[![Добавление метки и кнопку на страницу над элементом управления GridView](caching-data-with-the-objectdatasource-vb/_static/image19.png)](caching-data-with-the-objectdatasource-vb/_static/image18.png)

**Рис. 8**: Добавление метки и кнопки к странице выше GridView ([Просмотр полноразмерного изображения](caching-data-with-the-objectdatasource-vb/_static/image20.png))


При выполнении рабочего процесса доступа данных, ObjectDataSource s `Selecting` вызывает событие, прежде чем создается базовый объект и его настроенный метод вызывается. Создайте обработчик событий для этого события и добавьте следующий код:


[!code-vb[Main](caching-data-with-the-objectdatasource-vb/samples/sample3.vb)]

Каждый раз при ObjectDataSource выполняет запрос к архитектуры для данных, метка будет отображать инициируется событие выделение текста.

Посетите эту страницу в браузере. При первом посещении страницы отображается инициируется событие выделение текста. Нажмите кнопку обратной передачи и обратите внимание на то, что текст не отображается (предполагая, что GridView s `EnableViewState` свойству `True`, значение по умолчанию). Это обусловлено тем, при обратной передаче GridView воссоздается из состояния представления, и поэтому t включить в элемент управления ObjectDataSource для своих данных. Сортировка, разбиение по страницам и изменение данных, тем не менее, приводит к GridView выполнять повторную привязку к источнику данных и поэтому выбор событие отобразится текст.


[![Всякий раз, когда GridView повторно привязываются к источнику данных, отображается событие Selecting](caching-data-with-the-objectdatasource-vb/_static/image22.png)](caching-data-with-the-objectdatasource-vb/_static/image21.png)

**Рис. 9**: Всякий раз, когда GridView повторно привязываются к источнику данных, инициируется событие Selecting отображается ([Просмотр полноразмерного изображения](caching-data-with-the-objectdatasource-vb/_static/image23.png))


[![Щелкнув кнопку обратной передачи приводит к GridView, перестраиваются заново из состояния представления](caching-data-with-the-objectdatasource-vb/_static/image25.png)](caching-data-with-the-objectdatasource-vb/_static/image24.png)

**Рис. 10**: Нажатие кнопки обратной передачи GridView, перестраиваются заново из состояния представления ([Просмотр полноразмерного изображения](caching-data-with-the-objectdatasource-vb/_static/image26.png))


Может показаться излишним, для получения данных базы данных каждый раз, разбиваемых по страницам или сортировки данных. В конце концов так как мы повторно с разбиением на страницы по умолчанию, элемент управления ObjectDataSource получил все записи при отображении на первой странице. Даже если GridView не поддерживает сортировку и разбиение по страницам поддержки, необходимо получить данные из базы данных каждый раз при первом посещении страницы любым пользователем (и при каждой обратной передаче, если состояние просмотра отключено). Однако если GridView отображаются те же данные для всех пользователей, эти запросы дополнительной базы данных излишним. Почему бы не кэшировать результаты, возвращаемые `GetProducts()` метод и привязки GridView теми кэшированные результаты?

## <a name="step-4-caching-the-data-using-the-objectdatasource"></a>Шаг 4. Кэширование данных с помощью элемента управления ObjectDataSource

Просто задав несколько свойств, можно настроить элемент управления ObjectDataSource автоматически кэшировать его полученных данных в кэше данных ASP.NET. Ниже перечислены связанные с кэшем свойств элемента управления ObjectDataSource.

- [EnableCaching](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.enablecaching.aspx) должно быть присвоено `True` для включения кэширования. Значение по умолчанию — `False`.
- [CacheDuration](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.cacheduration.aspx) количество времени в секундах, которое данные кэшируются. Значение по умолчанию — 0. Элемент управления ObjectDataSource будет кэшировать данные, только если `EnableCaching` — `True` и `CacheDuration` присваивается значение больше нуля.
- [CacheExpirationPolicy](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.cacheexpirationpolicy.aspx) можно присвоить `Absolute` или `Sliding`. Если `Absolute`, элемент управления ObjectDataSource кэширует его извлеченных данных для `CacheDuration` секунды; Если `Sliding`, только после его не было обращений для истечения срока действия данных `CacheDuration` секунд. Значение по умолчанию — `Absolute`.
- [CacheKeyDependency](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.cachekeydependency.aspx) это свойство используется для связывания записей кэша s ObjectDataSource с существующей зависимости кэша. Записи данных s ObjectDataSource может быть преждевременно удалена из кэша с истекающим сроком действия, связанный с ним `CacheKeyDependency`. Это свойство чаще всего используется для связи с кэшем s ObjectDataSource зависимость кэша SQL, раздел будет рассмотрен в будущем [использование зависимостей кэша SQL](using-sql-cache-dependencies-vb.md) руководства.

Позвольте настроить s `ProductsDataSource` ObjectDataSource для кэширования данных на 30 секунд на абсолютной шкале. Набор ObjectDataSource s `EnableCaching` свойства `True` и его `CacheDuration` значение 30. Оставьте `CacheExpirationPolicy` свойство, значение по умолчанию `Absolute`.


[![Настройте элемент ObjectDataSource для кэширования данных на 30 секунд](caching-data-with-the-objectdatasource-vb/_static/image28.png)](caching-data-with-the-objectdatasource-vb/_static/image27.png)

**Рис. 11**: Настройте элемент ObjectDataSource для кэширования данных на 30 секунд ([Просмотр полноразмерного изображения](caching-data-with-the-objectdatasource-vb/_static/image29.png))


Сохраните изменения и вернитесь на эту страницу в браузере. Текст событие, запускаемое выбор будет отображаться при первом посещении страницы, так как изначально данные не в кэше. В отличие от последующих обратных передачах активации, нажав кнопку обратной передачи, сортировка, разбиение по страницам или кнопки Edit или Отмена *не* повторного отображения события Selecting инициируется текста. Это обусловлено `Selecting` событие срабатывает, только если элемент управления ObjectDataSource получает данные из базового объекта; `Selecting` событий не выполняется, если данные извлекаются из кэша данных.

Через 30 секунд данные будут вытесняться из кэша. Данные также будут удаляться из кэша, если элемент управления ObjectDataSource s `Insert`, `Update`, или `Delete` методы вызываются. Следовательно, после 30 секунд или кнопкой "Обновить" выбрана, сортировка, разбиение по страницам, или в кнопки Edit или "Отмена" для получения данных из базового объекта ObjectDataSource, отображение события Selecting инициируется текст при `Selecting` вызывает событие. Эти возвращаемые результаты помещаются обратно в кэш данных.

> [!NOTE]
> Если вы видите текст событие Selecting часто, даже в том случае, если предполагается, что элемент управления ObjectDataSource для работы с кэшированными данными, возможно из-за нехватки памяти. Если не хватает памяти, данные, добавленные в кэш элементом ObjectDataSource может были очистки для. Если t ObjectDataSource правильно кэшировать данные или только кэши данных нерегулярно, закройте некоторые приложения, чтобы освободить память и повторите попытку.


Рис. 12 показано s ObjectDataSource, кэширование рабочего процесса. При возникновении события Selecting текст отображается на экране, поскольку данные не найден в кэше и должны были быть получены из базового объекта. При этом текст отсутствует, однако его s, так как данные были доступны из кэша. Когда данные возвращаются из кэша существует s не вызов к базовому объекту и, следовательно, запрос базы данных не выполнен.


![Элемент управления ObjectDataSource сохраняет и извлекает данные из кэша данных](caching-data-with-the-objectdatasource-vb/_static/image30.png)

**Рис. 12**: Элемент управления ObjectDataSource сохраняет и извлекает данные из кэша данных


Каждое приложение ASP.NET имеет свой собственный кэш данных экземпляра, s, общими для всех страниц и посетителей. Что означает, что данные, хранящиеся в кэше данных элемент управления ObjectDataSource аналогично совместно для всех пользователей, посещающих страницу. Чтобы проверить это, откройте `ObjectDataSource.aspx` страницу в браузере. При первом просмотре странице будет отображаться текст событие Selecting (предполагается, что данные, добавленные в кэш с предыдущих тестов к этому моменту, исключен). Откройте второй экземпляр браузера и скопируйте и вставьте URL-адрес в первом экземпляре обозревателя до секунды. Во втором экземпляре обозревателя, текст события выбор не отображается, так как он s, используя те же кэшированные данные, что и первый.

При вставке его полученных данных в кэше, элемент управления ObjectDataSource использует значение ключа кэша, который включает в себя: `CacheDuration` и `CacheExpirationPolicy` значения свойств; тип базового объекта бизнеса используется элемент управления ObjectDataSource, который указывается с помощью [ `TypeName` свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.typename.aspx) (`ProductsBLL`, в этом примере); значение `SelectMethod` свойства, а также имени и значения параметров в `SelectParameters` коллекции; а также значения его `StartRowIndex`и `MaximumRows` свойства, которые используются при реализации [пользовательское разбиение по страницам](../paging-and-sorting/paging-and-sorting-report-data-vb.md).

Берет на себя создание значение ключа кэша как сочетание этих свойств гарантирует уникальных записей кэша, как изменить эти значения. Например, в предыдущих учебных курсах мы рассмотрели применение ve `ProductsBLL` класс s `GetProductsByCategoryID(categoryID)`, который возвращает все продукты для указанной категории. Один пользователь можете прийти к странице и представление «Напитки», которая имеет `CategoryID` 1. Если элемент управления ObjectDataSource кэшировать его результаты, без учета `SelectParameters` значений, когда другого пользователя на страницу для просмотра Специи при Напитки продукты были в кэше, они d см. в разделе продуктов кэшированных Напитки, а не Специи. Изменив ключ кэша по этим свойствам, которые включают значения `SelectParameters`, элемент управления ObjectDataSource поддерживает отдельную запись кэша для напитков и Специи.

## <a name="stale-data-concerns"></a>Устаревшие данные проблемы

Элемент управления ObjectDataSource автоматически исключает его элементы из кэша, если какой-либо из его `Insert`, `Update`, или `Delete` вызова методов. Это помогает защититься от устаревшие данные при очистке записей кэша при изменении данных на странице. Тем не менее существует возможность по-прежнему отображаться устаревшие данные с помощью кэширования нового ObjectDataSource. В самом простом случае может быть из-за данные, изменять непосредственно в базе данных. Может быть администратором базы данных только что выполнили сценарий, который изменяет некоторые записи в базе данных.

Этот сценарий также может раскрыть заметная способом. Хотя элемент управления ObjectDataSource исключает его элементы из кэша, при вызове одного из его методов изменения данных, кэшированные элементы предназначены для ObjectDataSource s определенного сочетания значений свойств (`CacheDuration`, `TypeName`, `SelectMethod`, и так далее). При наличии двух элементов управления ObjectDataSource, которые используют разные `SelectMethods` или `SelectParameters`, но по-прежнему можете обновить те же данные, а затем один элемент управления ObjectDataSource может обновить строку и отменить свой собственный записей кэша, но соответствующая строка для второй элемент управления ObjectDataSource по-прежнему будут обрабатываться из кэша. Я советую вам для создания страниц, на которых эта функция. Создать страницу, отображающую изменяемого элемента управления GridView, который извлекает данные из ObjectDataSource, который использует кэширование и настроен для получения данных из `ProductsBLL` класс s `GetProducts()` метод. Добавьте еще один изменяемые GridView и ObjectDataSource на этой странице (или другой), но для этой второй элемент управления ObjectDataSource будет использовать `GetProductsByCategoryID(categoryID)` метод. С момента двух элементов управления ObjectDataSource `SelectMethod` свойства отличаются, они ll каждый имеет свои собственные кэшированных значений. При изменении продукта в одной таблице, следующий раз, можно выполнить привязку данных к другой таблице (, разбиение по страницам, сортировку и т. д), он по-прежнему использовать старый, кэшированные данные и не отражают изменения, которые были выполнены из других сетки.

Короче говоря только используйте кэше на основе времени, если вы готовы пойти на потенциально устаревшие данные и использовать более короткие кэше для сценариев, в которых важно актуальность данных. Если устаревшие данные неприемлем, либо отказаться от кэширования, либо использовать зависимости кэша SQL (при условии, что это данные базы данных во время кэширования). В следующем учебном курсе мы изучим зависимостей кэша SQL.

## <a name="summary"></a>Сводка

В этом учебнике мы рассмотрели ObjectDataSource s встроенные возможности кэширования. Просто задав несколько свойств, можно указать элемент управления ObjectDataSource для кэширования результатов, возвращаемых из указанного `SelectMethod` в кэш данных ASP.NET. `CacheDuration` И `CacheExpirationPolicy` свойства указывают длительность кэширования элемента и является ли он абсолютный или скользящий срок действия. `CacheKeyDependency` Свойство связывает все записи кэша s ObjectDataSource с существующей зависимости кэша. Это можно использовать для вытеснения из кэша записей s ObjectDataSource, до того, как действия по времени достижения обычно используется с зависимостей кэша SQL.

Поскольку элемент управления ObjectDataSource просто кэширует его значения в кэш данных, мы удалось реплицировать встроенные функции s ObjectDataSource программным способом. Он t имеет смысла для этого на уровне представления, так как элемент управления ObjectDataSource обеспечивает эти функциональные возможности без дополнительной настройки, но мы можем реализовать возможности кэширования в отдельном слое архитектуры. Для этого нам потребуется повторите ту же логику, используется элемент управления ObjectDataSource. Мы рассмотрим, как программно работать с кэшем данных из в архитектуре в нашем следующем учебном курсе.

Счастливого вам программирования!

## <a name="further-reading"></a>Дополнительные сведения

Дополнительные сведения по темам, обсуждавшимся в этом руководстве см. в следующих ресурсах:

- [Кэширование ASP.NET: Методик и рекомендаций](https://msdn.microsoft.com/library/aa478965.aspx)
- [Кэширования руководство по архитектуре для приложений .NET Framework](https://msdn.microsoft.com/library/ee817645.aspx)
- [Кэширование вывода в ASP.NET 2.0](http://aspnet.4guysfromrolla.com/articles/121306-1.aspx)

## <a name="about-the-author"></a>Об авторе

[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи книг по ASP/ASP.NET и основатель веб- [4GuysFromRolla.com](http://www.4guysfromrolla.com), работает с веб-технологиями Microsoft с 1998 года. Скотт — независимый консультант, преподаватель и автор. Его последняя книга — [ *Sams Teach ASP.NET 2.0 in 24 часа*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco). Ним можно связаться по адресу [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) или через его блог, который можно найти в [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).

## <a name="special-thanks-to"></a>Особая благодарность

В этой серии руководств пособий рецензировалась многими компетентными редакторами. Основной рецензент этого учебного был Мерфи Терезой. Хотите поработать с моих последующих статей для MSDN? Если Да, напишите мне [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)

> [!div class="step-by-step"]
> [Назад](using-sql-cache-dependencies-cs.md)
> [Вперед](caching-data-in-the-architecture-vb.md)
