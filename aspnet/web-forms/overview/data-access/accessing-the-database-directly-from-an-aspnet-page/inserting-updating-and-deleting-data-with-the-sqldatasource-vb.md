---
uid: web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/inserting-updating-and-deleting-data-with-the-sqldatasource-vb
title: Вставка, обновление и удаление данных с помощью элемента SqlDataSource (VB) | Документация Майкрософт
author: rick-anderson
description: В предыдущих руководствах мы узнали, как элемент управления ObjectDataSource допускает вставку, обновление и удаление данных. Элемент управления SqlDataSource поддерживает t...
ms.author: riande
ms.date: 02/20/2007
ms.assetid: 9673bef3-892c-45ba-a7d8-0da3d6f48ec5
msc.legacyurl: /web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/inserting-updating-and-deleting-data-with-the-sqldatasource-vb
msc.type: authoredcontent
ms.openlocfilehash: 4f7b282b09769272df8ff3a32aa4c509c8917481
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78508338"
---
# <a name="inserting-updating-and-deleting-data-with-the-sqldatasource-vb"></a><span data-ttu-id="5cf0f-104">Вставка, обновление и удаление данных с помощью элемента управления SqlDataSource (VB)</span><span class="sxs-lookup"><span data-stu-id="5cf0f-104">Inserting, Updating, and Deleting Data with the SqlDataSource (VB)</span></span>

<span data-ttu-id="5cf0f-105">по [Скотт Митчелл](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="5cf0f-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="5cf0f-106">[Скачивание примера приложения](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_49_VB.exe) или [Загрузка PDF-файла](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/datatutorial49vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="5cf0f-106">[Download Sample App](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_49_VB.exe) or [Download PDF](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/datatutorial49vb1.pdf)</span></span>

> <span data-ttu-id="5cf0f-107">В предыдущих руководствах мы узнали, как элемент управления ObjectDataSource допускает вставку, обновление и удаление данных.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-107">In previous tutorials we learned how the ObjectDataSource control allowed for inserting, updating, and deleting of data.</span></span> <span data-ttu-id="5cf0f-108">Элемент управления SqlDataSource поддерживает те же операции, но подход отличается, и в этом руководстве показано, как настроить SqlDataSource для вставки, обновления и удаления данных.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-108">The SqlDataSource control supports the same operations, but the approach is different, and this tutorial shows how to configure the SqlDataSource to insert, update, and delete data.</span></span>

## <a name="introduction"></a><span data-ttu-id="5cf0f-109">Введение</span><span class="sxs-lookup"><span data-stu-id="5cf0f-109">Introduction</span></span>

<span data-ttu-id="5cf0f-110">Как обсуждалось в [обзоре вставки, обновления и удаления](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md), элемент управления GridView предоставляет встроенные возможности обновления и удаления, а элементы управления DetailsView и FormView включают поддержку вставки вместе с функциями редактирования и удаления.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-110">As discussed in [An Overview of Inserting, Updating, and Deleting](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md), the GridView control provides built-in updating and deleting capabilities, while the DetailsView and FormView controls include inserting support along with editing and deleting functionality.</span></span> <span data-ttu-id="5cf0f-111">Эти возможности изменения данных могут быть подключены непосредственно к элементу управления источника данных без необходимости написания строки кода.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-111">These data modification capabilities can be plugged directly into a data source control without a line of code needing to be written.</span></span> <span data-ttu-id="5cf0f-112">[Общие сведения о вставке, обновлении и удалении](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md) , проверенном с помощью ObjectDataSource, для упрощения вставки, обновления и удаления элементов управления GridView, DetailsView и FormView.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-112">[An Overview of Inserting, Updating, and Deleting](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md) examined using the ObjectDataSource to facilitate inserting, updating, and deleting with the GridView, DetailsView, and FormView controls.</span></span> <span data-ttu-id="5cf0f-113">Кроме того, можно использовать SqlDataSource вместо ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-113">Alternatively, the SqlDataSource can be used in place of the ObjectDataSource.</span></span>

<span data-ttu-id="5cf0f-114">Вспомним, что для поддержки вставки, обновления и удаления с помощью ObjectDataSource нам требовалось указать методы уровня объектов, которые нужно вызвать для выполнения операции вставки, обновления или удаления.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-114">Recall that to support inserting, updating, and deleting, with the ObjectDataSource we needed to specify the object layer methods to invoke to perform the insert, update, or delete action.</span></span> <span data-ttu-id="5cf0f-115">С помощью SqlDataSource необходимо предоставить для выполнения `INSERT`, `UPDATE`и `DELETE` инструкции SQL (или хранимые процедуры).</span><span class="sxs-lookup"><span data-stu-id="5cf0f-115">With the SqlDataSource, we need to provide `INSERT`, `UPDATE`, and `DELETE` SQL statements (or stored procedures) to execute.</span></span> <span data-ttu-id="5cf0f-116">Как будет показано в этом учебнике, эти инструкции можно создать вручную или автоматически создать с помощью мастера настройки источника данных SqlDataSource s.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-116">As we'll see in this tutorial, these statements can be created manually or can be automatically generated by the SqlDataSource s Configure Data Source wizard.</span></span>

> [!NOTE]
> <span data-ttu-id="5cf0f-117">Поскольку мы уже обсуждали возможности вставки, правки и удаления элементов управления GridView, DetailsView и FormView, в этом учебнике основное внимание уделяется настройке элемента управления SqlDataSource для поддержки этих операций.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-117">Since we ve already discussed the inserting, editing, and deleting capabilities of the GridView, DetailsView, and FormView controls, this tutorial will focus on configuring the SqlDataSource control to support these operations.</span></span> <span data-ttu-id="5cf0f-118">Если вам нужно придерживаться реализации этих функций в GridView, DetailsView и FormView, вернитесь к учебникам по редактированию, вставке и удалению данных, начиная с [обзора вставки, обновления и удаления](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md).</span><span class="sxs-lookup"><span data-stu-id="5cf0f-118">If you need to brush up on implementing these features within the GridView, DetailsView, and FormView, return to the Editing, Inserting, and Deleting Data tutorials, starting with [An Overview of Inserting, Updating, and Deleting](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md).</span></span>

## <a name="step-1-specifyinginsertupdate-anddeletestatements"></a><span data-ttu-id="5cf0f-119">Шаг 1. Указание`INSERT`,`UPDATE`и инструкций`DELETE`</span><span class="sxs-lookup"><span data-stu-id="5cf0f-119">Step 1: Specifying`INSERT`,`UPDATE`, and`DELETE`Statements</span></span>

<span data-ttu-id="5cf0f-120">Как мы видели в прошлых двух учебниках, для получения данных из элемента управления SqlDataSource необходимо задать два свойства:</span><span class="sxs-lookup"><span data-stu-id="5cf0f-120">As we ve seen in the past two tutorials, to retrieve data from a SqlDataSource control we need to set two properties:</span></span>

1. <span data-ttu-id="5cf0f-121">`ConnectionString`, указывающий базу данных, в которую отправляется запрос, и</span><span class="sxs-lookup"><span data-stu-id="5cf0f-121">`ConnectionString`, which specifies what database to send the query to, and</span></span>
2. <span data-ttu-id="5cf0f-122">`SelectCommand`, указывающий нерегламентированную инструкцию SQL или имя хранимой процедуры, которую необходимо выполнить для возврата результатов.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-122">`SelectCommand`, which specifies the ad-hoc SQL statement or stored procedure name to execute to return the results.</span></span>

<span data-ttu-id="5cf0f-123">Для `SelectCommand` значений с параметрами значения параметров задаются с помощью коллекции SqlDataSource s `SelectParameters` и могут включать жестко запрограммированные значения, общие значения источника параметров (поля строки запроса, переменные сеанса, значения веб-элементов управления и т. д.), а также могут быть назначены программно.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-123">For `SelectCommand` values with parameters, the parameter values are specified via the SqlDataSource s `SelectParameters` collection and can include hard-coded values, common parameter source values (querystring fields, session variables, Web control values, and so on), or can be programmatically assigned.</span></span> <span data-ttu-id="5cf0f-124">Когда метод `Select()` элемента управления SqlDataSource вызывается программно или автоматически из веб-элемента управления данными, устанавливается соединение с базой данных, значения параметров присваиваются запросу, а команда переключается в базу данных.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-124">When the SqlDataSource control s `Select()` method is invoked either programmatically or automatically from a data Web control a connection to the database is established, the parameter values are assigned to the query, and the command is shuttled off to the database.</span></span> <span data-ttu-id="5cf0f-125">Затем результаты возвращаются как набор данных или DataReader, в зависимости от значения свойства `DataSourceMode` управления.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-125">The results are then returned as either a DataSet or DataReader, depending on the value of the control s `DataSourceMode` property.</span></span>

<span data-ttu-id="5cf0f-126">Помимо выбора данных, элемент управления SqlDataSource можно использовать для вставки, обновления и удаления данных путем предоставления `INSERT`, `UPDATE`и `DELETE` инструкций SQL точно так же.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-126">Along with selecting data, the SqlDataSource control can be used to insert, update, and delete data by supplying `INSERT`, `UPDATE`, and `DELETE` SQL statements in much the same way.</span></span> <span data-ttu-id="5cf0f-127">Просто назначьте `InsertCommand`, `UpdateCommand`и `DeleteCommand` свойства `INSERT`, `UPDATE`и `DELETE` инструкций SQL для выполнения.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-127">Simply assign the `InsertCommand`, `UpdateCommand`, and `DeleteCommand` properties the `INSERT`, `UPDATE`, and `DELETE` SQL statements to execute.</span></span> <span data-ttu-id="5cf0f-128">Если инструкции имеют параметры (как правило, они всегда будут), включите их в коллекции `InsertParameters`, `UpdateParameters`и `DeleteParameters`.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-128">If the statements have parameters (as they most always will), include them in the `InsertParameters`, `UpdateParameters`, and `DeleteParameters` collections.</span></span>

<span data-ttu-id="5cf0f-129">После того как было задано значение `InsertCommand`, `UpdateCommand`или `DeleteCommand`, будет доступен параметр Разрешить вставку, включение редактирования или Включение удаления в соответствующем смарт-теге веб-элемента управления данными.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-129">Once an `InsertCommand`, `UpdateCommand`, or `DeleteCommand` value has been specified, the Enable Inserting, Enable Editing, or Enable Deleting option in the corresponding data Web control s smart tag will become available.</span></span> <span data-ttu-id="5cf0f-130">Чтобы проиллюстрировать это, давайте возьмем пример на странице `Querying.aspx`, созданной в [запросах данных, с помощью учебника по элементу управления SqlDataSource](querying-data-with-the-sqldatasource-control-vb.md) и дополнить его для включения возможностей удаления.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-130">To illustrate this, let s take an example from the `Querying.aspx` page we created in the [Querying Data with the SqlDataSource Control](querying-data-with-the-sqldatasource-control-vb.md) tutorial and augment it to include delete capabilities.</span></span>

<span data-ttu-id="5cf0f-131">Для начала откройте `InsertUpdateDelete.aspx` и `Querying.aspx` страницы из папки `SqlDataSource`.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-131">Start by opening the `InsertUpdateDelete.aspx` and `Querying.aspx` pages from the `SqlDataSource` folder.</span></span> <span data-ttu-id="5cf0f-132">В конструкторе на странице `Querying.aspx` выберите SqlDataSource и GridView из первого примера (элементы управления `ProductsDataSource` и `GridView1`).</span><span class="sxs-lookup"><span data-stu-id="5cf0f-132">From the Designer on the `Querying.aspx` page, select the SqlDataSource and GridView from the first example (the `ProductsDataSource` and `GridView1` controls).</span></span> <span data-ttu-id="5cf0f-133">Выбрав два элемента управления, перейдите в меню Правка и выберите команду Копировать (или просто нажмите клавиши CTRL + C).</span><span class="sxs-lookup"><span data-stu-id="5cf0f-133">After selecting the two controls, go to the Edit menu and choose Copy (or just hit Ctrl+C).</span></span> <span data-ttu-id="5cf0f-134">Затем перейдите в конструктор `InsertUpdateDelete.aspx` и вставьте элементы управления.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-134">Next, go to the Designer of `InsertUpdateDelete.aspx` and paste in the controls.</span></span> <span data-ttu-id="5cf0f-135">После перемещения этих двух элементов управления на `InsertUpdateDelete.aspx`протестируйте страницу в браузере.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-135">After you have moved the two controls over to `InsertUpdateDelete.aspx`, test out the page in a browser.</span></span> <span data-ttu-id="5cf0f-136">Должны отобразиться значения столбцов `ProductID`, `ProductName`и `UnitPrice` для всех записей в таблице `Products` базы данных.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-136">You should see the values of the `ProductID`, `ProductName`, and `UnitPrice` columns for all of the records in the `Products` database table.</span></span>

<span data-ttu-id="5cf0f-137">[![перечислены все продукты, упорядоченные по ProductID](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image1.gif)](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="5cf0f-137">[![All of the Products are Listed, Ordered by ProductID](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image1.gif)](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image1.png)</span></span>

<span data-ttu-id="5cf0f-138">**Рис. 1**. перечисляются все продукты, упорядоченные по `ProductID` ([щелкните, чтобы просмотреть изображение с полным размером](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="5cf0f-138">**Figure 1**: All of the Products are Listed, Ordered by `ProductID` ([Click to view full-size image](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image2.png))</span></span>

## <a name="adding-the-sqldatasource-sdeletecommandanddeleteparametersproperties"></a><span data-ttu-id="5cf0f-139">Добавление свойств SqlDataSource`DeleteCommand`и`DeleteParameters`</span><span class="sxs-lookup"><span data-stu-id="5cf0f-139">Adding the SqlDataSource s`DeleteCommand`and`DeleteParameters`Properties</span></span>

<span data-ttu-id="5cf0f-140">На этом этапе у нас есть средство SqlDataSource, которое просто возвращает все записи из таблицы `Products` и GridView, которое визуализирует эти данные.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-140">At this point we have a SqlDataSource that simply returns all of the records from the `Products` table and a GridView that renders this data.</span></span> <span data-ttu-id="5cf0f-141">Наша цель — расширить этот пример, чтобы позволить пользователю удалять продукты с помощью GridView.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-141">Our goal is to extend this example to allow for the user to delete products via the GridView.</span></span> <span data-ttu-id="5cf0f-142">Для этого необходимо указать значения для параметров управления SqlDataSource `DeleteCommand` и `DeleteParameters`, а затем настроить GridView для поддержки удаления.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-142">To accomplish this we need to specify values for the SqlDataSource control s `DeleteCommand` and `DeleteParameters` properties and then configure the GridView to support deleting.</span></span>

<span data-ttu-id="5cf0f-143">Свойства `DeleteCommand` и `DeleteParameters` можно указать несколькими способами.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-143">The `DeleteCommand` and `DeleteParameters` properties can be specified in a number of ways:</span></span>

- <span data-ttu-id="5cf0f-144">С помощью декларативного синтаксиса</span><span class="sxs-lookup"><span data-stu-id="5cf0f-144">Through the declarative syntax</span></span>
- <span data-ttu-id="5cf0f-145">Из окно свойств в конструкторе</span><span class="sxs-lookup"><span data-stu-id="5cf0f-145">From the Properties window in the Designer</span></span>
- <span data-ttu-id="5cf0f-146">На экране Укажите пользовательскую инструкцию SQL или хранимую процедуру в мастере настройки источника данных</span><span class="sxs-lookup"><span data-stu-id="5cf0f-146">From the Specify a custom SQL statement or stored procedure screen in the Configure Data Source wizard</span></span>
- <span data-ttu-id="5cf0f-147">С помощью кнопки Дополнительно в диалоговом окне укажите столбцы из таблицы представления в мастере настройки источника данных, который автоматически создает инструкцию SQL `DELETE` и коллекцию параметров, используемую в свойствах `DeleteCommand` и `DeleteParameters`</span><span class="sxs-lookup"><span data-stu-id="5cf0f-147">Via the Advanced button in the Specify columns from a table of view screen in the Configure Data Source wizard, which will actually automatically generate the `DELETE` SQL statement and parameter collection used in the `DeleteCommand` and `DeleteParameters` properties</span></span>

<span data-ttu-id="5cf0f-148">Мы рассмотрим, как автоматически создать инструкцию `DELETE`, созданную на шаге 2.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-148">We'll examine how to automatically have the `DELETE` statement created in Step 2.</span></span> <span data-ttu-id="5cf0f-149">Теперь давайте используем окно свойств в конструкторе, несмотря на то, что мастер настройки источника данных или декларативный синтаксис также работает.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-149">For now, let s use the Properties window in the Designer, although the Configure Data Source wizard or declarative syntax option would work just as well.</span></span>

<span data-ttu-id="5cf0f-150">В конструкторе в `InsertUpdateDelete.aspx`щелкните `ProductsDataSource` SqlDataSource, а затем откройте окно свойств (в меню Вид выберите пункт окно свойств или просто нажмите клавишу F4).</span><span class="sxs-lookup"><span data-stu-id="5cf0f-150">From the Designer in `InsertUpdateDelete.aspx`, click on the `ProductsDataSource` SqlDataSource and then bring up the Properties window (from the View menu, choose Properties window, or simply hit F4).</span></span> <span data-ttu-id="5cf0f-151">Выберите свойство Делетекуери, которое будет выделять набор эллипсов.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-151">Select the DeleteQuery property, which will bring up a set of ellipses.</span></span>

![Выберите свойство Делетекуери в окне "Свойства".](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image2.gif)

<span data-ttu-id="5cf0f-153">**Рис. 2**. Выбор свойства Делетекуери в окне "Свойства"</span><span class="sxs-lookup"><span data-stu-id="5cf0f-153">**Figure 2**: Select the DeleteQuery Property from the Properties Window</span></span>

> [!NOTE]
> <span data-ttu-id="5cf0f-154">В SqlDataSource отсутствует свойство Делетекуери.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-154">The SqlDataSource doesn t have a DeleteQuery property.</span></span> <span data-ttu-id="5cf0f-155">Вместо этого Делетекуери является сочетанием свойств `DeleteCommand` и `DeleteParameters` и отображается только в окно свойств при просмотре окна с помощью конструктора.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-155">Rather, DeleteQuery is a combination of the `DeleteCommand` and `DeleteParameters` properties and is only listed in the Properties window when viewing the window through the Designer.</span></span> <span data-ttu-id="5cf0f-156">Если вы просматриваете окно свойств в представлении исходного кода, вместо этого можно найти свойство `DeleteCommand`.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-156">If you are looking at the Properties window in the Source view, you'll find the `DeleteCommand` property instead.</span></span>

<span data-ttu-id="5cf0f-157">Нажмите кнопку с многоточием в свойстве Делетекуери, чтобы открыть диалоговое окно Редактор параметров и команд (см. рис. 3).</span><span class="sxs-lookup"><span data-stu-id="5cf0f-157">Click the ellipses in the DeleteQuery property to bring up the Command and Parameter Editor dialog box (see Figure 3).</span></span> <span data-ttu-id="5cf0f-158">В этом диалоговом окне можно указать `DELETE` инструкции SQL и указать параметры.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-158">From this dialog box you can specify the `DELETE` SQL statement and specify the parameters.</span></span> <span data-ttu-id="5cf0f-159">Введите следующий запрос в текстовое поле `DELETE` команда (вручную или с помощью конструктор запросов, если вы предпочитаете):</span><span class="sxs-lookup"><span data-stu-id="5cf0f-159">Enter the following query into the `DELETE` command textbox (either manually or using the Query Builder, if you prefer):</span></span>

[!code-sql[Main](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/samples/sample1.sql)]

<span data-ttu-id="5cf0f-160">Затем нажмите кнопку обновить параметры, чтобы добавить параметр `@ProductID` в список параметров ниже.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-160">Next, click the Refresh Parameters button to add the `@ProductID` parameter to the list of parameters below.</span></span>

<span data-ttu-id="5cf0f-161">[![выберите свойство Делетекуери в окне "Свойства".](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image3.gif)](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="5cf0f-161">[![Select the DeleteQuery Property from the Properties Window](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image3.gif)](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image3.png)</span></span>

<span data-ttu-id="5cf0f-162">**Рис. 3**. Выбор свойства Делетекуери в окне "Свойства" ([щелкните, чтобы просмотреть изображение с полным размером](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="5cf0f-162">**Figure 3**: Select the DeleteQuery Property from the Properties Window ([Click to view full-size image](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image4.png))</span></span>

<span data-ttu-id="5cf0f-163">*Не* указывайте значение для этого параметра (оставьте его источник параметров без изменений).</span><span class="sxs-lookup"><span data-stu-id="5cf0f-163">Do *not* provide a value for this parameter (leave its Parameter source at None ).</span></span> <span data-ttu-id="5cf0f-164">Когда мы добавим поддержку удаления в GridView, GridView автоматически предоставит значение этого параметра, используя значение его `DataKeys` коллекции для строки, для которой была нажата кнопка Delete (удалить).</span><span class="sxs-lookup"><span data-stu-id="5cf0f-164">Once we add deleting support to the GridView, the GridView will automatically supply this parameter value, using the value of its `DataKeys` collection for the row whose Delete button was clicked.</span></span>

> [!NOTE]
> <span data-ttu-id="5cf0f-165">Имя параметра, используемое в запросе `DELETE`, *должно* совпадать с именем `DataKeyNames` значения в GridView, DetailsView или FormView.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-165">The parameter name used in the `DELETE` query *must* be the same as the name of the `DataKeyNames` value in the GridView, DetailsView, or FormView.</span></span> <span data-ttu-id="5cf0f-166">Это значит, что параметр в операторе `DELETE` намеренно с именем `@ProductID` (вместо, скажем, `@ID`), так как имя первичного ключевого столбца в таблице Products (и, следовательно, значение DataKeyNames в GridView) `ProductID`.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-166">That is, the parameter in the `DELETE` statement is purposefully named `@ProductID` (instead of, say, `@ID`), because the primary key column name in the Products table (and therefore the DataKeyNames value in the GridView) is `ProductID`.</span></span>

<span data-ttu-id="5cf0f-167">Если имя параметра и значение `DataKeyNames` не совпадают, GridView не может автоматически присвоить параметру значение из коллекции `DataKeys`.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-167">If the parameter name and `DataKeyNames` value doesn t match, the GridView cannot automatically assign the parameter the value from the `DataKeys` collection.</span></span>

<span data-ttu-id="5cf0f-168">После ввода сведений об удалении в диалоговом окне Редактор параметров и команд нажмите кнопку ОК и перейдите к представлению исходного кода, чтобы просмотреть полученную декларативную разметку.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-168">After entering the delete-related information into the Command and Parameter Editor dialog box click OK and go to the Source view to examine the resulting declarative markup:</span></span>

[!code-aspx[Main](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/samples/sample2.aspx)]

<span data-ttu-id="5cf0f-169">Обратите внимание на добавление свойства `DeleteCommand`, а также раздела `<DeleteParameters>` и объекта параметра с именем `productID`.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-169">Note the addition of the `DeleteCommand` property as well as the `<DeleteParameters>` section and the Parameter object named `productID`.</span></span>

## <a name="configuring-the-gridview-for-deleting"></a><span data-ttu-id="5cf0f-170">Настройка элемента GridView для удаления</span><span class="sxs-lookup"><span data-stu-id="5cf0f-170">Configuring the GridView for Deleting</span></span>

<span data-ttu-id="5cf0f-171">После добавления свойства `DeleteCommand` смарт-тег GridView s теперь содержит параметр Включить удаление.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-171">With the `DeleteCommand` property added, the GridView s smart tag now contains the Enable Deleting option.</span></span> <span data-ttu-id="5cf0f-172">Установите этот флажок.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-172">Go ahead and check this checkbox.</span></span> <span data-ttu-id="5cf0f-173">Как обсуждалось в [обзоре вставки, обновления и удаления](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md), GridView добавляет CommandField со свойством `ShowDeleteButton`, имеющим значение `True`.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-173">As discussed in [An Overview of Inserting, Updating, and Deleting](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md), this causes the GridView to add a CommandField with its `ShowDeleteButton` property set to `True`.</span></span> <span data-ttu-id="5cf0f-174">Как показано на рис. 4, при посещении страницы через браузер включается кнопка Удалить.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-174">As Figure 4 shows, when the page is visited through a browser a Delete button is included.</span></span> <span data-ttu-id="5cf0f-175">Протестируйте эту страницу, удалив некоторые продукты.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-175">Test this page out by deleting some products.</span></span>

<span data-ttu-id="5cf0f-176">[![каждая строка GridView теперь содержит кнопку "Удалить"](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image4.gif)](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="5cf0f-176">[![Each GridView Row Now Includes a Delete Button](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image4.gif)](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image5.png)</span></span>

<span data-ttu-id="5cf0f-177">**Рис. 4**. Теперь каждая строка GridView содержит кнопку «Удалить» ([щелкните, чтобы просмотреть изображение с полным размером](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image6.png)).</span><span class="sxs-lookup"><span data-stu-id="5cf0f-177">**Figure 4**: Each GridView Row Now Includes a Delete Button ([Click to view full-size image](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image6.png))</span></span>

<span data-ttu-id="5cf0f-178">При нажатии кнопки удалить происходит обратная передача, GridView присваивает параметру `ProductID` значение `DataKeys` коллекции для строки, на которую была нажата кнопка Delete, и вызывает метод SqlDataSource `Delete()`.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-178">Upon clicking a Delete button, a postback occurs, the GridView assigns the `ProductID` parameter the value of the `DataKeys` collection value for the row whose Delete button was clicked, and invokes the SqlDataSource s `Delete()` method.</span></span> <span data-ttu-id="5cf0f-179">Затем элемент управления SqlDataSource подключается к базе данных и выполняет инструкцию `DELETE`.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-179">The SqlDataSource control then connects to the database and executes the `DELETE` statement.</span></span> <span data-ttu-id="5cf0f-180">Затем GridView выполняет повторную привязку к SqlDataSource, получая и отображая текущий набор продуктов (который больше не включает в себя только что удаленную запись).</span><span class="sxs-lookup"><span data-stu-id="5cf0f-180">The GridView then rebinds to the SqlDataSource, getting back and displaying the current set of products (which no longer includes the just-deleted record).</span></span>

> [!NOTE]
> <span data-ttu-id="5cf0f-181">Поскольку GridView использует коллекцию `DataKeys` для заполнения параметров SqlDataSource, крайне важно, чтобы свойство GridView s `DataKeyNames` было установлено равным столбцам, составляющим первичный ключ, а в SqlDataSource s `SelectCommand` возвращать эти столбцы.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-181">Since the GridView uses its `DataKeys` collection to populate the SqlDataSource parameters, it s vital that the GridView s `DataKeyNames` property be set to the column(s) that constitute the primary key and that the SqlDataSource s `SelectCommand` returns these columns.</span></span> <span data-ttu-id="5cf0f-182">Более того, важно, чтобы имя параметра в SqlDataSource s `DeleteCommand` было установлено в `@ProductID`.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-182">Moreover, it s important that the parameter name in the SqlDataSource s `DeleteCommand` is set to `@ProductID`.</span></span> <span data-ttu-id="5cf0f-183">Если свойство `DataKeyNames` не задано или параметр не имеет имя `@ProductsID`, нажатие кнопки удалить вызовет обратную передачу, но фактически не удаляет записи.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-183">If the `DataKeyNames` property is not set or the parameter is not named `@ProductsID`, clicking the Delete button will cause a postback, but won't actually delete any record.</span></span>

<span data-ttu-id="5cf0f-184">На рис. 5 показано графическое взаимодействие.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-184">Figure 5 depicts this interaction graphically.</span></span> <span data-ttu-id="5cf0f-185">Дополнительные сведения о цепочке событий, связанных с вставкой, обновлением и удалением из веб-элемента управления данными, см. в статье [изучение событий, связанных с вставкой, обновлением и удалением](../editing-inserting-and-deleting-data/examining-the-events-associated-with-inserting-updating-and-deleting-vb.md) руководства.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-185">Refer back to the [Examining the Events Associated with Inserting, Updating, and Deleting](../editing-inserting-and-deleting-data/examining-the-events-associated-with-inserting-updating-and-deleting-vb.md) tutorial for a more detailed discussion on the chain of events associated with inserting, updating, and deleting from a data Web control.</span></span>

![При нажатии кнопки "Удалить" в GridView вызывается метод SqlDataSource s Delete ().](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image5.gif)

<span data-ttu-id="5cf0f-187">**Рис. 5**. нажатие кнопки Delete в GridView вызывает метод SqlDataSource `Delete()`</span><span class="sxs-lookup"><span data-stu-id="5cf0f-187">**Figure 5**: Clicking the Delete Button in the GridView Invokes the SqlDataSource s `Delete()` Method</span></span>

## <a name="step-2-automatically-generating-theinsertupdate-anddeletestatements"></a><span data-ttu-id="5cf0f-188">Шаг 2. Автоматическое создание`INSERT`,`UPDATE`и инструкций`DELETE`</span><span class="sxs-lookup"><span data-stu-id="5cf0f-188">Step 2: Automatically Generating the`INSERT`,`UPDATE`, and`DELETE`Statements</span></span>

<span data-ttu-id="5cf0f-189">На шаге 1 проверены, `INSERT`, `UPDATE`и `DELETE` инструкции SQL можно указать с помощью декларативного синтаксиса окно свойств или Control.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-189">As Step 1 examined, `INSERT`, `UPDATE`, and `DELETE` SQL statements can be specified through the Properties window or the control s declarative syntax.</span></span> <span data-ttu-id="5cf0f-190">Однако этот подход требует, чтобы вручную написать инструкции SQL, которые могут быть монотонную и подвержены ошибкам.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-190">However, this approach requires that we manually write out the SQL statements by hand, which can be monotonous and error-prone.</span></span> <span data-ttu-id="5cf0f-191">К счастью, мастер настройки источников данных предоставляет возможность автоматического создания `INSERT`, `UPDATE`и `DELETE` инструкций при использовании окна указать столбцы из таблицы представления.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-191">Fortunately, the Configure Data Source wizard provides an option to have the `INSERT`, `UPDATE`, and `DELETE` statements automatically generated when using the Specify columns from a table of view screen.</span></span>

<span data-ttu-id="5cf0f-192">Давайте рассмотрим этот вариант автоматического создания.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-192">Let s explore this automatic generation option.</span></span> <span data-ttu-id="5cf0f-193">Добавьте элемент DetailsView в конструктор в `InsertUpdateDelete.aspx` и задайте для его свойства `ID` значение `ManageProducts`.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-193">Add a DetailsView to the Designer in `InsertUpdateDelete.aspx` and set its `ID` property to `ManageProducts`.</span></span> <span data-ttu-id="5cf0f-194">Затем в смарт-теге DetailsView s выберите Создание нового источника данных и создание SqlDataSource с именем `ManageProductsDataSource`.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-194">Next, from the DetailsView s smart tag, choose to create a new data source and create a SqlDataSource named `ManageProductsDataSource`.</span></span>

<span data-ttu-id="5cf0f-195">[![создать новый элемент SqlDataSource с именем Манажепродуктсдатасаурце](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image6.gif)](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="5cf0f-195">[![Create a New SqlDataSource Named ManageProductsDataSource](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image6.gif)](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image7.png)</span></span>

<span data-ttu-id="5cf0f-196">**Рис. 6**. Создание нового SqlDataSource с именем `ManageProductsDataSource` ([щелкните, чтобы просмотреть изображение с полным размером](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="5cf0f-196">**Figure 6**: Create a New SqlDataSource Named `ManageProductsDataSource` ([Click to view full-size image](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image8.png))</span></span>

<span data-ttu-id="5cf0f-197">В мастере настройки источника данных выберите использовать строку подключения `NORTHWINDConnectionString` и нажмите кнопку Далее.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-197">From the Configure Data Source wizard, opt to use the `NORTHWINDConnectionString` connection string and click Next.</span></span> <span data-ttu-id="5cf0f-198">На экране Настройка инструкции SELECT оставьте переключатель Укажите столбцы из таблицы или представления выбранным и выберите `Products` таблицу из раскрывающегося списка.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-198">From the Configure the Select Statement screen, leave the Specify columns from a table or view radio button selected and pick the `Products` table from the drop-down list.</span></span> <span data-ttu-id="5cf0f-199">Выберите столбцы `ProductID`, `ProductName`, `UnitPrice`и `Discontinued` из списка флажков.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-199">Select the `ProductID`, `ProductName`, `UnitPrice`, and `Discontinued` columns from the checkbox list.</span></span>

<span data-ttu-id="5cf0f-200">[![использовании таблицы Products, возвращающей столбцы ProductID, ProductName, UnitPrice и неподдерживаемые](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image7.gif)](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="5cf0f-200">[![Using the Products Table, Return the ProductID, ProductName, UnitPrice, and Discontinued Columns](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image7.gif)](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image9.png)</span></span>

<span data-ttu-id="5cf0f-201">**Рис. 7**. Использование `Products` таблицы для получения `ProductID`, `ProductName`, `UnitPrice`и `Discontinued` столбцов (щелкните,[чтобы просмотреть изображение с полным размером](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="5cf0f-201">**Figure 7**: Using the `Products` Table, Return the `ProductID`, `ProductName`, `UnitPrice`, and `Discontinued` Columns ([Click to view full-size image](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image10.png))</span></span>

<span data-ttu-id="5cf0f-202">Чтобы автоматически создать инструкции `INSERT`, `UPDATE`и `DELETE` на основе выбранной таблицы и столбцов, нажмите кнопку Дополнительно и установите флажок Создать `INSERT`, `UPDATE`и инструкции `DELETE`.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-202">To automatically generate `INSERT`, `UPDATE`, and `DELETE` statements based on the selected table and columns, click the Advanced button and check the Generate `INSERT`, `UPDATE`, and `DELETE` statements checkbox.</span></span>

![Установите флажок Создать инструкции INSERT, UPDATE и DELETE.](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image8.gif)

<span data-ttu-id="5cf0f-204">**Рис. 8**. флажок создания инструкций `INSERT`, `UPDATE`и `DELETE`</span><span class="sxs-lookup"><span data-stu-id="5cf0f-204">**Figure 8**: Check the Generate `INSERT`, `UPDATE`, and `DELETE` statements Checkbox</span></span>

<span data-ttu-id="5cf0f-205">Флажок Создать `INSERT`, `UPDATE`и `DELETE` будет доступен только в том случае, если выбранная таблица имеет первичный ключ, а столбец первичного ключа (или столбцы) включается в список возвращаемых столбцов.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-205">The Generate `INSERT`, `UPDATE`, and `DELETE` statements checkbox will only be checkable if the table selected has a primary key and the primary key column (or columns) are included in the list of returned columns.</span></span> <span data-ttu-id="5cf0f-206">Флажок использовать оптимистичный параллелизм, который становится выбираемым после установки флажка создать `INSERT`, `UPDATE`и `DELETE`, дополняет предложения `WHERE` в результирующих `UPDATE` и инструкциях `DELETE` для обеспечения управления оптимистичным параллелизмом.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-206">The Use optimistic concurrency checkbox, which becomes selectable once the Generate `INSERT`, `UPDATE`, and `DELETE` statements checkbox has been checked, will augment the `WHERE` clauses in the resulting `UPDATE` and `DELETE` statements to provide optimistic concurrency control.</span></span> <span data-ttu-id="5cf0f-207">Пока не устанавливайте этот флажок. в следующем руководстве мы рассмотрим оптимистичный параллелизм с помощью элемента управления SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-207">For now, leave this checkbox unchecked; we'll examine optimistic concurrency with the SqlDataSource control in the next tutorial.</span></span>

<span data-ttu-id="5cf0f-208">После установки флажка создать `INSERT`, `UPDATE`и `DELETE` нажмите кнопку ОК, чтобы вернуться на экран Настройка инструкции SELECT, затем нажмите кнопку Далее, а затем Готово, чтобы завершить работу мастера настройки источника данных.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-208">After checking the Generate `INSERT`, `UPDATE`, and `DELETE` statements checkbox, click OK to return to the Configure Select Statement screen, then click Next, and then Finish, to complete the Configure Data Source wizard.</span></span> <span data-ttu-id="5cf0f-209">После завершения работы мастера Visual Studio добавит BoundFields в элемент DetailsView для столбцов `ProductID`, `ProductName`и `UnitPrice` и CheckBoxField для столбца `Discontinued`.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-209">Upon completing the wizard, Visual Studio will add BoundFields to the DetailsView for the `ProductID`, `ProductName`, and `UnitPrice` columns and a CheckBoxField for the `Discontinued` column.</span></span> <span data-ttu-id="5cf0f-210">В смарт-теге DetailsView s установите флажок Включить разбиение на страницы, чтобы пользователь, который посещает эту страницу, мог пошагово пройти по продуктам.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-210">From the DetailsView s smart tag, check the Enable Paging option so that the user visiting this page can step through the products.</span></span> <span data-ttu-id="5cf0f-211">Также очистите свойства `Width` и `Height` DetailsView.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-211">Also clear out the DetailsView s `Width` and `Height` properties.</span></span>

<span data-ttu-id="5cf0f-212">Обратите внимание, что смарт-тег включает параметры Включить вставку, включить редактирование и разрешить удаление.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-212">Notice that the smart tag has the Enable Inserting, Enable Editing, and Enable Deleting options available.</span></span> <span data-ttu-id="5cf0f-213">Это обусловлено тем, что SqlDataSource содержит значения для его `InsertCommand`, `UpdateCommand`и `DeleteCommand`, как показано в следующем декларативном синтаксисе:</span><span class="sxs-lookup"><span data-stu-id="5cf0f-213">This is because the SqlDataSource contains values for its `InsertCommand`, `UpdateCommand`, and `DeleteCommand`, as the following declarative syntax shows:</span></span>

[!code-aspx[Main](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/samples/sample3.aspx)]

<span data-ttu-id="5cf0f-214">Обратите внимание, что значения элемента управления SqlDataSource автоматически задаются для свойств `InsertCommand`, `UpdateCommand`и `DeleteCommand`.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-214">Note how the SqlDataSource control has had values automatically set for its `InsertCommand`, `UpdateCommand`, and `DeleteCommand` properties.</span></span> <span data-ttu-id="5cf0f-215">Набор столбцов, упоминаемых в свойствах `InsertCommand` и `UpdateCommand`, основан на значениях в инструкции `SELECT`.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-215">The set of columns referenced in the `InsertCommand` and `UpdateCommand` properties are based on those in the `SELECT` statement.</span></span> <span data-ttu-id="5cf0f-216">То есть, вместо того чтобы *каждый* столбец Products в `InsertCommand` и `UpdateCommand`, были указаны только столбцы `SelectCommand` (меньше `ProductID`, что опускается, так как это [столбец`IDENTITY`](http://www.sqlteam.com/item.asp?ItemID=102), значение которого не может быть изменено при редактировании и которое автоматически назначается при вставке).</span><span class="sxs-lookup"><span data-stu-id="5cf0f-216">That is, rather than having *every* Products column in the `InsertCommand` and `UpdateCommand`, there are only those columns specified in the `SelectCommand` (less `ProductID`, which is omitted because it s an [`IDENTITY` column](http://www.sqlteam.com/item.asp?ItemID=102), whose value cannot be changed when edited and which is automatically assigned when inserting).</span></span> <span data-ttu-id="5cf0f-217">Кроме того, для каждого параметра в свойствах `InsertCommand`, `UpdateCommand`и `DeleteCommand` существуют соответствующие параметры в коллекциях `InsertParameters`, `UpdateParameters`и `DeleteParameters`.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-217">Moreover, for each parameter in the `InsertCommand`, `UpdateCommand`, and `DeleteCommand` properties there are corresponding parameters in the `InsertParameters`, `UpdateParameters`, and `DeleteParameters` collections.</span></span>

<span data-ttu-id="5cf0f-218">Чтобы включить функции изменения данных DetailsView, установите флажок Включить вставку, включить редактирование и включить параметры удаления в смарт-теге.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-218">To turn on the DetailsView s data modification features, check the Enable Inserting, Enable Editing, and Enable Deleting options in its smart tag.</span></span> <span data-ttu-id="5cf0f-219">При этом добавляется CommandField со свойствами `ShowInsertButton`, `ShowEditButton`и `ShowDeleteButton`, для которых задано значение `True`.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-219">This adds a CommandField with its `ShowInsertButton`, `ShowEditButton`, and `ShowDeleteButton` properties set to `True`.</span></span>

<span data-ttu-id="5cf0f-220">Откройте страницу в браузере и обратите внимание на кнопки Правка, удалить и новые, входящие в элемент DetailsView.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-220">Visit the page in a browser and note the Edit, Delete, and New buttons included in the DetailsView.</span></span> <span data-ttu-id="5cf0f-221">При нажатии кнопки "Изменить" элемент DetailsView переводится в режим редактирования, в котором отображаются все BoundField, свойство `ReadOnly` которых имеет значение `False` (по умолчанию) в качестве текстового поля, а CheckBoxField — как CheckBox.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-221">Clicking the Edit button turns the DetailsView into edit mode, which displays each BoundField whose `ReadOnly` property is set to `False` (the default) as a TextBox, and the CheckBoxField as a checkbox.</span></span>

<span data-ttu-id="5cf0f-222">[![интерфейс редактирования по умолчанию DetailsView s](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image9.gif)](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="5cf0f-222">[![The DetailsView s Default Editing Interface](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image9.gif)](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image11.png)</span></span>

<span data-ttu-id="5cf0f-223">**Рис. 9**. интерфейс редактирования по умолчанию DetailsView s ([щелкните, чтобы просмотреть изображение с полным размером](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="5cf0f-223">**Figure 9**: The DetailsView s Default Editing Interface ([Click to view full-size image](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image12.png))</span></span>

<span data-ttu-id="5cf0f-224">Аналогичным образом можно удалить текущий выбранный продукт или добавить новый продукт в систему.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-224">Similarly, you can delete the currently selected product or add a new product to the system.</span></span> <span data-ttu-id="5cf0f-225">Так как инструкция `InsertCommand` работает только с столбцами `ProductName`, `UnitPrice`и `Discontinued`, другие столбцы имеют либо `NULL`, либо значения по умолчанию, назначенные базой данных при вставке.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-225">Since the `InsertCommand` statement only works with the `ProductName`, `UnitPrice`, and `Discontinued` columns, the other columns have either `NULL` or their default value assigned by the database upon insert.</span></span> <span data-ttu-id="5cf0f-226">Как и в случае с ObjectDataSource, если в `InsertCommand` отсутствуют столбцы таблицы базы данных, которые не позволяют `NULL` s и Дон t не имеют значения по умолчанию, то при попытке выполнить инструкцию `INSERT` произойдет ошибка SQL.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-226">Just like with the ObjectDataSource, if the `InsertCommand` is missing any database table columns that don t allow `NULL` s and don t have a default value, a SQL error will occur when attempting to execute the `INSERT` statement.</span></span>

> [!NOTE]
> <span data-ttu-id="5cf0f-227">В интерфейсах вставки и редактирования DetailsView s отсутствует настройка или проверка.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-227">The DetailsView s inserting and editing interfaces lack any sort of customization or validation.</span></span> <span data-ttu-id="5cf0f-228">Чтобы добавить элементы управления проверки или настроить интерфейсы, необходимо преобразовать BoundFields в полей TemplateField.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-228">To add validation controls or to customize the interfaces, you need to convert the BoundFields to TemplateFields.</span></span> <span data-ttu-id="5cf0f-229">Дополнительные сведения см. в разделе [Добавление элементов управления проверки в интерфейсы правки и вставки](../editing-inserting-and-deleting-data/adding-validation-controls-to-the-editing-and-inserting-interfaces-vb.md) и настройка в учебниках по [интерфейсу изменения данных](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) .</span><span class="sxs-lookup"><span data-stu-id="5cf0f-229">Refer to the [Adding Validation Controls to the Editing and Inserting Interfaces](../editing-inserting-and-deleting-data/adding-validation-controls-to-the-editing-and-inserting-interfaces-vb.md) and [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) tutorials for more information.</span></span>

<span data-ttu-id="5cf0f-230">Кроме того, обратите внимание, что для обновления и удаления элемент DetailsView использует текущее значение Product `DataKey`, которое имеется только в том случае, если настроено свойство `DataKeyNames`.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-230">Also, keep in mind that for updating and deleting, the DetailsView uses the current product s `DataKey` value, which is only present if the `DataKeyNames` property is configured.</span></span> <span data-ttu-id="5cf0f-231">Если изменение или удаление не оказывает никакого влияния, убедитесь, что задано свойство `DataKeyNames`.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-231">If editing or deleting appears to have no effect, ensure that the `DataKeyNames` property is set.</span></span>

## <a name="limitations-of-automatically-generating-sql-statements"></a><span data-ttu-id="5cf0f-232">Ограничения автоматического создания инструкций SQL</span><span class="sxs-lookup"><span data-stu-id="5cf0f-232">Limitations of Automatically Generating SQL Statements</span></span>

<span data-ttu-id="5cf0f-233">Поскольку параметр Generate `INSERT`, `UPDATE`и `DELETE` доступен только при выборе столбцов из таблицы, для более сложных запросов необходимо написать собственные `INSERT`, `UPDATE`и инструкции `DELETE`, как в шаге 1.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-233">Since the Generate `INSERT`, `UPDATE`, and `DELETE` statements option is only available when picking columns from a table, for more complex queries you will have to write your own `INSERT`, `UPDATE`, and `DELETE` statements like we did in Step 1.</span></span> <span data-ttu-id="5cf0f-234">Как правило, инструкции SQL `SELECT` используют `JOIN` s для возврата данных из одной или нескольких таблиц подстановки в целях отображения (например, при возврате поля `Categories` таблицы с `CategoryName` при отображении сведений о продукте).</span><span class="sxs-lookup"><span data-stu-id="5cf0f-234">Commonly, SQL `SELECT` statements use `JOIN` s to bring back data from one or more lookup tables for display purposes (such as bringing back the `Categories` table s `CategoryName` field when displaying product information).</span></span> <span data-ttu-id="5cf0f-235">В то же время может потребоваться разрешить пользователю изменять, обновлять или вставлять данные в основную таблицу (`Products`, в данном случае).</span><span class="sxs-lookup"><span data-stu-id="5cf0f-235">At the same time, we might want to allow the user to edit, update, or insert data into the core table (`Products`, in this case).</span></span>

<span data-ttu-id="5cf0f-236">Хотя инструкции `INSERT`, `UPDATE`и `DELETE` можно указать вручную, рассмотрите следующий совет по экономии времени.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-236">While the `INSERT`, `UPDATE`, and `DELETE` statements can be entered manually, consider the following time-saving tip.</span></span> <span data-ttu-id="5cf0f-237">Сначала настройте SqlDataSource таким образом, чтобы он запрашивает обратно данные только из таблицы `Products`.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-237">Initially setup the SqlDataSource so that it pulls back data just from the `Products` table.</span></span> <span data-ttu-id="5cf0f-238">С помощью мастера настройки источника данных укажите столбцы из окна таблицы или представления, чтобы можно было автоматически создавать `INSERT`, `UPDATE`и операторы `DELETE`.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-238">Use the Configure Data Source wizard s Specify columns from a table or view screen so that you can automatically generate the `INSERT`, `UPDATE`, and `DELETE` statements.</span></span> <span data-ttu-id="5cf0f-239">После завершения работы мастера выберите настройку Селекткуери из окно свойств (или, Кроме того, вернитесь к мастеру настройки источника данных, но используйте параметр указать пользовательскую инструкцию SQL или хранимую процедуру).</span><span class="sxs-lookup"><span data-stu-id="5cf0f-239">Then, after completing the wizard, choose to configure the SelectQuery from the Properties window (or, alternatively, go back to the Configure Data Source wizard, but use the Specify a custom SQL statement or stored procedure option).</span></span> <span data-ttu-id="5cf0f-240">Затем обновите инструкцию `SELECT`, включив в нее синтаксис `JOIN`.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-240">Then update the `SELECT` statement to include the `JOIN` syntax.</span></span> <span data-ttu-id="5cf0f-241">Этот метод позволяет экономить время на основе автоматически создаваемых инструкций SQL и предоставляет более настраиваемую инструкцию `SELECT`.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-241">This technique offers the time-saving benefits of the automatically generated SQL statements and allows for a more customized `SELECT` statement.</span></span>

<span data-ttu-id="5cf0f-242">Еще одно ограничение автоматического создания `INSERT`, `UPDATE`и `DELETE` инструкций заключается в том, что столбцы в инструкциях `INSERT` и `UPDATE` основаны на столбцах, возвращаемых инструкцией `SELECT`.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-242">Another limitation of automatically generating the `INSERT`, `UPDATE`, and `DELETE` statements is that the columns in the `INSERT` and `UPDATE` statements are based on the columns returned by the `SELECT` statement.</span></span> <span data-ttu-id="5cf0f-243">Однако может потребоваться обновить или вставить больше или меньше полей.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-243">We may need to update or insert more or fewer fields, however.</span></span> <span data-ttu-id="5cf0f-244">Например, в примере на шаге 2 может потребоваться, чтобы `UnitPrice` BoundField быть доступны только для чтения.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-244">For example, in the example from Step 2, maybe we want to have the `UnitPrice` BoundField be read-only.</span></span> <span data-ttu-id="5cf0f-245">В этом случае он не должен отображаться в `UpdateCommand`.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-245">In that case, it shouldn't appear in the `UpdateCommand`.</span></span> <span data-ttu-id="5cf0f-246">Или нам может потребоваться задать значение поля таблицы, которое не отображается в GridView.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-246">Or we may want to set the value of a table field that does not appear in the GridView.</span></span> <span data-ttu-id="5cf0f-247">Например, при добавлении новой записи может потребоваться задать для `QuantityPerUnit` значение TODO.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-247">For example, when adding a new record we may want the `QuantityPerUnit` value set to TODO .</span></span>

<span data-ttu-id="5cf0f-248">Если такие настройки необходимы, их необходимо сделать вручную либо с помощью окно свойств, в мастере Укажите настраиваемую инструкцию SQL или параметр хранимой процедуры или с помощью декларативного синтаксиса.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-248">If such customizations are required, you need to make them manually, either through the Properties window, the Specify a custom SQL statement or stored procedure option in the wizard, or via the declarative syntax.</span></span>

> [!NOTE]
> <span data-ttu-id="5cf0f-249">При добавлении параметров, не имеющих соответствующих полей в веб-элементе управления данными, помните, что значения этих параметров должны быть назначены определенным образом.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-249">When adding parameters that do not have corresponding fields in the data Web control, keep in mind that these parameters values will need to be assigned values in some manner.</span></span> <span data-ttu-id="5cf0f-250">Эти значения могут быть жестко запрограммированы непосредственно в `InsertCommand` или `UpdateCommand`; может поступать из некоторого заранее определенного источника (строки запроса, состояния сеанса, веб-элементов управления на странице и т. д.); или могут быть назначены программно, как было показано в предыдущем руководстве.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-250">These values can be: hard-coded directly in the `InsertCommand` or `UpdateCommand`; can come from some pre-defined source (the querystring, session state, Web controls on the page, and so on); or can be assigned programmatically, as we saw in the preceding tutorial.</span></span>

## <a name="summary"></a><span data-ttu-id="5cf0f-251">Сводка</span><span class="sxs-lookup"><span data-stu-id="5cf0f-251">Summary</span></span>

<span data-ttu-id="5cf0f-252">Чтобы веб-элементы управления данными могли использовать встроенные возможности вставки, редактирования и удаления, элемент управления источника данных, к которому они привязаны, должен предоставить такую функциональность.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-252">In order for the data Web controls to utilize their built-in inserting, editing, and deleting capabilities, the data source control they are bound to must offer such functionality.</span></span> <span data-ttu-id="5cf0f-253">Для SqlDataSource это означает, что `INSERT`, `UPDATE`и `DELETE` инструкции SQL должны быть назначены свойствам `InsertCommand`, `UpdateCommand`и `DeleteCommand`.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-253">For the SqlDataSource, this means that `INSERT`, `UPDATE`, and `DELETE` SQL statements must be assigned to the `InsertCommand`, `UpdateCommand`, and `DeleteCommand` properties.</span></span> <span data-ttu-id="5cf0f-254">Эти свойства и соответствующие коллекции параметров можно добавить вручную или создать автоматически с помощью мастера настройки источника данных.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-254">These properties, and the corresponding parameters collections, can be added manually or generated automatically through the Configure Data Source wizard.</span></span> <span data-ttu-id="5cf0f-255">В этом учебнике мы рассмотрели обе методики.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-255">In this tutorial we examined both techniques.</span></span>

<span data-ttu-id="5cf0f-256">Мы рассматривали использование оптимистичного параллелизма с ObjectDataSource в учебнике [реализация оптимистичного параллелизма](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-vb.md) .</span><span class="sxs-lookup"><span data-stu-id="5cf0f-256">We examined using optimistic concurrency with the ObjectDataSource in the [Implementing Optimistic Concurrency](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-vb.md) tutorial.</span></span> <span data-ttu-id="5cf0f-257">Элемент управления SqlDataSource также обеспечивает поддержку оптимистичного параллелизма.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-257">The SqlDataSource control also provides optimistic concurrency support.</span></span> <span data-ttu-id="5cf0f-258">Как отмечалось на шаге 2, при автоматическом создании `INSERT`, `UPDATE`и инструкций `DELETE` мастер предлагает параметр использовать оптимистичный параллелизм.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-258">As noted in Step 2, when automatically generating the `INSERT`, `UPDATE`, and `DELETE` statements, the wizard offers a Use optimistic concurrency option.</span></span> <span data-ttu-id="5cf0f-259">Как мы увидим в следующем руководстве, использование оптимистичного параллелизма с помощью SqlDataSource изменяет `WHERE`ные предложения в инструкциях `UPDATE` и `DELETE`, чтобы гарантировать, что значения других столбцов не изменялись с момента последнего отображения данных на странице.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-259">As we'll see in the next tutorial, using optimistic concurrency with the SqlDataSource modifies the `WHERE` clauses in the `UPDATE` and `DELETE` statements to ensure that the values for the other columns haven't changed since the data was last displayed on the page.</span></span>

<span data-ttu-id="5cf0f-260">Поздравляем с программированием!</span><span class="sxs-lookup"><span data-stu-id="5cf0f-260">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="5cf0f-261">Об авторе</span><span class="sxs-lookup"><span data-stu-id="5cf0f-261">About the Author</span></span>

<span data-ttu-id="5cf0f-262">[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи книг по ASP/ASP. NET и основатель [4GuysFromRolla.com](http://www.4guysfromrolla.com), работал с веб-технологиями Майкрософт с 1998.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-262">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="5cf0f-263">Скотт работает как независимый консультант, преподаватель и модуль записи.</span><span class="sxs-lookup"><span data-stu-id="5cf0f-263">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="5cf0f-264">Его последняя книга — [*Sams обучать себя ASP.NET 2,0 за 24 часа*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="5cf0f-264">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="5cf0f-265">Он доступен по адресу [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="5cf0f-265">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="5cf0f-266">или через его блог, который можно найти по адресу [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="5cf0f-266">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="5cf0f-267">[Назад](using-parameterized-queries-with-the-sqldatasource-vb.md)
> [Вперед](implementing-optimistic-concurrency-with-the-sqldatasource-vb.md)</span><span class="sxs-lookup"><span data-stu-id="5cf0f-267">[Previous](using-parameterized-queries-with-the-sqldatasource-vb.md)
[Next](implementing-optimistic-concurrency-with-the-sqldatasource-vb.md)</span></span>
