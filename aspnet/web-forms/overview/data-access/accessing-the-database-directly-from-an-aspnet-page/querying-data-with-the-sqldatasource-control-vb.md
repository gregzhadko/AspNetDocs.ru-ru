---
uid: web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/querying-data-with-the-sqldatasource-control-vb
title: Запрос данных с помощью элемента управления SqlDataSource (VB) | Документация Майкрософт
author: rick-anderson
description: В предыдущих учебных курсах мы использовали элемент управления ObjectDataSource, чтобы полностью отделить уровень представления от уровня доступа к данным. Начиная с этого учебного...
ms.author: riande
ms.date: 02/20/2007
ms.assetid: b12f752d-3502-40a4-b695-fc7b7d08cfd3
msc.legacyurl: /web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/querying-data-with-the-sqldatasource-control-vb
msc.type: authoredcontent
ms.openlocfilehash: 199ddb46e877c3a0937672d33241a240660684da
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/28/2019
ms.locfileid: "74606029"
---
# <a name="querying-data-with-the-sqldatasource-control-vb"></a><span data-ttu-id="f3a17-104">Запрос данных с помощью элемента управления SqlDataSource (VB)</span><span class="sxs-lookup"><span data-stu-id="f3a17-104">Querying Data with the SqlDataSource Control (VB)</span></span>

<span data-ttu-id="f3a17-105">по [Скотт Митчелл](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="f3a17-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="f3a17-106">[Скачивание примера приложения](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_47_VB.exe) или [Загрузка PDF-файла](querying-data-with-the-sqldatasource-control-vb/_static/datatutorial47vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="f3a17-106">[Download Sample App](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_47_VB.exe) or [Download PDF](querying-data-with-the-sqldatasource-control-vb/_static/datatutorial47vb1.pdf)</span></span>

> <span data-ttu-id="f3a17-107">В предыдущих учебных курсах мы использовали элемент управления ObjectDataSource, чтобы полностью отделить уровень представления от уровня доступа к данным.</span><span class="sxs-lookup"><span data-stu-id="f3a17-107">In the preceding tutorials we used the ObjectDataSource control to fully separate the presentation layer from the Data Access layer.</span></span> <span data-ttu-id="f3a17-108">Начиная с этого руководства мы рассмотрим, как можно использовать элемент управления SqlDataSource для простых приложений, не требующих такого четкого разделения представления и доступа к данным.</span><span class="sxs-lookup"><span data-stu-id="f3a17-108">Starting with this tutorial, we learn how the SqlDataSource control can be used for simple applications that do not require such a strict separation of presentation and data access.</span></span>

## <a name="introduction"></a><span data-ttu-id="f3a17-109">Введение</span><span class="sxs-lookup"><span data-stu-id="f3a17-109">Introduction</span></span>

<span data-ttu-id="f3a17-110">Все учебные курсы, которые мы рассматривали ранее, использовали многоуровневую архитектуру, состоящую из уровней представления, бизнес-логики и доступа к данным.</span><span class="sxs-lookup"><span data-stu-id="f3a17-110">All of the tutorials we ve examined so far have used a tiered architecture consisting of presentation, Business Logic, and Data Access layers.</span></span> <span data-ttu-id="f3a17-111">Уровень доступа к данным (DAL) был создан в первом учебнике ([Создание уровня доступа к данным](../introduction/creating-a-data-access-layer-vb.md)) и на уровне бизнес-логики во втором ([Создание уровня бизнес-логики](../introduction/creating-a-business-logic-layer-vb.md)).</span><span class="sxs-lookup"><span data-stu-id="f3a17-111">The Data Access Layer (DAL) was crafted in the first tutorial ([Creating a Data Access Layer](../introduction/creating-a-data-access-layer-vb.md)) and the Business Logic Layer in the second ([Creating a Business Logic Layer](../introduction/creating-a-business-logic-layer-vb.md)).</span></span> <span data-ttu-id="f3a17-112">В начале [отображения данных с помощью учебника по ObjectDataSource](../basic-reporting/displaying-data-with-the-objectdatasource-vb.md) мы увидели, как использовать новый элемент управления objectdatasource ASP.NET 2,0, чтобы декларативно взаимодействовать с архитектурой из уровня представления.</span><span class="sxs-lookup"><span data-stu-id="f3a17-112">Starting with the [Displaying Data With the ObjectDataSource](../basic-reporting/displaying-data-with-the-objectdatasource-vb.md) tutorial, we saw how to use ASP.NET 2.0 s new ObjectDataSource control to declaratively interface with the architecture from the presentation layer.</span></span>

<span data-ttu-id="f3a17-113">Хотя все руководства на данный момент использовали архитектуру для работы с данными, можно также получать доступ к данным, вставлять, обновлять и удалять данные базы данных непосредственно из страницы ASP.NET, минуя архитектуру.</span><span class="sxs-lookup"><span data-stu-id="f3a17-113">While all of the tutorials so far have used the architecture to work with data, it is also possible to access, insert, update, and delete database data directly from an ASP.NET page, bypassing the architecture.</span></span> <span data-ttu-id="f3a17-114">Это позволяет разместит определенные запросы к базе данных и бизнес-логику непосредственно на веб-странице.</span><span class="sxs-lookup"><span data-stu-id="f3a17-114">Doing so places the specific database queries and business logic directly in the web page.</span></span> <span data-ttu-id="f3a17-115">Для достаточно больших или сложных приложений разработка, реализация и использование многоуровневой архитектуры жизненно важна для успешного, обновляемого и обслуживаемого приложения.</span><span class="sxs-lookup"><span data-stu-id="f3a17-115">For sufficiently large or complex applications, designing, implementing, and using a tiered architecture is vitally important for the success, updatability, and maintainability of the application.</span></span> <span data-ttu-id="f3a17-116">Однако разработка надежной архитектуры может быть ненужной при создании более простых, одноразовых приложений.</span><span class="sxs-lookup"><span data-stu-id="f3a17-116">Developing a robust architecture, however, may be unnecessary when creating exceedingly simple, one-off applications.</span></span>

<span data-ttu-id="f3a17-117">ASP.NET 2,0 предоставляет пять встроенных элементов управления источниками данных: [SqlDataSource](https://msdn.microsoft.com/library/dz12d98w%28vs.80%29.aspx), [AccessDataSource](https://msdn.microsoft.com/library/8e5545e1.aspx), [ObjectDataSource](https://msdn.microsoft.com/library/9a4kyhcx.aspx), [XmlDataSource](https://msdn.microsoft.com/library/e8d8587a%28en-US,VS.80%29.aspx)и [SiteMapDataSource](https://msdn.microsoft.com/library/5ex9t96x%28en-US,VS.80%29.aspx).</span><span class="sxs-lookup"><span data-stu-id="f3a17-117">ASP.NET 2.0 provides five built-in data source controls [SqlDataSource](https://msdn.microsoft.com/library/dz12d98w%28vs.80%29.aspx), [AccessDataSource](https://msdn.microsoft.com/library/8e5545e1.aspx), [ObjectDataSource](https://msdn.microsoft.com/library/9a4kyhcx.aspx), [XmlDataSource](https://msdn.microsoft.com/library/e8d8587a%28en-US,VS.80%29.aspx), and [SiteMapDataSource](https://msdn.microsoft.com/library/5ex9t96x%28en-US,VS.80%29.aspx).</span></span> <span data-ttu-id="f3a17-118">SqlDataSource можно использовать для доступа к данным и их изменения непосредственно из реляционной базы данных, включая Microsoft SQL Server, Microsoft Access, Oracle, MySQL и др.</span><span class="sxs-lookup"><span data-stu-id="f3a17-118">The SqlDataSource can be used to access and modify data directly from a relational database, including Microsoft SQL Server, Microsoft Access, Oracle, MySQL, and others.</span></span> <span data-ttu-id="f3a17-119">В этом руководстве и трех следующих примерах мы рассмотрим работу с элементом управления SqlDataSource, просмотрев запросы и фильтрацию данных базы данных, а также как использовать SqlDataSource для вставки, обновления и удаления данных.</span><span class="sxs-lookup"><span data-stu-id="f3a17-119">In this tutorial and the next three, we'll examine how to work with the SqlDataSource control, exploring how to query and filter database data, as well as how to use the SqlDataSource to insert, update, and delete data.</span></span>

![ASP.NET 2,0 включает пять встроенных элементов управления источниками данных](querying-data-with-the-sqldatasource-control-vb/_static/image1.gif)

<span data-ttu-id="f3a17-121">**Рис. 1**. ASP.NET 2,0 включает пять встроенных элементов управления источниками данных</span><span class="sxs-lookup"><span data-stu-id="f3a17-121">**Figure 1**: ASP.NET 2.0 Includes Five Built-In Data Source Controls</span></span>

## <a name="comparing-the-objectdatasource-and-sqldatasource"></a><span data-ttu-id="f3a17-122">Сравнение ObjectDataSource и SqlDataSource</span><span class="sxs-lookup"><span data-stu-id="f3a17-122">Comparing the ObjectDataSource and SqlDataSource</span></span>

<span data-ttu-id="f3a17-123">По сути, элементы управления ObjectDataSource и SqlDataSource просто являются прокси-объектами для данных.</span><span class="sxs-lookup"><span data-stu-id="f3a17-123">Conceptually, both the ObjectDataSource and SqlDataSource controls are simply proxies to data.</span></span> <span data-ttu-id="f3a17-124">Как обсуждалось в руководстве по [отображению данных с помощью элемента управления ObjectDataSource](../basic-reporting/displaying-data-with-the-objectdatasource-vb.md) , у ObjectDataSource есть свойства, указывающие тип объекта, который предоставляет данные, и методы, вызываемые для выбора, вставки, обновления и удаления данных из базового типа объекта.</span><span class="sxs-lookup"><span data-stu-id="f3a17-124">As discussed in the [Displaying Data With the ObjectDataSource](../basic-reporting/displaying-data-with-the-objectdatasource-vb.md) tutorial, the ObjectDataSource has properties that indicate the object type that provides the data and the methods to invoke to select, insert, update, and delete data from the underlying object type.</span></span> <span data-ttu-id="f3a17-125">После настройки свойств ObjectDataSource s веб-элемент управления данными, например GridView, DetailsView или DataList, может быть привязан к элементу управления с помощью методов ObjectDataSource `Select()`, `Insert()`, `Delete()`и `Update()` для взаимодействия с базовой архитектурой.</span><span class="sxs-lookup"><span data-stu-id="f3a17-125">Once the ObjectDataSource s properties have been configured, a data Web control such as a GridView, DetailsView, or DataList can be bound to the control, using the ObjectDataSource s `Select()`, `Insert()`, `Delete()`, and `Update()` methods to interact with the underlying architecture.</span></span>

<span data-ttu-id="f3a17-126">Функция SqlDataSource предоставляет те же функциональные возможности, но работает с реляционной базой данных, а не с библиотекой объектов.</span><span class="sxs-lookup"><span data-stu-id="f3a17-126">The SqlDataSource provides the same functionality, but operates against a relational database rather than an object library.</span></span> <span data-ttu-id="f3a17-127">С помощью SqlDataSource необходимо указать строку подключения к базе данных и нерегламентированные запросы SQL или хранимые процедуры, которые будут выполняться для вставки, обновления, удаления и получения данных.</span><span class="sxs-lookup"><span data-stu-id="f3a17-127">With the SqlDataSource, we must specify the database connection string and the ad-hoc SQL queries or stored procedures to execute to insert, update, delete, and retrieve data.</span></span> <span data-ttu-id="f3a17-128">Методы SqlDataSource `Select()`, `Insert()`, `Update()`и `Delete()` при вызове подключаются к указанной базе данных и выдают соответствующий запрос SQL.</span><span class="sxs-lookup"><span data-stu-id="f3a17-128">The SqlDataSource s `Select()`, `Insert()`, `Update()`, and `Delete()` methods, when invoked, connect to the specified database and issue the appropriate SQL query.</span></span> <span data-ttu-id="f3a17-129">Как показано на следующей схеме, эти методы выполняют grunt работу по подключению к базе данных, выполняя запрос и возвращают результаты.</span><span class="sxs-lookup"><span data-stu-id="f3a17-129">As the following diagram illustrates, the these methods do the grunt work of connecting to a database, issuing a query, and returning the results.</span></span>

![SqlDataSource выступает в качестве прокси-сервера для базы данных](querying-data-with-the-sqldatasource-control-vb/_static/image2.gif)

<span data-ttu-id="f3a17-131">**Рис. 2**. SqlDataSource выступает в качестве прокси-сервера для базы данных</span><span class="sxs-lookup"><span data-stu-id="f3a17-131">**Figure 2**: The SqlDataSource Serves as a Proxy to the Database</span></span>

> [!NOTE]
> <span data-ttu-id="f3a17-132">В этом учебнике основное внимание уделяется извлечению данных из базы данных.</span><span class="sxs-lookup"><span data-stu-id="f3a17-132">In this tutorial we'll focus on retrieving data from the database.</span></span> <span data-ttu-id="f3a17-133">В руководстве по [вставке, обновлению и удалению данных с помощью элемента управления SqlDataSource](inserting-updating-and-deleting-data-with-the-sqldatasource-vb.md) будет показано, как настроить SqlDataSource для поддержки вставки, обновления и удаления.</span><span class="sxs-lookup"><span data-stu-id="f3a17-133">In the [Inserting, Updating, and Deleting Data with the SqlDataSource Control](inserting-updating-and-deleting-data-with-the-sqldatasource-vb.md) tutorial, we'll see how to configure the SqlDataSource to support inserting, updating, and deleting.</span></span>

## <a name="the-sqldatasource-and-accessdatasource-controls"></a><span data-ttu-id="f3a17-134">Элементы управления SqlDataSource и AccessDataSource</span><span class="sxs-lookup"><span data-stu-id="f3a17-134">The SqlDataSource and AccessDataSource Controls</span></span>

<span data-ttu-id="f3a17-135">Помимо элемента управления SqlDataSource, ASP.NET 2,0 также включает элемент управления AccessDataSource.</span><span class="sxs-lookup"><span data-stu-id="f3a17-135">In addition to the SqlDataSource control, ASP.NET 2.0 also includes an AccessDataSource control.</span></span> <span data-ttu-id="f3a17-136">Эти два разных элемента управления ведут к тому, что многие разработчики впервые ASP.NET 2,0, что элемент управления AccessDataSource предназначен исключительно для работы с Microsoft Access с элементом управления SqlDataSource, предназначенным для работы исключительно с Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="f3a17-136">These two different controls lead many developers new to ASP.NET 2.0 to suspect that the AccessDataSource control is designed to work exclusively with Microsoft Access with the SqlDataSource control designed to work exclusively with Microsoft SQL Server.</span></span> <span data-ttu-id="f3a17-137">Хотя AccessDataSource предназначен для работы непосредственно с Microsoft Access, элемент управления SqlDataSource работает с *любой* реляционной базой данных, доступ к которой можно получить с помощью .NET.</span><span class="sxs-lookup"><span data-stu-id="f3a17-137">While the AccessDataSource is designed to work specifically with Microsoft Access, the SqlDataSource control works with *any* relational database that can be accessed through .NET.</span></span> <span data-ttu-id="f3a17-138">Сюда входят все хранилища данных, совместимые с OleDb или ODBC, такие как Microsoft SQL Server, Microsoft Access, Oracle, Informix, MySQL и PostgreSQL, а также многие другие.</span><span class="sxs-lookup"><span data-stu-id="f3a17-138">This includes any OleDb- or ODBC-compliant data stores, such as Microsoft SQL Server, Microsoft Access, Oracle, Informix, MySQL, and PostgreSQL, among many others.</span></span>

<span data-ttu-id="f3a17-139">Единственное различие между элементами управления AccessDataSource и SqlDataSource заключается в том, как указываются сведения о подключении к базе данных.</span><span class="sxs-lookup"><span data-stu-id="f3a17-139">The sole difference between the AccessDataSource and SqlDataSource controls is how the database connection information is specified.</span></span> <span data-ttu-id="f3a17-140">Элементу управления AccessDataSource требуется только путь к файлу базы данных Access.</span><span class="sxs-lookup"><span data-stu-id="f3a17-140">The AccessDataSource control needs just the file path to the Access database file.</span></span> <span data-ttu-id="f3a17-141">С другой стороны, для SqlDataSource требуется полная строка подключения.</span><span class="sxs-lookup"><span data-stu-id="f3a17-141">The SqlDataSource, on the other hand, requires a complete connection string.</span></span>

## <a name="step-1-creating-the-sqldatasource-web-pages"></a><span data-ttu-id="f3a17-142">Шаг 1. Создание веб-страниц SqlDataSource</span><span class="sxs-lookup"><span data-stu-id="f3a17-142">Step 1: Creating the SqlDataSource Web Pages</span></span>

<span data-ttu-id="f3a17-143">Прежде чем начать изучение работы с данными базы данных с помощью элемента управления SqlDataSource, давайте сначала создадим страницы ASP.NET в нашем проекте веб-сайта, которые понадобятся для работы с этим руководством и следующих трех.</span><span class="sxs-lookup"><span data-stu-id="f3a17-143">Before we start exploring how to work directly with database data using the SqlDataSource control, let s first take a moment to create the ASP.NET pages in our website project that we'll need for this tutorial and the next three.</span></span> <span data-ttu-id="f3a17-144">Для начала добавьте новую папку с именем `SqlDataSource`.</span><span class="sxs-lookup"><span data-stu-id="f3a17-144">Start by adding a new folder named `SqlDataSource`.</span></span> <span data-ttu-id="f3a17-145">Затем добавьте в эту папку следующие страницы ASP.NET, чтобы связать каждую страницу с главной страницей `Site.master`:</span><span class="sxs-lookup"><span data-stu-id="f3a17-145">Next, add the following ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `Querying.aspx`
- `ParameterizedQueries.aspx`
- `InsertUpdateDelete.aspx`
- `OptimisticConcurrency.aspx`

![Добавление страниц ASP.NET для учебников, связанных с SqlDataSource](querying-data-with-the-sqldatasource-control-vb/_static/image3.gif)

<span data-ttu-id="f3a17-147">**Рис. 3**. добавление страниц ASP.NET для учебников, связанных с SqlDataSource</span><span class="sxs-lookup"><span data-stu-id="f3a17-147">**Figure 3**: Add the ASP.NET Pages for the SqlDataSource-Related Tutorials</span></span>

<span data-ttu-id="f3a17-148">Как и в других папках, `Default.aspx` в папке `SqlDataSource` будут перечислены учебники в разделе.</span><span class="sxs-lookup"><span data-stu-id="f3a17-148">Like in the other folders, `Default.aspx` in the `SqlDataSource` folder will list the tutorials in its section.</span></span> <span data-ttu-id="f3a17-149">Вспомним, что `SectionLevelTutorialListing.ascx` пользовательский элемент управления предоставляет эти функции.</span><span class="sxs-lookup"><span data-stu-id="f3a17-149">Recall that the `SectionLevelTutorialListing.ascx` User Control provides this functionality.</span></span> <span data-ttu-id="f3a17-150">Таким образом, добавьте этот пользовательский элемент управления в `Default.aspx`, перетащив его из обозреватель решений на страницу s представление конструирования.</span><span class="sxs-lookup"><span data-stu-id="f3a17-150">Therefore, add this User Control to `Default.aspx` by dragging it from the Solution Explorer onto the page s Design view.</span></span>

<span data-ttu-id="f3a17-151">[![добавить пользовательский элемент управления SectionLevelTutorialListing. ascx в Default. aspx](querying-data-with-the-sqldatasource-control-vb/_static/image5.gif)](querying-data-with-the-sqldatasource-control-vb/_static/image4.gif)</span><span class="sxs-lookup"><span data-stu-id="f3a17-151">[![Add the SectionLevelTutorialListing.ascx User Control to Default.aspx](querying-data-with-the-sqldatasource-control-vb/_static/image5.gif)](querying-data-with-the-sqldatasource-control-vb/_static/image4.gif)</span></span>

<span data-ttu-id="f3a17-152">**Рис. 4**. Добавление пользовательского элемента управления `SectionLevelTutorialListing.ascx` в `Default.aspx` ([щелкните, чтобы просмотреть изображение с полным размером](querying-data-with-the-sqldatasource-control-vb/_static/image6.gif))</span><span class="sxs-lookup"><span data-stu-id="f3a17-152">**Figure 4**: Add the `SectionLevelTutorialListing.ascx` User Control to `Default.aspx` ([Click to view full-size image](querying-data-with-the-sqldatasource-control-vb/_static/image6.gif))</span></span>

<span data-ttu-id="f3a17-153">Наконец, добавьте эти четыре страницы в качестве записей в файл `Web.sitemap`.</span><span class="sxs-lookup"><span data-stu-id="f3a17-153">Lastly, add these four pages as entries to the `Web.sitemap` file.</span></span> <span data-ttu-id="f3a17-154">В частности, добавьте следующую разметку после добавления пользовательских кнопок в DataList и Repeater `<siteMapNode>`:</span><span class="sxs-lookup"><span data-stu-id="f3a17-154">Specifically, add the following markup after the Adding Custom Buttons to the DataList and Repeater `<siteMapNode>`:</span></span>

[!code-sql[Main](querying-data-with-the-sqldatasource-control-vb/samples/sample1.sql)]

<span data-ttu-id="f3a17-155">После обновления `Web.sitemap`просмотрите веб-сайт учебников в браузере.</span><span class="sxs-lookup"><span data-stu-id="f3a17-155">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="f3a17-156">В меню слева теперь содержатся элементы для учебников по редактированию, вставке и удалению.</span><span class="sxs-lookup"><span data-stu-id="f3a17-156">The menu on the left now includes items for the editing, inserting, and deleting tutorials.</span></span>

![На карте веб-узла теперь есть записи для учебников по SqlDataSource.](querying-data-with-the-sqldatasource-control-vb/_static/image7.gif)

<span data-ttu-id="f3a17-158">**Рис. 5**. схема узла теперь включает записи для учебников по SqlDataSource</span><span class="sxs-lookup"><span data-stu-id="f3a17-158">**Figure 5**: The Site Map Now Includes Entries for the SqlDataSource Tutorials</span></span>

## <a name="step-2-adding-and-configuring-the-sqldatasource-control"></a><span data-ttu-id="f3a17-159">Шаг 2. Добавление и настройка элемента управления SqlDataSource</span><span class="sxs-lookup"><span data-stu-id="f3a17-159">Step 2: Adding and Configuring the SqlDataSource Control</span></span>

<span data-ttu-id="f3a17-160">Для начала откройте страницу `Querying.aspx` в папке `SqlDataSource` и перейдите в представление конструирования.</span><span class="sxs-lookup"><span data-stu-id="f3a17-160">Start by opening the `Querying.aspx` page in the `SqlDataSource` folder and switch to Design view.</span></span> <span data-ttu-id="f3a17-161">Перетащите элемент управления SqlDataSource из панели элементов в конструктор и задайте для его `ID` значение `ProductsDataSource`.</span><span class="sxs-lookup"><span data-stu-id="f3a17-161">Drag a SqlDataSource control from the Toolbox onto the Designer and set its `ID` to `ProductsDataSource`.</span></span> <span data-ttu-id="f3a17-162">Как и в случае с ObjectDataSource, SqlDataSource не создает выходные данные и, следовательно, отображается в виде серого прямоугольника в области конструктора.</span><span class="sxs-lookup"><span data-stu-id="f3a17-162">As with the ObjectDataSource, the SqlDataSource does not produce any rendered output and therefore appears as a gray box on the design surface.</span></span> <span data-ttu-id="f3a17-163">Чтобы настроить SqlDataSource, щелкните ссылку Настроить источник данных из смарт-тега SqlDataSource s.</span><span class="sxs-lookup"><span data-stu-id="f3a17-163">To configure the SqlDataSource, click on the Configure Data Source link from the SqlDataSource s smart tag.</span></span>

![Щелкните ссылку Настройка источника данных из смарт-тега SqlDataSource s.](querying-data-with-the-sqldatasource-control-vb/_static/image8.gif)

<span data-ttu-id="f3a17-165">**Рис. 6**. Щелкните ссылку Настройка источника данных из смарт-тега SqlDataSource s</span><span class="sxs-lookup"><span data-stu-id="f3a17-165">**Figure 6**: Click on the Configure Data Source Link from the SqlDataSource s Smart Tag</span></span>

<span data-ttu-id="f3a17-166">Откроется мастер настройки источника данных SqlDataSource Control s.</span><span class="sxs-lookup"><span data-stu-id="f3a17-166">This brings up the SqlDataSource control s Configure Data Source wizard.</span></span> <span data-ttu-id="f3a17-167">В то время как шаги мастера отличаются от элементов управления ObjectDataSource, конечная цель одинакова для предоставления сведений о том, как извлекать, вставлять, обновлять и удалять данные через источник данных.</span><span class="sxs-lookup"><span data-stu-id="f3a17-167">While the wizard s steps differ from the ObjectDataSource control s, the end goal is the same to provide the details on how to retrieve, insert, update, and delete data through the data source.</span></span> <span data-ttu-id="f3a17-168">Для SqlDataSource это означает указание базовой базы данных для использования и предоставление специальных инструкций SQL или хранимых процедур.</span><span class="sxs-lookup"><span data-stu-id="f3a17-168">For the SqlDataSource this entails specifying the underlying database to use and providing the ad-hoc SQL statements or stored procedures.</span></span>

<span data-ttu-id="f3a17-169">Первый шаг мастера запрашивает у нас базу данных.</span><span class="sxs-lookup"><span data-stu-id="f3a17-169">The first wizard step prompts us for the database.</span></span> <span data-ttu-id="f3a17-170">В раскрывающемся списке содержатся базы данных, найденные в папке веб-приложения s `App_Data` и те, которые были добавлены в узел подключения к данным в обозреватель сервера.</span><span class="sxs-lookup"><span data-stu-id="f3a17-170">The drop-down list includes those databases found in the web application s `App_Data` folder and those that have been added to the Data Connections node in the Server Explorer.</span></span> <span data-ttu-id="f3a17-171">Так как мы уже добавили строку подключения для базы данных `NORTHWIND.MDF` в папке `App_Data` в `Web.config`ном файле Project s, раскрывающийся список содержит ссылку на эту строку подключения `NORTHWINDConnectionString`.</span><span class="sxs-lookup"><span data-stu-id="f3a17-171">Since we ve already added a connection string for the `NORTHWIND.MDF` database in the `App_Data` folder to our project s `Web.config` file, the drop-down list includes a reference to that connection string, `NORTHWINDConnectionString`.</span></span> <span data-ttu-id="f3a17-172">Выберите этот элемент в раскрывающемся списке и нажмите кнопку Далее.</span><span class="sxs-lookup"><span data-stu-id="f3a17-172">Choose this item from the drop-down list and click Next.</span></span>

![Выберите NORTHWINDConnectionString из раскрывающегося списка.](querying-data-with-the-sqldatasource-control-vb/_static/image9.gif)

<span data-ttu-id="f3a17-174">**Рис. 7**. Выбор `NORTHWINDConnectionString` из раскрывающегося списка</span><span class="sxs-lookup"><span data-stu-id="f3a17-174">**Figure 7**: Choose the `NORTHWINDConnectionString` from the Drop-Down List</span></span>

<span data-ttu-id="f3a17-175">После выбора базы данных мастер запросит запрос на возврат данных.</span><span class="sxs-lookup"><span data-stu-id="f3a17-175">After choosing the database, the wizard asks for the query to return data.</span></span> <span data-ttu-id="f3a17-176">Можно указать столбцы таблицы или представления, которые должны быть возвращены или могут ввести пользовательскую инструкцию SQL или указать хранимую процедуру.</span><span class="sxs-lookup"><span data-stu-id="f3a17-176">We can either specify the columns of a table or view to return or can enter a custom SQL statement or specify a stored procedure.</span></span> <span data-ttu-id="f3a17-177">Можно переключаться между этими вариантами с помощью параметра указать пользовательскую инструкцию SQL или хранимую процедуру и указать столбцы из переключателя таблицы или представления.</span><span class="sxs-lookup"><span data-stu-id="f3a17-177">You can toggle between this choice through the Specify a custom SQL statement or stored procedure and Specify columns from a table or view radio buttons.</span></span>

> [!NOTE]
> <span data-ttu-id="f3a17-178">Для этого первого примера позвольте использовать параметр указать столбцы из таблицы или представления.</span><span class="sxs-lookup"><span data-stu-id="f3a17-178">For this first example, let s use the Specify columns from a table or view option.</span></span> <span data-ttu-id="f3a17-179">Далее в этом руководстве мы вернемся к мастеру и изучим параметр указать пользовательскую инструкцию SQL или хранимую процедуру.</span><span class="sxs-lookup"><span data-stu-id="f3a17-179">We'll return to the wizard later in this tutorial and explore the Specify a custom SQL statement or stored procedure option.</span></span>

<span data-ttu-id="f3a17-180">На рис. 8 показан экран Настройка инструкции SELECT, когда выбран переключатель Укажите столбцы из таблицы или представления.</span><span class="sxs-lookup"><span data-stu-id="f3a17-180">Figure 8 shows the Configure the Select Statement screen when the Specify columns from a table or view radio button is selected.</span></span> <span data-ttu-id="f3a17-181">Раскрывающийся список содержит набор таблиц и представлений в базе данных Northwind с выбранными столбцами таблица или представление s, отображенными в списке ниже.</span><span class="sxs-lookup"><span data-stu-id="f3a17-181">The drop-down list contains the set of tables and views in the Northwind database, with the selected table or view s columns displayed in the checkbox list below.</span></span> <span data-ttu-id="f3a17-182">В этом примере пусть s возвращает `ProductID`, `ProductName`и `UnitPrice` столбцы из таблицы `Products`.</span><span class="sxs-lookup"><span data-stu-id="f3a17-182">For this example, let s return the `ProductID`, `ProductName`, and `UnitPrice` columns from the `Products` table.</span></span> <span data-ttu-id="f3a17-183">Как показано на рис. 8, после выполнения этих выбора мастер показывает результирующую инструкцию SQL `SELECT [ProductID], [ProductName], [UnitPrice] FROM [Products]`.</span><span class="sxs-lookup"><span data-stu-id="f3a17-183">As Figure 8 shows, after making these selections the wizard shows the resulting SQL statement `SELECT [ProductID], [ProductName], [UnitPrice] FROM [Products]`.</span></span>

![Возврат данных из таблицы Products](querying-data-with-the-sqldatasource-control-vb/_static/image10.gif)

<span data-ttu-id="f3a17-185">**Рис. 8**. Возвращение данных из таблицы `Products`</span><span class="sxs-lookup"><span data-stu-id="f3a17-185">**Figure 8**: Return Data from the `Products` Table</span></span>

<span data-ttu-id="f3a17-186">После настройки мастера для возврата `ProductID`, `ProductName`и `UnitPrice` столбцов из таблицы `Products` нажмите кнопку Далее.</span><span class="sxs-lookup"><span data-stu-id="f3a17-186">Once you have configured the wizard to return the `ProductID`, `ProductName`, and `UnitPrice` columns from the `Products` table, click the Next button.</span></span> <span data-ttu-id="f3a17-187">На этом последнем экране можно просмотреть результаты запроса, настроенного на предыдущем шаге.</span><span class="sxs-lookup"><span data-stu-id="f3a17-187">This final screen provides an opportunity to examine the results of the query configured from the previous step.</span></span> <span data-ttu-id="f3a17-188">Нажатие кнопки Проверить запрос выполняет настроенную инструкцию `SELECT` и отображает результаты в виде сетки.</span><span class="sxs-lookup"><span data-stu-id="f3a17-188">Clicking the Test Query button executes the configured `SELECT` statement and displays the results in a grid.</span></span>

![Нажмите кнопку проверить запрос, чтобы проверить запрос SELECT.](querying-data-with-the-sqldatasource-control-vb/_static/image11.gif)

<span data-ttu-id="f3a17-190">**Рис. 9**. нажатие кнопки "проверить запрос" для просмотра `SELECT` запроса</span><span class="sxs-lookup"><span data-stu-id="f3a17-190">**Figure 9**: Click the Test Query Button to Review Your `SELECT` Query</span></span>

<span data-ttu-id="f3a17-191">Чтобы завершить работу мастера, нажмите кнопку Готово.</span><span class="sxs-lookup"><span data-stu-id="f3a17-191">To complete the wizard, click Finish.</span></span>

<span data-ttu-id="f3a17-192">Как и в случае с ObjectDataSource, мастер SqlDataSource s просто присваивает значения свойствам Control s, а именно [`ConnectionString`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.connectionstring.aspx) и [`SelectCommand`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.selectcommand.aspx) свойства.</span><span class="sxs-lookup"><span data-stu-id="f3a17-192">Like with the ObjectDataSource, the SqlDataSource s wizard merely assigns values to the control s properties, namely the [`ConnectionString`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.connectionstring.aspx) and [`SelectCommand`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.selectcommand.aspx) properties.</span></span> <span data-ttu-id="f3a17-193">После завершения работы мастера декларативная разметка элемента управления SqlDataSource должна выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="f3a17-193">After completing the wizard, your SqlDataSource control s declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](querying-data-with-the-sqldatasource-control-vb/samples/sample2.aspx)]

<span data-ttu-id="f3a17-194">Свойство `ConnectionString` предоставляет сведения о том, как подключиться к базе данных.</span><span class="sxs-lookup"><span data-stu-id="f3a17-194">The `ConnectionString` property provides information on how to connect to the database.</span></span> <span data-ttu-id="f3a17-195">Этому свойству можно присвоить полное жестко заданное значение строки подключения или указать строку подключения в `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="f3a17-195">This property can be assigned a complete, hard-coded connection string value or can point to a connection string in `Web.config`.</span></span> <span data-ttu-id="f3a17-196">Для ссылки на значение строки подключения в файле Web. config используйте синтаксис `<%$ expressionPrefix:expressionValue %>`.</span><span class="sxs-lookup"><span data-stu-id="f3a17-196">To reference a connection string value in Web.config, use the syntax `<%$ expressionPrefix:expressionValue %>`.</span></span> <span data-ttu-id="f3a17-197">Обычно *експрессионпрефикс* — это ConnectionString, а *експрессионвалуе* — имя строки подключения в [разделе `Web.config``<connectionStrings>`](https://msdn.microsoft.com/library/bf7sd233.aspx).</span><span class="sxs-lookup"><span data-stu-id="f3a17-197">Typically, *expressionPrefix* is ConnectionStrings and *expressionValue* is the name of the connect string in the `Web.config` [`<connectionStrings>` section](https://msdn.microsoft.com/library/bf7sd233.aspx).</span></span> <span data-ttu-id="f3a17-198">Однако синтаксис можно использовать для ссылки на `<appSettings>` элементы или содержимое из файлов ресурсов.</span><span class="sxs-lookup"><span data-stu-id="f3a17-198">However, the syntax can be used to reference `<appSettings>` elements or content from resource files.</span></span> <span data-ttu-id="f3a17-199">Подробнее об этом синтаксисе см. в разделе [Общие сведения о выражениях ASP.NET](https://msdn.microsoft.com/library/d5bd1tad.aspx) .</span><span class="sxs-lookup"><span data-stu-id="f3a17-199">See [ASP.NET Expressions Overview](https://msdn.microsoft.com/library/d5bd1tad.aspx) for more on this syntax.</span></span>

<span data-ttu-id="f3a17-200">Свойство `SelectCommand` указывает нерегламентированную инструкцию SQL или хранимую процедуру, которую необходимо выполнить для возврата данных.</span><span class="sxs-lookup"><span data-stu-id="f3a17-200">The `SelectCommand` property specifies the ad-hoc SQL statement or stored procedure to execute to return the data.</span></span>

## <a name="step-3-adding-a-data-web-control-and-binding-it-to-the-sqldatasource"></a><span data-ttu-id="f3a17-201">Шаг 3. Добавление веб-элемента управления данными и его привязка к SqlDataSource</span><span class="sxs-lookup"><span data-stu-id="f3a17-201">Step 3: Adding a Data Web Control and Binding it to the SqlDataSource</span></span>

<span data-ttu-id="f3a17-202">После настройки SqlDataSource его можно привязать к веб-элементу управления данными, например GridView или DetailsView.</span><span class="sxs-lookup"><span data-stu-id="f3a17-202">Once the SqlDataSource has been configured, it can be bound to a data Web control, such as a GridView or DetailsView.</span></span> <span data-ttu-id="f3a17-203">В этом руководстве мы будем отображать данные в элементе управления GridView.</span><span class="sxs-lookup"><span data-stu-id="f3a17-203">For this tutorial, let s display the data in a GridView.</span></span> <span data-ttu-id="f3a17-204">Перетащите элемент управления GridView с панели элементов на страницу и привяжите его к `ProductsDataSource` SqlDataSource, выбрав источник данных из раскрывающегося списка в смарт-теге GridView s.</span><span class="sxs-lookup"><span data-stu-id="f3a17-204">From the Toolbox, drag a GridView onto the page and bind it to the `ProductsDataSource` SqlDataSource by choosing the data source from the drop-down list in the GridView s smart tag.</span></span>

<span data-ttu-id="f3a17-205">[![добавить GridView и привязать его к элементу управления SqlDataSource](querying-data-with-the-sqldatasource-control-vb/_static/image13.gif)](querying-data-with-the-sqldatasource-control-vb/_static/image12.gif)</span><span class="sxs-lookup"><span data-stu-id="f3a17-205">[![Add a GridView and Bind it to the SqlDataSource Control](querying-data-with-the-sqldatasource-control-vb/_static/image13.gif)](querying-data-with-the-sqldatasource-control-vb/_static/image12.gif)</span></span>

<span data-ttu-id="f3a17-206">**Рис. 10**. Добавление GridView и привязка его к элементу управления SqlDataSource ([щелкните, чтобы просмотреть изображение с полным размером](querying-data-with-the-sqldatasource-control-vb/_static/image14.gif))</span><span class="sxs-lookup"><span data-stu-id="f3a17-206">**Figure 10**: Add a GridView and Bind it to the SqlDataSource Control ([Click to view full-size image](querying-data-with-the-sqldatasource-control-vb/_static/image14.gif))</span></span>

<span data-ttu-id="f3a17-207">После выбора элемента управления SqlDataSource из раскрывающегося списка в смарт-теге GridView s Visual Studio автоматически добавит BoundField или CheckBoxField в GridView для каждого столбца, возвращаемого элементом управления источника данных.</span><span class="sxs-lookup"><span data-stu-id="f3a17-207">Once you ve selected the SqlDataSource control from the drop-down list in the GridView s smart tag, Visual Studio will automatically add a BoundField or CheckBoxField to the GridView for each of the columns returned by the data source control.</span></span> <span data-ttu-id="f3a17-208">Так как SqlDataSource возвращает три столбца базы данных `ProductID`, `ProductName`и `UnitPrice` в GridView есть три поля.</span><span class="sxs-lookup"><span data-stu-id="f3a17-208">Since the SqlDataSource returns three database columns `ProductID`, `ProductName`, and `UnitPrice` there are three fields in the GridView.</span></span>

<span data-ttu-id="f3a17-209">Уделите несколько минут настройке трех BoundFields в GridView s.</span><span class="sxs-lookup"><span data-stu-id="f3a17-209">Take a moment to configure the GridView s three BoundFields.</span></span> <span data-ttu-id="f3a17-210">Измените `ProductName` поля `HeaderText` свойства на имя продукта и на `UnitPrice` поле s на Price.</span><span class="sxs-lookup"><span data-stu-id="f3a17-210">Change the `ProductName` field s `HeaderText` property to Product Name and the `UnitPrice` field s to Price.</span></span> <span data-ttu-id="f3a17-211">Также Отформатируйте поле `UnitPrice` как валюту.</span><span class="sxs-lookup"><span data-stu-id="f3a17-211">Also format the `UnitPrice` field as a currency.</span></span> <span data-ttu-id="f3a17-212">После внесения этих изменений декларативная разметка GridView s должна выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="f3a17-212">After making these modifications, your GridView s declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](querying-data-with-the-sqldatasource-control-vb/samples/sample3.aspx)]

<span data-ttu-id="f3a17-213">Посетите эту страницу в браузере.</span><span class="sxs-lookup"><span data-stu-id="f3a17-213">Visit this page through a browser.</span></span> <span data-ttu-id="f3a17-214">Как показано на рис. 11, в элементе GridView перечислены `ProductID`, `ProductName`и `UnitPrice` значения.</span><span class="sxs-lookup"><span data-stu-id="f3a17-214">As Figure 11 shows, the GridView lists each product s `ProductID`, `ProductName`, and `UnitPrice` values.</span></span>

<span data-ttu-id="f3a17-215">[![GridView отображает значения ProductID, ProductName и UnitPrice для каждого продукта.](querying-data-with-the-sqldatasource-control-vb/_static/image16.gif)](querying-data-with-the-sqldatasource-control-vb/_static/image15.gif)</span><span class="sxs-lookup"><span data-stu-id="f3a17-215">[![The GridView Displays Each Product s ProductID, ProductName, and UnitPrice Values](querying-data-with-the-sqldatasource-control-vb/_static/image16.gif)](querying-data-with-the-sqldatasource-control-vb/_static/image15.gif)</span></span>

<span data-ttu-id="f3a17-216">**Рис. 11**. Отображение каждого продукта с `ProductID`, `ProductName`и `UnitPrice` значений (щелкните,[чтобы просмотреть изображение с полным размером](querying-data-with-the-sqldatasource-control-vb/_static/image17.gif))</span><span class="sxs-lookup"><span data-stu-id="f3a17-216">**Figure 11**: The GridView Displays Each Product s `ProductID`, `ProductName`, and `UnitPrice` Values ([Click to view full-size image](querying-data-with-the-sqldatasource-control-vb/_static/image17.gif))</span></span>

<span data-ttu-id="f3a17-217">При посещении страницы GridView вызывает метод `Select()` управления источниками данных.</span><span class="sxs-lookup"><span data-stu-id="f3a17-217">When the page is visited the GridView invokes its data source control s `Select()` method.</span></span> <span data-ttu-id="f3a17-218">При использовании элемента управления ObjectDataSource это вызывало метод `ProductsBLL` Class s `GetProducts()`.</span><span class="sxs-lookup"><span data-stu-id="f3a17-218">When we were using the ObjectDataSource control, this called the `ProductsBLL` class s `GetProducts()` method.</span></span> <span data-ttu-id="f3a17-219">Однако с помощью SqlDataSource метод `Select()` устанавливает соединение с указанной базой данных и выдает `SelectCommand` (в этом примере —`SELECT [ProductID], [ProductName], [UnitPrice] FROM [Products]`).</span><span class="sxs-lookup"><span data-stu-id="f3a17-219">With the SqlDataSource, however, the `Select()` method establishes a connection to the specified database and issues the `SelectCommand` (`SELECT [ProductID], [ProductName], [UnitPrice] FROM [Products]`, in this example).</span></span> <span data-ttu-id="f3a17-220">Функция SqlDataSource возвращает свои результаты, которые затем выполняет перечисление GridView, создавая строку в GridView для каждой возвращенной записи базы данных.</span><span class="sxs-lookup"><span data-stu-id="f3a17-220">The SqlDataSource returns its results which the GridView then enumerates, creating a row in the GridView for each database record returned.</span></span>

## <a name="the-built-in-data-web-control-features-and-the-sqldatasource-control"></a><span data-ttu-id="f3a17-221">Встроенные функции веб-элементов управления данными и элемент управления SqlDataSource</span><span class="sxs-lookup"><span data-stu-id="f3a17-221">The Built-In Data Web Control Features and the SqlDataSource Control</span></span>

<span data-ttu-id="f3a17-222">В целом, функции, присущие веб-элементам управления данными, сортируются, редактируют, удаляют, вставляют и т. д., относятся к веб-элементу управления данными и не зависят от используемого элемента управления источниками данных.</span><span class="sxs-lookup"><span data-stu-id="f3a17-222">In general, the features inherent to the data Web controls paging, sorting, editing, deleting, inserting, and so on are specific to the data Web control and are not dependent on the data source control used.</span></span> <span data-ttu-id="f3a17-223">Это значит, что GridView может использовать встроенную подкачку, сортировку, редактирование и удаление, связан ли он с ObjectDataSource или SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="f3a17-223">That is, the GridView can utilize its built-in paging, sorting, editing, and deleting whether it is bound to an ObjectDataSource or a SqlDataSource.</span></span> <span data-ttu-id="f3a17-224">Однако некоторые функции веб-элементов управления данными чувствительны к используемому элементу управления источником данных или к конфигурации системы управления источниками данных.</span><span class="sxs-lookup"><span data-stu-id="f3a17-224">However, certain data Web control features are sensitive to the data source control being used or to the data source control s configuration.</span></span>

<span data-ttu-id="f3a17-225">Например, в [рамках эффективного постраничного обмена большими объемами данных](../paging-and-sorting/efficiently-paging-through-large-amounts-of-data-vb.md) мы обсуждали, как по умолчанию логика разбиения по страницам для веб-элементов управления данными сильно возвращает *все* записи из базового источника данных, а затем отображает только соответствующее подмножество записей, учитывая текущий индекс страницы, и число записей, отображаемых на странице.</span><span class="sxs-lookup"><span data-stu-id="f3a17-225">For example, in the [Efficiently Paging Through Large Amounts of Data](../paging-and-sorting/efficiently-paging-through-large-amounts-of-data-vb.md) tutorial we discussed how, by default, the paging logic for the data Web controls naively returns *all* records from the underlying data source and then displays only the appropriate subset of records given the current page index and the number of records to display per page.</span></span> <span data-ttu-id="f3a17-226">Эта модель очень неэффективна при разбиении на страницы достаточно большого набора результирующих наборов.</span><span class="sxs-lookup"><span data-stu-id="f3a17-226">This model is highly inefficient when paging through sufficiently large result sets.</span></span> <span data-ttu-id="f3a17-227">К счастью, элемент управления ObjectDataSource можно настроить для поддержки пользовательского разбиения на страницы, возвращающего только точное подмножество отображаемых записей.</span><span class="sxs-lookup"><span data-stu-id="f3a17-227">Fortunately, the ObjectDataSource can be configured to support custom paging, which returns only the precise subset of records to display.</span></span> <span data-ttu-id="f3a17-228">Однако в элементе управления SqlDataSource отсутствуют свойства для реализации пользовательского разбиения на страницы.</span><span class="sxs-lookup"><span data-stu-id="f3a17-228">The SqlDataSource control, however, lacks the properties for implementing custom paging.</span></span>

<span data-ttu-id="f3a17-229">Другая тонкость, связанная с разбиением по страницам и сортировкой, возникает с помощью SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="f3a17-229">Another subtlety with paging and sorting arises with the SqlDataSource.</span></span> <span data-ttu-id="f3a17-230">По умолчанию данные, возвращаемые из SqlDataSource, можно пролистывать или сортировать с помощью элемента управления GridView.</span><span class="sxs-lookup"><span data-stu-id="f3a17-230">By default, the data returned from a SqlDataSource can be paged or sorted through the GridView.</span></span> <span data-ttu-id="f3a17-231">Чтобы продемонстрировать это, установите флажок Включить разбиение на страницы и включить параметры сортировки в смарт-теге GridView s в `Querying.aspx` и убедитесь, что это работает правильно.</span><span class="sxs-lookup"><span data-stu-id="f3a17-231">To demonstrate this, check the Enable Paging and Enable Sorting options in the GridView s smart tag in `Querying.aspx` and verify that this works as expected.</span></span>

<span data-ttu-id="f3a17-232">Сортировка и разбиение на страницы работают, поскольку SqlDataSource извлекает данные из базы данных в слабо типизированный набор данных.</span><span class="sxs-lookup"><span data-stu-id="f3a17-232">Sorting and paging works because the SqlDataSource retrieves the database data into a loosely-typed DataSet.</span></span> <span data-ttu-id="f3a17-233">Общее число записей, возвращенных запросом, является важным аспектом реализации разбиения на страницы из набора данных.</span><span class="sxs-lookup"><span data-stu-id="f3a17-233">The total number of records returned by the query an essential aspect to implementing paging can be ascertained from the DataSet.</span></span> <span data-ttu-id="f3a17-234">Кроме того, результаты набора данных можно отсортировать через объект DataView.</span><span class="sxs-lookup"><span data-stu-id="f3a17-234">Additionally, the DataSet s results can be sorted through a DataView.</span></span> <span data-ttu-id="f3a17-235">Эти возможности автоматически используются средством SqlDataSource, когда GridView запрашивает страницы или отсортированные данные.</span><span class="sxs-lookup"><span data-stu-id="f3a17-235">These capabilities are automatically used by the SqlDataSource when the GridView requests paged or sorted data.</span></span>

<span data-ttu-id="f3a17-236">С помощью элемента SqlDataSource можно настроить возврат объекта DataReader вместо набора данных, изменив его [свойство`DataSourceMode`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.datasourcemode.aspx) с `DataSet` (по умолчанию) на `DataReader`.</span><span class="sxs-lookup"><span data-stu-id="f3a17-236">The SqlDataSource can be configured to return a DataReader instead of a DataSet by changing its [`DataSourceMode` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.datasourcemode.aspx) from `DataSet` (the default) to `DataReader`.</span></span> <span data-ttu-id="f3a17-237">Использование DataReader может оказаться предпочтительным в ситуациях, когда передает результаты SqlDataSource в существующий код, который ждет DataReader.</span><span class="sxs-lookup"><span data-stu-id="f3a17-237">Using a DataReader might be preferred in situations when passing the SqlDataSource s results to existing code that expects a DataReader.</span></span> <span data-ttu-id="f3a17-238">Более того, поскольку объекты DataReader являются значительно более простыми объектами, чем наборы данных, они обеспечивают лучшую производительность.</span><span class="sxs-lookup"><span data-stu-id="f3a17-238">Furthermore, since DataReaders are considerably simpler objects than DataSets, they offer better performance.</span></span> <span data-ttu-id="f3a17-239">Однако при внесении этого изменения веб-элемент управления данными не может ни выполнять сортировку, ни страницу, так как SqlDataSource не может определить, сколько записей возвращается запросом, а DataReader не предлагает никаких методов для сортировки возвращаемых данных.</span><span class="sxs-lookup"><span data-stu-id="f3a17-239">If you make this change, however, the data Web control can neither sort nor page since the SqlDataSource cannot ascertain how many records are returned by the query, nor does the DataReader offer any techniques for sorting the returned data.</span></span>

## <a name="step-4-using-a-custom-sql-statement-or-stored-procedure"></a><span data-ttu-id="f3a17-240">Шаг 4. Использование пользовательской инструкции SQL или хранимой процедуры</span><span class="sxs-lookup"><span data-stu-id="f3a17-240">Step 4: Using a Custom SQL Statement or Stored Procedure</span></span>

<span data-ttu-id="f3a17-241">При настройке элемента управления SqlDataSource запрос, используемый для возврата данных, может быть указан в одном из двух подходов в качестве пользовательской инструкции SQL или хранимой процедуры или в виде столбцов из существующей таблицы или представления.</span><span class="sxs-lookup"><span data-stu-id="f3a17-241">When configuring the SqlDataSource control, the query used to return data can be specified in one of two approaches as a custom SQL statement or stored procedure, or as columns from an existing table or view.</span></span> <span data-ttu-id="f3a17-242">На шаге 2 мы рассмотрели выбор столбцов из таблицы `Products`.</span><span class="sxs-lookup"><span data-stu-id="f3a17-242">In Step 2 we examined selecting columns from the `Products` table.</span></span> <span data-ttu-id="f3a17-243">Давайте посмотрим на использование пользовательской инструкции SQL.</span><span class="sxs-lookup"><span data-stu-id="f3a17-243">Let s look at using a custom SQL statement.</span></span>

<span data-ttu-id="f3a17-244">Добавьте еще один элемент управления GridView на страницу `Querying.aspx` и выберите Создание нового источника данных из раскрывающегося списка в смарт-теге.</span><span class="sxs-lookup"><span data-stu-id="f3a17-244">Add another GridView control to the `Querying.aspx` page and choose to create a new data source from the drop-down list in the smart tag.</span></span> <span data-ttu-id="f3a17-245">Затем укажите, что данные будут извлечены из базы данных. при этом будет создан новый элемент управления SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="f3a17-245">Next, indicate that the data will be pulled from a database this will create a new SqlDataSource control.</span></span> <span data-ttu-id="f3a17-246">Присвойте элементу управления имя `ProductsWithCategoryInfoDataSource`.</span><span class="sxs-lookup"><span data-stu-id="f3a17-246">Name the control `ProductsWithCategoryInfoDataSource`.</span></span>

![Создание нового элемента управления SqlDataSource с именем Продуктсвискатегоринфодатасаурце](querying-data-with-the-sqldatasource-control-vb/_static/image18.gif)

<span data-ttu-id="f3a17-248">**Рис. 12**. Создание нового элемента управления SqlDataSource с именем `ProductsWithCategoryInfoDataSource`</span><span class="sxs-lookup"><span data-stu-id="f3a17-248">**Figure 12**: Create a New SqlDataSource Control Named `ProductsWithCategoryInfoDataSource`</span></span>

<span data-ttu-id="f3a17-249">На следующем экране будет предложено указать базу данных.</span><span class="sxs-lookup"><span data-stu-id="f3a17-249">The next screen asks us to specify the database.</span></span> <span data-ttu-id="f3a17-250">Как мы делали на рис. 7, выберите `NORTHWINDConnectionString` из раскрывающегося списка и нажмите кнопку Далее.</span><span class="sxs-lookup"><span data-stu-id="f3a17-250">As we did back in Figure 7, select the `NORTHWINDConnectionString` from the drop-down list and click Next.</span></span> <span data-ttu-id="f3a17-251">На экране Настройка инструкции Select выберите переключатель задать пользовательскую инструкцию SQL или хранимую процедуру и нажмите кнопку Далее.</span><span class="sxs-lookup"><span data-stu-id="f3a17-251">In the Configure the Select Statement screen, choose the Specify a custom SQL statement or stored procedure radio button and click Next.</span></span> <span data-ttu-id="f3a17-252">Откроется экран определение пользовательских инструкций или хранимых процедур, в котором будут представлены вкладки с метками SELECT, UPDATE, INSERT и DELETE.</span><span class="sxs-lookup"><span data-stu-id="f3a17-252">This will bring up the Define Custom Statements or Stored Procedures screen, which offers tabs labeled SELECT, UPDATE, INSERT, and DELETE.</span></span> <span data-ttu-id="f3a17-253">На каждой вкладке можно ввести пользовательскую инструкцию SQL в текстовое поле или выбрать хранимую процедуру из раскрывающегося списка.</span><span class="sxs-lookup"><span data-stu-id="f3a17-253">In each tab you can enter a custom SQL statement into the textbox or choose a stored procedure from the drop-down list.</span></span> <span data-ttu-id="f3a17-254">В этом учебнике рассматривается ввод пользовательской инструкции SQL. в следующем учебнике содержится пример, в котором используется хранимая процедура.</span><span class="sxs-lookup"><span data-stu-id="f3a17-254">In this tutorial we will look at entering a custom SQL statement; the next tutorial includes an example that uses a stored procedure.</span></span>

![Введите пользовательскую инструкцию SQL или выберите хранимую процедуру](querying-data-with-the-sqldatasource-control-vb/_static/image19.gif)

<span data-ttu-id="f3a17-256">**Рис. 13**. Ввод пользовательской инструкции SQL или выбор хранимой процедуры</span><span class="sxs-lookup"><span data-stu-id="f3a17-256">**Figure 13**: Enter a Custom SQL Statement or Pick a Stored Procedure</span></span>

<span data-ttu-id="f3a17-257">Пользовательская инструкция SQL может быть передана вручную в текстовое поле или может быть построена графически путем нажатия кнопки конструктор запросов.</span><span class="sxs-lookup"><span data-stu-id="f3a17-257">The custom SQL statement can be entered by hand into the textbox or can be constructed graphically by clicking the Query Builder button.</span></span> <span data-ttu-id="f3a17-258">В конструктор запросов или в текстовом поле используйте следующий запрос, чтобы вернуть поля `ProductID` и `ProductName` из таблицы `Products` с помощью `JOIN` для получения `CategoryName` продуктов из таблицы `Categories`.</span><span class="sxs-lookup"><span data-stu-id="f3a17-258">From either the Query Builder or the textbox, use the following query to return the `ProductID` and `ProductName` fields from the `Products` table using a `JOIN` to retrieve the product s `CategoryName` from the `Categories` table:</span></span>

[!code-sql[Main](querying-data-with-the-sqldatasource-control-vb/samples/sample4.sql)]

![Можно графически сформировать запрос с помощью конструктор запросов](querying-data-with-the-sqldatasource-control-vb/_static/image20.gif)

<span data-ttu-id="f3a17-260">**Рис. 14**. Создание графического запроса с помощью конструктор запросов</span><span class="sxs-lookup"><span data-stu-id="f3a17-260">**Figure 14**: You can Graphically Construct the Query Using the Query Builder</span></span>

<span data-ttu-id="f3a17-261">После указания запроса нажмите кнопку Далее, чтобы перейти к экрану тестового запроса.</span><span class="sxs-lookup"><span data-stu-id="f3a17-261">After specifying the query, click Next to proceed to the Test Query screen.</span></span> <span data-ttu-id="f3a17-262">Нажмите кнопку Готово, чтобы завершить работу мастера SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="f3a17-262">Click Finish to complete the SqlDataSource wizard.</span></span>

<span data-ttu-id="f3a17-263">После завершения работы мастера в GridView будет добавлено три BoundFields для отображения `ProductID`, `ProductName`и `CategoryName` столбцы, возвращаемые из запроса, и в результате чего будет получена следующая декларативная разметка:</span><span class="sxs-lookup"><span data-stu-id="f3a17-263">After completing the wizard, the GridView will have three BoundFields added to it displaying the `ProductID`, `ProductName`, and `CategoryName` columns returned from the query and resulting in the following declarative markup:</span></span>

[!code-aspx[Main](querying-data-with-the-sqldatasource-control-vb/samples/sample5.aspx)]

<span data-ttu-id="f3a17-264">[![элементе GridView отображаются ИДЕНТИФИКАТОРы, имена и имена связанных категорий продуктов.](querying-data-with-the-sqldatasource-control-vb/_static/image22.gif)](querying-data-with-the-sqldatasource-control-vb/_static/image21.gif)</span><span class="sxs-lookup"><span data-stu-id="f3a17-264">[![The GridView Shows Each Product s ID, Name, and Associated Category Name](querying-data-with-the-sqldatasource-control-vb/_static/image22.gif)](querying-data-with-the-sqldatasource-control-vb/_static/image21.gif)</span></span>

<span data-ttu-id="f3a17-265">**Рис. 15**. в элементе GRIDVIEW отображаются идентификаторы, имена и имена связанных категорий продуктов ([щелкните, чтобы просмотреть изображение с полным размером](querying-data-with-the-sqldatasource-control-vb/_static/image23.gif)).</span><span class="sxs-lookup"><span data-stu-id="f3a17-265">**Figure 15**: The GridView Shows Each Product s ID, Name, and Associated Category Name ([Click to view full-size image](querying-data-with-the-sqldatasource-control-vb/_static/image23.gif))</span></span>

## <a name="summary"></a><span data-ttu-id="f3a17-266">Сводка</span><span class="sxs-lookup"><span data-stu-id="f3a17-266">Summary</span></span>

<span data-ttu-id="f3a17-267">В этом учебнике мы увидели, как запрашивать и отображать данные с помощью элемента управления SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="f3a17-267">In this tutorial we saw how to query and display data using the SqlDataSource control.</span></span> <span data-ttu-id="f3a17-268">Как и в случае с ObjectDataSource, SqlDataSource выступает в качестве прокси-сервера, предоставляя декларативный подход к доступу к данным.</span><span class="sxs-lookup"><span data-stu-id="f3a17-268">Like the ObjectDataSource, the SqlDataSource serves as a proxy, providing a declarative approach to accessing data.</span></span> <span data-ttu-id="f3a17-269">Его свойства указывают базу данных, к которой необходимо подключиться, а также запрос SQL `SELECT` для выполнения. их можно указать с помощью окно свойств или с помощью мастера настройки источника данных.</span><span class="sxs-lookup"><span data-stu-id="f3a17-269">Its properties specify the database to connect to and the SQL `SELECT` query to execute; they can be specified through the Properties window or by using the Configure DataSource wizard.</span></span>

<span data-ttu-id="f3a17-270">В `SELECT` примерах запросов, которые мы рассматривали в этом учебнике, были возвращены все записи из указанного запроса.</span><span class="sxs-lookup"><span data-stu-id="f3a17-270">The `SELECT` query examples we examined in this tutorial returned all of the records from the specified query.</span></span> <span data-ttu-id="f3a17-271">Однако элемент управления SqlDataSource может содержать предложение `WHERE` с параметрами, значения которых назначаются программно или автоматически извлекаются из указанного источника.</span><span class="sxs-lookup"><span data-stu-id="f3a17-271">The SqlDataSource control, however, can include a `WHERE` clause with parameters whose values are assigned programmatically or are automatically pulled from a specified source.</span></span> <span data-ttu-id="f3a17-272">В следующем руководстве мы рассмотрим, как создавать и использовать параметризованные запросы.</span><span class="sxs-lookup"><span data-stu-id="f3a17-272">We'll examine how to create and use parameterized queries in the next tutorial!</span></span>

<span data-ttu-id="f3a17-273">Поздравляем с программированием!</span><span class="sxs-lookup"><span data-stu-id="f3a17-273">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="f3a17-274">Дополнительные сведения</span><span class="sxs-lookup"><span data-stu-id="f3a17-274">Further Reading</span></span>

<span data-ttu-id="f3a17-275">Дополнительные сведения о разделах, обсуждаемых в этом руководстве, см. в следующих ресурсах:</span><span class="sxs-lookup"><span data-stu-id="f3a17-275">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="f3a17-276">Доступ к данным реляционной базы данных</span><span class="sxs-lookup"><span data-stu-id="f3a17-276">Accessing Relational Database Data</span></span>](http://aspnet.4guysfromrolla.com/articles/022206-1.aspx)
- [<span data-ttu-id="f3a17-277">Общие сведения об элементе управления SqlDataSource</span><span class="sxs-lookup"><span data-stu-id="f3a17-277">SqlDataSource Control Overview</span></span>](https://msdn.microsoft.com/library/dz12d98w.aspx)
- [<span data-ttu-id="f3a17-278">Краткие руководства по ASP.NET: элемент управления SqlDataSource</span><span class="sxs-lookup"><span data-stu-id="f3a17-278">ASP.NET Quickstart Tutorials: The SqlDataSource Control</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/data/sqldatasource.aspx)
- [<span data-ttu-id="f3a17-279">Элемент `<connectionStrings>` Web. config</span><span class="sxs-lookup"><span data-stu-id="f3a17-279">The Web.config `<connectionStrings>` Element</span></span>](https://msdn.microsoft.com/library/bf7sd233.aspx)
- [<span data-ttu-id="f3a17-280">Ссылка на строку подключения к базе данных</span><span class="sxs-lookup"><span data-stu-id="f3a17-280">Database Connection String Reference</span></span>](http://www.connectionstrings.com/)

## <a name="about-the-author"></a><span data-ttu-id="f3a17-281">Об авторе</span><span class="sxs-lookup"><span data-stu-id="f3a17-281">About the Author</span></span>

<span data-ttu-id="f3a17-282">[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи книг по ASP/ASP. NET и основатель [4GuysFromRolla.com](http://www.4guysfromrolla.com), работал с веб-технологиями Майкрософт с 1998.</span><span class="sxs-lookup"><span data-stu-id="f3a17-282">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="f3a17-283">Скотт работает как независимый консультант, преподаватель и модуль записи.</span><span class="sxs-lookup"><span data-stu-id="f3a17-283">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="f3a17-284">Его последняя книга — [*Sams обучать себя ASP.NET 2,0 за 24 часа*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="f3a17-284">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="f3a17-285">Он доступен по адресу [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="f3a17-285">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="f3a17-286">или через его блог, который можно найти по адресу [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="f3a17-286">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="f3a17-287">Специальная благодарность</span><span class="sxs-lookup"><span data-stu-id="f3a17-287">Special Thanks To</span></span>

<span data-ttu-id="f3a17-288">Эта серия руководств была рассмотрена многими полезными рецензентами.</span><span class="sxs-lookup"><span data-stu-id="f3a17-288">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="f3a17-289">Потенциальные рецензенты для этого руководства: Ирина Коннери, Бернадетте Леигх и Дэвид суру.</span><span class="sxs-lookup"><span data-stu-id="f3a17-289">Lead reviewers for this tutorial were Susan Connery, Bernadette Leigh, and David Suru.</span></span> <span data-ttu-id="f3a17-290">Хотите ознакомиться с моими будущими статьями MSDN?</span><span class="sxs-lookup"><span data-stu-id="f3a17-290">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="f3a17-291">Если это так, расположите строку в [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="f3a17-291">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="f3a17-292">[Назад](implementing-optimistic-concurrency-with-the-sqldatasource-cs.md)
> [Вперед](using-parameterized-queries-with-the-sqldatasource-vb.md)</span><span class="sxs-lookup"><span data-stu-id="f3a17-292">[Previous](implementing-optimistic-concurrency-with-the-sqldatasource-cs.md)
[Next](using-parameterized-queries-with-the-sqldatasource-vb.md)</span></span>
