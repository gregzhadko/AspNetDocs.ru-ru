---
uid: web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/using-parameterized-queries-with-the-sqldatasource-cs
title: Использование параметризованных запросов с помощью элемента управления SqlDataSource (C#) | Документация Майкрософт
author: rick-anderson
description: В этом руководстве мы по-прежнему наш взгляд на элемента управления SqlDataSource и узнайте, как определить параметризованных запросов. Параметры могут быть заданы оба объявл...
ms.author: riande
ms.date: 02/20/2007
ms.assetid: 9128aaac-afe2-449f-84b2-bb1d035083c4
msc.legacyurl: /web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/using-parameterized-queries-with-the-sqldatasource-cs
msc.type: authoredcontent
ms.openlocfilehash: 654c0ce5520a206e5e8e2fd20bed92ac1075bfe9
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/01/2019
ms.locfileid: "57035901"
---
<a name="using-parameterized-queries-with-the-sqldatasource-c"></a><span data-ttu-id="0af3e-104">Использование параметризованных запросов с помощью элемента управления SqlDataSource (C#)</span><span class="sxs-lookup"><span data-stu-id="0af3e-104">Using Parameterized Queries with the SqlDataSource (C#)</span></span>
====================
<span data-ttu-id="0af3e-105">по [Скотт Митчелл](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="0af3e-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="0af3e-106">[Скачайте пример приложения](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_48_CS.exe) или [скачать PDF](using-parameterized-queries-with-the-sqldatasource-cs/_static/datatutorial48cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="0af3e-106">[Download Sample App](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_48_CS.exe) or [Download PDF](using-parameterized-queries-with-the-sqldatasource-cs/_static/datatutorial48cs1.pdf)</span></span>

> <span data-ttu-id="0af3e-107">В этом руководстве мы по-прежнему наш взгляд на элемента управления SqlDataSource и узнайте, как определить параметризованных запросов.</span><span class="sxs-lookup"><span data-stu-id="0af3e-107">In this tutorial, we continue our look at the SqlDataSource control and learn how to define parameterized queries.</span></span> <span data-ttu-id="0af3e-108">Параметры можно задать декларативно и программно и могут быть извлечены из нескольких расположений, таких как строку запроса, сеанс состояния, другие элементы управления и многое другое.</span><span class="sxs-lookup"><span data-stu-id="0af3e-108">The parameters can be specified both declaratively and programmatically, and can be pulled from a number of locations such as the querystring, Session state, other controls, and more.</span></span>


## <a name="introduction"></a><span data-ttu-id="0af3e-109">Вступление</span><span class="sxs-lookup"><span data-stu-id="0af3e-109">Introduction</span></span>

<span data-ttu-id="0af3e-110">В предыдущем учебном курсе мы рассмотрели использование элемента управления SqlDataSource для получения данных непосредственно из базы данных.</span><span class="sxs-lookup"><span data-stu-id="0af3e-110">In the previous tutorial we saw how to use the SqlDataSource control to retrieve data directly from a database.</span></span> <span data-ttu-id="0af3e-111">С помощью мастера настройки источника данных, мы могли бы выбрать базу данных и затем либо: выбрать столбцы, возвращаемые из таблицы или представления. Введите пользовательские инструкции SQL; или используйте хранимую процедуру.</span><span class="sxs-lookup"><span data-stu-id="0af3e-111">Using the Configure Data Source wizard, we could choose the database and then either: pick the columns to return from a table or view; enter a custom SQL statement; or use a stored procedure.</span></span> <span data-ttu-id="0af3e-112">Ли выбор столбцов из таблицы или представления, или ввести собственную инструкцию SQL, элемента управления SqlDataSource элемент управления s `SelectCommand` свойству назначается в конечном коде SQL ad-hoc `SELECT` инструкции и является это `SELECT` инструкции, которая является выполняется при SqlDataSource s `Select()` вызывается метод (программно или автоматически из данных веб-элемента управления).</span><span class="sxs-lookup"><span data-stu-id="0af3e-112">Whether selecting columns from a table or view or entering a custom SQL statement, the SqlDataSource control s `SelectCommand` property is assigned the resulting ad-hoc SQL `SELECT` statement and it is this `SELECT` statement that is executed when the SqlDataSource s `Select()` method is invoked (either programmatically or automatically from a data Web control).</span></span>

<span data-ttu-id="0af3e-113">SQL `SELECT` операторы, используемые в предыдущем руководстве s демонстрации не было `WHERE` предложения.</span><span class="sxs-lookup"><span data-stu-id="0af3e-113">The SQL `SELECT` statements used in the previous tutorial s demos lacked `WHERE` clauses.</span></span> <span data-ttu-id="0af3e-114">В `SELECT` инструкции `WHERE` предложение может использоваться для ограничения результатов, возвращаемых.</span><span class="sxs-lookup"><span data-stu-id="0af3e-114">In a `SELECT` statement, the `WHERE` clause can be used to limit the results returned.</span></span> <span data-ttu-id="0af3e-115">Например чтобы отобразить имена на продукты стоимостью более 50,00 долларов США, можно использовать следующий запрос:</span><span class="sxs-lookup"><span data-stu-id="0af3e-115">For example, to display the names of products costing more than $50.00, we could use the following query:</span></span>


[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample1.sql)]

<span data-ttu-id="0af3e-116">Как правило, значения, используемые в `WHERE` предложение определить, какого-либо внешнего источника, например значение строки запроса, переменной сеанса или ввод пользователя с веб-элемент управления на странице.</span><span class="sxs-lookup"><span data-stu-id="0af3e-116">Typically, the values used in a `WHERE` clause are determine by some external source, such as a querystring value, a session variable, or user input from a Web control on the page.</span></span> <span data-ttu-id="0af3e-117">В идеальном случае указаны такие входные данные помощи *параметры*.</span><span class="sxs-lookup"><span data-stu-id="0af3e-117">Ideally, such inputs are specified through the use of *parameters*.</span></span> <span data-ttu-id="0af3e-118">С помощью Microsoft SQL Server, параметры задаются с помощью `@parameterName`, как в:</span><span class="sxs-lookup"><span data-stu-id="0af3e-118">With Microsoft SQL Server, parameters are denoted using `@parameterName`, as in:</span></span>


[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample2.sql)]

<span data-ttu-id="0af3e-119">Элемента управления SqlDataSource поддерживает параметризованные запросы, как для `SELECT` инструкций и `INSERT`, `UPDATE`, и `DELETE` инструкций.</span><span class="sxs-lookup"><span data-stu-id="0af3e-119">The SqlDataSource supports parameterized queries, both for `SELECT` statements and `INSERT`, `UPDATE`, and `DELETE` statements.</span></span> <span data-ttu-id="0af3e-120">Более того значения параметров могут быть автоматически извлечены из различных источников, строку запроса, состояние сеанса, элементы управления на странице и так далее так и программными средствами.</span><span class="sxs-lookup"><span data-stu-id="0af3e-120">Moreover, the parameter values can be automatically pulled from a variety of sources the querystring, session state, controls on the page, and so on or can be assigned programmatically.</span></span> <span data-ttu-id="0af3e-121">В этом руководстве будет показано, как определить также параметризованных запросов, как указать параметр значения декларативно и программно.</span><span class="sxs-lookup"><span data-stu-id="0af3e-121">In this tutorial, we'll see how to define parameterized queries as well as how to specify the parameter values both declaratively and programmatically.</span></span>

> [!NOTE]
> <span data-ttu-id="0af3e-122">В предыдущем учебном курсе мы по сравнению с ObjectDataSource, который стал наше средство выбора сначала 46 руководства с помощью элемента управления SqlDataSource, заметить сходства концептуальной.</span><span class="sxs-lookup"><span data-stu-id="0af3e-122">In the previous tutorial we compared the ObjectDataSource which has been our tool of choice over the first 46 tutorials with the SqlDataSource, noting their conceptual similarities.</span></span> <span data-ttu-id="0af3e-123">Это сходство также применять параметры.</span><span class="sxs-lookup"><span data-stu-id="0af3e-123">These similarities also extend to parameters.</span></span> <span data-ttu-id="0af3e-124">Параметры s ObjectDataSource, соответствующие входным параметрам для методов в уровне бизнес-логики.</span><span class="sxs-lookup"><span data-stu-id="0af3e-124">The ObjectDataSource s parameters mapped to the input parameters for the methods in the Business Logic Layer.</span></span> <span data-ttu-id="0af3e-125">С помощью элемента управления SqlDataSource определения параметров непосредственно в SQL-запроса.</span><span class="sxs-lookup"><span data-stu-id="0af3e-125">With the SqlDataSource, the parameters are defined directly within the SQL query.</span></span> <span data-ttu-id="0af3e-126">Оба элемента управления создавать наборы параметров для их `Select()`, `Insert()`, `Update()`, и `Delete()` методов и оба могут иметь эти значения параметров, заполненное из предварительно определенных источников (значения строк запроса, переменные сеанса и т. д. ) или назначать программным образом.</span><span class="sxs-lookup"><span data-stu-id="0af3e-126">Both controls have collections of parameters for their `Select()`, `Insert()`, `Update()`, and `Delete()` methods, and both can have these parameter values populated from pre-defined sources (querystring values, session variables, and so on) or assigned programmatically.</span></span>


## <a name="creating-a-parameterized-query"></a><span data-ttu-id="0af3e-127">Создание параметризованного запроса</span><span class="sxs-lookup"><span data-stu-id="0af3e-127">Creating a Parameterized Query</span></span>

<span data-ttu-id="0af3e-128">Мастер настройки источника данных s элемента управления SqlDataSource предлагает три пути для определения команды, которые необходимо выполнить, чтобы получить записи базы данных:</span><span class="sxs-lookup"><span data-stu-id="0af3e-128">The SqlDataSource control s Configure Data Source wizard offers three avenues for defining the command to execute to retrieve database records:</span></span>

- <span data-ttu-id="0af3e-129">Выбирая столбцы из существующей таблицы или представления,</span><span class="sxs-lookup"><span data-stu-id="0af3e-129">By picking the columns from an existing table or view,</span></span>
- <span data-ttu-id="0af3e-130">Введя пользовательские инструкции SQL, или</span><span class="sxs-lookup"><span data-stu-id="0af3e-130">By entering a custom SQL statement, or</span></span>
- <span data-ttu-id="0af3e-131">Выбрав хранимой процедуры</span><span class="sxs-lookup"><span data-stu-id="0af3e-131">By choosing a stored procedure</span></span>

<span data-ttu-id="0af3e-132">При выборе столбцов из существующей таблицы или представления, параметры для `WHERE` предложение необходимо указать с помощью добавления `WHERE` диалоговое окно «предложение».</span><span class="sxs-lookup"><span data-stu-id="0af3e-132">When picking columns from an existing table or view, the parameters for the `WHERE` clause must be specified through the Add `WHERE` Clause dialog box.</span></span> <span data-ttu-id="0af3e-133">Создавая пользовательские инструкции SQL, однако можно ввести параметры непосредственно в `WHERE` предложение (с помощью `@parameterName` для обозначения каждого параметра).</span><span class="sxs-lookup"><span data-stu-id="0af3e-133">When creating a custom SQL statement, however, you can enter the parameters directly into the `WHERE` clause (using `@parameterName` to denote each parameter).</span></span> <span data-ttu-id="0af3e-134">Объект [хранимой процедуры](http://www.awprofessional.com/articles/article.asp?p=25288&amp;rl=1) состоит из одного или нескольких инструкций SQL, и эти инструкции могут быть параметризованы.</span><span class="sxs-lookup"><span data-stu-id="0af3e-134">A [stored procedure](http://www.awprofessional.com/articles/article.asp?p=25288&amp;rl=1) consists of one or more SQL statements, and these statements can be parameterized.</span></span> <span data-ttu-id="0af3e-135">Параметры, используемые в инструкциях SQL, тем не менее, должны передаваться в качестве входных параметров хранимой процедуры.</span><span class="sxs-lookup"><span data-stu-id="0af3e-135">The parameters used in the SQL statements, however, must be passed in as input parameters to the stored procedure.</span></span>

<span data-ttu-id="0af3e-136">Так как создание параметризованного запроса зависит от SqlDataSource s `SelectCommand` является указанного, позволяют s взгляните на всех трех подходов.</span><span class="sxs-lookup"><span data-stu-id="0af3e-136">Since creating a parameterized query depends on how the SqlDataSource s `SelectCommand` is specified, let s take a look at all three approaches.</span></span> <span data-ttu-id="0af3e-137">Чтобы приступить к работе, откройте `ParameterizedQueries.aspx` странице в `SqlDataSource` папки, перетащите элемент управления SqlDataSource из инструментария в конструктор и задайте его `ID` для `Products25BucksAndUnderDataSource`.</span><span class="sxs-lookup"><span data-stu-id="0af3e-137">To get started, open the `ParameterizedQueries.aspx` page in the `SqlDataSource` folder, drag a SqlDataSource control from the Toolbox onto the Designer, and set its `ID` to `Products25BucksAndUnderDataSource`.</span></span> <span data-ttu-id="0af3e-138">Затем щелкните ссылку Настройка источника данных в смарт-теге элемента управления s.</span><span class="sxs-lookup"><span data-stu-id="0af3e-138">Next, click the Configure Data Source link from the control s smart tag.</span></span> <span data-ttu-id="0af3e-139">Выберите базу данных, используемую (`NORTHWINDConnectionString`) и нажмите кнопку Далее.</span><span class="sxs-lookup"><span data-stu-id="0af3e-139">Select the database to use (`NORTHWINDConnectionString`) and click Next.</span></span>

## <a name="step-1-adding-awhereclause-when-picking-the-columns-from-a-table-or-view"></a><span data-ttu-id="0af3e-140">Шаг 1. Добавление`WHERE`предложение, при выборе столбцов из таблицы или представления</span><span class="sxs-lookup"><span data-stu-id="0af3e-140">Step 1: Adding a`WHERE`Clause When Picking the Columns from a Table or View</span></span>

<span data-ttu-id="0af3e-141">При выборе данные, возвращаемые из базы данных с помощью элемента управления SqlDataSource, мастер настройки источников данных позволяет нам просто выберите столбцы, для возвращения из существующей таблицы или представления (см. рис. 1).</span><span class="sxs-lookup"><span data-stu-id="0af3e-141">When selecting the data to return from the database with the SqlDataSource control, the Configure Data Source wizard allows us to simply pick the columns to return from an existing table or view (see Figure 1).</span></span> <span data-ttu-id="0af3e-142">Это автоматически создает SQL `SELECT` инструкцию, которая отправляется в базу данных при SqlDataSource s `Select()` вызывается метод.</span><span class="sxs-lookup"><span data-stu-id="0af3e-142">Doing so automatically builds up a SQL `SELECT` statement, which is what is sent to the database when the SqlDataSource s `Select()` method is invoked.</span></span> <span data-ttu-id="0af3e-143">Как и в предыдущем учебном курсе, выберите в раскрывающемся списке таблицу Products и проверьте `ProductID`, `ProductName`, и `UnitPrice` столбцов.</span><span class="sxs-lookup"><span data-stu-id="0af3e-143">As we did in the previous tutorial, select the Products table from the drop-down list and check the `ProductID`, `ProductName`, and `UnitPrice` columns.</span></span>


<span data-ttu-id="0af3e-144">[![Выберите столбцы, возвращаемые из таблицы или представления](using-parameterized-queries-with-the-sqldatasource-cs/_static/image1.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="0af3e-144">[![Pick the Columns to Return from a Table or View](using-parameterized-queries-with-the-sqldatasource-cs/_static/image1.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image1.png)</span></span>

<span data-ttu-id="0af3e-145">**Рис. 1**: Выбрать столбцы для возвращаемого значения из таблицы или представления ([Просмотр полноразмерного изображения](using-parameterized-queries-with-the-sqldatasource-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="0af3e-145">**Figure 1**: Pick the Columns to Return from a Table or View ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image2.png))</span></span>


<span data-ttu-id="0af3e-146">Для включения `WHERE` предложение в `SELECT` инструкцию, нажмите кнопку `WHERE` кнопку, которая вызывает добавление `WHERE` предложение диалоговом (см. рис. 2).</span><span class="sxs-lookup"><span data-stu-id="0af3e-146">To include a `WHERE` clause in the `SELECT` statement, click the `WHERE` button, which brings up the Add `WHERE` Clause dialog box (see Figure 2).</span></span> <span data-ttu-id="0af3e-147">Чтобы добавить параметр, чтобы ограничить результаты, возвращенные `SELECT` запрос, сначала выберите столбец, чтобы фильтровать данные по.</span><span class="sxs-lookup"><span data-stu-id="0af3e-147">To add a parameter to limit the results returned by the `SELECT` query, first choose the column to filter the data by.</span></span> <span data-ttu-id="0af3e-148">Затем выберите оператор, используемый для фильтрации (=, &lt;, &lt;=, &gt;, и так далее).</span><span class="sxs-lookup"><span data-stu-id="0af3e-148">Next, choose the operator to use for filtering (=, &lt;, &lt;=, &gt;, and so on).</span></span> <span data-ttu-id="0af3e-149">Наконец выберите источник s значения параметра, например, из строки запроса или состояние сеанса.</span><span class="sxs-lookup"><span data-stu-id="0af3e-149">Finally, choose the source of the parameter s value, such as from the querystring or session state.</span></span> <span data-ttu-id="0af3e-150">После настройки параметра, нажмите кнопку Добавить, чтобы включить ее в `SELECT` запроса.</span><span class="sxs-lookup"><span data-stu-id="0af3e-150">After configuring the parameter, click the Add button to include it in the `SELECT` query.</span></span>

<span data-ttu-id="0af3e-151">В этом примере s позволяют возвращать только те результаты где `UnitPrice` значение меньше или равно 25,00 долл. США.</span><span class="sxs-lookup"><span data-stu-id="0af3e-151">For this example, let s only return those results where the `UnitPrice` value is less than or equal to $25.00.</span></span> <span data-ttu-id="0af3e-152">Таким образом, выбрать `UnitPrice` из раскрывающегося списка столбцов и &lt;= из списка оператора.</span><span class="sxs-lookup"><span data-stu-id="0af3e-152">Therefore, pick `UnitPrice` from the Column drop-down list and &lt;= from the Operator drop-down list.</span></span> <span data-ttu-id="0af3e-153">При использовании значения параметра жестко (например, $25,00), или если значение параметра должно быть программно задана, выберите Нет исходного стрелку раскрывающегося списка.</span><span class="sxs-lookup"><span data-stu-id="0af3e-153">When using a hard-coded parameter value (such as $25.00) or if the parameter value is to be specified programmatically, select None from the Source drop-down list.</span></span> <span data-ttu-id="0af3e-154">Затем введите значение параметра жестко в поле ввода значения 25,00 и завершить процесс, нажав кнопку «Добавить».</span><span class="sxs-lookup"><span data-stu-id="0af3e-154">Next, enter the hard-coded parameter value in the Value textbox 25.00 and complete the process by clicking the Add button.</span></span>


<span data-ttu-id="0af3e-155">[![Ограничить результаты, возвращаемые из добавить предложение диалоговое окно](using-parameterized-queries-with-the-sqldatasource-cs/_static/image2.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="0af3e-155">[![Limit the Results Returned from the Add WHERE Clause Dialog Box](using-parameterized-queries-with-the-sqldatasource-cs/_static/image2.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image3.png)</span></span>

<span data-ttu-id="0af3e-156">**Рис. 2**: Ограничить результаты, возвращенные из Add `WHERE` диалоговое окно «предложение» ([Просмотр полноразмерного изображения](using-parameterized-queries-with-the-sqldatasource-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="0af3e-156">**Figure 2**: Limit the Results Returned from the Add `WHERE` Clause Dialog Box ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image4.png))</span></span>


<span data-ttu-id="0af3e-157">После добавления параметра, нажмите кнопку ОК, чтобы вернуться в мастер настройки источника данных.</span><span class="sxs-lookup"><span data-stu-id="0af3e-157">After adding the parameter, click OK to return to the Configure Data Source wizard.</span></span> <span data-ttu-id="0af3e-158">`SELECT` Инструкции в нижней части мастера должен включать `WHERE` предложение with параметр с именем `@UnitPrice`:</span><span class="sxs-lookup"><span data-stu-id="0af3e-158">The `SELECT` statement at the bottom of the wizard should now include a `WHERE` clause with a parameter named `@UnitPrice`:</span></span>


[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample3.sql)]

> [!NOTE]
> <span data-ttu-id="0af3e-159">Если указать несколько условий в `WHERE` предложение от добавления `WHERE` в диалоговом окне предложения мастера соединяет их с `AND` оператор.</span><span class="sxs-lookup"><span data-stu-id="0af3e-159">If you specify multiple conditions in the `WHERE` clause from the Add `WHERE` Clause dialog box, the wizard joins them with the `AND` operator.</span></span> <span data-ttu-id="0af3e-160">Если необходимо включить `OR` в `WHERE` предложение (такие как `WHERE UnitPrice <= @UnitPrice OR Discontinued = 1`) вам необходимо будет создать `SELECT` инструкцию через экран пользовательские инструкции SQL.</span><span class="sxs-lookup"><span data-stu-id="0af3e-160">If you need to include an `OR` in the `WHERE` clause (such as `WHERE UnitPrice <= @UnitPrice OR Discontinued = 1`) then you have to build the `SELECT` statement through the custom SQL statement screen.</span></span>


<span data-ttu-id="0af3e-161">Завершить настройку элемента управления SqlDataSource (нажмите кнопку Далее, после чего завершите) и затем проверить декларативную разметку элемента управления SqlDataSource s.</span><span class="sxs-lookup"><span data-stu-id="0af3e-161">Complete configuring the SqlDataSource (click Next, then Finish) and then inspect the SqlDataSource s declarative markup.</span></span> <span data-ttu-id="0af3e-162">Разметка теперь включает `<SelectParameters>` коллекции, которая подробно рассматриваются источники для параметров в `SelectCommand`.</span><span class="sxs-lookup"><span data-stu-id="0af3e-162">The markup now includes a `<SelectParameters>` collection, which spells out the sources for the parameters in the `SelectCommand`.</span></span>


[!code-aspx[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample4.aspx)]

<span data-ttu-id="0af3e-163">Когда SqlDataSource s `Select()` вызывается метод, `UnitPrice` значение параметра (25,00) применяется к `@UnitPrice` параметр в `SelectCommand` перед отправкой в базу данных.</span><span class="sxs-lookup"><span data-stu-id="0af3e-163">When the SqlDataSource s `Select()` method is invoked, the `UnitPrice` parameter value (25.00) is applied to the `@UnitPrice` parameter in the `SelectCommand` before being sent to the database.</span></span> <span data-ttu-id="0af3e-164">Конечным результатом будет то только те продукты, которые меньше или равно $25,00 возвращаются из `Products` таблицы.</span><span class="sxs-lookup"><span data-stu-id="0af3e-164">The net result is that only those products less than or equal to $25.00 are returned from the `Products` table.</span></span> <span data-ttu-id="0af3e-165">Чтобы проверить это, добавить GridView к странице, привяжите его к этому источнику данных и просмотрите страницу через обозреватель.</span><span class="sxs-lookup"><span data-stu-id="0af3e-165">To confirm this, add a GridView to the page, bind it to this data source, and then view the page through a browser.</span></span> <span data-ttu-id="0af3e-166">Вы увидите только этих продуктов в списке, которые меньше или равно $25,00 подтверждает рис. 3.</span><span class="sxs-lookup"><span data-stu-id="0af3e-166">You should only see those products listed that are less than or equal to $25.00, as Figure 3 confirms.</span></span>


<span data-ttu-id="0af3e-167">[![Отображаются только те продукты меньше чем или равен размеру 25,00 долл. США](using-parameterized-queries-with-the-sqldatasource-cs/_static/image3.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="0af3e-167">[![Only Those Products Less Than or Equal to $25.00 are Displayed](using-parameterized-queries-with-the-sqldatasource-cs/_static/image3.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image5.png)</span></span>

<span data-ttu-id="0af3e-168">**Рис. 3**: Отображаются только те продукты меньше чем или равен размеру 25,00 долл. США ([Просмотр полноразмерного изображения](using-parameterized-queries-with-the-sqldatasource-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="0af3e-168">**Figure 3**: Only Those Products Less Than or Equal to $25.00 are Displayed ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image6.png))</span></span>


## <a name="step-2-adding-parameters-to-a-custom-sql-statement"></a><span data-ttu-id="0af3e-169">Шаг 2. Добавление параметров для инструкции настраиваемый SQL</span><span class="sxs-lookup"><span data-stu-id="0af3e-169">Step 2: Adding Parameters to a Custom SQL Statement</span></span>

<span data-ttu-id="0af3e-170">При добавлении пользовательские инструкции SQL можно ввести `WHERE` предложение явным образом или укажите значение в ячейке фильтра построителя запросов.</span><span class="sxs-lookup"><span data-stu-id="0af3e-170">When adding a custom SQL statement you can enter the `WHERE` clause explicitly or specify a value in the Filter cell of the Query Builder.</span></span> <span data-ttu-id="0af3e-171">Чтобы продемонстрировать это, позвольте s отобразить только те продукты, в элементе управления GridView, цены, меньше, чем определенного порогового значения.</span><span class="sxs-lookup"><span data-stu-id="0af3e-171">To demonstrate this, let s display just those products in a GridView whose prices are less than a certain threshold.</span></span> <span data-ttu-id="0af3e-172">Начните с добавления TextBox для `ParameterizedQueries.aspx` страницу для сбора этого порогового значения от пользователя.</span><span class="sxs-lookup"><span data-stu-id="0af3e-172">Start by adding a TextBox to the `ParameterizedQueries.aspx` page to collect this threshold value from the user.</span></span> <span data-ttu-id="0af3e-173">Набор TextBox s `ID` свойства `MaxPrice`.</span><span class="sxs-lookup"><span data-stu-id="0af3e-173">Set the TextBox s `ID` property to `MaxPrice`.</span></span> <span data-ttu-id="0af3e-174">Добавьте кнопку веб-элемент управления и задайте его `Text` свойство для отображения соответствующих продуктов.</span><span class="sxs-lookup"><span data-stu-id="0af3e-174">Add a Button Web control and set its `Text` property to Display Matching Products .</span></span>

<span data-ttu-id="0af3e-175">Затем перетащите элемент управления GridView на страницу, а его смарт-теге, выберите Создание нового элемента управления SqlDataSource с именем `ProductsFilteredByPriceDataSource`.</span><span class="sxs-lookup"><span data-stu-id="0af3e-175">Next, drag a GridView onto the page and from its smart tag choose to create a new SqlDataSource named `ProductsFilteredByPriceDataSource`.</span></span> <span data-ttu-id="0af3e-176">С помощью мастера настройки источника данных, перейдите к Specify собственную инструкцию SQL или хранимой процедуры экрана (см. рис. 4) и введите следующий запрос:</span><span class="sxs-lookup"><span data-stu-id="0af3e-176">From the Configure Data Source wizard, proceed to the Specify a custom SQL statement or stored procedure screen (see Figure 4) and enter the following query:</span></span>


[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample5.sql)]

<span data-ttu-id="0af3e-177">После ввода запроса (вручную или через конструктор запросов), нажмите кнопку "Далее".</span><span class="sxs-lookup"><span data-stu-id="0af3e-177">After entering the query (either manually or through the Query Builder), click Next.</span></span>


<span data-ttu-id="0af3e-178">[![Возвращать только те продукты, меньше или равно значению параметра](using-parameterized-queries-with-the-sqldatasource-cs/_static/image4.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="0af3e-178">[![Return Only Those Products Less Than or Equal to a Parameter Value](using-parameterized-queries-with-the-sqldatasource-cs/_static/image4.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image7.png)</span></span>

<span data-ttu-id="0af3e-179">**Рис. 4**: Возврат только тех продуктов меньше чем или равен размеру значение параметра ([Просмотр полноразмерного изображения](using-parameterized-queries-with-the-sqldatasource-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="0af3e-179">**Figure 4**: Return Only Those Products Less Than or Equal to a Parameter Value ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image8.png))</span></span>


<span data-ttu-id="0af3e-180">Так как запрос включает параметры, на следующем экране мастер запрашивает источником значений параметров.</span><span class="sxs-lookup"><span data-stu-id="0af3e-180">Since the query includes parameters, the next screen in the wizard prompts us for the source of the parameters values.</span></span> <span data-ttu-id="0af3e-181">Выберите элемент управления из списка параметров источника раскрывающегося списка и `MaxPrice` (элемент управления TextBox s `ID` значение) в раскрывающемся списке ControlID.</span><span class="sxs-lookup"><span data-stu-id="0af3e-181">Choose Control from the Parameter source drop-down list and `MaxPrice` (the TextBox control s `ID` value) from the ControlID drop-down list.</span></span> <span data-ttu-id="0af3e-182">Можно также ввести необязательное значение по умолчанию для использования в случае, когда пользователь не ввел любой текст в `MaxPrice` текстового поля.</span><span class="sxs-lookup"><span data-stu-id="0af3e-182">You can also enter an optional default value to use in the case where the user has not entered any text into the `MaxPrice` TextBox.</span></span> <span data-ttu-id="0af3e-183">На данный момент, не вводите значение по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="0af3e-183">For the time being, do not enter a default value.</span></span>


<span data-ttu-id="0af3e-184">[![S MaxPrice текстовое свойство Text используется как источник параметра](using-parameterized-queries-with-the-sqldatasource-cs/_static/image5.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="0af3e-184">[![The MaxPrice TextBox s Text Property is Used as the Parameter Source](using-parameterized-queries-with-the-sqldatasource-cs/_static/image5.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image9.png)</span></span>

<span data-ttu-id="0af3e-185">**Рис. 5**: `MaxPrice` TextBox s `Text` свойство используется в качестве источника параметра ([Просмотр полноразмерного изображения](using-parameterized-queries-with-the-sqldatasource-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="0af3e-185">**Figure 5**: The `MaxPrice` TextBox s `Text` Property is Used as the Parameter Source ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image10.png))</span></span>


<span data-ttu-id="0af3e-186">Следуйте указаниям мастера настройки источников данных, кнопку "Далее", а затем завершите.</span><span class="sxs-lookup"><span data-stu-id="0af3e-186">Complete the Configure Data Source wizard by clicking Next, then Finish.</span></span> <span data-ttu-id="0af3e-187">Декларативная разметка для GridView, TextBox, Button и SqlDataSource выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="0af3e-187">The declarative markup for the GridView, TextBox, Button, and SqlDataSource follows:</span></span>


[!code-aspx[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample6.aspx)]

<span data-ttu-id="0af3e-188">Обратите внимание, что параметру в SqlDataSource s `<SelectParameters>` раздел `ControlParameter`, который включает дополнительные свойства, такие `ControlID` и `PropertyName`.</span><span class="sxs-lookup"><span data-stu-id="0af3e-188">Note that the parameter within the SqlDataSource s `<SelectParameters>` section is a `ControlParameter`, which includes additional properties like `ControlID` and `PropertyName`.</span></span> <span data-ttu-id="0af3e-189">Когда SqlDataSource s `Select()` вызывается метод, `ControlParameter` извлекает значение из указанного свойства элемента управления Web и назначает его соответствующий параметр в `SelectCommand`.</span><span class="sxs-lookup"><span data-stu-id="0af3e-189">When the SqlDataSource s `Select()` method is invoked, the `ControlParameter` grabs the value from the specified Web control property and assigns it to the corresponding parameter in the `SelectCommand`.</span></span> <span data-ttu-id="0af3e-190">В этом примере `MaxPrice` s текстовое свойство используется в качестве `@MaxPrice` значение параметра.</span><span class="sxs-lookup"><span data-stu-id="0af3e-190">In this example, the `MaxPrice` s Text property is used as the `@MaxPrice` parameter value.</span></span>

<span data-ttu-id="0af3e-191">Внимательно просмотреть эту страницу через обозреватель.</span><span class="sxs-lookup"><span data-stu-id="0af3e-191">Take a minute to view this page through a browser.</span></span> <span data-ttu-id="0af3e-192">При первом просмотре странице или всякий раз, когда `MaxPrice` текстовое поле не содержит значения, записи не отображаются в GridView.</span><span class="sxs-lookup"><span data-stu-id="0af3e-192">When first visiting the page or whenever the `MaxPrice` TextBox lacks a value no records are displayed in the GridView.</span></span>


<span data-ttu-id="0af3e-193">[![Нет записей, отображаются при MaxPrice TextBox пустое.](using-parameterized-queries-with-the-sqldatasource-cs/_static/image6.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="0af3e-193">[![No Records are Displayed When the MaxPrice TextBox is Empty](using-parameterized-queries-with-the-sqldatasource-cs/_static/image6.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image11.png)</span></span>

<span data-ttu-id="0af3e-194">**Рис. 6**: Нет записей, отображаемых при `MaxPrice` пустое текстовое поле ([Просмотр полноразмерного изображения](using-parameterized-queries-with-the-sqldatasource-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="0af3e-194">**Figure 6**: No Records are Displayed When the `MaxPrice` TextBox is Empty ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image12.png))</span></span>


<span data-ttu-id="0af3e-195">Продукты не отображаются, так как, по умолчанию пустым значение параметра преобразуется в базу данных `NULL` значение.</span><span class="sxs-lookup"><span data-stu-id="0af3e-195">The reason no products are shown is because, by default, an empty string for a parameter value is converted into a database `NULL` value.</span></span> <span data-ttu-id="0af3e-196">После сравнения `[UnitPrice] <= NULL` всегда имеет значение false, результаты не возвращаются.</span><span class="sxs-lookup"><span data-stu-id="0af3e-196">Since the comparison of `[UnitPrice] <= NULL` always evaluates as False, no results are returned.</span></span>

<span data-ttu-id="0af3e-197">Введите значение в текстовое поле, например 5,00 и нажмите кнопку Display соответствующие продукты.</span><span class="sxs-lookup"><span data-stu-id="0af3e-197">Enter a value into the textbox, like 5.00, and click the Display Matching Products button.</span></span> <span data-ttu-id="0af3e-198">При обратной передаче элемента управления SqlDataSource о том, что GridView, что один из своих источников параметра было изменено.</span><span class="sxs-lookup"><span data-stu-id="0af3e-198">On postback, the SqlDataSource informs the GridView that one of its parameter sources has changed.</span></span> <span data-ttu-id="0af3e-199">Следовательно для элемента GridView выполняет повторную привязку элемента управления SqlDataSource, отображая продукты меньше или равно $5,00.</span><span class="sxs-lookup"><span data-stu-id="0af3e-199">Consequently, the GridView rebinds to the SqlDataSource, displaying those products less than or equal to $5.00.</span></span>


<span data-ttu-id="0af3e-200">[![Отображаются продукты меньше чем или равен размеру 5,00 долл. США](using-parameterized-queries-with-the-sqldatasource-cs/_static/image7.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="0af3e-200">[![Products Less Than or Equal to $5.00 are Displayed](using-parameterized-queries-with-the-sqldatasource-cs/_static/image7.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image13.png)</span></span>

<span data-ttu-id="0af3e-201">**Рис. 7**: Отображаются продукты меньше чем или равен размеру 5,00 долл. США ([Просмотр полноразмерного изображения](using-parameterized-queries-with-the-sqldatasource-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="0af3e-201">**Figure 7**: Products Less Than or Equal to $5.00 are Displayed ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image14.png))</span></span>


## <a name="initially-displaying-all-products"></a><span data-ttu-id="0af3e-202">Изначально отображение всех продуктов</span><span class="sxs-lookup"><span data-stu-id="0af3e-202">Initially Displaying All Products</span></span>

<span data-ttu-id="0af3e-203">Может потребоваться отобразить вместо вывода нет продуктов, при первой загрузке страницы, мы *все* продуктов.</span><span class="sxs-lookup"><span data-stu-id="0af3e-203">Rather than displaying no products when the page is first loaded, we may want to display *all* products.</span></span> <span data-ttu-id="0af3e-204">Один из способов Отображение списка всех продуктов всякий раз, когда `MaxPrice` пуст — присвоить значение по умолчанию параметр s некоторые безумно слишком большое значение, как 1000000, так как оно s, маловероятно, что компания Northwind Traders будет когда-либо иметь инвентаризации цена которых превышает 1 000 000 долларов.</span><span class="sxs-lookup"><span data-stu-id="0af3e-204">One way to list all products whenever the `MaxPrice` TextBox is empty is to set the parameter s default value to some insanely high value, like 1000000, since it s unlikely that Northwind Traders will ever have inventory whose unit price exceeds $1,000,000.</span></span> <span data-ttu-id="0af3e-205">Тем не менее этот подход shortsighted и может не работать в других ситуациях.</span><span class="sxs-lookup"><span data-stu-id="0af3e-205">However, this approach is shortsighted and might not work in other situations.</span></span>

<span data-ttu-id="0af3e-206">В предыдущих учебных курсах - [декларативные параметры](../basic-reporting/declarative-parameters-cs.md) и ["основной/подробности" Фильтрация с помощью элемента управления DropDownList](../masterdetail/master-detail-filtering-with-a-dropdownlist-cs.md) мы были вы столкнулись с подобную проблему.</span><span class="sxs-lookup"><span data-stu-id="0af3e-206">In previous tutorials - [Declarative Parameters](../basic-reporting/declarative-parameters-cs.md) and [Master/Detail Filtering With a DropDownList](../masterdetail/master-detail-filtering-with-a-dropdownlist-cs.md) we were faced with a similar problem.</span></span> <span data-ttu-id="0af3e-207">Существует наше решение заключалось в том, чтобы поместить эту логику на уровне бизнес-логики.</span><span class="sxs-lookup"><span data-stu-id="0af3e-207">Our solution there was to put this logic in the Business Logic Layer.</span></span> <span data-ttu-id="0af3e-208">В частности, BLL проверяется входящее значение и, если он был `NULL` или некоторых зарезервированных значение, вызов направлен методу DAL, возвращаются все записи.</span><span class="sxs-lookup"><span data-stu-id="0af3e-208">Specifically, the BLL examined the incoming value and, if it was `NULL` or some reserved value, the call was routed to the DAL method that returned all records.</span></span> <span data-ttu-id="0af3e-209">Если входящее значение нормальное значение фильтрации, выполнен вызов к методу DAL, который выполнил инструкцию SQL, который использовать параметризованную `WHERE` предложение с помощью предоставленного значения.</span><span class="sxs-lookup"><span data-stu-id="0af3e-209">If the incoming value was a normal filtering value, a call was made to the DAL method that executed a SQL statement that used a parameterized `WHERE` clause with the supplied value.</span></span>

<span data-ttu-id="0af3e-210">К сожалению мы обойти архитектуры при использовании элемента управления SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="0af3e-210">Unfortunately, we bypass the architecture when using the SqlDataSource.</span></span> <span data-ttu-id="0af3e-211">Вместо этого нам нужно настроить инструкцию SQL, чтобы интеллектуально скопировать все записи, если `@MaximumPrice` параметр `NULL` или некоторые зарезервированное значение.</span><span class="sxs-lookup"><span data-stu-id="0af3e-211">Instead, we need to customize the SQL statement to intelligently grab all records if the `@MaximumPrice` parameter is `NULL` or some reserved value.</span></span> <span data-ttu-id="0af3e-212">В этом упражнении let s будет таким образом, если `@MaximumPrice` равен параметр `-1.0`, затем *все* записей должны быть возвращены (`-1.0` работает как зарезервированное значение, поскольку ни один продукт не может иметь отрицательное `UnitPrice`значение).</span><span class="sxs-lookup"><span data-stu-id="0af3e-212">For this exercise, let s have it so that if the `@MaximumPrice` parameter is equal to `-1.0`, then *all* of the records are to be returned (`-1.0` works as a reserved value since no product can have a negative `UnitPrice` value).</span></span> <span data-ttu-id="0af3e-213">Для выполнения этой задачи можно использовать следующую инструкцию SQL:</span><span class="sxs-lookup"><span data-stu-id="0af3e-213">To accomplish this we can use the following SQL statement:</span></span>


[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample7.sql)]

<span data-ttu-id="0af3e-214">Это `WHERE` предложение возвращает *все* Если `@MaximumPrice` slmax равен `-1.0`.</span><span class="sxs-lookup"><span data-stu-id="0af3e-214">This `WHERE` clause returns *all* records if the `@MaximumPrice` parameter equals `-1.0`.</span></span> <span data-ttu-id="0af3e-215">Если значение параметра не `-1.0`, только те продукты, `UnitPrice` меньше или равно `@MaximumPrice` возвращаются значения параметра.</span><span class="sxs-lookup"><span data-stu-id="0af3e-215">If the parameter value is not `-1.0`, only those products whose `UnitPrice` is less than or equal to the `@MaximumPrice` parameter value are returned.</span></span> <span data-ttu-id="0af3e-216">Установив значение по умолчанию `@MaximumPrice` параметр `-1.0`, при первой загрузке страницы (или каждый раз, когда `MaxPrice` пуст), `@MaximumPrice` будет иметь значение `-1.0` и отображаются все продукты.</span><span class="sxs-lookup"><span data-stu-id="0af3e-216">By setting the default value of the `@MaximumPrice` parameter to `-1.0`, on the first page load (or whenever the `MaxPrice` TextBox is empty), `@MaximumPrice` will have a value of `-1.0` and all products will be displayed.</span></span>


<span data-ttu-id="0af3e-217">[![Теперь все продукты, отображаются при MaxPrice TextBox пустое](using-parameterized-queries-with-the-sqldatasource-cs/_static/image8.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="0af3e-217">[![Now All Products are Displayed When the MaxPrice TextBox is Empty](using-parameterized-queries-with-the-sqldatasource-cs/_static/image8.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image15.png)</span></span>

<span data-ttu-id="0af3e-218">**Рис. 8**: Теперь все продукты, отображаемый при `MaxPrice` пустое текстовое поле ([Просмотр полноразмерного изображения](using-parameterized-queries-with-the-sqldatasource-cs/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="0af3e-218">**Figure 8**: Now All Products are Displayed When the `MaxPrice` TextBox is Empty ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image16.png))</span></span>


<span data-ttu-id="0af3e-219">Существует несколько предостережений отметить при таком подходе.</span><span class="sxs-lookup"><span data-stu-id="0af3e-219">There are a couple of caveats to note with this approach.</span></span> <span data-ttu-id="0af3e-220">Во-первых, учтите, что тип данных параметра s определяется по его использованию s в SQL-запросе.</span><span class="sxs-lookup"><span data-stu-id="0af3e-220">First, realize that the parameter s data type is inferred by it s usage in the SQL query.</span></span> <span data-ttu-id="0af3e-221">При изменении `WHERE` предложение из `@MaximumPrice = -1.0` для `@MaximumPrice = -1`, среда выполнения рассматривает параметр как целое число.</span><span class="sxs-lookup"><span data-stu-id="0af3e-221">If you change the `WHERE` clause from `@MaximumPrice = -1.0` to `@MaximumPrice = -1`, the runtime treats the parameter as an integer.</span></span> <span data-ttu-id="0af3e-222">Если после этого вы пытаетесь назначить `MaxPrice` текстовое поле в десятичное значение (например, 5,00), произойдет ошибка, так как она не может преобразовать 5,00 целое число.</span><span class="sxs-lookup"><span data-stu-id="0af3e-222">If you then attempt to assign the `MaxPrice` TextBox to a decimal value (like 5.00 ), an error will occur because it cannot convert 5.00 to an integer.</span></span> <span data-ttu-id="0af3e-223">Чтобы это исправить, либо убедитесь, что используется `@MaximumPrice = -1.0` в `WHERE` предложение или лучше, установите `ControlParameter` объект s `Type` свойство в десятичное число.</span><span class="sxs-lookup"><span data-stu-id="0af3e-223">To remedy this, either make sure that you use `@MaximumPrice = -1.0` in the `WHERE` clause or, better yet, set the `ControlParameter` object s `Type` property to Decimal .</span></span>

<span data-ttu-id="0af3e-224">Во-вторых, добавив `OR @MaximumPrice = -1.0` для `WHERE` предложение, обработчик запросов не может использовать индекс `UnitPrice` (при условии, что один существует), таким образом, путем просмотра таблицы.</span><span class="sxs-lookup"><span data-stu-id="0af3e-224">Secondly, by adding the `OR @MaximumPrice = -1.0` to the `WHERE` clause, the query engine cannot use an index on `UnitPrice` (assuming one exists), thereby resulting in a table scan.</span></span> <span data-ttu-id="0af3e-225">Это может повлиять на производительность при наличии достаточно большим количеством записей в `Products` таблицы.</span><span class="sxs-lookup"><span data-stu-id="0af3e-225">This can impact performance if there are a sufficiently large number of records in the `Products` table.</span></span> <span data-ttu-id="0af3e-226">Более удачным подходом было бы переместить эту логику в хранимой процедуре где `IF` либо выполнит инструкцию `SELECT` запрос из `Products` таблицы без `WHERE` предложения, когда все записи должны быть возвращены или одним которого `WHERE` предложение содержит только `UnitPrice` критериям, чтобы можно было использовать индекс.</span><span class="sxs-lookup"><span data-stu-id="0af3e-226">A better approach would be to move this logic to a stored procedure where an `IF` statement would either perform a `SELECT` query from the `Products` table without a `WHERE` clause when all records need to be returned or one whose `WHERE` clause contains just the `UnitPrice` criteria, so that an index can be used.</span></span>

## <a name="step-3-creating-and-using-parameterized-stored-procedures"></a><span data-ttu-id="0af3e-227">Шаг 3. Создание и использование параметризованные хранимые процедуры</span><span class="sxs-lookup"><span data-stu-id="0af3e-227">Step 3: Creating and Using Parameterized Stored Procedures</span></span>

<span data-ttu-id="0af3e-228">Хранимые процедуры можно включить набор входных параметров, которые затем могут использоваться в инструкции SQL, определенные в хранимой процедуре.</span><span class="sxs-lookup"><span data-stu-id="0af3e-228">Stored procedures can include a set of input parameters that can then be used in the SQL statement(s) defined within the stored procedure.</span></span> <span data-ttu-id="0af3e-229">При настройке элемента управления SqlDataSource использовать хранимую процедуру, которая принимает входные параметры, значения этих параметров можно указать с помощью приемов, как и в случае нерегламентированных инструкций SQL.</span><span class="sxs-lookup"><span data-stu-id="0af3e-229">When configuring the SqlDataSource to use a stored procedure that accepts input parameters, these parameter values can be specified using the same techniques as with ad-hoc SQL statements.</span></span>

<span data-ttu-id="0af3e-230">Чтобы проиллюстрировать использование хранимых процедур в элемента управления SqlDataSource, s позволяют создать новую хранимую процедуру в базе данных "Борей" с именем `GetProductsByCategory`, который принимает параметр с именем `@CategoryID` и возвращает все столбцы из продуктов, `CategoryID` столбец совпадает `@CategoryID`.</span><span class="sxs-lookup"><span data-stu-id="0af3e-230">To illustrate using stored procedures in the SqlDataSource, let s create a new stored procedure in the Northwind database named `GetProductsByCategory`, which accepts a parameter named `@CategoryID` and returns all of the columns of the products whose `CategoryID` column matches `@CategoryID`.</span></span> <span data-ttu-id="0af3e-231">Чтобы создать хранимую процедуру, перейдите в проводник по серверам и детализировать `NORTHWND.MDF` базы данных.</span><span class="sxs-lookup"><span data-stu-id="0af3e-231">To create a stored procedure, go to the Server Explorer and drill down into the `NORTHWND.MDF` database.</span></span> <span data-ttu-id="0af3e-232">(Если Дон t см. в разделе проводника, открыть его, перейдя в меню "Вид" и выбрав параметр Server Explorer.)</span><span class="sxs-lookup"><span data-stu-id="0af3e-232">(If you don t see the Server Explorer, bring it up by going to the View menu and selecting the Server Explorer option.)</span></span>

<span data-ttu-id="0af3e-233">Из `NORTHWND.MDF` базы данных, щелкните правой кнопкой мыши на папку хранимые процедуры, выберите Добавить новую хранимую процедуру и введите следующий синтаксис:</span><span class="sxs-lookup"><span data-stu-id="0af3e-233">From the `NORTHWND.MDF` database, right-click on the Stored Procedures folder, choose Add New Stored Procedure, and enter the following syntax:</span></span>


[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample8.sql)]

<span data-ttu-id="0af3e-234">Щелкните Save значок (или Ctrl + S) чтобы сохранить хранимую процедуру.</span><span class="sxs-lookup"><span data-stu-id="0af3e-234">Click the Save icon (or Ctrl+S) to save the stored procedure.</span></span> <span data-ttu-id="0af3e-235">Хранимую процедуру можно проверить, щелкнув его в папке хранимые процедуры и выбор Execute.</span><span class="sxs-lookup"><span data-stu-id="0af3e-235">You can test the stored procedure by right-clicking it from the Stored Procedures folder and choosing Execute.</span></span> <span data-ttu-id="0af3e-236">Это будет запрашивать параметры хранимых процедур s (`@CategoryID`, в данном экземпляре), после которого результаты отображаются в окне вывода.</span><span class="sxs-lookup"><span data-stu-id="0af3e-236">This will prompt you for the stored procedure s parameters (`@CategoryID`, in this instance), after which the results will be displayed in the Output window.</span></span>


<span data-ttu-id="0af3e-237">[![GetProductsByCategory хранимой процедуры, при выполнении с @CategoryID 1](using-parameterized-queries-with-the-sqldatasource-cs/_static/image9.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="0af3e-237">[![The GetProductsByCategory Stored Procedure when Executed with a @CategoryID of 1](using-parameterized-queries-with-the-sqldatasource-cs/_static/image9.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image17.png)</span></span>

<span data-ttu-id="0af3e-238">**Рис. 9**: `GetProductsByCategory` Хранимой процедуры, при выполнении с `@CategoryID` 1 ([Просмотр полноразмерного изображения](using-parameterized-queries-with-the-sqldatasource-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="0af3e-238">**Figure 9**: The `GetProductsByCategory` Stored Procedure when Executed with a `@CategoryID` of 1 ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image18.png))</span></span>


<span data-ttu-id="0af3e-239">Позвольте s Используйте эту хранимую процедуру, чтобы отобразить все продукты в категории «Напитки» в элементе управления GridView.</span><span class="sxs-lookup"><span data-stu-id="0af3e-239">Let s use this stored procedure to display all products in the Beverages category in a GridView.</span></span> <span data-ttu-id="0af3e-240">Добавление нового элемента управления GridView на страницу и привязать его к нового элемента управления SqlDataSource с именем `BeverageProductsDataSource`.</span><span class="sxs-lookup"><span data-stu-id="0af3e-240">Add a new GridView to the page and bind it to a new SqlDataSource named `BeverageProductsDataSource`.</span></span> <span data-ttu-id="0af3e-241">По-прежнему в указать собственную инструкцию SQL или хранимой процедуры экрана, установите переключатель в хранимые процедуры и выбрать `GetProductsByCategory` хранимую процедуру из раскрывающегося списка.</span><span class="sxs-lookup"><span data-stu-id="0af3e-241">Continue to the Specify a custom SQL statement or stored procedure screen, select the Stored procedure radio button, and pick the `GetProductsByCategory` stored procedure from the drop-down list.</span></span>


<span data-ttu-id="0af3e-242">[![Выберите GetProductsByCategory хранимую процедуру из раскрывающегося списка](using-parameterized-queries-with-the-sqldatasource-cs/_static/image10.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="0af3e-242">[![Select the GetProductsByCategory Stored Procedure from the Drop-Down List](using-parameterized-queries-with-the-sqldatasource-cs/_static/image10.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image19.png)</span></span>

<span data-ttu-id="0af3e-243">**Рис. 10**: Выберите `GetProductsByCategory` хранимую процедуру из раскрывающегося списка ([Просмотр полноразмерного изображения](using-parameterized-queries-with-the-sqldatasource-cs/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="0af3e-243">**Figure 10**: Select the `GetProductsByCategory` Stored Procedure from the Drop-Down List ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image20.png))</span></span>


<span data-ttu-id="0af3e-244">Так как хранимая процедура принимает входной параметр (`@CategoryID`), нажав кнопку Далее предлагает указать источник для этого параметра значение s.</span><span class="sxs-lookup"><span data-stu-id="0af3e-244">Since the stored procedure accepts an input parameter (`@CategoryID`), clicking Next prompts us to specify the source for this parameter s value.</span></span> <span data-ttu-id="0af3e-245">Напитков `CategoryID` имеет значение 1, поэтому оставьте ни один параметр исходного стрелку раскрывающегося списка и введите 1 в текстовое поле DefaultValue.</span><span class="sxs-lookup"><span data-stu-id="0af3e-245">The Beverages `CategoryID` is 1, so leave the Parameter source drop-down list at None and enter 1 into the DefaultValue textbox.</span></span>


<span data-ttu-id="0af3e-246">[![Использование жестко запрограммированных значений 1 для возврата продуктов в категории «Напитки»](using-parameterized-queries-with-the-sqldatasource-cs/_static/image11.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="0af3e-246">[![Use a Hard-Coded Value of 1 to Return the Products in the Beverages Category](using-parameterized-queries-with-the-sqldatasource-cs/_static/image11.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image21.png)</span></span>

<span data-ttu-id="0af3e-247">**Рис. 11**: Использование Hard-Coded значение 1 для возврата продуктов в категории «Напитки» ([Просмотр полноразмерного изображения](using-parameterized-queries-with-the-sqldatasource-cs/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="0af3e-247">**Figure 11**: Use a Hard-Coded Value of 1 to Return the Products in the Beverages Category ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image22.png))</span></span>


<span data-ttu-id="0af3e-248">Как показано в следующем декларативная разметка, при помощи хранимой процедуры, SqlDataSource s `SelectCommand` свойству присваивается имя хранимой процедуры и [ `SelectCommandType` свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.selectcommandtype.aspx) присваивается `StoredProcedure`, указывающее, `SelectCommand` имя хранимой процедуры, а не специальный оператор SQL.</span><span class="sxs-lookup"><span data-stu-id="0af3e-248">As the following declarative markup shows, when using a stored procedure, the SqlDataSource s `SelectCommand` property is set to the name of the stored procedure and the [`SelectCommandType` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.selectcommandtype.aspx) is set to `StoredProcedure`, indicating that the `SelectCommand` is the name of a stored procedure rather than an ad-hoc SQL statement.</span></span>


[!code-aspx[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample9.aspx)]

<span data-ttu-id="0af3e-249">Протестировать страницу в браузере.</span><span class="sxs-lookup"><span data-stu-id="0af3e-249">Test out the page in a browser.</span></span> <span data-ttu-id="0af3e-250">Отображаются только те продукты, принадлежащие к категории «Напитки», несмотря на то что *все* отображения полей продукта с момента `GetProductsByCategory` хранимая процедура возвращает все столбцы из `Products` таблицы.</span><span class="sxs-lookup"><span data-stu-id="0af3e-250">Only those products that belong to the Beverages category are displayed, although *all* of the product fields are displayed since the `GetProductsByCategory` stored procedure returns all of the columns from the `Products` table.</span></span> <span data-ttu-id="0af3e-251">Мы могут, само собой, ограничить или настраивать поля, отображаемый в GridView в диалоговом окне Правка столбцов s GridView.</span><span class="sxs-lookup"><span data-stu-id="0af3e-251">We could, of course, limit or customize the fields displayed in the GridView from the GridView s Edit Columns dialog box.</span></span>


<span data-ttu-id="0af3e-252">[![Отображаются все напитков](using-parameterized-queries-with-the-sqldatasource-cs/_static/image12.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="0af3e-252">[![All of the Beverages are Displayed](using-parameterized-queries-with-the-sqldatasource-cs/_static/image12.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image23.png)</span></span>

<span data-ttu-id="0af3e-253">**Рис. 12**: Отображаются все напитков ([Просмотр полноразмерного изображения](using-parameterized-queries-with-the-sqldatasource-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="0af3e-253">**Figure 12**: All of the Beverages are Displayed ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image24.png))</span></span>


## <a name="step-4-programmatically-invoking-a-sqldatasource-sselectstatement"></a><span data-ttu-id="0af3e-254">Шаг 4. Программного вызова SqlDataSource s`Select()`инструкции</span><span class="sxs-lookup"><span data-stu-id="0af3e-254">Step 4: Programmatically Invoking a SqlDataSource s`Select()`Statement</span></span>

<span data-ttu-id="0af3e-255">Примеры мы видели в предыдущем учебном курсе, а этот учебник ve привязку элементов управления SqlDataSource непосредственно к GridView.</span><span class="sxs-lookup"><span data-stu-id="0af3e-255">The examples we ve seen in the previous tutorial and this tutorial so far have bound SqlDataSource controls directly to a GridView.</span></span> <span data-ttu-id="0af3e-256">Данные элемента управления s SqlDataSource, тем не менее, может быть программно доступно и перечисления в коде.</span><span class="sxs-lookup"><span data-stu-id="0af3e-256">The SqlDataSource control s data, however, can be programmatically accessed and enumerated in code.</span></span> <span data-ttu-id="0af3e-257">Это может быть полезно, когда нужно запрашивать данные для ее проверки, но Дон t нужно отобразить ее.</span><span class="sxs-lookup"><span data-stu-id="0af3e-257">This can be particularly useful when you need to query data to inspect it, but don t need to display it.</span></span> <span data-ttu-id="0af3e-258">Вместо того, чтобы записать все стереотипный код ADO.NET для подключения к базе данных, укажите команду и получать результаты, вы можете разрешить элемента управления SqlDataSource обрабатывать этот монотонную код.</span><span class="sxs-lookup"><span data-stu-id="0af3e-258">Rather than having to write all of the boilerplate ADO.NET code to connect to the database, specify the command, and retrieve the results, you can let the SqlDataSource handle this monotonous code.</span></span>

<span data-ttu-id="0af3e-259">Для иллюстрации работы с SqlDataSource s данных программными средствами, представьте, что начальника достиг вы с запросом на создание веб-страницы, в котором отображается имя случайным образом выбранной категории и соответствующие продукты.</span><span class="sxs-lookup"><span data-stu-id="0af3e-259">To illustrate working with the SqlDataSource s data programmatically, imagine that your boss has approached you with a request to create a web page that displays the name of a randomly selected category and its associated products.</span></span> <span data-ttu-id="0af3e-260">То есть, когда пользователь посещает эту страницу, мы хотим случайным образом выбрать категорию из `Categories` таблицы, отображаемое имя категории и затем список продуктов, принадлежащих к этой категории.</span><span class="sxs-lookup"><span data-stu-id="0af3e-260">That is, when a user visits this page, we want to randomly choose a category from the `Categories` table, display the category name, and then list the products belonging to that category.</span></span>

<span data-ttu-id="0af3e-261">Для этого необходимы два элемента управления SqlDataSource один для получения случайных категории из `Categories` таблицу, а другую следует получить категорию продукты.</span><span class="sxs-lookup"><span data-stu-id="0af3e-261">To accomplish this we need two SqlDataSource controls one to grab a random category from the `Categories` table and another to get the category s products.</span></span> <span data-ttu-id="0af3e-262">Мы выполним сборку элемента управления SqlDataSource, извлекающий запись случайных категории на этом шаге; Шаг 5 рассматривает берет на себя создание элемента управления SqlDataSource, запрашивающего продукты категории s.</span><span class="sxs-lookup"><span data-stu-id="0af3e-262">We'll build the SqlDataSource that retrieves a random category record in this step; Step 5 looks at crafting the SqlDataSource that retrieves the category s products.</span></span>

<span data-ttu-id="0af3e-263">Начните с добавления элемента управления SqlDataSource для `ParameterizedQueries.aspx` и задайте его `ID` для `RandomCategoryDataSource`.</span><span class="sxs-lookup"><span data-stu-id="0af3e-263">Start by adding a SqlDataSource to `ParameterizedQueries.aspx` and set its `ID` to `RandomCategoryDataSource`.</span></span> <span data-ttu-id="0af3e-264">Настройте его таким образом, чтобы он использует следующий запрос SQL:</span><span class="sxs-lookup"><span data-stu-id="0af3e-264">Configure it so that it uses the following SQL query:</span></span>


[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample10.sql)]

<span data-ttu-id="0af3e-265">`ORDER BY NEWID()` Возвращает записи, отсортированные в случайном порядке (см. в разделе [Using `NEWID()` к случайным образом Сортировка записей](http://www.sqlteam.com/item.asp?ItemID=8747)).</span><span class="sxs-lookup"><span data-stu-id="0af3e-265">`ORDER BY NEWID()` returns the records sorted in random order (see [Using `NEWID()` to Randomly Sort Records](http://www.sqlteam.com/item.asp?ItemID=8747)).</span></span> <span data-ttu-id="0af3e-266">`SELECT TOP 1` Возвращает первую запись из результирующего набора.</span><span class="sxs-lookup"><span data-stu-id="0af3e-266">`SELECT TOP 1` returns the first record from the result set.</span></span> <span data-ttu-id="0af3e-267">В совокупности этот запрос возвращает `CategoryID` и `CategoryName` значения столбцов из одной, случайно выбранный категории.</span><span class="sxs-lookup"><span data-stu-id="0af3e-267">Put together, this query returns the `CategoryID` and `CategoryName` column values from a single, randomly selected category.</span></span>

<span data-ttu-id="0af3e-268">Чтобы отобразить категории s `CategoryName` значение, добавьте на страницу элемент управления Label Web, задайте его `ID` свойства `CategoryNameLabel`и очистите его `Text` свойство.</span><span class="sxs-lookup"><span data-stu-id="0af3e-268">To display the category s `CategoryName` value, add a Label Web control to the page, set its `ID` property to `CategoryNameLabel`, and clear out its `Text` property.</span></span> <span data-ttu-id="0af3e-269">Чтобы программным способом извлечения данных из элемента управления SqlDataSource, нам необходимо вызвать его `Select()` метод.</span><span class="sxs-lookup"><span data-stu-id="0af3e-269">To programmatically retrieve the data from a SqlDataSource control, we need to invoke its `Select()` method.</span></span> <span data-ttu-id="0af3e-270">[ `Select()` Метод](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.select.aspx) ожидает, что один входной параметр типа [ `DataSourceSelectArguments` ](https://msdn.microsoft.com/library/system.web.ui.datasourceselectarguments.aspx), которое указывает, как данные должны быть сообщения перед возвращением.</span><span class="sxs-lookup"><span data-stu-id="0af3e-270">The [`Select()` method](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.select.aspx) expects a single input parameter of type [`DataSourceSelectArguments`](https://msdn.microsoft.com/library/system.web.ui.datasourceselectarguments.aspx), which specifies how the data should be messaged before being returned.</span></span> <span data-ttu-id="0af3e-271">Это может включать инструкции для сортировки и фильтрации данных и используемые данные, которые веб-элементов управления при сортировке или разбиение по страницам данные из элемента управления SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="0af3e-271">This can include instructions on sorting and filtering the data, and is used by the data Web controls when sorting or paging through the data from a SqlDataSource control.</span></span> <span data-ttu-id="0af3e-272">В нашем примере мы кое t нужно данных изменить перед возвращением и таким образом будет передать в `DataSourceSelectArguments.Empty` объекта.</span><span class="sxs-lookup"><span data-stu-id="0af3e-272">For our example, though, we don t need the data to be modified before being returned, and therefore will pass in the `DataSourceSelectArguments.Empty` object.</span></span>

<span data-ttu-id="0af3e-273">`Select()` Метод возвращает объект, реализующий `IEnumerable`.</span><span class="sxs-lookup"><span data-stu-id="0af3e-273">The `Select()` method returns an object that implements `IEnumerable`.</span></span> <span data-ttu-id="0af3e-274">Точный тип, возвращенный зависит от значения элемента управления SqlDataSource s [ `DataSourceMode` свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.datasourcemode.aspx).</span><span class="sxs-lookup"><span data-stu-id="0af3e-274">The precise type returned depends on the value of the SqlDataSource control s [`DataSourceMode` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.datasourcemode.aspx).</span></span> <span data-ttu-id="0af3e-275">Как уже обсуждалось в предыдущем учебном курсе, это свойство может быть присвоено значение `DataSet` или `DataReader`.</span><span class="sxs-lookup"><span data-stu-id="0af3e-275">As discussed in the previous tutorial, this property can be set to a value of either `DataSet` or `DataReader`.</span></span> <span data-ttu-id="0af3e-276">Если значение `DataSet`, `Select()` возвращает [DataView](https://msdn.microsoft.com/library/01s96x0z.aspx) объекта; Если же задано `DataReader`, он возвращает объект, реализующий [ `IDataReader` ](https://msdn.microsoft.com/library/system.data.idatareader.aspx).</span><span class="sxs-lookup"><span data-stu-id="0af3e-276">If set to `DataSet`, the `Select()` method returns a [DataView](https://msdn.microsoft.com/library/01s96x0z.aspx) object; if set to `DataReader`, it returns an object that implements [`IDataReader`](https://msdn.microsoft.com/library/system.data.idatareader.aspx).</span></span> <span data-ttu-id="0af3e-277">Так как `RandomCategoryDataSource` SqlDataSource имеет его `DataSourceMode` свойство значение `DataSet` (по умолчанию), мы будем работать с использованием объекта DataView.</span><span class="sxs-lookup"><span data-stu-id="0af3e-277">Since the `RandomCategoryDataSource` SqlDataSource has its `DataSourceMode` property set to `DataSet` (the default), we will be working with a DataView object.</span></span>

<span data-ttu-id="0af3e-278">Следующий код показывает, как получить записи из `RandomCategoryDataSource` SqlDataSource как DataView а также способы чтения `CategoryName` значение столбца в первой строке DataView:</span><span class="sxs-lookup"><span data-stu-id="0af3e-278">The following code illustrates how to retrieve the records from the `RandomCategoryDataSource` SqlDataSource as a DataView as well as how to read the `CategoryName` column value from the first DataView row:</span></span>


[!code-csharp[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample11.cs)]

<span data-ttu-id="0af3e-279">`randomCategoryView[0]` Возвращает первый `DataRowView` в DataView.</span><span class="sxs-lookup"><span data-stu-id="0af3e-279">`randomCategoryView[0]` returns the first `DataRowView` in the DataView.</span></span> <span data-ttu-id="0af3e-280">`randomCategoryView[0]["CategoryName"]` Возвращает значение `CategoryName` столбца в первом ряду.</span><span class="sxs-lookup"><span data-stu-id="0af3e-280">`randomCategoryView[0]["CategoryName"]` returns the value of the `CategoryName` column in this first row.</span></span> <span data-ttu-id="0af3e-281">Обратите внимание, что DataView слабо типизированной.</span><span class="sxs-lookup"><span data-stu-id="0af3e-281">Note that the DataView is loosely-typed.</span></span> <span data-ttu-id="0af3e-282">Для ссылки на значение определенного столбца, нам нужно передать имя столбца в виде строки (в данном случае «категория»).</span><span class="sxs-lookup"><span data-stu-id="0af3e-282">To reference a particular column value we need to pass in the name of the column as a string ( CategoryName, in this case).</span></span> <span data-ttu-id="0af3e-283">Рис. 13 показано сообщение, отображаемое в `CategoryNameLabel` при просмотре страницы.</span><span class="sxs-lookup"><span data-stu-id="0af3e-283">Figure 13 shows the message displayed in the `CategoryNameLabel` when viewing the page.</span></span> <span data-ttu-id="0af3e-284">Разумеется, фактическое имя категории отображаемых выбирается случайным образом по `RandomCategoryDataSource` SqlDataSource на каждом посещении страницы (включая обратных передачах).</span><span class="sxs-lookup"><span data-stu-id="0af3e-284">Of course, the actual category name displayed is randomly selected by the `RandomCategoryDataSource` SqlDataSource on each visit to the page (including postbacks).</span></span>


<span data-ttu-id="0af3e-285">[![S случайным образом выбрать категорию, отображается имя](using-parameterized-queries-with-the-sqldatasource-cs/_static/image13.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="0af3e-285">[![The Randomly Selected Category s Name is Displayed](using-parameterized-queries-with-the-sqldatasource-cs/_static/image13.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image25.png)</span></span>

<span data-ttu-id="0af3e-286">**Рис. 13**: S случайным образом выбранных категорий, название ([Просмотр полноразмерного изображения](using-parameterized-queries-with-the-sqldatasource-cs/_static/image26.png))</span><span class="sxs-lookup"><span data-stu-id="0af3e-286">**Figure 13**: The Randomly Selected Category s Name is Displayed ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image26.png))</span></span>


> [!NOTE]
> <span data-ttu-id="0af3e-287">Если элемента управления SqlDataSource элемента управления s `DataSourceMode` свойство было присвоено значение `DataReader`, возвращаемое значение из `Select()` метод пришлось бы привести к `IDataReader`.</span><span class="sxs-lookup"><span data-stu-id="0af3e-287">If the SqlDataSource control s `DataSourceMode` property had been set to `DataReader`, the return value from the `Select()` method would have needed to be cast to `IDataReader`.</span></span> <span data-ttu-id="0af3e-288">Для чтения `CategoryName` значение столбца в первой строке, мы d использовать следующий код:</span><span class="sxs-lookup"><span data-stu-id="0af3e-288">To read the `CategoryName` column value from the first row, we d use code like:</span></span>


[!code-csharp[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample12.cs)]

<span data-ttu-id="0af3e-289">С помощью элемента управления SqlDataSource случайным образом выбирать категорию, мы будет готов для добавления GridView, которая перечисляет продукты категории s.</span><span class="sxs-lookup"><span data-stu-id="0af3e-289">With the SqlDataSource randomly selecting a category, we re ready to add the GridView that lists the category s products.</span></span>

> [!NOTE]
> <span data-ttu-id="0af3e-290">Вместо того чтобы использовать элемент управления Label Web, чтобы отобразить имя категории s, удалось добавлена FormView и DetailsView на страницу, привязав его к элемента управления SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="0af3e-290">Rather than using a Label Web control to display the category s name, we could have added a FormView or DetailsView to the page, binding it to the SqlDataSource.</span></span> <span data-ttu-id="0af3e-291">Тем не менее, с помощью метки, позволил нам о том, как программным способом вызвать SqlDataSource s `Select()` инструкции, а также работать с его полученные данные в коде.</span><span class="sxs-lookup"><span data-stu-id="0af3e-291">Using the Label, however, allowed us to explore how to programmatically invoke the SqlDataSource s `Select()` statement and work with its resulting data in code.</span></span>


## <a name="step-5-assigning-parameter-values-programmatically"></a><span data-ttu-id="0af3e-292">Шаг 5. Назначение значения параметров программно</span><span class="sxs-lookup"><span data-stu-id="0af3e-292">Step 5: Assigning Parameter Values Programmatically</span></span>

<span data-ttu-id="0af3e-293">Во всех примерах мы видели в этом руководстве ve использовали значение параметра жестко или один из одного из источников предварительно определенных параметров (значение строки запроса, веб-элемент управления на странице и т. д.).</span><span class="sxs-lookup"><span data-stu-id="0af3e-293">All of the examples we ve seen so far in this tutorial have used either a hard-coded parameter value or one taken from one of the pre-defined parameter sources (a querystring value, a Web control on the page, and so on).</span></span> <span data-ttu-id="0af3e-294">Тем не менее s параметры элемента управления SqlDataSource могут также устанавливаться программными средствами.</span><span class="sxs-lookup"><span data-stu-id="0af3e-294">However, the SqlDataSource control s parameters can also be set programmatically.</span></span> <span data-ttu-id="0af3e-295">До завершения текущего, мы должны SqlDataSource, который возвращает все продукты, принадлежащие к указанной категории.</span><span class="sxs-lookup"><span data-stu-id="0af3e-295">To complete our current example, we need a SqlDataSource that returns all of the products belonging to a specified category.</span></span> <span data-ttu-id="0af3e-296">Будет иметь этого элемента управления SqlDataSource `CategoryID` на основе параметра, значение которого требуется задать `CategoryID` значения столбца, возвращенного `RandomCategoryDataSource` SqlDataSource в `Page_Load` обработчик событий.</span><span class="sxs-lookup"><span data-stu-id="0af3e-296">This SqlDataSource will have a `CategoryID` parameter whose value needs to be set based on the `CategoryID` column value returned by the `RandomCategoryDataSource` SqlDataSource in the `Page_Load` event handler.</span></span>

<span data-ttu-id="0af3e-297">Начните с добавления элемента управления GridView на страницу и привязать его к нового элемента управления SqlDataSource с именем `ProductsByCategoryDataSource`.</span><span class="sxs-lookup"><span data-stu-id="0af3e-297">Start by adding a GridView to the page and bind it to a new SqlDataSource named `ProductsByCategoryDataSource`.</span></span> <span data-ttu-id="0af3e-298">Как мы делали на шаге 3, настройте элемента управления SqlDataSource, таким образом, чтобы он вызывает `GetProductsByCategory` хранимой процедуры.</span><span class="sxs-lookup"><span data-stu-id="0af3e-298">Much like we did in Step 3, configure the SqlDataSource so that it invokes the `GetProductsByCategory` stored procedure.</span></span> <span data-ttu-id="0af3e-299">Оставьте набор стрелку раскрывающегося списка параметров источника нет, но не вводите значение по умолчанию, как это значение по умолчанию будут заданы программным способом.</span><span class="sxs-lookup"><span data-stu-id="0af3e-299">Leave the Parameter source drop-down list set to None, but do not enter a default value, as we will set this default value programmatically.</span></span>


<span data-ttu-id="0af3e-300">[![Не указывайте источник параметра или значение по умолчанию](using-parameterized-queries-with-the-sqldatasource-cs/_static/image14.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="0af3e-300">[![Do Not Specify a Parameter Source or Default Value](using-parameterized-queries-with-the-sqldatasource-cs/_static/image14.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image27.png)</span></span>

<span data-ttu-id="0af3e-301">**Рис. 14**: Выполнение не указать источник параметра или значение по умолчанию ([Просмотр полноразмерного изображения](using-parameterized-queries-with-the-sqldatasource-cs/_static/image28.png))</span><span class="sxs-lookup"><span data-stu-id="0af3e-301">**Figure 14**: Do Not Specify a Parameter Source or Default Value ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image28.png))</span></span>


<span data-ttu-id="0af3e-302">После завершения работы мастера SqlDataSource итоговый декларативная разметка должен выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="0af3e-302">After completing the SqlDataSource wizard, the resulting declarative markup should look similar to the following:</span></span>


[!code-aspx[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample13.aspx)]

<span data-ttu-id="0af3e-303">Можно назначить `DefaultValue` из `CategoryID` программно с помощью параметра `Page_Load` обработчик событий:</span><span class="sxs-lookup"><span data-stu-id="0af3e-303">We can assign the `DefaultValue` of the `CategoryID` parameter programmatically in the `Page_Load` event handler:</span></span>


[!code-csharp[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample14.cs)]

<span data-ttu-id="0af3e-304">В результате этого добавления страница содержит GridView, отображаются продукты, связанные с случайным образом выбранной категории.</span><span class="sxs-lookup"><span data-stu-id="0af3e-304">With this addition, the page includes a GridView that shows the products associated with the randomly selected category.</span></span>


<span data-ttu-id="0af3e-305">[![Не указывайте источник параметра или значение по умолчанию](using-parameterized-queries-with-the-sqldatasource-cs/_static/image15.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="0af3e-305">[![Do Not Specify a Parameter Source or Default Value](using-parameterized-queries-with-the-sqldatasource-cs/_static/image15.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image29.png)</span></span>

<span data-ttu-id="0af3e-306">**Рис. 15**: Выполнение не указать источник параметра или значение по умолчанию ([Просмотр полноразмерного изображения](using-parameterized-queries-with-the-sqldatasource-cs/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="0af3e-306">**Figure 15**: Do Not Specify a Parameter Source or Default Value ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image30.png))</span></span>


## <a name="summary"></a><span data-ttu-id="0af3e-307">Сводка</span><span class="sxs-lookup"><span data-stu-id="0af3e-307">Summary</span></span>

<span data-ttu-id="0af3e-308">Элемента управления SqlDataSource позволяет определять параметризованные запросы со значениями параметров, можно жестко, извлеченных из предварительно определенных параметров или назначать программным образом.</span><span class="sxs-lookup"><span data-stu-id="0af3e-308">The SqlDataSource enables page developers to define parameterized queries whose parameter values can be hard-coded, pulled from pre-defined parameter sources, or assigned programmatically.</span></span> <span data-ttu-id="0af3e-309">В этом учебнике мы рассмотрели для быстрого создания параметризованного запроса с помощью мастера настройки источника данных для ad-hoc-запросов SQL и хранимых процедур.</span><span class="sxs-lookup"><span data-stu-id="0af3e-309">In this tutorial we saw how to craft a parameterized query from the Configure Data Source wizard for both ad-hoc SQL queries and stored procedures.</span></span> <span data-ttu-id="0af3e-310">Мы также рассмотрели использование параметра жестко источников, веб-элемента управления в качестве источника параметра и программно, указав значение параметра.</span><span class="sxs-lookup"><span data-stu-id="0af3e-310">We also looked at using hard-coded parameter sources, a Web control as a parameter source, and programmatically specifying the parameter value.</span></span>

<span data-ttu-id="0af3e-311">Как и с помощью ObjectDataSource, SqlDataSource также предоставляет возможности для изменения базовых данных.</span><span class="sxs-lookup"><span data-stu-id="0af3e-311">Like with the ObjectDataSource, the SqlDataSource also provides capabilities to modify its underlying data.</span></span> <span data-ttu-id="0af3e-312">В следующем учебном курсе мы рассмотрим способ определения `INSERT`, `UPDATE`, и `DELETE` инструкций с помощью элемента управления SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="0af3e-312">In the next tutorial we'll look at how to define `INSERT`, `UPDATE`, and `DELETE` statements with the SqlDataSource.</span></span> <span data-ttu-id="0af3e-313">После добавления этих инструкций, мы используем встроенную Вставка, редактирование и удаление средств элементов управления GridView, DetailsView и FormView.</span><span class="sxs-lookup"><span data-stu-id="0af3e-313">Once these statements have been added, we can utilize the built-in inserting, editing, and deleting features inherent to the GridView, DetailsView, and FormView controls.</span></span>

<span data-ttu-id="0af3e-314">Счастливого вам программирования!</span><span class="sxs-lookup"><span data-stu-id="0af3e-314">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="0af3e-315">Об авторе</span><span class="sxs-lookup"><span data-stu-id="0af3e-315">About the Author</span></span>

<span data-ttu-id="0af3e-316">[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи книг по ASP/ASP.NET и основатель веб- [4GuysFromRolla.com](http://www.4guysfromrolla.com), работает с веб-технологиями Microsoft с 1998 года.</span><span class="sxs-lookup"><span data-stu-id="0af3e-316">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="0af3e-317">Скотт — независимый консультант, преподаватель и автор.</span><span class="sxs-lookup"><span data-stu-id="0af3e-317">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="0af3e-318">Его последняя книга — [ *Sams Teach ASP.NET 2.0 in 24 часа*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="0af3e-318">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="0af3e-319">Ним можно связаться по адресу [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="0af3e-319">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="0af3e-320">или через его блог, который можно найти в [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="0af3e-320">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="0af3e-321">Особая благодарность</span><span class="sxs-lookup"><span data-stu-id="0af3e-321">Special Thanks To</span></span>

<span data-ttu-id="0af3e-322">В этой серии руководств пособий рецензировалась многими компетентными редакторами.</span><span class="sxs-lookup"><span data-stu-id="0af3e-322">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="0af3e-323">Скотт Clyde Шмидт Рэнделл и Кен Pespisa, стали Лиз Шалок в этом руководстве.</span><span class="sxs-lookup"><span data-stu-id="0af3e-323">Lead reviewers for this tutorial were Scott Clyde, Randell Schmidt, and Ken Pespisa.</span></span> <span data-ttu-id="0af3e-324">Хотите поработать с моих последующих статей для MSDN?</span><span class="sxs-lookup"><span data-stu-id="0af3e-324">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="0af3e-325">Если Да, напишите мне [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="0af3e-325">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="0af3e-326">[Назад](querying-data-with-the-sqldatasource-control-cs.md)
> [Вперед](inserting-updating-and-deleting-data-with-the-sqldatasource-cs.md)</span><span class="sxs-lookup"><span data-stu-id="0af3e-326">[Previous](querying-data-with-the-sqldatasource-control-cs.md)
[Next](inserting-updating-and-deleting-data-with-the-sqldatasource-cs.md)</span></span>
