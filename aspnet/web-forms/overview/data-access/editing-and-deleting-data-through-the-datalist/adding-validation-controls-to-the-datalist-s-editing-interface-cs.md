---
uid: web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/adding-validation-controls-to-the-datalist-s-editing-interface-cs
title: Добавление элементов управления проверки в интерфейс правки DataList (C#) | Документация Майкрософт
author: rick-anderson
description: В этом учебнике мы покажем, как легко добавить элементы управления проверки в EditItemTemplate, чтобы обеспечить более надежную правку пользователя int...
ms.author: riande
ms.date: 10/30/2006
ms.assetid: 3ecc21c5-da0e-40ab-abb4-fac1e47398ad
msc.legacyurl: /web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/adding-validation-controls-to-the-datalist-s-editing-interface-cs
msc.type: authoredcontent
ms.openlocfilehash: e3c14b7098da832bd28f57026e81dcb7f7ba7130
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/28/2019
ms.locfileid: "74640526"
---
# <a name="adding-validation-controls-to-the-datalists-editing-interface-c"></a><span data-ttu-id="b7b6e-103">Добавление элементов управления проверки в интерфейс правки элемента управления DataList (C#)</span><span class="sxs-lookup"><span data-stu-id="b7b6e-103">Adding Validation Controls to the DataList's Editing Interface (C#)</span></span>

<span data-ttu-id="b7b6e-104">по [Скотт Митчелл](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="b7b6e-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="b7b6e-105">[Скачивание примера приложения](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_39_CS.exe) или [Загрузка PDF-файла](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/datatutorial39cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="b7b6e-105">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_39_CS.exe) or [Download PDF](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/datatutorial39cs1.pdf)</span></span>

> <span data-ttu-id="b7b6e-106">В этом учебнике мы посмотрим, как просто добавить элементы управления проверки в EditItemTemplate, чтобы обеспечить возможность редактирования пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-106">In this tutorial we'll see how easy it is to add validation controls to the DataList's EditItemTemplate in order to provide a more foolproof editing user interface.</span></span>

## <a name="introduction"></a><span data-ttu-id="b7b6e-107">Введение</span><span class="sxs-lookup"><span data-stu-id="b7b6e-107">Introduction</span></span>

<span data-ttu-id="b7b6e-108">В учебных руководствах по редактированию элементов управления DataList интерфейсы редактирования списков данных не включали ни одной упреждающего проверки ввода пользователя, несмотря на то, что недопустимый ввод пользователя, например отсутствие названия продукта или отрицательная Цена, приводит к возникновению исключения.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-108">In the DataList editing tutorials thus far, the DataLists editing interfaces have not included any proactive user input validation even though invalid user input such as a missing product name or negative price results in an exception.</span></span> <span data-ttu-id="b7b6e-109">В [предыдущем учебном курсе](handling-bll-and-dal-level-exceptions-cs.md) мы рассмотрели, как добавить код обработки исключений в обработчик событий DataList `UpdateCommand` для перехвата и корректного отображения сведений обо всех возникших исключениях.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-109">In the [preceding tutorial](handling-bll-and-dal-level-exceptions-cs.md) we examined how to add exception handling code to the DataList s `UpdateCommand` event handler in order to catch and gracefully display information about any exceptions that were raised.</span></span> <span data-ttu-id="b7b6e-110">Однако в идеале интерфейс редактирования будет включать элементы управления проверки, чтобы предотвратить ввод пользователем таких недопустимых данных в первую очередь.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-110">Ideally, however, the editing interface would include validation controls to prevent a user from entering such invalid data in the first place.</span></span>

<span data-ttu-id="b7b6e-111">В этом учебнике мы посмотрим, как легко добавить элементы управления проверки в `EditItemTemplate` DataList, чтобы обеспечить более защищенный пользовательский интерфейс редактирования.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-111">In this tutorial we'll see how easy it is to add validation controls to the DataList s `EditItemTemplate` in order to provide a more foolproof editing user interface.</span></span> <span data-ttu-id="b7b6e-112">В частности, в этом руководстве используется пример, созданный в предыдущем руководстве, и расширяется интерфейс редактирования для включения соответствующей проверки.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-112">Specifically, this tutorial takes the example created in the preceding tutorial and augments the editing interface to include appropriate validation.</span></span>

## <a name="step-1-replicating-the-example-fromhandling-bll--and-dal-level-exceptionshandling-bll-and-dal-level-exceptions-csmd"></a><span data-ttu-id="b7b6e-113">Шаг 1. репликация примера из[обработки исключений уровня BLL и DAL](handling-bll-and-dal-level-exceptions-cs.md)</span><span class="sxs-lookup"><span data-stu-id="b7b6e-113">Step 1: Replicating the Example from[Handling BLL- and DAL-Level Exceptions](handling-bll-and-dal-level-exceptions-cs.md)</span></span>

<span data-ttu-id="b7b6e-114">В учебнике [обработка исключений на уровне BLL и DAL](handling-bll-and-dal-level-exceptions-cs.md) мы создали страницу, в которой указаны имена и цены продуктов в изменяемом DataList с двумя столбцами.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-114">In the [Handling BLL- and DAL-Level Exceptions](handling-bll-and-dal-level-exceptions-cs.md) tutorial we created a page that listed the names and prices of the products in a two-column, editable DataList.</span></span> <span data-ttu-id="b7b6e-115">Наша цель этого руководства — дополнить интерфейс редактирования DataList s для включения элементов управления проверки.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-115">Our goal for this tutorial is to augment the DataList s editing interface to include validation controls.</span></span> <span data-ttu-id="b7b6e-116">В частности, наша логика проверки будет:</span><span class="sxs-lookup"><span data-stu-id="b7b6e-116">In particular, our validation logic will:</span></span>

- <span data-ttu-id="b7b6e-117">Требовать, чтобы имя продукта было указано</span><span class="sxs-lookup"><span data-stu-id="b7b6e-117">Require that the product s name be provided</span></span>
- <span data-ttu-id="b7b6e-118">Убедитесь, что значение, указанное для цены, является допустимым форматом валюты.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-118">Ensure that the value entered for the price is a valid currency format</span></span>
- <span data-ttu-id="b7b6e-119">Убедитесь, что значение, указанное для цены, больше или равно нулю, так как отрицательное `UnitPrice`ное значение недопустимо.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-119">Ensure that the value entered for the price is greater than or equal to zero, since a negative `UnitPrice` value is illegal</span></span>

<span data-ttu-id="b7b6e-120">Прежде чем можно будет рассмотреть возможность расширения предыдущего примера, чтобы включить проверку, сначала необходимо выполнить репликацию примера со страницы `ErrorHandling.aspx` в папке `EditDeleteDataList` на страницу для этого руководства, `UIValidation.aspx`.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-120">Before we can look at augmenting the previous example to include validation, we first need to replicate the example from the `ErrorHandling.aspx` page in the `EditDeleteDataList` folder to the page for this tutorial, `UIValidation.aspx`.</span></span> <span data-ttu-id="b7b6e-121">Чтобы добиться этого, необходимо скопировать декларативную разметку `ErrorHandling.aspx` Page s и ее исходный код.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-121">To achieve this we need to copy over both the `ErrorHandling.aspx` page s declarative markup and its source code.</span></span> <span data-ttu-id="b7b6e-122">Сначала скопируйте декларативную разметку, выполнив следующие действия.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-122">First copy over the declarative markup by performing the following steps:</span></span>

1. <span data-ttu-id="b7b6e-123">Открытие страницы `ErrorHandling.aspx` в Visual Studio</span><span class="sxs-lookup"><span data-stu-id="b7b6e-123">Open the `ErrorHandling.aspx` page in Visual Studio</span></span>
2. <span data-ttu-id="b7b6e-124">Переход к декларативной разметке страницы (нажмите на кнопку Источник в нижней части страницы)</span><span class="sxs-lookup"><span data-stu-id="b7b6e-124">Go to the page s declarative markup (click on the Source button at the bottom of the page)</span></span>
3. <span data-ttu-id="b7b6e-125">Скопируйте текст в теги `<asp:Content>` и `</asp:Content>` (строки с 3 по 32), как показано на рис. 1.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-125">Copy the text within the `<asp:Content>` and `</asp:Content>` tags (lines 3 through 32), as shown in Figure 1.</span></span>

<span data-ttu-id="b7b6e-126">[![скопировать текст в элемент управления &lt;ASP: Content&gt;](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image2.png)](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="b7b6e-126">[![Copy the Text Within the &lt;asp:Content&gt; Control](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image2.png)](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image1.png)</span></span>

<span data-ttu-id="b7b6e-127">**Рисунок 1**. копирование текста внутри элемента управления `<asp:Content>` ([щелкните, чтобы просмотреть изображение с полным размером](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="b7b6e-127">**Figure 1**: Copy the Text Within the `<asp:Content>` Control ([Click to view full-size image](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image3.png))</span></span>

1. <span data-ttu-id="b7b6e-128">Открытие страницы `UIValidation.aspx`</span><span class="sxs-lookup"><span data-stu-id="b7b6e-128">Open the `UIValidation.aspx` page</span></span>
2. <span data-ttu-id="b7b6e-129">Переход к декларативной разметке страницы</span><span class="sxs-lookup"><span data-stu-id="b7b6e-129">Go to the page s declarative markup</span></span>
3. <span data-ttu-id="b7b6e-130">Вставьте текст в элемент управления `<asp:Content>`.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-130">Paste the text within the `<asp:Content>` control.</span></span>

<span data-ttu-id="b7b6e-131">Чтобы скопировать исходный код, откройте страницу `ErrorHandling.aspx.vb` и скопируйте только текст *внутри* класса `EditDeleteDataList_ErrorHandling`.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-131">To copy over the source code, open the `ErrorHandling.aspx.vb` page and copy just the text *within* the `EditDeleteDataList_ErrorHandling` class.</span></span> <span data-ttu-id="b7b6e-132">Скопируйте три обработчика событий (`Products_EditCommand`, `Products_CancelCommand`и `Products_UpdateCommand`) вместе с методом `DisplayExceptionDetails`, но **не** копируйте объявление класса или инструкции `using`.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-132">Copy the three event handlers (`Products_EditCommand`, `Products_CancelCommand`, and `Products_UpdateCommand`) along with the `DisplayExceptionDetails` method, but do **not** copy the class declaration or `using` statements.</span></span> <span data-ttu-id="b7b6e-133">Вставьте скопированный текст *в класс `EditDeleteDataList_UIValidation` в `UIValidation.aspx.vb`* .</span><span class="sxs-lookup"><span data-stu-id="b7b6e-133">Paste the copied text *within* the `EditDeleteDataList_UIValidation` class in `UIValidation.aspx.vb`.</span></span>

<span data-ttu-id="b7b6e-134">После перемещения содержимого и кода с `ErrorHandling.aspx` на `UIValidation.aspx`, уделите несколько минут тестированию страниц в браузере.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-134">After moving over the content and code from `ErrorHandling.aspx` to `UIValidation.aspx`, take a moment to test out the pages in a browser.</span></span> <span data-ttu-id="b7b6e-135">На каждой из этих двух страниц вы должны увидеть одинаковые функции вывода и работать с такими же функциями (см. рис. 2).</span><span class="sxs-lookup"><span data-stu-id="b7b6e-135">You should see the same output and experience the same functionality in each of these two pages (see Figure 2).</span></span>

<span data-ttu-id="b7b6e-136">[![страницы UIValidation. aspx имитирует функциональность в ErrorHandling. aspx](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image5.png)](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="b7b6e-136">[![The UIValidation.aspx Page Mimics the Functionality in ErrorHandling.aspx](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image5.png)](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image4.png)</span></span>

<span data-ttu-id="b7b6e-137">**Рис. 2**. страница `UIValidation.aspx` имитирует функциональность `ErrorHandling.aspx` ([щелкните, чтобы просмотреть изображение в полном размере](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="b7b6e-137">**Figure 2**: The `UIValidation.aspx` Page Mimics the Functionality in `ErrorHandling.aspx` ([Click to view full-size image](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image6.png))</span></span>

## <a name="step-2-adding-the-validation-controls-to-the-datalist-s-edititemtemplate"></a><span data-ttu-id="b7b6e-138">Шаг 2. Добавление элементов управления проверки в DataList s EditItemTemplate</span><span class="sxs-lookup"><span data-stu-id="b7b6e-138">Step 2: Adding the Validation Controls to the DataList s EditItemTemplate</span></span>

<span data-ttu-id="b7b6e-139">При создании форм ввода данных важно, чтобы пользователи вводили все необходимые поля и все предоставленные входные данные были допустимыми, правильно отформатированными значениями.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-139">When constructing data entry forms, it is important that users enter any required fields and that all their provided inputs are legal, properly-formatted values.</span></span> <span data-ttu-id="b7b6e-140">Чтобы обеспечить допустимость входных данных пользователя, ASP.NET предоставляет пять встроенных элементов управления проверки, предназначенных для проверки значения одного входного веб-элемента управления.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-140">To help ensure that a user s inputs are valid, ASP.NET provides five built-in validation controls that are designed to validate the value of a single input Web control:</span></span>

- <span data-ttu-id="b7b6e-141">[RequiredFieldValidator](https://msdn.microsoft.com/library/5hbw267h(VS.80).aspx) гарантирует, что указано значение</span><span class="sxs-lookup"><span data-stu-id="b7b6e-141">[RequiredFieldValidator](https://msdn.microsoft.com/library/5hbw267h(VS.80).aspx) ensures that a value has been provided</span></span>
- <span data-ttu-id="b7b6e-142">Объект [CompareValidator](https://msdn.microsoft.com/library/db330ayw(VS.80).aspx) проверяет значение на соответствие другому значению веб-элемента управления или константе или гарантирует, что формат значения s является допустимым для указанного типа данных.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-142">[CompareValidator](https://msdn.microsoft.com/library/db330ayw(VS.80).aspx) validates a value against another Web control value or a constant value, or ensures that the value s format is legal for a specified data type</span></span>
- <span data-ttu-id="b7b6e-143">[RangeValidator](https://msdn.microsoft.com/library/f70d09xt.aspx) гарантирует, что значение находится в диапазоне значений</span><span class="sxs-lookup"><span data-stu-id="b7b6e-143">[RangeValidator](https://msdn.microsoft.com/library/f70d09xt.aspx) ensures that a value is within a range of values</span></span>
- <span data-ttu-id="b7b6e-144">[Регуларекспрессионвалидатор](https://msdn.microsoft.com/library/eahwtc9e.aspx) проверяет значение по [регулярному выражению](http://en.wikipedia.org/wiki/Regular_expression)</span><span class="sxs-lookup"><span data-stu-id="b7b6e-144">[RegularExpressionValidator](https://msdn.microsoft.com/library/eahwtc9e.aspx) validates a value against a [regular expression](http://en.wikipedia.org/wiki/Regular_expression)</span></span>
- <span data-ttu-id="b7b6e-145">[CustomValidator](https://msdn.microsoft.com/library/9eee01cx(VS.80).aspx) проверяет значение для пользовательского, определяемого пользователем метода</span><span class="sxs-lookup"><span data-stu-id="b7b6e-145">[CustomValidator](https://msdn.microsoft.com/library/9eee01cx(VS.80).aspx) validates a value against a custom, user-defined method</span></span>

<span data-ttu-id="b7b6e-146">Дополнительные сведения об этих пяти элементах управления см. в разделе [Добавление элементов управления проверки в учебник по интерфейсам правки и вставки](../editing-inserting-and-deleting-data/adding-validation-controls-to-the-editing-and-inserting-interfaces-cs.md) или ознакомьтесь с [разделом проверки элементов управления](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/validation/default.aspx) в учебнике по [ASP.NET](https://quickstarts.asp.net).</span><span class="sxs-lookup"><span data-stu-id="b7b6e-146">For more information on these five controls refer back to the [Adding Validation Controls to the Editing and Inserting Interfaces](../editing-inserting-and-deleting-data/adding-validation-controls-to-the-editing-and-inserting-interfaces-cs.md) tutorial or check out the [Validation Controls section](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/validation/default.aspx) of the [ASP.NET Quickstart Tutorials](https://quickstarts.asp.net).</span></span>

<span data-ttu-id="b7b6e-147">В нашем учебном курсе необходимо использовать RequiredFieldValidator, чтобы гарантировать, что значение названия продукта было предоставлено, и CompareValidator, чтобы гарантировать, что введенная цена имеет значение, большее или равное 0, и представлено в допустимом формате валюты.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-147">For our tutorial we'll need to use a RequiredFieldValidator to ensure that a value for the product name has been supplied and a CompareValidator to ensure that the entered price has a value greater than or equal to 0 and is presented in a valid currency format.</span></span>

> [!NOTE]
> <span data-ttu-id="b7b6e-148">Хотя в ASP.NET 1. x существовали те же пять элементов управления проверки, ASP.NET 2,0 добавил ряд усовершенствований, две основные возможности поддержки сценариев на стороне клиента для браузеров в дополнение к Internet Explorer и возможность секционирования элементов управления проверки на странице в группы проверки.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-148">While ASP.NET 1.x had these same five validation controls, ASP.NET 2.0 has added a number of improvements, the main two being client-side script support for browsers in addition to Internet Explorer and the ability to partition validation controls on a page into validation groups.</span></span> <span data-ttu-id="b7b6e-149">Дополнительные сведения о новых возможностях элементов управления проверки в 2,0 см. в статье [которая разбила The проверки элементов управления в ASP.NET 2,0](http://aspnet.4guysfromrolla.com/articles/112305-1.aspx).</span><span class="sxs-lookup"><span data-stu-id="b7b6e-149">For more information on the new validation control features in 2.0, refer to [Dissecting the Validation Controls in ASP.NET 2.0](http://aspnet.4guysfromrolla.com/articles/112305-1.aspx).</span></span>

<span data-ttu-id="b7b6e-150">Давайте начнем с добавления необходимых элементов управления проверки в `EditItemTemplate`DataList s.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-150">Let s start by adding the necessary validation controls to the DataList s `EditItemTemplate`.</span></span> <span data-ttu-id="b7b6e-151">Эту задачу можно выполнить в конструкторе, щелкнув ссылку Edit Templates (изменить шаблоны) в смарт-теге DataList или с помощью декларативного синтаксиса.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-151">This task can be performed through the Designer by clicking on the Edit Templates link from the DataList s smart tag, or through the declarative syntax.</span></span> <span data-ttu-id="b7b6e-152">Давайте пошаговым процессом, используя параметр изменить шаблоны из представление конструирования.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-152">Let s step through the process using the Edit Templates option from the Design view.</span></span> <span data-ttu-id="b7b6e-153">После выбора элемента управления DataList `EditItemTemplate`добавьте RequiredFieldValidator, перетащив его из панели элементов в интерфейс редактирования шаблона, поместив его после текстового поля `ProductName`.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-153">After choosing to edit the DataList s `EditItemTemplate`, add a RequiredFieldValidator by dragging it from the Toolbox into the template editing interface, placing it after the `ProductName` TextBox.</span></span>

<span data-ttu-id="b7b6e-154">[![добавить RequiredFieldValidator в EditItemTemplate после текстового поля ProductName](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image8.png)](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="b7b6e-154">[![Add a RequiredFieldValidator to the EditItemTemplate After the ProductName TextBox](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image8.png)](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image7.png)</span></span>

<span data-ttu-id="b7b6e-155">**Рис. 3**. Добавление RequiredFieldValidator в `EditItemTemplate After` текстовое поле `ProductName` ([щелкните, чтобы просмотреть изображение с полным размером](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="b7b6e-155">**Figure 3**: Add a RequiredFieldValidator to the `EditItemTemplate After` the `ProductName` TextBox ([Click to view full-size image](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image9.png))</span></span>

<span data-ttu-id="b7b6e-156">Все элементы управления проверки работают путем проверки входных данных одного веб-элемента управления ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-156">All validation controls work by validating the input of a single ASP.NET Web control.</span></span> <span data-ttu-id="b7b6e-157">Поэтому необходимо указать, что RequiredFieldValidator, который мы только что добавили, должен проверяться по сравнению с текстовым полем `ProductName`. Это можно сделать, задав для [свойства`ControlToValidate`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basevalidator.controltovalidate(VS.80).aspx) контроля проверки значение `ID` соответствующего веб-элемента управления (`ProductName`в этом экземпляре).</span><span class="sxs-lookup"><span data-stu-id="b7b6e-157">Therefore, we need to indicate that the RequiredFieldValidator we just added should validate against the `ProductName` TextBox; this is done by setting the validation control s [`ControlToValidate` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basevalidator.controltovalidate(VS.80).aspx) to the `ID` of the appropriate Web control (`ProductName`, in this instance).</span></span> <span data-ttu-id="b7b6e-158">Затем задайте для [свойства`ErrorMessage`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basevalidator.errormessage(VS.80).aspx) значение, чтобы указать имя продукта и [свойство`Text`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basevalidator.text(VS.80).aspx) для \*.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-158">Next, set the [`ErrorMessage` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basevalidator.errormessage(VS.80).aspx) to You must provide the product s name and the [`Text` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basevalidator.text(VS.80).aspx) to \*.</span></span> <span data-ttu-id="b7b6e-159">Значение свойства `Text`, если оно указано, является текстом, отображаемым элементом управления проверки, если проверка завершается неудачно.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-159">The `Text` property value, if provided, is the text that is displayed by the validation control if the validation fails.</span></span> <span data-ttu-id="b7b6e-160">Значение свойства `ErrorMessage`, которое является обязательным, используется элементом управления ValidationSummary; Если значение свойства `Text` опущено, значение свойства `ErrorMessage` отображается элементом управления проверки на недопустимые входные данные.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-160">The `ErrorMessage` property value, which is required, is used by the ValidationSummary control; if the `Text` property value is omitted, the `ErrorMessage` property value is displayed by the validation control on invalid input.</span></span>

<span data-ttu-id="b7b6e-161">После установки этих трех свойств RequiredFieldValidator экран должен выглядеть примерно так, как показано на рис. 4.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-161">After setting these three properties of the RequiredFieldValidator, your screen should look similar to Figure 4.</span></span>

<span data-ttu-id="b7b6e-162">[![задать свойства ControlToValidate, ErrorMessage и Text для RequiredFieldValidator](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image11.png)](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="b7b6e-162">[![Set the RequiredFieldValidator s ControlToValidate, ErrorMessage, and Text Properties](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image11.png)](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image10.png)</span></span>

<span data-ttu-id="b7b6e-163">**Рис. 4**. Задание свойств RequiredFieldValidator `ControlToValidate`, `ErrorMessage`и `Text` (щелкните,[чтобы просмотреть изображение с полным размером](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="b7b6e-163">**Figure 4**: Set the RequiredFieldValidator s `ControlToValidate`, `ErrorMessage`, and `Text` Properties ([Click to view full-size image](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image12.png))</span></span>

<span data-ttu-id="b7b6e-164">После добавления RequiredFieldValidator в `EditItemTemplate`все, что остается, — это добавить необходимую проверку для текстового поля Product s Price.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-164">With the RequiredFieldValidator added to the `EditItemTemplate`, all that remains is to add the necessary validation for the product s price TextBox.</span></span> <span data-ttu-id="b7b6e-165">Поскольку `UnitPrice` не является обязательным при редактировании записи, нам не нужно добавлять RequiredFieldValidator.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-165">Since the `UnitPrice` is optional when editing a record, we don t need to add a RequiredFieldValidator.</span></span> <span data-ttu-id="b7b6e-166">Однако нам нужно добавить объект CompareValidator, чтобы `UnitPrice`, если он указан, правильно отформатирована как денежная единица и больше или равна 0.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-166">We do, however, need to add a CompareValidator to ensure that the `UnitPrice`, if supplied, is properly formatted as a currency and is greater than or equal to 0.</span></span>

<span data-ttu-id="b7b6e-167">Добавьте объект CompareValidator в `EditItemTemplate` и задайте для его свойства `ControlToValidate` значение `UnitPrice`, его свойство `ErrorMessage` значение price должно быть больше или равно нулю и не может включать символ валюты, а также свойство `Text` в \*.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-167">Add the CompareValidator into the `EditItemTemplate` and set its `ControlToValidate` property to `UnitPrice`, its `ErrorMessage` property to The price must be greater than or equal to zero and cannot include the currency symbol, and its `Text` property to \*.</span></span> <span data-ttu-id="b7b6e-168">Чтобы указать, что значение `UnitPrice` должно быть больше или равно 0, установите [свойство CompareValidator`Operator`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.comparevalidator.operator(VS.80).aspx) в значение `GreaterThanEqual`, его [свойству`ValueToCompare`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.comparevalidator.valuetocompare(VS.80).aspx) значение 0, а [свойству`Type`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basecomparevalidator.type.aspx) — `Currency`.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-168">To indicate that the `UnitPrice` value must be greater than or equal to 0, set the CompareValidator s [`Operator` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.comparevalidator.operator(VS.80).aspx) to `GreaterThanEqual`, its [`ValueToCompare` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.comparevalidator.valuetocompare(VS.80).aspx) to 0, and its [`Type` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basecomparevalidator.type.aspx) to `Currency`.</span></span>

<span data-ttu-id="b7b6e-169">После добавления этих двух элементов управления проверки декларативный синтаксис DataList `EditItemTemplate` s должен выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="b7b6e-169">After adding these two validation controls, the DataList s `EditItemTemplate` s declarative syntax should look similar to the following:</span></span>

[!code-aspx[Main](adding-validation-controls-to-the-datalist-s-editing-interface-cs/samples/sample1.aspx)]

<span data-ttu-id="b7b6e-170">После внесения этих изменений откройте страницу в браузере.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-170">After making these changes, open the page in a browser.</span></span> <span data-ttu-id="b7b6e-171">Если вы попытаетесь опустить имя или ввести недопустимое значение цены при редактировании продукта, рядом с текстовым полем появится звездочка.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-171">If you attempt to omit the name or enter an invalid price value when editing a product, an asterisk appears next to the textbox.</span></span> <span data-ttu-id="b7b6e-172">Как показано на рис. 5, значение цены, включающее символ валюты, например $19,95, считается недопустимым.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-172">As Figure 5 shows, a price value that includes the currency symbol such as $19.95 is considered invalid.</span></span> <span data-ttu-id="b7b6e-173">Объект CompareValidator `Currency` `Type` допускает разделители цифр (например, запятые или точки, в зависимости от настроек языка и региональных параметров) и начальный знак плюса или минуса, но *не* допускает символ валюты.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-173">The CompareValidator s `Currency` `Type` allows for digit separators (such as commas or periods, depending on the culture settings) and a leading plus or minus sign, but does *not* permit a currency symbol.</span></span> <span data-ttu-id="b7b6e-174">Это поведение может озадачить пользователей, так как интерфейс правки в настоящее время визуализирует `UnitPrice`, используя формат валюты.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-174">This behavior may perplex users as the editing interface currently renders the `UnitPrice` using the currency format.</span></span>

<span data-ttu-id="b7b6e-175">[![звездочка отображается рядом с текстовыми полями с недопустимыми входными данными](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image14.png)](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="b7b6e-175">[![An Asterisk Appears Next to the Textboxes with Invalid Input](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image14.png)](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image13.png)</span></span>

<span data-ttu-id="b7b6e-176">**Рис. 5**. Звездочка рядом с текстовыми полями с недопустимым входом ([щелкните, чтобы просмотреть изображение с полным размером](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="b7b6e-176">**Figure 5**: An Asterisk Appears Next to the Textboxes with Invalid Input ([Click to view full-size image](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image15.png))</span></span>

<span data-ttu-id="b7b6e-177">Хотя проверка работает как есть, пользователь должен вручную удалить символ валюты при редактировании записи, что неприемлемо.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-177">While the validation works as-is, the user has to manually remove the currency symbol when editing a record, which is not acceptable.</span></span> <span data-ttu-id="b7b6e-178">Более того, если в интерфейсе правки есть недопустимые входные данные, то при нажатии кнопки Обновить и отмена вызовет обратную передачу.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-178">Moreover, if there are invalid inputs in the editing interface neither the Update nor Cancel buttons, when clicked, will invoke a postback.</span></span> <span data-ttu-id="b7b6e-179">В идеале кнопка Отмена Возвращает элемент управления DataList в состояние предварительного редактирования независимо от действительности входных данных пользователя.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-179">Ideally, the Cancel button would return the DataList to its pre-editing state regardless of the validity of the user s inputs.</span></span> <span data-ttu-id="b7b6e-180">Кроме того, перед обновлением сведений о продукте в обработчике событий DataList `UpdateCommand` необходимо убедиться, что данные страницы являются допустимыми, так как проверка управления логикой на стороне клиента может быть продолжена пользователями, браузеры которых либо не поддерживают JavaScript, либо отключены.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-180">Also, we need to ensure that the page s data is valid before updating the product information in the DataList s `UpdateCommand` event handler, as the validation controls client-side logic can be bypassed by users whose browsers either don t support JavaScript or have its support disabled.</span></span>

## <a name="removing-the-currency-symbol-from-the-edititemtemplate-s-unitprice-textbox"></a><span data-ttu-id="b7b6e-181">Удаление символа валюты из текстового поля EditItemTemplate s UnitPrice</span><span class="sxs-lookup"><span data-stu-id="b7b6e-181">Removing the Currency Symbol from the EditItemTemplate s UnitPrice TextBox</span></span>

<span data-ttu-id="b7b6e-182">При использовании `Currency``Type`CompareValidator s проверяемые входные данные не должны содержать символы валют.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-182">When using the CompareValidator s `Currency``Type`, the input being validated must not include any currency symbols.</span></span> <span data-ttu-id="b7b6e-183">Наличие таких символов приводит к тому, что объект CompareValidator помечает входные данные как недопустимые.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-183">The presence of such symbols causes the CompareValidator to mark the input as invalid.</span></span> <span data-ttu-id="b7b6e-184">Однако наш интерфейс правки в настоящее время содержит символ валюты в текстовом поле `UnitPrice`, что означает, что пользователь должен явно удалить символ валюты перед сохранением изменений.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-184">However, our editing interface currently includes a currency symbol in the `UnitPrice` TextBox, meaning the user must explicitly remove the currency symbol before saving their changes.</span></span> <span data-ttu-id="b7b6e-185">Для устранения этой проблемы у нас есть три варианта:</span><span class="sxs-lookup"><span data-stu-id="b7b6e-185">To remedy this we have three options:</span></span>

1. <span data-ttu-id="b7b6e-186">Настройте `EditItemTemplate` таким образом, чтобы значение текстового поля `UnitPrice` не отформатировано как денежная единица.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-186">Configure the `EditItemTemplate` so that the `UnitPrice` TextBox value is not formatted as a currency.</span></span>
2. <span data-ttu-id="b7b6e-187">Разрешить пользователю вводить символ валюты, удаляя объект CompareValidator и заменяя его на Регуларекспрессионвалидатор, который проверяет наличие верно отформатированного значения валюты.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-187">Allow the user to enter a currency symbol by removing the CompareValidator and replacing it with a RegularExpressionValidator that checks for a properly formatted currency value.</span></span> <span data-ttu-id="b7b6e-188">Проблема в том, что регулярное выражение для проверки значения валюты не так просто, как CompareValidator, и потребовало бы написания кода, если бы нам требовалось включить параметры языка и региональных параметров.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-188">The challenge here is that the regular expression to validate a currency value is not as straightforward as the CompareValidator and would require writing code if we wanted to incorporate culture settings.</span></span>
3. <span data-ttu-id="b7b6e-189">Полностью удалите элемент управления проверки и используйте настраиваемую логику проверки на стороне сервера в обработчике событий GridView s `RowUpdating`.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-189">Remove the validation control altogether and rely on custom server-side validation logic in the GridView s `RowUpdating` event handler.</span></span>

<span data-ttu-id="b7b6e-190">Давайте рассмотрим вариант 1 для этого руководства.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-190">Let s go with option 1 for this tutorial.</span></span> <span data-ttu-id="b7b6e-191">В настоящее время `UnitPrice` форматируется как денежное значение из-за выражения привязки данных для текстового поля в `EditItemTemplate`: `<%# Eval("UnitPrice", "{0:c}") %>`.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-191">Currently the `UnitPrice` is formatted as a currency value due to the databinding expression for the TextBox in the `EditItemTemplate`: `<%# Eval("UnitPrice", "{0:c}") %>`.</span></span> <span data-ttu-id="b7b6e-192">Измените оператор `Eval` на `Eval("UnitPrice", "{0:n2}")`, который форматирует результат как число с двумя цифрами точности.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-192">Change the `Eval` statement to `Eval("UnitPrice", "{0:n2}")`, which formats the result as a number with two digits of precision.</span></span> <span data-ttu-id="b7b6e-193">Это можно сделать напрямую с помощью декларативного синтаксиса или щелкнув ссылку изменить привязки к данным в текстовом поле `UnitPrice` в DataList s `EditItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-193">This can be done directly through the declarative syntax or by clicking on the Edit DataBindings link from the `UnitPrice` TextBox in the DataList s `EditItemTemplate`.</span></span>

<span data-ttu-id="b7b6e-194">При этом изменении отформатированная Цена в интерфейсе редактирования включает запятые в качестве разделителя групп и точку в качестве десятичного разделителя, но оставляет символ валюты.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-194">With this change, the formatted price in the editing interface includes commas as the group separator and a period as the decimal separator, but leaves off the currency symbol.</span></span>

> [!NOTE]
> <span data-ttu-id="b7b6e-195">При удалении формата валюты из редактируемого интерфейса я получаю возможность вставить символ валюты как текст за пределами текстового поля.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-195">When removing the currency format from the editable interface, I find it helpful to put the currency symbol as text outside the TextBox.</span></span> <span data-ttu-id="b7b6e-196">Это служит указанием пользователю, что ему не нужно указывать символ валюты.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-196">This serves as a hint to the user that they do not need to provide the currency symbol.</span></span>

## <a name="fixing-the-cancel-button"></a><span data-ttu-id="b7b6e-197">Устранение кнопки "Отмена"</span><span class="sxs-lookup"><span data-stu-id="b7b6e-197">Fixing the Cancel Button</span></span>

<span data-ttu-id="b7b6e-198">По умолчанию веб-элементы управления проверки выдают JavaScript для выполнения проверки на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-198">By default, the validation Web controls emit JavaScript to perform validation on the client-side.</span></span> <span data-ttu-id="b7b6e-199">При нажатии кнопки, LinkButton или ImageButton элементы управления проверки на странице проверяются на стороне клиента перед обратной передачей.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-199">When a Button, LinkButton, or ImageButton is clicked, the validation controls on the page are checked on the client-side before the postback occurs.</span></span> <span data-ttu-id="b7b6e-200">При наличии недопустимых данных обратная передача отменяется.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-200">If there is any invalid data, the postback is cancelled.</span></span> <span data-ttu-id="b7b6e-201">Однако для некоторых кнопок допустимость данных может быть нематериальной. в этом случае обратная передача отменяется из-за недопустимых данных — неудобством.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-201">For certain Buttons, though, the validity of the data might be immaterial; in such a case, having the postback cancelled due to invalid data is a nuisance.</span></span>

<span data-ttu-id="b7b6e-202">Примером является кнопка Отмена.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-202">The Cancel button is such an example.</span></span> <span data-ttu-id="b7b6e-203">Представьте, что пользователь вводит недопустимые данные (например, пропускает название продукта), а затем решает, что он не желает сохранять продукт, и нажимает кнопку Отмена.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-203">Imagine that a user enters invalid data, such as omitting the product s name, and then decides she doesn t want to save the product after all and hits the Cancel button.</span></span> <span data-ttu-id="b7b6e-204">В настоящее время кнопка Отмена активирует элементы управления проверки на странице, сообщающие об отсутствии имени продукта и запрете обратной передачи.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-204">Currently, the Cancel button triggers the validation controls on the page, which report that the product name is missing and prevent the postback.</span></span> <span data-ttu-id="b7b6e-205">Пользователь должен ввести какой бы текст в текстовое поле `ProductName`, чтобы выйти из процесса редактирования.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-205">Our user has to type some text into the `ProductName` TextBox just to cancel out of the editing process.</span></span>

<span data-ttu-id="b7b6e-206">К счастью, кнопка, LinkButton и ImageButton имеют [свойство`CausesValidation`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.button.causesvalidation.aspx) , которое может указывать, должна ли нажата кнопка инициировать логику проверки (по умолчанию `True`).</span><span class="sxs-lookup"><span data-stu-id="b7b6e-206">Fortunately, the Button, LinkButton, and ImageButton have a [`CausesValidation` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.button.causesvalidation.aspx) that can indicate whether or not clicking the Button should initiate the validation logic (defaults to `True`).</span></span> <span data-ttu-id="b7b6e-207">Присвойте свойству `CausesValidation` Cancel (Отмена) значение `False`.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-207">Set the Cancel Button s `CausesValidation` property to `False`.</span></span>

## <a name="ensuring-the-inputs-are-valid-in-the-updatecommand-event-handler"></a><span data-ttu-id="b7b6e-208">Проверка допустимости входных данных в обработчике событий UpdateCommand</span><span class="sxs-lookup"><span data-stu-id="b7b6e-208">Ensuring the Inputs are Valid in the UpdateCommand Event Handler</span></span>

<span data-ttu-id="b7b6e-209">Из-за клиентского скрипта, порожденного проверочными элементами управления, если пользователь вводит недопустимый ввод, элементы управления проверки отменяют любые обратные передачи, инициированные элементами управления Button, LinkButton или ImageButton, свойства `CausesValidation` которых `True` (по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="b7b6e-209">Due to the client-side script emitted by the validation controls, if a user enters invalid input the validation controls cancel any postbacks initiated by Button, LinkButton, or ImageButton controls whose `CausesValidation` properties are `True` (the default).</span></span> <span data-ttu-id="b7b6e-210">Однако если пользователь посещает браузер устарела или тот, для которого отключена поддержка JavaScript, проверки на стороне клиента не будут выполняться.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-210">However, if a user is visiting with an antiquated browser or one whose JavaScript support has been disabled, the client-side validation checks will not execute.</span></span>

<span data-ttu-id="b7b6e-211">Все элементы управления проверки ASP.NET повторяют логику проверки сразу после обратной передачи и сообщают общую достоверность входных данных страницы с помощью [свойства`Page.IsValid`](https://msdn.microsoft.com/library/system.web.ui.page.isvalid.aspx).</span><span class="sxs-lookup"><span data-stu-id="b7b6e-211">All of the ASP.NET validation controls repeat their validation logic immediately upon postback and report the overall validity of the page s inputs via the [`Page.IsValid` property](https://msdn.microsoft.com/library/system.web.ui.page.isvalid.aspx).</span></span> <span data-ttu-id="b7b6e-212">Однако поток страницы не прерывается или не останавливается каким-либо образом в зависимости от значения `Page.IsValid`.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-212">However, the page flow is not interrupted or stopped in any way based on the value of `Page.IsValid`.</span></span> <span data-ttu-id="b7b6e-213">Разработчикам необходимо убедиться, что свойство `Page.IsValid` имеет значение `True` перед продолжением кода, который предполагает допустимые входные данные.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-213">As developers, it is our responsibility to ensure that the `Page.IsValid` property has a value of `True` before proceeding with code that assumes valid input data.</span></span>

<span data-ttu-id="b7b6e-214">Если пользователь отключил JavaScript, посещает нашу страницу, редактирует продукт, вводит значение цены слишком дорого и нажимает кнопку "Обновить", проверка на стороне клиента будет продолжена, и будет предприниматься обратная передача.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-214">If a user has JavaScript disabled, visits our page, edits a product, enters a price value of Too expensive, and clicks the Update button, the client-side validation will be bypassed and a postback will ensue.</span></span> <span data-ttu-id="b7b6e-215">При обратной передаче ASP.NET страница s `UpdateCommand` выполняется обработчик событий и возникает исключение при попытке выполнить синтаксический анализ слишком дорогостоящего `Decimal`.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-215">On postback, the ASP.NET page s `UpdateCommand` event handler executes and an exception is raised when attempting to parse Too expensive to a `Decimal`.</span></span> <span data-ttu-id="b7b6e-216">Так как у нас есть обработка исключений, такое исключение будет обработано надлежащим образом, но мы можем предотвратить переход недопустимых данных в первую очередь, пропуская только `UpdateCommand` обработчика событий, если `Page.IsValid` имеет значение `True`.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-216">Since we have exception handling, such an exception will be handled gracefully, but we could prevent the invalid data from slipping through in the first place by only proceeding with the `UpdateCommand` event handler if `Page.IsValid` has a value of `True`.</span></span>

<span data-ttu-id="b7b6e-217">Добавьте следующий код в начало обработчика событий `UpdateCommand`, непосредственно перед блоком `Try`:</span><span class="sxs-lookup"><span data-stu-id="b7b6e-217">Add the following code to the start of the `UpdateCommand` event handler, immediately before the `Try` block:</span></span>

[!code-csharp[Main](adding-validation-controls-to-the-datalist-s-editing-interface-cs/samples/sample2.cs)]

<span data-ttu-id="b7b6e-218">С этим добавлением продукт будет пытаться обновиться только в том случае, если отправленные данные действительны.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-218">With this addition, the product will attempt to be updated only if the submitted data is valid.</span></span> <span data-ttu-id="b7b6e-219">Большинство пользователей не смогут выполнить обратную передачу недопустимых данных из-за проверки элементов управления клиентские скрипты, но пользователи, чьи браузеры не поддерживают JavaScript или которые поддерживают JavaScript, могут обходить проверки на стороне клиента и отправлять недопустимые данные.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-219">Most users won't be able to postback invalid data due to the validation controls client-side scripts, but users whose browsers don t support JavaScript or that have JavaScript support disabled, can bypass the client-side checks and submit invalid data.</span></span>

> [!NOTE]
> <span data-ttu-id="b7b6e-220">Модуль чтения внимательный будет отзывать, что при обновлении данных с помощью GridView не нужно явно проверять свойство `Page.IsValid` в классе кода программной части страницы s.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-220">The astute reader will recall that when updating data with the GridView, we didn't need to explicitly check the `Page.IsValid` property in our page s code-behind class.</span></span> <span data-ttu-id="b7b6e-221">Это происходит потому, что GridView обращается к свойству `Page.IsValid` для нас и продолжает только обновление только в том случае, если оно возвращает значение `True`.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-221">This is because the GridView consults the `Page.IsValid` property for us and only proceeds with the update only if it returns a value of `True`.</span></span>

## <a name="step-3-summarizing-data-entry-problems"></a><span data-ttu-id="b7b6e-222">Шаг 3. сводка проблем ввода данных</span><span class="sxs-lookup"><span data-stu-id="b7b6e-222">Step 3: Summarizing Data Entry Problems</span></span>

<span data-ttu-id="b7b6e-223">В дополнение к пяти проверочным элементам управления ASP.NET включает [элемент управления ValidationSummary](https://msdn.microsoft.com/library/f9h59855(VS.80).aspx), который отображает `ErrorMessage`ные элементы управления проверки, которые обнаружили недопустимые данные.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-223">In addition to the five validation controls, ASP.NET includes the [ValidationSummary control](https://msdn.microsoft.com/library/f9h59855(VS.80).aspx), which displays the `ErrorMessage` s of those validation controls that detected invalid data.</span></span> <span data-ttu-id="b7b6e-224">Сводные данные могут отображаться в виде текста на веб-странице или с помощью модального окна MessageBox на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-224">This summary data can be displayed as text on the web page or through a modal, client-side messagebox.</span></span> <span data-ttu-id="b7b6e-225">Позвольте нам улучшить этот учебник, включив в него MessageBox на стороне клиента, суммирующий все проблемы проверки.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-225">Let s enhance this tutorial to include a client-side messagebox summarizing any validation problems.</span></span>

<span data-ttu-id="b7b6e-226">Для этого перетащите элемент управления ValidationSummary с панели инструментов в конструктор.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-226">To accomplish this, drag a ValidationSummary control from the Toolbox onto the Designer.</span></span> <span data-ttu-id="b7b6e-227">Расположение элемента управления ValidationSummary не имеет значения, так как мы перейдем к его настройке для вывода сводки только в виде MessageBox.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-227">The location of the ValidationSummary control doesn t really matter, since we re going to configure it to only display the summary as a messagebox.</span></span> <span data-ttu-id="b7b6e-228">После добавления элемента управления задайте для его [свойства`ShowSummary`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.validationsummary.showsummary(VS.80).aspx) значение `False`, а для [свойства`ShowMessageBox`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.validationsummary.showmessagebox(VS.80).aspx) значение `True`.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-228">After adding the control, set its [`ShowSummary` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.validationsummary.showsummary(VS.80).aspx) to `False` and its [`ShowMessageBox` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.validationsummary.showmessagebox(VS.80).aspx) to `True`.</span></span> <span data-ttu-id="b7b6e-229">Благодаря этому добавлению все ошибки проверки суммируются в клиентской части MessageBox (см. рис. 6).</span><span class="sxs-lookup"><span data-stu-id="b7b6e-229">With this addition, any validation errors are summarized in a client-side messagebox (see Figure 6).</span></span>

<span data-ttu-id="b7b6e-230">[![ошибки проверки обобщены в окне MessageBox на стороне клиента](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image17.png)](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="b7b6e-230">[![The Validation Errors are Summarized in a Client-Side Messagebox](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image17.png)](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image16.png)</span></span>

<span data-ttu-id="b7b6e-231">**Рис. 6**. ошибки проверки обобщены в окне MessageBox на стороне клиента ([щелкните, чтобы просмотреть изображение с полным размером](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="b7b6e-231">**Figure 6**: The Validation Errors are Summarized in a Client-Side Messagebox ([Click to view full-size image](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image18.png))</span></span>

## <a name="summary"></a><span data-ttu-id="b7b6e-232">Сводка</span><span class="sxs-lookup"><span data-stu-id="b7b6e-232">Summary</span></span>

<span data-ttu-id="b7b6e-233">В этом учебнике мы увидели, как уменьшить вероятность исключений с помощью элементов управления проверки, чтобы заранее убедиться, что наши входные данные являются допустимыми, прежде чем пытаться использовать их в рабочем процессе обновления.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-233">In this tutorial we saw how to reduce the likelihood of exceptions by using validation controls to proactively ensure that our users inputs are valid before attempting to use them in the updating workflow.</span></span> <span data-ttu-id="b7b6e-234">ASP.NET предоставляет пять веб-элементов управления проверки, предназначенных для проверки определенных входных данных веб-элементов управления и создания отчетов на допустимость входных данных s.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-234">ASP.NET provides five validation Web controls that are designed to inspect a particular Web control s input and report back on the input s validity.</span></span> <span data-ttu-id="b7b6e-235">В этом учебнике мы использовали два из этих пяти элементов управления RequiredFieldValidator и CompareValidator, чтобы убедиться в том, что указано имя продукта и что цена имеет формат валюты со значением, большим или равным нулю.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-235">In this tutorial we used two of those five controls the RequiredFieldValidator and the CompareValidator to ensure that the product s name was supplied and that the price had a currency format with a value greater than or equal to zero.</span></span>

<span data-ttu-id="b7b6e-236">Добавление элементов управления проверки в интерфейс редактирования DataList s осуществляется так же просто, как перетаскивание их на `EditItemTemplate` из панели элементов и задание нескольких свойств.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-236">Adding validation controls to the DataList s editing interface is as simple as dragging them onto the `EditItemTemplate` from the Toolbox and setting a handful of properties.</span></span> <span data-ttu-id="b7b6e-237">По умолчанию элементы управления проверки автоматически создают скрипт проверки на стороне клиента. Они также обеспечивают проверку обратной передачи на стороне сервера, сохраняя накопительный результат в свойстве `Page.IsValid`.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-237">By default, the validation controls automatically emit client-side validation script; they also provide server-side validation on postback, storing the cumulative result in the `Page.IsValid` property.</span></span> <span data-ttu-id="b7b6e-238">Чтобы обойти проверку на стороне клиента при нажатии кнопки, LinkButton или ImageButton, установите для свойства Button `CausesValidation` значение `False`.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-238">To bypass the client-side validation when a Button, LinkButton, or ImageButton is clicked, set the button s `CausesValidation` property to `False`.</span></span> <span data-ttu-id="b7b6e-239">Кроме того, перед выполнением каких бы то ни было задач с данными, отправленными при обратной передаче, убедитесь, что свойство `Page.IsValid` возвращает `True`.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-239">Also, before performing any tasks with the data submitted on postback, ensure that the `Page.IsValid` property returns `True`.</span></span>

<span data-ttu-id="b7b6e-240">Все учебные руководства по редактированию DataList, которые мы рассматривали ранее, имели очень простой интерфейс правки. текстовое поле для названия продукта и другое значение для цены.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-240">All of the DataList editing tutorials we ve examined so far have had very simple editing interfaces a TextBox for the product s name and another for the price.</span></span> <span data-ttu-id="b7b6e-241">Однако интерфейс редактирования может содержать сочетание различных веб-элементов управления, таких как элементов управления DropDownList, календари, переключатели, флажки и т. д.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-241">The editing interface, however, can contain a mix of different Web controls, such as DropDownLists, Calendars, RadioButtons, CheckBoxes, and so on.</span></span> <span data-ttu-id="b7b6e-242">В следующем учебном курсе мы рассмотрим создание интерфейса, использующего разнообразные веб-элементы управления.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-242">In our next tutorial we'll look at building an interface that uses a variety of Web controls.</span></span>

<span data-ttu-id="b7b6e-243">Поздравляем с программированием!</span><span class="sxs-lookup"><span data-stu-id="b7b6e-243">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="b7b6e-244">Об авторе</span><span class="sxs-lookup"><span data-stu-id="b7b6e-244">About the Author</span></span>

<span data-ttu-id="b7b6e-245">[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи книг по ASP/ASP. NET и основатель [4GuysFromRolla.com](http://www.4guysfromrolla.com), работал с веб-технологиями Майкрософт с 1998.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-245">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="b7b6e-246">Скотт работает как независимый консультант, преподаватель и модуль записи.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-246">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="b7b6e-247">Его последняя книга — [*Sams обучать себя ASP.NET 2,0 за 24 часа*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="b7b6e-247">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="b7b6e-248">Он доступен по адресу [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="b7b6e-248">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="b7b6e-249">или через его блог, который можно найти по адресу [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="b7b6e-249">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="b7b6e-250">Специальная благодарность</span><span class="sxs-lookup"><span data-stu-id="b7b6e-250">Special Thanks To</span></span>

<span data-ttu-id="b7b6e-251">Эта серия руководств была рассмотрена многими полезными рецензентами.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-251">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="b7b6e-252">Потенциальные рецензенты для этого руководства были Деннис Patterson, Кен Песписа и основными рецензентами.</span><span class="sxs-lookup"><span data-stu-id="b7b6e-252">Lead reviewers for this tutorial were Dennis Patterson, Ken Pespisa, and Liz Shulok.</span></span> <span data-ttu-id="b7b6e-253">Хотите ознакомиться с моими будущими статьями MSDN?</span><span class="sxs-lookup"><span data-stu-id="b7b6e-253">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="b7b6e-254">Если это так, расположите строку в [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="b7b6e-254">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="b7b6e-255">[Назад](handling-bll-and-dal-level-exceptions-cs.md)
> [Вперед](customizing-the-datalist-s-editing-interface-cs.md)</span><span class="sxs-lookup"><span data-stu-id="b7b6e-255">[Previous](handling-bll-and-dal-level-exceptions-cs.md)
[Next](customizing-the-datalist-s-editing-interface-cs.md)</span></span>
