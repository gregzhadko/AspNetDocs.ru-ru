---
uid: web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/handling-bll-and-dal-level-exceptions-cs
title: Обработка исключений уровня BLL и DAL (C#) | Документация Майкрософт
author: rick-anderson
description: В этом учебнике мы посмотрим, как тактфулли обработку исключений, возникающих во время рабочего процесса обновления элемента управления DataList.
ms.author: riande
ms.date: 10/30/2006
ms.assetid: f8fd58e2-f932-4f08-ab3d-fbf8ff3295d2
msc.legacyurl: /web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/handling-bll-and-dal-level-exceptions-cs
msc.type: authoredcontent
ms.openlocfilehash: 35ff60be6ed67ea8d1bf226ae70f590100597757
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78494970"
---
# <a name="handling-bll--and-dal-level-exceptions-c"></a><span data-ttu-id="b2bc4-103">Обработка исключений уровней BLL и DAL (C#)</span><span class="sxs-lookup"><span data-stu-id="b2bc4-103">Handling BLL- and DAL-Level Exceptions (C#)</span></span>

<span data-ttu-id="b2bc4-104">по [Скотт Митчелл](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="b2bc4-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="b2bc4-105">[Скачивание примера приложения](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_38_CS.exe) или [Загрузка PDF-файла](handling-bll-and-dal-level-exceptions-cs/_static/datatutorial38cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="b2bc4-105">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_38_CS.exe) or [Download PDF](handling-bll-and-dal-level-exceptions-cs/_static/datatutorial38cs1.pdf)</span></span>

> <span data-ttu-id="b2bc4-106">В этом учебнике мы посмотрим, как тактфулли обработку исключений, возникающих во время рабочего процесса обновления элемента управления DataList.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-106">In this tutorial, we'll see how to tactfully handle exceptions raised during an editable DataList's updating workflow.</span></span>

## <a name="introduction"></a><span data-ttu-id="b2bc4-107">Введение</span><span class="sxs-lookup"><span data-stu-id="b2bc4-107">Introduction</span></span>

<span data-ttu-id="b2bc4-108">В [обзоре редактирования и удаления данных в руководстве по DataList](an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md) мы создали элемент управления DataList, который предлагает простые возможности редактирования и удаления.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-108">In the [Overview of Editing and Deleting Data in the DataList](an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md) tutorial, we created a DataList that offered simple editing and deleting capabilities.</span></span> <span data-ttu-id="b2bc4-109">В то время как все ошибки, произошедшие во время процесса редактирования или удаления, привели к необработанному исключению, хотя это и полностью функционально, это было неудобно для пользователя.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-109">While fully functional, it was hardly user-friendly, as any error that occurred during the editing or deleting process resulted in an unhandled exception.</span></span> <span data-ttu-id="b2bc4-110">Например, если не указать название продукта или при редактировании продукта ввести значение цены очень доступное!, создает исключение.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-110">For example, omitting the product s name or, when editing a product, entering a price value of Very affordable!, throws an exception.</span></span> <span data-ttu-id="b2bc4-111">Поскольку это исключение не перехвачено в коде, оно передается в среду выполнения ASP.NET, которая затем отображает подробные сведения об исключениях на веб-странице.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-111">Since this exception is not caught in code, it bubbles up to the ASP.NET runtime, which then displays the exception s details in the web page.</span></span>

<span data-ttu-id="b2bc4-112">Как было показано в статье [обработка исключений BLL и DAL в учебнике по страницам ASP.NET](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) , если исключение создается из глубины бизнес-логики или уровней доступа к данным, сведения об исключении возвращаются в ObjectDataSource, а затем в GridView.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-112">As we saw in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) tutorial, if an exception is raised from the depths of the Business Logic or Data Access Layers, the exception details are returned to the ObjectDataSource and then to the GridView.</span></span> <span data-ttu-id="b2bc4-113">Мы увидели, как правильно обрабатывать эти исключения путем создания `Updated` или `RowUpdated` обработчиков событий для ObjectDataSource или GridView, проверки исключения и последующего указания на то, что исключение было обработано.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-113">We saw how to gracefully handle these exceptions by creating `Updated` or `RowUpdated` event handlers for the ObjectDataSource or GridView, checking for an exception, and then indicating that the exception was handled.</span></span>

<span data-ttu-id="b2bc4-114">Однако наши руководства по DataList не используют ObjectDataSource для обновления и удаления данных.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-114">Our DataList tutorials, however, aren't using the ObjectDataSource for updating and deleting data.</span></span> <span data-ttu-id="b2bc4-115">Вместо этого мы работаем непосредственно с BLL.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-115">Instead, we are working directly against the BLL.</span></span> <span data-ttu-id="b2bc4-116">Для обнаружения исключений, исходящих от BLL или DAL, нам нужно реализовать код обработки исключений в коде программной части страницы ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-116">In order to detect exceptions originating from the BLL or DAL, we need to implement exception handling code within the code-behind of our ASP.NET page.</span></span> <span data-ttu-id="b2bc4-117">В этом руководстве мы рассмотрим, как более тактфулли обработку исключений, возникающих во время изменяемого рабочего процесса DataList s.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-117">In this tutorial, we'll see how to more tactfully handle exceptions raised during an editable DataList s updating workflow.</span></span>

> [!NOTE]
> <span data-ttu-id="b2bc4-118">В *обзоре редактирования и удаления данных в учебнике по DataList* мы обсуждали различные методы редактирования и удаления данных из DataList, некоторые методы, связанные с использованием элемента управления ObjectDataSource для обновления и удаления.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-118">In the *An Overview of Editing and Deleting Data in the DataList* tutorial we discussed different techniques for editing and deleting data from the DataList, Some techniques involved using an ObjectDataSource for updating and deleting.</span></span> <span data-ttu-id="b2bc4-119">Если вы применяете эти методы, вы можете выполнять обработку исключений из BLL или DAL с помощью ObjectDataSource `Updated` или `Deleted` обработчиков событий.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-119">If you employ these techniques, you can handle exceptions from the BLL or DAL through the ObjectDataSource s `Updated` or `Deleted` event handlers.</span></span>

## <a name="step-1-creating-an-editable-datalist"></a><span data-ttu-id="b2bc4-120">Шаг 1. Создание изменяемого элемента управления DataList</span><span class="sxs-lookup"><span data-stu-id="b2bc4-120">Step 1: Creating an Editable DataList</span></span>

<span data-ttu-id="b2bc4-121">Прежде чем беспокоиться об обработке исключений, происходящих во время обновления рабочего процесса, давайте сначала создадим изменяемый элемент управления DataList.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-121">Before we worry about handling exceptions that occur during the updating workflow, let s first create an editable DataList.</span></span> <span data-ttu-id="b2bc4-122">Откройте страницу `ErrorHandling.aspx` в папке `EditDeleteDataList`, добавьте в конструктор элемент управления DataList, задайте для свойства `ID` значение `Products`и добавьте новый элемент управления ObjectDataSource с именем `ProductsDataSource`.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-122">Open the `ErrorHandling.aspx` page in the `EditDeleteDataList` folder, add a DataList to the Designer, set its `ID` property to `Products`, and add a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="b2bc4-123">Настройте ObjectDataSource для использования метода `ProductsBLL` классов `GetProducts()` для выбора записей. Задайте для раскрывающихся списков на вкладках Вставка, обновление и удаление значение (нет).</span><span class="sxs-lookup"><span data-stu-id="b2bc4-123">Configure the ObjectDataSource to use the `ProductsBLL` class s `GetProducts()` method for selecting records; set the drop-down lists in the INSERT, UPDATE, and DELETE tabs to (None).</span></span>

<span data-ttu-id="b2bc4-124">[![получить сведения о продукте с помощью метода WebMethod ()](handling-bll-and-dal-level-exceptions-cs/_static/image2.png)](handling-bll-and-dal-level-exceptions-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="b2bc4-124">[![Return the Product Information Using the GetProducts() Method](handling-bll-and-dal-level-exceptions-cs/_static/image2.png)](handling-bll-and-dal-level-exceptions-cs/_static/image1.png)</span></span>

<span data-ttu-id="b2bc4-125">**Рис. 1**. Возврат сведений о продукте с помощью метода `GetProducts()` ([щелкните, чтобы просмотреть изображение с полным размером](handling-bll-and-dal-level-exceptions-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="b2bc4-125">**Figure 1**: Return the Product Information Using the `GetProducts()` Method ([Click to view full-size image](handling-bll-and-dal-level-exceptions-cs/_static/image3.png))</span></span>

<span data-ttu-id="b2bc4-126">После завершения работы мастера ObjectDataSource Visual Studio автоматически создаст `ItemTemplate` для DataList.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-126">After completing the ObjectDataSource wizard, Visual Studio will automatically create an `ItemTemplate` for the DataList.</span></span> <span data-ttu-id="b2bc4-127">Введите здесь `ItemTemplate`, где отображаются названия и цены каждого продукта и включается кнопка "Изменить".</span><span class="sxs-lookup"><span data-stu-id="b2bc4-127">Replace this with an `ItemTemplate` that displays each product s name and price and includes an Edit button.</span></span> <span data-ttu-id="b2bc4-128">Затем создайте `EditItemTemplate` с помощью веб-элемента управления TextBox для Name and Price, а также кнопок Update и Cancel.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-128">Next, create an `EditItemTemplate` with a TextBox Web control for name and price and Update and Cancel buttons.</span></span> <span data-ttu-id="b2bc4-129">Наконец, задайте свойству `RepeatColumns` DataList s значение 2.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-129">Finally, set the DataList s `RepeatColumns` property to 2.</span></span>

<span data-ttu-id="b2bc4-130">После этих изменений декларативная разметка страницы должна выглядеть следующим образом.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-130">After these changes, your page s declarative markup should look similar to the following.</span></span> <span data-ttu-id="b2bc4-131">Дважды проверьте, что кнопки Правка, отмена и обновление имеют свойства `CommandName` для которых задано изменение, отмена и обновление соответственно.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-131">Double-check to make certain that the Edit, Cancel, and Update buttons have their `CommandName` properties set to Edit, Cancel, and Update, respectively.</span></span>

[!code-aspx[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample1.aspx)]

> [!NOTE]
> <span data-ttu-id="b2bc4-132">В этом руководстве состояние представления DataList должно быть включено.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-132">For this tutorial the DataList s view state must be enabled.</span></span>

<span data-ttu-id="b2bc4-133">Потратьте время на просмотр нашего хода работы в браузере (см. рис. 2).</span><span class="sxs-lookup"><span data-stu-id="b2bc4-133">Take a moment to view our progress through a browser (see Figure 2).</span></span>

<span data-ttu-id="b2bc4-134">[![каждый продукт включает кнопку "Изменить"](handling-bll-and-dal-level-exceptions-cs/_static/image5.png)](handling-bll-and-dal-level-exceptions-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="b2bc4-134">[![Each Product Includes an Edit Button](handling-bll-and-dal-level-exceptions-cs/_static/image5.png)](handling-bll-and-dal-level-exceptions-cs/_static/image4.png)</span></span>

<span data-ttu-id="b2bc4-135">**Рис. 2**. каждый продукт включает кнопку "Изменить" ([щелкните, чтобы просмотреть изображение с полным размером](handling-bll-and-dal-level-exceptions-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="b2bc4-135">**Figure 2**: Each Product Includes an Edit Button ([Click to view full-size image](handling-bll-and-dal-level-exceptions-cs/_static/image6.png))</span></span>

<span data-ttu-id="b2bc4-136">В настоящее время кнопка Edit (изменить) только вызывает обратную передачу, но не делает продукт редактируемым.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-136">Currently, the Edit button only causes a postback it doesn t yet make the product editable.</span></span> <span data-ttu-id="b2bc4-137">Чтобы включить редактирование, необходимо создать обработчики событий для `EditCommand`, `CancelCommand`и `UpdateCommand` событий DataList.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-137">To enable editing, we need to create event handlers for the DataList s `EditCommand`, `CancelCommand`, and `UpdateCommand` events.</span></span> <span data-ttu-id="b2bc4-138">События `EditCommand` и `CancelCommand` просто обновляют свойство DataList `EditItemIndex` и повторно привязывают данные к DataList:</span><span class="sxs-lookup"><span data-stu-id="b2bc4-138">The `EditCommand` and `CancelCommand` events simply update the DataList s `EditItemIndex` property and rebind the data to the DataList:</span></span>

[!code-csharp[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample2.cs)]

<span data-ttu-id="b2bc4-139">Обработчик событий `UpdateCommand` является немного более сложным.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-139">The `UpdateCommand` event handler is a bit more involved.</span></span> <span data-ttu-id="b2bc4-140">Он должен прочесть измененный продукт s `ProductID` из коллекции `DataKeys` вместе с именем и ценой продукта из текстовых полей в `EditItemTemplate`, а затем вызвать метод `ProductsBLL` Class `UpdateProduct`, прежде чем возвратить элемент управления DataList в состояние предварительного редактирования.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-140">It needs to read in the edited product s `ProductID` from the `DataKeys` collection along with the product s name and price from the TextBoxes in the `EditItemTemplate`, and then call the `ProductsBLL` class s `UpdateProduct` method before returning the DataList to its pre-editing state.</span></span>

<span data-ttu-id="b2bc4-141">Пока что давайте просто используем тот же код из обработчика событий `UpdateCommand` в разделе *Общие сведения об изменении и удалении данных в* элементе управления DataList.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-141">For now, let s just use the exact same code from the `UpdateCommand` event handler in the *Overview of Editing and Deleting Data in the DataList* tutorial.</span></span> <span data-ttu-id="b2bc4-142">Мы добавим код для корректной обработке исключений на шаге 2.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-142">We'll add the code to gracefully handle exceptions in step 2.</span></span>

[!code-csharp[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample3.cs)]

<span data-ttu-id="b2bc4-143">На лицевой стороне недопустимых входных данных, которые могут быть в виде неправильно отформатированной цены за единицу, недопустимое значение цены единицы, например-$5,00, или при пропуске имени продукта, будет создано исключение.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-143">In the face of invalid input which can be in the form of an improperly formatted unit price, an illegal unit price value like -$5.00, or the omission of the product s name an exception will be raised.</span></span> <span data-ttu-id="b2bc4-144">Так как обработчик событий `UpdateCommand` не включает код обработки исключений на этом этапе, исключение будет восходящей до среды выполнения ASP.NET, где оно будет отображаться для конечного пользователя (см. рис. 3).</span><span class="sxs-lookup"><span data-stu-id="b2bc4-144">Since the `UpdateCommand` event handler does not include any exception handling code at this point, the exception will bubble up to the ASP.NET runtime, where it will be displayed to the end user (see Figure 3).</span></span>

![При возникновении необработанного исключения конечный пользователь видит страницу ошибки](handling-bll-and-dal-level-exceptions-cs/_static/image7.png)

<span data-ttu-id="b2bc4-146">**Рис. 3**. при возникновении необработанного исключения конечный пользователь видит страницу ошибки</span><span class="sxs-lookup"><span data-stu-id="b2bc4-146">**Figure 3**: When an Unhandled Exception Occurs, the End User Sees an Error Page</span></span>

## <a name="step-2-gracefully-handling-exceptions-in-the-updatecommand-event-handler"></a><span data-ttu-id="b2bc4-147">Шаг 2. корректное обработка исключений в обработчике событий UpdateCommand</span><span class="sxs-lookup"><span data-stu-id="b2bc4-147">Step 2: Gracefully Handling Exceptions in the UpdateCommand Event Handler</span></span>

<span data-ttu-id="b2bc4-148">Во время обновления рабочего процесса исключения могут возникать в обработчике событий `UpdateCommand`, BLL или DAL.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-148">During the updating workflow, exceptions can occur in the `UpdateCommand` event handler, the BLL, or the DAL.</span></span> <span data-ttu-id="b2bc4-149">Например, если пользователь вводит цену слишком дорогостоящей, то оператор `Decimal.Parse` в обработчике событий `UpdateCommand` выдаст исключение `FormatException`.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-149">For example, if a user enters a price of Too expensive, the `Decimal.Parse` statement in the `UpdateCommand` event handler will throw a `FormatException` exception.</span></span> <span data-ttu-id="b2bc4-150">Если пользователь опускает название продукта или если цена имеет отрицательное значение, DAL вызовет исключение.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-150">If the user omits the product s name or if the price has a negative value, the DAL will raise an exception.</span></span>

<span data-ttu-id="b2bc4-151">При возникновении исключения нам нужно отобразить информативное сообщение на самой странице.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-151">When an exception occurs, we want to display an informative message within the page itself.</span></span> <span data-ttu-id="b2bc4-152">Добавьте на страницу веб-элемент управления Label, для `ID` которого задано значение `ExceptionDetails`.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-152">Add a Label Web control to the page whose `ID` is set to `ExceptionDetails`.</span></span> <span data-ttu-id="b2bc4-153">Настройте текст метки, чтобы он отображался красным, очень крупным полужирным шрифтом и курсивом, назначив его свойство `CssClass` для класса `Warning` CSS, который определен в файле `Styles.css`.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-153">Configure the Label s text to display in a red, extra-large, bold and italic font by assigning its `CssClass` property to the `Warning` CSS class, which is defined in the `Styles.css` file.</span></span>

<span data-ttu-id="b2bc4-154">При возникновении ошибки необходимо, чтобы метка отображалась только один раз.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-154">When an error occurs, we only want the Label to be displayed once.</span></span> <span data-ttu-id="b2bc4-155">Это означает, что при последующих обратных передачах сообщение с предупреждением Label должно исчезнуть.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-155">That is, on subsequent postbacks, the Label s warning message should disappear.</span></span> <span data-ttu-id="b2bc4-156">Для этого можно либо очистить свойство Label `Text`, либо указать его свойство `Visible` для `False` в обработчике событий `Page_Load` (как мы делали это при [обработке исключений уровня BLL и DAL в учебнике по страницам ASP.NET](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) ) или путем отключения поддержки состояния просмотра меток s.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-156">This can be accomplished by either clearing out the Label s `Text` property or settings its `Visible` property to `False` in the `Page_Load` event handler (as we did back in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) tutorial) or by disabling the Label s view state support.</span></span> <span data-ttu-id="b2bc4-157">Позвольте использовать второй вариант.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-157">Let s use the latter option.</span></span>

[!code-aspx[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample4.aspx)]

<span data-ttu-id="b2bc4-158">При возникновении исключения сведения об исключении будут назначаться свойству `ExceptionDetails` меток `Text`.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-158">When an exception is raised, we'll assign the details of the exception to the `ExceptionDetails` Label control s `Text` property.</span></span> <span data-ttu-id="b2bc4-159">Так как состояние представления отключено, при последующих обратных передачах программные изменения свойств `Text` будут утрачены, возвращается к тексту по умолчанию (пустая строка), тем самым скрываются предупреждающие сообщения.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-159">Since its view state is disabled, on subsequent postbacks the `Text` property s programmatic changes will be lost, reverting back to the default text (an empty string), thereby hiding the warning message.</span></span>

<span data-ttu-id="b2bc4-160">Чтобы определить, когда возникла ошибка, чтобы на странице отображалось полезное сообщение, необходимо добавить блок `Try ... Catch` в обработчик событий `UpdateCommand`.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-160">To determine when an error has been raised in order to display a helpful message on the page, we need to add a `Try ... Catch` block to the `UpdateCommand` event handler.</span></span> <span data-ttu-id="b2bc4-161">`Try` часть содержит код, который может привести к исключению, в то время как блок `Catch` содержит код, выполняемый на стороне исключения.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-161">The `Try` portion contains code that may lead to an exception, while the `Catch` block contains code that is executed in the face of an exception.</span></span> <span data-ttu-id="b2bc4-162">Дополнительные сведения о блоке `Try ... Catch` см. в разделе " [основы обработки исключений](https://msdn.microsoft.com/library/2w8f0bss.aspx) " в .NET Framework документации.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-162">Check out the [Exception Handling Fundamentals](https://msdn.microsoft.com/library/2w8f0bss.aspx) section in the .NET Framework documentation for more information on the `Try ... Catch` block.</span></span>

[!code-csharp[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample5.cs)]

<span data-ttu-id="b2bc4-163">Если в блоке `Try` порождается исключение любого типа, код `Catch` блока s начнет выполняться.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-163">When an exception of any type is thrown by code within the `Try` block, the `Catch` block s code will begin executing.</span></span> <span data-ttu-id="b2bc4-164">Тип исключения, вызываемого `DbException`, `NoNullAllowedException`, `ArgumentException`и т. д., зависит от того, что точно, причиной ошибку в первую очередь.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-164">The type of exception that is thrown `DbException`, `NoNullAllowedException`, `ArgumentException`, and so on depends on what, exactly, precipitated the error in the first place.</span></span> <span data-ttu-id="b2bc4-165">Если на уровне базы данных возникла проблема, будет выдана `DbException`.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-165">If there s a problem at the database level, a `DbException` will be thrown.</span></span> <span data-ttu-id="b2bc4-166">Если для полей `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`или `ReorderLevel` введено недопустимое значение, будет выдано исключение `ArgumentException`, так как мы добавили код для проверки этих значений полей в классе `ProductsDataTable` (см. Руководство по [созданию уровня бизнес-логики](../introduction/creating-a-business-logic-layer-cs.md) ).</span><span class="sxs-lookup"><span data-stu-id="b2bc4-166">If an illegal value is entered for the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, or `ReorderLevel` fields, an `ArgumentException` will be thrown, as we added code to validate these field values in the `ProductsDataTable` class (see the [Creating a Business Logic Layer](../introduction/creating-a-business-logic-layer-cs.md) tutorial).</span></span>

<span data-ttu-id="b2bc4-167">Мы можем предоставить конечному пользователю более полезное объяснение, указав текст сообщения для типа перехваченного исключения.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-167">We can provide a more helpful explanation to the end user by basing the message text on the type of exception caught.</span></span> <span data-ttu-id="b2bc4-168">Следующий код, который использовался в практически идентичной форме для [обработки исключений уровня BLL и DAL на странице ASP.NET,](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) предоставляет такой уровень детализации:</span><span class="sxs-lookup"><span data-stu-id="b2bc4-168">The following code which was used in a nearly identical form back in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) tutorial provides this level of detail:</span></span>

[!code-csharp[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample6.cs)]

<span data-ttu-id="b2bc4-169">Для работы с этим руководством просто вызовите метод `DisplayExceptionDetails` из блока `Catch`, передав в перехваченный экземпляр `Exception` (`ex`).</span><span class="sxs-lookup"><span data-stu-id="b2bc4-169">To complete this tutorial, simply call the `DisplayExceptionDetails` method from the `Catch` block passing in the caught `Exception` instance (`ex`).</span></span>

<span data-ttu-id="b2bc4-170">При наличии блока `Try ... Catch` пользователям предоставляется более информативное сообщение об ошибке, как показано 4 и 5.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-170">With the `Try ... Catch` block in place, users are presented with a more informative error message, as Figures 4 and 5 show.</span></span> <span data-ttu-id="b2bc4-171">Обратите внимание, что в случае исключения элемент управления DataList остается в режиме редактирования.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-171">Note that in the face of an exception the DataList remains in edit mode.</span></span> <span data-ttu-id="b2bc4-172">Это происходит из-за того, что после возникновения исключения поток управления сразу же перенаправляется в блок `Catch`, минуя код, возвращающий элемент управления DataList в состояние предварительного редактирования.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-172">This is because once the exception occurs, the control flow is immediately redirected to the `Catch` block, bypassing the code that returns the DataList to its pre-editing state.</span></span>

<span data-ttu-id="b2bc4-173">[![отображается сообщение об ошибке, если пользователь опускает обязательное поле](handling-bll-and-dal-level-exceptions-cs/_static/image9.png)](handling-bll-and-dal-level-exceptions-cs/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="b2bc4-173">[![An Error Message is Displayed if a User Omits a Required Field](handling-bll-and-dal-level-exceptions-cs/_static/image9.png)](handling-bll-and-dal-level-exceptions-cs/_static/image8.png)</span></span>

<span data-ttu-id="b2bc4-174">**Рис. 4**. отображается сообщение об ошибке, если пользователь опускает обязательное поле ([щелкните, чтобы просмотреть изображение с полным размером](handling-bll-and-dal-level-exceptions-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="b2bc4-174">**Figure 4**: An Error Message is Displayed if a User Omits a Required Field ([Click to view full-size image](handling-bll-and-dal-level-exceptions-cs/_static/image10.png))</span></span>

<span data-ttu-id="b2bc4-175">[![при вводе отрицательной цены отображается сообщение об ошибке](handling-bll-and-dal-level-exceptions-cs/_static/image12.png)](handling-bll-and-dal-level-exceptions-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="b2bc4-175">[![An Error Message is Displayed When Entering a Negative Price](handling-bll-and-dal-level-exceptions-cs/_static/image12.png)](handling-bll-and-dal-level-exceptions-cs/_static/image11.png)</span></span>

<span data-ttu-id="b2bc4-176">**Рис. 5**. при вводе отрицательной цены отображается сообщение об ошибке ([щелкните, чтобы просмотреть изображение с полным размером](handling-bll-and-dal-level-exceptions-cs/_static/image13.png))</span><span class="sxs-lookup"><span data-stu-id="b2bc4-176">**Figure 5**: An Error Message is Displayed When Entering a Negative Price ([Click to view full-size image](handling-bll-and-dal-level-exceptions-cs/_static/image13.png))</span></span>

## <a name="summary"></a><span data-ttu-id="b2bc4-177">Сводка</span><span class="sxs-lookup"><span data-stu-id="b2bc4-177">Summary</span></span>

<span data-ttu-id="b2bc4-178">GridView и ObjectDataSource предоставляют обработчики событий пост-уровня, которые включают сведения обо всех исключениях, возникших во время рабочего процесса обновления и удаления, а также свойства, которые можно задать, чтобы указать, было ли исключение задействован.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-178">The GridView and ObjectDataSource provide post-level event handlers that include information about any exceptions that were raised during the updating and deleting workflow, as well as properties that can be set to indicate whether or not the exception has been handled.</span></span> <span data-ttu-id="b2bc4-179">Однако эти функции недоступны при работе с элементом управления DataList и непосредственном использовании BLL.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-179">These features, however, are unavailable when working with the DataList and using the BLL directly.</span></span> <span data-ttu-id="b2bc4-180">Вместо этого мы отвечаем за реализацию обработки исключений.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-180">Instead, we are responsible for implementing exception handling.</span></span>

<span data-ttu-id="b2bc4-181">В этом учебнике мы увидели, как добавить обработку исключений в изменяемый рабочий процесс DataList s, добавив блок `Try ... Catch` в обработчик событий `UpdateCommand`.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-181">In this tutorial we saw how to add exception handling to an editable DataList s updating workflow by adding a `Try ... Catch` block to the `UpdateCommand` event handler.</span></span> <span data-ttu-id="b2bc4-182">Если во время прогона обновления возникает исключение, код блока `Catch` блокируется, отображая полезную информацию в `ExceptionDetails` метке.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-182">If an exception is raised during the updating workflow, the `Catch` block s code executes, displaying helpful information in the `ExceptionDetails` Label.</span></span>

<span data-ttu-id="b2bc4-183">На этом этапе DataList не предпринимает никаких усилий, чтобы предотвратить возникновение исключений на первом месте.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-183">At this point, the DataList makes no effort to prevent exceptions from happening in the first place.</span></span> <span data-ttu-id="b2bc4-184">Даже если известно, что отрицательная цена приведет к исключению, мы еще не добавили какие-либо функции, чтобы заранее запретить пользователю вводить такие недопустимые входные данные.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-184">Even though we know that a negative price will result in an exception, we haven't yet added any functionality to proactively prevent a user from entering such invalid input.</span></span> <span data-ttu-id="b2bc4-185">В следующем учебном курсе мы покажем, как уменьшить количество исключений, вызванных недопустимыми входными данными пользователя, добавив элементы управления проверки в `EditItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-185">In our next tutorial we'll see how to help reduce the exceptions caused by invalid user input by adding validation controls in the `EditItemTemplate`.</span></span>

<span data-ttu-id="b2bc4-186">Поздравляем с программированием!</span><span class="sxs-lookup"><span data-stu-id="b2bc4-186">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="b2bc4-187">Дополнительные материалы</span><span class="sxs-lookup"><span data-stu-id="b2bc4-187">Further Reading</span></span>

<span data-ttu-id="b2bc4-188">Дополнительные сведения о разделах, обсуждаемых в этом руководстве, см. в следующих ресурсах:</span><span class="sxs-lookup"><span data-stu-id="b2bc4-188">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="b2bc4-189">Правила разработки исключений</span><span class="sxs-lookup"><span data-stu-id="b2bc4-189">Design Guidelines for Exceptions</span></span>](https://msdn.microsoft.com/library/ms298399.aspx)
- <span data-ttu-id="b2bc4-190">[Модули и обработчики журнала ошибок (ELMAH)](http://workspaces.gotdotnet.com/elmah) (библиотека с открытым исходным кодом для ведения журнала ошибок)</span><span class="sxs-lookup"><span data-stu-id="b2bc4-190">[Error Logging Modules and Handlers (ELMAH)](http://workspaces.gotdotnet.com/elmah) (an open-source library for logging errors)</span></span>
- <span data-ttu-id="b2bc4-191">[Корпоративная библиотека для .NET Framework 2,0](https://www.microsoft.com/downloads/details.aspx?familyid=5A14E870-406B-4F2A-B723-97BA84AE80B5&amp;displaylang=en) (включает в себя блок приложения управления исключениями)</span><span class="sxs-lookup"><span data-stu-id="b2bc4-191">[Enterprise Library for .NET Framework 2.0](https://www.microsoft.com/downloads/details.aspx?familyid=5A14E870-406B-4F2A-B723-97BA84AE80B5&amp;displaylang=en) (includes the Exception Management Application Block)</span></span>

## <a name="about-the-author"></a><span data-ttu-id="b2bc4-192">Об авторе</span><span class="sxs-lookup"><span data-stu-id="b2bc4-192">About the Author</span></span>

<span data-ttu-id="b2bc4-193">[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи книг по ASP/ASP. NET и основатель [4GuysFromRolla.com](http://www.4guysfromrolla.com), работал с веб-технологиями Майкрософт с 1998.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-193">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="b2bc4-194">Скотт работает как независимый консультант, преподаватель и модуль записи.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-194">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="b2bc4-195">Его последняя книга — [*Sams обучать себя ASP.NET 2,0 за 24 часа*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="b2bc4-195">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="b2bc4-196">Он доступен по адресу [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="b2bc4-196">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="b2bc4-197">или через его блог, который можно найти по адресу [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="b2bc4-197">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="b2bc4-198">Специальная благодарность</span><span class="sxs-lookup"><span data-stu-id="b2bc4-198">Special Thanks To</span></span>

<span data-ttu-id="b2bc4-199">Эта серия руководств была рассмотрена многими полезными рецензентами.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-199">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="b2bc4-200">Специалист по интересу для этого руководства был Кен Песписа.</span><span class="sxs-lookup"><span data-stu-id="b2bc4-200">Lead reviewer for this tutorial was Ken Pespisa.</span></span> <span data-ttu-id="b2bc4-201">Хотите ознакомиться с моими будущими статьями MSDN?</span><span class="sxs-lookup"><span data-stu-id="b2bc4-201">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="b2bc4-202">Если это так, расположите строку в [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="b2bc4-202">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="b2bc4-203">[Назад](performing-batch-updates-cs.md)
> [Вперед](adding-validation-controls-to-the-datalist-s-editing-interface-cs.md)</span><span class="sxs-lookup"><span data-stu-id="b2bc4-203">[Previous](performing-batch-updates-cs.md)
[Next](adding-validation-controls-to-the-datalist-s-editing-interface-cs.md)</span></span>
