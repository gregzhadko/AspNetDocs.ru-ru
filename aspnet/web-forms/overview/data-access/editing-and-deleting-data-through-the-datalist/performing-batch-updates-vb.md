---
uid: web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/performing-batch-updates-vb
title: Выполнение пакетных обновлений (Visual Basic) | Документация Майкрософт
author: rick-anderson
description: Вы научитесь создавать полностью изменяемых пользователем элементов управления DataList, где все элементы находятся в режим редактирования и, значения которых могут сохраняться, щелкнув кнопку «Обновить все»...
ms.author: riande
ms.date: 10/30/2006
ms.assetid: 8dac22a7-91de-4e3b-888f-a4c438b03851
msc.legacyurl: /web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/performing-batch-updates-vb
msc.type: authoredcontent
ms.openlocfilehash: 731272c5f240c97c3ecf845827216857ddc94802
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2019
ms.locfileid: "65132133"
---
# <a name="performing-batch-updates-vb"></a><span data-ttu-id="7e731-103">Выполнение пакетных обновлений (VB)</span><span class="sxs-lookup"><span data-stu-id="7e731-103">Performing Batch Updates (VB)</span></span>

<span data-ttu-id="7e731-104">по [Скотт Митчелл](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="7e731-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="7e731-105">[Скачайте пример приложения](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_37_VB.exe) или [скачать PDF](performing-batch-updates-vb/_static/datatutorial37vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="7e731-105">[Download Sample App](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_37_VB.exe) or [Download PDF](performing-batch-updates-vb/_static/datatutorial37vb1.pdf)</span></span>

> <span data-ttu-id="7e731-106">Вы научитесь создавать полностью изменяемых пользователем элементов управления DataList, где все элементы находятся в режим редактирования и, значения которых можно сохранить, нажмите кнопку «Обновить все» на странице.</span><span class="sxs-lookup"><span data-stu-id="7e731-106">Learn how to create a fully-editable DataList where all of its items are in edit mode and whose values can be saved by clicking an "Update All" button on the page.</span></span>

## <a name="introduction"></a><span data-ttu-id="7e731-107">Вступление</span><span class="sxs-lookup"><span data-stu-id="7e731-107">Introduction</span></span>

<span data-ttu-id="7e731-108">В [предыдущем учебном курсе](an-overview-of-editing-and-deleting-data-in-the-datalist-vb.md) мы рассмотрели способы создания уровня элемента DataList.</span><span class="sxs-lookup"><span data-stu-id="7e731-108">In the [preceding tutorial](an-overview-of-editing-and-deleting-data-in-the-datalist-vb.md) we examined how to create an item-level DataList.</span></span> <span data-ttu-id="7e731-109">Таким как стандартный изменяемого элемента управления GridView, каждый элемент в элементе управления DataList включены изменения кнопка, при щелчке, сделает изменяемый элемент.</span><span class="sxs-lookup"><span data-stu-id="7e731-109">Like the standard editable GridView, each item in the DataList included an Edit button that, when clicked, would make the item editable.</span></span> <span data-ttu-id="7e731-110">Хотя это уровень элемента редактирования подходит для данных, которая обновляется только время от времени, определенных сценариев вариантов использования требуется пользователю изменять большое количество записей.</span><span class="sxs-lookup"><span data-stu-id="7e731-110">While this item-level editing works well for data that is only updated occasionally, certain use case scenarios require the user to edit many records.</span></span> <span data-ttu-id="7e731-111">Если пользователь должен изменить десятки записи и принудительно щелкните "Изменить", внесите свои изменения и нажмите кнопку обновления для каждого из них, щелкнув сумма может помешать ее производительность.</span><span class="sxs-lookup"><span data-stu-id="7e731-111">If a user needs to edit dozens of records and is forced to click Edit, make their changes, and click Update for each one, the amount of clicking can hamper her productivity.</span></span> <span data-ttu-id="7e731-112">В таких ситуациях, лучшим вариантом является предоставление полностью изменяемых пользователем элементов управления DataList, которой *все* элементы находятся в режиме правки, а также значения которого можно изменить, щелкнув кнопка "Обновить все" на странице (см. рис. 1).</span><span class="sxs-lookup"><span data-stu-id="7e731-112">In such situations, a better option is to provide a fully-editable DataList, one where *all* of its items are in edit mode and whose values can be edited by clicking an Update All button on the page (see Figure 1).</span></span>

<span data-ttu-id="7e731-113">[![Можно изменить каждый элемент полностью редактирования элемента управления DataList](performing-batch-updates-vb/_static/image2.png)](performing-batch-updates-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="7e731-113">[![Each Item in a Fully Editable DataList can be Modified](performing-batch-updates-vb/_static/image2.png)](performing-batch-updates-vb/_static/image1.png)</span></span>

<span data-ttu-id="7e731-114">**Рис. 1**: Можно изменить каждый элемент полностью редактирования элемента управления DataList ([Просмотр полноразмерного изображения](performing-batch-updates-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="7e731-114">**Figure 1**: Each Item in a Fully Editable DataList can be Modified ([Click to view full-size image](performing-batch-updates-vb/_static/image3.png))</span></span>

<span data-ttu-id="7e731-115">В этом руководстве мы рассмотрим, как разрешить пользователям обновлять информацию об адресе поставщиков, с помощью полностью доступно для редактирования элемента управления DataList.</span><span class="sxs-lookup"><span data-stu-id="7e731-115">In this tutorial we'll examine how to enable users to update suppliers address information using a fully editable DataList.</span></span>

## <a name="step-1-create-the-editable-user-interface-in-the-datalist-s-itemtemplate"></a><span data-ttu-id="7e731-116">Шаг 1. Создать редактируемый пользовательского интерфейса в s ItemTemplate элемента управления DataList</span><span class="sxs-lookup"><span data-stu-id="7e731-116">Step 1: Create the Editable User Interface in the DataList s ItemTemplate</span></span>

<span data-ttu-id="7e731-117">В предыдущем учебном курсе, где мы создания редактируемой standard, уровень элемента управления DataList, мы использовали два шаблона:</span><span class="sxs-lookup"><span data-stu-id="7e731-117">In the preceding tutorial, where we creating a standard, item-level editable DataList, we used two templates:</span></span>

- <span data-ttu-id="7e731-118">`ItemTemplate` содержит интерфейс пользователя только для чтения (метка веб-элементы управления для отображения каждого s имя и цену продукта).</span><span class="sxs-lookup"><span data-stu-id="7e731-118">`ItemTemplate` contained the read-only user interface (the Label Web controls for displaying each product s name and price).</span></span>
- <span data-ttu-id="7e731-119">`EditItemTemplate` содержит пользовательский интерфейс (два элемента управления TextBox Web) режиме редактирования.</span><span class="sxs-lookup"><span data-stu-id="7e731-119">`EditItemTemplate` contained the edit mode user interface (the two TextBox Web controls).</span></span>

<span data-ttu-id="7e731-120">Элемент управления DataList s `EditItemIndex` свойство определяет, что `DataListItem` (если таковые имеются) отображается с помощью `EditItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="7e731-120">The DataList s `EditItemIndex` property dictates what `DataListItem` (if any) is rendered using the `EditItemTemplate`.</span></span> <span data-ttu-id="7e731-121">В частности `DataListItem` которого `ItemIndex` значение совпадает с DataList s `EditItemIndex` свойство отображается с помощью `EditItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="7e731-121">In particular, the `DataListItem` whose `ItemIndex` value matches the DataList s `EditItemIndex` property is rendered using the `EditItemTemplate`.</span></span> <span data-ttu-id="7e731-122">Эта модель хорошо удобен в том случае, если только один элемент можно изменить во время, но друг от друга, использованные при создании полностью изменяемых пользователем элементов управления DataList.</span><span class="sxs-lookup"><span data-stu-id="7e731-122">This model works well when only one item can be edited at a time, but falls apart when creating a fully-editable DataList.</span></span>

<span data-ttu-id="7e731-123">Для полностью доступно для редактирования элемента управления DataList, мы хотим *все* из `DataListItem` s для подготовки к просмотру с помощью интерфейса редактирования.</span><span class="sxs-lookup"><span data-stu-id="7e731-123">For a fully editable DataList, we want *all* of the `DataListItem` s to render using the editable interface.</span></span> <span data-ttu-id="7e731-124">Самый простой способ выполнения этой задачи является определение интерфейса редактирования в `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="7e731-124">The simplest way to accomplish this is to define the editable interface in the `ItemTemplate`.</span></span> <span data-ttu-id="7e731-125">Для изменения информации об адресе поставщики, редактируемый интерфейс содержит имя поставщика, как текст, а затем текстовые поля для адреса, города и страны значения.</span><span class="sxs-lookup"><span data-stu-id="7e731-125">For modifying the suppliers address information, the editable interface contains the supplier name as text and then TextBoxes for the address, city, and country values.</span></span>

<span data-ttu-id="7e731-126">Сначала откройте `BatchUpdate.aspx` странице, добавьте элемент управления DataList и задайте его `ID` свойства `Suppliers`.</span><span class="sxs-lookup"><span data-stu-id="7e731-126">Start by opening the `BatchUpdate.aspx` page, add a DataList control, and set its `ID` property to `Suppliers`.</span></span> <span data-ttu-id="7e731-127">В смарт-теге элемента управления DataList s, необязательно, чтобы добавить новый элемент управления ObjectDataSource с именем `SuppliersDataSource`.</span><span class="sxs-lookup"><span data-stu-id="7e731-127">From the DataList s smart tag, opt to add a new ObjectDataSource control named `SuppliersDataSource`.</span></span>

<span data-ttu-id="7e731-128">[![Создайте новый ObjectDataSource, именуемого SuppliersDataSource](performing-batch-updates-vb/_static/image5.png)](performing-batch-updates-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="7e731-128">[![Create a New ObjectDataSource Named SuppliersDataSource](performing-batch-updates-vb/_static/image5.png)](performing-batch-updates-vb/_static/image4.png)</span></span>

<span data-ttu-id="7e731-129">**Рис. 2**: Создайте новый ObjectDataSource с именем `SuppliersDataSource` ([Просмотр полноразмерного изображения](performing-batch-updates-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="7e731-129">**Figure 2**: Create a New ObjectDataSource Named `SuppliersDataSource` ([Click to view full-size image](performing-batch-updates-vb/_static/image6.png))</span></span>

<span data-ttu-id="7e731-130">Настройте элемент ObjectDataSource для извлечения данных с помощью `SuppliersBLL` класс s `GetSuppliers()` метод (см. рис. 3).</span><span class="sxs-lookup"><span data-stu-id="7e731-130">Configure the ObjectDataSource to retrieve data using the `SuppliersBLL` class s `GetSuppliers()` method (see Figure 3).</span></span> <span data-ttu-id="7e731-131">Как и в предыдущем учебном курсе, а не обновление сведений о поставщике через элемент управления ObjectDataSource, мы будем работать непосредственно с уровня бизнес-логики.</span><span class="sxs-lookup"><span data-stu-id="7e731-131">As with the preceding tutorial, rather than updating the supplier information through the ObjectDataSource, we'll work directly with the Business Logic Layer.</span></span> <span data-ttu-id="7e731-132">Таким образом, задать стрелку раскрывающегося списка (нет) на вкладке "обновления" (см. рис. 4).</span><span class="sxs-lookup"><span data-stu-id="7e731-132">Therefore, set the drop-down list to (None) in the UPDATE tab (see Figure 4).</span></span>

<span data-ttu-id="7e731-133">[![Получение сведений о поставщике, с помощью метода GetSuppliers()](performing-batch-updates-vb/_static/image8.png)](performing-batch-updates-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="7e731-133">[![Retrieve Supplier Information Using the GetSuppliers() Method](performing-batch-updates-vb/_static/image8.png)](performing-batch-updates-vb/_static/image7.png)</span></span>

<span data-ttu-id="7e731-134">**Рис. 3**: Получить сведения с помощью поставщика `GetSuppliers()` метод ([Просмотр полноразмерного изображения](performing-batch-updates-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="7e731-134">**Figure 3**: Retrieve Supplier Information Using the `GetSuppliers()` Method ([Click to view full-size image](performing-batch-updates-vb/_static/image9.png))</span></span>

<span data-ttu-id="7e731-135">[![Задайте стрелку раскрывающегося списка (нет) на вкладке "обновления"](performing-batch-updates-vb/_static/image11.png)](performing-batch-updates-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="7e731-135">[![Set the Drop-Down List to (None) in the UPDATE Tab](performing-batch-updates-vb/_static/image11.png)](performing-batch-updates-vb/_static/image10.png)</span></span>

<span data-ttu-id="7e731-136">**Рис. 4**: Задайте стрелку раскрывающегося списка (нет) на вкладке "обновления" ([Просмотр полноразмерного изображения](performing-batch-updates-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="7e731-136">**Figure 4**: Set the Drop-Down List to (None) in the UPDATE Tab ([Click to view full-size image](performing-batch-updates-vb/_static/image12.png))</span></span>

<span data-ttu-id="7e731-137">После завершения работы мастера, Visual Studio автоматически создает элемент управления DataList s `ItemTemplate` для отображения каждого поля данных, возвращаемых источником данных в элементе управления Label Web.</span><span class="sxs-lookup"><span data-stu-id="7e731-137">After completing the wizard, Visual Studio automatically generates the DataList s `ItemTemplate` to display each data field returned by the data source in a Label Web control.</span></span> <span data-ttu-id="7e731-138">Нам нужно изменить этот шаблон, чтобы на ней присутствовала интерфейса редактирования.</span><span class="sxs-lookup"><span data-stu-id="7e731-138">We need to modify this template so that it provides the editing interface instead.</span></span> <span data-ttu-id="7e731-139">`ItemTemplate` Можно настроить через конструктор в режиме редактирования шаблонов в смарт-теге элемента управления DataList s или напрямую через декларативный синтаксис.</span><span class="sxs-lookup"><span data-stu-id="7e731-139">The `ItemTemplate` can be customized through the Designer using the Edit Templates option from the DataList s smart tag or directly through the declarative syntax.</span></span>

<span data-ttu-id="7e731-140">Отвлекитесь и создать интерфейс редактирования, который отображает имя s поставщика в виде текста, но включает текстовые поля для поставщика s адрес, Город и Страна значения.</span><span class="sxs-lookup"><span data-stu-id="7e731-140">Take a moment to create an editing interface that displays the supplier s name as text, but includes TextBoxes for the supplier s address, city, and country values.</span></span> <span data-ttu-id="7e731-141">После внесения этих изменений декларативный синтаксис s страницы должен выглядеть примерно следующее:</span><span class="sxs-lookup"><span data-stu-id="7e731-141">After making these changes, your page s declarative syntax should look similar to the following:</span></span>

[!code-aspx[Main](performing-batch-updates-vb/samples/sample1.aspx)]

> [!NOTE]
> <span data-ttu-id="7e731-142">Как в предыдущем учебном курсе, элемент управления DataList, в этом руководстве необходим включено.</span><span class="sxs-lookup"><span data-stu-id="7e731-142">As with the preceding tutorial, the DataList in this tutorial must have its view state enabled.</span></span>

<span data-ttu-id="7e731-143">В `ItemTemplate` я использую два новых класса CSS, `SupplierPropertyLabel` и `SupplierPropertyValue`, которой были добавлены `Styles.css` класса и использует те же параметры стиля, как `ProductPropertyLabel` и `ProductPropertyValue` классы CSS.</span><span class="sxs-lookup"><span data-stu-id="7e731-143">In the `ItemTemplate` I m using two new CSS classes, `SupplierPropertyLabel` and `SupplierPropertyValue`, which have been added to the `Styles.css` class and configured to use the same style settings as the `ProductPropertyLabel` and `ProductPropertyValue` CSS classes.</span></span>

[!code-css[Main](performing-batch-updates-vb/samples/sample2.css)]

<span data-ttu-id="7e731-144">После внесения этих изменений, посетите эту страницу через обозреватель.</span><span class="sxs-lookup"><span data-stu-id="7e731-144">After making these changes, visit this page through a browser.</span></span> <span data-ttu-id="7e731-145">Как показано на рис. 5, каждый элемент управления DataList отображает имя поставщика в виде текста и использует текстовые поля для отображения адреса, города и страны.</span><span class="sxs-lookup"><span data-stu-id="7e731-145">As Figure 5 shows, each DataList item displays the supplier name as text and uses TextBoxes to display the address, city, and country.</span></span>

<span data-ttu-id="7e731-146">[![Каждый поставщик в DataList является редактируемое](performing-batch-updates-vb/_static/image14.png)](performing-batch-updates-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="7e731-146">[![Each Supplier in the DataList is Editable](performing-batch-updates-vb/_static/image14.png)](performing-batch-updates-vb/_static/image13.png)</span></span>

<span data-ttu-id="7e731-147">**Рис. 5**: Каждый поставщик в DataList является редактируемое ([Просмотр полноразмерного изображения](performing-batch-updates-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="7e731-147">**Figure 5**: Each Supplier in the DataList is Editable ([Click to view full-size image](performing-batch-updates-vb/_static/image15.png))</span></span>

## <a name="step-2-adding-an-update-all-button"></a><span data-ttu-id="7e731-148">Шаг 2. Добавление обновления кнопка "все"</span><span class="sxs-lookup"><span data-stu-id="7e731-148">Step 2: Adding an Update All Button</span></span>

<span data-ttu-id="7e731-149">Хотя у каждого поставщика, на рис. 5 есть его адрес, Город и Страна полей, отображаемых в текстовое поле, в настоящее время нет кнопкой "Обновить".</span><span class="sxs-lookup"><span data-stu-id="7e731-149">While each supplier in Figure 5 has its address, city, and country fields displayed in a TextBox, there currently is no Update button available.</span></span> <span data-ttu-id="7e731-150">Вместо того, кнопка обновления каждого элемента, с полностью доступно для редактирования DataLists обычно наблюдается одной обновить все кнопки на странице, при нажатии обновляет *все* записей в элементе управления DataList.</span><span class="sxs-lookup"><span data-stu-id="7e731-150">Rather than having an Update button per item, with fully editable DataLists there is typically a single Update All button on the page that, when clicked, updates *all* of the records in the DataList.</span></span> <span data-ttu-id="7e731-151">Для этого руководства позволяют добавить два обновить все кнопки — в верхней части страницы и нижней (несмотря на то, что щелкнув одну из кнопок будет иметь тот же эффект) s.</span><span class="sxs-lookup"><span data-stu-id="7e731-151">For this tutorial, let s add two Update All buttons - one at the top of the page and one at the bottom (although clicking either button will have the same effect).</span></span>

<span data-ttu-id="7e731-152">Начните с добавления кнопки веб-элемент управления выше элементов управления DataList и набор его `ID` свойства `UpdateAll1`.</span><span class="sxs-lookup"><span data-stu-id="7e731-152">Start by adding a Button Web control above the DataList and set its `ID` property to `UpdateAll1`.</span></span> <span data-ttu-id="7e731-153">Затем добавьте второй веб-управления Button под элемент управления DataList, установка его `ID` для `UpdateAll2`.</span><span class="sxs-lookup"><span data-stu-id="7e731-153">Next, add the second Button Web control beneath the DataList, setting its `ID` to `UpdateAll2`.</span></span> <span data-ttu-id="7e731-154">Задайте `Text` две кнопки, чтобы обновить все свойства.</span><span class="sxs-lookup"><span data-stu-id="7e731-154">Set the `Text` properties for the two Buttons to Update All.</span></span> <span data-ttu-id="7e731-155">Наконец, создание обработчиков событий для обеих кнопок `Click` события.</span><span class="sxs-lookup"><span data-stu-id="7e731-155">Lastly, create event handlers for both Buttons `Click` events.</span></span> <span data-ttu-id="7e731-156">Вместо того чтобы дублировать логику обновления в каждом из обработчиков событий, позволяют s рефакторинг эту логику в третий метод `UpdateAllSupplierAddresses`, наличие обработчики событий, просто вызывая этот третий метод.</span><span class="sxs-lookup"><span data-stu-id="7e731-156">Rather than duplicating the update logic in each of the event handlers, let s refactor that logic to a third method, `UpdateAllSupplierAddresses`, having the event handlers simply invoking this third method.</span></span>

[!code-vb[Main](performing-batch-updates-vb/samples/sample3.vb)]

<span data-ttu-id="7e731-157">Рис. 6 показана страница, после добавления обновить все кнопки.</span><span class="sxs-lookup"><span data-stu-id="7e731-157">Figure 6 shows the page after the Update All buttons have been added.</span></span>

<span data-ttu-id="7e731-158">[![Две кнопки все обновления были добавлены на страницу](performing-batch-updates-vb/_static/image17.png)](performing-batch-updates-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="7e731-158">[![Two Update All Buttons have been Added to the Page](performing-batch-updates-vb/_static/image17.png)](performing-batch-updates-vb/_static/image16.png)</span></span>

<span data-ttu-id="7e731-159">**Рис. 6**: Две кнопки все обновления были добавлены на страницу ([Просмотр полноразмерного изображения](performing-batch-updates-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="7e731-159">**Figure 6**: Two Update All Buttons have been Added to the Page ([Click to view full-size image](performing-batch-updates-vb/_static/image18.png))</span></span>

## <a name="step-3-updating-all-of-the-suppliers-address-information"></a><span data-ttu-id="7e731-160">Шаг 3. Обновление всех сведений об адресе поставщики</span><span class="sxs-lookup"><span data-stu-id="7e731-160">Step 3: Updating All of the Suppliers Address Information</span></span>

<span data-ttu-id="7e731-161">Со всеми s элементов управления DataList, отображение интерфейса редактирования и с добавлением обновления всех кнопок все, что остается написание кода для выполнения пакетного обновления.</span><span class="sxs-lookup"><span data-stu-id="7e731-161">With all of the DataList s items displaying the editing interface and with the addition of the Update All buttons, all that remains is writing the code to perform the batch update.</span></span> <span data-ttu-id="7e731-162">В частности, нам нужно перебрать элементы управления DataList s и вызов `SuppliersBLL` класс s `UpdateSupplierAddress` метод для каждого из них.</span><span class="sxs-lookup"><span data-stu-id="7e731-162">Specifically, we need to loop through the DataList s items and call the `SuppliersBLL` class s `UpdateSupplierAddress` method for each one.</span></span>

<span data-ttu-id="7e731-163">Коллекция `DataListItem` экземпляров, состав DataList может осуществляться через элемент управления DataList s [ `Items` свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.items.aspx).</span><span class="sxs-lookup"><span data-stu-id="7e731-163">The collection of `DataListItem` instances that makeup the DataList can be accessed via the DataList s [`Items` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.items.aspx).</span></span> <span data-ttu-id="7e731-164">Со ссылкой на `DataListItem`, можно взять соответствующие `SupplierID` из `DataKeys` коллекции и программно ссылки, элементы управления TextBox Web в `ItemTemplate` как показано в следующем коде:</span><span class="sxs-lookup"><span data-stu-id="7e731-164">With a reference to a `DataListItem`, we can grab the corresponding `SupplierID` from the `DataKeys` collection and programmatically reference the TextBox Web controls within the `ItemTemplate` as the following code illustrates:</span></span>

[!code-vb[Main](performing-batch-updates-vb/samples/sample4.vb)]

<span data-ttu-id="7e731-165">Когда пользователь нажимает одну из кнопок, все обновления, `UpdateAllSupplierAddresses` метод перебирает все `DataListItem` в `Suppliers` элементов управления DataList и вызовы `SuppliersBLL` класс s `UpdateSupplierAddress` метод, передавая соответствующие значения.</span><span class="sxs-lookup"><span data-stu-id="7e731-165">When the user clicks one of the Update All buttons, the `UpdateAllSupplierAddresses` method iterates through each `DataListItem` in the `Suppliers` DataList and calls the `SuppliersBLL` class s `UpdateSupplierAddress` method, passing in the corresponding values.</span></span> <span data-ttu-id="7e731-166">Значение не введено значение для адреса, города или страны передает `Nothing` для `UpdateSupplierAddress` (а не содержит пустую строку), что приводит к базе данных `NULL` для базовой записи s полей.</span><span class="sxs-lookup"><span data-stu-id="7e731-166">A non-entered value for address, city, or country passes is a value of `Nothing` to `UpdateSupplierAddress` (rather than a blank string), which results in a database `NULL` for the underlying record s fields.</span></span>

> [!NOTE]
> <span data-ttu-id="7e731-167">Усовершенствование может потребоваться добавить состояние веб-управления Label к странице, предоставляет некоторые сообщение с подтверждением после пакетного обновления.</span><span class="sxs-lookup"><span data-stu-id="7e731-167">As an enhancement, you may want to add a status Label Web control to the page that provides some confirmation message after the batch update is performed.</span></span>

## <a name="updating-only-those-addresses-that-have-been-modified"></a><span data-ttu-id="7e731-168">Обновление только те адреса, которые были изменены</span><span class="sxs-lookup"><span data-stu-id="7e731-168">Updating Only Those Addresses That Have Been Modified</span></span>

<span data-ttu-id="7e731-169">Алгоритм обновления пакетной службы, используемый для этого учебника вызовов `UpdateSupplierAddress` метод *каждые* поставщика в элементе управления DataList, независимо от того, менялся ли сведения о своем адресе.</span><span class="sxs-lookup"><span data-stu-id="7e731-169">The batch update algorithm used for this tutorial calls the `UpdateSupplierAddress` method for *every* supplier in the DataList, regardless of whether their address information has been changed.</span></span> <span data-ttu-id="7e731-170">Во время таких людей с нарушениями зрения обновлений обычно не проблемы с производительностью, они может привести к излишним записей, если изменяется во время аудита в таблицу базы данных.</span><span class="sxs-lookup"><span data-stu-id="7e731-170">While such blind updates aren't usually a performance issue, they can lead to superfluous records if you re auditing changes to the database table.</span></span> <span data-ttu-id="7e731-171">Например, если используются триггеры для записи всех `UPDATE` s, чтобы `Suppliers` таблицы в таблицу аудита, каждый раз, когда пользователь щелкает кнопку Обновить все записи аудита будет создаваться для каждого поставщика в системе, независимо от того, внесла ли пользователь изменения.</span><span class="sxs-lookup"><span data-stu-id="7e731-171">For example, if you use triggers to record all `UPDATE` s to the `Suppliers` table to an auditing table, every time a user clicks the Update All button a new audit record will be created for each supplier in the system, regardless of whether the user made any changes.</span></span>

<span data-ttu-id="7e731-172">Классы ADO.NET DataTable и DataAdapter, позволяют пакетные обновления, где только измененные, удаленные и новые записи приводит все взаимодействие с базой данных.</span><span class="sxs-lookup"><span data-stu-id="7e731-172">The ADO.NET DataTable and DataAdapter classes are designed to support batch updates where only modified, deleted, and new records results in any database communication.</span></span> <span data-ttu-id="7e731-173">Каждая строка в объекте DataTable содержит [ `RowState` свойство](https://msdn.microsoft.com/library/system.data.datarow.rowstate.aspx) , указывающее, был добавлен к таблице DataTable, удалены из него, изменения, или остается без изменений строки.</span><span class="sxs-lookup"><span data-stu-id="7e731-173">Each row in the DataTable has a [`RowState` property](https://msdn.microsoft.com/library/system.data.datarow.rowstate.aspx) that indicates whether the row has been added to the DataTable, deleted from it, modified, or remains unchanged.</span></span> <span data-ttu-id="7e731-174">Когда изначально заполняется объект DataTable, все строки помечаются без изменений.</span><span class="sxs-lookup"><span data-stu-id="7e731-174">When a DataTable is initially populated, all rows are marked unchanged.</span></span> <span data-ttu-id="7e731-175">Изменение значения всех столбцов строки s строка помечается как измененный.</span><span class="sxs-lookup"><span data-stu-id="7e731-175">Changing the value of any of the row s columns marks the row as modified.</span></span>

<span data-ttu-id="7e731-176">В `SuppliersBLL` класс, мы обновляем информации об адресе указанного поставщика s, сначала прочитать статью в записи одного поставщика в `SuppliersDataTable` и задайте `Address`, `City`, и `Country` значения столбцов, используя следующий код:</span><span class="sxs-lookup"><span data-stu-id="7e731-176">In the `SuppliersBLL` class we update the specified supplier s address information by first reading in the single supplier record into a `SuppliersDataTable` and then set the `Address`, `City`, and `Country` column values using the following code:</span></span>

[!code-vb[Main](performing-batch-updates-vb/samples/sample5.vb)]

<span data-ttu-id="7e731-177">Этот код присваивает наивно переданный адрес, Город и Страна значения `SuppliersRow` в `SuppliersDataTable` независимо от того, является ли, что значения изменились.</span><span class="sxs-lookup"><span data-stu-id="7e731-177">This code naively assigns the passed-in address, city, and country values to the `SuppliersRow` in the `SuppliersDataTable` regardless of whether or not the values have changed.</span></span> <span data-ttu-id="7e731-178">Это вызывает `SuppliersRow` s `RowState` свойство помечается как измененный.</span><span class="sxs-lookup"><span data-stu-id="7e731-178">These modifications cause the `SuppliersRow` s `RowState` property to be marked as modified.</span></span> <span data-ttu-id="7e731-179">Когда s уровня доступа к данным `Update` вызывается метод, он видит, что `SupplierRow` была изменена и таким образом отправляет `UPDATE` команду к базе данных.</span><span class="sxs-lookup"><span data-stu-id="7e731-179">When the Data Access Layer s `Update` method is called, it sees that the `SupplierRow` has been modified and therefore sends an `UPDATE` command to the database.</span></span>

<span data-ttu-id="7e731-180">Однако представьте, что мы добавили код в этот метод, чтобы только назначить переданный адрес, Город и Страна значения, если они отличаются от `SuppliersRow` s существующие значения.</span><span class="sxs-lookup"><span data-stu-id="7e731-180">Imagine, however, that we added code to this method to only assign the passed-in address, city, and country values if they differ from the `SuppliersRow` s existing values.</span></span> <span data-ttu-id="7e731-181">В случае адрес, Город и Страна которых так же, как существующие данные не будут изменены и `SupplierRow` s `RowState` будет помечен как остается неизменной.</span><span class="sxs-lookup"><span data-stu-id="7e731-181">In the case where the address, city, and country are the same as the existing data, no changes will be made and the `SupplierRow` s `RowState` will be left marked as unchanged.</span></span> <span data-ttu-id="7e731-182">Конечным результатом будет, когда DAL s `Update` был вызван, будет сделан звонок не базы данных, так как `SuppliersRow` не был изменен.</span><span class="sxs-lookup"><span data-stu-id="7e731-182">The net result is that when the DAL s `Update` method is called, no database call will be made because the `SuppliersRow` has not been modified.</span></span>

<span data-ttu-id="7e731-183">Для применения этого изменения, замените инструкции, которые просто назначают переданный адрес, Город и Страна значения следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="7e731-183">To enact this change, replace the statements that blindly assign the passed-in address, city, and country values with the following code:</span></span>

[!code-vb[Main](performing-batch-updates-vb/samples/sample6.vb)]

<span data-ttu-id="7e731-184">С этим добавили код, DAL s `Update` метод отправляет `UPDATE` инструкцию в базе данных только те записи, которые были изменены, значения, связанные с адресом.</span><span class="sxs-lookup"><span data-stu-id="7e731-184">With this added code, the DAL s `Update` method sends an `UPDATE` statement to the database for only those records whose address-related values have changed.</span></span>

<span data-ttu-id="7e731-185">Кроме того, мы может отслеживать ли имеются различия между полями переданный адрес и данные базы данных и, при отсутствии таких, просто пропустить вызов DAL s `Update` метод.</span><span class="sxs-lookup"><span data-stu-id="7e731-185">Alternatively, we could keep track of whether there are any differences between the passed-in address fields and the database data and, if there are none, simply bypass the call to the DAL s `Update` method.</span></span> <span data-ttu-id="7e731-186">Этот подход работает также в том случае, если вы используете базы данных прямого метода, так как переданный t является прямой метод DB `SuppliersRow` экземпляра которого `RowState` можно проверить, чтобы определить, требуется ли фактически вызов базы данных.</span><span class="sxs-lookup"><span data-stu-id="7e731-186">This approach works well if you re using the DB direct method, since the DB direct method isn t passed a `SuppliersRow` instance whose `RowState` can be checked to determine whether a database call is actually needed.</span></span>

> [!NOTE]
> <span data-ttu-id="7e731-187">Каждый раз `UpdateSupplierAddress` вызывается метод, вызов выполняется в базу данных для получения сведений об обновленной записи.</span><span class="sxs-lookup"><span data-stu-id="7e731-187">Each time the `UpdateSupplierAddress` method is invoked, a call is made to the database to retrieve information about the updated record.</span></span> <span data-ttu-id="7e731-188">Затем, если в данных имеются изменения, еще один вызов к базе данных для обновления строки таблицы.</span><span class="sxs-lookup"><span data-stu-id="7e731-188">Then, if there are any changes in data, another call to the database is made to update the table row.</span></span> <span data-ttu-id="7e731-189">Этот рабочий процесс можно оптимизировать, создав `UpdateSupplierAddress` перегрузку метода, который принимает `EmployeesDataTable` экземпляра, включающего *все* изменений из `BatchUpdate.aspx` страницы.</span><span class="sxs-lookup"><span data-stu-id="7e731-189">This workflow could be optimized by creating an `UpdateSupplierAddress` method overload that accepts an `EmployeesDataTable` instance that has *all* of the changes from the `BatchUpdate.aspx` page.</span></span> <span data-ttu-id="7e731-190">Затем он может сделать один вызов к базе данных, чтобы получить все записи из `Suppliers` таблицы.</span><span class="sxs-lookup"><span data-stu-id="7e731-190">Then, it could make one call to the database to get all of the records from the `Suppliers` table.</span></span> <span data-ttu-id="7e731-191">Затем может быть перечислено два результирующих наборов и могут быть обновлены только те записи, где произошли изменения.</span><span class="sxs-lookup"><span data-stu-id="7e731-191">The two resultsets could then be enumerated and only those records where changes have occurred could be updated.</span></span>

## <a name="summary"></a><span data-ttu-id="7e731-192">Сводка</span><span class="sxs-lookup"><span data-stu-id="7e731-192">Summary</span></span>

<span data-ttu-id="7e731-193">В этом учебнике мы рассмотрели создание полностью доступно для редактирования элемента управления DataList, что позволяет пользователю быстро изменять сведения об адресах для нескольких поставщиков.</span><span class="sxs-lookup"><span data-stu-id="7e731-193">In this tutorial we saw how to create a fully editable DataList, allowing a user to quickly modify the address information for multiple suppliers.</span></span> <span data-ttu-id="7e731-194">Мы начали путем определения интерфейса редактирования текстового поля веб-элемент управления для поставщика s адрес, Город и Страна значения в элементе управления DataList s `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="7e731-194">We started by defining the editing interface a TextBox Web control for the supplier s address, city, and country values in the DataList s `ItemTemplate`.</span></span> <span data-ttu-id="7e731-195">Затем мы добавили обновление всех кнопок выше и ниже элемента управления DataList.</span><span class="sxs-lookup"><span data-stu-id="7e731-195">Next, we added Update All buttons above and below the DataList.</span></span> <span data-ttu-id="7e731-196">После его изменения и одну из кнопок, все обновления, нажатии пользователя `DataListItem` перечисляются s и вызов `SuppliersBLL` класс s `UpdateSupplierAddress` метода.</span><span class="sxs-lookup"><span data-stu-id="7e731-196">After a user has made his changes and clicked one of the Update All buttons, the `DataListItem` s are enumerated and a call to the `SuppliersBLL` class s `UpdateSupplierAddress` method is made.</span></span>

<span data-ttu-id="7e731-197">Счастливого вам программирования!</span><span class="sxs-lookup"><span data-stu-id="7e731-197">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="7e731-198">Об авторе</span><span class="sxs-lookup"><span data-stu-id="7e731-198">About the Author</span></span>

<span data-ttu-id="7e731-199">[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи книг по ASP/ASP.NET и основатель веб- [4GuysFromRolla.com](http://www.4guysfromrolla.com), работает с веб-технологиями Microsoft с 1998 года.</span><span class="sxs-lookup"><span data-stu-id="7e731-199">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="7e731-200">Скотт — независимый консультант, преподаватель и автор.</span><span class="sxs-lookup"><span data-stu-id="7e731-200">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="7e731-201">Его последняя книга — [ *Sams Teach ASP.NET 2.0 in 24 часа*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="7e731-201">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="7e731-202">Ним можно связаться по адресу [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="7e731-202">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="7e731-203">или через его блог, который можно найти в [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="7e731-203">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="7e731-204">Особая благодарность</span><span class="sxs-lookup"><span data-stu-id="7e731-204">Special Thanks To</span></span>

<span data-ttu-id="7e731-205">В этой серии руководств пособий рецензировалась многими компетентными редакторами.</span><span class="sxs-lookup"><span data-stu-id="7e731-205">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="7e731-206">Стали Зак Джонс и Кен Pespisa Лиз Шалок в этом руководстве.</span><span class="sxs-lookup"><span data-stu-id="7e731-206">Lead reviewers for this tutorial were Zack Jones and Ken Pespisa.</span></span> <span data-ttu-id="7e731-207">Хотите поработать с моих последующих статей для MSDN?</span><span class="sxs-lookup"><span data-stu-id="7e731-207">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="7e731-208">Если Да, напишите мне [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="7e731-208">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="7e731-209">[Назад](an-overview-of-editing-and-deleting-data-in-the-datalist-vb.md)
> [Вперед](handling-bll-and-dal-level-exceptions-vb.md)</span><span class="sxs-lookup"><span data-stu-id="7e731-209">[Previous](an-overview-of-editing-and-deleting-data-in-the-datalist-vb.md)
[Next](handling-bll-and-dal-level-exceptions-vb.md)</span></span>
