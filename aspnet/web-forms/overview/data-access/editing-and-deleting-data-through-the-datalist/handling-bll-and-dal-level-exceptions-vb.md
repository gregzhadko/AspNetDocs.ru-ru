---
uid: web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/handling-bll-and-dal-level-exceptions-vb
title: Обработка исключений уровней BLL и DAL (Visual Basic) | Документация Майкрософт
author: rick-anderson
description: В этом руководстве будет показано, как tactfully обработки исключений, возникающих во время обновления рабочего процесса редактирования элемента управления DataList.
ms.author: riande
ms.date: 10/30/2006
ms.assetid: ca665073-b379-4239-9404-f597663ca65e
msc.legacyurl: /web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/handling-bll-and-dal-level-exceptions-vb
msc.type: authoredcontent
ms.openlocfilehash: d52fadc1ddcc101d5815df6f1c1bc5eeba95d9b8
ms.sourcegitcommit: 62db31596a7da029263cf06335aff12236fb3186
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/26/2019
ms.locfileid: "58440369"
---
<a name="handling-bll--and-dal-level-exceptions-vb"></a>Обработка исключений уровней BLL и DAL (VB)
====================
по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Скачайте пример приложения](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_38_VB.exe) или [скачать PDF](handling-bll-and-dal-level-exceptions-vb/_static/datatutorial38vb1.pdf)

> В этом руководстве будет показано, как tactfully обработки исключений, возникающих во время обновления рабочего процесса редактирования элемента управления DataList.


## <a name="introduction"></a>Вступление

В [обзор редактирования и удаления данных в DataList](an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md) мы создали элемент управления DataList, предлагаемые простого редактирования и удаления возможности. Хотя полностью функциональную, было едва ли понятными, как любая ошибка, произошедшая во время редактирования или процесс удаления привело к необработанное исключение. Например, при пропуске названия продукта s или, при правке продукта, при вводе значения цены очень по доступной цене!, вызывает исключение. Так как это исключение не перехватывается в коде, он поднимает до среды выполнения ASP.NET, которая затем отображает сведения об исключении s в веб-страницы.

Как мы видели в [обработка BLL и исключения уровня DAL на странице ASP.NET](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) учебник, если возникает исключение из глубин бизнес-логику или уровни доступа к данным, сведения об исключении возвращаются к элементу ObjectDataSource и затем к GridView. Мы узнали, как для правильной обработки этих исключений путем создания `Updated` или `RowUpdated` обработчики событий для элементов управления GridView, проверка для исключения, а затем, указывающее, что исключение было обработано или элемент управления ObjectDataSource.

Тем не менее, руководств по DataList, не используется элемент управления ObjectDataSource для обновления и удаления данных. Вместо этого мы работаем непосредственно в BLL. Чтобы обнаруживать исключения, исходящие от DAL или BLL, нам нужно реализовать код внутри фонового кода страницы ASP.NET обработки исключений. В этом руководстве будет показано, как более tactfully обработки исключений, возникающих во время редактирования элемента управления DataList s обновление рабочего процесса.

> [!NOTE]
> В *обзор редактирования и удаления данных в DataList* учебнике мы рассмотрели различные методы для редактирования и удаления данных из элемента управления DataList, некоторые методы связана с использованием нового ObjectDataSource для обновления и Идет удаление. Если вы применяете эти методы, можно обрабатывать исключения из BLL и DAL с помощью ObjectDataSource s `Updated` или `Deleted` обработчики событий.


## <a name="step-1-creating-an-editable-datalist"></a>Шаг 1. Создание редактируемых элементов управления DataList

Прежде чем думать об обработке исключений, происходящих во время обновления рабочего процесса, позвольте s сначала создать редактируемый элемент управления DataList. Откройте `ErrorHandling.aspx` странице в `EditDeleteDataList` добавьте элемент управления DataList в конструктор, набор папок, его `ID` свойства `Products`, и добавьте новый ObjectDataSource, именуемый `ProductsDataSource`. Настройка ObjectDataSource на использование `ProductsBLL` класс s `GetProducts()` записывает метод выбора; задать раскрывающиеся списки в инструкции INSERT, UPDATE и удаление вкладок (нет).


[![Возвращает сведения о продукте, с помощью метода GetProducts()](handling-bll-and-dal-level-exceptions-vb/_static/image2.png)](handling-bll-and-dal-level-exceptions-vb/_static/image1.png)

**Рис. 1**: Возвращает сведения о продукте с помощью `GetProducts()` метод ([Просмотр полноразмерного изображения](handling-bll-and-dal-level-exceptions-vb/_static/image3.png))


После завершения работы мастера ObjectDataSource Visual Studio автоматически создает `ItemTemplate` элемента управления DataList. Введите здесь с `ItemTemplate` , отображает каждый s имя и цену продукта и содержит кнопку "Изменить". Создайте `EditItemTemplate` с элементом управления TextBox Web для имени и цены и кнопки "обновления" и "Отмена". Наконец, установите DataList s `RepeatColumns` значение 2.

После внесения этих изменений декларативная разметка s страницы должен выглядеть следующим образом. Еще раз проверьте, убедитесь, что изменить "," "Отмена", и кнопки обновления имеют свои `CommandName` задать свойства для изменения, отменить и обновления, соответственно.


[!code-aspx[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample1.aspx)]

> [!NOTE]
> В этом руководстве элемент управления DataList необходимо включить состояние просмотра s.


Отвлекитесь и просмотрите ход работы в обозревателе (см. рис. 2).


[![Кнопка «Изменить» включает в себя каждого продукта](handling-bll-and-dal-level-exceptions-vb/_static/image5.png)](handling-bll-and-dal-level-exceptions-vb/_static/image4.png)

**Рис. 2**: Каждый продукт включает кнопка Изменить ([Просмотр полноразмерного изображения](handling-bll-and-dal-level-exceptions-vb/_static/image6.png))


В настоящее время "Изменить" только вызывает обратную передачу его t еще редактировать продукта. Чтобы включить редактирование, необходимо создать обработчики событий для элементов управления DataList s `EditCommand`, `CancelCommand`, и `UpdateCommand` события. `EditCommand` И `CancelCommand` события просто обновить DataList s `EditItemIndex` свойство и повторную привязку данных к элементу управления DataList:


[!code-vb[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample2.vb)]

`UpdateCommand` Обработчик событий — немного сложнее. Его требуется считать продукта s `ProductID` из `DataKeys` коллекции, а также s имя и цену продукта из текстовых полей в `EditItemTemplate`, а затем вызвать `ProductsBLL` класс s `UpdateProduct` метод перед возвратом управления DataList в состояние до редактирования.

Теперь позволяют s просто использовать точный код из `UpdateCommand` обработчик событий в *обзор редактирования и удаления данных в DataList* руководства. Мы добавим код для правильной обработки исключений на шаге 2.


[!code-vb[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample3.vb)]

При возникновении недопустимые входные данные которой может быть в форме созданию неправильно отформатированного цена, значение цены Недопустимая единица, например - 5,00 долл. США или заменяют s название продукта, возникает исключение. Так как `UpdateCommand` обработчик событий не включает любой код на этом этапе обработки исключений, исключение будет передано до среды выполнения ASP.NET, где он будет отображаться для конечного пользователя (см. рис. 3).


![При возникновении необработанного исключения, конечный пользователь видит страницу ошибки](handling-bll-and-dal-level-exceptions-vb/_static/image7.png)

**Рис. 3**: При возникновении необработанного исключения, конечный пользователь видит страницу ошибки


## <a name="step-2-gracefully-handling-exceptions-in-the-updatecommand-event-handler"></a>Шаг 2. Аккуратная обработка исключений в обработчике событий UpdateCommand

Во время обновления рабочего процесса, исключения могут возникать в `UpdateCommand` обработчик событий, BLL и DAL. Например, если пользователь вводит цену слишком дорогим, `Decimal.Parse` инструкции в `UpdateCommand` обработчик событий вызывает исключение `FormatException` исключение. Если пользователь опускает имя продукта s или цена имеет отрицательное значение, DAL будет выдано исключение.

При возникновении исключения, мы хотим вывода информационного сообщения внутри самой страницы. Добавление метки веб-элемент управления на страницу `ID` присваивается `ExceptionDetails`. Настройка метки s текст, отображаемый в красный, очень большой, полужирного шрифта и курсива шрифта, назначив его `CssClass` свойства `Warning` класс CSS, который определен в `Styles.css` файл.

При возникновении ошибки, нам нужен только метки для отображения один раз. То есть при последующих обратных передачах метка s предупреждающее сообщение должно исчезнуть. Это можно сделать, сняв out метка s `Text` свойства или параметры его `Visible` свойства `False` в `Page_Load` обработчик событий (как делалось в [обработка BLL и исключения уровня DAL в ASP Страница .NET](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md) руководстве) или путем отключения поддержки состояния представления метки s. Разрешить использовать последний вариант s.


[!code-aspx[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample4.aspx)]

При возникновении исключения, мы назначим подробности исключения, чтобы `ExceptionDetails` метки элемента управления s `Text` свойство. Так как состояние просмотра отключено, при последующих обратных передачах `Text` свойство s программного изменения будут потеряны, действовавшие текст по умолчанию (пустая строка), таким образом скрывая предупреждающее сообщение.

Чтобы определить, когда возникает ошибка для отображения на странице отображается информационное сообщение, необходимо добавить `Try ... Catch` блок `UpdateCommand` обработчик событий. `Try` Часть содержит код, который может привести к исключению, хотя `Catch` блок содержит код, выполняемый при возникновении исключения. Ознакомьтесь с [основы обработки исключений](https://msdn.microsoft.com/library/2w8f0bss.aspx) статьи в документации по .NET Framework, Дополнительные сведения о `Try ... Catch` блока.


[!code-vb[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample5.vb)]

Когда любого типа, создается исключение внутри `Try` блока, `Catch` запускает выполнение кода блоков. Тип исключения, которое возникает `DbException`, `NoNullAllowedException`, `ArgumentException`и так далее, зависит, какие именно, ставшее причиной ошибки в первую очередь. Если там s проблемы на уровне базы данных, `DbException` будет создано. Если указано недопустимое значение для `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, или `ReorderLevel` поля, `ArgumentException` будет создаваться, так как мы добавили код для проверки значения этих полей в `ProductsDataTable` класса (см. в разделе [ Создание уровня бизнес-логики](../introduction/creating-a-business-logic-layer-vb.md) руководстве).

Мы предоставляем более полезные пояснения конечному пользователю на основе типа исключения, перехваченного текст сообщения. Следующий код, который использовался в почти те же форму обратно в [обработка BLL и исключения уровня DAL на странице ASP.NET](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md) учебник такой уровень детализации:


[!code-vb[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample6.vb)]

Для работы с этим руководством, просто вызовите `DisplayExceptionDetails` метода из `Catch` блок, передавая на Перехваченный `Exception` экземпляра (`ex`).

С помощью `Try ... Catch` блока в месте, пользователям предоставляется более подробное сообщение об ошибке, как рис. 4 и 5 show. Обратите внимание, что при возникновении исключения DataList остается в режиме редактирования. Это обусловлено тем, как только произойдет исключение, поток управления немедленно перенаправлены в `Catch` блока, минуя код, который возвращает состояние до редактирования элемента управления DataList.


[![Сообщение об ошибке отображается в том случае, когда пользователь опускает необходимые поля](handling-bll-and-dal-level-exceptions-vb/_static/image9.png)](handling-bll-and-dal-level-exceptions-vb/_static/image8.png)

**Рис. 4**: Сообщение об ошибке отображается в том случае, когда пользователь опускает необходимые поля ([Просмотр полноразмерного изображения](handling-bll-and-dal-level-exceptions-vb/_static/image10.png))


[![Сообщение об ошибке — отображаются при вводе отрицательное цены](handling-bll-and-dal-level-exceptions-vb/_static/image12.png)](handling-bll-and-dal-level-exceptions-vb/_static/image11.png)

**Рис. 5**: Сообщение об ошибке — отображаются при вводе отрицательное цены ([Просмотр полноразмерного изображения](handling-bll-and-dal-level-exceptions-vb/_static/image13.png))


## <a name="summary"></a>Сводка

GridView и ObjectDataSource предоставить обработчики событий последующего уровня, содержащие сведения о любые исключения, возникшие при выполнении рабочего процесса обновления и удаления, а также свойства, которые могут содержать значение, указывающее, было ли исключение обработано. Эти функции, однако, недоступны при работе с DataList и непосредственно с помощью BLL. Вместо этого мы отвечаете за реализацию обработку исключений.

В этом руководстве мы увидели, как добавить обработку исключений для редактируемых элементов управления DataList s обновление рабочего процесса с помощью добавления `Try ... Catch` блок `UpdateCommand` обработчик событий. Если исключение возникает во время обновления рабочего процесса, `Catch` блоков кода выполняется отображение полезную информацию в `ExceptionDetails` метки.

На этом этапе DataList не пытается предотвратить исключений происходит в первую очередь. Несмотря на то, что мы знаем, что приведет к отрицательным цена исключение, мы еще не добавили возможность заранее не позволяют пользователю вводить такие недопустимые входные данные. В нашем следующем учебном курсе мы рассмотрим способ смягчения исключения, вызванные недопустимый пользователя путем добавления элементов управления проверки в `EditItemTemplate`.

Счастливого вам программирования!

## <a name="further-reading"></a>Дополнительные сведения

Дополнительные сведения по темам, обсуждавшимся в этом руководстве см. в следующих ресурсах:

- [Правила разработки исключений](https://msdn.microsoft.com/library/ms298399.aspx)
- [Ошибка ведения журнала модулей и обработчиков (ELMAH)](http://workspaces.gotdotnet.com/elmah) (библиотекой с открытым исходным кодом для ведения журнала ошибок)
- [Enterprise Library для .NET Framework 2.0](https://www.microsoft.com/downloads/details.aspx?familyid=5A14E870-406B-4F2A-B723-97BA84AE80B5&amp;displaylang=en) (включает Exception Management Application Block)

## <a name="about-the-author"></a>Об авторе

[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи книг по ASP/ASP.NET и основатель веб- [4GuysFromRolla.com](http://www.4guysfromrolla.com), работает с веб-технологиями Microsoft с 1998 года. Скотт — независимый консультант, преподаватель и автор. Его последняя книга — [ *Sams Teach ASP.NET 2.0 in 24 часа*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco). Ним можно связаться по адресу [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) или через его блог, который можно найти в [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).

## <a name="special-thanks-to"></a>Особая благодарность

В этой серии руководств пособий рецензировалась многими компетентными редакторами. Основной рецензент этого учебного был Алексей Pespisa. Хотите поработать с моих последующих статей для MSDN? Если Да, напишите мне [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)

> [!div class="step-by-step"]
> [Назад](performing-batch-updates-vb.md)
> [Вперед](adding-validation-controls-to-the-datalist-s-editing-interface-vb.md)
