---
uid: web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/handling-bll-and-dal-level-exceptions-vb
title: Обработка исключений уровней BLL и DAL (Visual Basic) | Документация Майкрософт
author: rick-anderson
description: В этом руководстве будет показано, как tactfully обработки исключений, возникающих во время обновления рабочего процесса редактирования элемента управления DataList.
ms.author: riande
ms.date: 10/30/2006
ms.assetid: ca665073-b379-4239-9404-f597663ca65e
msc.legacyurl: /web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/handling-bll-and-dal-level-exceptions-vb
msc.type: authoredcontent
ms.openlocfilehash: 358d8605ed602720c7dd1687c8bdbb4275753529
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/09/2019
ms.locfileid: "59386103"
---
# <a name="handling-bll--and-dal-level-exceptions-vb"></a><span data-ttu-id="cfd84-103">Обработка исключений уровней BLL и DAL (VB)</span><span class="sxs-lookup"><span data-stu-id="cfd84-103">Handling BLL- and DAL-Level Exceptions (VB)</span></span>

<span data-ttu-id="cfd84-104">по [Скотт Митчелл](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="cfd84-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="cfd84-105">[Скачайте пример приложения](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_38_VB.exe) или [скачать PDF](handling-bll-and-dal-level-exceptions-vb/_static/datatutorial38vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="cfd84-105">[Download Sample App](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_38_VB.exe) or [Download PDF](handling-bll-and-dal-level-exceptions-vb/_static/datatutorial38vb1.pdf)</span></span>

> <span data-ttu-id="cfd84-106">В этом руководстве будет показано, как tactfully обработки исключений, возникающих во время обновления рабочего процесса редактирования элемента управления DataList.</span><span class="sxs-lookup"><span data-stu-id="cfd84-106">In this tutorial, we'll see how to tactfully handle exceptions raised during an editable DataList's updating workflow.</span></span>


## <a name="introduction"></a><span data-ttu-id="cfd84-107">Вступление</span><span class="sxs-lookup"><span data-stu-id="cfd84-107">Introduction</span></span>

<span data-ttu-id="cfd84-108">В [обзор редактирования и удаления данных в DataList](an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md) мы создали элемент управления DataList, предлагаемые простого редактирования и удаления возможности.</span><span class="sxs-lookup"><span data-stu-id="cfd84-108">In the [Overview of Editing and Deleting Data in the DataList](an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md) tutorial, we created a DataList that offered simple editing and deleting capabilities.</span></span> <span data-ttu-id="cfd84-109">Хотя полностью функциональную, было едва ли понятными, как любая ошибка, произошедшая во время редактирования или процесс удаления привело к необработанное исключение.</span><span class="sxs-lookup"><span data-stu-id="cfd84-109">While fully functional, it was hardly user-friendly, as any error that occurred during the editing or deleting process resulted in an unhandled exception.</span></span> <span data-ttu-id="cfd84-110">Например, при пропуске названия продукта s или, при правке продукта, при вводе значения цены очень по доступной цене!, вызывает исключение.</span><span class="sxs-lookup"><span data-stu-id="cfd84-110">For example, omitting the product s name or, when editing a product, entering a price value of Very affordable!, throws an exception.</span></span> <span data-ttu-id="cfd84-111">Так как это исключение не перехватывается в коде, он поднимает до среды выполнения ASP.NET, которая затем отображает сведения об исключении s в веб-страницы.</span><span class="sxs-lookup"><span data-stu-id="cfd84-111">Since this exception is not caught in code, it bubbles up to the ASP.NET runtime, which then displays the exception s details in the web page.</span></span>

<span data-ttu-id="cfd84-112">Как мы видели в [обработка BLL и исключения уровня DAL на странице ASP.NET](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) учебник, если возникает исключение из глубин бизнес-логику или уровни доступа к данным, сведения об исключении возвращаются к элементу ObjectDataSource и затем к GridView.</span><span class="sxs-lookup"><span data-stu-id="cfd84-112">As we saw in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) tutorial, if an exception is raised from the depths of the Business Logic or Data Access Layers, the exception details are returned to the ObjectDataSource and then to the GridView.</span></span> <span data-ttu-id="cfd84-113">Мы узнали, как для правильной обработки этих исключений путем создания `Updated` или `RowUpdated` обработчики событий для элементов управления GridView, проверка для исключения, а затем, указывающее, что исключение было обработано или элемент управления ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="cfd84-113">We saw how to gracefully handle these exceptions by creating `Updated` or `RowUpdated` event handlers for the ObjectDataSource or GridView, checking for an exception, and then indicating that the exception was handled.</span></span>

<span data-ttu-id="cfd84-114">Тем не менее, руководств по DataList, не используется элемент управления ObjectDataSource для обновления и удаления данных.</span><span class="sxs-lookup"><span data-stu-id="cfd84-114">Our DataList tutorials, however, aren't using the ObjectDataSource for updating and deleting data.</span></span> <span data-ttu-id="cfd84-115">Вместо этого мы работаем непосредственно в BLL.</span><span class="sxs-lookup"><span data-stu-id="cfd84-115">Instead, we are working directly against the BLL.</span></span> <span data-ttu-id="cfd84-116">Чтобы обнаруживать исключения, исходящие от DAL или BLL, нам нужно реализовать код внутри фонового кода страницы ASP.NET обработки исключений.</span><span class="sxs-lookup"><span data-stu-id="cfd84-116">In order to detect exceptions originating from the BLL or DAL, we need to implement exception handling code within the code-behind of our ASP.NET page.</span></span> <span data-ttu-id="cfd84-117">В этом руководстве будет показано, как более tactfully обработки исключений, возникающих во время редактирования элемента управления DataList s обновление рабочего процесса.</span><span class="sxs-lookup"><span data-stu-id="cfd84-117">In this tutorial, we'll see how to more tactfully handle exceptions raised during an editable DataList s updating workflow.</span></span>

> [!NOTE]
> <span data-ttu-id="cfd84-118">В *обзор редактирования и удаления данных в DataList* учебнике мы рассмотрели различные методы для редактирования и удаления данных из элемента управления DataList, некоторые методы связана с использованием нового ObjectDataSource для обновления и Идет удаление.</span><span class="sxs-lookup"><span data-stu-id="cfd84-118">In the *An Overview of Editing and Deleting Data in the DataList* tutorial we discussed different techniques for editing and deleting data from the DataList, Some techniques involved using an ObjectDataSource for updating and deleting.</span></span> <span data-ttu-id="cfd84-119">Если вы применяете эти методы, можно обрабатывать исключения из BLL и DAL с помощью ObjectDataSource s `Updated` или `Deleted` обработчики событий.</span><span class="sxs-lookup"><span data-stu-id="cfd84-119">If you employ these techniques, you can handle exceptions from the BLL or DAL through the ObjectDataSource s `Updated` or `Deleted` event handlers.</span></span>


## <a name="step-1-creating-an-editable-datalist"></a><span data-ttu-id="cfd84-120">Шаг 1. Создание редактируемых элементов управления DataList</span><span class="sxs-lookup"><span data-stu-id="cfd84-120">Step 1: Creating an Editable DataList</span></span>

<span data-ttu-id="cfd84-121">Прежде чем думать об обработке исключений, происходящих во время обновления рабочего процесса, позвольте s сначала создать редактируемый элемент управления DataList.</span><span class="sxs-lookup"><span data-stu-id="cfd84-121">Before we worry about handling exceptions that occur during the updating workflow, let s first create an editable DataList.</span></span> <span data-ttu-id="cfd84-122">Откройте `ErrorHandling.aspx` странице в `EditDeleteDataList` добавьте элемент управления DataList в конструктор, набор папок, его `ID` свойства `Products`, и добавьте новый ObjectDataSource, именуемый `ProductsDataSource`.</span><span class="sxs-lookup"><span data-stu-id="cfd84-122">Open the `ErrorHandling.aspx` page in the `EditDeleteDataList` folder, add a DataList to the Designer, set its `ID` property to `Products`, and add a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="cfd84-123">Настройка ObjectDataSource на использование `ProductsBLL` класс s `GetProducts()` записывает метод выбора; задать раскрывающиеся списки в инструкции INSERT, UPDATE и удаление вкладок (нет).</span><span class="sxs-lookup"><span data-stu-id="cfd84-123">Configure the ObjectDataSource to use the `ProductsBLL` class s `GetProducts()` method for selecting records; set the drop-down lists in the INSERT, UPDATE, and DELETE tabs to (None).</span></span>


[![R<span data-ttu-id="cfd84-124">ь сведения о продукте, с помощью метода GetProducts()]</span><span class="sxs-lookup"><span data-stu-id="cfd84-124">eturn the Product Information Using the GetProducts() Method]</span></span>(handling-bll-and-dal-level-exceptions-vb/_static/image2.png)](handling-bll-and-dal-level-exceptions-vb/_static/image1.png)

<span data-ttu-id="cfd84-125">**Рис. 1**: Возвращает сведения о продукте с помощью `GetProducts()` метод ([Просмотр полноразмерного изображения](handling-bll-and-dal-level-exceptions-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="cfd84-125">**Figure 1**: Return the Product Information Using the `GetProducts()` Method ([Click to view full-size image](handling-bll-and-dal-level-exceptions-vb/_static/image3.png))</span></span>


<span data-ttu-id="cfd84-126">После завершения работы мастера ObjectDataSource Visual Studio автоматически создает `ItemTemplate` элемента управления DataList.</span><span class="sxs-lookup"><span data-stu-id="cfd84-126">After completing the ObjectDataSource wizard, Visual Studio will automatically create an `ItemTemplate` for the DataList.</span></span> <span data-ttu-id="cfd84-127">Введите здесь с `ItemTemplate` , отображает каждый s имя и цену продукта и содержит кнопку "Изменить".</span><span class="sxs-lookup"><span data-stu-id="cfd84-127">Replace this with an `ItemTemplate` that displays each product s name and price and includes an Edit button.</span></span> <span data-ttu-id="cfd84-128">Создайте `EditItemTemplate` с элементом управления TextBox Web для имени и цены и кнопки "обновления" и "Отмена".</span><span class="sxs-lookup"><span data-stu-id="cfd84-128">Next, create an `EditItemTemplate` with a TextBox Web control for name and price and Update and Cancel buttons.</span></span> <span data-ttu-id="cfd84-129">Наконец, установите DataList s `RepeatColumns` значение 2.</span><span class="sxs-lookup"><span data-stu-id="cfd84-129">Finally, set the DataList s `RepeatColumns` property to 2.</span></span>

<span data-ttu-id="cfd84-130">После внесения этих изменений декларативная разметка s страницы должен выглядеть следующим образом.</span><span class="sxs-lookup"><span data-stu-id="cfd84-130">After these changes, your page s declarative markup should look similar to the following.</span></span> <span data-ttu-id="cfd84-131">Еще раз проверьте, убедитесь, что изменить "," "Отмена", и кнопки обновления имеют свои `CommandName` задать свойства для изменения, отменить и обновления, соответственно.</span><span class="sxs-lookup"><span data-stu-id="cfd84-131">Double-check to make certain that the Edit, Cancel, and Update buttons have their `CommandName` properties set to Edit, Cancel, and Update, respectively.</span></span>


[!code-aspx[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample1.aspx)]

> [!NOTE]
> <span data-ttu-id="cfd84-132">В этом руководстве элемент управления DataList необходимо включить состояние просмотра s.</span><span class="sxs-lookup"><span data-stu-id="cfd84-132">For this tutorial the DataList s view state must be enabled.</span></span>


<span data-ttu-id="cfd84-133">Отвлекитесь и просмотрите ход работы в обозревателе (см. рис. 2).</span><span class="sxs-lookup"><span data-stu-id="cfd84-133">Take a moment to view our progress through a browser (see Figure 2).</span></span>


[![E<span data-ttu-id="cfd84-134">ACH продукта содержит кнопку "Изменить".]</span><span class="sxs-lookup"><span data-stu-id="cfd84-134">ach Product Includes an Edit Button]</span></span>(handling-bll-and-dal-level-exceptions-vb/_static/image5.png)](handling-bll-and-dal-level-exceptions-vb/_static/image4.png)

<span data-ttu-id="cfd84-135">**Рис. 2**: Каждый продукт включает кнопка Изменить ([Просмотр полноразмерного изображения](handling-bll-and-dal-level-exceptions-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="cfd84-135">**Figure 2**: Each Product Includes an Edit Button ([Click to view full-size image](handling-bll-and-dal-level-exceptions-vb/_static/image6.png))</span></span>


<span data-ttu-id="cfd84-136">В настоящее время "Изменить" только вызывает обратную передачу его t еще редактировать продукта.</span><span class="sxs-lookup"><span data-stu-id="cfd84-136">Currently, the Edit button only causes a postback it doesn t yet make the product editable.</span></span> <span data-ttu-id="cfd84-137">Чтобы включить редактирование, необходимо создать обработчики событий для элементов управления DataList s `EditCommand`, `CancelCommand`, и `UpdateCommand` события.</span><span class="sxs-lookup"><span data-stu-id="cfd84-137">To enable editing, we need to create event handlers for the DataList s `EditCommand`, `CancelCommand`, and `UpdateCommand` events.</span></span> <span data-ttu-id="cfd84-138">`EditCommand` И `CancelCommand` события просто обновить DataList s `EditItemIndex` свойство и повторную привязку данных к элементу управления DataList:</span><span class="sxs-lookup"><span data-stu-id="cfd84-138">The `EditCommand` and `CancelCommand` events simply update the DataList s `EditItemIndex` property and rebind the data to the DataList:</span></span>


[!code-vb[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample2.vb)]

<span data-ttu-id="cfd84-139">`UpdateCommand` Обработчик событий — немного сложнее.</span><span class="sxs-lookup"><span data-stu-id="cfd84-139">The `UpdateCommand` event handler is a bit more involved.</span></span> <span data-ttu-id="cfd84-140">Его требуется считать продукта s `ProductID` из `DataKeys` коллекции, а также s имя и цену продукта из текстовых полей в `EditItemTemplate`, а затем вызвать `ProductsBLL` класс s `UpdateProduct` метод перед возвратом управления DataList в состояние до редактирования.</span><span class="sxs-lookup"><span data-stu-id="cfd84-140">It needs to read in the edited product s `ProductID` from the `DataKeys` collection along with the product s name and price from the TextBoxes in the `EditItemTemplate`, and then call the `ProductsBLL` class s `UpdateProduct` method before returning the DataList to its pre-editing state.</span></span>

<span data-ttu-id="cfd84-141">Теперь позволяют s просто использовать точный код из `UpdateCommand` обработчик событий в *обзор редактирования и удаления данных в DataList* руководства.</span><span class="sxs-lookup"><span data-stu-id="cfd84-141">For now, let s just use the exact same code from the `UpdateCommand` event handler in the *Overview of Editing and Deleting Data in the DataList* tutorial.</span></span> <span data-ttu-id="cfd84-142">Мы добавим код для правильной обработки исключений на шаге 2.</span><span class="sxs-lookup"><span data-stu-id="cfd84-142">We'll add the code to gracefully handle exceptions in step 2.</span></span>


[!code-vb[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample3.vb)]

<span data-ttu-id="cfd84-143">При возникновении недопустимые входные данные которой может быть в форме созданию неправильно отформатированного цена, значение цены Недопустимая единица, например - 5,00 долл. США или заменяют s название продукта, возникает исключение.</span><span class="sxs-lookup"><span data-stu-id="cfd84-143">In the face of invalid input which can be in the form of an improperly formatted unit price, an illegal unit price value like -$5.00, or the omission of the product s name an exception will be raised.</span></span> <span data-ttu-id="cfd84-144">Так как `UpdateCommand` обработчик событий не включает любой код на этом этапе обработки исключений, исключение будет передано до среды выполнения ASP.NET, где он будет отображаться для конечного пользователя (см. рис. 3).</span><span class="sxs-lookup"><span data-stu-id="cfd84-144">Since the `UpdateCommand` event handler does not include any exception handling code at this point, the exception will bubble up to the ASP.NET runtime, where it will be displayed to the end user (see Figure 3).</span></span>


![При возникновении необработанного исключения, конечный пользователь видит страницу ошибки](handling-bll-and-dal-level-exceptions-vb/_static/image7.png)

<span data-ttu-id="cfd84-146">**Рис. 3**: При возникновении необработанного исключения, конечный пользователь видит страницу ошибки</span><span class="sxs-lookup"><span data-stu-id="cfd84-146">**Figure 3**: When an Unhandled Exception Occurs, the End User Sees an Error Page</span></span>


## <a name="step-2-gracefully-handling-exceptions-in-the-updatecommand-event-handler"></a><span data-ttu-id="cfd84-147">Шаг 2. Аккуратная обработка исключений в обработчике событий UpdateCommand</span><span class="sxs-lookup"><span data-stu-id="cfd84-147">Step 2: Gracefully Handling Exceptions in the UpdateCommand Event Handler</span></span>

<span data-ttu-id="cfd84-148">Во время обновления рабочего процесса, исключения могут возникать в `UpdateCommand` обработчик событий, BLL и DAL.</span><span class="sxs-lookup"><span data-stu-id="cfd84-148">During the updating workflow, exceptions can occur in the `UpdateCommand` event handler, the BLL, or the DAL.</span></span> <span data-ttu-id="cfd84-149">Например, если пользователь вводит цену слишком дорогим, `Decimal.Parse` инструкции в `UpdateCommand` обработчик событий вызывает исключение `FormatException` исключение.</span><span class="sxs-lookup"><span data-stu-id="cfd84-149">For example, if a user enters a price of Too expensive, the `Decimal.Parse` statement in the `UpdateCommand` event handler will throw a `FormatException` exception.</span></span> <span data-ttu-id="cfd84-150">Если пользователь опускает имя продукта s или цена имеет отрицательное значение, DAL будет выдано исключение.</span><span class="sxs-lookup"><span data-stu-id="cfd84-150">If the user omits the product s name or if the price has a negative value, the DAL will raise an exception.</span></span>

<span data-ttu-id="cfd84-151">При возникновении исключения, мы хотим вывода информационного сообщения внутри самой страницы.</span><span class="sxs-lookup"><span data-stu-id="cfd84-151">When an exception occurs, we want to display an informative message within the page itself.</span></span> <span data-ttu-id="cfd84-152">Добавление метки веб-элемент управления на страницу `ID` присваивается `ExceptionDetails`.</span><span class="sxs-lookup"><span data-stu-id="cfd84-152">Add a Label Web control to the page whose `ID` is set to `ExceptionDetails`.</span></span> <span data-ttu-id="cfd84-153">Настройка метки s текст, отображаемый в красный, очень большой, полужирного шрифта и курсива шрифта, назначив его `CssClass` свойства `Warning` класс CSS, который определен в `Styles.css` файл.</span><span class="sxs-lookup"><span data-stu-id="cfd84-153">Configure the Label s text to display in a red, extra-large, bold and italic font by assigning its `CssClass` property to the `Warning` CSS class, which is defined in the `Styles.css` file.</span></span>

<span data-ttu-id="cfd84-154">При возникновении ошибки, нам нужен только метки для отображения один раз.</span><span class="sxs-lookup"><span data-stu-id="cfd84-154">When an error occurs, we only want the Label to be displayed once.</span></span> <span data-ttu-id="cfd84-155">То есть при последующих обратных передачах метка s предупреждающее сообщение должно исчезнуть.</span><span class="sxs-lookup"><span data-stu-id="cfd84-155">That is, on subsequent postbacks, the Label s warning message should disappear.</span></span> <span data-ttu-id="cfd84-156">Это можно сделать, сняв out метка s `Text` свойства или параметры его `Visible` свойства `False` в `Page_Load` обработчик событий (как делалось в [обработка BLL и исключения уровня DAL в ASP Страница .NET](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md) руководстве) или путем отключения поддержки состояния представления метки s.</span><span class="sxs-lookup"><span data-stu-id="cfd84-156">This can be accomplished by either clearing out the Label s `Text` property or settings its `Visible` property to `False` in the `Page_Load` event handler (as we did back in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md) tutorial) or by disabling the Label s view state support.</span></span> <span data-ttu-id="cfd84-157">Разрешить использовать последний вариант s.</span><span class="sxs-lookup"><span data-stu-id="cfd84-157">Let s use the latter option.</span></span>


[!code-aspx[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample4.aspx)]

<span data-ttu-id="cfd84-158">При возникновении исключения, мы назначим подробности исключения, чтобы `ExceptionDetails` метки элемента управления s `Text` свойство.</span><span class="sxs-lookup"><span data-stu-id="cfd84-158">When an exception is raised, we'll assign the details of the exception to the `ExceptionDetails` Label control s `Text` property.</span></span> <span data-ttu-id="cfd84-159">Так как состояние просмотра отключено, при последующих обратных передачах `Text` свойство s программного изменения будут потеряны, действовавшие текст по умолчанию (пустая строка), таким образом скрывая предупреждающее сообщение.</span><span class="sxs-lookup"><span data-stu-id="cfd84-159">Since its view state is disabled, on subsequent postbacks the `Text` property s programmatic changes will be lost, reverting back to the default text (an empty string), thereby hiding the warning message.</span></span>

<span data-ttu-id="cfd84-160">Чтобы определить, когда возникает ошибка для отображения на странице отображается информационное сообщение, необходимо добавить `Try ... Catch` блок `UpdateCommand` обработчик событий.</span><span class="sxs-lookup"><span data-stu-id="cfd84-160">To determine when an error has been raised in order to display a helpful message on the page, we need to add a `Try ... Catch` block to the `UpdateCommand` event handler.</span></span> <span data-ttu-id="cfd84-161">`Try` Часть содержит код, который может привести к исключению, хотя `Catch` блок содержит код, выполняемый при возникновении исключения.</span><span class="sxs-lookup"><span data-stu-id="cfd84-161">The `Try` portion contains code that may lead to an exception, while the `Catch` block contains code that is executed in the face of an exception.</span></span> <span data-ttu-id="cfd84-162">Ознакомьтесь с [основы обработки исключений](https://msdn.microsoft.com/library/2w8f0bss.aspx) статьи в документации по .NET Framework, Дополнительные сведения о `Try ... Catch` блока.</span><span class="sxs-lookup"><span data-stu-id="cfd84-162">Check out the [Exception Handling Fundamentals](https://msdn.microsoft.com/library/2w8f0bss.aspx) section in the .NET Framework documentation for more information on the `Try ... Catch` block.</span></span>


[!code-vb[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample5.vb)]

<span data-ttu-id="cfd84-163">Когда любого типа, создается исключение внутри `Try` блока, `Catch` запускает выполнение кода блоков.</span><span class="sxs-lookup"><span data-stu-id="cfd84-163">When an exception of any type is thrown by code within the `Try` block, the `Catch` block s code will begin executing.</span></span> <span data-ttu-id="cfd84-164">Тип исключения, которое возникает `DbException`, `NoNullAllowedException`, `ArgumentException`и так далее, зависит, какие именно, ставшее причиной ошибки в первую очередь.</span><span class="sxs-lookup"><span data-stu-id="cfd84-164">The type of exception that is thrown `DbException`, `NoNullAllowedException`, `ArgumentException`, and so on depends on what, exactly, precipitated the error in the first place.</span></span> <span data-ttu-id="cfd84-165">Если там s проблемы на уровне базы данных, `DbException` будет создано.</span><span class="sxs-lookup"><span data-stu-id="cfd84-165">If there s a problem at the database level, a `DbException` will be thrown.</span></span> <span data-ttu-id="cfd84-166">Если указано недопустимое значение для `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, или `ReorderLevel` поля, `ArgumentException` будет создаваться, так как мы добавили код для проверки значения этих полей в `ProductsDataTable` класса (см. в разделе [ Создание уровня бизнес-логики](../introduction/creating-a-business-logic-layer-vb.md) руководстве).</span><span class="sxs-lookup"><span data-stu-id="cfd84-166">If an illegal value is entered for the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, or `ReorderLevel` fields, an `ArgumentException` will be thrown, as we added code to validate these field values in the `ProductsDataTable` class (see the [Creating a Business Logic Layer](../introduction/creating-a-business-logic-layer-vb.md) tutorial).</span></span>

<span data-ttu-id="cfd84-167">Мы предоставляем более полезные пояснения конечному пользователю на основе типа исключения, перехваченного текст сообщения.</span><span class="sxs-lookup"><span data-stu-id="cfd84-167">We can provide a more helpful explanation to the end user by basing the message text on the type of exception caught.</span></span> <span data-ttu-id="cfd84-168">Следующий код, который использовался в почти те же форму обратно в [обработка BLL и исключения уровня DAL на странице ASP.NET](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md) учебник такой уровень детализации:</span><span class="sxs-lookup"><span data-stu-id="cfd84-168">The following code which was used in a nearly identical form back in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md) tutorial provides this level of detail:</span></span>


[!code-vb[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample6.vb)]

<span data-ttu-id="cfd84-169">Для работы с этим руководством, просто вызовите `DisplayExceptionDetails` метода из `Catch` блок, передавая на Перехваченный `Exception` экземпляра (`ex`).</span><span class="sxs-lookup"><span data-stu-id="cfd84-169">To complete this tutorial, simply call the `DisplayExceptionDetails` method from the `Catch` block passing in the caught `Exception` instance (`ex`).</span></span>

<span data-ttu-id="cfd84-170">С помощью `Try ... Catch` блока в месте, пользователям предоставляется более подробное сообщение об ошибке, как рис. 4 и 5 show.</span><span class="sxs-lookup"><span data-stu-id="cfd84-170">With the `Try ... Catch` block in place, users are presented with a more informative error message, as Figures 4 and 5 show.</span></span> <span data-ttu-id="cfd84-171">Обратите внимание, что при возникновении исключения DataList остается в режиме редактирования.</span><span class="sxs-lookup"><span data-stu-id="cfd84-171">Note that in the face of an exception the DataList remains in edit mode.</span></span> <span data-ttu-id="cfd84-172">Это обусловлено тем, как только произойдет исключение, поток управления немедленно перенаправлены в `Catch` блока, минуя код, который возвращает состояние до редактирования элемента управления DataList.</span><span class="sxs-lookup"><span data-stu-id="cfd84-172">This is because once the exception occurs, the control flow is immediately redirected to the `Catch` block, bypassing the code that returns the DataList to its pre-editing state.</span></span>


[![A<span data-ttu-id="cfd84-173">n сообщение об ошибке отображается в том случае, когда пользователь опускает необходимые поля]</span><span class="sxs-lookup"><span data-stu-id="cfd84-173">n Error Message is Displayed if a User Omits a Required Field]</span></span>(handling-bll-and-dal-level-exceptions-vb/_static/image9.png)](handling-bll-and-dal-level-exceptions-vb/_static/image8.png)

<span data-ttu-id="cfd84-174">**Рис. 4**: Сообщение об ошибке отображается в том случае, когда пользователь опускает необходимые поля ([Просмотр полноразмерного изображения](handling-bll-and-dal-level-exceptions-vb/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="cfd84-174">**Figure 4**: An Error Message is Displayed if a User Omits a Required Field ([Click to view full-size image](handling-bll-and-dal-level-exceptions-vb/_static/image10.png))</span></span>


[![A<span data-ttu-id="cfd84-175">n сообщение об ошибке — это отображается при вводе отрицательное цена]</span><span class="sxs-lookup"><span data-stu-id="cfd84-175">n Error Message is Displayed When Entering a Negative Price]</span></span>(handling-bll-and-dal-level-exceptions-vb/_static/image12.png)](handling-bll-and-dal-level-exceptions-vb/_static/image11.png)

<span data-ttu-id="cfd84-176">**Рис. 5**: Сообщение об ошибке — отображаются при вводе отрицательное цены ([Просмотр полноразмерного изображения](handling-bll-and-dal-level-exceptions-vb/_static/image13.png))</span><span class="sxs-lookup"><span data-stu-id="cfd84-176">**Figure 5**: An Error Message is Displayed When Entering a Negative Price ([Click to view full-size image](handling-bll-and-dal-level-exceptions-vb/_static/image13.png))</span></span>


## <a name="summary"></a><span data-ttu-id="cfd84-177">Сводка</span><span class="sxs-lookup"><span data-stu-id="cfd84-177">Summary</span></span>

<span data-ttu-id="cfd84-178">GridView и ObjectDataSource предоставить обработчики событий последующего уровня, содержащие сведения о любые исключения, возникшие при выполнении рабочего процесса обновления и удаления, а также свойства, которые могут содержать значение, указывающее, было ли исключение обработано.</span><span class="sxs-lookup"><span data-stu-id="cfd84-178">The GridView and ObjectDataSource provide post-level event handlers that include information about any exceptions that were raised during the updating and deleting workflow, as well as properties that can be set to indicate whether or not the exception has been handled.</span></span> <span data-ttu-id="cfd84-179">Эти функции, однако, недоступны при работе с DataList и непосредственно с помощью BLL.</span><span class="sxs-lookup"><span data-stu-id="cfd84-179">These features, however, are unavailable when working with the DataList and using the BLL directly.</span></span> <span data-ttu-id="cfd84-180">Вместо этого мы отвечаете за реализацию обработку исключений.</span><span class="sxs-lookup"><span data-stu-id="cfd84-180">Instead, we are responsible for implementing exception handling.</span></span>

<span data-ttu-id="cfd84-181">В этом руководстве мы увидели, как добавить обработку исключений для редактируемых элементов управления DataList s обновление рабочего процесса с помощью добавления `Try ... Catch` блок `UpdateCommand` обработчик событий.</span><span class="sxs-lookup"><span data-stu-id="cfd84-181">In this tutorial we saw how to add exception handling to an editable DataList s updating workflow by adding a `Try ... Catch` block to the `UpdateCommand` event handler.</span></span> <span data-ttu-id="cfd84-182">Если исключение возникает во время обновления рабочего процесса, `Catch` блоков кода выполняется отображение полезную информацию в `ExceptionDetails` метки.</span><span class="sxs-lookup"><span data-stu-id="cfd84-182">If an exception is raised during the updating workflow, the `Catch` block s code executes, displaying helpful information in the `ExceptionDetails` Label.</span></span>

<span data-ttu-id="cfd84-183">На этом этапе DataList не пытается предотвратить исключений происходит в первую очередь.</span><span class="sxs-lookup"><span data-stu-id="cfd84-183">At this point, the DataList makes no effort to prevent exceptions from happening in the first place.</span></span> <span data-ttu-id="cfd84-184">Несмотря на то, что мы знаем, что приведет к отрицательным цена исключение, мы еще не добавили возможность заранее не позволяют пользователю вводить такие недопустимые входные данные.</span><span class="sxs-lookup"><span data-stu-id="cfd84-184">Even though we know that a negative price will result in an exception, we haven't yet added any functionality to proactively prevent a user from entering such invalid input.</span></span> <span data-ttu-id="cfd84-185">В нашем следующем учебном курсе мы рассмотрим способ смягчения исключения, вызванные недопустимый пользователя путем добавления элементов управления проверки в `EditItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="cfd84-185">In our next tutorial we'll see how to help reduce the exceptions caused by invalid user input by adding validation controls in the `EditItemTemplate`.</span></span>

<span data-ttu-id="cfd84-186">Счастливого вам программирования!</span><span class="sxs-lookup"><span data-stu-id="cfd84-186">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="cfd84-187">Дополнительные сведения</span><span class="sxs-lookup"><span data-stu-id="cfd84-187">Further Reading</span></span>

<span data-ttu-id="cfd84-188">Дополнительные сведения по темам, обсуждавшимся в этом руководстве см. в следующих ресурсах:</span><span class="sxs-lookup"><span data-stu-id="cfd84-188">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="cfd84-189">Правила разработки исключений</span><span class="sxs-lookup"><span data-stu-id="cfd84-189">Design Guidelines for Exceptions</span></span>](https://msdn.microsoft.com/library/ms298399.aspx)
- <span data-ttu-id="cfd84-190">[Ошибка ведения журнала модулей и обработчиков (ELMAH)](http://workspaces.gotdotnet.com/elmah) (библиотекой с открытым исходным кодом для ведения журнала ошибок)</span><span class="sxs-lookup"><span data-stu-id="cfd84-190">[Error Logging Modules and Handlers (ELMAH)](http://workspaces.gotdotnet.com/elmah) (an open-source library for logging errors)</span></span>
- <span data-ttu-id="cfd84-191">[Enterprise Library для .NET Framework 2.0](https://www.microsoft.com/downloads/details.aspx?familyid=5A14E870-406B-4F2A-B723-97BA84AE80B5&amp;displaylang=en) (включает Exception Management Application Block)</span><span class="sxs-lookup"><span data-stu-id="cfd84-191">[Enterprise Library for .NET Framework 2.0](https://www.microsoft.com/downloads/details.aspx?familyid=5A14E870-406B-4F2A-B723-97BA84AE80B5&amp;displaylang=en) (includes the Exception Management Application Block)</span></span>

## <a name="about-the-author"></a><span data-ttu-id="cfd84-192">Об авторе</span><span class="sxs-lookup"><span data-stu-id="cfd84-192">About the Author</span></span>

<span data-ttu-id="cfd84-193">[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи книг по ASP/ASP.NET и основатель веб- [4GuysFromRolla.com](http://www.4guysfromrolla.com), работает с веб-технологиями Microsoft с 1998 года.</span><span class="sxs-lookup"><span data-stu-id="cfd84-193">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="cfd84-194">Скотт — независимый консультант, преподаватель и автор.</span><span class="sxs-lookup"><span data-stu-id="cfd84-194">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="cfd84-195">Его последняя книга — [ *Sams Teach ASP.NET 2.0 in 24 часа*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="cfd84-195">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="cfd84-196">Ним можно связаться по адресу [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="cfd84-196">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="cfd84-197">или через его блог, который можно найти в [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="cfd84-197">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="cfd84-198">Особая благодарность</span><span class="sxs-lookup"><span data-stu-id="cfd84-198">Special Thanks To</span></span>

<span data-ttu-id="cfd84-199">В этой серии руководств пособий рецензировалась многими компетентными редакторами.</span><span class="sxs-lookup"><span data-stu-id="cfd84-199">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="cfd84-200">Основной рецензент этого учебного был Алексей Pespisa.</span><span class="sxs-lookup"><span data-stu-id="cfd84-200">Lead reviewer for this tutorial was Ken Pespisa.</span></span> <span data-ttu-id="cfd84-201">Хотите поработать с моих последующих статей для MSDN?</span><span class="sxs-lookup"><span data-stu-id="cfd84-201">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="cfd84-202">Если Да, напишите мне [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="cfd84-202">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="cfd84-203">[Назад](performing-batch-updates-vb.md)
> [Вперед](adding-validation-controls-to-the-datalist-s-editing-interface-vb.md)</span><span class="sxs-lookup"><span data-stu-id="cfd84-203">[Previous](performing-batch-updates-vb.md)
[Next](adding-validation-controls-to-the-datalist-s-editing-interface-vb.md)</span></span>
