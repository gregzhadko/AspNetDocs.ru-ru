---
uid: web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/an-overview-of-editing-and-deleting-data-in-the-datalist-vb
title: Общие сведения об изменении и удалении данных в DataList (VB) | Документация Майкрософт
author: rick-anderson
description: Хотя в DataList отсутствуют встроенные возможности редактирования и удаления, в этом учебнике будет показано, как создать элемент управления DataList, поддерживающий редактирование и удаление o...
ms.author: riande
ms.date: 10/30/2006
ms.assetid: 9410a23c-9697-4f07-bd71-e62b0ceac655
msc.legacyurl: /web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/an-overview-of-editing-and-deleting-data-in-the-datalist-vb
msc.type: authoredcontent
ms.openlocfilehash: 49b09cbf0f12f7c7233c3bb2a8b3b2c073bf117e
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78495246"
---
# <a name="an-overview-of-editing-and-deleting-data-in-the-datalist-vb"></a><span data-ttu-id="e30ed-103">Общие сведения об изменении и удалении данных в DataList (VB)</span><span class="sxs-lookup"><span data-stu-id="e30ed-103">An Overview of Editing and Deleting Data in the DataList (VB)</span></span>

<span data-ttu-id="e30ed-104">по [Скотт Митчелл](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="e30ed-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="e30ed-105">[Скачивание примера приложения](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_36_VB.exe) или [Загрузка PDF-файла](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/datatutorial36vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="e30ed-105">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_36_VB.exe) or [Download PDF](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/datatutorial36vb1.pdf)</span></span>

> <span data-ttu-id="e30ed-106">Хотя в DataList отсутствуют встроенные возможности редактирования и удаления, в этом учебнике будет показано, как создать элемент управления DataList, поддерживающий редактирование и удаление базовых данных.</span><span class="sxs-lookup"><span data-stu-id="e30ed-106">While the DataList lacks built-in editing and deleting capabilities, in this tutorial we'll see how to create a DataList that supports editing and deleting of its underlying data.</span></span>

## <a name="introduction"></a><span data-ttu-id="e30ed-107">Введение</span><span class="sxs-lookup"><span data-stu-id="e30ed-107">Introduction</span></span>

<span data-ttu-id="e30ed-108">В [обзоре руководства по вставке,](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md) обновлению и удалению данных мы рассматривали способы вставки, обновления и удаления данных с помощью архитектуры приложения, ObjectDataSource и элементов управления GridView, DetailsView и FormView.</span><span class="sxs-lookup"><span data-stu-id="e30ed-108">In the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md) tutorial we looked at how to insert, update, and delete data using the application architecture, an ObjectDataSource, and the GridView, DetailsView, and FormView controls.</span></span> <span data-ttu-id="e30ed-109">С помощью ObjectDataSource и этих трех веб-элементов управления данными реализация простых интерфейсов изменения данных была привязкой и вовлечением только пометки флажка из смарт-тега.</span><span class="sxs-lookup"><span data-stu-id="e30ed-109">With the ObjectDataSource and these three data Web controls, implementing simple data modification interfaces was a snap and involved merely ticking a checkbox from a smart tag.</span></span> <span data-ttu-id="e30ed-110">Не требуется написание кода.</span><span class="sxs-lookup"><span data-stu-id="e30ed-110">No code needed to be written.</span></span>

<span data-ttu-id="e30ed-111">К сожалению, в DataList отсутствуют встроенные возможности редактирования и удаления, присущие элементу управления GridView.</span><span class="sxs-lookup"><span data-stu-id="e30ed-111">Unfortunately, the DataList lacks the built-in editing and deleting capabilities inherent in the GridView control.</span></span> <span data-ttu-id="e30ed-112">Эта отсутствующая функциональность связана с тем, что DataList является Relic из предыдущей версии ASP.NET, когда декларативные элементы управления источниками данных и страницы изменения данных без кода были недоступны.</span><span class="sxs-lookup"><span data-stu-id="e30ed-112">This missing functionality is due in part to the fact that the DataList is a relic from the previous version of ASP.NET, when declarative data source controls and code-free data modification pages were unavailable.</span></span> <span data-ttu-id="e30ed-113">Хотя элемент управления DataList в ASP.NET 2,0 не предоставляет те же возможности модификации данных, что и GridView, мы можем использовать методы ASP.NET 1. x для включения таких функций.</span><span class="sxs-lookup"><span data-stu-id="e30ed-113">While the DataList in ASP.NET 2.0 does not offer the same out of the box data modification capabilities as the GridView, we can use ASP.NET 1.x techniques to include such functionality.</span></span> <span data-ttu-id="e30ed-114">Этот подход требует немного кода, но, как мы увидим в этом руководстве, в DataList есть некоторые события и свойства, помогающие в этом процессе.</span><span class="sxs-lookup"><span data-stu-id="e30ed-114">This approach requires a bit of code but, as we'll see in this tutorial, the DataList has some events and properties in place to aid in this process.</span></span>

<span data-ttu-id="e30ed-115">В этом учебнике мы посмотрим, как создать элемент управления DataList, поддерживающий редактирование и удаление базовых данных.</span><span class="sxs-lookup"><span data-stu-id="e30ed-115">In this tutorial we'll see how to create a DataList that supports editing and deleting of its underlying data.</span></span> <span data-ttu-id="e30ed-116">В следующих учебных курсах будут рассмотрены более сложные сценарии редактирования и удаления, включая проверку полей ввода, корректной обработки исключений, возникающих при доступе к данным или уровнях бизнес-логики, и т. д.</span><span class="sxs-lookup"><span data-stu-id="e30ed-116">Future tutorials will examine more advanced editing and deleting scenarios, including input field validation, gracefully handling exceptions raised from the Data Access or Business Logic Layers, and so on.</span></span>

> [!NOTE]
> <span data-ttu-id="e30ed-117">Как и в DataList, элемент управления Repeater не имеет функциональных возможностей для вставки, обновления или удаления.</span><span class="sxs-lookup"><span data-stu-id="e30ed-117">Like the DataList, the Repeater control lacks the out of the box functionality for inserting, updating, or deleting.</span></span> <span data-ttu-id="e30ed-118">Хотя эти функциональные возможности можно добавить, DataList включает в себя свойства и события, не найденные в элементе управления Repeater, что упрощает добавление таких возможностей.</span><span class="sxs-lookup"><span data-stu-id="e30ed-118">While such functionality can be added, the DataList includes properties and events not found in the Repeater that simplify adding such capabilities.</span></span> <span data-ttu-id="e30ed-119">Таким образом, в этом руководстве и будущих версиях, которые будут рассматриваться при редактировании и удалении, основное внимание уделяется только элементу управления DataList.</span><span class="sxs-lookup"><span data-stu-id="e30ed-119">Therefore, this tutorial and future ones that look at editing and deleting will focus strictly on the DataList.</span></span>

## <a name="step-1-creating-the-editing-and-deleting-tutorials-web-pages"></a><span data-ttu-id="e30ed-120">Шаг 1. Создание веб-страниц с учебниками по редактированию и удалению</span><span class="sxs-lookup"><span data-stu-id="e30ed-120">Step 1: Creating the Editing and Deleting Tutorials Web Pages</span></span>

<span data-ttu-id="e30ed-121">Прежде чем начать изучение процесса обновления и удаления данных из DataList, давайте сначала создадим страницы ASP.NET в нашем проекте веб-сайта, которые понадобятся для работы с этим руководством и следующих нескольких.</span><span class="sxs-lookup"><span data-stu-id="e30ed-121">Before we start exploring how to update and delete data from a DataList, let s first take a moment to create the ASP.NET pages in our website project that we'll need for this tutorial and the next several ones.</span></span> <span data-ttu-id="e30ed-122">Для начала добавьте новую папку с именем `EditDeleteDataList`.</span><span class="sxs-lookup"><span data-stu-id="e30ed-122">Start by adding a new folder named `EditDeleteDataList`.</span></span> <span data-ttu-id="e30ed-123">Затем добавьте в эту папку следующие страницы ASP.NET, чтобы связать каждую страницу с главной страницей `Site.master`:</span><span class="sxs-lookup"><span data-stu-id="e30ed-123">Next, add the following ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `Basics.aspx`
- `BatchUpdate.aspx`
- `ErrorHandling.aspx`
- `UIValidation.aspx`
- `CustomizedUI.aspx`
- `OptimisticConcurrency.aspx`
- `ConfirmationOnDelete.aspx`
- `UserLevelAccess.aspx`

![Добавление страниц ASP.NET для учебников](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image1.png)

<span data-ttu-id="e30ed-125">**Рис. 1**. добавление страниц ASP.NET для учебников</span><span class="sxs-lookup"><span data-stu-id="e30ed-125">**Figure 1**: Add the ASP.NET Pages for the Tutorials</span></span>

<span data-ttu-id="e30ed-126">Как и в других папках, `Default.aspx` в папке `EditDeleteDataList` приводится список руководств в его разделе.</span><span class="sxs-lookup"><span data-stu-id="e30ed-126">Like in the other folders, `Default.aspx` in the `EditDeleteDataList` folder lists the tutorials in its section.</span></span> <span data-ttu-id="e30ed-127">Вспомним, что `SectionLevelTutorialListing.ascx` пользовательский элемент управления предоставляет эти функции.</span><span class="sxs-lookup"><span data-stu-id="e30ed-127">Recall that the `SectionLevelTutorialListing.ascx` User Control provides this functionality.</span></span> <span data-ttu-id="e30ed-128">Таким образом, добавьте этот пользовательский элемент управления в `Default.aspx`, перетащив его из обозреватель решений на страницу s представление конструирования.</span><span class="sxs-lookup"><span data-stu-id="e30ed-128">Therefore, add this User Control to `Default.aspx` by dragging it from the Solution Explorer onto the page s Design view.</span></span>

<span data-ttu-id="e30ed-129">[![добавить пользовательский элемент управления SectionLevelTutorialListing. ascx в Default. aspx](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image3.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image2.png)</span><span class="sxs-lookup"><span data-stu-id="e30ed-129">[![Add the SectionLevelTutorialListing.ascx User Control to Default.aspx](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image3.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image2.png)</span></span>

<span data-ttu-id="e30ed-130">**Рис. 2**. Добавление пользовательского элемента управления `SectionLevelTutorialListing.ascx` в `Default.aspx` ([щелкните, чтобы просмотреть изображение с полным размером](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="e30ed-130">**Figure 2**: Add the `SectionLevelTutorialListing.ascx` User Control to `Default.aspx` ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image4.png))</span></span>

<span data-ttu-id="e30ed-131">Наконец, добавьте страницы в качестве записей в файл `Web.sitemap`.</span><span class="sxs-lookup"><span data-stu-id="e30ed-131">Lastly, add the pages as entries to the `Web.sitemap` file.</span></span> <span data-ttu-id="e30ed-132">В частности, добавьте следующую разметку после отчетов «основной/подробности» с элементом управления DataList и Repeater `<siteMapNode>`:</span><span class="sxs-lookup"><span data-stu-id="e30ed-132">Specifically, add the following markup after the Master/Detail Reports with the DataList and Repeater `<siteMapNode>`:</span></span>

[!code-xml[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/samples/sample1.xml)]

<span data-ttu-id="e30ed-133">После обновления `Web.sitemap`просмотрите веб-сайт учебников в браузере.</span><span class="sxs-lookup"><span data-stu-id="e30ed-133">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="e30ed-134">Меню слева теперь включает элементы для учебников по редактированию и удалению DataList.</span><span class="sxs-lookup"><span data-stu-id="e30ed-134">The menu on the left now includes items for the DataList editing and deleting tutorials.</span></span>

![На карте веб-узла теперь есть записи для учебников по редактированию и удалению DataList.](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image5.png)

<span data-ttu-id="e30ed-136">**Рис. 3**. схема узла теперь включает записи для учебников по редактированию и удалению DataList</span><span class="sxs-lookup"><span data-stu-id="e30ed-136">**Figure 3**: The Site Map Now Includes Entries for the DataList Editing and Deleting Tutorials</span></span>

## <a name="step-2-examining-techniques-for-updating-and-deleting-data"></a><span data-ttu-id="e30ed-137">Шаг 2. изучение методов обновления и удаления данных</span><span class="sxs-lookup"><span data-stu-id="e30ed-137">Step 2: Examining Techniques for Updating and Deleting Data</span></span>

<span data-ttu-id="e30ed-138">Редактирование и удаление данных с помощью GridView настолько просто, потому что, под ним, GridView и ObjectDataSource работают совместно.</span><span class="sxs-lookup"><span data-stu-id="e30ed-138">Editing and deleting data with the GridView is so easy because, underneath the covers, the GridView and ObjectDataSource work in concert.</span></span> <span data-ttu-id="e30ed-139">Как обсуждалось в разделе [изучение событий, связанных с руководством по вставке, обновлению и удалению](../editing-inserting-and-deleting-data/examining-the-events-associated-with-inserting-updating-and-deleting-cs.md) , при нажатии кнопки обновления строки GridView автоматически назначает поля, использующие двустороннюю привязку данных, в коллекцию `UpdateParameters` элемента ObjectDataSource, а затем вызывает этот метод `Update()` ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="e30ed-139">As discussed in the [Examining the Events Associated with Inserting, Updating, and Deleting](../editing-inserting-and-deleting-data/examining-the-events-associated-with-inserting-updating-and-deleting-cs.md) tutorial, when a row s Update button is clicked, the GridView automatically assigns its fields that used two-way databinding to the `UpdateParameters` collection of its ObjectDataSource and then invokes that ObjectDataSource s `Update()` method.</span></span>

<span data-ttu-id="e30ed-140">К сожалению, элемент управления DataList не предоставляет ни одной из этих встроенных функций.</span><span class="sxs-lookup"><span data-stu-id="e30ed-140">Sadly, the DataList does not provide any of this built-in functionality.</span></span> <span data-ttu-id="e30ed-141">Нашей обязанностью является обеспечение того, что значения пользователя присваиваются параметрам ObjectDataSource s и вызывается метод `Update()`.</span><span class="sxs-lookup"><span data-stu-id="e30ed-141">It is our responsibility to ensure that the user s values are assigned to the ObjectDataSource s parameters and that its `Update()` method is called.</span></span> <span data-ttu-id="e30ed-142">Чтобы помочь нам в этом, элемент управления DataList предоставляет следующие свойства и события:</span><span class="sxs-lookup"><span data-stu-id="e30ed-142">To aid us in this endeavor, the DataList provides the following properties and events:</span></span>

- <span data-ttu-id="e30ed-143">При обновлении или удалении **[Свойства`DataKeyField`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basedatalist.datakeyfield.aspx)** необходимо иметь возможность уникально идентифицировать каждый элемент в DataList.</span><span class="sxs-lookup"><span data-stu-id="e30ed-143">**The [`DataKeyField` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basedatalist.datakeyfield.aspx)** when updating or deleting, we need to be able to uniquely identify each item in the DataList.</span></span> <span data-ttu-id="e30ed-144">Присвойте этому свойству поле первичный ключ отображаемых данных.</span><span class="sxs-lookup"><span data-stu-id="e30ed-144">Set this property to the primary key field of the displayed data.</span></span> <span data-ttu-id="e30ed-145">Это приведет к заполнению [коллекции`DataKeys`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basedatalist.datakeys.aspx) DataList с указанным `DataKeyField` значением для каждого элемента DataList.</span><span class="sxs-lookup"><span data-stu-id="e30ed-145">Doing so will populate the DataList s [`DataKeys` collection](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basedatalist.datakeys.aspx) with the specified `DataKeyField` value for each DataList item.</span></span>
- <span data-ttu-id="e30ed-146">**[Событие`EditCommand`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.editcommand.aspx)** срабатывает при нажатии кнопки, LinkButton или ImageButton, свойство `CommandName` которого имеет значение Edit.</span><span class="sxs-lookup"><span data-stu-id="e30ed-146">**The [`EditCommand` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.editcommand.aspx)** fires when a Button, LinkButton, or ImageButton whose `CommandName` property is set to Edit is clicked.</span></span>
- <span data-ttu-id="e30ed-147">**[Событие`CancelCommand`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.cancelcommand.aspx)** срабатывает при нажатии кнопки, LinkButton или ImageButton, свойство `CommandName` которого имеет значение Cancel.</span><span class="sxs-lookup"><span data-stu-id="e30ed-147">**The [`CancelCommand` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.cancelcommand.aspx)** fires when a Button, LinkButton, or ImageButton whose `CommandName` property is set to Cancel is clicked.</span></span>
- <span data-ttu-id="e30ed-148">**[Событие`UpdateCommand`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.updatecommand.aspx)** срабатывает при нажатии кнопки, LinkButton или ImageButton, свойство `CommandName` которого имеет значение Update.</span><span class="sxs-lookup"><span data-stu-id="e30ed-148">**The [`UpdateCommand` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.updatecommand.aspx)** fires when a Button, LinkButton, or ImageButton whose `CommandName` property is set to Update is clicked.</span></span>
- <span data-ttu-id="e30ed-149">**[Событие`DeleteCommand`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.deletecommand.aspx)** срабатывает при нажатии кнопки, LinkButton или ImageButton, свойство `CommandName` которого имеет значение Delete.</span><span class="sxs-lookup"><span data-stu-id="e30ed-149">**The [`DeleteCommand` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.deletecommand.aspx)** fires when a Button, LinkButton, or ImageButton whose `CommandName` property is set to Delete is clicked.</span></span>

<span data-ttu-id="e30ed-150">Используя эти свойства и события, можно использовать четыре подхода для обновления и удаления данных из DataList:</span><span class="sxs-lookup"><span data-stu-id="e30ed-150">Using these properties and events, there are four approaches we can use to update and delete data from the DataList:</span></span>

1. <span data-ttu-id="e30ed-151">**С помощью методик ASP.NET 1. x** элемент управления DataList существовал до ASP.NET 2,0 и objectdatasources и мог полностью обновлять и удалять данные с помощью программных средств.</span><span class="sxs-lookup"><span data-stu-id="e30ed-151">**Using ASP.NET 1.x Techniques** the DataList existed prior to ASP.NET 2.0 and ObjectDataSources and was able to update and delete data entirely through programmatic means.</span></span> <span data-ttu-id="e30ed-152">Этот метод дитчес ObjectDataSource полностью и требует, чтобы мы привязали данные к DataList непосредственно из уровня бизнес-логики, как при получении данных для просмотра, так и при обновлении или удалении записи.</span><span class="sxs-lookup"><span data-stu-id="e30ed-152">This technique ditches the ObjectDataSource altogether and requires that we bind the data to the DataList directly from the Business Logic Layer, both in retrieving the data to display and when updating or deleting a record.</span></span>
2. <span data-ttu-id="e30ed-153">**С помощью одного элемента управления ObjectDataSource на странице для выбора, обновления и удаления** в то время как в DataList отсутствуют возможности редактирования и удаления GridView, нет причин, по которым мы не можем сами добавить их.</span><span class="sxs-lookup"><span data-stu-id="e30ed-153">**Using a Single ObjectDataSource Control on the Page for Selecting, Updating, and Deleting** while the DataList lacks the GridView s inherent editing and deleting capabilities, there s no reason we can t add them in ourselves.</span></span> <span data-ttu-id="e30ed-154">При таком подходе мы используем ObjectDataSource, как в примерах GridView, но должны создать обработчик для события `UpdateCommand` DataList, где мы устанавливаем параметры ObjectDataSource s и вызываем его метод `Update()`.</span><span class="sxs-lookup"><span data-stu-id="e30ed-154">With this approach, we use an ObjectDataSource just like in the GridView examples, but must create an event handler for the DataList s `UpdateCommand` event where we set the ObjectDataSource s parameters and call its `Update()` method.</span></span>
3. <span data-ttu-id="e30ed-155">**Используя элемент управления ObjectDataSource для выбора, но обновления и удаления непосредственно для BLL** при использовании варианта 2, нам нужно написать фрагмент кода в событии `UpdateCommand`, назначив значения параметров и т. д.</span><span class="sxs-lookup"><span data-stu-id="e30ed-155">**Using an ObjectDataSource Control for Selecting, but Updating and Deleting Directly Against the BLL** when using option 2, we need to write a bit of code in the `UpdateCommand` event, assigning parameter values and so on.</span></span> <span data-ttu-id="e30ed-156">Вместо этого мы можем придерживаться использования ObjectDataSource для выбора, но выполнять обновление и удаление вызовов непосредственно для слоя BLL (например, с параметром 1).</span><span class="sxs-lookup"><span data-stu-id="e30ed-156">Instead, we can stick with using the ObjectDataSource for selecting, but make the updating and deleting calls directly against the BLL (like with option 1).</span></span> <span data-ttu-id="e30ed-157">По моему мнению, обновление данных путем взаимодействия непосредственно с BLL приводит к более удобочитаемому коду, чем назначение ObjectDataSource `UpdateParameters` и вызов метода `Update()`.</span><span class="sxs-lookup"><span data-stu-id="e30ed-157">In my opinion, updating data by interfacing directly with the BLL leads to more readable code than assigning the ObjectDataSource s `UpdateParameters` and calling its `Update()` method.</span></span>
4. <span data-ttu-id="e30ed-158">**Использование декларативных средств** с помощью нескольких элементов ObjectDataSource в предыдущих трех подходах требует немного кода.</span><span class="sxs-lookup"><span data-stu-id="e30ed-158">**Using Declarative Means through Multiple ObjectDataSources** the previous three approaches all require a bit of code.</span></span> <span data-ttu-id="e30ed-159">Если вы предпочитаете использовать как можно больше декларативного синтаксиса, последний вариант — включить несколько ObjectDataSource на странице.</span><span class="sxs-lookup"><span data-stu-id="e30ed-159">If you d rather keep using as much declarative syntax as possible, a final option is to include multiple ObjectDataSources on the page.</span></span> <span data-ttu-id="e30ed-160">Первый элемент управления ObjectDataSource извлекает данные из слоя BLL и привязывает их к DataList.</span><span class="sxs-lookup"><span data-stu-id="e30ed-160">The first ObjectDataSource retrieves the data from the BLL and binds it to the DataList.</span></span> <span data-ttu-id="e30ed-161">Для обновления добавляется другой элемент управления ObjectDataSource, который добавляется непосредственно в `EditItemTemplate`DataList s.</span><span class="sxs-lookup"><span data-stu-id="e30ed-161">For updating, another ObjectDataSource is added, but added directly within the DataList s `EditItemTemplate`.</span></span> <span data-ttu-id="e30ed-162">Чтобы включить поддержку удаления, в `ItemTemplate`потребуется еще один элемент ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="e30ed-162">To include deleting support, yet another ObjectDataSource would be needed in the `ItemTemplate`.</span></span> <span data-ttu-id="e30ed-163">При таком подходе эти внедренные элементы ObjectDataSource используют `ControlParameters` для декларативной привязки параметров ObjectDataSource s к элементам управления вводом данных пользователя (вместо того, чтобы указывать их программным способом в обработчике событий DataList `UpdateCommand`).</span><span class="sxs-lookup"><span data-stu-id="e30ed-163">With this approach, these embedded ObjectDataSource s use `ControlParameters` to declaratively bind the ObjectDataSource s parameters to the user input controls (rather than having to specify them programmatically in the DataList s `UpdateCommand` event handler).</span></span> <span data-ttu-id="e30ed-164">Этот подход по-прежнему требует фрагмента кода, который нам нужно вызвать с помощью внедренного `Update()` или `Delete()` команды ObjectDataSource, но требуется гораздо меньше, чем в других трех подходах.</span><span class="sxs-lookup"><span data-stu-id="e30ed-164">This approach still requires a bit of code we need to call the embedded ObjectDataSource s `Update()` or `Delete()` command but requires far less than with the other three approaches.</span></span> <span data-ttu-id="e30ed-165">Недостаток этого подхода состоит в том, что несколько фрагментов ObjectDataSource могут перегружать страницу, отменяя общую удобочитаемость.</span><span class="sxs-lookup"><span data-stu-id="e30ed-165">The downside here is that the multiple ObjectDataSources do clutter up the page, detracting from the overall readability.</span></span>

<span data-ttu-id="e30ed-166">Если принудительно использовать один из этих подходов, я использую вариант 1, так как он обеспечивает наибольшую гибкость и так как элемент управления DataList изначально разрабатывался для поддержки этого шаблона.</span><span class="sxs-lookup"><span data-stu-id="e30ed-166">If forced to only ever use one of these approaches, I d choose option 1 because it provides the most flexibility and because the DataList was originally designed to accommodate this pattern.</span></span> <span data-ttu-id="e30ed-167">Хотя элемент DataList был расширен для работы с элементами управления источниками данных ASP.NET 2,0, он не обладает всеми точками расширения или функциями официальных веб-элементов управления ASP.NET 2,0 (GridView, DetailsView и FormView).</span><span class="sxs-lookup"><span data-stu-id="e30ed-167">While the DataList was extended to work with the ASP.NET 2.0 data source controls, it does not have all of the extensibility points or features of the official ASP.NET 2.0 data Web controls (the GridView, DetailsView, and FormView).</span></span> <span data-ttu-id="e30ed-168">Однако варианты 2 – 4 не имеют.</span><span class="sxs-lookup"><span data-stu-id="e30ed-168">Options 2 through 4 are not without merit, though.</span></span>

<span data-ttu-id="e30ed-169">В этом и будущих руководствах по редактированию и удалению будет использоваться элемент управления ObjectDataSource для получения данных, которые будут отображаться, и прямые вызовы BLL для обновления и удаления данных (вариант 3).</span><span class="sxs-lookup"><span data-stu-id="e30ed-169">This and the future editing and deleting tutorials will use an ObjectDataSource for retrieving the data to display and direct calls to the BLL to update and delete data (option 3).</span></span>

## <a name="step-3-adding-the-datalist-and-configuring-its-objectdatasource"></a><span data-ttu-id="e30ed-170">Шаг 3. Добавление элемента управления DataList и настройка его элемента управления ObjectDataSource</span><span class="sxs-lookup"><span data-stu-id="e30ed-170">Step 3: Adding the DataList and Configuring its ObjectDataSource</span></span>

<span data-ttu-id="e30ed-171">В этом учебнике мы создадим элемент управления DataList, который содержит сведения о продукте, и для каждого продукта предоставляет пользователю возможность изменить имя и цену, а также удалить продукт полностью.</span><span class="sxs-lookup"><span data-stu-id="e30ed-171">In this tutorial we will create a DataList that lists product information and, for each product, provides the user the ability to edit the name and price and to delete the product altogether.</span></span> <span data-ttu-id="e30ed-172">В частности, мы извлекаем записи, которые будут отображаться с помощью элемента управления ObjectDataSource, но выполняют операции обновления и удаления путем взаимодействия непосредственно с BLL.</span><span class="sxs-lookup"><span data-stu-id="e30ed-172">In particular, we will retrieve the records to display using an ObjectDataSource, but perform the update and delete actions by interfacing directly with the BLL.</span></span> <span data-ttu-id="e30ed-173">Прежде чем беспокоиться о реализации возможностей редактирования и удаления в DataList, давайте сначала создадим страницу, чтобы отобразить продукты в интерфейсе только для чтения.</span><span class="sxs-lookup"><span data-stu-id="e30ed-173">Before we worry about implementing the editing and deleting capabilities to the DataList, let s first get the page to display the products in a read-only interface.</span></span> <span data-ttu-id="e30ed-174">Так как мы проверили эти действия в предыдущих руководствах, я продолжу их быстро.</span><span class="sxs-lookup"><span data-stu-id="e30ed-174">Since we ve examined these steps in previous tutorials, I'll proceed through them quickly.</span></span>

<span data-ttu-id="e30ed-175">Для начала откройте страницу `Basics.aspx` в папке `EditDeleteDataList` и в представление конструирования добавьте элемент управления DataList на страницу.</span><span class="sxs-lookup"><span data-stu-id="e30ed-175">Start by opening the `Basics.aspx` page in the `EditDeleteDataList` folder and, from the Design view, add a DataList to the page.</span></span> <span data-ttu-id="e30ed-176">Затем в смарт-теге DataList создайте новый элемент управления ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="e30ed-176">Next, from the DataList s smart tag, create a new ObjectDataSource.</span></span> <span data-ttu-id="e30ed-177">Так как мы работаем с данными продуктов, настройте его для использования класса `ProductsBLL`.</span><span class="sxs-lookup"><span data-stu-id="e30ed-177">Since we are working with product data, configure it to use the `ProductsBLL` class.</span></span> <span data-ttu-id="e30ed-178">Чтобы получить *все* продукты, выберите метод `GetProducts()` на вкладке Выбор.</span><span class="sxs-lookup"><span data-stu-id="e30ed-178">To retrieve *all* products, choose the `GetProducts()` method in the SELECT tab.</span></span>

<span data-ttu-id="e30ed-179">[![настроить ObjectDataSource для использования класса ProductsBLL](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image7.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image6.png)</span><span class="sxs-lookup"><span data-stu-id="e30ed-179">[![Configure the ObjectDataSource to Use the ProductsBLL Class](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image7.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image6.png)</span></span>

<span data-ttu-id="e30ed-180">**Рис. 4**. Настройка ObjectDataSource для использования класса `ProductsBLL` ([щелкните, чтобы просмотреть изображение с полным размером](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="e30ed-180">**Figure 4**: Configure the ObjectDataSource to Use the `ProductsBLL` Class ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image8.png))</span></span>

<span data-ttu-id="e30ed-181">[![получить сведения о продукте с помощью метода WebMethod ()](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image10.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="e30ed-181">[![Return the Product Information Using the GetProducts() Method](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image10.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image9.png)</span></span>

<span data-ttu-id="e30ed-182">**Рис. 5**. Возврат сведений о продукте с помощью метода `GetProducts()` ([щелкните, чтобы просмотреть изображение с полным размером](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image11.png))</span><span class="sxs-lookup"><span data-stu-id="e30ed-182">**Figure 5**: Return the Product Information Using the `GetProducts()` Method ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image11.png))</span></span>

<span data-ttu-id="e30ed-183">Элемент управления DataList, как и GridView, не предназначен для вставки новых данных; Поэтому выберите параметр (нет) в раскрывающемся списке на вкладке Вставка. Также выберите (нет) для вкладок обновления и удаления, так как обновления и удаления будут выполняться программно с помощью слоя BLL.</span><span class="sxs-lookup"><span data-stu-id="e30ed-183">The DataList, like the GridView, is not designed for inserting new data; therefore, select the (None) option from the drop-down list in the INSERT tab. Also choose (None) for the UPDATE and DELETE tabs since the updates and deletes will be performed programmatically through the BLL.</span></span>

<span data-ttu-id="e30ed-184">[![убедиться, что в раскрывающихся списках на вкладках вставки, обновления и удаления ObjectDataSource s задано значение (нет)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image13.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image12.png)</span><span class="sxs-lookup"><span data-stu-id="e30ed-184">[![Confirm that the Drop-Down Lists in the ObjectDataSource s INSERT, UPDATE, and DELETE Tabs are Set to (None)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image13.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image12.png)</span></span>

<span data-ttu-id="e30ed-185">**Рис. 6**. Убедитесь, что в раскрывающихся списках на вкладках вставки, обновления и удаления элемента управления ObjectDataSource задано значение (нет) ([щелкните, чтобы просмотреть изображение с полным размером](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="e30ed-185">**Figure 6**: Confirm that the Drop-Down Lists in the ObjectDataSource s INSERT, UPDATE, and DELETE Tabs are Set to (None) ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image14.png))</span></span>

<span data-ttu-id="e30ed-186">После настройки элемента управления ObjectDataSource нажмите кнопку Готово, чтобы вернуться в конструктор.</span><span class="sxs-lookup"><span data-stu-id="e30ed-186">After configuring the ObjectDataSource, click Finish, returning to the Designer.</span></span> <span data-ttu-id="e30ed-187">Как мы видели в прошлых примерах, при завершении настройки ObjectDataSource Visual Studio автоматически создает `ItemTemplate` для DropDownList, отображая все поля данных.</span><span class="sxs-lookup"><span data-stu-id="e30ed-187">As we ve seen in past examples, when completing the ObjectDataSource configuration, Visual Studio automatically creates an `ItemTemplate` for the DropDownList, displaying each of the data fields.</span></span> <span data-ttu-id="e30ed-188">Замените этот `ItemTemplate` на, отображающий только название и цену продукта.</span><span class="sxs-lookup"><span data-stu-id="e30ed-188">Replace this `ItemTemplate` with one that displays only the product s name and price.</span></span> <span data-ttu-id="e30ed-189">Кроме того, задайте для свойства `RepeatColumns` значение 2.</span><span class="sxs-lookup"><span data-stu-id="e30ed-189">Also, set the `RepeatColumns` property to 2.</span></span>

> [!NOTE]
> <span data-ttu-id="e30ed-190">Как обсуждалось в *обзоре руководства по вставке, обновлению и удалению данных* при изменении данных с помощью ObjectDataSource нашей архитектуры, необходимо удалить свойство `OldValuesParameterFormatString` из декларативной разметки ObjectDataSource (или сбросить его до значения по умолчанию `{0}`).</span><span class="sxs-lookup"><span data-stu-id="e30ed-190">As discussed in the *Overview of Inserting, Updating, and Deleting Data* tutorial, when modifying data using the ObjectDataSource our architecture requires that we remove the `OldValuesParameterFormatString` property from the ObjectDataSource s declarative markup (or reset it to its default value, `{0}`).</span></span> <span data-ttu-id="e30ed-191">Однако в этом руководстве мы используем ObjectDataSource только для извлечения данных.</span><span class="sxs-lookup"><span data-stu-id="e30ed-191">In this tutorial, however, we are using the ObjectDataSource only for retrieving data.</span></span> <span data-ttu-id="e30ed-192">Поэтому не нужно изменять значение свойства ObjectDataSource `OldValuesParameterFormatString` (хотя это не имеет вреда).</span><span class="sxs-lookup"><span data-stu-id="e30ed-192">Therefore, we do not need to modify the ObjectDataSource s `OldValuesParameterFormatString` property value (although it doesn t hurt to do so).</span></span>

<span data-ttu-id="e30ed-193">После замены `ItemTemplate` DataList, настроенного по умолчанию, декларативная разметка на странице должна выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="e30ed-193">After replacing the default DataList `ItemTemplate` with a customized one, the declarative markup on your page should look similar to the following:</span></span>

[!code-aspx[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/samples/sample2.aspx)]

<span data-ttu-id="e30ed-194">Уделите время для просмотра хода выполнения в браузере.</span><span class="sxs-lookup"><span data-stu-id="e30ed-194">Take a moment to view our progress through a browser.</span></span> <span data-ttu-id="e30ed-195">Как показано на рис. 7, в DataList отображается название продукта и цена за единицу для каждого продукта в двух столбцах.</span><span class="sxs-lookup"><span data-stu-id="e30ed-195">As Figure 7 shows, the DataList displays the product name and unit price for each product in two columns.</span></span>

<span data-ttu-id="e30ed-196">[![названия и цены продуктов отображаются в DataList с двумя столбцами.](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image16.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="e30ed-196">[![The Products Names and Prices are Displayed in a Two-Column DataList](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image16.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image15.png)</span></span>

<span data-ttu-id="e30ed-197">**Рис. 7**. названия и цены продуктов отображаются в DataList с двумя столбцами ([щелкните, чтобы просмотреть изображение с полным размером](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image17.png)).</span><span class="sxs-lookup"><span data-stu-id="e30ed-197">**Figure 7**: The Products Names and Prices are Displayed in a Two-Column DataList ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image17.png))</span></span>

> [!NOTE]
> <span data-ttu-id="e30ed-198">Элемент управления DataList имеет ряд свойств, необходимых для процесса обновления и удаления, и эти значения хранятся в состоянии представления.</span><span class="sxs-lookup"><span data-stu-id="e30ed-198">The DataList has a number of properties that are required for the updating and deleting process, and these values are stored in view state.</span></span> <span data-ttu-id="e30ed-199">Поэтому при создании элемента управления DataList, поддерживающего редактирование или удаление данных, необходимо включить состояние представления DataList.</span><span class="sxs-lookup"><span data-stu-id="e30ed-199">Therefore, when building a DataList that supports editing or deleting data, it is essential that the DataList s view state be enabled.</span></span>  
>   
> <span data-ttu-id="e30ed-200">Читатель внимательный может вспомнить, что мы смогли отключить состояние представления при создании редактируемых элементов управления GridView, DetailsView и FormView.</span><span class="sxs-lookup"><span data-stu-id="e30ed-200">The astute reader may recall that we were able to disable view state when creating editable GridViews, DetailsViews, and FormViews.</span></span> <span data-ttu-id="e30ed-201">Это связано с тем, что веб-элементы управления ASP.NET 2,0 могут включать в себя *состояние элемента управления*, которое сохраняется во всех обратных передачах, таких как состояние представления, но было признано необходимым.</span><span class="sxs-lookup"><span data-stu-id="e30ed-201">This is because ASP.NET 2.0 Web controls can include *control state*, which is state persisted across postbacks like view state, but deemed essential.</span></span>

<span data-ttu-id="e30ed-202">Отключение состояния представления в GridView просто опускает сведения об тривиальных состояниях, но поддерживает состояние элемента управления (включая состояние, необходимое для изменения и удаления).</span><span class="sxs-lookup"><span data-stu-id="e30ed-202">Disabling view state in the GridView merely omits trivial state information, but maintains the control state (which includes the state necessary for editing and deleting).</span></span> <span data-ttu-id="e30ed-203">Элемент управления DataList, созданный в интервале ASP.NET 1. x, не использует состояние контроля и поэтому должен иметь включенное состояние представления.</span><span class="sxs-lookup"><span data-stu-id="e30ed-203">The DataList, having been created in the ASP.NET 1.x timeframe, does not utilize control state and therefore must have view state enabled.</span></span> <span data-ttu-id="e30ed-204">Дополнительные сведения о назначении состояния элемента управления и его отличии от состояния представления см. в разделе [состояние элемента управления и состояние просмотра](https://msdn.microsoft.com/library/1whwt1k7.aspx) .</span><span class="sxs-lookup"><span data-stu-id="e30ed-204">See [Control State vs. View State](https://msdn.microsoft.com/library/1whwt1k7.aspx) for more information on the purpose of control state and how it differs from view state.</span></span>

## <a name="step-4-adding-an-editing-user-interface"></a><span data-ttu-id="e30ed-205">Шаг 4. Добавление пользовательского интерфейса редактирования</span><span class="sxs-lookup"><span data-stu-id="e30ed-205">Step 4: Adding an Editing User Interface</span></span>

<span data-ttu-id="e30ed-206">Элемент управления GridView состоит из коллекции полей (BoundFields, Чеккбоксфиелдс, полей TemplateField и т. д.).</span><span class="sxs-lookup"><span data-stu-id="e30ed-206">The GridView control is composed of a collection of fields (BoundFields, CheckBoxFields, TemplateFields, and so on).</span></span> <span data-ttu-id="e30ed-207">Эти поля могут изменять отображаемую разметку в зависимости от их режима.</span><span class="sxs-lookup"><span data-stu-id="e30ed-207">These fields can adjust their rendered markup depending on their mode.</span></span> <span data-ttu-id="e30ed-208">Например, в режиме только для чтения BoundField отображает значение поля данных в виде текста. в режиме редактирования он отображает веб-элемент управления TextBox, свойство `Text` которого присваивает значение поля данных.</span><span class="sxs-lookup"><span data-stu-id="e30ed-208">For example, when in read-only mode, a BoundField displays its data field value as text; when in edit mode, it renders a TextBox Web control whose `Text` property is assigned the data field value.</span></span>

<span data-ttu-id="e30ed-209">С другой стороны, элемент управления DataList отображает свои элементы с помощью шаблонов.</span><span class="sxs-lookup"><span data-stu-id="e30ed-209">The DataList, on the other hand, renders its items using templates.</span></span> <span data-ttu-id="e30ed-210">Элементы, доступные только для чтения, подготавливаются с помощью `ItemTemplate` в то время как элементы в режиме редактирования подготавливаются к просмотру с помощью `EditItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="e30ed-210">Read-only items are rendered using the `ItemTemplate` whereas items in edit mode are rendered via the `EditItemTemplate`.</span></span> <span data-ttu-id="e30ed-211">На этом этапе у нашего DataList есть только `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="e30ed-211">At this point, our DataList has only an `ItemTemplate`.</span></span> <span data-ttu-id="e30ed-212">Для поддержки функций редактирования на уровне элементов необходимо добавить `EditItemTemplate`, содержащий разметку, отображаемую для редактируемого элемента.</span><span class="sxs-lookup"><span data-stu-id="e30ed-212">To support item-level editing functionality we need to add an `EditItemTemplate` that contains the markup to be displayed for the editable item.</span></span> <span data-ttu-id="e30ed-213">В этом руководстве мы будем использовать веб-элементы управления TextBox для изменения имени и цены единицы продукта.</span><span class="sxs-lookup"><span data-stu-id="e30ed-213">For this tutorial, we'll use TextBox Web controls for editing the product s name and unit price.</span></span>

<span data-ttu-id="e30ed-214">`EditItemTemplate` можно создать декларативно или через конструктор (выбрав параметр изменить шаблоны в смарт-теге DataList).</span><span class="sxs-lookup"><span data-stu-id="e30ed-214">The `EditItemTemplate` can be created either declaratively or through the Designer (by selecting the Edit Templates option from the DataList s smart tag).</span></span> <span data-ttu-id="e30ed-215">Чтобы использовать параметр изменить шаблоны, сначала щелкните ссылку Edit Templates (изменить шаблоны) в смарт-теге, а затем выберите элемент `EditItemTemplate` из раскрывающегося списка.</span><span class="sxs-lookup"><span data-stu-id="e30ed-215">To use the Edit Templates option, first click the Edit Templates link in the smart tag and then select the `EditItemTemplate` item from the drop-down list.</span></span>

<span data-ttu-id="e30ed-216">[![для работы с элементом управления DataList s](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image19.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image18.png)</span><span class="sxs-lookup"><span data-stu-id="e30ed-216">[![Opt to Work with the DataList s EditItemTemplate](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image19.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image18.png)</span></span>

<span data-ttu-id="e30ed-217">**Рис. 8**. необязательное использование `EditItemTemplate` DataList s ([щелкните, чтобы просмотреть изображение с полным размером](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="e30ed-217">**Figure 8**: Opt to Work with the DataList s `EditItemTemplate` ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image20.png))</span></span>

<span data-ttu-id="e30ed-218">Затем введите название продукта: и Price:, а затем перетащите два элемента управления TextBox из панели элементов в интерфейс `EditItemTemplate` в конструкторе.</span><span class="sxs-lookup"><span data-stu-id="e30ed-218">Next, type in Product name: and Price: and then drag two TextBox controls from the Toolbox into the `EditItemTemplate` interface on the Designer.</span></span> <span data-ttu-id="e30ed-219">Задайте для полей `ID` свойства значение `ProductName` и `UnitPrice`.</span><span class="sxs-lookup"><span data-stu-id="e30ed-219">Set the TextBoxes `ID` properties to `ProductName` and `UnitPrice`.</span></span>

<span data-ttu-id="e30ed-220">[![добавить текстовое поле для имени и цены продукта](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image22.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="e30ed-220">[![Add a TextBox for the Product s Name and Price](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image22.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image21.png)</span></span>

<span data-ttu-id="e30ed-221">**Рис. 9**. Добавление текстового поля для имени и цены продукта ([щелкните, чтобы просмотреть изображение с полным размером](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image23.png))</span><span class="sxs-lookup"><span data-stu-id="e30ed-221">**Figure 9**: Add a TextBox for the Product s Name and Price ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image23.png))</span></span>

<span data-ttu-id="e30ed-222">Необходимо привязать соответствующие значения полей данных продукта к свойствам `Text` двух текстовых полей.</span><span class="sxs-lookup"><span data-stu-id="e30ed-222">We need to bind the corresponding product data field values to the `Text` properties of the two TextBoxes.</span></span> <span data-ttu-id="e30ed-223">В смарт-тегах текстовых полей щелкните ссылку изменить привязки к данным, а затем свяжите соответствующее поле данных со свойством `Text`, как показано на рис. 10.</span><span class="sxs-lookup"><span data-stu-id="e30ed-223">From the TextBoxes smart tags, click on the Edit DataBindings link and then associate the appropriate data field with the `Text` property, as shown in Figure 10.</span></span>

> [!NOTE]
> <span data-ttu-id="e30ed-224">При привязке поля `UnitPrice` данных к полю `Text` поля цены можно отформатировать его как денежное значение (`{0:C}`), общее число (`{0:N}`) или оставить его неформатированным.</span><span class="sxs-lookup"><span data-stu-id="e30ed-224">When binding the `UnitPrice` data field to the price TextBox s `Text` field, you may format it as a currency value (`{0:C}`), a general number (`{0:N}`), or leave it unformatted.</span></span>

![Привязка полей данных ProductName и UnitPrice к свойствам текста текстовых полей](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image24.png)

<span data-ttu-id="e30ed-226">**Рис. 10**. Привязка полей данных `ProductName` и `UnitPrice` к свойствам `Text` текстовых полей</span><span class="sxs-lookup"><span data-stu-id="e30ed-226">**Figure 10**: Bind the `ProductName` and `UnitPrice` Data Fields to the `Text` Properties of the TextBoxes</span></span>

<span data-ttu-id="e30ed-227">Обратите внимание, что диалоговое окно Изменение привязок данных на рис. 10 *не включает двусторонний* флажок DataBinding, который имеется при редактировании TemplateField в элементе управления GridView или DetailsView, или в шаблоне FormView.</span><span class="sxs-lookup"><span data-stu-id="e30ed-227">Notice how the Edit DataBindings dialog box in Figure 10 does *not* include the Two-way databinding checkbox that is present when editing a TemplateField in the GridView or DetailsView, or a template in the FormView.</span></span> <span data-ttu-id="e30ed-228">Функция двухсторонней привязки данных допускает, чтобы значение, введенное во входной веб-элемент управления, было автоматически назначено соответствующему ObjectDataSource `InsertParameters` или `UpdateParameters` при вставке или обновлении данных.</span><span class="sxs-lookup"><span data-stu-id="e30ed-228">The two-way databinding feature allowed the value entered into the input Web control to be automatically assigned to the corresponding ObjectDataSource s `InsertParameters` or `UpdateParameters` when inserting or updating data.</span></span> <span data-ttu-id="e30ed-229">Элемент управления DataList не поддерживает двустороннюю привязку данных, как будет показано далее в этом руководстве, после того, как пользователь вносит изменения и готов обновить данные, нам потребуется программный доступ к этим текстовым окнам `Text` свойствам и передать их значения соответствующему методу `UpdateProduct` в классе `ProductsBLL`.</span><span class="sxs-lookup"><span data-stu-id="e30ed-229">The DataList does not support two-way databinding as we'll see later on in this tutorial, after the user makes her changes and is ready to update the data, we will need to programmatically access these TextBoxes `Text` properties and pass in their values to the appropriate `UpdateProduct` method in the `ProductsBLL` class.</span></span>

<span data-ttu-id="e30ed-230">Наконец, необходимо добавить кнопки обновления и отмены в `EditItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="e30ed-230">Finally, we need to add Update and Cancel buttons to the `EditItemTemplate`.</span></span> <span data-ttu-id="e30ed-231">Как было показано в статье « [основной/подробности» с помощью маркированного списка основных записей с учебником «сведения об элементе DataList](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md) », если щелкнуть кнопку, LinkButton или ImageButton, свойство `CommandName` которого задано в элементе управления Repeater или DataList, то возникает событие Repeater или datalist s `ItemCommand`.</span><span class="sxs-lookup"><span data-stu-id="e30ed-231">As we saw in the [Master/Detail Using a Bulleted List of Master Records with a Details DataList](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md) tutorial, when a Button, LinkButton, or ImageButton whose `CommandName` property is set is clicked from within a Repeater or DataList, the Repeater or DataList s `ItemCommand` event is raised.</span></span> <span data-ttu-id="e30ed-232">Для элемента управления DataList, если для свойства `CommandName` задано определенное значение, также может возникнуть дополнительное событие.</span><span class="sxs-lookup"><span data-stu-id="e30ed-232">For the DataList, if the `CommandName` property is set to a certain value, an additional event may be raised as well.</span></span> <span data-ttu-id="e30ed-233">В число дополнительных `CommandName` значений свойств входят следующие.</span><span class="sxs-lookup"><span data-stu-id="e30ed-233">The special `CommandName` property values include, among others:</span></span>

- <span data-ttu-id="e30ed-234">Cancel вызывает событие `CancelCommand`</span><span class="sxs-lookup"><span data-stu-id="e30ed-234">Cancel raises the `CancelCommand` event</span></span>
- <span data-ttu-id="e30ed-235">Edit вызывает событие `EditCommand`</span><span class="sxs-lookup"><span data-stu-id="e30ed-235">Edit raises the `EditCommand` event</span></span>
- <span data-ttu-id="e30ed-236">Обновление вызывает событие `UpdateCommand`</span><span class="sxs-lookup"><span data-stu-id="e30ed-236">Update raises the `UpdateCommand` event</span></span>

<span data-ttu-id="e30ed-237">Помните, что эти события создаются *в дополнение к* событию `ItemCommand`.</span><span class="sxs-lookup"><span data-stu-id="e30ed-237">Keep in mind that these events are raised *in addition to* the `ItemCommand` event.</span></span>

<span data-ttu-id="e30ed-238">Добавьте в `EditItemTemplate` два веб-элемента управления "Кнопка", для которых задано `CommandName` обновление, а для другого параметра s — значение Cancel.</span><span class="sxs-lookup"><span data-stu-id="e30ed-238">Add to the `EditItemTemplate` two Button Web controls, one whose `CommandName` is set to Update and the other s set to Cancel.</span></span> <span data-ttu-id="e30ed-239">После добавления этих двух веб-элементов управления для кнопок конструктор должен выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="e30ed-239">After adding these two Button Web controls the Designer should look similar to the following:</span></span>

<span data-ttu-id="e30ed-240">[![добавить кнопки обновления и отмены в EditItemTemplate](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image26.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="e30ed-240">[![Add Update and Cancel Buttons to the EditItemTemplate](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image26.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image25.png)</span></span>

<span data-ttu-id="e30ed-241">**Рис. 11**. Добавление кнопок обновления и отмены в `EditItemTemplate` ([щелкните, чтобы просмотреть изображение с полным размером](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="e30ed-241">**Figure 11**: Add Update and Cancel Buttons to the `EditItemTemplate` ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image27.png))</span></span>

<span data-ttu-id="e30ed-242">После `EditItemTemplate` завершения декларативной разметки DataList s должен выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="e30ed-242">With the `EditItemTemplate` complete your DataList s declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/samples/sample3.aspx)]

## <a name="step-5-adding-the-plumbing-to-enter-edit-mode"></a><span data-ttu-id="e30ed-243">Шаг 5. Добавление провода для перехода в режим правки</span><span class="sxs-lookup"><span data-stu-id="e30ed-243">Step 5: Adding the Plumbing to Enter Edit Mode</span></span>

<span data-ttu-id="e30ed-244">На этом этапе наш элемент управления DataList имеет интерфейс правки, определенный с помощью его `EditItemTemplate`; Однако в настоящее время для пользователя, который посещает нашу страницу, нет способа указать, что он хочет изменить сведения о продукте.</span><span class="sxs-lookup"><span data-stu-id="e30ed-244">At this point our DataList has an editing interface defined via its `EditItemTemplate`; however, there s currently no way for a user visiting our page to indicate that he wants to edit a product s information.</span></span> <span data-ttu-id="e30ed-245">Нам нужно добавить кнопку изменить в каждый продукт, который при щелчке отображает этот элемент DataList в режиме редактирования.</span><span class="sxs-lookup"><span data-stu-id="e30ed-245">We need to add an Edit button to each product that, when clicked, renders that DataList item in edit mode.</span></span> <span data-ttu-id="e30ed-246">Начните с добавления кнопки "Изменить" в `ItemTemplate`либо через конструктор, либо декларативно.</span><span class="sxs-lookup"><span data-stu-id="e30ed-246">Start by adding an Edit button to the `ItemTemplate`, either through the Designer or declaratively.</span></span> <span data-ttu-id="e30ed-247">Убедитесь, что вы установили для свойства `CommandName` изменить свойство s.</span><span class="sxs-lookup"><span data-stu-id="e30ed-247">Be certain to set the Edit button s `CommandName` property to Edit .</span></span>

<span data-ttu-id="e30ed-248">После добавления этой кнопки редактирования просмотрите страницу в браузере.</span><span class="sxs-lookup"><span data-stu-id="e30ed-248">After you have added this Edit button, take a moment to view the page through a browser.</span></span> <span data-ttu-id="e30ed-249">С этим добавлением каждый список продуктов должен содержать кнопку Edit (изменить).</span><span class="sxs-lookup"><span data-stu-id="e30ed-249">With this addition, each product listing should include an Edit button.</span></span>

<span data-ttu-id="e30ed-250">[![добавить кнопки обновления и отмены в EditItemTemplate](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image29.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="e30ed-250">[![Add Update and Cancel Buttons to the EditItemTemplate](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image29.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image28.png)</span></span>

<span data-ttu-id="e30ed-251">**Рис. 12**. кнопки "добавить обновления" и "Отмена" в `EditItemTemplate` ([щелкните, чтобы просмотреть изображение с полным размером](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="e30ed-251">**Figure 12**: Add Update and Cancel Buttons to the `EditItemTemplate` ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image30.png))</span></span>

<span data-ttu-id="e30ed-252">Нажатие кнопки вызывает обратную передачу, но *не* переводит список продуктов в режим правки.</span><span class="sxs-lookup"><span data-stu-id="e30ed-252">Clicking the button causes a postback, but does *not* bring the product listing into edit mode.</span></span> <span data-ttu-id="e30ed-253">Чтобы сделать продукт доступным для редактирования, необходимо:</span><span class="sxs-lookup"><span data-stu-id="e30ed-253">To make the product editable, we need to:</span></span>

1. <span data-ttu-id="e30ed-254">Задайте для [свойства`EditItemIndex`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.edititemindex.aspx) DataList значение индекса `DataListItem`, для которого была нажата кнопка "Изменить".</span><span class="sxs-lookup"><span data-stu-id="e30ed-254">Set the DataList s [`EditItemIndex` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.edititemindex.aspx) to the index of the `DataListItem` whose Edit button was just clicked.</span></span>
2. <span data-ttu-id="e30ed-255">Выполните повторную привязку данных к DataList.</span><span class="sxs-lookup"><span data-stu-id="e30ed-255">Rebind the data to the DataList.</span></span> <span data-ttu-id="e30ed-256">При повторном отображении элемента управления DataList `DataListItem`, чьи `ItemIndex` соответствуют `EditItemIndex` DataList, будут отображены с помощью `EditItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="e30ed-256">When the DataList is re-rendered, the `DataListItem` whose `ItemIndex` corresponds with the DataList s `EditItemIndex` will render using its `EditItemTemplate`.</span></span>

<span data-ttu-id="e30ed-257">Так как событие DataList `EditCommand` возникает при нажатии кнопки Edit (изменить), создайте `EditCommand` обработчик событий с помощью следующего кода:</span><span class="sxs-lookup"><span data-stu-id="e30ed-257">Since the DataList s `EditCommand` event is fired when the Edit button is clicked, create an `EditCommand` event handler with the following code:</span></span>

[!code-vb[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/samples/sample4.vb)]

<span data-ttu-id="e30ed-258">Обработчик событий `EditCommand` передается в объект типа `DataListCommandEventArgs` в качестве второго входного параметра, который включает ссылку на `DataListItem`, для которого была нажата кнопка Edit (`e.Item`).</span><span class="sxs-lookup"><span data-stu-id="e30ed-258">The `EditCommand` event handler is passed in an object of type `DataListCommandEventArgs` as its second input parameter, which includes a reference to the `DataListItem` whose Edit button was clicked (`e.Item`).</span></span> <span data-ttu-id="e30ed-259">Обработчик событий сначала устанавливает `EditItemIndex` DataList s `ItemIndex` редактируемого `DataListItem`, а затем повторно привязывает данные к DataList, вызвав метод DataList s `DataBind()`.</span><span class="sxs-lookup"><span data-stu-id="e30ed-259">The event handler first sets the DataList s `EditItemIndex` to the `ItemIndex` of the editable `DataListItem` and then rebinds the data to the DataList by calling the DataList s `DataBind()` method.</span></span>

<span data-ttu-id="e30ed-260">После добавления этого обработчика событий перейдите на страницу в браузере.</span><span class="sxs-lookup"><span data-stu-id="e30ed-260">After adding this event handler, revisit the page in a browser.</span></span> <span data-ttu-id="e30ed-261">Нажав кнопку "Изменить", вы сделаете редактируемый продукт доступным для изменения (см. рис. 13).</span><span class="sxs-lookup"><span data-stu-id="e30ed-261">Clicking the Edit button now makes the clicked product editable (see Figure 13).</span></span>

<span data-ttu-id="e30ed-262">[![нажатии кнопки "Изменить" продукт становится доступным для редактирования](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image32.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="e30ed-262">[![Clicking the Edit Button Makes the Product Editable](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image32.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image31.png)</span></span>

<span data-ttu-id="e30ed-263">**Рис. 13**. при нажатии кнопки "Изменить" продукт становится изменяемым ([щелкните, чтобы просмотреть изображение с полным размером](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="e30ed-263">**Figure 13**: Clicking the Edit Button Makes the Product Editable ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image33.png))</span></span>

## <a name="step-6-saving-the-user-s-changes"></a><span data-ttu-id="e30ed-264">Шаг 6. Сохранение изменений пользователя</span><span class="sxs-lookup"><span data-stu-id="e30ed-264">Step 6: Saving the User s Changes</span></span>

<span data-ttu-id="e30ed-265">При нажатии кнопки изменить обновление или отмена продукта на этом этапе ничего не происходит; чтобы добавить эту функцию, необходимо создать обработчики событий для `UpdateCommand` и `CancelCommand` событий DataList.</span><span class="sxs-lookup"><span data-stu-id="e30ed-265">Clicking the edited product s Update or Cancel buttons does nothing at this point; to add this functionality we need to create event handlers for the DataList s `UpdateCommand` and `CancelCommand` events.</span></span> <span data-ttu-id="e30ed-266">Начните с создания обработчика событий `CancelCommand`, который будет выполняться при нажатии на кнопку измененного продукта Cancel и выполнении задачи возврата элемента управления DataList в состояние предварительного редактирования.</span><span class="sxs-lookup"><span data-stu-id="e30ed-266">Start by creating the `CancelCommand` event handler, which will execute when the edited product s Cancel button is clicked and it tasked with returning the DataList to its pre-editing state.</span></span>

<span data-ttu-id="e30ed-267">Чтобы элемент управления DataList отображал все элементы в режиме только для чтения, необходимо выполнить следующие действия.</span><span class="sxs-lookup"><span data-stu-id="e30ed-267">To have the DataList render all of its items in the read-only mode, we need to:</span></span>

1. <span data-ttu-id="e30ed-268">Задайте [свойству`EditItemIndex`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.edititemindex.aspx) DataList s индекс несуществующего `DataListItem` индекса.</span><span class="sxs-lookup"><span data-stu-id="e30ed-268">Set the DataList s [`EditItemIndex` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.edititemindex.aspx) to the index of a non-existent `DataListItem` index.</span></span> <span data-ttu-id="e30ed-269">`-1` является надежным выбором, так как индексы `DataListItem` начинаются с `0`.</span><span class="sxs-lookup"><span data-stu-id="e30ed-269">`-1` is a safe choice, since the `DataListItem` indexes start at `0`.</span></span>
2. <span data-ttu-id="e30ed-270">Выполните повторную привязку данных к DataList.</span><span class="sxs-lookup"><span data-stu-id="e30ed-270">Rebind the data to the DataList.</span></span> <span data-ttu-id="e30ed-271">Так как ни один из `DataListItem` `ItemIndex` ES не соответствует `EditItemIndex`DataList, все элементы управления DataList будут подготовлены к просмотру в режиме только для чтения.</span><span class="sxs-lookup"><span data-stu-id="e30ed-271">Since no `DataListItem` `ItemIndex` es correspond to the DataList s `EditItemIndex`, the entire DataList will be rendered in a read-only mode.</span></span>

<span data-ttu-id="e30ed-272">Эти действия можно выполнить с помощью следующего кода обработчика событий:</span><span class="sxs-lookup"><span data-stu-id="e30ed-272">These steps can be accomplished with the following event handler code:</span></span>

[!code-vb[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/samples/sample5.vb)]

<span data-ttu-id="e30ed-273">С помощью этого добавления, нажав кнопку Отмена, вы вернете элемент управления DataList к состоянию предварительного редактирования.</span><span class="sxs-lookup"><span data-stu-id="e30ed-273">With this addition, clicking the Cancel button returns the DataList to its pre-editing state.</span></span>

<span data-ttu-id="e30ed-274">Последний обработчик событий, который нам нужно выполнить, — обработчик событий `UpdateCommand`.</span><span class="sxs-lookup"><span data-stu-id="e30ed-274">The last event handler we need to complete is the `UpdateCommand` event handler.</span></span> <span data-ttu-id="e30ed-275">Этот обработчик событий должен:</span><span class="sxs-lookup"><span data-stu-id="e30ed-275">This event handler needs to:</span></span>

1. <span data-ttu-id="e30ed-276">Программный доступ к пользовательским названием продукта и цене, а также к измененному продукту с `ProductID`.</span><span class="sxs-lookup"><span data-stu-id="e30ed-276">Programmatically access the user-entered product name and price as well as the edited product s `ProductID`.</span></span>
2. <span data-ttu-id="e30ed-277">Запустите процесс обновления, вызвав соответствующую перегрузку `UpdateProduct` в классе `ProductsBLL`.</span><span class="sxs-lookup"><span data-stu-id="e30ed-277">Initiate the update process by calling the appropriate `UpdateProduct` overload in the `ProductsBLL` class.</span></span>
3. <span data-ttu-id="e30ed-278">Задайте [свойству`EditItemIndex`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.edititemindex.aspx) DataList s индекс несуществующего `DataListItem` индекса.</span><span class="sxs-lookup"><span data-stu-id="e30ed-278">Set the DataList s [`EditItemIndex` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.edititemindex.aspx) to the index of a non-existent `DataListItem` index.</span></span> <span data-ttu-id="e30ed-279">`-1` является надежным выбором, так как индексы `DataListItem` начинаются с `0`.</span><span class="sxs-lookup"><span data-stu-id="e30ed-279">`-1` is a safe choice, since the `DataListItem` indexes start at `0`.</span></span>
4. <span data-ttu-id="e30ed-280">Выполните повторную привязку данных к DataList.</span><span class="sxs-lookup"><span data-stu-id="e30ed-280">Rebind the data to the DataList.</span></span> <span data-ttu-id="e30ed-281">Так как ни один из `DataListItem` `ItemIndex` ES не соответствует `EditItemIndex`DataList, все элементы управления DataList будут подготовлены к просмотру в режиме только для чтения.</span><span class="sxs-lookup"><span data-stu-id="e30ed-281">Since no `DataListItem` `ItemIndex` es correspond to the DataList s `EditItemIndex`, the entire DataList will be rendered in a read-only mode.</span></span>

<span data-ttu-id="e30ed-282">Шаги 1 и 2 отвечают за сохранение изменений пользователя. шаги 3 и 4 возвращают элемент управления DataList в состояние предварительного редактирования после сохранения изменений и идентичны действиям, выполненным в обработчике событий `CancelCommand`.</span><span class="sxs-lookup"><span data-stu-id="e30ed-282">Steps 1 and 2 are responsible for saving the user s changes; steps 3 and 4 return the DataList to its pre-editing state after the changes have been saved and are identical to the steps performed in the `CancelCommand` event handler.</span></span>

<span data-ttu-id="e30ed-283">Чтобы получить обновленное название и цену продукта, необходимо использовать метод `FindControl` для программной ссылки на веб-элементы управления TextBox в `EditItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="e30ed-283">To get the updated product name and price, we need to use the `FindControl` method to programmatically reference the TextBox Web controls within the `EditItemTemplate`.</span></span> <span data-ttu-id="e30ed-284">Также необходимо получить измененное значение `ProductID` продукта.</span><span class="sxs-lookup"><span data-stu-id="e30ed-284">We also need to get the edited product s `ProductID` value.</span></span> <span data-ttu-id="e30ed-285">При первоначальной привязке ObjectDataSource к элементу управления DataList Visual Studio назначил свойству DataList `DataKeyField` значение первичного ключа из источника данных (`ProductID`).</span><span class="sxs-lookup"><span data-stu-id="e30ed-285">When we initially bound the ObjectDataSource to the DataList, Visual Studio assigned the DataList s `DataKeyField` property to the primary key value from the data source (`ProductID`).</span></span> <span data-ttu-id="e30ed-286">Затем это значение можно получить из коллекции DataList `DataKeys`.</span><span class="sxs-lookup"><span data-stu-id="e30ed-286">This value can then be retrieved from the DataList s `DataKeys` collection.</span></span> <span data-ttu-id="e30ed-287">Уделите время, чтобы свойство `DataKeyField` действительно было установлено в `ProductID`.</span><span class="sxs-lookup"><span data-stu-id="e30ed-287">Take a moment to ensure that the `DataKeyField` property is indeed set to `ProductID`.</span></span>

<span data-ttu-id="e30ed-288">Следующий код реализует четыре шага:</span><span class="sxs-lookup"><span data-stu-id="e30ed-288">The following code implements the four steps:</span></span>

[!code-vb[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/samples/sample6.vb)]

<span data-ttu-id="e30ed-289">Обработчик событий начинает чтение измененных `ProductID` продуктов из коллекции `DataKeys`.</span><span class="sxs-lookup"><span data-stu-id="e30ed-289">The event handler starts by reading in the edited product s `ProductID` from the `DataKeys` collection.</span></span> <span data-ttu-id="e30ed-290">Затем два текстовых поля в `EditItemTemplate` указываются и их `Text` свойства, хранящиеся в локальных переменных `productNameValue` и `unitPriceValue`.</span><span class="sxs-lookup"><span data-stu-id="e30ed-290">Next, the two TextBoxes in the `EditItemTemplate` are referenced and their `Text` properties stored in local variables, `productNameValue` and `unitPriceValue`.</span></span> <span data-ttu-id="e30ed-291">Мы используем метод `Decimal.Parse()` для считывания значения из текстового поля `UnitPrice` поэтому, если введенное значение имеет символ валюты, оно по-прежнему может быть правильно преобразовано в значение `Decimal`.</span><span class="sxs-lookup"><span data-stu-id="e30ed-291">We use the `Decimal.Parse()` method to read the value from the `UnitPrice` TextBox so that if the value entered has a currency symbol, it can still be correctly converted into a `Decimal` value.</span></span>

> [!NOTE]
> <span data-ttu-id="e30ed-292">Значения из текстовых полей `ProductName` и `UnitPrice` присваиваются только переменным Продуктнамевалуе и Унитприцевалуе, если для текстовых свойств текстового поля задано значение.</span><span class="sxs-lookup"><span data-stu-id="e30ed-292">The values from the `ProductName` and `UnitPrice` TextBoxes are only assigned to the productNameValue and unitPriceValue variables if the TextBoxes Text properties have a value specified.</span></span> <span data-ttu-id="e30ed-293">В противном случае для переменных используется значение `Nothing`, которое влияет на обновление данных с помощью значения `NULL` базы данных.</span><span class="sxs-lookup"><span data-stu-id="e30ed-293">Otherwise, a value of `Nothing` is used for the variables, which has the effect of updating the data with a database `NULL` value.</span></span> <span data-ttu-id="e30ed-294">То есть наш код обрабатывает преобразование пустых строк в значения `NULL` базы данных, что является поведением по умолчанию интерфейса редактирования в элементах управления GridView, DetailsView и FormView.</span><span class="sxs-lookup"><span data-stu-id="e30ed-294">That is, our code treats converts empty strings to database `NULL` values, which is the default behavior of the editing interface in the GridView, DetailsView, and FormView controls.</span></span>

<span data-ttu-id="e30ed-295">После считывания значений вызывается метод `UpdateProduct` класса `ProductsBLL`, передающий название продукта, цену и `ProductID`.</span><span class="sxs-lookup"><span data-stu-id="e30ed-295">After reading the values, the `ProductsBLL` class s `UpdateProduct` method is called, passing in the product s name, price, and `ProductID`.</span></span> <span data-ttu-id="e30ed-296">Обработчик событий завершает работу, возвращая элемент управления DataList в состояние предварительного редактирования, используя ту же логику, что и в обработчике событий `CancelCommand`.</span><span class="sxs-lookup"><span data-stu-id="e30ed-296">The event handler completes by returning the DataList to its pre-editing state using the exact same logic as in the `CancelCommand` event handler.</span></span>

<span data-ttu-id="e30ed-297">После завершения обработчиков событий `EditCommand`, `CancelCommand`и `UpdateCommand` посетитель может изменить имя и цену продукта.</span><span class="sxs-lookup"><span data-stu-id="e30ed-297">With the `EditCommand`, `CancelCommand`, and `UpdateCommand` event handlers complete, a visitor can edit the name and price of a product.</span></span> <span data-ttu-id="e30ed-298">Рисунки 14-16. Отображение рабочего процесса редактирования в действии.</span><span class="sxs-lookup"><span data-stu-id="e30ed-298">Figures 14-16 show this editing workflow in action.</span></span>

<span data-ttu-id="e30ed-299">[![при первом посещении страницы все продукты находятся в режиме только для чтения](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image35.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="e30ed-299">[![When First Visiting the Page, All Products are in Read-Only Mode](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image35.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image34.png)</span></span>

<span data-ttu-id="e30ed-300">**Рис. 14**. при первом посещении страницы все продукты находятся в режиме только для чтения ([щелкните, чтобы просмотреть изображение с полным размером](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image36.png)).</span><span class="sxs-lookup"><span data-stu-id="e30ed-300">**Figure 14**: When First Visiting the Page, All Products are in Read-Only Mode ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image36.png))</span></span>

<span data-ttu-id="e30ed-301">[![для обновления имени или цены продукта нажмите кнопку "Изменить".](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image38.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="e30ed-301">[![To Update a Product s Name or Price, Click the Edit Button](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image38.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image37.png)</span></span>

<span data-ttu-id="e30ed-302">**Рис. 15**. чтобы обновить название или цену продукта, нажмите кнопку "Изменить" ([щелкните, чтобы просмотреть изображение с полным размером](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="e30ed-302">**Figure 15**: To Update a Product s Name or Price, Click the Edit Button ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image39.png))</span></span>

<span data-ttu-id="e30ed-303">[![после изменения значения нажмите кнопку обновить, чтобы вернуться в режим только для чтения.](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image41.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="e30ed-303">[![After Changing the Value, Click Update to Return to the Read-Only Mode](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image41.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image40.png)</span></span>

<span data-ttu-id="e30ed-304">**Рис. 16**. После изменения значения нажмите кнопку обновить, чтобы вернуться в режим только для чтения ([щелкните, чтобы просмотреть изображение с полным размером](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image42.png)).</span><span class="sxs-lookup"><span data-stu-id="e30ed-304">**Figure 16**: After Changing the Value, Click Update to Return to the Read-Only Mode ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image42.png))</span></span>

## <a name="step-7-adding-delete-capabilities"></a><span data-ttu-id="e30ed-305">Шаг 7. Добавление возможностей удаления</span><span class="sxs-lookup"><span data-stu-id="e30ed-305">Step 7: Adding Delete Capabilities</span></span>

<span data-ttu-id="e30ed-306">Действия по добавлению возможностей удаления в DataList аналогичны тем, что позволяют добавлять возможности редактирования.</span><span class="sxs-lookup"><span data-stu-id="e30ed-306">The steps for adding delete capabilities to a DataList are similar to those for adding editing capabilities.</span></span> <span data-ttu-id="e30ed-307">Вкратце, нам нужно добавить кнопку «Удалить» к `ItemTemplate`, при нажатии которой:</span><span class="sxs-lookup"><span data-stu-id="e30ed-307">In short, we need to add a Delete button to the `ItemTemplate` that, when clicked:</span></span>

1. <span data-ttu-id="e30ed-308">Считывает в соответствующем продукте `ProductID` с помощью коллекции `DataKeys`.</span><span class="sxs-lookup"><span data-stu-id="e30ed-308">Reads in the corresponding product s `ProductID` via the `DataKeys` collection.</span></span>
2. <span data-ttu-id="e30ed-309">Выполняет удаление, вызывая метод `ProductsBLL` класса s `DeleteProduct`.</span><span class="sxs-lookup"><span data-stu-id="e30ed-309">Performs the delete by calling the `ProductsBLL` class s `DeleteProduct` method.</span></span>
3. <span data-ttu-id="e30ed-310">Повторно привязывает данные к DataList.</span><span class="sxs-lookup"><span data-stu-id="e30ed-310">Rebinds the data to the DataList.</span></span>

<span data-ttu-id="e30ed-311">Начнем с добавления кнопки Удалить в `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="e30ed-311">Let s start by adding a Delete button to the `ItemTemplate`.</span></span>

<span data-ttu-id="e30ed-312">При нажатии кнопки, `CommandName` изменить, обновить или отменить, вызывает событие DataList s `ItemCommand` вместе с дополнительным событием (например, при использовании команды Изменить событие `EditCommand`).</span><span class="sxs-lookup"><span data-stu-id="e30ed-312">When clicked, a Button whose `CommandName` is Edit, Update, or Cancel raises the DataList s `ItemCommand` event along with an additional event (for example, when using Edit the `EditCommand` event is raised as well).</span></span> <span data-ttu-id="e30ed-313">Аналогичным образом любая кнопка, LinkButton или ImageButton в элементе управления DataList, свойство `CommandName` которого имеет значение Delete, вызывает срабатывание события `DeleteCommand` (вместе с `ItemCommand`).</span><span class="sxs-lookup"><span data-stu-id="e30ed-313">Similarly, any Button, LinkButton, or ImageButton in the DataList whose `CommandName` property is set to Delete causes the `DeleteCommand` event to fire (along with `ItemCommand`).</span></span>

<span data-ttu-id="e30ed-314">Добавьте кнопку "Удалить" рядом с кнопкой "Изменить" в `ItemTemplate`, задав для свойства `CommandName` значение "Удалить".</span><span class="sxs-lookup"><span data-stu-id="e30ed-314">Add a Delete button next to the Edit button in the `ItemTemplate`, setting its `CommandName` property to Delete.</span></span> <span data-ttu-id="e30ed-315">После добавления этой кнопки элемент управления DataList s `ItemTemplate` декларативный синтаксис должен выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="e30ed-315">After adding this Button control your DataList s `ItemTemplate` declarative syntax should look like:</span></span>

[!code-aspx[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/samples/sample7.aspx)]

<span data-ttu-id="e30ed-316">Затем создайте обработчик событий для события `DeleteCommand` DataList, используя следующий код:</span><span class="sxs-lookup"><span data-stu-id="e30ed-316">Next, create an event handler for the DataList s `DeleteCommand` event, using the following code:</span></span>

[!code-vb[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/samples/sample8.vb)]

<span data-ttu-id="e30ed-317">Нажатие кнопки Удалить вызывает обратную передачу и запускает событие `DeleteCommand` DataList.</span><span class="sxs-lookup"><span data-stu-id="e30ed-317">Clicking the Delete button causes a postback and fires the DataList s `DeleteCommand` event.</span></span> <span data-ttu-id="e30ed-318">В обработчике событий в коллекции `DataKeys` используется доступ к `ProductID`ному продукту.</span><span class="sxs-lookup"><span data-stu-id="e30ed-318">In the event handler, the clicked product s `ProductID` value is accessed from the `DataKeys` collection.</span></span> <span data-ttu-id="e30ed-319">Затем продукт удаляется путем вызова метода `ProductsBLL` Class s `DeleteProduct`.</span><span class="sxs-lookup"><span data-stu-id="e30ed-319">Next, the product is deleted by calling the `ProductsBLL` class s `DeleteProduct` method.</span></span>

<span data-ttu-id="e30ed-320">После удаления продукта важно повторно привязать данные к элементу управления DataList (`DataList1.DataBind()`), в противном случае в DataList будет отображаться только что удаленный продукт.</span><span class="sxs-lookup"><span data-stu-id="e30ed-320">After deleting the product, it s important that we rebind the data to the DataList (`DataList1.DataBind()`), otherwise the DataList will continue to show the product that was just deleted.</span></span>

## <a name="summary"></a><span data-ttu-id="e30ed-321">Сводка</span><span class="sxs-lookup"><span data-stu-id="e30ed-321">Summary</span></span>

<span data-ttu-id="e30ed-322">Хотя в DataList отсутствует точка и нажата кнопка Изменить и удалить поддержку, которая может быть добавлена в GridView, с коротким фрагментом кода его можно улучшить, чтобы включить эти функции.</span><span class="sxs-lookup"><span data-stu-id="e30ed-322">While the DataList lacks the point and click editing and deleting support enjoyed by the GridView, with a short bit of code it can be enhanced to include these features.</span></span> <span data-ttu-id="e30ed-323">В этом учебнике мы рассмотрели, как создать список продуктов с двумя столбцами, которые можно удалить, а также имена и цены, которые можно изменить.</span><span class="sxs-lookup"><span data-stu-id="e30ed-323">In this tutorial we saw how to create a two-column listing of products that could be deleted and whose name and price could be edited.</span></span> <span data-ttu-id="e30ed-324">Добавление поддержки редактирования и удаления заключается в том, чтобы включить соответствующие веб-элементы управления в `ItemTemplate` и `EditItemTemplate`, создавать соответствующие обработчики событий, считывать значения вводимых пользователем и первичных ключей, а также взаимодействуя с уровнем бизнес-логики.</span><span class="sxs-lookup"><span data-stu-id="e30ed-324">Adding editing and deleting support is a matter of including the appropriate Web controls in the `ItemTemplate` and `EditItemTemplate`, creating the corresponding event handlers, reading the user-entered and primary key values, and interfacing with the Business Logic Layer.</span></span>

<span data-ttu-id="e30ed-325">Хотя мы добавили базовые возможности редактирования и удаления в DataList, у него нет более сложных функций.</span><span class="sxs-lookup"><span data-stu-id="e30ed-325">While we have added basic editing and deleting capabilities to the DataList, it lacks more advanced features.</span></span> <span data-ttu-id="e30ed-326">Например, отсутствует проверка поля ввода. Если пользователь вводит цену слишком дорого, `Decimal.Parse` при попытке преобразовать слишком дорогостоящий в `Decimal`.</span><span class="sxs-lookup"><span data-stu-id="e30ed-326">For example, there is no input field validation - if a user enters a price of Too expensive, an exception will be thrown by `Decimal.Parse` when attempting to convert Too expensive into a `Decimal`.</span></span> <span data-ttu-id="e30ed-327">Аналогичным образом, если возникла проблема при обновлении данных на уровнях бизнес-логики или доступа к данным, пользователь будет представлен на экране стандартного сообщения об ошибке.</span><span class="sxs-lookup"><span data-stu-id="e30ed-327">Similarly, if there is a problem in updating the data at the Business Logic or Data Access Layers the user will be presented with the standard error screen.</span></span> <span data-ttu-id="e30ed-328">Без какого-либо подтверждения на кнопке Delete случайное удаление продукта слишком вероятно.</span><span class="sxs-lookup"><span data-stu-id="e30ed-328">Without any sort of confirmation on the Delete button, accidentally deleting a product is all too likely.</span></span>

<span data-ttu-id="e30ed-329">В следующих учебных курсах будет показано, как улучшить взаимодействие с пользователем при редактировании.</span><span class="sxs-lookup"><span data-stu-id="e30ed-329">In future tutorials we'll see how to improve the editing user experience.</span></span>

<span data-ttu-id="e30ed-330">Поздравляем с программированием!</span><span class="sxs-lookup"><span data-stu-id="e30ed-330">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="e30ed-331">Об авторе</span><span class="sxs-lookup"><span data-stu-id="e30ed-331">About the Author</span></span>

<span data-ttu-id="e30ed-332">[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи книг по ASP/ASP. NET и основатель [4GuysFromRolla.com](http://www.4guysfromrolla.com), работал с веб-технологиями Майкрософт с 1998.</span><span class="sxs-lookup"><span data-stu-id="e30ed-332">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="e30ed-333">Скотт работает как независимый консультант, преподаватель и модуль записи.</span><span class="sxs-lookup"><span data-stu-id="e30ed-333">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="e30ed-334">Его последняя книга — [*Sams обучать себя ASP.NET 2,0 за 24 часа*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="e30ed-334">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="e30ed-335">Он доступен по адресу [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="e30ed-335">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="e30ed-336">или через его блог, который можно найти по адресу [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="e30ed-336">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="e30ed-337">Специальная благодарность</span><span class="sxs-lookup"><span data-stu-id="e30ed-337">Special Thanks To</span></span>

<span data-ttu-id="e30ed-338">Эта серия руководств была рассмотрена многими полезными рецензентами.</span><span class="sxs-lookup"><span data-stu-id="e30ed-338">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="e30ed-339">Потенциальными рецензентами для этого учебника были Зак Jones, Кен Песписа и Рэнди Шмидт.</span><span class="sxs-lookup"><span data-stu-id="e30ed-339">Lead reviewers for this tutorial were Zack Jones, Ken Pespisa, and Randy Schmidt.</span></span> <span data-ttu-id="e30ed-340">Хотите ознакомиться с моими будущими статьями MSDN?</span><span class="sxs-lookup"><span data-stu-id="e30ed-340">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="e30ed-341">Если это так, расположите строку в [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="e30ed-341">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="e30ed-342">[Назад](customizing-the-datalist-s-editing-interface-cs.md)
> [Вперед](performing-batch-updates-vb.md)</span><span class="sxs-lookup"><span data-stu-id="e30ed-342">[Previous](customizing-the-datalist-s-editing-interface-cs.md)
[Next](performing-batch-updates-vb.md)</span></span>
