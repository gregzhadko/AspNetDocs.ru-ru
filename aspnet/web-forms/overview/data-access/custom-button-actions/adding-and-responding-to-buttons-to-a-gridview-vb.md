---
uid: web-forms/overview/data-access/custom-button-actions/adding-and-responding-to-buttons-to-a-gridview-vb
title: Добавление кнопок в GridView (VB) и реагирование на них | Документация Майкрософт
author: rick-anderson
description: В этом учебнике мы рассмотрим, как добавить настраиваемые кнопки как в шаблон, так и в поля элемента управления GridView или DetailsView. В частности, мы буи...
ms.author: riande
ms.date: 09/13/2006
ms.assetid: 06c6bbd2-4bdc-435b-87a3-df2c868f4baa
msc.legacyurl: /web-forms/overview/data-access/custom-button-actions/adding-and-responding-to-buttons-to-a-gridview-vb
msc.type: authoredcontent
ms.openlocfilehash: 8727d8faead02340d223c75845bf29f63d1a0834
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78442278"
---
# <a name="adding-and-responding-to-buttons-to-a-gridview-vb"></a><span data-ttu-id="5dce4-104">Добавление кнопок и ответов на них к GridView (VB)</span><span class="sxs-lookup"><span data-stu-id="5dce4-104">Adding and Responding to Buttons to a GridView (VB)</span></span>

<span data-ttu-id="5dce4-105">по [Скотт Митчелл](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="5dce4-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="5dce4-106">[Скачивание примера приложения](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_28_VB.exe) или [Загрузка PDF-файла](adding-and-responding-to-buttons-to-a-gridview-vb/_static/datatutorial28vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="5dce4-106">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_28_VB.exe) or [Download PDF](adding-and-responding-to-buttons-to-a-gridview-vb/_static/datatutorial28vb1.pdf)</span></span>

> <span data-ttu-id="5dce4-107">В этом учебнике мы рассмотрим, как добавить настраиваемые кнопки как в шаблон, так и в поля элемента управления GridView или DetailsView.</span><span class="sxs-lookup"><span data-stu-id="5dce4-107">In this tutorial we'll look at how to add custom buttons, both to a template and to the fields of a GridView or DetailsView control.</span></span> <span data-ttu-id="5dce4-108">В частности, мы создадим интерфейс с FormView, который позволяет пользователю пролистывать поставщиков.</span><span class="sxs-lookup"><span data-stu-id="5dce4-108">In particular, we'll build an interface that has a FormView that allows the user to page through the suppliers.</span></span>

## <a name="introduction"></a><span data-ttu-id="5dce4-109">Введение</span><span class="sxs-lookup"><span data-stu-id="5dce4-109">Introduction</span></span>

<span data-ttu-id="5dce4-110">Несмотря на то, что многие сценарии составления отчетов включают доступ только для чтения к данным отчета, в отчетах не часто встречаются возможности выполнения действий на основе отображаемых данных.</span><span class="sxs-lookup"><span data-stu-id="5dce4-110">While many reporting scenarios involve read-only access to the report data, it s not uncommon for reports to include the ability to perform actions based upon the data displayed.</span></span> <span data-ttu-id="5dce4-111">Обычно это связано с добавлением веб-элемента управления Button, LinkButton или ImageButton с каждой отображаемой в отчете записью, которая при нажатии вызывает обратную передачу и вызывает некоторый код на стороне сервера.</span><span class="sxs-lookup"><span data-stu-id="5dce4-111">Typically this involved adding a Button, LinkButton, or ImageButton Web control with each record displayed in the report that, when clicked, causes a postback and invokes some server-side code.</span></span> <span data-ttu-id="5dce4-112">Наиболее распространенным примером является изменение и удаление данных на основе записи.</span><span class="sxs-lookup"><span data-stu-id="5dce4-112">Editing and deleting the data on a record-by-record basis is the most common example.</span></span> <span data-ttu-id="5dce4-113">На самом деле, как было показано, начиная с [обзора вставки, обновления и удаления данных учебник по вставке, обновлению](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md) и удалению является настолько распространенным, что элементы управления GridView, DetailsView и FormView могут поддерживать такую функциональность без необходимости написания одной строки кода.</span><span class="sxs-lookup"><span data-stu-id="5dce4-113">In fact, as we saw starting with the [Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md) tutorial, editing and deleting is so common that the GridView, DetailsView, and FormView controls can support such functionality without the need for writing a single line of code.</span></span>

<span data-ttu-id="5dce4-114">В дополнение к кнопкам "Правка" и "Удалить" элементы управления GridView, DetailsView и FormView могут также включать кнопки, LinkButton или Имажебуттонс, которые при нажатии выполняют некоторую пользовательскую логику на стороне сервера.</span><span class="sxs-lookup"><span data-stu-id="5dce4-114">In addition to Edit and Delete buttons, the GridView, DetailsView, and FormView controls can also include Buttons, LinkButtons, or ImageButtons that, when clicked, perform some custom server-side logic.</span></span> <span data-ttu-id="5dce4-115">В этом учебнике мы рассмотрим, как добавить настраиваемые кнопки как в шаблон, так и в поля элемента управления GridView или DetailsView.</span><span class="sxs-lookup"><span data-stu-id="5dce4-115">In this tutorial we'll look at how to add custom buttons, both to a template and to the fields of a GridView or DetailsView control.</span></span> <span data-ttu-id="5dce4-116">В частности, мы создадим интерфейс с FormView, который позволяет пользователю пролистывать поставщиков.</span><span class="sxs-lookup"><span data-stu-id="5dce4-116">In particular, we'll build an interface that has a FormView that allows the user to page through the suppliers.</span></span> <span data-ttu-id="5dce4-117">Для данного поставщика FormView будет показывать сведения о поставщике вместе с веб-элементом управления "Кнопка", при нажатии которого все связанные с ним продукты будут помечены как снятые с работы.</span><span class="sxs-lookup"><span data-stu-id="5dce4-117">For a given supplier, the FormView will show information about the supplier along with a Button Web control that, if clicked, will mark all of their associated products as discontinued.</span></span> <span data-ttu-id="5dce4-118">Кроме того, GridView перечисляет продукты, предоставляемые выбранным поставщиком, с каждой строкой, содержащей кнопки увеличения цены и скидки, которые при нажатии увеличивают или уменьшают продукт `UnitPrice` на 10% (см. рис. 1).</span><span class="sxs-lookup"><span data-stu-id="5dce4-118">Additionally, a GridView lists those products provided by the selected supplier, with each row containing Increase Price and Discount Price Buttons that, if clicked, raise or reduce the product s `UnitPrice` by 10% (see Figure 1).</span></span>

<span data-ttu-id="5dce4-119">[![как FormView, так и GridView содержат кнопки, выполняющие настраиваемые действия](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image2.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="5dce4-119">[![Both the FormView and GridView Contain Buttons That Perform Custom Actions](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image2.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image1.png)</span></span>

<span data-ttu-id="5dce4-120">**Рис. 1**. как FormView, так и GridView содержат кнопки для выполнения настраиваемых действий ([щелкните, чтобы просмотреть изображение с полным размером](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image3.png)).</span><span class="sxs-lookup"><span data-stu-id="5dce4-120">**Figure 1**: Both the FormView and GridView Contain Buttons That Perform Custom Actions ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image3.png))</span></span>

## <a name="step-1-adding-the-button-tutorial-web-pages"></a><span data-ttu-id="5dce4-121">Шаг 1. Добавление веб-страниц учебника по кнопкам</span><span class="sxs-lookup"><span data-stu-id="5dce4-121">Step 1: Adding the Button Tutorial Web Pages</span></span>

<span data-ttu-id="5dce4-122">Прежде чем мы посмотрим, как добавлять пользовательские кнопки, давайте сначала создадим страницы ASP.NET в нашем проекте веб-сайта, которые понадобятся для работы с этим руководством.</span><span class="sxs-lookup"><span data-stu-id="5dce4-122">Before we look at how to add a custom buttons, let s first take a moment to create the ASP.NET pages in our website project that we'll need for this tutorial.</span></span> <span data-ttu-id="5dce4-123">Для начала добавьте новую папку с именем `CustomButtons`.</span><span class="sxs-lookup"><span data-stu-id="5dce4-123">Start by adding a new folder named `CustomButtons`.</span></span> <span data-ttu-id="5dce4-124">Затем добавьте следующие две страницы ASP.NET в эту папку, чтобы связать каждую страницу с главной страницей `Site.master`:</span><span class="sxs-lookup"><span data-stu-id="5dce4-124">Next, add the following two ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `CustomButtons.aspx`

![Добавление страниц ASP.NET для руководств, связанных с пользовательскими кнопками](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image4.png)

<span data-ttu-id="5dce4-126">**Рис. 2**. добавление страниц ASP.NET для руководств, связанных с пользовательскими кнопками</span><span class="sxs-lookup"><span data-stu-id="5dce4-126">**Figure 2**: Add the ASP.NET Pages for the Custom Buttons-Related Tutorials</span></span>

<span data-ttu-id="5dce4-127">Как и в других папках, `Default.aspx` в папке `CustomButtons` будут перечислены учебники в разделе.</span><span class="sxs-lookup"><span data-stu-id="5dce4-127">Like in the other folders, `Default.aspx` in the `CustomButtons` folder will list the tutorials in its section.</span></span> <span data-ttu-id="5dce4-128">Вспомним, что `SectionLevelTutorialListing.ascx` пользовательский элемент управления предоставляет эти функции.</span><span class="sxs-lookup"><span data-stu-id="5dce4-128">Recall that the `SectionLevelTutorialListing.ascx` User Control provides this functionality.</span></span> <span data-ttu-id="5dce4-129">Таким образом, добавьте этот пользовательский элемент управления в `Default.aspx`, перетащив его из обозреватель решений на страницу s представление конструирования.</span><span class="sxs-lookup"><span data-stu-id="5dce4-129">Therefore, add this User Control to `Default.aspx` by dragging it from the Solution Explorer onto the page s Design view.</span></span>

<span data-ttu-id="5dce4-130">[![добавить пользовательский элемент управления SectionLevelTutorialListing. ascx в Default. aspx](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image6.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="5dce4-130">[![Add the SectionLevelTutorialListing.ascx User Control to Default.aspx](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image6.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image5.png)</span></span>

<span data-ttu-id="5dce4-131">**Рис. 3**. Добавление пользовательского элемента управления `SectionLevelTutorialListing.ascx` в `Default.aspx` ([щелкните, чтобы просмотреть изображение с полным размером](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image7.png))</span><span class="sxs-lookup"><span data-stu-id="5dce4-131">**Figure 3**: Add the `SectionLevelTutorialListing.ascx` User Control to `Default.aspx` ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image7.png))</span></span>

<span data-ttu-id="5dce4-132">Наконец, добавьте страницы в качестве записей в файл `Web.sitemap`.</span><span class="sxs-lookup"><span data-stu-id="5dce4-132">Lastly, add the pages as entries to the `Web.sitemap` file.</span></span> <span data-ttu-id="5dce4-133">В частности, добавьте следующую разметку после разбиения на страницы и сортировки `<siteMapNode>`:</span><span class="sxs-lookup"><span data-stu-id="5dce4-133">Specifically, add the following markup after the Paging and Sorting `<siteMapNode>`:</span></span>

[!code-xml[Main](adding-and-responding-to-buttons-to-a-gridview-vb/samples/sample1.xml)]

<span data-ttu-id="5dce4-134">После обновления `Web.sitemap`просмотрите веб-сайт учебников в браузере.</span><span class="sxs-lookup"><span data-stu-id="5dce4-134">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="5dce4-135">В меню слева теперь содержатся элементы для учебников по редактированию, вставке и удалению.</span><span class="sxs-lookup"><span data-stu-id="5dce4-135">The menu on the left now includes items for the editing, inserting, and deleting tutorials.</span></span>

![На карте узла теперь есть запись для учебника по настраиваемым кнопкам](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image8.png)

<span data-ttu-id="5dce4-137">**Рис. 4**. в карте узла теперь есть запись для учебника по настраиваемым кнопкам</span><span class="sxs-lookup"><span data-stu-id="5dce4-137">**Figure 4**: The Site Map Now Includes the Entry for the Custom Buttons Tutorial</span></span>

## <a name="step-2-adding-a-formview-that-lists-the-suppliers"></a><span data-ttu-id="5dce4-138">Шаг 2. Добавление элемента FormView, содержащего список поставщиков</span><span class="sxs-lookup"><span data-stu-id="5dce4-138">Step 2: Adding a FormView that Lists the Suppliers</span></span>

<span data-ttu-id="5dce4-139">Давайте приступим к работе с этим руководством, добавив FormView, в котором перечислены поставщики.</span><span class="sxs-lookup"><span data-stu-id="5dce4-139">Let s get started with this tutorial by adding the FormView that lists the suppliers.</span></span> <span data-ttu-id="5dce4-140">Как обсуждалось во введении, этот FormView позволит пользователю пролистывать поставщиков, отображая продукты, предоставленные поставщиком в GridView.</span><span class="sxs-lookup"><span data-stu-id="5dce4-140">As discussed in the Introduction, this FormView will allow the user to page through the suppliers, showing the products provided by the supplier in a GridView.</span></span> <span data-ttu-id="5dce4-141">Кроме того, в этот FormView будет включена кнопка, которая при нажатии пометит все продукты поставщика как снятые с работы.</span><span class="sxs-lookup"><span data-stu-id="5dce4-141">Additionally, this FormView will include a Button that, when clicked, will mark all of the supplier s products as discontinued.</span></span> <span data-ttu-id="5dce4-142">Прежде чем приступить к работе с добавлением пользовательской кнопки в FormView, давайте сначала создадим FormView, чтобы отобразить сведения о поставщике.</span><span class="sxs-lookup"><span data-stu-id="5dce4-142">Before we concern ourselves with adding the custom button to the FormView, let s first just create the FormView so that it displays the supplier information.</span></span>

<span data-ttu-id="5dce4-143">Для начала откройте страницу `CustomButtons.aspx` в папке `CustomButtons`.</span><span class="sxs-lookup"><span data-stu-id="5dce4-143">Start by opening the `CustomButtons.aspx` page in the `CustomButtons` folder.</span></span> <span data-ttu-id="5dce4-144">Добавьте элемент FormView на страницу, перетащив его с панели элементов в конструктор, и задайте для его свойства `ID` значение `Suppliers`.</span><span class="sxs-lookup"><span data-stu-id="5dce4-144">Add a FormView to the page by dragging it from the Toolbox onto the Designer and set its `ID` property to `Suppliers`.</span></span> <span data-ttu-id="5dce4-145">В смарт-теге FormView s выберите создать новый элемент управления ObjectDataSource с именем `SuppliersDataSource`.</span><span class="sxs-lookup"><span data-stu-id="5dce4-145">From the FormView s smart tag, opt to create a new ObjectDataSource named `SuppliersDataSource`.</span></span>

<span data-ttu-id="5dce4-146">[![создать новый элемент управления ObjectDataSource с именем Супплиерсдатасаурце](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image10.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="5dce4-146">[![Create a New ObjectDataSource Named SuppliersDataSource](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image10.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image9.png)</span></span>

<span data-ttu-id="5dce4-147">**Рис. 5**. Создание нового элемента управления ObjectDataSource с именем `SuppliersDataSource` ([щелкните, чтобы просмотреть изображение с полным размером](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image11.png))</span><span class="sxs-lookup"><span data-stu-id="5dce4-147">**Figure 5**: Create a New ObjectDataSource Named `SuppliersDataSource` ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image11.png))</span></span>

<span data-ttu-id="5dce4-148">Настройте этот новый элемент ObjectDataSource таким способом, чтобы он запрашивается из метода `GetSuppliers()` `SuppliersBLL` классов (см. рис. 6).</span><span class="sxs-lookup"><span data-stu-id="5dce4-148">Configure this new ObjectDataSource such that it queries from the `SuppliersBLL` class s `GetSuppliers()` method (see Figure 6).</span></span> <span data-ttu-id="5dce4-149">Поскольку этот элемент FormView не предоставляет интерфейс для обновления сведений о поставщике, выберите параметр (нет) в раскрывающемся списке на вкладке обновление.</span><span class="sxs-lookup"><span data-stu-id="5dce4-149">Since this FormView does not provide an interface for updating the supplier information, select the (None) option from the drop-down list in the UPDATE tab.</span></span>

<span data-ttu-id="5dce4-150">[![настроить источник данных для использования метода Супплиерсблл класса s ()](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image13.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image12.png)</span><span class="sxs-lookup"><span data-stu-id="5dce4-150">[![Configure the Data Source to use the SuppliersBLL Class s GetSuppliers() Method](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image13.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image12.png)</span></span>

<span data-ttu-id="5dce4-151">**Рис. 6**. Настройка источника данных на использование метода `GetSuppliers()` `SuppliersBLL` классов ([щелкните, чтобы просмотреть изображение с полным размером](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="5dce4-151">**Figure 6**: Configure the Data Source to use the `SuppliersBLL` Class s `GetSuppliers()` Method ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image14.png))</span></span>

<span data-ttu-id="5dce4-152">После настройки ObjectDataSource Visual Studio создаст `InsertItemTemplate`, `EditItemTemplate`и `ItemTemplate` для FormView.</span><span class="sxs-lookup"><span data-stu-id="5dce4-152">After configuring the ObjectDataSource, Visual Studio will generate an `InsertItemTemplate`, `EditItemTemplate`, and `ItemTemplate` for the FormView.</span></span> <span data-ttu-id="5dce4-153">Удалите `InsertItemTemplate` и `EditItemTemplate` и измените `ItemTemplate`, чтобы в нем отображалось только название компании поставщика и номер телефона.</span><span class="sxs-lookup"><span data-stu-id="5dce4-153">Remove the `InsertItemTemplate` and `EditItemTemplate` and modify the `ItemTemplate` so that it displays just the supplier s company name and phone number.</span></span> <span data-ttu-id="5dce4-154">Наконец, включите поддержку разбиения по страницам для FormView, установив флажок Включить разбиение по страницам из своего смарт-тега (или задав для свойства `AllowPaging` значение `True`).</span><span class="sxs-lookup"><span data-stu-id="5dce4-154">Finally, turn on paging support for the FormView by checking the Enable Paging checkbox from its smart tag (or by setting its `AllowPaging` property to `True`).</span></span> <span data-ttu-id="5dce4-155">После внесения этих изменений декларативная разметка страницы должна выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="5dce4-155">After these changes your page s declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](adding-and-responding-to-buttons-to-a-gridview-vb/samples/sample2.aspx)]

<span data-ttu-id="5dce4-156">На рис. 7 показана страница CustomButtons. aspx при просмотре в браузере.</span><span class="sxs-lookup"><span data-stu-id="5dce4-156">Figure 7 shows the CustomButtons.aspx page when viewed through a browser.</span></span>

<span data-ttu-id="5dce4-157">[![FormView содержит поля CompanyName и Phone для текущего выбранного поставщика.](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image16.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="5dce4-157">[![The FormView Lists the CompanyName and Phone Fields from the Currently Selected Supplier](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image16.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image15.png)</span></span>

<span data-ttu-id="5dce4-158">**Рис. 7**. список полей `CompanyName` и `Phone` из выбранного в данный момент поставщика ([щелкните, чтобы просмотреть изображение с полным размером](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image17.png))</span><span class="sxs-lookup"><span data-stu-id="5dce4-158">**Figure 7**: The FormView Lists the `CompanyName` and `Phone` Fields from the Currently Selected Supplier ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image17.png))</span></span>

## <a name="step-3-adding-a-gridview-that-lists-the-selected-supplier-s-products"></a><span data-ttu-id="5dce4-159">Шаг 3. Добавление элемента управления GridView, содержащего список выбранных продуктов поставщика</span><span class="sxs-lookup"><span data-stu-id="5dce4-159">Step 3: Adding a GridView that Lists the Selected Supplier s Products</span></span>

<span data-ttu-id="5dce4-160">Прежде чем добавить кнопку "прекратить все продукты" к шаблону FormView, давайте сначала добавим элемент управления GridView под элементом FormView, в котором перечислены продукты, предоставляемые выбранным поставщиком.</span><span class="sxs-lookup"><span data-stu-id="5dce4-160">Before we add the Discontinue All Products Button to the FormView s template, let s first add a GridView beneath the FormView that lists the products provided by the selected supplier.</span></span> <span data-ttu-id="5dce4-161">Для этого добавьте GridView на страницу, задайте для свойства `ID` значение `SuppliersProducts`и добавьте новый элемент управления ObjectDataSource с именем `SuppliersProductsDataSource`.</span><span class="sxs-lookup"><span data-stu-id="5dce4-161">To accomplish this, add a GridView to the page, set its `ID` property to `SuppliersProducts`, and add a new ObjectDataSource named `SuppliersProductsDataSource`.</span></span>

<span data-ttu-id="5dce4-162">[![создать новый элемент управления ObjectDataSource с именем Супплиерспродуктсдатасаурце](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image19.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image18.png)</span><span class="sxs-lookup"><span data-stu-id="5dce4-162">[![Create a New ObjectDataSource Named SuppliersProductsDataSource](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image19.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image18.png)</span></span>

<span data-ttu-id="5dce4-163">**Рис. 8**. Создание нового элемента управления ObjectDataSource с именем `SuppliersProductsDataSource` ([щелкните, чтобы просмотреть изображение с полным размером](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="5dce4-163">**Figure 8**: Create a New ObjectDataSource Named `SuppliersProductsDataSource` ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image20.png))</span></span>

<span data-ttu-id="5dce4-164">Настройте этот элемент ObjectDataSource для использования метода `GetProductsBySupplierID(supplierID)` класса ProductsBLL (см. рис. 9).</span><span class="sxs-lookup"><span data-stu-id="5dce4-164">Configure this ObjectDataSource to use the ProductsBLL class s `GetProductsBySupplierID(supplierID)` method (see Figure 9).</span></span> <span data-ttu-id="5dce4-165">Хотя этот элемент GridView позволяет корректировать цену продукта, он не будет использовать встроенные функции редактирования или удаления из GridView.</span><span class="sxs-lookup"><span data-stu-id="5dce4-165">While this GridView will allow for a product s price to be adjusted, it won't be using the built-in editing or deleting features from the GridView.</span></span> <span data-ttu-id="5dce4-166">Поэтому в раскрывающемся списке можно задать значение (нет) для вкладок «обновление», «вставка» и «удаление».</span><span class="sxs-lookup"><span data-stu-id="5dce4-166">Therefore, we can set the drop-down list to (None) for the ObjectDataSource s UPDATE, INSERT, and DELETE tabs.</span></span>

<span data-ttu-id="5dce4-167">[![настроить источник данных для использования метода Жетпродуктсбисупплиерид класса ProductsBLL (КодПоставщика)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image22.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="5dce4-167">[![Configure the Data Source to use the ProductsBLL Class s GetProductsBySupplierID(supplierID) Method](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image22.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image21.png)</span></span>

<span data-ttu-id="5dce4-168">**Рис. 9**. Настройка источника данных на использование метода `GetProductsBySupplierID(supplierID)` `ProductsBLL` классов ([щелкните, чтобы просмотреть изображение с полным размером](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image23.png))</span><span class="sxs-lookup"><span data-stu-id="5dce4-168">**Figure 9**: Configure the Data Source to use the `ProductsBLL` Class s `GetProductsBySupplierID(supplierID)` Method ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image23.png))</span></span>

<span data-ttu-id="5dce4-169">Так как метод `GetProductsBySupplierID(supplierID)` принимает входной параметр, мастер ObjectDataSource предлагает нам указать источник этого значения параметра.</span><span class="sxs-lookup"><span data-stu-id="5dce4-169">Since the `GetProductsBySupplierID(supplierID)` method accepts an input parameter, the ObjectDataSource wizard prompts us for the source of this parameter value.</span></span> <span data-ttu-id="5dce4-170">Чтобы передать значение `SupplierID` из FormView, в раскрывающемся списке Источник параметра выберите элемент Управление, а в раскрывающемся списке ControlID — значение `Suppliers` (идентификатор элемента FormView, созданного на шаге 2).</span><span class="sxs-lookup"><span data-stu-id="5dce4-170">To pass in the `SupplierID` value from the FormView, set the Parameter source drop-down list to Control and the ControlID drop-down list to `Suppliers` (the ID of the FormView created in Step 2).</span></span>

<span data-ttu-id="5dce4-171">[![указать, что параметр «КодПоставщика» должен поступать от элемента управления FormView «поставщики»](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image25.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image24.png)</span><span class="sxs-lookup"><span data-stu-id="5dce4-171">[![Indicate that the supplierID Parameter Should Come from the Suppliers FormView Control](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image25.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image24.png)</span></span>

<span data-ttu-id="5dce4-172">**Рис. 10**. Указание того, что параметр *`supplierID`* должен поступать из `Suppliers` элемента управления FormView ([щелкните, чтобы просмотреть изображение с полным размером](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image26.png))</span><span class="sxs-lookup"><span data-stu-id="5dce4-172">**Figure 10**: Indicate that the *`supplierID`* Parameter Should Come from the `Suppliers` FormView Control ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image26.png))</span></span>

<span data-ttu-id="5dce4-173">После завершения работы мастера ObjectDataSource элемент управления GridView будет содержать BoundField или CheckBoxField для каждого из полей данных Products.</span><span class="sxs-lookup"><span data-stu-id="5dce4-173">After completing the ObjectDataSource wizard, the GridView will contain a BoundField or CheckBoxField for each of the product s data fields.</span></span> <span data-ttu-id="5dce4-174">Разрежьте его так, чтобы отображались только `ProductName` и `UnitPrice` BoundFields вместе с `Discontinued` CheckBoxField; Кроме того, давайте отформатировать `UnitPrice` BoundField таким образом, чтобы его текст был отформатирован как денежная единица.</span><span class="sxs-lookup"><span data-stu-id="5dce4-174">Let s trim this down to show just the `ProductName` and `UnitPrice` BoundFields along with the `Discontinued` CheckBoxField; furthermore, let s format the `UnitPrice` BoundField such that its text is formatted as a currency.</span></span> <span data-ttu-id="5dce4-175">Декларативная разметка GridView и `SuppliersProductsDataSource` ObjectDataSource s должна выглядеть примерно так, как показано в следующей разметке:</span><span class="sxs-lookup"><span data-stu-id="5dce4-175">Your GridView and `SuppliersProductsDataSource` ObjectDataSource s declarative markup should look similar to the following markup:</span></span>

[!code-aspx[Main](adding-and-responding-to-buttons-to-a-gridview-vb/samples/sample3.aspx)]

<span data-ttu-id="5dce4-176">На этом этапе в нашем учебном курсе отображается отчет «основной/подробности», позволяющий пользователю выбрать поставщика из FormView в верхней части экрана и просмотреть продукты, предоставленные этим поставщиком, с помощью элемента управления GridView внизу.</span><span class="sxs-lookup"><span data-stu-id="5dce4-176">At this point our tutorial displays a master/details report, allowing the user to pick a supplier from the FormView at the top and to view the products provided by that supplier through the GridView at the bottom.</span></span> <span data-ttu-id="5dce4-177">На рис. 11 показан снимок экрана этой страницы при выборе поставщика компании Токио из FormView.</span><span class="sxs-lookup"><span data-stu-id="5dce4-177">Figure 11 shows a screen shot of this page when selecting the Tokyo Traders supplier from the FormView.</span></span>

<span data-ttu-id="5dce4-178">[![выбранные продукты поставщика отображаются в GridView](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image28.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="5dce4-178">[![The Selected Supplier s Products are Displayed in the GridView](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image28.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image27.png)</span></span>

<span data-ttu-id="5dce4-179">**Рис. 11**. выбранные продукты поставщика отображаются в элементе управления GridView ([щелкните, чтобы просмотреть изображение с полным размером](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image29.png))</span><span class="sxs-lookup"><span data-stu-id="5dce4-179">**Figure 11**: The Selected Supplier s Products are Displayed in the GridView ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image29.png))</span></span>

## <a name="step-4-creating-dal-and-bll-methods-to-discontinue-all-products-for-a-supplier"></a><span data-ttu-id="5dce4-180">Шаг 4. Создание методов DAL и BLL для прекращения всех продуктов для поставщика</span><span class="sxs-lookup"><span data-stu-id="5dce4-180">Step 4: Creating DAL and BLL Methods to Discontinue All Products for a Supplier</span></span>

<span data-ttu-id="5dce4-181">Прежде чем можно будет добавить кнопку в FormView, которая при нажатии отменяет все продукты поставщика, сначала необходимо добавить метод в DAL и BLL, выполняющие это действие.</span><span class="sxs-lookup"><span data-stu-id="5dce4-181">Before we can add a Button to the FormView that, when clicked, discontinues all of the supplier s products, we first need to add a method to both the DAL and BLL that performs this action.</span></span> <span data-ttu-id="5dce4-182">В частности, этот метод будет называться `DiscontinueAllProductsForSupplier(supplierID)`.</span><span class="sxs-lookup"><span data-stu-id="5dce4-182">In particular, this method will be named `DiscontinueAllProductsForSupplier(supplierID)`.</span></span> <span data-ttu-id="5dce4-183">При нажатии кнопки FormView s Этот метод будет вызываться на уровне бизнес-логики, передавая выбранному поставщику `SupplierID`. затем BLL обращается к соответствующему методу уровня доступа к данным, который будет выдавать инструкцию `UPDATE` базе данных, которая прекращает работу указанных продуктов поставщика.</span><span class="sxs-lookup"><span data-stu-id="5dce4-183">When the FormView s Button is clicked, we'll invoke this method in the Business Logic Layer, passing in the selected supplier s `SupplierID`; the BLL will then call down to the corresponding Data Access Layer method, which will issue an `UPDATE` statement to the database that discontinues the specified supplier s products.</span></span>

<span data-ttu-id="5dce4-184">Как мы сделали в предыдущих руководствах, мы будем использовать подход снизу вверх, начиная с создания метода DAL, затем метод BLL и заканчивая реализацией функций на странице ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="5dce4-184">As we have done in our previous tutorials, we'll use a bottom-up approach, starting with creating the DAL method, then the BLL method, and finally implementing the functionality in the ASP.NET page.</span></span> <span data-ttu-id="5dce4-185">Откройте `Northwind.xsd` типизированный набор данных в папке `App_Code/DAL` и добавьте новый метод в `ProductsTableAdapter` (щелкните правой кнопкой мыши `ProductsTableAdapter` и выберите команду Добавить запрос).</span><span class="sxs-lookup"><span data-stu-id="5dce4-185">Open the `Northwind.xsd` Typed DataSet in the `App_Code/DAL` folder and add a new method to the `ProductsTableAdapter` (right-click on the `ProductsTableAdapter` and choose Add Query).</span></span> <span data-ttu-id="5dce4-186">При этом откроется мастер настройки запросов адаптера таблицы TableAdapter, который познакомит нас с процессом добавления нового метода.</span><span class="sxs-lookup"><span data-stu-id="5dce4-186">Doing so will bring up the TableAdapter Query Configuration wizard, which walks us through the process of adding the new method.</span></span> <span data-ttu-id="5dce4-187">Начните с указания того, что наш метод DAL будет использовать специальный оператор SQL.</span><span class="sxs-lookup"><span data-stu-id="5dce4-187">Start by indicating that our DAL method will use an ad-hoc SQL statement.</span></span>

<span data-ttu-id="5dce4-188">[![создания метода DAL с помощью специального оператора SQL](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image31.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image30.png)</span><span class="sxs-lookup"><span data-stu-id="5dce4-188">[![Create the DAL Method Using an Ad-Hoc SQL Statement](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image31.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image30.png)</span></span>

<span data-ttu-id="5dce4-189">**Рис. 12**. Создание метода DAL с помощью специального оператора SQL ([щелкните, чтобы просмотреть изображение с полным размером](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image32.png))</span><span class="sxs-lookup"><span data-stu-id="5dce4-189">**Figure 12**: Create the DAL Method Using an Ad-Hoc SQL Statement ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image32.png))</span></span>

<span data-ttu-id="5dce4-190">Затем мастер запрашивает тип создаваемого запроса.</span><span class="sxs-lookup"><span data-stu-id="5dce4-190">Next, the wizard prompts us as to what type of query to create.</span></span> <span data-ttu-id="5dce4-191">Так как методу `DiscontinueAllProductsForSupplier(supplierID)` потребуется обновить таблицу `Products` базы данных, задав для поля `Discontinued` значение 1 для всех продуктов, предоставленных указанным *`supplierID`* , необходимо создать запрос, обновляющий данные.</span><span class="sxs-lookup"><span data-stu-id="5dce4-191">Since the `DiscontinueAllProductsForSupplier(supplierID)` method will need to update the `Products` database table, setting the `Discontinued` field to 1 for all products provided by the specified *`supplierID`*, we need to create a query that updates data.</span></span>

<span data-ttu-id="5dce4-192">[![выбрать тип запроса обновления](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image34.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image33.png)</span><span class="sxs-lookup"><span data-stu-id="5dce4-192">[![Choose the UPDATE Query Type](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image34.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image33.png)</span></span>

<span data-ttu-id="5dce4-193">**Рис. 13**. Выбор типа запроса на обновление ([щелкните, чтобы просмотреть изображение с полным размером](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image35.png))</span><span class="sxs-lookup"><span data-stu-id="5dce4-193">**Figure 13**: Choose the UPDATE Query Type ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image35.png))</span></span>

<span data-ttu-id="5dce4-194">Следующий экран мастера предоставляет существующую инструкцию `UPDATE` TableAdapter, которая обновляет каждое из полей, определенных в `Products` DataTable.</span><span class="sxs-lookup"><span data-stu-id="5dce4-194">The next wizard screen provides the TableAdapter s existing `UPDATE` statement, which updates each of the fields defined in the `Products` DataTable.</span></span> <span data-ttu-id="5dce4-195">Замените текст запроса следующей инструкцией:</span><span class="sxs-lookup"><span data-stu-id="5dce4-195">Replace this query text with the following statement:</span></span>

[!code-sql[Main](adding-and-responding-to-buttons-to-a-gridview-vb/samples/sample4.sql)]

<span data-ttu-id="5dce4-196">После ввода этого запроса и нажатия кнопки "Далее" на последнем экране мастера запрашивается имя нового метода. Используйте `DiscontinueAllProductsForSupplier`.</span><span class="sxs-lookup"><span data-stu-id="5dce4-196">After entering this query and clicking Next, the last wizard screen asks for the new method s name use `DiscontinueAllProductsForSupplier`.</span></span> <span data-ttu-id="5dce4-197">Завершите работу мастера, нажав кнопку Готово.</span><span class="sxs-lookup"><span data-stu-id="5dce4-197">Complete the wizard by clicking the Finish button.</span></span> <span data-ttu-id="5dce4-198">При возврате в конструктор наборов данных вы должны увидеть новый метод в `ProductsTableAdapter` с именем `DiscontinueAllProductsForSupplier(@SupplierID)`.</span><span class="sxs-lookup"><span data-stu-id="5dce4-198">Upon returning to the DataSet Designer you should see a new method in the `ProductsTableAdapter` named `DiscontinueAllProductsForSupplier(@SupplierID)`.</span></span>

<span data-ttu-id="5dce4-199">[![назовите новый метод DAL Дисконтинуеаллпродуктсфорсупплиер](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image37.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image36.png)</span><span class="sxs-lookup"><span data-stu-id="5dce4-199">[![Name the New DAL Method DiscontinueAllProductsForSupplier](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image37.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image36.png)</span></span>

<span data-ttu-id="5dce4-200">**Рис. 14**. Именование нового метода DAL `DiscontinueAllProductsForSupplier` ([щелкните, чтобы просмотреть изображение с полным размером](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image38.png))</span><span class="sxs-lookup"><span data-stu-id="5dce4-200">**Figure 14**: Name the New DAL Method `DiscontinueAllProductsForSupplier` ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image38.png))</span></span>

<span data-ttu-id="5dce4-201">С помощью метода `DiscontinueAllProductsForSupplier(supplierID)`, созданного на уровне доступа к данным, наша следующая задача — создать метод `DiscontinueAllProductsForSupplier(supplierID)` на уровне бизнес-логики.</span><span class="sxs-lookup"><span data-stu-id="5dce4-201">With the `DiscontinueAllProductsForSupplier(supplierID)` method created in the Data Access Layer, our next task is to create the `DiscontinueAllProductsForSupplier(supplierID)` method in the Business Logic Layer.</span></span> <span data-ttu-id="5dce4-202">Для этого откройте файл `ProductsBLL` класса и добавьте следующее:</span><span class="sxs-lookup"><span data-stu-id="5dce4-202">To accomplish this, open the `ProductsBLL` class file and add the following:</span></span>

[!code-vb[Main](adding-and-responding-to-buttons-to-a-gridview-vb/samples/sample5.vb)]

<span data-ttu-id="5dce4-203">Этот метод просто вызывает метод `DiscontinueAllProductsForSupplier(supplierID)` в DAL, передавая предоставленное значение параметра *`supplierID`* .</span><span class="sxs-lookup"><span data-stu-id="5dce4-203">This method simply calls down to the `DiscontinueAllProductsForSupplier(supplierID)` method in the DAL, passing along the provided *`supplierID`* parameter value.</span></span> <span data-ttu-id="5dce4-204">Если существовали бизнес-правила, которые позволили бы больше не поддерживать продукты поставщика при определенных обстоятельствах, эти правила должны быть реализованы в BLL.</span><span class="sxs-lookup"><span data-stu-id="5dce4-204">If there were any business rules that only allowed a supplier s products to be discontinued under certain circumstances, those rules should be implemented here, in the BLL.</span></span>

> [!NOTE]
> <span data-ttu-id="5dce4-205">В отличие от перегрузок `UpdateProduct` в классе `ProductsBLL`, сигнатура метода `DiscontinueAllProductsForSupplier(supplierID)` не включает атрибут `DataObjectMethodAttribute` (`<System.ComponentModel.DataObjectMethodAttribute(System.ComponentModel.DataObjectMethodType.Update, Boolean)>`).</span><span class="sxs-lookup"><span data-stu-id="5dce4-205">Unlike the `UpdateProduct` overloads in the `ProductsBLL` class, the `DiscontinueAllProductsForSupplier(supplierID)` method signature does not include the `DataObjectMethodAttribute` attribute (`<System.ComponentModel.DataObjectMethodAttribute(System.ComponentModel.DataObjectMethodType.Update, Boolean)>`).</span></span> <span data-ttu-id="5dce4-206">Это исключает возможность `DiscontinueAllProductsForSupplier(supplierID)` метода из раскрывающегося списка мастера настройки источника данных на вкладке обновление. Этот атрибут опущен, так как мы будем вызывать метод `DiscontinueAllProductsForSupplier(supplierID)` непосредственно из обработчика событий на нашей странице ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="5dce4-206">This precludes the `DiscontinueAllProductsForSupplier(supplierID)` method from the ObjectDataSource s Configure Data Source wizard s drop-down list in the UPDATE tab. I ve omitted this attribute because we'll be calling the `DiscontinueAllProductsForSupplier(supplierID)` method directly from an event handler in our ASP.NET page.</span></span>

## <a name="step-5-adding-a-discontinue-all-products-button-to-the-formview"></a><span data-ttu-id="5dce4-207">Шаг 5. Добавление кнопки "прекратить все продукты" в FormView</span><span class="sxs-lookup"><span data-stu-id="5dce4-207">Step 5: Adding a Discontinue All Products Button to the FormView</span></span>

<span data-ttu-id="5dce4-208">При завершении метода `DiscontinueAllProductsForSupplier(supplierID)` в BLL и DAL последним шагом добавить возможность прекращения всех продуктов для выбранного поставщика является добавление веб-элемента управления Button в `ItemTemplate`FormView.</span><span class="sxs-lookup"><span data-stu-id="5dce4-208">With the `DiscontinueAllProductsForSupplier(supplierID)` method in the BLL and DAL complete, the final step for adding the ability to discontinue all products for the selected supplier is to add a Button Web control to the FormView s `ItemTemplate`.</span></span> <span data-ttu-id="5dce4-209">Добавим такую кнопку под номером телефона поставщика с текстом кнопки, прекратить все продукты и `ID` значение свойства `DiscontinueAllProductsForSupplier`.</span><span class="sxs-lookup"><span data-stu-id="5dce4-209">Let s add such a Button below the supplier s phone number with the button text, Discontinue All Products and an `ID` property value of `DiscontinueAllProductsForSupplier`.</span></span> <span data-ttu-id="5dce4-210">Этот веб-элемент управления этой кнопки можно добавить через конструктор, щелкнув ссылку Edit Templates (изменить шаблоны) в смарт-теге FormView (см. рис. 15) или напрямую с помощью декларативного синтаксиса.</span><span class="sxs-lookup"><span data-stu-id="5dce4-210">You can add this Button Web control through the Designer by clicking on the Edit Templates link in the FormView s smart tag (see Figure 15), or directly through the declarative syntax.</span></span>

<span data-ttu-id="5dce4-211">[![добавить веб-элемент управления "прекратить все продукты" для кнопки FormView s ItemTemplate](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image40.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image39.png)</span><span class="sxs-lookup"><span data-stu-id="5dce4-211">[![Add a Discontinue All Products Button Web Control to the FormView s ItemTemplate](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image40.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image39.png)</span></span>

<span data-ttu-id="5dce4-212">**Рис. 15**. Добавление веб-элемента управления "прекратить все продукты" в `ItemTemplate` FormView s ([щелкните, чтобы просмотреть изображение с полным размером](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image41.png))</span><span class="sxs-lookup"><span data-stu-id="5dce4-212">**Figure 15**: Add a Discontinue All Products Button Web Control to the FormView s `ItemTemplate` ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image41.png))</span></span>

<span data-ttu-id="5dce4-213">При нажатии кнопки пользователем происходит обратная передача, и срабатывает [событие`ItemCommand`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.formview.itemcommand.aspx) FormView.</span><span class="sxs-lookup"><span data-stu-id="5dce4-213">When the Button is clicked by a user visiting the page, a postback ensues and the FormView s [`ItemCommand` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.formview.itemcommand.aspx) fires.</span></span> <span data-ttu-id="5dce4-214">Для выполнения пользовательского кода в ответ на нажатие этой кнопки можно создать обработчик событий для этого события.</span><span class="sxs-lookup"><span data-stu-id="5dce4-214">To execute custom code in response to this Button being clicked, we can create an event handler for this event.</span></span> <span data-ttu-id="5dce4-215">Однако следует понимать, что событие `ItemCommand` срабатывает при щелчке элемента управления FormView *любой* кнопки, LinkButton или ImageButton.</span><span class="sxs-lookup"><span data-stu-id="5dce4-215">Understand, though, that the `ItemCommand` event fires whenever *any* Button, LinkButton, or ImageButton Web control is clicked within the FormView.</span></span> <span data-ttu-id="5dce4-216">Это означает, что при переходе пользователя с одной страницы на другую в FormView возникает событие `ItemCommand`. то же самое, когда пользователь нажимает кнопку "создать", "Изменить" или "Удалить" в элементе FormView, поддерживающем вставку, обновление или удаление.</span><span class="sxs-lookup"><span data-stu-id="5dce4-216">That means that when the user moves from one page to another in the FormView, the `ItemCommand` event fires; same thing when the user clicks New, Edit, or Delete in a FormView that supports inserting, updating, or deleting.</span></span>

<span data-ttu-id="5dce4-217">Поскольку `ItemCommand` срабатывает независимо от того, какая кнопка нажата, в обработчике событий требуется способ определить, была ли нажата кнопка «прекратить все продукты» или была ли другая кнопка.</span><span class="sxs-lookup"><span data-stu-id="5dce4-217">Since the `ItemCommand` fires regardless of what button is clicked, in the event handler we need a way to determine if the Discontinue All Products Button was clicked or if it was some other button.</span></span> <span data-ttu-id="5dce4-218">Для этого можно присвоить свойству `CommandName` веб-элемента управления "Button" определенное идентифицирующее значение.</span><span class="sxs-lookup"><span data-stu-id="5dce4-218">To accomplish this, we can set the Button Web control s `CommandName` property to some identifying value.</span></span> <span data-ttu-id="5dce4-219">При нажатии кнопки это `CommandName` значение передается в обработчик событий `ItemCommand`, что позволяет нам определить, была ли нажата кнопка «прекратить все продукты».</span><span class="sxs-lookup"><span data-stu-id="5dce4-219">When the Button is clicked, this `CommandName` value is passed into the `ItemCommand` event handler, enabling us to determine whether the Discontinue All Products Button was the button clicked.</span></span> <span data-ttu-id="5dce4-220">Установите для свойства `CommandName` "прекратить все продукты" значение "Дисконтинуепродуктс".</span><span class="sxs-lookup"><span data-stu-id="5dce4-220">Set the Discontinue All Products Button s `CommandName` property to DiscontinueProducts .</span></span>

<span data-ttu-id="5dce4-221">Наконец, давайте попробуем использовать диалоговое окно подтверждения на стороне клиента, чтобы убедиться, что пользователь действительно хочет прекратить работу выбранных продуктов поставщика.</span><span class="sxs-lookup"><span data-stu-id="5dce4-221">Finally, let s use a client-side confirm dialog box to ensure that the user really wants to discontinue the selected supplier s products.</span></span> <span data-ttu-id="5dce4-222">Как было показано в статье [Добавление подтверждения на стороне клиента при удалении](../editing-inserting-and-deleting-data/adding-client-side-confirmation-when-deleting-vb.md) учебника, это можно сделать с помощью нескольких сценариев JavaScript.</span><span class="sxs-lookup"><span data-stu-id="5dce4-222">As we saw in the [Adding Client-Side Confirmation When Deleting](../editing-inserting-and-deleting-data/adding-client-side-confirmation-when-deleting-vb.md) tutorial, this can be accomplished with a bit of JavaScript.</span></span> <span data-ttu-id="5dce4-223">В частности, задайте для свойства OnClientClick элемента управления "Кнопка" значение `return confirm('This will mark _all_ of this supplier\'s products as discontinued. Are you certain you want to do this?');`</span><span class="sxs-lookup"><span data-stu-id="5dce4-223">In particular, set the Button Web control s OnClientClick property to `return confirm('This will mark _all_ of this supplier\'s products as discontinued. Are you certain you want to do this?');`</span></span>

<span data-ttu-id="5dce4-224">После внесения этих изменений декларативный синтаксис FormView s должен выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="5dce4-224">After making these changes, the FormView s declarative syntax should look like the following:</span></span>

[!code-aspx[Main](adding-and-responding-to-buttons-to-a-gridview-vb/samples/sample6.aspx)]

<span data-ttu-id="5dce4-225">Затем создайте обработчик событий для события `ItemCommand` FormView.</span><span class="sxs-lookup"><span data-stu-id="5dce4-225">Next, create an event handler for the FormView s `ItemCommand` event.</span></span> <span data-ttu-id="5dce4-226">В этом обработчике событий необходимо сначала определить, была ли нажата кнопка "прекратить все продукты".</span><span class="sxs-lookup"><span data-stu-id="5dce4-226">In this event handler we need to first determine whether the Discontinue All Products Button was clicked.</span></span> <span data-ttu-id="5dce4-227">Если да, необходимо создать экземпляр класса `ProductsBLL` и вызвать его метод `DiscontinueAllProductsForSupplier(supplierID)`, передав `SupplierID` выбранного FormView:</span><span class="sxs-lookup"><span data-stu-id="5dce4-227">If so, we want to create an instance of the `ProductsBLL` class and invoke its `DiscontinueAllProductsForSupplier(supplierID)` method, passing in the `SupplierID` of the selected FormView:</span></span>

[!code-vb[Main](adding-and-responding-to-buttons-to-a-gridview-vb/samples/sample7.vb)]

<span data-ttu-id="5dce4-228">Обратите внимание, что `SupplierID` текущего выбранного поставщика в FormView можно получить с помощью [свойства`SelectedValue`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.formview.selectedvalue.aspx)FormView.</span><span class="sxs-lookup"><span data-stu-id="5dce4-228">Note that the `SupplierID` of the current selected supplier in the FormView can be accessed using the FormView s [`SelectedValue` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.formview.selectedvalue.aspx).</span></span> <span data-ttu-id="5dce4-229">Свойство `SelectedValue` возвращает первое значение ключа данных для записи, отображаемой в FormView.</span><span class="sxs-lookup"><span data-stu-id="5dce4-229">The `SelectedValue` property returns the first data key value for the record being displayed in the FormView.</span></span> <span data-ttu-id="5dce4-230">[Свойство FormView`DataKeyNames`](https://msdn.microsoft.com/system.web.ui.webcontrols.formview.datakeynames.aspx), которое указывает поля данных, из которых извлекаются значения ключей данных, автоматически задается `SupplierID` в Visual Studio при привязке ObjectDataSource к элементу управления FormView на шаге 2.</span><span class="sxs-lookup"><span data-stu-id="5dce4-230">The FormView s [`DataKeyNames` property](https://msdn.microsoft.com/system.web.ui.webcontrols.formview.datakeynames.aspx), which indicates the data fields from which the data key values are pulled from, was automatically set to `SupplierID` by Visual Studio when binding the ObjectDataSource to the FormView back in Step 2.</span></span>

<span data-ttu-id="5dce4-231">После создания обработчика событий `ItemCommand` уделите время на тестирование страницы.</span><span class="sxs-lookup"><span data-stu-id="5dce4-231">With the `ItemCommand` event handler created, take a moment to test out the page.</span></span> <span data-ttu-id="5dce4-232">Перейдите к поставщику Cooperativa de Quesos "Лас Кабрас" (он — это пятый поставщик в FormView для меня).</span><span class="sxs-lookup"><span data-stu-id="5dce4-232">Browse to the Cooperativa de Quesos 'Las Cabras' supplier (it s the fifth supplier in the FormView for me).</span></span> <span data-ttu-id="5dce4-233">Этот поставщик предоставляет два продукта: Queso Cabrales и Queso Manchego La Pastore, которые больше *не* поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="5dce4-233">This supplier provides two products, Queso Cabrales and Queso Manchego La Pastora, both of which are *not* discontinued.</span></span>

<span data-ttu-id="5dce4-234">Представьте, что Cooperativa де Quesos ' Лас Кабрас ' закончился в бизнесе, поэтому его продукты будут прекращены.</span><span class="sxs-lookup"><span data-stu-id="5dce4-234">Imagine that Cooperativa de Quesos 'Las Cabras' has gone out of business and therefore its products are to be discontinued.</span></span> <span data-ttu-id="5dce4-235">Нажмите кнопку "прекратить все продукты".</span><span class="sxs-lookup"><span data-stu-id="5dce4-235">Click the Discontinue All Products Button.</span></span> <span data-ttu-id="5dce4-236">Отобразится диалоговое окно подтверждения на стороне клиента (см. рис. 16).</span><span class="sxs-lookup"><span data-stu-id="5dce4-236">This will display the client-side confirm dialog box (see Figure 16).</span></span>

<span data-ttu-id="5dce4-237">[![Cooperativa de Quesos Лас Кабрас предоставляет два активных продукта](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image43.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image42.png)</span><span class="sxs-lookup"><span data-stu-id="5dce4-237">[![Cooperativa de Quesos Las Cabras Supplies Two Active Products](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image43.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image42.png)</span></span>

<span data-ttu-id="5dce4-238">**Рис. 16**. Cooperativa de Quesos Лас Кабрас предоставляет два активных продукта ([щелкните, чтобы просмотреть изображение с полным размером](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image44.png))</span><span class="sxs-lookup"><span data-stu-id="5dce4-238">**Figure 16**: Cooperativa de Quesos Las Cabras Supplies Two Active Products ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image44.png))</span></span>

<span data-ttu-id="5dce4-239">Если нажать кнопку ОК в диалоговом окне Подтверждение на стороне клиента, отправка формы будет продолжена, что вызовет обратную передачу, в которой будет срабатывать событие `ItemCommand` FormView.</span><span class="sxs-lookup"><span data-stu-id="5dce4-239">If you click OK in the client-side confirm dialog box, the form submission will proceed, causing a postback in which the FormView s `ItemCommand` event will fire.</span></span> <span data-ttu-id="5dce4-240">Созданный обработчик событий, который затем будет выполнен, вызывает метод `DiscontinueAllProductsForSupplier(supplierID)` и прекращает работу продуктов Queso Cabrales и Queso Manchego La Pastore.</span><span class="sxs-lookup"><span data-stu-id="5dce4-240">The event handler we created will then execute, invoking the `DiscontinueAllProductsForSupplier(supplierID)` method and discontinuing both the Queso Cabrales and Queso Manchego La Pastora products.</span></span>

<span data-ttu-id="5dce4-241">Если вы отключили состояние представления GridView s, элемент управления GridView повторно привязан к базовому хранилищу данных при каждой обратной передаче, и поэтому будет немедленно обновлен, чтобы отразить, что эти два продукта теперь недоступны (см. рис. 17).</span><span class="sxs-lookup"><span data-stu-id="5dce4-241">If you have disabled the GridView s view state, the GridView is being rebound to the underlying data store on every postback, and therefore will immediately be updated to reflect that these two products are now discontinued (see Figure 17).</span></span> <span data-ttu-id="5dce4-242">Однако если вы не отключили состояние представления в GridView, после внесения этого изменения необходимо будет вручную выполнить повторную привязку данных к GridView.</span><span class="sxs-lookup"><span data-stu-id="5dce4-242">If, however, you have not disabled view state in the GridView, you will need to manually rebind the data to the GridView after making this change.</span></span> <span data-ttu-id="5dce4-243">Для этого просто выполните вызов метода `DataBind()` GridView s сразу же после вызова метода `DiscontinueAllProductsForSupplier(supplierID)`.</span><span class="sxs-lookup"><span data-stu-id="5dce4-243">To accomplish this, simply make a call to the GridView s `DataBind()` method immediately after invoking the `DiscontinueAllProductsForSupplier(supplierID)` method.</span></span>

<span data-ttu-id="5dce4-244">[![после нажатия кнопки "прекратить все продукты" продукты поставщика обновляются соответствующим образом](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image46.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image45.png)</span><span class="sxs-lookup"><span data-stu-id="5dce4-244">[![After Clicking the Discontinue All Products Button, the Supplier s Products are Updated Accordingly](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image46.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image45.png)</span></span>

<span data-ttu-id="5dce4-245">**Рис. 17**. После нажатия кнопки "прекратить все продукты" продукты поставщика обновляются соответствующим образом ([щелкните, чтобы просмотреть изображение с полным размером](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image47.png))</span><span class="sxs-lookup"><span data-stu-id="5dce4-245">**Figure 17**: After Clicking the Discontinue All Products Button, the Supplier s Products are Updated Accordingly ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image47.png))</span></span>

## <a name="step-6-creating-an-updateproduct-overload-in-the-business-logic-layer-for-adjusting-a-product-s-price"></a><span data-ttu-id="5dce4-246">Шаг 6. Создание перегрузки UpdateProduct на уровне бизнес-логики для корректировки цены продукта</span><span class="sxs-lookup"><span data-stu-id="5dce4-246">Step 6: Creating an UpdateProduct Overload in the Business Logic Layer for Adjusting a Product s Price</span></span>

<span data-ttu-id="5dce4-247">Как и кнопка "прекратить все продукты" в FormView, чтобы добавить кнопки для увеличения и уменьшения цены на продукт в GridView, необходимо сначала добавить соответствующий уровень доступа к данным и методы уровня бизнес-логики.</span><span class="sxs-lookup"><span data-stu-id="5dce4-247">Like with the Discontinue All Products Button in the FormView, in order to add buttons for increasing and decreasing the price for a product in the GridView we need to first add the appropriate Data Access Layer and Business Logic Layer methods.</span></span> <span data-ttu-id="5dce4-248">Поскольку у нас уже есть метод, который обновляет одну строку продукта в DAL, мы можем предоставить такую функциональность, создав новую перегрузку для метода `UpdateProduct` в BLL.</span><span class="sxs-lookup"><span data-stu-id="5dce4-248">Since we already have a method that updates a single product row in the DAL, we can provide such functionality by creating a new overload for the `UpdateProduct` method in the BLL.</span></span>

<span data-ttu-id="5dce4-249">Наши предыдущие `UpdateProduct` перегрузки производят некоторые сочетания полей продукта в качестве скалярных входных значений и затем обновляют только поля для указанного продукта.</span><span class="sxs-lookup"><span data-stu-id="5dce4-249">Our past `UpdateProduct` overloads have taken in some combination of product fields as scalar input values and have then updated just those fields for the specified product.</span></span> <span data-ttu-id="5dce4-250">Для этой перегрузки мы немного изменяем этот стандарт и передаем `ProductID` продукта и процентную долю, на которую нужно настроить `UnitPrice` (в отличие от передачи нового, скорректированного `UnitPrice`).</span><span class="sxs-lookup"><span data-stu-id="5dce4-250">For this overload we'll vary slightly from this standard and instead pass in the product s `ProductID` and the percentage by which to adjust the `UnitPrice` (as opposed to passing in the new, adjusted `UnitPrice` itself).</span></span> <span data-ttu-id="5dce4-251">Этот подход упростит код, который нам нужно написать в классе ASP.NET Page, поскольку нам не нужно беспокоиться о том, чтобы определить текущий продукт `UnitPrice`.</span><span class="sxs-lookup"><span data-stu-id="5dce4-251">This approach will simplify the code we need to write in the ASP.NET page code-behind class, since we don t have to bother with determining the current product s `UnitPrice`.</span></span>

<span data-ttu-id="5dce4-252">Перегрузка `UpdateProduct` для этого учебника показана ниже:</span><span class="sxs-lookup"><span data-stu-id="5dce4-252">The `UpdateProduct` overload for this tutorial is shown below:</span></span>

[!code-vb[Main](adding-and-responding-to-buttons-to-a-gridview-vb/samples/sample8.vb)]

<span data-ttu-id="5dce4-253">Эта перегрузка извлекает сведения об указанном продукте через метод DAL s `GetProductByProductID(productID)`.</span><span class="sxs-lookup"><span data-stu-id="5dce4-253">This overload retrieves information about the specified product through the DAL s `GetProductByProductID(productID)` method.</span></span> <span data-ttu-id="5dce4-254">Затем он проверяет, присвоено ли продукту `UnitPrice` `NULL` значение базы данных.</span><span class="sxs-lookup"><span data-stu-id="5dce4-254">It then checks to see whether the product s `UnitPrice` is assigned a database `NULL` value.</span></span> <span data-ttu-id="5dce4-255">Если это так, Цена остается без изменений.</span><span class="sxs-lookup"><span data-stu-id="5dce4-255">If it is, the price is left unaltered.</span></span> <span data-ttu-id="5dce4-256">Однако при наличии значения `UnitPrice`, не являющегося`NULL`, метод обновляет продукт с `UnitPrice` на указанный процент (`unitPriceAdjustmentPercent`).</span><span class="sxs-lookup"><span data-stu-id="5dce4-256">If, however, there is a non-`NULL` `UnitPrice` value, the method updates the product s `UnitPrice` by the specified percent (`unitPriceAdjustmentPercent`).</span></span>

## <a name="step-7-adding-the-increase-and-decrease-buttons-to-the-gridview"></a><span data-ttu-id="5dce4-257">Шаг 7. Добавление кнопок увеличения и уменьшения в GridView</span><span class="sxs-lookup"><span data-stu-id="5dce4-257">Step 7: Adding the Increase and Decrease Buttons to the GridView</span></span>

<span data-ttu-id="5dce4-258">GridView (и DetailsView) состоят из набора полей.</span><span class="sxs-lookup"><span data-stu-id="5dce4-258">The GridView (and DetailsView) are both made up of a collection of fields.</span></span> <span data-ttu-id="5dce4-259">В дополнение к BoundFields, Чеккбоксфиелдс и полей TemplateField, ASP.NET включает в себя Буттонфиелд, который, как предполагает его название, отображается как столбец с кнопкой, LinkButton или ImageButton для каждой строки.</span><span class="sxs-lookup"><span data-stu-id="5dce4-259">In addition to BoundFields, CheckBoxFields, and TemplateFields, ASP.NET includes the ButtonField, which, as its name implies, renders as a column with a Button, LinkButton, or ImageButton for each row.</span></span> <span data-ttu-id="5dce4-260">Аналогично элементу FormView, нажатию *любой* кнопки в кнопках мыши GridView, кнопках изменить или удалить, кнопки сортировки и т. д. вызывает обратную передачу и вызывает [событие GridView`RowCommand`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rowcommand.aspx).</span><span class="sxs-lookup"><span data-stu-id="5dce4-260">Similar to the FormView, clicking *any* button within the GridView paging buttons, Edit or Delete buttons, sorting buttons, and so on causes a postback and raises the GridView s [`RowCommand` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rowcommand.aspx).</span></span>

<span data-ttu-id="5dce4-261">Буттонфиелд имеет свойство `CommandName`, которое назначает указанное значение каждой из его кнопок `CommandName` свойства.</span><span class="sxs-lookup"><span data-stu-id="5dce4-261">The ButtonField has a `CommandName` property that assigns the specified value to each of its Buttons `CommandName` properties.</span></span> <span data-ttu-id="5dce4-262">Как и в FormView, `CommandName` значение используется обработчиком событий `RowCommand`, чтобы определить, какая кнопка была нажата.</span><span class="sxs-lookup"><span data-stu-id="5dce4-262">Like with the FormView, the `CommandName` value is used by the `RowCommand` event handler to determine which button was clicked.</span></span>

<span data-ttu-id="5dce4-263">Добавим в GridView два новых Буттонфиелдс, один — с ценой текста кнопки + 10%, а другой — с текстом Price-10%.</span><span class="sxs-lookup"><span data-stu-id="5dce4-263">Let s add two new ButtonFields to the GridView, one with a button text Price +10% and the other with the text Price -10%.</span></span> <span data-ttu-id="5dce4-264">Чтобы добавить эти Буттонфиелдс, щелкните ссылку Edit Columns (изменить столбцы) в смарт-теге GridView s, выберите тип поля Буттонфиелд из списка в левом верхнем углу и нажмите кнопку Добавить.</span><span class="sxs-lookup"><span data-stu-id="5dce4-264">To add these ButtonFields, click on the Edit Columns link from the GridView s smart tag, select the ButtonField field type from the list in the upper left and click the Add button.</span></span>

![Добавление двух Буттонфиелдс в GridView](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image48.png)

<span data-ttu-id="5dce4-266">**Рис. 18**. Добавление двух Буттонфиелдс в GridView</span><span class="sxs-lookup"><span data-stu-id="5dce4-266">**Figure 18**: Add Two ButtonFields to the GridView</span></span>

<span data-ttu-id="5dce4-267">Переместите два Буттонфиелдс, чтобы они отображались в качестве первых двух полей GridView.</span><span class="sxs-lookup"><span data-stu-id="5dce4-267">Move the two ButtonFields so that they appear as the first two GridView fields.</span></span> <span data-ttu-id="5dce4-268">Затем задайте для свойств `Text` этих двух Буттонфиелдс значения Price + 10% и Price-10%, а свойства `CommandName` — Инкреасеприце и Декреасеприце соответственно.</span><span class="sxs-lookup"><span data-stu-id="5dce4-268">Next, set the `Text` properties of these two ButtonFields to Price +10% and Price -10% and the `CommandName` properties to IncreasePrice and DecreasePrice, respectively.</span></span> <span data-ttu-id="5dce4-269">По умолчанию Буттонфиелд отображает свой столбец кнопок как LinkButton.</span><span class="sxs-lookup"><span data-stu-id="5dce4-269">By default, a ButtonField renders its column of buttons as LinkButtons.</span></span> <span data-ttu-id="5dce4-270">Однако это можно изменить с помощью [свойства`ButtonType`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.buttonfieldbase.buttontype.aspx)буттонфиелд s.</span><span class="sxs-lookup"><span data-stu-id="5dce4-270">This can be changed, however, through the ButtonField s [`ButtonType` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.buttonfieldbase.buttontype.aspx).</span></span> <span data-ttu-id="5dce4-271">Пусть эти два Буттонфиелдс отображаются как обычные кнопки отправки. Поэтому присвойте свойству `ButtonType` значение `Button`.</span><span class="sxs-lookup"><span data-stu-id="5dce4-271">Let s have these two ButtonFields rendered as regular push buttons; therefore, set the `ButtonType` property to `Button`.</span></span> <span data-ttu-id="5dce4-272">На рис. 19 показано диалоговое окно «поля» после внесения этих изменений. Ниже приведена декларативная разметка GridView s.</span><span class="sxs-lookup"><span data-stu-id="5dce4-272">Figure 19 shows the Fields dialog box after these changes have been made; following that is the GridView s declarative markup.</span></span>

![Настройка свойств Text, CommandName и ButtonType Буттонфиелдс](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image49.png)

<span data-ttu-id="5dce4-274">**Рис. 19**. настройка свойств `Text`, `CommandName`и `ButtonType` буттонфиелдс</span><span class="sxs-lookup"><span data-stu-id="5dce4-274">**Figure 19**: Configure the ButtonFields `Text`, `CommandName`, and `ButtonType` Properties</span></span>

[!code-aspx[Main](adding-and-responding-to-buttons-to-a-gridview-vb/samples/sample9.aspx)]

<span data-ttu-id="5dce4-275">После создания этих Буттонфиелдс на завершающем этапе создается обработчик событий для события `RowCommand` GridView s.</span><span class="sxs-lookup"><span data-stu-id="5dce4-275">With these ButtonFields created, the final step is to create an event handler for the GridView s `RowCommand` event.</span></span> <span data-ttu-id="5dce4-276">Этот обработчик событий, если он срабатывает из-за нажатия кнопок Price + 10% или Price – 10%, необходимо определить `ProductID` для строки, нажатой кнопкой, а затем вызвать метод `ProductsBLL` Class s `UpdateProduct`, передав соответствующую коррекцию `UnitPrice` процентных значений вместе с `ProductID`.</span><span class="sxs-lookup"><span data-stu-id="5dce4-276">This event handler, if fired because either the Price +10% or Price -10% buttons were clicked, needs to determine the `ProductID` for the row whose button was clicked and then invoke the `ProductsBLL` class s `UpdateProduct` method, passing in the appropriate `UnitPrice` percentage adjustment along with the `ProductID`.</span></span> <span data-ttu-id="5dce4-277">Следующий код выполняет следующие задачи:</span><span class="sxs-lookup"><span data-stu-id="5dce4-277">The following code performs these tasks:</span></span>

[!code-vb[Main](adding-and-responding-to-buttons-to-a-gridview-vb/samples/sample10.vb)]

<span data-ttu-id="5dce4-278">Чтобы определить `ProductID` для строки, для которой была нажата кнопка Цена + 10% или Price-10%, необходимо обратиться к коллекции GridView s `DataKeys`.</span><span class="sxs-lookup"><span data-stu-id="5dce4-278">In order to determine the `ProductID` for the row whose Price +10% or Price -10% button was clicked, we need to consult the GridView s `DataKeys` collection.</span></span> <span data-ttu-id="5dce4-279">Эта коллекция содержит значения полей, указанных в свойстве `DataKeyNames` для каждой строки GridView.</span><span class="sxs-lookup"><span data-stu-id="5dce4-279">This collection holds the values of the fields specified in the `DataKeyNames` property for each GridView row.</span></span> <span data-ttu-id="5dce4-280">Так как при привязке ObjectDataSource к GridView в Visual Studio свойству `DataKeyNames` GridView s присвоено значение ProductID, `DataKeys(rowIndex).Value` предоставляет `ProductID` для указанного значения *rowIndex*.</span><span class="sxs-lookup"><span data-stu-id="5dce4-280">Since the GridView s `DataKeyNames` property was set to ProductID by Visual Studio when binding the ObjectDataSource to the GridView, `DataKeys(rowIndex).Value` provides the `ProductID` for the specified *rowIndex*.</span></span>

<span data-ttu-id="5dce4-281">Буттонфиелд автоматически передает значение *rowIndex* строки, нажатой с помощью параметра `e.CommandArgument`.</span><span class="sxs-lookup"><span data-stu-id="5dce4-281">The ButtonField automatically passes in the *rowIndex* of the row whose button was clicked through the `e.CommandArgument` parameter.</span></span> <span data-ttu-id="5dce4-282">Таким образом, чтобы определить `ProductID` для строки, для которой была нажата кнопка Цена + 10% или Price-10%, мы используем: `Convert.ToInt32(SuppliersProducts.DataKeys(Convert.ToInt32(e.CommandArgument)).Value)`.</span><span class="sxs-lookup"><span data-stu-id="5dce4-282">Therefore, to determine the `ProductID` for the row whose Price +10% or Price -10% button was clicked, we use: `Convert.ToInt32(SuppliersProducts.DataKeys(Convert.ToInt32(e.CommandArgument)).Value)`.</span></span>

<span data-ttu-id="5dce4-283">Как и при нажатии кнопки "прекратить все продукты", если состояние представления GridView s отключено, элемент управления GridView повторно привязан к базовому хранилищу данных при каждой обратной передаче и, следовательно, будет обновлен, чтобы отразить изменение цены, которое происходит после нажатия кнопки Любая из кнопок.</span><span class="sxs-lookup"><span data-stu-id="5dce4-283">As with the Discontinue All Products button, if you have disabled the GridView s view state, the GridView is being rebound to the underlying data store on every postback, and therefore will immediately be updated to reflect a price change that occurs from clicking either of the buttons.</span></span> <span data-ttu-id="5dce4-284">Однако если вы не отключили состояние представления в GridView, после внесения этого изменения необходимо будет вручную выполнить повторную привязку данных к GridView.</span><span class="sxs-lookup"><span data-stu-id="5dce4-284">If, however, you have not disabled view state in the GridView, you will need to manually rebind the data to the GridView after making this change.</span></span> <span data-ttu-id="5dce4-285">Для этого просто выполните вызов метода `DataBind()` GridView s сразу же после вызова метода `UpdateProduct`.</span><span class="sxs-lookup"><span data-stu-id="5dce4-285">To accomplish this, simply make a call to the GridView s `DataBind()` method immediately after invoking the `UpdateProduct` method.</span></span>

<span data-ttu-id="5dce4-286">На рис. 20 показана страница при просмотре продуктов, предоставляемых Хоместеад Келли бабушка.</span><span class="sxs-lookup"><span data-stu-id="5dce4-286">Figure 20 shows the page when viewing the products provided by Grandma Kelly's Homestead.</span></span> <span data-ttu-id="5dce4-287">На рис. 21 показаны результаты после нажатия кнопки Цена + 10% для разворота бабушка Бойсенберри и кнопки Price-10% один раз для Норсвудс Кранберри.</span><span class="sxs-lookup"><span data-stu-id="5dce4-287">Figure 21 shows the results after the Price +10% button has been clicked twice for Grandma's Boysenberry Spread and the Price -10% button once for Northwoods Cranberry Sauce.</span></span>

<span data-ttu-id="5dce4-288">[![GridView включает кнопки Цена + 10% и Price-10%](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image51.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image50.png)</span><span class="sxs-lookup"><span data-stu-id="5dce4-288">[![The GridView Includes Price +10% and Price -10% Buttons](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image51.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image50.png)</span></span>

<span data-ttu-id="5dce4-289">**Рис. 20**. элемент GridView включает кнопки Price + 10% и Price-10% ([щелкните, чтобы просмотреть изображение с полным размером](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image52.png))</span><span class="sxs-lookup"><span data-stu-id="5dce4-289">**Figure 20**: The GridView Includes Price +10% and Price -10% Buttons ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image52.png))</span></span>

<span data-ttu-id="5dce4-290">[![цены на первый и третий продукты были обновлены с помощью кнопок Цена + 10% и цена-10%.](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image54.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image53.png)</span><span class="sxs-lookup"><span data-stu-id="5dce4-290">[![The Prices for the First and Third Product Have Been Updated via the Price +10% and Price -10% Buttons](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image54.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image53.png)</span></span>

<span data-ttu-id="5dce4-291">**Рис. 21**. цены на первый и третий продукты были обновлены с помощью кнопок Цена + 10% и цена-10% ([щелкните, чтобы просмотреть изображение с полным размером](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image55.png)).</span><span class="sxs-lookup"><span data-stu-id="5dce4-291">**Figure 21**: The Prices for the First and Third Product Have Been Updated via the Price +10% and Price -10% Buttons ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image55.png))</span></span>

> [!NOTE]
> <span data-ttu-id="5dce4-292">GridView (и DetailsView) также может содержать кнопки, LinkButton или Имажебуттонс, добавленные в их полей TemplateField.</span><span class="sxs-lookup"><span data-stu-id="5dce4-292">The GridView (and DetailsView) can also have Buttons, LinkButtons, or ImageButtons added to their TemplateFields.</span></span> <span data-ttu-id="5dce4-293">Как и в случае с BoundField, эти кнопки при нажатии будут вызывать обратную передачу, позывая событие `RowCommand` GridView s.</span><span class="sxs-lookup"><span data-stu-id="5dce4-293">As with the BoundField, these Buttons, when clicked, will induce a postback, raising the GridView s `RowCommand` event.</span></span> <span data-ttu-id="5dce4-294">Однако при добавлении кнопок в TemplateField кнопка s `CommandArgument` не задается автоматически индексом строки, как при использовании Буттонфиелдс.</span><span class="sxs-lookup"><span data-stu-id="5dce4-294">When adding buttons in a TemplateField, however, the Button s `CommandArgument` is not automatically set to the index of the row as it is when using ButtonFields.</span></span> <span data-ttu-id="5dce4-295">Если необходимо определить индекс строки кнопки, которая была нажата в обработчике событий `RowCommand`, необходимо вручную задать свойство Button `CommandArgument` в его декларативном синтаксисе в TemplateField, используя следующий код:</span><span class="sxs-lookup"><span data-stu-id="5dce4-295">If you need to determine the row index of the button that was clicked within the `RowCommand` event handler, you'll need to manually set the Button s `CommandArgument` property in its declarative syntax within the TemplateField, using code like:</span></span>  
> <span data-ttu-id="5dce4-296">`<asp:Button runat="server" ... CommandArgument='<%# CType(Container, GridViewRow).RowIndex %>' />`.</span><span class="sxs-lookup"><span data-stu-id="5dce4-296">`<asp:Button runat="server" ... CommandArgument='<%# CType(Container, GridViewRow).RowIndex %>' />`.</span></span>

## <a name="summary"></a><span data-ttu-id="5dce4-297">Сводка</span><span class="sxs-lookup"><span data-stu-id="5dce4-297">Summary</span></span>

<span data-ttu-id="5dce4-298">Элементы управления GridView, DetailsView и FormView могут включать кнопки, LinkButton или Имажебуттонс.</span><span class="sxs-lookup"><span data-stu-id="5dce4-298">The GridView, DetailsView, and FormView controls all can include Buttons, LinkButtons, or ImageButtons.</span></span> <span data-ttu-id="5dce4-299">Такие кнопки, при щелчке, вызывают обратную передачу и вызывают событие `ItemCommand` в элементах управления FormView и DetailsView и событие `RowCommand` в GridView.</span><span class="sxs-lookup"><span data-stu-id="5dce4-299">Such buttons, when clicked, cause a postback and raise the `ItemCommand` event in the FormView and DetailsView controls and the `RowCommand` event in the GridView.</span></span> <span data-ttu-id="5dce4-300">Эти веб-элементы управления данными имеют встроенные функции для обработки общих действий, связанных с командами, таких как удаление или изменение записей.</span><span class="sxs-lookup"><span data-stu-id="5dce4-300">These data Web controls have built-in functionality to handle common command-related actions, such as deleting or editing records.</span></span> <span data-ttu-id="5dce4-301">Однако можно также использовать кнопки, которые при щелчке мыши реагируют на исполнение собственного кода.</span><span class="sxs-lookup"><span data-stu-id="5dce4-301">However, we can also use buttons that, when clicked, respond with executing our own custom code.</span></span>

<span data-ttu-id="5dce4-302">Для этого необходимо создать обработчик событий для события `ItemCommand` или `RowCommand`.</span><span class="sxs-lookup"><span data-stu-id="5dce4-302">To accomplish this, we need to create an event handler for the `ItemCommand` or `RowCommand` event.</span></span> <span data-ttu-id="5dce4-303">В этом обработчике событий сначала проверяется значение входящего `CommandName`, чтобы определить, какая кнопка была нажата, а затем выполнить соответствующее настраиваемое действие.</span><span class="sxs-lookup"><span data-stu-id="5dce4-303">In this event handler we first check the incoming `CommandName` value to determine which button was clicked and then take appropriate custom action.</span></span> <span data-ttu-id="5dce4-304">В этом учебнике мы увидели, как использовать кнопки и Буттонфиелдс для прекращения использования всех продуктов для указанного поставщика или увеличения или уменьшения цены на определенный продукт на 10%.</span><span class="sxs-lookup"><span data-stu-id="5dce4-304">In this tutorial we saw how to use buttons and ButtonFields to discontinue all products for a specified supplier or to increase or decrease the price of a particular product by 10%.</span></span>

<span data-ttu-id="5dce4-305">Поздравляем с программированием!</span><span class="sxs-lookup"><span data-stu-id="5dce4-305">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="5dce4-306">Об авторе</span><span class="sxs-lookup"><span data-stu-id="5dce4-306">About the Author</span></span>

<span data-ttu-id="5dce4-307">[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи книг по ASP/ASP. NET и основатель [4GuysFromRolla.com](http://www.4guysfromrolla.com), работал с веб-технологиями Майкрософт с 1998.</span><span class="sxs-lookup"><span data-stu-id="5dce4-307">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="5dce4-308">Скотт работает как независимый консультант, преподаватель и модуль записи.</span><span class="sxs-lookup"><span data-stu-id="5dce4-308">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="5dce4-309">Его последняя книга — [*Sams обучать себя ASP.NET 2,0 за 24 часа*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="5dce4-309">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="5dce4-310">Он доступен по адресу [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="5dce4-310">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="5dce4-311">или через его блог, который можно найти по адресу [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="5dce4-311">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="5dce4-312">Назад</span><span class="sxs-lookup"><span data-stu-id="5dce4-312">Previous</span></span>](adding-and-responding-to-buttons-to-a-gridview-cs.md)
