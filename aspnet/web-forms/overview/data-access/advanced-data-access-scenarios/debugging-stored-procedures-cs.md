---
uid: web-forms/overview/data-access/advanced-data-access-scenarios/debugging-stored-procedures-cs
title: Отладка хранимыхC#процедур () | Документация Майкрософт
author: rick-anderson
description: Visual Studio Professional и выпуски Team System позволяют устанавливать точки останова и переходить к хранимым процедурам в SQL Server, делая отладку сохраненной...
ms.author: riande
ms.date: 08/03/2007
ms.assetid: c655c324-2ffa-4c21-8265-a254d79a693d
msc.legacyurl: /web-forms/overview/data-access/advanced-data-access-scenarios/debugging-stored-procedures-cs
msc.type: authoredcontent
ms.openlocfilehash: 12a8500b107345b9cc9ab457016fdef09ca1bb9d
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/28/2019
ms.locfileid: "74604865"
---
# <a name="debugging-stored-procedures-c"></a><span data-ttu-id="23fc6-103">Отладка хранимых процедур (C#)</span><span class="sxs-lookup"><span data-stu-id="23fc6-103">Debugging Stored Procedures (C#)</span></span>

<span data-ttu-id="23fc6-104">по [Скотт Митчелл](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="23fc6-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="23fc6-105">[Скачать код](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_74_CS.zip) или [скачать PDF](debugging-stored-procedures-cs/_static/datatutorial74cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="23fc6-105">[Download Code](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_74_CS.zip) or [Download PDF](debugging-stored-procedures-cs/_static/datatutorial74cs1.pdf)</span></span>

> <span data-ttu-id="23fc6-106">Visual Studio Professional и выпуски Team System позволяют устанавливать точки останова и переходить к хранимым процедурам в SQL Server, что позволяет выполнять отладку хранимых процедур так же просто, как отладка кода приложения.</span><span class="sxs-lookup"><span data-stu-id="23fc6-106">Visual Studio Professional and Team System editions allow you to set breakpoints and step in to stored procedures within SQL Server, making debugging stored procedures as easy as debugging application code.</span></span> <span data-ttu-id="23fc6-107">В этом учебнике демонстрируется Непосредственная отладка базы данных и отладка приложений для хранимых процедур.</span><span class="sxs-lookup"><span data-stu-id="23fc6-107">This tutorial demonstrates direct database debugging and application debugging of stored procedures.</span></span>

## <a name="introduction"></a><span data-ttu-id="23fc6-108">Введение</span><span class="sxs-lookup"><span data-stu-id="23fc6-108">Introduction</span></span>

<span data-ttu-id="23fc6-109">Visual Studio предоставляет широкие возможности для отладки.</span><span class="sxs-lookup"><span data-stu-id="23fc6-109">Visual Studio provides a rich debugging experience.</span></span> <span data-ttu-id="23fc6-110">С помощью нескольких клавиш или щелчков мыши можно использовать точки останова для остановки выполнения программы и изучения ее состояния и потока управления.</span><span class="sxs-lookup"><span data-stu-id="23fc6-110">With a few keystrokes or clicks of the mouse, it s possible to use breakpoints to stop execution of a program and examine its state and control flow.</span></span> <span data-ttu-id="23fc6-111">Наряду с отладкой кода приложения Visual Studio предлагает поддержку для отладки хранимых процедур из SQL Server.</span><span class="sxs-lookup"><span data-stu-id="23fc6-111">Along with debugging application code, Visual Studio offers support for debugging stored procedures from within SQL Server.</span></span> <span data-ttu-id="23fc6-112">Точно так же, как точки останова, можно задать в коде класса кода программной части ASP.NET или класса уровня бизнес-логики, так что они также могут размещаться в хранимых процедурах.</span><span class="sxs-lookup"><span data-stu-id="23fc6-112">Just like breakpoints can be set within the code of an ASP.NET code-behind class or Business Logic Layer class, so too can they be placed within stored procedures.</span></span>

<span data-ttu-id="23fc6-113">В этом учебнике мы рассмотрим пошаговое выполнение хранимых процедур из обозреватель сервера в Visual Studio, а также как задать точки останова, которые будут достигнуты при вызове хранимой процедуры из работающего приложения ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="23fc6-113">In this tutorial we will look at stepping into stored procedures from the Server Explorer within Visual Studio as well as how to set breakpoints that are hit when the stored procedure is called from the running ASP.NET application.</span></span>

> [!NOTE]
> <span data-ttu-id="23fc6-114">К сожалению, хранимые процедуры можно пошагово и отлаживать только с помощью версий Visual Studio Professional и Team Systems.</span><span class="sxs-lookup"><span data-stu-id="23fc6-114">Unfortunately, stored procedures can only be stepped into and debugged through the Professional and Team Systems versions of Visual Studio.</span></span> <span data-ttu-id="23fc6-115">Если вы используете Visual Web Developer или стандартную версию Visual Studio, вы можете ознакомиться с шагами, необходимыми для отладки хранимых процедур, но вы не сможете реплицировать эти действия на компьютере.</span><span class="sxs-lookup"><span data-stu-id="23fc6-115">If you are using Visual Web Developer or the standard version of Visual Studio, you are welcome to read along as we walk through the steps necessary to debug stored procedures, but you will not be able to replicate these steps on your machine.</span></span>

## <a name="sql-server-debugging-concepts"></a><span data-ttu-id="23fc6-116">Основные понятия отладки SQL Server</span><span class="sxs-lookup"><span data-stu-id="23fc6-116">SQL Server Debugging Concepts</span></span>

<span data-ttu-id="23fc6-117">Microsoft SQL Server 2005 была разработана для обеспечения интеграции [со средой CLR, которая](https://msdn.microsoft.com/netframework/aa497266.aspx)используется всеми сборками .NET.</span><span class="sxs-lookup"><span data-stu-id="23fc6-117">Microsoft SQL Server 2005 was designed to provide integration with the [Common Language Runtime (CLR)](https://msdn.microsoft.com/netframework/aa497266.aspx), which is the runtime used by all .NET assemblies.</span></span> <span data-ttu-id="23fc6-118">Следовательно, SQL Server 2005 поддерживает управляемые объекты базы данных.</span><span class="sxs-lookup"><span data-stu-id="23fc6-118">Consequently, SQL Server 2005 supports managed database objects.</span></span> <span data-ttu-id="23fc6-119">Таким образом, можно создавать объекты базы данных, такие как хранимые процедуры и определяемые пользователем функции (UDF), C# в качестве методов в классе.</span><span class="sxs-lookup"><span data-stu-id="23fc6-119">That is, you can create database objects like stored procedures and User-Defined Functions (UDFs) as methods in a C# class.</span></span> <span data-ttu-id="23fc6-120">Это позволяет этим хранимым процедурам и функциям UDF использовать функции в .NET Framework и из собственных пользовательских классов.</span><span class="sxs-lookup"><span data-stu-id="23fc6-120">This enables these stored procedures and UDFs to utilize functionality in the .NET Framework and from your own custom classes.</span></span> <span data-ttu-id="23fc6-121">Конечно, SQL Server 2005 также обеспечивает поддержку объектов базы данных T-SQL.</span><span class="sxs-lookup"><span data-stu-id="23fc6-121">Of course, SQL Server 2005 also provides support for T-SQL database objects.</span></span>

<span data-ttu-id="23fc6-122">SQL Server 2005 предлагает поддержку отладки как для T-SQL, так и для управляемых объектов базы данных.</span><span class="sxs-lookup"><span data-stu-id="23fc6-122">SQL Server 2005 offers debugging support for both T-SQL and managed database objects.</span></span> <span data-ttu-id="23fc6-123">Однако эти объекты можно отлаживать только с помощью выпусков Visual Studio 2005 Professional и Team Systems.</span><span class="sxs-lookup"><span data-stu-id="23fc6-123">However, these objects can only be debugged through Visual Studio 2005 Professional and Team Systems editions.</span></span> <span data-ttu-id="23fc6-124">В этом учебнике мы рассмотрим отладку объектов базы данных T-SQL.</span><span class="sxs-lookup"><span data-stu-id="23fc6-124">In this tutorial we will examine debugging T-SQL database objects.</span></span> <span data-ttu-id="23fc6-125">В следующем учебнике рассматривается отладка управляемых объектов базы данных.</span><span class="sxs-lookup"><span data-stu-id="23fc6-125">The subsequent tutorial looks at debugging managed database objects.</span></span>

<span data-ttu-id="23fc6-126">[Общие сведения об отладке T-SQL и CLR в записи блога SQL Server 2005](https://blogs.msdn.com/sqlclr/archive/2006/06/29/651644.aspx) из [группы интеграции SQL Server 2005 CLR](https://blogs.msdn.com/sqlclr/default.aspx) выделяют три способа отладки объектов SQL Server 2005 из Visual Studio:</span><span class="sxs-lookup"><span data-stu-id="23fc6-126">The [Overview of T-SQL and CLR Debugging in SQL Server 2005](https://blogs.msdn.com/sqlclr/archive/2006/06/29/651644.aspx) blog entry from the [SQL Server 2005 CLR Integration team](https://blogs.msdn.com/sqlclr/default.aspx) highlights the three ways to debug SQL Server 2005 objects from Visual Studio:</span></span>

- <span data-ttu-id="23fc6-127">**Прямая отладка базы данных (DDD)** — начиная с обозреватель сервера можно выполнить шаг с заходом в любой объект базы данных T-SQL, например хранимые процедуры и UDF.</span><span class="sxs-lookup"><span data-stu-id="23fc6-127">**Direct Database Debugging (DDD)** - from Server Explorer we can step into any T-SQL database object, such as stored procedures and UDFs.</span></span> <span data-ttu-id="23fc6-128">Мы рассмотрим DDD на шаге 1.</span><span class="sxs-lookup"><span data-stu-id="23fc6-128">We will examine DDD in Step 1.</span></span>
- <span data-ttu-id="23fc6-129">**Отладка приложений** . можно задать точки останова в объекте базы данных, а затем запустить приложение ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="23fc6-129">**Application Debugging** - we can set breakpoints within a database object and then run our ASP.NET application.</span></span> <span data-ttu-id="23fc6-130">При выполнении объекта базы данных происходит попадание в точку останова и управление переключается на отладчик.</span><span class="sxs-lookup"><span data-stu-id="23fc6-130">When the database object is executed, the breakpoint will be hit and control turned over to the debugger.</span></span> <span data-ttu-id="23fc6-131">Обратите внимание, что при отладке приложения не удается выполнить шаг с заходом в объект базы данных из кода приложения.</span><span class="sxs-lookup"><span data-stu-id="23fc6-131">Note that with application debugging we cannot step into a database object from application code.</span></span> <span data-ttu-id="23fc6-132">Необходимо явным образом задать точки останова в этих хранимых процедурах или функциях UDF, где отладчик должен останавливаться.</span><span class="sxs-lookup"><span data-stu-id="23fc6-132">We must explicitly set breakpoints in those stored procedures or UDFs where we want the debugger to stop.</span></span> <span data-ttu-id="23fc6-133">Отладка приложения проверяется, начиная с шага 2.</span><span class="sxs-lookup"><span data-stu-id="23fc6-133">Application debugging is examined starting in Step 2.</span></span>
- <span data-ttu-id="23fc6-134">**Отладка SQL Server** выпусков проекта Visual Studio Professional и Team Systems включает тип проекта SQL Server, который обычно используется для создания управляемых объектов базы данных.</span><span class="sxs-lookup"><span data-stu-id="23fc6-134">**Debugging from a SQL Server Project** - Visual Studio Professional and Team Systems editions include a SQL Server Project type that is commonly used to create managed database objects.</span></span> <span data-ttu-id="23fc6-135">В следующем руководстве мы рассмотрим использование проектов SQL Server и отладку их содержимого.</span><span class="sxs-lookup"><span data-stu-id="23fc6-135">We will examine using SQL Server Projects and debugging their contents in the next tutorial.</span></span>

<span data-ttu-id="23fc6-136">Visual Studio может выполнять отладку хранимых процедур на локальном и удаленном экземплярах SQL Server.</span><span class="sxs-lookup"><span data-stu-id="23fc6-136">Visual Studio can debug stored procedures on local and remote SQL Server instances.</span></span> <span data-ttu-id="23fc6-137">Локальный экземпляр SQL Server — это тот, который устанавливается на том же компьютере, что и Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="23fc6-137">A local SQL Server instance is one that is installed on the same machine as Visual Studio.</span></span> <span data-ttu-id="23fc6-138">Если используемая база данных SQL Server не находится на компьютере разработки, она считается удаленным экземпляром.</span><span class="sxs-lookup"><span data-stu-id="23fc6-138">If the SQL Server database you are using is not located on your development machine, then it is considered a remote instance.</span></span> <span data-ttu-id="23fc6-139">Для этих руководств мы использовали локальные экземпляры SQL Server.</span><span class="sxs-lookup"><span data-stu-id="23fc6-139">For these tutorials we have been using local SQL Server instances.</span></span> <span data-ttu-id="23fc6-140">Отладка хранимых процедур на удаленном экземпляре SQL Server требует больше этапов настройки, чем при отладке хранимых процедур на локальном экземпляре.</span><span class="sxs-lookup"><span data-stu-id="23fc6-140">Debugging stored procedures on a remote SQL server instance requires more configuration steps than when debugging stored procedures on a local instance.</span></span>

<span data-ttu-id="23fc6-141">Если вы используете локальный экземпляр SQL Server, можно начать с шага 1 и выполнить действия, описанные в этом руководстве, до конца.</span><span class="sxs-lookup"><span data-stu-id="23fc6-141">If you are using a local SQL Server instance, you can start with Step 1 and work through this tutorial to the end.</span></span> <span data-ttu-id="23fc6-142">Однако если вы используете удаленный экземпляр SQL Server, то сначала необходимо убедиться, что при отладке на компьютере разработки будет использоваться учетная запись пользователя Windows с SQL Server именем входа на удаленном экземпляре.</span><span class="sxs-lookup"><span data-stu-id="23fc6-142">If you are using a remote SQL Server instance, however, you will first need to ensure that when debugging you are logged to your development machine with a Windows user account that has a SQL Server login on the remote instance.</span></span> <span data-ttu-id="23fc6-143">Кроме того, имя входа базы данных и имя входа базы данных, используемые для подключения к базе данных из работающего приложения ASP.NET, должны быть членами роли `sysadmin`.</span><span class="sxs-lookup"><span data-stu-id="23fc6-143">Moreover, both this database login and the database login used to connect to the database from the running ASP.NET application must be members of the `sysadmin` role.</span></span> <span data-ttu-id="23fc6-144">Дополнительные сведения о настройке Visual Studio и SQL Server для отладки удаленного экземпляра см. в разделе Отладка объектов базы данных T-SQL в удаленных экземплярах в конце этого руководства.</span><span class="sxs-lookup"><span data-stu-id="23fc6-144">See the Debugging T-SQL Database Objects on Remote Instances section at the end of this tutorial for more information on configuring Visual Studio and SQL Server to debug a remote instance.</span></span>

<span data-ttu-id="23fc6-145">Наконец, следует понимать, что поддержка отладки для объектов базы данных T-SQL не так обширна, как поддержка отладки для приложений .NET.</span><span class="sxs-lookup"><span data-stu-id="23fc6-145">Finally, understand that debugging support for T-SQL database objects is not as feature rich as debugging support for .NET applications.</span></span> <span data-ttu-id="23fc6-146">Например, условия точки останова и фильтры не поддерживаются, доступно только подмножество окон отладки, нельзя использовать "изменить и продолжить", окно интерпретации подготавливается к просмотру бесполезным и т. д.</span><span class="sxs-lookup"><span data-stu-id="23fc6-146">For example, breakpoint conditions and filters are not supported, only a subset of the debugging windows are available, you cannot use Edit and Continue, the Immediate window is rendered useless, and so forth.</span></span> <span data-ttu-id="23fc6-147">Дополнительные сведения см. [в разделе ограничения на команды и функции отладчика](https://msdn.microsoft.com/library/ms165035(VS.80).aspx) .</span><span class="sxs-lookup"><span data-stu-id="23fc6-147">See [Limitations on Debugger Commands and Features](https://msdn.microsoft.com/library/ms165035(VS.80).aspx) for more information.</span></span>

## <a name="step-1-directly-stepping-into-a-stored-procedure"></a><span data-ttu-id="23fc6-148">Шаг 1. Непосредственная пошаговая отладка хранимой процедуры</span><span class="sxs-lookup"><span data-stu-id="23fc6-148">Step 1: Directly Stepping Into a Stored Procedure</span></span>

<span data-ttu-id="23fc6-149">Visual Studio упрощает прямую отладку объекта базы данных.</span><span class="sxs-lookup"><span data-stu-id="23fc6-149">Visual Studio makes it easy to directly debug a database object.</span></span> <span data-ttu-id="23fc6-150">Давайте рассмотрим, как использовать функцию прямой отладки базы данных (DDD) для пошагового перехода к `Products_SelectByCategoryID` хранимой процедуры в базе данных Northwind.</span><span class="sxs-lookup"><span data-stu-id="23fc6-150">Let s look at how to use the Direct Database Debugging (DDD) feature to step into the `Products_SelectByCategoryID` stored procedure in the Northwind database.</span></span> <span data-ttu-id="23fc6-151">Как следует из названия, `Products_SelectByCategoryID` возвращает сведения о продукте для определенной категории. Он был создан в учебнике [использование существующих хранимых процедур для адаптеров таблиц типизированного набора данных s](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md) .</span><span class="sxs-lookup"><span data-stu-id="23fc6-151">As its name implies, `Products_SelectByCategoryID` returns product information for a particular category; it was created in the [Using Existing Stored Procedures for the Typed DataSet s TableAdapters](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md) tutorial.</span></span> <span data-ttu-id="23fc6-152">Для начала перейдите к обозреватель сервера и разверните узел базы данных Northwind.</span><span class="sxs-lookup"><span data-stu-id="23fc6-152">Start by going to the Server Explorer and expand the Northwind database node.</span></span> <span data-ttu-id="23fc6-153">Затем перейдите в папку хранимых процедур, щелкните правой кнопкой мыши хранимую процедуру `Products_SelectByCategoryID` и выберите пункт Шаг с хранимой процедурой в контекстном меню.</span><span class="sxs-lookup"><span data-stu-id="23fc6-153">Next, drill down into the Stored Procedures folder, right-click on the `Products_SelectByCategoryID` stored procedure, and choose the Step Into Stored Procedure option from the context menu.</span></span> <span data-ttu-id="23fc6-154">Запустится отладчик.</span><span class="sxs-lookup"><span data-stu-id="23fc6-154">This will start the debugger.</span></span>

<span data-ttu-id="23fc6-155">Так как хранимая процедура `Products_SelectByCategoryID` предполагает, что `@CategoryID` входной параметр, нам будет предложено предоставить это значение.</span><span class="sxs-lookup"><span data-stu-id="23fc6-155">Since the `Products_SelectByCategoryID` stored procedure expects a `@CategoryID` input parameter, we are asked to provide this value.</span></span> <span data-ttu-id="23fc6-156">Введите 1, чтобы получить сведения о напитки.</span><span class="sxs-lookup"><span data-stu-id="23fc6-156">Enter 1, which will return information about the beverages.</span></span>

![Используйте значение 1 для параметра @CategoryID](debugging-stored-procedures-cs/_static/image1.png)

<span data-ttu-id="23fc6-158">**Рис. 1**. Использование значения 1 для параметра `@CategoryID`</span><span class="sxs-lookup"><span data-stu-id="23fc6-158">**Figure 1**: Use the Value 1 for the `@CategoryID` Parameter</span></span>

<span data-ttu-id="23fc6-159">После предоставления значения для параметра `@CategoryID` выполняется хранимая процедура.</span><span class="sxs-lookup"><span data-stu-id="23fc6-159">After supplying the value for the `@CategoryID` parameter, the stored procedure is executed.</span></span> <span data-ttu-id="23fc6-160">Однако вместо выполнения до завершения отладчик останавливает выполнение на первой инструкции.</span><span class="sxs-lookup"><span data-stu-id="23fc6-160">Rather than running to completion, though, the debugger halts execution on the first statement.</span></span> <span data-ttu-id="23fc6-161">Обратите внимание на желтую стрелку на поле, указывающую текущее место в хранимой процедуре.</span><span class="sxs-lookup"><span data-stu-id="23fc6-161">Note the yellow arrow in the margin, indicating the current location in the stored procedure.</span></span> <span data-ttu-id="23fc6-162">Значения параметров можно просматривать и изменять с помощью окно контрольных значений или путем наведения указателя мыши на имя параметра в хранимой процедуре.</span><span class="sxs-lookup"><span data-stu-id="23fc6-162">You can view and edit parameter values through the Watch window or by hovering over the parameter name in the stored procedure.</span></span>

<span data-ttu-id="23fc6-163">[![отладчик остановлен на первом операторе хранимой процедуры](debugging-stored-procedures-cs/_static/image3.png)](debugging-stored-procedures-cs/_static/image2.png)</span><span class="sxs-lookup"><span data-stu-id="23fc6-163">[![The Debugger has Halted on the First Statement of the Stored Procedure](debugging-stored-procedures-cs/_static/image3.png)](debugging-stored-procedures-cs/_static/image2.png)</span></span>

<span data-ttu-id="23fc6-164">**Рис. 2**. Отладчик остановлен на первом операторе хранимой процедуры ([щелкните, чтобы просмотреть изображение с полным размером](debugging-stored-procedures-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="23fc6-164">**Figure 2**: The Debugger has Halted on the First Statement of the Stored Procedure ([Click to view full-size image](debugging-stored-procedures-cs/_static/image4.png))</span></span>

<span data-ttu-id="23fc6-165">Для пошагового выполнения хранимой процедуры по одной инструкции нажмите кнопку Шаг с обходом на панели инструментов или нажмите клавишу F10.</span><span class="sxs-lookup"><span data-stu-id="23fc6-165">To step through the stored procedure one statement at a time, click the Step Over button in the Toolbar or hit the F10 key.</span></span> <span data-ttu-id="23fc6-166">`Products_SelectByCategoryID` хранимая процедура содержит одну инструкцию `SELECT`, поэтому нажатие клавиши F10 приведет к пошаговому выполнению одной инструкции и завершению выполнения хранимой процедуры.</span><span class="sxs-lookup"><span data-stu-id="23fc6-166">The `Products_SelectByCategoryID` stored procedure contains a single `SELECT` statement, so hitting F10 will Step over the single statement and complete the execution of the stored procedure.</span></span> <span data-ttu-id="23fc6-167">После завершения хранимой процедуры ее выходные данные отобразятся в окне вывод, и отладчик завершит работу.</span><span class="sxs-lookup"><span data-stu-id="23fc6-167">After the stored procedure has completed, its output will appear in the Output window and the debugger will terminate.</span></span>

> [!NOTE]
> <span data-ttu-id="23fc6-168">Отладка T-SQL происходит на уровне инструкций. невозможно выполнить шаг с заходом в инструкцию `SELECT`.</span><span class="sxs-lookup"><span data-stu-id="23fc6-168">T-SQL debugging occurs at the statement level; you cannot Step into a `SELECT` statement.</span></span>

## <a name="step-2-configuring-the-website-for-application-debugging"></a><span data-ttu-id="23fc6-169">Шаг 2. Настройка веб-сайта для отладки приложения</span><span class="sxs-lookup"><span data-stu-id="23fc6-169">Step 2: Configuring the Website for Application Debugging</span></span>

<span data-ttu-id="23fc6-170">Хотя Отладка хранимой процедуры непосредственно из обозреватель сервера удобна, во многих сценариях мы заинтересованы в отладке хранимой процедуры при ее вызове из нашего приложения ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="23fc6-170">While debugging a stored procedure directly from the Server Explorer is handy, in many scenarios we are more interested in debugging the stored procedure when it is called from our ASP.NET application.</span></span> <span data-ttu-id="23fc6-171">Можно добавить точки останова в хранимую процедуру из среды Visual Studio, а затем начать отладку приложения ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="23fc6-171">We can add breakpoints to a stored procedure from within Visual Studio and then start debugging the ASP.NET application.</span></span> <span data-ttu-id="23fc6-172">Если в приложении вызывается хранимая процедура с точками останова, выполнение будет остановлено в точке останова, и мы можем просмотреть и изменить значения параметров хранимой процедуры и пошагово выполнить инструкции, как в шаге 1.</span><span class="sxs-lookup"><span data-stu-id="23fc6-172">When a stored procedure with breakpoints is invoked from the application, execution will halt at the breakpoint and we can view and change the stored procedure s parameter values and step through its statements, just like we did in Step 1.</span></span>

<span data-ttu-id="23fc6-173">Прежде чем можно будет начать отладку хранимых процедур, вызываемых из приложения, необходимо указать веб-приложению ASP.NET интегрироваться с отладчиком SQL Server.</span><span class="sxs-lookup"><span data-stu-id="23fc6-173">Before we can start debugging stored procedures called from the application, we need to instruct the ASP.NET web application to integrate with the SQL Server debugger.</span></span> <span data-ttu-id="23fc6-174">Начните с щелчка правой кнопкой мыши по имени веб-сайта в обозреватель решений (`ASPNET_Data_Tutorial_74_CS`).</span><span class="sxs-lookup"><span data-stu-id="23fc6-174">Start by right-clicking on the website name in the Solution Explorer (`ASPNET_Data_Tutorial_74_CS`).</span></span> <span data-ttu-id="23fc6-175">Выберите параметр страницы свойств в контекстном меню, выберите элемент Параметры запуска слева и установите флажок SQL Server в разделе отладчики (см. рис. 3).</span><span class="sxs-lookup"><span data-stu-id="23fc6-175">Choose the Property Pages option from the context menu, select the Start Options item on the left, and check the SQL Server checkbox in the Debuggers section (see Figure 3).</span></span>

<span data-ttu-id="23fc6-176">[![установите флажок SQL Server на страницах свойств приложения.](debugging-stored-procedures-cs/_static/image6.png)](debugging-stored-procedures-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="23fc6-176">[![Check the SQL Server Checkbox in the Application s Property Pages](debugging-stored-procedures-cs/_static/image6.png)](debugging-stored-procedures-cs/_static/image5.png)</span></span>

<span data-ttu-id="23fc6-177">**Рис. 3**. Установка флажка SQL Server на страницах свойств приложения ([щелкните, чтобы просмотреть изображение с полным размером](debugging-stored-procedures-cs/_static/image7.png))</span><span class="sxs-lookup"><span data-stu-id="23fc6-177">**Figure 3**: Check the SQL Server Checkbox in the Application s Property Pages ([Click to view full-size image](debugging-stored-procedures-cs/_static/image7.png))</span></span>

<span data-ttu-id="23fc6-178">Кроме того, необходимо обновить строку подключения к базе данных, используемую приложением, чтобы отключить пул соединений.</span><span class="sxs-lookup"><span data-stu-id="23fc6-178">Additionally, we need to update the database connection string used by the application so that connection pooling is disabled.</span></span> <span data-ttu-id="23fc6-179">При закрытии соединения с базой данных соответствующий объект `SqlConnection` помещается в пул доступных подключений.</span><span class="sxs-lookup"><span data-stu-id="23fc6-179">When a connection to a database is closed, the corresponding `SqlConnection` object is placed in a pool of available connections.</span></span> <span data-ttu-id="23fc6-180">При установлении соединения с базой данных доступный объект подключения можно получить из пула, а не создавать и устанавливать новое соединение.</span><span class="sxs-lookup"><span data-stu-id="23fc6-180">When establishing a connection to a database, an available connection object can be retrieved from this pool rather than having to create and establish a new connection.</span></span> <span data-ttu-id="23fc6-181">Такое объединение объектов соединения является улучшением производительности и включено по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="23fc6-181">This pooling of connection objects is a performance enhancement and is enabled by default.</span></span> <span data-ttu-id="23fc6-182">Однако при отладке мы хотим отключить пулы соединений, так как инфраструктура отладки неправильно восстанавливается при работе с подключением, полученным из пула.</span><span class="sxs-lookup"><span data-stu-id="23fc6-182">However, when debugging we want to turn off connection pooling because the debugging infrastructure is not correctly reestablished when working with a connection that was taken from the pool.</span></span>

<span data-ttu-id="23fc6-183">Чтобы отключить пулы подключений, обновите `NORTHWNDConnectionString` в `Web.config`, чтобы она включала параметр `Pooling=false`.</span><span class="sxs-lookup"><span data-stu-id="23fc6-183">To disabled connection pooling, update the `NORTHWNDConnectionString` in `Web.config` so that it includes the setting `Pooling=false` .</span></span>

[!code-xml[Main](debugging-stored-procedures-cs/samples/sample1.xml)]

> [!NOTE]
> <span data-ttu-id="23fc6-184">Завершив отладку SQL Server с помощью приложения ASP.NET, не забудьте восстановить пулы соединений, удалив параметр `Pooling` из строки подключения (или задав для него значение `Pooling=true`).</span><span class="sxs-lookup"><span data-stu-id="23fc6-184">Once you have finished debugging SQL Server through the ASP.NET application be sure to reinstate connection pooling by removing the `Pooling` setting from the connection string (or by setting it to `Pooling=true` ).</span></span>

<span data-ttu-id="23fc6-185">На этом этапе приложение ASP.NET настроено так, чтобы позволить Visual Studio выполнять отладку SQL Server объектов базы данных при вызове через веб-приложение.</span><span class="sxs-lookup"><span data-stu-id="23fc6-185">At this point the ASP.NET application has been configured to allow Visual Studio to debug SQL Server database objects when invoked through the web application.</span></span> <span data-ttu-id="23fc6-186">Теперь остается только добавить точку останова в хранимую процедуру и начать отладку.</span><span class="sxs-lookup"><span data-stu-id="23fc6-186">All that remains now is to add a breakpoint to a stored procedure and start debugging!</span></span>

## <a name="step-3-adding-a-breakpoint-and-debugging"></a><span data-ttu-id="23fc6-187">Шаг 3. Добавление точки останова и отладки</span><span class="sxs-lookup"><span data-stu-id="23fc6-187">Step 3: Adding a Breakpoint and Debugging</span></span>

<span data-ttu-id="23fc6-188">Откройте `Products_SelectByCategoryID` хранимую процедуру и установите точку останова в начале `SELECT`, щелкнув поле в соответствующем месте или поместив курсор в начало оператора `SELECT` и нажав клавишу F9.</span><span class="sxs-lookup"><span data-stu-id="23fc6-188">Open the `Products_SelectByCategoryID` stored procedure and set a breakpoint at the start of the `SELECT` statement by clicking in the margin at the appropriate place or by placing your cursor at the start of the `SELECT` statement and hitting F9.</span></span> <span data-ttu-id="23fc6-189">Как показано на рис. 4, точка останова отображается в виде красного круга в поле.</span><span class="sxs-lookup"><span data-stu-id="23fc6-189">As Figure 4 illustrates, the breakpoint appears as a red circle in the margin.</span></span>

<span data-ttu-id="23fc6-190">[![установки точки останова в хранимой процедуре Products_SelectByCategoryID](debugging-stored-procedures-cs/_static/image9.png)](debugging-stored-procedures-cs/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="23fc6-190">[![Set a Breakpoint in the Products_SelectByCategoryID Stored Procedure](debugging-stored-procedures-cs/_static/image9.png)](debugging-stored-procedures-cs/_static/image8.png)</span></span>

<span data-ttu-id="23fc6-191">**Рис. 4**. Установка точки останова в хранимой процедуре `Products_SelectByCategoryID` ([щелкните, чтобы просмотреть изображение с полным размером](debugging-stored-procedures-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="23fc6-191">**Figure 4**: Set a Breakpoint in the `Products_SelectByCategoryID` Stored Procedure ([Click to view full-size image](debugging-stored-procedures-cs/_static/image10.png))</span></span>

<span data-ttu-id="23fc6-192">Чтобы объект базы данных SQL можно было отлаживать через клиентское приложение, необходимо настроить для базы данных поддержку отладки приложений.</span><span class="sxs-lookup"><span data-stu-id="23fc6-192">In order for a SQL database object to be debugged through a client application, it is imperative that the database be configured to support application debugging.</span></span> <span data-ttu-id="23fc6-193">При первом задании точки останова этот параметр должен автоматически переключаться, но рекомендуется выполнить двойную проверку.</span><span class="sxs-lookup"><span data-stu-id="23fc6-193">When you first set a breakpoint, this setting should automatically be switched on, but it is prudent to double-check.</span></span> <span data-ttu-id="23fc6-194">Щелкните правой кнопкой мыши узел `NORTHWND.MDF` в обозреватель сервера.</span><span class="sxs-lookup"><span data-stu-id="23fc6-194">Right-click on the `NORTHWND.MDF` node in the Server Explorer.</span></span> <span data-ttu-id="23fc6-195">Контекстное меню должно включать отмеченный элемент меню с именем Отладка приложения.</span><span class="sxs-lookup"><span data-stu-id="23fc6-195">The context menu should include a checked menu item named Application Debugging .</span></span>

![Убедитесь, что включен параметр отладки приложения.](debugging-stored-procedures-cs/_static/image11.png)

<span data-ttu-id="23fc6-197">**Рис. 5**. Убедитесь, что включен параметр отладки приложения</span><span class="sxs-lookup"><span data-stu-id="23fc6-197">**Figure 5**: Ensure that the Application Debugging Option is Enabled</span></span>

<span data-ttu-id="23fc6-198">Если установлена точка останова и включен параметр Отладка приложения, мы готовы к отладке хранимой процедуры при вызове из приложения ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="23fc6-198">With the breakpoint set and the Application Debugging option enabled, we are ready to debug the stored procedure when called from the ASP.NET application.</span></span> <span data-ttu-id="23fc6-199">Запустите отладчик, перейдя в меню Отладка и выбрав начать отладку, нажав клавишу F5 или щелкнув зеленый значок воспроизведения на панели инструментов.</span><span class="sxs-lookup"><span data-stu-id="23fc6-199">Start the debugger by going to the Debug menu and choosing Start Debugging, by hitting F5, or by clicking the green play icon in the Toolbar.</span></span> <span data-ttu-id="23fc6-200">Это приведет к запуску отладчика и запуску веб-сайта.</span><span class="sxs-lookup"><span data-stu-id="23fc6-200">This will start the debugger and launch the website.</span></span>

<span data-ttu-id="23fc6-201">`Products_SelectByCategoryID` хранимая процедура была создана в учебнике [использование существующих хранимых процедур для адаптеров TableAdapter типизированного набора данных s](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md) .</span><span class="sxs-lookup"><span data-stu-id="23fc6-201">The `Products_SelectByCategoryID` stored procedure was created in the [Using Existing Stored Procedures for the Typed DataSet s TableAdapters](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md) tutorial.</span></span> <span data-ttu-id="23fc6-202">Соответствующая веб-страница (`~/AdvancedDAL/ExistingSprocs.aspx`) содержит GridView, в котором отображаются результаты, возвращаемые этой хранимой процедурой.</span><span class="sxs-lookup"><span data-stu-id="23fc6-202">Its corresponding web page (`~/AdvancedDAL/ExistingSprocs.aspx`) contains a GridView that displays the results returned by this stored procedure.</span></span> <span data-ttu-id="23fc6-203">Посетите эту страницу в браузере.</span><span class="sxs-lookup"><span data-stu-id="23fc6-203">Visit this page through the browser.</span></span> <span data-ttu-id="23fc6-204">При достижении страницы точка останова в `Products_SelectByCategoryID` хранимой процедуре будет нажата и управление возвращается в Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="23fc6-204">Upon reaching the page, the breakpoint in the `Products_SelectByCategoryID` stored procedure will be hit and control returned to Visual Studio.</span></span> <span data-ttu-id="23fc6-205">Как и на шаге 1, можно пошагово выполнить инструкции хранимой процедуры s и просмотреть и изменить значения параметров.</span><span class="sxs-lookup"><span data-stu-id="23fc6-205">Just like in Step 1, you can step through the stored procedure s statements and view and modify the parameter values.</span></span>

<span data-ttu-id="23fc6-206">[![страница Ексистингспрокс. aspx изначально отображает напитки](debugging-stored-procedures-cs/_static/image13.png)](debugging-stored-procedures-cs/_static/image12.png)</span><span class="sxs-lookup"><span data-stu-id="23fc6-206">[![The ExistingSprocs.aspx Page Initially Displays the Beverages](debugging-stored-procedures-cs/_static/image13.png)](debugging-stored-procedures-cs/_static/image12.png)</span></span>

<span data-ttu-id="23fc6-207">**Рис. 6**. страница `ExistingSprocs.aspx` изначально отображает напитки ([щелкните, чтобы просмотреть изображение с полным размером](debugging-stored-procedures-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="23fc6-207">**Figure 6**: The `ExistingSprocs.aspx` Page Initially Displays the Beverages ([Click to view full-size image](debugging-stored-procedures-cs/_static/image14.png))</span></span>

<span data-ttu-id="23fc6-208">[![достигнута точка останова хранимой процедуры](debugging-stored-procedures-cs/_static/image16.png)](debugging-stored-procedures-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="23fc6-208">[![The Stored Procedure s Breakpoint has been Reached](debugging-stored-procedures-cs/_static/image16.png)](debugging-stored-procedures-cs/_static/image15.png)</span></span>

<span data-ttu-id="23fc6-209">**Рис. 7**. достигнута точка останова хранимой процедуры ([щелкните, чтобы просмотреть изображение с полным размером](debugging-stored-procedures-cs/_static/image17.png))</span><span class="sxs-lookup"><span data-stu-id="23fc6-209">**Figure 7**: The Stored Procedure s Breakpoint has been Reached ([Click to view full-size image](debugging-stored-procedures-cs/_static/image17.png))</span></span>

<span data-ttu-id="23fc6-210">Как показано окно контрольных значений на рис. 7, значение параметра `@CategoryID` равно 1.</span><span class="sxs-lookup"><span data-stu-id="23fc6-210">As the Watch window in Figure 7 shows, the value of the `@CategoryID` parameter is 1.</span></span> <span data-ttu-id="23fc6-211">Это связано с тем, что страница `ExistingSprocs.aspx` изначально отображает продукты в категории «напитки», которая имеет `CategoryID` значение 1.</span><span class="sxs-lookup"><span data-stu-id="23fc6-211">This is because the `ExistingSprocs.aspx` page initially displays products in the beverages category, which has a `CategoryID` value of 1.</span></span> <span data-ttu-id="23fc6-212">Выберите другую категорию из раскрывающегося списка.</span><span class="sxs-lookup"><span data-stu-id="23fc6-212">Choose a different category from the drop-down list.</span></span> <span data-ttu-id="23fc6-213">Это вызывает обратную передачу и повторно выполняет хранимую процедуру `Products_SelectByCategoryID`.</span><span class="sxs-lookup"><span data-stu-id="23fc6-213">Doing so causes a postback and re-executes the `Products_SelectByCategoryID` stored procedure.</span></span> <span data-ttu-id="23fc6-214">Точка останова снова будет достигнута, но на этот раз значение параметра `@CategoryID` s отражает выбранный `CategoryID`элемент раскрывающегося списка.</span><span class="sxs-lookup"><span data-stu-id="23fc6-214">The breakpoint is hit again, but this time the `@CategoryID` parameter s value reflects the selected drop-down list item s `CategoryID`.</span></span>

<span data-ttu-id="23fc6-215">[![выбрать другую категорию из раскрывающегося списка](debugging-stored-procedures-cs/_static/image19.png)](debugging-stored-procedures-cs/_static/image18.png)</span><span class="sxs-lookup"><span data-stu-id="23fc6-215">[![Choose a Different Category from the Drop-Down List](debugging-stored-procedures-cs/_static/image19.png)](debugging-stored-procedures-cs/_static/image18.png)</span></span>

<span data-ttu-id="23fc6-216">**Рис. 8**. Выбор другой категории из раскрывающегося списка ([щелкните, чтобы просмотреть изображение с полным размером](debugging-stored-procedures-cs/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="23fc6-216">**Figure 8**: Choose a Different Category from the Drop-Down List ([Click to view full-size image](debugging-stored-procedures-cs/_static/image20.png))</span></span>

<span data-ttu-id="23fc6-217">[![параметр @CategoryID отражает категорию, выбранную на веб-странице](debugging-stored-procedures-cs/_static/image22.png)](debugging-stored-procedures-cs/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="23fc6-217">[![The @CategoryID Parameter Reflects the Category Selected from the Web Page](debugging-stored-procedures-cs/_static/image22.png)](debugging-stored-procedures-cs/_static/image21.png)</span></span>

<span data-ttu-id="23fc6-218">**Рис. 9**. параметр `@CategoryID` отражает категорию, выбранную на веб-странице ([щелкните, чтобы просмотреть изображение с полным размером](debugging-stored-procedures-cs/_static/image23.png))</span><span class="sxs-lookup"><span data-stu-id="23fc6-218">**Figure 9**: The `@CategoryID` Parameter Reflects the Category Selected from the Web Page ([Click to view full-size image](debugging-stored-procedures-cs/_static/image23.png))</span></span>

> [!NOTE]
> <span data-ttu-id="23fc6-219">Если точка останова в `Products_SelectByCategoryID` хранимой процедуре не достигается при посещении страницы `ExistingSprocs.aspx`, убедитесь, что флажок SQL Server установлен в разделе отладчики страницы свойств приложения ASP.NET, что пулы соединений отключены и включен параметр отладки приложений базы данных.</span><span class="sxs-lookup"><span data-stu-id="23fc6-219">If the breakpoint in the `Products_SelectByCategoryID` stored procedure is not hit when visiting the `ExistingSprocs.aspx` page, make sure that the SQL Server checkbox has been checked in the Debuggers section of the ASP.NET application s Properties Page, that connection pooling has been disabled, and that the database s Application Debugging option is enabled.</span></span> <span data-ttu-id="23fc6-220">Если проблемы не исчезли, перезапустите Visual Studio и повторите попытку.</span><span class="sxs-lookup"><span data-stu-id="23fc6-220">If you re still having problems, restart Visual Studio and try again.</span></span>

## <a name="debugging-t-sql-database-objects-on-remote-instances"></a><span data-ttu-id="23fc6-221">Отладка объектов базы данных T-SQL на удаленных экземплярах</span><span class="sxs-lookup"><span data-stu-id="23fc6-221">Debugging T-SQL Database Objects on Remote Instances</span></span>

<span data-ttu-id="23fc6-222">Отладка объектов базы данных с помощью Visual Studio довольно проста, если SQL Server экземпляр базы данных находится на том же компьютере, что и Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="23fc6-222">Debugging database objects through Visual Studio is fairly straightforward when the SQL Server database instance is on the same machine as Visual Studio.</span></span> <span data-ttu-id="23fc6-223">Тем не менее, если SQL Server и Visual Studio находятся на разных компьютерах, то для правильной работы все должно быть достаточно тщательной настройки.</span><span class="sxs-lookup"><span data-stu-id="23fc6-223">However, if SQL Server and Visual Studio reside on different machines then some careful configuration is required to get everything working properly.</span></span> <span data-ttu-id="23fc6-224">Существует две основные задачи, с которыми мы столкнулись:</span><span class="sxs-lookup"><span data-stu-id="23fc6-224">There are two core tasks we are faced with:</span></span>

- <span data-ttu-id="23fc6-225">Убедитесь, что имя входа, используемое для подключения к базе данных через ADO.NET, принадлежит роли `sysadmin`.</span><span class="sxs-lookup"><span data-stu-id="23fc6-225">Ensure that the login used to connect to the database via ADO.NET belongs to the `sysadmin` role.</span></span>
- <span data-ttu-id="23fc6-226">Убедитесь, что учетная запись пользователя Windows, используемая Visual Studio на компьютере разработки, является допустимой SQL Server учетной записи входа, принадлежащей роли `sysadmin`.</span><span class="sxs-lookup"><span data-stu-id="23fc6-226">Ensure that the Windows user account used by Visual Studio on the development machine is a valid SQL Server login account that belongs to the `sysadmin` role.</span></span>

<span data-ttu-id="23fc6-227">Первый шаг относительно прост.</span><span class="sxs-lookup"><span data-stu-id="23fc6-227">The first step is relatively straightforward.</span></span> <span data-ttu-id="23fc6-228">Сначала укажите учетную запись пользователя, используемую для подключения к базе данных из приложения ASP.NET, а затем в SQL Server Management Studio добавьте эту учетную запись входа в роль `sysadmin`.</span><span class="sxs-lookup"><span data-stu-id="23fc6-228">First, identify the user account used to connect to the database from the ASP.NET application and then, from SQL Server Management Studio, add that login account to the `sysadmin` role.</span></span>

<span data-ttu-id="23fc6-229">Для второй задачи требуется, чтобы учетная запись пользователя Windows, используемая для отладки приложения, была действительным именем входа в удаленной базе данных.</span><span class="sxs-lookup"><span data-stu-id="23fc6-229">The second task requires that the Windows user account you use to debug the application be a valid login on the remote database.</span></span> <span data-ttu-id="23fc6-230">Однако, скорее всего, учетная запись Windows, которую вы вошли на рабочую станцию, не является допустимым именем входа на SQL Server.</span><span class="sxs-lookup"><span data-stu-id="23fc6-230">However, chances are the Windows account you logged on to your workstation with is not a valid login on SQL Server.</span></span> <span data-ttu-id="23fc6-231">Вместо того, чтобы добавлять конкретную учетную запись для входа в SQL Server, лучше выбрать учетную запись пользователя Windows в качестве учетной записи SQL Server отладки.</span><span class="sxs-lookup"><span data-stu-id="23fc6-231">Rather than adding your particular login account to SQL Server, a better choice would be to designate some Windows user account as the SQL Server debugging account.</span></span> <span data-ttu-id="23fc6-232">Затем, чтобы выполнить отладку объектов базы данных удаленного экземпляра SQL Server, необходимо запустить Visual Studio, используя учетные данные учетной записи входа Windows.</span><span class="sxs-lookup"><span data-stu-id="23fc6-232">Then, to debug the database objects of a remote SQL Server instance, you would run Visual Studio using that Windows login account s credentials.</span></span>

<span data-ttu-id="23fc6-233">Пример должен помочь прояснить вещи.</span><span class="sxs-lookup"><span data-stu-id="23fc6-233">An example should help clarify things.</span></span> <span data-ttu-id="23fc6-234">Представьте себе, что в домене Windows есть учетная запись Windows с именем `SQLDebug`.</span><span class="sxs-lookup"><span data-stu-id="23fc6-234">Imagine that there is a Windows account named `SQLDebug` within the Windows domain.</span></span> <span data-ttu-id="23fc6-235">Эту учетную запись необходимо добавить к удаленному экземпляру SQL Server в качестве допустимого имени входа и члена роли `sysadmin`.</span><span class="sxs-lookup"><span data-stu-id="23fc6-235">This account would need to be added to the remote SQL Server instance as a valid login and as a member of the `sysadmin` role.</span></span> <span data-ttu-id="23fc6-236">Затем, чтобы выполнить отладку удаленного экземпляра SQL Server из Visual Studio, необходимо запустить Visual Studio от имени пользователя `SQLDebug`.</span><span class="sxs-lookup"><span data-stu-id="23fc6-236">Then, to debug the remote SQL Server instance from Visual Studio, we would need to run Visual Studio as the `SQLDebug` user.</span></span> <span data-ttu-id="23fc6-237">Это можно сделать, выполнив выход из рабочей станции, войдя в систему как `SQLDebug`, а затем запуская Visual Studio, но более простой подход — войти на рабочую станцию, используя собственные учетные данные, а затем использовать `runas.exe` для запуска Visual Studio в качестве `SQLDebug` пользователя.</span><span class="sxs-lookup"><span data-stu-id="23fc6-237">This could be done by logging out of our workstation, logging back in as `SQLDebug`, and then launching Visual Studio, but a simpler approach would be to login to our workstation using our own credentials and then use `runas.exe` to launch Visual Studio as the `SQLDebug` user.</span></span> <span data-ttu-id="23fc6-238">`runas.exe` позволяет выполнять определенное приложение под ГИП другой учетной записи пользователя.</span><span class="sxs-lookup"><span data-stu-id="23fc6-238">`runas.exe` allows a particular application to be executed under the guise of a different user account.</span></span> <span data-ttu-id="23fc6-239">Чтобы запустить Visual Studio в качестве `SQLDebug`, в командной строке можно ввести следующую инструкцию:</span><span class="sxs-lookup"><span data-stu-id="23fc6-239">To launch Visual Studio as `SQLDebug`, you could enter the following statement at the command line:</span></span>

[!code-console[Main](debugging-stored-procedures-cs/samples/sample2.cmd)]

<span data-ttu-id="23fc6-240">Более подробное описание этого процесса см. в разделе [Уильям R. Вон](http://betav.com/BLOG/billva/) s *Путеводитель s Guide to Visual Studio and SQL Server, седьмой выпуск,* а также [инструкции по заданию разрешений SQL Server для отладки](https://msdn.microsoft.com/library/w1bhybwz(VS.80).aspx).</span><span class="sxs-lookup"><span data-stu-id="23fc6-240">For a more detailed explanation on this process, see [William R. Vaughn](http://betav.com/BLOG/billva/) s *Hitchhiker s Guide to Visual Studio and SQL Server, Seventh Edition* as well as [How To: Set SQL Server Permissions for Debugging](https://msdn.microsoft.com/library/w1bhybwz(VS.80).aspx).</span></span>

> [!NOTE]
> <span data-ttu-id="23fc6-241">Если на компьютере разработчика установлена ОС Windows XP с пакетом обновления 2 (SP2), необходимо настроить брандмауэр подключения к Интернету, чтобы разрешить удаленную отладку.</span><span class="sxs-lookup"><span data-stu-id="23fc6-241">If your development machine is running Windows XP Service Pack 2 you will need to configure the Internet Connection Firewall to allow remote debugging.</span></span> <span data-ttu-id="23fc6-242">[В статье как включить отладку SQL Server 2005](https://msdn.microsoft.com/library/s0fk6z6e(VS.80).aspx) заметок о том, что в этом разделе содержится два шага: (а) на хост-компьютере Visual Studio, необходимо добавить `Devenv.exe` в список исключений и открыть порт TCP 135. и (б) на удаленном компьютере (SQL), необходимо открыть порт TCP 135 и добавить `sqlservr.exe` в список исключений.</span><span class="sxs-lookup"><span data-stu-id="23fc6-242">[The How To: Enable SQL Server 2005 Debugging](https://msdn.microsoft.com/library/s0fk6z6e(VS.80).aspx) article notes that this involves two steps: (a) On the Visual Studio host machine, you must add `Devenv.exe` to the Exceptions list and open the TCP 135 port; and (b) On the remote (SQL) machine, you must open the TCP 135 port and add `sqlservr.exe` to the Exceptions list.</span></span> <span data-ttu-id="23fc6-243">Если политика домена требует, чтобы сетевая связь была выполнена через IPSec, необходимо открыть порты UDP 4500 и UDP 500.</span><span class="sxs-lookup"><span data-stu-id="23fc6-243">If your domain policy requires network communication to be done through IPSec, you must open the UDP 4500 and UDP 500 ports.</span></span>

## <a name="summary"></a><span data-ttu-id="23fc6-244">Сводка</span><span class="sxs-lookup"><span data-stu-id="23fc6-244">Summary</span></span>

<span data-ttu-id="23fc6-245">Помимо поддержки отладки кода приложений .NET, в Visual Studio также доступны различные варианты отладки для SQL Server 2005.</span><span class="sxs-lookup"><span data-stu-id="23fc6-245">In addition to providing debugging support for .NET application code, Visual Studio also provides a variety of debugging options for SQL Server 2005.</span></span> <span data-ttu-id="23fc6-246">В этом учебнике мы рассматривали два варианта: Непосредственная отладка базы данных и отладка приложений.</span><span class="sxs-lookup"><span data-stu-id="23fc6-246">In this tutorial we looked at two of those options: Direct Database Debugging and application debugging.</span></span> <span data-ttu-id="23fc6-247">Чтобы выполнить отладку объекта базы данных T-SQL напрямую, найдите объект с помощью обозреватель сервера щелкните его правой кнопкой мыши и выберите шаг с заходом.</span><span class="sxs-lookup"><span data-stu-id="23fc6-247">To directly debug a T-SQL database object, locate the object through the Server Explorer then right-click on it and choose Step Into.</span></span> <span data-ttu-id="23fc6-248">При этом запускается отладчик и останавливается на первом операторе в объекте Database, после чего можно выполнить пошаговое выполнение инструкций Object s и просмотреть и изменить значения параметров.</span><span class="sxs-lookup"><span data-stu-id="23fc6-248">This starts the debugger and halts on the first statement in the database object, at which point you can step through the object s statements and view and modify parameter values.</span></span> <span data-ttu-id="23fc6-249">На этапе 1 мы использовали этот подход для пошагового перехода к хранимой процедуре `Products_SelectByCategoryID`.</span><span class="sxs-lookup"><span data-stu-id="23fc6-249">In Step 1 we used this approach to step into the `Products_SelectByCategoryID` stored procedure.</span></span>

<span data-ttu-id="23fc6-250">Отладка приложений позволяет задавать точки останова непосредственно в объектах базы данных.</span><span class="sxs-lookup"><span data-stu-id="23fc6-250">Application debugging allows breakpoints to be set directly within the database objects.</span></span> <span data-ttu-id="23fc6-251">Когда объект базы данных с точками останова вызывается из клиентского приложения (например, веб-приложения ASP.NET), программа останавливается, когда выполняется отладчик.</span><span class="sxs-lookup"><span data-stu-id="23fc6-251">When a database object with breakpoints is invoked from a client application (such as an ASP.NET web application), the program halts as the debugger takes over.</span></span> <span data-ttu-id="23fc6-252">Отладка приложений полезна, так как более ясно показывает, какое действие приложения приводит к вызову определенного объекта базы данных.</span><span class="sxs-lookup"><span data-stu-id="23fc6-252">Application debugging is useful because it more clearly shows what application action causes a particular database object to be invoked.</span></span> <span data-ttu-id="23fc6-253">Однако для этого требуется немного больше конфигурации и настройки, чем для прямой отладки базы данных.</span><span class="sxs-lookup"><span data-stu-id="23fc6-253">However, it requires a bit more configuration and setup than Direct Database Debugging.</span></span>

<span data-ttu-id="23fc6-254">Объекты базы данных также можно отлаживать с помощью проектов SQL Server.</span><span class="sxs-lookup"><span data-stu-id="23fc6-254">Database objects can also be debugged through SQL Server Projects.</span></span> <span data-ttu-id="23fc6-255">Мы рассмотрим использование проектов SQL Server и их использование для создания и отладки управляемых объектов базы данных в следующем руководстве.</span><span class="sxs-lookup"><span data-stu-id="23fc6-255">We will look at using SQL Server Projects and how to use them to create and debug managed database objects in the next tutorial.</span></span>

<span data-ttu-id="23fc6-256">Поздравляем с программированием!</span><span class="sxs-lookup"><span data-stu-id="23fc6-256">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="23fc6-257">Об авторе</span><span class="sxs-lookup"><span data-stu-id="23fc6-257">About the Author</span></span>

<span data-ttu-id="23fc6-258">[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи книг по ASP/ASP. NET и основатель [4GuysFromRolla.com](http://www.4guysfromrolla.com), работал с веб-технологиями Майкрософт с 1998.</span><span class="sxs-lookup"><span data-stu-id="23fc6-258">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="23fc6-259">Скотт работает как независимый консультант, преподаватель и модуль записи.</span><span class="sxs-lookup"><span data-stu-id="23fc6-259">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="23fc6-260">Его последняя книга — [*Sams обучать себя ASP.NET 2,0 за 24 часа*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="23fc6-260">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="23fc6-261">Он доступен по адресу [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="23fc6-261">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="23fc6-262">или через его блог, который можно найти по адресу [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="23fc6-262">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="23fc6-263">[Назад](protecting-connection-strings-and-other-configuration-information-cs.md)
> [Вперед](creating-stored-procedures-and-user-defined-functions-with-managed-code-cs.md)</span><span class="sxs-lookup"><span data-stu-id="23fc6-263">[Previous](protecting-connection-strings-and-other-configuration-information-cs.md)
[Next](creating-stored-procedures-and-user-defined-functions-with-managed-code-cs.md)</span></span>
