---
uid: web-forms/overview/data-access/advanced-data-access-scenarios/configuring-the-data-access-layer-s-connection-and-command-level-settings-vb
title: Настройка параметров подключения и уровня команды на уровня доступа к данным (Visual Basic) | Документация Майкрософт
author: rick-anderson
description: TableAdapters в типизированный набор DataSet автоматически выполняет подключение к базе данных, выполнения команд и Заполнение DataTable с результатами...
ms.author: riande
ms.date: 08/03/2007
ms.assetid: d57dfa2b-d627-45cb-b5b1-abbf3159d770
msc.legacyurl: /web-forms/overview/data-access/advanced-data-access-scenarios/configuring-the-data-access-layer-s-connection-and-command-level-settings-vb
msc.type: authoredcontent
ms.openlocfilehash: a6097a32f0a67436b786fcdd808964ac6b832439
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/09/2019
ms.locfileid: "59419578"
---
# <a name="configuring-the-data-access-layers-connection--and-command-level-settings-vb"></a><span data-ttu-id="09834-103">Настройка параметров подключения и параметров уровня команды на уровне доступа к данным (VB)</span><span class="sxs-lookup"><span data-stu-id="09834-103">Configuring the Data Access Layer's Connection- and Command-Level Settings (VB)</span></span>

<span data-ttu-id="09834-104">по [Скотт Митчелл](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="09834-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="09834-105">[Скачать код](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_72_VB.zip) или [скачать PDF](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/datatutorial72vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="09834-105">[Download Code](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_72_VB.zip) or [Download PDF](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/datatutorial72vb1.pdf)</span></span>

> <span data-ttu-id="09834-106">TableAdapters в типизированный набор DataSet автоматически выполнит подключение к базе данных, выполнения команд и Заполнение DataTable с результатами.</span><span class="sxs-lookup"><span data-stu-id="09834-106">The TableAdapters within a Typed DataSet automatically take care of connecting to the database, issuing commands, and populating a DataTable with the results.</span></span> <span data-ttu-id="09834-107">Существуют случаи, однако когда требуется следить за этими сведениями, сами и в этом руководстве мы узнаем, как получить доступ к параметрам уровня подключения и команды базы данных в TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="09834-107">There are occasions however when we want to take care of these details ourselves, and in this tutorial we learn how to access the database connection- and command-level settings in the TableAdapter.</span></span>


## <a name="introduction"></a><span data-ttu-id="09834-108">Вступление</span><span class="sxs-lookup"><span data-stu-id="09834-108">Introduction</span></span>

<span data-ttu-id="09834-109">В этой серии руководств мы использовали типизированных наборов DataSet для реализации уровня доступа к данным и бизнес-объектов наших многоуровневой архитектуры.</span><span class="sxs-lookup"><span data-stu-id="09834-109">Throughout the tutorial series we have used Typed DataSets to implement the Data Access Layer and business objects of our layered architecture.</span></span> <span data-ttu-id="09834-110">Как уже говорилось в [руководства по использованию](../introduction/creating-a-data-access-layer-vb.md), s типизированный набор DataSet, DataTables служат в качестве репозиториев данных, тогда как адаптеры таблиц выступать в роли оболочки для взаимодействия с базой данных для извлечения и изменения базовых данных.</span><span class="sxs-lookup"><span data-stu-id="09834-110">As discussed in the [first tutorial](../introduction/creating-a-data-access-layer-vb.md), the Typed DataSet s DataTables serve as repositories of data whereas the TableAdapters act as wrappers to communicate with the database to retrieve and modify the underlying data.</span></span> <span data-ttu-id="09834-111">TableAdapters инкапсулируют сложности, применяемыми при работе с базой данных и избавляет от необходимости писать код, чтобы соединиться с базой данных, команда или заполнения результаты в таблицу данных.</span><span class="sxs-lookup"><span data-stu-id="09834-111">The TableAdapters encapsulate the complexity involved in working with the database and saves us from having to write code to connect to the database, issue a command, or populate the results into a DataTable.</span></span>

<span data-ttu-id="09834-112">Бывают случаи, тем не менее, когда нам требуется burrow вглубь дикой адаптера таблицы и писать код, который работает непосредственно с объектами ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="09834-112">There are times, however, when we need to burrow into the depths of the TableAdapter and write code that works directly with the ADO.NET objects.</span></span> <span data-ttu-id="09834-113">В [перенос изменений базы данных в транзакции](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-vb.md) руководства, например, мы добавили методы TableAdapter для начало, фиксация и откат транзакций в ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="09834-113">In the [Wrapping Database Modifications within a Transaction](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-vb.md) tutorial, for example, we added methods to the TableAdapter for beginning, committing, and rolling back ADO.NET transactions.</span></span> <span data-ttu-id="09834-114">Эти методы использовать внутренний, созданная `SqlTransaction` объект, который был назначен TableAdapter s `SqlCommand` объектов.</span><span class="sxs-lookup"><span data-stu-id="09834-114">These methods used an internal, manually-created `SqlTransaction` object that was assigned to the TableAdapter s `SqlCommand` objects.</span></span>

<span data-ttu-id="09834-115">В этом руководстве мы рассмотрим, как получить доступ к параметрам уровня подключения и команды базы данных в TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="09834-115">In this tutorial we will examine how to access the database connection- and command-level settings in the TableAdapter.</span></span> <span data-ttu-id="09834-116">В частности, мы добавим возможность `ProductsTableAdapter` которое обеспечивает доступ к основной строки подключения и параметры времени ожидания команды.</span><span class="sxs-lookup"><span data-stu-id="09834-116">In particular, we will add functionality to the `ProductsTableAdapter` that enables access to the underlying connection string and command timeout settings.</span></span>

## <a name="working-with-data-using-adonet"></a><span data-ttu-id="09834-117">Работа с данными, с помощью ADO.NET</span><span class="sxs-lookup"><span data-stu-id="09834-117">Working with Data Using ADO.NET</span></span>

<span data-ttu-id="09834-118">Microsoft .NET Framework содержит множество классов, предназначенных специально для работы с данными.</span><span class="sxs-lookup"><span data-stu-id="09834-118">The Microsoft .NET Framework contains a plethora of classes designed specifically to work with data.</span></span> <span data-ttu-id="09834-119">Эти классы, найденных в [ `System.Data` пространства имен](https://msdn.microsoft.com/library/system.data.aspx), называются *ADO.NET* классы.</span><span class="sxs-lookup"><span data-stu-id="09834-119">These classes, found within the [`System.Data` namespace](https://msdn.microsoft.com/library/system.data.aspx), are referred to as the *ADO.NET* classes.</span></span> <span data-ttu-id="09834-120">Некоторые классы ADO.NET считать привязаны к конкретному *поставщик данных*.</span><span class="sxs-lookup"><span data-stu-id="09834-120">Some of the classes under the ADO.NET umbrella are tied to a particular *data provider*.</span></span> <span data-ttu-id="09834-121">Поставщик данных можно считать канала связи, который разрешает отправку информации об между классами ADO.NET и хранилище данных.</span><span class="sxs-lookup"><span data-stu-id="09834-121">You can think of a data provider as a communication channel that allows information to flow between the ADO.NET classes and the underlying data store.</span></span> <span data-ttu-id="09834-122">Существуют обобщенный поставщики, например, OleDb и ODBC, а также поставщиков, которые специально разработаны для определенной базы данных системы.</span><span class="sxs-lookup"><span data-stu-id="09834-122">There are generalized providers, like OleDb and ODBC, as well as providers that are specially designed for a particular database system.</span></span> <span data-ttu-id="09834-123">Например хотя можно подключиться к базе данных Microsoft SQL Server, используя зарегистрированный поставщик OleDb, Поставщик SqlClient гораздо эффективнее, так как она была разработана и оптимизирована для SQL Server.</span><span class="sxs-lookup"><span data-stu-id="09834-123">For example, while it is possible to connect to a Microsoft SQL Server database using the OleDb provider, the SqlClient provider is much more efficient as it was designed and optimized specifically for SQL Server.</span></span>

<span data-ttu-id="09834-124">При программном доступе к данным, обычно используется следующий шаблон:</span><span class="sxs-lookup"><span data-stu-id="09834-124">When programmatically accessing data, the following pattern is commonly used:</span></span>

1. <span data-ttu-id="09834-125">Установите подключение к базе данных.</span><span class="sxs-lookup"><span data-stu-id="09834-125">Establish a connection to the database.</span></span>
2. <span data-ttu-id="09834-126">Команду.</span><span class="sxs-lookup"><span data-stu-id="09834-126">Issue a command.</span></span>
3. <span data-ttu-id="09834-127">Для `SELECT` запросов, работать с результирующие записи.</span><span class="sxs-lookup"><span data-stu-id="09834-127">For `SELECT` queries, work with the resulting records.</span></span>

<span data-ttu-id="09834-128">Существуют отдельные классы ADO.NET по выполнению каждого из следующих действий.</span><span class="sxs-lookup"><span data-stu-id="09834-128">There are separate ADO.NET classes for performing each of these steps.</span></span> <span data-ttu-id="09834-129">Чтобы подключиться к базе данных с помощью поставщика SqlClient, например, использовать [ `SqlConnection` класс](https://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection(VS.80).aspx).</span><span class="sxs-lookup"><span data-stu-id="09834-129">To connect to a database using the SqlClient provider, for example, use the [`SqlConnection` class](https://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection(VS.80).aspx).</span></span> <span data-ttu-id="09834-130">Проблемы `INSERT`, `UPDATE`, `DELETE`, или `SELECT` базы данных, используйте команду [ `SqlCommand` класс](https://msdn.microsoft.com/library/system.data.sqlclient.sqlcommand.aspx).</span><span class="sxs-lookup"><span data-stu-id="09834-130">To issue an `INSERT`, `UPDATE`, `DELETE`, or `SELECT` command to the database, use the [`SqlCommand` class](https://msdn.microsoft.com/library/system.data.sqlclient.sqlcommand.aspx).</span></span>

<span data-ttu-id="09834-131">За исключением [перенос изменений базы данных в транзакции](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-vb.md) учебнике мы не сталкивались писать ADO.NET низкого уровня код сами, поскольку TableAdapters автоматически созданный код включает функции, необходимые для соединиться с базой данных, команд, получения данных и заполнить эти данные в DataTables.</span><span class="sxs-lookup"><span data-stu-id="09834-131">Except for the [Wrapping Database Modifications within a Transaction](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-vb.md) tutorial, we have not had to write any low-level ADO.NET code ourselves because the TableAdapters auto-generated code includes the functionality needed to connect to the database, issue commands, retrieve data, and populate that data into DataTables.</span></span> <span data-ttu-id="09834-132">Тем не менее могут возникнуть ситуации, когда нам требуется, чтобы настроить эти параметры низкого уровня.</span><span class="sxs-lookup"><span data-stu-id="09834-132">However, there may be times when we need to customize these low-level settings.</span></span> <span data-ttu-id="09834-133">На следующих шагах мы рассмотрим, как в объекты ADO.NET, внутренним классом TableAdapters.</span><span class="sxs-lookup"><span data-stu-id="09834-133">Over the next few steps we will examine how to tap into the ADO.NET objects used internally by the TableAdapters.</span></span>

## <a name="step-1-examining-with-the-connection-property"></a><span data-ttu-id="09834-134">Шаг 1. Проверка с помощью свойства соединения</span><span class="sxs-lookup"><span data-stu-id="09834-134">Step 1: Examining with the Connection Property</span></span>

<span data-ttu-id="09834-135">Каждый класс TableAdapter имеет `Connection` свойство, которое указывает подключение к базе данных.</span><span class="sxs-lookup"><span data-stu-id="09834-135">Each TableAdapter class has a `Connection` property that specifies database connection information.</span></span> <span data-ttu-id="09834-136">Этот тип данных свойства s и `ConnectionString` значение определяется выбранные в мастере настройки адаптера таблицы.</span><span class="sxs-lookup"><span data-stu-id="09834-136">This property s data type and `ConnectionString` value are determined by the selections made in the TableAdapter Configuration wizard.</span></span> <span data-ttu-id="09834-137">Помните, что если сначала мы добавим TableAdapter к типизированному набору DataSet этот мастер предложит нам для базы данных источника (см. рис. 1).</span><span class="sxs-lookup"><span data-stu-id="09834-137">Recall that when we first add a TableAdapter to a Typed DataSet this wizard asks us for the database source (see Figure 1).</span></span> <span data-ttu-id="09834-138">Выберите в раскрывающемся списке на первом этапе включает этих баз данных, указанных в файле конфигурации, а также других баз данных в обозревателе серверов s подключения к данным.</span><span class="sxs-lookup"><span data-stu-id="09834-138">The drop-down list in this first step includes those databases specified in the configuration file as well as any other databases in the Server Explorer s Data Connections.</span></span> <span data-ttu-id="09834-139">Если базы данных, которую мы хотим использовать отсутствует в раскрывающемся списке, подключение к новой базе данных можно задать, щелкнув кнопку новое соединение и предоставляя сведения о соединении, необходимые.</span><span class="sxs-lookup"><span data-stu-id="09834-139">If the database we want to use does not exist in the drop-down list, a new database connection can be specified by clicking the New Connection button and providing the needed connection information.</span></span>


[![T<span data-ttu-id="09834-140">он первым шагом мастера настройки адаптера таблицы]</span><span class="sxs-lookup"><span data-stu-id="09834-140">he First Step of the TableAdapter Configuration Wizard]</span></span>(configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image2.png)](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image1.png)

<span data-ttu-id="09834-141">**Рис. 1**: На первом шаге мастера настройки TableAdapter ([Просмотр полноразмерного изображения](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="09834-141">**Figure 1**: The First Step of the TableAdapter Configuration Wizard ([Click to view full-size image](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image3.png))</span></span>


<span data-ttu-id="09834-142">Let s Отвлекитесь и проверьте код для TableAdapter s `Connection` свойство.</span><span class="sxs-lookup"><span data-stu-id="09834-142">Let s take a moment to inspect the code for the TableAdapter s `Connection` property.</span></span> <span data-ttu-id="09834-143">Как отмечалось в [создание уровня доступа к данным](../introduction/creating-a-data-access-layer-vb.md) руководстве TableAdapter автоматически созданный код можно просмотреть, перейдя в окне просмотра классов, детализация соответствующий класс и затем дважды щелкнув имя члена.</span><span class="sxs-lookup"><span data-stu-id="09834-143">As noted in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-vb.md) tutorial, we can view the auto-generated TableAdapter code by going to the Class View window, drilling down to the appropriate class, and then double-clicking the member name.</span></span>

<span data-ttu-id="09834-144">Перейдите в окно представления классов, перейдя в меню "Вид" и выбрав представление классов (или введите сочетание клавиш Ctrl + Shift + C).</span><span class="sxs-lookup"><span data-stu-id="09834-144">Navigate to the Class View window by going to the View menu and choosing Class View (or by typing Ctrl+Shift+C).</span></span> <span data-ttu-id="09834-145">В верхней части окна представления классов, выполнить детализацию для `NorthwindTableAdapters` пространства имен и выберите `ProductsTableAdapter` класса.</span><span class="sxs-lookup"><span data-stu-id="09834-145">From the top half of the Class View window, drill down to the `NorthwindTableAdapters` namespace and select the `ProductsTableAdapter` class.</span></span> <span data-ttu-id="09834-146">При этом отобразится `ProductsTableAdapter` s членов в нижней половине представления класса, как показано на рис. 2.</span><span class="sxs-lookup"><span data-stu-id="09834-146">This will display the `ProductsTableAdapter` s members in the bottom half of the Class View, as shown in Figure 2.</span></span> <span data-ttu-id="09834-147">Дважды щелкните `Connection` свойство, чтобы увидеть его код.</span><span class="sxs-lookup"><span data-stu-id="09834-147">Double-click the `Connection` property to see its code.</span></span>


![Дважды щелкните Свойства соединения в окне просмотра классов, чтобы просмотреть его автоматически созданный код](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image4.png)

<span data-ttu-id="09834-149">**Рис. 2**: Дважды щелкните Свойства соединения в окне просмотра классов, чтобы просмотреть его автоматически созданный код</span><span class="sxs-lookup"><span data-stu-id="09834-149">**Figure 2**: Double-Click the Connection Property in the Class View to View Its Auto-Generated Code</span></span>


<span data-ttu-id="09834-150">TableAdapter s `Connection` свойства и другие относящиеся к соединению код следующим:</span><span class="sxs-lookup"><span data-stu-id="09834-150">The TableAdapter s `Connection` property and other connection-related code follows:</span></span>


[!code-vb[Main](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/samples/sample1.vb)]

<span data-ttu-id="09834-151">При создании экземпляра класса TableAdapter, переменную-член `_connection` равен `Nothing`.</span><span class="sxs-lookup"><span data-stu-id="09834-151">When the TableAdapter class is instantiated, the member variable `_connection` is equal to `Nothing`.</span></span> <span data-ttu-id="09834-152">Когда `Connection` обращении к свойству, он сначала проверяет `_connection` переменную-член, который был создан экземпляр.</span><span class="sxs-lookup"><span data-stu-id="09834-152">When the `Connection` property is accessed, it first checks to see if the `_connection` member variable has been instantiated.</span></span> <span data-ttu-id="09834-153">Если нет, `InitConnection` вызывается метод, который создает экземпляр `_connection` и задает его `ConnectionString` присваивается значение строки подключения, указанные в первом шаге мастера s настройки адаптера таблицы.</span><span class="sxs-lookup"><span data-stu-id="09834-153">If it has not, the `InitConnection` method is invoked, which instantiates `_connection` and sets its `ConnectionString` property to the connection string value specified from the TableAdapter Configuration wizard s first step.</span></span>

<span data-ttu-id="09834-154">`Connection` Свойства также могут быть назначены `SqlConnection` объекта.</span><span class="sxs-lookup"><span data-stu-id="09834-154">The `Connection` property can also be assigned to a `SqlConnection` object.</span></span> <span data-ttu-id="09834-155">Это связывает новый `SqlConnection` объекта с каждым из TableAdapter s `SqlCommand` объектов.</span><span class="sxs-lookup"><span data-stu-id="09834-155">Doing so associates the new `SqlConnection` object with each of the TableAdapter s `SqlCommand` objects.</span></span>

## <a name="step-2-exposing-connection-level-settings"></a><span data-ttu-id="09834-156">Шаг 2. Предоставление настройки уровня соединения</span><span class="sxs-lookup"><span data-stu-id="09834-156">Step 2: Exposing Connection-Level Settings</span></span>

<span data-ttu-id="09834-157">Сведения о подключении должны остаются инкапсулированный в TableAdapter и не быть доступны другие слои в архитектуре приложения.</span><span class="sxs-lookup"><span data-stu-id="09834-157">The connection information should remain encapsulated within the TableAdapter and not be accessible to other layers in the application architecture.</span></span> <span data-ttu-id="09834-158">Однако возможны сценарии при сведения уровня соединения s TableAdapter должен быть доступен или настраиваемые для запроса, пользователя или страницы ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="09834-158">However, there may be scenarios when the TableAdapter s connection-level information needs to be accessible or customizable for a query, user, or ASP.NET page.</span></span>

<span data-ttu-id="09834-159">Позволяют расширить s `ProductsTableAdapter` в `Northwind` набор данных для включения `ConnectionString` свойство, которое может использоваться с уровня бизнес-логики для чтения или измените строку подключения, используемого TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="09834-159">Let s extend the `ProductsTableAdapter` in the `Northwind` DataSet to include a `ConnectionString` property that can be used by the Business Logic Layer to read or change the connection string used by the TableAdapter.</span></span>

> [!NOTE]
> <span data-ttu-id="09834-160">Объект *строку подключения* является строка, указывающая подключение к базе данных, таких как службу, чтобы использовать расположение базы данных, учетные данные проверки подлинности и другие параметры, относящиеся к базе данных.</span><span class="sxs-lookup"><span data-stu-id="09834-160">A *connection string* is a string that specifies database connection information, such as the provider to use, the location of the database, authentication credentials, and other database-related settings.</span></span> <span data-ttu-id="09834-161">Список шаблонов строк подключения, используемые широкий набор хранилищ данных и поставщики, см. в разделе [ConnectionStrings.com](http://www.connectionstrings.com/).</span><span class="sxs-lookup"><span data-stu-id="09834-161">For a list of connection string patterns used by a variety of data stores and providers, see [ConnectionStrings.com](http://www.connectionstrings.com/).</span></span>


<span data-ttu-id="09834-162">Как уже говорилось в [создание уровня доступа к данным](../introduction/creating-a-data-access-layer-vb.md) руководстве типизированный набор DataSet s автоматически генерируемых классов можно расширить посредством использования частичных классов.</span><span class="sxs-lookup"><span data-stu-id="09834-162">As discussed in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-vb.md) tutorial, the Typed DataSet s auto-generated classes can be extended through the use of partial classes.</span></span> <span data-ttu-id="09834-163">Во-первых, создайте новую вложенную папку в проекте с именем `ConnectionAndCommandSettings` под `~/App_Code/DAL` папки.</span><span class="sxs-lookup"><span data-stu-id="09834-163">First, create a new subfolder in the project named `ConnectionAndCommandSettings` underneath the `~/App_Code/DAL` folder.</span></span>


![Добавить вложенную папку с именем ConnectionAndCommandSettings](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image5.png)

<span data-ttu-id="09834-165">**Рис. 3**: Добавить вложенную папку с именем</span><span class="sxs-lookup"><span data-stu-id="09834-165">**Figure 3**: Add a Subfolder Named</span></span> `ConnectionAndCommandSettings`


<span data-ttu-id="09834-166">Добавьте новый файл класса с именем `ProductsTableAdapter.ConnectionAndCommandSettings.vb` и введите следующий код:</span><span class="sxs-lookup"><span data-stu-id="09834-166">Add a new class file named `ProductsTableAdapter.ConnectionAndCommandSettings.vb` and enter the following code:</span></span>


[!code-vb[Main](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/samples/sample2.vb)]

<span data-ttu-id="09834-167">Этот частичный класс добавляет `Public` свойство с именем `ConnectionString` для `ProductsTableAdapter` класс, который позволяет любой уровень считывать или обновлять строку подключения для TableAdapter s Базовое соединение.</span><span class="sxs-lookup"><span data-stu-id="09834-167">This partial class adds a `Public` property named `ConnectionString` to the `ProductsTableAdapter` class that allows any layer to read or update the connection string for the TableAdapter s underlying connection.</span></span>

<span data-ttu-id="09834-168">Этот частичный класс для создания (и сохранен), откройте `ProductsBLL` класса.</span><span class="sxs-lookup"><span data-stu-id="09834-168">With this partial class created (and saved), open the `ProductsBLL` class.</span></span> <span data-ttu-id="09834-169">Перейдите к одному из существующих методов и введите `Adapter` и затем нажмите клавишу периода для вызова IntelliSense.</span><span class="sxs-lookup"><span data-stu-id="09834-169">Go to one of the existing methods and type in `Adapter` and then hit the period key to bring up IntelliSense.</span></span> <span data-ttu-id="09834-170">Вы должны увидеть новый `ConnectionString` свойство, доступное в IntelliSense, это означает, что можно программно считывать или изменить это значение из BLL.</span><span class="sxs-lookup"><span data-stu-id="09834-170">You should see the new `ConnectionString` property available in IntelliSense, meaning that you can programmatically read or adjust this value from the BLL.</span></span>

## <a name="exposing-the-entire-connection-object"></a><span data-ttu-id="09834-171">Предоставление объекта всего подключения</span><span class="sxs-lookup"><span data-stu-id="09834-171">Exposing the Entire Connection Object</span></span>

<span data-ttu-id="09834-172">Этот частичный класс содержит только одно свойство объекта базового соединения: `ConnectionString`.</span><span class="sxs-lookup"><span data-stu-id="09834-172">This partial class exposes just one property of the underlying connection object: `ConnectionString`.</span></span> <span data-ttu-id="09834-173">Если вы хотите сделать всего подключения объект доступным за границы TableAdapter, можно также изменить `Connection` свойство s уровень защиты.</span><span class="sxs-lookup"><span data-stu-id="09834-173">If you want to make the entire connection object available beyond the confines of the TableAdapter, you can alternatively change the `Connection` property s protection level.</span></span> <span data-ttu-id="09834-174">Автоматически созданный код, который мы рассмотрели в шаге 1 показали, что TableAdapter s `Connection` свойство помечается как `Friend`, это означает, что он может осуществляться только с помощью классов в той же сборке.</span><span class="sxs-lookup"><span data-stu-id="09834-174">The auto-generated code we examined in Step 1 showed that the TableAdapter s `Connection` property is marked as `Friend`, meaning that it can only be accessed by classes in the same assembly.</span></span> <span data-ttu-id="09834-175">Это можно изменить, однако с помощью адаптера таблицы s `ConnectionModifier` свойство.</span><span class="sxs-lookup"><span data-stu-id="09834-175">This can be changed, however, via the TableAdapter s `ConnectionModifier` property.</span></span>

<span data-ttu-id="09834-176">Откройте `Northwind` набора данных, щелкните `ProductsTableAdapter` в конструкторе и перейдите в окно свойств.</span><span class="sxs-lookup"><span data-stu-id="09834-176">Open the `Northwind` DataSet, click on the `ProductsTableAdapter` in the Designer, and navigate to the Properties window.</span></span> <span data-ttu-id="09834-177">Вы увидите следующие сведения `ConnectionModifier` присвоено значение по умолчанию `Assembly`.</span><span class="sxs-lookup"><span data-stu-id="09834-177">There you will see the `ConnectionModifier` set to its default value, `Assembly`.</span></span> <span data-ttu-id="09834-178">Чтобы сделать `Connection` доступны за пределами сборки s типизированный набор DataSet, изменение свойства `ConnectionModifier` свойства `Public`.</span><span class="sxs-lookup"><span data-stu-id="09834-178">To make the `Connection` property available outside of the Typed DataSet s assembly, change the `ConnectionModifier` property to `Public`.</span></span>


[![T<span data-ttu-id="09834-179">он свойство соединения s уровень доступности можно настроить через свойство ConnectionModifier]</span><span class="sxs-lookup"><span data-stu-id="09834-179">he Connection Property s Accessibility Level Can Be Configured via the ConnectionModifier Property]</span></span>(configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image7.png)](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image6.png)

<span data-ttu-id="09834-180">**Рис. 4**: `Connection` Свойства специальных возможностей можно настроить уровень s через `ConnectionModifier` свойство ([Просмотр полноразмерного изображения](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="09834-180">**Figure 4**: The `Connection` Property s Accessibility Level Can Be Configured via the `ConnectionModifier` Property ([Click to view full-size image](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image8.png))</span></span>


<span data-ttu-id="09834-181">Сохранить набор данных и затем вернуться к `ProductsBLL` класса.</span><span class="sxs-lookup"><span data-stu-id="09834-181">Save the DataSet and then return to the `ProductsBLL` class.</span></span> <span data-ttu-id="09834-182">Как ранее, перейдите к одному из существующих методов и введите `Adapter` и затем нажмите клавишу периода для вызова IntelliSense.</span><span class="sxs-lookup"><span data-stu-id="09834-182">As before, go to one of the existing methods and type in `Adapter` and then hit the period key to bring up IntelliSense.</span></span> <span data-ttu-id="09834-183">Список должен включать `Connection` свойство, это означает, что теперь программно читать или назначить любые настройки уровня соединения из BLL.</span><span class="sxs-lookup"><span data-stu-id="09834-183">The list should include a `Connection` property, meaning that you can now programmatically read or assign any connection-level settings from the BLL.</span></span>

## <a name="step-3-examining-the-command-related-properties"></a><span data-ttu-id="09834-184">Шаг 3. Изучение свойств, связанных с командой</span><span class="sxs-lookup"><span data-stu-id="09834-184">Step 3: Examining the Command-Related Properties</span></span>

<span data-ttu-id="09834-185">Адаптер таблицы состоит из основного запроса, который, по умолчанию создан `INSERT`, `UPDATE`, и `DELETE` инструкций.</span><span class="sxs-lookup"><span data-stu-id="09834-185">A TableAdapter consists of a main query that, by default, has auto-generated `INSERT`, `UPDATE`, and `DELETE` statements.</span></span> <span data-ttu-id="09834-186">Этот основной запрос s `INSERT`, `UPDATE`, и `DELETE` инструкции выполняются в коде адаптера таблицы s как объект адаптера данных ADO.NET с помощью `Adapter` свойство.</span><span class="sxs-lookup"><span data-stu-id="09834-186">This main query s `INSERT`, `UPDATE`, and `DELETE` statements are implemented in the TableAdapter s code as an ADO.NET data adapter object via the `Adapter` property.</span></span> <span data-ttu-id="09834-187">Как и в его `Connection` свойство, `Adapter` тип данных свойства s определяется поставщик данных, используемый.</span><span class="sxs-lookup"><span data-stu-id="09834-187">Like with its `Connection` property, the `Adapter` property s data type is determined by the data provider used.</span></span> <span data-ttu-id="09834-188">Так как в этих учебниках используется поставщик SqlClient, `Adapter` свойство имеет тип [ `SqlDataAdapter` ](https://msdn.microsoft.com/library/system.data.sqlclient.sqldataadapter(VS.80).aspx).</span><span class="sxs-lookup"><span data-stu-id="09834-188">Since these tutorials use the SqlClient provider, the `Adapter` property is of type [`SqlDataAdapter`](https://msdn.microsoft.com/library/system.data.sqlclient.sqldataadapter(VS.80).aspx).</span></span>

<span data-ttu-id="09834-189">TableAdapter s `Adapter` свойство имеет три свойства типа `SqlCommand` , используемого для проблемы `INSERT`, `UPDATE`, и `DELETE` инструкции:</span><span class="sxs-lookup"><span data-stu-id="09834-189">The TableAdapter s `Adapter` property has three properties of type `SqlCommand` that it uses to issue the `INSERT`, `UPDATE`, and `DELETE` statements:</span></span>

- `InsertCommand`
- `UpdateCommand`
- `DeleteCommand`

<span data-ttu-id="09834-190">Объект `SqlCommand` объект отвечает за отправку определенного запроса к базе данных и содержит свойства, например: [ `CommandText` ](https://msdn.microsoft.com/library/system.data.sqlclient.sqlcommand.commandtext.aspx), который содержит специальный оператор SQL или хранимая процедура, выполняющаяся; и [ `Parameters` ](https://msdn.microsoft.com/library/system.data.sqlclient.sqlcommand.parameters.aspx), который является коллекцией `SqlParameter` объектов.</span><span class="sxs-lookup"><span data-stu-id="09834-190">A `SqlCommand` object is responsible for sending a particular query to the database and has properties like: [`CommandText`](https://msdn.microsoft.com/library/system.data.sqlclient.sqlcommand.commandtext.aspx), which contains the ad-hoc SQL statement or stored procedure to execute; and [`Parameters`](https://msdn.microsoft.com/library/system.data.sqlclient.sqlcommand.parameters.aspx), which is a collection of `SqlParameter` objects.</span></span> <span data-ttu-id="09834-191">Как мы видели в [создание уровня доступа к данным](../introduction/creating-a-data-access-layer-vb.md) руководстве эти команды объектов можно настроить с помощью окна «Свойства».</span><span class="sxs-lookup"><span data-stu-id="09834-191">As we saw back in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-vb.md) tutorial, these command objects can be customized through the Properties window.</span></span>

<span data-ttu-id="09834-192">В дополнение к его основного запроса адаптера таблицы может включать ряд методов, переменных, при вызове диспетчеризации указанной команды в базу данных.</span><span class="sxs-lookup"><span data-stu-id="09834-192">In addition to its main query, the TableAdapter can include a variable number of methods that, when invoked, dispatch a specified command to the database.</span></span> <span data-ttu-id="09834-193">Объект command основного запроса s и командных объектов для всех дополнительных методов, хранятся в TableAdapter s `CommandCollection` свойство.</span><span class="sxs-lookup"><span data-stu-id="09834-193">The main query s command object and the command objects for all additional methods are stored in the TableAdapter s `CommandCollection` property.</span></span>

<span data-ttu-id="09834-194">Let s Отвлекитесь и просмотрите код, сгенерированный `ProductsTableAdapter` в `Northwind` набор данных для этих двух свойств и их вспомогательные переменные-члены и вспомогательные методы:</span><span class="sxs-lookup"><span data-stu-id="09834-194">Let s take a moment to look at the code generated by the `ProductsTableAdapter` in the `Northwind` DataSet for these two properties and their supporting member variables and helper methods:</span></span>


[!code-vb[Main](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/samples/sample3.vb)]

<span data-ttu-id="09834-195">Код для `Adapter` и `CommandCollection` свойства точно имитирует, `Connection` свойство.</span><span class="sxs-lookup"><span data-stu-id="09834-195">The code for the `Adapter` and `CommandCollection` properties closely mimics that of the `Connection` property.</span></span> <span data-ttu-id="09834-196">Существуют переменные-члены, которые содержат объекты, используемые в свойствах.</span><span class="sxs-lookup"><span data-stu-id="09834-196">There are member variables that hold the objects used by the properties.</span></span> <span data-ttu-id="09834-197">Свойства `Get` методы доступа начните с проверки для получения соответствующей переменной члена `Nothing`.</span><span class="sxs-lookup"><span data-stu-id="09834-197">The properties `Get` accessors start by checking to see if the corresponding member variable is `Nothing`.</span></span> <span data-ttu-id="09834-198">Если Да, метод инициализации вызывается в том случае, который создает экземпляр переменной-члена и назначает основные свойства, связанных с командой.</span><span class="sxs-lookup"><span data-stu-id="09834-198">If so, an initialization method is called which creates an instance of the member variable and assigns the core command-related properties.</span></span>

## <a name="step-4-exposing-command-level-settings"></a><span data-ttu-id="09834-199">Шаг 4. Предоставление параметров уровня команды</span><span class="sxs-lookup"><span data-stu-id="09834-199">Step 4: Exposing Command-Level Settings</span></span>

<span data-ttu-id="09834-200">В идеале сведения на уровне команды должны оставаться инкапсулированный в пределах уровня доступа к данным.</span><span class="sxs-lookup"><span data-stu-id="09834-200">Ideally, the command-level information should remain encapsulated within the Data Access Layer.</span></span> <span data-ttu-id="09834-201">Эта информация понадобится на других уровнях архитектуры, тем не менее, его могут предоставляться через разделяемый класс, так же, как с помощью настройки уровня соединения.</span><span class="sxs-lookup"><span data-stu-id="09834-201">Should this information be needed in other layers of the architecture, however, it can be exposed through a partial class, just like with the connection-level settings.</span></span>

<span data-ttu-id="09834-202">Поскольку TableAdapter имеет только один `Connection` свойство, код для предоставления настройки уровня соединения вполне очевиден.</span><span class="sxs-lookup"><span data-stu-id="09834-202">Since the TableAdapter only has a single `Connection` property, the code for exposing connection-level settings is fairly straightforward.</span></span> <span data-ttu-id="09834-203">Вещей немного более сложны, при изменении параметров уровня команды, поскольку TableAdapter может иметь несколько объектов команды - `InsertCommand`, `UpdateCommand`, и `DeleteCommand`, вместе с переменное число командные объекты в `CommandCollection` свойство.</span><span class="sxs-lookup"><span data-stu-id="09834-203">Things are a bit more complicated when modifying command-level settings because the TableAdapter can have multiple command objects - an `InsertCommand`, `UpdateCommand`, and `DeleteCommand`, along with a variable number of command objects in the `CommandCollection` property.</span></span> <span data-ttu-id="09834-204">При обновлении параметров уровня команды, эти параметры необходимо распространить на все объекты команды.</span><span class="sxs-lookup"><span data-stu-id="09834-204">When updating command-level settings, these settings will need to be propagated to all of the command objects.</span></span>

<span data-ttu-id="09834-205">Например представьте факт определенных запросов в адаптер таблицы, затраченное на выполнение дополнительной продолжительное время.</span><span class="sxs-lookup"><span data-stu-id="09834-205">For example, imagine that there were certain queries in the TableAdapter that took an extraordinary long time to execute.</span></span> <span data-ttu-id="09834-206">При использовании адаптера таблицы для выполнения любого из этих запросов, нам может понадобиться увеличить объект команды s [ `CommandTimeout` свойство](https://msdn.microsoft.com/library/system.data.sqlclient.sqlcommand.commandtimeout.aspx).</span><span class="sxs-lookup"><span data-stu-id="09834-206">When using the TableAdapter to execute one of those queries, we might want to increase the command object s [`CommandTimeout` property](https://msdn.microsoft.com/library/system.data.sqlclient.sqlcommand.commandtimeout.aspx).</span></span> <span data-ttu-id="09834-207">Это свойство указывает количество секунд ожидания выполнения команды и значение по умолчанию — 30.</span><span class="sxs-lookup"><span data-stu-id="09834-207">This property specifies the number of seconds to wait for the command to execute and defaults to 30.</span></span>

<span data-ttu-id="09834-208">Чтобы разрешить `CommandTimeout` свойство отрегулировать BLL, добавьте следующий `Public` метод `ProductsDataTable` используйте разделяемого класса, созданный на шаге 2 (`ProductsTableAdapter.ConnectionAndCommandSettings.vb`):</span><span class="sxs-lookup"><span data-stu-id="09834-208">To allow the `CommandTimeout` property to be adjusted by the BLL, add the following `Public` method to the `ProductsDataTable` using the partial class file created in Step 2 (`ProductsTableAdapter.ConnectionAndCommandSettings.vb`):</span></span>


[!code-vb[Main](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/samples/sample4.vb)]

<span data-ttu-id="09834-209">Этот метод может вызываться из BLL или уровень представления данных, чтобы задать время ожидания команды для всех команд проблем управляет этот экземпляр адаптера таблицы.</span><span class="sxs-lookup"><span data-stu-id="09834-209">This method could be invoked from the BLL or Presentation Layer to set the command timeout for all commands issues by that TableAdapter instance.</span></span>

> [!NOTE]
> <span data-ttu-id="09834-210">`Adapter` И `CommandCollection` свойства отмечены как `Private`, то есть они возможен только из кода в TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="09834-210">The `Adapter` and `CommandCollection` properties are marked as `Private`, meaning they can only be accessed from code within the TableAdapter.</span></span> <span data-ttu-id="09834-211">В отличие от `Connection` свойства, эти модификаторы доступа не могут быть изменены.</span><span class="sxs-lookup"><span data-stu-id="09834-211">Unlike the `Connection` property, these access modifiers are not configurable.</span></span> <span data-ttu-id="09834-212">Таким образом, если вам нужно предоставлять свойства уровня команды на другие уровни в архитектуре необходимо использовать разделяемый класс подход, описанный выше, для предоставления `Public` метод или свойство, которое считывает или записывает `Private` объектов команд.</span><span class="sxs-lookup"><span data-stu-id="09834-212">Therefore, if you need to expose command-level properties to other layers in the architecture you must use the partial class approach discussed above to provide a `Public` method or property that reads or writes to the `Private` command objects.</span></span>


## <a name="summary"></a><span data-ttu-id="09834-213">Сводка</span><span class="sxs-lookup"><span data-stu-id="09834-213">Summary</span></span>

<span data-ttu-id="09834-214">TableAdapters в типизированный набор DataSet служат для инкапсуляции сведений о доступе к данным и сложности.</span><span class="sxs-lookup"><span data-stu-id="09834-214">The TableAdapters within a Typed DataSet serve to encapsulate data access details and complexity.</span></span> <span data-ttu-id="09834-215">Использование TableAdapter, мы не нужно беспокоиться о написании кода ADO.NET для соединения с базой данных, команда или заполнения результаты в таблицу данных.</span><span class="sxs-lookup"><span data-stu-id="09834-215">Using TableAdapters, we do not have to worry about writing ADO.NET code to connect to the database, issue a command, or populate the results into a DataTable.</span></span> <span data-ttu-id="09834-216">Он все обрабатывается автоматически для нас.</span><span class="sxs-lookup"><span data-stu-id="09834-216">It is all handled automatically for us.</span></span>

<span data-ttu-id="09834-217">Тем не менее могут возникнуть ситуации, когда нам требуется для настройки низкоуровневых особенностей ADO.NET, например изменение строки подключения или значения времени ожидания соединения или команды по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="09834-217">However, there may be times when we need to customize the low-level ADO.NET specifics, such as changing the connection string or the default connection or command timeout values.</span></span> <span data-ttu-id="09834-218">TableAdapter создан `Connection`, `Adapter`, и `CommandCollection` свойства, но они могут быть `Friend` или `Private`, по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="09834-218">The TableAdapter has auto-generated `Connection`, `Adapter`, and `CommandCollection` properties, but these are either `Friend` or `Private`, by default.</span></span> <span data-ttu-id="09834-219">Это внутренние сведения, которые могут предоставляться путем расширения TableAdapter, используя разделяемые классы для включения `Public` методов или свойств.</span><span class="sxs-lookup"><span data-stu-id="09834-219">This internal information can be exposed by extending the TableAdapter using partial classes to include `Public` methods or properties.</span></span> <span data-ttu-id="09834-220">Кроме того, s TableAdapter `Connection` модификатор доступа свойства можно настроить с помощью адаптера таблицы s `ConnectionModifier` свойство.</span><span class="sxs-lookup"><span data-stu-id="09834-220">Alternatively, the TableAdapter s `Connection` property access modifier can be configured through the TableAdapter s `ConnectionModifier` property.</span></span>

<span data-ttu-id="09834-221">Счастливого вам программирования!</span><span class="sxs-lookup"><span data-stu-id="09834-221">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="09834-222">Об авторе</span><span class="sxs-lookup"><span data-stu-id="09834-222">About the Author</span></span>

<span data-ttu-id="09834-223">[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи книг по ASP/ASP.NET и основатель веб- [4GuysFromRolla.com](http://www.4guysfromrolla.com), работает с веб-технологиями Microsoft с 1998 года.</span><span class="sxs-lookup"><span data-stu-id="09834-223">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="09834-224">Скотт — независимый консультант, преподаватель и автор.</span><span class="sxs-lookup"><span data-stu-id="09834-224">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="09834-225">Его последняя книга — [ *Sams Teach ASP.NET 2.0 in 24 часа*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="09834-225">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="09834-226">Ним можно связаться по адресу [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="09834-226">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="09834-227">или через его блог, который можно найти в [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="09834-227">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="09834-228">Особая благодарность</span><span class="sxs-lookup"><span data-stu-id="09834-228">Special Thanks To</span></span>

<span data-ttu-id="09834-229">В этой серии руководств пособий рецензировалась многими компетентными редакторами.</span><span class="sxs-lookup"><span data-stu-id="09834-229">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="09834-230">Burnadette Leigh, S ren Lauritsen Алексей Терезой Мерфи и Хилтон Geisenow стали Лиз Шалок в этом руководстве.</span><span class="sxs-lookup"><span data-stu-id="09834-230">Lead reviewers for this tutorial were Burnadette Leigh, S ren Jacob Lauritsen, Teresa Murphy, and Hilton Geisenow.</span></span> <span data-ttu-id="09834-231">Хотите поработать с моих последующих статей для MSDN?</span><span class="sxs-lookup"><span data-stu-id="09834-231">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="09834-232">Если Да, напишите мне [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="09834-232">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="09834-233">[Назад](working-with-computed-columns-vb.md)
> [Вперед](protecting-connection-strings-and-other-configuration-information-vb.md)</span><span class="sxs-lookup"><span data-stu-id="09834-233">[Previous](working-with-computed-columns-vb.md)
[Next](protecting-connection-strings-and-other-configuration-information-vb.md)</span></span>
