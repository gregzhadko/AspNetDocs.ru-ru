---
uid: web-forms/overview/data-access/advanced-data-access-scenarios/using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb
title: Использование существующих хранимых процедур для адаптеров таблиц TableAdapter типизированного набора данных (VB) | Документация Майкрософт
author: rick-anderson
description: В предыдущем учебном курсе мы узнали, как использовать мастер TableAdapter для создания новых хранимых процедур. В этом учебнике мы рассмотрим, как один и тот же адаптер TableAdapter...
ms.author: riande
ms.date: 07/18/2007
ms.assetid: 2da25f6a-757e-4e7b-a812-1575288d8f7a
msc.legacyurl: /web-forms/overview/data-access/advanced-data-access-scenarios/using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb
msc.type: authoredcontent
ms.openlocfilehash: e35c3d6a98516a07f6119e6cb9dbeb99bc28fe33
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78427128"
---
# <a name="using-existing-stored-procedures-for-the-typed-datasets-tableadapters-vb"></a><span data-ttu-id="b7071-104">Использование существующих хранимых процедур для адаптеров таблиц TableAdapter типизированного DataSet (VB)</span><span class="sxs-lookup"><span data-stu-id="b7071-104">Using Existing Stored Procedures for the Typed DataSet's TableAdapters (VB)</span></span>

<span data-ttu-id="b7071-105">по [Скотт Митчелл](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="b7071-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="b7071-106">[Скачать код](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_68_VB.zip) или [скачать PDF](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/datatutorial68vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="b7071-106">[Download Code](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_68_VB.zip) or [Download PDF](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/datatutorial68vb1.pdf)</span></span>

> <span data-ttu-id="b7071-107">В предыдущем учебном курсе мы узнали, как использовать мастер TableAdapter для создания новых хранимых процедур.</span><span class="sxs-lookup"><span data-stu-id="b7071-107">In the previous tutorial we learned how to use the TableAdapter Wizard to generate new stored procedures.</span></span> <span data-ttu-id="b7071-108">В этом учебнике мы рассмотрим, как мастер TableAdapter может работать с существующими хранимыми процедурами.</span><span class="sxs-lookup"><span data-stu-id="b7071-108">In this tutorial we learn how the same TableAdapter Wizard can work with existing stored procedures.</span></span> <span data-ttu-id="b7071-109">Мы также научитесь вручную добавлять новые хранимые процедуры в нашу базу данных.</span><span class="sxs-lookup"><span data-stu-id="b7071-109">We also learn how to manually add new stored procedures to our database.</span></span>

## <a name="introduction"></a><span data-ttu-id="b7071-110">Введение</span><span class="sxs-lookup"><span data-stu-id="b7071-110">Introduction</span></span>

<span data-ttu-id="b7071-111">В [предыдущем учебном курсе](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) мы увидели, как адаптеры таблиц типизированного набора данных могут быть настроены для использования хранимых процедур для доступа к данным, а не к специальным инструкциям SQL.</span><span class="sxs-lookup"><span data-stu-id="b7071-111">In the [preceding tutorial](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) we saw how the Typed DataSet s TableAdapters could be configured to use stored procedures to access data rather than ad-hoc SQL statements.</span></span> <span data-ttu-id="b7071-112">В частности, мы рассмотрели, как мастер TableAdapter автоматически создает эти хранимые процедуры.</span><span class="sxs-lookup"><span data-stu-id="b7071-112">In particular, we examined how to have the TableAdapter wizard automatically create these stored procedures.</span></span> <span data-ttu-id="b7071-113">При переносе устаревшего приложения на ASP.NET 2,0 или при создании веб-сайта ASP.NET 2,0 на основе существующей модели данных, вероятно, что база данных уже содержит нужные вам хранимые процедуры.</span><span class="sxs-lookup"><span data-stu-id="b7071-113">When porting a legacy application to ASP.NET 2.0 or when building an ASP.NET 2.0 website around an existing data model, chances are that the database already contains the stored procedures we need.</span></span> <span data-ttu-id="b7071-114">Кроме того, можно создать хранимые процедуры вручную или с помощью какого-либо средства, отличного от мастера TableAdapter, который создает хранимые процедуры.</span><span class="sxs-lookup"><span data-stu-id="b7071-114">Alternatively, you may prefer to create your stored procedures by hand or through some tool other than the TableAdapter wizard that auto-generates your stored procedures.</span></span>

<span data-ttu-id="b7071-115">В этом учебнике мы рассмотрим, как настроить TableAdapter для использования существующих хранимых процедур.</span><span class="sxs-lookup"><span data-stu-id="b7071-115">In this tutorial we will look at how to configure the TableAdapter to use existing stored procedures.</span></span> <span data-ttu-id="b7071-116">Поскольку база данных Northwind содержит только небольшой набор встроенных хранимых процедур, мы также рассмотрим шаги, необходимые для ручного добавления новых хранимых процедур в базу данных в среде Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="b7071-116">Since the Northwind database only has a small set of built-in stored procedures, we will also look at the steps needed to manually add new stored procedures to the database through the Visual Studio environment.</span></span> <span data-ttu-id="b7071-117">Давайте приступим к работе!</span><span class="sxs-lookup"><span data-stu-id="b7071-117">Let s get started!</span></span>

> [!NOTE]
> <span data-ttu-id="b7071-118">В процессе [переноса изменений базы данных в рамках руководства по транзакциям](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) мы добавили методы в TableAdapter для поддержки транзакций (`BeginTransaction`, `CommitTransaction`и т. д.).</span><span class="sxs-lookup"><span data-stu-id="b7071-118">In the [Wrapping Database Modifications within a Transaction](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) tutorial we added methods to the TableAdapter to support transactions (`BeginTransaction`, `CommitTransaction`, and so on).</span></span> <span data-ttu-id="b7071-119">Кроме того, транзакции могут полностью управляться внутри хранимой процедуры, что не требует внесения изменений в код уровня доступа к данным.</span><span class="sxs-lookup"><span data-stu-id="b7071-119">Alternatively, transactions can be managed entirely within a stored procedure, which requires no modifications to the Data Access Layer code.</span></span> <span data-ttu-id="b7071-120">В этом учебнике мы рассмотрим команды T-SQL, используемые для выполнения инструкций хранимых процедур в области действия транзакции.</span><span class="sxs-lookup"><span data-stu-id="b7071-120">In this tutorial we'll explore the T-SQL commands used to execute a stored procedure s statements within the scope of a transaction.</span></span>

## <a name="step-1-adding-stored-procedures-to-the-northwind-database"></a><span data-ttu-id="b7071-121">Шаг 1. Добавление хранимых процедур в базу данных Northwind</span><span class="sxs-lookup"><span data-stu-id="b7071-121">Step 1: Adding Stored Procedures to the Northwind Database</span></span>

<span data-ttu-id="b7071-122">Visual Studio упрощает добавление новых хранимых процедур в базу данных.</span><span class="sxs-lookup"><span data-stu-id="b7071-122">Visual Studio makes it easy to add new stored procedures to a database.</span></span> <span data-ttu-id="b7071-123">Добавим новую хранимую процедуру в базу данных Northwind, которая возвращает все столбцы из таблицы `Products` для тех, которые имеют определенное значение `CategoryID`.</span><span class="sxs-lookup"><span data-stu-id="b7071-123">Let s add a new stored procedure to the Northwind database that returns all columns from the `Products` table for those that have a particular `CategoryID` value.</span></span> <span data-ttu-id="b7071-124">В окне обозреватель сервера разверните базу данных Northwind, чтобы отображались ее папки — диаграммы базы данных, таблицы, представления и т. д.</span><span class="sxs-lookup"><span data-stu-id="b7071-124">From the Server Explorer window, expand the Northwind database so that its folders - Database Diagrams, Tables, Views, and so forth - are displayed.</span></span> <span data-ttu-id="b7071-125">Как было показано в предыдущем руководстве, папка хранимые процедуры содержит существующие хранимые процедуры базы данных.</span><span class="sxs-lookup"><span data-stu-id="b7071-125">As we saw in the preceding tutorial, the Stored Procedures folder contains the database s existing stored procedures.</span></span> <span data-ttu-id="b7071-126">Чтобы добавить новую хранимую процедуру, просто щелкните правой кнопкой мыши папку Хранимые процедуры и выберите в контекстном меню пункт Добавить новую хранимую процедуру.</span><span class="sxs-lookup"><span data-stu-id="b7071-126">To add a new stored procedure, simply right-click the Stored Procedures folder and choose the Add New Stored Procedure option from the context menu.</span></span>

<span data-ttu-id="b7071-127">[![щелкните правой кнопкой мыши папку Хранимые процедуры и добавьте новую хранимую процедуру.](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image2.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="b7071-127">[![Right-Click the Stored Procedures Folder and Add a New Stored Procedure](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image2.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image1.png)</span></span>

<span data-ttu-id="b7071-128">**Рис. 1**. Щелкните правой кнопкой мыши папку Хранимые процедуры и добавьте новую хранимую процедуру ([щелкните, чтобы просмотреть изображение с полным размером](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image3.png)).</span><span class="sxs-lookup"><span data-stu-id="b7071-128">**Figure 1**: Right-Click the Stored Procedures Folder and Add a New Stored Procedure ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image3.png))</span></span>

<span data-ttu-id="b7071-129">Как показано на рис. 1, при выборе параметра Добавить новую хранимую процедуру в Visual Studio открывается окно скрипта с описанием скрипта SQL, необходимого для создания хранимой процедуры.</span><span class="sxs-lookup"><span data-stu-id="b7071-129">As Figure 1 shows, selecting the Add New Stored Procedure option opens a script window in Visual Studio with the outline of the SQL script needed to create the stored procedure.</span></span> <span data-ttu-id="b7071-130">Мы обработаем этот сценарий и выполняем его, после чего хранимая процедура будет добавлена в базу данных.</span><span class="sxs-lookup"><span data-stu-id="b7071-130">It is our job to flesh out this script and execute it, at which point the stored procedure will be added to the database.</span></span>

<span data-ttu-id="b7071-131">Введите следующий скрипт:</span><span class="sxs-lookup"><span data-stu-id="b7071-131">Enter the following script:</span></span>

[!code-sql[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/samples/sample1.sql)]

<span data-ttu-id="b7071-132">При выполнении этот сценарий добавляет новую хранимую процедуру в базу данных Northwind с именем `Products_SelectByCategoryID`.</span><span class="sxs-lookup"><span data-stu-id="b7071-132">This script, when executed, will add a new stored procedure to the Northwind database named `Products_SelectByCategoryID`.</span></span> <span data-ttu-id="b7071-133">Эта хранимая процедура принимает один входной параметр (`@CategoryID`, типа `int`) и возвращает все поля для этих продуктов с соответствующим значением `CategoryID`.</span><span class="sxs-lookup"><span data-stu-id="b7071-133">This stored procedure accepts a single input parameter (`@CategoryID`, of type `int`) and it returns all of the fields for those products with a matching `CategoryID` value.</span></span>

<span data-ttu-id="b7071-134">Чтобы выполнить этот `CREATE PROCEDURE` сценарий и добавить хранимую процедуру в базу данных, щелкните значок сохранить на панели инструментов или нажмите клавиши CTRL + S.</span><span class="sxs-lookup"><span data-stu-id="b7071-134">To execute this `CREATE PROCEDURE` script and add the stored procedure to the database, click the Save icon in the toolbar or hit Ctrl+S.</span></span> <span data-ttu-id="b7071-135">После этого папка хранимых процедур обновится, отображая созданную хранимую процедуру.</span><span class="sxs-lookup"><span data-stu-id="b7071-135">After doing so, the Stored Procedures folder refreshes, showing the newly created stored procedure.</span></span> <span data-ttu-id="b7071-136">Кроме того, скрипт в окне изменит тонкость с `CREATE PROCEDURE dbo.Products_SelectProductByCategoryID` на `ALTER PROCEDURE` `dbo.Products_SelectProductByCategoryID`.</span><span class="sxs-lookup"><span data-stu-id="b7071-136">Also, the script in the window will change subtlety from `CREATE PROCEDURE dbo.Products_SelectProductByCategoryID` to `ALTER PROCEDURE` `dbo.Products_SelectProductByCategoryID`.</span></span> <span data-ttu-id="b7071-137">`CREATE PROCEDURE` добавляет в базу данных новую хранимую процедуру, а `ALTER PROCEDURE` обновляет существующую.</span><span class="sxs-lookup"><span data-stu-id="b7071-137">`CREATE PROCEDURE` adds a new stored procedure to the database, while `ALTER PROCEDURE` updates an existing one.</span></span> <span data-ttu-id="b7071-138">Так как начало скрипта изменилось на `ALTER PROCEDURE`, изменение входных параметров хранимых процедур или инструкций SQL и нажатие значка Сохранить приведет к обновлению хранимой процедуры этими изменениями.</span><span class="sxs-lookup"><span data-stu-id="b7071-138">Since the start of the script has changed to `ALTER PROCEDURE`, changing the stored procedures input parameters or SQL statements and clicking the Save icon will update the stored procedure with these changes.</span></span>

<span data-ttu-id="b7071-139">На рис. 2 показана Visual Studio после сохранения `Products_SelectByCategoryID` хранимой процедуры.</span><span class="sxs-lookup"><span data-stu-id="b7071-139">Figure 2 shows Visual Studio after the `Products_SelectByCategoryID` stored procedure has been saved.</span></span>

<span data-ttu-id="b7071-140">[![Products_SelectByCategoryID в базу данных добавлена хранимая процедура](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image5.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="b7071-140">[![The Stored Procedure Products_SelectByCategoryID Has Been Added to the Database](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image5.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image4.png)</span></span>

<span data-ttu-id="b7071-141">**Рис. 2**. хранимая процедура `Products_SelectByCategoryID` добавлена в базу данных ([щелкните, чтобы просмотреть изображение с полным размером](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="b7071-141">**Figure 2**: The Stored Procedure `Products_SelectByCategoryID` Has Been Added to the Database ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image6.png))</span></span>

## <a name="step-2-configuring-the-tableadapter-to-use-an-existing-stored-procedure"></a><span data-ttu-id="b7071-142">Шаг 2. Настройка адаптера таблицы для использования существующей хранимой процедуры</span><span class="sxs-lookup"><span data-stu-id="b7071-142">Step 2: Configuring the TableAdapter to Use an Existing Stored Procedure</span></span>

<span data-ttu-id="b7071-143">Теперь, когда в базу данных была добавлена `Products_SelectByCategoryID` хранимая процедура, мы можем настроить уровень доступа к данным, чтобы использовать эту хранимую процедуру при вызове одного из ее методов.</span><span class="sxs-lookup"><span data-stu-id="b7071-143">Now that the `Products_SelectByCategoryID` stored procedure has been added to the database, we can configure our Data Access Layer to use this stored procedure when one of its methods is invoked.</span></span> <span data-ttu-id="b7071-144">В частности, мы добавим метод `GetProductsByCategoryID(<_i22_>categoryID)<!--_i22_-->` в `ProductsTableAdapter` в `NorthwindWithSprocs` типизированном наборе данных, который вызывает только что созданную хранимую процедуру `Products_SelectByCategoryID`.</span><span class="sxs-lookup"><span data-stu-id="b7071-144">In particular, we will add a `GetProductsByCategoryID(<_i22_>categoryID)<!--_i22_-->` method to the `ProductsTableAdapter` in the `NorthwindWithSprocs` Typed DataSet that calls the `Products_SelectByCategoryID` stored procedure we just created.</span></span>

<span data-ttu-id="b7071-145">Для начала откройте набор данных `NorthwindWithSprocs`.</span><span class="sxs-lookup"><span data-stu-id="b7071-145">Start by opening the `NorthwindWithSprocs` DataSet.</span></span> <span data-ttu-id="b7071-146">Щелкните правой кнопкой мыши `ProductsTableAdapter` и выберите команду Добавить запрос, чтобы запустить мастер настройки запроса адаптера таблицы.</span><span class="sxs-lookup"><span data-stu-id="b7071-146">Right-click on the `ProductsTableAdapter` and choose Add Query to launch the TableAdapter Query Configuration wizard.</span></span> <span data-ttu-id="b7071-147">В [предыдущем учебном курсе](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) мы решили, что TableAdapter создает новую хранимую процедуру для нас.</span><span class="sxs-lookup"><span data-stu-id="b7071-147">In the [preceding tutorial](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) we opted to have the TableAdapter create a new stored procedure for us.</span></span> <span data-ttu-id="b7071-148">Однако в этом руководстве мы хотим связать новый метод TableAdapter с существующей `Products_SelectByCategoryID` хранимой процедурой.</span><span class="sxs-lookup"><span data-stu-id="b7071-148">For this tutorial, however, we want to wire the new TableAdapter method to the existing `Products_SelectByCategoryID` stored procedure.</span></span> <span data-ttu-id="b7071-149">Поэтому выберите параметр использовать существующую хранимую процедуру на первом шаге мастера, а затем нажмите кнопку Далее.</span><span class="sxs-lookup"><span data-stu-id="b7071-149">Therefore, choose the Use existing stored procedure option from the wizard s first step and then click Next.</span></span>

<span data-ttu-id="b7071-150">[![выберите параметр использовать существующую хранимую процедуру.](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image8.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="b7071-150">[![Choose the Use existing stored procedure Option](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image8.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image7.png)</span></span>

<span data-ttu-id="b7071-151">**Рис. 3**. Выбор параметра "использовать существующую хранимую процедуру" ([щелкните, чтобы просмотреть изображение с полным размером](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="b7071-151">**Figure 3**: Choose the Use existing stored procedure Option ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image9.png))</span></span>

<span data-ttu-id="b7071-152">На следующем экране представлен раскрывающийся список, заполненный хранимыми процедурами базы данных.</span><span class="sxs-lookup"><span data-stu-id="b7071-152">The following screen provides a drop-down list populated with the database s stored procedures.</span></span> <span data-ttu-id="b7071-153">При выборе хранимой процедуры выводится список входных параметров слева и поля данных, которые были возвращены (если имеются) справа.</span><span class="sxs-lookup"><span data-stu-id="b7071-153">Selecting a stored procedure lists its input parameters on the left and the data fields returned (if any) on the right.</span></span> <span data-ttu-id="b7071-154">Выберите `Products_SelectByCategoryID` хранимую процедуру из списка и нажмите кнопку Далее.</span><span class="sxs-lookup"><span data-stu-id="b7071-154">Choose the `Products_SelectByCategoryID` stored procedure from the list and click Next.</span></span>

<span data-ttu-id="b7071-155">[![выбрать Products_SelectByCategoryID хранимую процедуру](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image11.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="b7071-155">[![Pick the Products_SelectByCategoryID Stored Procedure](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image11.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image10.png)</span></span>

<span data-ttu-id="b7071-156">**Рис. 4**. Выбор хранимой процедуры `Products_SelectByCategoryID` ([щелкните, чтобы просмотреть изображение с полным размером](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="b7071-156">**Figure 4**: Pick the `Products_SelectByCategoryID` Stored Procedure ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image12.png))</span></span>

<span data-ttu-id="b7071-157">На следующем экране запрашивается, какие данные возвращаются хранимой процедурой, и наш ответ определяет тип, возвращаемый методом TableAdapter s.</span><span class="sxs-lookup"><span data-stu-id="b7071-157">The next screen asks us what kind of data is returned by the stored procedure and our answer here determines the type returned by the TableAdapter s method.</span></span> <span data-ttu-id="b7071-158">Например, если указать, что табличные данные возвращаются, метод возвратит `ProductsDataTable` экземпляр, заполненный записями, возвращаемыми хранимой процедурой.</span><span class="sxs-lookup"><span data-stu-id="b7071-158">For example, if we indicate that tabular data is returned, the method will return a `ProductsDataTable` instance populated with the records returned by the stored procedure.</span></span> <span data-ttu-id="b7071-159">Напротив, если бы мы указывали, что эта хранимая процедура возвращает единственное значение, TableAdapter возвратит `Object`, которому присваивается значение в первом столбце первой записи, возвращенной хранимой процедурой.</span><span class="sxs-lookup"><span data-stu-id="b7071-159">In contrast, if we indicate that this stored procedure returns a single value the TableAdapter will return an `Object` that is assigned the value in the first column of the first record returned by the stored procedure.</span></span>

<span data-ttu-id="b7071-160">Так как хранимая процедура `Products_SelectByCategoryID` возвращает все продукты, относящиеся к определенной категории, выберите первый ответ — табличные данные, а затем нажмите кнопку Далее.</span><span class="sxs-lookup"><span data-stu-id="b7071-160">Since the `Products_SelectByCategoryID` stored procedure returns all products that belong to a particular category, choose the first answer - Tabular data - and click Next.</span></span>

<span data-ttu-id="b7071-161">[![указать, что хранимая процедура возвращает табличные данные](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image14.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="b7071-161">[![Indicate that the Stored Procedure Returns Tabular Data](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image14.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image13.png)</span></span>

<span data-ttu-id="b7071-162">**Рис. 5**. Указание того, что хранимая процедура возвращает табличные данные ([щелкните, чтобы просмотреть изображение с полным размером](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="b7071-162">**Figure 5**: Indicate that the Stored Procedure Returns Tabular Data ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image15.png))</span></span>

<span data-ttu-id="b7071-163">Остается только указать, какие шаблоны методов следует использовать, за которыми следуют имена этих методов.</span><span class="sxs-lookup"><span data-stu-id="b7071-163">All that remains is to indicate what method patterns to use followed by the names for these methods.</span></span> <span data-ttu-id="b7071-164">Оставьте как заполненную таблицу данных, так и возвращаемые параметры DataTable, но переименуйте методы в `FillByCategoryID` и `GetProductsByCategoryID`.</span><span class="sxs-lookup"><span data-stu-id="b7071-164">Leave both the Fill a DataTable and Return a DataTable options checked, but rename the methods to `FillByCategoryID` and `GetProductsByCategoryID`.</span></span> <span data-ttu-id="b7071-165">Затем нажмите кнопку Далее, чтобы ознакомиться с краткими сведениями о задачах, которые будут выполнены мастером.</span><span class="sxs-lookup"><span data-stu-id="b7071-165">Then click Next to review a summary of the tasks the wizard will perform.</span></span> <span data-ttu-id="b7071-166">Если все выглядит правильно, нажмите кнопку Готово.</span><span class="sxs-lookup"><span data-stu-id="b7071-166">If everything looks correct, click Finish.</span></span>

<span data-ttu-id="b7071-167">[![назовите методы Филлбикатегорид и GetProductsByCategoryID.](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image17.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="b7071-167">[![Name the Methods FillByCategoryID and GetProductsByCategoryID](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image17.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image16.png)</span></span>

<span data-ttu-id="b7071-168">**Рис. 6**. Именование методов `FillByCategoryID` и `GetProductsByCategoryID` ([щелкните, чтобы просмотреть изображение с полным размером](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="b7071-168">**Figure 6**: Name the Methods `FillByCategoryID` and `GetProductsByCategoryID` ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image18.png))</span></span>

> [!NOTE]
> <span data-ttu-id="b7071-169">Методы TableAdapter, которые мы только что создали, `FillByCategoryID` и `GetProductsByCategoryID`, должны иметь входной параметр типа `Integer`.</span><span class="sxs-lookup"><span data-stu-id="b7071-169">The TableAdapter methods we just created, `FillByCategoryID` and `GetProductsByCategoryID`, expect an input parameter of type `Integer`.</span></span> <span data-ttu-id="b7071-170">Это значение входного параметра передается в хранимую процедуру через его параметр `@CategoryID`.</span><span class="sxs-lookup"><span data-stu-id="b7071-170">This input parameter value is passed into the stored procedure via its `@CategoryID` parameter.</span></span> <span data-ttu-id="b7071-171">При изменении параметров `Products_SelectByCategory` хранимых процедур s необходимо также обновить параметры для этих методов TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="b7071-171">If you modify the `Products_SelectByCategory` stored procedure s parameters, you'll need to also update the parameters for these TableAdapter methods.</span></span> <span data-ttu-id="b7071-172">Как обсуждалось в [предыдущем руководстве](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md), это можно сделать одним из двух способов: путем добавления или удаления параметров из коллекции Parameters вручную или путем повторного запуска мастера TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="b7071-172">As discussed in the [previous tutorial](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md), this can be done in one of two ways: by manually adding or removing parameters from the parameters collection or by rerunning the TableAdapter wizard.</span></span>

## <a name="step-3-adding-agetproductsbycategoryidcategoryidmethod-to-the-bll"></a><span data-ttu-id="b7071-173">Шаг 3. добавление к BLL метода`GetProductsByCategoryID(categoryID)`</span><span class="sxs-lookup"><span data-stu-id="b7071-173">Step 3: Adding a`GetProductsByCategoryID(categoryID)`Method to the BLL</span></span>

<span data-ttu-id="b7071-174">После завершения `GetProductsByCategoryID` метода DAL необходимо предоставить доступ к этому методу на уровне бизнес-логики.</span><span class="sxs-lookup"><span data-stu-id="b7071-174">With the `GetProductsByCategoryID` DAL method complete, the next step is to provide access to this method in the Business Logic Layer.</span></span> <span data-ttu-id="b7071-175">Откройте файл класса `ProductsBLLWithSprocs` и добавьте следующий метод:</span><span class="sxs-lookup"><span data-stu-id="b7071-175">Open the `ProductsBLLWithSprocs` class file and add the following method:</span></span>

[!code-vb[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/samples/sample2.vb)]

<span data-ttu-id="b7071-176">Этот метод BLL просто возвращает `ProductsDataTable`, возвращенный методом `ProductsTableAdapter` s `GetProductsByCategoryID`.</span><span class="sxs-lookup"><span data-stu-id="b7071-176">This BLL method simply returns the `ProductsDataTable` returned from the `ProductsTableAdapter` s `GetProductsByCategoryID` method.</span></span> <span data-ttu-id="b7071-177">Атрибут `DataObjectMethodAttribute` предоставляет метаданные, используемые мастером настройки источников данных ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="b7071-177">The `DataObjectMethodAttribute` attribute provides metadata used by the ObjectDataSource s Configure Data Source wizard.</span></span> <span data-ttu-id="b7071-178">В частности, этот метод будет отображаться в раскрывающемся списке SELECT Tab s (выбор вкладок).</span><span class="sxs-lookup"><span data-stu-id="b7071-178">In particular, this method will appear in the SELECT tab s drop-down list.</span></span>

## <a name="step-4-displaying-products-by-category"></a><span data-ttu-id="b7071-179">Шаг 4. Отображение продуктов по категориям</span><span class="sxs-lookup"><span data-stu-id="b7071-179">Step 4: Displaying Products by Category</span></span>

<span data-ttu-id="b7071-180">Чтобы протестировать вновь добавленную `Products_SelectByCategoryID` хранимую процедуру и соответствующие методы DAL и BLL, давайте создадим страницу ASP.NET, содержащую DropDownList и GridView.</span><span class="sxs-lookup"><span data-stu-id="b7071-180">To test the newly added `Products_SelectByCategoryID` stored procedure and the corresponding DAL and BLL methods, let s create an ASP.NET page that contains a DropDownList and a GridView.</span></span> <span data-ttu-id="b7071-181">В элементе управления DropDownList будут перечислены все категории в базе данных, а в элементе управления GridView будут отображаться продукты, принадлежащие выбранной категории.</span><span class="sxs-lookup"><span data-stu-id="b7071-181">The DropDownList will list all of the categories in the database while the GridView will display the products belonging to the selected category.</span></span>

> [!NOTE]
> <span data-ttu-id="b7071-182">Мы создали интерфейсы "основной/подробности" с помощью элементов управления DropDownList в предыдущих руководствах.</span><span class="sxs-lookup"><span data-stu-id="b7071-182">We ve created master/detail interfaces using DropDownLists in previous tutorials.</span></span> <span data-ttu-id="b7071-183">Более подробные сведения о реализации такого отчета «основной/подробности» см. в разделе [Фильтрация "основной/подробности" с помощью DropDownList](../masterdetail/master-detail-filtering-with-a-dropdownlist-vb.md) .</span><span class="sxs-lookup"><span data-stu-id="b7071-183">For a more in-depth look at implementing such a master/detail report, refer to the [Master/Detail Filtering With a DropDownList](../masterdetail/master-detail-filtering-with-a-dropdownlist-vb.md) tutorial.</span></span>

<span data-ttu-id="b7071-184">Откройте страницу `ExistingSprocs.aspx` в папке `AdvancedDAL` и перетащите DropDownList из области элементов в конструктор.</span><span class="sxs-lookup"><span data-stu-id="b7071-184">Open the `ExistingSprocs.aspx` page in the `AdvancedDAL` folder and drag a DropDownList from the Toolbox onto the Designer.</span></span> <span data-ttu-id="b7071-185">Установите для свойства DropDownList `ID` значение `Categories`, а для свойства `AutoPostBack` значение `True`.</span><span class="sxs-lookup"><span data-stu-id="b7071-185">Set the DropDownList s `ID` property to `Categories` and its `AutoPostBack` property to `True`.</span></span> <span data-ttu-id="b7071-186">Затем из своего смарт-тега привяжите DropDownList к новому ObjectDataSource с именем `CategoriesDataSource`.</span><span class="sxs-lookup"><span data-stu-id="b7071-186">Next, from its smart tag, bind the DropDownList to a new ObjectDataSource named `CategoriesDataSource`.</span></span> <span data-ttu-id="b7071-187">Настройте ObjectDataSource таким образом, чтобы он получал свои данные из метода `CategoriesBLL` класса s `GetCategories`.</span><span class="sxs-lookup"><span data-stu-id="b7071-187">Configure the ObjectDataSource so that it retrieves its data from the `CategoriesBLL` class s `GetCategories` method.</span></span> <span data-ttu-id="b7071-188">Установите в раскрывающихся списках на вкладках обновления, вставки и удаления значение (нет).</span><span class="sxs-lookup"><span data-stu-id="b7071-188">Set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>

<span data-ttu-id="b7071-189">[![получить данные из метода CategoriesBLL класса s](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image20.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="b7071-189">[![Retrieve Data from the CategoriesBLL Class s GetCategories Method](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image20.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image19.png)</span></span>

<span data-ttu-id="b7071-190">**Рис. 7**. Извлечение данных из метода `GetCategories` `CategoriesBLL` классов ([щелкните, чтобы просмотреть изображение с полным размером](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="b7071-190">**Figure 7**: Retrieve Data from the `CategoriesBLL` Class s `GetCategories` Method ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image21.png))</span></span>

<span data-ttu-id="b7071-191">[![установить в раскрывающихся списках на вкладках обновления, вставки и удаления значение (нет)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image23.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="b7071-191">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image23.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image22.png)</span></span>

<span data-ttu-id="b7071-192">**Рис. 8**. Установка в раскрывающихся списках на вкладках «обновление», «вставка» и «удаление» (нет) ([щелкните, чтобы просмотреть изображение с полным размером](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="b7071-192">**Figure 8**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image24.png))</span></span>

<span data-ttu-id="b7071-193">После завершения работы мастера ObjectDataSource настройте в DropDownList отображение поля данных `CategoryName` и используйте поле `CategoryID` в качестве `Value` для каждого `ListItem`.</span><span class="sxs-lookup"><span data-stu-id="b7071-193">After completing the ObjectDataSource wizard, configure the DropDownList to display the `CategoryName` data field and to use the `CategoryID` field as the `Value` for each `ListItem`.</span></span>

<span data-ttu-id="b7071-194">На этом этапе декларативная разметка DropDownList и ObjectDataSource должна выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="b7071-194">At this point, the DropDownList and ObjectDataSource s declarative markup should similar to the following:</span></span>

[!code-aspx[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/samples/sample3.aspx)]

<span data-ttu-id="b7071-195">Затем перетащите элемент управления GridView на конструктор, поместив его под элементом управления DropDownList.</span><span class="sxs-lookup"><span data-stu-id="b7071-195">Next, drag a GridView onto the Designer, placing it beneath the DropDownList.</span></span> <span data-ttu-id="b7071-196">Установите `ID` GridView s `ProductsByCategory` и, из своего смарт-тега, привяжите его к новому ObjectDataSource с именем `ProductsByCategoryDataSource`.</span><span class="sxs-lookup"><span data-stu-id="b7071-196">Set the GridView s `ID` to `ProductsByCategory` and, from its smart tag, bind it to a new ObjectDataSource named `ProductsByCategoryDataSource`.</span></span> <span data-ttu-id="b7071-197">Настройте `ProductsByCategoryDataSource` ObjectDataSource для использования класса `ProductsBLLWithSprocs`, получая данные с помощью метода `GetProductsByCategoryID(categoryID)`.</span><span class="sxs-lookup"><span data-stu-id="b7071-197">Configure the `ProductsByCategoryDataSource` ObjectDataSource to use the `ProductsBLLWithSprocs` class, having it retrieve its data using the `GetProductsByCategoryID(categoryID)` method.</span></span> <span data-ttu-id="b7071-198">Поскольку этот элемент GridView будет использоваться только для вывода данных, задайте для раскрывающихся списков на вкладках обновление, вставка и удаление значение (нет) и нажмите кнопку Далее.</span><span class="sxs-lookup"><span data-stu-id="b7071-198">Since this GridView will only be used to display data, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) and click Next.</span></span>

<span data-ttu-id="b7071-199">[![настроить ObjectDataSource для использования класса Продуктсбллвисспрокс](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image26.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="b7071-199">[![Configure the ObjectDataSource to Use the ProductsBLLWithSprocs Class](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image26.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image25.png)</span></span>

<span data-ttu-id="b7071-200">**Рис. 9**. Настройка ObjectDataSource для использования класса `ProductsBLLWithSprocs` ([щелкните, чтобы просмотреть изображение с полным размером](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="b7071-200">**Figure 9**: Configure the ObjectDataSource to Use the `ProductsBLLWithSprocs` Class ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image27.png))</span></span>

<span data-ttu-id="b7071-201">[![получить данные из метода GetProductsByCategoryID (КодТипа)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image29.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="b7071-201">[![Retrieve Data from the GetProductsByCategoryID(categoryID) Method](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image29.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image28.png)</span></span>

<span data-ttu-id="b7071-202">**Рис. 10**. получение данных из метода `GetProductsByCategoryID(categoryID)` ([щелкните, чтобы просмотреть изображение с полным размером](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="b7071-202">**Figure 10**: Retrieve Data from the `GetProductsByCategoryID(categoryID)` Method ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image30.png))</span></span>

<span data-ttu-id="b7071-203">Метод, выбранный на вкладке SELECT, ожидает параметр, поэтому последний шаг мастера запрашивает у нас источник параметра s.</span><span class="sxs-lookup"><span data-stu-id="b7071-203">The method chosen in the SELECT tab expects a parameter, so the final step of the wizard prompts us for the parameter s source.</span></span> <span data-ttu-id="b7071-204">Задайте в раскрывающемся списке Источник параметра значение Управление и выберите элемент управления `Categories` из раскрывающегося списка ControlID.</span><span class="sxs-lookup"><span data-stu-id="b7071-204">Set the Parameter source drop-down list to Control and choose the `Categories` control from the ControlID drop-down list.</span></span> <span data-ttu-id="b7071-205">Нажмите кнопку Готово, чтобы завершить работу с мастером.</span><span class="sxs-lookup"><span data-stu-id="b7071-205">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="b7071-206">[![использовать DropDownList категории в качестве источника параметра categoryID](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image32.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="b7071-206">[![Use the Categories DropDownList as the Source of the categoryID Parameter](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image32.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image31.png)</span></span>

<span data-ttu-id="b7071-207">**Рис. 11**. использование DropDownList `Categories` в качестве источника параметра `categoryID` ([щелкните, чтобы просмотреть изображение с полным размером](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="b7071-207">**Figure 11**: Use the `Categories` DropDownList as the Source of the `categoryID` Parameter ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image33.png))</span></span>

<span data-ttu-id="b7071-208">После завершения работы мастера ObjectDataSource Visual Studio добавит BoundFields и CheckBoxField для каждого поля данных продукта.</span><span class="sxs-lookup"><span data-stu-id="b7071-208">Upon completing the ObjectDataSource wizard, Visual Studio will add BoundFields and a CheckBoxField for each of the product data fields.</span></span> <span data-ttu-id="b7071-209">Вы можете настроить эти поля по своему усмотрению.</span><span class="sxs-lookup"><span data-stu-id="b7071-209">Feel free to customize these fields as you see fit.</span></span>

<span data-ttu-id="b7071-210">Откройте страницу в браузере.</span><span class="sxs-lookup"><span data-stu-id="b7071-210">Visit the page through a browser.</span></span> <span data-ttu-id="b7071-211">При посещении страницы выбирается Категория «напитки» и соответствующие продукты, перечисленные в сетке.</span><span class="sxs-lookup"><span data-stu-id="b7071-211">When visiting the page the Beverages category is selected and the corresponding products listed in the grid.</span></span> <span data-ttu-id="b7071-212">Изменение раскрывающегося списка на альтернативную категорию, как показано на рис. 12, вызывает обратную передачу и перегружает сетку с продуктами новой выбранной категории.</span><span class="sxs-lookup"><span data-stu-id="b7071-212">Changing the drop-down list to an alternative category, as Figure 12 shows, causes a postback and reloads the grid with the products of the newly selected category.</span></span>

<span data-ttu-id="b7071-213">[![отображаются продукты в категории создать.](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image35.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="b7071-213">[![The Products in the Produce Category are Displayed](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image35.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image34.png)</span></span>

<span data-ttu-id="b7071-214">**Рис. 12**. отображаются продукты в категории создать ([щелкните, чтобы просмотреть изображение с полным размером](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="b7071-214">**Figure 12**: The Products in the Produce Category are Displayed ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image36.png))</span></span>

## <a name="step-5-wrapping-a-stored-procedure-s-statements-within-the-scope-of-a-transaction"></a><span data-ttu-id="b7071-215">Шаг 5. заключение в оболочку хранимых процедур инструкций в области действия транзакции</span><span class="sxs-lookup"><span data-stu-id="b7071-215">Step 5: Wrapping a Stored Procedure s Statements Within the Scope of a Transaction</span></span>

<span data-ttu-id="b7071-216">В процессе [переноса изменений базы данных в рамках руководства по транзакциям](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-vb.md) мы обсуждали методы выполнения ряда инструкций изменения базы данных в области транзакции.</span><span class="sxs-lookup"><span data-stu-id="b7071-216">In the [Wrapping Database Modifications within a Transaction](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-vb.md) tutorial we discussed techniques for performing a series of database modification statements within the scope of a transaction.</span></span> <span data-ttu-id="b7071-217">Помните, что изменения, выполненные под символом-отработкой транзакции, либо все успешно, либо все завершаются сбоем, что гарантирует атомарность.</span><span class="sxs-lookup"><span data-stu-id="b7071-217">Recall that the modifications performed under the umbrella of a transaction either all succeed or all fail, guaranteeing atomicity.</span></span> <span data-ttu-id="b7071-218">Ниже приведены методы использования транзакций.</span><span class="sxs-lookup"><span data-stu-id="b7071-218">Techniques for using transactions include:</span></span>

- <span data-ttu-id="b7071-219">Использование классов в пространстве имен `System.Transactions`</span><span class="sxs-lookup"><span data-stu-id="b7071-219">Using the classes in the `System.Transactions` namespace,</span></span>
- <span data-ttu-id="b7071-220">Уровень доступа к данным использует ADO.NET классы, такие как `SqlTransaction`, и</span><span class="sxs-lookup"><span data-stu-id="b7071-220">Having the Data Access Layer use ADO.NET classes like `SqlTransaction`, and</span></span>
- <span data-ttu-id="b7071-221">Добавление команд транзакций T-SQL непосредственно в хранимую процедуру</span><span class="sxs-lookup"><span data-stu-id="b7071-221">Adding the T-SQL transaction commands directly within the stored procedure</span></span>

<span data-ttu-id="b7071-222">В руководстве по *обработке изменений базы данных в рамках транзакции* используются классы ADO.NET в DAL.</span><span class="sxs-lookup"><span data-stu-id="b7071-222">The *Wrapping Database Modifications within a Transaction* tutorial used the ADO.NET classes in the DAL.</span></span> <span data-ttu-id="b7071-223">В оставшейся части этого руководства рассматривается управление транзакцией с помощью команд T-SQL в хранимой процедуре.</span><span class="sxs-lookup"><span data-stu-id="b7071-223">The remainder of this tutorial examines how to manage a transaction using T-SQL commands from within a stored procedure.</span></span>

<span data-ttu-id="b7071-224">Три основные команды SQL для запуска, фиксации и отката транзакции вручную `BEGIN TRANSACTION`, `COMMIT TRANSACTION`и `ROLLBACK TRANSACTION`соответственно.</span><span class="sxs-lookup"><span data-stu-id="b7071-224">The three key SQL commands for manually starting, committing, and rolling back a transaction are `BEGIN TRANSACTION`, `COMMIT TRANSACTION`, and `ROLLBACK TRANSACTION`, respectively.</span></span> <span data-ttu-id="b7071-225">Как и в случае с подходом ADO.NET, при использовании транзакций из хранимой процедуры необходимо применить следующий шаблон:</span><span class="sxs-lookup"><span data-stu-id="b7071-225">Like with the ADO.NET approach, when using transactions from within a stored procedure we need to apply the following pattern:</span></span>

1. <span data-ttu-id="b7071-226">Указывает на начало транзакции.</span><span class="sxs-lookup"><span data-stu-id="b7071-226">Indicate the start of a transaction.</span></span>
2. <span data-ttu-id="b7071-227">Выполните инструкции SQL, составляющие транзакцию.</span><span class="sxs-lookup"><span data-stu-id="b7071-227">Execute the SQL statements that comprise the transaction.</span></span>
3. <span data-ttu-id="b7071-228">При возникновении ошибки в одной из инструкций, приведенных на шаге 2, необходимо выполнить откат транзакции.</span><span class="sxs-lookup"><span data-stu-id="b7071-228">If there is an error in any one of the statements from Step 2, rollback the transaction.</span></span>
4. <span data-ttu-id="b7071-229">Если все инструкции, выполненные на шаге 2, завершаются без ошибок, зафиксируйте транзакцию.</span><span class="sxs-lookup"><span data-stu-id="b7071-229">If all of the statements from Step 2 complete without error, commit the transaction.</span></span>

<span data-ttu-id="b7071-230">Этот шаблон можно реализовать в синтаксисе T-SQL, используя следующий шаблон:</span><span class="sxs-lookup"><span data-stu-id="b7071-230">This pattern can be implemented in T-SQL syntax using the following template:</span></span>

[!code-sql[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/samples/sample4.sql)]

<span data-ttu-id="b7071-231">Шаблон начинается с определения блока `TRY...CATCH`, новой — для SQL Server 2005.</span><span class="sxs-lookup"><span data-stu-id="b7071-231">The template starts by defining a `TRY...CATCH` block, a construct new to SQL Server 2005.</span></span> <span data-ttu-id="b7071-232">Как и в случае с блоками `Try...Catch` в Visual Basic, блок SQL `TRY...CATCH` выполняет инструкции в блоке `TRY`.</span><span class="sxs-lookup"><span data-stu-id="b7071-232">Like with `Try...Catch` blocks in Visual Basic, the SQL `TRY...CATCH` block executes the statements in the `TRY` block.</span></span> <span data-ttu-id="b7071-233">Если какая-либо инструкция вызывает ошибку, управление немедленно передается в блок `CATCH`.</span><span class="sxs-lookup"><span data-stu-id="b7071-233">If any statement raises an error, control is immediately transferred to the `CATCH` block.</span></span>

<span data-ttu-id="b7071-234">При отсутствии ошибок выполнения инструкций SQL, описывающего транзакцию, инструкция `COMMIT TRANSACTION` фиксирует изменения и завершает транзакцию.</span><span class="sxs-lookup"><span data-stu-id="b7071-234">If there are no errors executing the SQL statements that makeup the transaction, the `COMMIT TRANSACTION` statement commits the changes and completes the transaction.</span></span> <span data-ttu-id="b7071-235">Однако если одна из инструкций приводит к ошибке, то `ROLLBACK TRANSACTION` в блоке `CATCH` возвращает базу данных в состояние до начала транзакции.</span><span class="sxs-lookup"><span data-stu-id="b7071-235">If, however, one of the statements results in an error, the `ROLLBACK TRANSACTION` in the `CATCH` block returns the database to its state prior to the start of the transaction.</span></span> <span data-ttu-id="b7071-236">Хранимая процедура также вызывает ошибку с помощью [команды RAISERROR](https://msdn.microsoft.com/library/ms178592.aspx), которая приводит к возникновению `SqlException` в приложении.</span><span class="sxs-lookup"><span data-stu-id="b7071-236">The stored procedure also raises an error using the [RAISERROR command](https://msdn.microsoft.com/library/ms178592.aspx), which causes a `SqlException` to be raised in the application.</span></span>

> [!NOTE]
> <span data-ttu-id="b7071-237">Так как блок `TRY...CATCH` является новым для SQL Server 2005, указанный выше шаблон не будет работать при использовании более ранних версий Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="b7071-237">Since the `TRY...CATCH` block is new to SQL Server 2005, the above template will not work if you are using older versions of Microsoft SQL Server.</span></span> <span data-ttu-id="b7071-238">Если вы не используете SQL Server 2005, обратитесь к [разделу Управление транзакциями в SQL Server хранимых процедурах](http://www.4guysfromrolla.com/webtech/080305-1.shtml) для шаблона, который будет работать с другими версиями SQL Server.</span><span class="sxs-lookup"><span data-stu-id="b7071-238">If you are not using SQL Server 2005, consult [Managing Transactions in SQL Server Stored Procedures](http://www.4guysfromrolla.com/webtech/080305-1.shtml) for a template that will work with other versions of SQL Server.</span></span>

<span data-ttu-id="b7071-239">Давайте посмотрим на конкретный пример.</span><span class="sxs-lookup"><span data-stu-id="b7071-239">Let s look at a concrete example.</span></span> <span data-ttu-id="b7071-240">Существует ограничение внешнего ключа между таблицами `Categories` и `Products`, то есть каждое поле `CategoryID` в таблице `Products` должно сопоставляться со значением `CategoryID` в таблице `Categories`.</span><span class="sxs-lookup"><span data-stu-id="b7071-240">A foreign key constraint exists between the `Categories` and `Products` tables, meaning that each `CategoryID` field in the `Products` table must map to a `CategoryID` value in the `Categories` table.</span></span> <span data-ttu-id="b7071-241">Любое действие, нарушающее это ограничение, например попытку удалить категорию с соответствующими продуктами, приводит к нарушению ограничения внешнего ключа.</span><span class="sxs-lookup"><span data-stu-id="b7071-241">Any action that would violate this constraint, such as attempting to delete a category that has associated products, results in a foreign key constraint violation.</span></span> <span data-ttu-id="b7071-242">Чтобы проверить это, вернитесь к примеру "обновление и удаление существующих двоичных данных" в разделе "работа с двоичными данными" (`~/BinaryData/UpdatingAndDeleting.aspx`).</span><span class="sxs-lookup"><span data-stu-id="b7071-242">To verify this, revisit the Updating and Deleting Existing Binary Data example in the Working with Binary Data section (`~/BinaryData/UpdatingAndDeleting.aspx`).</span></span> <span data-ttu-id="b7071-243">На этой странице перечислены все категории в системе, а также кнопки "Изменить" и "Удалить" (см. рис. 13), но при попытке удалить категорию с соответствующими продуктами (например, напитки) происходит сбой удаления из-за нарушения ограничения внешнего ключа (см. рис. 14).</span><span class="sxs-lookup"><span data-stu-id="b7071-243">This page lists each category in the system along with Edit and Delete buttons (see Figure 13), but if you attempt to delete a category that has associated products - such as Beverages - the delete fails due to a foreign key constraint violation (see Figure 14).</span></span>

<span data-ttu-id="b7071-244">[![каждая категория отображается в элементе управления GridView с кнопками "Изменить" и "Удалить"](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image38.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="b7071-244">[![Each Category is Displayed in a GridView with Edit and Delete Buttons](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image38.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image37.png)</span></span>

<span data-ttu-id="b7071-245">**Рис. 13**. Каждая категория отображается в элементе управления GridView с кнопками "Изменить" и "Удалить" ([щелкните, чтобы просмотреть изображение с полным размером](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="b7071-245">**Figure 13**: Each Category is Displayed in a GridView with Edit and Delete Buttons ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image39.png))</span></span>

<span data-ttu-id="b7071-246">[![удалить категорию, имеющую существующие продукты, нельзя.](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image41.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="b7071-246">[![You Cannot Delete a Category that has Existing Products](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image41.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image40.png)</span></span>

<span data-ttu-id="b7071-247">**Рис. 14**. невозможно удалить категорию, имеющую существующие продукты ([щелкните, чтобы просмотреть изображение с полным размером](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="b7071-247">**Figure 14**: You Cannot Delete a Category that has Existing Products ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image42.png))</span></span>

<span data-ttu-id="b7071-248">Но представьте, что мы хотим разрешить удаление категорий независимо от наличия связанных с ними продуктов.</span><span class="sxs-lookup"><span data-stu-id="b7071-248">Imagine, though, that we want to allow categories to be deleted regardless of whether they have associated products.</span></span> <span data-ttu-id="b7071-249">Если категория с продуктами должна быть удалена, представьте, что необходимо также удалить существующие продукты (хотя другой вариант — просто задать для его продуктов `CategoryID` значения `NULL`).</span><span class="sxs-lookup"><span data-stu-id="b7071-249">Should a category with products be deleted, imagine that we want to also delete its existing products (although another option would be to simply set its products `CategoryID` values to `NULL`).</span></span> <span data-ttu-id="b7071-250">Эту функцию можно реализовать с помощью правил Cascade в ограничении внешнего ключа.</span><span class="sxs-lookup"><span data-stu-id="b7071-250">This functionality could be implemented through the cascade rules of the foreign key constraint.</span></span> <span data-ttu-id="b7071-251">Кроме того, можно создать хранимую процедуру, которая принимает входной параметр `@CategoryID` и при вызове явно удаляет все связанные продукты, а затем указанную категорию.</span><span class="sxs-lookup"><span data-stu-id="b7071-251">Alternatively, we could create a stored procedure that accepts a `@CategoryID` input parameter and, when invoked, explicitly deletes all of the associated products and then the specified category.</span></span>

<span data-ttu-id="b7071-252">Первая попыток в такой хранимой процедуре может выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="b7071-252">Our first attempt at such a stored procedure might look like the following:</span></span>

[!code-sql[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/samples/sample5.sql)]

<span data-ttu-id="b7071-253">Хотя это определенно удаляет связанные продукты и категории, оно не выполняется в рамках транзакции.</span><span class="sxs-lookup"><span data-stu-id="b7071-253">While this will definitely delete the associated products and category, it does not do so under the umbrella of a transaction.</span></span> <span data-ttu-id="b7071-254">Представьте себе, что существует еще какое-то ограничение внешнего ключа на `Categories`, которое запрещает удаление определенного значения `@CategoryID`.</span><span class="sxs-lookup"><span data-stu-id="b7071-254">Imagine that there is some other foreign key constraint on `Categories` that would prohibit the deletion of a particular `@CategoryID` value.</span></span> <span data-ttu-id="b7071-255">Проблема заключается в том, что в этом случае все продукты будут удалены перед попыткой удалить категорию.</span><span class="sxs-lookup"><span data-stu-id="b7071-255">The problem is that in such a case all of the products will be deleted before we attempt to delete the category.</span></span> <span data-ttu-id="b7071-256">В итоге, для такой категории эта хранимая процедура удалит все свои продукты, пока Категория осталась, так как она все еще содержит связанные записи в какой-либо другой таблице.</span><span class="sxs-lookup"><span data-stu-id="b7071-256">The net result is that for such a category, this stored procedure would remove all of its products while the category remained since it still has related records in some other table.</span></span>

<span data-ttu-id="b7071-257">Однако если хранимая процедура была заключена в область транзакции, то при удалении на `Categories`удаления из `Products`ной таблицы будет произведен откат.</span><span class="sxs-lookup"><span data-stu-id="b7071-257">If the stored procedure were wrapped within the scope of a transaction, however, the deletes to the `Products` table would be rolled back in the face of a failed delete on `Categories`.</span></span> <span data-ttu-id="b7071-258">Следующий скрипт хранимой процедуры использует транзакцию для обеспечения атомарности между двумя операторами `DELETE`:</span><span class="sxs-lookup"><span data-stu-id="b7071-258">The following stored procedure script uses a transaction to assure atomicity between the two `DELETE` statements:</span></span>

[!code-sql[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/samples/sample6.sql)]

<span data-ttu-id="b7071-259">Потратьте время на добавление `Categories_Delete` хранимой процедуры в базу данных Northwind.</span><span class="sxs-lookup"><span data-stu-id="b7071-259">Take a moment to add the `Categories_Delete` stored procedure to the Northwind database.</span></span> <span data-ttu-id="b7071-260">Инструкции по добавлению хранимых процедур в базу данных см. на шаге 1.</span><span class="sxs-lookup"><span data-stu-id="b7071-260">Refer back to Step 1 for instructions on adding stored procedures to a database.</span></span>

## <a name="step-6-updating-thecategoriestableadapter"></a><span data-ttu-id="b7071-261">Шаг 6. обновление`CategoriesTableAdapter`</span><span class="sxs-lookup"><span data-stu-id="b7071-261">Step 6: Updating the`CategoriesTableAdapter`</span></span>

<span data-ttu-id="b7071-262">Хотя мы добавили в базу данных хранимую процедуру `Categories_Delete`, DAL в настоящее время настроен на использование специальных инструкций SQL для выполнения удаления.</span><span class="sxs-lookup"><span data-stu-id="b7071-262">While we ve added the `Categories_Delete` stored procedure to the database, the DAL is currently configured to use ad-hoc SQL statements to perform the delete.</span></span> <span data-ttu-id="b7071-263">Необходимо обновить `CategoriesTableAdapter` и указать, что вместо этого будет использоваться хранимая процедура `Categories_Delete`.</span><span class="sxs-lookup"><span data-stu-id="b7071-263">We need to update the `CategoriesTableAdapter` and instruct it to use the `Categories_Delete` stored procedure instead.</span></span>

> [!NOTE]
> <span data-ttu-id="b7071-264">Ранее в этом учебнике мы работали с набором данных `NorthwindWithSprocs`.</span><span class="sxs-lookup"><span data-stu-id="b7071-264">Earlier in this tutorial we were working with the `NorthwindWithSprocs` DataSet.</span></span> <span data-ttu-id="b7071-265">Однако этот набор данных содержит только одну сущность, `ProductsDataTable`, и нам нужно работать с категориями.</span><span class="sxs-lookup"><span data-stu-id="b7071-265">But that DataSet only has a single entity, `ProductsDataTable`, and we need to work with categories.</span></span> <span data-ttu-id="b7071-266">Таким образом, в оставшейся части этого руководства, когда я расскажу о слое доступа к данным I m, ссылающемся на набор данных `Northwind`, тот, который был создан в учебнике [Создание уровня доступа к данным](../introduction/creating-a-data-access-layer-vb.md) .</span><span class="sxs-lookup"><span data-stu-id="b7071-266">Therefore, for the remainder of this tutorial when I talk about the Data Access Layer I m referring to the `Northwind` DataSet, the one that we first created in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-vb.md) tutorial.</span></span>

<span data-ttu-id="b7071-267">Откройте набор данных Northwind, выберите `CategoriesTableAdapter`и перейдите к окно свойств.</span><span class="sxs-lookup"><span data-stu-id="b7071-267">Open the Northwind DataSet, select the `CategoriesTableAdapter`, and go to the Properties window.</span></span> <span data-ttu-id="b7071-268">В окно свойств перечислены `InsertCommand`, `UpdateCommand`, `DeleteCommand`и `SelectCommand`, используемые TableAdapter, а также его имя и сведения о соединении.</span><span class="sxs-lookup"><span data-stu-id="b7071-268">The Properties window lists the `InsertCommand`, `UpdateCommand`, `DeleteCommand`, and `SelectCommand` used by the TableAdapter, as well as its name and connection information.</span></span> <span data-ttu-id="b7071-269">Разверните свойство `DeleteCommand`, чтобы просмотреть сведения о нем.</span><span class="sxs-lookup"><span data-stu-id="b7071-269">Expand the `DeleteCommand` property to see its details.</span></span> <span data-ttu-id="b7071-270">Как показано на рис. 15, свойству `DeleteCommand` s `CommandType` присвоено значение Text, которое указывает, что он отправляет текст в свойстве `CommandText` в виде специального SQL-запроса.</span><span class="sxs-lookup"><span data-stu-id="b7071-270">As Figure 15 shows, the `DeleteCommand` s `CommandType` property is set to Text, which instructs it to send the text in the `CommandText` property as an ad-hoc SQL query.</span></span>

![Выберите Категориестаблеадаптер в конструкторе, чтобы просмотреть его свойства в окне "Свойства".](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image43.png)

<span data-ttu-id="b7071-272">**Рис. 15**. Выбор `CategoriesTableAdapter` в конструкторе для просмотра его свойств в окне "Свойства"</span><span class="sxs-lookup"><span data-stu-id="b7071-272">**Figure 15**: Select the `CategoriesTableAdapter` in the Designer to View Its Properties in the Properties Window</span></span>

<span data-ttu-id="b7071-273">Чтобы изменить эти параметры, выберите текст (DeleteCommand) в окно свойств и выберите (создать) в раскрывающемся списке.</span><span class="sxs-lookup"><span data-stu-id="b7071-273">To change these settings, select the (DeleteCommand) text in the Properties window and choose (New) from the drop-down list.</span></span> <span data-ttu-id="b7071-274">Это приведет к очистке параметров свойств `CommandText`, `CommandType`и `Parameters`.</span><span class="sxs-lookup"><span data-stu-id="b7071-274">This will clear out the settings for the `CommandText`, `CommandType`, and `Parameters` properties.</span></span> <span data-ttu-id="b7071-275">Затем задайте для свойства `CommandType` значение `StoredProcedure`, а затем введите имя хранимой процедуры для `CommandText` (`dbo.Categories_Delete`).</span><span class="sxs-lookup"><span data-stu-id="b7071-275">Next, set the `CommandType` property to `StoredProcedure` and then type in the name of the stored procedure for the `CommandText` (`dbo.Categories_Delete`).</span></span> <span data-ttu-id="b7071-276">Если вы обязательно вводите свойства в этом порядке, сначала `CommandType`, а затем `CommandText` — Visual Studio автоматически заполнит коллекцию Parameters.</span><span class="sxs-lookup"><span data-stu-id="b7071-276">If you make sure to enter the properties in this order - first the `CommandType` and then the `CommandText` - Visual Studio will automatically populate the Parameters collection.</span></span> <span data-ttu-id="b7071-277">Если эти свойства не вводятся в указанном порядке, необходимо вручную добавить параметры с помощью редактора коллекции параметров.</span><span class="sxs-lookup"><span data-stu-id="b7071-277">If you do not enter these properties in this order, you will have to manually add the parameters through the Parameters Collection Editor.</span></span> <span data-ttu-id="b7071-278">В любом случае лучше щелкнуть многоточие в свойстве Parameters, чтобы открыть редактор коллекции параметров, чтобы убедиться в том, что были внесены правильные настройки параметров (см. рис. 16).</span><span class="sxs-lookup"><span data-stu-id="b7071-278">In either case, it s prudent to click on the ellipses in the Parameters property to bring up the Parameters Collection Editor to verify that the correct parameter settings changes have been made (see Figure 16).</span></span> <span data-ttu-id="b7071-279">Если в диалоговом окне Параметры не отображаются, добавьте параметр `@CategoryID` вручную (не нужно добавлять `@RETURN_VALUE` параметр).</span><span class="sxs-lookup"><span data-stu-id="b7071-279">If you do not see any parameters in the dialog box, add the `@CategoryID` parameter manually (you do not need to add the `@RETURN_VALUE` parameter).</span></span>

![Проверьте правильность настроек параметров](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image44.png)

<span data-ttu-id="b7071-281">**Рис. 16**. Проверка правильности параметров</span><span class="sxs-lookup"><span data-stu-id="b7071-281">**Figure 16**: Ensure That the Parameters Settings are Correct</span></span>

<span data-ttu-id="b7071-282">После обновления DAL удаление категории автоматически удалит все связанные с ней продукты и сделает это в рамках транзакции.</span><span class="sxs-lookup"><span data-stu-id="b7071-282">Once the DAL has been updated, deleting a category will automatically delete all of its associated products and do so under the umbrella of a transaction.</span></span> <span data-ttu-id="b7071-283">Чтобы проверить это, вернитесь на страницу "обновление и удаление существующих двоичных данных" и нажмите кнопку "Удалить" для одной из категорий.</span><span class="sxs-lookup"><span data-stu-id="b7071-283">To verify this, return to the Updating and Deleting Existing Binary Data page and click the Delete button for one of the categories.</span></span> <span data-ttu-id="b7071-284">При одном щелчке мыши Категория и все связанные с ней продукты будут удалены.</span><span class="sxs-lookup"><span data-stu-id="b7071-284">With one single click of the mouse, the category and all of its associated products will be deleted.</span></span>

> [!NOTE]
> <span data-ttu-id="b7071-285">Перед тестированием хранимой процедуры `Categories_Delete`, которая удалит ряд продуктов вместе с выбранной категорией, возможно, будет целесообразно создать резервную копию базы данных.</span><span class="sxs-lookup"><span data-stu-id="b7071-285">Before testing the `Categories_Delete` stored procedure, which will delete a number of products along with the selected category, it might be prudent to make a backup copy of your database.</span></span> <span data-ttu-id="b7071-286">Если вы используете базу данных `NORTHWND.MDF` в `App_Data`, просто закройте Visual Studio и скопируйте файлы MDF и LDF в `App_Data` в другую папку.</span><span class="sxs-lookup"><span data-stu-id="b7071-286">If you are using the `NORTHWND.MDF` database in `App_Data`, simply close Visual Studio and copy the MDF and LDF files in `App_Data` to some other folder.</span></span> <span data-ttu-id="b7071-287">После тестирования функциональности базу данных можно восстановить, закрыв Visual Studio и заменив текущие файлы MDF и LDF в `App_Data` с резервными копиями.</span><span class="sxs-lookup"><span data-stu-id="b7071-287">After testing the functionality, you can restore the database by closing Visual Studio and replacing the current MDF and LDF files in `App_Data` with the backup copies.</span></span>

## <a name="summary"></a><span data-ttu-id="b7071-288">Сводка</span><span class="sxs-lookup"><span data-stu-id="b7071-288">Summary</span></span>

<span data-ttu-id="b7071-289">В то время как мастер TableAdapter автоматически создает хранимые процедуры для нас, бывают случаи, когда эти хранимые процедуры уже созданы или вы хотите создать их вручную или с помощью других средств.</span><span class="sxs-lookup"><span data-stu-id="b7071-289">While the TableAdapter s wizard will automatically generate stored procedures for us, there are times when we might already have such stored procedures created or want to create them manually or with other tools instead.</span></span> <span data-ttu-id="b7071-290">Для поддержки таких сценариев TableAdapter также можно настроить так, чтобы он указывал на существующую хранимую процедуру.</span><span class="sxs-lookup"><span data-stu-id="b7071-290">To accommodate such scenarios, the TableAdapter can also be configured to point to an existing stored procedure.</span></span> <span data-ttu-id="b7071-291">В этом учебнике мы рассмотрели, как вручную добавить хранимые процедуры в базу данных в среде Visual Studio и как связать методы TableAdapter s с этими хранимыми процедурами.</span><span class="sxs-lookup"><span data-stu-id="b7071-291">In this tutorial we looked at how to manually add stored procedures to a database through the Visual Studio environment and how to wire the TableAdapter s methods to these stored procedures.</span></span> <span data-ttu-id="b7071-292">Мы также рассмотрели команды T-SQL и шаблон сценария, используемые для запуска, фиксации и отката транзакций в хранимой процедуре.</span><span class="sxs-lookup"><span data-stu-id="b7071-292">We also examined the T-SQL commands and script pattern used for starting, committing, and rolling back transactions from within a stored procedure.</span></span>

<span data-ttu-id="b7071-293">Поздравляем с программированием!</span><span class="sxs-lookup"><span data-stu-id="b7071-293">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="b7071-294">Об авторе</span><span class="sxs-lookup"><span data-stu-id="b7071-294">About the Author</span></span>

<span data-ttu-id="b7071-295">[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи книг по ASP/ASP. NET и основатель [4GuysFromRolla.com](http://www.4guysfromrolla.com), работал с веб-технологиями Майкрософт с 1998.</span><span class="sxs-lookup"><span data-stu-id="b7071-295">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="b7071-296">Скотт работает как независимый консультант, преподаватель и модуль записи.</span><span class="sxs-lookup"><span data-stu-id="b7071-296">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="b7071-297">Его последняя книга — [*Sams обучать себя ASP.NET 2,0 за 24 часа*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="b7071-297">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="b7071-298">Он доступен по адресу [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="b7071-298">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="b7071-299">или через его блог, который можно найти по адресу [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="b7071-299">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="b7071-300">Специальная благодарность</span><span class="sxs-lookup"><span data-stu-id="b7071-300">Special Thanks To</span></span>

<span data-ttu-id="b7071-301">Эта серия руководств была рассмотрена многими полезными рецензентами.</span><span class="sxs-lookup"><span data-stu-id="b7071-301">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="b7071-302">Потенциальные рецензенты для этого руководства были Хилтон Жеисенов, S REN Джейкоб Лауритсен и Терезой Мерфи.</span><span class="sxs-lookup"><span data-stu-id="b7071-302">Lead reviewers for this tutorial were Hilton Geisenow, S ren Jacob Lauritsen, and Teresa Murphy.</span></span> <span data-ttu-id="b7071-303">Хотите ознакомиться с моими будущими статьями MSDN?</span><span class="sxs-lookup"><span data-stu-id="b7071-303">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="b7071-304">Если это так, расположите строку в [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="b7071-304">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="b7071-305">[Назад](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md)
> [Вперед](updating-the-tableadapter-to-use-joins-vb.md)</span><span class="sxs-lookup"><span data-stu-id="b7071-305">[Previous](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md)
[Next](updating-the-tableadapter-to-use-joins-vb.md)</span></span>
