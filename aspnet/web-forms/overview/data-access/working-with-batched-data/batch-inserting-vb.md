---
uid: web-forms/overview/data-access/working-with-batched-data/batch-inserting-vb
title: Пакетная вставка (VB) | Документация Майкрософт
author: rick-anderson
description: Сведения о вставке нескольких записей базы данных в одну операцию. На уровне пользовательского интерфейса можно расширить GridView, чтобы пользователь вводил несколько n...
ms.author: riande
ms.date: 06/26/2007
ms.assetid: 48e2a4ae-77ca-4208-a204-c38c690ffb59
msc.legacyurl: /web-forms/overview/data-access/working-with-batched-data/batch-inserting-vb
msc.type: authoredcontent
ms.openlocfilehash: 413a0e209b1899414eaab70aff07ee0d3223f28f
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/28/2019
ms.locfileid: "74643124"
---
# <a name="batch-inserting-vb"></a><span data-ttu-id="41cbf-104">Пакетная вставка (VB)</span><span class="sxs-lookup"><span data-stu-id="41cbf-104">Batch Inserting (VB)</span></span>

<span data-ttu-id="41cbf-105">по [Скотт Митчелл](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="41cbf-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="41cbf-106">[Скачать код](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_66_VB.zip) или [скачать PDF](batch-inserting-vb/_static/datatutorial66vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="41cbf-106">[Download Code](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_66_VB.zip) or [Download PDF](batch-inserting-vb/_static/datatutorial66vb1.pdf)</span></span>

> <span data-ttu-id="41cbf-107">Сведения о вставке нескольких записей базы данных в одну операцию.</span><span class="sxs-lookup"><span data-stu-id="41cbf-107">Learn how to insert multiple database records in a single operation.</span></span> <span data-ttu-id="41cbf-108">На уровне пользовательского интерфейса можно расширить GridView, чтобы пользователь вводил несколько новых записей.</span><span class="sxs-lookup"><span data-stu-id="41cbf-108">In the User Interface Layer we extend the GridView to allow the user to enter multiple new records.</span></span> <span data-ttu-id="41cbf-109">На уровне доступа к данным мы заключим несколько операций вставки в транзакцию, чтобы гарантировать успешность всех вставок или отката всех вставок.</span><span class="sxs-lookup"><span data-stu-id="41cbf-109">In the Data Access Layer we wrap the multiple Insert operations within a transaction to ensure that all insertions succeed or all insertions are rolled back.</span></span>

## <a name="introduction"></a><span data-ttu-id="41cbf-110">Введение</span><span class="sxs-lookup"><span data-stu-id="41cbf-110">Introduction</span></span>

<span data-ttu-id="41cbf-111">В руководстве по [пакетному обновлению](batch-updating-vb.md) мы рассматривали настройку элемента управления GridView для предоставления интерфейса, в котором несколько записей были изменены.</span><span class="sxs-lookup"><span data-stu-id="41cbf-111">In the [Batch Updating](batch-updating-vb.md) tutorial we looked at customizing the GridView control to present an interface where multiple records were editable.</span></span> <span data-ttu-id="41cbf-112">Пользователь, посещающий страницу, может внести ряд изменений, а затем, нажав одну кнопку, выполнить пакетное обновление.</span><span class="sxs-lookup"><span data-stu-id="41cbf-112">The user visiting the page could make a series of changes and then, with a single button click, perform a batch update.</span></span> <span data-ttu-id="41cbf-113">В ситуациях, когда пользователи часто обновляют много записей в одном пути, такой интерфейс может сохранять бесчисленные щелчки и переключения контекста мыши по сравнению с функциями редактирования по умолчанию для отдельных строк, которые были впервые рассмотрены в [обзоре руководства по вставке, обновлению и удалению данных](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md) .</span><span class="sxs-lookup"><span data-stu-id="41cbf-113">For situations where users commonly update many records in one go, such an interface can save countless clicks and keyboard-to-mouse context switches when compared to the default per-row editing features that were first explored back in the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md) tutorial.</span></span>

<span data-ttu-id="41cbf-114">Эта концепция также может применяться при добавлении записей.</span><span class="sxs-lookup"><span data-stu-id="41cbf-114">This concept can also be applied when adding records.</span></span> <span data-ttu-id="41cbf-115">Представьте, что в компании Northwind мы обычно получаем поставки от поставщиков, которые содержат ряд продуктов для определенной категории.</span><span class="sxs-lookup"><span data-stu-id="41cbf-115">Imagine that here at Northwind Traders we commonly receive shipments from suppliers that contain a number of products for a particular category.</span></span> <span data-ttu-id="41cbf-116">Например, мы можем получить отправку шести различных продуктов для чай и кофе от Токио.</span><span class="sxs-lookup"><span data-stu-id="41cbf-116">As an example, we might receive a shipment of six different tea and coffee products from Tokyo Traders.</span></span> <span data-ttu-id="41cbf-117">Если пользователь вводит шесть продуктов по одному за раз с помощью элемента управления DetailsView, ему нужно будет выбрать один и тот же параметр в одном и обратном порядке: им нужно будет выбрать одну и ту же категорию (напитки), одного и того же поставщика (Токио) и то же неподдерживаемое значение ( False) и те же единицы в значении заказа (0).</span><span class="sxs-lookup"><span data-stu-id="41cbf-117">If a user enters the six products one at a time through a DetailsView control, they will have to choose many of the same values over and over again: they will need to choose the same category (Beverages), the same supplier (Tokyo Traders), the same discontinued value (False), and the same units on order value (0).</span></span> <span data-ttu-id="41cbf-118">Этот повторяющийся ввод данных не только занимает много времени, но и может привести к ошибкам.</span><span class="sxs-lookup"><span data-stu-id="41cbf-118">This repetitive data entry is not only time consuming, but is prone to errors.</span></span>

<span data-ttu-id="41cbf-119">С небольшой поработкой можно создать пакетный интерфейс вставки, позволяющий пользователю выбрать поставщика и категорию один раз, ввести ряд названий продуктов и цен на единицы, а затем нажать кнопку, чтобы добавить новые продукты в базу данных (см. рис. 1).</span><span class="sxs-lookup"><span data-stu-id="41cbf-119">With a little work we can create a batch inserting interface that enables the user to choose the supplier and category once, enter a series of product names and unit prices, and then click a button to add the new products to the database (see Figure 1).</span></span> <span data-ttu-id="41cbf-120">По мере добавления каждого продукта его `ProductName` и `UnitPrice` полям данных присваиваются значения, введенные в текстовые поля, тогда как значения `CategoryID` и `SupplierID` присваиваются значения из элементов управления DropDownList в верхней части формы.</span><span class="sxs-lookup"><span data-stu-id="41cbf-120">As each product is added, its `ProductName` and `UnitPrice` data fields are assigned the values entered in the TextBoxes, while its `CategoryID` and `SupplierID` values are assigned the values from the DropDownLists at the top fo the form.</span></span> <span data-ttu-id="41cbf-121">Значения `Discontinued` и `UnitsOnOrder` задаются жестко запрограммированными значениями `False` и 0 соответственно.</span><span class="sxs-lookup"><span data-stu-id="41cbf-121">The `Discontinued` and `UnitsOnOrder` values are set to the hard-coded values of `False` and 0, respectively.</span></span>

<span data-ttu-id="41cbf-122">[![интерфейса вставки пакетной службы](batch-inserting-vb/_static/image2.png)](batch-inserting-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="41cbf-122">[![The Batch Inserting Interface](batch-inserting-vb/_static/image2.png)](batch-inserting-vb/_static/image1.png)</span></span>

<span data-ttu-id="41cbf-123">**Рис. 1**. интерфейс вставки пакетов ([щелкните, чтобы просмотреть изображение с полным размером](batch-inserting-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="41cbf-123">**Figure 1**: The Batch Inserting Interface ([Click to view full-size image](batch-inserting-vb/_static/image3.png))</span></span>

<span data-ttu-id="41cbf-124">В этом учебнике мы создадим страницу, которая реализует интерфейс вставки пакетной службы, показанный на рис. 1.</span><span class="sxs-lookup"><span data-stu-id="41cbf-124">In this tutorial we will create a page that implements the batch inserting interface shown in Figure 1.</span></span> <span data-ttu-id="41cbf-125">Как и в предыдущих двух руководствах, мы будем переносить вставки внутри области транзакции, чтобы обеспечить атомарность.</span><span class="sxs-lookup"><span data-stu-id="41cbf-125">As with the previous two tutorials, we will wrap the insertions within the scope of a transaction to ensure atomicity.</span></span> <span data-ttu-id="41cbf-126">Давайте приступим к работе!</span><span class="sxs-lookup"><span data-stu-id="41cbf-126">Let s get started!</span></span>

## <a name="step-1-creating-the-display-interface"></a><span data-ttu-id="41cbf-127">Шаг 1. Создание интерфейса дисплея</span><span class="sxs-lookup"><span data-stu-id="41cbf-127">Step 1: Creating the Display Interface</span></span>

<span data-ttu-id="41cbf-128">В этом учебнике будет состоять одна страница, разделенная на два региона: область экрана и область вставки.</span><span class="sxs-lookup"><span data-stu-id="41cbf-128">This tutorial will consist of a single page that is divided into two regions: a display region and an inserting region.</span></span> <span data-ttu-id="41cbf-129">Интерфейс отображения, который мы создадим на этом шаге, отображает продукты в элементе управления GridView и включает кнопку «Обработка поставки продукта».</span><span class="sxs-lookup"><span data-stu-id="41cbf-129">The display interface, which we'll create in this step, shows the products in a GridView and includes a button titled Process Product Shipment.</span></span> <span data-ttu-id="41cbf-130">При нажатии этой кнопки интерфейс отображения заменяется интерфейсом вставки, который показан на рис. 1.</span><span class="sxs-lookup"><span data-stu-id="41cbf-130">When this button is clicked, the display interface is replaced with the inserting interface, which is shown in Figure 1.</span></span> <span data-ttu-id="41cbf-131">Интерфейс дисплея возвращается после нажатия кнопки Добавить продукты из отгрузки или отмены.</span><span class="sxs-lookup"><span data-stu-id="41cbf-131">The display interface returns after the Add Products from Shipment or Cancel buttons are clicked.</span></span> <span data-ttu-id="41cbf-132">Мы создадим интерфейс вставки на шаге 2.</span><span class="sxs-lookup"><span data-stu-id="41cbf-132">We'll create the inserting interface in Step 2.</span></span>

<span data-ttu-id="41cbf-133">При создании страницы с двумя интерфейсами, каждый из которых является видимым за раз, каждый интерфейс обычно помещается в [веб-элемент управления Panel](http://www.w3schools.com/aspnet/control_panel.asp), который служит контейнером для других элементов управления.</span><span class="sxs-lookup"><span data-stu-id="41cbf-133">When creating a page that has two interfaces, only one of which is visible at a time, each interface typically is placed within a [Panel Web control](http://www.w3schools.com/aspnet/control_panel.asp), which serves as a container for other controls.</span></span> <span data-ttu-id="41cbf-134">Таким образом, на нашей странице будут два элемента управления Panel по одному для каждого интерфейса.</span><span class="sxs-lookup"><span data-stu-id="41cbf-134">Therefore, our page will have two Panel controls one for each interface.</span></span>

<span data-ttu-id="41cbf-135">Для начала откройте страницу `BatchInsert.aspx` в папке `BatchData` и перетащите панель из панели элементов в конструктор (см. рис. 2).</span><span class="sxs-lookup"><span data-stu-id="41cbf-135">Start by opening the `BatchInsert.aspx` page in the `BatchData` folder and drag a Panel from the Toolbox onto the Designer (see Figure 2).</span></span> <span data-ttu-id="41cbf-136">Задайте для свойства Panel `ID` значение `DisplayInterface`.</span><span class="sxs-lookup"><span data-stu-id="41cbf-136">Set the Panel s `ID` property to `DisplayInterface`.</span></span> <span data-ttu-id="41cbf-137">При добавлении панели в конструктор его свойства `Height` и `Width` устанавливаются в 50px и 125px соответственно.</span><span class="sxs-lookup"><span data-stu-id="41cbf-137">When adding the Panel to the Designer, its `Height` and `Width` properties are set to 50px and 125px, respectively.</span></span> <span data-ttu-id="41cbf-138">Удалите эти значения свойств из окно свойств.</span><span class="sxs-lookup"><span data-stu-id="41cbf-138">Clear out these property values from the Properties window.</span></span>

<span data-ttu-id="41cbf-139">[![перетащить панель из панели элементов в конструктор](batch-inserting-vb/_static/image5.png)](batch-inserting-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="41cbf-139">[![Drag a Panel from the Toolbox onto the Designer](batch-inserting-vb/_static/image5.png)](batch-inserting-vb/_static/image4.png)</span></span>

<span data-ttu-id="41cbf-140">**Рис. 2**. Перетаскивание панели из панели элементов в конструктор ([щелкните, чтобы просмотреть изображение с полным размером](batch-inserting-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="41cbf-140">**Figure 2**: Drag a Panel from the Toolbox onto the Designer ([Click to view full-size image](batch-inserting-vb/_static/image6.png))</span></span>

<span data-ttu-id="41cbf-141">Затем перетащите кнопку и элемент управления GridView на панель.</span><span class="sxs-lookup"><span data-stu-id="41cbf-141">Next, drag a Button and GridView control into the Panel.</span></span> <span data-ttu-id="41cbf-142">Задайте для свойства Button `ID` значение `ProcessShipment` и его свойство `Text` для обработки отгрузки продукта.</span><span class="sxs-lookup"><span data-stu-id="41cbf-142">Set the Button s `ID` property to `ProcessShipment` and its `Text` property to Process Product Shipment.</span></span> <span data-ttu-id="41cbf-143">Задайте для свойства `ID` GridView s значение `ProductsGrid` и из его смарт-тега привяжите его к новому ObjectDataSource с именем `ProductsDataSource`.</span><span class="sxs-lookup"><span data-stu-id="41cbf-143">Set the GridView s `ID` property to `ProductsGrid` and, from its smart tag, bind it to a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="41cbf-144">Настройте ObjectDataSource для извлечения данных из `GetProducts` метода `ProductsBLL` классов.</span><span class="sxs-lookup"><span data-stu-id="41cbf-144">Configure the ObjectDataSource to pull its data from the `ProductsBLL` class s `GetProducts` method.</span></span> <span data-ttu-id="41cbf-145">Поскольку этот элемент GridView используется только для вывода данных, установите в раскрывающихся списках на вкладках обновление, вставка и удаление значение (нет).</span><span class="sxs-lookup"><span data-stu-id="41cbf-145">Since this GridView is used only to display data, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None).</span></span> <span data-ttu-id="41cbf-146">Нажмите кнопку Готово, чтобы завершить работу мастера настройки источника данных.</span><span class="sxs-lookup"><span data-stu-id="41cbf-146">Click Finish to complete the Configure Data Source wizard.</span></span>

<span data-ttu-id="41cbf-147">[![отобразить данные, возвращаемые методом ProductsBLL класса s](batch-inserting-vb/_static/image8.png)](batch-inserting-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="41cbf-147">[![Display the Data Returned from the ProductsBLL Class s GetProducts Method](batch-inserting-vb/_static/image8.png)](batch-inserting-vb/_static/image7.png)</span></span>

<span data-ttu-id="41cbf-148">**Рис. 3**. Отображение данных, возвращаемых методом `GetProducts` `ProductsBLL` классов ([щелкните, чтобы просмотреть изображение с полным размером](batch-inserting-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="41cbf-148">**Figure 3**: Display the Data Returned from the `ProductsBLL` Class s `GetProducts` Method ([Click to view full-size image](batch-inserting-vb/_static/image9.png))</span></span>

<span data-ttu-id="41cbf-149">[![установить в раскрывающихся списках на вкладках обновления, вставки и удаления значение (нет)](batch-inserting-vb/_static/image11.png)](batch-inserting-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="41cbf-149">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](batch-inserting-vb/_static/image11.png)](batch-inserting-vb/_static/image10.png)</span></span>

<span data-ttu-id="41cbf-150">**Рис. 4**. Установка раскрывающихся списков на вкладках обновления, вставки и удаления в (нет) ([щелкните, чтобы просмотреть изображение с полным размером](batch-inserting-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="41cbf-150">**Figure 4**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](batch-inserting-vb/_static/image12.png))</span></span>

<span data-ttu-id="41cbf-151">После завершения работы мастера ObjectDataSource Visual Studio добавит BoundFields и CheckBoxField для полей данных продукта.</span><span class="sxs-lookup"><span data-stu-id="41cbf-151">After completing the ObjectDataSource wizard, Visual Studio will add BoundFields and a CheckBoxField for the product data fields.</span></span> <span data-ttu-id="41cbf-152">Удалите все поля, кроме `ProductName`, `CategoryName`, `SupplierName`, `UnitPrice`и `Discontinued`.</span><span class="sxs-lookup"><span data-stu-id="41cbf-152">Remove all but the `ProductName`, `CategoryName`, `SupplierName`, `UnitPrice`, and `Discontinued` fields.</span></span> <span data-ttu-id="41cbf-153">Вы можете делать любые настройки Aesthetic.</span><span class="sxs-lookup"><span data-stu-id="41cbf-153">Feel free to make any aesthetic customizations.</span></span> <span data-ttu-id="41cbf-154">Я решил отформатировать поле `UnitPrice` как денежное значение, переупорядочивая поля и переименовать несколько полей `HeaderText` значений.</span><span class="sxs-lookup"><span data-stu-id="41cbf-154">I decided to format the `UnitPrice` field as a currency value, reordered the fields, and renamed several of the fields `HeaderText` values.</span></span> <span data-ttu-id="41cbf-155">Также настройте GridView для включения поддержки разбиения по страницам и сортировки, установив флажки Включить разбиение по страницам и включить сортировку в смарт-теге GridView s.</span><span class="sxs-lookup"><span data-stu-id="41cbf-155">Also configure the GridView to include paging and sorting support by checking the Enable Paging and Enable Sorting checkboxes in the GridView s smart tag.</span></span>

<span data-ttu-id="41cbf-156">После добавления элементов управления "панель", "Кнопка", "GridView" и "ObjectDataSource" и настройки полей "GridView s" декларативная разметка страницы должна выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="41cbf-156">After adding the Panel, Button, GridView, and ObjectDataSource controls and customizing the GridView s fields, your page s declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](batch-inserting-vb/samples/sample1.aspx)]

<span data-ttu-id="41cbf-157">Обратите внимание, что разметка для кнопки и GridView отображается в открывающих и закрывающих тегах `<asp:Panel>`.</span><span class="sxs-lookup"><span data-stu-id="41cbf-157">Note that the markup for the Button and GridView appear within the opening and closing `<asp:Panel>` tags.</span></span> <span data-ttu-id="41cbf-158">Так как эти элементы управления находятся на панели `DisplayInterface`, их можно скрыть, просто установив для свойства Panel `Visible` значение `False`.</span><span class="sxs-lookup"><span data-stu-id="41cbf-158">Since these controls are within the `DisplayInterface` Panel, we can hide them by simply setting the Panel s `Visible` property to `False`.</span></span> <span data-ttu-id="41cbf-159">На шаге 3 рассматривается программное изменение свойства Panel `Visible` в ответ на нажатие кнопки для отображения одного интерфейса при скрытии другого.</span><span class="sxs-lookup"><span data-stu-id="41cbf-159">Step 3 looks at programmatically changing the Panel s `Visible` property in response to a button click to show one interface while hiding the other.</span></span>

<span data-ttu-id="41cbf-160">Уделите время для просмотра хода выполнения в браузере.</span><span class="sxs-lookup"><span data-stu-id="41cbf-160">Take a moment to view our progress through a browser.</span></span> <span data-ttu-id="41cbf-161">Как показано на рис. 5, вы увидите кнопку обработать отгрузку продукта над элементом GridView, который содержит десять продуктов за раз.</span><span class="sxs-lookup"><span data-stu-id="41cbf-161">As Figure 5 shows, you should see a Process Product Shipment button above a GridView that lists the products ten at a time.</span></span>

<span data-ttu-id="41cbf-162">[![GridView перечисляет продукты и предлагает возможности сортировки и разбиения на страницы.](batch-inserting-vb/_static/image14.png)](batch-inserting-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="41cbf-162">[![The GridView Lists the Products and Offers Sorting and Paging Capabilities](batch-inserting-vb/_static/image14.png)](batch-inserting-vb/_static/image13.png)</span></span>

<span data-ttu-id="41cbf-163">**Рис. 5**. элемент управления GridView перечисляет продукты и предлагает возможности сортировки и разбиения на страницы ([щелкните, чтобы просмотреть изображение с полным размером](batch-inserting-vb/_static/image15.png)).</span><span class="sxs-lookup"><span data-stu-id="41cbf-163">**Figure 5**: The GridView Lists the Products and Offers Sorting and Paging Capabilities ([Click to view full-size image](batch-inserting-vb/_static/image15.png))</span></span>

## <a name="step-2-creating-the-inserting-interface"></a><span data-ttu-id="41cbf-164">Шаг 2. Создание интерфейса вставки</span><span class="sxs-lookup"><span data-stu-id="41cbf-164">Step 2: Creating the Inserting Interface</span></span>

<span data-ttu-id="41cbf-165">Теперь, когда интерфейс интерфейса дисплея завершен, мы повторно готовы к созданию интерфейса вставки.</span><span class="sxs-lookup"><span data-stu-id="41cbf-165">With the display interface complete, we re ready to create the inserting interface.</span></span> <span data-ttu-id="41cbf-166">В этом руководстве мы создадим интерфейс вставки, запрашивающий одного поставщика и значения категории, а затем позволяющий пользователю ввести до пяти названий продуктов и значений цены за единицу.</span><span class="sxs-lookup"><span data-stu-id="41cbf-166">For this tutorial, let s create an inserting interface that prompts for a single supplier and category value and then allows the user to enter up to five product names and unit price values.</span></span> <span data-ttu-id="41cbf-167">С помощью этого интерфейса пользователь может добавить до пяти новых продуктов, имеющих одну и ту же категорию и поставщика, но уникальные названия продуктов и цены.</span><span class="sxs-lookup"><span data-stu-id="41cbf-167">With this interface, the user can add one to five new products that all share the same category and supplier, but have unique product names and prices.</span></span>

<span data-ttu-id="41cbf-168">Начните с перетаскивания панели из панели элементов в конструктор, разместив ее под существующей панелью `DisplayInterface`.</span><span class="sxs-lookup"><span data-stu-id="41cbf-168">Start by dragging a Panel from the Toolbox onto the Designer, placing it beneath the existing `DisplayInterface` Panel.</span></span> <span data-ttu-id="41cbf-169">Задайте для свойства `ID` этой вновь добавленной панели значение `InsertingInterface` и задайте для свойства `Visible` значение `False`.</span><span class="sxs-lookup"><span data-stu-id="41cbf-169">Set the `ID` property of this newly added Panel to `InsertingInterface` and set its `Visible` property to `False`.</span></span> <span data-ttu-id="41cbf-170">Мы добавим код, который задает для свойства Panel `InsertingInterface` `Visible` значение `True` на шаге 3.</span><span class="sxs-lookup"><span data-stu-id="41cbf-170">We'll add code that sets the `InsertingInterface` Panel s `Visible` property to `True` in Step 3.</span></span> <span data-ttu-id="41cbf-171">Также снимите флажки с `Height` и `Width` значений свойств на панели.</span><span class="sxs-lookup"><span data-stu-id="41cbf-171">Also clear out the Panel s `Height` and `Width` property values.</span></span>

<span data-ttu-id="41cbf-172">Далее необходимо создать интерфейс вставки, показанный на рис. 1.</span><span class="sxs-lookup"><span data-stu-id="41cbf-172">Next, we need to create the inserting interface that was shown back in Figure 1.</span></span> <span data-ttu-id="41cbf-173">Этот интерфейс можно создать с помощью различных методов HTML, но мы будем использовать довольно простую таблицу: четыре столбца и семь строк.</span><span class="sxs-lookup"><span data-stu-id="41cbf-173">This interface can be created through a variety of HTML techniques, but we will use a fairly straightforward one: a four-column, seven-row table.</span></span>

> [!NOTE]
> <span data-ttu-id="41cbf-174">При вводе разметки для HTML-элементов `<table>` я предпочитаю использовать представление исходного кода.</span><span class="sxs-lookup"><span data-stu-id="41cbf-174">When entering markup for HTML `<table>` elements, I prefer to use the Source view.</span></span> <span data-ttu-id="41cbf-175">Хотя в Visual Studio есть средства для добавления элементов `<table>` через конструктор, конструктор кажется, что он слишком готов к внедрению незапрашиваемых параметров `style` в разметку.</span><span class="sxs-lookup"><span data-stu-id="41cbf-175">While Visual Studio does have tools for adding `<table>` elements through the Designer, the Designer seems all too willing to inject unasked for `style` settings into the markup.</span></span> <span data-ttu-id="41cbf-176">После создания разметки `<table>` обычно возвращается в конструктор, чтобы добавить веб-элементы управления и задать их свойства.</span><span class="sxs-lookup"><span data-stu-id="41cbf-176">Once I have created the `<table>` markup, I usually return to the Designer to add the Web controls and set their properties.</span></span> <span data-ttu-id="41cbf-177">При создании таблиц с заранее определенными столбцами и строками я предпочитаю использовать статический HTML, а не [веб-элемент управления Table](https://msdn.microsoft.com/library/system.web.ui.webcontrols.table.aspx) , так как доступ к веб-элементам управления, размещенным в веб-элементе управления Table, возможен только с помощью шаблона `FindControl("controlID")`.</span><span class="sxs-lookup"><span data-stu-id="41cbf-177">When creating tables with pre-determined columns and rows I prefer using static HTML rather than the [Table Web control](https://msdn.microsoft.com/library/system.web.ui.webcontrols.table.aspx) because any Web controls placed within a Table Web control can only be accessed using the `FindControl("controlID")` pattern.</span></span> <span data-ttu-id="41cbf-178">Однако я использую табличные веб-элементы управления для динамически изменяемых таблиц (строк или столбцов, которые основываются на определенных базах данных или определенных пользователем условиях), так как веб-элемент управления Table может быть создан программным способом.</span><span class="sxs-lookup"><span data-stu-id="41cbf-178">I do, however, use Table Web controls for dynamically-sized tables (ones whose rows or columns are based on some database or user-specified criteria), since the Table Web control can be constructed programmatically.</span></span>

<span data-ttu-id="41cbf-179">Введите следующую разметку в теги `<asp:Panel>` панели `InsertingInterface`:</span><span class="sxs-lookup"><span data-stu-id="41cbf-179">Enter the following markup within the `<asp:Panel>` tags of the `InsertingInterface` Panel:</span></span>

[!code-html[Main](batch-inserting-vb/samples/sample2.html)]

<span data-ttu-id="41cbf-180">Эта `<table>`ная разметка еще не содержит никаких веб-элементов управления, мы добавим их мгновенно.</span><span class="sxs-lookup"><span data-stu-id="41cbf-180">This `<table>` markup does not include any Web controls yet, we'll add those momentarily.</span></span> <span data-ttu-id="41cbf-181">Обратите внимание, что каждый элемент `<tr>` содержит определенный параметр класса CSS: `BatchInsertHeaderRow` для строки заголовка, куда будут элементов управления DropDownList поставщик и Категория. `BatchInsertFooterRow` для строки нижнего колонтитула, куда переходят кнопки Добавить продукты из отгрузки и отмены. и чередование значений `BatchInsertRow` и `BatchInsertAlternatingRow` для строк, которые будут содержать элементы управления TextBox Product и Price.</span><span class="sxs-lookup"><span data-stu-id="41cbf-181">Note that each `<tr>` element contains a particular CSS class setting: `BatchInsertHeaderRow` for the header row where the supplier and category DropDownLists will go; `BatchInsertFooterRow` for the footer row where the Add Products from Shipment and Cancel Buttons will go; and alternating `BatchInsertRow` and `BatchInsertAlternatingRow` values for the rows that will contain the product and unit price TextBox controls.</span></span> <span data-ttu-id="41cbf-182">Я создал соответствующие классы CSS в файле `Styles.css`, чтобы обеспечить внешний вид интерфейса вставки, похожий на элементы управления GridView и DetailsView, которые использовались в этих руководствах.</span><span class="sxs-lookup"><span data-stu-id="41cbf-182">I ve created corresponding CSS classes in the `Styles.css` file to give the inserting interface an appearance similar to the GridView and DetailsView controls we ve used throughout these tutorials.</span></span> <span data-ttu-id="41cbf-183">Ниже приведены эти классы CSS.</span><span class="sxs-lookup"><span data-stu-id="41cbf-183">These CSS classes are shown below.</span></span>

[!code-css[Main](batch-inserting-vb/samples/sample3.css)]

<span data-ttu-id="41cbf-184">После введения этой разметки вернитесь к представление конструирования.</span><span class="sxs-lookup"><span data-stu-id="41cbf-184">With this markup entered, return to the Design view.</span></span> <span data-ttu-id="41cbf-185">Эта `<table>` должна отображаться в виде таблицы из четырех столбцов и семи строк в конструкторе, как показано на рис. 6.</span><span class="sxs-lookup"><span data-stu-id="41cbf-185">This `<table>` should show as a four-column, seven-row table in the Designer, as Figure 6 illustrates.</span></span>

<span data-ttu-id="41cbf-186">[![интерфейс вставки состоит из таблицы из четырех столбцов и семи строк](batch-inserting-vb/_static/image17.png)](batch-inserting-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="41cbf-186">[![The Inserting Interface is Composed of a Four-Column, Seven-Row Table](batch-inserting-vb/_static/image17.png)](batch-inserting-vb/_static/image16.png)</span></span>

<span data-ttu-id="41cbf-187">**Рис. 6**. интерфейс вставки состоит из таблицы из четырех столбцов и семи строк ([щелкните, чтобы просмотреть изображение с полным размером](batch-inserting-vb/_static/image18.png)).</span><span class="sxs-lookup"><span data-stu-id="41cbf-187">**Figure 6**: The Inserting Interface is Composed of a Four-Column, Seven-Row Table ([Click to view full-size image](batch-inserting-vb/_static/image18.png))</span></span>

<span data-ttu-id="41cbf-188">Теперь мы готовы к добавлению веб-элементов управления в интерфейс вставки.</span><span class="sxs-lookup"><span data-stu-id="41cbf-188">We re now ready to add the Web controls to the inserting interface.</span></span> <span data-ttu-id="41cbf-189">Перетащите два элементов управления DropDownList из области элементов в соответствующие ячейки таблицы, одну для поставщика, и одну для категории.</span><span class="sxs-lookup"><span data-stu-id="41cbf-189">Drag two DropDownLists from the Toolbox into the appropriate cells in the table one for the supplier and one for the category.</span></span>

<span data-ttu-id="41cbf-190">Задайте для свойства `ID` в DropDownList поставщика значение `Suppliers` и привяжите его к новому ObjectDataSource с именем `SuppliersDataSource`.</span><span class="sxs-lookup"><span data-stu-id="41cbf-190">Set the supplier DropDownList s `ID` property to `Suppliers` and bind it to a new ObjectDataSource named `SuppliersDataSource`.</span></span> <span data-ttu-id="41cbf-191">Настройте новый элемент ObjectDataSource для получения данных из метода `SuppliersBLL` Class s `GetSuppliers` и установите в раскрывающемся списке вкладку обновления значение (нет).</span><span class="sxs-lookup"><span data-stu-id="41cbf-191">Configure the new ObjectDataSource to retrieve its data from the `SuppliersBLL` class s `GetSuppliers` method and set the UPDATE tab s drop-down list to (None).</span></span> <span data-ttu-id="41cbf-192">Чтобы завершить работу мастера, нажмите кнопку Готово.</span><span class="sxs-lookup"><span data-stu-id="41cbf-192">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="41cbf-193">[![настроить ObjectDataSource для использования метода Супплиерсблл класса s](batch-inserting-vb/_static/image20.png)](batch-inserting-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="41cbf-193">[![Configure the ObjectDataSource to Use the SuppliersBLL Class s GetSuppliers Method](batch-inserting-vb/_static/image20.png)](batch-inserting-vb/_static/image19.png)</span></span>

<span data-ttu-id="41cbf-194">**Рис. 7**. Настройка ObjectDataSource для использования метода `GetSuppliers` `SuppliersBLL` классов ([щелкните, чтобы просмотреть изображение с полным размером](batch-inserting-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="41cbf-194">**Figure 7**: Configure the ObjectDataSource to Use the `SuppliersBLL` Class s `GetSuppliers` Method ([Click to view full-size image](batch-inserting-vb/_static/image21.png))</span></span>

<span data-ttu-id="41cbf-195">По`Suppliers` DropDownList отображать поле данных `CompanyName` и использовать `SupplierID` поле данных в качестве значений `ListItem` s.</span><span class="sxs-lookup"><span data-stu-id="41cbf-195">Have the `Suppliers` DropDownList display the `CompanyName` data field and use the `SupplierID` data field as its `ListItem` s values.</span></span>

<span data-ttu-id="41cbf-196">[![отобразить поле данных CompanyName и использовать значение КодПоставщика в качестве значения](batch-inserting-vb/_static/image23.png)](batch-inserting-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="41cbf-196">[![Display the CompanyName Data Field and Use SupplierID as the Value](batch-inserting-vb/_static/image23.png)](batch-inserting-vb/_static/image22.png)</span></span>

<span data-ttu-id="41cbf-197">**Рис. 8**. Отображение поля данных `CompanyName` и использование `SupplierID` в качестве значения ([щелкните, чтобы просмотреть изображение с полным размером](batch-inserting-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="41cbf-197">**Figure 8**: Display the `CompanyName` Data Field and Use `SupplierID` as the Value ([Click to view full-size image](batch-inserting-vb/_static/image24.png))</span></span>

<span data-ttu-id="41cbf-198">Назовите второй элемент управления DropDownList `Categories` и привяжите его к новому ObjectDataSource с именем `CategoriesDataSource`.</span><span class="sxs-lookup"><span data-stu-id="41cbf-198">Name the second DropDownList `Categories` and bind it to a new ObjectDataSource named `CategoriesDataSource`.</span></span> <span data-ttu-id="41cbf-199">Настройте `CategoriesDataSource` ObjectDataSource для использования метода `CategoriesBLL` класса s `GetCategories`. Задайте для раскрывающихся списков на вкладках обновление и удаление значение (нет) и нажмите кнопку Готово, чтобы завершить работу мастера.</span><span class="sxs-lookup"><span data-stu-id="41cbf-199">Configure the `CategoriesDataSource` ObjectDataSource to use the `CategoriesBLL` class s `GetCategories` method; set the drop-down lists in the UPDATE and DELETE tabs to (None) and click Finish to complete the wizard.</span></span> <span data-ttu-id="41cbf-200">Наконец, отобразите в DropDownList поле данных `CategoryName` и используйте в качестве значения `CategoryID`.</span><span class="sxs-lookup"><span data-stu-id="41cbf-200">Finally, have the DropDownList display the `CategoryName` data field and use the `CategoryID` as the value.</span></span>

<span data-ttu-id="41cbf-201">После добавления этих двух элементов управления DropDownList и их привязки к соответствующим настройкам ObjectDataSource экран должен выглядеть примерно так, как показано на рис. 9.</span><span class="sxs-lookup"><span data-stu-id="41cbf-201">After these two DropDownLists have been added and bound to appropriately configured ObjectDataSources, your screen should look similar to Figure 9.</span></span>

<span data-ttu-id="41cbf-202">[![строка заголовка теперь содержит поставщики и категории элементов управления DropDownList](batch-inserting-vb/_static/image26.png)](batch-inserting-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="41cbf-202">[![The Header Row Now Contains the Suppliers and Categories DropDownLists](batch-inserting-vb/_static/image26.png)](batch-inserting-vb/_static/image25.png)</span></span>

<span data-ttu-id="41cbf-203">**Рис. 9**. Теперь строка заголовка содержит `Suppliers` и `Categories` элементов управления DropDownList ([щелкните, чтобы просмотреть изображение с полным размером](batch-inserting-vb/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="41cbf-203">**Figure 9**: The Header Row Now Contains the `Suppliers` and `Categories` DropDownLists ([Click to view full-size image](batch-inserting-vb/_static/image27.png))</span></span>

<span data-ttu-id="41cbf-204">Теперь необходимо создать текстовые поля для получения имени и цены для каждого нового продукта.</span><span class="sxs-lookup"><span data-stu-id="41cbf-204">We now need to create the TextBoxes to collect the name and price for each new product.</span></span> <span data-ttu-id="41cbf-205">Перетащите элемент управления TextBox из области элементов в конструктор для каждого из пяти строк «название продукта» и «цена».</span><span class="sxs-lookup"><span data-stu-id="41cbf-205">Drag a TextBox control from the Toolbox onto the Designer for each of the five product name and price rows.</span></span> <span data-ttu-id="41cbf-206">Задайте для свойств `ID` текстовых полей значение `ProductName1`, `UnitPrice1`, `ProductName2`, `UnitPrice2`, `ProductName3`, `UnitPrice3`и т. д.</span><span class="sxs-lookup"><span data-stu-id="41cbf-206">Set the `ID` properties of the TextBoxes to `ProductName1`, `UnitPrice1`, `ProductName2`, `UnitPrice2`, `ProductName3`, `UnitPrice3`, and so on.</span></span>

<span data-ttu-id="41cbf-207">Добавьте объект CompareValidator после каждого текстового поля Цена единицы, установив для свойства `ControlToValidate` соответствующее `ID`.</span><span class="sxs-lookup"><span data-stu-id="41cbf-207">Add a CompareValidator after each of the unit price TextBoxes, setting the `ControlToValidate` property to the appropriate `ID`.</span></span> <span data-ttu-id="41cbf-208">Также задайте для свойства `Operator` значение `GreaterThanEqual`, `ValueToCompare` 0, а `Type` — `Currency`.</span><span class="sxs-lookup"><span data-stu-id="41cbf-208">Also set the `Operator` property to `GreaterThanEqual`, `ValueToCompare` to 0, and `Type` to `Currency`.</span></span> <span data-ttu-id="41cbf-209">Эти параметры указывают объекту CompareValidator убедиться, что цена, если она указана, является допустимым значением валюты, которое больше или равно нулю.</span><span class="sxs-lookup"><span data-stu-id="41cbf-209">These settings instruct the CompareValidator to ensure that the price, if entered, is a valid currency value that is greater than or equal to zero.</span></span> <span data-ttu-id="41cbf-210">Задайте для свойства `Text` значение \*, а `ErrorMessage` цена должна быть больше или равна нулю.</span><span class="sxs-lookup"><span data-stu-id="41cbf-210">Set the `Text` property to \*, and `ErrorMessage` to The price must be greater than or equal to zero.</span></span> <span data-ttu-id="41cbf-211">Кроме того, не указывайте символы валют.</span><span class="sxs-lookup"><span data-stu-id="41cbf-211">Also, please omit any currency symbols.</span></span>

> [!NOTE]
> <span data-ttu-id="41cbf-212">Интерфейс вставки не включает элементы управления RequiredFieldValidator, несмотря на то, что поле `ProductName` в таблице `Products` базы данных не допускает `NULL` значений.</span><span class="sxs-lookup"><span data-stu-id="41cbf-212">The inserting interface does not include any RequiredFieldValidator controls, even though the `ProductName` field in the `Products` database table does not allow `NULL` values.</span></span> <span data-ttu-id="41cbf-213">Это связано с тем, что мы хотим позволить пользователю ввести до пяти продуктов.</span><span class="sxs-lookup"><span data-stu-id="41cbf-213">This is because we want to let the user enter up to five products.</span></span> <span data-ttu-id="41cbf-214">Например, если пользователю было необходимо предоставить название продукта и цену за единицу для первых трех строк, в результате чего две последние строки будут пустыми, d просто добавит в систему три новых продукта.</span><span class="sxs-lookup"><span data-stu-id="41cbf-214">For example, if the user were to provide the product name and unit price for the first three rows, leaving the last two rows blank, we d just add three new products to the system.</span></span> <span data-ttu-id="41cbf-215">Поскольку требуется `ProductName`, необходимо программно проверить, чтобы убедиться, что если введена Цена за единицу, что указано соответствующее значение названия продукта.</span><span class="sxs-lookup"><span data-stu-id="41cbf-215">Since `ProductName` is required, however, we will need to programmatically check to ensure that if a unit price is entered that a corresponding product name value is provided.</span></span> <span data-ttu-id="41cbf-216">Мы рассмотрим эту проверку в шаге 4.</span><span class="sxs-lookup"><span data-stu-id="41cbf-216">We'll tackle this check in Step 4.</span></span>

<span data-ttu-id="41cbf-217">При проверке входных данных пользователя объект CompareValidator сообщает недопустимые данные, если значение содержит символ валюты.</span><span class="sxs-lookup"><span data-stu-id="41cbf-217">When validating the user s input, the CompareValidator reports invalid data if the value contains a currency symbol.</span></span> <span data-ttu-id="41cbf-218">Добавьте «$» перед каждым текстовым полем «Цена», чтобы служить визуальной подсказкой, которая указывает пользователю опустить символ валюты при вводе цены.</span><span class="sxs-lookup"><span data-stu-id="41cbf-218">Add a $ in front of each of the unit price TextBoxes to serve as a visual cue that instructs the user to omit the currency symbol when entering the price.</span></span>

<span data-ttu-id="41cbf-219">Наконец, добавьте элемент управления ValidationSummary на панели `InsertingInterface`, применяет его свойство `ShowMessageBox` к `True` и его `ShowSummary` свойству значение `False`.</span><span class="sxs-lookup"><span data-stu-id="41cbf-219">Lastly, add a ValidationSummary control within the `InsertingInterface` Panel, settings its `ShowMessageBox` property to `True` and its `ShowSummary` property to `False`.</span></span> <span data-ttu-id="41cbf-220">С помощью этих параметров, если пользователь вводит недопустимое значение цены за единицу, рядом с элементами управления TextBox, вызвавшими ошибку, появится звездочка, и в ValidationSummary отобразится окно MessageBox на стороне клиента, в котором отображается сообщение об ошибке, указанное ранее.</span><span class="sxs-lookup"><span data-stu-id="41cbf-220">With these settings, if the user enters an invalid unit price value, an asterisk will appear next to the offending TextBox controls and the ValidationSummary will display a client-side messagebox that shows the error message we specified earlier.</span></span>

<span data-ttu-id="41cbf-221">На этом этапе экран должен выглядеть примерно так, как показано на рис. 10.</span><span class="sxs-lookup"><span data-stu-id="41cbf-221">At this point, your screen should look similar to Figure 10.</span></span>

<span data-ttu-id="41cbf-222">[![интерфейс вставки теперь включает текстовые поля для имен и цен продуктов.](batch-inserting-vb/_static/image29.png)](batch-inserting-vb/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="41cbf-222">[![The Inserting Interface Now Includes TextBoxes for the Products Names and Prices](batch-inserting-vb/_static/image29.png)](batch-inserting-vb/_static/image28.png)</span></span>

<span data-ttu-id="41cbf-223">**Рис. 10**. Теперь интерфейс вставки содержит текстовые поля для имен и цен продуктов ([щелкните, чтобы просмотреть изображение с полным размером](batch-inserting-vb/_static/image30.png)).</span><span class="sxs-lookup"><span data-stu-id="41cbf-223">**Figure 10**: The Inserting Interface Now Includes TextBoxes for the Products Names and Prices ([Click to view full-size image](batch-inserting-vb/_static/image30.png))</span></span>

<span data-ttu-id="41cbf-224">Далее необходимо добавить кнопки Добавить продукты из отгрузки и Отмена в строку нижнего колонтитула.</span><span class="sxs-lookup"><span data-stu-id="41cbf-224">Next we need to add the Add Products from Shipment and Cancel buttons to the footer row.</span></span> <span data-ttu-id="41cbf-225">Перетащите два элемента управления "Кнопка" из области элементов в нижний колонтитул интерфейса вставки, установив кнопки `ID` свойства для `AddProducts` и `CancelButton` и `Text` свойства, чтобы добавить продукты из отгрузки и отмены соответственно.</span><span class="sxs-lookup"><span data-stu-id="41cbf-225">Drag two Button controls from the Toolbox into the footer of the inserting interface, setting the Buttons `ID` properties to `AddProducts` and `CancelButton` and `Text` properties to Add Products from Shipment and Cancel, respectively.</span></span> <span data-ttu-id="41cbf-226">Кроме того, задайте для свойства `CausesValidation` `CancelButton` управления значение `false`.</span><span class="sxs-lookup"><span data-stu-id="41cbf-226">In addition, set the `CancelButton` control s `CausesValidation` property to `false`.</span></span>

<span data-ttu-id="41cbf-227">Наконец, необходимо добавить веб-элемент управления Label, который будет отображать сообщения о состоянии для двух интерфейсов.</span><span class="sxs-lookup"><span data-stu-id="41cbf-227">Finally, we need to add a Label Web control that will display status messages for the two interfaces.</span></span> <span data-ttu-id="41cbf-228">Например, когда пользователь успешно добавляет новую отгрузку продуктов, мы хотим вернуться к интерфейсу отображения и отобразить сообщение с подтверждением.</span><span class="sxs-lookup"><span data-stu-id="41cbf-228">For example, when a user successfully adds a new shipment of products, we want to return to the display interface and display a confirmation message.</span></span> <span data-ttu-id="41cbf-229">Тем не менее, если пользователь предоставляет цену на новый продукт, но не содержит название продукта, необходимо отобразить предупреждение, так как поле `ProductName` является обязательным.</span><span class="sxs-lookup"><span data-stu-id="41cbf-229">If, however, the user provides a price for a new product but leaves off the product name, we need to display a warning message since the `ProductName` field is required.</span></span> <span data-ttu-id="41cbf-230">Так как это сообщение необходимо отобразить для обоих интерфейсов, поместите его в верхнюю часть страницы за пределами панелей.</span><span class="sxs-lookup"><span data-stu-id="41cbf-230">Since we need this message to display for both interfaces, place it at the top of the page outside of the Panels.</span></span>

<span data-ttu-id="41cbf-231">Перетащите элемент Web Control Label с панели элементов в верхнюю часть страницы в конструкторе.</span><span class="sxs-lookup"><span data-stu-id="41cbf-231">Drag a Label Web control from the Toolbox to the top of the page in the Designer.</span></span> <span data-ttu-id="41cbf-232">Задайте для свойства `ID` значение `StatusLabel`, очистите свойство `Text` и задайте для свойств `Visible` и `EnableViewState` значение `False`.</span><span class="sxs-lookup"><span data-stu-id="41cbf-232">Set the `ID` property to `StatusLabel`, clear out the `Text` property, and set the `Visible` and `EnableViewState` properties to `False`.</span></span> <span data-ttu-id="41cbf-233">Как мы видели в предыдущих учебных курсах, установка свойства `EnableViewState` в `False` позволяет программно изменять значения свойств метки s и автоматически возвратиться к параметрам по умолчанию при последующей обратной передаче.</span><span class="sxs-lookup"><span data-stu-id="41cbf-233">As we have seen in previous tutorials, setting the `EnableViewState` property to `False` allows us to programmatically change the Label s property values and have them automatically revert back to their defaults on the subsequent postback.</span></span> <span data-ttu-id="41cbf-234">Это упрощает код для отображения сообщения о состоянии в ответ на некоторое действие пользователя, которое исчезает при последующей обратной передаче.</span><span class="sxs-lookup"><span data-stu-id="41cbf-234">This simplifies the code for showing a status message in response to some user action that disappears on the subsequent postback.</span></span> <span data-ttu-id="41cbf-235">Наконец, задайте для свойства `CssClass` `StatusLabel` управления значение Warning, которое представляет собой имя класса CSS, определенного в `Styles.css`, который отображает текст крупным курсивом, полужирным шрифтом красного цвета.</span><span class="sxs-lookup"><span data-stu-id="41cbf-235">Finally, set the `StatusLabel` control s `CssClass` property to Warning, which is the name of a CSS class defined in `Styles.css` that displays text in a large, italic, bold, red font.</span></span>

<span data-ttu-id="41cbf-236">На рис. 11 показан конструктор Visual Studio после добавления и настройки метки.</span><span class="sxs-lookup"><span data-stu-id="41cbf-236">Figure 11 shows the Visual Studio Designer after the Label has been added and configured.</span></span>

<span data-ttu-id="41cbf-237">[![поместить элемент управления значение statuslabel как над двумя элементами управления Panel](batch-inserting-vb/_static/image32.png)](batch-inserting-vb/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="41cbf-237">[![Place the StatusLabel Control Above the Two Panel Controls](batch-inserting-vb/_static/image32.png)](batch-inserting-vb/_static/image31.png)</span></span>

<span data-ttu-id="41cbf-238">**Рис. 11**. размещение элемента управления `StatusLabel` над двумя элементами управления Panel ([щелкните, чтобы просмотреть изображение с полным размером](batch-inserting-vb/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="41cbf-238">**Figure 11**: Place the `StatusLabel` Control Above the Two Panel Controls ([Click to view full-size image](batch-inserting-vb/_static/image33.png))</span></span>

## <a name="step-3-switching-between-the-display-and-inserting-interfaces"></a><span data-ttu-id="41cbf-239">Шаг 3. Переключение между интерфейсами дисплея и вставки</span><span class="sxs-lookup"><span data-stu-id="41cbf-239">Step 3: Switching Between the Display and Inserting Interfaces</span></span>

<span data-ttu-id="41cbf-240">На этом этапе мы завершили разметку для наших интерфейсов вывода и вставки, но по-прежнему осталось выполнить две задачи:</span><span class="sxs-lookup"><span data-stu-id="41cbf-240">At this point we have completed the markup for our display and inserting interfaces, but we re still left with two tasks:</span></span>

- <span data-ttu-id="41cbf-241">Переключение между интерфейсами дисплея и вставки</span><span class="sxs-lookup"><span data-stu-id="41cbf-241">Switching between the display and inserting interfaces</span></span>
- <span data-ttu-id="41cbf-242">Добавление продуктов в отгрузку в базу данных</span><span class="sxs-lookup"><span data-stu-id="41cbf-242">Adding the products in the shipment to the database</span></span>

<span data-ttu-id="41cbf-243">В настоящее время интерфейс отображения является видимым, но интерфейс вставки скрыт.</span><span class="sxs-lookup"><span data-stu-id="41cbf-243">Currently, the display interface is visible but the inserting interface is hidden.</span></span> <span data-ttu-id="41cbf-244">Это связано с тем, что свойство `Visible` панели `DisplayInterface` имеет значение `True` (значение по умолчанию), а свойство Panel `InsertingInterface` `Visible` имеет значение `False`.</span><span class="sxs-lookup"><span data-stu-id="41cbf-244">This is because the `DisplayInterface` Panel s `Visible` property is set to `True` (the default value), while the `InsertingInterface` Panel s `Visible` property is set to `False`.</span></span> <span data-ttu-id="41cbf-245">Для переключения между двумя интерфейсами необходимо просто переключить каждый элемент управления `Visible` значение свойства.</span><span class="sxs-lookup"><span data-stu-id="41cbf-245">To switch between the two interfaces we simply need to toggle each control s `Visible` property value.</span></span>

<span data-ttu-id="41cbf-246">Мы хотим перейти от интерфейса к интерфейсу вставки при нажатии кнопки обработать отгрузку продукта.</span><span class="sxs-lookup"><span data-stu-id="41cbf-246">We want to move from the display interface to the inserting interface when the Process Product Shipment button is clicked.</span></span> <span data-ttu-id="41cbf-247">Поэтому создайте обработчик событий для этой кнопки `Click` событие, которое содержит следующий код:</span><span class="sxs-lookup"><span data-stu-id="41cbf-247">Therefore, create an event handler for this Button s `Click` event that contains the following code:</span></span>

[!code-vb[Main](batch-inserting-vb/samples/sample4.vb)]

<span data-ttu-id="41cbf-248">Этот код просто скрывает панель `DisplayInterface` и отображает панель `InsertingInterface`.</span><span class="sxs-lookup"><span data-stu-id="41cbf-248">This code simply hides the `DisplayInterface` Panel and shows the `InsertingInterface` Panel.</span></span>

<span data-ttu-id="41cbf-249">Затем создайте обработчики событий для элементов управления "добавить продукты из отгрузки" и "Отмена" в интерфейсе вставки.</span><span class="sxs-lookup"><span data-stu-id="41cbf-249">Next, create event handlers for the Add Products from Shipment and Cancel Button controls in the inserting interface.</span></span> <span data-ttu-id="41cbf-250">При нажатии любой из этих кнопок необходимо вернуться к интерфейсу интерфейса дисплея.</span><span class="sxs-lookup"><span data-stu-id="41cbf-250">When either of these Buttons is clicked, we need to revert back to the display interface.</span></span> <span data-ttu-id="41cbf-251">Создайте `Click` обработчики событий для обоих элементов управления "Кнопка", чтобы они вызывали `ReturnToDisplayInterface`, метод, который мы будем добавлять мгновенно.</span><span class="sxs-lookup"><span data-stu-id="41cbf-251">Create `Click` event handlers for both Button controls so that they call `ReturnToDisplayInterface`, a method we will add momentarily.</span></span> <span data-ttu-id="41cbf-252">Помимо скрытия панели `InsertingInterface` и отображения панели `DisplayInterface`, метод `ReturnToDisplayInterface` должен вернуть веб-элементы управления в состояние предварительного редактирования.</span><span class="sxs-lookup"><span data-stu-id="41cbf-252">In addition to hiding the `InsertingInterface` Panel and showing the `DisplayInterface` Panel, the `ReturnToDisplayInterface` method needs to return the Web controls to their pre-editing state.</span></span> <span data-ttu-id="41cbf-253">Для этого необходимо задать для свойств элементов управления DropDownList `SelectedIndex` значение 0 и очистить свойства `Text` элементов управления TextBox.</span><span class="sxs-lookup"><span data-stu-id="41cbf-253">This involves setting the DropDownLists `SelectedIndex` properties to 0 and clearing out the `Text` properties of the TextBox controls.</span></span>

> [!NOTE]
> <span data-ttu-id="41cbf-254">Рассмотрим, что может произойти, если мы не возвращали элементы управления в состояние предварительного редактирования перед возвратом в интерфейс отображения.</span><span class="sxs-lookup"><span data-stu-id="41cbf-254">Consider what might happen if we didn't return the controls to their pre-editing state before returning to the display interface.</span></span> <span data-ttu-id="41cbf-255">Пользователь может нажать кнопку обработать отгрузку продукта, ввести продукты из отгрузки, а затем щелкнуть Добавить продукты из отгрузки.</span><span class="sxs-lookup"><span data-stu-id="41cbf-255">A user might click the Process Product Shipment button, enter the products from the shipment, and then click Add Products from Shipment.</span></span> <span data-ttu-id="41cbf-256">Это приведет к добавлению продуктов и возврату пользователя интерфейсу отображения.</span><span class="sxs-lookup"><span data-stu-id="41cbf-256">This would add the products and return the user to the display interface.</span></span> <span data-ttu-id="41cbf-257">На этом этапе пользователю может потребоваться добавить еще одну отгрузку.</span><span class="sxs-lookup"><span data-stu-id="41cbf-257">At this point the user might want to add another shipment.</span></span> <span data-ttu-id="41cbf-258">При нажатии кнопки обработать отгрузку продукта они возвращались к интерфейсу вставки, но значения выбора DropDownList и текстового поля по-прежнему будут заполнены предыдущими значениями.</span><span class="sxs-lookup"><span data-stu-id="41cbf-258">Upon clicking the Process Product Shipment button they would return to the inserting interface but the DropDownList selections and TextBox values would still be populated with their previous values.</span></span>

[!code-vb[Main](batch-inserting-vb/samples/sample5.vb)]

<span data-ttu-id="41cbf-259">Оба `Click` обработчики событий просто вызывают метод `ReturnToDisplayInterface`, хотя мы вернемся к обработчику событий Add Products from поставка `Click` на шаге 4 и добавим код для сохранения продуктов.</span><span class="sxs-lookup"><span data-stu-id="41cbf-259">Both `Click` event handlers simply call the `ReturnToDisplayInterface` method, although we'll return to the Add Products from Shipment `Click` event handler in Step 4 and add code to save the products.</span></span> <span data-ttu-id="41cbf-260">`ReturnToDisplayInterface` начинается с возврата `Suppliers` и `Categories` элементов управления DropDownList к их первым параметрам.</span><span class="sxs-lookup"><span data-stu-id="41cbf-260">`ReturnToDisplayInterface` starts by returning the `Suppliers` and `Categories` DropDownLists to their first options.</span></span> <span data-ttu-id="41cbf-261">Две константы `firstControlID` и `lastControlID` помечают начальные и конечные значения индекса управления, используемые при именовании текстовых полей Имя продукта и цена единицы в интерфейсе вставки и используемые в границах цикла `For`, который устанавливает свойства `Text` элементов управления TextBox обратно в пустую строку.</span><span class="sxs-lookup"><span data-stu-id="41cbf-261">The two constants `firstControlID` and `lastControlID` mark the starting and ending control index values used in naming the product name and unit price TextBoxes in the inserting interface and are used in the bounds of the `For` loop that sets the `Text` properties of the TextBox controls back to an empty string.</span></span> <span data-ttu-id="41cbf-262">Наконец, `Visible` свойства панели сбрасываются, чтобы интерфейс вставки был скрыт и отображался интерфейс отображения.</span><span class="sxs-lookup"><span data-stu-id="41cbf-262">Finally, the Panels `Visible` properties are reset so that the inserting interface is hidden and the display interface shown.</span></span>

<span data-ttu-id="41cbf-263">Уделите время для проверки этой страницы в браузере.</span><span class="sxs-lookup"><span data-stu-id="41cbf-263">Take a moment to test out this page in a browser.</span></span> <span data-ttu-id="41cbf-264">При первом посещении страницы должен отобразиться интерфейс отображения, как показано на рис. 5.</span><span class="sxs-lookup"><span data-stu-id="41cbf-264">When first visiting the page you should see the display interface as was shown in Figure 5.</span></span> <span data-ttu-id="41cbf-265">Нажмите кнопку обработать отгрузку продукта.</span><span class="sxs-lookup"><span data-stu-id="41cbf-265">Click the Process Product Shipment button.</span></span> <span data-ttu-id="41cbf-266">Страница выполнит обратную передачу, и теперь вы увидите интерфейс вставки, как показано на рис. 12.</span><span class="sxs-lookup"><span data-stu-id="41cbf-266">The page will postback and you should now see the inserting interface as shown in Figure 12.</span></span> <span data-ttu-id="41cbf-267">Нажатие кнопки Добавить продукты из отгрузки или отмена возвращает вас в интерфейс дисплея.</span><span class="sxs-lookup"><span data-stu-id="41cbf-267">Clicking either the Add Products from Shipment or Cancel buttons returns you to the display interface.</span></span>

> [!NOTE]
> <span data-ttu-id="41cbf-268">При просмотре интерфейса вставки необходимо протестировать Компаревалидаторс в текстовых полях цены единицы.</span><span class="sxs-lookup"><span data-stu-id="41cbf-268">While viewing the inserting interface, take a moment to test out the CompareValidators on the unit price TextBoxes.</span></span> <span data-ttu-id="41cbf-269">При нажатии кнопки Add Products from поставка с недопустимыми значениями денежной единицы или ценой со значением меньше нуля, отображается предупреждение MessageBox на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="41cbf-269">You should see a client-side messagebox warning when clicking the Add Products from Shipment button with invalid currency values or prices with a value less than zero.</span></span>

<span data-ttu-id="41cbf-270">[![интерфейс вставки отображается после нажатия кнопки обработать отгрузку продукта.](batch-inserting-vb/_static/image35.png)](batch-inserting-vb/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="41cbf-270">[![The Inserting Interface is Displayed After Clicking the Process Product Shipment Button](batch-inserting-vb/_static/image35.png)](batch-inserting-vb/_static/image34.png)</span></span>

<span data-ttu-id="41cbf-271">**Рис. 12**. интерфейс вставки отображается после нажатия кнопки обработать отгрузку продукта ([щелкните, чтобы просмотреть изображение с полным размером](batch-inserting-vb/_static/image36.png)).</span><span class="sxs-lookup"><span data-stu-id="41cbf-271">**Figure 12**: The Inserting Interface is Displayed After Clicking the Process Product Shipment Button ([Click to view full-size image](batch-inserting-vb/_static/image36.png))</span></span>

## <a name="step-4-adding-the-products"></a><span data-ttu-id="41cbf-272">Шаг 4. Добавление продуктов</span><span class="sxs-lookup"><span data-stu-id="41cbf-272">Step 4: Adding the Products</span></span>

<span data-ttu-id="41cbf-273">Все, что осталось для работы с этим руководством, — сохранить продукты в базе данных на кнопке Add Products from поставка `Click` обработчике событий.</span><span class="sxs-lookup"><span data-stu-id="41cbf-273">All that remains for this tutorial is to save the products to the database in the Add Products from Shipment Button s `Click` event handler.</span></span> <span data-ttu-id="41cbf-274">Это можно сделать, создав `ProductsDataTable` и добавив `ProductsRow` экземпляр для каждого из предоставленных названий продуктов.</span><span class="sxs-lookup"><span data-stu-id="41cbf-274">This can be accomplished by creating a `ProductsDataTable` and adding a `ProductsRow` instance for each of the product names supplied.</span></span> <span data-ttu-id="41cbf-275">После добавления этих `ProductsRow`ов мы создадим метод `ProductsBLL` класса s `UpdateWithTransaction` метода, передавая `ProductsDataTable`.</span><span class="sxs-lookup"><span data-stu-id="41cbf-275">Once these `ProductsRow` s have been added we will make a call to the `ProductsBLL` class s `UpdateWithTransaction` method passing in the `ProductsDataTable`.</span></span> <span data-ttu-id="41cbf-276">Помните, что метод `UpdateWithTransaction`, который был создан в процессе [переноса изменений базы данных в рамках руководства по транзакциям](wrapping-database-modifications-within-a-transaction-vb.md) , передает `ProductsDataTable` методу `ProductsTableAdapter``UpdateWithTransaction`.</span><span class="sxs-lookup"><span data-stu-id="41cbf-276">Recall that the `UpdateWithTransaction` method, which was created back in the [Wrapping Database Modifications within a Transaction](wrapping-database-modifications-within-a-transaction-vb.md) tutorial, passes the `ProductsDataTable` to the `ProductsTableAdapter`'s `UpdateWithTransaction` method.</span></span> <span data-ttu-id="41cbf-277">После этого запускается транзакция ADO.NET, и адаптер TableAdapter выдает в базу данных инструкцию `INSERT` для каждого добавленного `ProductsRow` в DataTable.</span><span class="sxs-lookup"><span data-stu-id="41cbf-277">From there, an ADO.NET transaction is started and the TableAdapter issues an `INSERT` statement to the database for each added `ProductsRow` in the DataTable.</span></span> <span data-ttu-id="41cbf-278">При условии, что все продукты добавляются без ошибок, транзакция фиксируется, в противном случае выполняется ее откат.</span><span class="sxs-lookup"><span data-stu-id="41cbf-278">Assuming all products are added without error, the transaction is committed, otherwise it is rolled back.</span></span>

<span data-ttu-id="41cbf-279">Код для кнопки Add Products from поставка `Click` обработчику событий также должен выполнить несколько проверок ошибок.</span><span class="sxs-lookup"><span data-stu-id="41cbf-279">The code for the Add Products from Shipment Button s `Click` event handler also needs to perform a bit of error checking.</span></span> <span data-ttu-id="41cbf-280">Так как в интерфейсе вставки не используется Рекуиредфиелдвалидаторс, пользователь может ввести цену на продукт, не пропуская его имя.</span><span class="sxs-lookup"><span data-stu-id="41cbf-280">Since there are no RequiredFieldValidators used in the inserting interface, a user could enter a price for a product while omitting its name.</span></span> <span data-ttu-id="41cbf-281">Поскольку имя продукта является обязательным, если такое условие отменяется, необходимо предупредить пользователя и не продолжить вставку.</span><span class="sxs-lookup"><span data-stu-id="41cbf-281">Since the product s name is required, if such a condition unfolds we need to alert the user and not proceed with the inserts.</span></span> <span data-ttu-id="41cbf-282">Полный `Click` код обработчика событий выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="41cbf-282">The complete `Click` event handler code follows:</span></span>

[!code-vb[Main](batch-inserting-vb/samples/sample6.vb)]

<span data-ttu-id="41cbf-283">Обработчик событий начинает работу, гарантируя, что свойство `Page.IsValid` возвращает значение `True`.</span><span class="sxs-lookup"><span data-stu-id="41cbf-283">The event handler starts by ensuring that the `Page.IsValid` property returns a value of `True`.</span></span> <span data-ttu-id="41cbf-284">Если он возвращает `False`, то это означает, что один или несколько Компаревалидаторс сообщают о недопустимых данных. в этом случае мы не хотим попытаться вставить введенные продукты, или мы получаем исключение при попытке присвоить введенное пользователем значение цены единицы свойству `ProductsRow` s `UnitPrice`.</span><span class="sxs-lookup"><span data-stu-id="41cbf-284">If it returns `False`, then that means one or more of the CompareValidators are reporting invalid data; in such a case we do not want to attempt to insert the entered products or we'll end up with an exception when attempting to assign the user-entered unit price value to the `ProductsRow` s `UnitPrice` property.</span></span>

<span data-ttu-id="41cbf-285">Затем создается новый экземпляр `ProductsDataTable` (`products`).</span><span class="sxs-lookup"><span data-stu-id="41cbf-285">Next, a new `ProductsDataTable` instance is created (`products`).</span></span> <span data-ttu-id="41cbf-286">Цикл `For` используется для итерации текстовых полей Product Name и Price Unit, а свойства `Text` считываются в локальные переменные `productName` и `unitPrice`.</span><span class="sxs-lookup"><span data-stu-id="41cbf-286">A `For` loop is used to iterate through the product name and unit price TextBoxes and the `Text` properties are read into the local variables `productName` and `unitPrice`.</span></span> <span data-ttu-id="41cbf-287">Если пользователь вводит значение для цены за единицу, но не для соответствующего названия продукта, `StatusLabel` отображает сообщение, если вы указали цену за единицу, необходимо также включить имя продукта и обработчик событий.</span><span class="sxs-lookup"><span data-stu-id="41cbf-287">If the user has entered a value for the unit price but not for the corresponding product name, the `StatusLabel` displays the message If you provide a unit price you must also include the name of the product and the event handler is exited.</span></span>

<span data-ttu-id="41cbf-288">Если указано имя продукта, создается новый экземпляр `ProductsRow` с помощью метода `ProductsDataTable` s `NewProductsRow`.</span><span class="sxs-lookup"><span data-stu-id="41cbf-288">If a product name has been provided, a new `ProductsRow` instance is created using the `ProductsDataTable` s `NewProductsRow` method.</span></span> <span data-ttu-id="41cbf-289">В этом новом `ProductsRow` экземпляра `ProductName` свойству присваивается имя текущего продукта, а свойства `SupplierID` и `CategoryID` присваиваются свойствам `SelectedValue` элементов управления DropDownList в заголовке Interface s.</span><span class="sxs-lookup"><span data-stu-id="41cbf-289">This new `ProductsRow` instance s `ProductName` property is set to the current product name TextBox while the `SupplierID` and `CategoryID` properties are assigned to the `SelectedValue` properties of the DropDownLists in the inserting interface s header.</span></span> <span data-ttu-id="41cbf-290">Если пользователь указал значение цены продукта, он назначается свойству `ProductsRow` instance s `UnitPrice`. в противном случае свойство остается неназначенным, что приведет к появлению `NULL` значения для `UnitPrice` в базе данных.</span><span class="sxs-lookup"><span data-stu-id="41cbf-290">If the user entered a value for the product s price, it is assigned to the `ProductsRow` instance s `UnitPrice` property; otherwise, the property is left unassigned, which will result in a `NULL` value for `UnitPrice` in the database.</span></span> <span data-ttu-id="41cbf-291">Наконец, свойства `Discontinued` и `UnitsOnOrder` присваиваются жестко закодированным значениям `False` и 0 соответственно.</span><span class="sxs-lookup"><span data-stu-id="41cbf-291">Finally, the `Discontinued` and `UnitsOnOrder` properties are assigned to the hard-coded values `False` and 0, respectively.</span></span>

<span data-ttu-id="41cbf-292">После назначения свойств экземпляру `ProductsRow` он добавляется в `ProductsDataTable`.</span><span class="sxs-lookup"><span data-stu-id="41cbf-292">After the properties have been assigned to the `ProductsRow` instance it is added to the `ProductsDataTable`.</span></span>

<span data-ttu-id="41cbf-293">По завершении цикла `For` мы проверяем, были ли добавлены какие либо продукты.</span><span class="sxs-lookup"><span data-stu-id="41cbf-293">At the completion of the `For` loop, we check whether any products have been added.</span></span> <span data-ttu-id="41cbf-294">Пользователь, в конце концов, щелкнул Добавление продуктов из отгрузки перед вводом названий продуктов или цен.</span><span class="sxs-lookup"><span data-stu-id="41cbf-294">The user may, after all, have clicked the Add Products from Shipment before entering any product names or prices.</span></span> <span data-ttu-id="41cbf-295">Если в `ProductsDataTable`есть хотя бы один продукт, вызывается метод `ProductsBLL` класса s `UpdateWithTransaction`.</span><span class="sxs-lookup"><span data-stu-id="41cbf-295">If there is at least one product in the `ProductsDataTable`, the `ProductsBLL` class s `UpdateWithTransaction` method is called.</span></span> <span data-ttu-id="41cbf-296">Затем данные повторно привязываются к `ProductsGrid` GridView, чтобы новые добавленные продукты отображались в интерфейсе отображения.</span><span class="sxs-lookup"><span data-stu-id="41cbf-296">Next, the data is rebound to the `ProductsGrid` GridView so that the newly added products will appear in the display interface.</span></span> <span data-ttu-id="41cbf-297">`StatusLabel` обновляется для отображения сообщения с подтверждением и вызова `ReturnToDisplayInterface`, скрытия интерфейса вставки и отображения интерфейса дисплея.</span><span class="sxs-lookup"><span data-stu-id="41cbf-297">The `StatusLabel` is updated to display a confirmation message and the `ReturnToDisplayInterface` is invoked, hiding the inserting interface and showing the display interface.</span></span>

<span data-ttu-id="41cbf-298">Если продукты не были введены, интерфейс вставки остается отображенным, но сообщение не было добавлено.</span><span class="sxs-lookup"><span data-stu-id="41cbf-298">If no products were entered, the inserting interface remains displayed but the message No products were added.</span></span> <span data-ttu-id="41cbf-299">Введите названия продуктов и цены единиц в текстовые поля.</span><span class="sxs-lookup"><span data-stu-id="41cbf-299">Please enter the product names and unit prices in the textboxes is displayed.</span></span>

<span data-ttu-id="41cbf-300">На рис. 13, 14 и 15 показаны интерфейсы вставки и отображения в действии.</span><span class="sxs-lookup"><span data-stu-id="41cbf-300">Figure s 13, 14, and 15 show the inserting and display interfaces in action.</span></span> <span data-ttu-id="41cbf-301">На рис. 13 пользователь указал значение цены единицы без соответствующего названия продукта.</span><span class="sxs-lookup"><span data-stu-id="41cbf-301">In Figure 13, the user has entered a unit price value without a corresponding product name.</span></span> <span data-ttu-id="41cbf-302">На рис. 14 показан интерфейс отображения после успешного добавления трех новых продуктов, на рис. 15 показаны два недавно добавленных продукта в GridView (третья — на предыдущей странице).</span><span class="sxs-lookup"><span data-stu-id="41cbf-302">Figure 14 shows the display interface after three new products have been added successfully, while Figure 15 shows two of the newly added products in the GridView (the third one is on the previous page).</span></span>

<span data-ttu-id="41cbf-303">[![имя продукта является обязательным при вводе цены за единицу](batch-inserting-vb/_static/image38.png)](batch-inserting-vb/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="41cbf-303">[![A Product Name is Required When Entering a Unit Price](batch-inserting-vb/_static/image38.png)](batch-inserting-vb/_static/image37.png)</span></span>

<span data-ttu-id="41cbf-304">**Рис. 13**. имя продукта требуется при вводе цены за единицу ([щелкните, чтобы просмотреть изображение с полным размером](batch-inserting-vb/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="41cbf-304">**Figure 13**: A Product Name is Required When Entering a Unit Price ([Click to view full-size image](batch-inserting-vb/_static/image39.png))</span></span>

<span data-ttu-id="41cbf-305">[![добавлены три новых Веггиес для поставщика Mayumi's s](batch-inserting-vb/_static/image41.png)](batch-inserting-vb/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="41cbf-305">[![Three New Veggies Have Been Added for the Supplier Mayumi s](batch-inserting-vb/_static/image41.png)](batch-inserting-vb/_static/image40.png)</span></span>

<span data-ttu-id="41cbf-306">**Рис. 14**. добавлены три новых Веггиес для поставщика mayumi's s ([щелкните, чтобы просмотреть изображение с полным размером](batch-inserting-vb/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="41cbf-306">**Figure 14**: Three New Veggies Have Been Added for the Supplier Mayumi s ([Click to view full-size image](batch-inserting-vb/_static/image42.png))</span></span>

<span data-ttu-id="41cbf-307">[![новые продукты можно найти на последней странице GridView.](batch-inserting-vb/_static/image44.png)](batch-inserting-vb/_static/image43.png)</span><span class="sxs-lookup"><span data-stu-id="41cbf-307">[![The New Products Can Be Found in the Last Page of the GridView](batch-inserting-vb/_static/image44.png)](batch-inserting-vb/_static/image43.png)</span></span>

<span data-ttu-id="41cbf-308">**Рис. 15**. новые продукты можно найти на последней странице GridView ([щелкните, чтобы просмотреть изображение с полным размером](batch-inserting-vb/_static/image45.png)).</span><span class="sxs-lookup"><span data-stu-id="41cbf-308">**Figure 15**: The New Products Can Be Found in the Last Page of the GridView ([Click to view full-size image](batch-inserting-vb/_static/image45.png))</span></span>

> [!NOTE]
> <span data-ttu-id="41cbf-309">Логика вставки пакетной службы, используемая в этом руководстве, заключает операции вставки в область транзакции.</span><span class="sxs-lookup"><span data-stu-id="41cbf-309">The batch inserting logic used in this tutorial wraps the inserts within the scope of transaction.</span></span> <span data-ttu-id="41cbf-310">Чтобы проверить это, намеренно ввести ошибку уровня базы данных.</span><span class="sxs-lookup"><span data-stu-id="41cbf-310">To verify this, purposefully introduce a database-level error.</span></span> <span data-ttu-id="41cbf-311">Например, вместо присвоения новому свойству `ProductsRow` экземпляра `CategoryID` выбранному значению в DropDownList `Categories` присвойте ему значение, например `i * 5`.</span><span class="sxs-lookup"><span data-stu-id="41cbf-311">For example, rather than assigning the new `ProductsRow` instance s `CategoryID` property to the selected value in the `Categories` DropDownList, assign it to a value like `i * 5`.</span></span> <span data-ttu-id="41cbf-312">Здесь `i` является индексатором цикла и имеет значения от 1 до 5.</span><span class="sxs-lookup"><span data-stu-id="41cbf-312">Here `i` is the loop indexer and has values ranging from 1 to 5.</span></span> <span data-ttu-id="41cbf-313">Поэтому при добавлении двух или более продуктов в пакетной вставке первый продукт будет иметь допустимое `CategoryID` значение (5), но последующие продукты будут иметь `CategoryID` значения, не соответствующие `CategoryID` значениям в таблице `Categories`.</span><span class="sxs-lookup"><span data-stu-id="41cbf-313">Therefore, when adding two or more products in batch insert the first product will have a valid `CategoryID` value (5), but subsequent products will have `CategoryID` values that do not match up to `CategoryID` values in the `Categories` table.</span></span> <span data-ttu-id="41cbf-314">В итоге, в то время как первый `INSERT` будет успешным, последующие произойдет сбой с нарушением ограничения внешнего ключа.</span><span class="sxs-lookup"><span data-stu-id="41cbf-314">The net effect is that while the first `INSERT` will succeed, subsequent ones will fail with a foreign key constraint violation.</span></span> <span data-ttu-id="41cbf-315">Поскольку Пакетная вставка является атомарной, выполняется откат первой `INSERT` и возвращение базы данных в ее состояние до начала процесса вставки пакета.</span><span class="sxs-lookup"><span data-stu-id="41cbf-315">Since the batch insert is atomic, the first `INSERT` will be rolled back, returning the database to its state before the batch insert process began.</span></span>

## <a name="summary"></a><span data-ttu-id="41cbf-316">Сводка</span><span class="sxs-lookup"><span data-stu-id="41cbf-316">Summary</span></span>

<span data-ttu-id="41cbf-317">В этом и предыдущих двух учебных курсах мы создали интерфейсы, которые позволяют обновлять, удалять и вставлять пакеты данных, каждая из которых использовала поддержку транзакций, добавленную к слою доступа к данным в рамках руководства по [транзакциям изменения базы данных](wrapping-database-modifications-within-a-transaction-vb.md) .</span><span class="sxs-lookup"><span data-stu-id="41cbf-317">Over this and the previous two tutorials we have created interfaces that allow for updating, deleting, and inserting batches of data, all of which used the transaction support we added to the Data Access Layer in the [Wrapping Database Modifications within a Transaction](wrapping-database-modifications-within-a-transaction-vb.md) tutorial.</span></span> <span data-ttu-id="41cbf-318">В некоторых случаях такие пользовательские интерфейсы пакетной обработки значительно улучшают эффективность работы конечных пользователей, выполняя количество щелчков, обратных передач и переключения контекста мыши, а также сохраняя целостность базовых данных.</span><span class="sxs-lookup"><span data-stu-id="41cbf-318">For certain scenarios, such batch processing user interfaces greatly improve end user efficiency by cutting down on the number of clicks, postbacks, and keyboard-to-mouse context switches, while also maintaining the integrity of the underlying data.</span></span>

<span data-ttu-id="41cbf-319">В этом руководстве мы рассмотрим работу с пакетными данными.</span><span class="sxs-lookup"><span data-stu-id="41cbf-319">This tutorial completes our look at working with batched data.</span></span> <span data-ttu-id="41cbf-320">В следующем наборе руководств рассматриваются разнообразные сценарии расширенного доступа к данным, в том числе использование хранимых процедур в методах TableAdapter, Настройка параметров соединения и уровня команд в DAL, шифрование строк подключения и многое другое.</span><span class="sxs-lookup"><span data-stu-id="41cbf-320">The next set of tutorials explores a variety of advanced Data Access Layer scenarios, including using stored procedures in the TableAdapter s methods, configuring connection- and command-level settings in the DAL, encrypting connection strings, and more!</span></span>

<span data-ttu-id="41cbf-321">Поздравляем с программированием!</span><span class="sxs-lookup"><span data-stu-id="41cbf-321">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="41cbf-322">Об авторе</span><span class="sxs-lookup"><span data-stu-id="41cbf-322">About the Author</span></span>

<span data-ttu-id="41cbf-323">[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи книг по ASP/ASP. NET и основатель [4GuysFromRolla.com](http://www.4guysfromrolla.com), работал с веб-технологиями Майкрософт с 1998.</span><span class="sxs-lookup"><span data-stu-id="41cbf-323">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="41cbf-324">Скотт работает как независимый консультант, преподаватель и модуль записи.</span><span class="sxs-lookup"><span data-stu-id="41cbf-324">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="41cbf-325">Его последняя книга — [*Sams обучать себя ASP.NET 2,0 за 24 часа*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="41cbf-325">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="41cbf-326">Он доступен по адресу [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="41cbf-326">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="41cbf-327">или через его блог, который можно найти по адресу [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="41cbf-327">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="41cbf-328">Специальная благодарность</span><span class="sxs-lookup"><span data-stu-id="41cbf-328">Special Thanks To</span></span>

<span data-ttu-id="41cbf-329">Эта серия руководств была рассмотрена многими полезными рецензентами.</span><span class="sxs-lookup"><span data-stu-id="41cbf-329">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="41cbf-330">Ведущими рецензентами для этого учебника были Хилтон Гизнау и S REN Джейкоб Лауритсен.</span><span class="sxs-lookup"><span data-stu-id="41cbf-330">Lead reviewers for this tutorial were Hilton Giesenow and S ren Jacob Lauritsen.</span></span> <span data-ttu-id="41cbf-331">Хотите ознакомиться с моими будущими статьями MSDN?</span><span class="sxs-lookup"><span data-stu-id="41cbf-331">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="41cbf-332">Если это так, расположите строку в [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="41cbf-332">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="41cbf-333">Назад</span><span class="sxs-lookup"><span data-stu-id="41cbf-333">Previous</span></span>](batch-deleting-vb.md)
