---
uid: web-forms/overview/data-access/working-with-batched-data/batch-inserting-cs
title: Пакет, вставка (C#) | Документация Майкрософт
author: rick-anderson
description: Узнайте, как вставить несколько записей в базе данных в рамках одной операции. В слой пользовательского интерфейса мы расширим GridView, чтобы разрешить пользователю вводить несколько n...
ms.author: riande
ms.date: 06/26/2007
ms.assetid: cf025e08-48fc-4385-b176-8610aa7b5565
msc.legacyurl: /web-forms/overview/data-access/working-with-batched-data/batch-inserting-cs
msc.type: authoredcontent
ms.openlocfilehash: 561acc9b473bac7d39e7ed4d511d8b979657131d
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/01/2019
ms.locfileid: "57035751"
---
<a name="batch-inserting-c"></a><span data-ttu-id="cc202-104">Пакетная вставка (C#)</span><span class="sxs-lookup"><span data-stu-id="cc202-104">Batch Inserting (C#)</span></span>
====================
<span data-ttu-id="cc202-105">по [Скотт Митчелл](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="cc202-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="cc202-106">[Скачать код](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_66_CS.zip) или [скачать PDF](batch-inserting-cs/_static/datatutorial66cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="cc202-106">[Download Code](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_66_CS.zip) or [Download PDF](batch-inserting-cs/_static/datatutorial66cs1.pdf)</span></span>

> <span data-ttu-id="cc202-107">Узнайте, как вставить несколько записей в базе данных в рамках одной операции.</span><span class="sxs-lookup"><span data-stu-id="cc202-107">Learn how to insert multiple database records in a single operation.</span></span> <span data-ttu-id="cc202-108">В слой пользовательского интерфейса мы расширим GridView, чтобы разрешить пользователю вводить несколько новых записей.</span><span class="sxs-lookup"><span data-stu-id="cc202-108">In the User Interface Layer we extend the GridView to allow the user to enter multiple new records.</span></span> <span data-ttu-id="cc202-109">В уровень доступа к данным мы Подведем краткие несколько операций вставки в рамках транзакции, чтобы убедиться, что успешного выполнения всех операций вставки, или выполнен откат всех операций вставки.</span><span class="sxs-lookup"><span data-stu-id="cc202-109">In the Data Access Layer we wrap the multiple Insert operations within a transaction to ensure that all insertions succeed or all insertions are rolled back.</span></span>


## <a name="introduction"></a><span data-ttu-id="cc202-110">Вступление</span><span class="sxs-lookup"><span data-stu-id="cc202-110">Introduction</span></span>

<span data-ttu-id="cc202-111">В [обновление пакета](batch-updating-cs.md) учебном курсе было рассмаотрено Настройка элемента управления GridView для представления интерфейса, где несколько записей были редактируемой.</span><span class="sxs-lookup"><span data-stu-id="cc202-111">In the [Batch Updating](batch-updating-cs.md) tutorial we looked at customizing the GridView control to present an interface where multiple records were editable.</span></span> <span data-ttu-id="cc202-112">Посещающий страницу пользователь может внести ряд изменений и выполните с одним нажатием кнопки, пакетного обновления.</span><span class="sxs-lookup"><span data-stu-id="cc202-112">The user visiting the page could make a series of changes and then, with a single button click, perform a batch update.</span></span> <span data-ttu-id="cc202-113">В ситуациях, где пользователи часто обновлять многие записи за одно действие, такой интерфейс можно сохранить бесчисленное количество щелчков, а также переключение контекста клавиатуры для мыши по сравнению с по умолчанию построчные функций редактирования, которые сначала были изучены обратно в [ Общие сведения о вставке, обновление и удаление данных](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md) руководства.</span><span class="sxs-lookup"><span data-stu-id="cc202-113">For situations where users commonly update many records in one go, such an interface can save countless clicks and keyboard-to-mouse context switches when compared to the default per-row editing features that were first explored back in the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md) tutorial.</span></span>

<span data-ttu-id="cc202-114">Эта концепция также может применяться при добавлении записей.</span><span class="sxs-lookup"><span data-stu-id="cc202-114">This concept can also be applied when adding records.</span></span> <span data-ttu-id="cc202-115">Представим, что здесь в компании Northwind Traders мы часто получают поставки от поставщиков, которые содержат ряд продуктов для определенной категории.</span><span class="sxs-lookup"><span data-stu-id="cc202-115">Imagine that here at Northwind Traders we commonly receive shipments from suppliers that contain a number of products for a particular category.</span></span> <span data-ttu-id="cc202-116">Например мы получаем партию шесть разных чая или кофе продуктов, от Tokyo Traders.</span><span class="sxs-lookup"><span data-stu-id="cc202-116">As an example, we might receive a shipment of six different tea and coffee products from Tokyo Traders.</span></span> <span data-ttu-id="cc202-117">Если пользователь вводит шесть одного продукта одновременно, используя элемент DetailsView, их нужно снова и снова выберите многие из одинаковые значения: им необходимо будет выбрать одной категории (Напитки), одного поставщика (Tokyo Traders), это значение (более не поддерживается Значение false) и тем же количеством единиц на порядковый номер (0).</span><span class="sxs-lookup"><span data-stu-id="cc202-117">If a user enters the six products one at a time through a DetailsView control, they will have to choose many of the same values over and over again: they will need to choose the same category (Beverages), the same supplier (Tokyo Traders), the same discontinued value (False), and the same units on order value (0).</span></span> <span data-ttu-id="cc202-118">Эта запись повторяющихся данных не только много времени, но может привести к ошибкам.</span><span class="sxs-lookup"><span data-stu-id="cc202-118">This repetitive data entry is not only time consuming, but is prone to errors.</span></span>

<span data-ttu-id="cc202-119">Немного поработав, мы можем создать пакет Вставка интерфейс, позволяющий пользователю выбрать поставщика и категории один раз, введите ряд названий продуктов и цен за штуку и нажмите кнопку для добавления новых продуктов в базу данных (см. рис. 1).</span><span class="sxs-lookup"><span data-stu-id="cc202-119">With a little work we can create a batch inserting interface that enables the user to choose the supplier and category once, enter a series of product names and unit prices, and then click a button to add the new products to the database (see Figure 1).</span></span> <span data-ttu-id="cc202-120">При добавлении каждого продукта, его `ProductName` и `UnitPrice` полей данных присваиваются значения, введенные в текстовые поля, хотя его `CategoryID` и `SupplierID` значения присваиваются значения из элементов управления DropDownList в верхнем fo формы.</span><span class="sxs-lookup"><span data-stu-id="cc202-120">As each product is added, its `ProductName` and `UnitPrice` data fields are assigned the values entered in the TextBoxes, while its `CategoryID` and `SupplierID` values are assigned the values from the DropDownLists at the top fo the form.</span></span> <span data-ttu-id="cc202-121">`Discontinued` И `UnitsOnOrder` значения устанавливаются в значения жестко `false` и 0 соответственно.</span><span class="sxs-lookup"><span data-stu-id="cc202-121">The `Discontinued` and `UnitsOnOrder` values are set to the hard-coded values of `false` and 0, respectively.</span></span>


<span data-ttu-id="cc202-122">[![Интерфейс вставки пакетной службы](batch-inserting-cs/_static/image2.png)](batch-inserting-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="cc202-122">[![The Batch Inserting Interface](batch-inserting-cs/_static/image2.png)](batch-inserting-cs/_static/image1.png)</span></span>

<span data-ttu-id="cc202-123">**Рис. 1**: Интерфейс вставки пакета ([Просмотр полноразмерного изображения](batch-inserting-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="cc202-123">**Figure 1**: The Batch Inserting Interface ([Click to view full-size image](batch-inserting-cs/_static/image3.png))</span></span>


<span data-ttu-id="cc202-124">В этом руководстве мы создадим страницу, которая реализует пакетной службы, вставка интерфейс, показанный на рис. 1.</span><span class="sxs-lookup"><span data-stu-id="cc202-124">In this tutorial we will create a page that implements the batch inserting interface shown in Figure 1.</span></span> <span data-ttu-id="cc202-125">Как с помощью двух предыдущих учебных мы будет служить оболочкой операций вставки в пределах области транзакции для обеспечения атомарности.</span><span class="sxs-lookup"><span data-stu-id="cc202-125">As with the previous two tutorials, we will wrap the insertions within the scope of a transaction to ensure atomicity.</span></span> <span data-ttu-id="cc202-126">Позвольте s приступить к работе!</span><span class="sxs-lookup"><span data-stu-id="cc202-126">Let s get started!</span></span>

## <a name="step-1-creating-the-display-interface"></a><span data-ttu-id="cc202-127">Шаг 1. Создание интерфейса отображения</span><span class="sxs-lookup"><span data-stu-id="cc202-127">Step 1: Creating the Display Interface</span></span>

<span data-ttu-id="cc202-128">Этот учебник будет состоять из одной страницы, разделенное на две области: область отображения и область вставки.</span><span class="sxs-lookup"><span data-stu-id="cc202-128">This tutorial will consist of a single page that is divided into two regions: a display region and an inserting region.</span></span> <span data-ttu-id="cc202-129">Интерфейс отображения, который мы создадим в этом шаге, показаны продукты в элементе управления GridView и содержит кнопку под названием процесса поставки продукта.</span><span class="sxs-lookup"><span data-stu-id="cc202-129">The display interface, which we'll create in this step, shows the products in a GridView and includes a button titled Process Product Shipment.</span></span> <span data-ttu-id="cc202-130">При нажатии этой кнопки, интерфейс отображения заменяется интерфейса вставки, как показано на рис. 1.</span><span class="sxs-lookup"><span data-stu-id="cc202-130">When this button is clicked, the display interface is replaced with the inserting interface, which is shown in Figure 1.</span></span> <span data-ttu-id="cc202-131">Интерфейс отображения возвращает после добавить продукты из отгрузки или нажатии кнопки "Отмена".</span><span class="sxs-lookup"><span data-stu-id="cc202-131">The display interface returns after the Add Products from Shipment or Cancel buttons are clicked.</span></span> <span data-ttu-id="cc202-132">Мы создадим интерфейс вставки на шаге 2.</span><span class="sxs-lookup"><span data-stu-id="cc202-132">We'll create the inserting interface in Step 2.</span></span>

<span data-ttu-id="cc202-133">При создании страницы, который имеет два интерфейса, одновременно только один из которых является видимым, каждый интерфейс обычно размещается в [веб-панель управления](http://www.w3schools.com/aspnet/control_panel.asp), который служит контейнером для других элементов управления.</span><span class="sxs-lookup"><span data-stu-id="cc202-133">When creating a page that has two interfaces, only one of which is visible at a time, each interface typically is placed within a [Panel Web control](http://www.w3schools.com/aspnet/control_panel.asp), which serves as a container for other controls.</span></span> <span data-ttu-id="cc202-134">Таким образом нашу страницу будет иметь два элемента управления панели один для каждого интерфейса.</span><span class="sxs-lookup"><span data-stu-id="cc202-134">Therefore, our page will have two Panel controls one for each interface.</span></span>

<span data-ttu-id="cc202-135">Сначала откройте `BatchInsert.aspx` странице в `BatchData` папки и перетащите панель из панели элементов в конструктор (см. рис. 2).</span><span class="sxs-lookup"><span data-stu-id="cc202-135">Start by opening the `BatchInsert.aspx` page in the `BatchData` folder and drag a Panel from the Toolbox onto the Designer (see Figure 2).</span></span> <span data-ttu-id="cc202-136">Задайте для свойства панели s `ID` свойства `DisplayInterface`.</span><span class="sxs-lookup"><span data-stu-id="cc202-136">Set the Panel s `ID` property to `DisplayInterface`.</span></span> <span data-ttu-id="cc202-137">При добавлении панели в конструкторе, его `Height` и `Width` свойствам присваивается 50px и 125px, соответственно.</span><span class="sxs-lookup"><span data-stu-id="cc202-137">When adding the Panel to the Designer, its `Height` and `Width` properties are set to 50px and 125px, respectively.</span></span> <span data-ttu-id="cc202-138">Очистите значения этих свойств в окне свойств.</span><span class="sxs-lookup"><span data-stu-id="cc202-138">Clear out these property values from the Properties window.</span></span>


<span data-ttu-id="cc202-139">[![Перетащите панель из панели элементов в конструктор](batch-inserting-cs/_static/image5.png)](batch-inserting-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="cc202-139">[![Drag a Panel from the Toolbox onto the Designer](batch-inserting-cs/_static/image5.png)](batch-inserting-cs/_static/image4.png)</span></span>

<span data-ttu-id="cc202-140">**Рис. 2**: Перетащите панель из панели элементов в конструктор ([Просмотр полноразмерного изображения](batch-inserting-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="cc202-140">**Figure 2**: Drag a Panel from the Toolbox onto the Designer ([Click to view full-size image](batch-inserting-cs/_static/image6.png))</span></span>


<span data-ttu-id="cc202-141">Затем перетащите элемент управления кнопки и GridView в панель.</span><span class="sxs-lookup"><span data-stu-id="cc202-141">Next, drag a Button and GridView control into the Panel.</span></span> <span data-ttu-id="cc202-142">Назначьте свойству s `ID` свойства `ProcessShipment` и его `Text` свойства процесса поставки продукта.</span><span class="sxs-lookup"><span data-stu-id="cc202-142">Set the Button s `ID` property to `ProcessShipment` and its `Text` property to Process Product Shipment.</span></span> <span data-ttu-id="cc202-143">Набор GridView s `ID` свойства `ProductsGrid` и его смарт-теге, привязать его к элементу управления ObjectDataSource с именем `ProductsDataSource`.</span><span class="sxs-lookup"><span data-stu-id="cc202-143">Set the GridView s `ID` property to `ProductsGrid` and, from its smart tag, bind it to a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="cc202-144">Настройте элемент ObjectDataSource для извлечения данных из `ProductsBLL` класс s `GetProducts` метод.</span><span class="sxs-lookup"><span data-stu-id="cc202-144">Configure the ObjectDataSource to pull its data from the `ProductsBLL` class s `GetProducts` method.</span></span> <span data-ttu-id="cc202-145">Так как этот GridView используется только для отображения данных, установите раскрывающиеся списки в UPDATE, INSERT и удаление вкладок (нет).</span><span class="sxs-lookup"><span data-stu-id="cc202-145">Since this GridView is used only to display data, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None).</span></span> <span data-ttu-id="cc202-146">Нажмите кнопку Готово для завершения работы мастера настройки источника данных.</span><span class="sxs-lookup"><span data-stu-id="cc202-146">Click Finish to complete the Configure Data Source wizard.</span></span>


<span data-ttu-id="cc202-147">[![Просмотреть данные, возвращаемые из метода GetProducts класса ProductsBLL s](batch-inserting-cs/_static/image8.png)](batch-inserting-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="cc202-147">[![Display the Data Returned from the ProductsBLL Class s GetProducts Method](batch-inserting-cs/_static/image8.png)](batch-inserting-cs/_static/image7.png)</span></span>

<span data-ttu-id="cc202-148">**Рис. 3**: Отобразить данные, возвращенные из `ProductsBLL` класс s `GetProducts` метод ([Просмотр полноразмерного изображения](batch-inserting-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="cc202-148">**Figure 3**: Display the Data Returned from the `ProductsBLL` Class s `GetProducts` Method ([Click to view full-size image](batch-inserting-cs/_static/image9.png))</span></span>


<span data-ttu-id="cc202-149">[![Установите раскрывающиеся списки в UPDATE, INSERT и удаление вкладок (нет)](batch-inserting-cs/_static/image11.png)](batch-inserting-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="cc202-149">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](batch-inserting-cs/_static/image11.png)](batch-inserting-cs/_static/image10.png)</span></span>

<span data-ttu-id="cc202-150">**Рис. 4**: Задайте раскрывающиеся списки в UPDATE, INSERT и удаление вкладок (нет) ([Просмотр полноразмерного изображения](batch-inserting-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="cc202-150">**Figure 4**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](batch-inserting-cs/_static/image12.png))</span></span>


<span data-ttu-id="cc202-151">После завершения работы мастера ObjectDataSource Visual Studio будут добавлены поля BoundFields и CheckBoxField для полей данных продукта.</span><span class="sxs-lookup"><span data-stu-id="cc202-151">After completing the ObjectDataSource wizard, Visual Studio will add BoundFields and a CheckBoxField for the product data fields.</span></span> <span data-ttu-id="cc202-152">Удалите все, кроме `ProductName`, `CategoryName`, `SupplierName`, `UnitPrice`, и `Discontinued` поля.</span><span class="sxs-lookup"><span data-stu-id="cc202-152">Remove all but the `ProductName`, `CategoryName`, `SupplierName`, `UnitPrice`, and `Discontinued` fields.</span></span> <span data-ttu-id="cc202-153">Вы можете внести любые изменения внешнего вида.</span><span class="sxs-lookup"><span data-stu-id="cc202-153">Feel free to make any aesthetic customizations.</span></span> <span data-ttu-id="cc202-154">Я решил форматирования `UnitPrice` поля в виде значения валюты, перед началом записи поля и переименовать несколько полей, `HeaderText` значения.</span><span class="sxs-lookup"><span data-stu-id="cc202-154">I decided to format the `UnitPrice` field as a currency value, reordered the fields, and renamed several of the fields `HeaderText` values.</span></span> <span data-ttu-id="cc202-155">Кроме того, настройте GridView, чтобы включить разбиение по страницам и обеспечения поддержки сортировки, установив флажки включить разбиение по страницам и включить сортировку в смарт-теге GridView s.</span><span class="sxs-lookup"><span data-stu-id="cc202-155">Also configure the GridView to include paging and sorting support by checking the Enable Paging and Enable Sorting checkboxes in the GridView s smart tag.</span></span>

<span data-ttu-id="cc202-156">После добавления элементов управления панели, кнопки, GridView и элемент управления ObjectDataSource и настройка полей s GridView, декларативной разметке страницы s должен выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="cc202-156">After adding the Panel, Button, GridView, and ObjectDataSource controls and customizing the GridView s fields, your page s declarative markup should look similar to the following:</span></span>


[!code-aspx[Main](batch-inserting-cs/samples/sample1.aspx)]

<span data-ttu-id="cc202-157">Обратите внимание, что разметка для кнопки и GridView отображаются между открывающим и закрывающим `<asp:Panel>` теги.</span><span class="sxs-lookup"><span data-stu-id="cc202-157">Note that the markup for the Button and GridView appear within the opening and closing `<asp:Panel>` tags.</span></span> <span data-ttu-id="cc202-158">Так как эти элементы управления находятся в пределах `DisplayInterface` панели мы их можно скрыть, просто задав панели s `Visible` свойства `false`.</span><span class="sxs-lookup"><span data-stu-id="cc202-158">Since these controls are within the `DisplayInterface` Panel, we can hide them by simply setting the Panel s `Visible` property to `false`.</span></span> <span data-ttu-id="cc202-159">Шаг 3 рассматривает программного изменения на панели s `Visible` свойство в ответ на нажатие кнопки щелкните, чтобы показать один интерфейс, скрывая другой.</span><span class="sxs-lookup"><span data-stu-id="cc202-159">Step 3 looks at programmatically changing the Panel s `Visible` property in response to a button click to show one interface while hiding the other.</span></span>

<span data-ttu-id="cc202-160">Отвлекитесь и просмотрите ход работы через браузер.</span><span class="sxs-lookup"><span data-stu-id="cc202-160">Take a moment to view our progress through a browser.</span></span> <span data-ttu-id="cc202-161">Как показано на рис. 5, вы должны увидеть процесс поставки продукта кнопки выше элемент GridView со списком продуктов десять одновременно.</span><span class="sxs-lookup"><span data-stu-id="cc202-161">As Figure 5 shows, you should see a Process Product Shipment button above a GridView that lists the products ten at a time.</span></span>


<span data-ttu-id="cc202-162">[![GridView перечисляет продукты и предлагает сортировки и разбиения по страницам](batch-inserting-cs/_static/image14.png)](batch-inserting-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="cc202-162">[![The GridView Lists the Products and Offers Sorting and Paging Capabilities](batch-inserting-cs/_static/image14.png)](batch-inserting-cs/_static/image13.png)</span></span>

<span data-ttu-id="cc202-163">**Рис. 5**: GridView перечисляет продукты и обеспечивает сортировку и разбиение по страницам возможности ([Просмотр полноразмерного изображения](batch-inserting-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="cc202-163">**Figure 5**: The GridView Lists the Products and Offers Sorting and Paging Capabilities ([Click to view full-size image](batch-inserting-cs/_static/image15.png))</span></span>


## <a name="step-2-creating-the-inserting-interface"></a><span data-ttu-id="cc202-164">Шаг 2. Создание интерфейса вставки</span><span class="sxs-lookup"><span data-stu-id="cc202-164">Step 2: Creating the Inserting Interface</span></span>

<span data-ttu-id="cc202-165">С помощью отображения интерфейса полный, мы будет готов для создания интерфейса вставки.</span><span class="sxs-lookup"><span data-stu-id="cc202-165">With the display interface complete, we re ready to create the inserting interface.</span></span> <span data-ttu-id="cc202-166">Для этого руководства позволяют создать интерфейс для вставки, запрашивает одно значение поставщика и категории, а затем позволяет пользователю ввести до пяти названия продуктов и значения цены единицы s.</span><span class="sxs-lookup"><span data-stu-id="cc202-166">For this tutorial, let s create an inserting interface that prompts for a single supplier and category value and then allows the user to enter up to five product names and unit price values.</span></span> <span data-ttu-id="cc202-167">С этим интерфейсом пользователь может добавлять новые продукты от одного до пяти все же категорию и поставщика, которые имеют уникальные продукты названия и цены.</span><span class="sxs-lookup"><span data-stu-id="cc202-167">With this interface, the user can add one to five new products that all share the same category and supplier, but have unique product names and prices.</span></span>

<span data-ttu-id="cc202-168">Start, перетащив панели из инструментария в конструктор, поместив его под существующий `DisplayInterface` панели.</span><span class="sxs-lookup"><span data-stu-id="cc202-168">Start by dragging a Panel from the Toolbox onto the Designer, placing it beneath the existing `DisplayInterface` Panel.</span></span> <span data-ttu-id="cc202-169">Задайте `ID` свойства данного объекта новые добавленные панели `InsertingInterface` и задайте его `Visible` свойства `false`.</span><span class="sxs-lookup"><span data-stu-id="cc202-169">Set the `ID` property of this newly added Panel to `InsertingInterface` and set its `Visible` property to `false`.</span></span> <span data-ttu-id="cc202-170">Мы добавим код, который задает `InsertingInterface` панели s `Visible` свойства `true` на шаге 3.</span><span class="sxs-lookup"><span data-stu-id="cc202-170">We'll add code that sets the `InsertingInterface` Panel s `Visible` property to `true` in Step 3.</span></span> <span data-ttu-id="cc202-171">Также очистить панель s `Height` и `Width` значения свойств.</span><span class="sxs-lookup"><span data-stu-id="cc202-171">Also clear out the Panel s `Height` and `Width` property values.</span></span>

<span data-ttu-id="cc202-172">Далее нам нужно создать интерфейс вставки, было показано на рис. 1.</span><span class="sxs-lookup"><span data-stu-id="cc202-172">Next, we need to create the inserting interface that was shown back in Figure 1.</span></span> <span data-ttu-id="cc202-173">Этот интерфейс может создаваться с помощью разных методов HTML, но мы будем использовать ее довольно проста: таблица с четырьмя столбцами и семь строк.</span><span class="sxs-lookup"><span data-stu-id="cc202-173">This interface can be created through a variety of HTML techniques, but we will use a fairly straightforward one: a four-column, seven-row table.</span></span>

> [!NOTE]
> <span data-ttu-id="cc202-174">При вводе разметки HTML `<table>` элементов, я предпочитаю использовать представление источника.</span><span class="sxs-lookup"><span data-stu-id="cc202-174">When entering markup for HTML `<table>` elements, I prefer to use the Source view.</span></span> <span data-ttu-id="cc202-175">Хотя Visual Studio имеет средства для добавления `<table>` элементов с помощью конструктора, конструкторе кажется, что все слишком хочу внедрить незапрошенный для `style` параметры в разметку.</span><span class="sxs-lookup"><span data-stu-id="cc202-175">While Visual Studio does have tools for adding `<table>` elements through the Designer, the Designer seems all too willing to inject unasked for `style` settings into the markup.</span></span> <span data-ttu-id="cc202-176">Когда я созданы `<table>` разметки, я обычно вернитесь в конструктор для добавления веб-элементов управления и задавать их свойства.</span><span class="sxs-lookup"><span data-stu-id="cc202-176">Once I have created the `<table>` markup, I usually return to the Designer to add the Web controls and set their properties.</span></span> <span data-ttu-id="cc202-177">При создании таблиц с предварительно определенный столбцами и строками я предпочитаю использовать статический HTML, а не [таблицы веб-элемента управления](https://msdn.microsoft.com/library/system.web.ui.webcontrols.table.aspx) так, как веб-элементы управления, помещены в элемент управления веб-таблица может осуществляться только с помощью `FindControl("controlID")` шаблон.</span><span class="sxs-lookup"><span data-stu-id="cc202-177">When creating tables with pre-determined columns and rows I prefer using static HTML rather than the [Table Web control](https://msdn.microsoft.com/library/system.web.ui.webcontrols.table.aspx) because any Web controls placed within a Table Web control can only be accessed using the `FindControl("controlID")` pattern.</span></span> <span data-ttu-id="cc202-178">Тем не менее, я использовать элементы управления веб-таблица для динамически размера таблиц (из них, строк или столбцов на основе некоторые базы данных или указанных пользователем критериев), с момента веб-таблица, элемент управления может быть создан программным способом.</span><span class="sxs-lookup"><span data-stu-id="cc202-178">I do, however, use Table Web controls for dynamically-sized tables (ones whose rows or columns are based on some database or user-specified criteria), since the Table Web control can be constructed programmatically.</span></span>


<span data-ttu-id="cc202-179">Введите следующую разметку внутри тегов `<asp:Panel>` тегами `InsertingInterface` панели:</span><span class="sxs-lookup"><span data-stu-id="cc202-179">Enter the following markup within the `<asp:Panel>` tags of the `InsertingInterface` Panel:</span></span>


[!code-html[Main](batch-inserting-cs/samples/sample2.html)]

<span data-ttu-id="cc202-180">Это `<table>` разметки не включает любые веб-элементы управления, но мы добавим их моментально.</span><span class="sxs-lookup"><span data-stu-id="cc202-180">This `<table>` markup does not include any Web controls yet, we'll add those momentarily.</span></span> <span data-ttu-id="cc202-181">Обратите внимание, что каждый `<tr>` элемент содержит конкретное значение класс CSS: `BatchInsertHeaderRow` для строки заголовка, которому будет переходить поставщика и категории элементов управления DropDownList; `BatchInsertFooterRow` для строки нижнего колонтитула, которому будет переходить добавить продукты Shipment и Отмена кнопки; и чередующихся `BatchInsertRow` и `BatchInsertAlternatingRow` значения для строк, которые будут содержать продукта и единицы измерения Цена элемента управления TextBox.</span><span class="sxs-lookup"><span data-stu-id="cc202-181">Note that each `<tr>` element contains a particular CSS class setting: `BatchInsertHeaderRow` for the header row where the supplier and category DropDownLists will go; `BatchInsertFooterRow` for the footer row where the Add Products from Shipment and Cancel Buttons will go; and alternating `BatchInsertRow` and `BatchInsertAlternatingRow` values for the rows that will contain the product and unit price TextBox controls.</span></span> <span data-ttu-id="cc202-182">Я ve создан соответствующие классы CSS в `Styles.css` файл для предоставления интерфейса вставки интерфейсом, аналогичным интерфейсу GridView и DetailsView, управляет мы ve, используемый в данных учебных курсах.</span><span class="sxs-lookup"><span data-stu-id="cc202-182">I ve created corresponding CSS classes in the `Styles.css` file to give the inserting interface an appearance similar to the GridView and DetailsView controls we ve used throughout these tutorials.</span></span> <span data-ttu-id="cc202-183">Ниже приведены эти классы CSS.</span><span class="sxs-lookup"><span data-stu-id="cc202-183">These CSS classes are shown below.</span></span>


[!code-css[Main](batch-inserting-cs/samples/sample3.css)]

<span data-ttu-id="cc202-184">С этой разметкой ввода вернитесь в режим конструктора.</span><span class="sxs-lookup"><span data-stu-id="cc202-184">With this markup entered, return to the Design view.</span></span> <span data-ttu-id="cc202-185">Это `<table>` должно отображаться как таблицу семь строк и четырех столбцов, в конструкторе, как показано на рис. 6.</span><span class="sxs-lookup"><span data-stu-id="cc202-185">This `<table>` should show as a four-column, seven-row table in the Designer, as Figure 6 illustrates.</span></span>


<span data-ttu-id="cc202-186">[![Интерфейс вставки состоит из четырех столбцов, таблица семь строк](batch-inserting-cs/_static/image17.png)](batch-inserting-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="cc202-186">[![The Inserting Interface is Composed of a Four-Column, Seven-Row Table](batch-inserting-cs/_static/image17.png)](batch-inserting-cs/_static/image16.png)</span></span>

<span data-ttu-id="cc202-187">**Рис. 6**: Интерфейс вставки состоит из четырех столбцов, таблица семь строк ([Просмотр полноразмерного изображения](batch-inserting-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="cc202-187">**Figure 6**: The Inserting Interface is Composed of a Four-Column, Seven-Row Table ([Click to view full-size image](batch-inserting-cs/_static/image18.png))</span></span>


<span data-ttu-id="cc202-188">Мы повторно теперь готов для добавления веб-элементов управления в интерфейсе правки.</span><span class="sxs-lookup"><span data-stu-id="cc202-188">We re now ready to add the Web controls to the inserting interface.</span></span> <span data-ttu-id="cc202-189">Перетащите двух элементов управления DropDownList с панели инструментов в соответствующие ячейки таблицы в таблице одного поставщика и категории.</span><span class="sxs-lookup"><span data-stu-id="cc202-189">Drag two DropDownLists from the Toolbox into the appropriate cells in the table one for the supplier and one for the category.</span></span>

<span data-ttu-id="cc202-190">Задать поставщик DropDownList s `ID` свойства `Suppliers` и привязать его к элементу управления ObjectDataSource с именем `SuppliersDataSource`.</span><span class="sxs-lookup"><span data-stu-id="cc202-190">Set the supplier DropDownList s `ID` property to `Suppliers` and bind it to a new ObjectDataSource named `SuppliersDataSource`.</span></span> <span data-ttu-id="cc202-191">Настройте новый элемент ObjectDataSource для извлечения данных из `SuppliersBLL` класс s `GetSuppliers` метода и обновление набора вкладке s с раскрывающимся списком (нет).</span><span class="sxs-lookup"><span data-stu-id="cc202-191">Configure the new ObjectDataSource to retrieve its data from the `SuppliersBLL` class s `GetSuppliers` method and set the UPDATE tab s drop-down list to (None).</span></span> <span data-ttu-id="cc202-192">Нажмите кнопку Готово, чтобы завершить работу мастера.</span><span class="sxs-lookup"><span data-stu-id="cc202-192">Click Finish to complete the wizard.</span></span>


<span data-ttu-id="cc202-193">[![Настройка ObjectDataSource на использование метода Getsuppliers() класса s GetSuppliers метод](batch-inserting-cs/_static/image20.png)](batch-inserting-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="cc202-193">[![Configure the ObjectDataSource to Use the SuppliersBLL Class s GetSuppliers Method](batch-inserting-cs/_static/image20.png)](batch-inserting-cs/_static/image19.png)</span></span>

<span data-ttu-id="cc202-194">**Рис. 7**: Настройка ObjectDataSource для использования `SuppliersBLL` класс s `GetSuppliers` метод ([Просмотр полноразмерного изображения](batch-inserting-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="cc202-194">**Figure 7**: Configure the ObjectDataSource to Use the `SuppliersBLL` Class s `GetSuppliers` Method ([Click to view full-size image](batch-inserting-cs/_static/image21.png))</span></span>


<span data-ttu-id="cc202-195">У `Suppliers` элемент управления DropDownList отображает `CompanyName` поля данных и использование `SupplierID` поле данных в качестве его `ListItem` s значений.</span><span class="sxs-lookup"><span data-stu-id="cc202-195">Have the `Suppliers` DropDownList display the `CompanyName` data field and use the `SupplierID` data field as its `ListItem` s values.</span></span>


<span data-ttu-id="cc202-196">[![Отображения поля данных CompanyName и SupplierID использовать в качестве значения](batch-inserting-cs/_static/image23.png)](batch-inserting-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="cc202-196">[![Display the CompanyName Data Field and Use SupplierID as the Value](batch-inserting-cs/_static/image23.png)](batch-inserting-cs/_static/image22.png)</span></span>

<span data-ttu-id="cc202-197">**Рис. 8**: Отображение `CompanyName` поля данных и использование `SupplierID` как значение ([Просмотр полноразмерного изображения](batch-inserting-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="cc202-197">**Figure 8**: Display the `CompanyName` Data Field and Use `SupplierID` as the Value ([Click to view full-size image](batch-inserting-cs/_static/image24.png))</span></span>


<span data-ttu-id="cc202-198">Имя второго элемента управления DropDownList `Categories` и привязать его к элементу управления ObjectDataSource с именем `CategoriesDataSource`.</span><span class="sxs-lookup"><span data-stu-id="cc202-198">Name the second DropDownList `Categories` and bind it to a new ObjectDataSource named `CategoriesDataSource`.</span></span> <span data-ttu-id="cc202-199">Настройка `CategoriesDataSource` ObjectDataSource на использование `CategoriesBLL` класс s `GetCategories` метод; набор, перечислены в раскрывающемся списке вкладки UPDATE и DELETE (нет) и нажмите кнопку "Готово" для завершения работы мастера.</span><span class="sxs-lookup"><span data-stu-id="cc202-199">Configure the `CategoriesDataSource` ObjectDataSource to use the `CategoriesBLL` class s `GetCategories` method; set the drop-down lists in the UPDATE and DELETE tabs to (None) and click Finish to complete the wizard.</span></span> <span data-ttu-id="cc202-200">Наконец, иметь элемент управления DropDownList отображает `CategoryName` поля данных и использование `CategoryID` как значение.</span><span class="sxs-lookup"><span data-stu-id="cc202-200">Finally, have the DropDownList display the `CategoryName` data field and use the `CategoryID` as the value.</span></span>

<span data-ttu-id="cc202-201">После этих двух элементов управления DropDownList добавлены и привязаны к соответствующим образом настроенных элементов управления ObjectDataSource, экран должен выглядеть аналогично рис. 9.</span><span class="sxs-lookup"><span data-stu-id="cc202-201">After these two DropDownLists have been added and bound to appropriately configured ObjectDataSources, your screen should look similar to Figure 9.</span></span>


<span data-ttu-id="cc202-202">[![Теперь содержит строки заголовка «поставщики» и «элементов управления DropDownList категории](batch-inserting-cs/_static/image26.png)](batch-inserting-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="cc202-202">[![The Header Row Now Contains the Suppliers and Categories DropDownLists](batch-inserting-cs/_static/image26.png)](batch-inserting-cs/_static/image25.png)</span></span>

<span data-ttu-id="cc202-203">**Рис. 9**: Строка заголовка теперь содержит `Suppliers` и `Categories` элементов управления DropDownList ([Просмотр полноразмерного изображения](batch-inserting-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="cc202-203">**Figure 9**: The Header Row Now Contains the `Suppliers` and `Categories` DropDownLists ([Click to view full-size image](batch-inserting-cs/_static/image27.png))</span></span>


<span data-ttu-id="cc202-204">Теперь нам нужно создать текстовые поля для сбора, название и цену для каждого нового продукта.</span><span class="sxs-lookup"><span data-stu-id="cc202-204">We now need to create the TextBoxes to collect the name and price for each new product.</span></span> <span data-ttu-id="cc202-205">Перетащите элемент управления TextBox с панели инструментов в конструктор для каждой строки название и цену продукта пять.</span><span class="sxs-lookup"><span data-stu-id="cc202-205">Drag a TextBox control from the Toolbox onto the Designer for each of the five product name and price rows.</span></span> <span data-ttu-id="cc202-206">Задайте `ID` свойства из текстовых полей для `ProductName1`, `UnitPrice1`, `ProductName2`, `UnitPrice2`, `ProductName3`, `UnitPrice3`, и т. д.</span><span class="sxs-lookup"><span data-stu-id="cc202-206">Set the `ID` properties of the TextBoxes to `ProductName1`, `UnitPrice1`, `ProductName2`, `UnitPrice2`, `ProductName3`, `UnitPrice3`, and so on.</span></span>

<span data-ttu-id="cc202-207">Добавьте элемент управления CompareValidator после каждого цены за единицу текстовые поля, установка `ControlToValidate` свойство в соответствующий `ID`.</span><span class="sxs-lookup"><span data-stu-id="cc202-207">Add a CompareValidator after each of the unit price TextBoxes, setting the `ControlToValidate` property to the appropriate `ID`.</span></span> <span data-ttu-id="cc202-208">Также задайте `Operator` свойства `GreaterThanEqual`, `ValueToCompare` 0, и `Type` для `Currency`.</span><span class="sxs-lookup"><span data-stu-id="cc202-208">Also set the `Operator` property to `GreaterThanEqual`, `ValueToCompare` to 0, and `Type` to `Currency`.</span></span> <span data-ttu-id="cc202-209">Эти параметры указать CompareValidator для обеспечения цену, если указано, значение валют, больше или равно нулю.</span><span class="sxs-lookup"><span data-stu-id="cc202-209">These settings instruct the CompareValidator to ensure that the price, if entered, is a valid currency value that is greater than or equal to zero.</span></span> <span data-ttu-id="cc202-210">Задайте `Text` свойства \*, и `ErrorMessage` цену должен быть больше или равно нулю.</span><span class="sxs-lookup"><span data-stu-id="cc202-210">Set the `Text` property to \*, and `ErrorMessage` to The price must be greater than or equal to zero.</span></span> <span data-ttu-id="cc202-211">Кроме того можно опустите любых символов валют.</span><span class="sxs-lookup"><span data-stu-id="cc202-211">Also, please omit any currency symbols.</span></span>

> [!NOTE]
> <span data-ttu-id="cc202-212">Интерфейс вставки не включает все элементы управления RequiredFieldValidator, даже если `ProductName` в `Products` таблицы базы данных не допускает `NULL` значения.</span><span class="sxs-lookup"><span data-stu-id="cc202-212">The inserting interface does not include any RequiredFieldValidator controls, even though the `ProductName` field in the `Products` database table does not allow `NULL` values.</span></span> <span data-ttu-id="cc202-213">Это потому, что мы хотим сообщить пользователю ввести до пяти продуктов.</span><span class="sxs-lookup"><span data-stu-id="cc202-213">This is because we want to let the user enter up to five products.</span></span> <span data-ttu-id="cc202-214">Например если пользователь должен был предоставить продукта имя и цену за единицу для первых трех строк, если оставить пустым, последних двух строк мы d просто добавьте три новых продуктов в систему.</span><span class="sxs-lookup"><span data-stu-id="cc202-214">For example, if the user were to provide the product name and unit price for the first three rows, leaving the last two rows blank, we d just add three new products to the system.</span></span> <span data-ttu-id="cc202-215">Так как `ProductName` — требуется, однако нам потребуется программно проверять, чтобы убедиться, что если цена за единицу вводится, предоставляется соответствующее значение имени продукта.</span><span class="sxs-lookup"><span data-stu-id="cc202-215">Since `ProductName` is required, however, we will need to programmatically check to ensure that if a unit price is entered that a corresponding product name value is provided.</span></span> <span data-ttu-id="cc202-216">Это будет рассмотрено эта проверка на шаге 4.</span><span class="sxs-lookup"><span data-stu-id="cc202-216">We'll tackle this check in Step 4.</span></span>


<span data-ttu-id="cc202-217">При проверке входных данных пользователя s, CompareValidator сообщает недопустимые данные, если значение содержит символ валюты.</span><span class="sxs-lookup"><span data-stu-id="cc202-217">When validating the user s input, the CompareValidator reports invalid data if the value contains a currency symbol.</span></span> <span data-ttu-id="cc202-218">Добавьте $ перед каждым из текстовых полей, который будет служить визуальным средством, которое указывает пользователю пропустить символ валюты при вводе цены цена за единицу.</span><span class="sxs-lookup"><span data-stu-id="cc202-218">Add a $ in front of each of the unit price TextBoxes to serve as a visual cue that instructs the user to omit the currency symbol when entering the price.</span></span>

<span data-ttu-id="cc202-219">Наконец, добавьте элемент управления ValidationSummary в `InsertingInterface` панели параметров его `ShowMessageBox` свойства `true` и его `ShowSummary` свойства `false`.</span><span class="sxs-lookup"><span data-stu-id="cc202-219">Lastly, add a ValidationSummary control within the `InsertingInterface` Panel, settings its `ShowMessageBox` property to `true` and its `ShowSummary` property to `false`.</span></span> <span data-ttu-id="cc202-220">С этими параметрами Если пользователь вводит значение Недопустимая единица измерения цены, звездочка будет отображаться рядом с нарушением. элементы управления TextBox и ValidationSummary отображает messagebox клиентской стороны, отобразится сообщение об ошибке, которую мы указали ранее.</span><span class="sxs-lookup"><span data-stu-id="cc202-220">With these settings, if the user enters an invalid unit price value, an asterisk will appear next to the offending TextBox controls and the ValidationSummary will display a client-side messagebox that shows the error message we specified earlier.</span></span>

<span data-ttu-id="cc202-221">На этом этапе экран должен выглядеть аналогично рис. 10.</span><span class="sxs-lookup"><span data-stu-id="cc202-221">At this point, your screen should look similar to Figure 10.</span></span>


<span data-ttu-id="cc202-222">[![Интерфейс вставки теперь включает текстовые поля для продуктов, названия и цены](batch-inserting-cs/_static/image29.png)](batch-inserting-cs/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="cc202-222">[![The Inserting Interface Now Includes TextBoxes for the Products Names and Prices](batch-inserting-cs/_static/image29.png)](batch-inserting-cs/_static/image28.png)</span></span>

<span data-ttu-id="cc202-223">**Рис. 10**: Вставка интерфейса теперь включает текстовые поля для названия продуктов и цены ([Просмотр полноразмерного изображения](batch-inserting-cs/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="cc202-223">**Figure 10**: The Inserting Interface Now Includes TextBoxes for the Products Names and Prices ([Click to view full-size image](batch-inserting-cs/_static/image30.png))</span></span>


<span data-ttu-id="cc202-224">Далее нам нужно добавить новый товар из кнопок отгрузки» и «Отмена строки нижнего колонтитула.</span><span class="sxs-lookup"><span data-stu-id="cc202-224">Next we need to add the Add Products from Shipment and Cancel buttons to the footer row.</span></span> <span data-ttu-id="cc202-225">Перетащите два кнопочные элементы управления из области элементов в нижнем колонтитуле интерфейсе вставки параметра кнопок `ID` свойства `AddProducts` и `CancelButton` и `Text` свойства, чтобы добавить продукты из поставки "и" Отмена ", соответственно.</span><span class="sxs-lookup"><span data-stu-id="cc202-225">Drag two Button controls from the Toolbox into the footer of the inserting interface, setting the Buttons `ID` properties to `AddProducts` and `CancelButton` and `Text` properties to Add Products from Shipment and Cancel, respectively.</span></span> <span data-ttu-id="cc202-226">Кроме того, задайте `CancelButton` управления s `CausesValidation` свойства `false`.</span><span class="sxs-lookup"><span data-stu-id="cc202-226">In addition, set the `CancelButton` control s `CausesValidation` property to `false`.</span></span>

<span data-ttu-id="cc202-227">Наконец необходимо добавить элемент управления Label Web, который будет отображать сообщения о состоянии для двух интерфейсов.</span><span class="sxs-lookup"><span data-stu-id="cc202-227">Finally, we need to add a Label Web control that will display status messages for the two interfaces.</span></span> <span data-ttu-id="cc202-228">Например когда пользователь успешно добавляет новая партия продуктов, мы хотим вернуться к интерфейсу отображения и отображать сообщение с подтверждением.</span><span class="sxs-lookup"><span data-stu-id="cc202-228">For example, when a user successfully adds a new shipment of products, we want to return to the display interface and display a confirmation message.</span></span> <span data-ttu-id="cc202-229">Если, однако пользователь предоставляет цену для нового продукта, но оставляет off название продукта, нам нужно отображать предупреждающее сообщение с момента `ProductName` поле является обязательным.</span><span class="sxs-lookup"><span data-stu-id="cc202-229">If, however, the user provides a price for a new product but leaves off the product name, we need to display a warning message since the `ProductName` field is required.</span></span> <span data-ttu-id="cc202-230">Поскольку нам требуется это сообщение, отображаемое для обоих интерфейсов, поместите его в верхней части страницы за пределами панели.</span><span class="sxs-lookup"><span data-stu-id="cc202-230">Since we need this message to display for both interfaces, place it at the top of the page outside of the Panels.</span></span>

<span data-ttu-id="cc202-231">Перетащите элемент управления Label Web с панели инструментов в верхней части страницы в конструкторе.</span><span class="sxs-lookup"><span data-stu-id="cc202-231">Drag a Label Web control from the Toolbox to the top of the page in the Designer.</span></span> <span data-ttu-id="cc202-232">Задайте `ID` свойства `StatusLabel`снимите out `Text` и установите `Visible` и `EnableViewState` свойства `false`.</span><span class="sxs-lookup"><span data-stu-id="cc202-232">Set the `ID` property to `StatusLabel`, clear out the `Text` property, and set the `Visible` and `EnableViewState` properties to `false`.</span></span> <span data-ttu-id="cc202-233">Как мы уже видели в предыдущих учебных курсах, установка `EnableViewState` свойства `false` позволяет программно изменять значения свойств метки s и их автоматически восстановить значения по умолчанию при последующих обратной передаче.</span><span class="sxs-lookup"><span data-stu-id="cc202-233">As we have seen in previous tutorials, setting the `EnableViewState` property to `false` allows us to programmatically change the Label s property values and have them automatically revert back to their defaults on the subsequent postback.</span></span> <span data-ttu-id="cc202-234">Это упрощает код для отображения сообщения о состоянии в ответ на некоторое действие пользователя, которая исчезает при последующем обратном вызове.</span><span class="sxs-lookup"><span data-stu-id="cc202-234">This simplifies the code for showing a status message in response to some user action that disappears on the subsequent postback.</span></span> <span data-ttu-id="cc202-235">Наконец, установите `StatusLabel` управления s `CssClass` свойства на "Предупреждение", представляющее собой имя класса CSS, определенного в `Styles.css` в больших, курсив, шрифт, который отображает текст.</span><span class="sxs-lookup"><span data-stu-id="cc202-235">Finally, set the `StatusLabel` control s `CssClass` property to Warning, which is the name of a CSS class defined in `Styles.css` that displays text in a large, italic, bold, red font.</span></span>

<span data-ttu-id="cc202-236">Рис. 11 показан конструктор Visual Studio после метки был добавлен и настроен.</span><span class="sxs-lookup"><span data-stu-id="cc202-236">Figure 11 shows the Visual Studio Designer after the Label has been added and configured.</span></span>


<span data-ttu-id="cc202-237">[![Поместите элемент управления StatusLabel над двумя Панельными элементами управления](batch-inserting-cs/_static/image32.png)](batch-inserting-cs/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="cc202-237">[![Place the StatusLabel Control Above the Two Panel Controls](batch-inserting-cs/_static/image32.png)](batch-inserting-cs/_static/image31.png)</span></span>

<span data-ttu-id="cc202-238">**Рис. 11**: Место `StatusLabel` контроля над двумя Панельными элементами управления ([Просмотр полноразмерного изображения](batch-inserting-cs/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="cc202-238">**Figure 11**: Place the `StatusLabel` Control Above the Two Panel Controls ([Click to view full-size image](batch-inserting-cs/_static/image33.png))</span></span>


## <a name="step-3-switching-between-the-display-and-inserting-interfaces"></a><span data-ttu-id="cc202-239">Шаг 3. Переключение между отображением и вставка интерфейсов</span><span class="sxs-lookup"><span data-stu-id="cc202-239">Step 3: Switching Between the Display and Inserting Interfaces</span></span>

<span data-ttu-id="cc202-240">На этом этапе мы завершили разметку для наших отображения и вставка интерфейсов, но мы повторно по-прежнему остается две задачи:</span><span class="sxs-lookup"><span data-stu-id="cc202-240">At this point we have completed the markup for our display and inserting interfaces, but we re still left with two tasks:</span></span>

- <span data-ttu-id="cc202-241">Переключение между отображением и вставка интерфейсов</span><span class="sxs-lookup"><span data-stu-id="cc202-241">Switching between the display and inserting interfaces</span></span>
- <span data-ttu-id="cc202-242">Добавление продуктов в в комплект поставки в базу данных</span><span class="sxs-lookup"><span data-stu-id="cc202-242">Adding the products in the shipment to the database</span></span>

<span data-ttu-id="cc202-243">В настоящее время отображения интерфейса отображается, но интерфейс вставки скрыт.</span><span class="sxs-lookup"><span data-stu-id="cc202-243">Currently, the display interface is visible but the inserting interface is hidden.</span></span> <span data-ttu-id="cc202-244">Это обусловлено `DisplayInterface` панели s `Visible` свойству `true` (значение по умолчанию), хотя `InsertingInterface` панели s `Visible` свойство имеет значение `false`.</span><span class="sxs-lookup"><span data-stu-id="cc202-244">This is because the `DisplayInterface` Panel s `Visible` property is set to `true` (the default value), while the `InsertingInterface` Panel s `Visible` property is set to `false`.</span></span> <span data-ttu-id="cc202-245">Для переключения между двумя интерфейсами, нам просто нужно переключить каждого элемента управления s `Visible` значение свойства.</span><span class="sxs-lookup"><span data-stu-id="cc202-245">To switch between the two interfaces we simply need to toggle each control s `Visible` property value.</span></span>

<span data-ttu-id="cc202-246">Мы хотим переместить из интерфейса отображения интерфейса вставки при нажатии кнопки процесса поставки продукта.</span><span class="sxs-lookup"><span data-stu-id="cc202-246">We want to move from the display interface to the inserting interface when the Process Product Shipment button is clicked.</span></span> <span data-ttu-id="cc202-247">Таким образом, создайте обработчик событий для данной кнопки s `Click` событие, содержащее следующий код:</span><span class="sxs-lookup"><span data-stu-id="cc202-247">Therefore, create an event handler for this Button s `Click` event that contains the following code:</span></span>


[!code-csharp[Main](batch-inserting-cs/samples/sample4.cs)]

<span data-ttu-id="cc202-248">Этот код просто скрывает `DisplayInterface` панели и показывает `InsertingInterface` панели.</span><span class="sxs-lookup"><span data-stu-id="cc202-248">This code simply hides the `DisplayInterface` Panel and shows the `InsertingInterface` Panel.</span></span>

<span data-ttu-id="cc202-249">Создайте обработчики событий для продуктов добавьте из элементов управления отгрузки и кнопку отмены в интерфейсе правки.</span><span class="sxs-lookup"><span data-stu-id="cc202-249">Next, create event handlers for the Add Products from Shipment and Cancel Button controls in the inserting interface.</span></span> <span data-ttu-id="cc202-250">При щелчке любой из этих кнопок, нам нужно вернуться к отображения интерфейса.</span><span class="sxs-lookup"><span data-stu-id="cc202-250">When either of these Buttons is clicked, we need to revert back to the display interface.</span></span> <span data-ttu-id="cc202-251">Создание `Click` обработчики событий для обоих кнопочные элементы управления, таким образом, чтобы они вызывают `ReturnToDisplayInterface`, метод, мы добавим моментально.</span><span class="sxs-lookup"><span data-stu-id="cc202-251">Create `Click` event handlers for both Button controls so that they call `ReturnToDisplayInterface`, a method we will add momentarily.</span></span> <span data-ttu-id="cc202-252">В дополнение к скрытие `InsertingInterface` панели и отображение `DisplayInterface` панели `ReturnToDisplayInterface` метод должен возвращать веб-элементов управления в их состояние до редактирования.</span><span class="sxs-lookup"><span data-stu-id="cc202-252">In addition to hiding the `InsertingInterface` Panel and showing the `DisplayInterface` Panel, the `ReturnToDisplayInterface` method needs to return the Web controls to their pre-editing state.</span></span> <span data-ttu-id="cc202-253">Это включает в себя установку элементов управления DropDownList `SelectedIndex` равными 0 и очищая `Text` свойства элементов управления TextBox.</span><span class="sxs-lookup"><span data-stu-id="cc202-253">This involves setting the DropDownLists `SelectedIndex` properties to 0 and clearing out the `Text` properties of the TextBox controls.</span></span>

> [!NOTE]
> <span data-ttu-id="cc202-254">Рассмотрим, что может произойти, если мы t возвращать элементы управления в их состояние до редактирования перед возвратом к интерфейсу отображения.</span><span class="sxs-lookup"><span data-stu-id="cc202-254">Consider what might happen if we didn t return the controls to their pre-editing state before returning to the display interface.</span></span> <span data-ttu-id="cc202-255">Пользователь может поставки продукта процесса нажмите кнопку, введите продукты из отгрузки и нажмите кнопку Добавить продукты из отгрузки.</span><span class="sxs-lookup"><span data-stu-id="cc202-255">A user might click the Process Product Shipment button, enter the products from the shipment, and then click Add Products from Shipment.</span></span> <span data-ttu-id="cc202-256">Это бы добавить продукты и возвращают данные о пользователе для отображения интерфейса.</span><span class="sxs-lookup"><span data-stu-id="cc202-256">This would add the products and return the user to the display interface.</span></span> <span data-ttu-id="cc202-257">На этом этапе пользователь может потребоваться добавить другой посылке.</span><span class="sxs-lookup"><span data-stu-id="cc202-257">At this point the user might want to add another shipment.</span></span> <span data-ttu-id="cc202-258">После нажатия кнопки поставки продукта процесс кнопкой, к которой будет возвращена к интерфейсу вставки, но DropDownList выбранные параметры и значения в текстовое поле по-прежнему содержались бы свои прежние значения.</span><span class="sxs-lookup"><span data-stu-id="cc202-258">Upon clicking the Process Product Shipment button they would return to the inserting interface but the DropDownList selections and TextBox values would still be populated with their previous values.</span></span>


[!code-csharp[Main](batch-inserting-cs/samples/sample5.cs)]

<span data-ttu-id="cc202-259">Оба `Click` обработчики событий, просто вызовите `ReturnToDisplayInterface` метод, несмотря на то, что мы вернемся к добавить продукты из поставки `Click` обработчик событий в шаге 4 и добавьте код для сохранения продукты.</span><span class="sxs-lookup"><span data-stu-id="cc202-259">Both `Click` event handlers simply call the `ReturnToDisplayInterface` method, although we'll return to the Add Products from Shipment `Click` event handler in Step 4 and add code to save the products.</span></span> <span data-ttu-id="cc202-260">`ReturnToDisplayInterface` Запускает, возвращая `Suppliers` и `Categories` элементов управления DropDownList для их сначала параметров.</span><span class="sxs-lookup"><span data-stu-id="cc202-260">`ReturnToDisplayInterface` starts by returning the `Suppliers` and `Categories` DropDownLists to their first options.</span></span> <span data-ttu-id="cc202-261">Две константы `firstControlID` и `lastControlID` пометить начальное и конечное значения индекса элемента управления, используемое для именования продукта имя и цену за единицу текстовые поля в Вставка интерфейса и используются в границы `for` цикл, который задает `Text`свойства элементов управления TextBox обратно в пустую строку.</span><span class="sxs-lookup"><span data-stu-id="cc202-261">The two constants `firstControlID` and `lastControlID` mark the starting and ending control index values used in naming the product name and unit price TextBoxes in the inserting interface and are used in the bounds of the `for` loop that sets the `Text` properties of the TextBox controls back to an empty string.</span></span> <span data-ttu-id="cc202-262">Наконец, панелей `Visible` свойства сбрасываются, таким образом, чтобы интерфейс вставки скрыт и отображения интерфейса показано.</span><span class="sxs-lookup"><span data-stu-id="cc202-262">Finally, the Panels `Visible` properties are reset so that the inserting interface is hidden and the display interface shown.</span></span>

<span data-ttu-id="cc202-263">Отвлекитесь и проверьте страницу в браузере.</span><span class="sxs-lookup"><span data-stu-id="cc202-263">Take a moment to test out this page in a browser.</span></span> <span data-ttu-id="cc202-264">При первом просмотре странице вы увидите интерфейс отображения, как было показано на рис. 5.</span><span class="sxs-lookup"><span data-stu-id="cc202-264">When first visiting the page you should see the display interface as was shown in Figure 5.</span></span> <span data-ttu-id="cc202-265">Нажмите кнопку процесса поставки продукта.</span><span class="sxs-lookup"><span data-stu-id="cc202-265">Click the Process Product Shipment button.</span></span> <span data-ttu-id="cc202-266">Будет обратной передачи страницы, и теперь вы увидите интерфейс вставки как показано на рис. 12.</span><span class="sxs-lookup"><span data-stu-id="cc202-266">The page will postback and you should now see the inserting interface as shown in Figure 12.</span></span> <span data-ttu-id="cc202-267">Щелкнув либо добавить продукты из отгрузки или «Отмена» снова отображения интерфейса.</span><span class="sxs-lookup"><span data-stu-id="cc202-267">Clicking either the Add Products from Shipment or Cancel buttons returns you to the display interface.</span></span>

> [!NOTE]
> <span data-ttu-id="cc202-268">При просмотре интерфейса вставки, Отвлекитесь и проверьте его CompareValidators на цену единицы текстовые поля.</span><span class="sxs-lookup"><span data-stu-id="cc202-268">While viewing the inserting interface, take a moment to test out the CompareValidators on the unit price TextBoxes.</span></span> <span data-ttu-id="cc202-269">Вы должны увидеть окно messagebox клиентские предупреждение при нажатии кнопки Добавить продукты из кнопки отгрузки с недопустимым денежных значений или цены с значение меньше нуля.</span><span class="sxs-lookup"><span data-stu-id="cc202-269">You should see a client-side messagebox warning when clicking the Add Products from Shipment button with invalid currency values or prices with a value less than zero.</span></span>


<span data-ttu-id="cc202-270">[![Интерфейс вставки отображается после нажатия кнопки «обработать» поставки продукта](batch-inserting-cs/_static/image35.png)](batch-inserting-cs/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="cc202-270">[![The Inserting Interface is Displayed After Clicking the Process Product Shipment Button](batch-inserting-cs/_static/image35.png)](batch-inserting-cs/_static/image34.png)</span></span>

<span data-ttu-id="cc202-271">**Рис. 12**: Интерфейс вставки отображается после нажатия кнопки «обработать» поставки продукта ([Просмотр полноразмерного изображения](batch-inserting-cs/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="cc202-271">**Figure 12**: The Inserting Interface is Displayed After Clicking the Process Product Shipment Button ([Click to view full-size image](batch-inserting-cs/_static/image36.png))</span></span>


## <a name="step-4-adding-the-products"></a><span data-ttu-id="cc202-272">Шаг 4. Добавление продуктов</span><span class="sxs-lookup"><span data-stu-id="cc202-272">Step 4: Adding the Products</span></span>

<span data-ttu-id="cc202-273">Это руководство представляет собой для сохранения продукты в базу данных в новый товар из s отгрузки кнопка остается `Click` обработчик событий.</span><span class="sxs-lookup"><span data-stu-id="cc202-273">All that remains for this tutorial is to save the products to the database in the Add Products from Shipment Button s `Click` event handler.</span></span> <span data-ttu-id="cc202-274">Это можно сделать, создав `ProductsDataTable` и добавление `ProductsRow` экземпляра для каждого из названий продуктов, которые предоставлены.</span><span class="sxs-lookup"><span data-stu-id="cc202-274">This can be accomplished by creating a `ProductsDataTable` and adding a `ProductsRow` instance for each of the product names supplied.</span></span> <span data-ttu-id="cc202-275">Один раз они `ProductsRow` , которые были добавлены будет сделан вызов `ProductsBLL` класс s `UpdateWithTransaction` метод передавая `ProductsDataTable`.</span><span class="sxs-lookup"><span data-stu-id="cc202-275">Once these `ProductsRow` s have been added we will make a call to the `ProductsBLL` class s `UpdateWithTransaction` method passing in the `ProductsDataTable`.</span></span> <span data-ttu-id="cc202-276">Помните, что `UpdateWithTransaction` метод, который был создан в [перенос изменений базы данных в транзакции](wrapping-database-modifications-within-a-transaction-cs.md) учебника, передает `ProductsDataTable` для `ProductsTableAdapter` s `UpdateWithTransaction` метод.</span><span class="sxs-lookup"><span data-stu-id="cc202-276">Recall that the `UpdateWithTransaction` method, which was created back in the [Wrapping Database Modifications within a Transaction](wrapping-database-modifications-within-a-transaction-cs.md) tutorial, passes the `ProductsDataTable` to the `ProductsTableAdapter` s `UpdateWithTransaction` method.</span></span> <span data-ttu-id="cc202-277">После этого запускается транзакции ADO.NET и проблемы TableAdatper `INSERT` инструкции в базу данных для каждого добавленного `ProductsRow` в объекте DataTable.</span><span class="sxs-lookup"><span data-stu-id="cc202-277">From there, an ADO.NET transaction is started and the TableAdatper issues an `INSERT` statement to the database for each added `ProductsRow` in the DataTable.</span></span> <span data-ttu-id="cc202-278">Предположим, что все продукты добавляются без ошибок, транзакция фиксируется, в противном случае она откатывается.</span><span class="sxs-lookup"><span data-stu-id="cc202-278">Assuming all products are added without error, the transaction is committed, otherwise it is rolled back.</span></span>

<span data-ttu-id="cc202-279">Код для добавить продукты из s кнопку отгрузки `Click` обработчик событий также требуется выполнить проверку ошибок.</span><span class="sxs-lookup"><span data-stu-id="cc202-279">The code for the Add Products from Shipment Button s `Click` event handler also needs to perform a bit of error checking.</span></span> <span data-ttu-id="cc202-280">Так как не RequiredFieldValidators, используемый в интерфейсе правки, пользователь может ввести цену для продукта опустив его имя.</span><span class="sxs-lookup"><span data-stu-id="cc202-280">Since there are no RequiredFieldValidators used in the inserting interface, a user could enter a price for a product while omitting its name.</span></span> <span data-ttu-id="cc202-281">Так как имя продукта s является обязательным, если такое состояние развертывания мы должны предупредить пользователя и не выполняйте операции вставки.</span><span class="sxs-lookup"><span data-stu-id="cc202-281">Since the product s name is required, if such a condition unfolds we need to alert the user and not proceed with the inserts.</span></span> <span data-ttu-id="cc202-282">Полный `Click` соответствует код обработчика событий:</span><span class="sxs-lookup"><span data-stu-id="cc202-282">The complete `Click` event handler code follows:</span></span>


[!code-csharp[Main](batch-inserting-cs/samples/sample6.cs)]

<span data-ttu-id="cc202-283">Обработчик событий начинается с обеспечения `Page.IsValid` свойство возвращает значение `true`.</span><span class="sxs-lookup"><span data-stu-id="cc202-283">The event handler starts by ensuring that the `Page.IsValid` property returns a value of `true`.</span></span> <span data-ttu-id="cc202-284">Если он возвращает `false`это означает, что один или несколько CompareValidators сообщаете недопустимые данные; в этом случае мы не хотим попытка вставить введенный продуктов и нажмите мы получим исключение при попытке назначить цена за единицу, введенный пользователем значение `ProductsRow` s `UnitPrice` свойство.</span><span class="sxs-lookup"><span data-stu-id="cc202-284">If it returns `false`, then that means one or more of the CompareValidators are reporting invalid data; in such a case we do not want to attempt to insert the entered products or we'll end up with an exception when attempting to assign the user-entered unit price value to the `ProductsRow` s `UnitPrice` property.</span></span>

<span data-ttu-id="cc202-285">Далее, новый `ProductsDataTable` создается экземпляр (`products`).</span><span class="sxs-lookup"><span data-stu-id="cc202-285">Next, a new `ProductsDataTable` instance is created (`products`).</span></span> <span data-ttu-id="cc202-286">Объект `for` цикла используется для итерации по продукту имя и цену за единицу текстовые поля и `Text` свойства считываются в локальные переменные `productName` и `unitPrice`.</span><span class="sxs-lookup"><span data-stu-id="cc202-286">A `for` loop is used to iterate through the product name and unit price TextBoxes and the `Text` properties are read into the local variables `productName` and `unitPrice`.</span></span> <span data-ttu-id="cc202-287">Если пользователь ввел значение цены за единицу, но не имя соответствующего продукта `StatusLabel` отображает сообщение, если указать цену единицы, вы должны также включать имя продукта и выходе из обработчика событий.</span><span class="sxs-lookup"><span data-stu-id="cc202-287">If the user has entered a value for the unit price but not for the corresponding product name, the `StatusLabel` displays the message If you provide a unit price you must also include the name of the product and the event handler is exited.</span></span>

<span data-ttu-id="cc202-288">Если указано имя продукта, новый `ProductsRow` создается экземпляр с помощью `ProductsDataTable` s `NewProductsRow` метод.</span><span class="sxs-lookup"><span data-stu-id="cc202-288">If a product name has been provided, a new `ProductsRow` instance is created using the `ProductsDataTable` s `NewProductsRow` method.</span></span> <span data-ttu-id="cc202-289">Этот новый `ProductsRow` экземпляра s `ProductName` свойству текущего продукта имя текстового поля при `SupplierID` и `CategoryID` которых присвоены `SelectedValue` свойства элементов управления DropDownList в заголовке вставки интерфейса s.</span><span class="sxs-lookup"><span data-stu-id="cc202-289">This new `ProductsRow` instance s `ProductName` property is set to the current product name TextBox while the `SupplierID` and `CategoryID` properties are assigned to the `SelectedValue` properties of the DropDownLists in the inserting interface s header.</span></span> <span data-ttu-id="cc202-290">Если пользователь ввел значение цены продукта s, она назначается `ProductsRow` экземпляра s `UnitPrice` свойство; в противном случае свойство является слева без конкретного указания, что приведет к `NULL` значение `UnitPrice` в базе данных.</span><span class="sxs-lookup"><span data-stu-id="cc202-290">If the user entered a value for the product s price, it is assigned to the `ProductsRow` instance s `UnitPrice` property; otherwise, the property is left unassigned, which will result in a `NULL` value for `UnitPrice` in the database.</span></span> <span data-ttu-id="cc202-291">Наконец `Discontinued` и `UnitsOnOrder` которых присвоены значения жестко `false` и 0 соответственно.</span><span class="sxs-lookup"><span data-stu-id="cc202-291">Finally, the `Discontinued` and `UnitsOnOrder` properties are assigned to the hard-coded values `false` and 0, respectively.</span></span>

<span data-ttu-id="cc202-292">После свойства, назначенные `ProductsRow` он добавляется в экземпляр `ProductsDataTable`.</span><span class="sxs-lookup"><span data-stu-id="cc202-292">After the properties have been assigned to the `ProductsRow` instance it is added to the `ProductsDataTable`.</span></span>

<span data-ttu-id="cc202-293">По завершении `for` цикла, мы проверяем, были ли добавлены все продукты.</span><span class="sxs-lookup"><span data-stu-id="cc202-293">At the completion of the `for` loop, we check whether any products have been added.</span></span> <span data-ttu-id="cc202-294">Пользователь может в конце концов, щелкнул добавить продукты из отгрузки перед вводом все названия продуктов или цены.</span><span class="sxs-lookup"><span data-stu-id="cc202-294">The user may, after all, have clicked the Add Products from Shipment before entering any product names or prices.</span></span> <span data-ttu-id="cc202-295">Если имеется хотя бы один продукт в `ProductsDataTable`, `ProductsBLL` класс s `UpdateWithTransaction` вызывается метод.</span><span class="sxs-lookup"><span data-stu-id="cc202-295">If there is at least one product in the `ProductsDataTable`, the `ProductsBLL` class s `UpdateWithTransaction` method is called.</span></span> <span data-ttu-id="cc202-296">Далее, привязываются к `ProductsGrid` GridView так, чтобы отображались новые продукты в интерфейсе отображения.</span><span class="sxs-lookup"><span data-stu-id="cc202-296">Next, the data is rebound to the `ProductsGrid` GridView so that the newly added products will appear in the display interface.</span></span> <span data-ttu-id="cc202-297">`StatusLabel` Обновляется и отображает сообщение с подтверждением и `ReturnToDisplayInterface` вызывается, скрытие интерфейсу правки и отображения отображения интерфейса.</span><span class="sxs-lookup"><span data-stu-id="cc202-297">The `StatusLabel` is updated to display a confirmation message and the `ReturnToDisplayInterface` is invoked, hiding the inserting interface and showing the display interface.</span></span>

<span data-ttu-id="cc202-298">Если продукты не были введены, но продукты не были добавлены сообщение отображается интерфейс вставки.</span><span class="sxs-lookup"><span data-stu-id="cc202-298">If no products were entered, the inserting interface remains displayed but the message No products were added.</span></span> <span data-ttu-id="cc202-299">Введите названия продуктов и отображается цены в текстовых полях.</span><span class="sxs-lookup"><span data-stu-id="cc202-299">Please enter the product names and unit prices in the textboxes is displayed.</span></span>

<span data-ttu-id="cc202-300">S рис 13, 14 и 15 Показать вставку и отображать интерфейсы в действии.</span><span class="sxs-lookup"><span data-stu-id="cc202-300">Figure s 13, 14, and 15 show the inserting and display interfaces in action.</span></span> <span data-ttu-id="cc202-301">На рис. 13 что пользователь ввел значение цены единицы без соответствующего имени продукта.</span><span class="sxs-lookup"><span data-stu-id="cc202-301">In Figure 13, the user has entered a unit price value without a corresponding product name.</span></span> <span data-ttu-id="cc202-302">Рис. 14 показаны отображения интерфейса после трех новых продуктов были успешно добавлены, а рис. 15 двух продуктов, добавленный в GridView (третье — на предыдущей странице).</span><span class="sxs-lookup"><span data-stu-id="cc202-302">Figure 14 shows the display interface after three new products have been added successfully, while Figure 15 shows two of the newly added products in the GridView (the third one is on the previous page).</span></span>


<span data-ttu-id="cc202-303">[![Название продукта — требуется при вводе цена за единицу](batch-inserting-cs/_static/image38.png)](batch-inserting-cs/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="cc202-303">[![A Product Name is Required When Entering a Unit Price](batch-inserting-cs/_static/image38.png)](batch-inserting-cs/_static/image37.png)</span></span>

<span data-ttu-id="cc202-304">**Рис. 13**: Название продукта — требуется при вводе цена за единицу ([Просмотр полноразмерного изображения](batch-inserting-cs/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="cc202-304">**Figure 13**: A Product Name is Required When Entering a Unit Price ([Click to view full-size image](batch-inserting-cs/_static/image39.png))</span></span>


<span data-ttu-id="cc202-305">[![Для поставщика были добавлены три новые Veggies Mayumi s](batch-inserting-cs/_static/image41.png)](batch-inserting-cs/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="cc202-305">[![Three New Veggies Have Been Added for the Supplier Mayumi s](batch-inserting-cs/_static/image41.png)](batch-inserting-cs/_static/image40.png)</span></span>

<span data-ttu-id="cc202-306">**Рис. 14**: Три новых Veggies были добавлены для поставщика Mayumi s ([Просмотр полноразмерного изображения](batch-inserting-cs/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="cc202-306">**Figure 14**: Three New Veggies Have Been Added for the Supplier Mayumi s ([Click to view full-size image](batch-inserting-cs/_static/image42.png))</span></span>


<span data-ttu-id="cc202-307">[![Новые продукты можно найти на последней странице элемента управления GridView](batch-inserting-cs/_static/image44.png)](batch-inserting-cs/_static/image43.png)</span><span class="sxs-lookup"><span data-stu-id="cc202-307">[![The New Products Can Be Found in the Last Page of the GridView](batch-inserting-cs/_static/image44.png)](batch-inserting-cs/_static/image43.png)</span></span>

<span data-ttu-id="cc202-308">**Рис. 15**: Новые продукты можно найти на последней странице элемента управления GridView ([Просмотр полноразмерного изображения](batch-inserting-cs/_static/image45.png))</span><span class="sxs-lookup"><span data-stu-id="cc202-308">**Figure 15**: The New Products Can Be Found in the Last Page of the GridView ([Click to view full-size image](batch-inserting-cs/_static/image45.png))</span></span>


> [!NOTE]
> <span data-ttu-id="cc202-309">Вставка логики, используемой в этом руководстве пакета является оболочкой для операции вставки в пределах области транзакции.</span><span class="sxs-lookup"><span data-stu-id="cc202-309">The batch inserting logic used in this tutorial wraps the inserts within the scope of transaction.</span></span> <span data-ttu-id="cc202-310">Чтобы проверить это, намеренно вызвать ошибку на уровне базы данных.</span><span class="sxs-lookup"><span data-stu-id="cc202-310">To verify this, purposefully introduce a database-level error.</span></span> <span data-ttu-id="cc202-311">Например, вместо того чтобы назначение нового `ProductsRow` экземпляра s `CategoryID` свойство для значения, выбранного в `Categories` DropDownList, назначить его значение, например `i * 5`.</span><span class="sxs-lookup"><span data-stu-id="cc202-311">For example, rather than assigning the new `ProductsRow` instance s `CategoryID` property to the selected value in the `Categories` DropDownList, assign it to a value like `i * 5`.</span></span> <span data-ttu-id="cc202-312">Здесь `i` является индексатором цикла и содержит значения в диапазоне от 1 до 5.</span><span class="sxs-lookup"><span data-stu-id="cc202-312">Here `i` is the loop indexer and has values ranging from 1 to 5.</span></span> <span data-ttu-id="cc202-313">Таким образом, при добавлении двух или более продуктов в пакетной службе вставьте первый продукт будет иметь допустимое `CategoryID` будет иметь значение (5), но последующие продуктов `CategoryID` значения, которые не соответствуют до `CategoryID` значения в `Categories` таблицы.</span><span class="sxs-lookup"><span data-stu-id="cc202-313">Therefore, when adding two or more products in batch insert the first product will have a valid `CategoryID` value (5), but subsequent products will have `CategoryID` values that do not match up to `CategoryID` values in the `Categories` table.</span></span> <span data-ttu-id="cc202-314">В итоге получается, во время первого `INSERT` будет выполнена успешно, последующие завершится ошибкой с нарушением ограничения внешнего ключа.</span><span class="sxs-lookup"><span data-stu-id="cc202-314">The net effect is that while the first `INSERT` will succeed, subsequent ones will fail with a foreign key constraint violation.</span></span> <span data-ttu-id="cc202-315">Так как Пакетная вставка является атомарной, первый `INSERT` будет выполнен откат, возврат базы данных в его состояние до пакетной вставки процесс начался.</span><span class="sxs-lookup"><span data-stu-id="cc202-315">Since the batch insert is atomic, the first `INSERT` will be rolled back, returning the database to its state before the batch insert process began.</span></span>


## <a name="summary"></a><span data-ttu-id="cc202-316">Сводка</span><span class="sxs-lookup"><span data-stu-id="cc202-316">Summary</span></span>

<span data-ttu-id="cc202-317">В этом и предыдущем два учебника мы создали, позволяющих обновление, удаление, и вставка пакеты данных, которые использовать поддержку транзакций, мы добавили уровень доступа к данным в [перенос изменений базы данных в рамках транзакции](wrapping-database-modifications-within-a-transaction-cs.md) руководства.</span><span class="sxs-lookup"><span data-stu-id="cc202-317">Over this and the previous two tutorials we have created interfaces that allow for updating, deleting, and inserting batches of data, all of which used the transaction support we added to the Data Access Layer in the [Wrapping Database Modifications within a Transaction](wrapping-database-modifications-within-a-transaction-cs.md) tutorial.</span></span> <span data-ttu-id="cc202-318">Для некоторых сценариев, такие интерфейсы пользователя пакетной обработки значительно повышают эффективность работы конечного пользователя сокращая вниз на количество щелчков, обратных вызовов и переключений контекста клавиатуры для мыши, одновременно сохраняя целостность базовых данных.</span><span class="sxs-lookup"><span data-stu-id="cc202-318">For certain scenarios, such batch processing user interfaces greatly improve end user efficiency by cutting down on the number of clicks, postbacks, and keyboard-to-mouse context switches, while also maintaining the integrity of the underlying data.</span></span>

<span data-ttu-id="cc202-319">Этот учебник завершает наш взгляд на работа с пакетными данными.</span><span class="sxs-lookup"><span data-stu-id="cc202-319">This tutorial completes our look at working with batched data.</span></span> <span data-ttu-id="cc202-320">Следующий набор учебных курсов исследует различных сложных сценариях уровня доступа к данным, включая использование хранимых процедур в s методов класса TableAdapter, настройки уровня подключения и команды в DAL, шифрования строк подключения и многое другое!</span><span class="sxs-lookup"><span data-stu-id="cc202-320">The next set of tutorials explores a variety of advanced Data Access Layer scenarios, including using stored procedures in the TableAdapter s methods, configuring connection- and command-level settings in the DAL, encrypting connection strings, and more!</span></span>

<span data-ttu-id="cc202-321">Счастливого вам программирования!</span><span class="sxs-lookup"><span data-stu-id="cc202-321">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="cc202-322">Об авторе</span><span class="sxs-lookup"><span data-stu-id="cc202-322">About the Author</span></span>

<span data-ttu-id="cc202-323">[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи книг по ASP/ASP.NET и основатель веб- [4GuysFromRolla.com](http://www.4guysfromrolla.com), работает с веб-технологиями Microsoft с 1998 года.</span><span class="sxs-lookup"><span data-stu-id="cc202-323">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="cc202-324">Скотт — независимый консультант, преподаватель и автор.</span><span class="sxs-lookup"><span data-stu-id="cc202-324">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="cc202-325">Его последняя книга — [ *Sams Teach ASP.NET 2.0 in 24 часа*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="cc202-325">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="cc202-326">Ним можно связаться по адресу [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="cc202-326">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="cc202-327">или через его блог, который можно найти в [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="cc202-327">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="cc202-328">Особая благодарность</span><span class="sxs-lookup"><span data-stu-id="cc202-328">Special Thanks To</span></span>

<span data-ttu-id="cc202-329">В этой серии руководств пособий рецензировалась многими компетентными редакторами.</span><span class="sxs-lookup"><span data-stu-id="cc202-329">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="cc202-330">Привести рецензентов в этом руководстве, были (Hilton giesenow) и S ren Алексей Lauritsen.</span><span class="sxs-lookup"><span data-stu-id="cc202-330">Lead reviewers for this tutorial were Hilton Giesenow and S ren Jacob Lauritsen.</span></span> <span data-ttu-id="cc202-331">Хотите поработать с моих последующих статей для MSDN?</span><span class="sxs-lookup"><span data-stu-id="cc202-331">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="cc202-332">Если Да, напишите мне [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="cc202-332">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="cc202-333">[Назад](batch-deleting-cs.md)
> [Вперед](wrapping-database-modifications-within-a-transaction-vb.md)</span><span class="sxs-lookup"><span data-stu-id="cc202-333">[Previous](batch-deleting-cs.md)
[Next](wrapping-database-modifications-within-a-transaction-vb.md)</span></span>
