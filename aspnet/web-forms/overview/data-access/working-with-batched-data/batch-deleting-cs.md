---
uid: web-forms/overview/data-access/working-with-batched-data/batch-deleting-cs
title: Пакетное удаление (C#) | Документация Майкрософт
author: rick-anderson
description: Узнайте, как удалить несколько записей базы данных в рамках одной операции. В слой пользовательского интерфейса мы созданы на основе расширенного GridView, созданные в предыдущем шаге tut...
ms.author: riande
ms.date: 06/26/2007
ms.assetid: ac6916d0-a5ab-4218-9760-7ba9e72d258c
msc.legacyurl: /web-forms/overview/data-access/working-with-batched-data/batch-deleting-cs
msc.type: authoredcontent
ms.openlocfilehash: da913e08cd007a89b659f87ef30ea15160692c09
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59416952"
---
# <a name="batch-deleting-c"></a>Пакетное удаление (C#)

по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Скачать код](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_65_CS.zip) или [скачать PDF](batch-deleting-cs/_static/datatutorial65cs1.pdf)

> Узнайте, как удалить несколько записей базы данных в рамках одной операции. В слой пользовательского интерфейса мы созданы на основе расширенного GridView, созданные в предыдущем руководстве. В уровень доступа к данным мы Подведем краткие нескольких операций удаления в рамках транзакции, чтобы убедиться, что все операции удаления успешно или откатываются все операции удаления.


## <a name="introduction"></a>Вступление

[Предыдущем учебном курсе](batch-updating-cs.md) показано, как создать пакет редактирования интерфейса с помощью полностью изменяемого элемента управления GridView. В ситуациях, где пользователи часто изменяете большое количество записей одновременно, интерфейс редактирования пакета потребуется гораздо меньшее число обратных передач и клавиатуры для мыши контекст коммутаторов, тем самым повышая эффективность s конечного пользователя. Аналогичным образом, этот метод полезен для страниц, где довольно часто пользователям удалять многие записи за одно действие.

Всем, кто использовал online почтовый клиент уже знакомы с одной из наиболее распространенных пакетной службы, удаление интерфейсов: кнопку флажок в каждой строке в сетке с соответствующей удалить все флажки (см. рис. 1). Это руководство представляет собой довольно короткий так как мы сделали это все часть тяжелой работы в предыдущих учебных курсах, при создании веб-интерфейса и метод, чтобы удалить ряд записей в рамках одной атомарной операции продуктом. В [Добавление столбца GridView флажков](../enhancing-the-gridview/adding-a-gridview-column-of-checkboxes-cs.md) руководстве мы создали GridView с помощью столбца флажков, так и в [перенос изменений базы данных в транзакции](wrapping-database-modifications-within-a-transaction-cs.md) руководстве мы создали метод в BLL, который будет использовать транзакцию, чтобы удалить `List<T>` из `ProductID` значения. В этом руководстве мы созданы на основе и слияния наш предыдущий опыт для создания раздела рабочий пример удаления.


[![Каждая строка включает флажок](batch-deleting-cs/_static/image1.gif)](batch-deleting-cs/_static/image1.png)

**Рис. 1**: Каждая строка включает флажок ([Просмотр полноразмерного изображения](batch-deleting-cs/_static/image2.png))


## <a name="step-1-creating-the-batch-deleting-interface"></a>Шаг 1. Создание пакета, удаление интерфейса

Так как мы уже создали удаление интерфейса в пакете [Добавление столбца GridView флажков](../enhancing-the-gridview/adding-a-gridview-column-of-checkboxes-cs.md) руководстве мы просто скопировать его, чтобы `BatchDelete.aspx` вместо его создания с нуля. Сначала откройте `BatchDelete.aspx` странице в `BatchData` папки и `CheckBoxField.aspx` странице в `EnhancedGridView` папку. Из `CheckBoxField.aspx` страницы, перейдите в представление источника и скопировать разметку между `<asp:Content>` тегов, как показано на рис. 2.


[![Скопируйте декларативную разметку CheckBoxField.aspx в буфер обмена](batch-deleting-cs/_static/image2.gif)](batch-deleting-cs/_static/image3.png)

**Рис. 2**: Скопируйте декларативную разметку `CheckBoxField.aspx` в буфер обмена ([Просмотр полноразмерного изображения](batch-deleting-cs/_static/image4.png))


Теперь перейдите к представлению источника в `BatchDelete.aspx` и вставьте содержимое буфера обмена в `<asp:Content>` теги. Также скопируйте и вставьте код из класса кода в `CheckBoxField.aspx.cs` для класса кода в `BatchDelete.aspx.cs` ( `DeleteSelectedProducts` кнопку s `Click` обработчик событий, `ToggleCheckState` метод и `Click` обработчики событий для `CheckAll` и `UncheckAll` кнопки). После копирования через это содержимое, `BatchDelete.aspx` вспомогательном классе страницы s должен содержать следующий код:


[!code-csharp[Main](batch-deleting-cs/samples/sample1.cs)]

После копирования декларативную разметку и исходный код, Отвлекитесь и протестировать `BatchDelete.aspx` , просмотрев его через браузер. Вы должны увидеть список первых десяти продуктов в элементе управления GridView, где каждая строка содержит название продукта s, категория и цена, а также флажок элемента управления GridView. Должно быть три кнопки: Отметьте все, снимите все флажки и удаления выбранных продуктов. Кнопки проверьте все выбирает все флажки, хотя снять все очищает все флажки. Нажав кнопку удаления выбранных продуктов отображает сообщение со списком `ProductID` значения выбранных продуктов, но фактически не удаляются продукты.


[![Интерфейс из CheckBoxField.aspx был перемещен в BatchDeleting.aspx](batch-deleting-cs/_static/image3.gif)](batch-deleting-cs/_static/image5.png)

**Рис. 3**: Интерфейс из `CheckBoxField.aspx` был перемещен в `BatchDeleting.aspx` ([Просмотр полноразмерного изображения](batch-deleting-cs/_static/image6.png))


## <a name="step-2-deleting-the-checked-products-using-transactions"></a>Шаг 2. Удаление Checked продуктов, с использованием транзакций

С помощью пакетной службы, удаление интерфейса успешно скопировать `BatchDeleting.aspx`, что все, что остается только обновить код таким образом, чтобы удалить выбранные продукты кнопки удаляет checked продуктов, с использованием `DeleteProductsWithTransaction` метод в `ProductsBLL` класса. Этот метод, добавленные в [перенос изменений базы данных в транзакции](wrapping-database-modifications-within-a-transaction-cs.md) руководстве принимает в качестве входных данных `List<T>` из `ProductID` значений и удаляет каждое из которых соответствует `ProductID` в области действия транзакция.

`DeleteSelectedProducts` Кнопку s `Click` обработчик событий в настоящее время использует следующие `foreach` цикла для перебора всех строк GridView:


[!code-csharp[Main](batch-deleting-cs/samples/sample2.cs)]

Для каждой строки `ProductSelector` программным образом указывается флажок веб-элемента управления. Если он установлен, строка s `ProductID` извлекается из `DataKeys` коллекции и `DeleteResults` метка s `Text` свойство обновляется для включения сообщение о том, что строка была выбрана для удаления.

Приведенный выше код фактически не удаляются все записи как вызов `ProductsBLL` класс s `Delete` метод закомментирован. Были эту логику удаления для применения, код будет удалять продукты, но не в атомарной операции. То есть если первый несколько удалений в последовательности выполнено успешно, но поздней не удалось (возможно, из-за нарушения ограничения внешнего ключа), будет выдано исключение, но эти продукты уже удален сохранится удаленные.

Чтобы обеспечить атомарность, нам нужно вместо этого использовать `ProductsBLL` класс s `DeleteProductsWithTransaction` метод. Так как этот метод принимает список `ProductID` значения, необходимо сначала скомпилировать этот список из сетки и передайте его в качестве параметра. Сначала создается экземпляр `List<T>` типа `int`. В рамках `foreach` цикл, нам нужно добавить выбранные продукты `ProductID` значения к этому `List<T>`. После цикла это `List<T>` должны быть переданы `ProductsBLL` класс s `DeleteProductsWithTransaction` метод. Обновление `DeleteSelectedProducts` кнопку s `Click` обработчик событий следующим кодом:


[!code-csharp[Main](batch-deleting-cs/samples/sample3.cs)]

Обновленный код создает `List<T>` типа `int` (`productIDsToDelete`) и заполняет его значением `ProductID` значения для удаления. После `foreach` цикла, если флажок установлен, хотя бы один продукт `ProductsBLL` класс s `DeleteProductsWithTransaction` вызывается метод и передать этот список. `DeleteResults` Также отображается метка и данные повторно привязываются к GridView (благодаря чему недавно удаленных записей больше не отображаются как строки в сетке).

Рис. 4 показан элемент управления GridView после несколько строк были выбраны для удаления. Рис. 5 показан экран, сразу после нажатия кнопки удаления выбранных продуктов. Обратите внимание, что на рис. 5 `ProductID` в надписи под GridView отображаются значения удаленные записи, и эти строки больше не будут в GridView.


[![Будут удалены выбранные продукты](batch-deleting-cs/_static/image4.gif)](batch-deleting-cs/_static/image7.png)

**Рис. 4**: Выбранные продукты будут удалены ([Просмотр полноразмерного изображения](batch-deleting-cs/_static/image8.png))


[![Удалить продукты ProductID значения в списке под GridView](batch-deleting-cs/_static/image5.gif)](batch-deleting-cs/_static/image9.png)

**Рис. 5**: Продукты удалены `ProductID` значения: в списке под GridView ([Просмотр полноразмерного изображения](batch-deleting-cs/_static/image10.png))


> [!NOTE]
> Для тестирования `DeleteProductsWithTransaction` атомарность метод s, вручную добавьте запись для продукта в `Order Details` таблицы, а затем попытается удалить этот продукт (вместе с другими пользователями). При попытке удалить продукт с связанный заказ, но Обратите внимание на то, как другие удаления выбранных продуктов откатываются, вы получите нарушение ограничения внешнего ключа.


## <a name="summary"></a>Сводка

Создание пакета, удаление интерфейса включает в себя добавление элемента GridView со столбцом флажки и кнопки веб-элемента управления, если он выбран, будут удалены все выбранные строки как одной атомарной операции. В этом руководстве мы создали такой интерфейс путем комбинирования работы, выполненной в двух предыдущих учебных курсах, [Добавление столбца GridView флажков](../enhancing-the-gridview/adding-a-gridview-column-of-checkboxes-cs.md) и [перенос изменений базы данных в транзакции](wrapping-database-modifications-within-a-transaction-cs.md). В первом учебном курсе мы создали GridView со столбцом флажки и во втором была реализована в BLL метод, при передаче `List<T>` из `ProductID` значения, удалить их все в пределах транзакции.

В следующем учебном курсе мы создадим интерфейс для выполнения пакетной вставки.

Счастливого вам программирования!

## <a name="about-the-author"></a>Об авторе

[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи книг по ASP/ASP.NET и основатель веб- [4GuysFromRolla.com](http://www.4guysfromrolla.com), работает с веб-технологиями Microsoft с 1998 года. Скотт — независимый консультант, преподаватель и автор. Его последняя книга — [ *Sams Teach ASP.NET 2.0 in 24 часа*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco). Ним можно связаться по адресу [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) или через его блог, который можно найти в [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).

## <a name="special-thanks-to"></a>Особая благодарность

В этой серии руководств пособий рецензировалась многими компетентными редакторами. (Hilton giesenow) и Терезой Мерфи, стали Лиз Шалок в этом руководстве. Хотите поработать с моих последующих статей для MSDN? Если Да, напишите мне [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)

> [!div class="step-by-step"]
> [Назад](batch-updating-cs.md)
> [Вперед](batch-inserting-cs.md)
