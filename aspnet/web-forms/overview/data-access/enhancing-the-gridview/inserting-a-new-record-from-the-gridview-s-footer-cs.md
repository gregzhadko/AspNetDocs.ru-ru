---
uid: web-forms/overview/data-access/enhancing-the-gridview/inserting-a-new-record-from-the-gridview-s-footer-cs
title: Вставка новой записи из нижнего колонтитула GridView (C#) | Документация Майкрософт
author: rick-anderson
description: Хотя элемент управления GridView не предоставляет встроенную поддержку для вставки новой записи данных, в этом руководстве показано, как дополнить GridView, включив...
ms.author: riande
ms.date: 03/06/2007
ms.assetid: 49545652-98af-46ba-9dbc-9ab529805d9b
msc.legacyurl: /web-forms/overview/data-access/enhancing-the-gridview/inserting-a-new-record-from-the-gridview-s-footer-cs
msc.type: authoredcontent
ms.openlocfilehash: 6b337fe395a0ed54b03767111e73ea6d6c0ba23a
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78477528"
---
# <a name="inserting-a-new-record-from-the-gridviews-footer-c"></a><span data-ttu-id="ae44c-103">Вставка новой записи из нижнего колонтитула GridView (C#)</span><span class="sxs-lookup"><span data-stu-id="ae44c-103">Inserting a New Record from the GridView's Footer (C#)</span></span>

<span data-ttu-id="ae44c-104">по [Скотт Митчелл](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="ae44c-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="ae44c-105">[Скачивание примера приложения](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_53_CS.exe) или [Загрузка PDF-файла](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/datatutorial53cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="ae44c-105">[Download Sample App](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_53_CS.exe) or [Download PDF](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/datatutorial53cs1.pdf)</span></span>

> <span data-ttu-id="ae44c-106">Хотя элемент управления GridView не предоставляет встроенную поддержку для вставки новой записи данных, в этом руководстве показано, как дополнять GridView для включения интерфейса вставки.</span><span class="sxs-lookup"><span data-stu-id="ae44c-106">While the GridView control does not provide built-in support for inserting a new record of data, this tutorial shows how to augment the GridView to include an inserting interface.</span></span>

## <a name="introduction"></a><span data-ttu-id="ae44c-107">Введение</span><span class="sxs-lookup"><span data-stu-id="ae44c-107">Introduction</span></span>

<span data-ttu-id="ae44c-108">Как обсуждалось в [обзоре учебника по вставке, обновлению и удалению данных](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md) , в каждом из элементов управления GridView, DetailsView и FormView представлены встроенные возможности изменения данных.</span><span class="sxs-lookup"><span data-stu-id="ae44c-108">As discussed in the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md) tutorial, the GridView, DetailsView, and FormView Web controls each include built-in data modification capabilities.</span></span> <span data-ttu-id="ae44c-109">При использовании с декларативными элементами управления источниками данных эти три веб-элемента управления можно быстро и легко настроить для изменения данных и в сценариях без необходимости написания одной строки кода.</span><span class="sxs-lookup"><span data-stu-id="ae44c-109">When used with declarative data source controls, these three Web controls can be quickly and easily configured to modify data - and in scenarios without needing to write a single line of code.</span></span> <span data-ttu-id="ae44c-110">К сожалению, только элементы управления DetailsView и FormView предоставляют встроенные возможности для вставки, редактирования и удаления.</span><span class="sxs-lookup"><span data-stu-id="ae44c-110">Unfortunately, only the DetailsView and FormView controls provide built-in inserting, editing, and deleting capabilities.</span></span> <span data-ttu-id="ae44c-111">GridView предлагает только поддержку редактирования и удаления.</span><span class="sxs-lookup"><span data-stu-id="ae44c-111">The GridView only offers editing and deleting support.</span></span> <span data-ttu-id="ae44c-112">Однако с небольшой изогнутой пастой можно дополнить GridView, включив в него интерфейс вставки.</span><span class="sxs-lookup"><span data-stu-id="ae44c-112">However, with a little elbow grease, we can augment the GridView to include an inserting interface.</span></span>

<span data-ttu-id="ae44c-113">При добавлении возможностей вставки в GridView мы будем отвечать за выбор способа добавления новых записей, создание интерфейса вставки и написание кода для вставки новой записи.</span><span class="sxs-lookup"><span data-stu-id="ae44c-113">In adding inserting capabilities to the GridView, we are responsible for deciding on how new records will be added, creating the inserting interface, and writing the code to insert the new record.</span></span> <span data-ttu-id="ae44c-114">В этом учебнике мы рассмотрим Добавление интерфейса вставки в строку нижнего колонтитула GridView (см. рис. 1).</span><span class="sxs-lookup"><span data-stu-id="ae44c-114">In this tutorial we will look at adding the inserting interface to the GridView s footer row (see Figure 1).</span></span> <span data-ttu-id="ae44c-115">Ячейка нижнего колонтитула для каждого столбца содержит соответствующий элемент пользовательского интерфейса сбора данных (текстовое поле для имени продукта, DropDownList для поставщика и т. д.).</span><span class="sxs-lookup"><span data-stu-id="ae44c-115">The footer cell for each column includes the appropriate data collection user interface element (a TextBox for the product s name, a DropDownList for the supplier, and so on).</span></span> <span data-ttu-id="ae44c-116">Нам также нужен столбец для кнопки Add, которая при нажатии вызовет обратную передачу и вставляет новую запись в `Products`ную таблицу, используя значения, указанные в строке нижнего колонтитула.</span><span class="sxs-lookup"><span data-stu-id="ae44c-116">We also need a column for an Add button that, when clicked, will cause a postback and insert a new record into the `Products` table using the values supplied in the footer row.</span></span>

<span data-ttu-id="ae44c-117">[![строка нижнего колонтитула предоставляет интерфейс для добавления новых продуктов](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image1.gif)](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="ae44c-117">[![The Footer Row Provides an Interface for Adding New Products](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image1.gif)](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image1.png)</span></span>

<span data-ttu-id="ae44c-118">**Рис. 1**. строка нижнего колонтитула предоставляет интерфейс для добавления новых продуктов ([щелкните, чтобы просмотреть изображение с полным размером](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="ae44c-118">**Figure 1**: The Footer Row Provides an Interface for Adding New Products ([Click to view full-size image](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image2.png))</span></span>

## <a name="step-1-displaying-product-information-in-a-gridview"></a><span data-ttu-id="ae44c-119">Шаг 1. Отображение сведений о продукте в элементе управления GridView</span><span class="sxs-lookup"><span data-stu-id="ae44c-119">Step 1: Displaying Product Information in a GridView</span></span>

<span data-ttu-id="ae44c-120">Прежде чем мы будем беспокоиться о создании интерфейса вставки в нижнем колонтитуле GridView, давайте попробуем добавить GridView на страницу, в которой перечислены продукты в базе данных.</span><span class="sxs-lookup"><span data-stu-id="ae44c-120">Before we concern ourselves with creating the inserting interface in the GridView s footer, let s first focus on adding a GridView to the page that lists the products in the database.</span></span> <span data-ttu-id="ae44c-121">Для начала откройте страницу `InsertThroughFooter.aspx` в папке `EnhancedGridView` и перетащите элемент управления GridView с панели инструментов в конструктор, установив для свойства `ID` GridView s значение `Products`.</span><span class="sxs-lookup"><span data-stu-id="ae44c-121">Start by opening the `InsertThroughFooter.aspx` page in the `EnhancedGridView` folder and drag a GridView from the Toolbox onto the Designer, setting the GridView s `ID` property to `Products`.</span></span> <span data-ttu-id="ae44c-122">Затем используйте смарт-тег GridView s, чтобы привязать его к новому ObjectDataSource с именем `ProductsDataSource`.</span><span class="sxs-lookup"><span data-stu-id="ae44c-122">Next, use the GridView s smart tag to bind it to a new ObjectDataSource named `ProductsDataSource`.</span></span>

<span data-ttu-id="ae44c-123">[![создать новый элемент управления ObjectDataSource с именем Продуктсдатасаурце](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image2.gif)](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="ae44c-123">[![Create a New ObjectDataSource Named ProductsDataSource](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image2.gif)](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image3.png)</span></span>

<span data-ttu-id="ae44c-124">**Рис. 2**. Создание нового элемента управления ObjectDataSource с именем `ProductsDataSource` ([щелкните, чтобы просмотреть изображение с полным размером](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="ae44c-124">**Figure 2**: Create a New ObjectDataSource Named `ProductsDataSource` ([Click to view full-size image](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image4.png))</span></span>

<span data-ttu-id="ae44c-125">Настройте ObjectDataSource для использования метода `ProductsBLL` классов `GetProducts()` для получения сведений о продукте.</span><span class="sxs-lookup"><span data-stu-id="ae44c-125">Configure the ObjectDataSource to use the `ProductsBLL` class s `GetProducts()` method to retrieve product information.</span></span> <span data-ttu-id="ae44c-126">В этом руководстве мы будем сосредоточиться только на добавлении возможностей вставки, а не беспокоиться об изменении и удалении.</span><span class="sxs-lookup"><span data-stu-id="ae44c-126">For this tutorial, let s focus strictly on adding inserting capabilities and not worry about editing and deleting.</span></span> <span data-ttu-id="ae44c-127">Поэтому убедитесь, что раскрывающийся список на вкладке Вставка имеет значение `AddProduct()` и что в раскрывающихся списках на вкладках обновление и удаление установлено значение (нет).</span><span class="sxs-lookup"><span data-stu-id="ae44c-127">Therefore, make sure that the drop-down list in the INSERT tab is set to `AddProduct()` and that the drop-down lists in the UPDATE and DELETE tabs are set to (None) .</span></span>

<span data-ttu-id="ae44c-128">[![сопоставьте метод AddProduct с методом ObjectDataSource s INSERT ()](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image3.gif)](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="ae44c-128">[![Map the AddProduct Method to the ObjectDataSource s Insert() Method](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image3.gif)](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image5.png)</span></span>

<span data-ttu-id="ae44c-129">**Рис. 3**. сопоставьте метод `AddProduct` с методом `Insert()` ObjectDataSource ([щелкните, чтобы просмотреть изображение с полным размером](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="ae44c-129">**Figure 3**: Map the `AddProduct` Method to the ObjectDataSource s `Insert()` Method ([Click to view full-size image](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image6.png))</span></span>

<span data-ttu-id="ae44c-130">[![задать для раскрывающихся списков обновления и удаления значение (нет)](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image4.gif)](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="ae44c-130">[![Set the UPDATE and DELETE Tabs Drop-Down Lists to (None)](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image4.gif)](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image7.png)</span></span>

<span data-ttu-id="ae44c-131">**Рис. 4**. Установка в раскрывающихся СПИСКАХ «обновление» и «удаление» (нет) ([щелкните, чтобы просмотреть изображение с полным размером](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="ae44c-131">**Figure 4**: Set the UPDATE and DELETE Tabs Drop-Down Lists to (None) ([Click to view full-size image](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image8.png))</span></span>

<span data-ttu-id="ae44c-132">После завершения работы мастера настройки источников данных ObjectDataSource в Visual Studio автоматически добавляются поля в GridView для каждого из соответствующих полей данных.</span><span class="sxs-lookup"><span data-stu-id="ae44c-132">After completing the ObjectDataSource s Configure Data Source wizard, Visual Studio will automatically add fields to the GridView for each of the corresponding data fields.</span></span> <span data-ttu-id="ae44c-133">Пока оставьте все поля, добавленные Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="ae44c-133">For now, leave all of the fields added by Visual Studio.</span></span> <span data-ttu-id="ae44c-134">Далее в этом учебнике мы вернемся и удалим некоторые из полей, значения которых не нужно указывать при добавлении новой записи.</span><span class="sxs-lookup"><span data-stu-id="ae44c-134">Later in this tutorial we'll come back and remove some of the fields whose values don t need to be specified when adding a new record.</span></span>

<span data-ttu-id="ae44c-135">Так как в базе данных имеется близкое к 80 продуктов, пользователю придется прокручивать все до нижнего края веб-страницы, чтобы добавить новую запись.</span><span class="sxs-lookup"><span data-stu-id="ae44c-135">Since there are close to 80 products in the database, a user will have to scroll all the way down to the bottom of the web page in order to add a new record.</span></span> <span data-ttu-id="ae44c-136">Таким образом, разрешите разбиение по страницам, чтобы сделать интерфейс вставки видимым и доступным.</span><span class="sxs-lookup"><span data-stu-id="ae44c-136">Therefore, let s enable paging to make the inserting interface more visible and accessible.</span></span> <span data-ttu-id="ae44c-137">Чтобы включить подкачку, просто установите флажок Включить разбиение по страницам в смарт-теге GridView s.</span><span class="sxs-lookup"><span data-stu-id="ae44c-137">To turn on paging, simply check the Enable Paging checkbox from the GridView s smart tag.</span></span>

<span data-ttu-id="ae44c-138">На этом этапе декларативная разметка GridView и ObjectDataSource s должна выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="ae44c-138">At this point, the GridView and ObjectDataSource s declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](inserting-a-new-record-from-the-gridview-s-footer-cs/samples/sample1.aspx)]

<span data-ttu-id="ae44c-139">[![все поля данных продукта отображаются в элементе управления GridView с постраничным отображением](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image5.gif)](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="ae44c-139">[![All Product Data Fields are Displayed in a Paged GridView](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image5.gif)](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image9.png)</span></span>

<span data-ttu-id="ae44c-140">**Рис. 5**. все поля данных продукта отображаются в элементе управления GridView с постраничным[просмотром (щелкните, чтобы просмотреть изображение с полным размером](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="ae44c-140">**Figure 5**: All Product Data Fields are Displayed in a Paged GridView ([Click to view full-size image](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image10.png))</span></span>

## <a name="step-2-adding-a-footer-row"></a><span data-ttu-id="ae44c-141">Шаг 2. Добавление строки нижнего колонтитула</span><span class="sxs-lookup"><span data-stu-id="ae44c-141">Step 2: Adding a Footer Row</span></span>

<span data-ttu-id="ae44c-142">Вместе с заголовком и строками данных GridView включает строку нижнего колонтитула.</span><span class="sxs-lookup"><span data-stu-id="ae44c-142">Along with its header and data rows, the GridView includes a footer row.</span></span> <span data-ttu-id="ae44c-143">Строки верхнего и нижнего колонтитулов отображаются в зависимости от значений свойств [`ShowHeader`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.showheader.aspx) GridView s и [`ShowFooter`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.showfooter.aspx) .</span><span class="sxs-lookup"><span data-stu-id="ae44c-143">The header and footer rows are displayed depending on the values of the GridView s [`ShowHeader`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.showheader.aspx) and [`ShowFooter`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.showfooter.aspx) properties.</span></span> <span data-ttu-id="ae44c-144">Чтобы отобразить строку нижнего колонтитула, просто задайте для свойства `ShowFooter` значение `true`.</span><span class="sxs-lookup"><span data-stu-id="ae44c-144">To show the footer row, simply set the `ShowFooter` property to `true`.</span></span> <span data-ttu-id="ae44c-145">Как показано на рис. 6, установка свойства `ShowFooter` в `true` добавляет к сетке строку нижнего колонтитула.</span><span class="sxs-lookup"><span data-stu-id="ae44c-145">As Figure 6 illustrates, setting the `ShowFooter` property to `true` adds a footer row to the grid.</span></span>

<span data-ttu-id="ae44c-146">[![, чтобы отобразить строку нижнего колонтитула, установите для Шовфутер значение true.](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image6.gif)](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="ae44c-146">[![To Display the Footer Row, Set ShowFooter to True](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image6.gif)](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image11.png)</span></span>

<span data-ttu-id="ae44c-147">**Рис. 6**. чтобы отобразить строку нижнего колонтитула, присвойте параметру `ShowFooter` значение `True` ([щелкните, чтобы просмотреть изображение с полным размером](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="ae44c-147">**Figure 6**: To Display the Footer Row, Set `ShowFooter` to `True` ([Click to view full-size image](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image12.png))</span></span>

<span data-ttu-id="ae44c-148">Обратите внимание, что строка нижнего колонтитула имеет темно-красный цвет фона.</span><span class="sxs-lookup"><span data-stu-id="ae44c-148">Note that the footer row has a dark red background color.</span></span> <span data-ttu-id="ae44c-149">Это связано с тем, что мы создали и применили тему для всех страниц в [данных с помощью](../basic-reporting/displaying-data-with-the-objectdatasource-cs.md) учебника по ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="ae44c-149">This is due to the DataWebControls Theme we created and applied to all pages back in the [Displaying Data With the ObjectDataSource](../basic-reporting/displaying-data-with-the-objectdatasource-cs.md) tutorial.</span></span> <span data-ttu-id="ae44c-150">В частности, файл `GridView.skin` настраивает свойство `FooterStyle` таким образом, что использует класс `FooterStyle` CSS.</span><span class="sxs-lookup"><span data-stu-id="ae44c-150">Specifically, the `GridView.skin` file configures the `FooterStyle` property such that is uses the `FooterStyle` CSS class.</span></span> <span data-ttu-id="ae44c-151">Класс `FooterStyle` определяется в `Styles.css` следующим образом:</span><span class="sxs-lookup"><span data-stu-id="ae44c-151">The `FooterStyle` class is defined in `Styles.css` as follows:</span></span>

[!code-css[Main](inserting-a-new-record-from-the-gridview-s-footer-cs/samples/sample2.css)]

> [!NOTE]
> <span data-ttu-id="ae44c-152">Мы проучили использование строки нижнего колонтитула GridView в предыдущих руководствах.</span><span class="sxs-lookup"><span data-stu-id="ae44c-152">We ve explored using the GridView s footer row in previous tutorials.</span></span> <span data-ttu-id="ae44c-153">При необходимости вернитесь к [отображению сводных данных в руководстве по нижнему колонтитулу GridView](../custom-formatting/displaying-summary-information-in-the-gridview-s-footer-cs.md) для обновления.</span><span class="sxs-lookup"><span data-stu-id="ae44c-153">If needed, refer back to the [Displaying Summary Information in the GridView's Footer](../custom-formatting/displaying-summary-information-in-the-gridview-s-footer-cs.md) tutorial for a refresher.</span></span>

<span data-ttu-id="ae44c-154">Установив для свойства `ShowFooter` значение `true`, просмотрите выходные данные в браузере.</span><span class="sxs-lookup"><span data-stu-id="ae44c-154">After setting the `ShowFooter` property to `true`, take a moment to view the output in a browser.</span></span> <span data-ttu-id="ae44c-155">В настоящее время строка нижнего колонтитула не содержит текста или веб-элементов управления.</span><span class="sxs-lookup"><span data-stu-id="ae44c-155">Currently the footer row doesn t contain any text or Web controls.</span></span> <span data-ttu-id="ae44c-156">На этапе 3 мы изменим нижний колонтитул для каждого поля GridView, чтобы он включал соответствующий интерфейс вставки.</span><span class="sxs-lookup"><span data-stu-id="ae44c-156">In Step 3 we'll modify the footer for each GridView field so that it includes the appropriate inserting interface.</span></span>

<span data-ttu-id="ae44c-157">[![пустая строка нижнего колонтитула отображается над элементами управления "интерфейс разбиения по страницам"](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image7.gif)](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="ae44c-157">[![The Empty Footer Row is Displayed Above the Paging Interface Controls](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image7.gif)](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image13.png)</span></span>

<span data-ttu-id="ae44c-158">**Рис. 7**. пустая строка нижнего колонтитула отображается над элементами управления "интерфейс разбиения по страницам" ([щелкните, чтобы просмотреть изображение с полным размером](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="ae44c-158">**Figure 7**: The Empty Footer Row is Displayed Above the Paging Interface Controls ([Click to view full-size image](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image14.png))</span></span>

## <a name="step-3-customizing-the-footer-row"></a><span data-ttu-id="ae44c-159">Шаг 3. Настройка строки нижнего колонтитула</span><span class="sxs-lookup"><span data-stu-id="ae44c-159">Step 3: Customizing the Footer Row</span></span>

<span data-ttu-id="ae44c-160">Вернемся к [использованию полей TemplateField в учебнике по элементу управления GridView](../custom-formatting/using-templatefields-in-the-gridview-control-cs.md) мы увидели, как значительно настроить отображение определенного столбца GridView с помощью полей TemplateField (в отличие от BoundFields или чеккбоксфиелдс). При [настройке интерфейса изменения данных](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) мы рассматривали использование полей TemplateField для настройки интерфейса редактирования в GridView.</span><span class="sxs-lookup"><span data-stu-id="ae44c-160">Back in the [Using TemplateFields in the GridView Control](../custom-formatting/using-templatefields-in-the-gridview-control-cs.md) tutorial we saw how to greatly customize the display of a particular GridView column using TemplateFields (as opposed to BoundFields or CheckBoxFields); in [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) we looked at using TemplateFields to customize the editing interface in a GridView.</span></span> <span data-ttu-id="ae44c-161">Помните, что TemplateField состоит из нескольких шаблонов, определяющих сочетание разметки, веб-элементов управления и синтаксиса привязки данных, используемого для определенных типов строк.</span><span class="sxs-lookup"><span data-stu-id="ae44c-161">Recall that a TemplateField is composed of a number of templates that defines the mix of markup, Web controls, and databinding syntax used for certain types of rows.</span></span> <span data-ttu-id="ae44c-162">`ItemTemplate`, например, указывает шаблон, используемый для строк только для чтения, а `EditItemTemplate` определяет шаблон для редактируемой строки.</span><span class="sxs-lookup"><span data-stu-id="ae44c-162">The `ItemTemplate`, for example, specifies the template used for read-only rows, while the `EditItemTemplate` defines the template for the editable row.</span></span>

<span data-ttu-id="ae44c-163">Вместе с `ItemTemplate` и `EditItemTemplate`TemplateField также содержит `FooterTemplate`, которое указывает содержимое для строки нижнего колонтитула.</span><span class="sxs-lookup"><span data-stu-id="ae44c-163">Along with the `ItemTemplate` and `EditItemTemplate`, the TemplateField also includes a `FooterTemplate` that specifies the content for the footer row.</span></span> <span data-ttu-id="ae44c-164">Поэтому мы можем добавить веб-элементы управления, необходимые для вставки интерфейса каждого поля в `FooterTemplate`.</span><span class="sxs-lookup"><span data-stu-id="ae44c-164">Therefore, we can add the Web controls needed for each field s inserting interface into the `FooterTemplate`.</span></span> <span data-ttu-id="ae44c-165">Чтобы начать, преобразуйте все поля в элементе управления GridView в полей TemplateField.</span><span class="sxs-lookup"><span data-stu-id="ae44c-165">To start, convert all of the fields in the GridView to TemplateFields.</span></span> <span data-ttu-id="ae44c-166">Это можно сделать, щелкнув ссылку Edit Columns (изменить столбцы) в смарт-теге GridView s, выбрав каждое поле в левом нижнем углу и щелкнув элемент преобразовать это поле в ссылку TemplateField.</span><span class="sxs-lookup"><span data-stu-id="ae44c-166">This can be done by clicking the Edit Columns link in the GridView s smart tag, selecting each field in the lower left corner, and clicking the Convert this field into a TemplateField link.</span></span>

![Преобразование каждого поля в TemplateField](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image8.gif)

<span data-ttu-id="ae44c-168">**Рис. 8**. преобразование каждого поля в TemplateField</span><span class="sxs-lookup"><span data-stu-id="ae44c-168">**Figure 8**: Convert Each Field Into a TemplateField</span></span>

<span data-ttu-id="ae44c-169">При нажатии кнопки преобразовать это поле в TemplateField текущий тип поля преобразуется в эквивалентный TemplateField.</span><span class="sxs-lookup"><span data-stu-id="ae44c-169">Clicking the Convert this field into a TemplateField turns the current field type into an equivalent TemplateField.</span></span> <span data-ttu-id="ae44c-170">Например, каждый BoundField заменяется TemplateField с `ItemTemplate`, содержащей метку, в которой отображается соответствующее поле данных, и `EditItemTemplate`, отображающая поле данных в текстовом поле.</span><span class="sxs-lookup"><span data-stu-id="ae44c-170">For example, each BoundField is replaced by a TemplateField with an `ItemTemplate` that contains a Label that displays the corresponding data field and an `EditItemTemplate` that displays the data field in a TextBox.</span></span> <span data-ttu-id="ae44c-171">`ProductName` BoundField преобразован в следующую разметку TemplateField:</span><span class="sxs-lookup"><span data-stu-id="ae44c-171">The `ProductName` BoundField has been converted into the following TemplateField markup:</span></span>

[!code-aspx[Main](inserting-a-new-record-from-the-gridview-s-footer-cs/samples/sample3.aspx)]

<span data-ttu-id="ae44c-172">Аналогичным образом `Discontinued` CheckBoxField преобразован в TemplateField, чьи `ItemTemplate` и `EditItemTemplate` содержат веб-элемент управления CheckBox (с отключенным флажком `ItemTemplate` s).</span><span class="sxs-lookup"><span data-stu-id="ae44c-172">Likewise, the `Discontinued` CheckBoxField has been converted into a TemplateField whose `ItemTemplate` and `EditItemTemplate` contain a CheckBox Web control (with the `ItemTemplate` s CheckBox disabled).</span></span> <span data-ttu-id="ae44c-173">`ProductID` BoundField, доступная только для чтения, преобразована в TemplateField с элементом управления Label как в `ItemTemplate`, так и в `EditItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="ae44c-173">The read-only `ProductID` BoundField has been converted into a TemplateField with a Label control in both the `ItemTemplate` and `EditItemTemplate`.</span></span> <span data-ttu-id="ae44c-174">Коротко говоря, преобразование существующего поля GridView в TemplateField — это быстрый и простой способ переключения на более настраиваемый TemplateField без потери существующих функциональных возможностей полей.</span><span class="sxs-lookup"><span data-stu-id="ae44c-174">In short, converting an existing GridView field into a TemplateField is a quick and easy way to switch to the more customizable TemplateField without losing any of the existing field s functionality.</span></span>

<span data-ttu-id="ae44c-175">Поскольку элемент управления GridView, который мы переработали в режиме поддержки, не поддерживает редактирование, вы можете удалить `EditItemTemplate` из каждого TemplateField, открывая только `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="ae44c-175">Since the GridView we re working with doesn t support editing, feel free to remove the `EditItemTemplate` from each TemplateField, leaving just the `ItemTemplate`.</span></span> <span data-ttu-id="ae44c-176">После этого декларативная разметка GridView s должна выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="ae44c-176">After doing this, your GridView s declarative markup should look like the following:</span></span>

[!code-aspx[Main](inserting-a-new-record-from-the-gridview-s-footer-cs/samples/sample4.aspx)]

<span data-ttu-id="ae44c-177">Теперь, когда каждое поле GridView было преобразовано в TemplateField, можно ввести соответствующий интерфейс вставки в каждое поле `FooterTemplate`.</span><span class="sxs-lookup"><span data-stu-id="ae44c-177">Now that each GridView field has been converted into a TemplateField, we can enter the appropriate inserting interface into each field s `FooterTemplate`.</span></span> <span data-ttu-id="ae44c-178">Некоторые поля не будут иметь интерфейс вставки (`ProductID`, например); другие зависят от веб-элементов управления, используемых для получения новых сведений о продуктах.</span><span class="sxs-lookup"><span data-stu-id="ae44c-178">Some of the fields will not have an inserting interface (`ProductID`, for instance); others will vary in the Web controls used to collect the new product s information.</span></span>

<span data-ttu-id="ae44c-179">Чтобы создать интерфейс редактирования, выберите ссылку Edit Templates (изменить шаблоны) в смарт-теге GridView s.</span><span class="sxs-lookup"><span data-stu-id="ae44c-179">To create the editing interface, choose the Edit Templates link from the GridView s smart tag.</span></span> <span data-ttu-id="ae44c-180">Затем в раскрывающемся списке выберите соответствующие поля `FooterTemplate` и перетащите соответствующий элемент управления из панели элементов в конструктор.</span><span class="sxs-lookup"><span data-stu-id="ae44c-180">Then, from the drop-down list, select the appropriate field s `FooterTemplate` and drag the appropriate control from the Toolbox onto the Designer.</span></span>

<span data-ttu-id="ae44c-181">[![добавить соответствующий интерфейс вставки в каждое поле Футертемплате](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image9.gif)](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="ae44c-181">[![Add the Appropriate Inserting Interface to Each Field s FooterTemplate](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image9.gif)](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image15.png)</span></span>

<span data-ttu-id="ae44c-182">**Рис. 9**. добавление соответствующего интерфейса вставки в каждое поле `FooterTemplate` ([щелкните, чтобы просмотреть изображение с полным размером](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="ae44c-182">**Figure 9**: Add the Appropriate Inserting Interface to Each Field s `FooterTemplate` ([Click to view full-size image](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image16.png))</span></span>

<span data-ttu-id="ae44c-183">Следующий маркированный список перечисляет поля GridView, указывая добавляемый интерфейс вставки:</span><span class="sxs-lookup"><span data-stu-id="ae44c-183">The following bulleted list enumerates the GridView fields, specifying the inserting interface to add:</span></span>

- <span data-ttu-id="ae44c-184">`ProductID` нет.</span><span class="sxs-lookup"><span data-stu-id="ae44c-184">`ProductID` none.</span></span>
- <span data-ttu-id="ae44c-185">`ProductName` добавить текстовое поле и задать для его `ID` значение `NewProductName`.</span><span class="sxs-lookup"><span data-stu-id="ae44c-185">`ProductName` add a TextBox and set its `ID` to `NewProductName`.</span></span> <span data-ttu-id="ae44c-186">Добавьте элемент управления RequiredFieldValidator и убедитесь, что пользователь вводит значение для нового имени продукта.</span><span class="sxs-lookup"><span data-stu-id="ae44c-186">Add a RequiredFieldValidator control as well to ensure that the user enters a value for the new product s name.</span></span>
- <span data-ttu-id="ae44c-187">`SupplierID` нет.</span><span class="sxs-lookup"><span data-stu-id="ae44c-187">`SupplierID` none.</span></span>
- <span data-ttu-id="ae44c-188">`CategoryID` нет.</span><span class="sxs-lookup"><span data-stu-id="ae44c-188">`CategoryID` none.</span></span>
- <span data-ttu-id="ae44c-189">`QuantityPerUnit` добавить текстовое поле, задав для его `ID` значение `NewQuantityPerUnit`.</span><span class="sxs-lookup"><span data-stu-id="ae44c-189">`QuantityPerUnit` add a TextBox, setting its `ID` to `NewQuantityPerUnit`.</span></span>
- <span data-ttu-id="ae44c-190">`UnitPrice` добавить текстовое поле с именем `NewUnitPrice` и объект CompareValidator, гарантирующий, что значение является денежным значением, которое больше или равно нулю.</span><span class="sxs-lookup"><span data-stu-id="ae44c-190">`UnitPrice` add a TextBox named `NewUnitPrice` and a CompareValidator that ensures the value entered is a currency value greater than or equal to zero.</span></span>
- <span data-ttu-id="ae44c-191">`UnitsInStock` использовать текстовое поле, для `ID` которого задано значение `NewUnitsInStock`.</span><span class="sxs-lookup"><span data-stu-id="ae44c-191">`UnitsInStock` use a TextBox whose `ID` is set to `NewUnitsInStock`.</span></span> <span data-ttu-id="ae44c-192">Включите объект CompareValidator, гарантирующий, что указанное значение является целым числом, которое больше или равно нулю.</span><span class="sxs-lookup"><span data-stu-id="ae44c-192">Include a CompareValidator that ensures that the value entered is an integer value greater than or equal to zero.</span></span>
- <span data-ttu-id="ae44c-193">`UnitsOnOrder` использовать текстовое поле, для `ID` которого задано значение `NewUnitsOnOrder`.</span><span class="sxs-lookup"><span data-stu-id="ae44c-193">`UnitsOnOrder` use a TextBox whose `ID` is set to `NewUnitsOnOrder`.</span></span> <span data-ttu-id="ae44c-194">Включите объект CompareValidator, гарантирующий, что указанное значение является целым числом, которое больше или равно нулю.</span><span class="sxs-lookup"><span data-stu-id="ae44c-194">Include a CompareValidator that ensures that the value entered is an integer value greater than or equal to zero.</span></span>
- <span data-ttu-id="ae44c-195">`ReorderLevel` использовать текстовое поле, для `ID` которого задано значение `NewReorderLevel`.</span><span class="sxs-lookup"><span data-stu-id="ae44c-195">`ReorderLevel` use a TextBox whose `ID` is set to `NewReorderLevel`.</span></span> <span data-ttu-id="ae44c-196">Включите объект CompareValidator, гарантирующий, что указанное значение является целым числом, которое больше или равно нулю.</span><span class="sxs-lookup"><span data-stu-id="ae44c-196">Include a CompareValidator that ensures that the value entered is an integer value greater than or equal to zero.</span></span>
- <span data-ttu-id="ae44c-197">`Discontinued` добавить флажок, установив для его `ID` значение `NewDiscontinued`.</span><span class="sxs-lookup"><span data-stu-id="ae44c-197">`Discontinued` add a CheckBox, setting its `ID` to `NewDiscontinued`.</span></span>
- <span data-ttu-id="ae44c-198">`CategoryName` добавить DropDownList и задать для его `ID` значение `NewCategoryID`.</span><span class="sxs-lookup"><span data-stu-id="ae44c-198">`CategoryName` add a DropDownList and set its `ID` to `NewCategoryID`.</span></span> <span data-ttu-id="ae44c-199">Привяжите его к новому ObjectDataSource с именем `CategoriesDataSource` и настройте его для использования метода `CategoriesBLL` класса s `GetCategories()`.</span><span class="sxs-lookup"><span data-stu-id="ae44c-199">Bind it to a new ObjectDataSource named `CategoriesDataSource` and configure it to use the `CategoriesBLL` class s `GetCategories()` method.</span></span> <span data-ttu-id="ae44c-200">Элемент DropDownList `ListItem` s отображает поле данных `CategoryName`, используя `CategoryID` поле данных в качестве значений.</span><span class="sxs-lookup"><span data-stu-id="ae44c-200">Have the DropDownList s `ListItem` s display the `CategoryName` data field, using the `CategoryID` data field as their values.</span></span>
- <span data-ttu-id="ae44c-201">`SupplierName` добавить DropDownList и задать для его `ID` значение `NewSupplierID`.</span><span class="sxs-lookup"><span data-stu-id="ae44c-201">`SupplierName` add a DropDownList and set its `ID` to `NewSupplierID`.</span></span> <span data-ttu-id="ae44c-202">Привяжите его к новому ObjectDataSource с именем `SuppliersDataSource` и настройте его для использования метода `SuppliersBLL` класса s `GetSuppliers()`.</span><span class="sxs-lookup"><span data-stu-id="ae44c-202">Bind it to a new ObjectDataSource named `SuppliersDataSource` and configure it to use the `SuppliersBLL` class s `GetSuppliers()` method.</span></span> <span data-ttu-id="ae44c-203">Элемент DropDownList `ListItem` s отображает поле данных `CompanyName`, используя `SupplierID` поле данных в качестве значений.</span><span class="sxs-lookup"><span data-stu-id="ae44c-203">Have the DropDownList s `ListItem` s display the `CompanyName` data field, using the `SupplierID` data field as their values.</span></span>

<span data-ttu-id="ae44c-204">Для каждого элемента управления проверки Очистите свойство `ForeColor` таким образом, чтобы вместо красного по умолчанию использовался белый цвет переднего плана CSS Class `FooterStyle`.</span><span class="sxs-lookup"><span data-stu-id="ae44c-204">For each of the validation controls, clear out the `ForeColor` property so that the `FooterStyle` CSS class s white foreground color will be used in place of the default red.</span></span> <span data-ttu-id="ae44c-205">Кроме того, используйте свойство `ErrorMessage` для подробного описания, но для свойства `Text` установите звездочку.</span><span class="sxs-lookup"><span data-stu-id="ae44c-205">Also use the `ErrorMessage` property for a detailed description, but set the `Text` property to an asterisk.</span></span> <span data-ttu-id="ae44c-206">Чтобы не допустить, чтобы текст элемента управления проверки переносился к двум строкам, установите для свойства `FooterStyle` s `Wrap` значение false для каждого `FooterTemplate` с использованием элемента управления проверки.</span><span class="sxs-lookup"><span data-stu-id="ae44c-206">To prevent the validation control s text from causing the inserting interface to wrap to two lines, set the `FooterStyle` s `Wrap` property to false for each of the `FooterTemplate` s that use a validation control.</span></span> <span data-ttu-id="ae44c-207">Наконец, добавьте элемент управления ValidationSummary под элементом GridView и задайте для его свойства `ShowMessageBox` значение `true` а свойству `ShowSummary` — значение `false`.</span><span class="sxs-lookup"><span data-stu-id="ae44c-207">Finally, add a ValidationSummary control beneath the GridView and set its `ShowMessageBox` property to `true` and its `ShowSummary` property to `false`.</span></span>

<span data-ttu-id="ae44c-208">При добавлении нового продукта необходимо предоставить `CategoryID` и `SupplierID`.</span><span class="sxs-lookup"><span data-stu-id="ae44c-208">When adding a new product, we need to provide the `CategoryID` and `SupplierID`.</span></span> <span data-ttu-id="ae44c-209">Эти сведения захватываются в элементов управления DropDownList в ячейках нижнего колонтитула для полей `CategoryName` и `SupplierName`.</span><span class="sxs-lookup"><span data-stu-id="ae44c-209">This information is captured through the DropDownLists in the footer cells for the `CategoryName` and `SupplierName` fields.</span></span> <span data-ttu-id="ae44c-210">Я решил использовать эти поля в отличие от `CategoryID` и `SupplierID` полей TemplateField, поскольку в строках данных сетки s пользователь, скорее всего, больше заинтересован в просмотре имен категорий и поставщиков, а не их значений ИДЕНТИФИКАТОРов.</span><span class="sxs-lookup"><span data-stu-id="ae44c-210">I chose to use these fields as opposed to the `CategoryID` and `SupplierID` TemplateFields because in the grid s data rows the user is likely more interested in seeing the category and supplier names rather than their ID values.</span></span> <span data-ttu-id="ae44c-211">Так как значения `CategoryID` и `SupplierID` теперь фиксируются в интерфейсах вставки полей `CategoryName` и `SupplierName`, можно удалить `CategoryID` и `SupplierID` полей TemplateField из GridView.</span><span class="sxs-lookup"><span data-stu-id="ae44c-211">Since the `CategoryID` and `SupplierID` values are now being captured in the `CategoryName` and `SupplierName` field s inserting interfaces, we can remove the `CategoryID` and `SupplierID` TemplateFields from the GridView.</span></span>

<span data-ttu-id="ae44c-212">Аналогичным образом `ProductID` не используется при добавлении нового продукта, поэтому `ProductID` TemplateField также можно удалить.</span><span class="sxs-lookup"><span data-stu-id="ae44c-212">Similarly, the `ProductID` is not used when adding a new product, so the `ProductID` TemplateField can be removed as well.</span></span> <span data-ttu-id="ae44c-213">Однако добавим поле `ProductID` в сетке.</span><span class="sxs-lookup"><span data-stu-id="ae44c-213">However, let s leave the `ProductID` field in the grid.</span></span> <span data-ttu-id="ae44c-214">В дополнение к элементам управления TextBox, элементов управления DropDownList, CheckBox и Validation, которые составляют интерфейс вставки, также потребуется кнопка Добавить, которая при нажатии выполняет логику для добавления нового продукта в базу данных.</span><span class="sxs-lookup"><span data-stu-id="ae44c-214">In addition to the TextBoxes, DropDownLists, CheckBoxes, and validation controls that make up the inserting interface, we'll also need an Add button that, when clicked, performs the logic to add the new product to the database.</span></span> <span data-ttu-id="ae44c-215">На шаге 4 будет добавлена кнопка Добавить в интерфейс вставки `ProductID` TemplateField s `FooterTemplate`.</span><span class="sxs-lookup"><span data-stu-id="ae44c-215">In Step 4 we'll include an Add button in the inserting interface in the `ProductID` TemplateField s `FooterTemplate`.</span></span>

<span data-ttu-id="ae44c-216">Вы можете улучшить внешний вид различных полей GridView.</span><span class="sxs-lookup"><span data-stu-id="ae44c-216">Feel free to improve the appearance of the various GridView fields.</span></span> <span data-ttu-id="ae44c-217">Например, можно отформатировать `UnitPrice` значения как валюту, выровняйте по правому краю поля `UnitsInStock`, `UnitsOnOrder`и `ReorderLevel` и обновить значения `HeaderText` для полей TemplateField.</span><span class="sxs-lookup"><span data-stu-id="ae44c-217">For example, you might want to format the `UnitPrice` values as a currency, right-align the `UnitsInStock`, `UnitsOnOrder`, and `ReorderLevel` fields, and update the `HeaderText` values for the TemplateFields.</span></span>

<span data-ttu-id="ae44c-218">После создания интерфейсов вставки в `FooterTemplate` s, удаления `SupplierID`и `CategoryID` полей TemplateField, а также улучшения эстетичность сетки с помощью форматирования и согласования полей TemplateField, декларативная разметка GridView s должна выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="ae44c-218">After creating the slew of inserting interfaces in the `FooterTemplate` s, removing the `SupplierID`, and `CategoryID` TemplateFields, and improving the aesthetics of the grid through formatting and aligning the TemplateFields, your GridView s declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](inserting-a-new-record-from-the-gridview-s-footer-cs/samples/sample5.aspx)]

<span data-ttu-id="ae44c-219">При просмотре в браузере строка нижнего колонтитула GridView теперь включает в себя готовый интерфейс вставки (см. рис. 10).</span><span class="sxs-lookup"><span data-stu-id="ae44c-219">When viewed through a browser, the GridView s footer row now includes the completed inserting interface (see Figure 10).</span></span> <span data-ttu-id="ae44c-220">На этом этапе интерфейс вставки не содержит средств, позволяющих пользователю указать, что он вводит данные для нового продукта и хочет вставить новую запись в базу данных.</span><span class="sxs-lookup"><span data-stu-id="ae44c-220">At this point, the inserting interface doesn t include a means for the user to indicate that she s entered the data for the new product and wants to insert a new record into the database.</span></span> <span data-ttu-id="ae44c-221">Кроме того, мы работаем над тем, как данные, введенные в нижний колонтитул, будут преобразованы в новую запись в базе данных `Products`.</span><span class="sxs-lookup"><span data-stu-id="ae44c-221">Also, we ve yet to address how the data entered into the footer will translate into a new record in the `Products` database.</span></span> <span data-ttu-id="ae44c-222">На шаге 4 мы рассмотрим, как включить кнопку Добавить в интерфейс вставки и как выполнить код при обратной передаче при нажатии.</span><span class="sxs-lookup"><span data-stu-id="ae44c-222">In Step 4 we'll look at how to include an Add button to the inserting interface and how to execute code on postback when it s clicked.</span></span> <span data-ttu-id="ae44c-223">На шаге 5 показано, как вставить новую запись с использованием данных из нижнего колонтитула.</span><span class="sxs-lookup"><span data-stu-id="ae44c-223">Step 5 shows how to insert a new record using the data from the footer.</span></span>

<span data-ttu-id="ae44c-224">[![нижний колонтитул GridView предоставляет интерфейс для добавления новой записи](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image10.gif)](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="ae44c-224">[![The GridView Footer Provides an Interface for Adding a New Record](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image10.gif)](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image17.png)</span></span>

<span data-ttu-id="ae44c-225">**Рис. 10**. Нижний колонтитул GridView предоставляет интерфейс для добавления новой записи ([щелкните, чтобы просмотреть изображение с полным размером](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="ae44c-225">**Figure 10**: The GridView Footer Provides an Interface for Adding a New Record ([Click to view full-size image](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image18.png))</span></span>

## <a name="step-4-including-an-add-button-in-the-inserting-interface"></a><span data-ttu-id="ae44c-226">Шаг 4. Включение кнопки "Добавить" в интерфейс вставки</span><span class="sxs-lookup"><span data-stu-id="ae44c-226">Step 4: Including an Add Button in the Inserting Interface</span></span>

<span data-ttu-id="ae44c-227">В интерфейсе вставки можно включить кнопку Добавить, так как в настоящее время в интерфейсе вставки нижнего колонтитула отсутствуют средства, указывающие, что пользователь завершил ввод новых сведений о продукте.</span><span class="sxs-lookup"><span data-stu-id="ae44c-227">We need to include an Add button somewhere in the inserting interface since the footer row s inserting interface currently lacks the means for the user to indicate that they have completed entering the new product s information.</span></span> <span data-ttu-id="ae44c-228">Это можно поместить в один из существующих `FooterTemplate` s или добавить в сетку новый столбец для этой цели.</span><span class="sxs-lookup"><span data-stu-id="ae44c-228">This could be placed in one of the existing `FooterTemplate` s or we could add a new column to the grid for this purpose.</span></span> <span data-ttu-id="ae44c-229">В рамках этого руководства Разместите кнопку Add (Добавить) в `ProductID` TemplateField s `FooterTemplate`.</span><span class="sxs-lookup"><span data-stu-id="ae44c-229">For this tutorial, let s place the Add button in the `ProductID` TemplateField s `FooterTemplate`.</span></span>

<span data-ttu-id="ae44c-230">В конструкторе щелкните ссылку Edit Templates (изменить шаблоны) в смарт-теге GridView s, а затем выберите `ProductID` поля `FooterTemplate` из раскрывающегося списка.</span><span class="sxs-lookup"><span data-stu-id="ae44c-230">From the Designer, click on the Edit Templates link in the GridView s smart tag and then choose the `ProductID` field s `FooterTemplate` from the drop-down list.</span></span> <span data-ttu-id="ae44c-231">Добавьте в шаблон веб-элемент управления Button (или LinkButton или ImageButton), указав для его идентификатора значение `AddProduct`, `CommandName` вставки, а также свойство `Text` для добавления, как показано на рис. 11.</span><span class="sxs-lookup"><span data-stu-id="ae44c-231">Add a Button Web control (or a LinkButton or ImageButton, if you prefer) to the template, setting its ID to `AddProduct`, its `CommandName` to Insert, and its `Text` property to Add as shown in Figure 11.</span></span>

<span data-ttu-id="ae44c-232">[![поместить кнопку Добавить в ProductID TemplateField s Футертемплате](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image11.gif)](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="ae44c-232">[![Place the Add Button in the ProductID TemplateField s FooterTemplate](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image11.gif)](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image19.png)</span></span>

<span data-ttu-id="ae44c-233">**Рис. 11**. Добавление кнопки "Добавить" в `ProductID` TemplateField s `FooterTemplate` ([щелкните, чтобы просмотреть изображение с полным размером](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="ae44c-233">**Figure 11**: Place the Add Button in the `ProductID` TemplateField s `FooterTemplate` ([Click to view full-size image](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image20.png))</span></span>

<span data-ttu-id="ae44c-234">После включения кнопки "Добавить" проверьте страницу в браузере.</span><span class="sxs-lookup"><span data-stu-id="ae44c-234">Once you ve included the Add button, test out the page in a browser.</span></span> <span data-ttu-id="ae44c-235">Обратите внимание, что при нажатии кнопки Добавить с недопустимыми данными в интерфейсе вставки выполняется сокращенная обратная передача, а элемент управления ValidationSummary указывает на недопустимые данные (см. рис. 12).</span><span class="sxs-lookup"><span data-stu-id="ae44c-235">Note that when clicking the Add button with invalid data in the inserting interface, the postback is short circuited and the ValidationSummary control indicates the invalid data (see Figure 12).</span></span> <span data-ttu-id="ae44c-236">После введения соответствующих данных нажатие кнопки Добавить вызывает обратную передачу.</span><span class="sxs-lookup"><span data-stu-id="ae44c-236">With appropriate data entered, clicking the Add button causes a postback.</span></span> <span data-ttu-id="ae44c-237">Однако записи в базу данных не добавляются.</span><span class="sxs-lookup"><span data-stu-id="ae44c-237">No record is added to the database, however.</span></span> <span data-ttu-id="ae44c-238">Нам потребуется написать немного кода, чтобы фактически выполнить вставку.</span><span class="sxs-lookup"><span data-stu-id="ae44c-238">We will need to write a bit of code to actually perform the insert.</span></span>

<span data-ttu-id="ae44c-239">[![обратная передача кнопки добавления в случае недопустимых данных в интерфейсе вставки сокращена.](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image12.gif)](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="ae44c-239">[![The Add Button s Postback is Short Circuited if There is Invalid Data in the Inserting Interface](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image12.gif)](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image21.png)</span></span>

<span data-ttu-id="ae44c-240">**Рис. 12**. обратная передача кнопки "Добавить" сокращена, если в интерфейсе вставки есть недопустимые данные ([щелкните, чтобы просмотреть изображение с полным размером](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="ae44c-240">**Figure 12**: The Add Button s Postback is Short Circuited if There is Invalid Data in the Inserting Interface ([Click to view full-size image](inserting-a-new-record-from-the-gridview-s-footer-cs/_static/image22.png))</span></span>

> [!NOTE]
> <span data-ttu-id="ae44c-241">Элементы управления проверки в интерфейсе вставки не были назначены группе проверки.</span><span class="sxs-lookup"><span data-stu-id="ae44c-241">The validation controls in the inserting interface were not assigned to a validation group.</span></span> <span data-ttu-id="ae44c-242">Это нормально, пока интерфейс вставки является единственным набором элементов управления проверки на странице.</span><span class="sxs-lookup"><span data-stu-id="ae44c-242">This works fine so long as the inserting interface is the only set of validation controls on the page.</span></span> <span data-ttu-id="ae44c-243">Однако если на странице есть другие элементы управления проверки (например, элементы управления проверки в интерфейсе редактирования сетки s), элементы управления проверки в интерфейсе вставки и кнопки Добавить `ValidationGroup` свойства должны иметь одинаковое значение, чтобы связать эти элементы управления с определенной группой проверки.</span><span class="sxs-lookup"><span data-stu-id="ae44c-243">If, however, there are other validation controls on the page (such as validation controls in the grid s editing interface), the validation controls in the inserting interface and Add button s `ValidationGroup` properties should be assigned the same value so as to associate these controls with a particular validation group.</span></span> <span data-ttu-id="ae44c-244">Дополнительные сведения о секционировании элементов управления проверки и кнопок на странице в группах проверки см. в разделе [которая разбила The Проверка элементов управления в ASP.NET 2,0](http://aspnet.4guysfromrolla.com/articles/112305-1.aspx) .</span><span class="sxs-lookup"><span data-stu-id="ae44c-244">See [Dissecting the Validation Controls in ASP.NET 2.0](http://aspnet.4guysfromrolla.com/articles/112305-1.aspx) for more information on partitioning the validation controls and buttons on a page into validation groups.</span></span>

## <a name="step-5-inserting-a-new-record-into-theproductstable"></a><span data-ttu-id="ae44c-245">Шаг 5. Вставка новой записи в таблицу`Products`</span><span class="sxs-lookup"><span data-stu-id="ae44c-245">Step 5: Inserting a New Record Into the`Products`Table</span></span>

<span data-ttu-id="ae44c-246">При использовании встроенных функций редактирования GridView элемент GridView автоматически обрабатывает всю работу, необходимую для выполнения обновления.</span><span class="sxs-lookup"><span data-stu-id="ae44c-246">When utilizing the built-in editing features of the GridView, the GridView automatically handles all of the work necessary for performing the update.</span></span> <span data-ttu-id="ae44c-247">В частности, при нажатии кнопки Обновить значения, указанные в интерфейсе редактирования, копируются в параметры в коллекции ObjectDataSource `UpdateParameters` и запускают обновление, вызывая метод ObjectDataSource `Update()`.</span><span class="sxs-lookup"><span data-stu-id="ae44c-247">In particular, when the Update button is clicked it copies the values entered from the editing interface to the parameters in the ObjectDataSource s `UpdateParameters` collection and kicks off the update by invoking the ObjectDataSource s `Update()` method.</span></span> <span data-ttu-id="ae44c-248">Поскольку GridView не предоставляет такие встроенные функции для вставки, необходимо реализовать код, который вызывает метод ObjectDataSource `Insert()` и копирует значения из интерфейса вставки в коллекцию ObjectDataSource `InsertParameters`.</span><span class="sxs-lookup"><span data-stu-id="ae44c-248">Since the GridView does not provide such built-in functionality for inserting, we must implement code that calls the ObjectDataSource s `Insert()` method and copies the values from the inserting interface to the ObjectDataSource s `InsertParameters` collection.</span></span>

<span data-ttu-id="ae44c-249">Эта логика вставки должна быть выполнена после нажатия кнопки Добавить.</span><span class="sxs-lookup"><span data-stu-id="ae44c-249">This insert logic should be executed after the Add button has been clicked.</span></span> <span data-ttu-id="ae44c-250">Как обсуждалось в разделе [Добавление и реагирование на кнопки в](../custom-button-actions/adding-and-responding-to-buttons-to-a-gridview-cs.md) руководстве по GridView, когда нажата кнопка, LinkButton или ImageButton в GridView, при обратной передаче возникает событие `RowCommand` GridView s.</span><span class="sxs-lookup"><span data-stu-id="ae44c-250">As discussed in the [Adding and Responding to Buttons in a GridView](../custom-button-actions/adding-and-responding-to-buttons-to-a-gridview-cs.md) tutorial, anytime a Button, LinkButton, or ImageButton in a GridView is clicked, the GridView s `RowCommand` event fires on postback.</span></span> <span data-ttu-id="ae44c-251">Это событие срабатывает, если кнопка, LinkButton или ImageButton была добавлена явно, например в кнопку Добавить в строке нижнего колонтитула, или если она была автоматически добавлена элементом GridView (например, в верхней части каждого столбца, если выбран параметр Включить сортировку) или Элемент LinkButton в интерфейсе разбиения по страницам, если выбран параметр Включить разбиение по страницам).</span><span class="sxs-lookup"><span data-stu-id="ae44c-251">This event fires whether the Button, LinkButton, or ImageButton was added explicitly such as the Add button in the footer row or if it was automatically added by the GridView (such as the LinkButtons at the top of each column when Enable Sorting is selected, or the LinkButtons in the paging interface when Enable Paging is selected).</span></span>

<span data-ttu-id="ae44c-252">Поэтому, чтобы ответить на пользователя нажатием кнопки "Добавить", необходимо создать обработчик событий для события `RowCommand` GridView s.</span><span class="sxs-lookup"><span data-stu-id="ae44c-252">Therefore, to respond to the user clicking the Add button, we need to create an event handler for the GridView s `RowCommand` event.</span></span> <span data-ttu-id="ae44c-253">Поскольку это событие срабатывает при нажатии *любой* кнопки, LinkButton или ImageButton в GridView, крайне важно, чтобы мы пропускали только логику вставки, если свойство `CommandName`, передаваемое в обработчик событий, сопоставляется с `CommandName`ым значением кнопки Добавить (INSERT).</span><span class="sxs-lookup"><span data-stu-id="ae44c-253">Since this event fires whenever *any* Button, LinkButton, or ImageButton in the GridView is clicked, it s vital that we only proceed with the inserting logic if the `CommandName` property passed into the event handler maps to the `CommandName` value of the Add button ( Insert ).</span></span> <span data-ttu-id="ae44c-254">Кроме того, мы также будем продолжать, только если проверяющие элементы управления сообщают о допустимых данных.</span><span class="sxs-lookup"><span data-stu-id="ae44c-254">Moreover, we should also only proceed if the validation controls report valid data.</span></span> <span data-ttu-id="ae44c-255">Для этого создайте обработчик событий для `RowCommand` события с помощью следующего кода:</span><span class="sxs-lookup"><span data-stu-id="ae44c-255">To accommodate this, create an event handler for the `RowCommand` event with the following code:</span></span>

[!code-csharp[Main](inserting-a-new-record-from-the-gridview-s-footer-cs/samples/sample6.cs)]

> [!NOTE]
> <span data-ttu-id="ae44c-256">Возможно, вас интересует, почему обработчик событий проверяет свойство `Page.IsValid`.</span><span class="sxs-lookup"><span data-stu-id="ae44c-256">You may be wondering why the event handler bothers checking the `Page.IsValid` property.</span></span> <span data-ttu-id="ae44c-257">В конце концов, не следует подавлять обратную передачу, если в интерфейсе вставки указаны недопустимые данные?</span><span class="sxs-lookup"><span data-stu-id="ae44c-257">After all, won't the postback be suppressed if invalid data is provided in the inserting interface?</span></span> <span data-ttu-id="ae44c-258">Это предположение верно, если пользователь не отключил JavaScript или выполнил действия по обдействию логики проверки на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="ae44c-258">This assumption is correct as long as the user has not disabled JavaScript or has taken steps to circumvent the client-side validation logic.</span></span> <span data-ttu-id="ae44c-259">Вкратце, один из них не должен зависеть строго от проверки на стороне клиента. Перед началом работы с данными необходимо всегда выполнять проверку на наличие на стороне сервера.</span><span class="sxs-lookup"><span data-stu-id="ae44c-259">In short, one should never rely strictly on client-side validation; a server-side check for validity should always be performed before working with the data.</span></span>

<span data-ttu-id="ae44c-260">На этапе 1 мы создали `ProductsDataSource` ObjectDataSource таким способом, чтобы его `Insert()` был сопоставлен с методом `ProductsBLL` класса s `AddProduct`.</span><span class="sxs-lookup"><span data-stu-id="ae44c-260">In Step 1 we created the `ProductsDataSource` ObjectDataSource such that its `Insert()` method is mapped to the `ProductsBLL` class s `AddProduct` method.</span></span> <span data-ttu-id="ae44c-261">Чтобы вставить новую запись в таблицу `Products`, можно просто вызвать метод ObjectDataSource `Insert()`:</span><span class="sxs-lookup"><span data-stu-id="ae44c-261">To insert the new record into the `Products` table, we can simply invoke the ObjectDataSource s `Insert()` method:</span></span>

[!code-csharp[Main](inserting-a-new-record-from-the-gridview-s-footer-cs/samples/sample7.cs)]

<span data-ttu-id="ae44c-262">Теперь, когда был вызван метод `Insert()`, остается только скопировать значения из интерфейса вставки в параметры, передаваемые в метод `ProductsBLL` класса s `AddProduct`.</span><span class="sxs-lookup"><span data-stu-id="ae44c-262">Now that the `Insert()` method has been invoked, all that remains is to copy the values from the inserting interface to the parameters passed to the `ProductsBLL` class s `AddProduct` method.</span></span> <span data-ttu-id="ae44c-263">Как мы видели в статье [изучение событий, связанных с руководством по вставке, обновлению и удалению](../editing-inserting-and-deleting-data/examining-the-events-associated-with-inserting-updating-and-deleting-cs.md) , это можно сделать с помощью события `Inserting` ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="ae44c-263">As we saw back in the [Examining the Events Associated with Inserting, Updating, and Deleting](../editing-inserting-and-deleting-data/examining-the-events-associated-with-inserting-updating-and-deleting-cs.md) tutorial, this can be accomplished through the ObjectDataSource s `Inserting` event.</span></span> <span data-ttu-id="ae44c-264">В `Inserting` событии необходимо программно ссылаться на элементы управления из строки нижнего колонтитула `Products` GridView и присваивать их значения коллекции `e.InputParameters`.</span><span class="sxs-lookup"><span data-stu-id="ae44c-264">In the `Inserting` event we need to programmatically reference the controls from the `Products` GridView s footer row and assign their values to the `e.InputParameters` collection.</span></span> <span data-ttu-id="ae44c-265">Если пользователь опускает значение, например оставить поле `ReorderLevel` пустым, необходимо указать, что значение, вставляемое в базу данных, должно быть `NULL`.</span><span class="sxs-lookup"><span data-stu-id="ae44c-265">If the user omits a value such as leaving the `ReorderLevel` TextBox blank we need to specify that the value inserted into the database should be `NULL`.</span></span> <span data-ttu-id="ae44c-266">Так как метод `AddProducts` принимает типы, допускающие значение null, для полей базы данных, допускающих значения NULL, просто используйте тип, допускающий значение null, и задайте для его значения значение `null` в случае, если входные данные пользователя опущены.</span><span class="sxs-lookup"><span data-stu-id="ae44c-266">Since the `AddProducts` method accepts nullable types for the nullable database fields, simply use a nullable type and set its value to `null` in the case where user input is omitted.</span></span>

[!code-csharp[Main](inserting-a-new-record-from-the-gridview-s-footer-cs/samples/sample8.cs)]

<span data-ttu-id="ae44c-267">После завершения обработчика `Inserting` событий новые записи можно добавить в таблицу `Products` базы данных с помощью строки нижнего колонтитула GridView.</span><span class="sxs-lookup"><span data-stu-id="ae44c-267">With the `Inserting` event handler completed, new records can be added to the `Products` database table via the GridView s footer row.</span></span> <span data-ttu-id="ae44c-268">Попробуйте добавить несколько новых продуктов.</span><span class="sxs-lookup"><span data-stu-id="ae44c-268">Go ahead and try adding several new products.</span></span>

## <a name="enhancing-and-customizing-the-add-operation"></a><span data-ttu-id="ae44c-269">Улучшение и настройка операции добавления</span><span class="sxs-lookup"><span data-stu-id="ae44c-269">Enhancing and Customizing the Add Operation</span></span>

<span data-ttu-id="ae44c-270">В настоящее время нажатие кнопки Добавить добавляет новую запись в таблицу базы данных, но не предоставляет никаких визуальных отзывов о том, что запись была успешно добавлена.</span><span class="sxs-lookup"><span data-stu-id="ae44c-270">Currently, clicking the Add button adds a new record to the database table but does not provide any sort of visual feedback that the record has successfully been added.</span></span> <span data-ttu-id="ae44c-271">В идеале для элемента управления Label или клиентского окна оповещение сообщает пользователю об успешном завершении вставки.</span><span class="sxs-lookup"><span data-stu-id="ae44c-271">Ideally, a Label Web control or client-side alert box would inform the user that their insert has completed with success.</span></span> <span data-ttu-id="ae44c-272">Я оставлю это в качестве упражнения для читателя.</span><span class="sxs-lookup"><span data-stu-id="ae44c-272">I leave this as an exercise for the reader.</span></span>

<span data-ttu-id="ae44c-273">Элемент управления GridView, используемый в этом руководстве, не применяет порядок сортировки к указанным продуктам и не позволяет конечному пользователю сортировать данные.</span><span class="sxs-lookup"><span data-stu-id="ae44c-273">The GridView used in this tutorial does not apply any sort order to the listed products, nor does it allow the end user to sort the data.</span></span> <span data-ttu-id="ae44c-274">Следовательно, записи упорядочиваются по мере их расположения в базе данных по полю первичного ключа.</span><span class="sxs-lookup"><span data-stu-id="ae44c-274">Consequently, the records are ordered as they are in the database by their primary key field.</span></span> <span data-ttu-id="ae44c-275">Так как каждая новая запись имеет `ProductID` значение больше, чем последняя, каждый раз, когда добавляется новый продукт, он добавляется в конец сетки.</span><span class="sxs-lookup"><span data-stu-id="ae44c-275">Since each new record has a `ProductID` value greater than the last one, every time a new product is added it is tacked on to the end of the grid.</span></span> <span data-ttu-id="ae44c-276">Поэтому при добавлении новой записи пользователь может захотеть автоматически отправить его на последнюю страницу GridView.</span><span class="sxs-lookup"><span data-stu-id="ae44c-276">Therefore, you may want to automatically send the user to the last page of the GridView after adding a new record.</span></span> <span data-ttu-id="ae44c-277">Это можно сделать, добавив следующую строку кода после вызова метода `ProductsDataSource.Insert()` в обработчике событий `RowCommand`, чтобы указать, что пользователь должен отправить на последнюю страницу после привязки данных к GridView:</span><span class="sxs-lookup"><span data-stu-id="ae44c-277">This can be accomplished by adding the following line of code after the call to `ProductsDataSource.Insert()` in the `RowCommand` event handler to indicate that the user needs to be sent to the last page after binding the data to the GridView:</span></span>

[!code-csharp[Main](inserting-a-new-record-from-the-gridview-s-footer-cs/samples/sample9.cs)]

<span data-ttu-id="ae44c-278">`SendUserToLastPage` — это логическая переменная на уровне страницы, которой изначально присвоено значение `false`.</span><span class="sxs-lookup"><span data-stu-id="ae44c-278">`SendUserToLastPage` is a page-level Boolean variable that is initially assigned a value of `false`.</span></span> <span data-ttu-id="ae44c-279">В обработчике событий `DataBound` GridView s, если `SendUserToLastPage` имеет значение false, свойство `PageIndex` обновляется для отправки пользователя на последнюю страницу.</span><span class="sxs-lookup"><span data-stu-id="ae44c-279">In the GridView s `DataBound` event handler, if `SendUserToLastPage` is false, the `PageIndex` property is updated to send the user to the last page.</span></span>

[!code-csharp[Main](inserting-a-new-record-from-the-gridview-s-footer-cs/samples/sample10.cs)]

<span data-ttu-id="ae44c-280">Причина, по которой свойство `PageIndex` задано в обработчике событий `DataBound` (в отличие от обработчика событий `RowCommand`), связано с тем, что при срабатывании обработчика событий `RowCommand` мы еще не добавили новую запись в таблицу базы данных `Products`.</span><span class="sxs-lookup"><span data-stu-id="ae44c-280">The reason the `PageIndex` property is set in the `DataBound` event handler (as opposed to the `RowCommand` event handler) is because when the `RowCommand` event handler fires we ve yet to add the new record to the `Products` database table.</span></span> <span data-ttu-id="ae44c-281">Таким образом, в обработчике событий `RowCommand` последний индекс страницы (`PageCount - 1`) представляет индекс последней страницы *до* добавления нового продукта.</span><span class="sxs-lookup"><span data-stu-id="ae44c-281">Therefore, in the `RowCommand` event handler the last page index (`PageCount - 1`) represents the last page index *before* the new product has been added.</span></span> <span data-ttu-id="ae44c-282">Для большинства добавляемых продуктов индекс последней страницы совпадает после добавления нового продукта.</span><span class="sxs-lookup"><span data-stu-id="ae44c-282">For the majority of products being added, the last page index is the same after adding the new product.</span></span> <span data-ttu-id="ae44c-283">Но если добавленный продукт получает новый индекс последней страницы, то при неправильном обновлении `PageIndex` в обработчике событий `RowCommand` будет выполнено переход на вторую страницу (индекс последней страницы до добавления нового продукта), а не на новый индекс последней страницы.</span><span class="sxs-lookup"><span data-stu-id="ae44c-283">But when the added product results in a new last page index, if we incorrectly update the `PageIndex` in the `RowCommand` event handler then we'll be taken to the second to last page (the last page index prior to adding the new product) as opposed to the new last page index.</span></span> <span data-ttu-id="ae44c-284">Так как обработчик событий `DataBound` срабатывает после добавления нового продукта и повторной привязки данных к сетке, установив свойство `PageIndex`, можно получить правильный индекс последней страницы.</span><span class="sxs-lookup"><span data-stu-id="ae44c-284">Since the `DataBound` event handler fires after the new product has been added and the data rebound to the grid, by setting the `PageIndex` property there we know we re getting the correct last page index.</span></span>

<span data-ttu-id="ae44c-285">Наконец, элемент управления GridView, используемый в этом учебнике, является довольно широким из-за количества полей, которые необходимо собрать для добавления нового продукта.</span><span class="sxs-lookup"><span data-stu-id="ae44c-285">Finally, the GridView used in this tutorial is quite wide due to the number of fields that must be collected for adding a new product.</span></span> <span data-ttu-id="ae44c-286">Из-за этой ширины предпочтительнее использовать вертикальный макет DetailsView s.</span><span class="sxs-lookup"><span data-stu-id="ae44c-286">Due to this width, a DetailsView s vertical layout might be preferred.</span></span> <span data-ttu-id="ae44c-287">Общую ширину GridView можно уменьшить, собрав меньшее число входов.</span><span class="sxs-lookup"><span data-stu-id="ae44c-287">The GridView s overall width could be reduced by collecting fewer inputs.</span></span> <span data-ttu-id="ae44c-288">Возможно, нам не нужно составлять `UnitsOnOrder`, `UnitsInStock`и `ReorderLevel` поля при добавлении нового продукта. в этом случае эти поля можно удалить из GridView.</span><span class="sxs-lookup"><span data-stu-id="ae44c-288">Perhaps we don t need to collect the `UnitsOnOrder`, `UnitsInStock`, and `ReorderLevel` fields when adding a new product, in which case these fields could be removed from the GridView.</span></span>

<span data-ttu-id="ae44c-289">Чтобы настроить собираемые данные, можно использовать один из двух способов.</span><span class="sxs-lookup"><span data-stu-id="ae44c-289">To adjust the data collected, we can use one of two approaches:</span></span>

- <span data-ttu-id="ae44c-290">Продолжайте использовать метод `AddProduct`, который ожидает значения полей `UnitsOnOrder`, `UnitsInStock`и `ReorderLevel`.</span><span class="sxs-lookup"><span data-stu-id="ae44c-290">Continue to use the `AddProduct` method that expects values for the `UnitsOnOrder`, `UnitsInStock`, and `ReorderLevel` fields.</span></span> <span data-ttu-id="ae44c-291">В обработчике событий `Inserting` укажите жестко запрограммированные значения по умолчанию, используемые для этих входных данных, которые были удалены из интерфейса вставки.</span><span class="sxs-lookup"><span data-stu-id="ae44c-291">In the `Inserting` event handler, provide hard-coded, default values to use for these inputs that have been removed from the inserting interface.</span></span>
- <span data-ttu-id="ae44c-292">Создайте новую перегрузку метода `AddProduct` в классе `ProductsBLL`, который не принимает входные данные для полей `UnitsOnOrder`, `UnitsInStock`и `ReorderLevel`.</span><span class="sxs-lookup"><span data-stu-id="ae44c-292">Create a new overload of the `AddProduct` method in the `ProductsBLL` class that does not accept inputs for the `UnitsOnOrder`, `UnitsInStock`, and `ReorderLevel` fields.</span></span> <span data-ttu-id="ae44c-293">Затем на странице ASP.NET настройте ObjectDataSource для использования этой новой перегрузки.</span><span class="sxs-lookup"><span data-stu-id="ae44c-293">Then, in the ASP.NET page, configure the ObjectDataSource to use this new overload.</span></span>

<span data-ttu-id="ae44c-294">Любой из этих вариантов также будет работать одинаково.</span><span class="sxs-lookup"><span data-stu-id="ae44c-294">Either option will work equally as well.</span></span> <span data-ttu-id="ae44c-295">В прошлых учебных курсах мы использовали второй вариант, создавая несколько перегрузок для метода `UpdateProduct` `ProductsBLL` Class s.</span><span class="sxs-lookup"><span data-stu-id="ae44c-295">In past tutorials we used the latter option, creating multiple overloads for the `ProductsBLL` class s `UpdateProduct` method.</span></span>

## <a name="summary"></a><span data-ttu-id="ae44c-296">Сводка</span><span class="sxs-lookup"><span data-stu-id="ae44c-296">Summary</span></span>

<span data-ttu-id="ae44c-297">В GridView отсутствуют встроенные возможности вставки, находящиеся в DetailsView и FormView, но с небольшой наработкой интерфейс вставки можно добавить в строку нижнего колонтитула.</span><span class="sxs-lookup"><span data-stu-id="ae44c-297">The GridView lacks the built-in inserting capabilities found in the DetailsView and FormView, but with a bit of effort an inserting interface can be added to the footer row.</span></span> <span data-ttu-id="ae44c-298">Чтобы отобразить строку нижнего колонтитула в GridView, достаточно установить для свойства `ShowFooter` значение `true`.</span><span class="sxs-lookup"><span data-stu-id="ae44c-298">To display the footer row in a GridView simply set its `ShowFooter` property to `true`.</span></span> <span data-ttu-id="ae44c-299">Содержимое строки нижнего колонтитула можно настроить для каждого поля путем преобразования поля в TemplateField и добавления интерфейса вставки в `FooterTemplate`.</span><span class="sxs-lookup"><span data-stu-id="ae44c-299">The footer row content can be customized for each field by converting the field to a TemplateField and adding the inserting interface to the `FooterTemplate`.</span></span> <span data-ttu-id="ae44c-300">Как было показано в этом учебнике, `FooterTemplate` может содержать кнопки, текстовые поля, элементов управления DropDownList, флажки, элементы управления источниками данных для заполнения веб-элементов управления, управляемых данными (например, элементов управления DropDownList), и элементов управления проверки.</span><span class="sxs-lookup"><span data-stu-id="ae44c-300">As we saw in this tutorial, the `FooterTemplate` can contain Buttons, TextBoxes, DropDownLists, CheckBoxes, data source controls for populating data-driven Web controls (such as DropDownLists), and validation controls.</span></span> <span data-ttu-id="ae44c-301">Вместе с элементами управления для сбора входных данных пользователя требуется кнопка Add, LinkButton или ImageButton.</span><span class="sxs-lookup"><span data-stu-id="ae44c-301">Along with controls for collecting the user s input, an Add Button, LinkButton, or ImageButton is needed.</span></span>

<span data-ttu-id="ae44c-302">При нажатии кнопки "Добавить" вызывается метод `Insert()` ObjectDataSource s для запуска рабочего процесса вставки.</span><span class="sxs-lookup"><span data-stu-id="ae44c-302">When the Add button is clicked, the ObjectDataSource s `Insert()` method is invoked to start the inserting workflow.</span></span> <span data-ttu-id="ae44c-303">Затем ObjectDataSource вызывает настроенный метод Insert (метод `ProductsBLL` класса s `AddProduct` в этом руководстве).</span><span class="sxs-lookup"><span data-stu-id="ae44c-303">The ObjectDataSource will then call the configured insert method (the `ProductsBLL` class s `AddProduct` method, in this tutorial).</span></span> <span data-ttu-id="ae44c-304">Необходимо скопировать значения из интерфейса вставки GridView s в коллекцию ObjectDataSource `InsertParameters`, прежде чем вызываемый метод вставки.</span><span class="sxs-lookup"><span data-stu-id="ae44c-304">We must copy the values from the GridView s inserting interface to the ObjectDataSource s `InsertParameters` collection prior to the insert method being invoked.</span></span> <span data-ttu-id="ae44c-305">Это можно сделать, программно обратившись к веб-элементам управления "интерфейс вставки" в обработчике событий ObjectDataSource `Inserting`.</span><span class="sxs-lookup"><span data-stu-id="ae44c-305">This can be accomplished by programmatically referencing the inserting interface Web controls in the ObjectDataSource s `Inserting` event handler.</span></span>

<span data-ttu-id="ae44c-306">В этом руководстве мы подробно рассмотрим методы улучшения внешнего вида GridView s.</span><span class="sxs-lookup"><span data-stu-id="ae44c-306">This tutorial completes our look at techniques for enhancing the GridView s appearance.</span></span> <span data-ttu-id="ae44c-307">В следующем наборе учебников рассматривается работа с двоичными данными, такими как изображения, PDF-файлы, документы Word и т. д. и элементы управления данными.</span><span class="sxs-lookup"><span data-stu-id="ae44c-307">The next set of tutorials will examine how to work with binary data such as images, PDFs, Word documents, and so on and the data Web controls.</span></span>

<span data-ttu-id="ae44c-308">Поздравляем с программированием!</span><span class="sxs-lookup"><span data-stu-id="ae44c-308">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="ae44c-309">Об авторе</span><span class="sxs-lookup"><span data-stu-id="ae44c-309">About the Author</span></span>

<span data-ttu-id="ae44c-310">[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи книг по ASP/ASP. NET и основатель [4GuysFromRolla.com](http://www.4guysfromrolla.com), работал с веб-технологиями Майкрософт с 1998.</span><span class="sxs-lookup"><span data-stu-id="ae44c-310">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="ae44c-311">Скотт работает как независимый консультант, преподаватель и модуль записи.</span><span class="sxs-lookup"><span data-stu-id="ae44c-311">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="ae44c-312">Его последняя книга — [*Sams обучать себя ASP.NET 2,0 за 24 часа*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="ae44c-312">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="ae44c-313">Он доступен по адресу [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="ae44c-313">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="ae44c-314">или через его блог, который можно найти по адресу [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="ae44c-314">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="ae44c-315">Специальная благодарность</span><span class="sxs-lookup"><span data-stu-id="ae44c-315">Special Thanks To</span></span>

<span data-ttu-id="ae44c-316">Эта серия руководств была рассмотрена многими полезными рецензентами.</span><span class="sxs-lookup"><span data-stu-id="ae44c-316">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="ae44c-317">Специалист по интересу для этого руководства был Бернадетте Леигх.</span><span class="sxs-lookup"><span data-stu-id="ae44c-317">Lead reviewer for this tutorial was Bernadette Leigh.</span></span> <span data-ttu-id="ae44c-318">Хотите ознакомиться с моими будущими статьями MSDN?</span><span class="sxs-lookup"><span data-stu-id="ae44c-318">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="ae44c-319">Если это так, расположите строку в [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="ae44c-319">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="ae44c-320">[Назад](adding-a-gridview-column-of-checkboxes-cs.md)
> [Вперед](adding-a-gridview-column-of-radio-buttons-vb.md)</span><span class="sxs-lookup"><span data-stu-id="ae44c-320">[Previous](adding-a-gridview-column-of-checkboxes-cs.md)
[Next](adding-a-gridview-column-of-radio-buttons-vb.md)</span></span>
