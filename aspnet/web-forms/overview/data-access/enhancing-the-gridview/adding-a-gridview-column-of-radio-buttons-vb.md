---
uid: web-forms/overview/data-access/enhancing-the-gridview/adding-a-gridview-column-of-radio-buttons-vb
title: Добавление столбца GridView переключателей (Visual Basic) | Документация Майкрософт
author: rick-anderson
description: Этот учебник рассказывает, как для добавления столбца кнопок-переключателей для элемента управления GridView для предоставления пользователю более интуитивно понятный способ выбора одной строки...
ms.author: riande
ms.date: 03/06/2007
ms.assetid: 2e31b60b-8723-4f14-b7ee-37859454dc3b
msc.legacyurl: /web-forms/overview/data-access/enhancing-the-gridview/adding-a-gridview-column-of-radio-buttons-vb
msc.type: authoredcontent
ms.openlocfilehash: 76b3dbd502eff7c97f57fdacd120ac2312aaceae
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/01/2019
ms.locfileid: "57061021"
---
<a name="adding-a-gridview-column-of-radio-buttons-vb"></a>Добавление столбца GridView переключателей (VB)
====================
по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Скачайте пример приложения](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_51_VB.exe) или [скачать PDF](adding-a-gridview-column-of-radio-buttons-vb/_static/datatutorial51vb1.pdf)

> Этом руководстве рассказывается, как для добавления столбца кнопок-переключателей для элемента управления GridView для предоставления пользователю более интуитивно понятный способ выбора одной строки GridView.


## <a name="introduction"></a>Вступление

Элемент управления GridView предоставляет немало встроенных функциональных возможностей. Он включает в себя несколько разных полей для отображения текста, изображений, гиперссылки и кнопки. Он поддерживает шаблоны для дальнейшей настройки. Несколькими щелчками мыши оно s, возможно, чтобы сделать элемент управления GridView, где можно выбрать каждую строку по нажатию кнопки или чтобы включить изменение или удаление возможностей. Несмотря на множество имеющиеся функции часто будет ситуаций, в которых дополнительные, неподдерживаемых функций будет необходимо добавить. В этом руководстве и следующих двух мы рассмотрим, как расширить функциональность s GridView, чтобы включить дополнительные функции.

Этот учебник и еще один сосредоточиться на улучшение процесса выбора строк. Как изучить в [Master/Detail, с помощью выбираемого основного элемента GridView с DetailView](../masterdetail/master-detail-using-a-selectable-master-gridview-with-a-details-detailview-vb.md), мы можем добавить поле CommandField GridView, который включает кнопки "выбрать". При щелчке, обратная и GridView s `SelectedIndex` обновляется индекс строки, в которых кнопка "выбрать" была нажата. В [Master/Detail, с помощью выбираемого основного элемента GridView с DetailView](../masterdetail/master-detail-using-a-selectable-master-gridview-with-a-details-detailview-vb.md) было показано, как использовать эту функцию для отображения сведений по выбранной строки GridView.

Кнопка "выбрать" работает во многих ситуациях, он может не работать также для других пользователей. Вместо использования кнопки, два других элементов пользовательского интерфейса обычно используются для выбора: переключатель и флажок. Мы можем расширить GridView, таким образом, вместо кнопки "выбрать", каждая строка содержит переключателя или флажка. В сценариях, где пользователь может выбрать только одну из записей GridView переключатель может быть предпочтительнее кнопки "выбрать". В ситуациях, где пользователь может выбрать несколько записей, например в электронной почты, веб-приложении, где пользователь может потребоваться выбрать несколько сообщений, чтобы удалить флажок предлагает возможности, не доступно для кнопки "выбрать" или "переключатель" пользовательские интерфейсы.

Этом руководстве рассказывается, как добавить столбец кнопок-переключателей к GridView. Продолжить руководстве описано, как использовать флажки.

## <a name="step-1-creating-the-enhancing-the-gridview-web-pages"></a>Шаг 1. Создание веб-страниц GridView улучшение

Прежде чем приступать к улучшение GridView, чтобы включить столбец кнопок-переключателей, позвольте s уделим несколько минут созданию в нашем проекте веб-сайта, что нам понадобится для этого учебника и следующих двух страниц ASP.NET. Начните с добавления новой папки с именем `EnhancedGridView`. Добавьте следующие страницы ASP.NET в этой папке, не забывая связывать каждую с `Site.master` главной страницы:

- `Default.aspx`
- `RadioButtonField.aspx`
- `CheckBoxField.aspx`
- `InsertThroughFooter.aspx`


![Добавление страниц ASP.NET для элемента управления SqlDataSource руководств](adding-a-gridview-column-of-radio-buttons-vb/_static/image1.gif)

**Рис. 1**: Добавление страниц ASP.NET для элемента управления SqlDataSource руководств


Как и в других папках, `Default.aspx` в `EnhancedGridView` папку перечислит учебные курсы в своем разделе. Помните, что `SectionLevelTutorialListing.ascx` пользовательский элемент управления предоставляет следующие функциональные возможности. Поэтому добавьте данный пользовательский элемент управления для `Default.aspx` , перетащив его из обозревателя решений на странице s режиме конструктора.


[![Добавление элемента управления Sectionleveltutoriallisting.ascx к странице Default.aspx](adding-a-gridview-column-of-radio-buttons-vb/_static/image2.gif)](adding-a-gridview-column-of-radio-buttons-vb/_static/image1.png)

**Рис. 2**: Добавить `SectionLevelTutorialListing.ascx` для пользовательского элемента управления `Default.aspx` ([Просмотр полноразмерного изображения](adding-a-gridview-column-of-radio-buttons-vb/_static/image2.png))


Наконец, добавьте эти четыре страницы как записи для `Web.sitemap` файла. В частности, добавьте следующую разметку после использование элемента управления SqlDataSource `<siteMapNode>`:


[!code-xml[Main](adding-a-gridview-column-of-radio-buttons-vb/samples/sample1.xml)]

После обновления `Web.sitemap`, Отвлекитесь и просмотрите учебный веб-узел в обозревателе. В меню слева теперь есть элементы для редактирования, вставки и удаления учебных курсов.


![Карта узла теперь включают записи для совершенствования учебники GridView](adding-a-gridview-column-of-radio-buttons-vb/_static/image3.gif)

**Рис. 3**: Карта узла теперь включают записи для совершенствования учебники GridView


## <a name="step-2-displaying-the-suppliers-in-a-gridview"></a>Шаг 2. Отображение поставщиков в элементе управления GridView

Для этого руководства позволяют s построения элемента управления GridView, перечисляющего поставщиков из США, с каждой строкой GridView, предоставляя типа "переключатель". После выбора поставщика с помощью переключателя, пользователь может просмотреть продукты поставщика нажатием кнопки. Хотя эта задача может показаться тривиальным, есть несколько тонкостей, которые упрощают задача особенно сложная. Прежде чем мы углубимся в этих тонкостей, позвольте s сначала нужно получить список поставщиков GridView.

Сначала откройте `RadioButtonField.aspx` странице в `EnhancedGridView` папки, перетащив элемент управления GridView с панели инструментов в конструктор. Набор GridView s `ID` для `Suppliers` и его смарт-теге решили создать новый источник данных. В частности, для создания нового ObjectDataSource, именуемого `SuppliersDataSource` , извлекает свои данные из `SuppliersBLL` объекта.


[![Создайте новый ObjectDataSource, именуемого SuppliersDataSource](adding-a-gridview-column-of-radio-buttons-vb/_static/image4.gif)](adding-a-gridview-column-of-radio-buttons-vb/_static/image3.png)

**Рис. 4**: Создайте новый ObjectDataSource с именем `SuppliersDataSource` ([Просмотр полноразмерного изображения](adding-a-gridview-column-of-radio-buttons-vb/_static/image4.png))


[![Настройка ObjectDataSource на использование метода Getsuppliers() класса](adding-a-gridview-column-of-radio-buttons-vb/_static/image5.gif)](adding-a-gridview-column-of-radio-buttons-vb/_static/image5.png)

**Рис. 5**: Настройка ObjectDataSource для использования `SuppliersBLL` класс ([Просмотр полноразмерного изображения](adding-a-gridview-column-of-radio-buttons-vb/_static/image6.png))


Поскольку нам требуется только список этих поставщиков в США, выберите `GetSuppliersByCountry(country)` метода из раскрывающегося списка на вкладке "SELECT".


[![Настройка ObjectDataSource на использование метода Getsuppliers() класса](adding-a-gridview-column-of-radio-buttons-vb/_static/image6.gif)](adding-a-gridview-column-of-radio-buttons-vb/_static/image7.png)

**Рис. 6**: Настройка ObjectDataSource для использования `SuppliersBLL` класс ([Просмотр полноразмерного изображения](adding-a-gridview-column-of-radio-buttons-vb/_static/image8.png))


Обновление вкладки, выберите (нет) и нажмите кнопку Далее.


[![Настройка ObjectDataSource на использование метода Getsuppliers() класса](adding-a-gridview-column-of-radio-buttons-vb/_static/image7.gif)](adding-a-gridview-column-of-radio-buttons-vb/_static/image9.png)

**Рис. 7**: Настройка ObjectDataSource для использования `SuppliersBLL` класс ([Просмотр полноразмерного изображения](adding-a-gridview-column-of-radio-buttons-vb/_static/image10.png))


Так как `GetSuppliersByCountry(country)` метод принимает параметр, мастер настройки источников данных запрашивает источник этого параметра. Чтобы указать жестко запрограммированное значение (в этом примере США) оставить параметр источника стрелку раскрывающегося списка значение None и введите значение по умолчанию в текстовом поле. Нажмите кнопку Готово, чтобы завершить работу мастера.


[![Использовать США в качестве значения по умолчанию для параметра страны](adding-a-gridview-column-of-radio-buttons-vb/_static/image8.gif)](adding-a-gridview-column-of-radio-buttons-vb/_static/image11.png)

**Рис. 8**: Используйте в качестве значения по умолчанию для США `country` параметра ([Просмотр полноразмерного изображения](adding-a-gridview-column-of-radio-buttons-vb/_static/image12.png))


По завершении работы мастера GridView будет включать BoundField для каждого поля данных поставщика. Удалите все, кроме `CompanyName`, `City`, и `Country` полей BoundField и переименуйте `CompanyName` поля BoundField, кроме `HeaderText` свойства поставщика. После этого GridView и элемент управления ObjectDataSource должен выглядеть следующим образом.


[!code-aspx[Main](adding-a-gridview-column-of-radio-buttons-vb/samples/sample2.aspx)]

Для этого руководства позволяют s разрешить пользователю просмотр выбранного поставщика продукты, на ту же страницу списка поставщиков или на другую страницу. Чтобы решить эту проблему, добавьте две кнопки веб-элементов управления на страницу. Я набора ve `ID` s из этих двух кнопок `ListProducts` и `SendToProducts`, на идее, что при `ListProducts` щелчке произойдет обратная передача, и продукты выбранного поставщика s появится в списке на этой же странице, но когда `SendToProducts` нажатии пользователь будет перейти на другую страницу, которая перечисляет продукты.

Рис. 9 показана `Suppliers` GridView и два веб-кнопка управляет при просмотре через браузер.


[![Поставщики из США имеют свои имя, Город и Страна информация, указанная](adding-a-gridview-column-of-radio-buttons-vb/_static/image9.gif)](adding-a-gridview-column-of-radio-buttons-vb/_static/image13.png)

**Рис. 9**: Поставщики из США имеют их имя города и страны в списке сведения ([Просмотр полноразмерного изображения](adding-a-gridview-column-of-radio-buttons-vb/_static/image14.png))


## <a name="step-3-adding-a-column-of-radio-buttons"></a>Шаг 3. Добавление столбца кнопок-переключателей

На этом этапе `Suppliers` GridView есть три поля BoundField, кроме отображения название компании, Город и Страна всех поставщиков в США. Столбец кнопок-переключателей, однако по-прежнему некий. К сожалению t GridView включают встроенные RadioButtonField, в противном случае мы можем просто добавить, в сетку и выполняться. Вместо этого можно добавить поле TemplateField и настроить его `ItemTemplate` для отображения типа "переключатель", приводит к типа "переключатель" для каждой строки GridView.

Изначально мы предположить, что нужный пользовательский интерфейс можно реализовать, добавив RadioButton веб-элемент управления для `ItemTemplate` из TemplateField. Хотя это будет действительно добавить отдельного переключателя к каждой строке GridView, переключатели не могут быть сгруппированы и следовательно не являются взаимоисключающими. То есть пользователь имеет возможность одновременный выбор нескольких переключателей из GridView.

Несмотря на то, что использование TemplateField RadioButton веб-элементов управления не предлагает функциональные возможности, нам нужно, s позволяют реализовать этот подход, так как он s, следует выяснить, почему итоговый переключатели не группируются. Начните с добавления TemplateField для поставщиков GridView, делая, крайнего левого поля. Затем s смарт-теге GridView, щелкните ссылку Изменить шаблоны и перетащите элемент управления RadioButton Web из области элементов в TemplateField s `ItemTemplate` (см. рис. 10). Набор RadioButton s `ID` свойства `RowSelector` и `GroupName` свойства `SuppliersGroup`.


[![Добавление элемента управления RadioButton Web ItemTemplate](adding-a-gridview-column-of-radio-buttons-vb/_static/image10.gif)](adding-a-gridview-column-of-radio-buttons-vb/_static/image15.png)

**Рис. 10**: Добавить веб-элемент управления RadioButton для `ItemTemplate` ([Просмотр полноразмерного изображения](adding-a-gridview-column-of-radio-buttons-vb/_static/image16.png))


После внесения этих изменений в конструкторе, разметка GridView s должен выглядеть следующим образом:


[!code-aspx[Main](adding-a-gridview-column-of-radio-buttons-vb/samples/sample3.aspx)]

RadioButton s [ `GroupName` свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.radiobutton.groupname(VS.80).aspx) используется для группирования ряд переключателей. Все элементы управления RadioButton с тем же `GroupName` значения считаются сгруппированных; из группы одновременно можно выбрать только один переключатель. `GroupName` Свойство задает значения для отображаемого переключателя s `name` атрибута. Браузер проверяет переключателей `name` атрибутам, чтобы определить радио кнопку группирований.

С помощью веб-управления RadioButton добавляемый `ItemTemplate`, посетите эту страницу через обозреватель и щелкнуть переключатели в строки сетки s. Обратите внимание, что как переключатели не группируются, что позволяет выбрать все строки, как на рис. 11 показан.


[![Переключатели GridView s не группируются](adding-a-gridview-column-of-radio-buttons-vb/_static/image11.gif)](adding-a-gridview-column-of-radio-buttons-vb/_static/image17.png)

**Рис. 11**: Переключатели GridView s не группируются ([Просмотр полноразмерного изображения](adding-a-gridview-column-of-radio-buttons-vb/_static/image18.png))


Переключатели не сгруппированы, так как их готовый для просмотра `name` атрибуты отличаются, несмотря на то, имеющих одинаковый `GroupName` значение свойства. Чтобы просмотреть эти различия, выполнить просмотр исходного кода из обозревателя и проверьте разметку переключателей кнопки:


[!code-html[Main](adding-a-gridview-column-of-radio-buttons-vb/samples/sample4.html)]

Обратите внимание, что как оба `name` и `id` атрибуты не точные значения, как указано в окне «Свойства», но предваряются символом количество других `ID` значения. Дополнительный `ID` значения, добавленные в начало отображаемого объекта `id` и `name` атрибуты являются `ID` s переключателя кнопки родительских элементов управления `GridViewRow` s `ID` s, GridView s `ID`, Содержимое элемента управления s `ID`и веб-формы s `ID`. Эти `ID` s добавляются, что всех преобразуемых веб-элемента управления GridView содержит уникальное `id` и `name` значения.

Всех преобразуемых потребности управления другой `name` и `id` так, как это как браузер однозначно определяет каждый элемент управления на стороне клиента и том, как он определяет на веб-сервер какое действие или было изменено при обратной передаче. Например представьте, что мы хотели бы выполняться код на стороне сервера при каждом RadioButton s извлечен состояние было изменено. Это может сделать, задав RadioButton s `AutoPostBack` свойства `True` и Создание обработчика событий для `CheckChanged` событий. Тем не менее если создаваемые `name` и `id` значения для всех переключателей были теми же, на обратной передачи не удалось определить какие именно RadioButton была нажата.

Краткосрочного его является то, что мы не удается создать столбец кнопок-переключателей в элементе управления GridView с помощью элемента управления RadioButton. Вместо этого необходимо использовать вместо древнее методы чтобы убедиться, что соответствующая разметка внедряется в каждой строки GridView.

> [!NOTE]
> Как и веб-управления RadioButton, переключатель HTML-элемент управления, при добавлении в шаблон, будет включать уникальный `name` атрибута, что переключатели в сетке несгруппированные. Если вы не знакомы с HTML-элементы управления, вы можете пропустить эту заметку, как редко используются элементы управления HTML, особенно в ASP.NET 2.0. Но если вы заинтересованы в получении дополнительной, см. в разделе [к. Скотт Аллен](http://odetocode.com/blogs/scott/default.aspx) запись в блоге s [веб-элементы управления и элементы управления HTML](http://www.odetocode.com/Articles/348.aspx).


## <a name="using-a-literal-control-to-inject-radio-button-markup"></a>Использование литерала элемента управления для добавления кнопки разметку переключателей

Чтобы правильно группирования всех переключателей в пределах GridView, нам нужно вручную запустить разметку переключателей кнопки в `ItemTemplate`. Каждый переключатель должен же `name` атрибута, но должен иметь уникальный `id` атрибута (если необходимо получить доступ типа "переключатель" с помощью скрипта на стороне клиента). Когда пользователь выбирает типа "переключатель" и сообщения обратно странице, браузер отправит обратно значение выбранного переключателя s `value` атрибута. Таким образом, потребуется уникальный каждого переключателя `value` атрибута. Наконец, при обратной передаче нужно обязательно добавьте `checked` атрибут один переключатель, который выбран, в противном случае после пользователь делает выбор и сообщения обратно, переключатели вернется к состоянию по умолчанию (все невыбранные).

Существует два подхода, которые можно использовать для вставки низкоуровневые разметки в шаблон. Один заключается в осуществлении разметки и вызовы методов, определенных в классе фонового кода форматирования. Этот метод впервые было рассказано в [использование полей TemplateField в элементе управления GridView](../custom-formatting/using-templatefields-in-the-gridview-control-vb.md) руководства. В нашем случае он может выглядеть примерно так:


[!code-aspx[Main](adding-a-gridview-column-of-radio-buttons-vb/samples/sample5.aspx)]

Здесь `GetUniqueRadioButton` и `GetRadioButtonValue` бы методы, определенные в классе фонового кода, который возвращается соответствующий `id` и `value` значения для каждого переключателя атрибутов. Этот подход хорошо работает для назначения `id` и `value` атрибуты, но не хватает, при необходимости указания `checked` значение атрибута, так как синтаксис привязки данных выполняется только в том случае, когда данные сначала будут привязаны к GridView. Таким образом, если у GridView есть состояние просмотра включено, методы форматирования возникает только при первой загрузке страницы (или когда GridView явно повторно привязываются к источнику данных) и поэтому функция, которая задает `checked` допускался атрибут выиграл t обратной передачи. Он s довольно деталь и немного выходит за рамки данной статьи, поэтому я оставляю это. Я сделать, тем не менее, рекомендуем вам попробовать выше подход и работать через точку, где вы будете уверены. Хотя такие t упражнения выиграл получить все ближе до рабочей версии, он поможет стимулировать углубленное рассмотрение GridView и жизненный цикл привязки данных.

Другой подход для добавления пользовательских низкоуровневые разметки в шаблон и подход, который мы будем использовать для этого учебника является добавление [управления Literal](https://msdn.microsoft.com/library/sz4949ks(VS.80).aspx) в шаблон. Затем в GridView s `RowCreated` или `RowDataBound` обработчик событий, текстовый элемент управления может осуществляться программными средствами и его `Text` свойства в разметку для выпуска.

Удалите элемент управления RadioButton из TemplateField s `ItemTemplate`, заменив его элементом управления. Значение литерала элемента управления s `ID` для `RadioButtonMarkup`.


[![Добавление литерала элемента управления ItemTemplate](adding-a-gridview-column-of-radio-buttons-vb/_static/image12.gif)](adding-a-gridview-column-of-radio-buttons-vb/_static/image19.png)

**Рис. 12**: Добавление литерала элемента управления к `ItemTemplate` ([Просмотр полноразмерного изображения](adding-a-gridview-column-of-radio-buttons-vb/_static/image20.png))


Создайте обработчик событий для GridView s `RowCreated` событий. `RowCreated` Событие запускается, когда для каждой добавляемой строки ли данные повторно привязываются к GridView. Это означает, что даже на обратную передачу при повторной загрузке данных из состояния представления, `RowCreated` событие по-прежнему запускается, и вот почему мы используем его вместо `RowDataBound` (который срабатывает, только когда данные явно связан с данным веб-элемента управления).

В этом обработчике событий должны продолжать, если мы повторно освободили строку данных. Для каждой строки данных необходимо создавать программную ссылку на `RadioButtonMarkup` литерала элемента управления и задайте его `Text` свойства в разметку для выпуска. Как в следующем коде показано, в разметке, генерируемой создает переключателя кнопку с заданным `name` атрибуту присваивается `SuppliersGroup`, чей `id` атрибут имеет значение `RowSelectorX`, где *X* — это индекс строке GridView а `value` атрибуту присваивается индекс строки GridView.


[!code-vb[Main](adding-a-gridview-column-of-radio-buttons-vb/samples/sample6.vb)]

Если выбрана строка GridView происходит обратная передача, нас интересует `SupplierID` выбранного поставщика. Таким образом, может показаться, что значение каждого переключателя должно быть фактическим `SupplierID` (а не индекс строки GridView). Хотя это может работать в определенных обстоятельствах, было бы угрозу безопасности, чтобы вслепую принимать и обрабатывать `SupplierID`. Наши GridView, например, список только тех поставщиков в США. Тем не менее если `SupplierID` передается непосредственно из переключатель, какие s, чтобы остановить хитрый пользователя из управления `SupplierID` значение, отправляемое обратно на обратную передачу? С помощью строки индекса в качестве `value`, а затем `SupplierID` при обратной передаче из `DataKeys` коллекции, мы можно убедиться, что пользователь является только одним из `SupplierID` значения, связанные с одной из строк GridView.

Когда вы добавите этот код обработчика событий, внимательно протестировать страницу в браузере. Во-первых, обратите внимание, что только один переключатель можно нажать кнопку в сетке одновременно. Тем не менее, при выборе типа "переключатель", а также выбрать одну из кнопок, происходит обратная передача и всех переключателей восстановить исходное состояние (то есть при обратной передаче выбранного переключателя больше не выбран). Чтобы устранить эту проблему, нам нужно дополнить `RowCreated` обработчик событий, так что он проверяет индекс кнопки выбранного переключателя, отправленные из обратной передачи и добавляет `checked="checked"` атрибут порожденную разметки совпадения строк индекса.

Когда происходит обратная передача, а браузер отправляет обратно `name` и `value` выбранного переключателя. Значение можно программно получить с помощью `Request.Form("name")`. [ `Request.Form` Свойство](https://msdn.microsoft.com/library/system.web.httprequest.form.aspx) предоставляет [ `NameValueCollection` ](https://msdn.microsoft.com/library/system.collections.specialized.namevaluecollection.aspx) представляющий переменных формы. Переменные формы являются имена и значения полей формы в веб-страницы и отправляются обратно веб-обозревателем, каждый раз, когда выполняется обратная. Так как готовый для просмотра `name` атрибут переключателей в GridView `SuppliersGroup`, при публикации веб-страницу назад, браузер будет отправлять `SuppliersGroup=valueOfSelectedRadioButton` веб-сервере (а также другие поля формы). Эта информация затем может быть организован `Request.Form` свойства с помощью: `Request.Form("SuppliersGroup")`.

С момента мы будем нужны для определения выбранного переключателя индексировать не только в `RowCreated` обработчик событий, но в `Click` добавить обработчики событий для кнопки веб-элементы управления, позволяющие s `SuppliersSelectedIndex` свойство к классу кода, который возвращает `-1`Если был выбран переключатель "Нет" и выбранного индекса, если выбран один из переключателей.


[!code-vb[Main](adding-a-gridview-column-of-radio-buttons-vb/samples/sample7.vb)]

Это свойство добавлен, мы знаем, чтобы добавить `checked="checked"` разметки в `RowCreated` обработчик событий при `SuppliersSelectedIndex` равно `e.Row.RowIndex`. Обновите этот обработчик событий, включение этой логики:


[!code-vb[Main](adding-a-gridview-column-of-radio-buttons-vb/samples/sample8.vb)]

Благодаря этому изменению выбранного переключателя остается выбранным после обратной передачи. Теперь, когда у нас есть возможность указать, какой переключатель, мы может изменить поведение, так что при первом посещении страницы был выбран первый переключатель строк GridView (вместо того, не переключателей, по умолчанию, который является текущим поведение). Чтобы включить для первого переключателя по умолчанию, просто измените `If SuppliersSelectedIndex = e.Row.RowIndex Then` следующим образом: `If SuppliersSelectedIndex = e.Row.RowIndex OrElse (Not Page.IsPostBack AndAlso e.Row.RowIndex = 0) Then`.

На этом этапе мы добавили столбец сгруппированных переключателей к GridView, позволяющий выделить и запоминать одной строки GridView. Наши вам потребуется отобразить продукты, предоставляемые выбранным поставщиком. На шаге 4 мы будет показано, как перенаправить пользователя на другую страницу отправки вдоль выбранного `SupplierID`. На шаге 5 узнаете, как для отображения в элементе управления GridView на той же странице продукты выбранного поставщика.

> [!NOTE]
> Вместо того чтобы использовать поле TemplateField (тема этой длительной шаг 3), мы создадим пользовательский `DataControlField` класс, который выводит соответствующий пользовательский интерфейс и функциональность. [ `DataControlField` Класс](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datacontrolfield.aspx) является базовым классом, от которого наследуют BoundField, CheckBoxField, TemplateField и другие встроенные поля GridView и DetailsView. Создание настраиваемого `DataControlField` класс означает столбец кнопок-переключателей может быть добавлен только с помощью декларативного синтаксиса что Кроме того, предоставляющие функции на других веб-страниц и другие веб-приложения значительно проще.


Если ve когда-либо созданных пользовательских, компилируются элементы управления в ASP.NET, тем не менее, вы знаете, что это так требуется значительный объем подготовительная работа и несет с собой множество тонкостей и крайних случаев, которые нужно тщательно обработать. Таким образом, мы будет отказаться от реализации столбец кнопок-переключателей как строка настраиваемого `DataControlField` класса сейчас и продолжайте применять параметр TemplateField. Возможно, будет возможность познакомиться с создание, использование и развертывание пользовательских `DataControlField` классы в следующем учебном курсе!

## <a name="step-4-displaying-the-selected-supplier-s-products-in-a-separate-page"></a>Шаг 4. Отображение продукты выбранного поставщика на отдельной странице

После выбора пользователем строке GridView необходимо показать продукты выбранного поставщика. В некоторых случаях нам может потребоваться отображение этих продуктов в отдельную страницу, в других случаях мы можете сделать это в той же странице. Позвольте s сначала рассмотрим, как отображение продуктов в отдельную страницу; на шаге 5 мы рассмотрим добавить GridView к `RadioButtonField.aspx` для отображения продукты выбранного поставщика s.

В настоящее время существует две кнопки элементах на странице `ListProducts` и `SendToProducts`. Когда `SendToProducts` кнопки, мы хотим отправить пользователю `~/Filtering/ProductsForSupplierDetails.aspx`. Эта страница была создана в ["основной/подробности" Фильтрация по две страницы](../masterdetail/master-detail-filtering-across-two-pages-vb.md) учебник и отображает продукты для поставщика, `SupplierID` передается через поле строки запроса с именем `SupplierID`.

Для обеспечения данной функциональности, создайте обработчик событий для `SendToProducts` кнопку s `Click` событий. На шаге 3 мы добавили `SuppliersSelectedIndex` свойство, которое возвращает индекс строки, переключатель выбран. Соответствующий `SupplierID` могут быть получены из GridView s `DataKeys` коллекции и пользователь затем может передаваться к `~/Filtering/ProductsForSupplierDetails.aspx?SupplierID=SupplierID` с помощью `Response.Redirect("url")`.


[!code-vb[Main](adding-a-gridview-column-of-radio-buttons-vb/samples/sample9.vb)]

Этот код прекрасно работает, до тех пор, пока один из переключателей выбирается из GridView. Если изначально GridView не поддерживает все переключатели выбран и пользователь нажимает кнопку `SendToProducts` кнопки `SuppliersSelectedIndex` будет `-1`, которое может вызвать исключение, поскольку у `-1` выходит за пределы диапазона индексов `DataKeys`коллекции. Это не столь важно, тем не менее, если вы решили обновить `RowCreated` обработчик событий, как описано в шаге 3, таким образом, чтобы иметь для первого переключателя в GridView изначально выбираются.

В соответствии с `SuppliersSelectedIndex` значение `-1`, добавьте элемент управления Label Web страницы над элементом управления GridView. Задайте его `ID` свойства `ChooseSupplierMsg`, ее `CssClass` свойства `Warning`, ее `EnableViewState` и `Visible` свойства `False`и его `Text` свойство до сначала необходимо выбрать поставщика из сетки. Класс CSS `Warning` отображает текст красного, курсив, полужирный и больших шрифта и определен в `Styles.css`. Задав `EnableViewState` и `Visible` свойства `False`, метка не отображается за исключением для только те обратные передачи, где элемент управления s `Visible` программно свойству `True`.


[![Добавьте элемент управления Label Web над элементом управления GridView](adding-a-gridview-column-of-radio-buttons-vb/_static/image13.gif)](adding-a-gridview-column-of-radio-buttons-vb/_static/image21.png)

**Рис. 13**: Добавить метку Web управления выше элемента управления GridView ([Просмотр полноразмерного изображения](adding-a-gridview-column-of-radio-buttons-vb/_static/image22.png))


Затем дополнить `Click` обработчик событий для отображения `ChooseSupplierMsg` метку, если `SuppliersSelectedIndex` меньше нуля и перенаправить пользователя на `~/Filtering/ProductsForSupplierDetails.aspx?SupplierID=SupplierID` в противном случае.


[!code-vb[Main](adding-a-gridview-column-of-radio-buttons-vb/samples/sample10.vb)]

Откройте страницу в обозревателе и нажмите кнопку `SendToProducts` кнопку, затем выберите поставщика в GridView. Как показано на рис. 14, откроется `ChooseSupplierMsg` метки. Затем выберите поставщика и нажмите кнопку `SendToProducts` кнопки. Это перенесет вас на страницу, которая перечисляет продукты, предоставляемые выбранным поставщиком. Рис. 15 приведен `ProductsForSupplierDetails.aspx` странице был выбран поставщик Breweries на снежном человеке.


[![Подпись ChooseSupplierMsg отображается в том случае, если поставщик не выбран](adding-a-gridview-column-of-radio-buttons-vb/_static/image14.gif)](adding-a-gridview-column-of-radio-buttons-vb/_static/image23.png)

**Рис. 14**: `ChooseSupplierMsg` Метка отображается в том случае, если поставщик не установлен ([Просмотр полноразмерного изображения](adding-a-gridview-column-of-radio-buttons-vb/_static/image24.png))


[![Продукты выбранного поставщика, отображаются в ProductsForSupplierDetails.aspx](adding-a-gridview-column-of-radio-buttons-vb/_static/image15.gif)](adding-a-gridview-column-of-radio-buttons-vb/_static/image25.png)

**Рис. 15**: Продукты выбранного поставщика, отображаются в `ProductsForSupplierDetails.aspx` ([Просмотр полноразмерного изображения](adding-a-gridview-column-of-radio-buttons-vb/_static/image26.png))


## <a name="step-5-displaying-the-selected-supplier-s-products-on-the-same-page"></a>Шаг 5. Отображение продукты выбранного поставщика на одной странице

На шаге 4 мы увидели, как будет перенаправлен на другой веб-страницу для отображения выбранного поставщика продукты. Кроме того продукты выбранного поставщика могут отображаться на одной странице. Чтобы проиллюстрировать это, мы добавим другой GridView к `RadioButtonField.aspx` для отображения продукты выбранного поставщика s.

Так как нам нужен только этот GridView продуктов для отображения после выбора поставщика, добавить панели веб-элемент управления под `Suppliers` GridView, установка его `ID` для `ProductsBySupplierPanel` и его `Visible` свойства `False`. В пределах панели, добавьте текст продуктов для выбранного поставщика, за которым следует элемент управления GridView с именем `ProductsBySupplier`. Выберите смарт-тега GridView s привязать его к элементу управления ObjectDataSource с именем `ProductsBySupplierDataSource`.


[![Привязки ProductsBySupplier GridView к элементу управления ObjectDataSource](adding-a-gridview-column-of-radio-buttons-vb/_static/image16.gif)](adding-a-gridview-column-of-radio-buttons-vb/_static/image27.png)

**Рис. 16**: Привязать `ProductsBySupplier` GridView к элементу управления ObjectDataSource ([Просмотр полноразмерного изображения](adding-a-gridview-column-of-radio-buttons-vb/_static/image28.png))


Настройте ObjectDataSource на использование `ProductsBLL` класса. Так, как только мы хотим получить эти продукты, предоставляемые выбранным поставщиком, указать, что элемент управления ObjectDataSource должен вызывать `GetProductsBySupplierID(supplierID)` метод для извлечения данных. Выберите (нет) из раскрывающихся списков в UPDATE, INSERT и удаление вкладок.


[![Настройка ObjectDataSource на использование метода GetProductsBySupplierID(supplierID)](adding-a-gridview-column-of-radio-buttons-vb/_static/image17.gif)](adding-a-gridview-column-of-radio-buttons-vb/_static/image29.png)

**Рис. 17**: Настройка ObjectDataSource для использования `GetProductsBySupplierID(supplierID)` метод ([Просмотр полноразмерного изображения](adding-a-gridview-column-of-radio-buttons-vb/_static/image30.png))


[![Установите раскрывающиеся списки (нет) в UPDATE, INSERT и удаление вкладок](adding-a-gridview-column-of-radio-buttons-vb/_static/image18.gif)](adding-a-gridview-column-of-radio-buttons-vb/_static/image31.png)

**Рис. 18**: Установите раскрывающиеся списки (нет) в обновления, вставки и удаления вкладок ([Просмотр полноразмерного изображения](adding-a-gridview-column-of-radio-buttons-vb/_static/image32.png))


После настройки SELECT, вставка и удаление вкладок, нажмите кнопку Далее. Так как `GetProductsBySupplierID(supplierID)` метод ожидает входной параметр, мастер создания источника данных запрашивает, чтобы указать источник для значения параметра s.

У нас есть несколько вариантов здесь в Указание источника значения параметра s. Мы могли бы использовать объект параметра по умолчанию и программным образом назначьте `SuppliersSelectedIndex` свойства параметр s `DefaultValue` свойства в элемент управления ObjectDataSource s `Selecting` обработчик событий. Вернуться к [Программная установка значений параметров ObjectDataSource](../basic-reporting/programmatically-setting-the-objectdatasource-s-parameter-values-vb.md) учебника программно присвоение значений параметров ObjectDataSource s в памяти.

Кроме того, можно использовать ControlParameter и ссылаться на `Suppliers` GridView s [ `SelectedValue` свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.selectedvalue.aspx) (см. рис. 19). GridView s `SelectedValue` возвращает `DataKey` значение, соответствующее [ `SelectedIndex` свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.selectedindex.aspx). Чтобы этот параметр действовал, необходимо программно задать GridView s `SelectedIndex` свойство для выбранной строки, если `ListProducts` кнопки. Как бонус, задав `SelectedIndex`, будут присутствовать выбранной записи `SelectedRowStyle` определенные в `DataWebControls` темы (желтый фон).


[![Используйте ControlParameter для указания GridView s SelectedValue как источник параметра](adding-a-gridview-column-of-radio-buttons-vb/_static/image19.gif)](adding-a-gridview-column-of-radio-buttons-vb/_static/image33.png)

**Рис. 19**: Позволяет указать GridView s SelectedValue как источник параметра ControlParameter ([Просмотр полноразмерного изображения](adding-a-gridview-column-of-radio-buttons-vb/_static/image34.png))


После завершения работы мастера, Visual Studio автоматически добавит поля для поля данных продукта s. Удалите все, кроме `ProductName`, `CategoryName`, и `UnitPrice` полей BoundField и измените `HeaderText` свойства категорию и цену продукта. Настройка `UnitPrice` BoundField таким образом, чтобы его значение форматируется как денежная единица. После внесения этих изменений, панели, GridView и ObjectDataSource s декларативная разметка должна выглядеть следующим образом:


[!code-aspx[Main](adding-a-gridview-column-of-radio-buttons-vb/samples/sample11.aspx)]

Чтобы завершить это упражнение, нам нужно установить GridView s `SelectedIndex` свойства `SelectedSuppliersIndex` и `ProductsBySupplierPanel` панели s `Visible` свойства `True` при `ListProducts` кнопки. Для этого необходимо создать обработчик событий для `ListProducts` веб-управления Button s `Click` событий и добавьте следующий код:


[!code-vb[Main](adding-a-gridview-column-of-radio-buttons-vb/samples/sample12.vb)]

Если поставщик не была выбрана из GridView, `ChooseSupplierMsg` метка будет отображаться и `ProductsBySupplierPanel` панели скрыты. В противном случае, если был выбран поставщик, `ProductsBySupplierPanel` отображается и GridView s `SelectedIndex` обновляется свойство.

Рис. 20 показаны результаты, после того как был выбран поставщик Breweries на снежном человеке и Показать продукты кнопки страницы был выполнен щелчок.


[![Продукты предоставляемые Breweries на снежном человеке, перечислены на одной странице](adding-a-gridview-column-of-radio-buttons-vb/_static/image20.gif)](adding-a-gridview-column-of-radio-buttons-vb/_static/image35.png)

**Рис. 20**: Продукты предоставляемые Breweries на снежном человеке, перечислены на этой же странице ([Просмотр полноразмерного изображения](adding-a-gridview-column-of-radio-buttons-vb/_static/image36.png))


## <a name="summary"></a>Сводка

Как уже говорилось в [Master/Detail, с помощью выбираемого основного элемента GridView с DetailView](../masterdetail/master-detail-using-a-selectable-master-gridview-with-a-details-detailview-vb.md) руководства, записи могут быть выбраны из элемента управления GridView с помощью CommandField которого `ShowSelectButton` свойство имеет значение `True`. Но CommandField отображает его как обычные Нажимаемые кнопки, ссылки или изображения. Пользовательский интерфейс выбора альтернативных строк является предоставление переключателя или флажка в каждой строке GridView. В этом учебнике мы рассмотрели, как добавить столбец кнопок-переключателей.

К сожалению Добавление столбца t является переключатель кнопок как простой или простой, как можно ожидать, что. Имеется не встроенные RadioButtonField, которые могут добавляться по нажатию кнопки, и использование веб-управления RadioButton в поле TemplateField создает свой собственный набор проблем. В конце концов, для обеспечения такой интерфейс мы должны создать пользовательский `DataControlField` класса и не прибегая к ввод соответствующий HTML-кода в поле TemplateField во время `RowCreated` событий.

Продемонстрировано, как добавить столбец кнопок-переключателей, сообщите нам обратить внимание на добавление столбца флажков. С помощью столбца флажков пользователь может выбрать один или несколько строк GridView и затем выполнить некую операцию на всех выбранных строк (например, выбрать набор сообщений электронной почты от клиента веб-почты и затем выбрав удаление всех выбранных сообщений электронной почты). В следующем учебном курсе будет показано, как для добавления такого столбца.

Счастливого вам программирования!

## <a name="about-the-author"></a>Об авторе

[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи книг по ASP/ASP.NET и основатель веб- [4GuysFromRolla.com](http://www.4guysfromrolla.com), работает с веб-технологиями Microsoft с 1998 года. Скотт — независимый консультант, преподаватель и автор. Его последняя книга — [ *Sams Teach ASP.NET 2.0 in 24 часа*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco). Ним можно связаться по адресу [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) или через его блог, который можно найти в [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).

## <a name="special-thanks-to"></a>Особая благодарность

В этой серии руководств пособий рецензировалась многими компетентными редакторами. Основной рецензент этого учебного был Дэвид Suru. Хотите поработать с моих последующих статей для MSDN? Если Да, напишите мне [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)

> [!div class="step-by-step"]
> [Назад](inserting-a-new-record-from-the-gridview-s-footer-cs.md)
> [Вперед](adding-a-gridview-column-of-checkboxes-vb.md)
