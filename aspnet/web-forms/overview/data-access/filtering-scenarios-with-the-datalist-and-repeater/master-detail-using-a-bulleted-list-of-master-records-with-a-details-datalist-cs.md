---
uid: web-forms/overview/data-access/filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs
title: "\"Основной/подробности\" с помощью маркированного списка главных записей с элементом управления DataListC#() | Документация Майкрософт"
author: rick-anderson
description: В этом учебнике мы будем сжимать отчет «основной/подробности» из предыдущего руководства на одну страницу, отображая маркированный список имен категорий на t...
ms.author: riande
ms.date: 10/17/2006
ms.assetid: c727bb73-7b59-41a1-8dc3-623c6d69e7c2
msc.legacyurl: /web-forms/overview/data-access/filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs
msc.type: authoredcontent
ms.openlocfilehash: 4549ab8e64599b09c300c158bedfd5d85efafc4d
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78490968"
---
# <a name="masterdetail-using-a-bulleted-list-of-master-records-with-a-details-datalist-c"></a><span data-ttu-id="28ae3-103">Отчет "Основной/подробности" с использованием маркированного списка основных записей с элементом управления DataList для подробных сведений (C#)</span><span class="sxs-lookup"><span data-stu-id="28ae3-103">Master/Detail Using a Bulleted List of Master Records with a Details DataList (C#)</span></span>

<span data-ttu-id="28ae3-104">по [Скотт Митчелл](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="28ae3-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="28ae3-105">[Скачивание примера приложения](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_35_CS.exe) или [Загрузка PDF-файла](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/datatutorial35cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="28ae3-105">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_35_CS.exe) or [Download PDF](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/datatutorial35cs1.pdf)</span></span>

> <span data-ttu-id="28ae3-106">В этом учебнике мы будем сжимать отчет «основной/подробности» из предыдущего руководства на одну страницу, отображая маркированный список имен категорий в левой части экрана и продукты выбранной категории в правой части экрана.</span><span class="sxs-lookup"><span data-stu-id="28ae3-106">In this tutorial we'll compress the two-page master/detail report of the previous tutorial into a single page, showing a bulleted list of category names on the left side of the screen and the selected category's products on the right of the screen.</span></span>

## <a name="introduction"></a><span data-ttu-id="28ae3-107">Введение</span><span class="sxs-lookup"><span data-stu-id="28ae3-107">Introduction</span></span>

<span data-ttu-id="28ae3-108">В [предыдущем учебном курсе](master-detail-filtering-acess-two-pages-datalist-cs.md) мы рассматривали разделение отчета «основной/подробности» на две страницы.</span><span class="sxs-lookup"><span data-stu-id="28ae3-108">In the [preceding tutorial](master-detail-filtering-acess-two-pages-datalist-cs.md) we looked at how to separate a master/detail report across two pages.</span></span> <span data-ttu-id="28ae3-109">На главной странице мы использовали элемент управления Repeater для отображения маркированного списка категорий.</span><span class="sxs-lookup"><span data-stu-id="28ae3-109">In the master page we used a Repeater control to render a bulleted list of categories.</span></span> <span data-ttu-id="28ae3-110">Имя каждой категории было гиперссылкой, при щелчке которого пользователь перейдет на страницу сведений, где в DataList отображались продукты, принадлежащие выбранной категории.</span><span class="sxs-lookup"><span data-stu-id="28ae3-110">Each category name was a hyperlink that, when clicked, would take the user to the details page, where a two-column DataList showed those products belonging to the selected category.</span></span>

<span data-ttu-id="28ae3-111">В этом учебнике мы будем сжимать учебник с двумя страницами на одной странице, отображая маркированный список имен категорий в левой части экрана с именами категорий, отображаемыми как LinkButton.</span><span class="sxs-lookup"><span data-stu-id="28ae3-111">In this tutorial we'll compress the two-page tutorial into a single page, showing a bulleted list of category names on the left side of the screen with each category name rendered as a LinkButton.</span></span> <span data-ttu-id="28ae3-112">Щелкнув одну из категорий LinkButton, можно выполнить обратную передачу и привязать продукты выбранной категории к элементу DataList с двумя столбцами справа от экрана.</span><span class="sxs-lookup"><span data-stu-id="28ae3-112">Clicking one of the category name LinkButtons induces a postback and binds the selected category s products to a two-column DataList on the right of the screen.</span></span> <span data-ttu-id="28ae3-113">В дополнение к отображению каждого имени категории, в элементе Repeater слева отображается общее количество продуктов для данной категории (см. рис. 1).</span><span class="sxs-lookup"><span data-stu-id="28ae3-113">In addition to displaying each category s name, the Repeater on the left shows how many total products there are for a given category (see Figure 1).</span></span>

<span data-ttu-id="28ae3-114">[![имя категории s и общее количество продуктов отображаются слева](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image2.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="28ae3-114">[![The Category s Name and Total Number of Products are Displayed on the Left](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image2.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image1.png)</span></span>

<span data-ttu-id="28ae3-115">**Рис. 1**. имя категории и общее количество продуктов отображаются слева ([щелкните, чтобы просмотреть изображение с полным размером](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="28ae3-115">**Figure 1**: The Category s Name and Total Number of Products are Displayed on the Left ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image3.png))</span></span>

## <a name="step-1-displaying-a-repeater-in-the-left-portion-of-the-screen"></a><span data-ttu-id="28ae3-116">Шаг 1. Отображение элемента Repeater в левой части экрана</span><span class="sxs-lookup"><span data-stu-id="28ae3-116">Step 1: Displaying a Repeater in the Left Portion of the Screen</span></span>

<span data-ttu-id="28ae3-117">Для работы с этим руководством необходимо, чтобы маркированный список категорий отображался слева от выбранных продуктов категории s.</span><span class="sxs-lookup"><span data-stu-id="28ae3-117">For this tutorial we need to have the bulleted list of categories appear to the left of the selected category s products.</span></span> <span data-ttu-id="28ae3-118">Содержимое на веб-странице может быть размещено с помощью стандартных тегов абзацев, неразрывных пробелов, `<table>` s и т. д. или с помощью методов каскадной таблицы стилей (CSS).</span><span class="sxs-lookup"><span data-stu-id="28ae3-118">Content within a web page can be positioned using standard HTML elements paragraph tags, non-breaking spaces, `<table>` s, and so on or through cascading stylesheet (CSS) techniques.</span></span> <span data-ttu-id="28ae3-119">Во всех наших руководствах мы использовали методы CSS для позиционирования.</span><span class="sxs-lookup"><span data-stu-id="28ae3-119">All of our tutorials thus far have used CSS techniques for positioning.</span></span> <span data-ttu-id="28ae3-120">При построении пользовательского интерфейса навигации на главной странице в учебном курсе [главные страницы и Навигация по сайту](../introduction/master-pages-and-site-navigation-cs.md) было использовано *абсолютное позиционирование*, указывающее точное смещение пикселя для списка переходов и основное содержимое.</span><span class="sxs-lookup"><span data-stu-id="28ae3-120">When we built the navigation user interface in our master page in the [Master Pages and Site Navigation](../introduction/master-pages-and-site-navigation-cs.md) tutorial we used *absolute positioning*, indicating the precise pixel offset for the navigation list and the main content.</span></span> <span data-ttu-id="28ae3-121">Кроме того, CSS можно использовать для размещения одного элемента справа или слева от другого до *плавающего*.</span><span class="sxs-lookup"><span data-stu-id="28ae3-121">Alternatively, CSS can be used to position one element to the right or left of another through *floating*.</span></span> <span data-ttu-id="28ae3-122">Можно отобразить маркированный список категорий слева от выбранных продуктов категории s, перечисляя элемент управления Repeater слева от элемента управления DataList.</span><span class="sxs-lookup"><span data-stu-id="28ae3-122">We can have the bulleted list of categories appear to the left of the selected category s products by floating the Repeater to the left of the DataList</span></span>

<span data-ttu-id="28ae3-123">Откройте страницу `CategoriesAndProducts.aspx` из папки `DataListRepeaterFiltering` и добавьте ее на страницу a Repeater и DataList.</span><span class="sxs-lookup"><span data-stu-id="28ae3-123">Open the `CategoriesAndProducts.aspx` page from the `DataListRepeaterFiltering` folder and add to the page a Repeater and a DataList.</span></span> <span data-ttu-id="28ae3-124">Задайте для параметра Repeater s `ID` значение `Categories`, а для элемента DataList s — значение `CategoryProducts`.</span><span class="sxs-lookup"><span data-stu-id="28ae3-124">Set the Repeater s `ID` to `Categories` and the DataList s to `CategoryProducts`.</span></span> <span data-ttu-id="28ae3-125">Перейдите в представление исходного кода и помещайте элементы управления Repeater и DataList в свои элементы `<div>`.</span><span class="sxs-lookup"><span data-stu-id="28ae3-125">Go to the Source view and put the Repeater and DataList controls within their own `<div>` elements.</span></span> <span data-ttu-id="28ae3-126">То есть сначала заключите элемент управления Repeater внутрь элемента `<div>`, а затем элемент управления DataList в своем собственном элементе `<div>` непосредственно после элемента управления Repeater.</span><span class="sxs-lookup"><span data-stu-id="28ae3-126">That is, enclose the Repeater within a `<div>` element first and then the DataList in its own `<div>` element directly after the Repeater.</span></span> <span data-ttu-id="28ae3-127">Разметка на этом этапе должна выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="28ae3-127">Your markup at this point should look similar to the following:</span></span>

[!code-aspx[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample1.aspx)]

<span data-ttu-id="28ae3-128">Чтобы переместить элемент управления Repeater на левую часть DataList, необходимо использовать атрибут стиля CSS `float`, вот так:</span><span class="sxs-lookup"><span data-stu-id="28ae3-128">To float the Repeater to the left of the DataList, we need to use the `float` CSS style attribute, like so:</span></span>

[!code-html[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample2.html)]

<span data-ttu-id="28ae3-129">`float: left;` перемещает первый элемент `<div>` влево от второго.</span><span class="sxs-lookup"><span data-stu-id="28ae3-129">The `float: left;` floats the first `<div>` element to the left of the second one.</span></span> <span data-ttu-id="28ae3-130">Параметры `width` и `padding-right` указывают первый `<div>` `width` и то, сколько дополнений добавляется между содержимым `<div>` элемента и его правым полем.</span><span class="sxs-lookup"><span data-stu-id="28ae3-130">The `width` and `padding-right` settings indicate the first `<div>` s `width` and how much padding is added between the `<div>` element s content and its right margin.</span></span> <span data-ttu-id="28ae3-131">Дополнительные сведения об плавающих элементах CSS см. в [флоатуториал](http://css.maxdesign.com.au/floatutorial/).</span><span class="sxs-lookup"><span data-stu-id="28ae3-131">For more information on floating elements in CSS check out the [Floatutorial](http://css.maxdesign.com.au/floatutorial/).</span></span>

<span data-ttu-id="28ae3-132">Вместо того, чтобы задавать стиль непосредственно через первый `<p>` элемент `style` атрибут, давайте создадим новый класс CSS в `Styles.css` с именем `FloatLeft`:</span><span class="sxs-lookup"><span data-stu-id="28ae3-132">Rather than specify the style setting directly through the first `<p>` element s `style` attribute, let s instead create a new CSS class in `Styles.css` named `FloatLeft`:</span></span>

[!code-css[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample3.css)]

<span data-ttu-id="28ae3-133">Затем можно заменить `<div>` `<div class="FloatLeft">`.</span><span class="sxs-lookup"><span data-stu-id="28ae3-133">Then we can replace the `<div>` with `<div class="FloatLeft">`.</span></span>

<span data-ttu-id="28ae3-134">После добавления класса CSS и настройки разметки на странице `CategoriesAndProducts.aspx` перейдите в конструктор.</span><span class="sxs-lookup"><span data-stu-id="28ae3-134">After adding the CSS class and configuring the markup in the `CategoriesAndProducts.aspx` page, go to the Designer.</span></span> <span data-ttu-id="28ae3-135">Элемент управления Repeater должен быть плавающим слева от элемента управления DataList (хотя теперь он отображается серым цветом, так как мы еще не настроили их источники данных или шаблоны).</span><span class="sxs-lookup"><span data-stu-id="28ae3-135">You should see the Repeater floating to the left of the DataList (although right now both just appear as gray boxes since we ve yet to configure their data sources or templates).</span></span>

<span data-ttu-id="28ae3-136">[![элемент управления Repeater находится слева от DataList](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image5.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="28ae3-136">[![The Repeater is Floated to the Left of the DataList](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image5.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image4.png)</span></span>

<span data-ttu-id="28ae3-137">**Рис. 2**. элемент управления Repeater находится слева от элемента управления DataList ([щелкните, чтобы просмотреть изображение с полным размером](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="28ae3-137">**Figure 2**: The Repeater is Floated to the Left of the DataList ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image6.png))</span></span>

## <a name="step-2-determining-the-number-of-products-for-each-category"></a><span data-ttu-id="28ae3-138">Шаг 2. Определение количества продуктов для каждой категории</span><span class="sxs-lookup"><span data-stu-id="28ae3-138">Step 2: Determining the Number of Products for Each Category</span></span>

<span data-ttu-id="28ae3-139">После завершения разметки Repeater и DataList мы повторно готовы привязать данные категорий к элементу управления Repeater.</span><span class="sxs-lookup"><span data-stu-id="28ae3-139">With the Repeater and DataList s surrounding markup complete, we re ready to bind the category data to the Repeater control.</span></span> <span data-ttu-id="28ae3-140">Однако, как показано в маркированном списке категорий на рис. 1, в дополнение к именам категорий s также необходимо отобразить количество продуктов, связанных с категорией.</span><span class="sxs-lookup"><span data-stu-id="28ae3-140">However, as the bulleted list of categories in Figure 1 shows, in addition to each category s name we also need to display the number of products associated with the category.</span></span> <span data-ttu-id="28ae3-141">Чтобы получить доступ к этим сведениям, можно выполнить одно из следующих действий:</span><span class="sxs-lookup"><span data-stu-id="28ae3-141">To access this information we can either:</span></span>

- <span data-ttu-id="28ae3-142">**Определите эти сведения на основе класса кода программной части ASP.NET Page s.**</span><span class="sxs-lookup"><span data-stu-id="28ae3-142">**Determine this information from the ASP.NET page s code-behind class.**</span></span> <span data-ttu-id="28ae3-143">Учитывая конкретную *`categoryID`* мы можем определить количество связанных продуктов, вызвав метод `ProductsBLL` класса s `GetProductsByCategoryID(categoryID)`.</span><span class="sxs-lookup"><span data-stu-id="28ae3-143">Given a particular *`categoryID`* we can determine the number of associated products by calling the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method.</span></span> <span data-ttu-id="28ae3-144">Этот метод возвращает объект `ProductsDataTable`, свойство `Count` которого показывает, сколько `ProductsRow` существует, что представляет собой количество продуктов для указанного *`categoryID`* .</span><span class="sxs-lookup"><span data-stu-id="28ae3-144">This method returns a `ProductsDataTable` object whose `Count` property indicates how many `ProductsRow` s exists, which is the number of products for the specified *`categoryID`*.</span></span> <span data-ttu-id="28ae3-145">Можно создать обработчик событий `ItemDataBound` для элемента Repeater, который для каждой категории, привязанной к элементу Repeater, вызывает метод `ProductsBLL` класса s `GetProductsByCategoryID(categoryID)` и включает его количество в выходных данных.</span><span class="sxs-lookup"><span data-stu-id="28ae3-145">We can create an `ItemDataBound` event handler for the Repeater that, for each category bound to the Repeater, calls the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method and includes its count in the output.</span></span>
- <span data-ttu-id="28ae3-146">**Обновите `CategoriesDataTable` в типизированном наборе данных, чтобы включить столбец `NumberOfProducts`.**</span><span class="sxs-lookup"><span data-stu-id="28ae3-146">**Update the `CategoriesDataTable` in the Typed DataSet to include a `NumberOfProducts` column.**</span></span> <span data-ttu-id="28ae3-147">Затем можно обновить метод `GetCategories()` в `CategoriesDataTable`, чтобы включить эти сведения, или же оставить `GetCategories()` "как есть" и создать новый метод `CategoriesDataTable` с именем `GetCategoriesAndNumberOfProducts()`.</span><span class="sxs-lookup"><span data-stu-id="28ae3-147">We can then update the `GetCategories()` method in the `CategoriesDataTable` to include this information or, alternatively, leave `GetCategories()` as-is and create a new `CategoriesDataTable` method called `GetCategoriesAndNumberOfProducts()`.</span></span>

<span data-ttu-id="28ae3-148">Давайте рассмотрим оба этих метода.</span><span class="sxs-lookup"><span data-stu-id="28ae3-148">Let s explore both of these techniques.</span></span> <span data-ttu-id="28ae3-149">Первый подход проще реализовать, так как нам не нужно обновлять уровень доступа к данным. Однако для этого требуется больше связи с базой данных.</span><span class="sxs-lookup"><span data-stu-id="28ae3-149">The first approach is simpler to implement since we don t need to update the Data Access Layer; however, it requires more communications with the database.</span></span> <span data-ttu-id="28ae3-150">Вызов метода `ProductsBLL` класса `GetProductsByCategoryID(categoryID)` в обработчике событий `ItemDataBound` добавляет дополнительный вызов базы данных для каждой категории, отображаемой в элементе Repeater.</span><span class="sxs-lookup"><span data-stu-id="28ae3-150">The call to the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method in the `ItemDataBound` event handler adds an extra database call for each category displayed in the Repeater.</span></span> <span data-ttu-id="28ae3-151">При использовании этого метода существует *n* + 1 вызовов баз данных, где *n* — число категорий, отображаемых в элементе Repeater.</span><span class="sxs-lookup"><span data-stu-id="28ae3-151">With this technique there are *N* + 1 database calls, where *N* is the number of categories displayed in the Repeater.</span></span> <span data-ttu-id="28ae3-152">При втором подходе возвращается число продуктов со сведениями о каждой категории из метода `CategoriesBLL` класса s `GetCategories()` (или `GetCategoriesAndNumberOfProducts()`), что приводит к простому обращению к базе данных.</span><span class="sxs-lookup"><span data-stu-id="28ae3-152">With the second approach, the product count is returned with information about each category from the `CategoriesBLL` class s `GetCategories()` (or `GetCategoriesAndNumberOfProducts()`) method, thereby resulting in just one trip to the database.</span></span>

## <a name="determining-the-number-of-products-in-the-itemdatabound-event-handler"></a><span data-ttu-id="28ae3-153">Определение количества продуктов в обработчике событий ItemDataBound</span><span class="sxs-lookup"><span data-stu-id="28ae3-153">Determining the Number of Products in the ItemDataBound Event Handler</span></span>

<span data-ttu-id="28ae3-154">Для определения количества продуктов для каждой категории в обработчике событий Repeater `ItemDataBound` не требуется вносить изменения в имеющийся уровень доступа к данным.</span><span class="sxs-lookup"><span data-stu-id="28ae3-154">Determining the number of products for each category in the Repeater s `ItemDataBound` event handler does not require any modifications to our existing Data Access Layer.</span></span> <span data-ttu-id="28ae3-155">Все изменения можно вносить непосредственно на странице `CategoriesAndProducts.aspx`.</span><span class="sxs-lookup"><span data-stu-id="28ae3-155">All modifications can be made directly within the `CategoriesAndProducts.aspx` page.</span></span> <span data-ttu-id="28ae3-156">Начните с добавления нового элемента управления ObjectDataSource с именем `CategoriesDataSource` через смарт-тег Repeater s.</span><span class="sxs-lookup"><span data-stu-id="28ae3-156">Start by adding a new ObjectDataSource named `CategoriesDataSource` via the Repeater s smart tag.</span></span> <span data-ttu-id="28ae3-157">Затем настройте `CategoriesDataSource` ObjectDataSource таким образом, чтобы он получал свои данные из метода `CategoriesBLL` класса s `GetCategories()`.</span><span class="sxs-lookup"><span data-stu-id="28ae3-157">Next, configure the `CategoriesDataSource` ObjectDataSource so that it retrieves its data from the `CategoriesBLL` class s `GetCategories()` method.</span></span>

<span data-ttu-id="28ae3-158">[![настроить ObjectDataSource для использования метода класса CategoriesBLL-Categories ()](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image8.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="28ae3-158">[![Configure the ObjectDataSource to Use the CategoriesBLL class s GetCategories() Method](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image8.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image7.png)</span></span>

<span data-ttu-id="28ae3-159">**Рис. 3**. Настройка ObjectDataSource для использования метода `GetCategories()` `CategoriesBLL` классов ([щелкните, чтобы просмотреть изображение с полным размером](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="28ae3-159">**Figure 3**: Configure the ObjectDataSource to Use the `CategoriesBLL` class s `GetCategories()` Method ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image9.png))</span></span>

<span data-ttu-id="28ae3-160">Каждый элемент в `Categories` Repeater должен быть щелчком мыши, и при нажатии `CategoryProducts` DataList отображает эти продукты для выбранной категории.</span><span class="sxs-lookup"><span data-stu-id="28ae3-160">Each item in the `Categories` Repeater needs to be clickable and, when clicked, cause the `CategoryProducts` DataList to display those products for the selected category.</span></span> <span data-ttu-id="28ae3-161">Это можно сделать, сделав каждую категорию гиперссылкой, связав ее с той же страницей (`CategoriesAndProducts.aspx`), но передавая `CategoryID` через строку запроса, как показано в предыдущем руководстве.</span><span class="sxs-lookup"><span data-stu-id="28ae3-161">This can be accomplished by making each category a hyperlink, linking back to this same page (`CategoriesAndProducts.aspx`), but passing the `CategoryID` through the querystring, much like we saw in the previous tutorial.</span></span> <span data-ttu-id="28ae3-162">Преимуществом этого подхода является то, что страница, отображающая определенные продукты категории, может быть помечена и проиндексирована поисковой системой.</span><span class="sxs-lookup"><span data-stu-id="28ae3-162">The advantage of this approach is that a page displaying a particular category s products can be bookmarked and indexed by a search engine.</span></span>

<span data-ttu-id="28ae3-163">Кроме того, можно создать каждую категорию с помощью элемента LinkButton, который мы будем использовать для работы с этим руководством.</span><span class="sxs-lookup"><span data-stu-id="28ae3-163">Alternatively, we can make each category a LinkButton, which is the approach we'll use for this tutorial.</span></span> <span data-ttu-id="28ae3-164">Элемент LinkButton отображается в браузере User s как гиперссылка, но при щелчке вызывает обратную передачу; при обратной передаче необходимо обновить элемент управления DataList, чтобы отобразить продукты, принадлежащие выбранной категории.</span><span class="sxs-lookup"><span data-stu-id="28ae3-164">The LinkButton renders in the user s browser as a hyperlink but, when clicked, induces a postback; on postback, the DataList s ObjectDataSource needs to be refreshed to display those products belonging to the selected category.</span></span> <span data-ttu-id="28ae3-165">В этом учебнике использование гиперссылки имеет больше смысла, чем использование элемента LinkButton; Однако могут существовать и другие сценарии, в которых использование элемента LinkButton является более выгодным.</span><span class="sxs-lookup"><span data-stu-id="28ae3-165">For this tutorial, using a hyperlink makes more sense than using a LinkButton; however, there may be other scenarios where using a LinkButton is more advantageous.</span></span> <span data-ttu-id="28ae3-166">Хотя подход гиперссылки идеально подходит для этого примера, давайте рассмотрим использование LinkButton.</span><span class="sxs-lookup"><span data-stu-id="28ae3-166">While the hyperlink approach would be ideal for this example, let s instead explore using the LinkButton.</span></span> <span data-ttu-id="28ae3-167">Как мы увидим, использование LinkButton вводит некоторые проблемы, которые в противном случае не будут возникать с гиперссылкой.</span><span class="sxs-lookup"><span data-stu-id="28ae3-167">As we'll see, using a LinkButton introduces some challenges that would not otherwise arise with a hyperlink.</span></span> <span data-ttu-id="28ae3-168">Поэтому использование элемента LinkButton в этом учебнике выделит эти проблемы и предоставит решения для тех сценариев, в которых вместо гиперссылки может потребоваться использовать элемент LinkButton.</span><span class="sxs-lookup"><span data-stu-id="28ae3-168">Therefore, using a LinkButton in this tutorial will highlight these challenges and help provide solutions for those scenarios where we may want to use a LinkButton instead of a hyperlink.</span></span>

> [!NOTE]
> <span data-ttu-id="28ae3-169">Рекомендуется повторить этот учебник, используя элемент управления HyperLink или элемент `<a>` вместо элемента LinkButton.</span><span class="sxs-lookup"><span data-stu-id="28ae3-169">You are encouraged to repeat this tutorial using a HyperLink control or `<a>` element in lieu of the LinkButton.</span></span>

<span data-ttu-id="28ae3-170">В следующей разметке показан декларативный синтаксис для элемента управления Repeater и ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="28ae3-170">The following markup shows the declarative syntax for the Repeater and the ObjectDataSource.</span></span> <span data-ttu-id="28ae3-171">Обратите внимание, что шаблоны Repeater дорабатывают маркированный список с каждым элементом как LinkButton:</span><span class="sxs-lookup"><span data-stu-id="28ae3-171">Note that the Repeater s templates render a bulleted list with each item as a LinkButton:</span></span>

[!code-aspx[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample4.aspx)]

> [!NOTE]
> <span data-ttu-id="28ae3-172">В этом учебнике для элемента Repeater должно быть включено состояние просмотра (Обратите внимание на упущение `EnableViewState="False"` из декларативного синтаксиса Repeater).</span><span class="sxs-lookup"><span data-stu-id="28ae3-172">For this tutorial the Repeater must have its view state enabled (note the omission of the `EnableViewState="False"` from the Repeater s declarative syntax).</span></span> <span data-ttu-id="28ae3-173">На этапе 3 мы создадим обработчик событий для события Repeater `ItemCommand`, в котором мы будем обновлять коллекцию коллекций ObjectDataSource s `SelectParameters`.</span><span class="sxs-lookup"><span data-stu-id="28ae3-173">In step 3 we'll be creating an event handler for the Repeater s `ItemCommand` event in which we'll be updating the DataList s ObjectDataSource s `SelectParameters` collection.</span></span> <span data-ttu-id="28ae3-174">Однако `ItemCommand`Repeater не будет срабатывать, если состояние представления отключено.</span><span class="sxs-lookup"><span data-stu-id="28ae3-174">The Repeater s `ItemCommand`, however, won't fire if view state is disabled.</span></span> <span data-ttu-id="28ae3-175">Дополнительные сведения о том, почему должно быть включено состояние просмотра `ItemCommand` для запуска события Repeater, см. [в разделе головоломка ASP.NET вопроса](http://scottonwriting.net/sowblog/posts/1263.aspx) и [его решения](http://scottonwriting.net/sowBlog/posts/1268.aspx) .</span><span class="sxs-lookup"><span data-stu-id="28ae3-175">See [A Stumper of an ASP.NET Question](http://scottonwriting.net/sowblog/posts/1263.aspx) and [its solution](http://scottonwriting.net/sowBlog/posts/1268.aspx) for more information on why view state must be enabled for a Repeater s `ItemCommand` event to fire.</span></span>

<span data-ttu-id="28ae3-176">Свойство LinkButton со значением свойства `ID` `ViewCategory` не имеет установленного свойства `Text`.</span><span class="sxs-lookup"><span data-stu-id="28ae3-176">The LinkButton with the `ID` property value of `ViewCategory` does not have its `Text` property set.</span></span> <span data-ttu-id="28ae3-177">Если бы было просто отображалось имя категории, свойство Text было бы задано декларативно с помощью синтаксиса DataBinding следующим образом:</span><span class="sxs-lookup"><span data-stu-id="28ae3-177">If we had just wanted to display the category name, we would have set the Text property declaratively, through databinding syntax, like so:</span></span>

[!code-aspx[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample5.aspx)]

<span data-ttu-id="28ae3-178">Однако мы хотим отобразить как имя категории, так *и* число продуктов, принадлежащих этой категории.</span><span class="sxs-lookup"><span data-stu-id="28ae3-178">However, we want to show both the category s name *and* the number of products belonging to that category.</span></span> <span data-ttu-id="28ae3-179">Эти сведения можно получить из обработчика событий Repeater `ItemDataBound`, сделав вызов метода `ProductBLL` класса s `GetCategoriesByProductID(categoryID)` и определив, сколько записей возвращается в результате `ProductsDataTable`, как показано в следующем коде:</span><span class="sxs-lookup"><span data-stu-id="28ae3-179">This information can be retrieved from the Repeater s `ItemDataBound` event handler by making a call to the `ProductBLL` class s `GetCategoriesByProductID(categoryID)` method and determining how many records are returned in the resulting `ProductsDataTable`, as the following code illustrates:</span></span>

[!code-csharp[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample6.cs)]

<span data-ttu-id="28ae3-180">Начнем с того, что мы работаем над тем, чтобы мы переработали элемент данных (один из которых `ItemType` `Item` или `AlternatingItem`), а затем сослаться на экземпляр `CategoriesRow`, который только что был привязан к текущему `RepeaterItem`.</span><span class="sxs-lookup"><span data-stu-id="28ae3-180">We start out by ensuring that we re working with a data item (one whose `ItemType` is `Item` or `AlternatingItem`) and then reference the `CategoriesRow` instance that has just been bound to the current `RepeaterItem`.</span></span> <span data-ttu-id="28ae3-181">Далее мы определяем количество продуктов для этой категории путем создания экземпляра класса `ProductsBLL`, вызова его метода `GetCategoriesByProductID(categoryID)` и определения количества записей, возвращаемых с помощью свойства `Count`.</span><span class="sxs-lookup"><span data-stu-id="28ae3-181">Next, we determine the number of products for this category by creating an instance of the `ProductsBLL` class, calling its `GetCategoriesByProductID(categoryID)` method, and determining the number of records returned using the `Count` property.</span></span> <span data-ttu-id="28ae3-182">Наконец, `ViewCategory` LinkButton в ItemTemplate является ссылкой, а свойство `Text` имеет значение *CategoryName* (*нумберофпродуктсинкатегори*), где *нумберофпродуктсинкатегори* отформатировано как число с нулевыми десятичными разрядами.</span><span class="sxs-lookup"><span data-stu-id="28ae3-182">Finally, the `ViewCategory` LinkButton in the ItemTemplate is references and its `Text` property is set to *CategoryName* (*NumberOfProductsInCategory*), where *NumberOfProductsInCategory* is formatted as a number with zero decimal places.</span></span>

> [!NOTE]
> <span data-ttu-id="28ae3-183">Кроме того, мы могли бы добавить *функцию форматирования* в класс кода программной части ASP.NET Page s, который принимает категории s `CategoryName` и `CategoryID` значения и возвращает `CategoryName` сцепление с числом продуктов в категории (как определено вызовом метода `GetCategoriesByProductID(categoryID)`).</span><span class="sxs-lookup"><span data-stu-id="28ae3-183">Alternatively, we could have added a *formatting function* to the ASP.NET page s code-behind class that accepts a category s `CategoryName` and `CategoryID` values and returns the `CategoryName` concatenated with the number of products in the category (as determined by calling the `GetCategoriesByProductID(categoryID)` method).</span></span> <span data-ttu-id="28ae3-184">Результаты такой функции форматирования можно декларативно назначить свойству "текст" в LinkButton, заменив потребность в обработчике событий `ItemDataBound`.</span><span class="sxs-lookup"><span data-stu-id="28ae3-184">The results of such a formatting function could be declaratively assigned to the LinkButton s Text property replacing the need for the `ItemDataBound` event handler.</span></span> <span data-ttu-id="28ae3-185">Дополнительные сведения об использовании функций форматирования см. в разделе [Использование полей TemplateField в элементе управления GridView](../custom-formatting/using-templatefields-in-the-gridview-control-cs.md) или при [форматировании элементов DataList и Repeater на основе](../displaying-data-with-the-datalist-and-repeater/formatting-the-datalist-and-repeater-based-upon-data-cs.md) учебников по работе с данными.</span><span class="sxs-lookup"><span data-stu-id="28ae3-185">Refer to the [Using TemplateFields in the GridView Control](../custom-formatting/using-templatefields-in-the-gridview-control-cs.md) or [Formatting the DataList and Repeater Based Upon Data](../displaying-data-with-the-datalist-and-repeater/formatting-the-datalist-and-repeater-based-upon-data-cs.md) tutorials for more information on using formatting functions.</span></span>

<span data-ttu-id="28ae3-186">После добавления этого обработчика событий протестируйте страницу в браузере.</span><span class="sxs-lookup"><span data-stu-id="28ae3-186">After adding this event handler, take a moment to test the page through a browser.</span></span> <span data-ttu-id="28ae3-187">Обратите внимание, что каждая категория указана в маркированном списке, отображая название категории s и число продуктов, связанных с категорией (см. рис. 4).</span><span class="sxs-lookup"><span data-stu-id="28ae3-187">Note how each category is listed in a bulleted list, displaying the category s name and the number of products associated with the category (see Figure 4).</span></span>

<span data-ttu-id="28ae3-188">[![отображаются имена и количество продуктов категории s](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image11.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="28ae3-188">[![Each Category s Name and Number of Products are Displayed](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image11.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image10.png)</span></span>

<span data-ttu-id="28ae3-189">**Рис. 4**. отображаются имена и количество продуктов каждой категории ([щелкните, чтобы просмотреть изображение с полным размером](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image12.png)).</span><span class="sxs-lookup"><span data-stu-id="28ae3-189">**Figure 4**: Each Category s Name and Number of Products are Displayed ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image12.png))</span></span>

## <a name="updating-thecategoriesdatatableandcategoriestableadapterto-include-the-number-of-products-for-each-category"></a><span data-ttu-id="28ae3-190">Обновление`CategoriesDataTable`и`CategoriesTableAdapter`для включения числа продуктов для каждой категории</span><span class="sxs-lookup"><span data-stu-id="28ae3-190">Updating the`CategoriesDataTable`and`CategoriesTableAdapter`to Include the Number of Products for Each Category</span></span>

<span data-ttu-id="28ae3-191">Вместо того чтобы определять количество продуктов для каждой категории в качестве привязки к Repeater, мы можем упростить этот процесс, настроив `CategoriesDataTable` и `CategoriesTableAdapter` на уровне доступа к данным, чтобы включить эти сведения в исходный код.</span><span class="sxs-lookup"><span data-stu-id="28ae3-191">Rather than determining the number of products for each category as it s bound to the Repeater, we can streamline this process by adjusting the `CategoriesDataTable` and `CategoriesTableAdapter` in the Data Access Layer to include this information natively.</span></span> <span data-ttu-id="28ae3-192">Для этого необходимо добавить новый столбец для `CategoriesDataTable` для хранения количества связанных продуктов.</span><span class="sxs-lookup"><span data-stu-id="28ae3-192">To achieve this, we must add a new column to `CategoriesDataTable` to hold the number of associated products.</span></span> <span data-ttu-id="28ae3-193">Чтобы добавить новый столбец к DataTable, откройте типизированный набор данных (`App_Code\DAL\Northwind.xsd`), щелкните правой кнопкой мыши таблицу данных, которую нужно изменить, и выберите Добавить/столбец.</span><span class="sxs-lookup"><span data-stu-id="28ae3-193">To add a new column to a DataTable, open the Typed DataSet (`App_Code\DAL\Northwind.xsd`), right-click on the DataTable to modify, and choose Add / Column.</span></span> <span data-ttu-id="28ae3-194">Добавьте новый столбец в `CategoriesDataTable` (см. рис. 5).</span><span class="sxs-lookup"><span data-stu-id="28ae3-194">Add a new column to the `CategoriesDataTable` (see Figure 5).</span></span>

<span data-ttu-id="28ae3-195">[![добавить новый столбец в CategoriesDataSource](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image14.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="28ae3-195">[![Add a New Column to the CategoriesDataSource](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image14.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image13.png)</span></span>

<span data-ttu-id="28ae3-196">**Рис. 5**. Добавление нового столбца в `CategoriesDataSource` ([щелкните, чтобы просмотреть изображение с полным размером](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="28ae3-196">**Figure 5**: Add a New Column to the `CategoriesDataSource` ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image15.png))</span></span>

<span data-ttu-id="28ae3-197">При этом будет добавлен новый столбец с именем `Column1`, который можно изменить, просто введя другое имя.</span><span class="sxs-lookup"><span data-stu-id="28ae3-197">This will add a new column named `Column1`, which you can change by simply typing in a different name.</span></span> <span data-ttu-id="28ae3-198">Переименуйте этот новый столбец в `NumberOfProducts`.</span><span class="sxs-lookup"><span data-stu-id="28ae3-198">Rename this new column to `NumberOfProducts`.</span></span> <span data-ttu-id="28ae3-199">Далее необходимо настроить свойства этого столбца.</span><span class="sxs-lookup"><span data-stu-id="28ae3-199">Next, we need to configure this column s properties.</span></span> <span data-ttu-id="28ae3-200">Щелкните новый столбец и перейдите к окно свойств.</span><span class="sxs-lookup"><span data-stu-id="28ae3-200">Click on the new column and go to the Properties window.</span></span> <span data-ttu-id="28ae3-201">Измените свойство `DataType` столбцов с `System.String` на `System.Int32` и задайте для свойства `ReadOnly` значение `True`, как показано на рис. 6.</span><span class="sxs-lookup"><span data-stu-id="28ae3-201">Change the column s `DataType` property from `System.String` to `System.Int32` and set the `ReadOnly` property to `True`, as shown in Figure 6.</span></span>

![Установка свойств DataType и ReadOnly нового столбца](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image16.png)

<span data-ttu-id="28ae3-203">**Рис. 6**. задание свойств `DataType` и `ReadOnly` нового столбца</span><span class="sxs-lookup"><span data-stu-id="28ae3-203">**Figure 6**: Set the `DataType` and `ReadOnly` Properties of the New Column</span></span>

<span data-ttu-id="28ae3-204">Хотя `CategoriesDataTable` теперь содержит столбец `NumberOfProducts`, его значение не задается ни одним из запросов TableAdapter s.</span><span class="sxs-lookup"><span data-stu-id="28ae3-204">While the `CategoriesDataTable` now has a `NumberOfProducts` column, its value is not set by any of the corresponding TableAdapter s queries.</span></span> <span data-ttu-id="28ae3-205">Мы можем обновить метод `GetCategories()`, чтобы получить эти сведения, если требуется, чтобы эти сведения возвращались при каждой получении сведений о категории.</span><span class="sxs-lookup"><span data-stu-id="28ae3-205">We can update the `GetCategories()` method to return this information if we want such information returned every time category information is retrieved.</span></span> <span data-ttu-id="28ae3-206">Однако в редких случаях нам нужно только извлечь количество связанных продуктов для категорий (например, просто для этого руководства), а затем оставить `GetCategories()` "как есть" и создать новый метод, возвращающий эту информацию.</span><span class="sxs-lookup"><span data-stu-id="28ae3-206">If, however, we only need to grab the number of associated products for the categories in rare instances (such as just for this tutorial), then we can leave `GetCategories()` as-is and create a new method that returns this information.</span></span> <span data-ttu-id="28ae3-207">Давайте будем использовать этот подход, создавая новый метод с именем `GetCategoriesAndNumberOfProducts()`.</span><span class="sxs-lookup"><span data-stu-id="28ae3-207">Let s use this latter approach, creating a new method named `GetCategoriesAndNumberOfProducts()`.</span></span>

<span data-ttu-id="28ae3-208">Чтобы добавить этот новый метод `GetCategoriesAndNumberOfProducts()`, щелкните правой кнопкой мыши `CategoriesTableAdapter` и выберите Создать запрос.</span><span class="sxs-lookup"><span data-stu-id="28ae3-208">To add this new `GetCategoriesAndNumberOfProducts()` method, right-click on the `CategoriesTableAdapter` and choose New Query.</span></span> <span data-ttu-id="28ae3-209">Откроется мастер настройки запросов адаптера таблицы TableAdapter, который мы использовали несколько раз в предыдущих руководствах.</span><span class="sxs-lookup"><span data-stu-id="28ae3-209">This brings up the TableAdapter Query Configuration Wizard, which we ve used numerous times in previous tutorials.</span></span> <span data-ttu-id="28ae3-210">Для этого метода запустите мастер, указав, что запрос использует специальный оператор SQL, возвращающий строки.</span><span class="sxs-lookup"><span data-stu-id="28ae3-210">For this method, start the wizard by indicating that the query uses an ad-hoc SQL statement that returns rows.</span></span>

<span data-ttu-id="28ae3-211">[![создать метод с помощью специального оператора SQL](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image18.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="28ae3-211">[![Create the Method Using an Ad-Hoc SQL Statement](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image18.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image17.png)</span></span>

<span data-ttu-id="28ae3-212">**Рис. 7**. Создание метода с помощью специального оператора SQL ([щелкните, чтобы просмотреть изображение с полным размером](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image19.png))</span><span class="sxs-lookup"><span data-stu-id="28ae3-212">**Figure 7**: Create the Method Using an Ad-Hoc SQL Statement ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image19.png))</span></span>

<span data-ttu-id="28ae3-213">[![инструкция SQL возвращает строки](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image21.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image20.png)</span><span class="sxs-lookup"><span data-stu-id="28ae3-213">[![The SQL Statement Returns Rows](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image21.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image20.png)</span></span>

<span data-ttu-id="28ae3-214">**Рис. 8**. Инструкция SQL возвращает строки ([щелкните, чтобы просмотреть изображение с полным размером](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="28ae3-214">**Figure 8**: The SQL Statement Returns Rows ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image22.png))</span></span>

<span data-ttu-id="28ae3-215">На следующем экране мастера запрашивается запрос на использование.</span><span class="sxs-lookup"><span data-stu-id="28ae3-215">The next wizard screen prompts us for the query to use.</span></span> <span data-ttu-id="28ae3-216">Чтобы вернуть каждую категорию `CategoryID`, `CategoryName`и `Description` полей, а также число продуктов, связанных с категорией, используйте следующую инструкцию `SELECT`:</span><span class="sxs-lookup"><span data-stu-id="28ae3-216">To return each category s `CategoryID`, `CategoryName`, and `Description` fields, along with the number of products associated with the category, use the following `SELECT` statement:</span></span>

[!code-sql[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample7.sql)]

<span data-ttu-id="28ae3-217">[![указать используемый запрос](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image24.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="28ae3-217">[![Specify the Query to Use](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image24.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image23.png)</span></span>

<span data-ttu-id="28ae3-218">**Рис. 9**. Указание используемого запроса ([щелкните, чтобы просмотреть изображение с полным размером](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image25.png))</span><span class="sxs-lookup"><span data-stu-id="28ae3-218">**Figure 9**: Specify the Query to Use ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image25.png))</span></span>

<span data-ttu-id="28ae3-219">Обратите внимание, что вложенный запрос, вычисляющий количество продуктов, связанных с категорией, имеет псевдоним в виде `NumberOfProducts`.</span><span class="sxs-lookup"><span data-stu-id="28ae3-219">Note that the subquery that computes the number of products associated with the category is aliased as `NumberOfProducts`.</span></span> <span data-ttu-id="28ae3-220">Такое сопоставление имен приводит к тому, что значение, возвращаемое этим вложенным запросом, связывается со столбцом `CategoriesDataTable` s `NumberOfProducts`.</span><span class="sxs-lookup"><span data-stu-id="28ae3-220">This naming match causes the value returned by this subquery to be associated with the `CategoriesDataTable` s `NumberOfProducts` column.</span></span>

<span data-ttu-id="28ae3-221">После ввода этого запроса последним шагом является выбор имени для нового метода.</span><span class="sxs-lookup"><span data-stu-id="28ae3-221">After entering this query, the last step is to choose the name for the new method.</span></span> <span data-ttu-id="28ae3-222">Используйте `FillWithNumberOfProducts` и `GetCategoriesAndNumberOfProducts` для заполнения DataTable и возврата шаблонов DataTable соответственно.</span><span class="sxs-lookup"><span data-stu-id="28ae3-222">Use `FillWithNumberOfProducts` and `GetCategoriesAndNumberOfProducts` for the Fill a DataTable and Return a DataTable patterns, respectively.</span></span>

<span data-ttu-id="28ae3-223">[![назовите новые методы TableAdapter s Филлвиснумберофпродуктс и GetCategoriesAndNumberOfProducts.](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image27.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image26.png)</span><span class="sxs-lookup"><span data-stu-id="28ae3-223">[![Name the New TableAdapter s Methods FillWithNumberOfProducts and GetCategoriesAndNumberOfProducts](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image27.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image26.png)</span></span>

<span data-ttu-id="28ae3-224">**Рис. 10**. именование новых методов адаптера таблицы `FillWithNumberOfProducts` и `GetCategoriesAndNumberOfProducts` ([щелкните, чтобы просмотреть изображение с полным размером](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image28.png))</span><span class="sxs-lookup"><span data-stu-id="28ae3-224">**Figure 10**: Name the New TableAdapter s Methods `FillWithNumberOfProducts` and `GetCategoriesAndNumberOfProducts` ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image28.png))</span></span>

<span data-ttu-id="28ae3-225">На этом этапе уровень доступа к данным был расширен и включает число продуктов для каждой категории.</span><span class="sxs-lookup"><span data-stu-id="28ae3-225">At this point the Data Access Layer has been extended to include the number of products per category.</span></span> <span data-ttu-id="28ae3-226">Так как весь уровень представления направляет все вызовы DAL через отдельный уровень бизнес-логики, необходимо добавить соответствующий метод `GetCategoriesAndNumberOfProducts` в класс `CategoriesBLL`:</span><span class="sxs-lookup"><span data-stu-id="28ae3-226">Since all our presentation layer routes all calls to the DAL through a separate Business Logic Layer we need to add a corresponding `GetCategoriesAndNumberOfProducts` method to the `CategoriesBLL` class:</span></span>

[!code-csharp[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample8.cs)]

<span data-ttu-id="28ae3-227">После выполнения DAL и BLL мы повторно готовы привязать эти данные к `Categories` Repeater в `CategoriesAndProducts.aspx`!</span><span class="sxs-lookup"><span data-stu-id="28ae3-227">With the DAL and BLL complete, we re ready to bind this data to the `Categories` Repeater in `CategoriesAndProducts.aspx`!</span></span> <span data-ttu-id="28ae3-228">Если вы уже создали элемент управления ObjectDataSource для элемента управления Repeater от определения числа продуктов в разделе обработчика событий `ItemDataBound`, удалите этот элемент ObjectDataSource и удалите параметр свойства Repeater s `DataSourceID`. Кроме того, не следует развязать событие Repeater `ItemDataBound` из обработчика событий, удалив синтаксис `Handles Categories.OnItemDataBound` в классе кода программной части ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="28ae3-228">If you ve already created an ObjectDataSource for the Repeater from the Determining the Number of Products in the `ItemDataBound` Event Handler section, delete this ObjectDataSource and remove the Repeater s `DataSourceID` property setting; also unwire the Repeater s `ItemDataBound` event from the event handler by removing the `Handles Categories.OnItemDataBound` syntax in the ASP.NET code-behind class.</span></span>

<span data-ttu-id="28ae3-229">После возврата к исходному состоянию Repeater добавьте новый объект ObjectDataSource с именем `CategoriesDataSource` через смарт-тег Repeater s.</span><span class="sxs-lookup"><span data-stu-id="28ae3-229">With the Repeater back in its original state, add a new ObjectDataSource named `CategoriesDataSource` via the Repeater s smart tag.</span></span> <span data-ttu-id="28ae3-230">Настройте ObjectDataSource для использования класса `CategoriesBLL`, но вместо того, чтобы он использовал метод `GetCategories()`, он должен использовать `GetCategoriesAndNumberOfProducts()` вместо него (см. рис. 11).</span><span class="sxs-lookup"><span data-stu-id="28ae3-230">Configure the ObjectDataSource to use the `CategoriesBLL` class, but instead of having it use the `GetCategories()` method, have it use `GetCategoriesAndNumberOfProducts()` instead (see Figure 11).</span></span>

<span data-ttu-id="28ae3-231">[![настроить ObjectDataSource для использования метода GetCategoriesAndNumberOfProducts](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image30.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="28ae3-231">[![Configure the ObjectDataSource to Use the GetCategoriesAndNumberOfProducts Method](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image30.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image29.png)</span></span>

<span data-ttu-id="28ae3-232">**Рис. 11**. Настройка ObjectDataSource для использования метода `GetCategoriesAndNumberOfProducts` ([щелкните, чтобы просмотреть изображение с полным размером](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image31.png))</span><span class="sxs-lookup"><span data-stu-id="28ae3-232">**Figure 11**: Configure the ObjectDataSource to Use the `GetCategoriesAndNumberOfProducts` Method ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image31.png))</span></span>

<span data-ttu-id="28ae3-233">Затем обновите `ItemTemplate` таким образом, чтобы свойство LinkButton `Text` было декларативно назначено с помощью синтаксиса DataBinding и включало поля данных `CategoryName` и `NumberOfProducts`.</span><span class="sxs-lookup"><span data-stu-id="28ae3-233">Next, update the `ItemTemplate` so that the LinkButton s `Text` property is declaratively assigned using databinding syntax and includes both the `CategoryName` and `NumberOfProducts` data fields.</span></span> <span data-ttu-id="28ae3-234">Полная декларативная разметка для элемента управления Repeater и `CategoriesDataSource` ObjectDataSource соблюдается:</span><span class="sxs-lookup"><span data-stu-id="28ae3-234">The complete declarative markup for the Repeater and the `CategoriesDataSource` ObjectDataSource follow:</span></span>

[!code-aspx[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample9.aspx)]

<span data-ttu-id="28ae3-235">Выходные данные, отображаемые путем обновления DAL для включения `NumberOfProducts` столбца, аналогичны тому, как используется `ItemDataBound`ный метод обработчика событий (см. рис. 4 для просмотра снимка экрана с именами категорий и количеством продуктов).</span><span class="sxs-lookup"><span data-stu-id="28ae3-235">The output rendered by updating the DAL to include a `NumberOfProducts` column is the same as using the `ItemDataBound` event handler approach (refer back to Figure 4 to see a screen shot of the Repeater showing the category names and number of products).</span></span>

## <a name="step-3-displaying-the-selected-category-s-products"></a><span data-ttu-id="28ae3-236">Шаг 3. Отображение выбранных продуктов категории</span><span class="sxs-lookup"><span data-stu-id="28ae3-236">Step 3: Displaying the Selected Category s Products</span></span>

<span data-ttu-id="28ae3-237">На этом этапе у нас есть `Categories` Repeater, отображающий список категорий вместе с количеством продуктов в каждой категории.</span><span class="sxs-lookup"><span data-stu-id="28ae3-237">At this point we have the `Categories` Repeater displaying the list of categories along with the number of products in each category.</span></span> <span data-ttu-id="28ae3-238">Элемент управления Repeater использует элемент управления LinkButton для каждой категории, которая при нажатии вызывает обратную передачу, после чего необходимо отобразить эти продукты для выбранной категории в `CategoryProducts` DataList.</span><span class="sxs-lookup"><span data-stu-id="28ae3-238">The Repeater uses a LinkButton for each category that, when clicked, causes a postback, at which point we need to display those products for the selected category in the `CategoryProducts` DataList.</span></span>

<span data-ttu-id="28ae3-239">Одна из проблем заключается в том, как разместить в DataList только те продукты для выбранной категории.</span><span class="sxs-lookup"><span data-stu-id="28ae3-239">One challenge facing us is how to have the DataList display just those products for the selected category.</span></span> <span data-ttu-id="28ae3-240">В базе данных " [основной/подробности" с помощью выбираемого главного элемента управления GridView с](../masterdetail/master-detail-using-a-selectable-master-gridview-with-a-details-detailview-cs.md) руководством по DetailsView мы увидели, как создать элемент управления GridView, строки которого могли быть выбраны, а сведения о выбранных строках отображаются в элементе DetailsView на той же странице.</span><span class="sxs-lookup"><span data-stu-id="28ae3-240">In the [Master/Detail Using a Selectable Master GridView with a Details DetailsView](../masterdetail/master-detail-using-a-selectable-master-gridview-with-a-details-detailview-cs.md) tutorial we saw how to build a GridView whose rows could be selected, with the selected row s details being displayed in a DetailsView on the same page.</span></span> <span data-ttu-id="28ae3-241">Элемент управления GridView возвращает сведения обо всех продуктах, используя метод `ProductsBLL` s `GetProducts()`, а элемент ObjectDataSource DetailsView извлекает сведения о выбранном продукте с помощью метода `GetProductsByProductID(productID)`.</span><span class="sxs-lookup"><span data-stu-id="28ae3-241">The GridView s ObjectDataSource returned information about all products using the `ProductsBLL` s `GetProducts()` method while the DetailsView s ObjectDataSource retrieved information about the selected product using the `GetProductsByProductID(productID)` method.</span></span> <span data-ttu-id="28ae3-242">Значение параметра *`productID`* было предоставлено декларативно путем связывания его со значением свойства GridView s `SelectedValue`.</span><span class="sxs-lookup"><span data-stu-id="28ae3-242">The *`productID`* parameter value was provided declaratively by associating it with the value of the GridView s `SelectedValue` property.</span></span> <span data-ttu-id="28ae3-243">К сожалению, у элемента Repeater нет свойства `SelectedValue` и он не может выступать в качестве источника параметра.</span><span class="sxs-lookup"><span data-stu-id="28ae3-243">Unfortunately, the Repeater does not have a `SelectedValue` property and cannot serve as a parameter source.</span></span>

> [!NOTE]
> <span data-ttu-id="28ae3-244">Это одна из проблем, которые появляются при использовании LinkButton в элементе Repeater.</span><span class="sxs-lookup"><span data-stu-id="28ae3-244">This is one of those challenges that appear when using the LinkButton in a Repeater.</span></span> <span data-ttu-id="28ae3-245">Если бы мы использовали гиперссылку для передачи `CategoryID` через строку запроса, мы могли бы использовать это поле QueryString в качестве источника для значения параметра s.</span><span class="sxs-lookup"><span data-stu-id="28ae3-245">Had we used a hyperlink to pass in the `CategoryID` through the querystring instead, we could use that QueryString field as the source for the parameter s value.</span></span>

<span data-ttu-id="28ae3-246">Прежде чем беспокоиться о недостатке свойства `SelectedValue` для элемента управления Repeater, позвольте s сначала привязать элемент управления DataList к элементу ObjectDataSource и указать его `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="28ae3-246">Before we worry about the lack of a `SelectedValue` property for the Repeater, though, let s first bind the DataList to an ObjectDataSource and specify its `ItemTemplate`.</span></span>

<span data-ttu-id="28ae3-247">В смарт-теге DataList добавьте новый элемент ObjectDataSource с именем `CategoryProductsDataSource` и настройте его для использования метода `ProductsBLL` класса s `GetProductsByCategoryID(categoryID)`.</span><span class="sxs-lookup"><span data-stu-id="28ae3-247">From the DataList s smart tag, opt to add a new ObjectDataSource named `CategoryProductsDataSource` and configure it to use the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method.</span></span> <span data-ttu-id="28ae3-248">Поскольку элемент управления DataList в этом учебнике предоставляет интерфейс только для чтения, вы можете установить в раскрывающихся списках на вкладках Вставка, обновление и удалить значение (нет).</span><span class="sxs-lookup"><span data-stu-id="28ae3-248">Since the DataList in this tutorial offers a read-only interface, feel free to set the drop-down lists in the INSERT, UPDATE, and DELETE tabs to (None).</span></span>

<span data-ttu-id="28ae3-249">[![настроить ObjectDataSource для использования метода GetProductsByCategoryID класса ProductsBLL (КодТипа)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image33.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image32.png)</span><span class="sxs-lookup"><span data-stu-id="28ae3-249">[![Configure the ObjectDataSource to Use ProductsBLL Class s GetProductsByCategoryID(categoryID) Method](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image33.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image32.png)</span></span>

<span data-ttu-id="28ae3-250">**Рис. 12**. Настройка ObjectDataSource для использования метода `ProductsBLL` Class s `GetProductsByCategoryID(categoryID)` ([щелкните, чтобы просмотреть изображение с полным размером](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image34.png))</span><span class="sxs-lookup"><span data-stu-id="28ae3-250">**Figure 12**: Configure the ObjectDataSource to Use `ProductsBLL` Class s `GetProductsByCategoryID(categoryID)` Method ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image34.png))</span></span>

<span data-ttu-id="28ae3-251">Так как метод `GetProductsByCategoryID(categoryID)` принимает входной параметр ( *`categoryID`* ), мастер настройки источника данных позволяет указать источник параметра s.</span><span class="sxs-lookup"><span data-stu-id="28ae3-251">Since the `GetProductsByCategoryID(categoryID)` method expects an input parameter (*`categoryID`*), the Configure Data Source wizard allows us to specify the parameter s source.</span></span> <span data-ttu-id="28ae3-252">Если категории были перечислены в элементе управления GridView или DataList, мы устанавливаем раскрывающийся список источника параметров для управления, а параметр ControlID — `ID` веб-элемента.</span><span class="sxs-lookup"><span data-stu-id="28ae3-252">Had the categories been listed in a GridView or a DataList, we d set the Parameter source drop-down list to Control and the ControlID to the `ID` of the data Web control.</span></span> <span data-ttu-id="28ae3-253">Однако поскольку у элемента Repeater отсутствует свойство `SelectedValue` его нельзя использовать в качестве источника параметра.</span><span class="sxs-lookup"><span data-stu-id="28ae3-253">However, since the Repeater lacks a `SelectedValue` property it cannot be used as a parameter source.</span></span> <span data-ttu-id="28ae3-254">Если флажок установлен, то раскрывающийся список ControlID будет содержать только один элемент управления `ID``CategoryProducts`, `ID` DataList.</span><span class="sxs-lookup"><span data-stu-id="28ae3-254">If you check, you'll find that the ControlID drop-down list only contains one control `ID``CategoryProducts`, the `ID` of the DataList.</span></span>

<span data-ttu-id="28ae3-255">Пока установите в раскрывающемся списке Источник параметра значение нет.</span><span class="sxs-lookup"><span data-stu-id="28ae3-255">For now, set the Parameter source drop-down list to None.</span></span> <span data-ttu-id="28ae3-256">В итоге мы будем программно назначать значение этого параметра при щелчке элемента LinkButton в элементе Repeater.</span><span class="sxs-lookup"><span data-stu-id="28ae3-256">We'll end up programmatically assigning this parameter value when a category LinkButton is clicked in the Repeater.</span></span>

<span data-ttu-id="28ae3-257">[![не указывать источник параметра для параметра categoryID](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image36.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="28ae3-257">[![Do Not Specify a Parameter Source for the categoryID Parameter](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image36.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image35.png)</span></span>

<span data-ttu-id="28ae3-258">**Рис. 13**. не указывайте источник параметра для параметра *`categoryID`* ([щелкните, чтобы просмотреть изображение с полным размером](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image37.png))</span><span class="sxs-lookup"><span data-stu-id="28ae3-258">**Figure 13**: Do Not Specify a Parameter Source for the *`categoryID`* Parameter ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image37.png))</span></span>

<span data-ttu-id="28ae3-259">После завершения работы мастера настройки источника данных Visual Studio создает `ItemTemplate`DataList.</span><span class="sxs-lookup"><span data-stu-id="28ae3-259">After completing the Configure Data Source wizard, Visual Studio auto-generates the DataList s `ItemTemplate`.</span></span> <span data-ttu-id="28ae3-260">Замените этот `ItemTemplate` по умолчанию шаблоном, который использовался в предыдущем руководстве. также задайте для свойства `RepeatColumns` DataList s значение 2.</span><span class="sxs-lookup"><span data-stu-id="28ae3-260">Replace this default `ItemTemplate` with the template we used in the preceding tutorial; also, set the DataList s `RepeatColumns` property to 2.</span></span> <span data-ttu-id="28ae3-261">После внесения этих изменений декларативная разметка для элемента управления DataList и связанный с ней объект ObjectDataSource должны выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="28ae3-261">After making these changes the declarative markup for your DataList and its associated ObjectDataSource should look like the following:</span></span>

[!code-aspx[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample10.aspx)]

<span data-ttu-id="28ae3-262">В настоящее время параметр *`categoryID`* `CategoryProductsDataSource` ObjectDataSource s не задан, поэтому при просмотре страницы продукты не отображаются.</span><span class="sxs-lookup"><span data-stu-id="28ae3-262">Currently, the `CategoryProductsDataSource` ObjectDataSource s *`categoryID`* parameter is never set, so no products are displayed when viewing the page.</span></span> <span data-ttu-id="28ae3-263">Для этого нужно задать значение этого параметра на основе `CategoryID` категории, нажатой в элементе Repeater.</span><span class="sxs-lookup"><span data-stu-id="28ae3-263">What we need to do is have this parameter value set based on the `CategoryID` of the clicked category in the Repeater.</span></span> <span data-ttu-id="28ae3-264">Это приводит к двум задачам: сначала, как определить, когда была нажата кнопка LinkButton в элементе Repeater s `ItemTemplate`; и во вторых, как можно определить `CategoryID` соответствующей категории, которую щелкнули LinkButton?</span><span class="sxs-lookup"><span data-stu-id="28ae3-264">This introduces two challenges: first, how do we determine when a LinkButton in the Repeater s `ItemTemplate` has been clicked; and second, how can we determine the `CategoryID` of the corresponding category whose LinkButton was clicked?</span></span>

<span data-ttu-id="28ae3-265">Элемент управления LinkButton, такой как Button и ImageButton, имеет событие `Click` и [событие`Command`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.linkbutton.command.aspx).</span><span class="sxs-lookup"><span data-stu-id="28ae3-265">The LinkButton like the Button and ImageButton controls has a `Click` event and a [`Command` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.linkbutton.command.aspx).</span></span> <span data-ttu-id="28ae3-266">Событие `Click` предназначено для того, чтобы просто отметить, что была нажата кнопка LinkButton.</span><span class="sxs-lookup"><span data-stu-id="28ae3-266">The `Click` event is designed to simply note that the LinkButton has been clicked.</span></span> <span data-ttu-id="28ae3-267">Однако иногда в дополнение к тому, что была нажата кнопка LinkButton, нам также нужно передать некоторую дополнительную информацию в обработчик событий.</span><span class="sxs-lookup"><span data-stu-id="28ae3-267">At times, however, in addition to noting that the LinkButton has been clicked we also need to pass some extra information to the event handler.</span></span> <span data-ttu-id="28ae3-268">В этом случае эти дополнительные сведения могут быть назначены свойствам LinkButton [`CommandName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.linkbutton.commandname.aspx) и [`CommandArgument`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.linkbutton.commandargument.aspx) .</span><span class="sxs-lookup"><span data-stu-id="28ae3-268">If this is the case, the LinkButton s [`CommandName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.linkbutton.commandname.aspx) and [`CommandArgument`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.linkbutton.commandargument.aspx) properties can be assigned this extra information.</span></span> <span data-ttu-id="28ae3-269">Затем при нажатии элемента LinkButton срабатывает ее `Command` событие (вместо события `Click`), и обработчику событий передаются значения свойств `CommandName` и `CommandArgument`.</span><span class="sxs-lookup"><span data-stu-id="28ae3-269">Then, when the LinkButton is clicked, its `Command` event fires (instead of its `Click` event) and the event handler is passed the values of the `CommandName` and `CommandArgument` properties.</span></span>

<span data-ttu-id="28ae3-270">При возникновении события `Command` в шаблоне в элементе Repeater возникает [событие repeater`ItemCommand`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.repeater.itemcommand.aspx) , и ему передается `CommandName` и `CommandArgument` значения нажатия элемента LinkButton (или кнопки или ImageButton).</span><span class="sxs-lookup"><span data-stu-id="28ae3-270">When a `Command` event is raised from within a template in the Repeater, the Repeater s [`ItemCommand` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.repeater.itemcommand.aspx) fires and is passed the `CommandName` and `CommandArgument` values of the clicked LinkButton (or Button or ImageButton).</span></span> <span data-ttu-id="28ae3-271">Таким образом, чтобы определить, когда была нажата Категория LinkButton в элементе Repeater, необходимо выполнить следующие действия.</span><span class="sxs-lookup"><span data-stu-id="28ae3-271">Therefore, to determine when a category LinkButton in the Repeater has been clicked, we need to do the following:</span></span>

1. <span data-ttu-id="28ae3-272">Задайте для свойства `CommandName` элемента LinkButton в элементе Repeater `ItemTemplate` какое-то значение (я использовал Листпродуктс).</span><span class="sxs-lookup"><span data-stu-id="28ae3-272">Set the `CommandName` property of the LinkButton in the Repeater s `ItemTemplate` to some value (I ve used ListProducts ).</span></span> <span data-ttu-id="28ae3-273">Если задать это `CommandName`, то при нажатии кнопки LinkButton возникает событие `Command` LinkButton.</span><span class="sxs-lookup"><span data-stu-id="28ae3-273">By setting this `CommandName` value, the LinkButton s `Command` event fires when the LinkButton is clicked.</span></span>
2. <span data-ttu-id="28ae3-274">Присвойте свойству `CommandArgument` LinkButton s значение текущего элемента `CategoryID`.</span><span class="sxs-lookup"><span data-stu-id="28ae3-274">Set the LinkButton s `CommandArgument` property to the value of the current item s `CategoryID`.</span></span>
3. <span data-ttu-id="28ae3-275">Создайте обработчик событий для события Repeater `ItemCommand`.</span><span class="sxs-lookup"><span data-stu-id="28ae3-275">Create an event handler for the Repeater s `ItemCommand` event.</span></span> <span data-ttu-id="28ae3-276">В обработчике событий задайте для параметра `CategoryProductsDataSource` ObjectDataSource s `CategoryID` значение переданного `CommandArgument`.</span><span class="sxs-lookup"><span data-stu-id="28ae3-276">In the event handler, set the `CategoryProductsDataSource` ObjectDataSource s `CategoryID` parameter to the value of the passed-in `CommandArgument`.</span></span>

<span data-ttu-id="28ae3-277">Следующая `ItemTemplate` разметка для повторяющихся категорий, реализует шаги 1 и 2.</span><span class="sxs-lookup"><span data-stu-id="28ae3-277">The following `ItemTemplate` markup for the Categories Repeater implements steps 1 and 2.</span></span> <span data-ttu-id="28ae3-278">Обратите внимание, что `CommandArgument` значение присваивается элементам данных `CategoryID` с помощью синтаксиса DataBinding:</span><span class="sxs-lookup"><span data-stu-id="28ae3-278">Note how the `CommandArgument` value is assigned the data item s `CategoryID` using databinding syntax:</span></span>

[!code-aspx[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample11.aspx)]

<span data-ttu-id="28ae3-279">При создании обработчика `ItemCommand` событий рекомендуется всегда сначала проверять значение входящего `CommandName`, так как *любое* событие `Command`, вызванное *любой* кнопкой, LinkButton или ImageButton в элементе Repeater, приведет к срабатыванию события `ItemCommand`.</span><span class="sxs-lookup"><span data-stu-id="28ae3-279">Whenever creating an `ItemCommand` event handler it is prudent to always first check the incoming `CommandName` value because *any* `Command` event raised by *any* Button, LinkButton, or ImageButton within the Repeater will cause the `ItemCommand` event to fire.</span></span> <span data-ttu-id="28ae3-280">Хотя сейчас у нас есть только одна такая LinkButton, в будущем мы (или другой разработчик в нашей группе) могут добавить в Repeater дополнительные веб-элементы управления для кнопок, которые при нажатии вызывают тот же `ItemCommand` обработчик событий.</span><span class="sxs-lookup"><span data-stu-id="28ae3-280">While we currently only have one such LinkButton now, in the future we (or another developer on our team) might add additional button Web controls to the Repeater that, when clicked, raises the same `ItemCommand` event handler.</span></span> <span data-ttu-id="28ae3-281">Поэтому рекомендуется всегда проверять свойство `CommandName` и продолжать только программную логику, если она соответствует ожидаемому значению.</span><span class="sxs-lookup"><span data-stu-id="28ae3-281">Therefore, it s best to always make sure you check the `CommandName` property and only proceed with your programmatic logic if it matches up to the value expected.</span></span>

<span data-ttu-id="28ae3-282">Убедившись, что переданное `CommandName` значение равно Листпродуктс, обработчик событий присваивает `CategoryProductsDataSource` ObjectDataSource s `CategoryID` параметру переданного `CommandArgument`.</span><span class="sxs-lookup"><span data-stu-id="28ae3-282">After ensuring that the passed-in `CommandName` value equals ListProducts, the event handler then assigns the `CategoryProductsDataSource` ObjectDataSource s `CategoryID` parameter to the value of the passed-in `CommandArgument`.</span></span> <span data-ttu-id="28ae3-283">Это изменение в ObjectDataSource `SelectParameters` автоматически приводит к повторной привязке элемента управления DataList к источнику данных, отображая продукты для вновь выбранной категории.</span><span class="sxs-lookup"><span data-stu-id="28ae3-283">This modification to the ObjectDataSource s `SelectParameters` automatically causes the DataList to rebind itself to the data source, showing the products for the newly selected category.</span></span>

[!code-csharp[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample12.cs)]

<span data-ttu-id="28ae3-284">С этими дополнениями наш учебник завершен.</span><span class="sxs-lookup"><span data-stu-id="28ae3-284">With these additions, our tutorial is complete!</span></span> <span data-ttu-id="28ae3-285">Уделите немного времени для тестирования в браузере.</span><span class="sxs-lookup"><span data-stu-id="28ae3-285">Take a moment to test it out in a browser.</span></span> <span data-ttu-id="28ae3-286">На рис. 14 показан экран при первом посещении страницы.</span><span class="sxs-lookup"><span data-stu-id="28ae3-286">Figure 14 shows the screen when first visiting the page.</span></span> <span data-ttu-id="28ae3-287">Поскольку Категория еще не выбрана, продукты не отображаются.</span><span class="sxs-lookup"><span data-stu-id="28ae3-287">Since a category has yet to be selected, no products are displayed.</span></span> <span data-ttu-id="28ae3-288">Щелкнув категорию, например создать, вы увидите эти продукты в категории продуктов в представлении с двумя столбцами (см. рис. 15).</span><span class="sxs-lookup"><span data-stu-id="28ae3-288">Clicking on a category, such as Produce, displays those products in the Product category in a two-column view (see Figure 15).</span></span>

<span data-ttu-id="28ae3-289">[![при первом посещении страницы продукты не отображаются](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image39.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image38.png)</span><span class="sxs-lookup"><span data-stu-id="28ae3-289">[![No Products are Displayed When First Visiting the Page](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image39.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image38.png)</span></span>

<span data-ttu-id="28ae3-290">**Рис. 14**. при первом посещении страницы продукты не отображаются ([щелкните, чтобы просмотреть изображение с полным размером](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image40.png))</span><span class="sxs-lookup"><span data-stu-id="28ae3-290">**Figure 14**: No Products are Displayed When First Visiting the Page ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image40.png))</span></span>

<span data-ttu-id="28ae3-291">[![щелкнув категорию создать, вы выведете список соответствующих продуктов справа.](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image42.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image41.png)</span><span class="sxs-lookup"><span data-stu-id="28ae3-291">[![Clicking the Produce Category Lists the Matching Products to the Right](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image42.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image41.png)</span></span>

<span data-ttu-id="28ae3-292">**Рис. 15**. Если щелкнуть категорию создать, выводится список соответствующих продуктов справа ([щелкните, чтобы просмотреть изображение с полным размером](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image43.png)).</span><span class="sxs-lookup"><span data-stu-id="28ae3-292">**Figure 15**: Clicking the Produce Category Lists the Matching Products to the Right ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image43.png))</span></span>

## <a name="summary"></a><span data-ttu-id="28ae3-293">Сводка</span><span class="sxs-lookup"><span data-stu-id="28ae3-293">Summary</span></span>

<span data-ttu-id="28ae3-294">Как было показано в этом учебнике, а также на предыдущем, отчеты «основной/подробности» могут быть распределены между двумя страницами или объединены по одной.</span><span class="sxs-lookup"><span data-stu-id="28ae3-294">As we saw in this tutorial and the preceding one, master/detail reports can be spread out across two pages, or consolidated on one.</span></span> <span data-ttu-id="28ae3-295">При отображении отчета «основной/подробности» на одной странице приводятся некоторые трудности, связанные с тем, как лучше разрешать макеты основных и подробных записей на странице.</span><span class="sxs-lookup"><span data-stu-id="28ae3-295">Displaying a master/details report on a single page, however, introduces some challenges on how best to layout the master and details records on the page.</span></span> <span data-ttu-id="28ae3-296">В *главной и подробной среде с помощью выбираемого главного элемента управления GridView с руководством по DetailsView подробные* записи отображаются над главными записями. в этом учебнике мы использовали методы CSS, чтобы записи главной таблицы настроились слева от сведений.</span><span class="sxs-lookup"><span data-stu-id="28ae3-296">In the *Master/Detail Using a Selectable Master GridView with a Details DetailsView* tutorial we had the details records appear above the master records; in this tutorial we used CSS techniques to have the master records float to the left of the details.</span></span>

<span data-ttu-id="28ae3-297">Вместе с отображением отчетов «основной/подробности» у нас также была возможность исследовать, как получить количество продуктов, связанных с каждой категорией, а также как выполнять логику на стороне сервера при щелчке элемента LinkButton (или кнопки или ImageButton) в элементе Repeater.</span><span class="sxs-lookup"><span data-stu-id="28ae3-297">Along with displaying master/details reports, we also had the opportunity to explore how to retrieve the number of products associated with each category as well as how to perform server-side logic when a LinkButton (or Button or ImageButton) is clicked from within a Repeater.</span></span>

<span data-ttu-id="28ae3-298">Этот учебник завершает исследование отчетов «основной/подробности» с помощью элементов управления DataList и Repeater.</span><span class="sxs-lookup"><span data-stu-id="28ae3-298">This tutorial completes our examination of master/detail reports with the DataList and Repeater.</span></span> <span data-ttu-id="28ae3-299">В следующем наборе руководств показано, как добавить возможности редактирования и удаления элементов управления DataList.</span><span class="sxs-lookup"><span data-stu-id="28ae3-299">Our next set of tutorials will illustrate how to add editing and deleting capabilities to the DataList control.</span></span>

<span data-ttu-id="28ae3-300">Поздравляем с программированием!</span><span class="sxs-lookup"><span data-stu-id="28ae3-300">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="28ae3-301">Дополнительные материалы</span><span class="sxs-lookup"><span data-stu-id="28ae3-301">Further Reading</span></span>

<span data-ttu-id="28ae3-302">Дополнительные сведения о разделах, обсуждаемых в этом руководстве, см. в следующих ресурсах:</span><span class="sxs-lookup"><span data-stu-id="28ae3-302">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- <span data-ttu-id="28ae3-303">[Флоатуториал](http://css.maxdesign.com.au/floatutorial/) учебник по плавающим элементам CSS с помощью CSS</span><span class="sxs-lookup"><span data-stu-id="28ae3-303">[Floatutorial](http://css.maxdesign.com.au/floatutorial/) a tutorial on floating CSS elements with CSS</span></span>
- <span data-ttu-id="28ae3-304">[Размещение CSS](http://www.brainjar.com/css/positioning/) дополнительные сведения о размещении элементов с помощью CSS</span><span class="sxs-lookup"><span data-stu-id="28ae3-304">[CSS Positioning](http://www.brainjar.com/css/positioning/) more information on positioning elements with CSS</span></span>
- <span data-ttu-id="28ae3-305">Размещение [содержимого с HTML](http://www.w3schools.com/html/html_layout.asp) с помощью `<table>` s и других HTML-элементов для позиционирования</span><span class="sxs-lookup"><span data-stu-id="28ae3-305">[Laying Out Content with HTML](http://www.w3schools.com/html/html_layout.asp) using `<table>` s and other HTML elements for positioning</span></span>

## <a name="about-the-author"></a><span data-ttu-id="28ae3-306">Об авторе</span><span class="sxs-lookup"><span data-stu-id="28ae3-306">About the Author</span></span>

<span data-ttu-id="28ae3-307">[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи книг по ASP/ASP. NET и основатель [4GuysFromRolla.com](http://www.4guysfromrolla.com), работал с веб-технологиями Майкрософт с 1998.</span><span class="sxs-lookup"><span data-stu-id="28ae3-307">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="28ae3-308">Скотт работает как независимый консультант, преподаватель и модуль записи.</span><span class="sxs-lookup"><span data-stu-id="28ae3-308">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="28ae3-309">Его последняя книга — [*Sams обучать себя ASP.NET 2,0 за 24 часа*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="28ae3-309">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="28ae3-310">Он доступен по адресу [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="28ae3-310">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="28ae3-311">или через его блог, который можно найти по адресу [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="28ae3-311">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="28ae3-312">Специальная благодарность</span><span class="sxs-lookup"><span data-stu-id="28ae3-312">Special Thanks To</span></span>

<span data-ttu-id="28ae3-313">Эта серия руководств была рассмотрена многими полезными рецензентами.</span><span class="sxs-lookup"><span data-stu-id="28ae3-313">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="28ae3-314">Специалистом по интересу для этого учебника был Зак Джонс.</span><span class="sxs-lookup"><span data-stu-id="28ae3-314">Lead reviewer for this tutorial was Zack Jones.</span></span> <span data-ttu-id="28ae3-315">Хотите ознакомиться с моими будущими статьями MSDN?</span><span class="sxs-lookup"><span data-stu-id="28ae3-315">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="28ae3-316">Если это так, расположите строку в [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="28ae3-316">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="28ae3-317">[Назад](master-detail-filtering-acess-two-pages-datalist-cs.md)
> [Вперед](master-detail-filtering-with-a-dropdownlist-datalist-vb.md)</span><span class="sxs-lookup"><span data-stu-id="28ae3-317">[Previous](master-detail-filtering-acess-two-pages-datalist-cs.md)
[Next](master-detail-filtering-with-a-dropdownlist-datalist-vb.md)</span></span>
