---
uid: web-forms/overview/older-versions-security/roles/creating-and-managing-roles-vb
title: Создание ролей и управление ими (VB) | Документация Майкрософт
author: rick-anderson
description: В этом руководстве рассматриваются шаги, необходимые для настройки платформы ролей. После этого мы будем создавать веб-страницы для создания и удаления ролей.
ms.author: riande
ms.date: 03/24/2008
ms.assetid: 83af9f5f-9a00-4f83-8afc-e98bdd49014e
msc.legacyurl: /web-forms/overview/older-versions-security/roles/creating-and-managing-roles-vb
msc.type: authoredcontent
ms.openlocfilehash: 825e2afb750925637d308b7ceb35e1b02b708c1d
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/28/2019
ms.locfileid: "74586331"
---
# <a name="creating-and-managing-roles-vb"></a><span data-ttu-id="ff34c-104">Создание ролей и управление ими (VB)</span><span class="sxs-lookup"><span data-stu-id="ff34c-104">Creating and Managing Roles (VB)</span></span>

<span data-ttu-id="ff34c-105">по [Скотт Митчелл](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="ff34c-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="ff34c-106">[Скачать код](https://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/VB.09.zip) или [скачать PDF](https://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/aspnet_tutorial09_CreatingRoles_vb.pdf)</span><span class="sxs-lookup"><span data-stu-id="ff34c-106">[Download Code](https://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/VB.09.zip) or [Download PDF](https://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/aspnet_tutorial09_CreatingRoles_vb.pdf)</span></span>

> <span data-ttu-id="ff34c-107">В этом руководстве рассматриваются шаги, необходимые для настройки платформы ролей.</span><span class="sxs-lookup"><span data-stu-id="ff34c-107">This tutorial examines the steps necessary for configuring the Roles framework.</span></span> <span data-ttu-id="ff34c-108">После этого мы будем создавать веб-страницы для создания и удаления ролей.</span><span class="sxs-lookup"><span data-stu-id="ff34c-108">Following that, we will build web pages to create and delete roles.</span></span>

## <a name="introduction"></a><span data-ttu-id="ff34c-109">Введение</span><span class="sxs-lookup"><span data-stu-id="ff34c-109">Introduction</span></span>

<span data-ttu-id="ff34c-110"><a id="_msoanchor_1"> </a>В учебнике по [*авторизации на основе пользователей*](../membership/user-based-authorization-vb.md) мы рассматривали использование авторизации URL-адресов для ограничения определенных пользователей от набора страниц и изучения декларативных и программных методов настройки функций страницы ASP.NET на основе посещаемого пользователя.</span><span class="sxs-lookup"><span data-stu-id="ff34c-110">In the <a id="_msoanchor_1"></a>[*User-Based Authorization*](../membership/user-based-authorization-vb.md) tutorial we looked at using URL authorization to restrict certain users from a set of pages and explored declarative and programmatic techniques for adjusting an ASP.NET page's functionality based on the visiting user.</span></span> <span data-ttu-id="ff34c-111">Тем не менее, предоставление разрешения на доступ к странице или функциональность на уровне пользователя может стать кошмаром обслуживания в сценариях с множеством учетных записей пользователей или при частом изменении привилегий пользователей.</span><span class="sxs-lookup"><span data-stu-id="ff34c-111">Granting permission for page access or functionality on a user-by-user basis, however, can become a maintenance nightmare in scenarios where there are many user accounts or when users' privileges change often.</span></span> <span data-ttu-id="ff34c-112">Каждый раз, когда пользователь получает или теряет авторизацию для выполнения определенной задачи, администратору необходимо обновить соответствующие правила авторизации URL-адреса, декларативную разметку и код.</span><span class="sxs-lookup"><span data-stu-id="ff34c-112">Any time a user gains or loses authorization to perform a particular task, the administrator needs to update the appropriate URL authorization rules, declarative markup, and code.</span></span>

<span data-ttu-id="ff34c-113">Обычно это помогает классифицировать пользователей на группы или *роли* , а затем применять разрешения для конкретных ролей.</span><span class="sxs-lookup"><span data-stu-id="ff34c-113">It usually helps to classify users into groups or *roles* and then to apply permissions on a role-by-role basis.</span></span> <span data-ttu-id="ff34c-114">Например, большинство веб-приложений имеют определенный набор страниц или задач, которые зарезервированы только для пользователей с правами администратора.</span><span class="sxs-lookup"><span data-stu-id="ff34c-114">For example, most web applications have a certain set of pages or tasks that are reserved only for administrative users.</span></span> <span data-ttu-id="ff34c-115">Используя методики, описанные в руководстве по *авторизации на основе пользователей* , мы добавим соответствующие правила авторизации URL-адресов, декларативную разметку и код, чтобы разрешить указанным учетным записям пользователей выполнять административные задачи.</span><span class="sxs-lookup"><span data-stu-id="ff34c-115">Using the techniques learned in the *User-Based Authorization* tutorial, we would add the appropriate URL authorization rules, declarative markup, and code to allow the specified user accounts to perform administrative tasks.</span></span> <span data-ttu-id="ff34c-116">Но если был добавлен новый администратор или у существующего администратора требуется, чтобы его права на администрирование были отозваны, нам пришлось бы вернуть и обновить файлы конфигурации и веб-страницы.</span><span class="sxs-lookup"><span data-stu-id="ff34c-116">But if a new administrator was added or if an existing administrator needed to have her administration rights revoked, we would have to return and update the configuration files and web pages.</span></span> <span data-ttu-id="ff34c-117">Однако с помощью ролей можно создать роль Администраторы и назначить этих доверенных пользователей роли администраторов.</span><span class="sxs-lookup"><span data-stu-id="ff34c-117">With roles, however, we could create a role called Administrators and assign those trusted users to the Administrators role.</span></span> <span data-ttu-id="ff34c-118">Далее мы добавим соответствующие правила авторизации URL-адреса, декларативную разметку и код, чтобы позволить роли администраторов выполнять различные задачи администрирования.</span><span class="sxs-lookup"><span data-stu-id="ff34c-118">Next, we would add the appropriate URL authorization rules, declarative markup, and code to allow the Administrators role to perform the various administrative tasks.</span></span> <span data-ttu-id="ff34c-119">При такой инфраструктуре Добавление новых администраторов на сайт или удаление существующих пользователей сводится к включению или удалению пользователя из роли "Администраторы".</span><span class="sxs-lookup"><span data-stu-id="ff34c-119">With this infrastructure in place, adding new administrators to the site or removing existing ones is as simple as including or removing the user from the Administrators role.</span></span> <span data-ttu-id="ff34c-120">Настройка, декларативная разметка или изменение кода не требуются.</span><span class="sxs-lookup"><span data-stu-id="ff34c-120">No configuration, declarative markup, or code changes are necessary.</span></span>

<span data-ttu-id="ff34c-121">ASP.NET предлагает платформу ролей для определения ролей и связывания их с учетными записями пользователей.</span><span class="sxs-lookup"><span data-stu-id="ff34c-121">ASP.NET offers a Roles framework for defining roles and associating them with user accounts.</span></span> <span data-ttu-id="ff34c-122">Платформа ролей позволяет создавать и удалять роли, добавлять пользователей или удалять пользователей из роли, определять набор пользователей, принадлежащих к определенной роли, и сообщать, относится ли пользователь к определенной роли.</span><span class="sxs-lookup"><span data-stu-id="ff34c-122">With the Roles framework we can create and delete roles, add users to or remove users from a role, determine the set of users that belong to a particular role, and tell whether a user belongs to a particular role.</span></span> <span data-ttu-id="ff34c-123">После настройки платформы ролей можно ограничить доступ к страницам на уровне ролей с помощью правил авторизации URL-адресов, а также показать или скрыть дополнительные сведения или функциональные возможности на странице на основе ролей текущего пользователя, вошедшего в систему.</span><span class="sxs-lookup"><span data-stu-id="ff34c-123">Once the Roles framework has been configured, we can limit access to pages on a role-by-role basis through URL authorization rules and show or hide additional information or functionality on a page based on the currently logged on user's roles.</span></span>

<span data-ttu-id="ff34c-124">В этом руководстве рассматриваются шаги, необходимые для настройки платформы ролей.</span><span class="sxs-lookup"><span data-stu-id="ff34c-124">This tutorial examines the steps necessary for configuring the Roles framework.</span></span> <span data-ttu-id="ff34c-125">После этого мы будем создавать веб-страницы для создания и удаления ролей.</span><span class="sxs-lookup"><span data-stu-id="ff34c-125">Following that, we will build web pages to create and delete roles.</span></span> <span data-ttu-id="ff34c-126"><a id="_msoanchor_2"> </a>В учебнике [*назначение ролей для пользователей*](assigning-roles-to-users-vb.md) мы рассмотрим, как добавлять и удалять пользователей из ролей.</span><span class="sxs-lookup"><span data-stu-id="ff34c-126">In the <a id="_msoanchor_2"></a>[*Assigning Roles to Users*](assigning-roles-to-users-vb.md) tutorial we will look at how to add and remove users from roles.</span></span> <span data-ttu-id="ff34c-127">А в учебнике по <a id="_msoanchor_3"> </a> [*авторизации на основе ролей*](role-based-authorization-vb.md) мы поможем увидеть, как ограничить доступ к страницам на основе ролей, а также как настроить функциональность страницы в зависимости от роли пользователя.</span><span class="sxs-lookup"><span data-stu-id="ff34c-127">And in the <a id="_msoanchor_3"></a>[*Role-Based Authorization*](role-based-authorization-vb.md) tutorial we will see how to limit access to pages on a role-by-role basis along with how to adjust page functionality depending on the visiting user's role.</span></span> <span data-ttu-id="ff34c-128">Приступим к работе!</span><span class="sxs-lookup"><span data-stu-id="ff34c-128">Let's get started!</span></span>

## <a name="step-1-adding-new-aspnet-pages"></a><span data-ttu-id="ff34c-129">Шаг 1. Добавление новых страниц ASP.NET</span><span class="sxs-lookup"><span data-stu-id="ff34c-129">Step 1: Adding New ASP.NET Pages</span></span>

<span data-ttu-id="ff34c-130">В этом руководстве и следующих двух мы будем изучать различные функции и возможности, связанные с ролями.</span><span class="sxs-lookup"><span data-stu-id="ff34c-130">In this tutorial and the next two we will be examining various roles-related functions and capabilities.</span></span> <span data-ttu-id="ff34c-131">Для реализации разделов, которые были проверены в рамках этих руководств, потребуется серия ASP.NET страниц.</span><span class="sxs-lookup"><span data-stu-id="ff34c-131">We will need a series of ASP.NET pages to implement the topics examined throughout these tutorials.</span></span> <span data-ttu-id="ff34c-132">Давайте создадим эти страницы и обновляем карту узла.</span><span class="sxs-lookup"><span data-stu-id="ff34c-132">Let's create these pages and update the site map.</span></span>

<span data-ttu-id="ff34c-133">Начните с создания новой папки в проекте с именем `Roles`.</span><span class="sxs-lookup"><span data-stu-id="ff34c-133">Start by creating a new folder in the project named `Roles`.</span></span> <span data-ttu-id="ff34c-134">Затем добавьте четыре новые страницы ASP.NET в папку `Roles`, связав каждую страницу с главной страницей `Site.master`.</span><span class="sxs-lookup"><span data-stu-id="ff34c-134">Next, add four new ASP.NET pages to the `Roles` folder, linking each page with the `Site.master` master page.</span></span> <span data-ttu-id="ff34c-135">Назовите страницы:</span><span class="sxs-lookup"><span data-stu-id="ff34c-135">Name the pages:</span></span>

- `ManageRoles.aspx`
- `UsersAndRoles.aspx`
- `CreateUserWizardWithRoles.aspx`
- `RoleBasedAuthorization.aspx`

<span data-ttu-id="ff34c-136">На этом этапе обозреватель решений проекта должны выглядеть примерно так, как показано на снимке экрана, показанном на рис. 1.</span><span class="sxs-lookup"><span data-stu-id="ff34c-136">At this point your project's Solution Explorer should look similar to the screen shot shown in Figure 1.</span></span>

<span data-ttu-id="ff34c-137">[в папку Roles Добавлено ![четыре новые страницы](creating-and-managing-roles-vb/_static/image2.png)](creating-and-managing-roles-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="ff34c-137">[![Four New Pages Have Been Added to the Roles Folder](creating-and-managing-roles-vb/_static/image2.png)](creating-and-managing-roles-vb/_static/image1.png)</span></span>

<span data-ttu-id="ff34c-138">**Рис. 1**. в папку `Roles` добавлены четыре новые страницы ([щелкните, чтобы просмотреть изображение с полным размером](creating-and-managing-roles-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="ff34c-138">**Figure 1**: Four New Pages Have Been Added to the `Roles` Folder  ([Click to view full-size image](creating-and-managing-roles-vb/_static/image3.png))</span></span>

<span data-ttu-id="ff34c-139">На этом этапе на каждой странице должно быть два элемента управления содержимым — по одному для каждой элементов управления ContentPlaceHolder главной страницы: `MainContent` и `LoginContent`.</span><span class="sxs-lookup"><span data-stu-id="ff34c-139">Each page should, at this point, have the two Content controls, one for each of the master page's ContentPlaceHolders: `MainContent` and `LoginContent`.</span></span>

[!code-aspx[Main](creating-and-managing-roles-vb/samples/sample1.aspx)]

<span data-ttu-id="ff34c-140">Помните, что разметка `LoginContent` ContentPlaceHolder по умолчанию отображает ссылку на вход или выход из системы сайта в зависимости от того, прошел ли пользователь проверку подлинности.</span><span class="sxs-lookup"><span data-stu-id="ff34c-140">Recall that the `LoginContent` ContentPlaceHolder's default markup displays a link to log on or log off the site, depending on whether the user is authenticated.</span></span> <span data-ttu-id="ff34c-141">Однако присутствие `Content2`ного элемента управления содержимым на странице ASP.NET переопределяет разметку по умолчанию главной страницы.</span><span class="sxs-lookup"><span data-stu-id="ff34c-141">The presence of the `Content2` Content control in the ASP.NET page, however, overrides the master page's default markup.</span></span> <span data-ttu-id="ff34c-142">Как обсуждалось в <a id="_msoanchor_4"> </a> [*обзоре учебника по проверке подлинности*](../introduction/an-overview-of-forms-authentication-vb.md) с помощью форм, Переопределение разметки по умолчанию полезно на страницах, где не требуется отображать параметры, связанные с именем входа, в левом столбце.</span><span class="sxs-lookup"><span data-stu-id="ff34c-142">As we discussed in <a id="_msoanchor_4"></a>[*An Overview of Forms Authentication*](../introduction/an-overview-of-forms-authentication-vb.md) tutorial, overriding the default markup is useful in pages where we do not want to display login-related options in the left column.</span></span>

<span data-ttu-id="ff34c-143">Однако для этих четырех страниц необходимо отобразить разметку главной страницы по умолчанию для `LoginContent` ContentPlaceHolder.</span><span class="sxs-lookup"><span data-stu-id="ff34c-143">For these four pages, however, we want to show the master page's default markup for the `LoginContent` ContentPlaceHolder.</span></span> <span data-ttu-id="ff34c-144">Поэтому удалите декларативную разметку для элемента управления содержимым `Content2`.</span><span class="sxs-lookup"><span data-stu-id="ff34c-144">Therefore, remove the declarative markup for the `Content2` Content control.</span></span> <span data-ttu-id="ff34c-145">После этого каждая из разметки каждой из четырех страниц должна содержать только один элемент управления содержимым.</span><span class="sxs-lookup"><span data-stu-id="ff34c-145">After doing so, each of the four page's markup should contain just one Content control.</span></span>

<span data-ttu-id="ff34c-146">Наконец, обновите карту узла (`Web.sitemap`), чтобы включить эти новые веб-страницы.</span><span class="sxs-lookup"><span data-stu-id="ff34c-146">Finally, let's update the site map (`Web.sitemap`) to include these new web pages.</span></span> <span data-ttu-id="ff34c-147">Добавьте следующий XML-код после `<siteMapNode>`, добавленного в учебники по членству.</span><span class="sxs-lookup"><span data-stu-id="ff34c-147">Add the following XML after the `<siteMapNode>` we added for the Membership tutorials.</span></span>

[!code-xml[Main](creating-and-managing-roles-vb/samples/sample2.xml)]

<span data-ttu-id="ff34c-148">Обновив карту узла, перейдите на сайт через браузер.</span><span class="sxs-lookup"><span data-stu-id="ff34c-148">With the site map updated, visit the site through a browser.</span></span> <span data-ttu-id="ff34c-149">Как показано на рис. 2, Навигация в левой части теперь включает элементы для учебника по ролям.</span><span class="sxs-lookup"><span data-stu-id="ff34c-149">As Figure 2 shows, the navigation on the left now includes items for the Roles tutorials.</span></span>

<span data-ttu-id="ff34c-150">[в папку Roles Добавлено ![четыре новые страницы](creating-and-managing-roles-vb/_static/image5.png)](creating-and-managing-roles-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="ff34c-150">[![Four New Pages Have Been Added to the Roles Folder](creating-and-managing-roles-vb/_static/image5.png)](creating-and-managing-roles-vb/_static/image4.png)</span></span>

<span data-ttu-id="ff34c-151">**Рис. 2**. в папку `Roles` добавлены четыре новые страницы ([щелкните, чтобы просмотреть изображение с полным размером](creating-and-managing-roles-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="ff34c-151">**Figure 2**: Four New Pages Have Been Added to the `Roles` Folder  ([Click to view full-size image](creating-and-managing-roles-vb/_static/image6.png))</span></span>

## <a name="step-2-specifying-and-configuring-the-roles-framework-provider"></a><span data-ttu-id="ff34c-152">Шаг 2. Указание и настройка поставщика инфраструктуры ролей</span><span class="sxs-lookup"><span data-stu-id="ff34c-152">Step 2: Specifying and Configuring the Roles Framework Provider</span></span>

<span data-ttu-id="ff34c-153">Как и в случае с инфраструктурой членства, инфраструктура ролей строится на основе модели поставщика.</span><span class="sxs-lookup"><span data-stu-id="ff34c-153">Like the Membership framework, the Roles framework is built atop the provider model.</span></span> <span data-ttu-id="ff34c-154">Как <a id="_msoanchor_5"> </a>описано в учебнике [*основы безопасности и поддержка ASP.NET*](../introduction/security-basics-and-asp-net-support-vb.md) , .NET Framework поставляется с тремя встроенными поставщиками ролей: [`AuthorizationStoreRoleProvider`](https://msdn.microsoft.com/library/system.web.security.authorizationstoreroleprovider.aspx), [`WindowsTokenRoleProvider`](https://msdn.microsoft.com/library/system.web.security.windowstokenroleprovider.aspx)и [`SqlRoleProvider`](https://msdn.microsoft.com/library/system.web.security.sqlroleprovider.aspx).</span><span class="sxs-lookup"><span data-stu-id="ff34c-154">As discussed in the <a id="_msoanchor_5"></a>[*Security Basics and ASP.NET Support*](../introduction/security-basics-and-asp-net-support-vb.md) tutorial, the .NET Framework ships with three built-in Roles providers: [`AuthorizationStoreRoleProvider`](https://msdn.microsoft.com/library/system.web.security.authorizationstoreroleprovider.aspx), [`WindowsTokenRoleProvider`](https://msdn.microsoft.com/library/system.web.security.windowstokenroleprovider.aspx), and [`SqlRoleProvider`](https://msdn.microsoft.com/library/system.web.security.sqlroleprovider.aspx).</span></span> <span data-ttu-id="ff34c-155">В этой серии руководств основное внимание уделяется `SqlRoleProvider`, в которой в качестве хранилища ролей используется база данных Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="ff34c-155">This tutorial series focuses on the `SqlRoleProvider`, which uses a Microsoft SQL Server database as the role store.</span></span>

<span data-ttu-id="ff34c-156">В ней рассматриваются платформа ролей и `SqlRoleProvider` работают точно так же, как и инфраструктура членства и `SqlMembershipProvider`.</span><span class="sxs-lookup"><span data-stu-id="ff34c-156">Underneath the covers the Roles framework and `SqlRoleProvider` work just like the Membership framework and `SqlMembershipProvider`.</span></span> <span data-ttu-id="ff34c-157">.NET Framework содержит класс `Roles`, который служит в качестве API для платформы ролей.</span><span class="sxs-lookup"><span data-stu-id="ff34c-157">The .NET Framework contains a `Roles` class that serves as the API to the Roles framework.</span></span> <span data-ttu-id="ff34c-158">Класс `Roles` имеет общие методы, такие как `CreateRole`, `DeleteRole`, `GetAllRoles`, `AddUserToRole`, `IsUserInRole`и т. д.</span><span class="sxs-lookup"><span data-stu-id="ff34c-158">The `Roles` class has shared methods like `CreateRole`, `DeleteRole`, `GetAllRoles`, `AddUserToRole`, `IsUserInRole`, and so forth.</span></span> <span data-ttu-id="ff34c-159">При вызове одного из этих методов класс `Roles` делегирует вызов настроенному поставщику.</span><span class="sxs-lookup"><span data-stu-id="ff34c-159">When one of these methods is invoked, the `Roles` class delegates the call to the configured provider.</span></span> <span data-ttu-id="ff34c-160">`SqlRoleProvider` работает с таблицами, зависящими от роли (`aspnet_Roles` и `aspnet_UsersInRoles`) в ответе.</span><span class="sxs-lookup"><span data-stu-id="ff34c-160">The `SqlRoleProvider` works with the role-specific tables (`aspnet_Roles` and `aspnet_UsersInRoles`) in response.</span></span>

<span data-ttu-id="ff34c-161">Чтобы использовать поставщик `SqlRoleProvider` в нашем приложении, необходимо указать базу данных, которая будет использоваться в качестве хранилища.</span><span class="sxs-lookup"><span data-stu-id="ff34c-161">In order to use the `SqlRoleProvider` provider in our application, we need to specify what database to use as the store.</span></span> <span data-ttu-id="ff34c-162">`SqlRoleProvider` требуется, чтобы в указанном хранилище ролей имелись определенные таблицы, представления и хранимые процедуры базы данных.</span><span class="sxs-lookup"><span data-stu-id="ff34c-162">The `SqlRoleProvider` expects the specified role store to have certain database tables, views, and stored procedures.</span></span> <span data-ttu-id="ff34c-163">Эти необходимые объекты базы данных можно добавить с помощью [средства`aspnet_regsql.exe`](https://msdn.microsoft.com/library/ms229862.aspx).</span><span class="sxs-lookup"><span data-stu-id="ff34c-163">These requisite database objects can be added using the [`aspnet_regsql.exe` tool](https://msdn.microsoft.com/library/ms229862.aspx).</span></span> <span data-ttu-id="ff34c-164">На этом этапе у нас уже есть база данных с схемой, необходимой для `SqlRoleProvider`.</span><span class="sxs-lookup"><span data-stu-id="ff34c-164">At this point we already have a database with the schema necessary for the `SqlRoleProvider`.</span></span> <span data-ttu-id="ff34c-165"><a id="_msoanchor_6"> </a>В SQL Server руководстве по [*созданию схемы членства*](../membership/creating-the-membership-schema-in-sql-server-vb.md) мы создали базу данных с именем `SecurityTutorials.mdf` и использовали `aspnet_regsql.exe`, чтобы добавить службы приложений, которые включали объекты базы данных, необходимые для `SqlRoleProvider`.</span><span class="sxs-lookup"><span data-stu-id="ff34c-165">Back in the <a id="_msoanchor_6"></a>[*Creating the Membership Schema in SQL Server*](../membership/creating-the-membership-schema-in-sql-server-vb.md) tutorial we created a database named `SecurityTutorials.mdf` and used `aspnet_regsql.exe` to add the application services, which included the database objects required by the `SqlRoleProvider`.</span></span> <span data-ttu-id="ff34c-166">Поэтому нам нужно сообщить платформе Roles, что необходимо включить поддержку ролей и использовать `SqlRoleProvider` с базой данных `SecurityTutorials.mdf` в качестве хранилища ролей.</span><span class="sxs-lookup"><span data-stu-id="ff34c-166">Therefore we just need to tell the Roles framework to enable role support and to use the `SqlRoleProvider` with the `SecurityTutorials.mdf` database as the role store.</span></span>

<span data-ttu-id="ff34c-167">Платформа ролей настраивается с помощью элемента `<roleManager>` в файле `Web.config` приложения.</span><span class="sxs-lookup"><span data-stu-id="ff34c-167">The Roles framework is configured via the `<roleManager>` element in the application's `Web.config` file.</span></span> <span data-ttu-id="ff34c-168">По умолчанию поддержка ролей отключена.</span><span class="sxs-lookup"><span data-stu-id="ff34c-168">By default, role support is disabled.</span></span> <span data-ttu-id="ff34c-169">Чтобы включить его, необходимо задать атрибуту `enabled` элемента [`<roleManager>`](https://msdn.microsoft.com/library/ms164660.aspx) значение `true` следующим образом:</span><span class="sxs-lookup"><span data-stu-id="ff34c-169">To enable it, you must set the [`<roleManager>`](https://msdn.microsoft.com/library/ms164660.aspx) element's `enabled` attribute to `true` like so:</span></span>

[!code-xml[Main](creating-and-managing-roles-vb/samples/sample3.xml)]

<span data-ttu-id="ff34c-170">По умолчанию у всех веб-приложений есть поставщик ролей с именем `AspNetSqlRoleProvider` типа `SqlRoleProvider`.</span><span class="sxs-lookup"><span data-stu-id="ff34c-170">By default, all web applications have a Roles provider named `AspNetSqlRoleProvider` of type `SqlRoleProvider`.</span></span> <span data-ttu-id="ff34c-171">Этот поставщик по умолчанию регистрируется в `machine.config` (находится в `%WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG`):</span><span class="sxs-lookup"><span data-stu-id="ff34c-171">This default provider is registered in `machine.config` (located at `%WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG`):</span></span>

[!code-xml[Main](creating-and-managing-roles-vb/samples/sample4.xml)]

<span data-ttu-id="ff34c-172">Атрибут `connectionStringName` поставщика указывает используемое хранилище ролей.</span><span class="sxs-lookup"><span data-stu-id="ff34c-172">The provider's `connectionStringName` attribute specifies the role store that is used.</span></span> <span data-ttu-id="ff34c-173">Поставщик `AspNetSqlRoleProvider` присваивает этому атрибуту значение `LocalSqlServer`, которое также определено в `machine.config` и указывает по умолчанию на базу данных SQL Server 2005, экспресс-выпуск в папке `App_Data` с именем `aspnet.mdf`.</span><span class="sxs-lookup"><span data-stu-id="ff34c-173">The `AspNetSqlRoleProvider` provider sets this attribute to `LocalSqlServer`, which is also defined in `machine.config` and points, by default, to a SQL Server 2005 Express Edition database in the `App_Data` folder named `aspnet.mdf`.</span></span>

<span data-ttu-id="ff34c-174">Следовательно, если мы просто включили платформу Roles без указания каких бы то ни было сведений о поставщике в файле `Web.config` приложения, приложение использует зарегистрированный поставщик ролей по умолчанию, `AspNetSqlRoleProvider`.</span><span class="sxs-lookup"><span data-stu-id="ff34c-174">Consequently, if we simply enable the Roles framework without specifying any provider information in our application's `Web.config` file, the application uses the default registered Roles provider, `AspNetSqlRoleProvider`.</span></span> <span data-ttu-id="ff34c-175">Если `~/App_Data/aspnet.mdf` базы данных не существует, среда выполнения ASP.NET автоматически создаст ее и добавит схему служб приложений.</span><span class="sxs-lookup"><span data-stu-id="ff34c-175">If the `~/App_Data/aspnet.mdf` database does not exist, the ASP.NET runtime will automatically create it and add the application services schema.</span></span> <span data-ttu-id="ff34c-176">Однако мы не хотим использовать базу данных `aspnet.mdf`. Вместо этого мы хотим использовать базу данных `SecurityTutorials.mdf`, которая уже создана и добавила схему служб приложений в.</span><span class="sxs-lookup"><span data-stu-id="ff34c-176">However, we don't want to use the `aspnet.mdf` database; rather, we want to use the `SecurityTutorials.mdf` database that we have already created and added the application services schema to.</span></span> <span data-ttu-id="ff34c-177">Это изменение можно выполнить одним из двух способов:</span><span class="sxs-lookup"><span data-stu-id="ff34c-177">This modification can be accomplished in one of two ways:</span></span>

- <span data-ttu-id="ff34c-178"><strong>Укажите значение</strong> <strong>`LocalSqlServer`</strong> <strong>имя строки подключения в</strong> <strong>`Web.config`</strong> <strong>.</strong></span><span class="sxs-lookup"><span data-stu-id="ff34c-178"><strong>Specify a value for the</strong><strong>`LocalSqlServer`</strong><strong>connection string name in</strong><strong>`Web.config`</strong><strong>.</strong></span></span> <span data-ttu-id="ff34c-179">Перезаписав значение имени строки подключения `LocalSqlServer` в `Web.config`, можно использовать поставщик зарегистрированных ролей по умолчанию (`AspNetSqlRoleProvider`) и правильно работать с базой данных `SecurityTutorials.mdf`.</span><span class="sxs-lookup"><span data-stu-id="ff34c-179">By overwriting the `LocalSqlServer` connection string name value in `Web.config`, we can use the default registered Roles provider (`AspNetSqlRoleProvider`) and have it correctly work with the `SecurityTutorials.mdf` database.</span></span> <span data-ttu-id="ff34c-180">Дополнительные сведения об этом методе см. в записи блога [Скотта Гатри (](https://weblogs.asp.net/scottgu/), [которая настраивает ASP.NET 2,0 Службы приложений для использования SQL Server 2000 или SQL Server 2005](https://weblogs.asp.net/scottgu/archive/2005/08/25/423703.aspx).</span><span class="sxs-lookup"><span data-stu-id="ff34c-180">For more information on this technique, see [Scott Guthrie](https://weblogs.asp.net/scottgu/)'s blog post, [Configuring ASP.NET 2.0 Application Services to Use SQL Server 2000 or SQL Server 2005](https://weblogs.asp.net/scottgu/archive/2005/08/25/423703.aspx).</span></span>
- <span data-ttu-id="ff34c-181"><strong>Добавьте новый зарегистрированный поставщик типа</strong> <strong>`SqlRoleProvider`</strong> <strong>и настройте его</strong> параметры<strong>`connectionStringName`</strong>, <strong>чтобы она указывала</strong> на <strong>базу данных</strong> <strong>`SecurityTutorials.mdf`</strong>.</span><span class="sxs-lookup"><span data-stu-id="ff34c-181"><strong>Add a new registered provider of type</strong><strong>`SqlRoleProvider`</strong><strong>and configure its</strong><strong>`connectionStringName`</strong><strong>setting to point to the</strong><strong>`SecurityTutorials.mdf`</strong><strong>database.</strong></span></span> <span data-ttu-id="ff34c-182">Это подход, который я рекомендовал и использовал в <a id="_msoanchor_7"> </a> [*создании схемы членства в SQL Server*](../membership/creating-the-membership-schema-in-sql-server-vb.md) руководстве, и этот подход также будет использоваться в этом учебнике.</span><span class="sxs-lookup"><span data-stu-id="ff34c-182">This is the approach I recommended and used in the <a id="_msoanchor_7"></a>[*Creating the Membership Schema in SQL Server*](../membership/creating-the-membership-schema-in-sql-server-vb.md) tutorial, and it is the approach I will use in this tutorial as well.</span></span>

<span data-ttu-id="ff34c-183">Добавьте следующую разметку конфигурации ролей в файл `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="ff34c-183">Add the following Roles configuration markup to the `Web.config` file.</span></span> <span data-ttu-id="ff34c-184">Эта разметка регистрирует нового поставщика с именем `SecurityTutorialsSqlRoleProvider.`</span><span class="sxs-lookup"><span data-stu-id="ff34c-184">This markup registers a new provider named `SecurityTutorialsSqlRoleProvider.`</span></span>

[!code-xml[Main](creating-and-managing-roles-vb/samples/sample5.xml)]

<span data-ttu-id="ff34c-185">Приведенная выше разметка определяет `SecurityTutorialsSqlRoleProvider` как поставщик по умолчанию (через атрибут `defaultProvider` в элементе `<roleManager>`).</span><span class="sxs-lookup"><span data-stu-id="ff34c-185">The above markup defines the `SecurityTutorialsSqlRoleProvider` as the default provider (via the `defaultProvider` attribute in the `<roleManager>` element).</span></span> <span data-ttu-id="ff34c-186">Он также задает для параметра `applicationName` `SecurityTutorialsSqlRoleProvider`значение `SecurityTutorials`, которое соответствует параметру `applicationName`, используемому поставщиком членства (`SecurityTutorialsSqlMembershipProvider`).</span><span class="sxs-lookup"><span data-stu-id="ff34c-186">It also sets the `SecurityTutorialsSqlRoleProvider`'s `applicationName` setting to `SecurityTutorials`, which is the same `applicationName` setting used by the Membership provider (`SecurityTutorialsSqlMembershipProvider`).</span></span> <span data-ttu-id="ff34c-187">Хотя это не показано здесь, [элемент`<add>`](https://msdn.microsoft.com/library/ms164662.aspx) для `SqlRoleProvider` может также содержать атрибут `commandTimeout` для указания времени ожидания базы данных в секундах.</span><span class="sxs-lookup"><span data-stu-id="ff34c-187">While not shown here, the [`<add>` element](https://msdn.microsoft.com/library/ms164662.aspx) for the `SqlRoleProvider` may also contain a `commandTimeout` attribute to specify the database timeout duration, in seconds.</span></span> <span data-ttu-id="ff34c-188">Значение по умолчанию — 30.</span><span class="sxs-lookup"><span data-stu-id="ff34c-188">The default value is 30.</span></span>

<span data-ttu-id="ff34c-189">С этой разметкой конфигурации мы готовы приступить к использованию функций ролей в нашем приложении.</span><span class="sxs-lookup"><span data-stu-id="ff34c-189">With this configuration markup in place, we are ready to start using role functionality within our application.</span></span>

> [!NOTE]
> <span data-ttu-id="ff34c-190">Приведенная выше разметка конфигурации иллюстрирует использование атрибутов `enabled` и `defaultProvider` элемента `<roleManager>`.</span><span class="sxs-lookup"><span data-stu-id="ff34c-190">The above configuration markup illustrates using the `<roleManager>` element's `enabled` and `defaultProvider` attributes.</span></span> <span data-ttu-id="ff34c-191">Существует ряд других атрибутов, влияющих на то, как инфраструктура ролей связывает сведения о ролях на уровне пользователя.</span><span class="sxs-lookup"><span data-stu-id="ff34c-191">There are a number of other attributes that affect how the Roles framework associates role information on a user-by-user basis.</span></span> <span data-ttu-id="ff34c-192">Эти параметры будут рассмотрены в учебнике по <a id="_msoanchor_8"> </a> [*авторизации на основе ролей*](role-based-authorization-vb.md) .</span><span class="sxs-lookup"><span data-stu-id="ff34c-192">We will examine these settings in the <a id="_msoanchor_8"></a>[*Role-Based Authorization*](role-based-authorization-vb.md) tutorial.</span></span>

## <a name="step-3-examining-the-roles-api"></a><span data-ttu-id="ff34c-193">Шаг 3. изучение API ролей</span><span class="sxs-lookup"><span data-stu-id="ff34c-193">Step 3: Examining the Roles API</span></span>

<span data-ttu-id="ff34c-194">Функциональность инфраструктуры ролей предоставляется через [класс`Roles`](https://msdn.microsoft.com/library/system.web.security.roles.aspx), который содержит общие методы тринадцать для выполнения операций на основе ролей.</span><span class="sxs-lookup"><span data-stu-id="ff34c-194">The Roles framework's functionality is exposed via the [`Roles` class](https://msdn.microsoft.com/library/system.web.security.roles.aspx), which contains thirteen shared methods for performing role-based operations.</span></span> <span data-ttu-id="ff34c-195">Когда мы рассмотрим создание и удаление ролей в шагах 4 и 6, мы будем использовать методы [`CreateRole`](https://msdn.microsoft.com/library/system.web.security.roles.createrole.aspx) и [`DeleteRole`](https://msdn.microsoft.com/library/system.web.security.roles.deleterole.aspx) , которые добавляют или удаляют роль из системы.</span><span class="sxs-lookup"><span data-stu-id="ff34c-195">When we look at creating and deleting roles in Steps 4 and 6 we will use the [`CreateRole`](https://msdn.microsoft.com/library/system.web.security.roles.createrole.aspx) and [`DeleteRole`](https://msdn.microsoft.com/library/system.web.security.roles.deleterole.aspx) methods, which add or remove a role from the system.</span></span>

<span data-ttu-id="ff34c-196">Чтобы получить список всех ролей в системе, используйте [метод`GetAllRoles`](https://msdn.microsoft.com/library/system.web.security.roles.getallroles.aspx) (см. шаг 5).</span><span class="sxs-lookup"><span data-stu-id="ff34c-196">To get a list of all of the roles in the system, use the [`GetAllRoles` method](https://msdn.microsoft.com/library/system.web.security.roles.getallroles.aspx) (see Step 5).</span></span> <span data-ttu-id="ff34c-197">[Метод`RoleExists`](https://msdn.microsoft.com/library/system.web.security.roles.roleexists.aspx) возвращает логическое значение, указывающее, существует ли указанная роль.</span><span class="sxs-lookup"><span data-stu-id="ff34c-197">The [`RoleExists` method](https://msdn.microsoft.com/library/system.web.security.roles.roleexists.aspx) returns a Boolean value indicating whether a specified role exists.</span></span>

<span data-ttu-id="ff34c-198">В следующем учебном курсе мы рассмотрим, как связать пользователей с ролями.</span><span class="sxs-lookup"><span data-stu-id="ff34c-198">In the next tutorial we will examine how to associate users with roles.</span></span> <span data-ttu-id="ff34c-199">Методы [`AddUserToRole`](https://msdn.microsoft.com/library/system.web.security.roles.addusertorole.aspx), [`AddUserToRoles`](https://msdn.microsoft.com/library/system.web.security.roles.addusertoroles.aspx), [`AddUsersToRole`](https://msdn.microsoft.com/library/system.web.security.roles.adduserstorole.aspx)и [`AddUsersToRoles`](https://msdn.microsoft.com/library/system.web.security.roles.adduserstoroles.aspx) класса `Roles` добавляют одного или нескольких пользователей к одной или нескольким ролям.</span><span class="sxs-lookup"><span data-stu-id="ff34c-199">The `Roles` class's [`AddUserToRole`](https://msdn.microsoft.com/library/system.web.security.roles.addusertorole.aspx), [`AddUserToRoles`](https://msdn.microsoft.com/library/system.web.security.roles.addusertoroles.aspx), [`AddUsersToRole`](https://msdn.microsoft.com/library/system.web.security.roles.adduserstorole.aspx), and [`AddUsersToRoles`](https://msdn.microsoft.com/library/system.web.security.roles.adduserstoroles.aspx) methods add one or more users to one or more roles.</span></span> <span data-ttu-id="ff34c-200">Чтобы удалить пользователей из ролей, используйте методы [`RemoveUserFromRole`](https://msdn.microsoft.com/library/system.web.security.roles.removeuserfromrole.aspx), [`RemoveUserFromRoles`](https://msdn.microsoft.com/library/system.web.security.roles.removeuserfromroles.aspx), [`RemoveUsersFromRole`](https://msdn.microsoft.com/library/system.web.security.roles.removeusersfromrole.aspx)или [`RemoveUsersFromRoles`](https://msdn.microsoft.com/library/system.web.security.roles.removeusersfromroles.aspx) .</span><span class="sxs-lookup"><span data-stu-id="ff34c-200">To remove users from roles, use the [`RemoveUserFromRole`](https://msdn.microsoft.com/library/system.web.security.roles.removeuserfromrole.aspx), [`RemoveUserFromRoles`](https://msdn.microsoft.com/library/system.web.security.roles.removeuserfromroles.aspx), [`RemoveUsersFromRole`](https://msdn.microsoft.com/library/system.web.security.roles.removeusersfromrole.aspx), or [`RemoveUsersFromRoles`](https://msdn.microsoft.com/library/system.web.security.roles.removeusersfromroles.aspx) methods.</span></span>

<span data-ttu-id="ff34c-201">В учебнике по <a id="_msoanchor_9"> </a> [*авторизации на основе ролей*](role-based-authorization-vb.md) мы рассмотрим способы программного отображения или скрытия функциональных возможностей в зависимости от текущей роли пользователя, вошедшего в систему.</span><span class="sxs-lookup"><span data-stu-id="ff34c-201">In the <a id="_msoanchor_9"></a>[*Role-Based Authorization*](role-based-authorization-vb.md) tutorial we will look at ways to programmatically show or hide functionality based on the currently logged in user's role.</span></span> <span data-ttu-id="ff34c-202">Для этого можно использовать методы [`FindUsersInRole`](https://msdn.microsoft.com/library/system.web.security.roles.findusersinrole.aspx), [`GetRolesForUser`](https://msdn.microsoft.com/library/system.web.security.roles.getrolesforuser.aspx), [`GetUsersInRole`](https://msdn.microsoft.com/library/system.web.security.roles.getusersinrole.aspx)или [`IsUserInRole`](https://msdn.microsoft.com/library/system.web.security.roles.isuserinrole.aspx) класса Role.</span><span class="sxs-lookup"><span data-stu-id="ff34c-202">To accomplish this, we can use the Role class's [`FindUsersInRole`](https://msdn.microsoft.com/library/system.web.security.roles.findusersinrole.aspx), [`GetRolesForUser`](https://msdn.microsoft.com/library/system.web.security.roles.getrolesforuser.aspx), [`GetUsersInRole`](https://msdn.microsoft.com/library/system.web.security.roles.getusersinrole.aspx), or [`IsUserInRole`](https://msdn.microsoft.com/library/system.web.security.roles.isuserinrole.aspx) methods.</span></span>

> [!NOTE]
> <span data-ttu-id="ff34c-203">Помните, что при каждом вызове одного из этих методов класс `Roles` делегирует вызов настроенному поставщику.</span><span class="sxs-lookup"><span data-stu-id="ff34c-203">Keep in mind that any time one of these methods is invoked, the `Roles` class delegates the call to the configured provider.</span></span> <span data-ttu-id="ff34c-204">В нашем случае это означает, что вызов отправляется в `SqlRoleProvider`.</span><span class="sxs-lookup"><span data-stu-id="ff34c-204">In our case, this means that the call is being sent to the `SqlRoleProvider`.</span></span> <span data-ttu-id="ff34c-205">Затем `SqlRoleProvider` выполняет соответствующую операцию с базой данных на основе вызванного метода.</span><span class="sxs-lookup"><span data-stu-id="ff34c-205">The `SqlRoleProvider` then performs the appropriate database operation based on the invoked method.</span></span> <span data-ttu-id="ff34c-206">Например, код `Roles.CreateRole("Administrators")` приводит `SqlRoleProvider` к выполнению хранимой процедуры `aspnet_Roles_CreateRole`, которая вставляет новую запись в таблицу `aspnet_Roles` с именем Administrators.</span><span class="sxs-lookup"><span data-stu-id="ff34c-206">For example, the code `Roles.CreateRole("Administrators")` results in the `SqlRoleProvider` executing the `aspnet_Roles_CreateRole` stored procedure, which inserts a new record into the `aspnet_Roles` table named Administrators .</span></span>

<span data-ttu-id="ff34c-207">В оставшейся части этого руководства рассматривается использование методов `CreateRole`, `GetAllRoles`и `DeleteRole` класса `Roles` для управления ролями в системе.</span><span class="sxs-lookup"><span data-stu-id="ff34c-207">The remainder of this tutorial looks at using the `Roles` class's `CreateRole`, `GetAllRoles`, and `DeleteRole` methods to manage the roles in the system.</span></span>

## <a name="step-4-creating-new-roles"></a><span data-ttu-id="ff34c-208">Шаг 4. Создание новых ролей</span><span class="sxs-lookup"><span data-stu-id="ff34c-208">Step 4: Creating New Roles</span></span>

<span data-ttu-id="ff34c-209">Роли предлагают возможность произвольного группирования пользователей, и чаще всего эта группировка используется для более удобного применения правил авторизации.</span><span class="sxs-lookup"><span data-stu-id="ff34c-209">Roles offer a way to arbitrarily group users, and most commonly this grouping is used for a more convenient way to apply authorization rules.</span></span> <span data-ttu-id="ff34c-210">Но для использования ролей в качестве механизма авторизации сначала необходимо определить, какие роли существуют в приложении.</span><span class="sxs-lookup"><span data-stu-id="ff34c-210">But in order to use roles as an authorization mechanism we first need to define what roles exist in the application.</span></span> <span data-ttu-id="ff34c-211">К сожалению, ASP.NET не включает элемент управления Креатеролевизард.</span><span class="sxs-lookup"><span data-stu-id="ff34c-211">Unfortunately, ASP.NET does not include a CreateRoleWizard control.</span></span> <span data-ttu-id="ff34c-212">Чтобы добавить новые роли, необходимо создать подходящий интерфейс пользователя и самостоятельно вызвать API ролей.</span><span class="sxs-lookup"><span data-stu-id="ff34c-212">In order to add new roles we need to create a suitable user interface and invoke the Roles API ourselves.</span></span> <span data-ttu-id="ff34c-213">Хорошая новость в том, что это очень просто сделать.</span><span class="sxs-lookup"><span data-stu-id="ff34c-213">The good news is that this is very easy to accomplish.</span></span>

> [!NOTE]
> <span data-ttu-id="ff34c-214">Хотя отсутствует веб-элемент управления Креатеролевизард, существует [средство администрирования веб-узла ASP.NET](https://msdn.microsoft.com/library/ms228053.aspx), которое является локальным приложением ASP.NET, предназначенным для облегчения просмотра и управления конфигурацией веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="ff34c-214">While there is no CreateRoleWizard Web control, there is the [ASP.NET Web Site Administration Tool](https://msdn.microsoft.com/library/ms228053.aspx), which is a local ASP.NET application designed to assist with viewing and managing your web application's configuration.</span></span> <span data-ttu-id="ff34c-215">Однако я не являюсь большим вентилятором средства администрирования веб-узла ASP.NET по двум причинам.</span><span class="sxs-lookup"><span data-stu-id="ff34c-215">However, I am not a big fan of the ASP.NET Web Site Administration Tool for two reasons.</span></span> <span data-ttu-id="ff34c-216">Во-первых, это немного ошибками, и взаимодействие с пользователем значительно потребует.</span><span class="sxs-lookup"><span data-stu-id="ff34c-216">First, it is a bit buggy and the user experience leaves a lot to be desired.</span></span> <span data-ttu-id="ff34c-217">Во-вторых, средство администрирования Web site ASP.NET предназначено для работы только локально. Это означает, что вам придется создавать собственные веб-страницы управления ролями, если необходимо удаленно управлять ролями на активном сайте.</span><span class="sxs-lookup"><span data-stu-id="ff34c-217">Second, the ASP.NET Web Site Administration Tool is designed to only work locally, meaning that you will have to build your own role management web pages if you need to manage roles on a live site remotely.</span></span> <span data-ttu-id="ff34c-218">По этим двум причинам это руководство и следующее основное внимание уделяется созданию необходимых средств управления ролями на веб-странице, а не полагаться на средство администрирования веб-узла ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="ff34c-218">For these two reasons, this tutorial and the next will focus on building the necessary role management tools in a web page rather than relying on the ASP.NET Web Site Administration Tool.</span></span>

<span data-ttu-id="ff34c-219">Откройте страницу `ManageRoles.aspx` в папке `Roles` и добавьте на страницу текстовое поле и элемент управления "Кнопка".</span><span class="sxs-lookup"><span data-stu-id="ff34c-219">Open the `ManageRoles.aspx` page in the `Roles` folder and add a TextBox and a Button Web control to the page.</span></span> <span data-ttu-id="ff34c-220">Задайте для свойства `ID` элемента управления TextBox значение `RoleName` и свойства `ID` и `Text` кнопки, чтобы `CreateRoleButton` и создать роль соответственно.</span><span class="sxs-lookup"><span data-stu-id="ff34c-220">Set the TextBox control's `ID` property to `RoleName` and the Button's `ID` and `Text` properties to `CreateRoleButton` and Create Role, respectively.</span></span> <span data-ttu-id="ff34c-221">На этом этапе декларативная разметка страницы должна выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="ff34c-221">At this point, your page's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](creating-and-managing-roles-vb/samples/sample6.aspx)]

<span data-ttu-id="ff34c-222">Затем дважды щелкните элемент управления "`CreateRoleButton`" в конструкторе, чтобы создать `Click` обработчик событий, а затем добавьте следующий код:</span><span class="sxs-lookup"><span data-stu-id="ff34c-222">Next, double-click the `CreateRoleButton` Button control in the Designer to create a `Click` event handler and then add the following code:</span></span>

[!code-vb[Main](creating-and-managing-roles-vb/samples/sample7.vb)]

<span data-ttu-id="ff34c-223">Приведенный выше код начинается с присвоения имени сокращенной роли, указанной в текстовом поле `RoleName`, переменной `newRoleName`.</span><span class="sxs-lookup"><span data-stu-id="ff34c-223">The above code starts by assigning the trimmed role name entered in the `RoleName` TextBox to the `newRoleName` variable.</span></span> <span data-ttu-id="ff34c-224">Затем вызывается метод `RoleExists` класса `Roles`, чтобы определить, существует ли в системе роль, `newRoleName`.</span><span class="sxs-lookup"><span data-stu-id="ff34c-224">Next, the `Roles` class's `RoleExists` method is called to determine if the role `newRoleName` already exists in the system.</span></span> <span data-ttu-id="ff34c-225">Если роль не существует, она создается с помощью вызова метода `CreateRole`.</span><span class="sxs-lookup"><span data-stu-id="ff34c-225">If the role does not exist, it is created via a call to the `CreateRole` method.</span></span> <span data-ttu-id="ff34c-226">Если методу `CreateRole` передается имя роли, которое уже существует в системе, возникает исключение `ProviderException`.</span><span class="sxs-lookup"><span data-stu-id="ff34c-226">If the `CreateRole` method is passed a role name that already exists in the system, a `ProviderException` exception is thrown.</span></span> <span data-ttu-id="ff34c-227">Именно поэтому код сначала проверяет, не существует ли роль в системе перед вызовом `CreateRole`.</span><span class="sxs-lookup"><span data-stu-id="ff34c-227">This is why the code first checks to ensure that the role does not already exist in the system before calling `CreateRole`.</span></span> <span data-ttu-id="ff34c-228">Обработчик событий `Click` завершается путем очистки свойства `Text` текстового поля `RoleName`.</span><span class="sxs-lookup"><span data-stu-id="ff34c-228">The `Click` event handler concludes by clearing out the `RoleName` TextBox's `Text` property.</span></span>

> [!NOTE]
> <span data-ttu-id="ff34c-229">Возможно, вас интересует, что произойдет, если пользователь не введет какое бы то ни было значение в текстовое поле `RoleName`.</span><span class="sxs-lookup"><span data-stu-id="ff34c-229">You may be wondering what will happen if the user doesn't enter any value into the `RoleName` TextBox.</span></span> <span data-ttu-id="ff34c-230">Если значение, передаваемое в метод `CreateRole`, `Nothing` или является пустой строкой, возникает исключение.</span><span class="sxs-lookup"><span data-stu-id="ff34c-230">If the value passed into the `CreateRole` method is `Nothing` or an empty string, an exception is raised.</span></span> <span data-ttu-id="ff34c-231">Аналогично, если имя роли содержит запятую, возникает исключение.</span><span class="sxs-lookup"><span data-stu-id="ff34c-231">Likewise, if the role name contains a comma an exception is raised.</span></span> <span data-ttu-id="ff34c-232">Следовательно, страница должна содержать элементы управления проверки, чтобы убедиться, что пользователь вводит роль и не содержит запятые.</span><span class="sxs-lookup"><span data-stu-id="ff34c-232">Consequently, the page should contain validation controls to ensure that the user enters a role and that it does not contain any commas.</span></span> <span data-ttu-id="ff34c-233">Я оставлю в качестве упражнения для читателя.</span><span class="sxs-lookup"><span data-stu-id="ff34c-233">I leave as an exercise for the reader.</span></span>

<span data-ttu-id="ff34c-234">Давайте создадим роль с именем Администраторы.</span><span class="sxs-lookup"><span data-stu-id="ff34c-234">Let's create a role named Administrators.</span></span> <span data-ttu-id="ff34c-235">Перейдите на страницу `ManageRoles.aspx` в браузере, введите Администраторы в текстовое поле (см. рис. 3), а затем нажмите кнопку Создать роль.</span><span class="sxs-lookup"><span data-stu-id="ff34c-235">Visit the `ManageRoles.aspx` page through a browser, type in Administrators into the textbox (see Figure 3), and then click the Create Role button.</span></span>

<span data-ttu-id="ff34c-236">[![создать роль администраторов](creating-and-managing-roles-vb/_static/image8.png)](creating-and-managing-roles-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="ff34c-236">[![Create an Administrators Role](creating-and-managing-roles-vb/_static/image8.png)](creating-and-managing-roles-vb/_static/image7.png)</span></span>

<span data-ttu-id="ff34c-237">**Рис. 3**. Создание роли администраторов ([щелкните, чтобы просмотреть изображение с полным размером](creating-and-managing-roles-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="ff34c-237">**Figure 3**: Create an Administrators Role  ([Click to view full-size image](creating-and-managing-roles-vb/_static/image9.png))</span></span>

<span data-ttu-id="ff34c-238">Что произойдет?</span><span class="sxs-lookup"><span data-stu-id="ff34c-238">What happens?</span></span> <span data-ttu-id="ff34c-239">Происходит обратная передача, но отсутствует визуальная подсказка о том, что роль на самом деле была добавлена в систему.</span><span class="sxs-lookup"><span data-stu-id="ff34c-239">A postback occurs, but there's no visual cue that the role has actually been added to the system.</span></span> <span data-ttu-id="ff34c-240">Мы будем обновлять эту страницу на шаге 5, чтобы включить визуальную обратную связь.</span><span class="sxs-lookup"><span data-stu-id="ff34c-240">We will update this page in Step 5 to include visual feedback.</span></span> <span data-ttu-id="ff34c-241">Однако теперь можно убедиться, что роль создана, перейдя к базе данных `SecurityTutorials.mdf` и отобразив данные из `aspnet_Roles` таблицы.</span><span class="sxs-lookup"><span data-stu-id="ff34c-241">For now, however, you can verify that the role was created by going to the `SecurityTutorials.mdf` database and displaying the data from the `aspnet_Roles` table.</span></span> <span data-ttu-id="ff34c-242">Как показано на рис. 4, `aspnet_Roles`ная таблица содержит запись для только что добавленных ролей администраторов.</span><span class="sxs-lookup"><span data-stu-id="ff34c-242">As Figure 4 shows, the `aspnet_Roles` table contains a record for the just-added Administrators roles.</span></span>

<span data-ttu-id="ff34c-243">[![aspnet_Roles таблица содержит строку для администраторов](creating-and-managing-roles-vb/_static/image11.png)](creating-and-managing-roles-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="ff34c-243">[![The aspnet_Roles Table has a Row for the Administrators](creating-and-managing-roles-vb/_static/image11.png)](creating-and-managing-roles-vb/_static/image10.png)</span></span>

<span data-ttu-id="ff34c-244">**Рис. 4**. `aspnet_Roles`ная таблица содержит строку для администраторов ([щелкните, чтобы просмотреть изображение с полным размером](creating-and-managing-roles-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="ff34c-244">**Figure 4**: The `aspnet_Roles` Table has a Row for the Administrators  ([Click to view full-size image](creating-and-managing-roles-vb/_static/image12.png))</span></span>

## <a name="step-5-displaying-the-roles-in-the-system"></a><span data-ttu-id="ff34c-245">Шаг 5. отображение ролей в системе</span><span class="sxs-lookup"><span data-stu-id="ff34c-245">Step 5: Displaying the Roles in the System</span></span>

<span data-ttu-id="ff34c-246">Добавим `ManageRoles.aspx` страницу, чтобы включить список текущих ролей в системе.</span><span class="sxs-lookup"><span data-stu-id="ff34c-246">Let's augment the `ManageRoles.aspx` page to include a list of the current roles in the system.</span></span> <span data-ttu-id="ff34c-247">Для этого добавьте на страницу элемент управления GridView и задайте для его свойства `ID` значение `RoleList`.</span><span class="sxs-lookup"><span data-stu-id="ff34c-247">To accomplish this, add a GridView control to the page and set its `ID` property to `RoleList`.</span></span> <span data-ttu-id="ff34c-248">Затем добавьте метод в класс кода программной части страницы с именем `DisplayRolesInGrid`, используя следующий код:</span><span class="sxs-lookup"><span data-stu-id="ff34c-248">Next, add a method to the page's code-behind class named `DisplayRolesInGrid` using the following code:</span></span>

[!code-vb[Main](creating-and-managing-roles-vb/samples/sample8.vb)]

<span data-ttu-id="ff34c-249">Метод `GetAllRoles` класса `Roles` возвращает все роли в системе в виде массива строк.</span><span class="sxs-lookup"><span data-stu-id="ff34c-249">The `Roles` class's `GetAllRoles` method returns all of the roles in the system as an array of strings.</span></span> <span data-ttu-id="ff34c-250">Затем этот строковый массив привязывается к GridView.</span><span class="sxs-lookup"><span data-stu-id="ff34c-250">This string array is then bound to the GridView.</span></span> <span data-ttu-id="ff34c-251">Чтобы привязать список ролей к GridView при первой загрузке страницы, необходимо вызвать метод `DisplayRolesInGrid` из обработчика событий `Page_Load` страницы.</span><span class="sxs-lookup"><span data-stu-id="ff34c-251">In order to bind the list of roles to the GridView when the page is first loaded, we need to call the `DisplayRolesInGrid` method from the page's `Page_Load` event handler.</span></span> <span data-ttu-id="ff34c-252">Следующий код вызывает этот метод при первом посещении страницы, но не при последующих обратных передачах.</span><span class="sxs-lookup"><span data-stu-id="ff34c-252">The following code calls this method when the page is first visited, but not on subsequent postbacks.</span></span>

[!code-vb[Main](creating-and-managing-roles-vb/samples/sample9.vb)]

<span data-ttu-id="ff34c-253">Используя этот код, перейдите на страницу в браузере.</span><span class="sxs-lookup"><span data-stu-id="ff34c-253">With this code in place, visit the page through a browser.</span></span> <span data-ttu-id="ff34c-254">Как показано на рис. 5, вы увидите сетку с одним столбцом с меткой элемент.</span><span class="sxs-lookup"><span data-stu-id="ff34c-254">As Figure 5 shows, you should see a grid with a single column labeled Item.</span></span> <span data-ttu-id="ff34c-255">Сетка включает строку для роли администраторов, добавленную на шаге 4.</span><span class="sxs-lookup"><span data-stu-id="ff34c-255">The grid includes a row for the Administrators role we added in Step 4.</span></span>

<span data-ttu-id="ff34c-256">[![GridView отображает роли в одном столбце](creating-and-managing-roles-vb/_static/image14.png)](creating-and-managing-roles-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="ff34c-256">[![The GridView Displays the Roles in a Single Column](creating-and-managing-roles-vb/_static/image14.png)](creating-and-managing-roles-vb/_static/image13.png)</span></span>

<span data-ttu-id="ff34c-257">**Рис. 5**. отображение ролей в элементе управления GridView в одном столбце ([щелкните, чтобы просмотреть изображение с полным размером](creating-and-managing-roles-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="ff34c-257">**Figure 5**: The GridView Displays the Roles in a Single Column  ([Click to view full-size image](creating-and-managing-roles-vb/_static/image15.png))</span></span>

<span data-ttu-id="ff34c-258">Элемент GridView отображает отдельный столбец с меткой Item, так как свойство `AutoGenerateColumns` GridView имеет значение true (значение по умолчанию), которое заставляет GridView автоматически создавать столбец для каждого свойства в его `DataSource`.</span><span class="sxs-lookup"><span data-stu-id="ff34c-258">The GridView displays a lone column labeled Item because the GridView's `AutoGenerateColumns` property is set to True (the default), which causes the GridView to automatically create a column for each property in its `DataSource`.</span></span> <span data-ttu-id="ff34c-259">Массив содержит одно свойство, представляющее элементы массива, следовательно, один столбец в GridView.</span><span class="sxs-lookup"><span data-stu-id="ff34c-259">An array has a single property that represents the elements in the array, hence the single column in the GridView.</span></span>

<span data-ttu-id="ff34c-260">При отображении данных с помощью GridView я предпочитаю явно определять мои столбцы, а не создавать их неявно с помощью GridView.</span><span class="sxs-lookup"><span data-stu-id="ff34c-260">When displaying data with a GridView, I prefer to explicitly define my columns rather than have them implicitly generated by the GridView.</span></span> <span data-ttu-id="ff34c-261">Путем явного определения столбцов гораздо проще форматировать данные, переупорядочивать столбцы и выполнять другие стандартные задачи.</span><span class="sxs-lookup"><span data-stu-id="ff34c-261">By explicitly defining the columns it is much easier to format the data, rearrange the columns, and perform other common tasks.</span></span> <span data-ttu-id="ff34c-262">Таким образом, давайте изменим декларативную разметку GridView так, чтобы ее столбцы были явно определены.</span><span class="sxs-lookup"><span data-stu-id="ff34c-262">Therefore, let's update the GridView's declarative markup so that its columns are explicitly defined.</span></span>

<span data-ttu-id="ff34c-263">Начните с установки свойства `AutoGenerateColumns` GridView в значение false.</span><span class="sxs-lookup"><span data-stu-id="ff34c-263">Start by setting the GridView's `AutoGenerateColumns` property to False.</span></span> <span data-ttu-id="ff34c-264">Затем добавьте TemplateField в сетку, задайте для свойства `HeaderText` значение Roles и настройте его `ItemTemplate` таким образом, чтобы он отображал содержимое массива.</span><span class="sxs-lookup"><span data-stu-id="ff34c-264">Next, add a TemplateField to the grid, set its `HeaderText` property to Roles, and configure its `ItemTemplate` so that it displays the contents of the array.</span></span> <span data-ttu-id="ff34c-265">Для этого добавьте в `ItemTemplate` веб-элемент управления Label с именем `RoleNameLabel` и привяжите его свойство `Text` к `Container.DataItem.`</span><span class="sxs-lookup"><span data-stu-id="ff34c-265">To accomplish this, add a Label Web control named `RoleNameLabel` to the `ItemTemplate` and bind its `Text` property to `Container.DataItem.`</span></span>

<span data-ttu-id="ff34c-266">Эти свойства и содержимое `ItemTemplate`можно задать декларативно или с помощью диалогового окна поля GridView и интерфейса редактирования шаблонов.</span><span class="sxs-lookup"><span data-stu-id="ff34c-266">These properties and the `ItemTemplate`'s contents can be set declaratively or through the GridView's Fields dialog box and Edit Templates interface.</span></span> <span data-ttu-id="ff34c-267">Чтобы открыть диалоговое окно "поля", щелкните ссылку изменить столбцы в смарт-теге GridView.</span><span class="sxs-lookup"><span data-stu-id="ff34c-267">To reach the Fields dialog box, click the Edit Columns link in the GridView's Smart Tag.</span></span> <span data-ttu-id="ff34c-268">Затем снимите флажок автоматически создавать поля, чтобы присвоить свойству `AutoGenerateColumns` значение false, и добавьте TemplateField в GridView, установив для свойства `HeaderText` значение Role.</span><span class="sxs-lookup"><span data-stu-id="ff34c-268">Next, uncheck the Auto-generate fields checkbox to set the `AutoGenerateColumns` property to False, and add a TemplateField to the GridView, setting its `HeaderText` property to Role.</span></span> <span data-ttu-id="ff34c-269">Чтобы определить содержимое `ItemTemplate`, выберите параметр изменить шаблоны в смарт-теге GridView.</span><span class="sxs-lookup"><span data-stu-id="ff34c-269">To define the `ItemTemplate`'s contents, choose the Edit Templates option from the GridView's Smart Tag.</span></span> <span data-ttu-id="ff34c-270">Перетащите элемент управления Label на `ItemTemplate`, задайте для его свойства `ID` значение `RoleNameLabel`и настройте его параметры привязки, чтобы его свойство `Text` было привязано к `Container.DataItem`.</span><span class="sxs-lookup"><span data-stu-id="ff34c-270">Drag a Label Web control onto the `ItemTemplate`, set its `ID` property to `RoleNameLabel`, and configure its databinding settings so that its `Text` property is bound to `Container.DataItem`.</span></span>

<span data-ttu-id="ff34c-271">Независимо от того, какой подход вы используете, полученная декларативная разметка GridView должна выглядеть примерно так, как показано ниже.</span><span class="sxs-lookup"><span data-stu-id="ff34c-271">Regardless of what approach you use, the GridView's resulting declarative markup should look similar to the following when you are done.</span></span>

[!code-aspx[Main](creating-and-managing-roles-vb/samples/sample10.aspx)]

> [!NOTE]
> <span data-ttu-id="ff34c-272">Содержимое массива отображается с помощью синтаксиса DataBinding `<%# Container.DataItem %>`.</span><span class="sxs-lookup"><span data-stu-id="ff34c-272">The array's contents are displayed using the databinding syntax `<%# Container.DataItem %>`.</span></span> <span data-ttu-id="ff34c-273">Подробное описание того, почему этот синтаксис используется при отображении содержимого массива, привязанного к GridView, выходит за рамки данного руководства.</span><span class="sxs-lookup"><span data-stu-id="ff34c-273">A thorough description of why this syntax is used when displaying the contents of an array bound to the GridView is beyond the scope of this tutorial.</span></span> <span data-ttu-id="ff34c-274">Дополнительные сведения об этом важностях см. в статье [Привязка скалярного массива к веб-элементу управления данными](http://aspnet.4guysfromrolla.com/articles/082504-1.aspx).</span><span class="sxs-lookup"><span data-stu-id="ff34c-274">For more information on this matter, refer to [Binding a Scalar Array to a Data Web Control](http://aspnet.4guysfromrolla.com/articles/082504-1.aspx).</span></span>

<span data-ttu-id="ff34c-275">В настоящее время `RoleList` GridView привязывается только к списку ролей при первом посещении страницы.</span><span class="sxs-lookup"><span data-stu-id="ff34c-275">Currently, the `RoleList` GridView is only bound to the list of roles when the page is first visited.</span></span> <span data-ttu-id="ff34c-276">Необходимо обновить сетку при добавлении новой роли.</span><span class="sxs-lookup"><span data-stu-id="ff34c-276">We need to refresh the grid whenever a new role is added.</span></span> <span data-ttu-id="ff34c-277">Для этого обновите обработчик событий `Click` кнопки `CreateRoleButton`, чтобы он вызывал метод `DisplayRolesInGrid` при создании новой роли.</span><span class="sxs-lookup"><span data-stu-id="ff34c-277">To accomplish this, update the `CreateRoleButton` Button's `Click` event handler so that it calls the `DisplayRolesInGrid` method if a new role is created.</span></span>

[!code-vb[Main](creating-and-managing-roles-vb/samples/sample11.vb)]

<span data-ttu-id="ff34c-278">Теперь, когда пользователь добавляет новую роль, `RoleList` GridView показывает только что добавленную роль при обратной передаче, предоставляя визуальную реакцию на то, что роль была успешно создана.</span><span class="sxs-lookup"><span data-stu-id="ff34c-278">Now when the user adds a new role the `RoleList` GridView shows the just-added role on postback, providing visual feedback that the role was successfully created.</span></span> <span data-ttu-id="ff34c-279">Чтобы проиллюстрировать это, перейдите на страницу `ManageRoles.aspx` в браузере и добавьте роль с именем Супервизоры.</span><span class="sxs-lookup"><span data-stu-id="ff34c-279">To illustrate this, visit the `ManageRoles.aspx` page through a browser and add a role named Supervisors.</span></span> <span data-ttu-id="ff34c-280">При нажатии кнопки Создать роль произойдет обратная передача, и в сетке будут добавлены администраторы, а также новая роль, Супервизоры.</span><span class="sxs-lookup"><span data-stu-id="ff34c-280">Upon clicking the Create Role button, a postback will ensue and the grid will update to include Administrators as well as the new role, Supervisors.</span></span>

<span data-ttu-id="ff34c-281">[![добавлена роль "руководители"](creating-and-managing-roles-vb/_static/image17.png)](creating-and-managing-roles-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="ff34c-281">[![The Supervisors Role has Been Added](creating-and-managing-roles-vb/_static/image17.png)](creating-and-managing-roles-vb/_static/image16.png)</span></span>

<span data-ttu-id="ff34c-282">**Рис. 6**. Добавлена роль "Супервизоры" ([щелкните, чтобы просмотреть изображение с полным размером](creating-and-managing-roles-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="ff34c-282">**Figure 6**: The Supervisors Role has Been Added  ([Click to view full-size image](creating-and-managing-roles-vb/_static/image18.png))</span></span>

## <a name="step-6-deleting-roles"></a><span data-ttu-id="ff34c-283">Шаг 6. Удаление ролей</span><span class="sxs-lookup"><span data-stu-id="ff34c-283">Step 6: Deleting Roles</span></span>

<span data-ttu-id="ff34c-284">На этом этапе пользователь может создать новую роль и просмотреть все существующие роли на странице `ManageRoles.aspx`.</span><span class="sxs-lookup"><span data-stu-id="ff34c-284">At this point a user can create a new role and view all existing roles from the `ManageRoles.aspx` page.</span></span> <span data-ttu-id="ff34c-285">Давайте разрешите пользователям также удалять роли.</span><span class="sxs-lookup"><span data-stu-id="ff34c-285">Let's allow users to also delete roles.</span></span> <span data-ttu-id="ff34c-286">Метод `Roles.DeleteRole` имеет две перегрузки:</span><span class="sxs-lookup"><span data-stu-id="ff34c-286">The `Roles.DeleteRole` method has two overloads:</span></span>

- <span data-ttu-id="ff34c-287">[`DeleteRole(roleName)`](https://msdn.microsoft.com/library/ek4sywc0.aspx) — Удаляет роль *roleName*.</span><span class="sxs-lookup"><span data-stu-id="ff34c-287">[`DeleteRole(roleName)`](https://msdn.microsoft.com/library/ek4sywc0.aspx) - deletes the role *roleName*.</span></span> <span data-ttu-id="ff34c-288">Если роль содержит один или несколько членов, возникает исключение.</span><span class="sxs-lookup"><span data-stu-id="ff34c-288">An exception is thrown if the role contains one or more members.</span></span>
- <span data-ttu-id="ff34c-289">[`DeleteRole(roleName, throwOnPopulatedRole)`](https://msdn.microsoft.com/library/38h6wf59.aspx) — Удаляет роль *roleName*.</span><span class="sxs-lookup"><span data-stu-id="ff34c-289">[`DeleteRole(roleName, throwOnPopulatedRole)`](https://msdn.microsoft.com/library/38h6wf59.aspx) - deletes the role *roleName*.</span></span> <span data-ttu-id="ff34c-290">Если *сровонпопулатероле* имеет `True`, то создается исключение, если роль содержит один или несколько членов.</span><span class="sxs-lookup"><span data-stu-id="ff34c-290">If *throwOnPopulateRole* is `True`, then an exception is thrown if the role contains one or more members.</span></span> <span data-ttu-id="ff34c-291">Если *сровонпопулатероле* имеет значение `False`, то роль удаляется независимо от того, содержит ли она какие-либо члены.</span><span class="sxs-lookup"><span data-stu-id="ff34c-291">If *throwOnPopulateRole* is `False`, then the role is deleted whether it contains any members or not.</span></span> <span data-ttu-id="ff34c-292">На внутреннем уровне метод `DeleteRole(roleName)` вызывает `DeleteRole(roleName, True)`.</span><span class="sxs-lookup"><span data-stu-id="ff34c-292">Internally, the `DeleteRole(roleName)` method calls `DeleteRole(roleName, True)`.</span></span>

<span data-ttu-id="ff34c-293">Метод `DeleteRole` также вызывает исключение, если параметр *roleName* имеет значение `Nothing` или является пустой строкой или если *roleName* содержит запятую.</span><span class="sxs-lookup"><span data-stu-id="ff34c-293">The `DeleteRole` method will also throw an exception if *roleName* is `Nothing` or an empty string or if *roleName* contains a comma.</span></span> <span data-ttu-id="ff34c-294">Если параметр *roleName* не существует в системе, `DeleteRole` завершается со сбоем автоматически, без вызова исключения.</span><span class="sxs-lookup"><span data-stu-id="ff34c-294">If *roleName* does not exist in the system, `DeleteRole` fails silently, without raising an exception.</span></span>

<span data-ttu-id="ff34c-295">Добавим GridView в `ManageRoles.aspx`, чтобы добавить кнопку Удалить, которая при нажатии удаляет выбранную роль.</span><span class="sxs-lookup"><span data-stu-id="ff34c-295">Let's augment the GridView in `ManageRoles.aspx` to include a Delete button that, when clicked, deletes the selected role.</span></span> <span data-ttu-id="ff34c-296">Начните с добавления кнопки Удалить в GridView, перейдя в диалоговое окно поля и добавив кнопку Удалить, которая находится в разделе параметр CommandField.</span><span class="sxs-lookup"><span data-stu-id="ff34c-296">Start by adding a Delete button to the GridView by going to the Fields dialog box and adding a Delete button, which is located under the CommandField option.</span></span> <span data-ttu-id="ff34c-297">Сделайте нажатой кнопку Удалить в крайнем левом столбце и задайте для его свойства `DeleteText` значение удалить роль.</span><span class="sxs-lookup"><span data-stu-id="ff34c-297">Make the Delete button the far left column and set its `DeleteText` property to Delete Role .</span></span>

<span data-ttu-id="ff34c-298">[![добавить кнопку "Удалить" в RoleList GridView](creating-and-managing-roles-vb/_static/image20.png)](creating-and-managing-roles-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="ff34c-298">[![Add a Delete Button to the RoleList GridView](creating-and-managing-roles-vb/_static/image20.png)](creating-and-managing-roles-vb/_static/image19.png)</span></span>

<span data-ttu-id="ff34c-299">**Рис. 7**. Добавление кнопки "Удалить" в `RoleList` GridView ([щелкните, чтобы просмотреть изображение с полным размером](creating-and-managing-roles-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="ff34c-299">**Figure 7**: Add a Delete Button to the `RoleList` GridView  ([Click to view full-size image](creating-and-managing-roles-vb/_static/image21.png))</span></span>

<span data-ttu-id="ff34c-300">После добавления кнопки "Удалить" декларативная разметка GridView должна выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="ff34c-300">After adding the Delete button, your GridView's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](creating-and-managing-roles-vb/samples/sample12.aspx)]

<span data-ttu-id="ff34c-301">Затем создайте обработчик событий для события `RowDeleting` GridView.</span><span class="sxs-lookup"><span data-stu-id="ff34c-301">Next, create an event handler for the GridView's `RowDeleting` event.</span></span> <span data-ttu-id="ff34c-302">Это событие возникает при обратной передаче при нажатии кнопки удаления роли.</span><span class="sxs-lookup"><span data-stu-id="ff34c-302">This is the event that is raised on postback when the Delete Role button is clicked.</span></span> <span data-ttu-id="ff34c-303">Добавьте в обработчик событий приведенный ниже код.</span><span class="sxs-lookup"><span data-stu-id="ff34c-303">Add the following code to the event handler.</span></span>

[!code-vb[Main](creating-and-managing-roles-vb/samples/sample13.vb)]

<span data-ttu-id="ff34c-304">Код начинается с программной ссылки на `RoleNameLabel` веб-элемент управления в строке, для которой была нажата кнопка Удалить роль.</span><span class="sxs-lookup"><span data-stu-id="ff34c-304">The code starts by programmatically referencing the `RoleNameLabel` Web control in the row whose Delete Role button was clicked.</span></span> <span data-ttu-id="ff34c-305">Затем вызывается метод `Roles.DeleteRole`, передающий `Text` `RoleNameLabel` и `False`, тем самым удаляя роль независимо от наличия пользователей, связанных с этой ролью.</span><span class="sxs-lookup"><span data-stu-id="ff34c-305">The `Roles.DeleteRole` method is then invoked, passing in the `Text` of the `RoleNameLabel` and `False`, thereby deleting the role regardless of whether there are any users associated with the role.</span></span> <span data-ttu-id="ff34c-306">Наконец, `RoleList` GridView обновляется таким образом, что только что удаленная роль больше не отображается в сетке.</span><span class="sxs-lookup"><span data-stu-id="ff34c-306">Finally, the `RoleList` GridView is refreshed so that the just-deleted role no longer appears in the grid.</span></span>

> [!NOTE]
> <span data-ttu-id="ff34c-307">Для кнопки удалить роль не требуется никаких подтверждений от пользователя перед удалением роли.</span><span class="sxs-lookup"><span data-stu-id="ff34c-307">The Delete Role button does not require any sort of confirmation from the user before deleting the role.</span></span> <span data-ttu-id="ff34c-308">Одним из самых простых способов подтверждения действия является применение диалогового окна подтверждения на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="ff34c-308">One of the easiest ways to confirm an action is through a client-side confirm dialog box.</span></span> <span data-ttu-id="ff34c-309">Дополнительные сведения об этом способе см. в разделе [Добавление подтверждения на стороне клиента при удалении](https://asp.net/learn/data-access/tutorial-42-vb.aspx).</span><span class="sxs-lookup"><span data-stu-id="ff34c-309">For more information on this technique, see [Adding Client-Side Confirmation When Deleting](https://asp.net/learn/data-access/tutorial-42-vb.aspx).</span></span>

## <a name="summary"></a><span data-ttu-id="ff34c-310">Сводка</span><span class="sxs-lookup"><span data-stu-id="ff34c-310">Summary</span></span>

<span data-ttu-id="ff34c-311">Многие веб-приложения имеют определенные правила авторизации или функции на уровне страницы, которые доступны только определенным классам пользователей.</span><span class="sxs-lookup"><span data-stu-id="ff34c-311">Many web applications have certain authorization rules or page-level functionality that is only available to certain classes of users.</span></span> <span data-ttu-id="ff34c-312">Например, может существовать набор веб-страниц, доступ к которым имеют только администраторы.</span><span class="sxs-lookup"><span data-stu-id="ff34c-312">For example, there may be a set of web pages that only administrators can access.</span></span> <span data-ttu-id="ff34c-313">Вместо того, чтобы определять эти правила авторизации на уровне пользователя, очень полезно определить правила на основе роли.</span><span class="sxs-lookup"><span data-stu-id="ff34c-313">Rather than defining these authorization rules on a user-by-user basis, oftentimes it is more useful to define the rules based on a role.</span></span> <span data-ttu-id="ff34c-314">То есть, вместо явного разрешения пользователям Скотт и Цзисунь на доступ к административным веб-страницам, более сопровождаемый подход заключается в предоставлении членам роли «Администраторы» доступа к этим страницам, а также для обозначения Скотт и Цзисунь в качестве пользователей, принадлежащих к Роль администраторов.</span><span class="sxs-lookup"><span data-stu-id="ff34c-314">That is, rather than explicitly allowing users Scott and Jisun to access the administrative web pages, a more maintainable approach is to permit members of the Administrators role to access these pages, and then to denote Scott and Jisun as users belonging to the Administrators role.</span></span>

<span data-ttu-id="ff34c-315">Инфраструктура ролей упрощает создание ролей и управление ими.</span><span class="sxs-lookup"><span data-stu-id="ff34c-315">The Roles framework makes it easy to create and manage roles.</span></span> <span data-ttu-id="ff34c-316">В этом учебнике мы рассмотрели, как настроить платформу ролей для использования `SqlRoleProvider`, в которой в качестве хранилища ролей используется база данных Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="ff34c-316">In this tutorial we examined how to configure the Roles framework to use the `SqlRoleProvider`, which uses a Microsoft SQL Server database as the role store.</span></span> <span data-ttu-id="ff34c-317">Мы также создали веб-страницу, в которой перечислены существующие роли в системе, и она позволяет создавать новые роли и удалять существующие.</span><span class="sxs-lookup"><span data-stu-id="ff34c-317">We also created a web page that lists the existing roles in the system and allows for new roles to be created and existing ones to be deleted.</span></span> <span data-ttu-id="ff34c-318">В следующих учебных курсах будет показано, как назначать пользователям роли и как применять авторизацию на основе ролей.</span><span class="sxs-lookup"><span data-stu-id="ff34c-318">In subsequent tutorials we will see how to assign users to roles and how to apply role-based authorization.</span></span>

<span data-ttu-id="ff34c-319">Поздравляем с программированием!</span><span class="sxs-lookup"><span data-stu-id="ff34c-319">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="ff34c-320">Дополнительные сведения</span><span class="sxs-lookup"><span data-stu-id="ff34c-320">Further Reading</span></span>

<span data-ttu-id="ff34c-321">Дополнительные сведения о разделах, обсуждаемых в этом руководстве, см. в следующих ресурсах:</span><span class="sxs-lookup"><span data-stu-id="ff34c-321">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="ff34c-322">Изучение членства, ролей и профиля ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="ff34c-322">Examining ASP.NET 2.0's Membership, Roles, and Profile</span></span>](http://aspnet.4guysfromrolla.com/articles/120705-1.aspx)
- [<span data-ttu-id="ff34c-323">Как использовать диспетчер ролей в ASP.NET 2,0</span><span class="sxs-lookup"><span data-stu-id="ff34c-323">How To: Use Role Manager in ASP.NET 2.0</span></span>](https://msdn.microsoft.com/library/ms998314.aspx)
- [<span data-ttu-id="ff34c-324">Поставщики ролей</span><span class="sxs-lookup"><span data-stu-id="ff34c-324">Role Providers</span></span>](https://msdn.microsoft.com/library/aa478950.aspx)
- [<span data-ttu-id="ff34c-325">Развертывание собственного средства администрирования веб-сайта</span><span class="sxs-lookup"><span data-stu-id="ff34c-325">Rolling Your Own Website Administration Tool</span></span>](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx)
- [<span data-ttu-id="ff34c-326">Техническая документация по элементу `<roleManager>`</span><span class="sxs-lookup"><span data-stu-id="ff34c-326">Technical documentation for the `<roleManager>` Element</span></span>](https://msdn.microsoft.com/library/ms164660.aspx)
- [<span data-ttu-id="ff34c-327">Использование API членства и диспетчера ролей</span><span class="sxs-lookup"><span data-stu-id="ff34c-327">Using the Membership and Role Manager APIs</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/security/membership.aspx)

### <a name="about-the-author"></a><span data-ttu-id="ff34c-328">Об авторе</span><span class="sxs-lookup"><span data-stu-id="ff34c-328">About the Author</span></span>

<span data-ttu-id="ff34c-329">Скотт Митчелл, автор нескольких книг по ASP/ASP. NET и основатель 4GuysFromRolla.com, работал с веб-технологиями Майкрософт с 1998.</span><span class="sxs-lookup"><span data-stu-id="ff34c-329">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="ff34c-330">Скотт работает как независимый консультант, преподаватель и модуль записи.</span><span class="sxs-lookup"><span data-stu-id="ff34c-330">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="ff34c-331">Его последняя книга — *[Sams обучать себя ASP.NET 2,0 за 24 часа](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)* .</span><span class="sxs-lookup"><span data-stu-id="ff34c-331">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="ff34c-332">Скотт можно получить по адресу [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) или через свой блог по адресу [http://ScottOnWriting.NET](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="ff34c-332">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="ff34c-333">Специальная благодарность</span><span class="sxs-lookup"><span data-stu-id="ff34c-333">Special Thanks To</span></span>

<span data-ttu-id="ff34c-334">Эта серия руководств была рассмотрена многими полезными рецензентами.</span><span class="sxs-lookup"><span data-stu-id="ff34c-334">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="ff34c-335">Потенциальные рецензенты для этого руководства включают Аликжа Мазиарз, Сучи Банержи и Терезой Мерфи.</span><span class="sxs-lookup"><span data-stu-id="ff34c-335">Lead reviewers for this tutorial include Alicja Maziarz, Suchi Banerjee, and Teresa Murphy.</span></span> <span data-ttu-id="ff34c-336">Хотите ознакомиться с моими будущими статьями MSDN?</span><span class="sxs-lookup"><span data-stu-id="ff34c-336">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="ff34c-337">Если да, расположите строку в [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="ff34c-337">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="ff34c-338">[Назад](role-based-authorization-cs.md)
> [Вперед](assigning-roles-to-users-vb.md)</span><span class="sxs-lookup"><span data-stu-id="ff34c-338">[Previous](role-based-authorization-cs.md)
[Next](assigning-roles-to-users-vb.md)</span></span>
