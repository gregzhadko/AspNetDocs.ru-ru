---
uid: web-forms/overview/older-versions-security/roles/assigning-roles-to-users-cs
title: Назначение ролей пользователям (C#) | Документация Майкрософт
author: rick-anderson
description: В этом руководстве мы построим две страницы ASP.NET для помощи в управлении, какие пользователи принадлежат к роли. Первая страница будет включать средства, чтобы увидеть, что...
ms.author: riande
ms.date: 03/24/2008
ms.assetid: d522639a-5aca-421e-9a76-d73f95607f57
msc.legacyurl: /web-forms/overview/older-versions-security/roles/assigning-roles-to-users-cs
msc.type: authoredcontent
ms.openlocfilehash: 482460248fb070b273c1ff97515152cacf66dbce
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2019
ms.locfileid: "65108688"
---
# <a name="assigning-roles-to-users-c"></a><span data-ttu-id="f7de7-104">Назначение ролей пользователям (C#)</span><span class="sxs-lookup"><span data-stu-id="f7de7-104">Assigning Roles to Users (C#)</span></span>

<span data-ttu-id="f7de7-105">по [Скотт Митчелл](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="f7de7-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="f7de7-106">[Скачать код](http://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/CS.10.zip) или [скачать PDF](http://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/aspnet_tutorial10_AssigningRoles_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="f7de7-106">[Download Code](http://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/CS.10.zip) or [Download PDF](http://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/aspnet_tutorial10_AssigningRoles_cs.pdf)</span></span>

> <span data-ttu-id="f7de7-107">В этом руководстве мы построим две страницы ASP.NET для помощи в управлении, какие пользователи принадлежат к роли.</span><span class="sxs-lookup"><span data-stu-id="f7de7-107">In this tutorial we will build two ASP.NET pages to assist with managing what users belong to what roles.</span></span> <span data-ttu-id="f7de7-108">Первая страница будет включать средства, чтобы увидеть, какие пользователи принадлежат к определенной роли, конкретный пользователь принадлежит роли, а также возможность назначить или удалить пользователя из определенной роли.</span><span class="sxs-lookup"><span data-stu-id="f7de7-108">The first page will include facilities to see what users belong to a given role, what roles a particular user belongs to, and the ability to assign or remove a particular user from a particular role.</span></span> <span data-ttu-id="f7de7-109">На второй странице мы расширим элемент управления CreateUserWizard, теперь она содержит шаг, чтобы указывать только что созданный пользователь принадлежит к роли.</span><span class="sxs-lookup"><span data-stu-id="f7de7-109">In the second page we will augment the CreateUserWizard control so that it includes a step to specify what roles the newly created user belongs to.</span></span> <span data-ttu-id="f7de7-110">Это полезно в сценариях, где администратор может создать новую учетную запись.</span><span class="sxs-lookup"><span data-stu-id="f7de7-110">This is useful in scenarios where an administrator is able to create new user accounts.</span></span>

## <a name="introduction"></a><span data-ttu-id="f7de7-111">Вступление</span><span class="sxs-lookup"><span data-stu-id="f7de7-111">Introduction</span></span>

<span data-ttu-id="f7de7-112"><a id="_msoanchor_1"> </a> [Предыдущем учебном курсе](creating-and-managing-roles-cs.md) исследуется framework ролей и `SqlRoleProvider`; мы узнали, как использовать `Roles` класса для создания, извлечения и удалять роли.</span><span class="sxs-lookup"><span data-stu-id="f7de7-112">The <a id="_msoanchor_1"></a>[previous tutorial](creating-and-managing-roles-cs.md) examined the Roles framework and the `SqlRoleProvider`; we saw how to use the `Roles` class to create, retrieve, and delete roles.</span></span> <span data-ttu-id="f7de7-113">Помимо создания и удаления ролей, необходимо иметь возможность назначить или удалить пользователей из роли.</span><span class="sxs-lookup"><span data-stu-id="f7de7-113">In addition to creating and deleting roles, we need to be able to assign or remove users from a role.</span></span> <span data-ttu-id="f7de7-114">К сожалению ASP.NET поставляется с любой веб-элементы управления для управления, какие пользователи принадлежат к роли.</span><span class="sxs-lookup"><span data-stu-id="f7de7-114">Unfortunately, ASP.NET does not ship with any Web controls for managing what users belong to what roles.</span></span> <span data-ttu-id="f7de7-115">Вместо этого необходимо создать собственные страницы ASP.NET для управления этих связей.</span><span class="sxs-lookup"><span data-stu-id="f7de7-115">Instead, we must create our own ASP.NET pages to manage these associations.</span></span> <span data-ttu-id="f7de7-116">Хорошо то, что добавление и удаление ролей пользователям достаточно прост.</span><span class="sxs-lookup"><span data-stu-id="f7de7-116">The good news is that adding and removing users to roles is quite easy.</span></span> <span data-ttu-id="f7de7-117">`Roles` Класс содержит ряд методов для добавления одного или нескольких пользователей в одну или несколько ролей.</span><span class="sxs-lookup"><span data-stu-id="f7de7-117">The `Roles` class contains a number of methods for adding one or more users to one or more roles.</span></span>

<span data-ttu-id="f7de7-118">В этом руководстве мы построим две страницы ASP.NET для помощи в управлении, какие пользователи принадлежат к роли.</span><span class="sxs-lookup"><span data-stu-id="f7de7-118">In this tutorial we will build two ASP.NET pages to assist with managing what users belong to what roles.</span></span> <span data-ttu-id="f7de7-119">Первая страница будет включать средства, чтобы увидеть, какие пользователи принадлежат к определенной роли, конкретный пользователь принадлежит роли, а также возможность назначить или удалить пользователя из определенной роли.</span><span class="sxs-lookup"><span data-stu-id="f7de7-119">The first page will include facilities to see what users belong to a given role, what roles a particular user belongs to, and the ability to assign or remove a particular user from a particular role.</span></span> <span data-ttu-id="f7de7-120">На второй странице мы расширим элемент управления CreateUserWizard, теперь она содержит шаг, чтобы указывать только что созданный пользователь принадлежит к роли.</span><span class="sxs-lookup"><span data-stu-id="f7de7-120">In the second page we will augment the CreateUserWizard control so that it includes a step to specify what roles the newly created user belongs to.</span></span> <span data-ttu-id="f7de7-121">Это полезно в сценариях, где администратор может создать новую учетную запись.</span><span class="sxs-lookup"><span data-stu-id="f7de7-121">This is useful in scenarios where an administrator is able to create new user accounts.</span></span>

<span data-ttu-id="f7de7-122">Давайте начнем!</span><span class="sxs-lookup"><span data-stu-id="f7de7-122">Let's get started!</span></span>

## <a name="listing-what-users-belong-to-what-roles"></a><span data-ttu-id="f7de7-123">Листинг какие пользователи принадлежат какие роли</span><span class="sxs-lookup"><span data-stu-id="f7de7-123">Listing What Users Belong To What Roles</span></span>

<span data-ttu-id="f7de7-124">Первым делом в этом руководстве является создание веб-страницы, из которого пользователи могут быть назначены роли.</span><span class="sxs-lookup"><span data-stu-id="f7de7-124">The first order of business for this tutorial is to create a web page from which users can be assigned to roles.</span></span> <span data-ttu-id="f7de7-125">Прежде чем заняться как назначать пользователей ролям, давайте сначала сосредоточиться на том, как определить, какие пользователи принадлежат к роли.</span><span class="sxs-lookup"><span data-stu-id="f7de7-125">Before we concern ourselves with how to assign users to roles, let's first concentrate on how to determine what users belong to what roles.</span></span> <span data-ttu-id="f7de7-126">Существует два способа для отображения этой информации: «роль» или «user».</span><span class="sxs-lookup"><span data-stu-id="f7de7-126">There are two ways to display this information: "by role" or "by user."</span></span> <span data-ttu-id="f7de7-127">Мы делает возможным посетитель выберите роль, а затем отобразить их всех пользователей, которые принадлежат роли («по ролям» отображение), или мы может выдать запрос посетитель выберите пользователя, а затем отобразить их роли, назначенные этому пользователю («пользователем» отображение).</span><span class="sxs-lookup"><span data-stu-id="f7de7-127">We could allow the visitor to select a role and then show them all of the users that belong to the role (the "by role" display), or we could prompt the visitor to select a user and then show them the roles assigned to that user (the "by user" display).</span></span>

<span data-ttu-id="f7de7-128">Представление «по ролям» полезны в случаях, когда посетитель хочет знать набор пользователей, принадлежащих к определенной роли; представление «пользователем» идеально в тех случаях, когда посетитель необходима информация о роли конкретного пользователя.</span><span class="sxs-lookup"><span data-stu-id="f7de7-128">The "by role" view is useful in circumstances where the visitor wants to know the set of users that belong to a particular role; the "by user" view is ideal when the visitor needs to know a particular user's role(s).</span></span> <span data-ttu-id="f7de7-129">Давайте обновим страницу включают «роли» и «пользователем» интерфейсы.</span><span class="sxs-lookup"><span data-stu-id="f7de7-129">Let's have our page include both "by role" and "by user" interfaces.</span></span>

<span data-ttu-id="f7de7-130">Мы начнем с создания интерфейса, «пользователем».</span><span class="sxs-lookup"><span data-stu-id="f7de7-130">We will start with creating the "by user" interface.</span></span> <span data-ttu-id="f7de7-131">Этот интерфейс будет состоять из раскрывающегося списка и список флажков.</span><span class="sxs-lookup"><span data-stu-id="f7de7-131">This interface will consist of a drop-down list and a list of checkboxes.</span></span> <span data-ttu-id="f7de7-132">Выберите в раскрывающемся списке будет заполняться набор пользователей в системе; флажки перечисляет роли.</span><span class="sxs-lookup"><span data-stu-id="f7de7-132">The drop-down list will be populated with the set of users in the system; the checkboxes will enumerate the roles.</span></span> <span data-ttu-id="f7de7-133">Выбрав пользователя из раскрывающегося списка будет проверять эти роли, к которой принадлежит пользователь.</span><span class="sxs-lookup"><span data-stu-id="f7de7-133">Selecting a user from the drop-down list will check those roles the user belongs to.</span></span> <span data-ttu-id="f7de7-134">Лицо, посетив страницу можно, а затем установите или снимите флажки, чтобы добавить или удалить выбранного пользователя из соответствующих ролей.</span><span class="sxs-lookup"><span data-stu-id="f7de7-134">The person visiting the page can then check or uncheck the checkboxes to add or remove the selected user from the corresponding roles.</span></span>

> [!NOTE]
> <span data-ttu-id="f7de7-135">С помощью раскрывающегося списка в список учетных записей пользователей не является идеальным выбором для веб-сайтов там, где могут существовать сотни учетных записей пользователей.</span><span class="sxs-lookup"><span data-stu-id="f7de7-135">Using a drop-down list to list the user accounts is not an ideal choice for websites where there may be hundreds of user accounts.</span></span> <span data-ttu-id="f7de7-136">Стрелку раскрывающегося списка позволяет пользователю выбрать один элемент из относительно короткий список параметров.</span><span class="sxs-lookup"><span data-stu-id="f7de7-136">A drop-down list is designed to allow a user to pick one item from a relatively short list of options.</span></span> <span data-ttu-id="f7de7-137">Он быстро становится громоздким, по мере роста число элементов списка.</span><span class="sxs-lookup"><span data-stu-id="f7de7-137">It quickly becomes unwieldy as the number of list items grows.</span></span> <span data-ttu-id="f7de7-138">Если вы создаете веб-сайта, будет иметь потенциально большое количество учетных записей пользователей, можно рассмотреть возможность использования альтернативный пользовательский интерфейс, например возможностью разбивки на страницы элемента управления GridView или фильтруемые интерфейс, который перечисляет запросы на ввод посетителя, чтобы выбрать букву и затем только Показывает этих пользователей, ее имя пользователя начинается с выбранной буквы.</span><span class="sxs-lookup"><span data-stu-id="f7de7-138">If you are building a website that will have potentially large numbers of user accounts, you may want to consider using an alternative user interface, such as a pageable GridView or a filterable interface that lists prompts the visitor to choose a letter and then only shows those users whose username starts with the selected letter.</span></span>

## <a name="step-1-building-the-by-user-user-interface"></a><span data-ttu-id="f7de7-139">Шаг 1. Создание пользовательского интерфейса «Пользователем»</span><span class="sxs-lookup"><span data-stu-id="f7de7-139">Step 1: Building the "By User" User Interface</span></span>

<span data-ttu-id="f7de7-140">Откройте `UsersAndRoles.aspx` страницы.</span><span class="sxs-lookup"><span data-stu-id="f7de7-140">Open the `UsersAndRoles.aspx` page.</span></span> <span data-ttu-id="f7de7-141">В верхней части страницы, добавьте элемент управления Label Web `ActionStatus` и очистите его `Text` свойство.</span><span class="sxs-lookup"><span data-stu-id="f7de7-141">At the top of the page, add a Label Web control named `ActionStatus` and clear out its `Text` property.</span></span> <span data-ttu-id="f7de7-142">Мы будем использовать эту метку отзыв о действиях, выполняемых, отображение сообщения, например, «Tito пользователь был добавлен к роли "Администраторы"» или «Цзисунь пользователь был удален из роли руководителями.»</span><span class="sxs-lookup"><span data-stu-id="f7de7-142">We will use this Label to provide feedback on the actions performed, displaying messages like, "User Tito has been added to the Administrators role," or "User Jisun has been removed from the Supervisors role."</span></span> <span data-ttu-id="f7de7-143">Чтобы сделать эти сообщения фоне, задайте метки `CssClass` свойства «Важно!».</span><span class="sxs-lookup"><span data-stu-id="f7de7-143">In order to make these messages stand out, set the Label's `CssClass` property to "Important".</span></span>

[!code-aspx[Main](assigning-roles-to-users-cs/samples/sample1.aspx)]

<span data-ttu-id="f7de7-144">Добавьте следующее определение класса CSS к `Styles.css` таблицы стилей:</span><span class="sxs-lookup"><span data-stu-id="f7de7-144">Next, add the following CSS class definition to the `Styles.css` stylesheet:</span></span>

[!code-css[Main](assigning-roles-to-users-cs/samples/sample2.css)]

<span data-ttu-id="f7de7-145">Это определение CSS указывает, что в браузере открывается с помощью большой красный шрифт метки.</span><span class="sxs-lookup"><span data-stu-id="f7de7-145">This CSS definition instructs the browser to display the Label using a large, red font.</span></span> <span data-ttu-id="f7de7-146">Рис. 1 показан этот эффект в конструкторе Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="f7de7-146">Figure 1 shows this effect through the Visual Studio Designer.</span></span>

<span data-ttu-id="f7de7-147">[![Свойство метки CssClass приводит к большой красный шрифт](assigning-roles-to-users-cs/_static/image2.png)](assigning-roles-to-users-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="f7de7-147">[![The Label's CssClass Property Results in a Large, Red Font](assigning-roles-to-users-cs/_static/image2.png)](assigning-roles-to-users-cs/_static/image1.png)</span></span>

<span data-ttu-id="f7de7-148">**Рис. 1**: Метки `CssClass` свойства приводят крупный шрифт Red ([Просмотр полноразмерного изображения](assigning-roles-to-users-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="f7de7-148">**Figure 1**: The Label's `CssClass` Property Results in a Large, Red Font  ([Click to view full-size image](assigning-roles-to-users-cs/_static/image3.png))</span></span>

<span data-ttu-id="f7de7-149">Добавление элемента управления DropDownList на страницу, затем установите его `ID` свойства `UserList`и задайте его `AutoPostBack` присваивается значение True.</span><span class="sxs-lookup"><span data-stu-id="f7de7-149">Next, add a DropDownList to the page, set its `ID` property to `UserList`, and set its `AutoPostBack` property to True.</span></span> <span data-ttu-id="f7de7-150">Мы будем использовать этот DropDownList для получения списка всех пользователей в системе.</span><span class="sxs-lookup"><span data-stu-id="f7de7-150">We will use this DropDownList to list all of the users in the system.</span></span> <span data-ttu-id="f7de7-151">Этот DropDownList будет привязан к коллекции объектов MembershipUser.</span><span class="sxs-lookup"><span data-stu-id="f7de7-151">This DropDownList will be bound to a collection of MembershipUser objects.</span></span> <span data-ttu-id="f7de7-152">Поскольку мы хотим DropDownList для отображения Свойство UserName объекта MembershipUser (и использовать его в качестве значения элементов списка), значение DropDownList `DataTextField` и `DataValueField` свойства «Username».</span><span class="sxs-lookup"><span data-stu-id="f7de7-152">Because we want the DropDownList to display the UserName property of the MembershipUser object (and use it as the value of the list items), set the DropDownList's `DataTextField` and `DataValueField` properties to "UserName".</span></span>

<span data-ttu-id="f7de7-153">Под DropDownList, добавьте элемент управления Repeater с именем `UsersRoleList`.</span><span class="sxs-lookup"><span data-stu-id="f7de7-153">Underneath the DropDownList, add a Repeater named `UsersRoleList`.</span></span> <span data-ttu-id="f7de7-154">Этот элемент управления Repeater будут отображаться все роли в системе как ряд флажки.</span><span class="sxs-lookup"><span data-stu-id="f7de7-154">This Repeater will list all of the roles in the system as a series of checkboxes.</span></span> <span data-ttu-id="f7de7-155">Определение элемента Repeater `ItemTemplate` с помощью следующей декларативной разметке:</span><span class="sxs-lookup"><span data-stu-id="f7de7-155">Define the Repeater's `ItemTemplate` using the following declarative markup:</span></span>

[!code-aspx[Main](assigning-roles-to-users-cs/samples/sample3.aspx)]

<span data-ttu-id="f7de7-156">`ItemTemplate` Разметка включает один флажок веб-элемент управления с именем `RoleCheckBox`.</span><span class="sxs-lookup"><span data-stu-id="f7de7-156">The `ItemTemplate` markup includes a single CheckBox Web control named `RoleCheckBox`.</span></span> <span data-ttu-id="f7de7-157">Флажок `AutoPostBack` свойство имеет значение True и `Text` свойство привязано к `Container.DataItem`.</span><span class="sxs-lookup"><span data-stu-id="f7de7-157">The CheckBox's `AutoPostBack` property is set to True and the `Text` property is bound to `Container.DataItem`.</span></span> <span data-ttu-id="f7de7-158">Причина синтаксис привязки данных — это просто `Container.DataItem` — так как платформа роли возвращает список имен ролей, как массив строк, а этот массив строк, который будет осуществляться привязка к элементу управления Repeater.</span><span class="sxs-lookup"><span data-stu-id="f7de7-158">The reason the databinding syntax is simply `Container.DataItem` is because the Roles framework returns the list of role names as a string array, and it is this string array that we will be binding to the Repeater.</span></span> <span data-ttu-id="f7de7-159">Полное описание причины такой синтаксис используется для отображения содержимого массива, который привязан к веб-элемент данных выходит за рамки данного руководства.</span><span class="sxs-lookup"><span data-stu-id="f7de7-159">A thorough description of why this syntax is used to display the contents of an array bound to a data Web control is beyond the scope of this tutorial.</span></span> <span data-ttu-id="f7de7-160">Дополнительные сведения по данному вопросу см. [привязка к веб-элемент данных массива скаляр](http://aspnet.4guysfromrolla.com/articles/082504-1.aspx).</span><span class="sxs-lookup"><span data-stu-id="f7de7-160">For more information on this matter, refer to [Binding a Scalar Array to a Data Web Control](http://aspnet.4guysfromrolla.com/articles/082504-1.aspx).</span></span>

<span data-ttu-id="f7de7-161">На этом этапе декларативная разметка вашей «пользователем» интерфейса выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="f7de7-161">At this point your "by user" interface's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](assigning-roles-to-users-cs/samples/sample4.aspx)]

<span data-ttu-id="f7de7-162">Теперь мы готовы написать код, чтобы связать набор учетных записей пользователей в DropDownList и набор ролей, к элементу управления Repeater.</span><span class="sxs-lookup"><span data-stu-id="f7de7-162">We are now ready to write the code to bind the set of user accounts to the DropDownList and the set of roles to the Repeater.</span></span> <span data-ttu-id="f7de7-163">В классе фонового кода страницы добавьте метод с именем `BindUsersToUserList` , а другой с именем `BindRolesList`, используя следующий код:</span><span class="sxs-lookup"><span data-stu-id="f7de7-163">In the page's code-behind class, add a method named `BindUsersToUserList` and another named `BindRolesList`, using the following code:</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample5.cs)]

<span data-ttu-id="f7de7-164">`BindUsersToUserList` Метод извлекает все учетные записи пользователей в системе через [ `Membership.GetAllUsers` метод](https://msdn.microsoft.com/library/dy8swhya.aspx).</span><span class="sxs-lookup"><span data-stu-id="f7de7-164">The `BindUsersToUserList` method retrieves all of the user accounts in the system via the [`Membership.GetAllUsers` method](https://msdn.microsoft.com/library/dy8swhya.aspx).</span></span> <span data-ttu-id="f7de7-165">Эта команда возвращает [ `MembershipUserCollection` объект](https://msdn.microsoft.com/library/system.web.security.membershipusercollection.aspx), который является коллекцией [ `MembershipUser` экземпляры](https://msdn.microsoft.com/library/system.web.security.membershipuser.aspx).</span><span class="sxs-lookup"><span data-stu-id="f7de7-165">This returns a [`MembershipUserCollection` object](https://msdn.microsoft.com/library/system.web.security.membershipusercollection.aspx), which is a collection of [`MembershipUser` instances](https://msdn.microsoft.com/library/system.web.security.membershipuser.aspx).</span></span> <span data-ttu-id="f7de7-166">Эта коллекция затем привязывается к `UserList` DropDownList.</span><span class="sxs-lookup"><span data-stu-id="f7de7-166">This collection is then bound to the `UserList` DropDownList.</span></span> <span data-ttu-id="f7de7-167">`MembershipUser` Экземпляров, состав, коллекция содержит различные свойства, такие как `UserName`, `Email`, `CreationDate`, и `IsOnline`.</span><span class="sxs-lookup"><span data-stu-id="f7de7-167">The `MembershipUser` instances that makeup the collection contain a variety of properties, like `UserName`, `Email`, `CreationDate`, and `IsOnline`.</span></span> <span data-ttu-id="f7de7-168">Чтобы настроить DropDownList для отображения значения `UserName` свойство, убедитесь, что `UserList` DropDownList `DataTextField` и `DataValueField` заданы свойства «Username».</span><span class="sxs-lookup"><span data-stu-id="f7de7-168">In order to instruct the DropDownList to display the value of the `UserName` property, ensure that the `UserList` DropDownList's `DataTextField` and `DataValueField` properties have been set to "UserName".</span></span>

> [!NOTE]
> <span data-ttu-id="f7de7-169">`Membership.GetAllUsers` Метод имеет две перегрузки: один, который не принимает никаких входных параметров и возвращает всех пользователей, а другое принимает целочисленные значения для индекса страницы и размера страницы и возвращает только определенное подмножество пользователей.</span><span class="sxs-lookup"><span data-stu-id="f7de7-169">The `Membership.GetAllUsers` method has two overloads: one that accepts no input parameters and returns all of the users, and one that takes in integer values for the page index and page size, and returns only the specified subset of the users.</span></span> <span data-ttu-id="f7de7-170">При наличии большого количества учетных записей пользователей, отображаемых в элементе возможностью разбивки на страницы пользовательского интерфейса, вторая перегрузка может использоваться для более эффективно разбивка на страницы пользователей, так как он возвращает только точные подмножества учетных записей пользователей, а не все из них.</span><span class="sxs-lookup"><span data-stu-id="f7de7-170">When there are large amounts of user accounts being displayed in a pageable user interface element, the second overload can be used to more efficiently page through the users since it returns just the precise subset of user accounts rather than all of them.</span></span>

<span data-ttu-id="f7de7-171">`BindRolesToList` Запускает метод с помощью вызова `Roles` класса [ `GetAllRoles` метод](https://msdn.microsoft.com/library/system.web.security.roles.getallroles.aspx), который возвращает массив строк, содержащий роли в системе.</span><span class="sxs-lookup"><span data-stu-id="f7de7-171">The `BindRolesToList` method starts by calling the `Roles` class's [`GetAllRoles` method](https://msdn.microsoft.com/library/system.web.security.roles.getallroles.aspx), which returns a string array containing the roles in the system.</span></span> <span data-ttu-id="f7de7-172">Этот массив строк, затем привязывается к элементу управления Repeater.</span><span class="sxs-lookup"><span data-stu-id="f7de7-172">This string array is then bound to the Repeater.</span></span>

<span data-ttu-id="f7de7-173">Наконец необходимо вызвать эти два метода, при первой загрузке страницы.</span><span class="sxs-lookup"><span data-stu-id="f7de7-173">Finally, we need to call these two methods when the page is first loaded.</span></span> <span data-ttu-id="f7de7-174">Добавьте следующий код в обработчик событий `Page_Load` .</span><span class="sxs-lookup"><span data-stu-id="f7de7-174">Add the following code to the `Page_Load` event handler:</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample6.cs)]

<span data-ttu-id="f7de7-175">Этот код в месте Отвлекитесь и посетите страницу через браузер; экран должен выглядеть как показано на рис. 2.</span><span class="sxs-lookup"><span data-stu-id="f7de7-175">With this code in place, take a moment to visit the page through a browser; your screen should look similar to Figure 2.</span></span> <span data-ttu-id="f7de7-176">Учетные записи пользователей будут заполнены все в раскрывающемся списке и нижнего уровня, каждая роль отображается как флажок.</span><span class="sxs-lookup"><span data-stu-id="f7de7-176">All of the user accounts are populated in the drop-down list and, underneath that, each role appears as a checkbox.</span></span> <span data-ttu-id="f7de7-177">Так как мы задали `AutoPostBack` свойства элемента управления DropDownList и флажки значение True, Изменение выбранного пользователя или устанавливая или снимая роли вызывает обратную передачу.</span><span class="sxs-lookup"><span data-stu-id="f7de7-177">Because we set the `AutoPostBack` properties of the DropDownList and CheckBoxes to True, changing the selected user or checking or unchecking a role causes a postback.</span></span> <span data-ttu-id="f7de7-178">Никакие действия не выполняются, тем не менее, поскольку у нас есть еще писать код для обработки этих действий.</span><span class="sxs-lookup"><span data-stu-id="f7de7-178">No action is performed, however, because we have yet to write code to handle these actions.</span></span> <span data-ttu-id="f7de7-179">Это будет рассмотрено этих задач в следующих двух разделах.</span><span class="sxs-lookup"><span data-stu-id="f7de7-179">We'll tackle these tasks in the next two sections.</span></span>

<span data-ttu-id="f7de7-180">[![На странице отображается пользователей и ролей](assigning-roles-to-users-cs/_static/image5.png)](assigning-roles-to-users-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="f7de7-180">[![The Page Displays the Users and Roles](assigning-roles-to-users-cs/_static/image5.png)](assigning-roles-to-users-cs/_static/image4.png)</span></span>

<span data-ttu-id="f7de7-181">**Рис. 2**: На странице отображаются пользователи и роли ([Просмотр полноразмерного изображения](assigning-roles-to-users-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="f7de7-181">**Figure 2**: The Page Displays the Users and Roles  ([Click to view full-size image](assigning-roles-to-users-cs/_static/image6.png))</span></span>

### <a name="checking-the-roles-the-selected-user-belongs-to"></a><span data-ttu-id="f7de7-182">Проверка роли выбранного пользователя принадлежит</span><span class="sxs-lookup"><span data-stu-id="f7de7-182">Checking the Roles the Selected User Belongs To</span></span>

<span data-ttu-id="f7de7-183">При первой загрузке страницы или всякий раз, когда пользователь выбирает нового пользователя в раскрывающемся списке, необходимо обновить `UsersRoleList`флажки, чтобы флажок данной роли установлен только в том случае, если выбранный пользователь принадлежит к этой роли.</span><span class="sxs-lookup"><span data-stu-id="f7de7-183">When the page is first loaded, or whenever the visitor selects a new user from the drop-down list, we need to update the `UsersRoleList`'s checkboxes so that a given role checkbox is checked only if the selected user belongs to that role.</span></span> <span data-ttu-id="f7de7-184">Для этого необходимо создать метод с именем `CheckRolesForSelectedUser` следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="f7de7-184">To accomplish this, create a method named `CheckRolesForSelectedUser` with the following code:</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample7.cs)]

<span data-ttu-id="f7de7-185">Приведенный выше код начинается с определения выбранного пользователя.</span><span class="sxs-lookup"><span data-stu-id="f7de7-185">The above code starts by determining who the selected user is.</span></span> <span data-ttu-id="f7de7-186">Затем он использует класс ролей [ `GetRolesForUser(userName)` метод](https://msdn.microsoft.com/library/system.web.security.roles.getrolesforuser.aspx) для возврата набора ролей как массив строк указанного пользователя.</span><span class="sxs-lookup"><span data-stu-id="f7de7-186">It then uses the Roles class's [`GetRolesForUser(userName)` method](https://msdn.microsoft.com/library/system.web.security.roles.getrolesforuser.aspx) to return the specified user's set of roles as a string array.</span></span> <span data-ttu-id="f7de7-187">Далее перечисляются элементы элементу управления Repeater и каждый элемент `RoleCheckBox` флажок упоминается программным способом.</span><span class="sxs-lookup"><span data-stu-id="f7de7-187">Next, the Repeater's items are enumerated and each item's `RoleCheckBox` CheckBox is programmatically referenced.</span></span> <span data-ttu-id="f7de7-188">Этот флажок установлен, только в том случае, если содержится в роли, он соответствует `selectedUsersRoles` массив строк.</span><span class="sxs-lookup"><span data-stu-id="f7de7-188">The CheckBox is checked only if the role it corresponds to is contained within the `selectedUsersRoles` string array.</span></span>

> [!NOTE]
> <span data-ttu-id="f7de7-189">`selectedUserRoles.Contains<string>(...)` Синтаксис не будет компилироваться при использовании ASP.NET версии 2.0.</span><span class="sxs-lookup"><span data-stu-id="f7de7-189">The `selectedUserRoles.Contains<string>(...)` syntax will not compile if you are using ASP.NET version 2.0.</span></span> <span data-ttu-id="f7de7-190">`Contains<string>` Метод является частью [LINQ библиотеки](http://en.wikipedia.org/wiki/Language_Integrated_Query), которое является новым для ASP.NET 3.5.</span><span class="sxs-lookup"><span data-stu-id="f7de7-190">The `Contains<string>` method is part of the [LINQ library](http://en.wikipedia.org/wiki/Language_Integrated_Query), which is new to ASP.NET 3.5.</span></span> <span data-ttu-id="f7de7-191">Если вы все еще используете ASP.NET версии 2.0, используйте [ `Array.IndexOf<string>` метод](https://msdn.microsoft.com/library/eha9t187.aspx) вместо этого.</span><span class="sxs-lookup"><span data-stu-id="f7de7-191">If you are still using ASP.NET version 2.0, use the [`Array.IndexOf<string>` method](https://msdn.microsoft.com/library/eha9t187.aspx) instead.</span></span>

<span data-ttu-id="f7de7-192">`CheckRolesForSelectedUser` Метод должен вызываться в двух случаях: при первой загрузке страницы, а также при каждом `UserList` изменении выбранного индекса DropDownList.</span><span class="sxs-lookup"><span data-stu-id="f7de7-192">The `CheckRolesForSelectedUser` method needs to be called in two cases: when the page is first loaded and whenever the `UserList` DropDownList's selected index is changed.</span></span> <span data-ttu-id="f7de7-193">Таким образом, вызывать этот метод из `Page_Load` обработчик событий (после вызовов `BindUsersToUserList` и `BindRolesToList`).</span><span class="sxs-lookup"><span data-stu-id="f7de7-193">Therefore, call this method from the `Page_Load` event handler (after the calls to `BindUsersToUserList` and `BindRolesToList`).</span></span> <span data-ttu-id="f7de7-194">Кроме того, создайте обработчик событий для элемента управления DropDownList `SelectedIndexChanged` событие и вызвать этот метод из него.</span><span class="sxs-lookup"><span data-stu-id="f7de7-194">Also, create an event handler for the DropDownList's `SelectedIndexChanged` event and call this method from there.</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample8.cs)]

<span data-ttu-id="f7de7-195">Этот код в месте можно проверить страницы в браузере.</span><span class="sxs-lookup"><span data-stu-id="f7de7-195">With this code in place, you can test the page through the browser.</span></span> <span data-ttu-id="f7de7-196">Однако, поскольку `UsersAndRoles.aspx` страницы в настоящее время отсутствует возможность назначать пользователям роли, пользователи не имеют роли.</span><span class="sxs-lookup"><span data-stu-id="f7de7-196">However, since the `UsersAndRoles.aspx` page currently lacks the ability to assign users to roles, no users have roles.</span></span> <span data-ttu-id="f7de7-197">Мы создадим интерфейс для назначения пользователям ролей позже, чтобы вы могли воспользоваться программа word, этот код работает и убедитесь, что она делает это позже, или можно вручную добавить пользователей в роли путем вставки записей в `aspnet_UsersInRoles` таблицы, чтобы протестировать этот functi Теперь onality.</span><span class="sxs-lookup"><span data-stu-id="f7de7-197">We will create the interface for assigning users to roles in a moment, so you can either take my word that this code works and verify that it does so later, or you can manually add users to roles by inserting records into the `aspnet_UsersInRoles` table in order to test this functionality now.</span></span>

### <a name="assigning-and-removing-users-from-roles"></a><span data-ttu-id="f7de7-198">Назначение и удаление пользователей из ролей</span><span class="sxs-lookup"><span data-stu-id="f7de7-198">Assigning and Removing Users from Roles</span></span>

<span data-ttu-id="f7de7-199">Когда посетитель или снятии флажка в `UsersRoleList` Repeater, нам нужно добавить или удалить выбранного пользователя из соответствующей роли.</span><span class="sxs-lookup"><span data-stu-id="f7de7-199">When the visitor checks or unchecks a CheckBox in the `UsersRoleList` Repeater we need to add or remove the selected user from the corresponding role.</span></span> <span data-ttu-id="f7de7-200">Флажок `AutoPostBack` в настоящее время задано значение True, то вызывает обратную передачу в любое время в виде флажка в элементу управления Repeater устанавливается или снимается.</span><span class="sxs-lookup"><span data-stu-id="f7de7-200">The CheckBox's `AutoPostBack` property is currently set to True, which causes a postback anytime a CheckBox in the Repeater is checked or unchecked.</span></span> <span data-ttu-id="f7de7-201">Иными словами, необходимо создать обработчик событий к флажку `CheckChanged` событий.</span><span class="sxs-lookup"><span data-stu-id="f7de7-201">In short, we need to create an event handler for the CheckBox's `CheckChanged` event.</span></span> <span data-ttu-id="f7de7-202">Так как он находится в элементе управления Repeater, необходимо вручную добавить магистрали обработчика событий.</span><span class="sxs-lookup"><span data-stu-id="f7de7-202">Since the CheckBox is in a Repeater control, we need to manually add the event handler plumbing.</span></span> <span data-ttu-id="f7de7-203">Начните с добавления обработчика событий в класс фонового кода как `protected` метода, следующим образом:</span><span class="sxs-lookup"><span data-stu-id="f7de7-203">Start by adding the event handler to the code-behind class as a `protected` method, like so:</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample9.cs)]

<span data-ttu-id="f7de7-204">Мы вернемся к написать код для этого обработчика событий чуть позже.</span><span class="sxs-lookup"><span data-stu-id="f7de7-204">We will return to write the code for this event handler in a moment.</span></span> <span data-ttu-id="f7de7-205">Но сначала давайте заполним магистрали обработки событий.</span><span class="sxs-lookup"><span data-stu-id="f7de7-205">But first let's complete the event handling plumbing.</span></span> <span data-ttu-id="f7de7-206">Установки флажка в элементе Repeater `ItemTemplate`, добавьте `OnCheckedChanged="RoleCheckBox_CheckChanged"`.</span><span class="sxs-lookup"><span data-stu-id="f7de7-206">From the CheckBox within the Repeater's `ItemTemplate`, add `OnCheckedChanged="RoleCheckBox_CheckChanged"`.</span></span> <span data-ttu-id="f7de7-207">Связывает этот синтаксис `RoleCheckBox_CheckChanged` в обработчике событий `RoleCheckBox`в `CheckedChanged` событий.</span><span class="sxs-lookup"><span data-stu-id="f7de7-207">This syntax wires the `RoleCheckBox_CheckChanged` event handler to the `RoleCheckBox`'s `CheckedChanged` event.</span></span>

[!code-aspx[Main](assigning-roles-to-users-cs/samples/sample10.aspx)]

<span data-ttu-id="f7de7-208">Наша последняя задача — для завершения `RoleCheckBox_CheckChanged` обработчик событий.</span><span class="sxs-lookup"><span data-stu-id="f7de7-208">Our final task is to complete the `RoleCheckBox_CheckChanged` event handler.</span></span> <span data-ttu-id="f7de7-209">Необходимо запустить, ссылаясь на элемент управления CheckBox, который вызвал событие, так как этот экземпляр флажок указывает, какую роль была проверенный или непроверенный через его `Text` и `Checked` свойства.</span><span class="sxs-lookup"><span data-stu-id="f7de7-209">We need to start by referencing the CheckBox control that raised the event because this CheckBox instance tells us what role was checked or unchecked via its `Text` and `Checked` properties.</span></span> <span data-ttu-id="f7de7-210">Используя эти сведения вместе с именем пользователя для выбранного пользователя, мы добавить или удалить пользователя из роли с помощью `Roles` класса [ `AddUserToRole` ](https://msdn.microsoft.com/library/system.web.security.roles.addusertorole.aspx) или [ `RemoveUserFromRole` метод](https://msdn.microsoft.com/library/system.web.security.roles.removeuserfromrole.aspx).</span><span class="sxs-lookup"><span data-stu-id="f7de7-210">Using this information along with the UserName of the selected user, we add or remove the user from the role via the `Roles` class's [`AddUserToRole`](https://msdn.microsoft.com/library/system.web.security.roles.addusertorole.aspx) or [`RemoveUserFromRole` method](https://msdn.microsoft.com/library/system.web.security.roles.removeuserfromrole.aspx).</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample11.cs)]

<span data-ttu-id="f7de7-211">Приведенный выше код начинается с программного обращения флажок, который вызвал событие, которое доступно через `sender` входного параметра.</span><span class="sxs-lookup"><span data-stu-id="f7de7-211">The above code starts by programmatically referencing the CheckBox that raised the event, which is available via the `sender` input parameter.</span></span> <span data-ttu-id="f7de7-212">Если этот флажок установлен, выбранного пользователя добавляется в указанную роль, в противном случае они удаляются из роли.</span><span class="sxs-lookup"><span data-stu-id="f7de7-212">If the CheckBox is checked, the selected user is added to the specified role, otherwise they are removed from the role.</span></span> <span data-ttu-id="f7de7-213">В любом случае `ActionStatus` метка отображает сообщение, суммирование только что выполненное действие.</span><span class="sxs-lookup"><span data-stu-id="f7de7-213">In either case, the `ActionStatus` Label displays a message summarizing the action just performed.</span></span>

<span data-ttu-id="f7de7-214">Отвлекитесь и проверьте страницу в обозревателе.</span><span class="sxs-lookup"><span data-stu-id="f7de7-214">Take a moment to test out this page through a browser.</span></span> <span data-ttu-id="f7de7-215">Выберите пользователя Tito, а затем добавьте Tito ролям администраторами и руководителями.</span><span class="sxs-lookup"><span data-stu-id="f7de7-215">Select user Tito and then add Tito to both the Administrators and Supervisors roles.</span></span>

<span data-ttu-id="f7de7-216">[![Был добавлен Tito администраторами и руководителями ролей](assigning-roles-to-users-cs/_static/image8.png)](assigning-roles-to-users-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="f7de7-216">[![Tito Has Been Added to the Administrators and Supervisors Roles](assigning-roles-to-users-cs/_static/image8.png)](assigning-roles-to-users-cs/_static/image7.png)</span></span>

<span data-ttu-id="f7de7-217">**Рис. 3**: Был добавлен Tito администраторами и руководителями роли ([Просмотр полноразмерного изображения](assigning-roles-to-users-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="f7de7-217">**Figure 3**: Tito Has Been Added to the Administrators and Supervisors Roles  ([Click to view full-size image](assigning-roles-to-users-cs/_static/image9.png))</span></span>

<span data-ttu-id="f7de7-218">Затем выберите пользователя Брюс из раскрывающегося списка.</span><span class="sxs-lookup"><span data-stu-id="f7de7-218">Next, select user Bruce from the drop-down list.</span></span> <span data-ttu-id="f7de7-219">Обратная передача и элементу управления Repeater флажки обновляются с помощью команды `CheckRolesForSelectedUser`.</span><span class="sxs-lookup"><span data-stu-id="f7de7-219">There is a postback and the Repeater's CheckBoxes are updated via the `CheckRolesForSelectedUser`.</span></span> <span data-ttu-id="f7de7-220">Поскольку Брюс принадлежит каких-либо ролей, флажки сняты.</span><span class="sxs-lookup"><span data-stu-id="f7de7-220">Since Bruce does not yet belong to any roles, the two checkboxes are unchecked.</span></span> <span data-ttu-id="f7de7-221">Затем добавьте Брюс руководителями роли.</span><span class="sxs-lookup"><span data-stu-id="f7de7-221">Next, add Bruce to the Supervisors role.</span></span>

<span data-ttu-id="f7de7-222">[![Брюс была добавлена к роли руководителями](assigning-roles-to-users-cs/_static/image11.png)](assigning-roles-to-users-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="f7de7-222">[![Bruce Has Been Added to the Supervisors Role](assigning-roles-to-users-cs/_static/image11.png)](assigning-roles-to-users-cs/_static/image10.png)</span></span>

<span data-ttu-id="f7de7-223">**Рис. 4**: Брюс была добавлена к роли руководители ([Просмотр полноразмерного изображения](assigning-roles-to-users-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="f7de7-223">**Figure 4**: Bruce Has Been Added to the Supervisors Role  ([Click to view full-size image](assigning-roles-to-users-cs/_static/image12.png))</span></span>

<span data-ttu-id="f7de7-224">Для дальнейшей проверки функциональности `CheckRolesForSelectedUser` метод, выберите пользователя, отличного от Tito или Брюс.</span><span class="sxs-lookup"><span data-stu-id="f7de7-224">To further verify the functionality of the `CheckRolesForSelectedUser` method, select a user other than Tito or Bruce.</span></span> <span data-ttu-id="f7de7-225">Обратите внимание на то, как автоматически сняты флажки, обозначающая, что они не принадлежат ни одной роли.</span><span class="sxs-lookup"><span data-stu-id="f7de7-225">Note how the checkboxes are automatically unchecked, denoting that they do not belong to any roles.</span></span> <span data-ttu-id="f7de7-226">Вернитесь к Tito.</span><span class="sxs-lookup"><span data-stu-id="f7de7-226">Return to Tito.</span></span> <span data-ttu-id="f7de7-227">Следует проверить флажков "Администраторы" или "руководители.</span><span class="sxs-lookup"><span data-stu-id="f7de7-227">Both the Administrators and Supervisors checkboxes should be checked.</span></span>

## <a name="step-2-building-the-by-roles-user-interface"></a><span data-ttu-id="f7de7-228">Шаг 2. Создание пользовательского интерфейса «,» роли</span><span class="sxs-lookup"><span data-stu-id="f7de7-228">Step 2: Building the "By Roles" User Interface</span></span>

<span data-ttu-id="f7de7-229">На этом этапе мы завершили интерфейс «пользователями» и приступить к реализации интерфейса «ролями».</span><span class="sxs-lookup"><span data-stu-id="f7de7-229">At this point we have completed the "by users" interface and are ready to start tackling the "by roles" interface.</span></span> <span data-ttu-id="f7de7-230">Интерфейс «,» роли пользователю будет предложено выбрать роль из раскрывающегося списка, а затем отображает набор пользователей, которые принадлежат к этой роли в элементе управления GridView.</span><span class="sxs-lookup"><span data-stu-id="f7de7-230">The "by roles" interface prompts the user to select a role from a drop-down list and then displays the set of users that belong to that role in a GridView.</span></span>

<span data-ttu-id="f7de7-231">Добавление другого элемента управления DropDownList для `UsersAndRoles.aspx` страницы.</span><span class="sxs-lookup"><span data-stu-id="f7de7-231">Add another DropDownList control to the `UsersAndRoles.aspx` page.</span></span> <span data-ttu-id="f7de7-232">Поместите этот расположенного под элементом управления Repeater, назовите его `RoleList`и задайте его `AutoPostBack` присваивается значение True.</span><span class="sxs-lookup"><span data-stu-id="f7de7-232">Place this one beneath the Repeater control, name it `RoleList`, and set its `AutoPostBack` property to True.</span></span> <span data-ttu-id="f7de7-233">Нижнего уровня, добавьте элемент управления GridView и назовите его `RolesUserList`.</span><span class="sxs-lookup"><span data-stu-id="f7de7-233">Underneath that, add a GridView and name it `RolesUserList`.</span></span> <span data-ttu-id="f7de7-234">Этот GridView будет содержать список пользователей, которые входят в выбранную роль.</span><span class="sxs-lookup"><span data-stu-id="f7de7-234">This GridView will list the users that belong to the selected role.</span></span> <span data-ttu-id="f7de7-235">Присвоить свойству `AutoGenerateColumns` свойство имеет значение false, добавьте поле TemplateField в сетку `Columns` коллекции и задайте его `HeaderText` свойства «Пользователи».</span><span class="sxs-lookup"><span data-stu-id="f7de7-235">Set the GridView's `AutoGenerateColumns` property to False, add a TemplateField to the grid's `Columns` collection, and set its `HeaderText` property to "Users".</span></span> <span data-ttu-id="f7de7-236">Определите TemplateField `ItemTemplate` таким образом, чтобы он отображает значение выражения привязки данных `Container.DataItem` в `Text` свойства элемента управления Label с именем `UserNameLabel`.</span><span class="sxs-lookup"><span data-stu-id="f7de7-236">Define the TemplateField's `ItemTemplate` so that it displays the value of the databinding expression `Container.DataItem` in the `Text` property of a Label named `UserNameLabel`.</span></span>

<span data-ttu-id="f7de7-237">После добавления и настройки GridView, декларативная разметка вашей «по ролям» интерфейса должен выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="f7de7-237">After adding and configuring the GridView, your "by role" interface's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](assigning-roles-to-users-cs/samples/sample12.aspx)]

<span data-ttu-id="f7de7-238">Нам нужно заполнить `RoleList` DropDownList с набором ролей в системе.</span><span class="sxs-lookup"><span data-stu-id="f7de7-238">We need to populate the `RoleList` DropDownList with the set of roles in the system.</span></span> <span data-ttu-id="f7de7-239">Чтобы добиться этого, обновите `BindRolesToList` метода и это привязывает массив строк, возвращаемый `Roles.GetAllRoles` метод `RolesList` DropDownList (а также `UsersRoleList` Repeater).</span><span class="sxs-lookup"><span data-stu-id="f7de7-239">To accomplish this, update the `BindRolesToList` method so that is binds the string array returned by the `Roles.GetAllRoles` method to the `RolesList` DropDownList (as well as the `UsersRoleList` Repeater).</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample13.cs)]

<span data-ttu-id="f7de7-240">Две последние строки в `BindRolesToList` метод были добавлены в набор ролей, чтобы привязать `RoleList` элемента управления DropDownList.</span><span class="sxs-lookup"><span data-stu-id="f7de7-240">The last two lines in the `BindRolesToList` method have been added to bind the set of roles to the `RoleList` DropDownList control.</span></span> <span data-ttu-id="f7de7-241">Рис. 5 показан готовый результат при просмотре через обозреватель — стрелку раскрывающегося списка, заполненный системные роли.</span><span class="sxs-lookup"><span data-stu-id="f7de7-241">Figure 5 shows the end result when viewed through a browser – a drop-down list populated with the system's roles.</span></span>

<span data-ttu-id="f7de7-242">[![Роли отображаются в раскрывающемся списке RoleList](assigning-roles-to-users-cs/_static/image14.png)](assigning-roles-to-users-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="f7de7-242">[![The Roles are Displayed in the RoleList DropDownList](assigning-roles-to-users-cs/_static/image14.png)](assigning-roles-to-users-cs/_static/image13.png)</span></span>

<span data-ttu-id="f7de7-243">**Рис. 5**: Роли отображаются в `RoleList` DropDownList ([Просмотр полноразмерного изображения](assigning-roles-to-users-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="f7de7-243">**Figure 5**: The Roles are Displayed in the `RoleList` DropDownList  ([Click to view full-size image](assigning-roles-to-users-cs/_static/image15.png))</span></span>

### <a name="displaying-the-users-that-belong-to-the-selected-role"></a><span data-ttu-id="f7de7-244">Отображение пользователей, которые принадлежат выбранной роли</span><span class="sxs-lookup"><span data-stu-id="f7de7-244">Displaying the Users That Belong To the Selected Role</span></span>

<span data-ttu-id="f7de7-245">При первой загрузке страницы или при выборе новой роли из `RoleList` DropDownList, нам нужно отобразить список пользователей, принадлежащих этой роли в GridView.</span><span class="sxs-lookup"><span data-stu-id="f7de7-245">When the page is first loaded, or when a new role is selected from the `RoleList` DropDownList, we need to display the list of users that belong to that role in the GridView.</span></span> <span data-ttu-id="f7de7-246">Создайте метод с именем `DisplayUsersBelongingToRole` следующим образом:</span><span class="sxs-lookup"><span data-stu-id="f7de7-246">Create a method named `DisplayUsersBelongingToRole` using the following code:</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample14.cs)]

<span data-ttu-id="f7de7-247">Этот метод начинает с получения выбранной роли из `RoleList` DropDownList.</span><span class="sxs-lookup"><span data-stu-id="f7de7-247">This method starts by getting the selected role from the `RoleList` DropDownList.</span></span> <span data-ttu-id="f7de7-248">Затем он использует [ `Roles.GetUsersInRole(roleName)` метод](https://msdn.microsoft.com/library/system.web.security.roles.getusersinrole.aspx) для получения строкового массива имена пользователей, которые принадлежат к этой роли.</span><span class="sxs-lookup"><span data-stu-id="f7de7-248">It then uses the [`Roles.GetUsersInRole(roleName)` method](https://msdn.microsoft.com/library/system.web.security.roles.getusersinrole.aspx) to retrieve a string array of the UserNames of the users that belong to that role.</span></span> <span data-ttu-id="f7de7-249">Этот массив затем привязывается к `RolesUserList` GridView.</span><span class="sxs-lookup"><span data-stu-id="f7de7-249">This array is then bound to the `RolesUserList` GridView.</span></span>

<span data-ttu-id="f7de7-250">Этот метод должен вызываться в двух случаях: при начальной загрузке страницы и при выбранной ролью в `RoleList` изменения элемента управления DropDownList.</span><span class="sxs-lookup"><span data-stu-id="f7de7-250">This method needs to be called in two circumstances: when the page is initially loaded and when the selected role in the `RoleList` DropDownList changes.</span></span> <span data-ttu-id="f7de7-251">Таким образом, обновление `Page_Load` обработчик событий, чтобы этот метод вызывается после вызова `CheckRolesForSelectedUser`.</span><span class="sxs-lookup"><span data-stu-id="f7de7-251">Therefore, update the `Page_Load` event handler so that this method is invoked after the call to `CheckRolesForSelectedUser`.</span></span> <span data-ttu-id="f7de7-252">Создайте обработчик событий для `RoleList`в `SelectedIndexChanged` событий и вызовите этот метод после этого слишком.</span><span class="sxs-lookup"><span data-stu-id="f7de7-252">Next, create an event handler for the `RoleList`'s `SelectedIndexChanged` event, and call this method from there, too.</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample15.cs)]

<span data-ttu-id="f7de7-253">Этот код в месте `RolesUserList` GridView следует отобразить этих пользователей, которые принадлежат выбранной роли.</span><span class="sxs-lookup"><span data-stu-id="f7de7-253">With this code in place, the `RolesUserList` GridView should display those users that belong to the selected role.</span></span> <span data-ttu-id="f7de7-254">Как показано на рис. 6, руководителями роль состоит из двух элементов: Брюс и Tito.</span><span class="sxs-lookup"><span data-stu-id="f7de7-254">As Figure 6 shows, the Supervisors role consists of two members: Bruce and Tito.</span></span>

<span data-ttu-id="f7de7-255">[![GridView перечисляет тех пользователей, которые принадлежат выбранной роли](assigning-roles-to-users-cs/_static/image17.png)](assigning-roles-to-users-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="f7de7-255">[![The GridView Lists Those Users That Belong to the Selected Role](assigning-roles-to-users-cs/_static/image17.png)](assigning-roles-to-users-cs/_static/image16.png)</span></span>

<span data-ttu-id="f7de7-256">**Рис. 6**: GridView перечислены те пользователи, принадлежат к роли выбран ([Просмотр полноразмерного изображения](assigning-roles-to-users-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="f7de7-256">**Figure 6**: The GridView Lists Those Users That Belong to the Selected Role  ([Click to view full-size image](assigning-roles-to-users-cs/_static/image18.png))</span></span>

### <a name="removing-users-from-the-selected-role"></a><span data-ttu-id="f7de7-257">Идет удаление пользователей из выбранной роли</span><span class="sxs-lookup"><span data-stu-id="f7de7-257">Removing Users from the Selected Role</span></span>

<span data-ttu-id="f7de7-258">Давайте дополнить `RolesUserList` GridView, теперь она содержит столбец «удалить» кнопок.</span><span class="sxs-lookup"><span data-stu-id="f7de7-258">Let's augment the `RolesUserList` GridView so that it includes a column of "Remove" buttons.</span></span> <span data-ttu-id="f7de7-259">Нажав кнопку «Удалить» для конкретного пользователя будут удалены из этой роли.</span><span class="sxs-lookup"><span data-stu-id="f7de7-259">Clicking the "Remove" button for a particular user will remove them from that role.</span></span>

<span data-ttu-id="f7de7-260">Начните с добавления поля кнопки Delete к GridView.</span><span class="sxs-lookup"><span data-stu-id="f7de7-260">Start by adding a Delete button field to the GridView.</span></span> <span data-ttu-id="f7de7-261">Сделать это поле отображаются в виде наиболее архивированного слева и измените его `DeleteText` значение «Удалить» из «Delete» (по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="f7de7-261">Make this field appear as the left most filed and change its `DeleteText` property from "Delete" (the default) to "Remove".</span></span>

<span data-ttu-id="f7de7-262">[![Добавить](assigning-roles-to-users-cs/_static/image20.png)](assigning-roles-to-users-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="f7de7-262">[![Add the](assigning-roles-to-users-cs/_static/image20.png)](assigning-roles-to-users-cs/_static/image19.png)</span></span>

<span data-ttu-id="f7de7-263">**Рис. 7**: Добавьте к элементу GridView кнопка «Удалить» ([Просмотр полноразмерного изображения](assigning-roles-to-users-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="f7de7-263">**Figure 7**: Add the "Remove" Button to the GridView  ([Click to view full-size image](assigning-roles-to-users-cs/_static/image21.png))</span></span>

<span data-ttu-id="f7de7-264">При нажатии кнопки «Удалить» обратная и GridView `RowDeleting` события.</span><span class="sxs-lookup"><span data-stu-id="f7de7-264">When the "Remove" button is clicked a postback ensues and the GridView's `RowDeleting` event is raised.</span></span> <span data-ttu-id="f7de7-265">Нам нужно создать обработчик событий для этого события и написать код, который удаляет пользователя из выбранной роли.</span><span class="sxs-lookup"><span data-stu-id="f7de7-265">We need to create an event handler for this event and write code that removes the user from the selected role.</span></span> <span data-ttu-id="f7de7-266">Создайте обработчик событий и затем добавьте следующий код:</span><span class="sxs-lookup"><span data-stu-id="f7de7-266">Create the event handler and then add the following code:</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample16.cs)]

<span data-ttu-id="f7de7-267">Код начинается с определения имени выбранной роли.</span><span class="sxs-lookup"><span data-stu-id="f7de7-267">The code starts by determining the selected role name.</span></span> <span data-ttu-id="f7de7-268">Затем программным способом ссылки `UserNameLabel` управления была нажата, кнопка «Удалить», чтобы определить имя пользователя, чтобы удалить строки.</span><span class="sxs-lookup"><span data-stu-id="f7de7-268">It then programmatically references the `UserNameLabel` control from the row whose "Remove" button was clicked in order to determine the UserName of the user to remove.</span></span> <span data-ttu-id="f7de7-269">Пользователь был удален из роли через вызов `Roles.RemoveUserFromRole` метод.</span><span class="sxs-lookup"><span data-stu-id="f7de7-269">The user is then removed from the role via a call to the `Roles.RemoveUserFromRole` method.</span></span> <span data-ttu-id="f7de7-270">`RolesUserList` Обновляется GridView и выводится сообщение с помощью `ActionStatus` метки элемента управления.</span><span class="sxs-lookup"><span data-stu-id="f7de7-270">The `RolesUserList` GridView is then refreshed and a message is displayed via the `ActionStatus` Label control.</span></span>

> [!NOTE]
> <span data-ttu-id="f7de7-271">Кнопка «Удалить» не требует каких-либо подтверждения от пользователя, прежде чем удалять пользователя из роли.</span><span class="sxs-lookup"><span data-stu-id="f7de7-271">The "Remove" button does not require any sort of confirmation from the user before removing the user from the role.</span></span> <span data-ttu-id="f7de7-272">Я приглашаю вас добавить некоторый уровень подтверждение пользователя.</span><span class="sxs-lookup"><span data-stu-id="f7de7-272">I invite you to add some level of user confirmation.</span></span> <span data-ttu-id="f7de7-273">Одна из самых простых способов, чтобы подтвердить действие — через диалоговое окно подтверждения на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="f7de7-273">One of the easiest ways to confirm an action is through a client-side confirm dialog box.</span></span> <span data-ttu-id="f7de7-274">Дополнительные сведения об этом приеме см. в разделе [Добавление клиентского подтверждения при Идет удаление](https://asp.net/learn/data-access/tutorial-42-cs.aspx).</span><span class="sxs-lookup"><span data-stu-id="f7de7-274">For more information on this technique, see [Adding Client-Side Confirmation When Deleting](https://asp.net/learn/data-access/tutorial-42-cs.aspx).</span></span>

<span data-ttu-id="f7de7-275">Рис. 8 показана страница после удаления пользователя Tito в группе руководителей.</span><span class="sxs-lookup"><span data-stu-id="f7de7-275">Figure 8 shows the page after user Tito has been removed from the Supervisors group.</span></span>

<span data-ttu-id="f7de7-276">[![Увы Tito больше не начальнику](assigning-roles-to-users-cs/_static/image23.png)](assigning-roles-to-users-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="f7de7-276">[![Alas, Tito is No Longer a Supervisor](assigning-roles-to-users-cs/_static/image23.png)](assigning-roles-to-users-cs/_static/image22.png)</span></span>

<span data-ttu-id="f7de7-277">**Рис. 8**: Увы, Tito больше не начальнику ([Просмотр полноразмерного изображения](assigning-roles-to-users-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="f7de7-277">**Figure 8**: Alas, Tito is No Longer a Supervisor  ([Click to view full-size image](assigning-roles-to-users-cs/_static/image24.png))</span></span>

### <a name="adding-new-users-to-the-selected-role"></a><span data-ttu-id="f7de7-278">Добавление новых пользователей в выбранной роли</span><span class="sxs-lookup"><span data-stu-id="f7de7-278">Adding New Users to the Selected Role</span></span>

<span data-ttu-id="f7de7-279">А также удаление пользователей из выбранной роли, посетителя на эту страницу также сможете Добавление пользователя в выбранной роли.</span><span class="sxs-lookup"><span data-stu-id="f7de7-279">Along with removing users from the selected role, the visitor to this page should also be able to add a user to the selected role.</span></span> <span data-ttu-id="f7de7-280">Лучший интерфейс для добавления в выбранную роль пользователя зависит от числа учетных записей пользователей, которые предполагается наличие.</span><span class="sxs-lookup"><span data-stu-id="f7de7-280">The best interface for adding a user to the selected role depends on the number of user accounts you expect to have.</span></span> <span data-ttu-id="f7de7-281">Если веб-сайт размещается несколько десятков учетных записей или менее, можно использовать здесь элемента управления DropDownList.</span><span class="sxs-lookup"><span data-stu-id="f7de7-281">If your website will house just a few dozen user accounts or less, you could use a DropDownList here.</span></span> <span data-ttu-id="f7de7-282">Если возможно, тысячи учетных записей пользователей, нужно включить пользовательский интерфейс, который позволяет посетителя для постраничного просмотра учетных записей, поиск определенной учетной записи, или фильтрации учетных записей пользователей в каким-либо другим образом.</span><span class="sxs-lookup"><span data-stu-id="f7de7-282">If there might be thousands of user accounts, you would want to include a user interface that permits the visitor to page through the accounts, search for a particular account, or filter the user accounts in some other fashion.</span></span>

<span data-ttu-id="f7de7-283">Для этой страницы используем очень простой интерфейс, работает независимо от числа учетных записей пользователей в системе.</span><span class="sxs-lookup"><span data-stu-id="f7de7-283">For this page let's use a very simple interface that works regardless of the number of user accounts in the system.</span></span> <span data-ttu-id="f7de7-284">А именно мы будем использовать текстовое поле запроса посетителя, чтобы ввести имя пользователя, который она хочет добавить к выбранной роли.</span><span class="sxs-lookup"><span data-stu-id="f7de7-284">Namely, we will use a TextBox, prompting the visitor to type in the username of the user she wants to add to the selected role.</span></span> <span data-ttu-id="f7de7-285">Если пользователь с таким именем не существует, или если пользователь уже является членом роли, мы отобразим сообщение в `ActionStatus` метки.</span><span class="sxs-lookup"><span data-stu-id="f7de7-285">If no user with that name exists, or if the user is already a member of the role, we'll display a message in `ActionStatus` Label.</span></span> <span data-ttu-id="f7de7-286">Но если он существует и не является членом роли, мы обновить сетку и добавить их к роли.</span><span class="sxs-lookup"><span data-stu-id="f7de7-286">But if the user exists and is not a member of the role, we'll add them to the role and refresh the grid.</span></span>

<span data-ttu-id="f7de7-287">Добавьте текстовое поле и кнопку под GridView.</span><span class="sxs-lookup"><span data-stu-id="f7de7-287">Add a TextBox and Button beneath the GridView.</span></span> <span data-ttu-id="f7de7-288">Значение текстового поля `ID` для `UserNameToAddToRole` и задайте кнопки `ID` и `Text` свойства `AddUserToRoleButton` и «Добавление пользователя в роль», соответственно.</span><span class="sxs-lookup"><span data-stu-id="f7de7-288">Set the TextBox's `ID` to `UserNameToAddToRole` and set the Button's `ID` and `Text` properties to `AddUserToRoleButton` and "Add User to Role", respectively.</span></span>

[!code-aspx[Main](assigning-roles-to-users-cs/samples/sample17.aspx)]

<span data-ttu-id="f7de7-289">Создайте `Click` обработчик событий для `AddUserToRoleButton` и добавьте следующий код:</span><span class="sxs-lookup"><span data-stu-id="f7de7-289">Next, create a `Click` event handler for the `AddUserToRoleButton` and add the following code:</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample18.cs)]

<span data-ttu-id="f7de7-290">Большая часть кода в `Click` обработчик событий выполняет различные проверки.</span><span class="sxs-lookup"><span data-stu-id="f7de7-290">The majority of the code in the `Click` event handler performs various validation checks.</span></span> <span data-ttu-id="f7de7-291">Это гарантирует, что посетитель указано имя пользователя в `UserNameToAddToRole` текстовое поле, что пользователь существует в системе, и что уже не входящие в выбранной роли.</span><span class="sxs-lookup"><span data-stu-id="f7de7-291">It ensures that the visitor supplied a username in the `UserNameToAddToRole` TextBox, that the user exists in the system, and that they don't already belong to the selected role.</span></span> <span data-ttu-id="f7de7-292">Если любой из этих проверок завершается ошибкой, соответствующее сообщение отображается в `ActionStatus` и выходе из обработчика событий.</span><span class="sxs-lookup"><span data-stu-id="f7de7-292">If any of these checks fails, an appropriate message is displayed in `ActionStatus` and the event handler is exited.</span></span> <span data-ttu-id="f7de7-293">Если все проверки успешно, пользователь добавляется в роль с помощью `Roles.AddUserToRole` метод.</span><span class="sxs-lookup"><span data-stu-id="f7de7-293">If all of the checks pass, the user is added to the role via the `Roles.AddUserToRole` method.</span></span> <span data-ttu-id="f7de7-294">После этого текстового поля в `Text` свойства очищаются, обновляется GridView и `ActionStatus` метка появится сообщение о том, что указанный пользователь был успешно добавлен в выбранную роль.</span><span class="sxs-lookup"><span data-stu-id="f7de7-294">Following that, the TextBox's `Text` property is cleared out, the GridView is refreshed, and the `ActionStatus` Label displays a message indicating that the specified user was successfully added to the selected role.</span></span>

> [!NOTE]
> <span data-ttu-id="f7de7-295">Чтобы убедиться, что указанный пользователь уже входит в выбранную роль, мы используем [ `Roles.IsUserInRole(userName, roleName)` метод](https://msdn.microsoft.com/library/system.web.security.roles.isuserinrole.aspx), который возвращает логическое значение, указывающее, является ли *имя пользователя* является членом *roleName*.</span><span class="sxs-lookup"><span data-stu-id="f7de7-295">To ensure that the specified user does not already belong to the selected role, we use the [`Roles.IsUserInRole(userName, roleName)` method](https://msdn.microsoft.com/library/system.web.security.roles.isuserinrole.aspx), which returns a Boolean value indicating whether *userName* is a member of *roleName*.</span></span> <span data-ttu-id="f7de7-296">Мы будем использовать этот метод еще раз, в <a id="_msoanchor_2"> </a> [следующему руководству](role-based-authorization-cs.md) Если взглянуть на авторизации на основе ролей.</span><span class="sxs-lookup"><span data-stu-id="f7de7-296">We will use this method again in the <a id="_msoanchor_2"></a>[next tutorial](role-based-authorization-cs.md) when we look at role-based authorization.</span></span>

<span data-ttu-id="f7de7-297">Посетите страницу в обозревателе и выберите роль руководителями из `RoleList` DropDownList.</span><span class="sxs-lookup"><span data-stu-id="f7de7-297">Visit the page through a browser and select the Supervisors role from the `RoleList` DropDownList.</span></span> <span data-ttu-id="f7de7-298">Попробуйте ввести неправильное имя пользователя — вы должны увидеть сообщение о том, что пользователь не существует в системе.</span><span class="sxs-lookup"><span data-stu-id="f7de7-298">Try entering an invalid username – you should see a message explaining that the user does not exist in the system.</span></span>

<span data-ttu-id="f7de7-299">[![Невозможно добавить несуществующий пользователь к роли](assigning-roles-to-users-cs/_static/image26.png)](assigning-roles-to-users-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="f7de7-299">[![You Cannot Add a Non-Existent User to a Role](assigning-roles-to-users-cs/_static/image26.png)](assigning-roles-to-users-cs/_static/image25.png)</span></span>

<span data-ttu-id="f7de7-300">**Рис. 9**: Невозможно добавить пользователя несуществующий роли ([Просмотр полноразмерного изображения](assigning-roles-to-users-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="f7de7-300">**Figure 9**: You Cannot Add a Non-Existent User to a Role  ([Click to view full-size image](assigning-roles-to-users-cs/_static/image27.png))</span></span>

<span data-ttu-id="f7de7-301">Теперь попробуйте добавить допустимого пользователя.</span><span class="sxs-lookup"><span data-stu-id="f7de7-301">Now try adding a valid user.</span></span> <span data-ttu-id="f7de7-302">Теперь добавим повторно Tito руководителями роли.</span><span class="sxs-lookup"><span data-stu-id="f7de7-302">Go ahead and re-add Tito to the Supervisors role.</span></span>

<span data-ttu-id="f7de7-303">[![Tito еще раз является руководителем!](assigning-roles-to-users-cs/_static/image29.png)](assigning-roles-to-users-cs/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="f7de7-303">[![Tito Is Once Again a Supervisor!](assigning-roles-to-users-cs/_static/image29.png)](assigning-roles-to-users-cs/_static/image28.png)</span></span>

<span data-ttu-id="f7de7-304">**Рис. 10**: Tito еще раз является руководителем!</span><span class="sxs-lookup"><span data-stu-id="f7de7-304">**Figure 10**: Tito Is Once Again a Supervisor!</span></span>  <span data-ttu-id="f7de7-305">([Просмотр полноразмерного изображения](assigning-roles-to-users-cs/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="f7de7-305">([Click to view full-size image](assigning-roles-to-users-cs/_static/image30.png))</span></span>

## <a name="step-3-cross-updating-the-by-user-and-by-role-interfaces"></a><span data-ttu-id="f7de7-306">Шаг 3. Обновление нескольких «User» и «роли» интерфейсы</span><span class="sxs-lookup"><span data-stu-id="f7de7-306">Step 3: Cross-Updating the "By User" and "By Role" Interfaces</span></span>

<span data-ttu-id="f7de7-307">`UsersAndRoles.aspx` Страница предлагает два отдельных интерфейсов для управления пользователями и ролями.</span><span class="sxs-lookup"><span data-stu-id="f7de7-307">The `UsersAndRoles.aspx` page offers two distinct interfaces for managing users and roles.</span></span> <span data-ttu-id="f7de7-308">В настоящее время эти два интерфейса действовать независимо друг от друга, так что вполне возможно, что изменения, внесенные в одном интерфейсе будет не будут отражены немедленно в другой.</span><span class="sxs-lookup"><span data-stu-id="f7de7-308">Currently, these two interfaces act independently of one another so it is possible that a change made in one interface will not be reflected immediately in the other.</span></span> <span data-ttu-id="f7de7-309">Например, представьте выбирается посетителя на страницу роли руководителями из `RoleList` DropDownList, в которой перечислены Брюс и Tito в качестве своих членов.</span><span class="sxs-lookup"><span data-stu-id="f7de7-309">For example, imagine that the visitor to the page selects the Supervisors role from the `RoleList` DropDownList, which lists Bruce and Tito as its members.</span></span> <span data-ttu-id="f7de7-310">Затем пользователь выбирает Tito из `UserList` DropDownList, который проверяет флажки «Администраторы» и «руководители в `UsersRoleList` Repeater.</span><span class="sxs-lookup"><span data-stu-id="f7de7-310">Next, the visitor selects Tito from the `UserList` DropDownList, which checks the Administrators and Supervisors checkboxes in the `UsersRoleList` Repeater.</span></span> <span data-ttu-id="f7de7-311">Если посетитель затем снимает роли начальника из элемента управления Repeater, Tito удаляется из роли руководителями, но это изменение не отражается в интерфейсе «по ролям».</span><span class="sxs-lookup"><span data-stu-id="f7de7-311">If the visitor then unchecks the Supervisor role from the Repeater, Tito is removed from the Supervisors role, but this modification is not reflected in the "by role" interface.</span></span> <span data-ttu-id="f7de7-312">GridView по-прежнему будет отображаться Tito как член роли руководителями.</span><span class="sxs-lookup"><span data-stu-id="f7de7-312">The GridView will still show Tito as being a member of the Supervisors role.</span></span>

<span data-ttu-id="f7de7-313">Чтобы исправить это нам нужно обновить GridView, каждый раз, когда роль устанавливается или снимается из `UsersRoleList` Repeater.</span><span class="sxs-lookup"><span data-stu-id="f7de7-313">To fix this we need to refresh the GridView whenever a role is checked or unchecked from the `UsersRoleList` Repeater.</span></span> <span data-ttu-id="f7de7-314">Аналогичным образом нам нужно обновить Repeater всякий раз, когда пользователь удален или добавлен к роли с помощью интерфейса «, роль».</span><span class="sxs-lookup"><span data-stu-id="f7de7-314">Likewise, we need to refresh the Repeater whenever a user is removed or added to a role from the "by role" interface.</span></span>

<span data-ttu-id="f7de7-315">Элемент управления Repeater в интерфейсе «пользователем» обновляется путем вызова `CheckRolesForSelectedUser` метод.</span><span class="sxs-lookup"><span data-stu-id="f7de7-315">The Repeater in the "by user" interface is refreshed by calling the `CheckRolesForSelectedUser` method.</span></span> <span data-ttu-id="f7de7-316">Интерфейс «по ролям» можно изменить в `RolesUserList` GridView `RowDeleting` обработчик событий и `AddUserToRoleButton` кнопки `Click` обработчик событий.</span><span class="sxs-lookup"><span data-stu-id="f7de7-316">The "by role" interface can be modified in the `RolesUserList` GridView's `RowDeleting` event handler and the `AddUserToRoleButton` Button's `Click` event handler.</span></span> <span data-ttu-id="f7de7-317">Таким образом, необходимо вызвать `CheckRolesForSelectedUser` метода из каждого из этих методов.</span><span class="sxs-lookup"><span data-stu-id="f7de7-317">Therefore, we need to call the `CheckRolesForSelectedUser` method from each of these methods.</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample19.cs)]

<span data-ttu-id="f7de7-318">Аналогичным образом, путем вызова обновляется GridView в интерфейсе «по ролям» `DisplayUsersBelongingToRole` метода и интерфейс «пользователем» изменяется посредством `RoleCheckBox_CheckChanged` обработчик событий.</span><span class="sxs-lookup"><span data-stu-id="f7de7-318">Similarly, the GridView in the "by role" interface is refreshed by calling the `DisplayUsersBelongingToRole` method and the "by user" interface is modified through the `RoleCheckBox_CheckChanged` event handler.</span></span> <span data-ttu-id="f7de7-319">Таким образом, необходимо вызвать `DisplayUsersBelongingToRole` метод из этого обработчика событий.</span><span class="sxs-lookup"><span data-stu-id="f7de7-319">Therefore, we need to call the `DisplayUsersBelongingToRole` method from this event handler.</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample20.cs)]

<span data-ttu-id="f7de7-320">Благодаря этим изменениям небольшие «user» и «роли» интерфейсы теперь правильно кросс update.</span><span class="sxs-lookup"><span data-stu-id="f7de7-320">With these minor code changes, the "by user" and "by role" interfaces now correctly cross-update.</span></span> <span data-ttu-id="f7de7-321">Чтобы проверить это, посетите страницу в обозревателе и выберите Tito и руководителей из `UserList` и `RoleList` элементов управления DropDownList, соответственно.</span><span class="sxs-lookup"><span data-stu-id="f7de7-321">To verify this, visit the page through a browser and select Tito and Supervisors from the `UserList` and `RoleList` DropDownLists, respectively.</span></span> <span data-ttu-id="f7de7-322">Обратите внимание на то, что как роль руководителями снимите для Tito из элемента управления Repeater в интерфейсе «пользователем», Tito автоматически удаляется из GridView в интерфейсе «по ролям».</span><span class="sxs-lookup"><span data-stu-id="f7de7-322">Note that as you uncheck the Supervisors role for Tito from the Repeater in the "by user" interface, Tito is automatically removed from the GridView in the "by role" interface.</span></span> <span data-ttu-id="f7de7-323">Повторное добавление Tito обратно к своим руководителям роли из интерфейса «по ролям» автоматически проверяет руководителями флажок в интерфейсе «пользователем».</span><span class="sxs-lookup"><span data-stu-id="f7de7-323">Adding Tito back to the Supervisors role from the "by role" interface automatically re-checks the Supervisors checkbox in the "by user" interface.</span></span>

## <a name="step-4-customizing-the-createuserwizard-to-include-a-specify-roles-step"></a><span data-ttu-id="f7de7-324">Шаг 4. Настройка CreateUserWizard, чтобы включить шаг «Укажите роли»</span><span class="sxs-lookup"><span data-stu-id="f7de7-324">Step 4: Customizing the CreateUserWizard to Include a "Specify Roles" Step</span></span>

<span data-ttu-id="f7de7-325">В <a id="_msoanchor_3"> </a> [ *Создание учетных записей пользователей* ](../membership/creating-user-accounts-cs.md) руководства мы узнали, как использовать элемент управления CreateUserWizard обеспечивает интерфейс для создания учетной записи пользователя.</span><span class="sxs-lookup"><span data-stu-id="f7de7-325">In the <a id="_msoanchor_3"></a>[*Creating User Accounts*](../membership/creating-user-accounts-cs.md) tutorial we saw how to use the CreateUserWizard Web control to provide an interface for creating a new user account.</span></span> <span data-ttu-id="f7de7-326">Элемент управления CreateUserWizard может использоваться в одном из двух способов:</span><span class="sxs-lookup"><span data-stu-id="f7de7-326">The CreateUserWizard control can be used in one of two ways:</span></span>

- <span data-ttu-id="f7de7-327">Как средство для посетителей создать собственную учетную запись пользователя на сайте и</span><span class="sxs-lookup"><span data-stu-id="f7de7-327">As a means for visitors to create their own user account on the site, and</span></span>
- <span data-ttu-id="f7de7-328">Как средство для администраторов создать новые учетные записи</span><span class="sxs-lookup"><span data-stu-id="f7de7-328">As a means for administrators to create new accounts</span></span>

<span data-ttu-id="f7de7-329">В первом варианте использования посетитель входит на сайт и вводит CreateUserWizard, вводит свои данные для регистрации на сайте.</span><span class="sxs-lookup"><span data-stu-id="f7de7-329">In the first use case, a visitor comes to the site and fills out the CreateUserWizard, entering their information in order to register on the site.</span></span> <span data-ttu-id="f7de7-330">Во втором случае администратор создает новую учетную запись для другого лица.</span><span class="sxs-lookup"><span data-stu-id="f7de7-330">In the second case, an administrator creates a new account for another person.</span></span>

<span data-ttu-id="f7de7-331">При создании учетной записи администратором некоторые другие лица, может быть полезно позволить администратору указывать учетную запись пользователя принадлежит к роли.</span><span class="sxs-lookup"><span data-stu-id="f7de7-331">When an account is being created by an administrator for some other person, it might be helpful to allow the administrator to specify what roles the new user account belongs to.</span></span> <span data-ttu-id="f7de7-332">В <a id="_msoanchor_4"> </a> [ *хранение* *Дополнительные сведения о пользователе* ](../membership/storing-additional-user-information-cs.md) мы узнали, как настроить CreateUserWizard, добавляя дополнительные руководства `WizardSteps`.</span><span class="sxs-lookup"><span data-stu-id="f7de7-332">In the <a id="_msoanchor_4"></a>[*Storing* *Additional User Information*](../membership/storing-additional-user-information-cs.md) tutorial we saw how to customize the CreateUserWizard by adding additional `WizardSteps`.</span></span> <span data-ttu-id="f7de7-333">Давайте взглянем на том, как добавить дополнительный шаг в CreateUserWizard, чтобы указать роли нового пользователя.</span><span class="sxs-lookup"><span data-stu-id="f7de7-333">Let's look at how to add an additional step to the CreateUserWizard in order to specify the new user's roles.</span></span>

<span data-ttu-id="f7de7-334">Откройте `CreateUserWizardWithRoles.aspx` странице и добавьте элемент управления CreateUserWizard `RegisterUserWithRoles`.</span><span class="sxs-lookup"><span data-stu-id="f7de7-334">Open the `CreateUserWizardWithRoles.aspx` page and add a CreateUserWizard control named `RegisterUserWithRoles`.</span></span> <span data-ttu-id="f7de7-335">Задайте в качестве `ContinueDestinationPageUrl` свойства «~ / Default.aspx».</span><span class="sxs-lookup"><span data-stu-id="f7de7-335">Set the control's `ContinueDestinationPageUrl` property to "~/Default.aspx".</span></span> <span data-ttu-id="f7de7-336">Поскольку смысл в том, что администратор будет использовать этот элемент управления CreateUserWizard для создания новых учетных записей пользователей, задайте в качестве `LoginCreatedUser` значение False.</span><span class="sxs-lookup"><span data-stu-id="f7de7-336">Because the idea here is that an administrator will be using this CreateUserWizard control to create new user accounts, set the control's `LoginCreatedUser` property to False.</span></span> <span data-ttu-id="f7de7-337">Это `LoginCreatedUser` свойство указывает ли пользователь автоматически входит в систему как пользователь только что созданного и по умолчанию используется значение True.</span><span class="sxs-lookup"><span data-stu-id="f7de7-337">This `LoginCreatedUser` property specifies whether the visitor is automatically logged on as the just-created user, and it defaults to True.</span></span> <span data-ttu-id="f7de7-338">Ей присваивается значение False, когда администратор создает новую учетную запись, мы хотим сохранить его в систему как сам.</span><span class="sxs-lookup"><span data-stu-id="f7de7-338">We set it to False because when an administrator creates a new account we want to keep him signed in as himself.</span></span>

<span data-ttu-id="f7de7-339">Затем выберите «Добавить или удалить `WizardSteps`...» смарт-теге CreateUserWizard и добавьте новый `WizardStep`, устанавливая его `ID` для `SpecifyRolesStep`.</span><span class="sxs-lookup"><span data-stu-id="f7de7-339">Next, select the "Add/Remove `WizardSteps`…" option from the CreateUserWizard's Smart Tag and add a new `WizardStep`, setting its `ID` to `SpecifyRolesStep`.</span></span> <span data-ttu-id="f7de7-340">Переместить `SpecifyRolesStep WizardStep` таким образом, речь идет после шага «Входа для создания новой учетной записи», но до шага «Complete».</span><span class="sxs-lookup"><span data-stu-id="f7de7-340">Move the `SpecifyRolesStep WizardStep` so that it comes after the "Sign Up for Your New Account" step, but before the "Complete" step.</span></span> <span data-ttu-id="f7de7-341">Задайте `WizardStep` `Title` свойства «Укажите роли», его `StepType` свойства `Step`и его `AllowReturn` значение False.</span><span class="sxs-lookup"><span data-stu-id="f7de7-341">Set the `WizardStep`'s `Title` property to "Specify Roles", its `StepType` property to `Step`, and its `AllowReturn` property to False.</span></span>

<span data-ttu-id="f7de7-342">[![Добавить](assigning-roles-to-users-cs/_static/image32.png)](assigning-roles-to-users-cs/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="f7de7-342">[![Add the](assigning-roles-to-users-cs/_static/image32.png)](assigning-roles-to-users-cs/_static/image31.png)</span></span>

<span data-ttu-id="f7de7-343">**Рис. 11**: Добавьте «Укажите роли» `WizardStep` для CreateUserWizard ([Просмотр полноразмерного изображения](assigning-roles-to-users-cs/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="f7de7-343">**Figure 11**: Add the "Specify Roles" `WizardStep` to the CreateUserWizard  ([Click to view full-size image](assigning-roles-to-users-cs/_static/image33.png))</span></span>

<span data-ttu-id="f7de7-344">После этого изменения вашей CreateUserWizard декларативная разметка должна выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="f7de7-344">After this change your CreateUserWizard's declarative markup should look like the following:</span></span>

[!code-aspx[Main](assigning-roles-to-users-cs/samples/sample21.aspx)]

<span data-ttu-id="f7de7-345">В «Укажите роли» `WizardStep`, добавьте CheckBoxList с именем `RoleList`.</span><span class="sxs-lookup"><span data-stu-id="f7de7-345">In the "Specify Roles" `WizardStep`, add a CheckBoxList named `RoleList`.</span></span> <span data-ttu-id="f7de7-346">Этот CheckBoxList перечислит доступные роли, включение person, посетив страницу проверить только что созданный пользователь принадлежит к роли.</span><span class="sxs-lookup"><span data-stu-id="f7de7-346">This CheckBoxList will list the available roles, enabling the person visiting the page to check what roles the newly created user belongs to.</span></span>

<span data-ttu-id="f7de7-347">Мы остается две задачи кодирования: мы должны заполнить `RoleList` CheckBoxList с ролями в системе; во-вторых, необходимо добавить созданным пользователем для выбранных ролей, когда пользователь перемещает на шаге «Укажите роли» шаг «Завершить».</span><span class="sxs-lookup"><span data-stu-id="f7de7-347">We are left with two coding tasks: first we must populate the `RoleList` CheckBoxList with the roles in the system; second, we need to add the created user to the selected roles when the user moves from the "Specify Roles" step to the "Complete" step.</span></span> <span data-ttu-id="f7de7-348">Первая задача в можно достичь `Page_Load` обработчик событий.</span><span class="sxs-lookup"><span data-stu-id="f7de7-348">We can accomplish the first task in the `Page_Load` event handler.</span></span> <span data-ttu-id="f7de7-349">В следующем примере кода программным образом ссылки `RoleList` флажок на первом просмотре страницы и привязывает роли в системе, к нему.</span><span class="sxs-lookup"><span data-stu-id="f7de7-349">The following code programmatically references the `RoleList` CheckBox on the first visit to the page and binds the roles in the system to it.</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample22.cs)]

<span data-ttu-id="f7de7-350">Приведенный выше код должен выглядеть знакомы.</span><span class="sxs-lookup"><span data-stu-id="f7de7-350">The above code should look familiar.</span></span> <span data-ttu-id="f7de7-351">В <a id="_msoanchor_5"> </a> [ *хранение* *Дополнительные сведения о пользователе* ](../membership/storing-additional-user-information-cs.md) руководстве мы использовали две `FindControl` инструкций для ссылки на веб-элемент управления из в пределах пользовательского `WizardStep`.</span><span class="sxs-lookup"><span data-stu-id="f7de7-351">In the <a id="_msoanchor_5"></a>[*Storing* *Additional User Information*](../membership/storing-additional-user-information-cs.md) tutorial we used two `FindControl` statements to reference a Web control from within a custom `WizardStep`.</span></span> <span data-ttu-id="f7de7-352">И код, который выполняет привязку роли к CheckBoxList был взят из этого руководства.</span><span class="sxs-lookup"><span data-stu-id="f7de7-352">And the code that binds the roles to the CheckBoxList was taken from earlier in this tutorial.</span></span>

<span data-ttu-id="f7de7-353">Для выполнения второй задачи программирования, нам необходимо знать, если были завершены на шаге «Укажите роли».</span><span class="sxs-lookup"><span data-stu-id="f7de7-353">In order to perform the second programming task we need to know when the "Specify Roles" step has been completed.</span></span> <span data-ttu-id="f7de7-354">Вспомним, что имеет CreateUserWizard `ActiveStepChanged` ObjectDataSource, который запускается каждый раз, когда посетитель переходит от одного шага к другому.</span><span class="sxs-lookup"><span data-stu-id="f7de7-354">Recall that the CreateUserWizard has an `ActiveStepChanged` event, which fires each time the visitor navigates from one step to another.</span></span> <span data-ttu-id="f7de7-355">Здесь мы можем определить, если пользователь достиг шаг «Завершить»; Если Да, нам нужно добавить пользователя в выбранных ролей.</span><span class="sxs-lookup"><span data-stu-id="f7de7-355">Here we can determine if the user has reached the "Complete" step; if so, we need to add the user to the selected roles.</span></span>

<span data-ttu-id="f7de7-356">Создайте обработчик событий для `ActiveStepChanged` событий и добавьте следующий код:</span><span class="sxs-lookup"><span data-stu-id="f7de7-356">Create an event handler for the `ActiveStepChanged` event and add the following code:</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample23.cs)]

<span data-ttu-id="f7de7-357">Если пользователь просто достиг на шаге «Завершено», обработчик событий перечисляет элементы `RoleList` CheckBoxList и только что созданного пользователя присваивается выбранных ролей.</span><span class="sxs-lookup"><span data-stu-id="f7de7-357">If the user has just reached the "Completed" step, the event handler enumerates the items of the `RoleList` CheckBoxList and the just-created user is assigned to the selected roles.</span></span>

<span data-ttu-id="f7de7-358">Посетите эту страницу через обозреватель.</span><span class="sxs-lookup"><span data-stu-id="f7de7-358">Visit this page through a browser.</span></span> <span data-ttu-id="f7de7-359">Первым шагом в CreateUserWizard — это стандартный шаг «Входа для создания новой учетной записи», который запрашивает имя пользователя нового пользователя, пароль, электронной почты и другую ключевую информацию.</span><span class="sxs-lookup"><span data-stu-id="f7de7-359">The first step in the CreateUserWizard is the standard "Sign Up for Your New Account" step, which prompts for the new user's username, password, email, and other key information.</span></span> <span data-ttu-id="f7de7-360">Введите сведения, чтобы создать нового пользователя с именем Ванда.</span><span class="sxs-lookup"><span data-stu-id="f7de7-360">Enter the information to create a new user named Wanda.</span></span>

<span data-ttu-id="f7de7-361">[![Создайте нового пользователя с именем Ванда](assigning-roles-to-users-cs/_static/image35.png)](assigning-roles-to-users-cs/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="f7de7-361">[![Create a New User Named Wanda](assigning-roles-to-users-cs/_static/image35.png)](assigning-roles-to-users-cs/_static/image34.png)</span></span>

<span data-ttu-id="f7de7-362">**Рис. 12**: Создание нового пользователя с именем Ванда ([Просмотр полноразмерного изображения](assigning-roles-to-users-cs/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="f7de7-362">**Figure 12**: Create a New User Named Wanda  ([Click to view full-size image](assigning-roles-to-users-cs/_static/image36.png))</span></span>

<span data-ttu-id="f7de7-363">Нажмите кнопку «Create User».</span><span class="sxs-lookup"><span data-stu-id="f7de7-363">Click the "Create User" button.</span></span> <span data-ttu-id="f7de7-364">CreateUserWizard внутренне вызывает `Membership.CreateUser` метод, создание новой учетной записи пользователя, а затем переходит к следующему шагу, «укажите роли.»</span><span class="sxs-lookup"><span data-stu-id="f7de7-364">The CreateUserWizard internally calls the `Membership.CreateUser` method, creating the new user account, and then progresses to the next step, "Specify Roles."</span></span> <span data-ttu-id="f7de7-365">Ниже перечислены системные роли.</span><span class="sxs-lookup"><span data-stu-id="f7de7-365">Here the system roles are listed.</span></span> <span data-ttu-id="f7de7-366">Установите флажок "руководители" и нажмите кнопку Далее.</span><span class="sxs-lookup"><span data-stu-id="f7de7-366">Check the Supervisors checkbox and click Next.</span></span>

<span data-ttu-id="f7de7-367">[![Сделать членом роли руководителями Ванда](assigning-roles-to-users-cs/_static/image38.png)](assigning-roles-to-users-cs/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="f7de7-367">[![Make Wanda a Member of the Supervisors Role](assigning-roles-to-users-cs/_static/image38.png)](assigning-roles-to-users-cs/_static/image37.png)</span></span>

<span data-ttu-id="f7de7-368">**Рис. 13**: Сделать членом роли руководителями Ванда ([Просмотр полноразмерного изображения](assigning-roles-to-users-cs/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="f7de7-368">**Figure 13**: Make Wanda a Member of the Supervisors Role  ([Click to view full-size image](assigning-roles-to-users-cs/_static/image39.png))</span></span>

<span data-ttu-id="f7de7-369">Нажав кнопку Далее вызывает обратную передачу и обновления `ActiveStep` шаг «Завершить».</span><span class="sxs-lookup"><span data-stu-id="f7de7-369">Clicking Next causes a postback and updates the `ActiveStep` to the "Complete" step.</span></span> <span data-ttu-id="f7de7-370">В `ActiveStepChanged` обработчик событий, недавно созданные учетной записи назначена роль руководителями.</span><span class="sxs-lookup"><span data-stu-id="f7de7-370">In the `ActiveStepChanged` event handler, the recently-created user account is assigned to the Supervisors role.</span></span> <span data-ttu-id="f7de7-371">Чтобы проверить это, нужно вернуть `UsersAndRoles.aspx` и укажите руководителями из `RoleList` DropDownList.</span><span class="sxs-lookup"><span data-stu-id="f7de7-371">To verify this, return to the `UsersAndRoles.aspx` page and select Supervisors from the `RoleList` DropDownList.</span></span> <span data-ttu-id="f7de7-372">Как показано на рис. 14, Супервизоров теперь состоят из трех пользователей: Брюс Tito и Ванда.</span><span class="sxs-lookup"><span data-stu-id="f7de7-372">As Figure 14 shows, the Supervisors are now made up of three users: Bruce, Tito, and Wanda.</span></span>

<span data-ttu-id="f7de7-373">[![Брюс Tito и Ванда являются все руководители](assigning-roles-to-users-cs/_static/image41.png)](assigning-roles-to-users-cs/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="f7de7-373">[![Bruce, Tito, and Wanda are All Supervisors](assigning-roles-to-users-cs/_static/image41.png)](assigning-roles-to-users-cs/_static/image40.png)</span></span>

<span data-ttu-id="f7de7-374">**Рис. 14**: Брюс Tito и Ванда являются все руководители ([Просмотр полноразмерного изображения](assigning-roles-to-users-cs/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="f7de7-374">**Figure 14**: Bruce, Tito, and Wanda are All Supervisors  ([Click to view full-size image](assigning-roles-to-users-cs/_static/image42.png))</span></span>

## <a name="summary"></a><span data-ttu-id="f7de7-375">Сводка</span><span class="sxs-lookup"><span data-stu-id="f7de7-375">Summary</span></span>

<span data-ttu-id="f7de7-376">Платформа framework ролей предоставляет методы для получения сведений о ролях и методы для определения, какие пользователи являются членами указанной роли конкретного пользователя.</span><span class="sxs-lookup"><span data-stu-id="f7de7-376">The Roles framework offers methods for retrieving information about a particular user's roles and methods for determining what users belong to a specified role.</span></span> <span data-ttu-id="f7de7-377">Кроме того существует ряд методов для добавления и удаления одного или нескольких пользователей для одной или нескольких ролей.</span><span class="sxs-lookup"><span data-stu-id="f7de7-377">Furthermore, there are a number of methods for adding and removing one or more users to one or more roles.</span></span> <span data-ttu-id="f7de7-378">В этом руководстве были рассмотрены только два из этих методов: `AddUserToRole` и `RemoveUserFromRole`.</span><span class="sxs-lookup"><span data-stu-id="f7de7-378">In this tutorial we focused on just two of these methods: `AddUserToRole` and `RemoveUserFromRole`.</span></span> <span data-ttu-id="f7de7-379">Существуют дополнительные варианты, добавление нескольких пользователей одной роли и назначить несколько ролей для одного пользователя.</span><span class="sxs-lookup"><span data-stu-id="f7de7-379">There are additional variants designed to add multiple users to a single role and to assign multiple roles to a single user.</span></span>

<span data-ttu-id="f7de7-380">Этот учебник также включены внимание на расширение для включения элемента управления CreateUserWizard `WizardStep` для указания роли вновь созданный пользователь.</span><span class="sxs-lookup"><span data-stu-id="f7de7-380">This tutorial also included a look at extending the CreateUserWizard control to include a `WizardStep` to specify the newly-created user's roles.</span></span> <span data-ttu-id="f7de7-381">Такого шага может помочь ускорить процесс создания учетных записей пользователей для новых пользователей администратора.</span><span class="sxs-lookup"><span data-stu-id="f7de7-381">Such a step could help an administrator streamline the process of creating user accounts for new users.</span></span>

<span data-ttu-id="f7de7-382">На этом этапе мы видели, как создавать и удалять роли и как добавлять и удалять пользователей из ролей.</span><span class="sxs-lookup"><span data-stu-id="f7de7-382">At this point we have seen how to create and delete roles and how to add and remove users from roles.</span></span> <span data-ttu-id="f7de7-383">Но у нас есть еще рассмотрим применение авторизации на основе ролей.</span><span class="sxs-lookup"><span data-stu-id="f7de7-383">But we have yet to look at applying role-based authorization.</span></span> <span data-ttu-id="f7de7-384">В <a id="_msoanchor_6"> </a> [этом руководстве](role-based-authorization-cs.md) мы рассмотрим определение правила авторизации URL-адрес на основе ролей, роли, также как ограничивать его функциональные возможности уровня страницы на основе ролей выполнившего вход пользователя.</span><span class="sxs-lookup"><span data-stu-id="f7de7-384">In the <a id="_msoanchor_6"></a>[following tutorial](role-based-authorization-cs.md) we will look at defining URL authorization rules on a role-by-role basis, as well as how to limit page-level functionality based on the currently logged in user's roles.</span></span>

<span data-ttu-id="f7de7-385">Счастливого вам программирования!</span><span class="sxs-lookup"><span data-stu-id="f7de7-385">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="f7de7-386">Дополнительные сведения</span><span class="sxs-lookup"><span data-stu-id="f7de7-386">Further Reading</span></span>

<span data-ttu-id="f7de7-387">Дополнительные сведения по темам, обсуждавшимся в этом руководстве см. в следующих ресурсах:</span><span class="sxs-lookup"><span data-stu-id="f7de7-387">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="f7de7-388">Обзор средства администрирования веб-сайта ASP.NET</span><span class="sxs-lookup"><span data-stu-id="f7de7-388">ASP.NET Web Site Administration Tool Overview</span></span>](https://msdn.microsoft.com/library/ms228053.aspx)
- [<span data-ttu-id="f7de7-389">Проверка ASP. NET членства, ролей и профиля</span><span class="sxs-lookup"><span data-stu-id="f7de7-389">Examining ASP.NET's Membership, Roles, and Profile</span></span>](http://aspnet.4guysfromrolla.com/articles/120705-1.aspx)
- [<span data-ttu-id="f7de7-390">Развертывание собственного средства администрирования веб-сайта</span><span class="sxs-lookup"><span data-stu-id="f7de7-390">Rolling Your Own Website Administration Tool</span></span>](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx)

### <a name="about-the-author"></a><span data-ttu-id="f7de7-391">Об авторе</span><span class="sxs-lookup"><span data-stu-id="f7de7-391">About the Author</span></span>

<span data-ttu-id="f7de7-392">Скотт Митчелл, автор нескольких книг по ASP/ASP.NET и основатель веб-узла 4GuysFromRolla.com, работает с веб-технологиями Microsoft с 1998 года.</span><span class="sxs-lookup"><span data-stu-id="f7de7-392">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="f7de7-393">Скотт — независимый консультант, преподаватель и автор.</span><span class="sxs-lookup"><span data-stu-id="f7de7-393">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="f7de7-394">Его последняя книга —  *[Sams Teach ASP.NET 2.0 in 24 часа](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span><span class="sxs-lookup"><span data-stu-id="f7de7-394">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="f7de7-395">Скоттом можно связаться по адресу [ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com) или через его блог по адресу [ http://ScottOnWriting.NET ](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="f7de7-395">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="f7de7-396">Особая благодарность</span><span class="sxs-lookup"><span data-stu-id="f7de7-396">Special Thanks To…</span></span>

<span data-ttu-id="f7de7-397">В этой серии руководств пособий рецензировалась многими компетентными редакторами.</span><span class="sxs-lookup"><span data-stu-id="f7de7-397">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="f7de7-398">Основной рецензент этого учебного был Мерфи Терезой.</span><span class="sxs-lookup"><span data-stu-id="f7de7-398">Lead reviewer for this tutorial was Teresa Murphy.</span></span> <span data-ttu-id="f7de7-399">Хотите поработать с моих последующих статей для MSDN?</span><span class="sxs-lookup"><span data-stu-id="f7de7-399">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="f7de7-400">Если Да, напишите мне [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="f7de7-400">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="f7de7-401">[Назад](creating-and-managing-roles-cs.md)
> [Вперед](role-based-authorization-cs.md)</span><span class="sxs-lookup"><span data-stu-id="f7de7-401">[Previous](creating-and-managing-roles-cs.md)
[Next](role-based-authorization-cs.md)</span></span>
