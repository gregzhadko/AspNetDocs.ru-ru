---
uid: web-forms/overview/older-versions-security/membership/creating-user-accounts-vb
title: Создание учетных записей пользователей (Visual Basic) | Документация Майкрософт
author: rick-anderson
description: В этом руководстве мы рассмотрим использование структуры членства (через SqlMembershipProvider) для создания новых учетных записей пользователей. Будет показано, как создавать новые нам...
ms.author: riande
ms.date: 01/18/2008
ms.assetid: 9ef3e893-bebe-4b13-9fe5-8b71720dd85e
msc.legacyurl: /web-forms/overview/older-versions-security/membership/creating-user-accounts-vb
msc.type: authoredcontent
ms.openlocfilehash: 95231452831b5e328447709fad0329f63ae7a9f5
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/09/2019
ms.locfileid: "59395827"
---
# <a name="creating-user-accounts-vb"></a>Создание учетных записей пользователей (VB)

по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Скачать код](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_05_VB.zip) или [скачать PDF](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial05_CreatingUsers_vb.pdf)

> В этом руководстве мы рассмотрим использование структуры членства (через SqlMembershipProvider) для создания новых учетных записей пользователей. Будет показано, как для создания новых пользователей, программно и с помощью ASP. NET встроенного элемента управления CreateUserWizard.


## <a name="introduction"></a>Вступление

В <a id="_msoanchor_1"> </a> [предыдущем учебном курсе](creating-the-membership-schema-in-sql-server-vb.md) мы установили схему служб приложения в базе данных, в которой добавляются таблицы, представления и хранимые процедуры, необходимые для `SqlMembershipProvider` и `SqlRoleProvider`. Она создана инфраструктурой, нам понадобится для оставшейся части руководства в этой серии. В этом руководстве мы рассмотрим, с помощью структуры членства (через `SqlMembershipProvider`) для создания новых учетных записей пользователей. Будет показано, как для создания новых пользователей, программно и с помощью ASP. NET встроенного элемента управления CreateUserWizard.

В нем описан способ создания новых учетных записей пользователей, мы также потребуется обновить демонстрационный веб-сайт, сначала мы создали в *<a id="_msoanchor_2"> </a> [Обзор аутентификации форм](../introduction/an-overview-of-forms-authentication-vb.md)* руководства и затем расширять *<a id="_msoanchor_3"> </a> [конфигурацию проверки подлинности форм и дополнительные разделы](../introduction/forms-authentication-configuration-and-advanced-topics-vb.md)* руководства. Наш демонстрационный веб-приложение имеет страницу входа, который проверяет учетные данные пользователей с жестко имя пользователя и пароль. Кроме того `Global.asax` содержит код, который создает пользовательские `IPrincipal` и `IIdentity` объекты для прошедших проверку пользователей. Мы будем обновлять страницы входа для проверки учетных данных пользователей от структуры членства и удалите настраиваемую логику субъектов и удостоверений.

Давайте начнем!

## <a name="the-forms-authentication-and-membership-checklist"></a>Проверка подлинности форм и контрольный список членства

Прежде чем начать работу с структуру членства, давайте Отвлекитесь и просмотрите важные действия, предпринятые для достижения этой точки. При использовании структуры членства с `SqlMembershipProvider` в сценарии проверки подлинности на основе форм, необходимо выполнить перед применением функции членства в веб-приложении следующие действия:

1. **Включите проверку подлинности на основе форм.** Как уже говорилось в  *<a id="_msoanchor_4"> </a> [Обзор аутентификации форм](../introduction/an-overview-of-forms-authentication-vb.md)*, изменив включена проверка подлинности forms `Web.config` и параметр `<authentication>` элемента `mode` атрибут `Forms`. С включенной проверкой подлинности форм, каждого входящего запроса проверяется на наличие *подлинности форм*, если он имеется, определяющий запрашивающей стороне.
2. **Добавьте схему служб приложения в соответствующей базе данных.** При использовании `SqlMembershipProvider` нам нужно установить схему служб приложения к базе данных. Обычно это схема добавляется в той же базе данных, которая содержит модель данных приложения. *<a id="_msoanchor_5"> </a> [Создание схемы членства в SQL Server](creating-the-membership-schema-in-sql-server-vb.md)* руководстве рассмотрели применение `aspnet_regsql.exe` средство для выполнения этой задачи.
3. **Настройка параметров веб-приложения для ссылки на базу данных из шага 2.** *Создание схемы членства в SQL Server* руководстве был два способа настройки веб-приложения, чтобы `SqlMembershipProvider` использовать базы данных, выбранной на шаге 2: путем изменения `LocalSqlServer` имя строки подключения; или путем добавления нового зарегистрированного поставщика в список поставщиков членства framework и настройка этого нового поставщика для использования базы данных из шага 2.

При построении веб-приложения, в котором используются `SqlMembershipProvider` и проверки подлинности на основе форм, необходимо выполнить следующие три шага, прежде чем использовать `Membership` класса или элементы управления ASP.NET Login Web. Так как мы уже выполнили эти шаги в предыдущих учебных курсах, мы готовы начать использовать платформу членства!

## <a name="step-1-adding-new-aspnet-pages"></a>Шаг 1. Добавление новых страниц ASP.NET

В этом учебнике и трех последующих мы остановимся подробнее различных функций для работы с членством и возможности. Нам понадобится несколько страниц ASP.NET для реализации в разделах, проверены в данных учебных курсах. Давайте создадим эти страницы, а затем файл карты узла `(Web.sitemap)`.

Начнем с создания новой папки в проект с именем `Membership`. Добавьте пять новых страниц ASP.NET к `Membership` папке связывания каждой страницы с `Site.master` главной страницы. Имя страницы:

- `CreatingUserAccounts.aspx`
- `UserBasedAuthorization.aspx`
- `EnhancedCreateUserWizard.aspx`
- `AdditionalUserInfo.aspx`
- `Guestbook.aspx`

На этом этапе проекта обозреватель решений должен выглядеть снимок экрана, показанный на рис. 1.


[![FНовые страницы были добавлены в папку членства ивный](creating-user-accounts-vb/_static/image2.png)](creating-user-accounts-vb/_static/image1.png)

**Рис. 1**: Пять новых страниц были добавлены `Membership` папку ([Просмотр полноразмерного изображения](creating-user-accounts-vb/_static/image3.png))


Каждая страница на этом этапе у двух элементов управления содержимым, одной для каждого из элементов управления ContentPlaceHolder на главной странице: `MainContent` и `LoginContent`.

[!code-aspx[Main](creating-user-accounts-vb/samples/sample1.aspx)]

Помните, что `LoginContent` разметки по умолчанию элемента ContentPlaceHolder отображает ссылку на входе или выходе из системы сайта, в зависимости от того, является ли пользователь проверку подлинности. Наличие `Content2` элемента управления содержимым, тем не менее, переопределяет разметки по умолчанию на главной странице. Как уже говорилось в *<a id="_msoanchor_6"> </a> [Обзор аутентификации форм](../introduction/an-overview-of-forms-authentication-vb.md)* руководстве это полезно в страницах, где мы не хотим отобразить параметры, связанные с входом в левом столбце.

Для этих пяти страниц, тем не менее, мы хотим Показать разметки главной страницы по умолчанию для `LoginContent` ContentPlaceHolder. Таким образом, удалить декларативная разметка для `Content2` содержимого элемента управления. После этого, каждый из пяти страницы разметки должен содержать только один элемент управления содержимым.

## <a name="step-2-creating-the-site-map"></a>Шаг 2. Создание карты сайта

Все, кроме самых тривиальных веб-сайтов необходимо реализовать определенные виды Навигационный пользовательский интерфейс. Пользовательский интерфейс навигации может быть простой список ссылок на различные разделы веб-узла. Кроме того эти ссылки могут быть организованы в меню или представления в виде дерева. Как разработчикам страниц Создание Навигационный пользовательский интерфейс — только половина истории. Необходимо также некоторые средства для определения логической структуры веб-узла в режиме поддержки и может обновляться. Добавляются новые страницы или удалении существующих страниц, мы хотим иметь возможность обновлять единый источник - карта узла — и отражать эти изменения между Навигационный пользовательский интерфейс веб-узла.

Эти две задачи — Определение карту узла и реализация Навигационный пользовательский интерфейс на основе карты узла — легко осуществить благодаря framework карту узла и Интернете навигации управляет добавлена в ASP.NET версии 2.0. Карты узла платформа позволяет разработчику определить карту узла и затем доступ к нему через программный интерфейс API ( [ `SiteMap` класс](https://msdn.microsoft.com/library/system.web.sitemap.aspx)). Встроенная навигации веб-элементы управления включают [управления "меню"](https://msdn.microsoft.com/library/bz09dy46.aspx), [элемента управления TreeView](https://msdn.microsoft.com/library/3eafky27.aspx)и [управления SiteMapPath](https://msdn.microsoft.com/library/3eafky27.aspx).

Как платформы членства и ролей, карты узла платформа строится поверх [модель поставщика](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx). Задача класс поставщика карты узла — для создания структуры в памяти, используемый `SiteMap` класс из в хранилище постоянных данных, например XML-файл или таблицу базы данных. .NET Framework поставляется с поставщиком карты узла по умолчанию, который считывает данные карты узла из XML-файл ([`XmlSiteMapProvider`](https://msdn.microsoft.com/library/system.web.xmlsitemapprovider.aspx)), и это поставщик, мы будем использовать в этом руководстве. Некоторые альтернативные реализации поставщика карты узла см в разделе Дополнительные материалы в конце этого руководства.

Поставщик карты узла по умолчанию ожидает, что правильно сформированный файл XML с именем `Web.sitemap` должно существовать в корневом каталоге. Поскольку мы используем этот поставщик по умолчанию, необходимо добавить такой файл и определить структуре карты узла в соответствующем формате XML. Чтобы добавить файл, щелкните правой кнопкой мыши имя проекта в обозревателе решений и выберите Add New Item. В диалоговом окне Repeater выберите файл карты узла с именем типа `Web.sitemap`.


[![Aдд файл с именем Web.sitemap корневой каталог проекта](creating-user-accounts-vb/_static/image5.png)](creating-user-accounts-vb/_static/image4.png)

**Рис. 2**: Добавьте файл с именем `Web.sitemap` корневой каталог проекта ([Просмотр полноразмерного изображения](creating-user-accounts-vb/_static/image6.png))


Файл карты узла XML определяет структуру веб сайта в иерархии. Эта иерархическую связь моделируется в XML-файле через происхождение из `<siteMapNode>` элементов. `Web.sitemap` Должно начинаться с `<siteMap>` родительский узел, который имеет ровно один `<siteMapNode>` дочерних. Этом верхнего уровня `<siteMapNode>` элемент представляет корень иерархии, а также может иметь произвольное число узлов-потомков. Каждый `<siteMapNode>` элемент должен включать `title` атрибут и может включать `url` и `description` атрибуты, помимо прочих; каждой непустой `url` атрибут должен быть уникальным.

Введите следующий код XML в `Web.sitemap` файла:

[!code-xml[Main](creating-user-accounts-vb/samples/sample2.xml)]

Приведенная выше разметка карта узла определяет иерархии, показанной на рис. 3.


[![Tон карты узла представляет иерархическая структура переходов](creating-user-accounts-vb/_static/image8.png)](creating-user-accounts-vb/_static/image7.png)

**Рис. 3**: Карта узла — иерархическая структура переходов ([Просмотр полноразмерного изображения](creating-user-accounts-vb/_static/image9.png))


## <a name="step-3-updating-the-master-page-to-include-a-navigational-user-interface"></a>Шаг 3. Обновление главной страницы для включения Навигационный пользовательский интерфейс

ASP.NET включает несколько связанных с навигацией веб-элементов управления по проектированию пользовательского интерфейса. К ним относятся, меню, TreeView и SiteMapPath. Элементы управления Menu и TreeView отображаются структуре карты узла в меню или дерева, соответственно, в то время как SiteMapPath отображает навигатором, показывающий посещение которого выполняется, а также его предки текущего узла. Данные карты узла могут быть привязаны к другим данным, веб-элементов управления с помощью SiteMapDataSource и может осуществляться программно через `SiteMap` класса.

Так как подробное обсуждение framework карты узла, а также элементы управления навигацией выходит за рамки этой серии руководств, а не тратить время, давайте составления собственный Навигационный пользовательский интерфейс на вместо позаимствовать использованному в моей *[ Работа с данными в ASP.NET 2.0](../../data-access/index.md)* серии руководств, который используется элементом управления Repeater для отображения двух глубокого маркированного списка ссылок навигации, как показано на рис. 4.

### <a name="adding-a-two-level-list-of-links-in-the-left-column"></a>Добавление двух уровней список ссылок в левом столбце

Чтобы создать этот интерфейс, добавьте к следующей декларативной разметке `Site.master` главной страницы левом столбце где текст TODO: Сюда будет отправляться меню... в настоящее время находится.

[!code-aspx[Main](creating-user-accounts-vb/samples/sample3.aspx)]

Приведенная выше разметка привязывает элемент управления Repeater, с именем `menu` к SiteMapDataSource, который возвращает иерархии карты узла, определенный в `Web.sitemap`. Так как элемент управления SiteMapDataSource [ `ShowStartingNode` свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sitemapdatasource.showstartingnode.aspx) имеет значение False, он начинает возвращать карты узла иерархии, начиная с потомков узла Home. Каждый из этих узлов (в настоящее время только членство) отображает Repeater в `<li>` элемент. Затем другой, внутренний Repeater отображает дочерние элементы текущего узла в вложенный неупорядоченный список.

Рис. 4 показан Приведенная выше разметка выводимых данных к структуре карты сайта, созданной на шаге 2. Repeater создает разметку vanilla неупорядоченный список; определенные правила каскадных стилей в `Styles.css` отвечают за макет красоту приятная. Более подробное описание того, как приведенная выше разметка работает, см. в разделе [главные страницы и переходы по узлу](https://asp.net/learn/data-access/tutorial-03-vb.aspx) руководства.


[![Tон Навигационный пользовательский интерфейс — к просмотру с помощью вложенных неупорядоченный список](creating-user-accounts-vb/_static/image11.png)](creating-user-accounts-vb/_static/image10.png)

**Рис. 4**: Навигационный пользовательский интерфейс — к просмотру с помощью вложенных неупорядоченный список ([Просмотр полноразмерного изображения](creating-user-accounts-vb/_static/image12.png))


### <a name="adding-breadcrumb-navigation"></a>Создание иерархической схемы перемещения

Помимо списка ссылок в левом столбце, давайте также имеют вид каждой страницы [навигации](http://en.wikipedia.org/wiki/Breadcrumb_%28navigation%29). Создание навигатора находится элемент навигации пользовательского интерфейса, который позволяет быстро увидеть пользователей, их текущую позицию в иерархии сайтов. Элемент управления SiteMapPath идеологии карты узла для определения местоположения текущей страницы в карте узла, а затем отображает навигатором, на основании этой информации.

В частности, добавление `<span>` элемент Заголовок главной страницы `<div>` элемент и задайте для нового `<span>` элемента `class` атрибут навигации. ( `Styles.css` Класс содержит правило для класса навигации.) Затем добавьте SiteMapPath новой `<span>` элемент.

[!code-aspx[Main](creating-user-accounts-vb/samples/sample4.aspx)]

Рис. 5 показан результат выполнения SiteMapPath при посещении `~/Membership/CreatingUserAccounts.aspx`.


[![Tон навигации отображает текущую страницу и его предков карты узла](creating-user-accounts-vb/_static/image14.png)](creating-user-accounts-vb/_static/image13.png)

**Рис. 5**: Отображает навигации текущей страницы и его предков карты узла ([Просмотр полноразмерного изображения](creating-user-accounts-vb/_static/image15.png))


## <a name="step-4-removing-the-custom-principal-and-identity-logic"></a>Шаг 4. Удаление собственного участника безопасности и логику удостоверений

В *<a id="_msoanchor_7"> </a> [конфигурацию проверки подлинности форм и дополнительные разделы](../introduction/forms-authentication-configuration-and-advanced-topics-vb.md)* учебнике было показано, как сопоставить пользовательские объекты principal и identity пользователям, прошедшим проверку. Выполнение данной задачи путем создания обработчика событий в `Global.asax` для приложения `PostAuthenticateRequest` , запускающегося после `FormsAuthenticationModule` проверки подлинности пользователя. В этом обработчике событий мы заменили `GenericPrincipal` и `FormsIdentity` объекты, добавленные с `FormsAuthenticationModule` с `CustomPrincipal` и `CustomIdentity` объектов, мы создали в этом учебнике.

Хотя пользовательские объекты principal и identity полезны в некоторых сценариях, в большинстве случаев `GenericPrincipal` и `FormsIdentity` достаточны объектов. Следовательно я думаю, что стоит вернуться к поведению по умолчанию. Этого не сделать, удалив или комментирования `PostAuthenticateRequest` обработчик событий или удалив `Global.asax` файл целиком.

> [!NOTE]
> Как только вы закомментирован или удален код в `Global.asax`, вам потребуется закомментировать код в `Default.aspx's` вспомогательного класса, к которому приводятся `User.Identity` свойства `CustomIdentity` экземпляра.


## <a name="step-5-programmatically-creating-a-new-user"></a>Шаг 5. Программное создание нового пользователя

Для создания учетной записи пользователя путем использования framework членства `Membership` класса [ `CreateUser` метод](https://msdn.microsoft.com/library/system.web.security.membership.createuser.aspx). Этот метод имеет входные параметры для имени пользователя, пароль и другие поля, относящиеся к пользователю. При вызове, он делегирует Создание новой учетной записи пользователя в систему настроенного поставщика членства, а затем возвращает [ `MembershipUser` объект](https://msdn.microsoft.com/library/system.web.security.membershipuser.aspx) представляющий учетной записи только что созданного пользователя.

`CreateUser` Метод имеет четыре перегрузки, каждое из которых принимает разное число входных параметров:

- [`CreateUser(username, password)`](https://msdn.microsoft.com/library/d8t4h2es.aspx)
- [`CreateUser(username, password, email)`](https://msdn.microsoft.com/library/t8yy6w3h.aspx)
- [`CreateUser(username, password, email, passwordQuestion, passwordAnswer, isApproved, MembershipCreateStatus)`](https://msdn.microsoft.com/library/82xx2e62.aspx)
- [`CreateUser(username, password, email, passwordQuestion, passwordAnswer, isApproved, providerUserKey, MembershipCreateStatus)`](https://msdn.microsoft.com/library/ms152012.aspx)

Эти четыре перегрузки отличаются от объема собранных данных. Первый перегруженный метод, к примеру, требуется только имя пользователя и пароль для новой учетной записи пользователя, тогда как второй также требуется адрес электронной почты пользователя.

Эти перегрузки существует, так как сведения, необходимые для создания учетной записи пользователя зависит от параметров конфигурации поставщика членства. В *<a id="_msoanchor_8"> </a> [Создание схемы членства в SQL Server](creating-the-membership-schema-in-sql-server-vb.md)* учебнике мы рассмотрели указываются параметры конфигурации поставщика членства в `Web.config`. Таблица 2 включен полный список параметров конфигурации.

Один такой членства поставщика параметр конфигурации, который влияет на то, что `CreateUser` можно использовать перегрузки — `requiresQuestionAndAnswer` параметр. Если `requiresQuestionAndAnswer` присваивается `true` (по умолчанию), то при создании учетной записи пользователя мы должны указать секретный вопрос и ответ. Эта информация используется позднее в том случае, если пользователю необходимо сбросить или изменить свой пароль. В частности в этот момент они показаны на контрольный вопрос и их необходимо ввести правильный ответ, чтобы сбросить или изменить свой пароль. Следовательно Если `requiresQuestionAndAnswer` присваивается `true` затем вызов любого из первых двух `CreateUser` перегружает приводят к возникновению исключения из-за отсутствия контрольный вопрос и ответ. Поскольку наше приложение в настоящий момент настроен требовать секретный вопрос и ответ, необходимо использовать один из второй две перегрузки, при создании пользователя программным способом.

Чтобы проиллюстрировать использование `CreateUser` метода, давайте создадим пользовательский интерфейс, где мы приглашение ввести свое имя, пароль, адрес электронной почты и ответ на вопрос предварительно определенные секретные. Откройте `CreatingUserAccounts.aspx` странице в `Membership` папку и добавьте следующие веб-элементов управления к элементу управления содержимым:

- Текстовое поле с именем `Username`
- Текстовое поле с именем `Password`, чей `TextMode` свойство имеет значение `Password`
- Текстовое поле с именем `Email`
- Метка `SecurityQuestion` с его `Text` очищаются свойство
- Текстовое поле с именем `SecurityAnswer`
- Кнопки с именем `CreateAccountButton` которого `Text` свойству Создание учетной записи пользователя
- Элемент управления Label с именем `CreateAccountResults` с его `Text` очищаются свойство

На этом этапе экран должен выглядеть аналогично снимок экрана, показанный на рис. 6.


[![Aдд различных веб-элементов управления на страницу CreatingUserAccounts.aspx](creating-user-accounts-vb/_static/image17.png)](creating-user-accounts-vb/_static/image16.png)

**Рис. 6**: Добавьте различные веб-элементы управления для `CreatingUserAccounts.aspx Page` ([Просмотр полноразмерного изображения](creating-user-accounts-vb/_static/image18.png))


`SecurityQuestion` Метки и `SecurityAnswer` TextBox предназначены для отображения предварительно определенные секретные вопрос и ответ пользователя на сбор. Обратите внимание на то, что контрольный вопрос и ответ хранятся на конкретного пользователя по, поэтому можно разрешить пользователям определять свои собственные контрольный вопрос. Тем не менее в этом примере я решили использовать вопрос универсальной безопасности, а именно: Что такое любимый цвет?

Чтобы реализовать этот вопрос предварительно определенные секретные, добавьте константы в класс фонового кода страницы с именем `passwordQuestion`, назначив ей на секретный вопрос. Затем в `Page_Load` обработчик событий, назначение этом константа, которая `SecurityQuestion` метки `Text` свойство:

[!code-vb[Main](creating-user-accounts-vb/samples/sample5.vb)]

Создайте обработчик событий для `CreateAccountButton'` s `Click` событий и добавьте следующий код:

[!code-vb[Main](creating-user-accounts-vb/samples/sample6.vb)]

`Click` Обработчик событий начинает с определения переменной с именем `createStatus` типа [ `MembershipCreateStatus` ](https://msdn.microsoft.com/library/system.web.security.membershipcreatestatus.aspx). `MembershipCreateStatus` представляет собой перечисление, указывающее состояние `CreateUser` операции. Например, если учетная запись пользователя успешно создан, полученный в результате `MembershipCreateStatus` экземпляра будет присвоено значение `Success;` с другой стороны, если операция завершается ошибкой, так как уже существует пользователь с тем же именем пользователя, он будет присвоено значение `DuplicateUserName`. В `CreateUser` перегрузки, мы используем, необходимо передать `MembershipCreateStatus` экземпляра в методе. Этому параметру присвоить соответствующее значение в пределах `CreateUser` метод и изучим его значение после вызова метода, чтобы определить, был ли учетной записи пользователя успешно создан.

После вызова метода `CreateUser`, передавая `createStatus`, `Select Case` оператор используется для вывода соответствующего сообщения в зависимости от значения, назначенные `createStatus`. Рис. 7 показан результат, когда пользователь успешно создан. Цифры 8 и 9 показаны выходные данные, когда учетная запись пользователя не создается. На рис. 8 посетителя вводить пароль пяти букв, который не соответствует требованиям стойкость пароля, выраженная в параметры конфигурации поставщика членства. На рис. 9 посетителя пытается создать учетную запись пользователя с именем существующего пользователя (созданный на рис. 7).


[![A Новая учетная запись пользователя является успешно создан](creating-user-accounts-vb/_static/image20.png)](creating-user-accounts-vb/_static/image19.png)

**Рис. 7**: Учетной записи пользователя будет создан ([Просмотр полноразмерного изображения](creating-user-accounts-vb/_static/image21.png))


[![Tон учетная запись пользователя не создается, поскольку пароль является слишком слабым](creating-user-accounts-vb/_static/image23.png)](creating-user-accounts-vb/_static/image22.png)

**Рис. 8**: Учетная запись пользователя создается не в том случае, так как пароль является слишком слабым ([Просмотр полноразмерного изображения](creating-user-accounts-vb/_static/image24.png))


[![Tон учетная запись пользователя не создается, так как имя пользователя уже используется](creating-user-accounts-vb/_static/image26.png)](creating-user-accounts-vb/_static/image25.png)

**Рис. 9**: Учетная запись пользователя является не создана потому, что имя пользователя уже используется ([Просмотр полноразмерного изображения](creating-user-accounts-vb/_static/image27.png))


> [!NOTE]
> Может возникнуть вопрос, как определить успех или неудачу, при использовании одной из первых двух `CreateUser` перегрузки метода, ни один из которых имеет параметр типа `MembershipCreateStatus`. Эти первые две перегрузки throw [ `MembershipCreateUserException` исключение](https://msdn.microsoft.com/library/system.web.security.membershipcreateuserexception.aspx) при возникновении сбоя, который включает [ `StatusCode` свойство](https://msdn.microsoft.com/library/system.web.security.membershipcreateuserexception.statuscode.aspx) типа `MembershipCreateStatus`.


После создания нескольких учетных записей пользователей, убедитесь, что учетные записи были созданы, перечисляя содержимое `aspnet_Users` и `aspnet_Membership` таблицы в `SecurityTutorials.mdf` базы данных. Как показано на рис. 10, я добавил два пользователя через `CreatingUserAccounts.aspx` страницы: Tito и Брюсом.


[![TНиже приведены два пользователя Store пользователя членства. Tito и Брюс](creating-user-accounts-vb/_static/image29.png)](creating-user-accounts-vb/_static/image28.png)

**Рис. 10**: Существует два пользователя в Store пользователя членства. Tito и Брюс ([Просмотр полноразмерного изображения](creating-user-accounts-vb/_static/image30.png))


Хотя хранилище авторизованных пользователей теперь включает в себя Брюс и Tito сведения об учетной записи, у нас есть еще для реализации функциональных возможностей, который разрешает Брюс или Tito для входа на сайт. В настоящее время `Login.aspx` проверяет учетные данные пользователя с жестко набор пар имя пользователя и пароль — Да *не* проверить предоставленные учетные данные от структуры членства. Для теперь отображаются новые учетные записи пользователей в `aspnet_Users` и `aspnet_Membership` таблиц придется остаться. В следующем учебном курсе  *<a id="_msoanchor_9"> </a> [проверка пользователя учетные данные от членства пользователя Store](validating-user-credentials-against-the-membership-user-store-vb.md)*, мы обновим страницу входа для проверки членства в хранилище.

> [!NOTE]
> Если вы не видите все пользователи в вашей `SecurityTutorials.mdf` базы данных, возможно, так как веб-приложение использует поставщик членства по умолчанию, `AspNetSqlMembershipProvider`, которая использует `ASPNETDB.mdf` базы данных в качестве хранилища пользователя. Чтобы определить, если это проблема, нажмите кнопку "Обновить" в обозревателе решений. Если база данных с именем `ASPNETDB.mdf` был добавлен `App_Data` папку, это проблема. Вернитесь к шагу 4 *<a id="_msoanchor_10"> </a> [Создание схемы членства в SQL Server](creating-the-membership-schema-in-sql-server-vb.md)* учебника инструкции о том, как правильно настроить поставщик членства.


В большинстве Создание сценариев в учетной записи пользователя, посетитель предоставляется интерфейс ввести свое имя пользователя, пароль, адрес электронной почты и другие важные сведения, после чего создается новую учетную запись. На этом шаге мы рассмотрели создание такого интерфейса вручную и затем рассмотрели использование `Membership.CreateUser` программным способом добавить новую учетную запись пользователя на основании входных данных пользователя. Тем не менее, наш код, только что создали новую учетную запись пользователя. Не удалось выполнить любые дальнейшие действия, например вход пользователя на сайт в учетной записи пользователя, созданную или отправке пользователю электронное сообщение с подтверждением. Эти дополнительные действия, потребуется дополнительный код в кнопки `Click` обработчик событий.

В ASP.NET имеется элемент управления CreateUserWizard, который может обрабатывать процесс создания учетной записи пользователя, от отрисовки пользовательского интерфейса для создания новых учетных записей пользователей, создания учетной записи в структуру членства и не выполняет после учетной записи задачи создания, например для отправки электронной почты с подтверждением и вход пользователя, созданную на сайт. Использование элемента управления CreateUserWizard осуществляется простым перетащив элемент управления CreateUserWizard из области элементов на страницу, а затем установить несколько свойств. В большинстве случаев не нужно писать ни одной строки кода. Мы рассмотрим этот изящный элемент управления, подробно на шаге 6.

Если новые учетные записи пользователей создаются только через типовой веб-странице создать учетную запись, маловероятно, что когда-либо придется написать код, который `CreateUser` метод, как элемент управления CreateUserWizard скорее всего соответствии с вашими требованиями. Тем не менее `CreateUser` метод удобно в сценариях нужном персонализировать взаимодействие с пользователем Создание учетной записи или при необходимости для программного создания новых учетных записей пользователей с помощью альтернативных интерфейса. Например возможно, страница, на которой пользователь может отправить XML-файл, содержащий сведения о пользователе из другим приложением. Страницы могут анализирует содержимое загруженного XML-файл и создать новую учетную запись для каждого пользователя, представленного в XML, вызвав `CreateUser` метод.

## <a name="step-6-creating-a-new-user-with-the-createuserwizard-control"></a>Шаг 6. Создание нового пользователя с помощью элемента управления CreateUserWizard

ASP.NET поставляется с несколькими входа веб-элементов управления. Эти элементы управления помогают выполнять многие обычные пользовательские связанные с учетной записью и входа сценарии. [Элемент управления CreateUserWizard](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/createuserwizard.aspx) один такой элемент, который позволяет представить пользовательский интерфейс для добавления учетной записи пользователя в структуру членства.

Как и многие другие связанные с входом веб-элементов управления CreateUserWizard можно использовать без написания кода. Его интуитивно предоставляет пользовательский интерфейс на основе поставщика членства параметры конфигурации и внутренне вызывает `Membership` класса `CreateUser` метод после того как пользователь вводит необходимые сведения и нажимает кнопку Create User. Элемент управления CreateUserWizard чрезвычайно настраивается. Доступен ряд событий, возникающих в ходе различных этапов процесса создания учетной записи. Можно создать обработчики событий, при необходимости, для вставки пользовательской логики в рабочий процесс создания учетной записи. Кроме того внешний вид CreateUserWizard обладает большой гибкостью. Существует ряд свойств, которые определяют внешний вид интерфейса по умолчанию; При необходимости можно преобразовать в шаблон элемента управления, или могут быть добавлены дополнительные пользовательские действия для регистрации.

Давайте начнем с рассмотрения с помощью элемента управления CreateUserWizard интерфейс по умолчанию и поведение. Затем мы рассмотрим способы настройки внешнего вида с помощью свойства и события элемента управления.

### <a name="examining-the-createuserwizards-default-interface-and-behavior"></a>Изучение интерфейс по умолчанию и поведение CreateUserWizard

Вернитесь к `CreatingUserAccounts.aspx` странице в `Membership` папки, переключиться в режим конструктора или разбиение и затем добавьте элемент управления CreateUserWizard в верхней части страницы. Элемент управления CreateUserWizard, под которым хранится раздел элементов управления панели элементов входа. После добавления элемента управления, задайте его `ID` свойства `RegisterUser`. Как на снимке экрана на рис. 11 показано, CreateUserWizard отображает интерфейс с текстовые поля для нового пользователя имя пользователя, пароль, адрес электронной почты и контрольный вопрос и ответ.


[![Tон элемент управления CreateUserWizard предоставляет универсальный интерфейс пользователя, создайте](creating-user-accounts-vb/_static/image32.png)](creating-user-accounts-vb/_static/image31.png)

**Рис. 11**: Элемент управления CreateUserWizard предоставляет универсальный интерфейс пользователя, создайте ([Просмотр полноразмерного изображения](creating-user-accounts-vb/_static/image33.png))


Давайте немного, чтобы сравнить пользовательский интерфейс по умолчанию, сформированный элементом управления CreateUserWizard с интерфейсом, который мы создали на шаге 5. Во-первых элемент управления CreateUserWizard позволяет посетителя для указания контрольный вопрос и ответ, тогда как наш интерфейс, созданных вручную использовать предварительно определенные секретные вопрос. Интерфейс элемента управления CreateUserWizard также включает в себя проверяющие элементы управления, а нам пришлось еще реализация проверки на наш интерфейс поля формы. И интерфейс управления CreateUserWizard включает текстовое поле Подтверждение пароля (вместе с CompareValidator, чтобы обеспечить текста, введенного пароля и текстовые поля пароль сравнения равны).

Интересно то, что элемент управления CreateUserWizard учитывает параметры конфигурации поставщика членства, при подготовке к просмотру его пользовательский интерфейс. Например, текстовые поля вопросов и ответов безопасности отображаются, только если `requiresQuestionAndAnswer` имеет значение True. Аналогично, CreateUserWizard автоматически добавляет элемент управления RegularExpressionValidator, чтобы убедиться, что соблюдены к надежности паролей и задает его `ErrorMessage` и `ValidationExpression` на основе свойства `minRequiredPasswordLength`, `minRequiredNonalphanumericCharacters`и `passwordStrengthRegularExpression` параметры конфигурации.

Элемент управления CreateUserWizard, как и предполагает его имя, является производным от [элемента управления Wizard](https://msdn.microsoft.com/library/s2etd1ek.aspx). Мастер элементов управления призваны обеспечить интерфейс для выполнения нескольких шагов задач. Элемент управления мастера, может иметь произвольное число `WizardSteps`, каждый из которых — это шаблон, определяющий HTML и веб-элементов управления для этого шага. Мастер управления изначально отображает первый `WizardStep`, а также элементы управления для перемещения, которые разрешают пользователю перейти от одного шага к следующему или вернуться к предыдущим шагам.

Как показано на рис. 11 декларативная разметка, интерфейс по умолчанию элемента управления CreateUserWizard включает две `WizardStep` s:

- [`CreateUserWizardStep`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizardstep.aspx) ? Отрисовывает интерфейс для сбора сведений для создания новой учетной записи пользователя. Это показано на рисунке 11.
- [`CompleteWizardStep`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.completewizardstep.aspx) ? Отображает сообщение о том, что учетная запись успешно создана.

Можно изменить внешний вид и поведение CreateUserWizard, преобразовав одно из следующих действий для шаблонов или путем добавления собственных `WizardStep` s. Мы рассмотрим добавление `WizardStep` в интерфейсе регистрации на *хранения Дополнительные сведения о пользователе* руководства.

Давайте посмотрим, элемент управления CreateUserWizard в действии. Посетите `CreatingUserAccounts.aspx` страницы в обозревателе. Начните с ввода в интерфейс CreateUserWizard некоторые недопустимые значения. Попробуйте ввода пароля, который не соответствует требованиям стойкость пароля, или если оставить пустым текстовое поле имени пользователя. CreateUserWizard отобразит соответствующее сообщение об ошибке. Рис. 12 показаны выходные данные, при попытке создать пользователя с недостаточно надежный пароль.


[![Tон CreateUserWizard автоматически внедряет проверяющие элементы управления](creating-user-accounts-vb/_static/image35.png)](creating-user-accounts-vb/_static/image34.png)

**Рис. 12**: CreateUserWizard автоматически внедряет проверяющие элементы управления ([Просмотр полноразмерного изображения](creating-user-accounts-vb/_static/image36.png))


Затем введите соответствующие значения в CreateUserWizard и нажмите кнопку "Create User". Если были введены обязательные поля и надежность пароля будет достаточно, CreateUserWizard будет создать учетную запись пользователя помощи структуры членства и отобразите `CompleteWizardStep`элемента интерфейса (см. рис. 13). На самом деле вызывает CreateUserWizard `Membership.CreateUser` метод, как мы это делали на шаге 5.


[![A Новая учетная запись пользователя имеет, успешно созданы](creating-user-accounts-vb/_static/image38.png)](creating-user-accounts-vb/_static/image37.png)

**Рис. 13**: Содержит учетную запись пользователя успешно создана ([Просмотр полноразмерного изображения](creating-user-accounts-vb/_static/image39.png))


> [!NOTE]
> Как показано на рис. 13, `CompleteWizardStep`интерфейс включает кнопки "Продолжить". Однако на этом этапе просто щелкнув его выполняет обратную передачу, оставляя посетителя на одной странице. Настройка внешнего вида и поведения через его свойства CreateUserWizard секции мы рассмотрим, что нужно сделать эту кнопку, отправить посетителя `Default.aspx` (или другую страницу).


После создания учетной записи пользователя, вернитесь в Visual Studio и изучите `aspnet_Users` и `aspnet_Membership` таблицы, как это делалось на рисунке 10, чтобы убедиться, что учетная запись успешно создана.

### <a name="customizing-the-createuserwizards-behavior-and-appearance-through-its-properties"></a>Настройка поведения и внешнего вида с помощью его свойства CreateUserWizard

CreateUserWizard можно настраивать различными способами с помощью свойств `WizardStep` s и обработчиков событий. В этом разделе мы рассмотрим способы настройки внешнего вида элемента управления с помощью его свойства; Ниже рассматривается расширение поведения элемента управления с помощью обработчиков событий.

Практически все текст, отображаемый в элементе управления CreateUserWizard по умолчанию пользовательский интерфейс можно настроить с помощью его множество свойств. Например, можно настроить имя пользователя, пароль, подтверждение пароля, электронной почты, контрольный вопрос и ответ на контрольный вопрос метки слева от текстовых полей с [ `UserNameLabelText` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.usernamelabeltext.aspx), [ `PasswordLabelText` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.passwordlabeltext.aspx), [ `ConfirmPasswordLabelText` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.confirmpasswordlabeltext.aspx), [ `EmailLabelText` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.emaillabeltext.aspx), [ `QuestionLabelText` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.questionlabeltext.aspx), и [ `AnswerLabelText` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.answerlabeltext.aspx) свойства, соответственно. Аналогично, нет свойства для задания текста для кнопки «Create User и продолжить» в `CreateUserWizardStep` и `CompleteWizardStep`, а также, как если эти кнопки отображаемой в качестве кнопок, элементов управления LinkButton или ImageButtons.

Цвета, границы, шрифты и другие визуальные элементы настраиваются через узел свойств стиля. Сам элемент управления CreateUserWizard имеет свойства стиля распространенных Web управления - `BackColor`, `BorderStyle`, `CssClass`, `Font`, и т. д. — и предусмотрен целый ряд свойств стиля для определения внешнего вида, для определенных частей Интерфейс CreateUserWizard. [ `TextBoxStyle` Свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.textboxstyle.aspx), к примеру, определяет стили для элементов управления TextBox в `CreateUserWizardStep`, хотя [ `TitleTextStyle` свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.titletextstyle.aspx) определяет стиль заголовка (регистрации в службе вновь Учетная запись).

В дополнение к свойствам внешнего существует ряд свойств, которые влияют на поведение элемента управления CreateUserWizard. [ `DisplayCancelButton` Свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.wizard.displaycancelbutton.aspx), если значение True, отображает кнопки «Отмена» рядом с кнопкой Create User (значение по умолчанию — False). Если необходимо отобразить кнопки "Отмена", не забудьте также задать [ `CancelDestinationPageUrl` свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.continuedestinationpageurl.aspx), который указывает страницу, пользователю отправляется после нажатия кнопки "Отмена". Как отмечалось в предыдущем разделе, кнопки "Продолжить" в `CompleteWizardStep`в интерфейс вызывает обратную передачу, но оставляет посетителя на одной странице. Чтобы отправить посетителя на другую страницу после нажатия кнопки "Продолжить", просто укажите URL-адрес в [ `ContinueDestinationPageUrl` свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.continuedestinationpageurl.aspx).

Давайте обновим `RegisterUser` для отображения кнопки "Отмена", так и для отправки посетитель элемента управления CreateUserWizard `Default.aspx` при нажатии кнопки "Отмена" или продолжить. Для этого необходимо задать `DisplayCancelButton` значение True и оба `CancelDestinationPageUrl` и `ContinueDestinationPageUrl` свойства ~ / Default.aspx. Рис. 14 показаны обновленные CreateUserWizard при просмотре через браузер.


[![Tон CreateUserWizardStep содержит кнопку "Отмена".](creating-user-accounts-vb/_static/image41.png)](creating-user-accounts-vb/_static/image40.png)

**Рис. 14**: `CreateUserWizardStep` Содержит кнопку "Отмена" ([Просмотр полноразмерного изображения](creating-user-accounts-vb/_static/image42.png))


Когда посетитель вводит имя пользователя, пароль, адрес электронной почты и контрольный вопрос и ответ и нажимает кнопку Create User, учетную запись пользователя создается и посетителя регистрируется под этой только что созданного пользователя. При условии, что лица, посетив страницу используется для создания новой учетной записи для себя, скорее всего это требуемое поведение. Тем не менее может потребоваться дают администраторам возможность добавлять новые учетные записи пользователей. Таким образом, приведет к созданию учетной записи пользователя, но администратор сохранится вошедшего в систему с правами администратора (а не как созданной учетной записи). Это поведение можно изменять с помощью логического [ `LoginCreatedUser` свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.logincreateduser.aspx).

Учетные записи пользователей в платформу членства содержат утвержденных флаг; не утвержденные пользователи не смогут войти на сайт. По умолчанию созданной учетной записи помечен как утвержденные, позволяя пользователю немедленно войти на сайт. Это возможно, однако новые учетные записи пользователей, помечены как «не утверждено». Возможно, вам необходимо, чтобы администратор вручную одобрил новых пользователей, прежде чем они могут войти в систему. или, возможно, вы хотите проверить, что адрес электронной почты, введенный при регистрации является допустимым, прежде чем позволить пользователю войти в систему. Бы то ни было, может иметь запись только что созданного пользователя, помечены как «не утверждено» с задание элемента управления CreateUserWizard [ `DisableCreatedUser` свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.disablecreateduser.aspx) значение true (по умолчанию — False).

Включить другие свойства, связанные с поведением, интересные `AutoGeneratePassword` и `MailDefinition`. Если [ `AutoGeneratePassword` свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.autogeneratepassword.aspx) имеет значение True, `CreateUserWizardStep` не содержит текстовые поля пароль и подтверждение пароля; вместо этого только что созданный пароль создается автоматически с помощью `Membership` класса [ `GeneratePassword` метод](https://msdn.microsoft.com/library/system.web.security.membership.generatepassword.aspx). `GeneratePassword` Метод создает пароль указанной длины и с достаточное количество неалфавитных символов в соответствии с требованиями надежности настроенным паролем.

[ `MailDefinition` Свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.maildefinition.aspx) полезно, если вы хотите отправить сообщение электронной почты на адрес электронной почты, указанный во время создания учетной записи. `MailDefinition` Свойство включает ряд вложенные свойства для определения сведения о сообщении, сконструированный по электронной почте. Эти вложенные свойства включают в себя параметры как `Subject`, `Priority`, `IsBodyHtml`, `From`, `CC`, и `BodyFileName`. [ `BodyFileName` Свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.bodyfilename.aspx) указывает на текст или HTML-файл, содержащий текст для сообщения электронной почты. Тело поддерживает два предварительно определенных заполнителя: `<%UserName%>` и `<%Password%>`. Эти заполнители, если они присутствуют в `BodyFileName` файл, будут заменены на только что созданного имени пользователя и пароль.

> [!NOTE]
> `CreateUserWizard` Элемента управления `MailDefinition` свойство только указывает сведения о сообщении электронной почты, отправляемого при создании новой учетной записи. Он не включает все сведения о том, как фактически отправляется сообщение электронной почты (то есть использование каталога сервера или почты SMTP, информацию для проверки подлинности и т. д.). Эти низкоуровневые элементы должны быть определены в `<system.net>` статьи `Web.config`. Дополнительные сведения об этих параметрах конфигурации и отправки электронной почты из ASP.NET 2.0 в целом см. [по адресу SystemNetMail.com](http://www.systemnetmail.com/) и моей статье [отправки электронной почты в ASP.NET 2.0](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx).


### <a name="extending-the-createuserwizards-behavior-using-event-handlers"></a>Расширения поведения CreateUserWizard, с помощью обработчиков событий

Элемент управления CreateUserWizard Возводит число событий во время его рабочего процесса. Например, после посетитель введет свое имя пользователя, пароль и другие сопутствующие сведения и нажимает кнопку Create User, элемент управления CreateUserWizard вызывает его [ `CreatingUser` событий](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.creatinguser.aspx). Если возникла проблема во время процесса создания [ `CreateUserError` событий](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createusererror.aspx) запускается; тем не менее, если пользователь будет создан, то [ `CreatedUser` событие](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createduser.aspx) возникает. Существуют дополнительные события элемента управления CreateUserWizard, вызывается, но это три наиболее относятся те из них.

В некоторых сценариях необходимо задействовать CreateUserWizard рабочего процесса, который мы можем создать обработчик событий для соответствующего события. Чтобы проиллюстрировать это, давайте улучшим `RegisterUser` элемента управления CreateUserWizard для включения некоторых пользовательскую проверку на имя пользователя и пароль. В частности давайте усовершенствуем наш CreateUserWizard, имена пользователей не может содержать начальные или конечные пробелы и имя пользователя не может находиться в любом месте пароль. Короче говоря мы хотим предотвращения создания имя пользователя, как «Scott», и необходимости сочетание имени пользователя и пароля, таких как Скотт и Scott.1234.

Для этого мы создадим обработчик событий для `CreatingUser` событий для наших проверок дополнительную проверку. Если предоставленные данные не является допустимым, нам нужно отменить процесс создания. Мы также необходимо добавить элемент управления Label Web на страницу, чтобы отобразить сообщение о том, что имя пользователя или пароль является недопустимым. Начните с добавления элемента управления Label под элементом управления CreateUserWizard, установка его `ID` свойства `InvalidUserNameOrPasswordMessage` и его `ForeColor` свойства `Red`. Очистите его `Text` и установите его `EnableViewState` и `Visible` свойств значение false.

[!code-aspx[Main](creating-user-accounts-vb/samples/sample7.aspx)]

Создайте обработчик событий для элемента управления CreateUserWizard `CreatingUser` событий. Чтобы создать обработчик событий, выберите элемент управления в конструкторе и перейдите в окно свойств. После этого щелкните значок с молнией, а затем дважды щелкните соответствующее событие, чтобы создать обработчик событий.

Добавьте следующий код в обработчик событий `CreatingUser` .

[!code-vb[Main](creating-user-accounts-vb/samples/sample8.vb)]

Обратите внимание, что имя пользователя и пароль, введенные в элементе управления CreateUserWizard доступны через его [ `UserName` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.username.aspx) и [ `Password` свойства](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.password.aspx), соответственно. Мы используем эти свойства в обработчике событий выше, чтобы определить, является ли введенное имя пользователя содержит начальные или конечные пробелы и ли имя пользователя находится в пределах пароль. Если одно из этих условий выполняется, сообщение об ошибке отображается в `InvalidUserNameOrPasswordMessage` метку и обработчик событий `e.Cancel` свойству `True`. Если `e.Cancel` присваивается `True`, CreateUserWizard игнорирует его рабочего процесса, эффективно Отмена в процессе создания учетной записи пользователя.

Рис. 15 приведен снимок экрана `CreatingUserAccounts.aspx` когда пользователь вводит имя пользователя с пробелов.


[![Usernames с начальные или конечные пробелы не допускаются](creating-user-accounts-vb/_static/image44.png)](creating-user-accounts-vb/_static/image43.png)

**Рис. 15**: Имена пользователей в начальные или конечные пробелы не допускаются ([Просмотр полноразмерного изображения](creating-user-accounts-vb/_static/image45.png))


> [!NOTE]
> Мы увидим пример использования элемента управления CreateUserWizard `CreatedUser` событие в *<a id="_msoanchor_11"> </a> [хранения Дополнительные сведения о пользователе](storing-additional-user-information-vb.md)* руководства.


## <a name="summary"></a>Сводка

`Membership` Класса `CreateUser` метод создает новую учетную запись пользователя в структуру членства. Это делается с передачей вызова настроенного поставщика членства. В случае использования `SqlMembershipProvider`, `CreateUser` метод добавляет запись `aspnet_Users` и `aspnet_Membership` таблицы базы данных.

Однако можно создавать новые учетные записи пользователей, программным образом (как мы видели в шаге 5), быстрее и проще подходом является использование элемента управления CreateUserWizard. Этот элемент управления предоставляет многоэтапный пользовательский интерфейс для сбора сведений о пользователе и создания нового пользователя в структуру членства. Принципы работы, этот элемент управления использует те же `Membership.CreateUser` метод как изучить в шаге 5, но элемент управления создает пользовательский интерфейс, проверяющие элементы управления и реагирует на ошибки при создании учетной записи пользователя не нужно писать ни строчки кода.

На этом этапе у нас есть функциональные возможности на месте для создания новых учетных записей пользователей. Тем не менее на страницу входа по-прежнему проверка этих учетных данных жестко, которую мы указали обратно в втором учебном курсе. В <a id="_msoanchor_12"> </a> [следующему руководству](validating-user-credentials-against-the-membership-user-store-vb.md) мы обновим `Login.aspx` для проверки пользователя предоставленные учетные данные от структуры членства.

Счастливого вам программирования!

### <a name="further-reading"></a>Дополнительные сведения

Дополнительные сведения по темам, обсуждавшимся в этом руководстве см. в следующих ресурсах:

- [`CreateUser` Техническая документация](https://msdn.microsoft.com/library/system.web.security.membershipprovider.createuser.aspx)
- [Обзор элемента управления CreateUserWizard](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/createuserwizard.aspx)
- [Создание поставщика карты узла на основе системы файла](http://aspnet.4guysfromrolla.com/articles/020106-1.aspx)
- [Создание пошаговые пользовательского интерфейса с помощью элемента управления ASP.NET 2.0 мастера](http://aspnet.4guysfromrolla.com/articles/061406-1.aspx)
- [Изучение ASP.NET 2.0 переходы по узлу](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx)
- [Главные страницы и переходы по узлу](https://asp.net/learn/data-access/tutorial-03-vb.aspx)
- [Поставщик карты узла SQL вы ждали](https://msdn.microsoft.com/msdnmag/issues/06/02/WickedCode/default.aspx)

### <a name="about-the-author"></a>Об авторе

Скотт Митчелл, автор нескольких книг по ASP/ASP.NET и основатель веб-узла 4GuysFromRolla.com, работает с веб-технологиями Microsoft с 1998 года. Скотт — независимый консультант, преподаватель и автор. Его последняя книга —  *[Sams Teach ASP.NET 2.0 in 24 часа](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*. Скоттом можно связаться по адресу [ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com) или через его блог по адресу [ http://ScottOnWriting.NET ](http://scottonwriting.net/).

### <a name="special-thanks-to"></a>Особая благодарность

В этой серии руководств пособий рецензировалась многими компетентными редакторами. Основной рецензент этого учебного был Мерфи Терезой. Хотите поработать с моих последующих статей для MSDN? Если Да, напишите мне [ mitchell@4GuysFromRolla.com ](mailto:mitchell@4guysfromrolla.com).

> [!div class="step-by-step"]
> [Назад](creating-the-membership-schema-in-sql-server-vb.md)
> [Вперед](validating-user-credentials-against-the-membership-user-store-vb.md)
