---
uid: web-forms/overview/older-versions-security/membership/storing-additional-user-information-cs
title: Сохранение дополнительных сведений о пользователе (C#) | Документация Майкрософт
author: rick-anderson
description: В этом руководстве мы будет ответить на этот вопрос с создания приложения очень просты гостевой книги. Таким образом, мы рассмотрим различные варианты modeli...
ms.author: riande
ms.date: 01/18/2008
ms.assetid: 1642132a-1ca5-4872-983f-ab59fc8865d3
msc.legacyurl: /web-forms/overview/older-versions-security/membership/storing-additional-user-information-cs
msc.type: authoredcontent
ms.openlocfilehash: fce3bd00716d992dd9faf70dfd46c2e845faef14
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2019
ms.locfileid: "65133047"
---
# <a name="storing-additional-user-information-c"></a><span data-ttu-id="42c19-104">Сохранение дополнительных сведений о пользователе (C#)</span><span class="sxs-lookup"><span data-stu-id="42c19-104">Storing Additional User Information (C#)</span></span>

<span data-ttu-id="42c19-105">по [Скотт Митчелл](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="42c19-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="42c19-106">[Скачать код](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_08_CS.zip) или [скачать PDF](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial08_ExtraUserInfo_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="42c19-106">[Download Code](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_08_CS.zip) or [Download PDF](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial08_ExtraUserInfo_cs.pdf)</span></span>

> <span data-ttu-id="42c19-107">В этом руководстве мы будет ответить на этот вопрос с создания приложения очень просты гостевой книги.</span><span class="sxs-lookup"><span data-stu-id="42c19-107">In this tutorial we will answer this question by building a very rudimentary guestbook application.</span></span> <span data-ttu-id="42c19-108">Таким образом, мы рассмотрим различные варианты моделирования сведения о пользователе в базе данных и затем узнать, как связать эти данные с учетные записи пользователей, созданные платформой членства.</span><span class="sxs-lookup"><span data-stu-id="42c19-108">In doing so, we will look at different options for modeling user information in a database, and then see how to associate this data with the user accounts created by the Membership framework.</span></span>

## <a name="introduction"></a><span data-ttu-id="42c19-109">Вступление</span><span class="sxs-lookup"><span data-stu-id="42c19-109">Introduction</span></span>

<span data-ttu-id="42c19-110">ASP. Членство в .NET framework предлагает гибкие интерфейс для управления пользователями.</span><span class="sxs-lookup"><span data-stu-id="42c19-110">ASP.NET's Membership framework offers a flexible interface for managing users.</span></span> <span data-ttu-id="42c19-111">API членства включает методы для проверки учетных данных, получения сведений о текущего пользователя, создание учетной записи пользователя и удаление учетной записи пользователя, помимо прочего.</span><span class="sxs-lookup"><span data-stu-id="42c19-111">The Membership API includes methods for validating credentials, retrieving information about the currently logged on user, creating a new user account, and deleting a user account, among others.</span></span> <span data-ttu-id="42c19-112">Каждая учетная запись пользователя в структуру членства содержит только свойства, необходимые для проверки учетных данных и выполнение задач, связанные с учетной записью essential пользователя.</span><span class="sxs-lookup"><span data-stu-id="42c19-112">Each user account in the Membership framework contains only the properties needed for validating credentials and performing essential user account-related tasks.</span></span> <span data-ttu-id="42c19-113">Об этом свидетельствуют методам и свойствам [ `MembershipUser` класс](https://msdn.microsoft.com/library/system.web.security.membershipuser.aspx), который моделирует учетной записи пользователя в структуру членства.</span><span class="sxs-lookup"><span data-stu-id="42c19-113">This is evidenced by the methods and properties of the [`MembershipUser` class](https://msdn.microsoft.com/library/system.web.security.membershipuser.aspx), which models a user account in the Membership framework.</span></span> <span data-ttu-id="42c19-114">Этот класс имеет свойства, такие как [ `UserName` ](https://msdn.microsoft.com/library/system.web.security.membershipuser.username.aspx), [ `Email` ](https://msdn.microsoft.com/library/system.web.security.membershipuser.email.aspx), и [ `IsLockedOut` ](https://msdn.microsoft.com/library/system.web.security.membershipuser.islockedout.aspx), и методы, такие как [ `GetPassword` ](https://msdn.microsoft.com/library/system.web.security.membershipuser.getpassword.aspx) и [ `UnlockUser` ](https://msdn.microsoft.com/library/system.web.security.membershipuser.unlockuser.aspx).</span><span class="sxs-lookup"><span data-stu-id="42c19-114">This class has properties like [`UserName`](https://msdn.microsoft.com/library/system.web.security.membershipuser.username.aspx), [`Email`](https://msdn.microsoft.com/library/system.web.security.membershipuser.email.aspx), and [`IsLockedOut`](https://msdn.microsoft.com/library/system.web.security.membershipuser.islockedout.aspx), and methods like [`GetPassword`](https://msdn.microsoft.com/library/system.web.security.membershipuser.getpassword.aspx) and [`UnlockUser`](https://msdn.microsoft.com/library/system.web.security.membershipuser.unlockuser.aspx).</span></span>

<span data-ttu-id="42c19-115">Очень часто приложений необходимо сохранять дополнительные сведения о пользователе не включены в структуру членства.</span><span class="sxs-lookup"><span data-stu-id="42c19-115">Oftentimes, applications need to store additional user information not included in the Membership framework.</span></span> <span data-ttu-id="42c19-116">Например Интернет-магазине может потребоваться разрешить каждому пользователю хранить ее адреса доставки и выставления счетов, сведения о платеже, предпочтения доставки и контактный номер телефона.</span><span class="sxs-lookup"><span data-stu-id="42c19-116">For example, an online retailer might need to let each user store her shipping and billing addresses, payment information, delivery preferences, and contact phone number.</span></span> <span data-ttu-id="42c19-117">Кроме того каждый заказ в системе, связанный с записью определенного пользователя.</span><span class="sxs-lookup"><span data-stu-id="42c19-117">Furthermore, each order in the system is associated with a particular user account.</span></span>

<span data-ttu-id="42c19-118">`MembershipUser` Класс не имеет свойства, такие как `PhoneNumber` или `DeliveryPreferences` или `PastOrders`.</span><span class="sxs-lookup"><span data-stu-id="42c19-118">The `MembershipUser` class does not include properties like `PhoneNumber` or `DeliveryPreferences` or `PastOrders`.</span></span> <span data-ttu-id="42c19-119">Так как мы отслеживать сведения о пользователе, необходимые для приложения и его интеграции с помощью структуры членства?</span><span class="sxs-lookup"><span data-stu-id="42c19-119">So how do we track the user information needed by the application and have it integrate with the Membership framework?</span></span> <span data-ttu-id="42c19-120">В этом руководстве мы будет ответить на этот вопрос с создания приложения очень просты гостевой книги.</span><span class="sxs-lookup"><span data-stu-id="42c19-120">In this tutorial we will answer this question by building a very rudimentary guestbook application.</span></span> <span data-ttu-id="42c19-121">Таким образом, мы рассмотрим различные варианты моделирования сведения о пользователе в базе данных и затем узнать, как связать эти данные с учетные записи пользователей, созданные платформой членства.</span><span class="sxs-lookup"><span data-stu-id="42c19-121">In doing so, we will look at different options for modeling user information in a database, and then see how to associate this data with the user accounts created by the Membership framework.</span></span> <span data-ttu-id="42c19-122">Давайте начнем!</span><span class="sxs-lookup"><span data-stu-id="42c19-122">Let's get started!</span></span>

## <a name="step-1-creating-the-guestbook-applications-data-model"></a><span data-ttu-id="42c19-123">Шаг 1. Создание модели данных приложения гостевой книги</span><span class="sxs-lookup"><span data-stu-id="42c19-123">Step 1: Creating the Guestbook Application's Data Model</span></span>

<span data-ttu-id="42c19-124">Существуют различные методы, которые можно использовать для записи сведения о пользователе в базе данных и связать его с учетные записи пользователей, созданные платформой членства.</span><span class="sxs-lookup"><span data-stu-id="42c19-124">There are a variety of techniques that can be employed to capture user information in a database and associate it with the user accounts created by the Membership framework.</span></span> <span data-ttu-id="42c19-125">Чтобы продемонстрировать данные методы, необходимо дополнить учебника веб-приложение, которое включало какую-либо данные о пользователях.</span><span class="sxs-lookup"><span data-stu-id="42c19-125">In order to illustrate these techniques, we will need to augment the tutorial web application so that it captures some sort of user-related data.</span></span> <span data-ttu-id="42c19-126">(В настоящее время содержит модель данных приложения, только таблицы, необходимые для служб приложений `SqlMembershipProvider`.)</span><span class="sxs-lookup"><span data-stu-id="42c19-126">(Currently, the application's data model contains only the application services tables needed by the `SqlMembershipProvider`.)</span></span>

<span data-ttu-id="42c19-127">Давайте создадим приложение очень простую гостевую книгу, где прошедший проверку пользователь может оставить комментарий.</span><span class="sxs-lookup"><span data-stu-id="42c19-127">Let's create a very simple guestbook application where an authenticated user can leave a comment.</span></span> <span data-ttu-id="42c19-128">Помимо хранения комментариях, разрешите подключение для каждого пользователя, для хранения его домашней города, домашней страницы и подпись.</span><span class="sxs-lookup"><span data-stu-id="42c19-128">In addition to storing guestbook comments, let's allow each user to store his home town, homepage, and signature.</span></span> <span data-ttu-id="42c19-129">Если указано, домашний Город пользователя, домашней страницы и подпись будет отображаться для каждого сообщения, которые он оставил в гостевой книги.</span><span class="sxs-lookup"><span data-stu-id="42c19-129">If provided, the user's home town, homepage, and signature will appear on each message he has left in the guestbook.</span></span>

### <a name="adding-theguestbookcommentstable"></a><span data-ttu-id="42c19-130">Добавление`GuestbookComments`таблицы</span><span class="sxs-lookup"><span data-stu-id="42c19-130">Adding the`GuestbookComments`Table</span></span>

<span data-ttu-id="42c19-131">Чтобы записать в комментариях, нам необходимо создать таблицу базы данных с именем `GuestbookComments` , содержит столбцы, такие как `CommentId`, `Subject`, `Body`, и `CommentDate`.</span><span class="sxs-lookup"><span data-stu-id="42c19-131">In order to capture the guestbook comments, we need to create a database table named `GuestbookComments` that has columns like `CommentId`, `Subject`, `Body`, and `CommentDate`.</span></span> <span data-ttu-id="42c19-132">Мы также требуются каждой записи `GuestbookComments` ссылки на таблицу пользователя, который оставил комментарий.</span><span class="sxs-lookup"><span data-stu-id="42c19-132">We also need to have each record in the `GuestbookComments` table reference the user who left the comment.</span></span>

<span data-ttu-id="42c19-133">Чтобы добавить эту таблицу в базе данных, перейдите в обозреватель базы данных в Visual Studio и детализировать `SecurityTutorials` базы данных.</span><span class="sxs-lookup"><span data-stu-id="42c19-133">To add this table to our database, go to the Database Explorer in Visual Studio and drill down into the `SecurityTutorials` database.</span></span> <span data-ttu-id="42c19-134">Щелкните правой кнопкой мыши папку «таблицы» и выберите Добавить новую таблицу.</span><span class="sxs-lookup"><span data-stu-id="42c19-134">Right-click on the Tables folder and choose Add New Table.</span></span> <span data-ttu-id="42c19-135">Откроется интерфейс, который позволяет определить столбцы для новой таблицы.</span><span class="sxs-lookup"><span data-stu-id="42c19-135">This brings up an interface that allows us to define the columns for the new table.</span></span>

<span data-ttu-id="42c19-136">[![Добавить новую таблицу в базе данных SecurityTutorials](storing-additional-user-information-cs/_static/image2.png)](storing-additional-user-information-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="42c19-136">[![Add a New Table to the SecurityTutorials Database](storing-additional-user-information-cs/_static/image2.png)](storing-additional-user-information-cs/_static/image1.png)</span></span>

<span data-ttu-id="42c19-137">**Рис. 1**: Добавить новую таблицу для `SecurityTutorials` базы данных ([Просмотр полноразмерного изображения](storing-additional-user-information-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="42c19-137">**Figure 1**: Add a New Table to the `SecurityTutorials` Database  ([Click to view full-size image](storing-additional-user-information-cs/_static/image3.png))</span></span>

<span data-ttu-id="42c19-138">Затем определите `GuestbookComments`в столбцы.</span><span class="sxs-lookup"><span data-stu-id="42c19-138">Next, define the `GuestbookComments`'s columns.</span></span> <span data-ttu-id="42c19-139">Начните с добавления столбца с именем `CommentId` типа `uniqueidentifier`.</span><span class="sxs-lookup"><span data-stu-id="42c19-139">Start by adding a column named `CommentId` of type `uniqueidentifier`.</span></span> <span data-ttu-id="42c19-140">Этот столбец будет уникальной идентификации каждого комментария в гостевой книги, поэтому запрещать `NULL` s и пометить его как первичный ключ таблицы.</span><span class="sxs-lookup"><span data-stu-id="42c19-140">This column will uniquely identify each comment in the guestbook, so disallow `NULL` s and mark it as the table's primary key.</span></span> <span data-ttu-id="42c19-141">Вместо того, чтобы предоставить значение для `CommentId` на каждый `INSERT`, мы может указывать, что новый `uniqueidentifier` значение должно создаваться автоматически для этого поля на `INSERT` , задав значение столбца по умолчанию `NEWID()`.</span><span class="sxs-lookup"><span data-stu-id="42c19-141">Rather than providing a value for the `CommentId` field on each `INSERT`, we can indicate that a new `uniqueidentifier` value should be automatically generated for this field on `INSERT` by setting the column's default value to `NEWID()`.</span></span> <span data-ttu-id="42c19-142">После добавления этого первого поля, пометив его как первичный ключ и параметров значения по умолчанию и экран должен выглядеть аналогично снимок экрана, показанный на рис. 2.</span><span class="sxs-lookup"><span data-stu-id="42c19-142">After adding this first field, marking it as the primary key, and settings its default value, your screen should look similar to the screen shot shown in Figure 2.</span></span>

<span data-ttu-id="42c19-143">[![Добавление основной столбец с именем CommentId](storing-additional-user-information-cs/_static/image5.png)](storing-additional-user-information-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="42c19-143">[![Add a Primary Column Named CommentId](storing-additional-user-information-cs/_static/image5.png)](storing-additional-user-information-cs/_static/image4.png)</span></span>

<span data-ttu-id="42c19-144">**Рис. 2**: Добавление основной столбец с именем `CommentId` ([Просмотр полноразмерного изображения](storing-additional-user-information-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="42c19-144">**Figure 2**: Add a Primary Column Named `CommentId` ([Click to view full-size image](storing-additional-user-information-cs/_static/image6.png))</span></span>

<span data-ttu-id="42c19-145">Добавьте столбец с именем `Subject` типа `nvarchar(50)` и столбец с именем `Body` типа `nvarchar(MAX)`, запрет `NULL` s в обоих столбцах.</span><span class="sxs-lookup"><span data-stu-id="42c19-145">Next, add a column named `Subject` of type `nvarchar(50)` and a column named `Body` of type `nvarchar(MAX)`, disallowing `NULL` s in both columns.</span></span> <span data-ttu-id="42c19-146">После этого добавьте столбец с именем `CommentDate` типа `datetime`.</span><span class="sxs-lookup"><span data-stu-id="42c19-146">Following that, add a column named `CommentDate` of type `datetime`.</span></span> <span data-ttu-id="42c19-147">Запретить `NULL` и установить `CommentDate` по умолчанию значение столбца для `getdate()`.</span><span class="sxs-lookup"><span data-stu-id="42c19-147">Disallow `NULL` s and set the `CommentDate` column's default value to `getdate()`.</span></span>

<span data-ttu-id="42c19-148">Все, что остается лишь добавить столбец, который связывает учетную запись пользователя с каждым из этих комментариев гостевой книги.</span><span class="sxs-lookup"><span data-stu-id="42c19-148">All that remains is to add a column that associates a user account with each guestbook comment.</span></span> <span data-ttu-id="42c19-149">Один из вариантов следовало бы добавить столбец с именем `UserName` типа `nvarchar(256)`.</span><span class="sxs-lookup"><span data-stu-id="42c19-149">One option would be to add a column named `UserName` of type `nvarchar(256)`.</span></span> <span data-ttu-id="42c19-150">Это является подходящим выбором при использовании поставщика членства, отличные от `SqlMembershipProvider`.</span><span class="sxs-lookup"><span data-stu-id="42c19-150">This is a suitable choice when using a Membership provider other than the `SqlMembershipProvider`.</span></span> <span data-ttu-id="42c19-151">Но при использовании `SqlMembershipProvider`, поскольку в этой серии руководств `UserName` столбца в `aspnet_Users` таблицы не обязательно быть уникальным.</span><span class="sxs-lookup"><span data-stu-id="42c19-151">But when using the `SqlMembershipProvider`, as we are in this tutorial series, the `UserName` column in the `aspnet_Users` table is not guaranteed to be unique.</span></span> <span data-ttu-id="42c19-152">`aspnet_Users` Является первичным ключом таблицы `UserId` и имеет тип `uniqueidentifier`.</span><span class="sxs-lookup"><span data-stu-id="42c19-152">The `aspnet_Users` table's primary key is `UserId` and is of type `uniqueidentifier`.</span></span> <span data-ttu-id="42c19-153">Таким образом `GuestbookComments` таблица должна столбец с именем `UserId` типа `uniqueidentifier` (запрет `NULL` значения).</span><span class="sxs-lookup"><span data-stu-id="42c19-153">Therefore, the `GuestbookComments` table needs a column named `UserId` of type `uniqueidentifier` (disallowing `NULL` values).</span></span> <span data-ttu-id="42c19-154">Теперь добавим этот столбец.</span><span class="sxs-lookup"><span data-stu-id="42c19-154">Go ahead and add this column.</span></span>

> [!NOTE]
> <span data-ttu-id="42c19-155">Как уже говорилось в [ *Создание схемы членства в SQL Server* ](creating-the-membership-schema-in-sql-server-cs.md) учебника, обеспечивает возможность нескольких веб-приложений с разными учетными записями одного и того же структуру членства хранилище пользователя.</span><span class="sxs-lookup"><span data-stu-id="42c19-155">As we discussed in the [*Creating the Membership Schema in SQL Server*](creating-the-membership-schema-in-sql-server-cs.md) tutorial, the Membership framework is designed to enable multiple web applications with different user accounts to share the same user store.</span></span> <span data-ttu-id="42c19-156">Это достигается путем разделения учетных записей пользователей на различных приложений.</span><span class="sxs-lookup"><span data-stu-id="42c19-156">It does this by partitioning user accounts into different applications.</span></span> <span data-ttu-id="42c19-157">И хотя каждое имя пользователя гарантированно будет уникальным в пределах приложения, того же имени пользователя может использоваться в различных приложениях, используя то же хранилище пользователя.</span><span class="sxs-lookup"><span data-stu-id="42c19-157">And while each username is guaranteed to be unique within an application, the same username may be used in different applications using the same user store.</span></span> <span data-ttu-id="42c19-158">Имеется составной `UNIQUE` ограничение в `aspnet_Users` таблицы на `UserName` и `ApplicationId` поля, но не на только что `UserName` поля.</span><span class="sxs-lookup"><span data-stu-id="42c19-158">There is a composite `UNIQUE` constraint in the `aspnet_Users` table on the `UserName` and `ApplicationId` fields, but not one on just the `UserName` field.</span></span> <span data-ttu-id="42c19-159">Следовательно, возможна aspnet\_таблице Users иметь два (или более) записей с одним `UserName` значение.</span><span class="sxs-lookup"><span data-stu-id="42c19-159">Consequently, it is possible for the aspnet\_Users table to have two (or more) records with the same `UserName` value.</span></span> <span data-ttu-id="42c19-160">Однако, есть `UNIQUE` ограничение на `aspnet_Users` таблицы `UserId` поле (так как он является первичным ключом).</span><span class="sxs-lookup"><span data-stu-id="42c19-160">There is, however, a `UNIQUE` constraint on the `aspnet_Users` table's `UserId` field (since it is the primary key).</span></span> <span data-ttu-id="42c19-161">Объект `UNIQUE` ограничение важно, поскольку без него не удается установить ограничение внешнего ключа между `GuestbookComments` и `aspnet_Users` таблицы.</span><span class="sxs-lookup"><span data-stu-id="42c19-161">A `UNIQUE` constraint is important because without it we cannot establish a foreign key constraint between the `GuestbookComments` and `aspnet_Users` tables.</span></span>

<span data-ttu-id="42c19-162">После добавления `UserId` столбцом, сохранить таблицу, щелкнув значок "Сохранить" на панели инструментов.</span><span class="sxs-lookup"><span data-stu-id="42c19-162">After adding the `UserId` column, save the table by clicking on the Save icon in the Toolbar.</span></span> <span data-ttu-id="42c19-163">Назовите новую таблицу `GuestbookComments`.</span><span class="sxs-lookup"><span data-stu-id="42c19-163">Name the new table `GuestbookComments`.</span></span>

<span data-ttu-id="42c19-164">У нас есть один прошлом выпуске, чтобы заняться работой с `GuestbookComments` таблицы: нам необходимо создать [ограничение внешнего ключа](https://msdn.microsoft.com/library/ms175464.aspx) между `GuestbookComments.UserId` столбца и `aspnet_Users.UserId` столбца.</span><span class="sxs-lookup"><span data-stu-id="42c19-164">We have one last issue to attend to with the `GuestbookComments` table: we need to create a [foreign key constraint](https://msdn.microsoft.com/library/ms175464.aspx) between the `GuestbookComments.UserId` column and the `aspnet_Users.UserId` column.</span></span> <span data-ttu-id="42c19-165">Для этого щелкните значок «связи» в панели инструментов, чтобы открыть диалоговое окно связи по внешнему ключу.</span><span class="sxs-lookup"><span data-stu-id="42c19-165">To achieve this, click the Relationship icon in the Toolbar to launch the Foreign Key Relationships dialog box.</span></span> <span data-ttu-id="42c19-166">(Кроме того, можно открыть его, перейдя в меню конструктора таблиц и выборе связи.)</span><span class="sxs-lookup"><span data-stu-id="42c19-166">(Alternatively, you can launch this dialog box by going to the Table Designer menu and choosing Relationships.)</span></span>

<span data-ttu-id="42c19-167">В левом нижнем углу диалогового окна связи по внешнему ключу, нажмите кнопку Добавить.</span><span class="sxs-lookup"><span data-stu-id="42c19-167">Click the Add button in the lower left corner of the Foreign Key Relationships dialog box.</span></span> <span data-ttu-id="42c19-168">Будут добавлены новые ограничения внешнего ключа, несмотря на то, что мы по-прежнему требуется для определения таблиц, участвующих в связи.</span><span class="sxs-lookup"><span data-stu-id="42c19-168">This will add a new foreign key constraint, although we still need to define the tables that participate in the relationship.</span></span>

<span data-ttu-id="42c19-169">[![Используйте диалоговое окно связей по внешнему ключу для управления ограничения внешнего ключа таблицы](storing-additional-user-information-cs/_static/image8.png)](storing-additional-user-information-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="42c19-169">[![Use the Foreign Key Relationships Dialog Box to Manage a Table's Foreign Key Constraints](storing-additional-user-information-cs/_static/image8.png)](storing-additional-user-information-cs/_static/image7.png)</span></span>

<span data-ttu-id="42c19-170">**Рис. 3**: Использовать для управления ограничения внешнего ключа таблицы внешнего ключа связи диалоговом окне ([Просмотр полноразмерного изображения](storing-additional-user-information-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="42c19-170">**Figure 3**: Use the Foreign Key Relationships Dialog Box to Manage a Table's Foreign Key Constraints  ([Click to view full-size image](storing-additional-user-information-cs/_static/image9.png))</span></span>

<span data-ttu-id="42c19-171">Затем щелкните значок многоточия в строке «Спецификации таблиц и столбцов» в правой части.</span><span class="sxs-lookup"><span data-stu-id="42c19-171">Next, click the ellipses icon in the "Table and Columns Specifications" row on the right.</span></span> <span data-ttu-id="42c19-172">Это приведет к запуску таблиц и столбцов, диалоговое окно, из которого можно указать таблицы первичного ключа и столбец и столбец внешнего ключа из `GuestbookComments` таблицы.</span><span class="sxs-lookup"><span data-stu-id="42c19-172">This will launch the Tables and Columns dialog box, from which we can specify the primary key table and column and the foreign key column from the `GuestbookComments` table.</span></span> <span data-ttu-id="42c19-173">В частности, выбирайте `aspnet_Users` и `UserId` как таблица первичного ключа и столбец, и `UserId` из `GuestbookComments` таблице как столбец внешнего ключа (см. рис. 4).</span><span class="sxs-lookup"><span data-stu-id="42c19-173">In particular, select `aspnet_Users` and `UserId` as the primary key table and column, and `UserId` from the `GuestbookComments` table as the foreign key column (see Figure 4).</span></span> <span data-ttu-id="42c19-174">После определения первичного и внешнего ключа таблицы и столбцы, нажмите кнопку ОК, чтобы вернуться в диалоговое окно связи по внешнему ключу.</span><span class="sxs-lookup"><span data-stu-id="42c19-174">After defining the primary and foreign key tables and columns, click OK to return to the Foreign Key Relationships dialog box.</span></span>

<span data-ttu-id="42c19-175">[![Определение внешнего ключа ограничения между aspnet_Users и GuesbookComments таблиц](storing-additional-user-information-cs/_static/image11.png)](storing-additional-user-information-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="42c19-175">[![Establish a Foreign Key Constraint Between the aspnet_Users and GuesbookComments Tables](storing-additional-user-information-cs/_static/image11.png)](storing-additional-user-information-cs/_static/image10.png)</span></span>

<span data-ttu-id="42c19-176">**Рис. 4**: Установить внешнего ключа ограничения между `aspnet_Users` и `GuesbookComments` таблиц ([Просмотр полноразмерного изображения](storing-additional-user-information-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="42c19-176">**Figure 4**: Establish a Foreign Key Constraint Between the `aspnet_Users` and `GuesbookComments` Tables  ([Click to view full-size image](storing-additional-user-information-cs/_static/image12.png))</span></span>

<span data-ttu-id="42c19-177">На этом этапе было установлено ограничение внешнего ключа.</span><span class="sxs-lookup"><span data-stu-id="42c19-177">At this point the foreign key constraint has been established.</span></span> <span data-ttu-id="42c19-178">Наличие этого ограничения гарантирует [реляционной целостности](http://en.wikipedia.org/wiki/Referential_integrity) между двумя таблицами, гарантируя, что никогда не будет записи гостевой книги, ссылающийся на учетную запись пользователя не существует.</span><span class="sxs-lookup"><span data-stu-id="42c19-178">The presence of this constraint ensures [relational integrity](http://en.wikipedia.org/wiki/Referential_integrity) between the two tables by guaranteeing that there will never be a guestbook entry referring to a non-existent user account.</span></span> <span data-ttu-id="42c19-179">По умолчанию ограничения внешнего ключа запретит родительскую запись удаленным, если существуют соответствующие дочерние записи.</span><span class="sxs-lookup"><span data-stu-id="42c19-179">By default, a foreign key constraint will disallow a parent record to be deleted if there are corresponding child records.</span></span> <span data-ttu-id="42c19-180">То есть если пользователь создает один или несколько комментариях, а затем предпринимается попытка удаления этой учетной записи пользователя, удаления, если не сначала удалить его комментариях.</span><span class="sxs-lookup"><span data-stu-id="42c19-180">That is, if a user makes one or more guestbook comments, and then we attempt to delete that user account, the delete will fail unless his guestbook comments are deleted first.</span></span>

<span data-ttu-id="42c19-181">Ограничения внешнего ключа можно настроить автоматическое удаление связанных дочерних записей при удалении родительской записи.</span><span class="sxs-lookup"><span data-stu-id="42c19-181">Foreign key constraints can be configured to automatically delete the associated child records when a parent record is deleted.</span></span> <span data-ttu-id="42c19-182">Другими словами мы можете настроить это ограничение внешнего ключа, чтобы записи гостевой книги пользователя будут автоматически удалены при удалении своей учетной записи пользователя.</span><span class="sxs-lookup"><span data-stu-id="42c19-182">In other words, we can setup this foreign key constraint so that a user's guestbook entries are automatically deleted when her user account is deleted.</span></span> <span data-ttu-id="42c19-183">Для этого разверните раздел «INSERT и UPDATE спецификация» и присвойте свойству «Удалить правило» Cascade.</span><span class="sxs-lookup"><span data-stu-id="42c19-183">To accomplish this, expand the "INSERT And UPDATE Specification" section and set the "Delete Rule" property to Cascade.</span></span>

<span data-ttu-id="42c19-184">[![Настройка ограничения внешнего ключа для каскадное удаление](storing-additional-user-information-cs/_static/image14.png)](storing-additional-user-information-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="42c19-184">[![Configure the Foreign Key Constraint to Cascade Deletes](storing-additional-user-information-cs/_static/image14.png)](storing-additional-user-information-cs/_static/image13.png)</span></span>

<span data-ttu-id="42c19-185">**Рис. 5**: Настроить ограничение внешнего ключа для каскадные удаления ([Просмотр полноразмерного изображения](storing-additional-user-information-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="42c19-185">**Figure 5**: Configure the Foreign Key Constraint to Cascade Deletes  ([Click to view full-size image](storing-additional-user-information-cs/_static/image15.png))</span></span>

<span data-ttu-id="42c19-186">Чтобы сохранить ограничение внешнего ключа, нажмите кнопку «Закрыть», чтобы выйти из связи внешних ключей.</span><span class="sxs-lookup"><span data-stu-id="42c19-186">To save the foreign key constraint, click the Close button to exit out of the Foreign Key Relationships.</span></span> <span data-ttu-id="42c19-187">Щелкните значок "Сохранить" в панели инструментов, чтобы сохранить в таблице и эта связь.</span><span class="sxs-lookup"><span data-stu-id="42c19-187">Then click the Save icon in the Toolbar to save the table and the this relationship.</span></span>

### <a name="storing-the-users-home-town-homepage-and-signature"></a><span data-ttu-id="42c19-188">Хранение домашней Город пользователя, домашней страницы и подпись</span><span class="sxs-lookup"><span data-stu-id="42c19-188">Storing the User's Home Town, Homepage, and Signature</span></span>

<span data-ttu-id="42c19-189">`GuestbookComments` Таблице показано, как для хранения информации, один ко многим связь с учетных записей пользователей.</span><span class="sxs-lookup"><span data-stu-id="42c19-189">The `GuestbookComments` table illustrates how to store information that shares a one-to-many relationship with user accounts.</span></span> <span data-ttu-id="42c19-190">Поскольку каждая учетная запись пользователя может иметь произвольное число комментарий, эта связь моделируется путем создания таблицы для хранения комментариев со столбцом, что ссылается каждый комментарий к конкретному пользователю.</span><span class="sxs-lookup"><span data-stu-id="42c19-190">Since each user account may have an arbitrary number of associated comments, this relationship is modeled by creating a table to hold the set of comments that includes a column that links back each comment to a particular user.</span></span> <span data-ttu-id="42c19-191">При использовании `SqlMembershipProvider`, связь лучше всего будет установлена, создав столбец с именем `UserId` типа `uniqueidentifier` и ограничение внешнего ключа между этот столбец и `aspnet_Users.UserId`.</span><span class="sxs-lookup"><span data-stu-id="42c19-191">When using the `SqlMembershipProvider`, this link is best established by creating a column named `UserId` of type `uniqueidentifier` and a foreign key constraint between this column and `aspnet_Users.UserId`.</span></span>

<span data-ttu-id="42c19-192">Теперь нам нужно связать три столбца с каждой учетной записи пользователя для хранения пользователя родном городе пользователя домашней страницы и подпись, которая будет отображаться в своем комментарии гостевой книги.</span><span class="sxs-lookup"><span data-stu-id="42c19-192">We now need to associate three columns with each user account to store the user's home town, homepage, and signature, which will appear in his guestbook comments.</span></span> <span data-ttu-id="42c19-193">Существуют число различных способов выполнения этой задачи:</span><span class="sxs-lookup"><span data-stu-id="42c19-193">There are number of different ways to accomplish this:</span></span>

- <span data-ttu-id="42c19-194"><strong>Добавить столбцы</strong><strong>`aspnet_Users`</strong><strong>или</strong><strong>`aspnet_Membership`</strong><strong>таблиц.</strong></span><span class="sxs-lookup"><span data-stu-id="42c19-194"><strong>Add new columns to the</strong><strong>`aspnet_Users`</strong><strong>or</strong><strong>`aspnet_Membership`</strong><strong>tables.</strong></span></span> <span data-ttu-id="42c19-195">Я не рекомендую этот подход, так как она изменяет схемы, используемой `SqlMembershipProvider`.</span><span class="sxs-lookup"><span data-stu-id="42c19-195">I would not recommend this approach because it modifies the schema used by the `SqlMembershipProvider`.</span></span> <span data-ttu-id="42c19-196">Это решение может вернуться перейдет в будущем.</span><span class="sxs-lookup"><span data-stu-id="42c19-196">This decision may come back to haunt you down the road.</span></span> <span data-ttu-id="42c19-197">Например, что делать, если будущей версии ASP.NET использует другое `SqlMembershipProvider` схемы.</span><span class="sxs-lookup"><span data-stu-id="42c19-197">For example, what if a future version of ASP.NET uses a different `SqlMembershipProvider` schema.</span></span> <span data-ttu-id="42c19-198">Microsoft может включать средство для переноса в ASP.NET 2.0 `SqlMembershipProvider` данных до новой схемы, но если вы изменили в ASP.NET 2.0 `SqlMembershipProvider` схемы, такое преобразование может оказаться невозможным.</span><span class="sxs-lookup"><span data-stu-id="42c19-198">Microsoft may include a tool to migrate the ASP.NET 2.0 `SqlMembershipProvider` data to the new schema, but if you have modified the ASP.NET 2.0 `SqlMembershipProvider` schema, such a conversion may not be possible.</span></span>

- <span data-ttu-id="42c19-199">**С помощью ASP. NET framework профиля, определение свойства профиля для домашних города, домашней страницы и подпись.**</span><span class="sxs-lookup"><span data-stu-id="42c19-199">**Use ASP.NET's Profile framework, defining a profile property for the home town, homepage, and signature.**</span></span> <span data-ttu-id="42c19-200">ASP.NET включает платформу профиль, предназначенный для хранения дополнительных данных конкретного пользователя.</span><span class="sxs-lookup"><span data-stu-id="42c19-200">ASP.NET includes a Profile framework that is designed to store additional user-specific data.</span></span> <span data-ttu-id="42c19-201">Как структуру членства профиля framework строится поверх модели поставщиков.</span><span class="sxs-lookup"><span data-stu-id="42c19-201">Like the Membership framework, the Profile framework is built atop the provider model.</span></span> <span data-ttu-id="42c19-202">.NET Framework поставляется с `SqlProfileProvider` sthat, которая хранит данные профиля в базе данных SQL Server.</span><span class="sxs-lookup"><span data-stu-id="42c19-202">The .NET Framework ships with a `SqlProfileProvider` sthat stores profile data in a SQL Server database.</span></span> <span data-ttu-id="42c19-203">На самом деле, нашей базе данных уже есть таблицы, используемой `SqlProfileProvider` (`aspnet_Profile`), как он был добавлен, когда мы добавили служб приложения обратно в <a id="_msoanchor_2"> </a> [ *Создание схемы членства в SQL Сервер* ](creating-the-membership-schema-in-sql-server-cs.md) руководства.</span><span class="sxs-lookup"><span data-stu-id="42c19-203">In fact, our database already has the table used by the `SqlProfileProvider` (`aspnet_Profile`), as it was added when we added the application services back in the <a id="_msoanchor_2"></a>[*Creating the Membership Schema in SQL Server*](creating-the-membership-schema-in-sql-server-cs.md) tutorial.</span></span>   
  <span data-ttu-id="42c19-204">Основным преимуществом framework профиля — что он позволяет разработчикам определять свойства профиля в `Web.config` — код не нужно писать для сериализации данных профиля в и из базового хранилища данных.</span><span class="sxs-lookup"><span data-stu-id="42c19-204">The main benefit of the Profile framework is that it allows for developers to define the profile properties in `Web.config` – no code needs to be written to serialize the profile data to and from the underlying data store.</span></span> <span data-ttu-id="42c19-205">Короче говоря это очень просто определить набор свойств профилей и работа с ними в коде.</span><span class="sxs-lookup"><span data-stu-id="42c19-205">In short, it is incredibly easy to define a set of profile properties and to work with them in code.</span></span> <span data-ttu-id="42c19-206">Тем не менее, система профиля далека от идеальной желать лучшего, когда дело доходит до управления версиями, поэтому, если у вас есть приложение, где предполагается, что новые пользовательские свойства для добавления в более позднее время или существующие, чтобы удалить или изменить, а затем framework профиля не может быть  лучшим вариантом.</span><span class="sxs-lookup"><span data-stu-id="42c19-206">However, the Profile system leaves a lot to be desired when it comes to versioning, so if you have an application where you expect new user-specific properties to be added at a later time, or existing ones to be removed or modified, then the Profile framework may not be the best option.</span></span> <span data-ttu-id="42c19-207">Кроме того `SqlProfileProvider` сохраняет свойство профиля высокой денормализованные образом, что делает практически невозможным для выполнения запросов непосредственно к данные профиля (например, сколько пользователей имеют домашний города Нью-Йорк).</span><span class="sxs-lookup"><span data-stu-id="42c19-207">Moreover, the `SqlProfileProvider` stores the profile properties in a highly denormalized fashion, making it next to impossible to run queries directly against the profile data (such as, how many users have a home town of New York).</span></span>   
  <span data-ttu-id="42c19-208">Дополнительные сведения о профиле framework см. в разделе «Дополнительные материалы» в конце этого руководства.</span><span class="sxs-lookup"><span data-stu-id="42c19-208">For more information on the Profile framework, consult the "Further Readings" section at the end of this tutorial.</span></span>

- <span data-ttu-id="42c19-209"><strong>Добавьте эти три столбца в новую таблицу в базе данных и установить отношение один к одному между этой таблицей и</strong><strong>`aspnet_Users`</strong><strong>.</strong></span><span class="sxs-lookup"><span data-stu-id="42c19-209"><strong>Add these three columns to a new table in the database and establish a one-to-one relationship between this table and</strong><strong>`aspnet_Users`</strong><strong>.</strong></span></span> <span data-ttu-id="42c19-210">Этот подход требует немного больше усилий, чем с помощью платформы профиля, но предоставляет максимальную гибкость при как дополнительные пользовательские свойства моделируются в базе данных.</span><span class="sxs-lookup"><span data-stu-id="42c19-210">This approach involves a bit more work than with the Profile framework, but offers maximum flexibility in how the additional user properties are modeled in the database.</span></span> <span data-ttu-id="42c19-211">Это параметр, которые будут использоваться в этом руководстве.</span><span class="sxs-lookup"><span data-stu-id="42c19-211">This is the option we will use in this tutorial.</span></span>

<span data-ttu-id="42c19-212">Мы создадим новую таблицу с именем `UserProfiles` сохранить родного города, домашней страницы и подписи для каждого пользователя.</span><span class="sxs-lookup"><span data-stu-id="42c19-212">We will create a new table called `UserProfiles` to save the home town, homepage, and signature for each user.</span></span> <span data-ttu-id="42c19-213">Щелкните правой кнопкой мыши папку «таблицы» в окне обозревателя базы данных и выберите команду Создать новую таблицу.</span><span class="sxs-lookup"><span data-stu-id="42c19-213">Right-click on the Tables folder in the Database Explorer window and choose to create a new table.</span></span> <span data-ttu-id="42c19-214">Имя первого столбца `UserId` и установите для него `uniqueidentifier`.</span><span class="sxs-lookup"><span data-stu-id="42c19-214">Name the first column `UserId` and set its type to `uniqueidentifier`.</span></span> <span data-ttu-id="42c19-215">Запретить `NULL` значений и пометить столбец как первичный ключ.</span><span class="sxs-lookup"><span data-stu-id="42c19-215">Disallow `NULL` values and mark the column as a primary key.</span></span> <span data-ttu-id="42c19-216">Добавьте столбцы с именами: `HomeTown` типа `nvarchar(50)`; `HomepageUrl` типа `nvarchar(100)`; и сигнатуры типа `nvarchar(500)`.</span><span class="sxs-lookup"><span data-stu-id="42c19-216">Next, add columns named: `HomeTown` of type `nvarchar(50)`; `HomepageUrl` of type `nvarchar(100)`; and Signature of type `nvarchar(500)`.</span></span> <span data-ttu-id="42c19-217">Каждый из этих трех столбцов может принимать `NULL` значение.</span><span class="sxs-lookup"><span data-stu-id="42c19-217">Each of these three columns can accept a `NULL` value.</span></span>

<span data-ttu-id="42c19-218">[![Создать таблицу UserProfiles](storing-additional-user-information-cs/_static/image17.png)](storing-additional-user-information-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="42c19-218">[![Create the UserProfiles Table](storing-additional-user-information-cs/_static/image17.png)](storing-additional-user-information-cs/_static/image16.png)</span></span>

<span data-ttu-id="42c19-219">**Рис. 6**: Создание `UserProfiles` таблицы ([Просмотр полноразмерного изображения](storing-additional-user-information-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="42c19-219">**Figure 6**: Create the `UserProfiles` Table  ([Click to view full-size image](storing-additional-user-information-cs/_static/image18.png))</span></span>

<span data-ttu-id="42c19-220">Сохраните таблицу и назовите его `UserProfiles`.</span><span class="sxs-lookup"><span data-stu-id="42c19-220">Save the table and name it `UserProfiles`.</span></span> <span data-ttu-id="42c19-221">Наконец, установить ограничение внешнего ключа между `UserProfiles` таблицы `UserId` поля и `aspnet_Users.UserId` поля.</span><span class="sxs-lookup"><span data-stu-id="42c19-221">Lastly, establish a foreign key constraint between the `UserProfiles` table's `UserId` field and the `aspnet_Users.UserId` field.</span></span> <span data-ttu-id="42c19-222">Как мы сделали с ограничение внешнего ключа между `GuestbookComments` и `aspnet_Users` таблицы, имеют этого ограничения каскадное удаление.</span><span class="sxs-lookup"><span data-stu-id="42c19-222">As we did with the foreign key constraint between the `GuestbookComments` and `aspnet_Users` tables, have this constraint cascade deletes.</span></span> <span data-ttu-id="42c19-223">Так как `UserId` в `UserProfiles` первичный ключ — это гарантирует, что будет существовать не более чем одной записи в `UserProfiles` таблицы для каждой учетной записи пользователя.</span><span class="sxs-lookup"><span data-stu-id="42c19-223">Since the `UserId` field in `UserProfiles` is the primary key, this ensures that there will be no more than one record in the `UserProfiles` table for each user account.</span></span> <span data-ttu-id="42c19-224">Этот тип связи называется как один к одному.</span><span class="sxs-lookup"><span data-stu-id="42c19-224">This type of relationship is referred to as one-to-one.</span></span>

<span data-ttu-id="42c19-225">Теперь, когда у нас есть модель данных, созданная, мы готовы использовать его.</span><span class="sxs-lookup"><span data-stu-id="42c19-225">Now that we have the data model created, we are ready to use it.</span></span> <span data-ttu-id="42c19-226">В шагах 2 и 3 мы рассмотрим как текущего пользователя можно просматривать и изменять их домашней города, домашней страницы и информацию о подписи.</span><span class="sxs-lookup"><span data-stu-id="42c19-226">In Steps 2 and 3 we will look at how the currently logged on user can view and edit their home town, homepage, and signature information.</span></span> <span data-ttu-id="42c19-227">На шаге 4 мы создадим интерфейс для прошедших проверку пользователей отправить новые комментарии в гостевую книгу и просматривать существующие серверы.</span><span class="sxs-lookup"><span data-stu-id="42c19-227">In Step 4 we will create the interface for authenticated users to submit new comments to the guestbook and view the existing ones.</span></span>

## <a name="step-2-displaying-the-users-home-town-homepage-and-signature"></a><span data-ttu-id="42c19-228">Шаг 2. Отображение домашней Город пользователя, домашней страницы и подписи</span><span class="sxs-lookup"><span data-stu-id="42c19-228">Step 2: Displaying the User's Home Town, Homepage, and Signature</span></span>

<span data-ttu-id="42c19-229">Существует ряд способов, чтобы разрешить текущего пользователя для просмотра и изменения его домашней города, домашней страницы и информацию о подписи.</span><span class="sxs-lookup"><span data-stu-id="42c19-229">There are a variety of ways to allow the currently logged on user to view and edit his home town, homepage, and signature information.</span></span> <span data-ttu-id="42c19-230">Можно вручную создать пользовательский интерфейс с текстовым полем и меток или мы использовать один из элементов управления, например элемент управления DetailsView.</span><span class="sxs-lookup"><span data-stu-id="42c19-230">We could manually create the user interface with TextBox and Label controls or we could use one of the data Web controls, such as the DetailsView control.</span></span> <span data-ttu-id="42c19-231">Для выполнения базы данных `SELECT` и `UPDATE` операторов, ADO.NET можно было бы написать код на нашей странице вспомогательного класса, или в качестве альтернативы использовать декларативный подход с помощью элемента управления SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="42c19-231">To perform the database `SELECT` and `UPDATE` statements we could write ADO.NET code in our page's code-behind class or, alternatively, employ a declarative approach with the SqlDataSource.</span></span> <span data-ttu-id="42c19-232">В идеале наше приложение будет содержать многоуровневые архитектуры, мы, либо может вызвать программно из вспомогательного класса страницы, или декларативно с помощью элемента управления ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="42c19-232">Ideally our application would contain a tiered architecture, which we could either invoke programmatically from the page's code-behind class or declaratively via the ObjectDataSource control.</span></span>

<span data-ttu-id="42c19-233">Так как в этой серии руководств посвящена форм проверки подлинности, авторизации, учетные записи пользователей и ролей, не будет подробное описание этих параметров доступа другими данными или почему многоуровневые архитектуры предпочтительнее, чем выполнение инструкций SQL непосредственно на странице ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="42c19-233">Since this tutorial series focuses on forms authentication, authorization, user accounts, and roles, there will not be a thorough discussion of these different data access options or why a tiered architecture is preferred over executing SQL statements directly from the ASP.NET page.</span></span> <span data-ttu-id="42c19-234">Я собираюсь изучить использование DetailsView и SqlDataSource — параметр быстрый и простой — но обсуждавшиеся определенно могут применяться к альтернативным Web элементы управления и данных логики доступа к.</span><span class="sxs-lookup"><span data-stu-id="42c19-234">I am going to walk through using a DetailsView and SqlDataSource – the quickest and easiest option – but the concepts discussed can certainly be applied to alternative Web controls and data access logic.</span></span> <span data-ttu-id="42c19-235">Дополнительные сведения о работе с данными в ASP.NET см. Мой *[работа с данными в ASP.NET 2.0](../../data-access/index.md)* серии руководств.</span><span class="sxs-lookup"><span data-stu-id="42c19-235">For more information on working with data in ASP.NET, refer to my *[Working with Data in ASP.NET 2.0](../../data-access/index.md)* tutorial series.</span></span>

<span data-ttu-id="42c19-236">Откройте `AdditionalUserInfo.aspx` странице в `Membership` папку и добавьте элемент управления DetailsView к странице, устанавливая его `ID` свойства `UserProfile` и очищая его `Width` и `Height` свойства.</span><span class="sxs-lookup"><span data-stu-id="42c19-236">Open the `AdditionalUserInfo.aspx` page in the `Membership` folder and add a DetailsView control to the page, setting its `ID` property to `UserProfile` and clearing out its `Width` and `Height` properties.</span></span> <span data-ttu-id="42c19-237">Разверните DetailsView смарт-тег и выберите привязать его к новый элемент управления источником данных.</span><span class="sxs-lookup"><span data-stu-id="42c19-237">Expand the DetailsView's Smart Tag and choose to bind it to a new data source control.</span></span> <span data-ttu-id="42c19-238">Это приведет к запуску мастера настройки источника данных (см. рис. 7).</span><span class="sxs-lookup"><span data-stu-id="42c19-238">This will launch the DataSource Configuration Wizard (see Figure 7).</span></span> <span data-ttu-id="42c19-239">Первым шагом просит указать тип источника данных.</span><span class="sxs-lookup"><span data-stu-id="42c19-239">The first step asks you to specify the data source type.</span></span> <span data-ttu-id="42c19-240">Так как мы собираемся подключать напрямую к `SecurityTutorials` базы данных, выберите значок базы данных, указав `ID` как `UserProfileDataSource`.</span><span class="sxs-lookup"><span data-stu-id="42c19-240">Since we are going to connect directly to the `SecurityTutorials` database, choose the Database icon, specifying the `ID` as `UserProfileDataSource`.</span></span>

<span data-ttu-id="42c19-241">[![Добавление нового элемента управления SqlDataSource с именем UserProfileDataSource](storing-additional-user-information-cs/_static/image20.png)](storing-additional-user-information-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="42c19-241">[![Add a New SqlDataSource Control Named UserProfileDataSource](storing-additional-user-information-cs/_static/image20.png)](storing-additional-user-information-cs/_static/image19.png)</span></span>

<span data-ttu-id="42c19-242">**Рис. 7**: Добавление нового элемента управления SqlDataSource с именем `UserProfileDataSource` ([Просмотр полноразмерного изображения](storing-additional-user-information-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="42c19-242">**Figure 7**: Add a New SqlDataSource Control Named `UserProfileDataSource` ([Click to view full-size image](storing-additional-user-information-cs/_static/image21.png))</span></span>

<span data-ttu-id="42c19-243">Далее запрашивает для базы данных.</span><span class="sxs-lookup"><span data-stu-id="42c19-243">The next screen prompts for the database to use.</span></span> <span data-ttu-id="42c19-244">Мы уже определили строку подключения в `Web.config` для `SecurityTutorials` базы данных.</span><span class="sxs-lookup"><span data-stu-id="42c19-244">We have already defined a connection string in `Web.config` for the `SecurityTutorials` database.</span></span> <span data-ttu-id="42c19-245">Это имя строки подключения — `SecurityTutorialsConnectionString` — должны находиться в раскрывающемся списке.</span><span class="sxs-lookup"><span data-stu-id="42c19-245">This connection string name – `SecurityTutorialsConnectionString` – should be in the drop-down list.</span></span> <span data-ttu-id="42c19-246">Выберите этот вариант и нажмите кнопку Далее.</span><span class="sxs-lookup"><span data-stu-id="42c19-246">Select this option and click Next.</span></span>

<span data-ttu-id="42c19-247">[![Выберите SecurityTutorialsConnectionString из раскрывающегося списка](storing-additional-user-information-cs/_static/image23.png)](storing-additional-user-information-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="42c19-247">[![Choose SecurityTutorialsConnectionString from the Drop-Down List](storing-additional-user-information-cs/_static/image23.png)](storing-additional-user-information-cs/_static/image22.png)</span></span>

<span data-ttu-id="42c19-248">**Рис. 8**: Выберите `SecurityTutorialsConnectionString` из раскрывающегося списка ([Просмотр полноразмерного изображения](storing-additional-user-information-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="42c19-248">**Figure 8**: Choose `SecurityTutorialsConnectionString` from the Drop-Down List  ([Click to view full-size image](storing-additional-user-information-cs/_static/image24.png))</span></span>

<span data-ttu-id="42c19-249">Последующие экране указать таблицы и столбцы для запроса.</span><span class="sxs-lookup"><span data-stu-id="42c19-249">The subsequent screen asks us to specify the table and columns to query.</span></span> <span data-ttu-id="42c19-250">Выберите `UserProfiles` таблицу из раскрывающегося списка и проверьте все столбцы.</span><span class="sxs-lookup"><span data-stu-id="42c19-250">Choose the `UserProfiles` table from the drop-down list and check all of the columns.</span></span>

<span data-ttu-id="42c19-251">[![Перевести обратно все столбцы из таблицы UserProfiles](storing-additional-user-information-cs/_static/image26.png)](storing-additional-user-information-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="42c19-251">[![Bring Back All of the Columns from the UserProfiles Table](storing-additional-user-information-cs/_static/image26.png)](storing-additional-user-information-cs/_static/image25.png)</span></span>

<span data-ttu-id="42c19-252">**Рис. 9**: Переместить назад все столбцы из `UserProfiles` таблицы ([Просмотр полноразмерного изображения](storing-additional-user-information-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="42c19-252">**Figure 9**: Bring Back All of the Columns from the `UserProfiles` Table  ([Click to view full-size image](storing-additional-user-information-cs/_static/image27.png))</span></span>

<span data-ttu-id="42c19-253">Текущий запрос на рис. 9 возвращает *все* записей в `UserProfiles`, но нас интересует только запись текущего пользователя.</span><span class="sxs-lookup"><span data-stu-id="42c19-253">The current query in Figure 9 returns *all* of the records in `UserProfiles`, but we are only interested in the currently logged on user's record.</span></span> <span data-ttu-id="42c19-254">Чтобы добавить `WHERE` предложение, щелкните `WHERE` , чтобы открыть добавления `WHERE` предложение диалоговом (см. рис. 10).</span><span class="sxs-lookup"><span data-stu-id="42c19-254">To add a `WHERE` clause, click the `WHERE` button to bring up the Add `WHERE` Clause dialog box (see Figure 10).</span></span> <span data-ttu-id="42c19-255">Здесь можно выбрать столбец для фильтрации, оператора и источник параметра filter.</span><span class="sxs-lookup"><span data-stu-id="42c19-255">Here you can select the column to filter on, the operator, and the source of the filter parameter.</span></span> <span data-ttu-id="42c19-256">Выберите `UserId` как столбец и «=», что и оператор.</span><span class="sxs-lookup"><span data-stu-id="42c19-256">Select `UserId` as the column and "=" as the Operator.</span></span>

<span data-ttu-id="42c19-257">К сожалению, отсутствует встроенный параметр источник для возврата текущего пользователя `UserId` значение.</span><span class="sxs-lookup"><span data-stu-id="42c19-257">Unfortunately there is no built-in parameter source to return the currently logged on user's `UserId` value.</span></span> <span data-ttu-id="42c19-258">Нам потребуется получить это значение программно.</span><span class="sxs-lookup"><span data-stu-id="42c19-258">We will need to grab this value programmatically.</span></span> <span data-ttu-id="42c19-259">Таким образом задайте исходного стрелку раскрывающегося списка для «Нет» нажмите кнопку Add для добавления параметра, а затем нажмите кнопку ОК.</span><span class="sxs-lookup"><span data-stu-id="42c19-259">Therefore, set the Source drop-down list to "None," click the Add button to add the parameter, and then click OK.</span></span>

<span data-ttu-id="42c19-260">[![Добавьте параметр фильтра на столбец UserId](storing-additional-user-information-cs/_static/image29.png)](storing-additional-user-information-cs/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="42c19-260">[![Add a Filter Parameter on the UserId Column](storing-additional-user-information-cs/_static/image29.png)](storing-additional-user-information-cs/_static/image28.png)</span></span>

<span data-ttu-id="42c19-261">**Рис. 10**: Добавьте параметр фильтра на `UserId` столбца ([Просмотр полноразмерного изображения](storing-additional-user-information-cs/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="42c19-261">**Figure 10**: Add a Filter Parameter on the `UserId` Column  ([Click to view full-size image](storing-additional-user-information-cs/_static/image30.png))</span></span>

<span data-ttu-id="42c19-262">После нажатия кнопки ОК вы вернетесь на экран, показанный на рис. 9.</span><span class="sxs-lookup"><span data-stu-id="42c19-262">After clicking OK you will be returned to the screen shown in Figure 9.</span></span> <span data-ttu-id="42c19-263">На этот раз тем не менее, SQL-запрос в нижней части экрана должен включать `WHERE` предложение.</span><span class="sxs-lookup"><span data-stu-id="42c19-263">This time, however, the SQL query at the bottom of the screen should include a `WHERE` clause.</span></span> <span data-ttu-id="42c19-264">Для перехода экран «Проверка запроса», нажмите кнопку "Далее".</span><span class="sxs-lookup"><span data-stu-id="42c19-264">Click Next to move on to the "Test Query" screen.</span></span> <span data-ttu-id="42c19-265">Здесь можно выполнить запрос и просмотреть результаты.</span><span class="sxs-lookup"><span data-stu-id="42c19-265">Here you can run the query and see the results.</span></span> <span data-ttu-id="42c19-266">Нажмите кнопку Готово, чтобы завершить работу мастера.</span><span class="sxs-lookup"><span data-stu-id="42c19-266">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="42c19-267">После завершения работы мастера настройки источника данных, Visual Studio создает элемент управления SqlDataSource, на основе параметров, указанных в мастере.</span><span class="sxs-lookup"><span data-stu-id="42c19-267">Upon completing the DataSource Configuration Wizard, Visual Studio creates the SqlDataSource control based on the settings specified in the wizard.</span></span> <span data-ttu-id="42c19-268">Кроме того, он самостоятельно добавляет поля BoundField, кроме к элементу управления DetailsView для каждого столбца, возвращаемые SqlDataSource `SelectCommand`.</span><span class="sxs-lookup"><span data-stu-id="42c19-268">Moreover, it manually adds BoundFields to the DetailsView for each column returned by the SqlDataSource's `SelectCommand`.</span></span> <span data-ttu-id="42c19-269">Нет необходимости, чтобы показать `UserId` поле в DetailsView, поскольку пользователь не нужно знать это значение.</span><span class="sxs-lookup"><span data-stu-id="42c19-269">There's no need to show the `UserId` field in the DetailsView, since the user does not need to know this value.</span></span> <span data-ttu-id="42c19-270">Вы можете удалить это поле непосредственно из декларативная разметка элемента управления DetailsView или, нажав кнопку «Изменить поля» ссылка из его смарт-тега.</span><span class="sxs-lookup"><span data-stu-id="42c19-270">You can remove this field directly from the DetailsView control's declarative markup or by clicking the "Edit Fields" link from its Smart Tag.</span></span>

<span data-ttu-id="42c19-271">На этом этапе декларативная разметка страницы должна выглядеть следующего вида:</span><span class="sxs-lookup"><span data-stu-id="42c19-271">At this point your page's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](storing-additional-user-information-cs/samples/sample1.aspx)]

<span data-ttu-id="42c19-272">Нам необходимо программно задать элемента управления SqlDataSource `UserId` параметр для текущего вошедшего пользователя `UserId` до выбора данных.</span><span class="sxs-lookup"><span data-stu-id="42c19-272">We need to programmatically set the SqlDataSource control's `UserId` parameter to the currently logged in user's `UserId` before the data is selected.</span></span> <span data-ttu-id="42c19-273">Это можно сделать, создав обработчик событий для элемента управления SqlDataSource `Selecting` событий и добавьте следующий код существует:</span><span class="sxs-lookup"><span data-stu-id="42c19-273">This can be accomplished by creating an event handler for the SqlDataSource's `Selecting` event and adding the following code there:</span></span>

[!code-csharp[Main](storing-additional-user-information-cs/samples/sample2.cs)]

<span data-ttu-id="42c19-274">Приведенный выше код запускается, получив ссылку на текущего пользователя, вызвав `Membership` класса `GetUser` метод.</span><span class="sxs-lookup"><span data-stu-id="42c19-274">The above code starts by obtaining a reference to the currently logged on user by calling the `Membership` class's `GetUser` method.</span></span> <span data-ttu-id="42c19-275">Эта команда возвращает `MembershipUser` , чье свойство `ProviderUserKey` свойство содержит `UserId`.</span><span class="sxs-lookup"><span data-stu-id="42c19-275">This returns a `MembershipUser` object, whose `ProviderUserKey` property contains the `UserId`.</span></span> <span data-ttu-id="42c19-276">`UserId` Значение затем присваивается SqlDataSource `@UserId` параметра.</span><span class="sxs-lookup"><span data-stu-id="42c19-276">The `UserId` value is then assigned to the SqlDataSource's `@UserId` parameter.</span></span>

> [!NOTE]
> <span data-ttu-id="42c19-277">`Membership.GetUser()` Метод возвращает сведения о текущего пользователя.</span><span class="sxs-lookup"><span data-stu-id="42c19-277">The `Membership.GetUser()` method returns information about the currently logged on user.</span></span> <span data-ttu-id="42c19-278">Если анонимный пользователь посетив страницу, то возвращается значение `null`.</span><span class="sxs-lookup"><span data-stu-id="42c19-278">If an anonymous user is visiting the page, it will return a value of `null`.</span></span> <span data-ttu-id="42c19-279">В таком случае это приведет к `NullReferenceException` на следующую строку кода, при попытке прочесть `ProviderUserKey` свойство.</span><span class="sxs-lookup"><span data-stu-id="42c19-279">In such a case, this will lead to a `NullReferenceException` on the following line of code when attempting to read the `ProviderUserKey` property.</span></span> <span data-ttu-id="42c19-280">Само собой, нам не нужно беспокоиться о `Membership.GetUser()` возвращение `null` значение в `AdditionalUserInfo.aspx` странице, поскольку настроен непрерывный режим авторизации URL-адреса в предыдущем руководстве, чтобы только прошедшие проверку удалось получить доступ к ресурсам в этой папке ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="42c19-280">Of course, we don't have to worry about `Membership.GetUser()` returning a `null` value in the `AdditionalUserInfo.aspx` page because we configured URL authorization in a previous tutorial so that only authenticated users could access the ASP.NET resources in this folder.</span></span> <span data-ttu-id="42c19-281">Если требуется доступ к сведениям о текущего пользователя на странице, где разрешен анонимный доступ, убедитесь в том, чтобы убедиться, что отличным от`null MembershipUser` объект возвращается из `GetUser()` метод до ссылки на его свойства.</span><span class="sxs-lookup"><span data-stu-id="42c19-281">If you need to access information about the currently logged on user in a page where anonymous access is permitted, make sure to check that a non-`null MembershipUser` object is returned from the `GetUser()` method before referencing its properties.</span></span>

<span data-ttu-id="42c19-282">При посещении `AdditionalUserInfo.aspx` страницы в обозревателе вы увидите пустую страницу, так как у нас есть еще добавить ни одной строки для `UserProfiles` таблицы.</span><span class="sxs-lookup"><span data-stu-id="42c19-282">If you visit the `AdditionalUserInfo.aspx` page through a browser you will see a blank page because we have yet to add any rows to the `UserProfiles` table.</span></span> <span data-ttu-id="42c19-283">На шаге 6 мы рассмотрим способы настройки элемента управления CreateUserWizard для автоматического добавления новой строки к `UserProfiles` таблицы при создании учетной записи пользователя.</span><span class="sxs-lookup"><span data-stu-id="42c19-283">In Step 6 we will look at how to customize the CreateUserWizard control to automatically add a new row to the `UserProfiles` table when a new user account is created.</span></span> <span data-ttu-id="42c19-284">Однако теперь необходимо вручную создать запись в таблице.</span><span class="sxs-lookup"><span data-stu-id="42c19-284">For now, however, we will need to manually create a record in the table.</span></span>

<span data-ttu-id="42c19-285">Перейдите в обозреватель баз данных в Visual Studio и раскройте папку таблицы.</span><span class="sxs-lookup"><span data-stu-id="42c19-285">Navigate to the Database Explorer in Visual Studio and expand the Tables folder.</span></span> <span data-ttu-id="42c19-286">Щелкните правой кнопкой мыши `aspnet_Users` таблицы и выберите «Показать таблицу данных» для просмотра записей в таблице; сделать то же самое `UserProfiles` таблицы.</span><span class="sxs-lookup"><span data-stu-id="42c19-286">Right-click on the `aspnet_Users` table and choose "Show Table Data" to see the records in the table; do the same thing for the `UserProfiles` table.</span></span> <span data-ttu-id="42c19-287">Рис. 11 отобразятся следующие результаты, когда Мозаичная по вертикали.</span><span class="sxs-lookup"><span data-stu-id="42c19-287">Figure 11 shows these results when tiled vertically.</span></span> <span data-ttu-id="42c19-288">В моей базе данных нет `aspnet_Users` записи для Брюс Fred и Tito, но ни одной записи в `UserProfiles` таблицы.</span><span class="sxs-lookup"><span data-stu-id="42c19-288">In my database there are currently `aspnet_Users` records for Bruce, Fred, and Tito, but no records in the `UserProfiles` table.</span></span>

<span data-ttu-id="42c19-289">[![Отображается содержимое aspnet_Users и UserProfiles таблиц](storing-additional-user-information-cs/_static/image32.png)](storing-additional-user-information-cs/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="42c19-289">[![The Contents of the aspnet_Users and UserProfiles Tables are Displayed](storing-additional-user-information-cs/_static/image32.png)](storing-additional-user-information-cs/_static/image31.png)</span></span>

<span data-ttu-id="42c19-290">**Рис. 11**: Содержание `aspnet_Users` и `UserProfiles` таблиц ([Просмотр полноразмерного изображения](storing-additional-user-information-cs/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="42c19-290">**Figure 11**: The Contents of the `aspnet_Users` and `UserProfiles` Tables are Displayed  ([Click to view full-size image](storing-additional-user-information-cs/_static/image33.png))</span></span>

<span data-ttu-id="42c19-291">Добавить новую запись для `UserProfiles` таблицы, вручную введя значения для `HomeTown`, `HomepageUrl`, и `Signature` поля.</span><span class="sxs-lookup"><span data-stu-id="42c19-291">Add a new record to the `UserProfiles` table by manually typing in values for the `HomeTown`, `HomepageUrl`, and `Signature` fields.</span></span> <span data-ttu-id="42c19-292">Самый простой способ получить допустимый `UserId` значение в новом `UserProfiles` записи заключается в выборе `UserId` из учетной записи пользователя в `aspnet_Users` таблицы, скопируйте и вставьте его в `UserId` в `UserProfiles`.</span><span class="sxs-lookup"><span data-stu-id="42c19-292">The easiest way to get a valid `UserId` value in the new `UserProfiles` record is to select the `UserId` field from a particular user account in the `aspnet_Users` table and copy and paste it into the `UserId` field in `UserProfiles`.</span></span> <span data-ttu-id="42c19-293">Рис. 12 показан `UserProfiles` таблицы после добавления новой записи для Брюс.</span><span class="sxs-lookup"><span data-stu-id="42c19-293">Figure 12 shows the `UserProfiles` table after a new record has been added for Bruce.</span></span>

<span data-ttu-id="42c19-294">[![Запись была добавлена к UserProfiles Брюс](storing-additional-user-information-cs/_static/image35.png)](storing-additional-user-information-cs/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="42c19-294">[![A Record was Added to UserProfiles for Bruce](storing-additional-user-information-cs/_static/image35.png)](storing-additional-user-information-cs/_static/image34.png)</span></span>

<span data-ttu-id="42c19-295">**Рис. 12**: Была добавлена запись `UserProfiles` для Брюс ([Просмотр полноразмерного изображения](storing-additional-user-information-cs/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="42c19-295">**Figure 12**: A Record was Added to `UserProfiles` for Bruce  ([Click to view full-size image](storing-additional-user-information-cs/_static/image36.png))</span></span>

<span data-ttu-id="42c19-296">Вернитесь к `AdditionalUserInfo.aspx` страницы, войти в систему как Брюс.</span><span class="sxs-lookup"><span data-stu-id="42c19-296">Return to the `AdditionalUserInfo.aspx` page, logged in as Bruce.</span></span> <span data-ttu-id="42c19-297">Как показано на рис. 13, отображаются параметры Bruce's.</span><span class="sxs-lookup"><span data-stu-id="42c19-297">As Figure 13 shows, Bruce's settings are displayed.</span></span>

<span data-ttu-id="42c19-298">[![В настоящее время посещения он показано His параметры](storing-additional-user-information-cs/_static/image38.png)](storing-additional-user-information-cs/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="42c19-298">[![The Currently Visiting User is Shown His Settings](storing-additional-user-information-cs/_static/image38.png)](storing-additional-user-information-cs/_static/image37.png)</span></span>

<span data-ttu-id="42c19-299">**Рис. 13**: В настоящее время посещения он показано His параметры ([Просмотр полноразмерного изображения](storing-additional-user-information-cs/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="42c19-299">**Figure 13**: The Currently Visiting User is Shown His Settings  ([Click to view full-size image](storing-additional-user-information-cs/_static/image39.png))</span></span>

> [!NOTE]
> <span data-ttu-id="42c19-300">Переход вперед и вручную добавить записи в `UserProfiles` таблицы для каждого пользователя приложения Membership.</span><span class="sxs-lookup"><span data-stu-id="42c19-300">Go ahead and manually add records in the `UserProfiles` table for each Membership user.</span></span> <span data-ttu-id="42c19-301">На шаге 6 мы рассмотрим способы настройки элемента управления CreateUserWizard для автоматического добавления новой строки к `UserProfiles` таблицы при создании учетной записи пользователя.</span><span class="sxs-lookup"><span data-stu-id="42c19-301">In Step 6 we will look at how to customize the CreateUserWizard control to automatically add a new row to the `UserProfiles` table when a new user account is created.</span></span>

## <a name="step-3-allowing-the-user-to-edit-his-home-town-homepage-and-signature"></a><span data-ttu-id="42c19-302">Шаг 3. Что позволяет пользователю изменять его домашней города, домашней страницы и подписи</span><span class="sxs-lookup"><span data-stu-id="42c19-302">Step 3: Allowing the User to Edit His Home Town, Homepage, and Signature</span></span>

<span data-ttu-id="42c19-303">На этом этапе в настоящее время вошедшего в систему пользователь может просмотреть их родного города, домашней страницы и параметры подписи, но они еще не могут изменять их.</span><span class="sxs-lookup"><span data-stu-id="42c19-303">At this point the currently logged in user can view their home town, homepage, and signature setting, but they cannot yet modify them.</span></span> <span data-ttu-id="42c19-304">Давайте обновим элементе управления DetailsView, так что можно изменять данные.</span><span class="sxs-lookup"><span data-stu-id="42c19-304">Let's update the DetailsView control so that the data can be edited.</span></span>

<span data-ttu-id="42c19-305">Первое, что нам нужно сделать — добавить `UpdateCommand` для элемента управления SqlDataSource, указав `UPDATE` инструкцию для выполнения и его соответствующие параметры.</span><span class="sxs-lookup"><span data-stu-id="42c19-305">The first thing we need to do is add an `UpdateCommand` for the SqlDataSource, specifying the `UPDATE` statement to execute and its corresponding parameters.</span></span> <span data-ttu-id="42c19-306">Выбор элемента управления SqlDataSource и в окне «Свойства» щелкните кнопку с многоточием рядом со свойством UpdateQuery, чтобы открыть диалоговое окно Редактор команд и параметров.</span><span class="sxs-lookup"><span data-stu-id="42c19-306">Select the SqlDataSource and, from the Properties window, click on the ellipses next to the UpdateQuery property to bring up the Command and Parameter Editor dialog box.</span></span> <span data-ttu-id="42c19-307">Введите следующую `UPDATE` инструкции в текстовое поле:</span><span class="sxs-lookup"><span data-stu-id="42c19-307">Enter the following `UPDATE` statement into the textbox:</span></span>

[!code-sql[Main](storing-additional-user-information-cs/samples/sample3.sql)]

<span data-ttu-id="42c19-308">Затем щелкните кнопку «Обновить параметры», которая будет создан параметр в объекте элемента управления SqlDataSource `UpdateParameters` сбор данных для каждого параметра в `UPDATE` инструкции.</span><span class="sxs-lookup"><span data-stu-id="42c19-308">Next, click the "Refresh Parameters" button, which will create a parameter in the SqlDataSource control's `UpdateParameters` collection for each of the parameters in the `UPDATE` statement.</span></span> <span data-ttu-id="42c19-309">Оставьте источника для всех набора параметров значение None и нажмите кнопку ОК, чтобы закрыть диалоговое окно.</span><span class="sxs-lookup"><span data-stu-id="42c19-309">Leave the source for all of the parameters set to None and click the OK button to complete the dialog box.</span></span>

<span data-ttu-id="42c19-310">[![Укажите UpdateCommand и UpdateParameters элемента управления SqlDataSource](storing-additional-user-information-cs/_static/image41.png)](storing-additional-user-information-cs/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="42c19-310">[![Specify the SqlDataSource's UpdateCommand and UpdateParameters](storing-additional-user-information-cs/_static/image41.png)](storing-additional-user-information-cs/_static/image40.png)</span></span>

<span data-ttu-id="42c19-311">**Рис. 14**: Укажите SqlDataSource `UpdateCommand` и `UpdateParameters` ([Просмотр полноразмерного изображения](storing-additional-user-information-cs/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="42c19-311">**Figure 14**: Specify the SqlDataSource's `UpdateCommand` and `UpdateParameters` ([Click to view full-size image](storing-additional-user-information-cs/_static/image42.png))</span></span>

<span data-ttu-id="42c19-312">Из-за дополнения мы внесли в элемент управления SqlDataSource, DetailsView, элемент управления теперь поддерживает редактирование.</span><span class="sxs-lookup"><span data-stu-id="42c19-312">Due to the additions we made to the SqlDataSource control, the DetailsView control can now support editing.</span></span> <span data-ttu-id="42c19-313">Смарт-теге DetailsView установите флажок «Разрешить редактирование».</span><span class="sxs-lookup"><span data-stu-id="42c19-313">From the DetailsView's Smart Tag, check the "Enable Editing" checkbox.</span></span> <span data-ttu-id="42c19-314">Это поле добавляет CommandField элемента управления `Fields` коллекции с его `ShowEditButton` свойство присвоено значение True.</span><span class="sxs-lookup"><span data-stu-id="42c19-314">This adds a CommandField to the control's `Fields` collection with its `ShowEditButton` property set to True.</span></span> <span data-ttu-id="42c19-315">Это делает кнопка «изменить», при отображении элемента управления DetailsView в режиме только для чтения и обновления и кнопки "Отмена", при отображении в режиме редактирования.</span><span class="sxs-lookup"><span data-stu-id="42c19-315">This renders an Edit button when the DetailsView is displayed in read-only mode and Update and Cancel buttons when displayed in edit mode.</span></span> <span data-ttu-id="42c19-316">Вместо того чтобы требовать от пользователя, щелкните "Изменить", однако мы может иметь отрисовки DetailsView в «всегда» состояние, задав элемента управления DetailsView [ `DefaultMode` свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.defaultmode.aspx) для `Edit`.</span><span class="sxs-lookup"><span data-stu-id="42c19-316">Rather than requiring the user to click Edit, though, we can have the DetailsView render in an "always editable" state by setting the DetailsView control's [`DefaultMode` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.defaultmode.aspx) to `Edit`.</span></span>

<span data-ttu-id="42c19-317">Этих изменений декларативная разметка элемента управления DetailsView должен выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="42c19-317">With these changes, your DetailsView control's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](storing-additional-user-information-cs/samples/sample4.aspx)]

<span data-ttu-id="42c19-318">Обратите внимание на добавление CommandField и `DefaultMode` свойство.</span><span class="sxs-lookup"><span data-stu-id="42c19-318">Note the addition of the CommandField and the `DefaultMode` property.</span></span>

<span data-ttu-id="42c19-319">Пойти дальше и проверить эту страницу через обозреватель.</span><span class="sxs-lookup"><span data-stu-id="42c19-319">Go ahead and test this page through a browser.</span></span> <span data-ttu-id="42c19-320">При посещении с пользователем, который имеет соответствующей записи в `UserProfiles`, параметры пользователя будут отображаться в интерфейс редактирования.</span><span class="sxs-lookup"><span data-stu-id="42c19-320">When visiting with a user that has a corresponding record in `UserProfiles`, the user's settings are displayed in an editable interface.</span></span>

<span data-ttu-id="42c19-321">[![Элемент DetailsView отображает интерфейс редактирования](storing-additional-user-information-cs/_static/image44.png)](storing-additional-user-information-cs/_static/image43.png)</span><span class="sxs-lookup"><span data-stu-id="42c19-321">[![The DetailsView Renders an Editable Interface](storing-additional-user-information-cs/_static/image44.png)](storing-additional-user-information-cs/_static/image43.png)</span></span>

<span data-ttu-id="42c19-322">**Рис. 15**: Элемент DetailsView отображает интерфейс редактирования ([Просмотр полноразмерного изображения](storing-additional-user-information-cs/_static/image45.png))</span><span class="sxs-lookup"><span data-stu-id="42c19-322">**Figure 15**: The DetailsView Renders an Editable Interface  ([Click to view full-size image](storing-additional-user-information-cs/_static/image45.png))</span></span>

<span data-ttu-id="42c19-323">Попробуйте изменить значения и щелкнув кнопкой "Обновить".</span><span class="sxs-lookup"><span data-stu-id="42c19-323">Try changing the values and clicking the Update button.</span></span> <span data-ttu-id="42c19-324">Он отображается, как если бы ничего не происходит.</span><span class="sxs-lookup"><span data-stu-id="42c19-324">It appears as if nothing happens.</span></span> <span data-ttu-id="42c19-325">Обратная передача значения сохраняются в базу данных, но есть не визуальную обратную связь, произошедшего сохранения.</span><span class="sxs-lookup"><span data-stu-id="42c19-325">There is a postback and the values are saved to the database, but there's no visual feedback that the save occurred.</span></span>

<span data-ttu-id="42c19-326">Чтобы исправить это, вернитесь в Visual Studio и добавьте элемент управления Label выше DetailsView.</span><span class="sxs-lookup"><span data-stu-id="42c19-326">To remedy this, return to Visual Studio and add a Label control above the DetailsView.</span></span> <span data-ttu-id="42c19-327">Задайте его `ID` для `SettingsUpdatedMessage`, ее `Text` свойства «параметры обновлены,» и его `Visible` и `EnableViewState` свойства `false`.</span><span class="sxs-lookup"><span data-stu-id="42c19-327">Set its `ID` to `SettingsUpdatedMessage`, its `Text` property to "Your settings have been updated," and its `Visible` and `EnableViewState` properties to `false`.</span></span>

[!code-aspx[Main](storing-additional-user-information-cs/samples/sample5.aspx)]

<span data-ttu-id="42c19-328">Нам нужно отобразить `SettingsUpdatedMessage` метки при изменении элемента управления DetailsView.</span><span class="sxs-lookup"><span data-stu-id="42c19-328">We need to display the `SettingsUpdatedMessage` Label whenever the DetailsView is updated.</span></span> <span data-ttu-id="42c19-329">Для этого необходимо создать обработчик событий для элемента DetailsView `ItemUpdated` событий и добавьте следующий код:</span><span class="sxs-lookup"><span data-stu-id="42c19-329">To accomplish this, create an event handler for the DetailsView's `ItemUpdated` event and add the following code:</span></span>

[!code-csharp[Main](storing-additional-user-information-cs/samples/sample6.cs)]

<span data-ttu-id="42c19-330">Вернитесь к `AdditionalUserInfo.aspx` странице через браузер и обновления данных.</span><span class="sxs-lookup"><span data-stu-id="42c19-330">Return to the `AdditionalUserInfo.aspx` page through a browser and update the data.</span></span> <span data-ttu-id="42c19-331">В данном случае отображается сообщение о состоянии полезными.</span><span class="sxs-lookup"><span data-stu-id="42c19-331">This time, a helpful status message is displayed.</span></span>

<span data-ttu-id="42c19-332">[![Короткое сообщение будет отображаться после обновления параметров](storing-additional-user-information-cs/_static/image47.png)](storing-additional-user-information-cs/_static/image46.png)</span><span class="sxs-lookup"><span data-stu-id="42c19-332">[![A Short Message is Displayed When the Settings are Updated](storing-additional-user-information-cs/_static/image47.png)](storing-additional-user-information-cs/_static/image46.png)</span></span>

<span data-ttu-id="42c19-333">**Рис. 16**: Короткое сообщение отображается в том случае, если параметры будут обновлены ([Просмотр полноразмерного изображения](storing-additional-user-information-cs/_static/image48.png))</span><span class="sxs-lookup"><span data-stu-id="42c19-333">**Figure 16**: A Short Message is Displayed When the Settings are Updated  ([Click to view full-size image](storing-additional-user-information-cs/_static/image48.png))</span></span>

> [!NOTE]
> <span data-ttu-id="42c19-334">Элемент управления DetailsView редактирования интерфейса оставляет желать много лучшего.</span><span class="sxs-lookup"><span data-stu-id="42c19-334">The DetailsView control's editing interface leaves a lot to be desired.</span></span> <span data-ttu-id="42c19-335">Она использует стандартного размера текстовых полей, но поле подписи, вероятно, должно быть многострочном текстовом поле.</span><span class="sxs-lookup"><span data-stu-id="42c19-335">It uses standard-sized textboxes, but the Signature field should probably be a multi-line textbox.</span></span> <span data-ttu-id="42c19-336">RegularExpressionValidator следует использовать, чтобы убедиться, что URL-адрес домашней страницы, если указано, начинается с « http://» или « https://».</span><span class="sxs-lookup"><span data-stu-id="42c19-336">A RegularExpressionValidator should be used to ensure that the homepage URL, if entered, starts with "http://" or "https://".</span></span> <span data-ttu-id="42c19-337">Кроме того, с момента DetailsView, элемент управления имеет его `DefaultMode` свойство значение `Edit`, ничего не происходит кнопки "Отмена".</span><span class="sxs-lookup"><span data-stu-id="42c19-337">Moreover, since the DetailsView control has its `DefaultMode` property set to `Edit`, the Cancel button does not do anything.</span></span> <span data-ttu-id="42c19-338">Он должен либо быть удален или, при нажатии перенаправить пользователя на другую страницу (такие как `~/Default.aspx`).</span><span class="sxs-lookup"><span data-stu-id="42c19-338">It should either be removed or, when clicked, redirect the user to some other page (such as `~/Default.aspx`).</span></span> <span data-ttu-id="42c19-339">Я оставьте эти усовершенствования в качестве упражнения для чтения.</span><span class="sxs-lookup"><span data-stu-id="42c19-339">I leave these enhancements as an exercise for the reader.</span></span>

### <a name="adding-a-link-to-theadditionaluserinfoaspxpage-in-the-master-page"></a><span data-ttu-id="42c19-340">Добавление ссылки на`AdditionalUserInfo.aspx`страницы на главной странице</span><span class="sxs-lookup"><span data-stu-id="42c19-340">Adding a Link to the`AdditionalUserInfo.aspx`Page in the Master Page</span></span>

<span data-ttu-id="42c19-341">В настоящее время веб-сайт не поддерживает любые ссылки на `AdditionalUserInfo.aspx` страницы.</span><span class="sxs-lookup"><span data-stu-id="42c19-341">Currently, the website does not provide any links to the `AdditionalUserInfo.aspx` page.</span></span> <span data-ttu-id="42c19-342">Введите URL-адрес страницы непосредственно в адресной строке браузера является единственным способом получить к нему доступ.</span><span class="sxs-lookup"><span data-stu-id="42c19-342">The only way to reach it is to enter the page's URL directly into the browser's Address bar.</span></span> <span data-ttu-id="42c19-343">Давайте добавим ссылку на эту страницу в `Site.master` главной страницы.</span><span class="sxs-lookup"><span data-stu-id="42c19-343">Let's add a link to this page in the `Site.master` master page.</span></span>

<span data-ttu-id="42c19-344">Помните, что главная страница содержит LoginView веб-элемент управления в его `LoginContent` ContentPlaceHolder, отображающий разную разметку для посетителей проверенными и анонимными.</span><span class="sxs-lookup"><span data-stu-id="42c19-344">Recall that the master page contains a LoginView Web control in its `LoginContent` ContentPlaceHolder that displays different markup for authenticated and anonymous visitors.</span></span> <span data-ttu-id="42c19-345">Обновление элемента управления LoginView `LoggedInTemplate` включать ссылку на `AdditionalUserInfo.aspx` страницы.</span><span class="sxs-lookup"><span data-stu-id="42c19-345">Update the LoginView control's `LoggedInTemplate` to include a link to the `AdditionalUserInfo.aspx` page.</span></span> <span data-ttu-id="42c19-346">После внесения этих изменений в LoginView декларативная разметка элемента управления должен выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="42c19-346">After making these changes the LoginView control's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](storing-additional-user-information-cs/samples/sample7.aspx)]

<span data-ttu-id="42c19-347">Обратите внимание, добавление `lnkUpdateSettings` гиперссылки для `LoggedInTemplate`.</span><span class="sxs-lookup"><span data-stu-id="42c19-347">Note the addition of the `lnkUpdateSettings` HyperLink control to the `LoggedInTemplate`.</span></span> <span data-ttu-id="42c19-348">Вместе со ссылкой на месте прошедших проверку подлинности пользователей можно быстро перейти на страницу для просмотра и изменения их домашней города, домашней страницы и подпись.</span><span class="sxs-lookup"><span data-stu-id="42c19-348">With this link in place, authenticated users can quickly jump to the page to view and modify their home town, homepage, and signature settings.</span></span>

## <a name="step-4-adding-new-guestbook-comments"></a><span data-ttu-id="42c19-349">Шаг 4. Добавление новых комментариев гостевой книги</span><span class="sxs-lookup"><span data-stu-id="42c19-349">Step 4: Adding New Guestbook Comments</span></span>

<span data-ttu-id="42c19-350">`Guestbook.aspx` Страница является где прошедшего проверку подлинности пользователи могут просматривать гостевой книги и оставьте комментарий.</span><span class="sxs-lookup"><span data-stu-id="42c19-350">The `Guestbook.aspx` page is where authenticated users can view the guestbook and leave a comment.</span></span> <span data-ttu-id="42c19-351">Давайте начнем с создания интерфейса, чтобы добавить новые комментарии гостевой книги.</span><span class="sxs-lookup"><span data-stu-id="42c19-351">Let's start with creating the interface to add new guestbook comments.</span></span>

<span data-ttu-id="42c19-352">Откройте `Guestbook.aspx` страницы в Visual Studio, а также создание пользовательского интерфейса, состоящий из двух элементов управления TextBox, новый комментарий субъекта и для его основной части.</span><span class="sxs-lookup"><span data-stu-id="42c19-352">Open the `Guestbook.aspx` page in Visual Studio and construct a user interface consisting of two TextBox controls, one for the new comment's subject and one for its body.</span></span> <span data-ttu-id="42c19-353">Значение первого элемента управления TextBox `ID` свойства `Subject` и его `Columns` значение 40; установите второй `ID` для `Body`, ее `TextMode` для `MultiLine`и его `Width` и `Rows` свойства «95%» и 8, соответственно.</span><span class="sxs-lookup"><span data-stu-id="42c19-353">Set the first TextBox control's `ID` property to `Subject` and its `Columns` property to 40; set second's `ID` to `Body`, its `TextMode` to `MultiLine`, and its `Width` and `Rows` properties to "95%" and 8, respectively.</span></span> <span data-ttu-id="42c19-354">Чтобы завершить пользовательский интерфейс, добавьте кнопку веб-элемент управления с именем `PostCommentButton` и задайте его `Text` свойства «Опубликовать комментарий».</span><span class="sxs-lookup"><span data-stu-id="42c19-354">To complete the user interface, add a Button Web control named `PostCommentButton` and set its `Text` property to "Post Your Comment".</span></span>

<span data-ttu-id="42c19-355">Так как каждый комментарий гостевой книги требуется тему и текст, добавьте RequiredFieldValidator для каждого из текстовых полей.</span><span class="sxs-lookup"><span data-stu-id="42c19-355">Since each guestbook comment requires a subject and body, add a RequiredFieldValidator for each of the TextBoxes.</span></span> <span data-ttu-id="42c19-356">Задайте `ValidationGroup` свойства этих элементов управления для «EnterComment»; аналогично, установите `PostCommentButton` элемента управления `ValidationGroup` свойства «EnterComment».</span><span class="sxs-lookup"><span data-stu-id="42c19-356">Set the `ValidationGroup` property of these controls to "EnterComment"; likewise, set the `PostCommentButton` control's `ValidationGroup` property to "EnterComment".</span></span> <span data-ttu-id="42c19-357">Дополнительные сведения о ASP. Проверяющие элементы управления NET, извлечение [проверка форм в ASP.NET](http://www.4guysfromrolla.com/webtech/090200-1.shtml), [разбор элементов управления проверки в ASP.NET 2.0](http://aspnet.4guysfromrolla.com/articles/112305-1.aspx)и [учебник элементов управления проверки сервера](http://www.w3schools.com/aspnet/aspnet_refvalidationcontrols.asp) на [W3Schools](http://www.w3schools.com/).</span><span class="sxs-lookup"><span data-stu-id="42c19-357">For more information on ASP.NET's validation controls, check out [Form Validation in ASP.NET](http://www.4guysfromrolla.com/webtech/090200-1.shtml), [Dissecting the Validation Controls in ASP.NET 2.0](http://aspnet.4guysfromrolla.com/articles/112305-1.aspx), and the [Validation Server Controls Tutorial](http://www.w3schools.com/aspnet/aspnet_refvalidationcontrols.asp) on [W3Schools](http://www.w3schools.com/).</span></span>

<span data-ttu-id="42c19-358">После создания пользовательского интерфейса декларативная разметка страницы должен выглядеть примерно следующим образом:</span><span class="sxs-lookup"><span data-stu-id="42c19-358">After crafting the user interface your page's declarative markup should look something like the following:</span></span>

[!code-aspx[Main](storing-additional-user-information-cs/samples/sample8.aspx)]

<span data-ttu-id="42c19-359">Полный пользовательский интерфейс, DAL следующей задачей является для вставки новой записи в `GuestbookComments` таблицу при `PostCommentButton` нажатии.</span><span class="sxs-lookup"><span data-stu-id="42c19-359">With the user interface complete, our next task is to insert a new record into the `GuestbookComments` table when the `PostCommentButton` is clicked.</span></span> <span data-ttu-id="42c19-360">Это можно сделать несколькими способами: можно написать код ADO.NET в кнопки `Click` обработчика событий; мы можно добавить на страницу элемент управления SqlDataSource, настройте его `InsertCommand`и затем вызвать его `Insert` метода из `Click` событий обработчик; или мы могли бы создавать среднего уровня, отвечающие за Вставка новых комментариях и вызова этих функций из `Click` обработчик событий.</span><span class="sxs-lookup"><span data-stu-id="42c19-360">This can be accomplished in a number of ways: we can write ADO.NET code in the Button's `Click` event handler; we can add a SqlDataSource control to the page, configure its `InsertCommand`, and then call its `Insert` method from the `Click` event handler; or we could build a middle tier that was responsible for inserting new guestbook comments, and invoke this functionality from the `Click` event handler.</span></span> <span data-ttu-id="42c19-361">Так как мы рассмотрели применение элемента управления SqlDataSource на шаге 3, воспользуемся кода ADO.NET здесь.</span><span class="sxs-lookup"><span data-stu-id="42c19-361">Since we looked at using a SqlDataSource in Step 3, let's use ADO.NET code here.</span></span>

> [!NOTE]
> <span data-ttu-id="42c19-362">Классы ADO.NET, используемые для программного доступа к данным из базы данных Microsoft SQL Server находятся в папке `System.Data.SqlClient` пространства имен.</span><span class="sxs-lookup"><span data-stu-id="42c19-362">The ADO.NET classes used to programmatically access data from a Microsoft SQL Server database are located in the `System.Data.SqlClient` namespace.</span></span> <span data-ttu-id="42c19-363">Может потребоваться импортировать это пространство имен в класс фонового кода страницы (т. е. `using System.Data.SqlClient;`).</span><span class="sxs-lookup"><span data-stu-id="42c19-363">You may need to import this namespace into your page's code-behind class (i.e., `using System.Data.SqlClient;`).</span></span>

<span data-ttu-id="42c19-364">Создайте обработчик событий для `PostCommentButton`в `Click` событий и добавьте следующий код:</span><span class="sxs-lookup"><span data-stu-id="42c19-364">Create an event handler for the `PostCommentButton`'s `Click` event and add the following code:</span></span>

[!code-csharp[Main](storing-additional-user-information-cs/samples/sample9.cs)]

<span data-ttu-id="42c19-365">`Click` Обработчик событий начинает с проверки допустимости данных, предоставленные пользователем.</span><span class="sxs-lookup"><span data-stu-id="42c19-365">The `Click` event handler starts by checking that the user-supplied data is valid.</span></span> <span data-ttu-id="42c19-366">Если это не так, обработчик событий завершит работу перед вставкой записи.</span><span class="sxs-lookup"><span data-stu-id="42c19-366">If it is not, the event handler exits before inserting a record.</span></span> <span data-ttu-id="42c19-367">При условии, что является допустимым, предоставленные данные текущего пользователя `UserId` значение извлекается и хранится в `currentUserId` локальной переменной.</span><span class="sxs-lookup"><span data-stu-id="42c19-367">Assuming the supplied data is valid, the currently logged on user's `UserId` value is retrieved and stored in the `currentUserId` local variable.</span></span> <span data-ttu-id="42c19-368">Это значение требуется, так как нам необходимо предоставить `UserId` значение при вставке записи в `GuestbookComments`.</span><span class="sxs-lookup"><span data-stu-id="42c19-368">This value is needed because we must supply a `UserId` value when inserting a record into `GuestbookComments`.</span></span>

<span data-ttu-id="42c19-369">После этого строка соединения для `SecurityTutorials` базы данных извлекается из `Web.config` и `INSERT` задана инструкция SQL.</span><span class="sxs-lookup"><span data-stu-id="42c19-369">Following that, the connection string for the `SecurityTutorials` database is retrieved from `Web.config` and the `INSERT` SQL statement is specified.</span></span> <span data-ttu-id="42c19-370">Объект `SqlConnection` объект создается и открывается.</span><span class="sxs-lookup"><span data-stu-id="42c19-370">A `SqlConnection` object is then created and opened.</span></span> <span data-ttu-id="42c19-371">Далее, `SqlCommand` объект создается и значения для параметров используются в `INSERT` запроса относятся.</span><span class="sxs-lookup"><span data-stu-id="42c19-371">Next, a `SqlCommand` object is constructed and the values for the parameters used in the `INSERT` query are assigned.</span></span> <span data-ttu-id="42c19-372">`INSERT` Выполняется инструкция, и подключение закрыто.</span><span class="sxs-lookup"><span data-stu-id="42c19-372">The `INSERT` statement is then executed and the connection closed.</span></span> <span data-ttu-id="42c19-373">В конце обработчика событий `Subject` и `Body` текстовые поля `Text` свойства, очищаются, чтобы значения пользователя не сохраняются между обратной передачи.</span><span class="sxs-lookup"><span data-stu-id="42c19-373">At the end of the event handler, the `Subject` and `Body` TextBoxes' `Text` properties are cleared out so that the user's values are not persisted across the postback.</span></span>

<span data-ttu-id="42c19-374">Продолжим и проверьте страницу в браузере.</span><span class="sxs-lookup"><span data-stu-id="42c19-374">Go ahead and test out this page in a browser.</span></span> <span data-ttu-id="42c19-375">Так как эта страница находится в `Membership` папку оно не доступно для анонимных пользователей.</span><span class="sxs-lookup"><span data-stu-id="42c19-375">Since this page is in the `Membership` folder it is not accessible to anonymous visitors.</span></span> <span data-ttu-id="42c19-376">Таким образом необходимо сначала войти (Если вы еще этого не сделали).</span><span class="sxs-lookup"><span data-stu-id="42c19-376">Therefore, you will need to first log on (if you have not already).</span></span> <span data-ttu-id="42c19-377">Введите значение в `Subject` и `Body` текстовые поля и нажмите кнопку `PostCommentButton` кнопки.</span><span class="sxs-lookup"><span data-stu-id="42c19-377">Enter a value into the `Subject` and `Body` TextBoxes and click the `PostCommentButton` button.</span></span> <span data-ttu-id="42c19-378">Это приведет к записи для добавления `GuestbookComments`.</span><span class="sxs-lookup"><span data-stu-id="42c19-378">This will cause a new record to be added to `GuestbookComments`.</span></span> <span data-ttu-id="42c19-379">При обратной передаче тему и текст, который вы указали очищены из текстовых полей.</span><span class="sxs-lookup"><span data-stu-id="42c19-379">On postback, the subject and body you provided are wiped from the TextBoxes.</span></span>

<span data-ttu-id="42c19-380">После нажатия кнопки `PostCommentButton` существует кнопка является не визуальную обратную связь, комментарий, добавленный в гостевую книгу.</span><span class="sxs-lookup"><span data-stu-id="42c19-380">After clicking the `PostCommentButton` button there is no visual feedback that the comment was added to the guestbook.</span></span> <span data-ttu-id="42c19-381">По-прежнему необходимо обновить эту страницу, чтобы отобразить существующие комментарии гостевой книги, которые мы будем использовать на шаге 5.</span><span class="sxs-lookup"><span data-stu-id="42c19-381">We still need to update this page to display the existing guestbook comments, which we will do in Step 5.</span></span> <span data-ttu-id="42c19-382">Как только мы сделать это, только что добавлен комментарий будет отображаться в списке комментариев, предоставляя достаточно визуальную обратную связь.</span><span class="sxs-lookup"><span data-stu-id="42c19-382">Once we accomplish that, the just-added comment will appear in the list of comments, providing adequate visual feedback.</span></span> <span data-ttu-id="42c19-383">Сейчас, убедитесь, что гостевая книга комментарий был сохранен, проверив содержимое из `GuestbookComments` таблицы.</span><span class="sxs-lookup"><span data-stu-id="42c19-383">For now, confirm that your guestbook comment was saved by examining the contents of the `GuestbookComments` table.</span></span>

<span data-ttu-id="42c19-384">Рис. 17 показано содержимое `GuestbookComments` таблицу были добавлены два комментарии.</span><span class="sxs-lookup"><span data-stu-id="42c19-384">Figure 17 shows the contents of the `GuestbookComments` table after two comments have been left.</span></span>

<span data-ttu-id="42c19-385">[![Вы увидите в комментариях в таблице GuestbookComments](storing-additional-user-information-cs/_static/image50.png)](storing-additional-user-information-cs/_static/image49.png)</span><span class="sxs-lookup"><span data-stu-id="42c19-385">[![You Can See the Guestbook Comments in the GuestbookComments Table](storing-additional-user-information-cs/_static/image50.png)](storing-additional-user-information-cs/_static/image49.png)</span></span>

<span data-ttu-id="42c19-386">**Рис. 17**: Вы увидите в комментариях в `GuestbookComments` таблицы ([Просмотр полноразмерного изображения](storing-additional-user-information-cs/_static/image51.png))</span><span class="sxs-lookup"><span data-stu-id="42c19-386">**Figure 17**: You Can See the Guestbook Comments in the `GuestbookComments` Table  ([Click to view full-size image](storing-additional-user-information-cs/_static/image51.png))</span></span>

> [!NOTE]
> <span data-ttu-id="42c19-387">Если пользователь пытается вставить комментарий гостевой книги, который содержит потенциально опасных разметка — например, HTML – ASP.NET вызывает исключение `HttpRequestValidationException`.</span><span class="sxs-lookup"><span data-stu-id="42c19-387">If a user attempts to insert a guestbook comment that contains potentially dangerous markup – such as HTML – ASP.NET will throw an `HttpRequestValidationException`.</span></span> <span data-ttu-id="42c19-388">Дополнительные сведения об этом исключении, почему она возникает исключение, и как разрешить пользователям отправлять потенциально опасных значений обратитесь к [запроса Технический документ проверки](../../../../whitepapers/request-validation.md).</span><span class="sxs-lookup"><span data-stu-id="42c19-388">To learn more about this exception, why it's thrown, and how to permit users to submit potentially dangerous values, consult the [Request Validation Whitepaper](../../../../whitepapers/request-validation.md).</span></span>

## <a name="step-5-listing-the-existing-guestbook-comments"></a><span data-ttu-id="42c19-389">Шаг 5. Список существующих комментариев гостевой книги</span><span class="sxs-lookup"><span data-stu-id="42c19-389">Step 5: Listing the Existing Guestbook Comments</span></span>

<span data-ttu-id="42c19-390">Помимо добавления комментариев, пользователю, просматривающему `Guestbook.aspx` страницы также должен иметь возможность просматривать существующие комментариях.</span><span class="sxs-lookup"><span data-stu-id="42c19-390">In addition to leaving comments, a user visiting the `Guestbook.aspx` page should also be able to view the guestbook's existing comments.</span></span> <span data-ttu-id="42c19-391">Для этого добавьте элемент управления ListView, с именем `CommentList` в нижней части страницы.</span><span class="sxs-lookup"><span data-stu-id="42c19-391">To accomplish this, add a ListView control named `CommentList` to the bottom of the page.</span></span>

> [!NOTE]
> <span data-ttu-id="42c19-392">Элемент управления ListView является новым для ASP.NET версии 3.5.</span><span class="sxs-lookup"><span data-stu-id="42c19-392">The ListView control is new to ASP.NET version 3.5.</span></span> <span data-ttu-id="42c19-393">Он предназначен для отображения списка элементов в очень настраиваемым и гибкий макет, но по-прежнему предлагают встроенные редактирование, вставка, удаление, разбиение по страницам и сортировка функциональные возможности, например GridView.</span><span class="sxs-lookup"><span data-stu-id="42c19-393">It is designed to display a list of items in a very customizable and flexible layout, yet still offer built-in editing, inserting, deleting, paging, and sorting functionality like the GridView.</span></span> <span data-ttu-id="42c19-394">Если вы используете ASP.NET 2.0, необходимо вместо этого используйте элемент управления DataList и Repeater.</span><span class="sxs-lookup"><span data-stu-id="42c19-394">If you are using ASP.NET 2.0, you will need to use the DataList or Repeater control instead.</span></span> <span data-ttu-id="42c19-395">Дополнительные сведения об использовании ListView см. в разделе [Скотт Гатри](https://weblogs.asp.net/scottgu/)на запись в блоге [управления asp: ListView](https://weblogs.asp.net/scottgu/archive/2007/08/10/the-asp-listview-control-part-1-building-a-product-listing-page-with-clean-css-ui.aspx)и моей статье [отображение данных с элементом управления ListView](http://aspnet.4guysfromrolla.com/articles/122607-1.aspx).</span><span class="sxs-lookup"><span data-stu-id="42c19-395">For more information on using the ListView, see [Scott Guthrie](https://weblogs.asp.net/scottgu/)'s blog entry, [The asp:ListView Control](https://weblogs.asp.net/scottgu/archive/2007/08/10/the-asp-listview-control-part-1-building-a-product-listing-page-with-clean-css-ui.aspx), and my article, [Displaying Data with the ListView Control](http://aspnet.4guysfromrolla.com/articles/122607-1.aspx).</span></span>

<span data-ttu-id="42c19-396">Откройте ListView смарт-тег и из раскрывающегося списка Выбор источника данных привязка элемента управления к новому источнику данных.</span><span class="sxs-lookup"><span data-stu-id="42c19-396">Open the ListView's Smart Tag and, from the Choose Data Source drop-down list, bind the control to a new data source.</span></span> <span data-ttu-id="42c19-397">Как мы видели в шаге 2, это приведет к запуску мастера настройки источника данных.</span><span class="sxs-lookup"><span data-stu-id="42c19-397">As we saw in Step 2, this will launch the Data Source Configuration Wizard.</span></span> <span data-ttu-id="42c19-398">Выберите значок базы данных, имя результирующего элемента управления SqlDataSource `CommentsDataSource`и нажмите кнопку ОК.</span><span class="sxs-lookup"><span data-stu-id="42c19-398">Select the Database icon, name the resulting SqlDataSource `CommentsDataSource`, and click OK.</span></span> <span data-ttu-id="42c19-399">Затем выберите `SecurityTutorialsConnectionString` подключения строка из раскрывающегося списка и нажмите кнопку Далее.</span><span class="sxs-lookup"><span data-stu-id="42c19-399">Next, select the `SecurityTutorialsConnectionString` connection string from the drop-down list and click Next.</span></span>

<span data-ttu-id="42c19-400">На этом этапе на шаге 2 мы указали данные для запроса путем выбора `UserProfiles` таблицу из раскрывающегося списка и выберите столбцы, возвращаемые (см. рис. 9).</span><span class="sxs-lookup"><span data-stu-id="42c19-400">At this point in Step 2 we specified the data to query by picking the `UserProfiles` table from the drop-down list and selecting the columns to return (refer back to Figure 9).</span></span> <span data-ttu-id="42c19-401">На этот раз тем не менее, мы хотим создать инструкцию SQL, которая извлекает не только записи из `GuestbookComments`, но также комментирующий родного города, домашней страницы, подписи и имени пользователя.</span><span class="sxs-lookup"><span data-stu-id="42c19-401">This time, however, we want to craft a SQL statement that pulls back not only the records from `GuestbookComments`, but also the commenter's home town, homepage, signature, and username.</span></span> <span data-ttu-id="42c19-402">Таким образом установите переключатель «Указать пользовательские инструкции SQL или хранимой процедуры» и нажмите кнопку Далее.</span><span class="sxs-lookup"><span data-stu-id="42c19-402">Therefore, select the "Specify a custom SQL statement or stored procedure" radio button and click Next.</span></span>

<span data-ttu-id="42c19-403">Это приведет к появлению на экране «Определение пользовательских инструкций или хранимых процедурах».</span><span class="sxs-lookup"><span data-stu-id="42c19-403">This will bring up the "Define Custom Statements or Stored Procedures" screen.</span></span> <span data-ttu-id="42c19-404">Нажмите кнопку построителя запросов для графического построения запроса.</span><span class="sxs-lookup"><span data-stu-id="42c19-404">Click the Query Builder button to graphically build the query.</span></span> <span data-ttu-id="42c19-405">Построитель запросов начинает, предлагающее для указания таблицы, которые нам нужно создать запрос.</span><span class="sxs-lookup"><span data-stu-id="42c19-405">The Query Builder starts by prompting us to specify the tables we want to query from.</span></span> <span data-ttu-id="42c19-406">Выберите `GuestbookComments`, `UserProfiles`, и `aspnet_Users` таблицы и нажмите кнопку ОК.</span><span class="sxs-lookup"><span data-stu-id="42c19-406">Select the `GuestbookComments`, `UserProfiles`, and `aspnet_Users` tables and click OK.</span></span> <span data-ttu-id="42c19-407">Это добавит все три таблицы в область конструктора.</span><span class="sxs-lookup"><span data-stu-id="42c19-407">This will add all three tables to the design surface.</span></span> <span data-ttu-id="42c19-408">Так как существуют ограничения внешнего ключа между отдельными `GuestbookComments`, `UserProfiles`, и `aspnet_Users` таблицы, построитель запросов автоматически `JOIN` s эти таблицы.</span><span class="sxs-lookup"><span data-stu-id="42c19-408">Since there are foreign key constraints amongst the `GuestbookComments`, `UserProfiles`, and `aspnet_Users` tables, the Query Builder automatically `JOIN` s these tables.</span></span>

<span data-ttu-id="42c19-409">Все, что остается лишь указать столбцы, возвращаемые.</span><span class="sxs-lookup"><span data-stu-id="42c19-409">All that remains is to specify the columns to return.</span></span> <span data-ttu-id="42c19-410">Из `GuestbookComments` таблицы выберите `Subject`, `Body`, и `CommentDate` столбцы; возвращают `HomeTown`, `HomepageUrl`, и `Signature` столбцы из `UserProfiles` таблицы; и возвращать `UserName` из `aspnet_Users`.</span><span class="sxs-lookup"><span data-stu-id="42c19-410">From the `GuestbookComments` table select the `Subject`, `Body`, and `CommentDate` columns; return the `HomeTown`, `HomepageUrl`, and `Signature` columns from the `UserProfiles` table; and return `UserName` from `aspnet_Users`.</span></span> <span data-ttu-id="42c19-411">Кроме того, добавьте "`ORDER BY CommentDate DESC`" в конец `SELECT` запроса, чтобы последние записи, будут возвращены первыми.</span><span class="sxs-lookup"><span data-stu-id="42c19-411">Also, add "`ORDER BY CommentDate DESC`" to the end of the `SELECT` query so that the most recent posts are returned first.</span></span> <span data-ttu-id="42c19-412">После выбора этих на на рис. 18 снимке экрана должна выглядеть интерфейс построителя запросов.</span><span class="sxs-lookup"><span data-stu-id="42c19-412">After making these selections, your Query Builder interface should look similar to the screen shot in Figure 18.</span></span>

<span data-ttu-id="42c19-413">[![Запрос Constructed объединяет GuestbookComments, UserProfiles и aspnet_Users таблиц](storing-additional-user-information-cs/_static/image53.png)](storing-additional-user-information-cs/_static/image52.png)</span><span class="sxs-lookup"><span data-stu-id="42c19-413">[![The Constructed Query JOINs the GuestbookComments, UserProfiles, and aspnet_Users Tables](storing-additional-user-information-cs/_static/image53.png)](storing-additional-user-information-cs/_static/image52.png)</span></span>

<span data-ttu-id="42c19-414">**Рис. 18**: Запрос создан `JOIN` s `GuestbookComments`, `UserProfiles`, и `aspnet_Users` таблиц ([Просмотр полноразмерного изображения](storing-additional-user-information-cs/_static/image54.png))</span><span class="sxs-lookup"><span data-stu-id="42c19-414">**Figure 18**: The Constructed Query `JOIN` s the `GuestbookComments`, `UserProfiles`, and `aspnet_Users` Tables  ([Click to view full-size image](storing-additional-user-information-cs/_static/image54.png))</span></span>

<span data-ttu-id="42c19-415">Нажмите кнопку ОК, чтобы закрыть окно построителя запросов и вернуться к экрану «Определение пользовательских инструкций или хранимых процедурах».</span><span class="sxs-lookup"><span data-stu-id="42c19-415">Click OK to close the Query Builder window and return to the "Define Custom Statements or Stored Procedures" screen.</span></span> <span data-ttu-id="42c19-416">Нажмите кнопку Далее, чтобы перейти на экран «Проверка запроса», где можно просмотреть результаты запроса, нажав кнопку Проверить запрос.</span><span class="sxs-lookup"><span data-stu-id="42c19-416">Click Next to advance to the "Test Query" screen, where you may view the query results by clicking the Test Query button.</span></span> <span data-ttu-id="42c19-417">Когда вы будете готовы, нажмите кнопку "Готово", чтобы завершить работу мастера настройки источника данных ".</span><span class="sxs-lookup"><span data-stu-id="42c19-417">When you're ready, click Finish to complete the Configure Data Source wizard.</span></span>

<span data-ttu-id="42c19-418">Когда мы выполнили мастер настройки источников данных в шаге 2, сопоставленного элемента управления DetailsView `Fields` коллекция обновляется, чтобы добавить поле BoundField для каждого столбца, возвращаемые `SelectCommand`.</span><span class="sxs-lookup"><span data-stu-id="42c19-418">When we completed the Configure Data Source wizard in Step 2, the associated DetailsView control's `Fields` collection was updated to include a BoundField for each column returned by the `SelectCommand`.</span></span> <span data-ttu-id="42c19-419">ListView остался без изменений; Мы по-прежнему необходимо определить его макет.</span><span class="sxs-lookup"><span data-stu-id="42c19-419">The ListView, however, remains unchanged; we still need to define its layout.</span></span> <span data-ttu-id="42c19-420">Макет ListView могут создаваться вручную через его декларативной разметки или из параметра «Настройка ListView» в его смарт-тега.</span><span class="sxs-lookup"><span data-stu-id="42c19-420">The ListView's layout can be constructed manually through its declarative markup or from the "Configure ListView" option in its Smart Tag.</span></span> <span data-ttu-id="42c19-421">Обычно я предпочитают определение разметку вручную, но использовать любой метод является наиболее естественным для вас.</span><span class="sxs-lookup"><span data-stu-id="42c19-421">I usually prefer defining the markup by hand, but use whatever method is most natural to you.</span></span>

<span data-ttu-id="42c19-422">Я в итоге, выполнив в `LayoutTemplate`, `ItemTemplate`, и `ItemSeparatorTemplate` для моего элемента управления ListView:</span><span class="sxs-lookup"><span data-stu-id="42c19-422">I ended up using the following `LayoutTemplate`, `ItemTemplate`, and `ItemSeparatorTemplate` for my ListView control:</span></span>

[!code-aspx[Main](storing-additional-user-information-cs/samples/sample10.aspx)]

<span data-ttu-id="42c19-423">`LayoutTemplate` Определяет разметку передаются элементом управления, хотя `ItemTemplate` отображает каждый элемент, возвращаемый элемента управления SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="42c19-423">The `LayoutTemplate` defines the markup emitted by the control, while the `ItemTemplate` renders each item returned by the SqlDataSource.</span></span> <span data-ttu-id="42c19-424">`ItemTemplate`Полученная в итоге разметка помещается в `LayoutTemplate`в `itemPlaceholder` элемента управления.</span><span class="sxs-lookup"><span data-stu-id="42c19-424">The `ItemTemplate`'s resulting markup is placed in the `LayoutTemplate`'s `itemPlaceholder` control.</span></span> <span data-ttu-id="42c19-425">В дополнение к `itemPlaceholder`, `LayoutTemplate` включает элемент управления DataPager, который ограничивает ListView отображается всего 10 комментариях на одной странице (по умолчанию) и отображает интерфейс разбиения по страницам.</span><span class="sxs-lookup"><span data-stu-id="42c19-425">In addition to the `itemPlaceholder`, the `LayoutTemplate` includes a DataPager control, which limits the ListView to showing just 10 guestbook comments per page (the default) and renders a paging interface.</span></span>

<span data-ttu-id="42c19-426">Мои `ItemTemplate` отображает каждый комментарий гостевой книги субъекта в `<h4>` элемент с телом, которые находятся ниже темы.</span><span class="sxs-lookup"><span data-stu-id="42c19-426">My `ItemTemplate` displays each guestbook comment's subject in an `<h4>` element with the body situated below the subject.</span></span> <span data-ttu-id="42c19-427">Обратите внимание, что синтаксис, используемый для отображения текста принимает данные, возвращаемые `Eval("Body")` инструкции привязки данных, преобразует его в строку и заменяет разрывы строк с `<br />` элемент.</span><span class="sxs-lookup"><span data-stu-id="42c19-427">Note that syntax used for displaying the body takes the data returned by the `Eval("Body")` databinding statement, converts it to a string, and replaces line breaks with the `<br />` element.</span></span> <span data-ttu-id="42c19-428">Такое преобразование необходимо, чтобы показать разрывы строки, введенные при отправке комментарий, так как пробелы игнорируются по HTML.</span><span class="sxs-lookup"><span data-stu-id="42c19-428">This conversion is needed in order to show the line breaks entered when submitting the comment since whitespace is ignored by HTML.</span></span> <span data-ttu-id="42c19-429">Подпись пользователя отображается под текст курсивом, следуют пользователя родном городе пользователя, ссылку на своей домашней страницы, даты и времени, сделанные комментарий, имя пользователя, тому, кто оставил комментарий.</span><span class="sxs-lookup"><span data-stu-id="42c19-429">The user's signature is displayed beneath the body in italics, followed by the user's home town, a link to his homepage, the date and time the comment was made, and the username of the person who left the comment.</span></span>

<span data-ttu-id="42c19-430">Отвлекитесь и просмотрите страницу через обозреватель.</span><span class="sxs-lookup"><span data-stu-id="42c19-430">Take a moment to view the page through a browser.</span></span> <span data-ttu-id="42c19-431">Вы увидите комментарии, добавленные в гостевую книгу на шаге 5, показанные здесь.</span><span class="sxs-lookup"><span data-stu-id="42c19-431">You should see the comments that you added to the guestbook in Step 5 displayed here.</span></span>

<span data-ttu-id="42c19-432">[![Сейчас Guestbook.aspx отображается комментариях](storing-additional-user-information-cs/_static/image56.png)](storing-additional-user-information-cs/_static/image55.png)</span><span class="sxs-lookup"><span data-stu-id="42c19-432">[![Guestbook.aspx Now Displays the Guestbook's Comments](storing-additional-user-information-cs/_static/image56.png)](storing-additional-user-information-cs/_static/image55.png)</span></span>

<span data-ttu-id="42c19-433">**Рис. 19**: `Guestbook.aspx` Теперь отображает комментариях ([Просмотр полноразмерного изображения](storing-additional-user-information-cs/_static/image57.png))</span><span class="sxs-lookup"><span data-stu-id="42c19-433">**Figure 19**: `Guestbook.aspx` Now Displays the Guestbook's Comments  ([Click to view full-size image](storing-additional-user-information-cs/_static/image57.png))</span></span>

<span data-ttu-id="42c19-434">Попробуйте добавить нового комментария в гостевой книги.</span><span class="sxs-lookup"><span data-stu-id="42c19-434">Try adding a new comment to the guestbook.</span></span> <span data-ttu-id="42c19-435">После нажатия кнопки `PostCommentButton` обратной передаче страницы кнопку Добавить комментарий к базе данных, а элемент управления ListView не обновляется для отображения нового комментария.</span><span class="sxs-lookup"><span data-stu-id="42c19-435">Upon clicking the `PostCommentButton` button the page posts back and the comment is added to the database, but the ListView control is not updated to show the new comment.</span></span> <span data-ttu-id="42c19-436">Это можно исправить, либо:</span><span class="sxs-lookup"><span data-stu-id="42c19-436">This can be fixed by either:</span></span>

- <span data-ttu-id="42c19-437">Обновление `PostCommentButton` кнопки `Click` обработчик событий, чтобы он вызывал элемента управления ListView `DataBind()` метод после вставки нового комментария в базе данных, или</span><span class="sxs-lookup"><span data-stu-id="42c19-437">Updating the `PostCommentButton` button's `Click` event handler so that it invokes the ListView control's `DataBind()` method after inserting the new comment into the database, or</span></span>
- <span data-ttu-id="42c19-438">Настройка элемента управления ListView `EnableViewState` свойства `false`.</span><span class="sxs-lookup"><span data-stu-id="42c19-438">Setting the ListView control's `EnableViewState` property to `false`.</span></span> <span data-ttu-id="42c19-439">Этот подход работает, поскольку отключение состояния представления элемента управления, его заново привязать к данным при каждой обратной передаче.</span><span class="sxs-lookup"><span data-stu-id="42c19-439">This approach works because by disabling the control's view state, it must rebind to the underlying data on every postback.</span></span>

<span data-ttu-id="42c19-440">Учебника по веб-сайт загрузки из этого учебника описание обоих методов.</span><span class="sxs-lookup"><span data-stu-id="42c19-440">The tutorial website downloadable from this tutorial illustrates both techniques.</span></span> <span data-ttu-id="42c19-441">Элемента управления ListView `EnableViewState` свойства `false` и представлены в код, необходимый для программным способом привяжите данные к ListView `Click` обработчик событий, но закомментирован.</span><span class="sxs-lookup"><span data-stu-id="42c19-441">The ListView control's `EnableViewState` property to `false` and the code needed to programmatically rebind the data to the ListView is present in the `Click` event handler, but is commented out.</span></span>

> [!NOTE]
> <span data-ttu-id="42c19-442">В настоящее время `AdditionalUserInfo.aspx` страница позволяет пользователям просматривать и редактировать их домашней параметры города, домашней страницы и подпись.</span><span class="sxs-lookup"><span data-stu-id="42c19-442">Currently the `AdditionalUserInfo.aspx` page allows the user to view and edit their home town, homepage, and signature settings.</span></span> <span data-ttu-id="42c19-443">Было бы здорово обновить `AdditionalUserInfo.aspx` для отображения вошедшего в комментариях пользователя.</span><span class="sxs-lookup"><span data-stu-id="42c19-443">It might be nice to update `AdditionalUserInfo.aspx` to display the logged in user's guestbook comments.</span></span> <span data-ttu-id="42c19-444">То есть, помимо проверки и изменения ее сведения, пользователь может посетить `AdditionalUserInfo.aspx` страницу, чтобы увидеть, какие гостевая книга комментарии, она выполняется в прошлом.</span><span class="sxs-lookup"><span data-stu-id="42c19-444">That is, in addition to examining and modifying her information, a user can visit the `AdditionalUserInfo.aspx` page to see what guestbook comments she's made in the past.</span></span> <span data-ttu-id="42c19-445">Оставить этот в качестве упражнения для интересующихся.</span><span class="sxs-lookup"><span data-stu-id="42c19-445">I leave this as an exercise for the interested reader.</span></span>

## <a name="step-6-customizing-the-createuserwizard-control-to-include-an-interface-for-the-home-town-homepage-and-signature"></a><span data-ttu-id="42c19-446">Шаг 6. Элемент управления CreateUserWizard, чтобы включить интерфейс для домашней города, домашней страницы и подписи</span><span class="sxs-lookup"><span data-stu-id="42c19-446">Step 6: Customizing the CreateUserWizard Control to Include an Interface for the Home Town, Homepage, and Signature</span></span>

<span data-ttu-id="42c19-447">`SELECT` Запроса, используемого `Guestbook.aspx` странице использует `INNER JOIN` для объединения связанных записей среди `GuestbookComments`, `UserProfiles`, и `aspnet_Users` таблицы.</span><span class="sxs-lookup"><span data-stu-id="42c19-447">The `SELECT` query used by the `Guestbook.aspx` page uses an `INNER JOIN` to combine the related records amongst the `GuestbookComments`, `UserProfiles`, and `aspnet_Users` tables.</span></span> <span data-ttu-id="42c19-448">Если пользователь, не имеет записи в `UserProfiles` комментарий делает гостевой книги, комментария не будет отображаться в ListView, поскольку `INNER JOIN` возвращает только `GuestbookComments` записей при наличии совпадающих записей в `UserProfiles` и `aspnet_Users`.</span><span class="sxs-lookup"><span data-stu-id="42c19-448">If a user that has no record in `UserProfiles` makes a guestbook comment, the comment won't be displayed in the ListView because the `INNER JOIN` only returns `GuestbookComments` records when there are matching records in `UserProfiles` and `aspnet_Users`.</span></span> <span data-ttu-id="42c19-449">И как мы видели в шаге 3, если пользователь не имеет записи `UserProfiles` она нельзя просматривать или изменять ее параметры в `AdditionalUserInfo.aspx` страницы.</span><span class="sxs-lookup"><span data-stu-id="42c19-449">And as we saw in Step 3, if a user does not have a record in `UserProfiles` she cannot view or edit her settings in the `AdditionalUserInfo.aspx` page.</span></span>

<span data-ttu-id="42c19-450">Нечего и говорить, из-за нашей структуре решения, очень важно, что все учетные записи пользователей в системе членства с совпадающим записи в `UserProfiles` таблицы.</span><span class="sxs-lookup"><span data-stu-id="42c19-450">Needless to say, due to our design decisions it is important that every user account in the Membership system have a matching record in the `UserProfiles` table.</span></span> <span data-ttu-id="42c19-451">Мы хотим предназначен для соответствующей записи для добавления `UserProfiles` создается каждый раз, когда с помощью CreateUserWizard учетной записи пользователя членства.</span><span class="sxs-lookup"><span data-stu-id="42c19-451">What we want is for a corresponding record to be added to `UserProfiles` whenever a new Membership user account is created through the CreateUserWizard.</span></span>

<span data-ttu-id="42c19-452">Как уже говорилось в [ *Создание учетных записей пользователей* ](creating-user-accounts-cs.md) руководства, после создания новой учетной записи пользователя членства в элементе управления CreateUserWizard вызывает его [ `CreatedUser` событий](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createduser.aspx).</span><span class="sxs-lookup"><span data-stu-id="42c19-452">As discussed in the [*Creating User Accounts*](creating-user-accounts-cs.md) tutorial, after the new Membership user account is created the CreateUserWizard control raises its [`CreatedUser` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createduser.aspx).</span></span> <span data-ttu-id="42c19-453">Мы можно создать обработчик событий для этого события, получить идентификатор пользователя для только что созданного пользователя и затем вставить запись в `UserProfiles` таблицы со значениями по умолчанию для `HomeTown`, `HomepageUrl`, и `Signature` столбцов.</span><span class="sxs-lookup"><span data-stu-id="42c19-453">We can create an event handler for this event, get the UserId for the just-created user, and then insert a record into the `UserProfiles` table with default values for the `HomeTown`, `HomepageUrl`, and `Signature` columns.</span></span> <span data-ttu-id="42c19-454">Более того существует возможность запрашивать у пользователя эти значения путем настройки интерфейса элемента управления CreateUserWizard включать дополнительные текстовые поля.</span><span class="sxs-lookup"><span data-stu-id="42c19-454">What's more, it is possible to prompt the user for these values by customizing the CreateUserWizard control's interface to include additional TextBoxes.</span></span>

<span data-ttu-id="42c19-455">Давайте сначала рассмотрим способы добавления новой строки к `UserProfiles` в таблицу `CreatedUser` обработчик событий со значениями по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="42c19-455">Let's first look at how to add a new row to the `UserProfiles` table in the `CreatedUser` event handler with default values.</span></span> <span data-ttu-id="42c19-456">После этого мы увидим, как настроить пользовательский интерфейс элемента управления CreateUserWizard включать дополнительные поля формы для сбора родного города нового пользователя, домашней страницы и подпись.</span><span class="sxs-lookup"><span data-stu-id="42c19-456">Following that, we will see how to customize the CreateUserWizard control's user interface to include additional form fields to collect the new user's home town, homepage, and signature.</span></span>

### <a name="adding-a-default-row-touserprofiles"></a><span data-ttu-id="42c19-457">Добавление строки по умолчанию`UserProfiles`</span><span class="sxs-lookup"><span data-stu-id="42c19-457">Adding a Default Row to`UserProfiles`</span></span>

<span data-ttu-id="42c19-458">В [ *Создание учетных записей пользователей* ](creating-user-accounts-cs.md) руководстве, мы добавили элемент управления CreateUserWizard для `CreatingUserAccounts.aspx` странице в `Membership` папку.</span><span class="sxs-lookup"><span data-stu-id="42c19-458">In the [*Creating User Accounts*](creating-user-accounts-cs.md) tutorial we added a CreateUserWizard control to the `CreatingUserAccounts.aspx` page in the `Membership` folder.</span></span> <span data-ttu-id="42c19-459">Чтобы получить CreateUserWizard управления добавить запись `UserProfiles` таблицы при создании учетной записи пользователя, необходимо обновить функциональные возможности элемента управления CreateUserWizard.</span><span class="sxs-lookup"><span data-stu-id="42c19-459">In order to have the CreateUserWizard control add a record to `UserProfiles` table upon user account creation, we need to update the CreateUserWizard control's functionality.</span></span> <span data-ttu-id="42c19-460">Вместо того, чтобы эти изменения к `CreatingUserAccounts.aspx` странице, можно вместо этого добавить новый элемент управления CreateUserWizard для `EnhancedCreateUserWizard.aspx` странице и внесите изменения в этом руководстве, существует.</span><span class="sxs-lookup"><span data-stu-id="42c19-460">Rather than making these changes to the `CreatingUserAccounts.aspx` page, let's instead add a new CreateUserWizard control to `EnhancedCreateUserWizard.aspx` page and make the modifications for this tutorial there.</span></span>

<span data-ttu-id="42c19-461">Откройте `EnhancedCreateUserWizard.aspx` страницы в Visual Studio и перетащите элемент управления CreateUserWizard из панели элементов на странице.</span><span class="sxs-lookup"><span data-stu-id="42c19-461">Open the `EnhancedCreateUserWizard.aspx` page in Visual Studio and drag a CreateUserWizard control from the Toolbox onto the page.</span></span> <span data-ttu-id="42c19-462">Значение элемента управления CreateUserWizard `ID` свойства `NewUserWizard`.</span><span class="sxs-lookup"><span data-stu-id="42c19-462">Set the CreateUserWizard control's `ID` property to `NewUserWizard`.</span></span> <span data-ttu-id="42c19-463">Как уже говорилось в <a id="_msoanchor_5"> </a> [ *Создание учетных записей пользователей* ](creating-user-accounts-cs.md) учебника, CreateUserWizard по умолчанию пользовательский интерфейс предлагает посетителя необходимую информацию.</span><span class="sxs-lookup"><span data-stu-id="42c19-463">As we discussed in the <a id="_msoanchor_5"></a>[*Creating User Accounts*](creating-user-accounts-cs.md) tutorial, the CreateUserWizard's default user interface prompts the visitor for the necessary information.</span></span> <span data-ttu-id="42c19-464">После этого информация предоставлено, элемент управления внутри создает учетную запись пользователя в структуру членства, все это без нам придется писать ни одной строки кода.</span><span class="sxs-lookup"><span data-stu-id="42c19-464">Once this information has been supplied, the control internally creates a new user account in the Membership framework, all without us having to write a single line of code.</span></span>

<span data-ttu-id="42c19-465">Элемент управления CreateUserWizard Возводит число событий во время его рабочего процесса.</span><span class="sxs-lookup"><span data-stu-id="42c19-465">The CreateUserWizard control raises a number of events during its workflow.</span></span> <span data-ttu-id="42c19-466">После посетитель предоставляет необходимые данные и отправляет форму, элемент управления CreateUserWizard изначально запускает его [ `CreatingUser` событий](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.creatinguser.aspx).</span><span class="sxs-lookup"><span data-stu-id="42c19-466">After a visitor supplies the request information and submits the form, the CreateUserWizard control initially fires its [`CreatingUser` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.creatinguser.aspx).</span></span> <span data-ttu-id="42c19-467">Если возникла проблема во время процесса создания [ `CreateUserError` событий](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createusererror.aspx) запускается; тем не менее, если пользователь будет создан, то [ `CreatedUser` событие](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createduser.aspx) возникает.</span><span class="sxs-lookup"><span data-stu-id="42c19-467">If there is a problem during the create process, the [`CreateUserError` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createusererror.aspx) is fired; however, if the user is successfully created, then the [`CreatedUser` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createduser.aspx) is raised.</span></span> <span data-ttu-id="42c19-468">В <a id="_msoanchor_6"> </a> [ *Создание учетных записей пользователей* ](creating-user-accounts-cs.md) руководстве мы создали обработчик событий для `CreatingUser` событий, чтобы убедиться, что введенное имя пользователя не содержал ведущими или конечные пробелы, и что имя пользователя не возникали в любом месте в пароле.</span><span class="sxs-lookup"><span data-stu-id="42c19-468">In the <a id="_msoanchor_6"></a>[*Creating User Accounts*](creating-user-accounts-cs.md) tutorial we created an event handler for the `CreatingUser` event to ensure that the supplied username did not contain any leading or trailing spaces, and that the username did not appear anywhere in the password.</span></span>

<span data-ttu-id="42c19-469">Чтобы добавить строку в `UserProfiles` таблицы для только что созданного пользователя, нам необходимо создать обработчик событий для `CreatedUser` событий.</span><span class="sxs-lookup"><span data-stu-id="42c19-469">In order to add a row in the `UserProfiles` table for the just-created user, we need to create an event handler for the `CreatedUser` event.</span></span> <span data-ttu-id="42c19-470">К моменту `CreatedUser` события, учетная запись пользователя уже создан в структуру членства, благодаря чему мы можем получить значение UserId учетной записи.</span><span class="sxs-lookup"><span data-stu-id="42c19-470">By the time the `CreatedUser` event has fired, the user account has already been created in the Membership framework, enabling us to retrieve the account's UserId value.</span></span>

<span data-ttu-id="42c19-471">Создайте обработчик событий для `NewUserWizard`в `CreatedUser` событий и добавьте следующий код:</span><span class="sxs-lookup"><span data-stu-id="42c19-471">Create an event handler for the `NewUserWizard`'s `CreatedUser` event and add the following code:</span></span>

[!code-csharp[Main](storing-additional-user-information-cs/samples/sample11.cs)]

<span data-ttu-id="42c19-472">Выше существ кода, получив идентификатор пользователя учетной записи пользователя, только что добавлен.</span><span class="sxs-lookup"><span data-stu-id="42c19-472">The above code beings by retrieving the UserId of the just-added user account.</span></span> <span data-ttu-id="42c19-473">Это достигается с помощью `Membership.GetUser(username)` метод для возврата сведений о конкретного пользователя и затем с помощью `ProviderUserKey` свойство для извлечения их UserId.</span><span class="sxs-lookup"><span data-stu-id="42c19-473">This is accomplished by using the `Membership.GetUser(username)` method to return information about a particular user, and then using the `ProviderUserKey` property to retrieve their UserId.</span></span> <span data-ttu-id="42c19-474">Имя пользователя, введенное пользователем в элемент управления CreateUserWizard доступен через его [ `UserName` свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.username.aspx).</span><span class="sxs-lookup"><span data-stu-id="42c19-474">The username entered by the user in the CreateUserWizard control is available via its [`UserName` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.username.aspx).</span></span>

<span data-ttu-id="42c19-475">После этого строка подключения извлекается из `Web.config` и `INSERT` задана инструкция.</span><span class="sxs-lookup"><span data-stu-id="42c19-475">Next, the connection string is retrieved from `Web.config` and the `INSERT` statement is specified.</span></span> <span data-ttu-id="42c19-476">Создаются необходимые объекты ADO.NET, и выполнена команда.</span><span class="sxs-lookup"><span data-stu-id="42c19-476">The necessary ADO.NET objects are instantiated and the command executed.</span></span> <span data-ttu-id="42c19-477">Код присваивает [ `DBNull` ](https://msdn.microsoft.com/library/system.dbnull.aspx) экземпляр `@HomeTown`, `@HomepageUrl`, и `@Signature` параметры, которые имеет приведет к добавлению базы данных `NULL` значений в параметре `HomeTown`, `HomepageUrl`, и `Signature` поля.</span><span class="sxs-lookup"><span data-stu-id="42c19-477">The code assigns a [`DBNull`](https://msdn.microsoft.com/library/system.dbnull.aspx) instance to the `@HomeTown`, `@HomepageUrl`, and `@Signature` parameters, which has the effect of inserting database `NULL` values for the `HomeTown`, `HomepageUrl`, and `Signature` fields.</span></span>

<span data-ttu-id="42c19-478">Посетите `EnhancedCreateUserWizard.aspx` странице через браузер и создать учетную запись пользователя.</span><span class="sxs-lookup"><span data-stu-id="42c19-478">Visit the `EnhancedCreateUserWizard.aspx` page through a browser and create a new user account.</span></span> <span data-ttu-id="42c19-479">После этого вернитесь в Visual Studio и изучить содержимое `aspnet_Users` и `UserProfiles` таблиц (как это делалось обратно на рис. 12).</span><span class="sxs-lookup"><span data-stu-id="42c19-479">After doing so, return to Visual Studio and examine the contents of the `aspnet_Users` and `UserProfiles` tables (like we did back in Figure 12).</span></span> <span data-ttu-id="42c19-480">Вы увидите новую учетную запись пользователя, в `aspnet_Users` и соответствующий `UserProfiles` строки (с `NULL` значений в параметре `HomeTown`, `HomepageUrl`, и `Signature`).</span><span class="sxs-lookup"><span data-stu-id="42c19-480">You should see the new user account in `aspnet_Users` and a corresponding `UserProfiles` row (with `NULL` values for `HomeTown`, `HomepageUrl`, and `Signature`).</span></span>

<span data-ttu-id="42c19-481">[![Были добавлены новой учетной записи пользователя и запись UserProfiles](storing-additional-user-information-cs/_static/image59.png)](storing-additional-user-information-cs/_static/image58.png)</span><span class="sxs-lookup"><span data-stu-id="42c19-481">[![A New User Account and UserProfiles Record Have Been Added](storing-additional-user-information-cs/_static/image59.png)](storing-additional-user-information-cs/_static/image58.png)</span></span>

<span data-ttu-id="42c19-482">**Рис. 20**: Учетной записи пользователя и `UserProfiles` записи были добавлены ([Просмотр полноразмерного изображения](storing-additional-user-information-cs/_static/image60.png))</span><span class="sxs-lookup"><span data-stu-id="42c19-482">**Figure 20**: A New User Account and `UserProfiles` Record Have Been Added  ([Click to view full-size image](storing-additional-user-information-cs/_static/image60.png))</span></span>

<span data-ttu-id="42c19-483">После посетитель предоставляется его новые сведения об учетной записи и нажал кнопку «Create User», создается учетная запись пользователя, и строка `UserProfiles` таблицы.</span><span class="sxs-lookup"><span data-stu-id="42c19-483">After the visitor has supplied his new account information and clicked the "Create User" button, the user account is created and a row added to the `UserProfiles` table.</span></span> <span data-ttu-id="42c19-484">CreateUserWizard выведет его `CompleteWizardStep`, которая отображает сообщение об успешном выполнении и кнопки "Продолжить".</span><span class="sxs-lookup"><span data-stu-id="42c19-484">The CreateUserWizard then displays its `CompleteWizardStep`, which displays a success message and a Continue button.</span></span> <span data-ttu-id="42c19-485">Нажатие кнопки "Продолжить" обратную передачу, но никакие действия не выполняются, а пользователь, прикрепленной `EnhancedCreateUserWizard.aspx` страницы.</span><span class="sxs-lookup"><span data-stu-id="42c19-485">Clicking the Continue button causes a postback, but no action is taken, leaving the user stuck on the `EnhancedCreateUserWizard.aspx` page.</span></span>

<span data-ttu-id="42c19-486">Можно указать URL-адрес для отправки пользователю при нажатии кнопки "Продолжить" с помощью элемента управления CreateUserWizard [ `ContinueDestinationPageUrl` свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.continuedestinationpageurl.aspx).</span><span class="sxs-lookup"><span data-stu-id="42c19-486">We can specify a URL to send the user to when the Continue button is clicked via the CreateUserWizard control's [`ContinueDestinationPageUrl` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.continuedestinationpageurl.aspx).</span></span> <span data-ttu-id="42c19-487">Задать `ContinueDestinationPageUrl` свойства «~ / Membership/AdditionalUserInfo.aspx».</span><span class="sxs-lookup"><span data-stu-id="42c19-487">Set the `ContinueDestinationPageUrl` property to "~/Membership/AdditionalUserInfo.aspx".</span></span> <span data-ttu-id="42c19-488">Это занимает новому пользователю `AdditionalUserInfo.aspx`, где они могут просматривать и обновлять их параметры.</span><span class="sxs-lookup"><span data-stu-id="42c19-488">This takes the new user to `AdditionalUserInfo.aspx`, where they can view and update their settings.</span></span>

### <a name="customizing-the-createuserwizards-interface-to-prompt-for-the-new-users-home-town-homepage-and-signature"></a><span data-ttu-id="42c19-489">Настройка интерфейса CreateUserWizard, чтобы запрашивать домашней города нового пользователя, домашней страницы и подписи</span><span class="sxs-lookup"><span data-stu-id="42c19-489">Customizing the CreateUserWizard's Interface to Prompt for the New User's Home Town, Homepage, and Signature</span></span>

<span data-ttu-id="42c19-490">Интерфейс по умолчанию элемента управления CreateUserWizard достаточно для сценариев создания простой учетной записи, где должны собираться только данные учетной записи пользователя core как имя пользователя, пароль и адрес электронной почты.</span><span class="sxs-lookup"><span data-stu-id="42c19-490">The CreateUserWizard control's default interface is sufficient for simple account creation scenarios where only core user account information like username, password, and email need be collected.</span></span> <span data-ttu-id="42c19-491">Но что делать, если мы хотели бы запрашивать посетителя, ввести свой родного города, домашней страницы и подписи при создании своей учетной записи?</span><span class="sxs-lookup"><span data-stu-id="42c19-491">But what if we wanted to prompt the visitor to enter her home town, homepage, and signature while creating her account?</span></span> <span data-ttu-id="42c19-492">Существует возможность настройки интерфейса элемента управления CreateUserWizard для сбора дополнительных сведений при регистрации, и эта информация может использоваться в `CreatedUser` обработчик событий для вставки дополнительных записей в основной базе данных.</span><span class="sxs-lookup"><span data-stu-id="42c19-492">It is possible to customize the CreateUserWizard control's interface to collect additional information at signup, and this information may be used in the `CreatedUser` event handler to insert additional records into the underlying database.</span></span>

<span data-ttu-id="42c19-493">Элемент управления CreateUserWizard расширяет элемент управления ASP.NET мастер, который является элементом управления, который позволяет разработчику определить ряд упорядоченный `WizardSteps`.</span><span class="sxs-lookup"><span data-stu-id="42c19-493">The CreateUserWizard control extends the ASP.NET Wizard control, which is a control that allows a page developer to define a series of ordered `WizardSteps`.</span></span> <span data-ttu-id="42c19-494">Элемент управления мастер отображает активного шага и предоставляет интерфейс навигации, который позволяет посетителя переместить эти шаги.</span><span class="sxs-lookup"><span data-stu-id="42c19-494">The Wizard control renders the active step and provides a navigation interface that allows the visitor to move through these steps.</span></span> <span data-ttu-id="42c19-495">Элемента управления Wizard идеально подходит для дробления длительной задачи в несколько простых действий.</span><span class="sxs-lookup"><span data-stu-id="42c19-495">The Wizard control is ideal for breaking down a long task into several short steps.</span></span> <span data-ttu-id="42c19-496">Дополнительные сведения об элементе управления мастера, см. в разделе [Создание пошаговое пользовательского интерфейса с помощью элемента управления ASP.NET 2.0 мастер](http://aspnet.4guysfromrolla.com/articles/061406-1.aspx).</span><span class="sxs-lookup"><span data-stu-id="42c19-496">For more information on the Wizard control, see [Creating a Step-by-Step User Interface with the ASP.NET 2.0 Wizard Control](http://aspnet.4guysfromrolla.com/articles/061406-1.aspx).</span></span>

<span data-ttu-id="42c19-497">Разметка элемента управления CreateUserWizard по умолчанию определяются два `WizardSteps`: `CreateUserWizardStep` и `CompleteWizardStep`.</span><span class="sxs-lookup"><span data-stu-id="42c19-497">The CreateUserWizard control's default markup defines two `WizardSteps`: `CreateUserWizardStep` and `CompleteWizardStep`.</span></span>

[!code-aspx[Main](storing-additional-user-information-cs/samples/sample12.aspx)]

<span data-ttu-id="42c19-498">Первый `WizardStep`, `CreateUserWizardStep`, отображает интерфейс, который запрашивает имя пользователя, пароль, адрес электронной почты и т. д.</span><span class="sxs-lookup"><span data-stu-id="42c19-498">The first `WizardStep`, `CreateUserWizardStep`, renders the interface that prompts for the username, password, email, and so on.</span></span> <span data-ttu-id="42c19-499">После посетителя отправляет эту информацию и нажимает кнопку «Create User», она отображается `CompleteWizardStep`, который показывает сообщение об успешном выполнении и кнопки "Продолжить".</span><span class="sxs-lookup"><span data-stu-id="42c19-499">After the visitor supplies this information and clicks "Create User", she is shown the `CompleteWizardStep`, which shows the success message and a Continue button.</span></span>

<span data-ttu-id="42c19-500">Для настройки интерфейса элемента управления CreateUserWizard, чтобы включить дополнительные поля формы, можем:</span><span class="sxs-lookup"><span data-stu-id="42c19-500">To customize the CreateUserWizard control's interface to include additional form fields, we can:</span></span>

- <span data-ttu-id="42c19-501"><strong>Создать один или несколько</strong><strong>`WizardStep`</strong><strong>s, чтобы содержать дополнительных элементах пользовательского интерфейса</strong>.</span><span class="sxs-lookup"><span data-stu-id="42c19-501"><strong>Create one or more new</strong><strong>`WizardStep`</strong><strong>s to contain the additional user interface elements</strong>.</span></span> <span data-ttu-id="42c19-502">Чтобы добавить новую `WizardStep` чтобы CreateUserWizard, нажмите кнопку «Добавить или удалить `WizardSteps`"ссылка из его смарт-тег, чтобы запустить `WizardStep` редактор коллекции.</span><span class="sxs-lookup"><span data-stu-id="42c19-502">To add a new `WizardStep` to the CreateUserWizard, click the "Add/Remove `WizardSteps`" link from its Smart Tag to launch the `WizardStep` Collection Editor.</span></span> <span data-ttu-id="42c19-503">Оттуда можно добавить, удалить или изменить порядок действий в мастере.</span><span class="sxs-lookup"><span data-stu-id="42c19-503">From there you can add, remove, or reorder the steps in the wizard.</span></span> <span data-ttu-id="42c19-504">Именно этот подход, которые будут использоваться в этом руководстве.</span><span class="sxs-lookup"><span data-stu-id="42c19-504">This is the approach we will use for this tutorial.</span></span>

- <span data-ttu-id="42c19-505"><strong>Преобразовать</strong><strong>`CreateUserWizardStep`</strong><strong>в изменяемом элементе</strong><strong>`WizardStep`</strong><strong>.</strong></span><span class="sxs-lookup"><span data-stu-id="42c19-505"><strong>Convert the</strong><strong>`CreateUserWizardStep`</strong><strong>into an editable</strong><strong>`WizardStep`</strong><strong>.</strong></span></span> <span data-ttu-id="42c19-506">Этот параметр заменяет `CreateUserWizardStep` с эквивалентным `WizardStep` , разметка определяет пользовательский интерфейс, который соответствует `CreateUserWizardStep`"s.</span><span class="sxs-lookup"><span data-stu-id="42c19-506">This replaces the `CreateUserWizardStep` with an equivalent `WizardStep` whose markup defines a user interface that matches the `CreateUserWizardStep`'s.</span></span> <span data-ttu-id="42c19-507">Путем преобразования `CreateUserWizardStep` в `WizardStep` можно переместить элементы управления или добавление дополнительных элементах пользовательского интерфейса для этого шага.</span><span class="sxs-lookup"><span data-stu-id="42c19-507">By converting the `CreateUserWizardStep` into a `WizardStep` we can reposition the controls or add additional user interface elements to this step.</span></span> <span data-ttu-id="42c19-508">Для преобразования `CreateUserWizardStep` или `CompleteWizardStep` в изменяемом элементе `WizardStep`, нажмите кнопку «Создать пользователя Настройка Step» или «Настроить выполните шаг» связать смарт-теге элемента управления.</span><span class="sxs-lookup"><span data-stu-id="42c19-508">To convert the `CreateUserWizardStep` or `CompleteWizardStep` into an editable `WizardStep`, click the "Customize Create User Step" or "Customize Complete Step" link from the control's Smart Tag.</span></span>

- <span data-ttu-id="42c19-509">**Используйте сочетание двух перечисленных выше.**</span><span class="sxs-lookup"><span data-stu-id="42c19-509">**Use some combination of the above two options.**</span></span>

<span data-ttu-id="42c19-510">— Это важно помнить, что элемент управления CreateUserWizard выполняется его процесс создания учетной записи пользователя, при нажатии кнопки «Создать пользователя» изнутри его `CreateUserWizardStep`.</span><span class="sxs-lookup"><span data-stu-id="42c19-510">One important thing to keep in mind is that the CreateUserWizard control executes its user account creation process when the "Create User" button is clicked from within its `CreateUserWizardStep`.</span></span> <span data-ttu-id="42c19-511">Не важно, если существуют дополнительные `WizardStep` s после `CreateUserWizardStep` или нет.</span><span class="sxs-lookup"><span data-stu-id="42c19-511">It doesn't matter if there are additional `WizardStep` s after the `CreateUserWizardStep` or not.</span></span>

<span data-ttu-id="42c19-512">При добавлении пользовательского `WizardStep` управления CreateUserWizard, чтобы собирать дополнительного ввода данных пользователем, пользовательского `WizardStep` можно разместить до или после `CreateUserWizardStep`.</span><span class="sxs-lookup"><span data-stu-id="42c19-512">When adding a custom `WizardStep` to the CreateUserWizard control to collect additional user input, the custom `WizardStep` can be placed before or after the `CreateUserWizardStep`.</span></span> <span data-ttu-id="42c19-513">Если она предшествует `CreateUserWizardStep` затем собранные дополнительного пользовательского ввода из пользовательского `WizardStep` для `CreatedUser` обработчик событий.</span><span class="sxs-lookup"><span data-stu-id="42c19-513">If it comes before the `CreateUserWizardStep` then the additional user input collected from the custom `WizardStep` is available for the `CreatedUser` event handler.</span></span> <span data-ttu-id="42c19-514">Тем не менее если пользовательский `WizardStep` следует после `CreateUserWizardStep` затем, когда пользовательский `WizardStep` отображается новой учетной записи уже создан и `CreatedUser` событие уже возникло.</span><span class="sxs-lookup"><span data-stu-id="42c19-514">However, if the custom `WizardStep` comes after `CreateUserWizardStep` then by the time the custom `WizardStep` is displayed the new user account has already been created and the `CreatedUser` event has already fired.</span></span>

<span data-ttu-id="42c19-515">Рис. 21 показан рабочий процесс при добавленного `WizardStep` предшествует `CreateUserWizardStep`.</span><span class="sxs-lookup"><span data-stu-id="42c19-515">Figure 21 shows the workflow when the added `WizardStep` precedes the `CreateUserWizardStep`.</span></span> <span data-ttu-id="42c19-516">Поскольку к моменту сбора дополнительных сведений о пользователе `CreatedUser` вызывает событие, все что нужно сделать — обновление `CreatedUser` обработчик событий для получения этих входных данных и использовать их для `INSERT` значения параметров для инструкции (а не `DBNull.Value`).</span><span class="sxs-lookup"><span data-stu-id="42c19-516">Since the additional user information has been collected by the time the `CreatedUser` event fires, all we have to do is update the `CreatedUser` event handler to retrieve these inputs and use those for the `INSERT` statement's parameter values (rather than `DBNull.Value`).</span></span>

<span data-ttu-id="42c19-517">[![Рабочий процесс CreateUserWizard, когда дополнительные WizardStep предшествует CreateUserWizardStep](storing-additional-user-information-cs/_static/image62.png)](storing-additional-user-information-cs/_static/image61.png)</span><span class="sxs-lookup"><span data-stu-id="42c19-517">[![The CreateUserWizard Workflow When an Additional WizardStep Precedes the CreateUserWizardStep](storing-additional-user-information-cs/_static/image62.png)](storing-additional-user-information-cs/_static/image61.png)</span></span>

<span data-ttu-id="42c19-518">**Рис. 21**: CreateUserWizard рабочего процесса при дополнительной `WizardStep` Precedes `CreateUserWizardStep` ([Просмотр полноразмерного изображения](storing-additional-user-information-cs/_static/image63.png))</span><span class="sxs-lookup"><span data-stu-id="42c19-518">**Figure 21**: The CreateUserWizard Workflow When an Additional `WizardStep` Precedes the `CreateUserWizardStep` ([Click to view full-size image](storing-additional-user-information-cs/_static/image63.png))</span></span>

<span data-ttu-id="42c19-519">Если пользовательский `WizardStep` помещается *после* `CreateUserWizardStep`, однако процесса создания учетной записи пользователя выполняется до того, как пользователь сможет войти в свой домашний города, домашней страницы или подпись.</span><span class="sxs-lookup"><span data-stu-id="42c19-519">If the custom `WizardStep` is placed *after* the `CreateUserWizardStep`, however, the create user account process occurs before the user has had a chance to enter her home town, homepage, or signature.</span></span> <span data-ttu-id="42c19-520">В таком случае эти дополнительные сведения необходимо вставить в базу данных после создания учетной записи пользователя, как показано на рис. 22.</span><span class="sxs-lookup"><span data-stu-id="42c19-520">In such a case, this additional information needs to be inserted into the database after the user account has been created, as Figure 22 illustrates.</span></span>

<span data-ttu-id="42c19-521">[![При поступлении дополнительных WizardStep после CreateUserWizardStep рабочего процесса CreateUserWizard](storing-additional-user-information-cs/_static/image65.png)](storing-additional-user-information-cs/_static/image64.png)</span><span class="sxs-lookup"><span data-stu-id="42c19-521">[![The CreateUserWizard Workflow When an Additional WizardStep Comes After the CreateUserWizardStep](storing-additional-user-information-cs/_static/image65.png)](storing-additional-user-information-cs/_static/image64.png)</span></span>

<span data-ttu-id="42c19-522">**Рис. 22**: CreateUserWizard рабочего процесса при дополнительной `WizardStep` поставляется после `CreateUserWizardStep` ([Просмотр полноразмерного изображения](storing-additional-user-information-cs/_static/image66.png))</span><span class="sxs-lookup"><span data-stu-id="42c19-522">**Figure 22**: The CreateUserWizard Workflow When an Additional `WizardStep` Comes After the `CreateUserWizardStep` ([Click to view full-size image](storing-additional-user-information-cs/_static/image66.png))</span></span>

<span data-ttu-id="42c19-523">Ожидает вставить запись в рабочий процесс, показанный на рис. 22 `UserProfiles` таблицы до, после завершения шаг 2.</span><span class="sxs-lookup"><span data-stu-id="42c19-523">The workflow shown in Figure 22 waits to insert a record into the `UserProfiles` table until after Step 2 completes.</span></span> <span data-ttu-id="42c19-524">Если посетитель закрывает браузер после шага 1, тем не менее, будет достигнут состояния, где создана учетная запись пользователя, но не запись была добавлена к `UserProfiles`.</span><span class="sxs-lookup"><span data-stu-id="42c19-524">If the visitor closes her browser after step 1, however, we will have reached a state where a user account was created, but no record was added to `UserProfiles`.</span></span> <span data-ttu-id="42c19-525">В этом случае является записывать с `NULL` или по умолчанию значениях, вставляемых в `UserProfiles` в `CreatedUser` обработчик событий (который срабатывает после выполнения шага 1) и только затем это записи после завершения шаг 2.</span><span class="sxs-lookup"><span data-stu-id="42c19-525">One workaround is to have a record with `NULL` or default values inserted into `UserProfiles` in the `CreatedUser` event handler (which fires after step 1), and then update this record after step 2 completes.</span></span> <span data-ttu-id="42c19-526">Это гарантирует, что `UserProfiles` будет добавлена запись для учетной записи пользователя, даже если пользователь завершает работу во время процесса регистрации.</span><span class="sxs-lookup"><span data-stu-id="42c19-526">This ensures that a `UserProfiles` record will be added for the user account even if the user quits the registration process midway through.</span></span>

<span data-ttu-id="42c19-527">В этом руководстве давайте создадим новый `WizardStep` , наступающее после `CreateUserWizardStep` до `CompleteWizardStep`.</span><span class="sxs-lookup"><span data-stu-id="42c19-527">For this tutorial let's create a new `WizardStep` that occurs after the `CreateUserWizardStep` but before the `CompleteWizardStep`.</span></span> <span data-ttu-id="42c19-528">Давайте сначала получите WizardStep в поместите и настроен, а затем мы рассмотрим код.</span><span class="sxs-lookup"><span data-stu-id="42c19-528">Let's first get the WizardStep in place and configured and then we'll look at the code.</span></span>

<span data-ttu-id="42c19-529">Смарт-теге элемента управления CreateUserWizard, выберите «Добавить или удалить `WizardStep` s», которая вызывает `WizardStep` диалоговое окно редактора коллекции.</span><span class="sxs-lookup"><span data-stu-id="42c19-529">From the CreateUserWizard control's Smart Tag, select the "Add/Remove `WizardStep` s", which brings up the `WizardStep` Collection Editor dialog.</span></span> <span data-ttu-id="42c19-530">Добавьте новый `WizardStep`, устанавливая его `ID` для `UserSettings`, ее `Title` «Your Настройка» и его `StepType` для `Step`.</span><span class="sxs-lookup"><span data-stu-id="42c19-530">Add a new `WizardStep`, setting its `ID` to `UserSettings`, its `Title` to "Your Settings" and its `StepType` to `Step`.</span></span> <span data-ttu-id="42c19-531">Затем поместите ее так, чтобы он следует после `CreateUserWizardStep` («Регистрация для создания новой учетной записи») и перед `CompleteWizardStep` («полное»), как показано на рис. 23.</span><span class="sxs-lookup"><span data-stu-id="42c19-531">Then position it so that it comes after the `CreateUserWizardStep` ("Sign Up for Your New Account") and before the `CompleteWizardStep` ("Complete"), as shown in Figure 23.</span></span>

<span data-ttu-id="42c19-532">[![Добавьте новый WizardStep к элементу управления CreateUserWizard](storing-additional-user-information-cs/_static/image68.png)](storing-additional-user-information-cs/_static/image67.png)</span><span class="sxs-lookup"><span data-stu-id="42c19-532">[![Add a New WizardStep to the CreateUserWizard Control](storing-additional-user-information-cs/_static/image68.png)](storing-additional-user-information-cs/_static/image67.png)</span></span>

<span data-ttu-id="42c19-533">**Рис. 23**: Добавить новый `WizardStep` в элемент управления CreateUserWizard ([Просмотр полноразмерного изображения](storing-additional-user-information-cs/_static/image69.png))</span><span class="sxs-lookup"><span data-stu-id="42c19-533">**Figure 23**: Add a New `WizardStep` to the CreateUserWizard Control  ([Click to view full-size image](storing-additional-user-information-cs/_static/image69.png))</span></span>

<span data-ttu-id="42c19-534">Нажмите кнопку ОК, чтобы закрыть `WizardStep` диалоговое окно редактора коллекции.</span><span class="sxs-lookup"><span data-stu-id="42c19-534">Click OK to close the `WizardStep` Collection Editor dialog.</span></span> <span data-ttu-id="42c19-535">Новый `WizardStep` свидетельствует обновленные декларативная разметка элемента управления CreateUserWizard:</span><span class="sxs-lookup"><span data-stu-id="42c19-535">The new `WizardStep` is evidenced by the CreateUserWizard control's updated declarative markup:</span></span>

[!code-aspx[Main](storing-additional-user-information-cs/samples/sample13.aspx)]

<span data-ttu-id="42c19-536">Обратите внимание на новое `<asp:WizardStep>` элемент.</span><span class="sxs-lookup"><span data-stu-id="42c19-536">Note the new `<asp:WizardStep>` element.</span></span> <span data-ttu-id="42c19-537">Нам нужно добавить пользовательский интерфейс для сбора родного города нового пользователя, домашней страницы и подпись здесь.</span><span class="sxs-lookup"><span data-stu-id="42c19-537">We need to add the user interface to collect the new user's home town, homepage, and signature here.</span></span> <span data-ttu-id="42c19-538">Это содержимое можно ввести в декларативном синтаксисе или с помощью конструктора.</span><span class="sxs-lookup"><span data-stu-id="42c19-538">You can enter this content in the declarative syntax or through the Designer.</span></span> <span data-ttu-id="42c19-539">Использование конструктора, выберите на шаге «Your параметры» из раскрывающегося списка в смарт-тег для см. шаг в конструкторе.</span><span class="sxs-lookup"><span data-stu-id="42c19-539">To use the Designer, select the "Your Settings" step from the drop-down list in the Smart Tag to see the step in the Designer.</span></span>

> [!NOTE]
> <span data-ttu-id="42c19-540">При выборе пошагово с раскрывающимся списком смарт-тега обновляется элемент управления CreateUserWizard [ `ActiveStepIndex` свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.activestepindex.aspx), который указывает индекс начального шага.</span><span class="sxs-lookup"><span data-stu-id="42c19-540">Selecting a step through the Smart Tag's drop-down list updates the CreateUserWizard control's [`ActiveStepIndex` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.activestepindex.aspx), which specifies the index of the starting step.</span></span> <span data-ttu-id="42c19-541">Таким образом, при использовании этого раскрывающегося списка, чтобы внести изменения в шаг «Your параметры» в конструкторе, не забудьте снова задайте для нее «Входа для создания новой учетной записи», чтобы этот шаг показан при первом посещении `EnhancedCreateUserWizard.aspx` страницы.</span><span class="sxs-lookup"><span data-stu-id="42c19-541">Therefore, if you use this drop-down list to edit the "Your Settings" step in the Designer, be sure to set it back to "Sign Up for Your New Account" so that this step is shown when users first visit the `EnhancedCreateUserWizard.aspx` page.</span></span>

<span data-ttu-id="42c19-542">Создание пользовательского интерфейса в пределах шага «Your параметры», который содержит три элемента управления TextBox с именем `HomeTown`, `HomepageUrl`, и `Signature`.</span><span class="sxs-lookup"><span data-stu-id="42c19-542">Create a user interface within the "Your Settings" step that contains three TextBox controls named `HomeTown`, `HomepageUrl`, and `Signature`.</span></span> <span data-ttu-id="42c19-543">После создания этот интерфейс, декларативная разметка CreateUserWizard должен выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="42c19-543">After constructing this interface, the CreateUserWizard's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](storing-additional-user-information-cs/samples/sample14.aspx)]

<span data-ttu-id="42c19-544">Продолжим и посетите эту страницу через обозреватель и создать новую учетную запись пользователя, указывая значения для домашних города, домашней страницы и подпись.</span><span class="sxs-lookup"><span data-stu-id="42c19-544">Go ahead and visit this page through a browser and create a new user account, specifying values for the home town, homepage, and signature.</span></span> <span data-ttu-id="42c19-545">После завершения `CreateUserWizardStep` учетная запись пользователя создается в структуру членства и `CreatedUser` выполняется обработчик события, которые добавляет новую строку к `UserProfiles`, но с базой данных `NULL` значение `HomeTown`, `HomepageUrl`, и `Signature`.</span><span class="sxs-lookup"><span data-stu-id="42c19-545">After completing the `CreateUserWizardStep` the user account is created in the Membership framework and the `CreatedUser` event handler runs, which adds a new row to `UserProfiles`, but with a database `NULL` value for `HomeTown`, `HomepageUrl`, and `Signature`.</span></span> <span data-ttu-id="42c19-546">Значения, введенные для домашних города, домашней страницы и подпись никогда не используются.</span><span class="sxs-lookup"><span data-stu-id="42c19-546">The values entered for the home town, homepage, and signature are never used.</span></span> <span data-ttu-id="42c19-547">Конечным результатом является новой учетной записи пользователя с `UserProfiles` записи которого `HomeTown`, `HomepageUrl`, и `Signature` поля еще должно быть задано.</span><span class="sxs-lookup"><span data-stu-id="42c19-547">The net result is a new user account with a `UserProfiles` record whose `HomeTown`, `HomepageUrl`, and `Signature` fields have yet to be specified.</span></span>

<span data-ttu-id="42c19-548">Мы должны выполнять код после шага «Your параметры», которая принимает домашней города, honepage и подпись значений, введенных пользователем и обновляет соответствующий `UserProfiles` записи.</span><span class="sxs-lookup"><span data-stu-id="42c19-548">We need to execute code after the "Your Settings" step that takes the home town, honepage, and signature values entered by the user and updates the appropriate `UserProfiles` record.</span></span> <span data-ttu-id="42c19-549">Каждый раз при перемещении между шагами в мастере элементов управления, мастер [ `ActiveStepChanged` событий](https://msdn.microsoft.com/library/system.web.ui.webcontrols.wizard.activestepchanged.aspx) активируется.</span><span class="sxs-lookup"><span data-stu-id="42c19-549">Each time the user moves between steps in a Wizard control, the Wizard's [`ActiveStepChanged` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.wizard.activestepchanged.aspx) fires.</span></span> <span data-ttu-id="42c19-550">Можно создать обработчик событий для этого события и обновления `UserProfiles` таблицы по завершении шага «Your параметры».</span><span class="sxs-lookup"><span data-stu-id="42c19-550">We can create an event handler for this event and update the `UserProfiles` table when the "Your Settings" step has completed.</span></span>

<span data-ttu-id="42c19-551">Добавьте обработчик событий для CreateUserWizard `ActiveStepChanged` событий и добавьте следующий код:</span><span class="sxs-lookup"><span data-stu-id="42c19-551">Add an event handler for the CreateUserWizard's `ActiveStepChanged` event and add the following code:</span></span>

[!code-csharp[Main](storing-additional-user-information-cs/samples/sample15.cs)]

<span data-ttu-id="42c19-552">Приведенный выше код начинается с определения, если только что вышедшей шаг «Завершить».</span><span class="sxs-lookup"><span data-stu-id="42c19-552">The above code starts by determining if we have just reached the "Complete" step.</span></span> <span data-ttu-id="42c19-553">Так как на шаге «Complete» происходит сразу после шага «Your параметры», когда достигает посетитель «Complete» пошагово, означает, что она только что завершили шаг «Your параметры».</span><span class="sxs-lookup"><span data-stu-id="42c19-553">Since the "Complete" step occurs immediately after the "Your Settings" step, then when the visitor reaches "Complete" step that means she just finished the "Your Settings" step.</span></span>

<span data-ttu-id="42c19-554">В этом случае нам нужно программно сослаться на элементы управления TextBox внутри `UserSettings WizardStep`.</span><span class="sxs-lookup"><span data-stu-id="42c19-554">In such a case, we need to programmatically reference the TextBox controls within the `UserSettings WizardStep`.</span></span> <span data-ttu-id="42c19-555">Это достигается с помощью первого `FindControl` способ программного обращения `UserSettings WizardStep`, а затем еще раз, чтобы ссылаться на текстовых полей внутри `WizardStep`.</span><span class="sxs-lookup"><span data-stu-id="42c19-555">This is accomplished by first using the `FindControl` method to programmatically referencing the `UserSettings WizardStep`, and then again to reference the TextBoxes from within the `WizardStep`.</span></span> <span data-ttu-id="42c19-556">После содержатся ссылки на текстовых полей, мы готовы выполнить `UPDATE` инструкции.</span><span class="sxs-lookup"><span data-stu-id="42c19-556">Once the TextBoxes have been referenced, we're ready to execute the `UPDATE` statement.</span></span> <span data-ttu-id="42c19-557">`UPDATE` Инструкция имеет одинаковое количество параметров, которое `INSERT` инструкции в `CreatedUser` обработчик событий, но здесь мы используем домашней города, домашней страницы и подпись значения, предоставленные пользователем.</span><span class="sxs-lookup"><span data-stu-id="42c19-557">The `UPDATE` statement has the same number of parameters as the `INSERT` statement in the `CreatedUser` event handler, but here we use the home town, homepage, and signature values supplied by the user.</span></span>

<span data-ttu-id="42c19-558">С помощью этого обработчика событий в месте, посетите `EnhancedCreateUserWizard.aspx` странице через браузер и создайте учетную запись пользователя, указывая значения для домашних города, домашней страницы и подпись.</span><span class="sxs-lookup"><span data-stu-id="42c19-558">With this event handler in place, visit the `EnhancedCreateUserWizard.aspx` page through a browser and create a new user account specifying values for the home town, homepage, and signature.</span></span> <span data-ttu-id="42c19-559">После создания новой учетной записи вы должны быть перенаправлены к `AdditionalUserInfo.aspx` страницы, где только что введенный домашней города, домашней страницы и подпись информация отображается.</span><span class="sxs-lookup"><span data-stu-id="42c19-559">After creating the new account you should be redirected to the `AdditionalUserInfo.aspx` page, where the just-entered home town, homepage, and signature information is displayed.</span></span>

> [!NOTE]
> <span data-ttu-id="42c19-560">Наш веб-сайт в настоящее время имеет две страницы, из которых посетитель может создать новую учетную запись: `CreatingUserAccounts.aspx` и `EnhancedCreateUserWizard.aspx`.</span><span class="sxs-lookup"><span data-stu-id="42c19-560">Our website currently has two pages from which a visitor can create a new account: `CreatingUserAccounts.aspx` and `EnhancedCreateUserWizard.aspx`.</span></span> <span data-ttu-id="42c19-561">Sitemap веб сайта и страницу входа точка `CreatingUserAccounts.aspx` страницы, но `CreatingUserAccounts.aspx` страницы не запрашивает пользователя его домашней города, домашней страницы и подпись данные и не добавляет соответствующую строку в `UserProfiles`.</span><span class="sxs-lookup"><span data-stu-id="42c19-561">The website's sitemap and login page point to the `CreatingUserAccounts.aspx` page, but the `CreatingUserAccounts.aspx` page does not prompt the user for their home town, homepage, and signature information and does not add a corresponding row to `UserProfiles`.</span></span> <span data-ttu-id="42c19-562">Таким образом, либо обновить `CreatingUserAccounts.aspx` странице таким образом, чтобы он обеспечивает эти функциональные возможности или обновить страницу sitemap и войдите в систему, чтобы ссылаться на `EnhancedCreateUserWizard.aspx` вместо `CreatingUserAccounts.aspx`.</span><span class="sxs-lookup"><span data-stu-id="42c19-562">Therefore, either update the `CreatingUserAccounts.aspx` page so that it offers this functionality or update the sitemap and login page to reference `EnhancedCreateUserWizard.aspx` instead of `CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="42c19-563">Если вы выберите второй вариант, не забудьте обновить `Membership` папки `Web.config` файл так, чтобы разрешить анонимным пользователям доступ к `EnhancedCreateUserWizard.aspx` страницы.</span><span class="sxs-lookup"><span data-stu-id="42c19-563">If you choose the latter option, be sure to update the `Membership` folder's `Web.config` file so as to allow anonymous users access to the `EnhancedCreateUserWizard.aspx` page.</span></span>

## <a name="summary"></a><span data-ttu-id="42c19-564">Сводка</span><span class="sxs-lookup"><span data-stu-id="42c19-564">Summary</span></span>

<span data-ttu-id="42c19-565">В этом учебнике мы рассмотрели методы для моделирования данных, который связан с учетных записей пользователей в платформу членства.</span><span class="sxs-lookup"><span data-stu-id="42c19-565">In this tutorial we looked at techniques for modeling data that is related to user accounts within the Membership framework.</span></span> <span data-ttu-id="42c19-566">В частности мы рассмотрели моделирования сущностей, которые совместно используют один ко многим связь с учетных записей пользователей, а также данных, совместно использующих взаимно-однозначной связи.</span><span class="sxs-lookup"><span data-stu-id="42c19-566">In particular, we looked at modeling entities that share a one-to-many relationship with user accounts as well as data that shares a one-to-one relationship.</span></span> <span data-ttu-id="42c19-567">Кроме того, мы узнали, как это связанные сведения может отобразить, вставке и обновляется несколько примеров, с помощью элемента управления SqlDataSource и другим пользователям с помощью кода ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="42c19-567">Furthermore, we saw how this related information could be displayed, inserted, and updated, with some examples using the SqlDataSource control and others using ADO.NET code.</span></span>

<span data-ttu-id="42c19-568">Этот учебник завершает наш взгляд на учетные записи пользователей.</span><span class="sxs-lookup"><span data-stu-id="42c19-568">This tutorial completes our look at user accounts.</span></span> <span data-ttu-id="42c19-569">Начиная с следующем учебном курсе мы будет обратим наше внимание на роли.</span><span class="sxs-lookup"><span data-stu-id="42c19-569">Starting with the next tutorial we will turn our attention to roles.</span></span> <span data-ttu-id="42c19-570">Следующие несколько учебников, мы рассмотрим framework ролей, см. в разделе Создание новых ролей, как назначать роли пользователям, чтобы определить, какие роли принадлежит пользователь, а также применять проверку подлинности на основе ролей.</span><span class="sxs-lookup"><span data-stu-id="42c19-570">Over the next several tutorials we will look at the Roles framework, see how to create new roles, how to assign roles to users, how to determine what roles a user belongs to, and how to apply role-based authorization.</span></span>

<span data-ttu-id="42c19-571">Счастливого вам программирования!</span><span class="sxs-lookup"><span data-stu-id="42c19-571">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="42c19-572">Дополнительные сведения</span><span class="sxs-lookup"><span data-stu-id="42c19-572">Further Reading</span></span>

<span data-ttu-id="42c19-573">Дополнительные сведения по темам, обсуждавшимся в этом руководстве см. в следующих ресурсах:</span><span class="sxs-lookup"><span data-stu-id="42c19-573">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="42c19-574">Просмотр и обновление данных в ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="42c19-574">Accessing and Updating Data in ASP.NET 2.0</span></span>](http://aspnet.4guysfromrolla.com/articles/011106-1.aspx)
- [<span data-ttu-id="42c19-575">Элемент управления ASP.NET 2.0 мастера</span><span class="sxs-lookup"><span data-stu-id="42c19-575">ASP.NET 2.0 Wizard Control</span></span>](https://weblogs.asp.net/scottgu/archive/2006/02/21/438732.aspx)
- [<span data-ttu-id="42c19-576">Создание пошаговые пользовательского интерфейса с помощью элемента управления ASP.NET 2.0 мастера</span><span class="sxs-lookup"><span data-stu-id="42c19-576">Creating a Step-by-Step User Interface with the ASP.NET 2.0 Wizard Control</span></span>](http://aspnet.4guysfromrolla.com/articles/061406-1.aspx)
- [<span data-ttu-id="42c19-577">Создание параметров пользовательского источника данных элемента управления</span><span class="sxs-lookup"><span data-stu-id="42c19-577">Creating Custom DataSource Control Parameters</span></span>](http://aspnet.4guysfromrolla.com/articles/110106-1.aspx)
- [<span data-ttu-id="42c19-578">Настройка элементов управления CreateUserWizard</span><span class="sxs-lookup"><span data-stu-id="42c19-578">Customizing the CreateUserWizard Control</span></span>](http://aspnet.4guysfromrolla.com/articles/070506-1.aspx)
- [<span data-ttu-id="42c19-579">Примеры использования элемента управления DetailsView</span><span class="sxs-lookup"><span data-stu-id="42c19-579">DetailsView Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/data/detailsview.aspx)
- [<span data-ttu-id="42c19-580">Отображение данных с помощью элемента управления ListView</span><span class="sxs-lookup"><span data-stu-id="42c19-580">Displaying Data with the ListView Control</span></span>](http://aspnet.4guysfromrolla.com/articles/122607-1.aspx)
- [<span data-ttu-id="42c19-581">Разбор элементов управления проверки в ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="42c19-581">Dissecting the Validation Controls in ASP.NET 2.0</span></span>](http://aspnet.4guysfromrolla.com/articles/112305-1.aspx)
- [<span data-ttu-id="42c19-582">Редактирование, вставка и удаление данных</span><span class="sxs-lookup"><span data-stu-id="42c19-582">Editing Insert and Deleting Data</span></span>](../../data-access/editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md)
- [<span data-ttu-id="42c19-583">Проверка форм в ASP.NET</span><span class="sxs-lookup"><span data-stu-id="42c19-583">Form Validation in ASP.NET</span></span>](http://www.4guysfromrolla.com/webtech/090200-1.shtml)
- [<span data-ttu-id="42c19-584">Сбор сведений о регистрации пользовательских</span><span class="sxs-lookup"><span data-stu-id="42c19-584">Gathering Custom User Registration Information</span></span>](https://weblogs.asp.net/scottgu/archive/2006/07/05/Tip_2F00_Trick_3A00_-Gathering-Custom-User-Registration-Information.aspx)
- [<span data-ttu-id="42c19-585">Профили в ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="42c19-585">Profiles in ASP.NET 2.0</span></span>](http://www.odetocode.com/Articles/440.aspx)
- [<span data-ttu-id="42c19-586">Элемент управления asp: ListView</span><span class="sxs-lookup"><span data-stu-id="42c19-586">The asp:ListView Control</span></span>](https://weblogs.asp.net/scottgu/archive/2007/08/10/the-asp-listview-control-part-1-building-a-product-listing-page-with-clean-css-ui.aspx)
- [<span data-ttu-id="42c19-587">Примеры использования профилей пользователя</span><span class="sxs-lookup"><span data-stu-id="42c19-587">User Profiles QuickStart</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/profile/default.aspx)

### <a name="about-the-author"></a><span data-ttu-id="42c19-588">Об авторе</span><span class="sxs-lookup"><span data-stu-id="42c19-588">About the Author</span></span>

<span data-ttu-id="42c19-589">Скотт Митчелл, автор нескольких книг по ASP/ASP.NET и основатель веб-узла 4GuysFromRolla.com, работает с веб-технологиями Microsoft с 1998 года.</span><span class="sxs-lookup"><span data-stu-id="42c19-589">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="42c19-590">Скотт — независимый консультант, преподаватель и автор.</span><span class="sxs-lookup"><span data-stu-id="42c19-590">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="42c19-591">Его последняя книга —  *[Sams Teach ASP.NET 2.0 in 24 часа](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span><span class="sxs-lookup"><span data-stu-id="42c19-591">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="42c19-592">Скоттом можно связаться по адресу [ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com) или через его блог по адресу [ http://ScottOnWriting.NET ](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="42c19-592">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="42c19-593">Особая благодарность</span><span class="sxs-lookup"><span data-stu-id="42c19-593">Special Thanks To…</span></span>

<span data-ttu-id="42c19-594">В этой серии руководств пособий рецензировалась многими компетентными редакторами.</span><span class="sxs-lookup"><span data-stu-id="42c19-594">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="42c19-595">Хотите поработать с моих последующих статей для MSDN?</span><span class="sxs-lookup"><span data-stu-id="42c19-595">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="42c19-596">Если Да, напишите мне [ mitchell@4GuysFromRolla.com ](mailto:mitchell@4GuysFromRolla.com).</span><span class="sxs-lookup"><span data-stu-id="42c19-596">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="42c19-597">[Назад](user-based-authorization-cs.md)
> [Вперед](creating-the-membership-schema-in-sql-server-vb.md)</span><span class="sxs-lookup"><span data-stu-id="42c19-597">[Previous](user-based-authorization-cs.md)
[Next](creating-the-membership-schema-in-sql-server-vb.md)</span></span>
