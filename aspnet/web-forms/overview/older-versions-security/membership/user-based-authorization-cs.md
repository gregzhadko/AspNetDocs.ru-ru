---
uid: web-forms/overview/older-versions-security/membership/user-based-authorization-cs
title: Авторизации на основе пользователей (C#) | Документация Майкрософт
author: rick-anderson
description: В этом руководстве мы рассмотрим ограничение доступа к страницам и ограничивая функциональные возможности уровня страницы с помощью разных методов.
ms.author: riande
ms.date: 01/18/2008
ms.assetid: 3c815a9e-2296-4b9b-b945-776d54989daa
msc.legacyurl: /web-forms/overview/older-versions-security/membership/user-based-authorization-cs
msc.type: authoredcontent
ms.openlocfilehash: f596a4a9ae92e567a5ac98db26584d4575931a60
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/09/2019
ms.locfileid: "59382110"
---
# <a name="user-based-authorization-c"></a>Авторизация на основе пользователей (C#)

по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Скачать код](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_07_CS.zip) или [скачать PDF](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial07_UserAuth_cs.pdf)

> В этом руководстве мы рассмотрим ограничение доступа к страницам и ограничивая функциональные возможности уровня страницы с помощью разных методов.


## <a name="introduction"></a>Вступление

Большинство веб-приложений, которые содержат учетные записи пользователей сделать это в части для ограничения определенных посетителям доступ к некоторым страницам на сайте. В наиболее online messageboard сайтов например, все пользователи — анонимные и проверкой подлинности — доступны для просмотра записей messageboard, но только авторизованные пользователи могут посетить веб-страницы для создания новой записи. Также может возникнуть административным страницам, которые доступны только для определенного пользователя (или определенного набора пользователей). Кроме того функциональные возможности уровня страницы могут различаться на основе пользователя по. При просмотре списка записей, прошедших проверку подлинности пользователей отображаются интерфейс для оценки каждой отправки, в то время как этот интерфейс доступен не для анонимных пользователей.

ASP.NET позволяет легко определить правила авторизации на основе пользователя. Совсем немного разметки в `Web.config`, определенные веб-страницы или весь каталог может быть зафиксирован, чтобы они доступны только определенному подмножеству пользователей. Функциональные возможности уровня страницы можно включить или отключить зависимости от пользователя, выполнившего вход через программной и декларативной средства.

В этом руководстве мы рассмотрим ограничение доступа к страницам и ограничивая функциональные возможности уровня страницы с помощью разных методов. Давайте начнем!

## <a name="a-look-at-the-url-authorization-workflow"></a>Рассмотрим рабочий процесс авторизации URL-адрес

Как уже говорилось в [ *Обзор аутентификации форм* ](../introduction/an-overview-of-forms-authentication-cs.md) руководстве описано, когда среда выполнения ASP.NET обрабатывает запрос для запроса ресурса ASP.NET вызывает ряд событий во время его жизненного цикла. *HTTP-модули* — управляемые классы, код которого выполняется в ответ на определенное событие в жизненном цикле запроса. В ASP.NET имеется ряд модулей HTTP, выполнения важных задач за кулисами.

Является одним из таких модулей HTTP [ `FormsAuthenticationModule` ](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx). Как уже говорилось в предыдущих учебных курсах, основная функция `FormsAuthenticationModule` определяет удостоверение текущего запроса. Это достигается путем проверки билета проверки подлинности, который либо находится в файле cookie, либо внедрен в URL-адрес. Этот код выполняется во время [ `AuthenticateRequest` событий](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx).

Еще один модуль HTTP для важных [ `UrlAuthorizationModule` ](https://msdn.microsoft.com/library/system.web.security.urlauthorizationmodule.aspx), который вызывается в ответ на [ `AuthorizeRequest` событий](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx) (что происходит после `AuthenticateRequest` событий). `UrlAuthorizationModule` Проверяет разметку настройки в `Web.config` для определения, имеет ли удостоверение текущего центра, чтобы перейти на указанную страницу. Этот процесс называется *Авторизация URL-адреса*.

Будет рассмотрен синтаксис для правила авторизации URL-адреса на шаге 1, но сначала давайте рассмотрим `UrlAuthorizationModule` в зависимости от того, авторизован ли запрос или нет. Если `UrlAuthorizationModule` определяет, что запрос авторизуется, то он не выполняет никаких действий и запроса продолжается в течение его жизненного цикла. Тем не менее если запрос является *не* авторизован, то `UrlAuthorizationModule` прерывает жизненный цикл и указывает, что `Response` возвращаемого объекта [HTTP 401 несанкционированный](http://www.checkupdown.com/status/E401.html) состояния. При использовании проверки подлинности форм это состояние HTTP 401 никогда не возвращается клиенту, поскольку если `FormsAuthenticationModule` обнаруживает HTTP 401, находится в состоянии изменяет его, чтобы [перенаправления HTTP 302](http://www.checkupdown.com/status/E302.html) на страницу входа.

Рис. 1 показан рабочий процесс конвейера ASP.NET, `FormsAuthenticationModule`и `UrlAuthorizationModule` прибытии неавторизованный запрос. В частности, на рис. 1 показан запрос для анонимных посетителем `ProtectedPage.aspx`, который является страницей, которое запрещает доступ анонимным пользователям. Так как пользователь является анонимным, `UrlAuthorizationModule` прерывает запрос и возвращает состояние HTTP 401 несанкционированный. `FormsAuthenticationModule` Затем преобразует состояния 401 на 302 — перенаправление на страницу входа. После проверки подлинности пользователя через страницу входа, он перенаправляется `ProtectedPage.aspx`. Это время `FormsAuthenticationModule` идентифицирует пользователя, в зависимости от его билет проверки подлинности. Теперь, когда пользователь проходит проверку подлинности, `UrlAuthorizationModule` разрешает доступ к странице.


[![Tон проверки подлинности форм и рабочий процесс авторизации URL-адрес](user-based-authorization-cs/_static/image2.png)](user-based-authorization-cs/_static/image1.png)

**Рис. 1**: Проверка подлинности форм и рабочий процесс авторизации URL-адрес ([Просмотр полноразмерного изображения](user-based-authorization-cs/_static/image3.png))


Рис. 1 изображена взаимодействие, которое возникает при попытке посетитель анонимный доступ к ресурсу, который недоступен для анонимных пользователей. В таком случае анонимный пользователь перенаправляется на страницу входа с помощью страницы, на которую она пытается посетить указанный в строке запроса. Как только пользователь успешно вошел в систему, она автоматически перейдете обратно на ресурс, который она изначально попытке просмотра.

Неавторизованный запрос, сделанные анонимного пользователя, этот рабочий процесс выполняется просто и легко для посетителя понять, что произошло и почему. Но имейте в виду, что `FormsAuthenticationModule` перенаправит *любой* несанкционированный пользователя на страницу входа, даже если запрос выполняется пользователем, прошедшим проверку. Это может привести к путанице при использовании, если прошедший проверку пользователь пытается посетить страницу, для которого она не имеет полномочия.

Представьте, что наш веб-сайт было его правила авторизации URL-адрес, настроенные таким образом, чтобы страницы ASP.NET `OnlyTito.aspx` было accessibly только Tito. Теперь представим, что Сэм посещает сайт, входе в систему, а затем пытается посетить `OnlyTito.aspx`. `UrlAuthorizationModule` Halt жизненного цикла запроса и будут возвращены статус HTTP 401 несанкционированный которого `FormsAuthenticationModule` обнаружит и затем перенаправить Sam на страницу входа. Так как уже зарегистрировал Sam, однако она может возникнуть вопрос, почему она был отправлен обратно на страницу входа. Она может причин, что ее учетные данные для входа были потеряны каким-либо образом или что она введены недопустимые учетные данные. Если Sam повторно вводит свои учетные данные со страницы входа она будет войти в систему (повторно) и перенаправляется `OnlyTito.aspx`. `UrlAuthorizationModule` Обнаруживает, что Sam не может посетить эту страницу, и она будет возвращаться на страницу входа.

Рис. 2 показан этот рабочий процесс в заблуждение.


[![Tон по умолчанию рабочий процесс может привести к цикл толку](user-based-authorization-cs/_static/image5.png)](user-based-authorization-cs/_static/image4.png)

**Рис. 2**: По умолчанию рабочий процесс может привести к цикл толку ([Просмотр полноразмерного изображения](user-based-authorization-cs/_static/image6.png))


Рабочий процесс показан на рис. 2 можно быстро befuddle даже большинство компьютера грамотный посетителя. Мы рассмотрим способы предотвращения этого толку цикла на шаге 2.

> [!NOTE]
> ASP.NET использует два механизма для определения ли текущий пользователь может получить доступ к определенной веб-страницы: Авторизация URL-адреса и авторизация файлов. Авторизация файлов реализуется [ `FileAuthorizationModule` ](https://msdn.microsoft.com/library/system.web.security.fileauthorizationmodule.aspx), определяющий центр по журналу запрошенного файлы списки управления доступом. Авторизация файлов чаще всего используется с проверкой подлинности Windows, так как списки управления доступом, разрешения, которые применяются к учетным записям Windows. При использовании проверки подлинности форм, системного уровня операционной системы и файл все запросы выполняются с той же учетной записи Windows, независимо от того, пользователь, посещения веб-узла. Так как в этой серии руководств акцент сделан на проверку подлинности форм, мы не рассмотрим файл авторизации.


### <a name="the-scope-of-url-authorization"></a>Область авторизации URL-адрес

`UrlAuthorizationModule` — Управляемый код, который является частью среды выполнения ASP.NET. До выхода версии 7 компании Microsoft [Internet Information Services (IIS)](https://www.iis.net/) веб-сервере произошла distinct барьера между конвейер HTTP в IIS и среда выполнения ASP.NET конвейера. Иными словами, в IIS 6 и более ранних версиях ASP. NET `UrlAuthorizationModule` выполняется, только если запрос делегируется среды выполнения ASP.NET с IIS. По умолчанию IIS обрабатывает статического содержимого, — например страниц HTML и CSS, JavaScript и файлы изображений — и только передает запросы в среду выполнения ASP.NET, когда страница с расширением `.aspx`, `.asmx`, или `.ashx` запрашивается.

IIS 7, однако позволяет для интеграции IIS и ASP.NET конвейеров. Некоторые параметры конфигурации можно настроить IIS 7 для вызова `UrlAuthorizationModule` для *все* запросов, это означает, что можно определить правила авторизации URL-адрес для файлов любого типа. Кроме того IIS 7 включает в себя механизмом авторизации URL-адрес. Дополнительные сведения об интеграции ASP.NET и IIS 7 собственные функции авторизации URL-адрес, см. в разделе [Авторизация URL-адреса IIS7 понимание](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/URL-Authorization/Understanding-IIS7-URL-Authorization). Для более подробно рассмотрим интеграции ASP.NET и IIS 7 взять копию книги Shahram Khosravi *Professional IIS 7 и ASP.NET интегрированной Programming* (ISBN: 978-0470152539).

По сути в версиях, предшествующих IIS 7, правила авторизации URL-адреса применяются только к ресурсам, которые обрабатываются средой выполнения ASP.NET. Но со службами IIS 7 можно использовать на собственный URL-адрес авторизации службы IIS или интегрировать ASP. NET `UrlAuthorizationModule` в конвейер HTTP в IIS, тем самым расширяя эта функция ко всем запросам.

> [!NOTE]
> Есть некоторые небольшие, но важных различия в том, как ASP. NET `UrlAuthorizationModule` и IIS 7 URL-адрес авторизации обрабатывать правила авторизации. Этот учебник не проверяет функциональность авторизации URL-адреса IIS 7 или различия в анализе правила авторизации, по сравнению с `UrlAuthorizationModule`. Дополнительные сведения об этих темах см. в документации IIS 7 на MSDN или в [www.iis.net](https://www.iis.net/).


## <a name="step-1-defining-url-authorization-rules-inwebconfig"></a>Шаг 1. Определение правил авторизации URL-адрес в`Web.config`

`UrlAuthorizationModule` Определяет, следует ли предоставить или запретить доступ к ресурсу для конкретное удостоверение на основе правил авторизации URL-адреса, определенные в конфигурации приложения. Правила авторизации выраженная в [ `<authorization>` элемент](https://msdn.microsoft.com/library/8d82143t.aspx) в виде `<allow>` и `<deny>` дочерних элементов. Каждый `<allow>` и `<deny>` можно указать дочерний элемент:

- Конкретного пользователя
- Разделенный запятыми список пользователей
- Все анонимные пользователи, обозначенное с помощью знак вопроса (?)
- Все пользователи, обозначенное с помощью звездочки (\*)

Следующую разметку показаны способы использования правил авторизации URL-адрес, чтобы разрешить пользователям Tito и Скотт и запретить все остальные.

[!code-xml[Main](user-based-authorization-cs/samples/sample1.xml)]

`<allow>` Элемент определяет, какие пользователи могут - Tito и Скотт - хотя `<deny>` указывает элемент, который *все* пользователям запрещен.

> [!NOTE]
> `<allow>` И `<deny>` элементы также можно указать правила авторизации для ролей. Мы рассмотрим авторизации на основе ролей в следующем учебном курсе.


Следующий параметр предоставляет доступ для всех, кроме Sam (включая анонимным посетителям):

[!code-xml[Main](user-based-authorization-cs/samples/sample2.xml)]

Чтобы разрешить только пользователям, прошедшим проверку подлинности, используйте следующую конфигурацию, которое запрещает доступ для всех анонимных пользователей:

[!code-xml[Main](user-based-authorization-cs/samples/sample3.xml)]

Правила авторизации определяются в `<system.web>` элемент в `Web.config` и применяются ко всем ресурсам ASP.NET в веб-приложения. Очень часто приложение имеет различные правила авторизации в разных разделах. Например на сайте электронной коммерции, все посетители могут высматривать продукты, см. в разделе обзоров продуктов, поиск в каталоге и так далее. Тем не менее только пользователи, прошедшие проверку подлинности может достигать извлечение или оно страниц для управления истории доставки единицы. Кроме того может быть частями узла, доступными только выберите пользователей, например Администраторы веб-сайтов.

ASP.NET позволяет легко определить различные правила авторизации для разных файлов и папок на сайте. Правила авторизации, указанный в корневой папке `Web.config` файла применяются ко всем ресурсам ASP.NET на сайте. Тем не менее, эти параметры авторизации по умолчанию могут переопределяться для конкретной папки, добавив `Web.config` с `<authorization>` раздел.

Давайте обновим наш веб-сайт, чтобы только прошедшие проверку подлинности пользователи смогут посещать страницы ASP.NET в `Membership` папку. Для этого нам нужно добавить `Web.config` файл `Membership` папки и задать его параметры авторизации, чтобы запретить анонимным пользователям. Щелкните правой кнопкой мыши `Membership` папку в обозревателе решений, выберите меню «Добавление нового элемента» в контекстном меню и добавьте новый файл веб-конфигурации с именем `Web.config`.


[![Aдд файл Web.config в папку членства](user-based-authorization-cs/_static/image8.png)](user-based-authorization-cs/_static/image7.png)

**Рис. 3**: Добавить `Web.config` файл `Membership` папку ([Просмотр полноразмерного изображения](user-based-authorization-cs/_static/image9.png))


На этом этапе проект должен содержать два `Web.config` файлов: один в корневом каталоге, а другой в `Membership` папку.


[![Yнаше приложение теперь должно содержать два файла Web.config](user-based-authorization-cs/_static/image11.png)](user-based-authorization-cs/_static/image10.png)

**Рис. 4**: Ваши приложения должны теперь содержат два `Web.config` файлов ([Просмотр полноразмерного изображения](user-based-authorization-cs/_static/image12.png))


Обновите файл конфигурации в `Membership` папку, так что он запрещает доступ анонимным пользователям.

[!code-xml[Main](user-based-authorization-cs/samples/sample4.xml)]

Вот и все!

Чтобы протестировать это изменение, посетите домашнюю страницу в браузере и убедитесь, что вы вошли. Так как приложение ASP.NET по умолчанию — разрешить все посетители, а так как мы не вносить изменения авторизации в корневом каталоге `Web.config` файла, мы открываться файлы в корневом каталоге как посетитель анонимный.

Щелкните ссылку создания учетных записей пользователей, в левом столбце. Это требуется для `~/Membership/CreatingUserAccounts.aspx`. Так как `Web.config` файл `Membership` папка определяет правила авторизации, чтобы запретить анонимный доступ, `UrlAuthorizationModule` прерывает запрос и возвращает состояние HTTP 401 несанкционированный. `FormsAuthenticationModule` Изменяет это 302 состояния перенаправления, отправив нам на страницу входа. Обратите внимание на то, что страницы мы предпринималась попытка получить доступ к (`CreatingUserAccounts.aspx`) передается на страницу входа с помощью `ReturnUrl` параметр строки запроса.


[![Sинс URL-адрес авторизации правила запрещают анонимный доступ, мы перенаправляются на страницу входа](user-based-authorization-cs/_static/image14.png)](user-based-authorization-cs/_static/image13.png)

**Рис. 5**: Так как URL-адрес авторизации правила запрещают анонимный доступ, мы перенаправляются на страницу входа ([Просмотр полноразмерного изображения](user-based-authorization-cs/_static/image15.png))


После завершения входа в систему, то будут перенаправлены в `CreatingUserAccounts.aspx` страницы. Это время `UrlAuthorizationModule` разрешает доступ к странице, так как мы больше не являются анонимными.

### <a name="applying-url-authorization-rules-to-a-specific-location"></a>Применение правил авторизации URL-адрес в определенном местоположении

Параметры авторизации, определенные в `<system.web>` раздел `Web.config` применяются ко всем ресурсам в этом каталоге и его подкаталогах ASP.NET (до переопределений на другое `Web.config` файла). В некоторых случаях, мы может понадобиться все ресурсы ASP.NET в указанном каталоге для конкретной конфигурации авторизации за исключением одного или двух определенных страниц. Это можно сделать, добавив `<location>` элемент `Web.config`, его на файл, с которых правила авторизации, отличаются и определения его правила авторизации, уникальный в этой последовательности.

Чтобы проиллюстрировать использование `<location>` элемент, чтобы переопределить параметры конфигурации для определенного ресурса, давайте настроим параметры авторизации, чтобы только Tito можно посетить `CreatingUserAccounts.aspx`. Для этого добавьте `<location>` элемент `Membership` папки `Web.config` файла и обновить свою разметку, чтобы он выглядел следующим образом:

[!code-xml[Main](user-based-authorization-cs/samples/sample5.xml)]

`<authorization>` Элемент в `<system.web>` определяет правила авторизации URL-адрес по умолчанию для ресурсов ASP.NET в `Membership` папках и подпапках. `<location>` Элемент позволяет переопределить эти правила для конкретного ресурса. В разметке выше `<location>` ссылок на элементы `CreatingUserAccounts.aspx` странице и указывает его авторизации правила, например, разрешить Tito, но запретить его всем остальным.

Чтобы протестировать это изменение авторизации, сначала посетить веб-сайт как анонимный пользователь. Если вы попытаетесь перейти к любой странице `Membership` папки, такие как `UserBasedAuthorization.aspx`, `UrlAuthorizationModule` должны отклоняться и вы будете перенаправлены на страницу входа. После входа в систему как, скажем, Скотт, вы можете посетить любой страницы `Membership` папку *за исключением* для `CreatingUserAccounts.aspx`. При попытке посетить `CreatingUserAccounts.aspx` войти в систему как любой пользователь, но Tito приведет к попытке несанкционированного доступа, перенаправление на страницу входа.

> [!NOTE]
> `<location>` Элемент должен находиться за пределами конфигурации `<system.web>` элемент. Необходимо использовать отдельный `<location>` элемент для каждого ресурса, параметры авторизации которого требуется переопределить.


### <a name="a-look-at-how-theurlauthorizationmoduleuses-the-authorization-rules-to-grant-or-deny-access"></a>Рассмотрим как`UrlAuthorizationModule`использует правила авторизации, чтобы предоставить или запретить доступ

`UrlAuthorizationModule` Определяет, является ли авторизовать конкретное удостоверение для определенного URL-адреса путем анализа авторизации URL-адрес правила по одному, начиная с первого и продолжает по направлению. Как только соответствие найдено, пользователь будет разрешен или запрещен доступ, в зависимости от того, если соответствие найдено в `<allow>` или `<deny>` элемент. <strong>Если совпадений не найдено, пользователю предоставляется доступ.</strong> Следовательно, если вы хотите ограничить доступ, важно использовать `<deny>` элемент как последний элемент в конфигурации авторизации URL-адрес. <strong>Если опустить</strong><strong>`<deny>`</strong><strong>элемент, всем пользователям будет предоставлен доступ.</strong>

Чтобы лучше понять процесс, при котором `UrlAuthorizationModule` для определения центра, рассмотрим пример правила авторизации URL-адрес, мы рассмотрели ранее на этом шаге. Первое правило заключается в `<allow>` элемент, который разрешает доступ к Tito и Скотт. Второй правила имеет `<deny>` элемент, который запрещает доступ всем пользователям. Если анонимный пользователь посещает, `UrlAuthorizationModule` начинается с запросом, является анонимным Скотт или Tito? Ответ, очевидно, что — нет, поэтому он переходит к второе правило. Является анонимным, вошедших в набор всех пользователей? Так как ответ вот Да, `<deny>` правило помещается в силе и пользователь перенаправляется на страницу входа. Аналогичным образом, если Цзисунь посещает, `UrlAuthorizationModule` начинается с запросом, является Цзисунь Скотт или Tito? Так как она не, `UrlAuthorizationModule` переходит на второй вопрос — Цзисунь вошедших в набор всех пользователей? Она является, поэтому ему, кроме того, запрещается доступ. Наконец, если посещает Tito, первый вопрос, исходящих от `UrlAuthorizationModule` будет получен утвердительный ответ, поэтому Tito предоставляется доступ.

Так как `UrlAuthorizationModule` процессы, правила авторизации сверху вниз, остановка в любые совпадения, важно иметь более конкретные правила располагаются перед менее конкретными. Т. е для определения правил авторизации, запрещать Цзисунь и анонимных пользователей, но все остальные пользователи прошедшего проверку подлинности, будет начинаться с - один Цзисунь повлиять на работу — самое подходящее правило и перейдите к менее конкретные правила — те, что все остальные Прошедшие проверку, но Запрет всех анонимных пользователей. Следующие правила авторизации URL-адрес реализует эту политику, сначала отказа Цзисунь и затем отзывать их по любому анонимному пользователю. Все прошедшие проверку подлинности пользователя, отличного от Цзисунь будет предоставлен доступ так как ни одно из этих `<deny>` будет соответствовать инструкций.

[!code-xml[Main](user-based-authorization-cs/samples/sample6.xml)]

## <a name="step-2-fixing-the-workflow-for-unauthorized-authenticated-users"></a>Шаг 2. Исправление рабочего процесса для несанкционированного, прошедшего проверку подлинности пользователей

Как уже говорилось ранее в этом учебнике в ищите в разделе рабочий процесс авторизации URL-адрес, в любое время процесс неавторизованный запрос, `UrlAuthorizationModule` прерывает запрос и возвращает состояние HTTP 401 несанкционированный. Изменяется после этого состояния 401 `FormsAuthenticationModule` в 302 перенаправления состояние, которое направляет пользователя на страницу входа. Этот рабочий процесс происходит на любой неавторизованный запрос, даже если пользователь прошел проверку подлинности.

Возврат на страницу входа пользователя, прошедшего проверку, скорее всего путайте их, так как они уже вошедшие в систему. С помощью небольшой работы мы можем улучшить этот рабочий процесс, перенаправляя прошедшего проверку подлинности пользователей, устанавливающих неавторизованные запросы к странице, объясняющее, что они пытались получить доступ к странице с ограниченным доступом.

Начнем с создания новой страницы ASP.NET в веб-приложения в корневую папку с именем `UnauthorizedAccess.aspx`; не забудьте связать эту страницу с помощью `Site.master` главной страницы. После создания этой страницы, удалите элемент управления содержимым, который ссылается на `LoginContent` ContentPlaceHolder таким образом, чтобы стандартная содержимого главной страницы будет отображаться. Добавьте сообщение, поясняющее ситуации, а именно пользователь попытался получить доступ к защищенному ресурсу. После добавления такого сообщения `UnauthorizedAccess.aspx` декларативная разметка страницы должен выглядеть следующим образом:

[!code-aspx[Main](user-based-authorization-cs/samples/sample7.aspx)]

Теперь нам нужно изменить рабочий процесс, если неавторизованный запрос выполняется пользователем, прошедшим аутентификацию они отправляются `UnauthorizedAccess.aspx` страницы, а не на страницу входа. Логика, которая перенаправляет неавторизованных запросов на страницу входа скрыта в закрытый метод `FormsAuthenticationModule` класса, поэтому это поведение нельзя настроить. Что мы можем сделать, однако является добавление на страницу входа, который перенаправляет пользователя для нашего собственного логики `UnauthorizedAccess.aspx`, при необходимости.

Когда `FormsAuthenticationModule` посетитель несанкционированного перенаправляет на страницу входа он добавляет URL-адрес запрошенного, несанкционированного строку запроса с именем `ReturnUrl`. Например, если неавторизованный пользователь попытался посетите `OnlyTito.aspx`, `FormsAuthenticationModule` перенаправит их `Login.aspx?ReturnUrl=OnlyTito.aspx`. Таким образом по достижении страницы входа пользователем, прошедшим аутентификацию с помощью строки запроса, который включает в себя `ReturnUrl` параметра, а затем мы знаете, что это не прошедший проверку пользователь просто пытался посетите страницу, она не имеет прав на просмотр. В этом случае мы хотим перенаправляет его на `UnauthorizedAccess.aspx`.

Для этого добавьте следующий код на страницу входа `Page_Load` обработчик событий:

[!code-csharp[Main](user-based-authorization-cs/samples/sample8.cs)]

Приведенный выше код перенаправляет прошедшего проверку подлинности, неавторизованных пользователей `UnauthorizedAccess.aspx` страницы. Чтобы увидеть эту логику в действии, посетите веб-узел как посетитель анонимные и щелкните ссылку "Создание учетных записей пользователей" в левом столбце. Это требуется для `~/Membership/CreatingUserAccounts.aspx` страницы, что на шаге 1, мы настроили только разрешить доступ к Tito. Поскольку анонимные пользователи будут запрещены, `FormsAuthenticationModule` перенаправляет нам обратно на страницу входа.

На этом этапе мы являются анонимными, поэтому `Request.IsAuthenticated` возвращает `false` мы не направляются `UnauthorizedAccess.aspx`. Вместо этого отображается на страницу входа. Войдите в качестве пользователя, отличного от Tito, например Брюс. После ввода правильных учетных данных, страницы входа передает нам обратно `~/Membership/CreatingUserAccounts.aspx`. Тем не менее так как эта страница доступна только для Tito, мы нет доступа для ее просмотра и немедленно возвращаются на страницу входа. Однако на этот раз `Request.IsAuthenticated` возвращает `true` (и `ReturnUrl` существует параметр строки запроса), поэтому мы перенаправляются `UnauthorizedAccess.aspx` страницы.


[![Aпроверку подлинности, неавторизованные пользователи перенаправляются UnauthorizedAccess.aspx](user-based-authorization-cs/_static/image17.png)](user-based-authorization-cs/_static/image16.png)

**Рис. 6**: Проверку подлинности, неавторизованные пользователи перенаправляются `UnauthorizedAccess.aspx` ([Просмотр полноразмерного изображения](user-based-authorization-cs/_static/image18.png))


Этот настраиваемый рабочий процесс возвращает в пользовательском интерфейсе более продуманной и простую замыкание цикла, изображенный на рис. 2.

## <a name="step-3-limiting-functionality-based-on-the-currently-logged-in-user"></a>Шаг 3. Ограничение функций зависимости от выполнившего вход пользователя

Авторизация URL-адреса позволяет легко указать правила авторизации крупных фрагментов. Как мы видели в шаге 1, с URL-адрес авторизации мы можно кратко состояния какие удостоверения разрешены и какие из них запрещен просмотр определенной страницы или все страницы в папке. В некоторых сценариях тем не менее, мы может потребоваться разрешить всем пользователям посетите страницу, но ограничить функциональные возможности страницы, на основе пользователя, посетив его.

Рассмотрим случай использования на веб-сайте электронной коммерции, который допускает прошедшего проверку подлинности просмотрите свои продукты. Когда анонимный пользователь посещает страницу продукта, они увидят только сведения о продукте и не будет дано возможность оставить отзыв. Тем не менее прошедший проверку пользователь посещения этой же странице отображался рецензирования интерфейс. Если еще прошедшего проверку подлинности пользователя не были проверены этот продукт, интерфейс позволила бы им для отправки рецензии; в противном случае он будет отображать их проверку отправленного ранее. Кроме того, чтобы сделать этот сценарий шаг на странице продукта может просмотреть дополнительные сведения и предлагают расширенные возможности для тех пользователей, которые работают на компанию электронной коммерции. Например на странице продукта может списке запасов на складе и включают в себя параметры для изменения цены продукта и описание при посещении сотрудником.

Можно реализовать таких правил авторизации высокогранулированных декларативно или программно (или через сочетание двух). В следующем разделе вы узнаете, как реализовать высокогранулированных авторизацию с помощью элемента управления LoginView. После этого мы изучим программные методы. Прежде чем мы рассмотрим применение правил авторизации реализуя более точное, тем не менее, необходимо сначала создать, функциональность которого зависит от пользователя, посетив его страницу.

Давайте создадим страницу, которая перечисляет файлы из определенного каталога в элементе управления GridView. А также список имя каждого файла, размер и другие сведения, GridView будет содержать два столбца из элементов управления LinkButton: один под названием представления и один названием Delete. При щелчке мышью элемента управления LinkButton представление, будет отображаться содержимое выбранного файла; При щелчке мышью элемента управления LinkButton удаление, файл будет удален. Давайте первоначально создать эту страницу, таким образом, что его представление и delete функциональность доступна всем пользователям. В рамках элемента управления LoginView и программным образом ограничивая функциональные возможности разделы, будет показано, как включить или отключить эти функции, в зависимости от пользователя, посещающего страницу.

> [!NOTE]
> Мы должны создавать страницы ASP.NET использует элемент управления GridView для отображения списка файлов. Так как в этом учебном курсе посвящены форм проверки подлинности, авторизации, учетные записи пользователей и ролей я не хочу тратить слишком много времени на обсуждение внутренней работы элемента управления GridView. Хотя этот учебник конкретных пошаговые инструкции по настройке этой страницы, он не подробно рассмотрены почему были внесены те или иные, или у определенных свойств эффекта в выводимых данных. Полное тестирование элемента управления GridView, см. Мой *[работа с данными в ASP.NET 2.0](../../data-access/index.md)* серии руководств.


Сначала откройте `UserBasedAuthorization.aspx` файл `Membership` папки и добавление элемента управления GridView на страницу с именем `FilesGrid`. Смарт-теге элемента GridView щелкните ссылку Изменить столбцы, чтобы запустить диалоговое окно "поля". На этой странице снимите флажок поля автоматически создавать в левом нижнем углу. Добавьте кнопки "выбрать", кнопку «Удалить» и два поля BoundField, кроме из верхнего левого угла (кнопки Select и Delete можно найти в поле CommandField тип). Задайте кнопки Select `SelectText` свойства для просмотра и первый BoundField `HeaderText` и `DataField` свойства к имени. Установите второй BoundField `HeaderText` свойства размер в байтах, его `DataField` свойство до длины, его `DataFormatString` свойства {0:N0} и его `HtmlEncode` значение False.

После настройки столбцов GridView, нажмите кнопку ОК, чтобы закрыть диалоговое окно "поля". В окне «Свойства» задайте GridView `DataKeyNames` свойства `FullName`. На этом этапе декларативная разметка GridView должен выглядеть следующим образом:

[!code-aspx[Main](user-based-authorization-cs/samples/sample9.aspx)]

С помощью разметки, созданной для элемента GridView мы готовы написать код, который извлечет файлы из определенного каталога и привязывать их к GridView. Добавьте следующий код на страницу `Page_Load` обработчик событий:

[!code-csharp[Main](user-based-authorization-cs/samples/sample10.cs)]

Приведенный выше код использует [ `DirectoryInfo` класс](https://msdn.microsoft.com/library/system.io.directoryinfo.aspx) для получения списка файлов в корневой папке приложения. [ `GetFiles()` Метод](https://msdn.microsoft.com/library/system.io.directoryinfo.getfiles.aspx) возвращает все файлы в каталоге как массив [ `FileInfo` объектов](https://msdn.microsoft.com/library/system.io.fileinfo.aspx), который затем привязывается к GridView. `FileInfo` Объект имеет целый ряд свойств, таких как `Name`, `Length`, и `IsReadOnly`, среди прочего. Как видно из его декларативная разметка GridView выведет на экран только `Name` и `Length` свойства.

> [!NOTE]
> `DirectoryInfo` И `FileInfo` классы находятся в [ `System.IO` пространства имен](https://msdn.microsoft.com/library/system.io.aspx). Таким образом, потребуются либо имена этих классов с их имен пространств имен в начале или пространство имен, импортируемое в файл класса (через `using System.IO`).


Отвлекитесь на эту страницу через обозреватель. Появится список файлов, находящихся в корневом каталоге приложения. Щелкнув любой представления или удаления элементов управления LinkButton приведет к обратной передачи, но вмешательство произойдет в том случае, так как еще не создать необходимые обработчики событий.


[![Tв GridView перечислены файлы в корневом каталоге веб-приложения](user-based-authorization-cs/_static/image20.png)](user-based-authorization-cs/_static/image19.png)

**Рис. 7**: GridView Перечисляет файлы в корневом каталоге веб-приложения ([Просмотр полноразмерного изображения](user-based-authorization-cs/_static/image21.png))


Нам нужен способ отображения содержимого выбранного файла. Вернитесь в Visual Studio и текстовое поле с именем `FileContents` над элементом управления GridView. Задайте его `TextMode` свойства `MultiLine` и его `Columns` и `Rows` свойства до 95% и 10 соответственно.

[!code-aspx[Main](user-based-authorization-cs/samples/sample11.aspx)]

Создайте обработчик событий для элемента GridView [ `SelectedIndexChanged` событий](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.selectedindexchanged.aspx) и добавьте следующий код:

[!code-csharp[Main](user-based-authorization-cs/samples/sample12.cs)]

Этот код использует GridView `SelectedValue` свойства, чтобы определить полное имя выбранного файла. На внутреннем уровне `DataKeys` Коллекция указывается для получения `SelectedValue`, поэтому крайне важно установить GridView `DataKeyNames` свойство с именем, как описано ранее в этом шаге. [ `File` Класс](https://msdn.microsoft.com/library/system.io.file.aspx) используется для считывания содержимое выбранного файла в строку, которая затем присваивается `FileContents` текстового поля `Text` свойство, поэтому отображается содержимое файла, выбранного на странице.


[![Tон выбран содержимое файла отображаются в текстовом поле](user-based-authorization-cs/_static/image23.png)](user-based-authorization-cs/_static/image22.png)

**Рис. 8**: Содержимое выбранного файла отображаются в текстовом поле ([Просмотр полноразмерного изображения](user-based-authorization-cs/_static/image24.png))


> [!NOTE]
> Если просмотреть содержимое файла, содержащего разметку HTML и затем попытаться просмотреть или удалить файл, вы получите `HttpRequestValidationException` ошибки. Это происходит, поскольку при обратной передаче содержимое текстового поля отправляются обратно в веб-сервера. По умолчанию ASP.NET вызывает `HttpRequestValidationException` ошибка при обнаружении потенциально опасных обратной передачи содержимого, такого как HTML-разметка. Чтобы отключить Эта ошибка возникнет, отключить проверку запроса для страницы, добавив `ValidateRequest="false"` для `@Page` директива. Дополнительные сведения о преимуществах проверку запроса, что также какие действия следует предпринять при отключении, чтение [проверка запросов — предотвращение атак скрипт](https://asp.net/learn/whitepapers/request-validation/).


Наконец, добавьте обработчик событий следующим кодом для элемента GridView [ `RowDeleting` событий](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rowdeleting.aspx):

[!code-csharp[Main](user-based-authorization-cs/samples/sample13.cs)]

Код просто отображает полное имя файла для удаления в `FileContents` TextBox *без* фактического удаления файла.


[![Cщелкнув удалить не фактически удаляется файл](user-based-authorization-cs/_static/image26.png)](user-based-authorization-cs/_static/image25.png)

**Рис. 9**: Нажав кнопку Delete кнопки не фактически удаляет файл ([Просмотр полноразмерного изображения](user-based-authorization-cs/_static/image27.png))


На шаге 1, мы настроили правила авторизации URL-адрес, чтобы запретить анонимным пользователям просмотр страниц в `Membership` папку. Чтобы лучше демонстрировать высокогранулированных проверки подлинности, разрешите возможность посещения анонимным пользователям `UserBasedAuthorization.aspx` страницы, но с ограниченной функциональностью. Чтобы открыть эту страницу, всем пользователям доступ к которым, добавьте следующий `<location>` элемент `Web.config` файл `Membership` папку:

[!code-xml[Main](user-based-authorization-cs/samples/sample14.xml)]

После добавления этого `<location>` элемент, тестирования новых правил авторизации URL-адрес войти из узла. Как анонимный пользователь должен быть разрешен посетить `UserBasedAuthorization.aspx` страницы.

В настоящее время можно посетить любого пользователя, прошедшего проверку подлинности или анонимные `UserBasedAuthorization.aspx` странице, чтобы просмотреть или удалить файлы. Давайте превратим его, чтобы только прошедшие проверку подлинности пользователи могут просматривать содержимое файла и только Tito можно удалить файл. Таких правил авторизации высокогранулированных может применяться декларативно, программно или через сочетание обоих методов. Давайте использовать декларативный подход для ограничения, кто может просматривать содержимое файла; Мы будем использовать программный подход для ограничения доступа можно удалить файл.

### <a name="using-the-loginview-control"></a>С помощью элемента управления LoginView

Как мы видели в предыдущих учебных курсах, элемент управления LoginView может использоваться для отображения разных интерфейсов для прошедшего проверку подлинности и анонимных пользователей и предлагает простой способ скрыть функциональные возможности, недоступной для анонимных пользователей. Поскольку анонимные пользователи не может просмотреть или удалить файлы, мы должны только Показывать `FileContents` текстового поля при просмотре пользователем, прошедшим проверку. Для этого добавьте на страницу элемент управления LoginView, назовите его `LoginViewForFileContentsTextBox`и переместите `FileContents` декларативная разметка текстового поля в элемент управления LoginView `LoggedInTemplate`.

[!code-aspx[Main](user-based-authorization-cs/samples/sample15.aspx)]

Веб-элементы управления в шаблонах LoginView больше не доступны непосредственно из кода класса. Например `FilesGrid` GridView `SelectedIndexChanged` и `RowDeleting` данный момент ссылаются на обработчики событий `FileContents` элемент управления TextBox с кодом, такие как:

[!code-csharp[Main](user-based-authorization-cs/samples/sample16.cs)]

Тем не менее этот код больше не является допустимым. Путем перемещения `FileContents` текстовое поле в `LoggedInTemplate` текстового поля невозможно открыть напрямую. Вместо этого мы используем `FindControl("controlId")` способ создавать программную ссылку на элемент управления. Обновление `FilesGrid` обработчики событий для ссылки на текстовое поле следующим образом:

[!code-csharp[Main](user-based-authorization-cs/samples/sample17.cs)]

После перемещения текстового поля в LoginView `LoggedInTemplate` и обновление страницы кода для ссылки на текстовое поле с помощью `FindControl("controlId")` шаблонов, посетите страницу как анонимный пользователь. Как показано на рис. 10, `FileContents` текстовое поле не отображается. Тем не менее по-прежнему отображается представление элемента управления LinkButton.


[![Tэлемент управления LoginView он отображает только FileContents текстовое поле для Authenticated Users](user-based-authorization-cs/_static/image29.png)](user-based-authorization-cs/_static/image28.png)

**Рис. 10**: Элемент управления LoginView только отображает `FileContents` текстовое поле для Authenticated Users ([Просмотр полноразмерного изображения](user-based-authorization-cs/_static/image30.png))


Чтобы скрыть кнопки представления для анонимных пользователей рекомендуется преобразовать GridView поле в TemplateField. Будет создан шаблон, который содержит декларативная разметка для представления элемента управления LinkButton. Мы затем добавьте элемент управления LoginView TemplateField и поместите LinkButton в LoginView `LoggedInTemplate`, тем самым скрытие «представление» из анонимных пользователей. Для этого щелкните ссылку Изменить столбцы смарт-теге элемента GridView диалогового окна «поля». Затем выберите кнопки "выбрать" в списке в левом нижнем углу и нажмите кнопку Преобразовать это поле в TemplateField связь. Это изменит декларативная разметка поля из:

[!code-aspx[Main](user-based-authorization-cs/samples/sample18.aspx)]

 В: 

[!code-aspx[Main](user-based-authorization-cs/samples/sample19.aspx)]

На этом этапе мы можем добавить LoginView TemplateField. Следующая разметка отображает LinkButton представления только для прошедших проверку пользователей.

[!code-aspx[Main](user-based-authorization-cs/samples/sample20.aspx)]

Как показано на рис. 11, конечный результат не является, что довольно как представление столбцов по-прежнему отображается несмотря на то, что представление элементов управления LinkButton внутри столбца скрыты. Как скрыть всего столбца GridView (и не только LinkButton) будут рассмотрены в следующем разделе.


[![Tэлемент управления LoginView он скрывает представление элементов управления LinkButton для анонимных пользователей](user-based-authorization-cs/_static/image32.png)](user-based-authorization-cs/_static/image31.png)

**Рис. 11**: Элемент управления LoginView скрывает представление элементов управления LinkButton для анонимных пользователей ([Просмотр полноразмерного изображения](user-based-authorization-cs/_static/image33.png))


### <a name="programmatically-limiting-functionality"></a>Программно ограничение функций

В некоторых случаях декларативной методики, недостаточны для ограничение функций на страницу. Например доступность некоторых функций страницы может зависеть критерии за пределы того пользователя, посещающего страницу анонимных или прошедших проверку подлинности. В таких случаях различных элементов пользовательского интерфейса можно отобразить или скрыть через программные средства.

Чтобы ограничить функциональные возможности программным образом, нам нужно выполнить две задачи:

1. Определяют, доступны ли пользователя, посещающего страницу функциональные возможности, и
2. Измените пользовательский интерфейс, в зависимости от того, имеет ли пользователь доступ к функциям в вопросе программным образом.

Чтобы продемонстрировать применение эти две задачи, давайте разрешают только Tito для удаления файлов из GridView. Наша первая задача, то для определения, является ли Tito, посетив страницу. После определения, нам нужно скрыть (или отображение) удалить столбец к GridView. Столбцы GridView, доступны через его `Columns` свойство; столбец отображается только в том случае, если его `Visible` свойству `true` (по умолчанию).

Добавьте следующий код, чтобы `Page_Load` обработчик событий до привязка данных к GridView:

[!code-csharp[Main](user-based-authorization-cs/samples/sample21.cs)]

Как уже говорилось в [ *Обзор аутентификации форм* ](../introduction/an-overview-of-forms-authentication-cs.md) руководстве `User.Identity.Name` возвращает имя удостоверения. Это соответствует имени пользователя, введенный в элементе управления Login. При посещении страницы, второй столбец GridView Tito `Visible` свойству `true`; в противном случае он становится равным `false`. Конечным результатом будет то, что если кто-то отличного от Tito посещает страницу, либо другого пользователя, прошедшего проверку подлинности, или анонимного пользователя, удалить столбец не отображается (см. рис. 12); Тем не менее, когда Tito посещает страницу, удалить столбец присутствует (см. рис. 13).


[![Tон удалить столбец является не отображается при посещен, кто-то отличное от Tito (например, Брюс)](user-based-authorization-cs/_static/image35.png)](user-based-authorization-cs/_static/image34.png)

**Рис. 12**: Удалить столбец является не отображается при посещен, кто-то отличное от Tito (например, Брюс) ([Просмотр полноразмерного изображения](user-based-authorization-cs/_static/image36.png))


[![TУдалить столбец он отображается для Tito](user-based-authorization-cs/_static/image38.png)](user-based-authorization-cs/_static/image37.png)

**Рис. 13**: Удалить столбец отображается для Tito ([Просмотр полноразмерного изображения](user-based-authorization-cs/_static/image39.png))


## <a name="step-4-applying-authorization-rules-to-classes-and-methods"></a>Шаг 4. Применение правил авторизации для классов и методов

На шаге 3 мы запрещено анонимным пользователям просматривать содержимое файла и права всем пользователям, но Tito удаление файлов. Это осуществлялось с сокрытие элементов интерфейса пользователя для несанкционированного посетителей через декларативные и программные методы. В нашем примере простого правильно скрытие элементов пользовательского интерфейса был простым, но как насчет более сложные сайты которых может быть много различных способов выполнения одинаковой функциональности? Ограничения эти функции для неавторизованных пользователей, что произойдет, если мы забыли скрыть или отключить все элементы интерфейса пользователя?

Чтобы убедиться, что конкретная часть функциональности может быть недоступна для несанкционированного удобно для оформления этого класса или метода с [ `PrincipalPermission` атрибут](https://msdn.microsoft.com/library/system.security.permissions.principalpermissionattribute.aspx). Когда среда выполнения .NET используется класс или выполняет одну из его методов, выполняется проверка того, что текущий контекст безопасности имеет разрешение на использование класса или выполнения метода. `PrincipalPermission` Атрибут предоставляет механизм, через который можно определить эти правила.

Давайте демонстрируют использование `PrincipalPermission` атрибут для элемента GridView `SelectedIndexChanged` и `RowDeleting` обработчики событий, чтобы запретить выполнение анонимные пользователи и пользователи, не являющиеся Tito, соответственно. Нам нужно сделать всего лишь добавить соответствующий атрибут поверх каждое определение функции:

[!code-csharp[Main](user-based-authorization-cs/samples/sample22.cs)]

Атрибут для `SelectedIndexChanged` определяет обработчик событий, которые только прошедшие проверку пользователи могут выполнять процедуру обработчика событий, а в атрибуте `RowDeleting` обработчик событий ограничивает к Tito при выполнении.

Если каким-то образом пользователя, отличного от Tito пытается выполнить `RowDeleting` обработчик событий или без проверки подлинности пользователь пытается выполнить `SelectedIndexChanged` обработчик событий, которые будут вызывать среду выполнения .NET `SecurityException`.


[![IЕсли нужное контекст безопасности не авторизован для выполнения метода, то выдается SecurityException](user-based-authorization-cs/_static/image41.png)](user-based-authorization-cs/_static/image40.png)

**Рис. 14**: Если контекст безопасности не авторизован для выполнения метода, `SecurityException` возникает исключение ([Просмотр полноразмерного изображения](user-based-authorization-cs/_static/image42.png))


> [!NOTE]
> Чтобы разрешить несколько контекстов безопасности для доступа к класса или метода, снабдить класса или метода с `PrincipalPermission` атрибут для каждого контекста безопасности. То есть Tito и Брюс, для выполнения `RowDeleting` обработчик событий, добавьте *два* `PrincipalPermission` атрибуты:


[!code-csharp[Main](user-based-authorization-cs/samples/sample23.cs)]

В дополнение к страницы ASP.NET многие приложения также имеют архитектуру, которая включает в себя различные уровни, такие как бизнес-логики и уровни доступа к данным. Эти уровни обычно реализуются как библиотеки классов и предоставляют классы и методы для выполнения бизнес-логики и связанные данные функции. `PrincipalPermission` Атрибут полезен для применения правила авторизации для этих уровней.

Дополнительные сведения об использовании `PrincipalPermission` атрибут для определения правил авторизации на классы и методы, см. [Скотт Гатри](https://weblogs.asp.net/scottgu/)на запись в блоге [добавления правила авторизации для бизнеса и слои с помощью `PrincipalPermissionAttributes` ](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx).

## <a name="summary"></a>Сводка

В этом учебнике мы рассмотрели способы применения правил авторизации на основе пользователя. Мы начали с рассмотрения ASP. В .NET framework авторизации URL-адрес. Для каждого запроса, механизм ASP.NET `UrlAuthorizationModule` проверяет правила авторизации URL-адреса, определенные в конфигурации приложения, чтобы определить, авторизован ли удостоверение для доступа к запрошенному ресурсу. Короче говоря Авторизация URL-адреса позволяет легко указать правила авторизации для конкретной страницы или для всех страниц из определенного каталога.

Инфраструктуры авторизации URL-адрес применяет правила авторизации на основе страниц. Авторизации URL-адрес запрашивающий удостоверений имеет права для доступа к определенному ресурсу или нет. Во многих сценариях, однако, вызвать дополнительные правила авторизации высокогранулированных. Вместо того, чтобы определить, кто имеет разрешение на доступ к странице, нам может понадобиться разрешать доступ к странице, но для отображение различных данных или предлагать различные функциональные возможности в зависимости от пользователя, посещающего страницу. Авторизацию на уровне страницы обычно включает в себя скрытие элементов пользовательского интерфейса, чтобы предотвратить несанкционированный доступ к функциональным возможностям запрещенных. Кроме того можно использовать атрибуты для ограничения доступа к классам и выполнения его методов для определенных пользователей.

Счастливого вам программирования!

### <a name="further-reading"></a>Дополнительные сведения

Дополнительные сведения по темам, обсуждавшимся в этом руководстве см. в следующих ресурсах:

- [Добавление к бизнесу и уровни данных с помощью правил авторизации `PrincipalPermissionAttributes`](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)
- [Проверки подлинности ASP.NET](https://msdn.microsoft.com/library/wce3kxhd.aspx)
- [Изменения между IIS6 и системы безопасности в IIS7](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/Changes-between-IIS6-and-IIS7-Security)
- [Настройка отдельных файлов и подкаталогов](https://msdn.microsoft.com/library/6hbkh9s7.aspx)
- [Ограничение функций изменения данных на основе пользователя](../../data-access/editing-inserting-and-deleting-data/limiting-data-modification-functionality-based-on-the-user-cs.md)
- [Примеры использования элемента управления LoginView](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/loginview.aspx)
- [Основные сведения об авторизации URL-адреса IIS7](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/URL-Authorization/Understanding-IIS7-URL-Authorization)
- [`UrlAuthorizationModule` Техническая документация](https://msdn.microsoft.com/library/system.web.security.urlauthorizationmodule.aspx)
- [Работа с данными в ASP.NET 2.0](../../data-access/index.md)

### <a name="about-the-author"></a>Об авторе

Скотт Митчелл, автор нескольких книг по ASP/ASP.NET и основатель веб-узла 4GuysFromRolla.com, работает с веб-технологиями Microsoft с 1998 года. Скотт — независимый консультант, преподаватель и автор. Его последняя книга —  *[Sams Teach ASP.NET 2.0 in 24 часа](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*. Скоттом можно связаться по адресу [ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com) или через его блог по адресу [ http://ScottOnWriting.NET ](http://scottonwriting.net/).

### <a name="special-thanks-to"></a>Особая благодарность

В этой серии руководств пособий рецензировалась многими компетентными редакторами. Хотите поработать с моих последующих статей для MSDN? Если Да, напишите мне [ mitchell@4GuysFromRolla.com ](mailto:mitchell@4GuysFromRolla.com).

> [!div class="step-by-step"]
> [Назад](validating-user-credentials-against-the-membership-user-store-cs.md)
> [Вперед](storing-additional-user-information-cs.md)
