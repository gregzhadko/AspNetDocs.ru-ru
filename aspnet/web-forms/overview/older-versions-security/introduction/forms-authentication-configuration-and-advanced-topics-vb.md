---
uid: web-forms/overview/older-versions-security/introduction/forms-authentication-configuration-and-advanced-topics-vb
title: Настройка проверки подлинности с помощью форм и дополнительные разделы (VB) | Документация Майкрософт
author: rick-anderson
description: В этом учебнике мы рассмотрим различные параметры проверки подлинности на основе форм и посмотрим, как их изменять с помощью элемента Forms. Это влечет за собой подробные сведения...
ms.author: riande
ms.date: 01/14/2008
ms.assetid: 829d2f56-5c48-445b-b826-3418a450c788
msc.legacyurl: /web-forms/overview/older-versions-security/introduction/forms-authentication-configuration-and-advanced-topics-vb
msc.type: authoredcontent
ms.openlocfilehash: 4d77816a489a4fa16cd70ec4214cd2f8ee563029
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78518136"
---
# <a name="forms-authentication-configuration-and-advanced-topics-vb"></a><span data-ttu-id="d9ca4-104">Настройка проверки подлинности на основе форм и дополнительные разделы (VB)</span><span class="sxs-lookup"><span data-stu-id="d9ca4-104">Forms Authentication Configuration and Advanced Topics (VB)</span></span>

<span data-ttu-id="d9ca4-105">по [Скотт Митчелл](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="d9ca4-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="d9ca4-106">[Скачать код](https://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/ASPNET_Security_Tutorial_03_VB.zip) или [скачать PDF](https://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/aspnet_tutorial03_AuthAdvanced_vb.pdf)</span><span class="sxs-lookup"><span data-stu-id="d9ca4-106">[Download Code](https://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/ASPNET_Security_Tutorial_03_VB.zip) or [Download PDF](https://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/aspnet_tutorial03_AuthAdvanced_vb.pdf)</span></span>

> <span data-ttu-id="d9ca4-107">В этом учебнике мы рассмотрим различные параметры проверки подлинности на основе форм и посмотрим, как их изменять с помощью элемента Forms.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-107">In this tutorial we will examine the various forms authentication settings and see how to modify them through the forms element.</span></span> <span data-ttu-id="d9ca4-108">Это влечет за собой подробный обзор настройки значения времени ожидания билета проверки подлинности на основе форм, использование страницы входа с настраиваемым URL-адресом (например, SignIn. aspx вместо login. aspx) и билетами проверки подлинности форм без файлов cookie.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-108">This will entail a detailed look at customizing the forms authentication ticket's timeout value, using a login page with a custom URL (like SignIn.aspx instead of Login.aspx), and cookieless forms authentication tickets.</span></span>

## <a name="introduction"></a><span data-ttu-id="d9ca4-109">Введение</span><span class="sxs-lookup"><span data-stu-id="d9ca4-109">Introduction</span></span>

<span data-ttu-id="d9ca4-110">В [предыдущем учебном курсе](an-overview-of-forms-authentication-vb.md) были рассмотрены шаги, необходимые для реализации проверки подлинности с помощью форм в приложении ASP.NET, от указания параметров конфигурации в файле Web. config до создания страницы входа для отображения другого содержимого для проверки подлинности и анонимных пользователей.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-110">In the [previous tutorial](an-overview-of-forms-authentication-vb.md) we looked at the steps necessary for implementing forms authentication in an ASP.NET application, from specifying configuration settings in Web.config to creating a log in page to displaying different content for authenticated and anonymous users.</span></span> <span data-ttu-id="d9ca4-111">Помните, что мы настроили веб-сайт для использования проверки подлинности с помощью форм, установив атрибут mode элемента&gt; проверки подлинности &lt;в Forms.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-111">Recall that we configured the website to use forms authentication by setting the mode attribute of the &lt;authentication&gt; element to Forms.</span></span> <span data-ttu-id="d9ca4-112">Элемент&gt; проверки подлинности &lt;может содержать дочерний элемент &lt;Forms&gt;, через который можно указать набор параметров проверки подлинности с помощью форм.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-112">The &lt;authentication&gt; element may optionally include a &lt;forms&gt; child element, through which an assortment of forms authentication settings may be specified.</span></span>

<span data-ttu-id="d9ca4-113">В этом учебнике мы рассмотрим различные параметры проверки подлинности на основе форм и изучим их изменение с помощью элемента &lt;Forms&gt;.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-113">In this tutorial we will examine the various forms authentication settings and see how to modify them through the &lt;forms&gt; element.</span></span> <span data-ttu-id="d9ca4-114">Это влечет за собой подробный обзор настройки значения времени ожидания билета проверки подлинности на основе форм, использование страницы входа с настраиваемым URL-адресом (например, SignIn. aspx вместо login. aspx) и билетами проверки подлинности форм без файлов cookie.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-114">This will entail a detailed look at customizing the forms authentication ticket's timeout value, using a login page with a custom URL (like SignIn.aspx instead of Login.aspx), and cookieless forms authentication tickets.</span></span> <span data-ttu-id="d9ca4-115">Мы также рассмотрим описывающего билета проверки подлинности с помощью форм и посмотрим, что меры предосторожности ASP.NET гарантируют, что данные билета защищены от проверки и изменения.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-115">We will also examine the makeup of the forms authentication ticket more closely and see the precautions ASP.NET takes to ensure that the ticket's data is secure from inspection and tampering.</span></span> <span data-ttu-id="d9ca4-116">Наконец, мы рассмотрим, как хранить дополнительные данные пользователя в билете проверки подлинности на основе форм и как моделировать эти данные с помощью пользовательского объекта Principal.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-116">Finally, we will look at how to store extra user data in the forms authentication ticket and how to model this data through a custom principal object.</span></span>

## <a name="step-1-examining-the-ltformsgt-configuration-settings"></a><span data-ttu-id="d9ca4-117">Шаг 1. Проверка &lt;Forms&gt; параметров конфигурации</span><span class="sxs-lookup"><span data-stu-id="d9ca4-117">Step 1: Examining the &lt;forms&gt; Configuration Settings</span></span>

<span data-ttu-id="d9ca4-118">Система проверки подлинности форм в ASP.NET предлагает ряд параметров конфигурации, которые можно настроить отдельно для каждого приложения.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-118">The forms authentication system in ASP.NET offers a number of configuration settings that can be customized on an application-by-application basis.</span></span> <span data-ttu-id="d9ca4-119">Сюда входят такие параметры, как: время существования билета проверки подлинности форм; какой тип защиты применяется к билету; при условии, что используются билеты проверки подлинности без поддержки файлов cookie; путь к странице входа; и другие сведения.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-119">This includes settings like: the lifetime of the forms authentication ticket; what sort of protection is applied to the ticket; under what conditions cookieless authentication tickets are used; the path to the login page; and other information.</span></span> <span data-ttu-id="d9ca4-120">Чтобы изменить значения по умолчанию, добавьте [элемент&lt;forms&gt;](https://msdn.microsoft.com/library/1d3t3c61.aspx) в качестве дочернего элемента [&lt;&gt; проверки подлинности](https://msdn.microsoft.com/library/532aee0e.aspx), указав значения этих свойств, которые нужно настроить в качестве атрибутов XML следующим образом:</span><span class="sxs-lookup"><span data-stu-id="d9ca4-120">To modify the default values, add a [&lt;forms&gt; element](https://msdn.microsoft.com/library/1d3t3c61.aspx) as a child of the [&lt;authentication&gt; element](https://msdn.microsoft.com/library/532aee0e.aspx), specifying those property values you want to customize as XML attributes like so:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample1.xml)]

<span data-ttu-id="d9ca4-121">В таблице 1 приведены сводные сведения о свойствах, которые можно настроить с помощью элемента &lt;Forms&gt;.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-121">Table 1 summarizes the properties that can be customized through the &lt;forms&gt; element.</span></span> <span data-ttu-id="d9ca4-122">Так как файл Web. config является XML-файлом, в именах атрибутов в левом столбце учитывается регистр.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-122">Since Web.config is an XML file, the attribute names in the left column are case-sensitive.</span></span>

| <span data-ttu-id="d9ca4-123"><strong>Attribute</strong></span><span class="sxs-lookup"><span data-stu-id="d9ca4-123"><strong>Attribute</strong></span></span> |                                                                                                                                                                                                                                     <span data-ttu-id="d9ca4-124"><strong>Описание</strong></span><span class="sxs-lookup"><span data-stu-id="d9ca4-124"><strong>Description</strong></span></span>                                                                                                                                                                                                                                      |
|----------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         <span data-ttu-id="d9ca4-125">сеансов</span><span class="sxs-lookup"><span data-stu-id="d9ca4-125">cookieless</span></span>         |                                                                                                                <span data-ttu-id="d9ca4-126">Этот атрибут указывает, при каких условиях билет проверки подлинности хранится в файле cookie и не внедряется в URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-126">This attribute specifies under what conditions the authentication ticket is stored in a cookie versus being embedded in the URL.</span></span> <span data-ttu-id="d9ca4-127">Допустимые значения: Усекукиес; Усеури; Автообнаружение и Уседевицепрофиле (значение по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="d9ca4-127">Allowable values are: UseCookies; UseUri; AutoDetect; and UseDeviceProfile (the default).</span></span> <span data-ttu-id="d9ca4-128">Шаг 2 подробно рассматривает этот параметр.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-128">Step 2 examines this setting in more detail.</span></span>                                                                                                                |
|         <span data-ttu-id="d9ca4-129">дефаултурл</span><span class="sxs-lookup"><span data-stu-id="d9ca4-129">defaultUrl</span></span>         |                                                                                                                                                         <span data-ttu-id="d9ca4-130">Указывает URL-адрес, на который пользователи перенаправляются после входа со страницы входа, если в строке запроса не указано значение RedirectUrl.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-130">Indicates the URL that users are redirected to after signing in from the login page if there is no RedirectUrl value specified in the querystring.</span></span> <span data-ttu-id="d9ca4-131">По умолчанию используется значение default.aspx.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-131">The default value is default.aspx.</span></span>                                                                                                                                                         |
|           <span data-ttu-id="d9ca4-132">домен</span><span class="sxs-lookup"><span data-stu-id="d9ca4-132">domain</span></span>           | <span data-ttu-id="d9ca4-133">При использовании билетов проверки подлинности на основе файлов cookie этот параметр указывает значение домена cookie s.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-133">When using cookie-based authentication tickets, this setting specifies the cookie s domain value.</span></span> <span data-ttu-id="d9ca4-134">Значение по умолчанию — пустая строка, которая заставляет браузер использовать домен, из которого он был выдан (например, www.yourdomain.com).</span><span class="sxs-lookup"><span data-stu-id="d9ca4-134">The default value is an empty string, which causes the browser to use the domain from which it was issued (such as www.yourdomain.com).</span></span> <span data-ttu-id="d9ca4-135">В этом случае файл cookie <strong>не</strong> будет отправляться при выполнении запросов к поддоменам, таким как admin.yourdomain.com.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-135">In this case, the cookie will <strong>not</strong> be sent when making requests to subdomains, such as admin.yourdomain.com.</span></span> <span data-ttu-id="d9ca4-136">Если вы хотите, чтобы файл cookie передавался во все поддомены, необходимо настроить атрибут домена, указав для него значение yourdomain.com.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-136">If you want the cookie to be passed to all subdomains you need to customize the domain attribute setting it to yourdomain.com.</span></span> |
|  <span data-ttu-id="d9ca4-137">енаблекроссаппредиректс</span><span class="sxs-lookup"><span data-stu-id="d9ca4-137">enableCrossAppRedirects</span></span>   |                                                                                                                                                                   <span data-ttu-id="d9ca4-138">Логическое значение, указывающее, запоминаются ли пользователи, прошедшие проверку подлинности, при перенаправлении на URL-адреса других веб-приложений на том же сервере.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-138">A Boolean value indicating whether authenticated users are remembered when redirected to URLs in other web applications on the same server.</span></span> <span data-ttu-id="d9ca4-139">Значение по умолчанию — false.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-139">The default is false.</span></span>                                                                                                                                                                   |
|          <span data-ttu-id="d9ca4-140">логинурл</span><span class="sxs-lookup"><span data-stu-id="d9ca4-140">loginUrl</span></span>          |                                                                                                                                                                                                                      <span data-ttu-id="d9ca4-141">URL-адрес страницы входа.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-141">The URL of the login page.</span></span> <span data-ttu-id="d9ca4-142">По умолчанию используется значение login.aspx.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-142">The default value is login.aspx.</span></span>                                                                                                                                                                                                                      |
|            <span data-ttu-id="d9ca4-143">name</span><span class="sxs-lookup"><span data-stu-id="d9ca4-143">name</span></span>            |                                                                                                                                                                                                   <span data-ttu-id="d9ca4-144">При использовании билетов проверки подлинности на основе файлов cookie имя файла cookie.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-144">When using cookie-based authentication tickets, the name of the cookie.</span></span> <span data-ttu-id="d9ca4-145">Значение по умолчанию —. АСПКСАУС.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-145">The default is .ASPXAUTH.</span></span>                                                                                                                                                                                                   |
|            <span data-ttu-id="d9ca4-146">path</span><span class="sxs-lookup"><span data-stu-id="d9ca4-146">path</span></span>            |                                                                             <span data-ttu-id="d9ca4-147">При использовании билетов проверки подлинности на основе файлов cookie этот параметр указывает атрибут пути к файлу cookie.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-147">When using cookie-based authentication tickets, this setting specifies the cookie s path attribute.</span></span> <span data-ttu-id="d9ca4-148">Атрибут Path позволяет разработчику ограничить область файла cookie определенной иерархией каталогов.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-148">The path attribute enables a developer to limit the scope of a cookie to a particular directory hierarchy.</span></span> <span data-ttu-id="d9ca4-149">Значение по умолчанию —/, которое информирует браузер о необходимости отправить файл cookie билета проверки подлинности в любой запрос, сделанный в домене.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-149">The default value is /, which informs the browser to send the authentication ticket cookie to any request made to the domain.</span></span>                                                                              |
|         <span data-ttu-id="d9ca4-150">защита</span><span class="sxs-lookup"><span data-stu-id="d9ca4-150">protection</span></span>         |                                                                                                                                            <span data-ttu-id="d9ca4-151">Указывает, какие методы используются для защиты билета проверки подлинности с помощью форм.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-151">Indicates what techniques are used to protect the forms authentication ticket.</span></span> <span data-ttu-id="d9ca4-152">Допустимые значения: ALL (по умолчанию); Ключ None и проверки.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-152">The allowable values are: All (the default); Encryption; None; and Validation.</span></span> <span data-ttu-id="d9ca4-153">Эти параметры подробно описаны на шаге 3.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-153">These settings are discussed in detail in Step 3.</span></span>                                                                                                                                            |
|         <span data-ttu-id="d9ca4-154">requireSSL</span><span class="sxs-lookup"><span data-stu-id="d9ca4-154">requireSSL</span></span>         |                                                                                                                                                                                <span data-ttu-id="d9ca4-155">Логическое значение, указывающее, требуется ли SSL-соединение для передачи файла cookie проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-155">A Boolean value that indicates whether an SSL connection is required to transmit the authentication cookie.</span></span> <span data-ttu-id="d9ca4-156">Значение по умолчанию — false.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-156">The default value is false.</span></span>                                                                                                                                                                                |
|     <span data-ttu-id="d9ca4-157">slidingExpiration</span><span class="sxs-lookup"><span data-stu-id="d9ca4-157">slidingExpiration</span></span>      |                                                                                                 <span data-ttu-id="d9ca4-158">Логическое значение, указывающее, будет ли время ожидания для файла cookie проверки подлинности сбрасываться каждый раз, когда пользователь посещает сайт в течение одного сеанса.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-158">A Boolean value that indicates whether the authentication cookie s timeout is reset each time the user visits the site during a single session.</span></span> <span data-ttu-id="d9ca4-159">Значение по умолчанию — true.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-159">The default value is true.</span></span> <span data-ttu-id="d9ca4-160">Политика времени ожидания билета проверки подлинности обсуждается более подробно в разделе Указание значения времени ожидания билета s.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-160">The authentication ticket timeout policy is discussed in more detail in the Specifying the Ticket s Timeout Value section.</span></span>                                                                                                 |
|          <span data-ttu-id="d9ca4-161">timeout</span><span class="sxs-lookup"><span data-stu-id="d9ca4-161">timeout</span></span>           |                                                                                                                               <span data-ttu-id="d9ca4-162">Указывает время в минутах, по истечении которого срок действия файла cookie билета проверки подлинности истекает.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-162">Specifies the time, in minutes, after which the authentication ticket cookie expires.</span></span> <span data-ttu-id="d9ca4-163">Значение по умолчанию — 30.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-163">The default value is 30.</span></span> <span data-ttu-id="d9ca4-164">Политика времени ожидания билета проверки подлинности обсуждается более подробно в разделе Указание значения времени ожидания билета s.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-164">The authentication ticket timeout policy is discussed in more detail in the Specifying the Ticket s Timeout Value section.</span></span>                                                                                                                               |

<span data-ttu-id="d9ca4-165">**Таблица 1**. сводка по &lt;forms&gt; атрибутов элемента</span><span class="sxs-lookup"><span data-stu-id="d9ca4-165">**Table 1**: A Summary of the &lt;forms&gt; Element's Attributes</span></span>

<span data-ttu-id="d9ca4-166">В ASP.NET 2,0 и более поздних версиях значения проверки подлинности форм по умолчанию жестко запрограммированы в классе Формсаусентикатионконфигуратион в .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-166">In ASP.NET 2.0 and beyond, the default forms authentication values are hard-coded in the FormsAuthenticationConfiguration class in the .NET Framework.</span></span> <span data-ttu-id="d9ca4-167">Любые изменения должны быть применены к отдельным приложениям в файле Web. config.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-167">Any modifications must be applied on an application-by-application basis in the Web.config file.</span></span> <span data-ttu-id="d9ca4-168">Это отличается от ASP.NET 1. x, где значения проверки подлинности форм по умолчанию хранились в файле Machine. config (и поэтому могут быть изменены с помощью редактирования Machine. config).</span><span class="sxs-lookup"><span data-stu-id="d9ca4-168">This differs from ASP.NET 1.x, where the default forms authentication values were stored in the machine.config file (and could therefore be modified via editing machine.config).</span></span> <span data-ttu-id="d9ca4-169">Хотя в разделе ASP.NET 1. x стоит упомянуть, что ряд параметров системы проверки подлинности с помощью форм имеет разные значения по умолчанию в ASP.NET 2,0 и более поздних, чем в ASP.NET 1. x.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-169">While on the topic of ASP.NET 1.x, it is worthwhile to mention that a number of the forms authentication system settings have different default values in ASP.NET 2.0 and beyond than in ASP.NET 1.x.</span></span> <span data-ttu-id="d9ca4-170">При переносе приложения из среды ASP.NET 1. x важно помнить об этих различиях.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-170">If you are migrating your application from an ASP.NET 1.x environment, it is important to be aware of these differences.</span></span> <span data-ttu-id="d9ca4-171">Список различий см. [в &lt;forms&gt; элемент технической документации](https://msdn.microsoft.com/library/1d3t3c61.aspx) .</span><span class="sxs-lookup"><span data-stu-id="d9ca4-171">Consult [the &lt;forms&gt; element technical documentation](https://msdn.microsoft.com/library/1d3t3c61.aspx) for a list of the differences.</span></span>

> [!NOTE]
> <span data-ttu-id="d9ca4-172">Несколько параметров проверки подлинности с помощью форм, таких как время ожидания, домен и путь, указывают сведения о результирующем файле cookie билета проверки подлинности форм.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-172">Several forms authentication settings, such as the timeout, domain, and path, specify details for the resulting forms authentication ticket cookie.</span></span> <span data-ttu-id="d9ca4-173">Дополнительные сведения о файлах cookie, их работе и их различных свойствах см. в [руководстве по файлам cookie](http://www.quirksmode.org/js/cookies.html).</span><span class="sxs-lookup"><span data-stu-id="d9ca4-173">For more information on cookies, how they work, and their various properties, read [this Cookies tutorial](http://www.quirksmode.org/js/cookies.html).</span></span>

### <a name="specifying-the-tickets-timeout-value"></a><span data-ttu-id="d9ca4-174">Указание значения времени ожидания билета</span><span class="sxs-lookup"><span data-stu-id="d9ca4-174">Specifying the Ticket's Timeout Value</span></span>

<span data-ttu-id="d9ca4-175">Билет проверки подлинности форм — это маркер, представляющий удостоверение.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-175">The forms authentication ticket is a token that represents an identity.</span></span> <span data-ttu-id="d9ca4-176">При использовании билетов проверки подлинности на основе файлов cookie этот маркер хранится в виде файла cookie и отправляется на веб-сервер при каждом запросе.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-176">With cookie-based authentication tickets, this token is held in the form of a cookie and sent to the web server on each request.</span></span> <span data-ttu-id="d9ca4-177">Владение маркером, по сути, *объявляет, я*уже вошел в систему и используется, чтобы удостоверение пользователя можно было запомнить при посещении страницы.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-177">Possession of the token, in essence, declares, I am *username*, I have already logged in, and is used so that a user's identity can be remembered across page visits.</span></span>

<span data-ttu-id="d9ca4-178">Билет проверки подлинности на формах содержит не только удостоверение пользователя, но и сведения, помогающие обеспечить целостность и безопасность маркера.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-178">The forms authentication ticket not only includes the user's identity, but also contains information to help ensure the integrity and security of the token.</span></span> <span data-ttu-id="d9ca4-179">В конце концов, мы не хотим, чтобы злостный пользователь мог создать контрафактный маркер или изменить незаконный токен.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-179">After all, we don't want a nefarious user to be able to create a counterfeit token, or to modify a legit token in some underhanded way.</span></span>

<span data-ttu-id="d9ca4-180">Одним из таких сведений, включенных в билет, является *срок действия*, то есть дата и время, когда билет больше не действителен.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-180">One such bit of information included in the ticket is an *expiry*, which is the date and time the ticket is no longer valid.</span></span> <span data-ttu-id="d9ca4-181">Каждый раз, когда FormsAuthenticationModule проверяет билет проверки подлинности, он гарантирует, что срок действия билета еще не прошел.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-181">Each time the FormsAuthenticationModule inspects an authentication ticket, it ensures that the ticket's expiry has not yet passed.</span></span> <span data-ttu-id="d9ca4-182">Если он есть, он не учитывает билет и определяет пользователя как анонимный.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-182">If it has, it disregards the ticket and identifies the user as being anonymous.</span></span> <span data-ttu-id="d9ca4-183">Эта мера защиты помогает защититься от атак с использованием воспроизведения.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-183">This safeguard helps protect against replay attacks.</span></span> <span data-ttu-id="d9ca4-184">Без истечения срока действия, если злоумышленнику удалось получить доступ к допустимому билету проверки подлинности пользователя, возможно, путем получения физического доступа к своему компьютеру и его корневого каталога с помощью файлов cookie, они могли бы отправить запрос на сервер с помощью этого украденного билета проверки подлинности и получить запись.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-184">Without an expiry, if a hacker was able to get her hands on a user's valid authentication ticket - perhaps by gaining physical access to their computer and rooting through their cookies - they could send a request to the server with this stolen authentication ticket and gain entry.</span></span> <span data-ttu-id="d9ca4-185">Хотя срок действия не мешает этому сценарию, он ограничивает окно, в течение которого такая атака может быть выполнена.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-185">While the expiry doesn't prevent this scenario, it does limit the window during which such an attack can succeed.</span></span>

> [!NOTE]
> <span data-ttu-id="d9ca4-186">Шаг 3. сведения о дополнительных методах, используемых системой проверки подлинности форм для защиты билета проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-186">Step 3 details additional techniques used by the forms authentication system to protect the authentication ticket.</span></span>

<span data-ttu-id="d9ca4-187">При создании билета аутентификации система проверки подлинности форм определяет срок ее действия, выдавая параметр времени ожидания.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-187">When creating the authentication ticket, the forms authentication system determines its expiry by consulting the timeout setting.</span></span> <span data-ttu-id="d9ca4-188">Как указано в табл. 1, значение времени ожидания по умолчанию равно 30 минутам. Это означает, что при создании билета проверки подлинности на форме в будущем задается Дата и время в 30 минут.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-188">As noted in Table 1, the timeout setting defaults to 30 minutes, meaning that when the forms authentication ticket is created its expiry is set to a date and time 30 minutes in the future.</span></span>

<span data-ttu-id="d9ca4-189">Срок действия определяет абсолютное время в будущем при истечении срока действия билета проверки подлинности форм.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-189">The expiry defines an absolute time in the future when the forms authentication ticket expires.</span></span> <span data-ttu-id="d9ca4-190">Но обычно разработчики хотят реализовать скользящий срок действия, который сбрасывается при каждом посещении сайта пользователем.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-190">But usually developers want to implement a sliding expiry, one that is reset every time the user revisits the site.</span></span> <span data-ttu-id="d9ca4-191">Это поведение определяется параметрами slidingExpiration.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-191">This behavior is determined by the slidingExpiration settings.</span></span> <span data-ttu-id="d9ca4-192">Если задано значение true (по умолчанию), при каждой проверке подлинности пользователя FormsAuthenticationModule обновляет срок действия билета.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-192">If set to true (the default), each time the FormsAuthenticationModule authenticates a user, it updates the ticket's expiry.</span></span> <span data-ttu-id="d9ca4-193">Если задано значение false, срок действия для каждого запроса не обновляется, что приводит к тому, что срок действия билета истекает в течение заданного времени ожидания (в минутах) после создания билета.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-193">If set to false, the expiry is not updated on each request, thereby causing the ticket to expire exactly timeout number of minutes past when the ticket was first created.</span></span>

> [!NOTE]
> <span data-ttu-id="d9ca4-194">Срок действия, сохраненный в билете проверки подлинности, является абсолютным значением даты и времени, например 2 августа 2008 11:34 AM.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-194">The expiry stored in the authentication ticket is an absolute date and time value, like August 2, 2008 11:34 AM.</span></span> <span data-ttu-id="d9ca4-195">Более того, Дата и время зависят от местного времени веб-сервера.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-195">Moreover, the date and time are relative to the web server's local time.</span></span> <span data-ttu-id="d9ca4-196">Это решение может иметь несколько интересных побочных эффектов, связанных с переходом на летнее время (DST), когда часы в США перемещаются на один час (предполагая, что веб-сервер размещается в языковом стандарте, где наблюдается летнее время).</span><span class="sxs-lookup"><span data-stu-id="d9ca4-196">This design decision can have some interesting side effects around Daylight Saving Time (DST), which is when clocks in the United States are moved ahead one hour (assuming the web server is hosted in a locale where Daylight Saving Time is observed).</span></span> <span data-ttu-id="d9ca4-197">Рассмотрим, что произойдет для веб-сайта ASP.NET с истекшим сроком действия 30 минут в ближайшее время начала летнего времени (2:00 AM).</span><span class="sxs-lookup"><span data-stu-id="d9ca4-197">Consider what would happen for an ASP.NET website with a 30 minute expiry near the time that DST begins (which is at 2:00 AM).</span></span> <span data-ttu-id="d9ca4-198">Представьте, что посетитель входит на сайт с 11 марта 2008 по 1:55 AM.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-198">Imagine a visitor signs on to the site on March 11, 2008 at 1:55 AM.</span></span> <span data-ttu-id="d9ca4-199">Это приведет к формированию билета проверки подлинности форм, срок действия которого истекает 11 марта 2008 в 2:25 AM (30 минут в будущем).</span><span class="sxs-lookup"><span data-stu-id="d9ca4-199">This would generate a forms authentication ticket that expires at March 11, 2008 at 2:25 AM (30 minutes in the future).</span></span> <span data-ttu-id="d9ca4-200">Однако один раз в 2:00, часы переходят в 3:00 AM из-за летнего времени.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-200">However, once 2:00 AM rolls around, the clock jumps to 3:00 AM because of DST.</span></span> <span data-ttu-id="d9ca4-201">Когда пользователь загружает новую страницу за шесть минут после входа (в 3:01 AM), FormsAuthenticationModule записывает, что срок действия билета истек, и перенаправляет пользователя на страницу входа.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-201">When the user loads a new page six minutes after signing in (at 3:01 AM), the FormsAuthenticationModule notes that the ticket has expired and redirects the user to the login page.</span></span> <span data-ttu-id="d9ca4-202">Дополнительные сведения об этом и других странностиах времени ожидания билета проверки подлинности, а также обходные пути см. в статье копия Стефан Шаков ( *Security Professional ASP.NET 2,0, членство и управление ролями* (ISBN: 978-0-7645-9698-8).</span><span class="sxs-lookup"><span data-stu-id="d9ca4-202">For a more thorough discussion on this and other authentication ticket timeout oddities, as well as workarounds, pick up a copy of Stefan Schackow's *Professional ASP.NET 2.0 Security, Membership, and Role Management* (ISBN: 978-0-7645-9698-8).</span></span>

<span data-ttu-id="d9ca4-203">На рис. 1 показан рабочий процесс, когда slidingExpiration имеет значение false, а для параметра timeout — значение 30.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-203">Figure 1 illustrates the workflow when slidingExpiration is set to false and timeout is set to 30.</span></span> <span data-ttu-id="d9ca4-204">Обратите внимание, что билет проверки подлинности, созданный при входе, содержит дату окончания срока действия, и это значение не обновляется при последующих запросах.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-204">Note that the authentication ticket generated at login contains the expiration date, and this value is not updated on subsequent requests.</span></span> <span data-ttu-id="d9ca4-205">Если FormsAuthenticationModule обнаружит, что срок действия билета истек, он отклоняет его и обрабатывает запрос как анонимный.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-205">If the FormsAuthenticationModule finds that the ticket has expired, it discards it and treats the request as anonymous.</span></span>

<span data-ttu-id="d9ca4-206">[![графическое представление срока действия билета проверки подлинности форм, если slidingExpiration имеет значение false](forms-authentication-configuration-and-advanced-topics-vb/_static/image2.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="d9ca4-206">[![A Graphical Representation of the Forms Authentication Ticket's Expiry When slidingExpiration is false](forms-authentication-configuration-and-advanced-topics-vb/_static/image2.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image1.png)</span></span>

<span data-ttu-id="d9ca4-207">**Рис. 01**. графическое представление срока действия билета проверки подлинности на основе форм, если slidingExpiration имеет значение false ([щелкните, чтобы просмотреть изображение с полным размером](forms-authentication-configuration-and-advanced-topics-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="d9ca4-207">**Figure 01**: A Graphical Representation of the Forms Authentication Ticket's Expiry When slidingExpiration is false ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image3.png))</span></span>

<span data-ttu-id="d9ca4-208">На рис. 2 показан рабочий процесс, когда для slidingExpiration установлено значение true, а для параметра timeout — значение 30.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-208">Figure 2 shows the workflow when slidingExpiration is set to true and timeout is set to 30.</span></span> <span data-ttu-id="d9ca4-209">При получении запроса, прошедшего проверку подлинности (с неистекшим билетом) срок его действия истекает до времени ожидания в будущем.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-209">When an authenticated request is received (with a non-expired ticket) its expiry is updated to timeout number of minutes in the future.</span></span>

<span data-ttu-id="d9ca4-210">[![графическое представление билета проверки подлинности форм, когда slidingExpiration имеет значение true](forms-authentication-configuration-and-advanced-topics-vb/_static/image5.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="d9ca4-210">[![A Graphical Representation of the Forms Authentication Ticket's When slidingExpiration is true](forms-authentication-configuration-and-advanced-topics-vb/_static/image5.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image4.png)</span></span>

<span data-ttu-id="d9ca4-211">**Рис. 02**. графическое представление билета проверки подлинности форм, когда slidingExpiration имеет значение true ([щелкните, чтобы просмотреть изображение с полным размером](forms-authentication-configuration-and-advanced-topics-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="d9ca4-211">**Figure 02**: A Graphical Representation of the Forms Authentication Ticket's When slidingExpiration is true ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image6.png))</span></span>

<span data-ttu-id="d9ca4-212">При использовании билетов проверки подлинности на основе файлов cookie (по умолчанию) это обсуждение станет немного запутанным, так как для файлов cookie также могут быть заданы собственные сроки действия.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-212">When using cookie-based authentication tickets (the default), this discussion becomes a little more confusing because cookies can also have their own expiries specified.</span></span> <span data-ttu-id="d9ca4-213">Срок действия файла cookie (или его отсутствие) указывает браузеру на необходимость уничтожения файла cookie.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-213">A cookie's expiry (or lack thereof) instructs the browser when the cookie should be destroyed.</span></span> <span data-ttu-id="d9ca4-214">Если у файла cookie отсутствует срок действия, он уничтожается при завершении работы браузера.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-214">If the cookie lacks an expiry, it is destroyed when the browser shuts down.</span></span> <span data-ttu-id="d9ca4-215">Однако если срок действия истекает, файл cookie сохраняется на компьютере пользователя до тех пор, пока не будет пройдена Дата и время, указанные в параметре срока действия.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-215">If an expiry is present, however, the cookie remains stored on the user's computer until the date and time specified in the expiry has passed.</span></span> <span data-ttu-id="d9ca4-216">Когда файл cookie уничтожается браузером, он больше не отправляется на веб-сервер.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-216">When a cookie is destroyed by the browser, it is no longer sent to the web server.</span></span> <span data-ttu-id="d9ca4-217">Таким образом, уничтожение файла cookie аналогично выходу пользователя из сайта.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-217">Therefore, the destruction of a cookie is analogous to the user logging out of the site.</span></span>

> [!NOTE]
> <span data-ttu-id="d9ca4-218">Конечно, пользователь может заранее удалить все файлы cookie, хранящиеся на их компьютере.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-218">Of course, a user may proactively remove any cookies stored on their computer.</span></span> <span data-ttu-id="d9ca4-219">В Internet Explorer 7 перейдите в меню Сервис, параметры и нажмите кнопку Удалить в разделе журнал браузера.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-219">In Internet Explorer 7, you would go to Tools, Options, and click the Delete button in the Browsing history section.</span></span> <span data-ttu-id="d9ca4-220">После этого нажмите кнопку Удалить файлы cookie.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-220">From there, click the Delete cookies button.</span></span>

<span data-ttu-id="d9ca4-221">Система проверки подлинности форм создает файлы cookie на основе сеанса или на основе срока действия в зависимости от значения, переданного в параметр *персисткукие* .</span><span class="sxs-lookup"><span data-stu-id="d9ca4-221">The forms authentication system creates session-based or expiry-based cookies depending on the value passed in to the *persistCookie* parameter.</span></span> <span data-ttu-id="d9ca4-222">Помните, что методы Жетаускукие, Сетаускукие и RedirectFromLoginPage класса FormsAuthentication принимают два входных параметра: *username* и *персисткукие*.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-222">Recall that the FormsAuthentication class's GetAuthCookie, SetAuthCookie, and RedirectFromLoginPage methods take in two input parameters: *username* and *persistCookie*.</span></span> <span data-ttu-id="d9ca4-223">Страница входа, созданная в предыдущем учебнике, включала флажок "Запомнить мои данные", который определяет, был ли создан сохраняемый файл cookie.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-223">The login page we created in the preceding tutorial included a Remember me CheckBox, which determined whether a persistent cookie was created.</span></span> <span data-ttu-id="d9ca4-224">Срок действия постоянных файлов cookie истекает; непостоянные файлы cookie — это сеансы на основе сеансов.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-224">Persistent cookies are expiry-based; non-persistent cookies are session-based.</span></span>

<span data-ttu-id="d9ca4-225">Уже обсуждаемые концепции timeout и slidingExpiration применяются и к файлам cookie, основанным на сеансах, и по истечении срока действия.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-225">The timeout and slidingExpiration concepts already discussed apply the same to both session- and expiry-based cookies.</span></span> <span data-ttu-id="d9ca4-226">Существует только одно небольшое различие в выполнении: при использовании файлов cookie с истекшим сроком действия с Слидингтимеаут, для которых задано значение true, срок действия файла cookie обновляется только в случае истечения половины указанного времени.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-226">There is only one minor difference in execution: when using expiry-based cookies with slidingTimeout set to true, the cookie's expiry is only updated when more than half of the specified time has elapsed.</span></span>

<span data-ttu-id="d9ca4-227">Давайте изменим политики времени ожидания билета проверки подлинности для веб-сайта, чтобы время ожидания билетов истекло через один час (60 минут) с использованием скользящего срока действия.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-227">Let's update our website's authentication ticket timeout policies so that tickets timeout after one hour (60 minutes), using a sliding expiration.</span></span> <span data-ttu-id="d9ca4-228">Чтобы это изменение вступили в действие, обновите файл Web. config, добавив элемент &lt;Forms&gt; в элемент &lt;&gt; проверки подлинности со следующей разметкой:</span><span class="sxs-lookup"><span data-stu-id="d9ca4-228">To effect this change, update the Web.config file, adding a &lt;forms&gt; element to the &lt;authentication&gt; element with the following markup:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample2.xml)]

### <a name="using-an-login-page-url-other-than-loginaspx"></a><span data-ttu-id="d9ca4-229">Использование URL-адреса страницы входа, отличной от Login. aspx</span><span class="sxs-lookup"><span data-stu-id="d9ca4-229">Using an Login Page URL Other than Login.aspx</span></span>

<span data-ttu-id="d9ca4-230">Так как FormsAuthenticationModule автоматически перенаправляет неавторизованных пользователей на страницу входа, ему необходимо указать URL-адрес страницы входа.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-230">Since the FormsAuthenticationModule automatically redirects unauthorized users to the login page, it needs to know the login page's URL.</span></span> <span data-ttu-id="d9ca4-231">Этот URL-адрес задается атрибутом Логинурл в элементе &lt;Forms&gt; и по умолчанию используется имя входа. aspx.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-231">This URL is specified by the loginUrl attribute in the &lt;forms&gt; element and defaults to login.aspx.</span></span> <span data-ttu-id="d9ca4-232">Если выполняется перенос по существующему веб-сайту, возможно, у вас уже есть страница входа с другим URL-адресом, которая уже была помечена и проиндексирована поисковых машин.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-232">If you are porting over an existing website, you may already have a login page with a different URL, one that has already been bookmarked and indexed by search engines.</span></span> <span data-ttu-id="d9ca4-233">Вместо переименования существующей страницы входа в систему Login. aspx и разрыва ссылок и закладок пользователей можно изменить атрибут Логинурл, чтобы он указывал на страницу входа.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-233">Rather than renaming your existing login page to login.aspx and breaking links and users' bookmarks, you can instead modify the loginUrl attribute to point to your login page.</span></span>

<span data-ttu-id="d9ca4-234">Например, если страница входа называется Signing. aspx и находится в каталоге Users, можно указать параметру конфигурации Логинурл значение ~/Усерс/сигнин.аспкс следующим образом:</span><span class="sxs-lookup"><span data-stu-id="d9ca4-234">For example, if your login page was named SignIn.aspx and was located in the Users directory, you could point the loginUrl configuration setting to ~/Users/SignIn.aspx like so:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample3.xml)]

<span data-ttu-id="d9ca4-235">Так как у текущего приложения уже есть страница входа с именем Login. aspx, нет необходимости указывать пользовательское значение в элементе &lt;Forms&gt;.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-235">Since our current application already has a login page named Login.aspx, there's no need to specify a custom value in the &lt;forms&gt; element.</span></span>

## <a name="step-2-using-cookieless-forms-authentication-tickets"></a><span data-ttu-id="d9ca4-236">Шаг 2. Использование билетов проверки подлинности с помощью форм без файлов cookie</span><span class="sxs-lookup"><span data-stu-id="d9ca4-236">Step 2: Using Cookieless Forms Authentication Tickets</span></span>

<span data-ttu-id="d9ca4-237">По умолчанию система проверки подлинности форм определяет, следует ли сохранять билеты проверки подлинности в коллекции cookies или внедрять их в URL-адрес на основе агента пользователя, который посещает сайт.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-237">By default the forms authentication system determines whether to store its authentication tickets in the cookies collection or embed them in the URL based on the user agent visiting the site.</span></span> <span data-ttu-id="d9ca4-238">Все распространенные браузеры настольных систем, такие как Internet Explorer, Firefox, Opera и Safari, поддерживают файлы cookie, но не все мобильные устройства.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-238">All mainstream desktop browsers like Internet Explorer, Firefox, Opera, and Safari, support cookies, but not all mobile devices do.</span></span>

<span data-ttu-id="d9ca4-239">Политика файлов cookie, используемая системой проверки подлинности форм, зависит от параметра без файлов cookie в элементе &lt;Forms&gt;, которому можно назначить одно из четырех значений:</span><span class="sxs-lookup"><span data-stu-id="d9ca4-239">The cookie policy used by the forms authentication system depends on the cookieless setting in the &lt;forms&gt; element, which can be assigned one of four values:</span></span>

- <span data-ttu-id="d9ca4-240">Усекукиес — указывает, что всегда будут использоваться билеты проверки подлинности на основе файлов cookie.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-240">UseCookies - specifies that cookie-based authentication tickets will always be used.</span></span>
- <span data-ttu-id="d9ca4-241">Усеури — указывает, что билеты проверки подлинности на основе файлов cookie никогда не используются.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-241">UseUri - indicates that cookie-based authentication tickets will never be used.</span></span>
- <span data-ttu-id="d9ca4-242">Автообнаружение. Если профиль устройства не поддерживает файлы cookie, билеты проверки подлинности на основе файлов cookie не используются. Если профиль устройства поддерживает файлы cookie, для определения того, включены ли файлы cookie, используется механизм проверки.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-242">AutoDetect - if the device profile does not support cookies, cookie-based authentication tickets are not used; if the device profile supports cookies, a probing mechanism is used to determine if cookies are enabled.</span></span>
- <span data-ttu-id="d9ca4-243">Уседевицепрофиле — значение по умолчанию; использует билеты проверки подлинности на основе файлов cookie, только если профиль устройства поддерживает файлы cookie.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-243">UseDeviceProfile - the default; uses cookie-based authentication tickets only if the device profile supports cookies.</span></span> <span data-ttu-id="d9ca4-244">Механизм зондирования не используется.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-244">No probing mechanism is used.</span></span>

<span data-ttu-id="d9ca4-245">Параметры автоопределения и Уседевицепрофиле используют *профиль устройства* , чтобы определить, следует ли использовать билеты проверки подлинности без поддержки файлов cookie или файлов cookie.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-245">The AutoDetect and UseDeviceProfile settings rely on a *device profile* in ascertaining whether to use cookie-based or cookieless authentication tickets.</span></span> <span data-ttu-id="d9ca4-246">ASP.NET поддерживает базу данных различных устройств и их возможности, например, поддерживают ли они файлы cookie, какую версию JavaScript поддерживает и т. д.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-246">ASP.NET maintains a database of various devices and their capabilities, such as whether they support cookies, what version of JavaScript they support, and so on.</span></span> <span data-ttu-id="d9ca4-247">Каждый раз, когда устройство запрашивает веб-страницу с веб-сервера, он отправляет через HTTP *-заголовок агента пользователя* , который определяет тип устройства.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-247">Each time a device requests a web page from a web server it sends along a *user-agent* HTTP header that identifies the device type.</span></span> <span data-ttu-id="d9ca4-248">ASP.NET автоматически сопоставляет указанную строку агента пользователя с соответствующим профилем, указанным в его базе данных.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-248">ASP.NET automatically matches the supplied user-agent string with the corresponding profile specified in its database.</span></span>

> [!NOTE]
> <span data-ttu-id="d9ca4-249">Эта база данных возможностей устройства хранится в виде нескольких XML-файлов, которые соответствуют [схеме файла определения браузера](https://msdn.microsoft.com/library/ms228122.aspx).</span><span class="sxs-lookup"><span data-stu-id="d9ca4-249">This database of device capabilities is stored in a number of XML files that adhere to the [Browser Definition File schema](https://msdn.microsoft.com/library/ms228122.aspx).</span></span> <span data-ttu-id="d9ca4-250">Файлы профиля устройства по умолчанию находятся в папке%WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG\Browsers.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-250">The default device profile files are located in %WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG\Browsers.</span></span> <span data-ttu-id="d9ca4-251">Вы также можете добавить пользовательские файлы в папку приложений\_Browsers приложения.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-251">You can also add custom files to your application's App\_Browsers folder.</span></span> <span data-ttu-id="d9ca4-252">Дополнительные сведения см. [в разделе руководство. обнаружение типов браузеров в веб-страницы ASP.NET](https://msdn.microsoft.com/library/3yekbd5b.aspx).</span><span class="sxs-lookup"><span data-stu-id="d9ca4-252">For more information, see [How To: Detect Browser Types in ASP.NET Web Pages](https://msdn.microsoft.com/library/3yekbd5b.aspx).</span></span>

<span data-ttu-id="d9ca4-253">Поскольку значение по умолчанию — Уседевицепрофиле, билеты проверки подлинности форм без файлов cookie будут использоваться при посещении сайта устройством, профиль которого сообщает, что он не поддерживает файлы cookie.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-253">Because the default setting is UseDeviceProfile, cookieless forms authentication tickets will be used when the site is visited by a device whose profile reports that it does not support cookies.</span></span>

### <a name="encoding-the-authentication-ticket-in-the-url"></a><span data-ttu-id="d9ca4-254">Кодирование билета проверки подлинности в URL-адресе</span><span class="sxs-lookup"><span data-stu-id="d9ca4-254">Encoding the Authentication Ticket in the URL</span></span>

<span data-ttu-id="d9ca4-255">Файлы cookie являются естественным носителем для включения информации из браузера в каждый запрос к определенному веб-сайту, поэтому по умолчанию параметры проверки подлинности на основе форм используют файлы cookie, если на посещение устройства они поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-255">Cookies are a natural medium for including information from the browser in each request to a particular website, which is why the default forms authentication settings use cookies if the visiting device supports them.</span></span> <span data-ttu-id="d9ca4-256">Если файлы cookie не поддерживаются, необходимо использовать альтернативные средства для передачи билета проверки подлинности от клиента на сервер.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-256">If cookies are not supported, an alternate means for passing the authentication ticket from the client to the server must be employed.</span></span> <span data-ttu-id="d9ca4-257">Распространенный обходной путь, используемый в средах без файлов cookie, заключается в кодировании данных cookie в URL-адресе.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-257">A common workaround used in cookieless environments is to encode the cookie data in the URL.</span></span>

<span data-ttu-id="d9ca4-258">Чтобы увидеть, как подобная информация может быть внедрена в URL-адрес, рекомендуется принудительно использовать билеты проверки подлинности без поддержки файлов cookie.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-258">The best way to see how such information can be embedded within the URL is to force the site to use cookieless authentication tickets.</span></span> <span data-ttu-id="d9ca4-259">Это можно сделать, задав для параметра конфигурации без файлов cookie значение Усеури:</span><span class="sxs-lookup"><span data-stu-id="d9ca4-259">This can be accomplished by setting the cookieless configuration setting to UseUri:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample4.xml)]

<span data-ttu-id="d9ca4-260">После внесения этого изменения посетите сайт в браузере.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-260">Once you have made this change, visit the site through a browser.</span></span> <span data-ttu-id="d9ca4-261">При посещении в качестве анонимного пользователя URL-адреса будут выглядеть точно так же, как и раньше.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-261">When visiting as an anonymous user, the URLs will look exactly like they did before.</span></span> <span data-ttu-id="d9ca4-262">Например, при посещении страницы Default. aspx в адресной строке моего браузера отображается следующий URL-адрес:</span><span class="sxs-lookup"><span data-stu-id="d9ca4-262">For example, when visiting Default.aspx page my browser's address bar shows the following URL:</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/default.aspx`

<span data-ttu-id="d9ca4-263">Однако при входе в систему билет проверки подлинности форм внедряется в URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-263">However, upon logging in, the forms authentication ticket is embedded into the URL.</span></span> <span data-ttu-id="d9ca4-264">Например, после посещения страницы входа и входа в систему как SAM я вернулся на страницу Default. aspx, но URL-адрес этого времени:</span><span class="sxs-lookup"><span data-stu-id="d9ca4-264">For example, after visiting the login page and logging in as Sam, I am returned to the Default.aspx page, but the URL this time is:</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/(F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2))/default.aspx`

<span data-ttu-id="d9ca4-265">Билет проверки подлинности форм был внедрен в URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-265">The forms authentication ticket has been embedded within the URL.</span></span> <span data-ttu-id="d9ca4-266">Строка (F (jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-Фималксжфов\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2) представляет сведения о билете проверки подлинности в шестнадцатеричной кодировке и — это те же данные, которые обычно хранятся в файле cookie.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-266">The string (F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2) represents the hex-encoded authentication ticket information, and is the same data that is usually stored within a cookie.</span></span>

<span data-ttu-id="d9ca4-267">Чтобы билеты проверки подлинности без файлов cookie работали, система должна кодировать все URL-адреса на странице, чтобы включить данные билета проверки подлинности, в противном случае билет проверки подлинности будет потерян, когда пользователь щелкнет ссылку.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-267">In order for cookieless authentication tickets to work, the system must encode all URLs on the page to include the authentication ticket data, otherwise the authentication ticket will be lost when the user clicks on a link.</span></span> <span data-ttu-id="d9ca4-268">К счастью, эта логика внедрения выполняется автоматически.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-268">Thankfully, this embedding logic is performed automatically.</span></span> <span data-ttu-id="d9ca4-269">Чтобы продемонстрировать эту функцию, откройте страницу Default. aspx и добавьте элемент управления HyperLink, задав его свойства Text и NavigateUrl для Test Link и Сомепаже. aspx соответственно.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-269">To demonstrate this functionality, open the Default.aspx page and add a HyperLink control, setting its Text and NavigateUrl properties to Test Link and SomePage.aspx, respectively.</span></span> <span data-ttu-id="d9ca4-270">Не имеет значения, что в нашем проекте нет страницы с именем Сомепаже. aspx.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-270">It doesn't matter that there really isn't a page in our project named SomePage.aspx.</span></span>

<span data-ttu-id="d9ca4-271">Сохраните изменения в файле Default. aspx, а затем откройте его в браузере.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-271">Save the changes to Default.aspx and then visit it through a browser.</span></span> <span data-ttu-id="d9ca4-272">Войдите на сайт, чтобы билет проверки подлинности форм был внедрен в URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-272">Log on to the site so that the forms authentication ticket is embedded in the URL.</span></span> <span data-ttu-id="d9ca4-273">Затем из default. aspx щелкните ссылку проверить ссылку.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-273">Next, from Default.aspx, click the Test Link link.</span></span> <span data-ttu-id="d9ca4-274">Что произошло?</span><span class="sxs-lookup"><span data-stu-id="d9ca4-274">What happened?</span></span> <span data-ttu-id="d9ca4-275">Если страница с именем Сомепаже. aspx не существует, то произошла ошибка 404, но это не так важно.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-275">If no page named SomePage.aspx exists, then a 404 error occurred, but that's not what's important here.</span></span> <span data-ttu-id="d9ca4-276">Вместо этого Обратите внимание на адресную строку в браузере.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-276">Instead, focus on the Address bar in your browser.</span></span> <span data-ttu-id="d9ca4-277">Обратите внимание, что он содержит билет проверки подлинности форм в URL-адресе.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-277">Note that it includes the forms authentication ticket in the URL!</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/(F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2))/SomePage.aspx`

<span data-ttu-id="d9ca4-278">URL-адрес Сомепаже. aspx в ссылке был автоматически преобразован в URL-адрес, включающий билет проверки подлинности. нам не пришлось писать строчку кода!</span><span class="sxs-lookup"><span data-stu-id="d9ca4-278">The URL SomePage.aspx in the link was automatically converted into a URL that included the authentication ticket - we didn't have to write a lick of code!</span></span> <span data-ttu-id="d9ca4-279">Билет проверки подлинности формы будет автоматически внедрен в URL-адрес для любых гиперссылок, которые не начинаются с http://или/.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-279">The form authentication ticket will automatically be embedded in the URL for any hyperlinks that do not start with http:// or /.</span></span> <span data-ttu-id="d9ca4-280">Не имеет значения, отображается ли гиперссылка при вызове метода Response. Redirect, в элементе управления HyperLink или в элементе HTML привязки (т. е. &lt;a href = "..."&gt;...&lt;/a&gt;).</span><span class="sxs-lookup"><span data-stu-id="d9ca4-280">It doesn't matter if the hyperlink appears in a call to Response.Redirect, in a HyperLink control, or in an anchor HTML element (i.e., &lt;a href="..."&gt;...&lt;/a&gt;).</span></span> <span data-ttu-id="d9ca4-281">При условии, что URL-адрес не http://www.someserver.com/SomePage.aspx или/Сомепаже.аспкс, билет проверки подлинности форм будет внедрен для нас.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-281">As long as the URL isn't something like http://www.someserver.com/SomePage.aspx or /SomePage.aspx, the forms authentication ticket will be embedded for us.</span></span>

> [!NOTE]
> <span data-ttu-id="d9ca4-282">Билеты проверки подлинности в формах без файлов cookie соответствуют тем же политикам времени ожидания, что и билеты проверки подлинности на основе файлов cookie.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-282">Cookieless forms authentication tickets adhere to the same timeout policies as cookie-based authentication tickets.</span></span> <span data-ttu-id="d9ca4-283">Однако билеты проверки подлинности без файлов cookie более подвержены атакам с целью воспроизведения, так как билет проверки подлинности внедряется непосредственно в URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-283">However, cookieless authentication tickets are more prone to replay attacks since the authentication ticket is embedded directly in the URL.</span></span> <span data-ttu-id="d9ca4-284">Представьте себе пользователя, который посещает веб-сайт, войдет в систему и вставит URL-адрес в электронное письмо коллеге.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-284">Imagine a user who visits a website, logs in, and then pastes the URL in an email to a colleague.</span></span> <span data-ttu-id="d9ca4-285">Если коллега щелкнет эту ссылку до истечения срока действия, он будет зарегистрирован в качестве пользователя, отправившего сообщение.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-285">If the colleague clicks on that link before the expiry is reached, they will be logged in as the user who sent the email!</span></span>

## <a name="step-3-securing-the-authentication-ticket"></a><span data-ttu-id="d9ca4-286">Шаг 3. обеспечение безопасности билета проверки подлинности</span><span class="sxs-lookup"><span data-stu-id="d9ca4-286">Step 3: Securing the Authentication Ticket</span></span>

<span data-ttu-id="d9ca4-287">Билет проверки подлинности на основе форм передается по каналу в файле cookie или внедряется непосредственно в URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-287">The forms authentication ticket is transmitted over the wire either in a cookie or embedded directly within the URL.</span></span> <span data-ttu-id="d9ca4-288">Кроме сведений об удостоверениях, билет проверки подлинности также может содержать данные пользователя (как будет показано на шаге 4).</span><span class="sxs-lookup"><span data-stu-id="d9ca4-288">In addition to identity information, the authentication ticket can also include user data (as we will see in Step 4).</span></span> <span data-ttu-id="d9ca4-289">Следовательно, важно, чтобы данные билета были зашифрованы от любопытныхных глаз и (еще важнее), что система проверки подлинности форм может гарантировать, что билет не был изменен.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-289">Consequently, it is important that the ticket's data is encrypted from prying eyes and (even more importantly) that the forms authentication system can guarantee that the ticket was not tampered with.</span></span>

<span data-ttu-id="d9ca4-290">Чтобы обеспечить конфиденциальность данных билета, система проверки подлинности форм может зашифровать данные билета.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-290">To ensure the privacy of the ticket's data, the forms authentication system can encrypt the ticket data.</span></span> <span data-ttu-id="d9ca4-291">Сбой шифрования данных билета отправляет потенциально конфиденциальную информацию по каналу в виде обычного текста.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-291">Failure to encrypt the ticket data sends potentially sensitive information over the wire in plain-text.</span></span>

<span data-ttu-id="d9ca4-292">Чтобы гарантировать подлинность билета, система проверки подлинности форм должна *проверить* билет.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-292">To guarantee a ticket's authenticity, the forms authentication system must *validate* the ticket.</span></span> <span data-ttu-id="d9ca4-293">Проверка является гарантией того, что конкретный фрагмент данных не был изменен, и выполняется с помощью *[кода проверки подлинности сообщения (Mac)](http://en.wikipedia.org/wiki/Message_authentication_code)* .</span><span class="sxs-lookup"><span data-stu-id="d9ca4-293">Validation is the act of ensuring that a particular piece of data has not been modified, and is accomplished via a *[message authentication code (MAC)](http://en.wikipedia.org/wiki/Message_authentication_code)*.</span></span> <span data-ttu-id="d9ca4-294">В двух словах, MAC — это небольшая часть информации, определяющая данные, которые необходимо проверить (в данном случае это билет).</span><span class="sxs-lookup"><span data-stu-id="d9ca4-294">In a nutshell, the MAC is a small piece of information that identifies the data that needs to be validated (in this case, the ticket).</span></span> <span data-ttu-id="d9ca4-295">Если данные, представленные MAC, изменяются, то MAC и данные не будут совпадать.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-295">If the data represented by the MAC is modified, then the MAC and the data will not match up.</span></span> <span data-ttu-id="d9ca4-296">Более того, злоумышленнику будет трудно изменить данные и создать собственный MAC-адрес для соответствия измененным данным.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-296">Moreover, it is computationally hard for a hacker to both modify the data and generate his own MAC to correspond with the modified data.</span></span>

<span data-ttu-id="d9ca4-297">При создании (или изменении) билета система проверки подлинности форм создает MAC и прикрепляет его к данным билета.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-297">When creating (or modifying) a ticket, the forms authentication system creates a MAC and attaches it to the ticket's data.</span></span> <span data-ttu-id="d9ca4-298">При получении последующего запроса система проверки подлинности форм сравнивает данные MAC и билета для проверки подлинности данных билета.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-298">When a subsequent request arrives, the forms authentication system compares the MAC and ticket data to validate the authenticity of the ticket data.</span></span> <span data-ttu-id="d9ca4-299">На рис. 3 показан этот рабочий процесс в графическом виде.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-299">Figure 3 illustrates this workflow graphically.</span></span>

<span data-ttu-id="d9ca4-300">[![подлинности билета обеспечивается через MAC](forms-authentication-configuration-and-advanced-topics-vb/_static/image8.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="d9ca4-300">[![The Ticket's Authenticity is Ensured through a MAC](forms-authentication-configuration-and-advanced-topics-vb/_static/image8.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image7.png)</span></span>

<span data-ttu-id="d9ca4-301">**Рис. 03**. Проверка подлинности билета обеспечивается через Mac ([щелкните, чтобы просмотреть образ полного размера](forms-authentication-configuration-and-advanced-topics-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="d9ca4-301">**Figure 03**: The Ticket's Authenticity is Ensured through a MAC ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image9.png))</span></span>

<span data-ttu-id="d9ca4-302">Меры безопасности, применяемые к билету проверки подлинности, зависят от настройки защиты в элементе &lt;Forms&gt;.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-302">What security measures are applied to the authentication ticket depends on the protection setting in the &lt;forms&gt; element.</span></span> <span data-ttu-id="d9ca4-303">Параметр защиты может быть назначен одному из следующих трех значений:</span><span class="sxs-lookup"><span data-stu-id="d9ca4-303">The protection setting may be assigned to one of the following three values:</span></span>

- <span data-ttu-id="d9ca4-304">Все — билет зашифрован и имеет цифровую подпись (по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="d9ca4-304">All - the ticket is both encrypted and digitally signed (the default).</span></span>
- <span data-ttu-id="d9ca4-305">Применяется шифрование только для шифрования — MAC не создается.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-305">Encryption - only encryption is applied - no MAC is generated.</span></span>
- <span data-ttu-id="d9ca4-306">None — билет не зашифрован или имеет цифровую подпись.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-306">None - the ticket is neither encrypted nor digitally signed.</span></span>
- <span data-ttu-id="d9ca4-307">Проверка — создается MAC-адрес, но данные билета передаются по сети в виде обычного текста.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-307">Validation - a MAC is generated, but the ticket data is sent over the wire in plain-text.</span></span>

<span data-ttu-id="d9ca4-308">Корпорация Майкрософт настоятельно рекомендует использовать параметр ALL.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-308">Microsoft strongly recommends using the All setting.</span></span>

### <a name="setting-the-validation-and-decryption-keys"></a><span data-ttu-id="d9ca4-309">Настройка ключей проверки и расшифровки</span><span class="sxs-lookup"><span data-stu-id="d9ca4-309">Setting the Validation and Decryption Keys</span></span>

<span data-ttu-id="d9ca4-310">Алгоритмы шифрования и хэширования, используемые системой проверки подлинности форм для шифрования и проверки билета проверки подлинности, можно настраивать с помощью [элемента&lt;machineKey&gt;](https://msdn.microsoft.com/library/w8h3skw9.aspx) в файле Web. config. В таблице 2 приведены атрибуты элемента &lt;machineKey&gt; и их возможные значения.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-310">The encryption and hashing algorithms used by the forms authentication system to encrypt and validate the authentication ticket are customizable through the [&lt;machineKey&gt; element](https://msdn.microsoft.com/library/w8h3skw9.aspx) in Web.config. Table 2 outlines the &lt;machineKey&gt; element's attributes and their possible values.</span></span>

| <span data-ttu-id="d9ca4-311">**Attribute**</span><span class="sxs-lookup"><span data-stu-id="d9ca4-311">**Attribute**</span></span> | <span data-ttu-id="d9ca4-312">**Описание**</span><span class="sxs-lookup"><span data-stu-id="d9ca4-312">**Description**</span></span> |
| --- | --- |
| <span data-ttu-id="d9ca4-313">расшифровка</span><span class="sxs-lookup"><span data-stu-id="d9ca4-313">decryption</span></span> | <span data-ttu-id="d9ca4-314">Указывает алгоритм, используемый для шифрования.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-314">Indicates the algorithm used for encryption.</span></span> <span data-ttu-id="d9ca4-315">Этот атрибут может иметь одно из следующих четырех значений:-Auto — значение по умолчанию; Определяет алгоритм на основе длины атрибута Декриптионкэй.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-315">This attribute can have one of the following four values: - Auto - the default; determines the algorithm based on the length of the decryptionKey attribute.</span></span> <span data-ttu-id="d9ca4-316">-AES — использует алгоритм [AES (AES)](http://en.wikipedia.org/wiki/Advanced_Encryption_Standard) .</span><span class="sxs-lookup"><span data-stu-id="d9ca4-316">- AES - uses the [Advanced Encryption Standard (AES)](http://en.wikipedia.org/wiki/Advanced_Encryption_Standard) algorithm.</span></span> <span data-ttu-id="d9ca4-317">-DES — использует [стандарт шифрования данных (DES)](http://en.wikipedia.org/wiki/Data_Encryption_Standard) . Этот алгоритм считается ненадежным для вычислений и не должен использоваться.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-317">- DES - uses the [Data Encryption Standard (DES)](http://en.wikipedia.org/wiki/Data_Encryption_Standard) This algorithm is considered computationally weak and should not be used.</span></span> <span data-ttu-id="d9ca4-318">-3DES — использует алгоритм [Triple DES](http://en.wikipedia.org/wiki/Triple_DES) , который работает в три раза, применяя алгоритм DES.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-318">- 3DES - uses the [Triple DES](http://en.wikipedia.org/wiki/Triple_DES) algorithm, which works by applying the DES algorithm three times.</span></span> |
| <span data-ttu-id="d9ca4-319">декриптионкэй</span><span class="sxs-lookup"><span data-stu-id="d9ca4-319">decryptionKey</span></span> | <span data-ttu-id="d9ca4-320">Секретный ключ, используемый алгоритмом шифрования.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-320">The secret key used by the encryption algorithm.</span></span> <span data-ttu-id="d9ca4-321">Это значение должно быть шестнадцатеричной строкой соответствующей длины (в зависимости от значения в расшифровании), автогенерации или любого значения с добавлением, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-321">This value must either be a hexadecimal string of the appropriate length (based on the value in decryption), AutoGenerate, or either value appended with,IsolateApps.</span></span> <span data-ttu-id="d9ca4-322">Добавление IsolateApps указывает ASP.NET использовать уникальное значение для каждого приложения.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-322">Adding IsolateApps instructs ASP.NET to use a unique value for each application.</span></span> <span data-ttu-id="d9ca4-323">Значение по умолчанию — Автоформирование, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-323">The default is AutoGenerate,IsolateApps.</span></span> |
| <span data-ttu-id="d9ca4-324">validation</span><span class="sxs-lookup"><span data-stu-id="d9ca4-324">validation</span></span> | <span data-ttu-id="d9ca4-325">Указывает алгоритм, используемый для проверки.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-325">Indicates the algorithm used for validation.</span></span> <span data-ttu-id="d9ca4-326">Этот атрибут может иметь одно из следующих четырех значений:-AES-использует алгоритм AES (AES).</span><span class="sxs-lookup"><span data-stu-id="d9ca4-326">This attribute can have one of the following four values: - AES - uses the Advanced Encryption Standard (AES) algorithm.</span></span> <span data-ttu-id="d9ca4-327">-MD5 — использует алгоритм [Message-Digest 5 (MD5)](http://en.wikipedia.org/wiki/MD5) .</span><span class="sxs-lookup"><span data-stu-id="d9ca4-327">- MD5 - uses the [Message-Digest 5 (MD5)](http://en.wikipedia.org/wiki/MD5) algorithm.</span></span> <span data-ttu-id="d9ca4-328">-SHA1 — использует алгоритм [SHA1](http://en.wikipedia.org/wiki/Sha1) (по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="d9ca4-328">- SHA1 - uses the [SHA1](http://en.wikipedia.org/wiki/Sha1) algorithm (the default).</span></span> <span data-ttu-id="d9ca4-329">-3DES — использует алгоритм Triple DES.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-329">- 3DES - uses the Triple DES algorithm.</span></span> |
| <span data-ttu-id="d9ca4-330">валидатионкэй</span><span class="sxs-lookup"><span data-stu-id="d9ca4-330">validationKey</span></span> | <span data-ttu-id="d9ca4-331">Секретный ключ, используемый алгоритмом проверки.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-331">The secret key used by the validation algorithm.</span></span> <span data-ttu-id="d9ca4-332">Это значение должно быть шестнадцатеричной строкой соответствующей длины (в зависимости от значения в проверке), автоматическим созданием или любым из значений, добавленных с помощью, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-332">This value must either be a hexadecimal string of the appropriate length (based on the value in validation), AutoGenerate, or either value appended with,IsolateApps.</span></span> <span data-ttu-id="d9ca4-333">Добавление IsolateApps указывает ASP.NET использовать уникальное значение для каждого приложения.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-333">Adding IsolateApps instructs ASP.NET to use a unique value for each application.</span></span> <span data-ttu-id="d9ca4-334">Значение по умолчанию — Автоформирование, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-334">The default is AutoGenerate,IsolateApps.</span></span> |

<span data-ttu-id="d9ca4-335">**Таблица 2**. атрибуты элемента &lt;machineKey&gt;</span><span class="sxs-lookup"><span data-stu-id="d9ca4-335">**Table 2**: The &lt;machineKey&gt; Element Attributes</span></span>

<span data-ttu-id="d9ca4-336">Подробное обсуждение этих вариантов шифрования и проверки, а также достоинств и недостатков различных алгоритмов выходит за рамки этого руководства.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-336">A thorough discussion of these encryption and validation options, and the pros and cons of the various algorithms, is beyond the scope of this tutorial.</span></span> <span data-ttu-id="d9ca4-337">Подробные сведения об этих проблемах, в том числе рекомендации по использованию алгоритмов шифрования и проверки, используемых ключей, а также рекомендации по созданию этих ключей, см. в статье *профессиональная ASP.NET 2,0 Security, Membership и Role Management*.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-337">For an in-depth look at these issues, including guidance on what encryption and validation algorithms to use, what key lengths to use, and how best to generate these keys, refer to *Professional ASP.NET 2.0 Security, Membership, and Role Management*.</span></span>

<span data-ttu-id="d9ca4-338">По умолчанию ключи, используемые для шифрования и проверки, создаются автоматически для каждого приложения, и эти ключи хранятся в локальном центре безопасности (LSA).</span><span class="sxs-lookup"><span data-stu-id="d9ca4-338">By default, the keys used for encryption and validation are generated automatically for each application, and these keys are stored in the Local Security Authority (LSA).</span></span> <span data-ttu-id="d9ca4-339">Вкратце, параметры по умолчанию гарантируют уникальность ключей на веб-сервере, а также на уровне приложений.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-339">In short, the default settings guarantee unique keys on a web server-by-web server and application-by-application basis.</span></span> <span data-ttu-id="d9ca4-340">Следовательно, это поведение по умолчанию не будет работать в двух следующих сценариях:</span><span class="sxs-lookup"><span data-stu-id="d9ca4-340">Consequently, this default behavior will not work for the two following scenarios:</span></span>

- <span data-ttu-id="d9ca4-341">**Веб** -фермы — в сценарии [веб-фермы](http://en.wikipedia.org/wiki/Web_farm) одно веб-приложение размещается на нескольких веб-серверах в целях масштабируемости и избыточности.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-341">**Web Farms** - in a [web farm](http://en.wikipedia.org/wiki/Web_farm) scenario, a single web application is hosted on multiple web servers for purposes of scalability and redundancy.</span></span> <span data-ttu-id="d9ca4-342">Каждый входящий запрос отправляется на сервер в ферме, то есть в течение времени существования сеанса пользователя разные серверы могут обрабатывать различные запросы.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-342">Each incoming request is dispatched to a server in the farm, meaning that over the lifetime of a user's session, different servers may be used to handle his various requests.</span></span> <span data-ttu-id="d9ca4-343">Следовательно, каждый сервер должен использовать одинаковые ключи шифрования и проверки, чтобы билет проверки подлинности форм, созданный, зашифрованный и проверенный на одном сервере, можно было расшифровать и проверить на другом сервере в ферме.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-343">Consequently, each server must use the same encryption and validation keys so that the forms authentication ticket created, encrypted, and validated on one server can be decrypted and validated on a different server in the farm.</span></span>
- <span data-ttu-id="d9ca4-344">**Совместное использование билета между приложениями** . на одном веб-сервере может размещаться несколько ASP.NET приложений.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-344">**Cross Application Ticket Sharing** - a single web server may host multiple ASP.NET applications.</span></span> <span data-ttu-id="d9ca4-345">Если вам необходимо, чтобы эти приложения совместно используют один билет проверки подлинности с помощью форм, обязательно сопоставьте ключи шифрования и проверки.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-345">If you need for these different applications to share a single forms authentication ticket, it is imperative that their encryption and validation keys match up.</span></span>

<span data-ttu-id="d9ca4-346">При работе с параметром веб-фермы или совместном использовании билетов проверки подлинности в приложениях на одном сервере необходимо настроить элемент &lt;machineKey&gt; в затронутых приложениях таким образом, чтобы значения Декриптионкэй и Валидатионкэй совпадали.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-346">When working in a web farm setting or sharing authentication tickets across applications on the same server, you will need to configure the &lt;machineKey&gt; element in the affected applications so that their decryptionKey and validationKey values match up.</span></span>

<span data-ttu-id="d9ca4-347">Хотя ни один из описанных выше сценариев не применяется к нашему примеру приложения, мы можем указать явные значения Декриптионкэй и Валидатионкэй и определить используемые алгоритмы.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-347">While neither of the above scenarios applies to our sample application, we can still specify explicit decryptionKey and validationKey values and define the algorithms to be used.</span></span> <span data-ttu-id="d9ca4-348">Добавьте параметр &lt;machineKey&gt; в файл Web. config:</span><span class="sxs-lookup"><span data-stu-id="d9ca4-348">Add a &lt;machineKey&gt; setting to the Web.config file:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample5.xml)]

<span data-ttu-id="d9ca4-349">Дополнительные сведения см. в [инструкции по настройке machineKey в ASP.NET 2,0](https://msdn.microsoft.com/library/ms998288.aspx).</span><span class="sxs-lookup"><span data-stu-id="d9ca4-349">For more information check out [How To: Configure MachineKey in ASP.NET 2.0](https://msdn.microsoft.com/library/ms998288.aspx).</span></span>

> [!NOTE]
> <span data-ttu-id="d9ca4-350">Значения Декриптионкэй и Валидатионкэй были взяты из [веб-страницы с превосходными паролями](https://www.grc.com/passwords.htm) [Стива Гибсона](http://www.grc.com/stevegibson.htm), которая создает 64 случайных шестнадцатеричных символов на каждом посещении страницы.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-350">The decryptionKey and validationKey values were taken from [Steve Gibson](http://www.grc.com/stevegibson.htm)'s [Perfect Passwords web page](https://www.grc.com/passwords.htm), which generates 64 random hexadecimal characters on each page visit.</span></span> <span data-ttu-id="d9ca4-351">Чтобы уменьшить вероятность того, что эти ключи переносятся в рабочие приложения, рекомендуется заменить приведенные выше ключи на страницы, созданные случайным образом, на странице «идеальные пароли».</span><span class="sxs-lookup"><span data-stu-id="d9ca4-351">To lessen the likelihood of these keys making their way into your production applications, you are encouraged to replace the above keys with randomly generated ones from the Perfect Passwords page.</span></span>

## <a name="step-4-storing-additional-user-data-in-the-ticket"></a><span data-ttu-id="d9ca4-352">Шаг 4. сохранение дополнительных данных пользователя в билете</span><span class="sxs-lookup"><span data-stu-id="d9ca4-352">Step 4: Storing Additional User Data in the Ticket</span></span>

<span data-ttu-id="d9ca4-353">Во многих веб-приложениях отображается информация о странице и ее отображение для текущего пользователя.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-353">Many web applications display information about or base the page's display on the currently logged on user.</span></span> <span data-ttu-id="d9ca4-354">Например, на веб-странице может отображаться имя пользователя и Дата последнего входа в верхний угол каждой страницы.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-354">For example, a web page might show the user's name and the date she last logged on in the upper corner of every page.</span></span> <span data-ttu-id="d9ca4-355">Билет проверки подлинности на основе форм хранит имя пользователя, выполнившего вход в систему, но если требуются другие сведения, страница должна попасть в хранилище пользователя — обычно это база данных для поиска информации, не хранящейся в билете проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-355">The forms authentication ticket stores the currently logged on user's username, but when any other information is needed, the page must go to the user store - typically a database - to lookup the information not stored in the authentication ticket.</span></span>

<span data-ttu-id="d9ca4-356">С небольшой частью кода мы можем хранить дополнительную информацию о пользователях в билете проверки подлинности с помощью форм.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-356">With a little bit of code we can store additional user information in the forms authentication ticket.</span></span> <span data-ttu-id="d9ca4-357">Такие данные могут быть выражены с помощью [свойства UserData](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.userdata.aspx) [класса формсаусентикатионтиккет](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.aspx).</span><span class="sxs-lookup"><span data-stu-id="d9ca4-357">Such data can be expressed through the [FormsAuthenticationTicket class](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.aspx)'s [UserData property](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.userdata.aspx).</span></span> <span data-ttu-id="d9ca4-358">Это полезное место для размещения небольших объемов сведений о пользователе, который часто требуется.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-358">This is a useful place to put small amounts of information about the user that is commonly needed.</span></span> <span data-ttu-id="d9ca4-359">Значение, указанное в свойстве UserData, включается как часть файла cookie билета проверки подлинности, а, как и другие поля билетов, шифруется и проверяется на основе конфигурации системы проверки подлинности форм.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-359">The value specified in the UserData property is included as part of the authentication ticket cookie and, like the other ticket fields, is encrypted and validated based on the forms authentication system's configuration.</span></span> <span data-ttu-id="d9ca4-360">По умолчанию UserData является пустой строкой.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-360">By default, UserData is an empty string.</span></span>

<span data-ttu-id="d9ca4-361">Чтобы сохранить данные пользователя в билете проверки подлинности, необходимо написать небольшой код на странице входа, который извлекает сведения о пользователе и сохраняет их в билете.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-361">In order to store user data in the authentication ticket, we need to write a bit of code in the login page that grabs the user-specific information and stores it in the ticket.</span></span> <span data-ttu-id="d9ca4-362">Так как UserData является свойством типа String, хранящиеся в нем данные должны быть правильно сериализованы как строка.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-362">Since UserData is a property of type String, the data stored in it must be properly serialized as a string.</span></span> <span data-ttu-id="d9ca4-363">Например, представьте, что наш магазин пользователей включал дату рождения каждого пользователя и имя своего работодателя, и мы хотели сохранить эти два значения свойств в билете проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-363">For example, imagine that our user store included each user's date of birth and the name of their employer, and we wanted to store these two property values in the authentication ticket.</span></span> <span data-ttu-id="d9ca4-364">Можно сериализовать эти значения в строку путем сцепления даты рождения пользователя с каналом (|), за которым следует имя работодателя.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-364">We could serialize these values into a string by concatenating the user's date of birth's string with a pipe ( | ), followed by the employer name.</span></span> <span data-ttu-id="d9ca4-365">Для пользователя, выпущенного 15 августа 1974, который работает для компании Northwind Traders, мы присваиваем свойству UserData строку: 1974-08-15 | Борей.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-365">For a user born on August 15, 1974 that works for Northwind Traders, we would assign the UserData property the string: 1974-08-15|Northwind Traders .</span></span>

<span data-ttu-id="d9ca4-366">Когда нам нужно получить доступ к данным, хранящимся в билете, мы можем сделать это, заменив Формсаусентикатионтиккет текущего запроса и выполнив десериализацию свойства UserData.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-366">Whenever we need to access the data stored in the ticket, we can do so by grabbing the current request's FormsAuthenticationTicket and deserializing the UserData property.</span></span> <span data-ttu-id="d9ca4-367">В примере даты рождения и имени работодателя мы разделит строку UserData на две подстроки на основе разделителя (|).</span><span class="sxs-lookup"><span data-stu-id="d9ca4-367">In the case of the date of birth and employer name example, we would split the UserData string into two substrings based on the delimiter ( | ).</span></span>

<span data-ttu-id="d9ca4-368">[![дополнительные сведения о пользователе можно хранить в билете проверки подлинности.](forms-authentication-configuration-and-advanced-topics-vb/_static/image11.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="d9ca4-368">[![Additional User Information Can Be Stored in the Authentication Ticket](forms-authentication-configuration-and-advanced-topics-vb/_static/image11.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image10.png)</span></span>

<span data-ttu-id="d9ca4-369">**Рис. 04**. Дополнительные сведения о пользователе можно хранить в билете проверки подлинности ([щелкните, чтобы просмотреть изображение с полным размером](forms-authentication-configuration-and-advanced-topics-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="d9ca4-369">**Figure 04**: Additional User Information Can Be Stored in the Authentication Ticket ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image12.png))</span></span>

### <a name="writing-information-to-userdata"></a><span data-ttu-id="d9ca4-370">Запись сведений в UserData</span><span class="sxs-lookup"><span data-stu-id="d9ca4-370">Writing Information to UserData</span></span>

<span data-ttu-id="d9ca4-371">К сожалению, Добавление сведений о пользователе в билет проверки подлинности на основе форм не так просто, как может показаться.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-371">Unfortunately, adding user-specific information to a forms authentication ticket is not as straightforward as one might expect.</span></span> <span data-ttu-id="d9ca4-372">Свойство UserData класса Формсаусентикатионтиккет доступно только для чтения и может быть задано только с помощью конструктора класса Формсаусентикатионтиккет.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-372">The UserData property of the FormsAuthenticationTicket class is read-only and can only be specified through the FormsAuthenticationTicket class constructor.</span></span> <span data-ttu-id="d9ca4-373">При указании свойства UserData в конструкторе также необходимо предоставить другие значения билета: имя пользователя, Дата выпуска, срок действия и т. д.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-373">When specifying the UserData property in the constructor, we also need to provide the ticket's other values: the username, the issue date, the expiration, and so on.</span></span> <span data-ttu-id="d9ca4-374">Когда мы создали страницу входа в предыдущем руководстве, все было обработано для нас классом FormsAuthentication.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-374">When we created the login page in the preceding tutorial, this was all handled for us by the FormsAuthentication class.</span></span> <span data-ttu-id="d9ca4-375">При добавлении UserData в Формсаусентикатионтиккет необходимо написать код для репликации большей части функций, уже предоставляемых классом FormsAuthentication.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-375">When adding UserData to the FormsAuthenticationTicket, we will need to write code to replicate much of the functionality already provided by the FormsAuthentication class.</span></span>

<span data-ttu-id="d9ca4-376">Давайте рассмотрим необходимый код для работы с UserData, обновив страницу Login. aspx, чтобы записать дополнительные сведения о пользователе в билет проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-376">Let's explore the necessary code for working with UserData by updating the Login.aspx page to record additional information about the user to the authentication ticket.</span></span> <span data-ttu-id="d9ca4-377">Представьте, что магазин пользователей содержит информацию о компании, в которой работает пользователь, и ее название, и что мы хотим записать эти сведения в билет проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-377">Pretend that our user store contains information about the company the user works for and their title, and that we want to capture this information in the authentication ticket.</span></span> <span data-ttu-id="d9ca4-378">Обновите обработчик событий Логинбуттон Click на странице login. aspx, чтобы код выглядел следующим образом:</span><span class="sxs-lookup"><span data-stu-id="d9ca4-378">Update the Login.aspx page's LoginButton Click event handler so that the code looks like the following:</span></span>

[!code-vb[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample6.vb)]

<span data-ttu-id="d9ca4-379">Давайте проверим этот код по одной строке за раз.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-379">Let's step through this code one line at a time.</span></span> <span data-ttu-id="d9ca4-380">Метод начинается с определения четырех массивов строк: Users, Passwords, companyName и Титлеаткомпани.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-380">The method starts by defining four string arrays: users, passwords, companyName, and titleAtCompany.</span></span> <span data-ttu-id="d9ca4-381">Эти массивы содержат имена пользователей, пароли, названия компаний и заголовки для учетных записей пользователей в системе, в которых есть три: Скотт, Цзисунь и SAM.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-381">These arrays hold the usernames, passwords, company names, and titles for the user accounts in the system, of which there are three: Scott, Jisun, and Sam.</span></span> <span data-ttu-id="d9ca4-382">В реальных приложениях эти значения будут запрашиваться из хранилища пользователя, а не жестко запрограммированы в исходном коде страницы.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-382">In a real application, these values would be queried from the user store, not hard-coded in the page's source code.</span></span>

<span data-ttu-id="d9ca4-383">В предыдущем учебнике, если предоставленные учетные данные были допустимыми, мы просто назвали FormsAuthentication. RedirectFromLoginPage (UserName. Text, RememberMe. Checked), которые выполнили следующие действия:</span><span class="sxs-lookup"><span data-stu-id="d9ca4-383">In the previous tutorial, if the supplied credentials were valid we simply called FormsAuthentication.RedirectFromLoginPage(UserName.Text, RememberMe.Checked), which performed the following steps:</span></span>

1. <span data-ttu-id="d9ca4-384">Создан билет проверки подлинности форм</span><span class="sxs-lookup"><span data-stu-id="d9ca4-384">Created the forms authentication ticket</span></span>
2. <span data-ttu-id="d9ca4-385">Записал билет в соответствующее хранилище.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-385">Wrote the ticket to the appropriate store.</span></span> <span data-ttu-id="d9ca4-386">Для билетов проверки подлинности на основе файлов cookie используется коллекция файлов cookie браузера. для билетов проверки подлинности без файлов cookie данные билета сериализуются в URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-386">For cookies-based authentication tickets, the browser's cookies collection is used; for cookieless authentication tickets, the ticket data is serialized into the URL</span></span>
3. <span data-ttu-id="d9ca4-387">Перенаправляет пользователя на соответствующую страницу</span><span class="sxs-lookup"><span data-stu-id="d9ca4-387">Redirected the user to the appropriate page</span></span>

<span data-ttu-id="d9ca4-388">Эти шаги реплицируются в приведенном выше коде.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-388">These steps are replicated in the code above.</span></span> <span data-ttu-id="d9ca4-389">Во-первых, строка, которая в конечном итоге будет храниться в свойстве UserData, сохранится путем объединения названия и названия компании, разделяющих эти значения символом вертикальной черты (|).</span><span class="sxs-lookup"><span data-stu-id="d9ca4-389">First, the string we will eventually store in the UserData property is formed by combining the company name and the title, delimiting the two values with a pipe character ( | ).</span></span>

<span data-ttu-id="d9ca4-390">Dim Усердатастринг As String = String. Concat (companyName (i), "|", Титлеаткомпани (i))</span><span class="sxs-lookup"><span data-stu-id="d9ca4-390">Dim userDataString As String = String.Concat(companyName(i), "|", titleAtCompany(i))</span></span>

<span data-ttu-id="d9ca4-391">Затем вызывается метод FormsAuthentication. Жетаускукие, который создает билет проверки подлинности, шифрует и проверяет его в соответствии с параметрами конфигурации и помещает его в объект HttpCookie.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-391">Next, the FormsAuthentication.GetAuthCookie method is invoked, which creates the authentication ticket, encrypts and validates it according to the configuration settings, and places it in an HttpCookie object.</span></span>

<span data-ttu-id="d9ca4-392">Dim authCookie As HttpCookie = FormsAuthentication.GetAuthCookie(UserName.Text, RememberMe.Checked)</span><span class="sxs-lookup"><span data-stu-id="d9ca4-392">Dim authCookie As HttpCookie = FormsAuthentication.GetAuthCookie(UserName.Text, RememberMe.Checked)</span></span>

<span data-ttu-id="d9ca4-393">Чтобы работать с Формаусентикатионтиккет, внедренными в файл cookie, необходимо вызвать [метод дешифровки](https://msdn.microsoft.com/library/system.web.security.formsauthentication.decrypt.aspx)класса формаусентикатион, передав значение cookie.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-393">In order to work with the FormAuthenticationTicket embedded within the cookie, we need to call the FormAuthentication class's [Decrypt method](https://msdn.microsoft.com/library/system.web.security.formsauthentication.decrypt.aspx), passing in the cookie value.</span></span>

<span data-ttu-id="d9ca4-394">Dim Ticket AS Формсаусентикатионтиккет = FormsAuthentication. дешифровки (Аускукие. Value)</span><span class="sxs-lookup"><span data-stu-id="d9ca4-394">Dim ticket As FormsAuthenticationTicket = FormsAuthentication.Decrypt(authCookie.Value)</span></span>

<span data-ttu-id="d9ca4-395">Затем мы создадим *Новый* экземпляр формсаусентикатионтиккет на основе существующих значений формсаусентикатионтиккет.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-395">We then create a *new* FormsAuthenticationTicket instance based on the existing FormsAuthenticationTicket's values.</span></span> <span data-ttu-id="d9ca4-396">Однако этот новый билет включает сведения, относящиеся к пользователю (Усердатастринг).</span><span class="sxs-lookup"><span data-stu-id="d9ca4-396">However, this new ticket includes the user-specific information (userDataString).</span></span>

<span data-ttu-id="d9ca4-397">Dim Невтиккет AS Формсаусентикатионтиккет = New Формсаусентикатионтиккет (билет. Версия, билет. Имя, билет. Иссуедате, билет. Срок действия, билет. Persistent, Усердатастринг)</span><span class="sxs-lookup"><span data-stu-id="d9ca4-397">Dim newTicket As FormsAuthenticationTicket = New FormsAuthenticationTicket(ticket.Version, ticket.Name, ticket.IssueDate, ticket.Expiration, ticket.IsPersistent, userDataString)</span></span>

<span data-ttu-id="d9ca4-398">Затем мы шифруют (и проверяйте) новый экземпляр Формсаусентикатионтиккет, вызывая [метод Encrypt](https://msdn.microsoft.com/library/system.web.security.formsauthentication.encrypt.aspx), и помещаю эти зашифрованные (и проверенные) данные обратно в аускукие.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-398">We then encrypt (and validate) the new FormsAuthenticationTicket instance by calling the [Encrypt method](https://msdn.microsoft.com/library/system.web.security.formsauthentication.encrypt.aspx), and put this encrypted (and validated) data back into authCookie.</span></span>

<span data-ttu-id="d9ca4-399">authCookie.Value = FormsAuthentication.Encrypt(newTicket)</span><span class="sxs-lookup"><span data-stu-id="d9ca4-399">authCookie.Value = FormsAuthentication.Encrypt(newTicket)</span></span>

<span data-ttu-id="d9ca4-400">Наконец, Аускукие добавляется в коллекцию Response. cookies и вызывается метод Жетредиректурл для определения соответствующей страницы для отправки пользователя.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-400">Finally, authCookie is added to the Response.Cookies collection and the GetRedirectUrl method is called to determine the appropriate page to send the user.</span></span>

[!code-vb[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample7.vb)]

<span data-ttu-id="d9ca4-401">Весь этот код необходим, так как свойство UserData доступно только для чтения, а класс FormsAuthentication не предоставляет методов для указания сведений о UserData в своих методах Жетаускукие, Сетаускукие или RedirectFromLoginPage.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-401">All of this code is needed because the UserData property is read-only and the FormsAuthentication class does not provide any methods for specifying UserData information in its GetAuthCookie, SetAuthCookie, or RedirectFromLoginPage methods.</span></span>

> [!NOTE]
> <span data-ttu-id="d9ca4-402">Только что проверенный код хранит сведения о пользователе в билете проверки подлинности на основе файлов cookie.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-402">The code we just examined stores user-specific information in a cookies-based authentication ticket.</span></span> <span data-ttu-id="d9ca4-403">Классы, отвечающие за сериализацию билета проверки подлинности форм на URL-адрес, являются внутренними для .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-403">The classes responsible for serializing the forms authentication ticket to the URL are internal to the .NET Framework.</span></span> <span data-ttu-id="d9ca4-404">Короткая история, не позволяет хранить данные пользователя в билете проверки подлинности форм без файлов cookie.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-404">Long story short, you cannot store user data in a cookieless forms authentication ticket.</span></span>

### <a name="accessing-the-userdata-information"></a><span data-ttu-id="d9ca4-405">Доступ к сведениям о UserData</span><span class="sxs-lookup"><span data-stu-id="d9ca4-405">Accessing the UserData Information</span></span>

<span data-ttu-id="d9ca4-406">На этом этапе имя и название организации каждого пользователя хранятся в свойстве "UserData" билета проверки подлинности форм при входе.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-406">At this point each user's company name and title is stored in the forms authentication ticket's UserData property when they log in.</span></span> <span data-ttu-id="d9ca4-407">Эти сведения можно получить из билета проверки подлинности на любой странице, не требуя обращения к хранилищу пользователей.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-407">This information can be accessed from the authentication ticket on any page without requiring a trip to the user store.</span></span> <span data-ttu-id="d9ca4-408">Чтобы продемонстрировать, как эти сведения можно получить из свойства UserData, давайте изменим Default. aspx так, чтобы приветственное сообщение состоять не только из имени пользователя, но и от компании, в которой он работает, и их названия.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-408">To illustrate how this information can be retrieved from the UserData property, let's update Default.aspx so that its welcome message includes not only the user's name, but also the company they work for and their title.</span></span>

<span data-ttu-id="d9ca4-409">В настоящее время Default. aspx содержит панель Аусентикатедмессажепанел с элементом управления Label с именем Велкомебаккмессаже.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-409">Currently, Default.aspx contains an AuthenticatedMessagePanel Panel with a Label control named WelcomeBackMessage.</span></span> <span data-ttu-id="d9ca4-410">Эта панель отображается только для пользователей, прошедших проверку подлинности.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-410">This Panel is only displayed to authenticated users.</span></span> <span data-ttu-id="d9ca4-411">Обновите код на странице Default. aspx,\_загрузить обработчик событий, чтобы он выглядел следующим образом:</span><span class="sxs-lookup"><span data-stu-id="d9ca4-411">Update the code in Default.aspx's Page\_Load event handler so that it looks like the following:</span></span>

[!code-vb[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample8.vb)]

<span data-ttu-id="d9ca4-412">Если параметр Request. IsTrue имеет значение true, то для свойства Text в Велкомебаккмессаже сначала задается значение "Добро пожаловать, *имя пользователя*".</span><span class="sxs-lookup"><span data-stu-id="d9ca4-412">If Request.IsAuthenticated is True, then the WelcomeBackMessage's Text property is first set to Welcome back, *username*.</span></span> <span data-ttu-id="d9ca4-413">Затем свойство User. Identity приводится к объекту FormsIdentity, чтобы можно было получить доступ к базовому Формсаусентикатионтиккет.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-413">Then, the User.Identity property is cast to a FormsIdentity object so that we can access the underlying FormsAuthenticationTicket.</span></span> <span data-ttu-id="d9ca4-414">Получив Формсаусентикатионтиккет, вы десериализуете свойство UserData в название и название компании.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-414">Once we have the FormsAuthenticationTicket, we deserialize the UserData property into the company name and title.</span></span> <span data-ttu-id="d9ca4-415">Это достигается путем разбиения строки на символ вертикальной черты.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-415">This is accomplished by splitting the string on the pipe character.</span></span> <span data-ttu-id="d9ca4-416">Название и название компании отображаются в метке Велкомебаккмессаже.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-416">The company name and title are then displayed in the WelcomeBackMessage Label.</span></span>

<span data-ttu-id="d9ca4-417">На рис. 5 показан снимок экрана, отображаемый в действии.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-417">Figure 5 shows a screenshot of this display in action.</span></span> <span data-ttu-id="d9ca4-418">При входе в систему как Скотт отображается приветственное сообщение, включающее в себя компанию и заголовок Скотта.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-418">Logging in as Scott displays a welcome back message that includes Scott's company and title.</span></span>

<span data-ttu-id="d9ca4-419">[![отображается название компании пользователя, выполнившего вход в систему, и заголовок](forms-authentication-configuration-and-advanced-topics-vb/_static/image14.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="d9ca4-419">[![The Currently Logged On User's Company and Title are Displayed](forms-authentication-configuration-and-advanced-topics-vb/_static/image14.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image13.png)</span></span>

<span data-ttu-id="d9ca4-420">**Рис. 05**. Отображение названия компании и заголовка текущего пользователя ([щелкните, чтобы просмотреть изображение с полным размером](forms-authentication-configuration-and-advanced-topics-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="d9ca4-420">**Figure 05**: The Currently Logged On User's Company and Title are Displayed ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image15.png))</span></span>

> [!NOTE]
> <span data-ttu-id="d9ca4-421">Свойство UserData билета проверки подлинности служит кэшем хранилища пользователей.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-421">The authentication ticket's UserData property serves as a cache for the user store.</span></span> <span data-ttu-id="d9ca4-422">Как и любой кэш, он должен быть обновлен при изменении базовых данных.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-422">Like any cache, it needs to be updated when the underlying data is modified.</span></span> <span data-ttu-id="d9ca4-423">Например, если имеется веб-страница, из которой пользователи могут обновлять свой профиль, поля, кэшированные в свойстве UserData, необходимо обновить, чтобы отразить изменения, внесенные пользователем.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-423">For example, if there is a web page from which users can update their profile, the fields cached in the UserData property must be refreshed to reflect the changes made by the user.</span></span>

## <a name="step-5-using-a-custom-principal"></a><span data-ttu-id="d9ca4-424">Шаг 5. Использование настраиваемого участника</span><span class="sxs-lookup"><span data-stu-id="d9ca4-424">Step 5: Using a Custom Principal</span></span>

<span data-ttu-id="d9ca4-425">Для каждого входящего запроса FormsAuthenticationModule пытается проверить подлинность пользователя.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-425">On each incoming request the FormsAuthenticationModule attempts to authenticate the user.</span></span> <span data-ttu-id="d9ca4-426">Если имеется неистекший билет проверки подлинности, FormsAuthenticationModule присваивает свойству HttpContext. User новый объект GenericPrincipal.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-426">If a non-expired authentication ticket is present, the FormsAuthenticationModule assigns the HttpContext.User property to a new GenericPrincipal object.</span></span> <span data-ttu-id="d9ca4-427">Этот объект GenericPrincipal имеет идентификатор типа FormsIdentity, который включает ссылку на билет проверки подлинности с помощью форм.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-427">This GenericPrincipal object has an Identity of type FormsIdentity, which includes a reference to the forms authentication ticket.</span></span> <span data-ttu-id="d9ca4-428">Класс GenericPrincipal содержит минимальную функциональность по определению, необходимую классу, реализующему IPrincipal. он просто имеет свойство Identity и метод IsInRole.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-428">The GenericPrincipal class contains the bare minimum functionality needed by a class that implements IPrincipal - it just has an Identity property and an IsInRole method.</span></span>

<span data-ttu-id="d9ca4-429">Объект Principal имеет две обязанности: для указания ролей, к которым принадлежит пользователь, и для предоставления сведений об удостоверениях.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-429">The principal object has two responsibilities: to indicate what roles the user belongs to and to provide identity information.</span></span> <span data-ttu-id="d9ca4-430">Это осуществляется с помощью метода IsInRole (*roleName*) интерфейса IPrincipal и свойства Identity соответственно.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-430">This is accomplished through the IPrincipal interface's IsInRole(*roleName*) method and Identity property, respectively.</span></span> <span data-ttu-id="d9ca4-431">Класс GenericPrincipal позволяет указать строковый массив имен ролей с помощью конструктора. его метод IsInRole (*roleName*) просто проверяет, существует ли переданный объект *roleName* в массиве строк.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-431">The GenericPrincipal class allows for a string array of role names to be specified via its constructor; its IsInRole(*roleName*) method merely checks to see if the passed in *roleName* exists within the string array.</span></span> <span data-ttu-id="d9ca4-432">Когда FormsAuthenticationModule создает GenericPrincipal, он передает в конструктор GenericPrincipal пустой строковый массив.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-432">When the FormsAuthenticationModule creates the GenericPrincipal, it passes in an empty string array to the GenericPrincipal's constructor.</span></span> <span data-ttu-id="d9ca4-433">Следовательно, любой вызов IsInRole всегда возвратит значение false.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-433">Consequently, any call to IsInRole will always return False.</span></span>

<span data-ttu-id="d9ca4-434">Класс GenericPrincipal соответствует потребностям большинства сценариев проверки подлинности на основе форм, в которых роли не используются.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-434">The GenericPrincipal class meets the needs for most forms based authentication scenarios where roles are not used.</span></span> <span data-ttu-id="d9ca4-435">В тех случаях, когда обработка ролей по умолчанию недостаточна или необходимо связать пользовательский объект IIdentity с пользователем, можно создать пользовательский объект IPrincipal во время рабочего процесса проверки подлинности и назначить его свойству HttpContext. User.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-435">For those situations where the default role handling is insufficient or when you need to associate a custom IIdentity object with the user, you can create a custom IPrincipal object during the authentication workflow and assign it to the HttpContext.User property.</span></span>

> [!NOTE]
> <span data-ttu-id="d9ca4-436">Как мы будем видеть в следующих учебных курсах, когда ASP. Инфраструктура ролей NET включена. она создает пользовательский объект Principal типа [ролепринЦипал](https://msdn.microsoft.com/library/system.web.security.roleprincipal.aspx) и перезаписывает объект GenericPrincipal, созданный с помощью проверки подлинности Forms.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-436">As we will see in future tutorials, when ASP.NET's Roles framework is enabled it creates a custom principal object of type [RolePrincipal](https://msdn.microsoft.com/library/system.web.security.roleprincipal.aspx) and overwrites the forms authentication-created GenericPrincipal object.</span></span> <span data-ttu-id="d9ca4-437">Это делается для того, чтобы настроить метод IsInRole субъекта для взаимодействия с API инфраструктуры ролей.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-437">It does this in order to customize the principal's IsInRole method to interface with the Roles framework's API.</span></span>

<span data-ttu-id="d9ca4-438">Так как мы не работаем с ролями, единственная причина, по которой нам нужно создать настраиваемый участник на этом присоединении к, — связать пользовательский объект IIdentity с участником.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-438">Since we have not concerned ourselves with roles yet, the only reason we would have for creating a custom principal at this juncture would be to associate a custom IIdentity object to the principal.</span></span> <span data-ttu-id="d9ca4-439">На шаге 4 мы рассматривали сохранение дополнительных сведений о пользователе в свойстве UserData билета проверки подлинности, в частности название компании пользователя и его название.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-439">In Step 4 we looked at storing additional user information in the authentication ticket's UserData property, in particular the user's company name and their title.</span></span> <span data-ttu-id="d9ca4-440">Однако сведения о UserData доступны только через билет проверки подлинности и затем только в виде сериализованной строки. Это означает, что в любой момент, когда нужно просмотреть сведения о пользователе, хранящиеся в билете, необходимо проанализировать свойство UserData.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-440">However, the UserData information is only accessible through the authentication ticket and only then as a serialized string, meaning that anytime we want to view the user information stored in the ticket we need to parse the UserData property.</span></span>

<span data-ttu-id="d9ca4-441">Мы можем улучшить взаимодействие с разработчиками, создав класс, который реализует IIdentity и включает свойства CompanyName и Title.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-441">We can improve the developer experience by creating a class that implements IIdentity and includes CompanyName and Title properties.</span></span> <span data-ttu-id="d9ca4-442">Таким образом, разработчик может получить доступ к имени компании и заголовку текущего пользователя непосредственно через свойства CompanyName и Title без необходимости знать, как анализировать свойство UserData.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-442">That way, a developer can access the currently logged on user's company name and title directly through the CompanyName and Title properties without needed to know how to parse the UserData property.</span></span>

### <a name="creating-the-custom-identity-and-principal-classes"></a><span data-ttu-id="d9ca4-443">Создание пользовательских удостоверений и классов-участников</span><span class="sxs-lookup"><span data-stu-id="d9ca4-443">Creating the Custom Identity and Principal Classes</span></span>

<span data-ttu-id="d9ca4-444">В этом руководстве мы создадим пользовательские объекты Principal и Identity в папке приложения\_Code.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-444">For this tutorial, let's create the custom principal and identity objects in the App\_Code folder.</span></span> <span data-ttu-id="d9ca4-445">Для начала добавьте в проект папку с кодом\_приложения. Щелкните правой кнопкой мыши имя проекта в обозреватель решений, выберите пункт Добавить папку ASP.NET и выберите приложение код\_.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-445">Start by adding an App\_Code folder to your project - right-click on the project name in Solution Explorer, select the Add ASP.NET Folder option, and choose App\_Code.</span></span> <span data-ttu-id="d9ca4-446">Папка кода приложения\_является специальной папкой ASP.NET, содержащей файлы классов, относящиеся к веб-сайту.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-446">The App\_Code folder is a special ASP.NET folder that holds class files specific to the website.</span></span>

> [!NOTE]
> <span data-ttu-id="d9ca4-447">Папку кода приложения\_следует использовать только при управлении проектом с помощью модели проекта веб-сайта.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-447">The App\_Code folder should only be used when managing your project through the Website Project Model.</span></span> <span data-ttu-id="d9ca4-448">Если вы используете [модель проекта веб-приложения](https://msdn.microsoft.com/asp.net/Aa336618.aspx), создайте стандартную папку и добавьте в нее классы.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-448">If you are using the [Web Application Project Model](https://msdn.microsoft.com/asp.net/Aa336618.aspx), create a standard folder and add the classes to that.</span></span> <span data-ttu-id="d9ca4-449">Например, можно добавить новую папку с именем classes и поместить в нее код.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-449">For example, you could add a new folder named Classes, and place your code there.</span></span>

<span data-ttu-id="d9ca4-450">Затем добавьте два новых файла класса в папку приложения\_с именем Кустомидентити. vb и одним именем CustomPrincipal. vb.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-450">Next, add two new class files to the App\_Code folder, one named CustomIdentity.vb and one named CustomPrincipal.vb.</span></span>

<span data-ttu-id="d9ca4-451">[![добавить классы Кустомидентити и CustomPrincipal в проект](forms-authentication-configuration-and-advanced-topics-vb/_static/image17.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="d9ca4-451">[![Add the CustomIdentity and CustomPrincipal Classes to Your Project](forms-authentication-configuration-and-advanced-topics-vb/_static/image17.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image16.png)</span></span>

<span data-ttu-id="d9ca4-452">**Рис. 6**. Добавление классов Кустомидентити и CustomPrincipal в проект ([щелкните, чтобы просмотреть изображение с полным размером](forms-authentication-configuration-and-advanced-topics-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="d9ca4-452">**Figure 06**: Add the CustomIdentity and CustomPrincipal Classes to Your Project ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image18.png))</span></span>

<span data-ttu-id="d9ca4-453">Класс Кустомидентити отвечает за реализацию интерфейса IIdentity, который определяет свойства AuthenticationType, Authenticator и Name.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-453">The CustomIdentity class is responsible for implementing the IIdentity interface, which defines the AuthenticationType, IsAuthenticated, and Name properties.</span></span> <span data-ttu-id="d9ca4-454">Помимо этих обязательных свойств мы заинтересованы предоставлять билет проверки подлинности на основе форм, а также свойства для имени и названия компании пользователя.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-454">In addition to those required properties, we are interested in exposing the underlying forms authentication ticket as well as properties for the user's company name and title.</span></span> <span data-ttu-id="d9ca4-455">Введите следующий код в класс Кустомидентити.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-455">Enter the following code into the CustomIdentity class.</span></span>

[!code-vb[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample9.vb)]

<span data-ttu-id="d9ca4-456">Обратите внимание, что класс содержит переменную-член Формсаусентикатионтиккет (\_билет) и что эти сведения должны быть указаны с помощью конструктора.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-456">Note that the class includes a FormsAuthenticationTicket member variable (\_ticket) and that this ticket information must be supplied through the constructor.</span></span> <span data-ttu-id="d9ca4-457">Эти данные билета используются при возврате имени удостоверения; Свойство UserData анализируется для получения значений для свойств CompanyName и Title.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-457">This ticket data is used in returning the identity's Name; its UserData property is parsed to return the values for the CompanyName and Title properties.</span></span>

<span data-ttu-id="d9ca4-458">Затем создайте класс CustomPrincipal.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-458">Next, create the CustomPrincipal class.</span></span> <span data-ttu-id="d9ca4-459">Так как мы не будем заниматься ролями на этом присоединении к, конструктор класса CustomPrincipal принимает только объект Кустомидентити; его метод IsInRole всегда возвращает значение false.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-459">Since we are not concerned with roles at this juncture, the CustomPrincipal class's constructor accepts only a CustomIdentity object; its IsInRole method always returns False.</span></span>

[!code-vb[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample10.vb)]

### <a name="assigning-a-customprincipal-object-to-the-incoming-requests-security-context"></a><span data-ttu-id="d9ca4-460">Назначение объекта CustomPrincipal контексту безопасности входящего запроса</span><span class="sxs-lookup"><span data-stu-id="d9ca4-460">Assigning a CustomPrincipal Object to the Incoming Request's Security Context</span></span>

<span data-ttu-id="d9ca4-461">Теперь у нас есть класс, который расширяет спецификацию IIdentity по умолчанию для включения свойств CompanyName и Title, а также пользовательского класса Principal, который использует настраиваемое удостоверение.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-461">We now have a class that extends the default IIdentity specification to include CompanyName and Title properties, as well as a custom principal class that uses the custom identity.</span></span> <span data-ttu-id="d9ca4-462">Мы готовы к пошаговому выполнению конвейера ASP.NET и назначению нашего пользовательского объекта Principal контексту безопасности входящего запроса.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-462">We are ready to step into the ASP.NET pipeline and assign our custom principal object to the incoming request's security context.</span></span>

<span data-ttu-id="d9ca4-463">Конвейер ASP.NET принимает входящий запрос и обрабатывает его с помощью ряда шагов.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-463">The ASP.NET pipeline takes an incoming request and processes it through a number of steps.</span></span> <span data-ttu-id="d9ca4-464">На каждом шаге создается определенное событие, которое позволяет разработчикам коснуться конвейера ASP.NET и изменить запрос в определенных точках жизненного цикла.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-464">At each step, a particular event is raised, making it possible for developers to tap into the ASP.NET pipeline and modify the request at certain points in its lifecycle.</span></span> <span data-ttu-id="d9ca4-465">FormsAuthenticationModule, например, ожидает от ASP.NET вызова [события AuthenticateRequest](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx), после чего он проверяет входящий запрос на наличие билета проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-465">The FormsAuthenticationModule, for example, waits for ASP.NET to raise the [AuthenticateRequest event](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx), at which point it inspects the incoming request for an authentication ticket.</span></span> <span data-ttu-id="d9ca4-466">Если найден билет проверки подлинности, создается объект GenericPrincipal, который назначается свойству HttpContext. User.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-466">If an authentication ticket is found, a GenericPrincipal object is created and assigned to the HttpContext.User property.</span></span>

<span data-ttu-id="d9ca4-467">После события AuthenticateRequest конвейер ASP.NET вызывает [событие PostAuthenticateRequest](https://msdn.microsoft.com/library/system.web.httpapplication.postauthenticaterequest.aspx), где мы можем заменить объект GenericPrincipal, созданный FormsAuthenticationModule, экземпляром нашего объекта CustomPrincipal.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-467">After the AuthenticateRequest event, the ASP.NET pipeline raises the [PostAuthenticateRequest event](https://msdn.microsoft.com/library/system.web.httpapplication.postauthenticaterequest.aspx), which is where we can replace the GenericPrincipal object created by the FormsAuthenticationModule with an instance of our CustomPrincipal object.</span></span> <span data-ttu-id="d9ca4-468">На рис. 7 показан этот рабочий процесс.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-468">Figure 7 depicts this workflow.</span></span>

<span data-ttu-id="d9ca4-469">[![GenericPrincipal заменяется CustomPrincipal в событии Постаусентикатионрекуест](forms-authentication-configuration-and-advanced-topics-vb/_static/image20.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="d9ca4-469">[![The GenericPrincipal is Replaced by a CustomPrincipal in the PostAuthenticationRequest Event](forms-authentication-configuration-and-advanced-topics-vb/_static/image20.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image19.png)</span></span>

<span data-ttu-id="d9ca4-470">**Рис. 07**. GenericPrincipal заменяется CustomPrincipal в событии Постаусентикатионрекуест ([щелкните, чтобы просмотреть изображение с полным размером](forms-authentication-configuration-and-advanced-topics-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="d9ca4-470">**Figure 07**: The GenericPrincipal is Replaced by a CustomPrincipal in the PostAuthenticationRequest Event ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image21.png))</span></span>

<span data-ttu-id="d9ca4-471">Чтобы выполнить код в ответ на событие конвейера ASP.NET, можно либо создать соответствующий обработчик событий в Global. asax, либо создать собственный модуль HTTP.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-471">In order to execute code in response to an ASP.NET pipeline event, we can either create the appropriate event handler in Global.asax or create our own HTTP Module.</span></span> <span data-ttu-id="d9ca4-472">В этом руководстве мы создадим обработчик событий в Global. asax.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-472">For this tutorial let's create the event handler in Global.asax.</span></span> <span data-ttu-id="d9ca4-473">Начните с добавления Global. asax на веб-сайт.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-473">Start by adding Global.asax to your website.</span></span> <span data-ttu-id="d9ca4-474">Щелкните правой кнопкой мыши имя проекта в обозреватель решений и добавьте элемент типа глобальный класс приложения с именем Global. asax.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-474">Right-click on the project name in Solution Explorer and add an item of type Global Application Class named Global.asax.</span></span>

<span data-ttu-id="d9ca4-475">[![добавить файл Global. asax на веб-сайт](forms-authentication-configuration-and-advanced-topics-vb/_static/image23.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="d9ca4-475">[![Add a Global.asax File to Your Website](forms-authentication-configuration-and-advanced-topics-vb/_static/image23.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image22.png)</span></span>

<span data-ttu-id="d9ca4-476">**Рис. 08**. Добавление файла Global. asax на веб-сайт ([щелкните, чтобы просмотреть изображение с полным размером](forms-authentication-configuration-and-advanced-topics-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="d9ca4-476">**Figure 08**: Add a Global.asax File to Your Website ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image24.png))</span></span>

<span data-ttu-id="d9ca4-477">Шаблон Global. asax по умолчанию включает обработчики событий для ряда событий конвейера ASP.NET, включая событие Start, End и [Error](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx), среди прочих.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-477">The default Global.asax template includes event handlers for a number of the ASP.NET pipeline events, including the Start, End and [Error event](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx), among others.</span></span> <span data-ttu-id="d9ca4-478">Вы можете удалить эти обработчики событий, так как они не нужны для этого приложения.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-478">Feel free to remove these event handlers, as we do not need them for this application.</span></span> <span data-ttu-id="d9ca4-479">Событие, которое мы заинтересованы, — это PostAuthenticateRequest.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-479">The event we are interested in is PostAuthenticateRequest.</span></span> <span data-ttu-id="d9ca4-480">Обновите файл Global. asax, чтобы его разметка наглядела следующим образом:</span><span class="sxs-lookup"><span data-stu-id="d9ca4-480">Update your Global.asax file so its markup looks similar to the following:</span></span>

[!code-aspx[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample11.aspx)]

<span data-ttu-id="d9ca4-481">Приложение\_метод Онпостаусентикатерекуест выполняется каждый раз, когда среда выполнения ASP.NET вызывает событие PostAuthenticateRequest, которое происходит один раз для каждого входящего запроса страницы.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-481">The Application\_OnPostAuthenticateRequest method executes each time the ASP.NET runtime raises the PostAuthenticateRequest event, which happens once on each incoming page request.</span></span> <span data-ttu-id="d9ca4-482">Обработчик событий начинает с проверки проверки подлинности пользователя и прошел проверку подлинности с помощью форм.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-482">The event handler starts by checking to see if the user is authenticated and was authenticated via forms authentication.</span></span> <span data-ttu-id="d9ca4-483">Если да, то создается новый объект Кустомидентити и ему передается билет проверки подлинности текущего запроса в конструкторе.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-483">If so, a new CustomIdentity object is created and passed the current request's authentication ticket in its constructor.</span></span> <span data-ttu-id="d9ca4-484">После этого создается объект CustomPrincipal и ему передается только что созданный объект Кустомидентити в своем конструкторе.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-484">Following that, a CustomPrincipal object is created and passed the just-created CustomIdentity object in its constructor.</span></span> <span data-ttu-id="d9ca4-485">Наконец, контекст безопасности текущего запроса назначается только что созданному объекту CustomPrincipal.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-485">Finally, the current request's security context is assigned to the newly created CustomPrincipal object.</span></span>

<span data-ttu-id="d9ca4-486">Обратите внимание, что последний шаг — связывание объекта CustomPrincipal с контекстом безопасности запроса — назначает участнику два свойства: HttpContext. User и Thread. CurrentPrincipal.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-486">Note that the last step - associating the CustomPrincipal object with the request's security context - assigns the principal to two properties: HttpContext.User and Thread.CurrentPrincipal.</span></span> <span data-ttu-id="d9ca4-487">Эти два назначения необходимы из-за способа обработки контекстов безопасности в ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-487">These two assignments are necessary because of the way security contexts are handled in ASP.NET.</span></span> <span data-ttu-id="d9ca4-488">.NET Framework связывает контекст безопасности с каждым выполняющимся потоком; Эти сведения доступны в виде объекта IPrincipal с помощью [свойства CurrentPrincipal](https://msdn.microsoft.com/library/system.threading.thread.currentcontext.aspx) [объекта потока](https://msdn.microsoft.com/library/system.threading.thread.aspx).</span><span class="sxs-lookup"><span data-stu-id="d9ca4-488">The .NET Framework associates a security context with each running thread; this information is available as an IPrincipal object through the [Thread object](https://msdn.microsoft.com/library/system.threading.thread.aspx)'s [CurrentPrincipal property](https://msdn.microsoft.com/library/system.threading.thread.currentcontext.aspx).</span></span> <span data-ttu-id="d9ca4-489">В этом состоит, что ASP.NET имеет собственную информацию о контексте безопасности (HttpContext. User).</span><span class="sxs-lookup"><span data-stu-id="d9ca4-489">What is a confusing is that ASP.NET has its own security context information (HttpContext.User).</span></span>

<span data-ttu-id="d9ca4-490">В некоторых сценариях свойство Thread. CurrentPrincipal проверяется при определении контекста безопасности. в других сценариях используется HttpContext. User.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-490">In certain scenarios, the Thread.CurrentPrincipal property is examined when determining the security context; in other scenarios, HttpContext.User is used.</span></span> <span data-ttu-id="d9ca4-491">Например, в .NET есть функции безопасности, позволяющие разработчикам декларативно определить, какие пользователи или роли могут создавать экземпляры класса или вызывать определенные методы (см. Дополнительные сведения о [добавлении правил авторизации к бизнес-слоям и уровням данных с помощью принЦипалпермиссионаттрибутес](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)).</span><span class="sxs-lookup"><span data-stu-id="d9ca4-491">For example, there are security features in .NET that allow developers to declaratively state what users or roles can instantiate a class or invoke specific methods (see [Adding Authorization Rules to Business and Data Layers Using PrincipalPermissionAttributes](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)).</span></span> <span data-ttu-id="d9ca4-492">Под ним эти декларативные методы определяют контекст безопасности с помощью свойства Thread. CurrentPrincipal.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-492">Underneath the covers, these declarative techniques determine the security context via the Thread.CurrentPrincipal property.</span></span>

<span data-ttu-id="d9ca4-493">В других сценариях используется свойство HttpContext. User.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-493">In other scenarios, the HttpContext.User property is used.</span></span> <span data-ttu-id="d9ca4-494">Например, в предыдущем учебном курсе мы использовали это свойство для вывода имени пользователя, выполнившего вход в систему.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-494">For example, in the previous tutorial we used this property to display the currently logged on user's username.</span></span> <span data-ttu-id="d9ca4-495">Очевидно, что необходимо, чтобы сведения о контексте безопасности в свойствах Thread. CurrentPrincipal и HttpContext. User совпадали.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-495">Clearly, then, it is imperative that the security context information in the Thread.CurrentPrincipal and HttpContext.User properties match up.</span></span>

<span data-ttu-id="d9ca4-496">Среда выполнения ASP.NET автоматически синхронизирует эти значения свойств для нас.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-496">The ASP.NET runtime automatically syncs these property values for us.</span></span> <span data-ttu-id="d9ca4-497">Однако эта синхронизация выполняется после события AuthenticateRequest, но *до* события PostAuthenticateRequest.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-497">However, this synchronization occurs after the AuthenticateRequest event, but *before* the PostAuthenticateRequest event.</span></span> <span data-ttu-id="d9ca4-498">Следовательно, при добавлении пользовательского субъекта в событие PostAuthenticateRequest необходимо быть уверенным в том, чтобы вручную назначить метод Thread. CurrentPrincipal или else. CurrentPrincipal и HttpContext. User не синхронизирован. Более подробное обсуждение этой проблемы см. в разделе [context. User и. Thread. CurrentPrincipal](http://leastprivilege.com/2005/11/23/context-user-vs-thread-currentprincipal/) .</span><span class="sxs-lookup"><span data-stu-id="d9ca4-498">Consequently, when adding a custom principal in the PostAuthenticateRequest event we need to be certain to manually assign the Thread.CurrentPrincipal or else Thread.CurrentPrincipal and HttpContext.User will be out of sync. See [Context.User vs. Thread.CurrentPrincipal](http://leastprivilege.com/2005/11/23/context-user-vs-thread-currentprincipal/) for a more detailed discussion on this issue.</span></span>

### <a name="accessing-the-companyname-and-title-properties"></a><span data-ttu-id="d9ca4-499">Доступ к свойствам CompanyName и Title</span><span class="sxs-lookup"><span data-stu-id="d9ca4-499">Accessing the CompanyName and Title Properties</span></span>

<span data-ttu-id="d9ca4-500">Каждый раз, когда запрос прибывает и отправляется в подсистему ASP.NET, будет срабатывать обработчик событий Application\_Онпостаусентикатерекуест в Global. asax.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-500">Whenever a request arrives and is dispatched to the ASP.NET engine, the Application\_OnPostAuthenticateRequest event handler in Global.asax will fire.</span></span> <span data-ttu-id="d9ca4-501">Если запрос успешно прошел проверку подлинности с помощью FormsAuthenticationModule, обработчик событий создаст новый объект CustomPrincipal с объектом Кустомидентити на основе билета проверки подлинности с помощью форм.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-501">If the request has been successfully authenticated by the FormsAuthenticationModule, the event handler will create a new CustomPrincipal object with a CustomIdentity object based on the forms authentication ticket.</span></span> <span data-ttu-id="d9ca4-502">Благодаря этой логике доступ к сведениям о названии и названии компании пользователя, вошедшего в систему, чрезвычайно прост.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-502">With this logic in place, accessing information about the currently logged on user's company name and title is incredibly straightforward.</span></span>

<span data-ttu-id="d9ca4-503">Вернитесь на страницу\_загрузки обработчика событий в файле Default. aspx, где на шаге 4 мы написали код для получения билета проверки подлинности формы и анализа свойства UserData для отображения имени и названия компании пользователя.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-503">Return to the Page\_Load event handler in Default.aspx, where in Step 4 we wrote code to retrieve the form authentication ticket and parse the UserData property in order to display the user's company name and title.</span></span> <span data-ttu-id="d9ca4-504">Если объекты CustomPrincipal и Кустомидентити уже используются, то нет необходимости анализировать значения из свойства UserData билета.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-504">With the CustomPrincipal and CustomIdentity objects in use now, there's no need to parse the values out of the ticket's UserData property.</span></span> <span data-ttu-id="d9ca4-505">Вместо этого просто получите ссылку на объект Кустомидентити и используйте его свойства CompanyName и Title:</span><span class="sxs-lookup"><span data-stu-id="d9ca4-505">Instead, simply get a reference to the CustomIdentity object and use its CompanyName and Title properties:</span></span>

[!code-vb[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample12.vb)]

## <a name="summary"></a><span data-ttu-id="d9ca4-506">Сводка</span><span class="sxs-lookup"><span data-stu-id="d9ca4-506">Summary</span></span>

<span data-ttu-id="d9ca4-507">В этом учебнике мы рассмотрели, как настроить параметры системы проверки подлинности форм с помощью Web. config. Мы рассматривали обработку истечения срока действия билета проверки подлинности и использование мер шифрования и проверки для защиты билета от проверки и изменения.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-507">In this tutorial we examined how to customize the forms authentication system's settings via Web.config. We looked at how the authentication ticket's expiration is handled and how the encryption and validation safeguards are used to protect the ticket from inspection and modification.</span></span> <span data-ttu-id="d9ca4-508">Наконец, мы обсуждали использование свойства UserData билета проверки подлинности для хранения дополнительных сведений о пользователях в самом билете и использования настраиваемых объектов Principal и Identity для предоставления этой информации более понятным разработчикам.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-508">Finally, we discussed using the authentication ticket's UserData property to store additional user information in the ticket itself, and how to use custom principal and identity objects to expose this information in a more developer-friendly manner.</span></span>

<span data-ttu-id="d9ca4-509">В этом руководстве мы завершаем изучение проверки подлинности с помощью форм в ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-509">This tutorial concludes our examination of forms authentication in ASP.NET.</span></span> <span data-ttu-id="d9ca4-510">В следующем руководстве начинается наша структура членства.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-510">The next tutorial starts our journey into the Membership framework.</span></span>

<span data-ttu-id="d9ca4-511">Поздравляем с программированием!</span><span class="sxs-lookup"><span data-stu-id="d9ca4-511">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="d9ca4-512">Дополнительные материалы</span><span class="sxs-lookup"><span data-stu-id="d9ca4-512">Further Reading</span></span>

<span data-ttu-id="d9ca4-513">Дополнительные сведения о разделах, обсуждаемых в этом руководстве, см. в следующих ресурсах:</span><span class="sxs-lookup"><span data-stu-id="d9ca4-513">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="d9ca4-514">Проверка подлинности которая разбила Forms</span><span class="sxs-lookup"><span data-stu-id="d9ca4-514">Dissecting Forms Authentication</span></span>](http://aspnet.4guysfromrolla.com/articles/072005-1.aspx)
- [<span data-ttu-id="d9ca4-515">Описание: проверка подлинности с помощью форм в ASP.NET 2,0</span><span class="sxs-lookup"><span data-stu-id="d9ca4-515">Explained: Forms Authentication in ASP.NET 2.0</span></span>](https://msdn.microsoft.com/library/aa480476.aspx)
- [<span data-ttu-id="d9ca4-516">Как защитить проверку подлинности с помощью форм в ASP.NET 2,0</span><span class="sxs-lookup"><span data-stu-id="d9ca4-516">How To: Protect Forms Authentication in ASP.NET 2.0</span></span>](https://msdn.microsoft.com/library/ms998310.aspx)
- <span data-ttu-id="d9ca4-517">[Профессиональная ASP.NET 2,0 безопасность, членство и управление ролями](http://www.wrox.com/WileyCDA/WroxTitle/productCd-0764596985.html) (ISBN: 978-0-7645-9698-8)</span><span class="sxs-lookup"><span data-stu-id="d9ca4-517">[Professional ASP.NET 2.0 Security, Membership, and Role Management](http://www.wrox.com/WileyCDA/WroxTitle/productCd-0764596985.html) (ISBN: 978-0-7645-9698-8)</span></span>
- [<span data-ttu-id="d9ca4-518">Защита элементов управления входом</span><span class="sxs-lookup"><span data-stu-id="d9ca4-518">Securing Login Controls</span></span>](https://msdn.microsoft.com/library/ms178346.aspx)
- [<span data-ttu-id="d9ca4-519">Элемент&gt; проверки подлинности &lt;</span><span class="sxs-lookup"><span data-stu-id="d9ca4-519">The &lt;authentication&gt; Element</span></span>](https://msdn.microsoft.com/library/532aee0e.aspx)
- [<span data-ttu-id="d9ca4-520">Элемент&gt; &lt;Forms для проверки подлинности &lt;&gt;</span><span class="sxs-lookup"><span data-stu-id="d9ca4-520">The &lt;forms&gt; Element for &lt;authentication&gt;</span></span>](https://msdn.microsoft.com/library/1d3t3c61.aspx)
- [<span data-ttu-id="d9ca4-521">Элемент &lt;machineKey&gt;</span><span class="sxs-lookup"><span data-stu-id="d9ca4-521">The &lt;machineKey&gt; Element</span></span>](https://msdn.microsoft.com/library/w8h3skw9.aspx)
- [<span data-ttu-id="d9ca4-522">Общие сведения о билете проверки подлинности форм и файле cookie</span><span class="sxs-lookup"><span data-stu-id="d9ca4-522">Understanding the Forms Authentication Ticket and Cookie</span></span>](https://support.microsoft.com/kb/910443)

### <a name="video-training-on-topics-contained-in-this-tutorial"></a><span data-ttu-id="d9ca4-523">Видеообучение по темам, содержащимся в этом руководстве</span><span class="sxs-lookup"><span data-stu-id="d9ca4-523">Video Training on Topics Contained in this Tutorial</span></span>

- [<span data-ttu-id="d9ca4-524">Изменение свойств проверки подлинности на формах</span><span class="sxs-lookup"><span data-stu-id="d9ca4-524">How to Change the Forms Authentication Properties</span></span>](../../../videos/authentication/how-to-change-the-forms-authentication-properties.md)
- [<span data-ttu-id="d9ca4-525">Настройка и использование проверки подлинности без файлов cookie в приложении ASP.NET</span><span class="sxs-lookup"><span data-stu-id="d9ca4-525">How to Setup and Use Cookie-less Authentication in an ASP.NET Application</span></span>](../../../videos/authentication/how-to-setup-and-use-cookie-less-authentication-in-an-aspnet-application.md)
- [<span data-ttu-id="d9ca4-526">Перемещение входа с проверкой подлинности на основе форм в ASP</span><span class="sxs-lookup"><span data-stu-id="d9ca4-526">ASP Forms Login Relocation</span></span>](../../../videos/authentication/asp-forms-login-relocation.md)
- [<span data-ttu-id="d9ca4-527">Конфигурация пользовательского ключа для входа</span><span class="sxs-lookup"><span data-stu-id="d9ca4-527">Forms Login Custom Key Configuration</span></span>](../../../videos/authentication/forms-login-custom-key-configuration.md)
- [<span data-ttu-id="d9ca4-528">Добавление пользовательских данных в метод проверки подлинности</span><span class="sxs-lookup"><span data-stu-id="d9ca4-528">Add Custom Data to the Authentication Method</span></span>](../../../videos/authentication/add-custom-data-to-the-authentication-method.md)
- [<span data-ttu-id="d9ca4-529">Использование пользовательских объектов Principal</span><span class="sxs-lookup"><span data-stu-id="d9ca4-529">Use Custom Principal Objects</span></span>](../../../videos/authentication/use-custom-principal-objects.md)

### <a name="about-the-author"></a><span data-ttu-id="d9ca4-530">Об авторе</span><span class="sxs-lookup"><span data-stu-id="d9ca4-530">About the Author</span></span>

<span data-ttu-id="d9ca4-531">Скотт Митчелл, автор нескольких книг по ASP/ASP. NET и основатель 4GuysFromRolla.com, работал с веб-технологиями Майкрософт с 1998.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-531">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="d9ca4-532">Скотт работает как независимый консультант, преподаватель и модуль записи.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-532">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="d9ca4-533">Его последняя книга — *[Sams обучать себя ASP.NET 2,0 за 24 часа](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)* .</span><span class="sxs-lookup"><span data-stu-id="d9ca4-533">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="d9ca4-534">Скотт можно получить по адресу [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) или через свой блог по адресу [http://ScottOnWriting.NET](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="d9ca4-534">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="d9ca4-535">Специальная благодарность</span><span class="sxs-lookup"><span data-stu-id="d9ca4-535">Special Thanks To</span></span>

<span data-ttu-id="d9ca4-536">Эта серия руководств была рассмотрена многими полезными рецензентами.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-536">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="d9ca4-537">Специалист по интересу для этого руководства был Аликжа Мазиарз.</span><span class="sxs-lookup"><span data-stu-id="d9ca4-537">Lead reviewer for this tutorial was Alicja Maziarz.</span></span> <span data-ttu-id="d9ca4-538">Хотите ознакомиться с моими будущими статьями MSDN?</span><span class="sxs-lookup"><span data-stu-id="d9ca4-538">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="d9ca4-539">Если это так, расположите строку в [mitchell@4GuysFromRolla.com](mailto:mitchell@4guysfromrolla.com).</span><span class="sxs-lookup"><span data-stu-id="d9ca4-539">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4guysfromrolla.com).</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="d9ca4-540">Назад</span><span class="sxs-lookup"><span data-stu-id="d9ca4-540">Previous</span></span>](an-overview-of-forms-authentication-vb.md)
