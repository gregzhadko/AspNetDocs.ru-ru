---
uid: web-forms/overview/older-versions-security/admin/unlocking-and-approving-user-accounts-vb
title: Снятие блокировки и утверждение учетных записей пользователей (Visual Basic) | Документация Майкрософт
author: rick-anderson
description: Этом руководстве показано, как создавать веб-страницы управления для администраторов заблокирована и утверждены состояния пользователей. Мы также показано, как утвердить новый o пользователей...
ms.author: riande
ms.date: 04/01/2008
ms.assetid: 041854a5-ea8c-4de0-82f1-121ba6cb2893
msc.legacyurl: /web-forms/overview/older-versions-security/admin/unlocking-and-approving-user-accounts-vb
msc.type: authoredcontent
ms.openlocfilehash: 1f6ade517bda60ac0f44811853ee9b9d06070091
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/09/2019
ms.locfileid: "59384179"
---
# <a name="unlocking-and-approving-user-accounts-vb"></a>Снятие блокировки и утверждение учетных записей пользователей (VB)

по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Скачать код](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/VB.14.zip) или [скачать PDF](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/aspnet_tutorial14_UnlockAndApprove_vb.pdf)

> Этом руководстве показано, как создавать веб-страницы управления для администраторов заблокирована и утверждены состояния пользователей. Кроме того, мы увидим утверждение новых пользователей, только после проверки адреса электронной почты.


## <a name="introduction"></a>Вступление

Наряду с пользователя, пароль и адрес электронной почты, каждая учетная запись пользователя имеет два поля состояния, которые определяют, может ли пользователь войти на сайт: заблокирована и утверждены. Пользователь блокируется автоматически, если они предоставляют недопустимых учетных данных указанное число раз в течение указанного числа минут (по умолчанию блокировать пользователя после 5 попыток недопустимое имя для входа в течение 10 минут). Состояние утверждения полезен в сценариях, где должен пройти какое-либо действие, прежде чем пользователь сможет войти сайт. Например пользователь может потребоваться сначала проверьте свой адрес электронной почты или быть утвержден администратором, прежде чем он сможет входа.

Так как заблокированный out или не утвержденные невозможно выполнить вход пользователя, он является единственным естественного гадать, как можно восстановить эти состояния. ASP.NET не содержит никакой встроенной функциональности, или веб-элементы управления для управления пользователей заблокирована и частично утверждено состояния, так как эти решения необходимо обрабатывать на основе узла. Некоторые узлы могут автоматически утвердить все новые учетные записи пользователей (поведение по умолчанию). Другие попросите администратора утвердить новые учетные записи или не утверждение пользователей, пока они посетите ссылки, отправленной по адресу электронной почты, указанному во время регистрации. Аналогично некоторые узлы могут блокировать пользователей, пока администратор сбрасывает их состояние, то время как другие сайты отправлять сообщение электронной почты пользователю заблокированной URL-адрес, они могут посещать, чтобы разблокировать свою учетную запись.

Этом руководстве показано, как создавать веб-страницы управления для администраторов заблокирована и утверждены состояния пользователей. Кроме того, мы увидим утверждение новых пользователей, только после проверки адреса электронной почты.

## <a name="step-1-managing-users-locked-out-and-approved-statuses"></a>Шаг 1. Управление пользователями заблокирована и утверждены состояния

В <a id="Tutorial12"> </a> [ *Создание интерфейса для выбора одной учетной записи с помощью многих* ](building-an-interface-to-select-one-user-account-from-many-vb.md) руководстве, мы составили страницу, перечислявшую каждой учетной записи пользователя в разбитого на страницы, отфильтрованные GridView. В сетке приведен список имя каждого пользователя и адрес электронной почты, их состояние разрешенных и заблокированных out, находятся ли они в интерактивном режиме и комментарии о пользователе. Для управления пользователями утверждения и заблокирована состояний, можно сделать эту сетку редактирования. Чтобы изменить состояние утверждения для пользователя, администратор будет сначала найдите учетную запись пользователя и затем измените соответствующую строку GridView, устанавливая или снимая флажок утвержденных. Кроме того мы может управлять утвержденные, так и заблокированной состояния через отдельную страницу ASP.NET.

В этом руководстве давайте используются две страницы ASP.NET: `ManageUsers.aspx` и `UserInformation.aspx`. В данном случае, `ManageUsers.aspx` перечислены учетные записи пользователей в системе, хотя `UserInformation.aspx` администратор может управлять утвержденные, так и заблокированной состояния для определенного пользователя. Наши первым делом является дополнение элементов GridView в `ManageUsers.aspx` для включения поля HyperLinkField, который отображается в виде столбца ссылок. Мы хотим каждой ссылки, чтобы они указывали `UserInformation.aspx?user=UserName`, где *UserName* — это имя пользователя для редактирования.

> [!NOTE]
> Если вы загрузили код <a id="Tutorial13"> </a> [ *восстановление и изменение паролей* ](recovering-and-changing-passwords-vb.md) учебник, вы могли заметить, `ManageUsers.aspx` страница уже содержит набор " Управление» ссылки и `UserInformation.aspx` страница предоставляет интерфейс для изменения пароля выбранного пользователя. Я решил не реплицировать эту функциональность в коде, связанные с этим руководством, так как это работало, обход API членства и операционной напрямую с базой данных SQL Server для изменения пароля пользователя. Это руководство начинается с нуля, используя `UserInformation.aspx` страницы.


### <a name="adding-manage-links-to-theuseraccountsgridview"></a>Добавление «Manage» ссылки на`UserAccounts`GridView

Откройте `ManageUsers.aspx` странице и Добавление поля HyperLinkField к `UserAccounts` GridView. Установка для свойства `Text` свойства «Управление» и его `DataNavigateUrlFields` и `DataNavigateUrlFormatString` свойства `UserName` и «UserInformation.aspx?user={0}«, соответственно. Эти параметры позволяют настроить поле HyperLinkField таким образом, что все гиперссылки отображения текста «Manage», но каждая ссылка передается в соответствующий *UserName* значение в строку запроса.

После добавления HyperLinkField к элементу GridView, Отвлекитесь и просмотрите `ManageUsers.aspx` страницы в обозревателе. Как показано на рис. 1, каждая строка GridView теперь включает ссылку «Управление». Указывает ссылку «Управление» для Брюс `UserInformation.aspx?user=Bruce`, тогда как ссылка «Управление» для Дейв указывает `UserInformation.aspx?user=Dave`.


[![Tон добавляет HyperLinkField](unlocking-and-approving-user-accounts-vb/_static/image2.png)](unlocking-and-approving-user-accounts-vb/_static/image1.png)

**Рис. 1**: Поле HyperLinkField добавляет ссылку «Управление» для каждой учетной записи пользователя ([Просмотр полноразмерного изображения](unlocking-and-approving-user-accounts-vb/_static/image3.png))


Мы создадим пользовательского интерфейса и кода для `UserInformation.aspx` странице в данный момент, но сначала давайте разговоров о как программными средствами изменить пользователя заблокирована и утверждены состояния. [ `MembershipUser` Класс](https://msdn.microsoft.com/library/system.web.security.membershipuser.aspx) имеет [ `IsLockedOut` ](https://msdn.microsoft.com/library/system.web.security.membershipuser.islockedout.aspx) и [ `IsApproved` свойства](https://msdn.microsoft.com/library/system.web.security.membershipuser.isapproved.aspx). `IsLockedOut` Свойство доступно только для чтения. Отсутствует механизм для программно блокировки записи пользователя; Чтобы разблокировать пользователя, используйте `MembershipUser` класса [ `UnlockUser` метод](https://msdn.microsoft.com/library/system.web.security.membershipuser.unlockuser.aspx). `IsApproved` Свойство для чтения и записи. Чтобы сохранить любые изменения этого свойства, необходимо вызвать `Membership` класса [ `UpdateUser` метод](https://msdn.microsoft.com/library/system.web.security.membership.updateuser.aspx), передав в измененной `MembershipUser` объекта.

Так как `IsApproved` свойство для чтения и записи, элемент управления CheckBox, вероятно, является лучшим элемент пользовательского интерфейса для настройки этого свойства. Тем не менее, флажок не будет работать для `IsLockedOut` свойство так, как администратор не может заблокировать пользователя, она может разблокировать только пользователь. Это подходящий пользовательский интерфейс для `IsLockedOut` свойство — это кнопка, щелчок снимает блокировку учетной записи пользователя. Эту кнопку следует включать только в том случае, если пользователь будет заблокирован.

### <a name="creating-theuserinformationaspxpage"></a>Создание`UserInformation.aspx`страницы

Теперь мы готовы реализовать пользовательский интерфейс в `UserInformation.aspx`. Открыть эту страницу и добавьте следующие веб-элементов управления:

- Элемент управления гиперссылки, при нажатии возвращает администратору `ManageUsers.aspx` страницы.
- Метка веб-элемент управления для отображения имени выбранного пользователя. Задайте эту метку `ID` для `UserNameLabel` и очистите его свойства Text.
- Элемент управления CheckBox с именем `IsApproved`. Задайте его `AutoPostBack` свойства `True`.
- Элемент управления "Метка" для отображения пользователя последнего элемента заблокирована даты. Назовите эту метку `LastLockedOutDateLabel` и очистите его `Text` свойство.
- Кнопка для разблокировки пользователя. Имя этой кнопки `UnlockUserButton` и задайте его `Text` свойство «Разблокировать User».
- Элемент управления Label, для отображения сообщений о состоянии, такие как «состояние утверждения пользователя был обновлен.» Имя этого элемента управления `StatusMessage`снимите out его `Text` и установите его `CssClass` свойства `Important`. ( `Important` Класс CSS, определенные в `Styles.css` файла таблицы стилей; отображается соответствующий текст в большой красный шрифт.)

После добавления этих элементов управления, режиме конструктора в Visual Studio должен выглядеть на рисунке, на рис. 2.


[![CСоздание пользовательского интерфейса для UserInformation.aspx](unlocking-and-approving-user-accounts-vb/_static/image5.png)](unlocking-and-approving-user-accounts-vb/_static/image4.png)

**Рис. 2**: Создание пользовательского интерфейса для `UserInformation.aspx` ([Просмотр полноразмерного изображения](unlocking-and-approving-user-accounts-vb/_static/image6.png))


Полный пользовательский интерфейс, DAL следующей задачей является установка `IsApproved` флажок и другие элементы управления на основе выбранного пользователя сведений. Создайте обработчик событий для страницы `Load` событий и добавьте следующий код:

[!code-vb[Main](unlocking-and-approving-user-accounts-vb/samples/sample1.vb)]

Приведенный выше код начинается с обеспечения, что это первом посещении страницы и не последующих обратную передачу. Затем считывает имя пользователя, переданное через `user` поля строки запроса и извлекает сведения об этой учетной записи пользователя с помощью `Membership.GetUser(username)` метод. Если нет имени пользователя предоставлен через строку запроса, или если не удалось найти указанного пользователя, администратору будет отправлено обратно `ManageUsers.aspx` страницы.

`MembershipUser` Объекта `UserName` значение отображается в `UserNameLabel` и `IsApproved` флажок на основе `IsApproved` значение свойства.

`MembershipUser` Объекта [ `LastLockoutDate` свойство](https://msdn.microsoft.com/library/system.web.security.membershipuser.lastlockoutdate.aspx) возвращает `DateTime` значение, указывающее, когда последний пользователь заблокирован. Если пользователь никогда не был заблокирован, возвращаемое значение зависит от поставщика членства. При создании новой учетной записи, `SqlMembershipProvider` задает `aspnet_Membership` таблицы `LastLockoutDate` поле `1754-01-01 12:00:00 AM`. Приведенный выше код отображает пустую строку в `LastLockoutDateLabel` Если `LastLockoutDate` свойство предшествует год 2000, в противном случае — части даты `LastLockoutDate` свойство отображается в метке. `UnlockUserButton`В `Enabled` свойству пользователя заблокирована состояние, это означает, что эта кнопка будет включаться только если пользователь будет заблокирован.

Отвлекитесь и протестировать `UserInformation.aspx` страницы в обозревателе. Само собой, необходимо начать с `ManageUsers.aspx` и выберите учетную запись пользователя для управления. От поступающих `UserInformation.aspx`, обратите внимание, что `IsApproved` флажок проверяется только в том случае, если пользователь будет утвержден. Если пользователь никогда не был заблокирован, отображается последней блокировки записи даты. Кнопка Разблокировать пользователя становится доступен только в том случае, если пользователь в данный момент заблокирована. Устанавливая или снимая `IsApproved` флажок или нажмите кнопку Разблокировать пользователя вызывает обратную передачу, но не было изменений учетной записи пользователя, так как еще не создавать обработчики событий для этих событий.

Вернитесь в Visual Studio и создавать обработчики событий для `IsApproved` элемента CheckBox `CheckedChanged` событий и `UnlockUser` кнопки `Click` событий. В `CheckedChanged` обработчик событий, задайте пользователя `IsApproved` свойства `Checked` свойство элемента управления CheckBox, а затем сохранить изменения через вызов `Membership.UpdateUser`. В `Click` обработчик событий, простым вызовом `MembershipUser` объекта `UnlockUser` метод. В обоих обработчиков событий, отобразить соответствующее сообщение в `StatusMessage` метки.

[!code-vb[Main](unlocking-and-approving-user-accounts-vb/samples/sample2.vb)]

### <a name="testing-theuserinformationaspxpage"></a>Тестирование`UserInformation.aspx`страницы

В этих обработчиках событий в месте, вернемся к странице и «не утверждено» пользователя. Как показано на рис. 3, вы должны увидеть краткое сообщение на странице, означает, что пользователя `IsApproved` свойство изменена успешно.


[![Cинформационной системы персонала был не утверждено](unlocking-and-approving-user-accounts-vb/_static/image8.png)](unlocking-and-approving-user-accounts-vb/_static/image7.png)

**Рис. 3**: Крис был не утверждено ([Просмотр полноразмерного изображения](unlocking-and-approving-user-accounts-vb/_static/image9.png))


Далее выхода из системы и попробуйте войти в систему как пользователь, учетная запись которого было просто «не утверждено». Так как пользователь не утвержден, они не может выполнить вход. По умолчанию элемент управления Login отображает то же сообщение, если пользователь не может выполнить вход, независимо от причины. Однако в <a id="Tutorial6"> </a> [ *проверка пользователя учетные данные от членства пользователя Store* ](../membership/validating-user-credentials-against-the-membership-user-store-vb.md) учебном курсе было рассмаотрено улучшения элемента управления Login для отображения более подходящим сообщения. Как показано на рис. 4, Крис отображается сообщение о том, что он не может выполнить вход, так как его учетная запись еще не утверждено.


[![CНевозможно выполнить вход информационной системы персонала, поскольку его учетная запись не утверждено](unlocking-and-approving-user-accounts-vb/_static/image11.png)](unlocking-and-approving-user-accounts-vb/_static/image10.png)

**Рис. 4**: Крис невозможно из-за His является учетная запись входа не утверждено ([Просмотр полноразмерного изображения](unlocking-and-approving-user-accounts-vb/_static/image12.png))


Для тестирования функциональности заблокированной пытаются войти в систему как пользователь с правами утвержденных, но использовать неправильный пароль. Повторите эту процедуру необходимое количество раз, пока учетная запись пользователя заблокирована. Элемент управления Login также был изменен для отображения пользовательского сообщения, если попытка входа с помощью заблокированной учетной записи. Вы знаете, что учетная запись была заблокирована как только вы начнете видеть следующее сообщение на страницу входа: «Ваша учетная запись была заблокирована из-за слишком много попыток входа. Обратитесь к администратору, чтобы учетная запись разблокирована.»

Вернитесь к `ManageUsers.aspx` странице и щелкните ссылку "Управление" для заблокированной пользователя. Как показано на рис. 5, вы должны увидеть значение в `LastLockedOutDateLabel` кнопки разблокировать пользователя должен быть включен. Нажмите кнопку Разблокировать пользователя, чтобы разблокировать учетную запись пользователя. После разблокирования пользователя, они смогут войти в систему.


[![DAve блокирована система](unlocking-and-approving-user-accounts-vb/_static/image14.png)](unlocking-and-approving-user-accounts-vb/_static/image13.png)

**Рис. 5**: Дейв имеет были заблокированы из системы ([Просмотр полноразмерного изображения](unlocking-and-approving-user-accounts-vb/_static/image15.png))


## <a name="step-2-specifying-new-users-approved-status"></a>Шаг 2. Указание новых пользователей состояние "Утверждено"

Состояние утверждения полезно в сценариях, где нужно некоторые действия должны быть выполнены до новый пользователь не сможет войти в систему и доступа к функциям конкретного пользователя узла. Например может выполняться закрытый веб-сайта, где все страницы, за исключением страниц входа и регистрации, доступны только пользователям, прошедшим проверку. Но что произойдет, если веб-сайта, достигает незнакомого обнаруживает на страницу регистрации и создает учетную запись? Чтобы предотвратить возникновение этой ситуации вы можете перейти на страницу регистрации для `Administration` папки и вручную создать каждой учетной записи администратора. Кроме того вы сможет любой желающий для регистрации, но запретить доступ к сайтам, до администратора учетной записи пользователя.

По умолчанию элемент управления CreateUserWizard утверждает новые учетные записи. Можно настроить это поведение с помощью элемента управления [ `DisableCreatedUser` свойство](https://msdn.microsoft.com/en-gb/library/system.web.ui.webcontrols.createuserwizard.disablecreateduser.aspx). Присвойте этому свойству значение `True` не утверждение новых учетных записей пользователей.

> [!NOTE]
> По умолчанию элемент управления CreateUserWizard автоматический вход в систему новой учетной записи пользователя. Это поведение зависит от элемента управления [ `LoginCreatedUser` свойство](https://msdn.microsoft.com/en-gb/library/system.web.ui.webcontrols.createuserwizard.logincreateduser.aspx). Так как «не утверждено» пользователи не могут входить на сайт, когда `DisableCreatedUser` является `True` новой учетной записи пользователя не выполнил вход в узел, независимо от значения `LoginCreatedUser` свойство.


Программным образом при создании новых учетных записей пользователей с помощью `Membership.CreateUser` метода, чтобы создать учетную запись пользователя «не утверждено» используйте одну из перегрузок, принимающих новый пользователь `IsApproved` значением свойства в качестве входного параметра.

## <a name="step-3-approving-users-by-verifying-their-email-address"></a>Шаг 3. Утверждения пользователей путем проверки адреса электронной почты

Многие веб-сайты, которые поддерживают учетные записи пользователей не утверждает новых пользователей, пока они подтвердить адрес электронной почты, которые они использовали при регистрации. Процесс проверки обычно используется для атак программ-роботов, отправители нежелательной почты и других несознательные, так как он требуется адрес электронной почты уникальным, проверенных и добавляет дополнительный этап в процессе регистрации. В этой модели при регистрации нового пользователя они отправляются сообщения электронной почты со ссылкой на страницу проверки. Открыв ссылку пользователь оказалось, что они получил сообщение электронной почты и, таким образом, что адрес электронной почты, предоставляемые является допустимым. На страницу проверки отвечает за утверждение пользователя. Это может произойти автоматически, тем самым утверждение любой пользователь, который достигает этой странице, или только после пользователь предоставляет некоторые дополнительные сведения, такие как [CAPTCHA](http://en.wikipedia.org/wiki/Captcha).

Чтобы адаптировать этот рабочий процесс, необходимо сначала обновить страницу создания учетной записи, таким образом, чтобы новые пользователи не одобрены. Откройте `EnhancedCreateUserWizard.aspx` странице в `Membership` папку и набора элемент управления CreateUserWizard `DisableCreatedUser` свойства `True`.

Далее нам нужно настроить элемент управления CreateUserWizard отправить сообщение электронной почты для нового пользователя с инструкциями по проверке учетной записи. В частности, будет включать ссылку в сообщении, чтобы `Verification.aspx` страницы (который еще не создать), передав новый пользователь `UserId` через строку запроса. `Verification.aspx` Страница будет найти указанного пользователя и отметьте их утверждения.

### <a name="sending-a-verification-email-to-new-users"></a>Отправка проверочное сообщение электронной почты для новых пользователей

Чтобы отправить сообщение электронной почты из элемента управления CreateUserWizard, настройте его `MailDefinition` свойство соответствующим образом. Как уже говорилось в <a id="Tutorial13"> </a> [предыдущем учебном курсе](recovering-and-changing-passwords-vb.md), элементы управления ChangePassword и PasswordRecovery включают [ `MailDefinition` свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.maildefinition.aspx) , работает так же, как CreateUserWizard элемента управления.

> [!NOTE]
> Чтобы использовать `MailDefinition` свойства, необходимо указать доставки почты параметры в `Web.config`. Дополнительные сведения см. [отправки электронной почты в ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx).


Начните с создания нового шаблона сообщения электронной почты с именем `CreateUserWizard.txt` в `EmailTemplates` папку. Для шаблона, используйте следующий текст:

[!code-aspx[Main](unlocking-and-approving-user-accounts-vb/samples/sample3.aspx)]

Задайте `MailDefinition` `BodyFileName` свойства «~ / EmailTemplates/CreateUserWizard.txt» и его `Subject` свойства «вас приветствует веб-узла! При активации учетной записи.»

Обратите внимание, что `CreateUserWizard.txt` включает в себя шаблон сообщения электронной почты `<%VerificationUrl%>` заполнителя. Именно для этого URL-адрес `Verification.aspx` страницы будут помещены. CreateUserWizard автоматически заменяет `<%UserName%>` и `<%Password%>` заполнители с новой учетной записи пользователя и пароля, но отсутствует встроенный `<%VerificationUrl%>` заполнителя. Необходимо вручную заменить его URL-адрес соответствующего проверки.

Для этого необходимо создать обработчик событий для CreateUserWizard [ `SendingMail` событий](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.sendingmail.aspx) и добавьте следующий код:

[!code-vb[Main](unlocking-and-approving-user-accounts-vb/samples/sample4.vb)]

`SendingMail` Событие срабатывает после `CreatedUser` события, это означает, что к моменту выше обработчик событий выполняет нового пользователя учетная запись уже создана. Можно обратиться к имени нового пользователя `UserId` значение путем вызова метода `Membership.GetUser` метод, передавая `UserName` введенные в элементе управления CreateUserWizard. Затем формируется URL-адрес проверки. Инструкция `Request.Url.GetLeftPart(UriPartial.Authority)` возвращает `http://yourserver.com` часть URL-адрес; `Request.ApplicationPath` возвращает путь, где к корневому каталогу приложения. Проверка URL-адрес затем определяется как `Verification.aspx?ID=userId`. Две эти строки затем объединяются для формирования полного URL-адреса. Наконец, тело сообщения электронной почты (`e.Message.Body`) имеет все вхождения `<%VerificationUrl%>` заменены полный URL-адрес.

В итоге получается, что новые пользователи не одобрены, это означает, что они не могут войти на сайт. Кроме того, они автоматически отправляются сообщения электронной почты со ссылкой на URL-адрес проверки (см. рис. 6).


[![Tон новый пользователь получает сообщение электронной почты со ссылкой на URL-адрес проверки](unlocking-and-approving-user-accounts-vb/_static/image17.png)](unlocking-and-approving-user-accounts-vb/_static/image16.png)

**Рис. 6**: Новый пользователь получает сообщение электронной почты со ссылкой на URL-адрес проверки ([Просмотр полноразмерного изображения](unlocking-and-approving-user-accounts-vb/_static/image18.png))


> [!NOTE]
> Элемент управления CreateUserWizard по умолчанию CreateUserWizard шаг выводит сообщение, информирующее пользователя своей учетной записью, будет создана и отображает кнопки "Продолжить". При нажатии этой кнопки перенаправит пользователя на указанный URL-адрес элемента управления `ContinueDestinationPageUrl` свойство. CreateUserWizard в `EnhancedCreateUserWizard.aspx` будет настроен для отправки новых пользователей к `~/Membership/AdditionalUserInfo.aspx`, который запрашивает у пользователя их проживания, URL-адрес домашней страницы и подпись. Так как эти сведения могут добавляться только по системе работают пользователи, имеет смысл обновить это свойство для обратной отправки пользователям домашнюю страницу сайта (`~/Default.aspx`). Кроме того `EnhancedCreateUserWizard.aspx` страницу или на шаге CreateUserWizard следует дополнять информировать пользователей о том, что они были отправлены проверочное сообщение электронной почты и учетной записи не активируются до их следуйте инструкциям в этом сообщении электронной почты. Я оставьте эти изменения в качестве упражнения для чтения.


### <a name="creating-the-verification-page"></a>Создание страницы проверки

Наша последняя задача — создать `Verification.aspx` страницы. Добавьте эту страницу в корневую папку, сопоставляя его с `Site.master` главной страницы. Как мы делали с большинством из предыдущих страниц содержимого, добавляются к сайту, удалите элемент управления содержимым, который ссылается на `LoginContent` ContentPlaceHolder таким образом, страницы содержимого использовал главной страницы по умолчанию содержимого.

Добавьте элемент управления Label Web для `Verification.aspx` задайте его `ID` для `StatusMessage` и очистите его свойства text. Создайте `Page_Load` обработчик событий и добавьте следующий код:

[!code-vb[Main](unlocking-and-approving-user-accounts-vb/samples/sample5.vb)]

Основная часть приведенный выше код проверяет, что существует UserId, переданный через строку запроса, что это допустимый `Guid` значение, и что он ссылается на существующую учетную запись пользователя. Если все эти проверки, утверждения учетной записи пользователя; в противном случае отображается сообщение о состоянии подходящий.

Рис. 7 показан `Verification.aspx` странице при посещении через браузер.


[![TУчетная запись нового пользователя он является теперь утверждения](unlocking-and-approving-user-accounts-vb/_static/image20.png)](unlocking-and-approving-user-accounts-vb/_static/image19.png)

**Рис. 7**: Учетная запись нового пользователя — теперь утверждения ([Просмотр полноразмерного изображения](unlocking-and-approving-user-accounts-vb/_static/image21.png))


## <a name="summary"></a>Сводка

Все учетные записи пользователей членства имеют два состояния, которые определяют, может ли пользователь войти на сайт: `IsLockedOut` и `IsApproved`. Оба эти свойства должны быть `True` для пользователя с именем входа.

Пользователь заблокирован состояния используется в качестве меры безопасности для уменьшения вероятности разбиение на сайт через методы подбора злоумышленник. В частности, пользователь будет заблокирован при наличии определенного числа попыток недопустимое имя для входа в пределах определенного периода времени. Эти границы, можно настроить параметры поставщика членства в `Web.config`.

Утвержденного статуса обычно используется как средство, чтобы запретить новым пользователям войти в систему, пока не задан какое-либо действие. Возможно веб-узел требует, что новые учетные записи обязательности утверждения администратором или, как мы видели в шаге 3, путем проверки адреса электронной почты.

Счастливого вам программирования!

### <a name="about-the-author"></a>Об авторе

Скотт Митчелл, автор нескольких книг по ASP/ASP.NET и основатель веб-узла 4GuysFromRolla.com, работает с веб-технологиями Microsoft с 1998 года. Скотт — независимый консультант, преподаватель и автор. Его последняя книга —  *[Sams Teach ASP.NET 2.0 in 24 часа](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*. Скоттом можно связаться по адресу [ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com) или через его блог по адресу [ http://ScottOnWriting.NET ](http://scottonwriting.net/).

### <a name="special-thanks-to"></a>Особая благодарность

В этой серии руководств пособий рецензировалась многими компетентными редакторами. Хотите поработать с моих последующих статей для MSDN? Если Да, напишите мне [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)

> [!div class="step-by-step"]
> [Назад](recovering-and-changing-passwords-vb.md)
