---
uid: web-forms/overview/older-versions-security/admin/building-an-interface-to-select-one-user-account-from-many-cs
title: Создание интерфейса для выбора одной учетной записи пользователя из множестваC#() | Документация Майкрософт
author: rick-anderson
description: В этом учебнике мы создадим пользовательский интерфейс с постраничной и фильтруемой сеткой. В частности, наш интерфейс пользователя будет состоять из серии LinkButton для...
ms.author: riande
ms.date: 04/01/2008
ms.assetid: 9e4e687c-b4ec-434f-a4ef-edb0b8f365e4
msc.legacyurl: /web-forms/overview/older-versions-security/admin/building-an-interface-to-select-one-user-account-from-many-cs
msc.type: authoredcontent
ms.openlocfilehash: 8057cfbcd33c74376076363bc27940cebd522c08
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78522030"
---
# <a name="building-an-interface-to-select-one-user-account-from-many-c"></a><span data-ttu-id="71ba3-104">Создание интерфейса для выбора одной учетной записи пользователя из многих (C#)</span><span class="sxs-lookup"><span data-stu-id="71ba3-104">Building an Interface to Select One User Account from Many (C#)</span></span>

<span data-ttu-id="71ba3-105">по [Скотт Митчелл](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="71ba3-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="71ba3-106">[Скачать код](https://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/CS.12.zip) или [скачать PDF](https://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/aspnet_tutorial12_SelectUser_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="71ba3-106">[Download Code](https://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/CS.12.zip) or [Download PDF](https://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/aspnet_tutorial12_SelectUser_cs.pdf)</span></span>

> <span data-ttu-id="71ba3-107">В этом учебнике мы создадим пользовательский интерфейс с постраничной и фильтруемой сеткой.</span><span class="sxs-lookup"><span data-stu-id="71ba3-107">In this tutorial we will build a user interface with a paged, filterable grid.</span></span> <span data-ttu-id="71ba3-108">В частности, наш интерфейс пользователя будет состоять из ряда элементов управления LinkButton для фильтрации результатов на основе начальной буквы имени пользователя, а также для отображения соответствующих пользователей.</span><span class="sxs-lookup"><span data-stu-id="71ba3-108">In particular, our user interface will consist of a series of LinkButtons for filtering the results based on the starting letter of the username, and a GridView control to show the matching users.</span></span> <span data-ttu-id="71ba3-109">Мы начнем с перечисления всех учетных записей пользователей в элементе управления GridView.</span><span class="sxs-lookup"><span data-stu-id="71ba3-109">We'll start by listing all of the user accounts in a GridView.</span></span> <span data-ttu-id="71ba3-110">Затем в шаге 3 мы добавим фильтры LinkButton.</span><span class="sxs-lookup"><span data-stu-id="71ba3-110">Then, in Step 3, we will add the filter LinkButtons.</span></span> <span data-ttu-id="71ba3-111">Шаг 4 рассматривает разбивку отфильтрованных результатов.</span><span class="sxs-lookup"><span data-stu-id="71ba3-111">Step 4 looks at paging the filtered results.</span></span> <span data-ttu-id="71ba3-112">Интерфейс, созданный в шагах 2 – 4, будет использоваться в последующих руководствах для выполнения административных задач для конкретной учетной записи пользователя.</span><span class="sxs-lookup"><span data-stu-id="71ba3-112">The interface constructed in Steps 2 through 4 will be used in the subsequent tutorials to perform administrative tasks for a particular user account.</span></span>

## <a name="introduction"></a><span data-ttu-id="71ba3-113">Введение</span><span class="sxs-lookup"><span data-stu-id="71ba3-113">Introduction</span></span>

<span data-ttu-id="71ba3-114"><a id="_msoanchor_1"> </a>В руководстве [*назначение ролей пользователям*](../roles/assigning-roles-to-users-cs.md) мы создали элементарный интерфейс для администратора, чтобы выбрать пользователя и управлять его ролями.</span><span class="sxs-lookup"><span data-stu-id="71ba3-114">In the <a id="_msoanchor_1"></a>[*Assigning Roles to Users*](../roles/assigning-roles-to-users-cs.md) tutorial, we created a rudimentary interface for an administrator to select a user and manage her roles.</span></span> <span data-ttu-id="71ba3-115">В частности, интерфейс представил администратору раскрывающийся список всех пользователей.</span><span class="sxs-lookup"><span data-stu-id="71ba3-115">Specifically, the interface presented the administrator with a drop-down list of all of the users.</span></span> <span data-ttu-id="71ba3-116">Такой интерфейс подходит, если имеется, но не более десятка учетных записей пользователей, но это неудобно для сайтов с сотнями или тысячами учетных записей.</span><span class="sxs-lookup"><span data-stu-id="71ba3-116">Such an interface is suitable when there are but a dozen or so user accounts, but is unwieldy for sites with hundreds or thousands of accounts.</span></span> <span data-ttu-id="71ba3-117">Постраничная и фильтруемая сетка — более подходящий пользовательский интерфейс для веб-сайтов с большими базами пользователей.</span><span class="sxs-lookup"><span data-stu-id="71ba3-117">A paged, filterable grid is more suitable user interface for websites with large user bases.</span></span>

<span data-ttu-id="71ba3-118">В этом учебнике мы создадим такой пользовательский интерфейс.</span><span class="sxs-lookup"><span data-stu-id="71ba3-118">In this tutorial we will build such a user interface.</span></span> <span data-ttu-id="71ba3-119">В частности, наш интерфейс пользователя будет состоять из ряда элементов управления LinkButton для фильтрации результатов на основе начальной буквы имени пользователя, а также для отображения соответствующих пользователей.</span><span class="sxs-lookup"><span data-stu-id="71ba3-119">In particular, our user interface will consist of a series of LinkButtons for filtering the results based on the starting letter of the username, and a GridView control to show the matching users.</span></span> <span data-ttu-id="71ba3-120">Мы начнем с перечисления всех учетных записей пользователей в элементе управления GridView.</span><span class="sxs-lookup"><span data-stu-id="71ba3-120">We'll start by listing all of the user accounts in a GridView.</span></span> <span data-ttu-id="71ba3-121">Затем в шаге 3 мы добавим фильтры LinkButton.</span><span class="sxs-lookup"><span data-stu-id="71ba3-121">Then, in Step 3, we will add the filter LinkButtons.</span></span> <span data-ttu-id="71ba3-122">Шаг 4 рассматривает разбивку отфильтрованных результатов.</span><span class="sxs-lookup"><span data-stu-id="71ba3-122">Step 4 looks at paging the filtered results.</span></span> <span data-ttu-id="71ba3-123">Интерфейс, созданный в шагах 2 – 4, будет использоваться в последующих руководствах для выполнения административных задач для конкретной учетной записи пользователя.</span><span class="sxs-lookup"><span data-stu-id="71ba3-123">The interface constructed in Steps 2 through 4 will be used in the subsequent tutorials to perform administrative tasks for a particular user account.</span></span>

<span data-ttu-id="71ba3-124">Приступим.</span><span class="sxs-lookup"><span data-stu-id="71ba3-124">Let's get started!</span></span>

## <a name="step-1-adding-new-aspnet-pages"></a><span data-ttu-id="71ba3-125">Шаг 1. Добавление новых страниц ASP.NET</span><span class="sxs-lookup"><span data-stu-id="71ba3-125">Step 1: Adding New ASP.NET Pages</span></span>

<span data-ttu-id="71ba3-126">В этом руководстве и следующих двух мы будем изучать различные функции и возможности, связанные с администрированием.</span><span class="sxs-lookup"><span data-stu-id="71ba3-126">In this tutorial and the next two we will be examining various administration-related functions and capabilities.</span></span> <span data-ttu-id="71ba3-127">Для реализации разделов, которые были проверены в рамках этих руководств, потребуется серия ASP.NET страниц.</span><span class="sxs-lookup"><span data-stu-id="71ba3-127">We will need a series of ASP.NET pages to implement the topics examined throughout these tutorials.</span></span> <span data-ttu-id="71ba3-128">Давайте создадим эти страницы и обновляем карту узла.</span><span class="sxs-lookup"><span data-stu-id="71ba3-128">Let's create these pages and update the site map.</span></span>

<span data-ttu-id="71ba3-129">Начните с создания новой папки в проекте с именем `Administration`.</span><span class="sxs-lookup"><span data-stu-id="71ba3-129">Start by creating a new folder in the project named `Administration`.</span></span> <span data-ttu-id="71ba3-130">Затем добавьте в папку две новые страницы ASP.NET, связав каждую страницу с главной страницей `Site.master`.</span><span class="sxs-lookup"><span data-stu-id="71ba3-130">Next, add two new ASP.NET pages to the folder, linking each page with the `Site.master` master page.</span></span> <span data-ttu-id="71ba3-131">Назовите страницы:</span><span class="sxs-lookup"><span data-stu-id="71ba3-131">Name the pages:</span></span>

- `ManageUsers.aspx`
- `UserInformation.aspx`

<span data-ttu-id="71ba3-132">Кроме того, добавьте две страницы в корневой каталог веб-сайта: `ChangePassword.aspx` и `RecoverPassword.aspx`.</span><span class="sxs-lookup"><span data-stu-id="71ba3-132">Also add two pages to the website's root directory: `ChangePassword.aspx` and `RecoverPassword.aspx`.</span></span>

<span data-ttu-id="71ba3-133">На этом этапе на этих четырех страницах должно быть два элемента управления содержимым — по одному для каждой элементов управления ContentPlaceHolder главной страницы: `MainContent` и `LoginContent`.</span><span class="sxs-lookup"><span data-stu-id="71ba3-133">These four pages should, at this point, have two Content controls, one for each of the master page's ContentPlaceHolders: `MainContent` and `LoginContent`.</span></span>

[!code-aspx[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample1.aspx)]

<span data-ttu-id="71ba3-134">Мы хотим отобразить разметку главной страницы по умолчанию для `LoginContent` ContentPlaceHolder для этих страниц.</span><span class="sxs-lookup"><span data-stu-id="71ba3-134">We want to show the master page's default markup for the `LoginContent` ContentPlaceHolder for these pages.</span></span> <span data-ttu-id="71ba3-135">Поэтому удалите декларативную разметку для элемента управления содержимым `Content2`.</span><span class="sxs-lookup"><span data-stu-id="71ba3-135">Therefore, remove the declarative markup for the `Content2` Content control.</span></span> <span data-ttu-id="71ba3-136">После этого разметка страниц должна содержать только один элемент управления содержимым.</span><span class="sxs-lookup"><span data-stu-id="71ba3-136">After doing so, the pages' markup should contain just one Content control.</span></span>

<span data-ttu-id="71ba3-137">Страницы ASP.NET в папке `Administration` предназначены исключительно для пользователей с правами администратора.</span><span class="sxs-lookup"><span data-stu-id="71ba3-137">The ASP.NET pages in the `Administration` folder are intended solely for administrative users.</span></span> <span data-ttu-id="71ba3-138">Роль администраторов добавлена в систему в <a id="_msoanchor_2"> </a>учебнике [*Создание ролей и управление ими*](../roles/creating-and-managing-roles-cs.md) . Ограничьте доступ к этим двум страницам с этой ролью.</span><span class="sxs-lookup"><span data-stu-id="71ba3-138">We added an Administrators role to the system in the <a id="_msoanchor_2"></a>[*Creating and Managing Roles*](../roles/creating-and-managing-roles-cs.md) tutorial; restrict access to these two pages to this role.</span></span> <span data-ttu-id="71ba3-139">Для этого добавьте `Web.config` файл в папку `Administration` и настройте его элемент `<authorization>`, чтобы присвоить пользователям роль «Администраторы» и запретить все остальные.</span><span class="sxs-lookup"><span data-stu-id="71ba3-139">To accomplish this, add a `Web.config` file to the `Administration` folder and configure its `<authorization>` element to admit users in the Administrators role and to deny all others.</span></span>

[!code-xml[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample2.xml)]

<span data-ttu-id="71ba3-140">На этом этапе обозреватель решений проекта должны выглядеть примерно так, как показано на снимке экрана, показанном на рис. 1.</span><span class="sxs-lookup"><span data-stu-id="71ba3-140">At this point your project's Solution Explorer should look similar to the screen shot shown in Figure 1.</span></span>

<span data-ttu-id="71ba3-141">[![на веб-сайт были добавлены четыре новые страницы и файл Web. config.](building-an-interface-to-select-one-user-account-from-many-cs/_static/image2.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="71ba3-141">[![Four New Pages and a Web.config File Have Been Added to the Website](building-an-interface-to-select-one-user-account-from-many-cs/_static/image2.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image1.png)</span></span>

<span data-ttu-id="71ba3-142">**Рис. 1**. на веб-сайт добавлены четыре новые страницы и файл `Web.config` ([щелкните, чтобы просмотреть изображение с полным размером](building-an-interface-to-select-one-user-account-from-many-cs/_static/image3.png)).</span><span class="sxs-lookup"><span data-stu-id="71ba3-142">**Figure 1**: Four New Pages and a `Web.config` File Have Been Added to the Website  ([Click to view full-size image](building-an-interface-to-select-one-user-account-from-many-cs/_static/image3.png))</span></span>

<span data-ttu-id="71ba3-143">Наконец, обновите карту узла (`Web.sitemap`), чтобы добавить запись на страницу `ManageUsers.aspx`.</span><span class="sxs-lookup"><span data-stu-id="71ba3-143">Finally, update the site map (`Web.sitemap`) to include an entry to the `ManageUsers.aspx` page.</span></span> <span data-ttu-id="71ba3-144">Добавьте следующий XML-код после `<siteMapNode>`, добавленного для учебника по ролям.</span><span class="sxs-lookup"><span data-stu-id="71ba3-144">Add the following XML after the `<siteMapNode>` we added for the Roles tutorials.</span></span>

[!code-xml[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample3.xml)]

<span data-ttu-id="71ba3-145">Обновив карту узла, перейдите на сайт через браузер.</span><span class="sxs-lookup"><span data-stu-id="71ba3-145">With the site map updated, visit the site through a browser.</span></span> <span data-ttu-id="71ba3-146">Как показано на рис. 2, Навигация в левой части включает элементы учебников по администрированию.</span><span class="sxs-lookup"><span data-stu-id="71ba3-146">As Figure 2 shows, the navigation on the left now includes items for the Administration tutorials.</span></span>

<span data-ttu-id="71ba3-147">[![на карте узла имеется узел Администрирование пользователей](building-an-interface-to-select-one-user-account-from-many-cs/_static/image5.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="71ba3-147">[![The Site Map Includes a Node Titled User Administration](building-an-interface-to-select-one-user-account-from-many-cs/_static/image5.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image4.png)</span></span>

<span data-ttu-id="71ba3-148">**Рис. 2**. схема узла включает узел с названием Администрирование пользователя ([щелкните, чтобы просмотреть изображение с полным размером](building-an-interface-to-select-one-user-account-from-many-cs/_static/image6.png)).</span><span class="sxs-lookup"><span data-stu-id="71ba3-148">**Figure 2**: The Site Map Includes a Node Titled User Administration  ([Click to view full-size image](building-an-interface-to-select-one-user-account-from-many-cs/_static/image6.png))</span></span>

## <a name="step-2-listing-all-user-accounts-in-a-gridview"></a><span data-ttu-id="71ba3-149">Шаг 2. Перечисление всех учетных записей пользователей в элементе управления GridView</span><span class="sxs-lookup"><span data-stu-id="71ba3-149">Step 2: Listing All User Accounts in a GridView</span></span>

<span data-ttu-id="71ba3-150">Наша конечная цель этого руководства — создать отфильтрованную, фильтруемую по страницам сетку, с помощью которой администратор может выбрать учетную запись пользователя для управления.</span><span class="sxs-lookup"><span data-stu-id="71ba3-150">Our end goal for this tutorial is to create a paged, filterable grid through which an administrator can select a user account to manage.</span></span> <span data-ttu-id="71ba3-151">Начнем с перечисления *всех* пользователей в элементе управления GridView.</span><span class="sxs-lookup"><span data-stu-id="71ba3-151">Let's start by listing *all* users in a GridView.</span></span> <span data-ttu-id="71ba3-152">После завершения этой работы мы добавим интерфейсы фильтрации и разбиения на страницы.</span><span class="sxs-lookup"><span data-stu-id="71ba3-152">Once this is complete, we will add the filtering and paging interfaces and functionality.</span></span>

<span data-ttu-id="71ba3-153">Откройте страницу `ManageUsers.aspx` в папке `Administration` и добавьте GridView, установив для его `ID` значение `UserAccounts`.</span><span class="sxs-lookup"><span data-stu-id="71ba3-153">Open the `ManageUsers.aspx` page in the `Administration` folder and add a GridView, setting its `ID` to `UserAccounts`.</span></span> <span data-ttu-id="71ba3-154">Сейчас мы создадим код для привязки набора учетных записей пользователей к GridView с помощью метода `GetAllUsers` класса `Membership`.</span><span class="sxs-lookup"><span data-stu-id="71ba3-154">In a moment, we will write code to bind the set of user accounts to the GridView using the `Membership` class's `GetAllUsers` method.</span></span> <span data-ttu-id="71ba3-155">Как обсуждалось в предыдущих учебных курсах, метод Жеталлусерс возвращает объект `MembershipUserCollection`, который представляет собой коллекцию объектов `MembershipUser`.</span><span class="sxs-lookup"><span data-stu-id="71ba3-155">As discussed in earlier tutorials, the GetAllUsers method returns a `MembershipUserCollection` object, which is a collection of `MembershipUser` objects.</span></span> <span data-ttu-id="71ba3-156">Каждый `MembershipUser` в коллекции включает такие свойства, как `UserName`, `Email`, `IsApproved`и т. д.</span><span class="sxs-lookup"><span data-stu-id="71ba3-156">Each `MembershipUser` in the collection includes properties like `UserName`, `Email`, `IsApproved`, and so on.</span></span>

<span data-ttu-id="71ba3-157">Чтобы отобразить нужные сведения об учетной записи пользователя в GridView, установите свойство `AutoGenerateColumns` GridView в значение false и добавьте BoundFields для свойств `UserName`, `Email`и `Comment` и Чеккбоксфиелдс для свойств `IsApproved`, `IsLockedOut`и `IsOnline`.</span><span class="sxs-lookup"><span data-stu-id="71ba3-157">In order to display the desired user account information in the GridView, set the GridView's `AutoGenerateColumns` property to False and add BoundFields for the `UserName`, `Email`, and `Comment` properties and CheckBoxFields for the `IsApproved`, `IsLockedOut`, and `IsOnline` properties.</span></span> <span data-ttu-id="71ba3-158">Эту конфигурацию можно применить с помощью декларативной разметки элемента управления или с помощью диалогового окна «поля».</span><span class="sxs-lookup"><span data-stu-id="71ba3-158">This configuration can be applied through the control's declarative markup or via the Fields dialog box.</span></span> <span data-ttu-id="71ba3-159">На рис. 3 показан снимок экрана диалогового окна «поля» после того, как флажок Автоматическое создание полей снят, а BoundFields и Чеккбоксфиелдс были добавлены и настроены.</span><span class="sxs-lookup"><span data-stu-id="71ba3-159">Figure 3 shows a screen shot of the Fields dialog box after the Auto-generate fields checkbox has been unchecked and the BoundFields and CheckBoxFields have been added and configured.</span></span>

<span data-ttu-id="71ba3-160">[![добавить три BoundFields и три Чеккбоксфиелдс в GridView](building-an-interface-to-select-one-user-account-from-many-cs/_static/image8.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="71ba3-160">[![Add Three BoundFields and Three CheckBoxFields to the GridView](building-an-interface-to-select-one-user-account-from-many-cs/_static/image8.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image7.png)</span></span>

<span data-ttu-id="71ba3-161">**Рис. 3**. Добавление в GridView трех BoundFields и трех Чеккбоксфиелдс ([щелкните, чтобы просмотреть изображение с полным размером](building-an-interface-to-select-one-user-account-from-many-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="71ba3-161">**Figure 3**: Add Three BoundFields and Three CheckBoxFields to the GridView  ([Click to view full-size image](building-an-interface-to-select-one-user-account-from-many-cs/_static/image9.png))</span></span>

<span data-ttu-id="71ba3-162">После настройки элемента управления GridView убедитесь, что его декларативная разметка похожа на следующую:</span><span class="sxs-lookup"><span data-stu-id="71ba3-162">After configuring your GridView, ensure that its declarative markup resembles the following:</span></span>

[!code-aspx[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample4.aspx)]

<span data-ttu-id="71ba3-163">Далее нам нужно написать код, который привязывает учетные записи пользователей к GridView.</span><span class="sxs-lookup"><span data-stu-id="71ba3-163">Next, we need to write code that binds the user accounts to the GridView.</span></span> <span data-ttu-id="71ba3-164">Создайте метод с именем `BindUserAccounts` для выполнения этой задачи, а затем вызовите его из обработчика событий `Page_Load` на первой странице посещения.</span><span class="sxs-lookup"><span data-stu-id="71ba3-164">Create a method named `BindUserAccounts` to perform this task and then call it from the `Page_Load` event handler on the first page visit.</span></span>

[!code-csharp[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample5.cs)]

<span data-ttu-id="71ba3-165">Уделите время на тестирование страницы в браузере.</span><span class="sxs-lookup"><span data-stu-id="71ba3-165">Take a moment to test the page through a browser.</span></span> <span data-ttu-id="71ba3-166">Как показано на рис. 4, `UserAccounts` GridView перечисляет имя пользователя, адрес электронной почты и другие сведения об учетной записи для всех пользователей в системе.</span><span class="sxs-lookup"><span data-stu-id="71ba3-166">As Figure 4 shows, the `UserAccounts` GridView lists the username, email address, and other pertinent account information for all users in the system.</span></span>

<span data-ttu-id="71ba3-167">[![учетные записи пользователей перечислены в элементе управления GridView.](building-an-interface-to-select-one-user-account-from-many-cs/_static/image11.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="71ba3-167">[![The User Accounts are Listed in the GridView](building-an-interface-to-select-one-user-account-from-many-cs/_static/image11.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image10.png)</span></span>

<span data-ttu-id="71ba3-168">**Рис. 4**. учетные записи пользователей перечислены в элементе управления GridView ([щелкните, чтобы просмотреть изображение с полным размером](building-an-interface-to-select-one-user-account-from-many-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="71ba3-168">**Figure 4**: The User Accounts are Listed in the GridView  ([Click to view full-size image](building-an-interface-to-select-one-user-account-from-many-cs/_static/image12.png))</span></span>

## <a name="step-3-filtering-the-results-by-the-first-letter-of-the-username"></a><span data-ttu-id="71ba3-169">Шаг 3. Фильтрация результатов по первой букве имени пользователя</span><span class="sxs-lookup"><span data-stu-id="71ba3-169">Step 3: Filtering the Results by the First Letter of the Username</span></span>

<span data-ttu-id="71ba3-170">В настоящее время `UserAccounts` GridView отображает *все* учетные записи пользователей.</span><span class="sxs-lookup"><span data-stu-id="71ba3-170">Currently the `UserAccounts` GridView shows *all* of the user accounts.</span></span> <span data-ttu-id="71ba3-171">Для веб-сайтов с сотнями или тысячами учетных записей пользователей крайне важно, чтобы пользователь мог быстро немного очистить отображаемые учетные записи.</span><span class="sxs-lookup"><span data-stu-id="71ba3-171">For websites with hundreds or thousands of user accounts, it is imperative that user be able to quickly pare down the displayed accounts.</span></span> <span data-ttu-id="71ba3-172">Это можно сделать, добавив на страницу фильтрацию LinkButton.</span><span class="sxs-lookup"><span data-stu-id="71ba3-172">This can be accomplished by adding filtering LinkButtons to the page.</span></span> <span data-ttu-id="71ba3-173">Давайте добавим на страницу 27 элементов LinkButton: для каждой буквы алфавита задается по одному элементу LinkButton.</span><span class="sxs-lookup"><span data-stu-id="71ba3-173">Let's add 27 LinkButtons to the page: one titled All along with one LinkButton for each letter of the alphabet.</span></span> <span data-ttu-id="71ba3-174">Если посетитель щелкнет элемент управления LinkButton, в GridView будут показаны все пользователи.</span><span class="sxs-lookup"><span data-stu-id="71ba3-174">If a visitor clicks the All LinkButton, the GridView will show all of the users.</span></span> <span data-ttu-id="71ba3-175">Если щелкнуть определенную букву, будут отображены только те пользователи, имена которых начинаются с выбранной буквы.</span><span class="sxs-lookup"><span data-stu-id="71ba3-175">If they click a particular letter, only those users whose username starts with the selected letter will be displayed.</span></span>

<span data-ttu-id="71ba3-176">Нашей первой задачей является добавление 27 элементов управления LinkButton.</span><span class="sxs-lookup"><span data-stu-id="71ba3-176">Our first task is to add the 27 LinkButton controls.</span></span> <span data-ttu-id="71ba3-177">Один из вариантов — создать 27 LinkButton декларативно, по одному за раз.</span><span class="sxs-lookup"><span data-stu-id="71ba3-177">One option would be to create the 27 LinkButtons declaratively, one at a time.</span></span> <span data-ttu-id="71ba3-178">Более гибкий подход заключается в использовании элемента управления Repeater с `ItemTemplate`, который визуализирует LinkButton, а затем привязывает параметры фильтрации к элементу Repeater в качестве массива `string`.</span><span class="sxs-lookup"><span data-stu-id="71ba3-178">A more flexible approach is to use a Repeater control with an `ItemTemplate` that renders a LinkButton and then binds the filtering options to the Repeater as a `string` array.</span></span>

<span data-ttu-id="71ba3-179">Начните с добавления элемента управления Repeater на страницу над `UserAccounts` GridView.</span><span class="sxs-lookup"><span data-stu-id="71ba3-179">Start by adding a Repeater control to the page above the `UserAccounts` GridView.</span></span> <span data-ttu-id="71ba3-180">Задайте для свойства `ID` Repeater значение `FilteringUI`.</span><span class="sxs-lookup"><span data-stu-id="71ba3-180">Set the Repeater's `ID` property to `FilteringUI`.</span></span> <span data-ttu-id="71ba3-181">Настройте шаблоны Repeater таким образом, чтобы его `ItemTemplate` отображали элемент LinkButton, свойства `Text` и `CommandName` которых привязаны к текущему элементу массива.</span><span class="sxs-lookup"><span data-stu-id="71ba3-181">Configure the Repeater's templates so that its `ItemTemplate` renders a LinkButton whose `Text` and `CommandName` properties are bound to the current array element.</span></span> <span data-ttu-id="71ba3-182">Как было показано в <a id="_msoanchor_3"> </a>руководстве [*назначение ролей пользователям*](../roles/assigning-roles-to-users-cs.md) , это можно сделать с помощью синтаксиса `Container.DataItem` DataBinding.</span><span class="sxs-lookup"><span data-stu-id="71ba3-182">As we saw in the <a id="_msoanchor_3"></a>[*Assigning Roles to Users*](../roles/assigning-roles-to-users-cs.md) tutorial, this can be accomplished using the `Container.DataItem` databinding syntax.</span></span> <span data-ttu-id="71ba3-183">Используйте `SeparatorTemplate` Repeater, чтобы отобразить вертикальную линию между каждой ссылкой.</span><span class="sxs-lookup"><span data-stu-id="71ba3-183">Use the Repeater's `SeparatorTemplate` to display a vertical line between each link.</span></span>

[!code-aspx[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample6.aspx)]

<span data-ttu-id="71ba3-184">Чтобы заполнить этот Repeater с помощью требуемых параметров фильтрации, создайте метод с именем `BindFilteringUI`.</span><span class="sxs-lookup"><span data-stu-id="71ba3-184">To populate this Repeater with the desired filtering options, create a method named `BindFilteringUI`.</span></span> <span data-ttu-id="71ba3-185">Не забудьте вызвать этот метод из обработчика событий `Page_Load` при первой загрузке страницы.</span><span class="sxs-lookup"><span data-stu-id="71ba3-185">Be sure to call this method from the `Page_Load` event handler on the first page load.</span></span>

[!code-csharp[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample7.cs)]

<span data-ttu-id="71ba3-186">Этот метод задает параметры фильтрации в виде элементов в массиве `string` `filterOptions`.</span><span class="sxs-lookup"><span data-stu-id="71ba3-186">This method specifies the filtering options as elements in the `string` array `filterOptions`.</span></span> <span data-ttu-id="71ba3-187">Для каждого элемента в массиве Repeater будет визуализировать элемент LinkButton с его `Text` и `CommandName` свойствами, назначенными значению элемента массива.</span><span class="sxs-lookup"><span data-stu-id="71ba3-187">For each element in the array, the Repeater will render a LinkButton with its `Text` and `CommandName` properties assigned to the value of the array element.</span></span>

<span data-ttu-id="71ba3-188">На рис. 5 показана страница `ManageUsers.aspx` при просмотре в браузере.</span><span class="sxs-lookup"><span data-stu-id="71ba3-188">Figure 5 shows the `ManageUsers.aspx` page when viewed through a browser.</span></span>

<span data-ttu-id="71ba3-189">[![список Repeater 27 фильтрует LinkButton](building-an-interface-to-select-one-user-account-from-many-cs/_static/image14.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="71ba3-189">[![The Repeater Lists 27 Filtering LinkButtons](building-an-interface-to-select-one-user-account-from-many-cs/_static/image14.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image13.png)</span></span>

<span data-ttu-id="71ba3-190">**Рис. 5**. элемент Repeater содержит 27 фильтров LinkButton ([щелкните, чтобы просмотреть изображение с полным размером](building-an-interface-to-select-one-user-account-from-many-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="71ba3-190">**Figure 5**: The Repeater Lists 27 Filtering LinkButtons  ([Click to view full-size image](building-an-interface-to-select-one-user-account-from-many-cs/_static/image15.png))</span></span>

> [!NOTE]
> <span data-ttu-id="71ba3-191">Имена пользователей могут начинаться с любого символа, включая цифры и знаки препинания.</span><span class="sxs-lookup"><span data-stu-id="71ba3-191">Usernames may start with any character, including numbers and punctuation.</span></span> <span data-ttu-id="71ba3-192">Чтобы просмотреть эти учетные записи, администратор должен использовать параметр ALL LinkButton.</span><span class="sxs-lookup"><span data-stu-id="71ba3-192">In order to view these accounts, the administrator will have to use the All LinkButton option.</span></span> <span data-ttu-id="71ba3-193">Кроме того, можно добавить LinkButton для возврата всех учетных записей пользователей, начинающихся с цифры.</span><span class="sxs-lookup"><span data-stu-id="71ba3-193">Alternatively, you could add a LinkButton to return all user accounts that start with a number.</span></span> <span data-ttu-id="71ba3-194">Я оставлю это в качестве упражнения для читателя.</span><span class="sxs-lookup"><span data-stu-id="71ba3-194">I leave this as an exercise for the reader.</span></span>

<span data-ttu-id="71ba3-195">Если щелкнуть любую из фильтров LinkButton, произойдет обратная передача и будет вызвано событие `ItemCommand` Repeater, но в сетке нет изменений, так как мы еще записали код для фильтрации результатов.</span><span class="sxs-lookup"><span data-stu-id="71ba3-195">Clicking any of the filtering LinkButtons causes a postback and raises the Repeater's `ItemCommand` event, but there's no change in the grid because we've yet to write any code to filter the results.</span></span> <span data-ttu-id="71ba3-196">Класс `Membership` включает [метод`FindUsersByName`](https://technet.microsoft.com/library/system.web.security.membership.findusersbyname.aspx) , который возвращает учетные записи пользователей, имена которых совпадают с указанным шаблоном поиска.</span><span class="sxs-lookup"><span data-stu-id="71ba3-196">The `Membership` class includes a [`FindUsersByName` method](https://technet.microsoft.com/library/system.web.security.membership.findusersbyname.aspx) that returns those user accounts whose username matches a specified search pattern.</span></span> <span data-ttu-id="71ba3-197">Этот метод можно использовать для получения только тех учетных записей пользователей, имена которых начинаются с буквы, указанной `CommandName` отфильтрованной LinkButton, которая была нажата.</span><span class="sxs-lookup"><span data-stu-id="71ba3-197">We can use this method to retrieve just those user accounts whose usernames start with the letter specified by the `CommandName` of the filtered LinkButton that was clicked.</span></span>

<span data-ttu-id="71ba3-198">Начните с обновления класса кода программной части страницы `ManageUser.aspx`, чтобы он включал свойство с именем `UsernameToMatch`.</span><span class="sxs-lookup"><span data-stu-id="71ba3-198">Start by updating the `ManageUser.aspx` page's code-behind class so that it includes a property named `UsernameToMatch`.</span></span> <span data-ttu-id="71ba3-199">Это свойство сохраняет строку фильтра username между обратными передачами:</span><span class="sxs-lookup"><span data-stu-id="71ba3-199">This property persists the username filter string across postbacks:</span></span>

[!code-csharp[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample8.cs)]

<span data-ttu-id="71ba3-200">Свойство `UsernameToMatch` сохраняет свое значение, которое присваивается коллекции `ViewState` с помощью ключевого значения UsernameToMatch.</span><span class="sxs-lookup"><span data-stu-id="71ba3-200">The `UsernameToMatch` property stores its value it is assigned into the `ViewState` collection using the key UsernameToMatch.</span></span> <span data-ttu-id="71ba3-201">При считывании значения этого свойства проверяет, существует ли значение в коллекции `ViewState`. Если нет, возвращается значение по умолчанию — пустая строка.</span><span class="sxs-lookup"><span data-stu-id="71ba3-201">When this property's value is read, it checks to see if a value exists in the `ViewState` collection; if not, it returns the default value, an empty string.</span></span> <span data-ttu-id="71ba3-202">Свойство `UsernameToMatch` имеет общий шаблон, а именно сохраняет значение в состоянии представления, чтобы любые изменения свойства сохранялись во всех обратных передачах.</span><span class="sxs-lookup"><span data-stu-id="71ba3-202">The `UsernameToMatch` property exhibits a common pattern, namely persisting a value to view state so that any changes to the property are persisted across postbacks.</span></span> <span data-ttu-id="71ba3-203">Дополнительные сведения об этом шаблоне см. в статье [Основные сведения о состоянии представления ASP.NET](https://msdn.microsoft.com/library/ms972976.aspx).</span><span class="sxs-lookup"><span data-stu-id="71ba3-203">For more information on this pattern, read [Understanding ASP.NET View State](https://msdn.microsoft.com/library/ms972976.aspx).</span></span>

<span data-ttu-id="71ba3-204">Затем обновите метод `BindUserAccounts` так, чтобы вместо вызова `Membership.GetAllUsers`он вызывал `Membership.FindUsersByName`, передавая значение свойства `UsernameToMatch`, к которому добавляется символ-шаблон SQL,%.</span><span class="sxs-lookup"><span data-stu-id="71ba3-204">Next, update the `BindUserAccounts` method so that instead of calling `Membership.GetAllUsers`, it calls `Membership.FindUsersByName`, passing in the value of the `UsernameToMatch` property appended with the SQL wildcard character, %.</span></span>

[!code-csharp[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample9.cs)]

<span data-ttu-id="71ba3-205">Чтобы отобразить только тех пользователей, имена которых начинаются с буквы A, задайте для свойства `UsernameToMatch` значение, а затем вызовите `BindUserAccounts`.</span><span class="sxs-lookup"><span data-stu-id="71ba3-205">To display just those users whose username starts with the letter A, set the `UsernameToMatch` property to A and then call `BindUserAccounts`.</span></span> <span data-ttu-id="71ba3-206">Это приведет к вызову `Membership.FindUsersByName("A%")`, который возвратит всех пользователей, чье имя пользователя начинается с. Аналогично, чтобы вернуть *всех* пользователей, присвойте свойству `UsernameToMatch` пустую строку, чтобы метод `BindUserAccounts` вызывал `Membership.FindUsersByName("%")`, тем самым возвращая все учетные записи пользователей.</span><span class="sxs-lookup"><span data-stu-id="71ba3-206">This would result in a call to `Membership.FindUsersByName("A%")`, which will return all users whose username starts with A. Likewise, to return *all* users, assign an empty string to the `UsernameToMatch` property so that the `BindUserAccounts` method will invoke `Membership.FindUsersByName("%")`, thereby returning all user accounts.</span></span>

<span data-ttu-id="71ba3-207">Создайте обработчик событий для `ItemCommand` события Repeater.</span><span class="sxs-lookup"><span data-stu-id="71ba3-207">Create an event handler for the Repeater's `ItemCommand` event.</span></span> <span data-ttu-id="71ba3-208">Это событие возникает при нажатии одной из фильтров LinkButton. ему передается `CommandName` значение LinkButton с помощью объекта `RepeaterCommandEventArgs`.</span><span class="sxs-lookup"><span data-stu-id="71ba3-208">This event is raised whenever one of the filter LinkButtons is clicked; it is passed the clicked LinkButton's `CommandName` value through the `RepeaterCommandEventArgs` object.</span></span> <span data-ttu-id="71ba3-209">Необходимо присвоить соответствующее значение свойству `UsernameToMatch`, а затем вызвать метод `BindUserAccounts`.</span><span class="sxs-lookup"><span data-stu-id="71ba3-209">We need to assign the appropriate value to the `UsernameToMatch` property and then call the `BindUserAccounts` method.</span></span> <span data-ttu-id="71ba3-210">Если `CommandName` все, назначьте пустую строку для `UsernameToMatch`, чтобы отображались все учетные записи пользователей.</span><span class="sxs-lookup"><span data-stu-id="71ba3-210">If the `CommandName` is All, assign an empty string to `UsernameToMatch` so that all user accounts are displayed.</span></span> <span data-ttu-id="71ba3-211">В противном случае назначьте значение `CommandName` `UsernameToMatch`.</span><span class="sxs-lookup"><span data-stu-id="71ba3-211">Otherwise, assign the `CommandName` value to `UsernameToMatch`.</span></span>

[!code-csharp[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample10.cs)]

<span data-ttu-id="71ba3-212">Используя этот код, протестируйте функцию фильтрации.</span><span class="sxs-lookup"><span data-stu-id="71ba3-212">With this code in place, test out the filtering functionality.</span></span> <span data-ttu-id="71ba3-213">При первом посещении страницы отображаются все учетные записи пользователей (см. рис. 5).</span><span class="sxs-lookup"><span data-stu-id="71ba3-213">When the page is first visited, all user accounts are displayed (refer back to Figure 5).</span></span> <span data-ttu-id="71ba3-214">Если щелкнуть элемент LinkButton, произойдет обратная передача и отфильтрованы результаты, отображая только те учетные записи пользователей, которые начинаются с.</span><span class="sxs-lookup"><span data-stu-id="71ba3-214">Clicking the A LinkButton causes a postback and filters the results, displaying only those user accounts that start with A .</span></span>

<span data-ttu-id="71ba3-215">[![использовать фильтры LinkButton для вывода пользователей, имена которых начинаются с определенной буквы.](building-an-interface-to-select-one-user-account-from-many-cs/_static/image17.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="71ba3-215">[![Use the Filtering LinkButtons to Display those Users Whose Username Starts with a Certain Letter](building-an-interface-to-select-one-user-account-from-many-cs/_static/image17.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image16.png)</span></span>

<span data-ttu-id="71ba3-216">**Рис. 6**. Использование фильтрации LinkButton для отображения пользователей, имена которых начинаются с определенной буквы ([щелкните, чтобы просмотреть изображение с полным размером](building-an-interface-to-select-one-user-account-from-many-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="71ba3-216">**Figure 6**: Use the Filtering LinkButtons to Display those Users Whose Username Starts with a Certain Letter  ([Click to view full-size image](building-an-interface-to-select-one-user-account-from-many-cs/_static/image18.png))</span></span>

## <a name="step-4-updating-the-gridview-to-use-paging"></a><span data-ttu-id="71ba3-217">Шаг 4. обновление элемента управления GridView для использования разбиения на страницы</span><span class="sxs-lookup"><span data-stu-id="71ba3-217">Step 4: Updating the GridView to Use Paging</span></span>

<span data-ttu-id="71ba3-218">В элементе управления GridView, показанном на рис. 5 и 6, перечислены все записи, возвращенные методом `FindUsersByName`.</span><span class="sxs-lookup"><span data-stu-id="71ba3-218">The GridView shown in Figures 5 and 6 lists all of the records returned from the `FindUsersByName` method.</span></span> <span data-ttu-id="71ba3-219">При наличии сотен или тысяч учетных записей пользователей это может привести к перегрузке информации при просмотре всех учетных записей (как в случае щелчка элемента LinkButton или при первом посещении страницы).</span><span class="sxs-lookup"><span data-stu-id="71ba3-219">If there are hundreds or thousands of user accounts this can lead to information overload when viewing all of the accounts (as is the case when clicking the All LinkButton or when initially visiting the page).</span></span> <span data-ttu-id="71ba3-220">Чтобы обеспечить предоставление учетных записей пользователей более управляемыми фрагментами, давайте настроим в GridView отображение 10 учетных записей пользователей за раз.</span><span class="sxs-lookup"><span data-stu-id="71ba3-220">To help present the user accounts in more manageable chunks, let's configure the GridView to display 10 user accounts at a time.</span></span>

<span data-ttu-id="71ba3-221">Элемент управления GridView предлагает два типа подкачки:</span><span class="sxs-lookup"><span data-stu-id="71ba3-221">The GridView control offers two types of paging:</span></span>

- <span data-ttu-id="71ba3-222">**Разбиение по страницам по умолчанию** — простота реализации, но неэффективно.</span><span class="sxs-lookup"><span data-stu-id="71ba3-222">**Default paging** - easy to implement, but inefficient.</span></span> <span data-ttu-id="71ba3-223">Вкратце, с разбиением по страницам по умолчанию GridView принимает *все* записи из своего источника данных.</span><span class="sxs-lookup"><span data-stu-id="71ba3-223">In a nutshell, with default paging the GridView expects *all* of the records from its data source.</span></span> <span data-ttu-id="71ba3-224">Затем отображается только соответствующая страница записей.</span><span class="sxs-lookup"><span data-stu-id="71ba3-224">It then only displays the appropriate page of records.</span></span>
- <span data-ttu-id="71ba3-225">**Пользовательское разбиение на страницы** . для реализации требуется больше работы, но это более эффективно, чем разбиение по страницам по умолчанию, поскольку при использовании пользовательского разбиения на страницы источник данных возвращает только точный набор отображаемых записей.</span><span class="sxs-lookup"><span data-stu-id="71ba3-225">**Custom paging** - requires more work to implement, but is more efficient than default paging because with custom paging the data source returns only the precise set of records to display.</span></span>

<span data-ttu-id="71ba3-226">Разница в производительности между по умолчанию и пользовательским разбиением на страницы может быть довольно существенной при разбиении по тысячам записей.</span><span class="sxs-lookup"><span data-stu-id="71ba3-226">The performance difference between default and custom paging can be quite substantial when paging through thousands of records.</span></span> <span data-ttu-id="71ba3-227">Поскольку мы создаем этот интерфейс, предполагая, что могут быть сотни или тысячи учетных записей пользователей, давайте будем использовать пользовательское разбиение по страницам.</span><span class="sxs-lookup"><span data-stu-id="71ba3-227">Because we are building this interface assuming that there may be hundreds or thousands of user accounts, let's use custom paging.</span></span>

> [!NOTE]
> <span data-ttu-id="71ba3-228">Дополнительные сведения о различиях между стандартным и пользовательским разбиением на страницы, а также о проблемах, связанных с реализацией пользовательского разбиения по страницам, см. в разделе [эффективное разбиение больших объемов данных](https://asp.net/learn/data-access/tutorial-25-cs.aspx).</span><span class="sxs-lookup"><span data-stu-id="71ba3-228">For a more thorough discussion on the differences between default and custom paging, as well as the challenges involved in implementing custom paging, refer to [Efficiently Paging Through Large Amounts of Data](https://asp.net/learn/data-access/tutorial-25-cs.aspx).</span></span> <span data-ttu-id="71ba3-229">Для анализа разницы в производительности между по умолчанию и пользовательским разбиением на страницы см. раздел [Настраиваемое разбиение по страницам в ASP.NET с SQL Server 2005](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx).</span><span class="sxs-lookup"><span data-stu-id="71ba3-229">For some analysis of the performance difference between default and custom paging, see [Custom Paging in ASP.NET with SQL Server 2005](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx).</span></span>

<span data-ttu-id="71ba3-230">Для реализации пользовательского разбиения на страницы сначала нужен механизм, позволяющий получить точное подмножество записей, отображаемых элементом GridView.</span><span class="sxs-lookup"><span data-stu-id="71ba3-230">To implement custom paging we first need some mechanism by which to retrieve the precise subset of records being displayed by the GridView.</span></span> <span data-ttu-id="71ba3-231">Хорошая новость состоит в том, что метод `FindUsersByName` `Membership` класса имеет перегрузку, которая позволяет указать индекс страницы и размер страницы, а также возвращает только те учетные записи пользователей, которые попадают в этот диапазон записей.</span><span class="sxs-lookup"><span data-stu-id="71ba3-231">The good news is that the `Membership` class's `FindUsersByName` method has an overload that allows us to specify the page index and page size, and returns only those user accounts that fall within that range of records.</span></span>

<span data-ttu-id="71ba3-232">В частности, эта перегрузка имеет следующую сигнатуру: [`FindUsersByName(usernameToMatch, pageIndex, pageSize, totalRecords)`](https://msdn.microsoft.com/library/fa5st8b2.aspx).</span><span class="sxs-lookup"><span data-stu-id="71ba3-232">In particular, this overload has the following signature: [`FindUsersByName(usernameToMatch, pageIndex, pageSize, totalRecords)`](https://msdn.microsoft.com/library/fa5st8b2.aspx).</span></span>

<span data-ttu-id="71ba3-233">Параметр *pageIndex* указывает страницу возвращаемых учетных записей пользователей. *pageSize* указывает количество записей, отображаемых на страницу.</span><span class="sxs-lookup"><span data-stu-id="71ba3-233">The *pageIndex* parameter specifies the page of user accounts to return; *pageSize* indicates how many records to display per page.</span></span> <span data-ttu-id="71ba3-234">Параметр *тоталрекордс* является параметром `out`, возвращающим общее количество учетных записей пользователей в хранилище пользователя.</span><span class="sxs-lookup"><span data-stu-id="71ba3-234">The *totalRecords* parameter is an `out` parameter that returns the number of total user accounts in the user store.</span></span>

> [!NOTE]
> <span data-ttu-id="71ba3-235">Данные, возвращаемые `FindUsersByName`, сортируются по имени пользователя. невозможно настроить критерии сортировки.</span><span class="sxs-lookup"><span data-stu-id="71ba3-235">The data returned by `FindUsersByName` is sorted by username; the sort criteria cannot be customized.</span></span>

<span data-ttu-id="71ba3-236">GridView можно настроить для использования пользовательского разбиения на страницы, но только при привязке к элементу управления ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="71ba3-236">The GridView can be configured to utilize custom paging, but only when bound to an ObjectDataSource control.</span></span> <span data-ttu-id="71ba3-237">Для реализации пользовательского разбиения по страницам в элементе управления ObjectDataSource требуются два метода: один, который передает начальный индекс строки и максимальное число отображаемых записей, и возвращает точное подмножество записей, которые попадают в этот диапазон. и метод, возвращающий общее количество записей, на которые размещается страница.</span><span class="sxs-lookup"><span data-stu-id="71ba3-237">For the ObjectDataSource control to implement custom paging, it requires two methods: one that is passed a start row index and the maximum number of records to display, and returns the precise subset of records that fall within that span; and a method that returns the total number of records being paged through.</span></span> <span data-ttu-id="71ba3-238">Перегрузка `FindUsersByName` принимает индекс страницы и размер страницы, а также возвращает общее количество записей с помощью параметра `out`.</span><span class="sxs-lookup"><span data-stu-id="71ba3-238">The `FindUsersByName` overload accepts a page index and page size, and returns the total number of records through an `out` parameter.</span></span> <span data-ttu-id="71ba3-239">Поэтому здесь есть несоответствие интерфейсов.</span><span class="sxs-lookup"><span data-stu-id="71ba3-239">So there is an interface mismatch here.</span></span>

<span data-ttu-id="71ba3-240">Один из вариантов — создать прокси-класс, который предоставляет интерфейс, который требуется ObjectDataSource, а затем внутренне вызывает метод `FindUsersByName`.</span><span class="sxs-lookup"><span data-stu-id="71ba3-240">One option would be to create a proxy class that exposes the interface the ObjectDataSource expects, and then internally calls the `FindUsersByName` method.</span></span> <span data-ttu-id="71ba3-241">Другой вариант — и тот, который мы будем использовать в этой статье, — создать наш интерфейс разбиения по страницам и использовать его вместо встроенного интерфейса разбиения по страницам GridView.</span><span class="sxs-lookup"><span data-stu-id="71ba3-241">Another option - and the one we'll use for this article - is to create our own paging interface and use that instead of the GridView's built-in paging interface.</span></span>

### <a name="creating-a-first-previous-next-last-paging-interface"></a><span data-ttu-id="71ba3-242">Создание первого, предыдущего, следующего, последнего интерфейса разбиения на страницы</span><span class="sxs-lookup"><span data-stu-id="71ba3-242">Creating a First, Previous, Next, Last Paging Interface</span></span>

<span data-ttu-id="71ba3-243">Давайте создадим интерфейс разбиения по страницам с помощью первой, предыдущей, следующей и последней элемента LinkButton.</span><span class="sxs-lookup"><span data-stu-id="71ba3-243">Let's build a paging interface with First, Previous, Next, and Last LinkButtons.</span></span> <span data-ttu-id="71ba3-244">При нажатии первой страницы LinkButton пользователь перейдет на первую страницу данных, тогда как предыдущий будет возвращен на предыдущую страницу.</span><span class="sxs-lookup"><span data-stu-id="71ba3-244">The First LinkButton, when clicked, will take the user to the first page of data, whereas Previous will return him to the previous page.</span></span> <span data-ttu-id="71ba3-245">Аналогично, Next и Last переместит пользователя на следующую и последнюю страницу соответственно.</span><span class="sxs-lookup"><span data-stu-id="71ba3-245">Likewise, Next and Last will move the user to the next and last page, respectively.</span></span> <span data-ttu-id="71ba3-246">Добавьте четыре элемента управления LinkButton под `UserAccounts` GridView.</span><span class="sxs-lookup"><span data-stu-id="71ba3-246">Add the four LinkButton controls beneath the `UserAccounts` GridView.</span></span>

[!code-aspx[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample11.aspx)]

<span data-ttu-id="71ba3-247">Затем создайте обработчик событий для каждого `Click` событий элемента LinkButton.</span><span class="sxs-lookup"><span data-stu-id="71ba3-247">Next, create an event handler for each of the LinkButton's `Click` events.</span></span>

<span data-ttu-id="71ba3-248">На рис. 7 показаны четыре элемента LinkButton при просмотре с помощью Visual Web Developer представление конструирования.</span><span class="sxs-lookup"><span data-stu-id="71ba3-248">Figure 7 shows the four LinkButtons when viewed through the Visual Web Developer Design view.</span></span>

<span data-ttu-id="71ba3-249">[![добавления первой, предыдущей, следующей и последней элементов управления LinkButton под элементом управления GridView](building-an-interface-to-select-one-user-account-from-many-cs/_static/image20.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="71ba3-249">[![Add First, Previous, Next, and Last LinkButtons Beneath the GridView](building-an-interface-to-select-one-user-account-from-many-cs/_static/image20.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image19.png)</span></span>

<span data-ttu-id="71ba3-250">**Рис. 7**. Добавление первой, предыдущей, следующей и последней элементов управления LinkButton под элементом управления GridView ([щелкните, чтобы просмотреть изображение с полным размером](building-an-interface-to-select-one-user-account-from-many-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="71ba3-250">**Figure 7**: Add First, Previous, Next, and Last LinkButtons Beneath the GridView  ([Click to view full-size image](building-an-interface-to-select-one-user-account-from-many-cs/_static/image21.png))</span></span>

### <a name="keeping-track-of-the-current-page-index"></a><span data-ttu-id="71ba3-251">Отслеживание индекса текущей страницы</span><span class="sxs-lookup"><span data-stu-id="71ba3-251">Keeping Track of the Current Page Index</span></span>

<span data-ttu-id="71ba3-252">Когда пользователь впервые посещает страницу `ManageUsers.aspx` или щелкает одну из кнопок фильтрации, нам нужно отобразить первую страницу данных в GridView.</span><span class="sxs-lookup"><span data-stu-id="71ba3-252">When a user first visits the `ManageUsers.aspx` page or clicks one of the filtering buttons, we want to display the first page of data in the GridView.</span></span> <span data-ttu-id="71ba3-253">Однако когда пользователь щелкает одну из элементов LinkButton навигации, необходимо обновить индекс страницы.</span><span class="sxs-lookup"><span data-stu-id="71ba3-253">When the user clicks one of the navigation LinkButtons, however, we need to update the page index.</span></span> <span data-ttu-id="71ba3-254">Чтобы сохранить индекс страницы и количество записей, отображаемых на странице, добавьте следующие два свойства в класс кода программной части страницы:</span><span class="sxs-lookup"><span data-stu-id="71ba3-254">To maintain the page index and the number of records to display per page, add the following two properties to the page's code-behind class:</span></span>

[!code-csharp[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample12.cs)]

<span data-ttu-id="71ba3-255">Как и свойство `UsernameToMatch`, свойство `PageIndex` сохраняет свое значение в состоянии представления.</span><span class="sxs-lookup"><span data-stu-id="71ba3-255">Like the `UsernameToMatch` property, the `PageIndex` property persists its value to view state.</span></span> <span data-ttu-id="71ba3-256">Свойство `PageSize` только для чтения возвращает жестко заданное значение 10.</span><span class="sxs-lookup"><span data-stu-id="71ba3-256">The read-only `PageSize` property returns a hard-coded value, 10.</span></span> <span data-ttu-id="71ba3-257">Я приглашаю заинтересованному читателю обновить это свойство, чтобы использовать тот же шаблон, что и `PageIndex`, а затем дополнить `ManageUsers.aspx`ную страницу таким образом, чтобы пользователь, посещающий страницу, мог указать количество учетных записей пользователей, отображаемых на странице.</span><span class="sxs-lookup"><span data-stu-id="71ba3-257">I invite the interested reader to update this property to use the same pattern as `PageIndex`, and then to augment the `ManageUsers.aspx` page such that the person visiting the page can specify how many user accounts to display per page.</span></span>

### <a name="retrieving-just-the-current-pages-records-updating-the-page-index-and-enabling-and-disabling-the-paging-interface-linkbuttons"></a><span data-ttu-id="71ba3-258">Получение только записей текущей страницы, обновление индекса страницы, включение и отключение элемента LinkButton с интерфейсом подкачки</span><span class="sxs-lookup"><span data-stu-id="71ba3-258">Retrieving Just the Current Page's Records, Updating the Page Index, and Enabling and Disabling the Paging Interface LinkButtons</span></span>

<span data-ttu-id="71ba3-259">При наличии интерфейса разбиения на страницы и добавления свойств `PageIndex` и `PageSize` мы готовы обновить метод `BindUserAccounts`, чтобы он использовал соответствующую перегрузку `FindUsersByName`.</span><span class="sxs-lookup"><span data-stu-id="71ba3-259">With the paging interface in place and the `PageIndex` and `PageSize` properties added, we are ready to update the `BindUserAccounts` method so that it uses the appropriate `FindUsersByName` overload.</span></span> <span data-ttu-id="71ba3-260">Кроме того, этот метод должен включать или отключать интерфейс разбиения на страницы в зависимости от того, какая страница отображается.</span><span class="sxs-lookup"><span data-stu-id="71ba3-260">Additionally, we need to have this method enable or disable the paging interface depending on what page is being displayed.</span></span> <span data-ttu-id="71ba3-261">При просмотре первой страницы данных первая и Предыдущая ссылки должны быть отключены. Следующие и последние должны быть отключены при просмотре последней страницы.</span><span class="sxs-lookup"><span data-stu-id="71ba3-261">When viewing the first page of data, the First and Previous links should be disabled; Next and Last should be disabled when viewing the last page.</span></span>

<span data-ttu-id="71ba3-262">Обновите метод `BindUserAccounts`, используя следующий код:</span><span class="sxs-lookup"><span data-stu-id="71ba3-262">Update the `BindUserAccounts` method with the following code:</span></span>

[!code-csharp[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample13.cs)]

<span data-ttu-id="71ba3-263">Обратите внимание, что общее число страниц, на которые выполняется переход, определяется последним параметром метода `FindUsersByName`.</span><span class="sxs-lookup"><span data-stu-id="71ba3-263">Note that the total number of records being paged through is determined by the last parameter of the `FindUsersByName` method.</span></span> <span data-ttu-id="71ba3-264">Это `out` параметр, поэтому сначала необходимо объявить переменную для хранения этого значения (`totalRecords`), а затем добавить перед ней ключевое слово `out`.</span><span class="sxs-lookup"><span data-stu-id="71ba3-264">This is an `out` parameter, so we need to first declare a variable to hold this value (`totalRecords`) and then prefix it with the `out` keyword.</span></span>

<span data-ttu-id="71ba3-265">После того как указанная страница учетных записей пользователей будет возвращена, четыре элемента LinkButton будут включены или отключены в зависимости от того, просматриваются первая или последняя страница данных.</span><span class="sxs-lookup"><span data-stu-id="71ba3-265">After the specified page of user accounts are returned, the four LinkButtons are either enabled or disabled, depending on whether the first or last page of data is being viewed.</span></span>

<span data-ttu-id="71ba3-266">Последним шагом является написание кода для четырех обработчиков событий LinkButton `Click`.</span><span class="sxs-lookup"><span data-stu-id="71ba3-266">The last step is to write the code for the four LinkButtons' `Click` event handlers.</span></span> <span data-ttu-id="71ba3-267">Эти обработчики событий должны обновить свойство `PageIndex`, а затем повторно привязать данные к GridView с помощью вызова `BindUserAccounts`.</span><span class="sxs-lookup"><span data-stu-id="71ba3-267">These event handlers need to update the `PageIndex` property and then rebind the data to the GridView via a call to `BindUserAccounts`.</span></span> <span data-ttu-id="71ba3-268">Обработчики первого, предыдущего и следующего событий очень просты.</span><span class="sxs-lookup"><span data-stu-id="71ba3-268">The First, Previous, and Next event handlers are very simple.</span></span> <span data-ttu-id="71ba3-269">Однако обработчик событий `Click` последнего элемента LinkButton является немного более сложным, так как нам нужно определить, сколько записей отображается, чтобы определить последний индекс страницы.</span><span class="sxs-lookup"><span data-stu-id="71ba3-269">The `Click` event handler for the Last LinkButton, however, is a bit more complex because we need to determine how many records are being displayed in order to determine the last page index.</span></span>

[!code-csharp[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample14.cs)]

<span data-ttu-id="71ba3-270">На рисунках 8 и 9 показан пользовательский интерфейс разбиения на страницы в действии.</span><span class="sxs-lookup"><span data-stu-id="71ba3-270">Figures 8 and 9 show the custom paging interface in action.</span></span> <span data-ttu-id="71ba3-271">На рис. 8 показана страница `ManageUsers.aspx` при просмотре первой страницы данных для всех учетных записей пользователей.</span><span class="sxs-lookup"><span data-stu-id="71ba3-271">Figure 8 shows the `ManageUsers.aspx` page when viewing the first page of data for all user accounts.</span></span> <span data-ttu-id="71ba3-272">Обратите внимание, что отображаются только 10 из 13 учетных записей.</span><span class="sxs-lookup"><span data-stu-id="71ba3-272">Note that only 10 of the 13 accounts are displayed.</span></span> <span data-ttu-id="71ba3-273">Если щелкнуть следующую или последнюю ссылку, то обратная передача обновится `PageIndex` до 1 и привязывает вторую страницу учетных записей пользователей к сетке (см. рис. 9).</span><span class="sxs-lookup"><span data-stu-id="71ba3-273">Clicking the Next or Last link causes a postback, updates the `PageIndex` to 1, and binds the second page of user accounts to the grid (see Figure 9).</span></span>

<span data-ttu-id="71ba3-274">[![отображаются первые 10 учетных записей пользователей](building-an-interface-to-select-one-user-account-from-many-cs/_static/image23.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="71ba3-274">[![The First 10 User Accounts are Displayed](building-an-interface-to-select-one-user-account-from-many-cs/_static/image23.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image22.png)</span></span>

<span data-ttu-id="71ba3-275">**Рис. 8**. отображаются первые 10 учетных записей пользователей ([щелкните, чтобы просмотреть изображение с полным размером](building-an-interface-to-select-one-user-account-from-many-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="71ba3-275">**Figure 8**: The First 10 User Accounts are Displayed  ([Click to view full-size image](building-an-interface-to-select-one-user-account-from-many-cs/_static/image24.png))</span></span>

<span data-ttu-id="71ba3-276">[![щелкнув ссылку "Далее", вы увидите вторую страницу учетных записей пользователей.](building-an-interface-to-select-one-user-account-from-many-cs/_static/image26.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="71ba3-276">[![Clicking the Next Link Displays the Second Page of User Accounts](building-an-interface-to-select-one-user-account-from-many-cs/_static/image26.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image25.png)</span></span>

<span data-ttu-id="71ba3-277">**Рис. 9**. при щелчке по следующей ссылке отображается вторая страница учетных записей пользователей ([щелкните, чтобы просмотреть изображение с полным размером](building-an-interface-to-select-one-user-account-from-many-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="71ba3-277">**Figure 9**: Clicking the Next Link Displays the Second Page of User Accounts  ([Click to view full-size image](building-an-interface-to-select-one-user-account-from-many-cs/_static/image27.png))</span></span>

## <a name="summary"></a><span data-ttu-id="71ba3-278">Сводка</span><span class="sxs-lookup"><span data-stu-id="71ba3-278">Summary</span></span>

<span data-ttu-id="71ba3-279">Администраторам часто требуется выбрать пользователя из списка учетных записей.</span><span class="sxs-lookup"><span data-stu-id="71ba3-279">Administrators often need to select a user from the list of accounts.</span></span> <span data-ttu-id="71ba3-280">В предыдущих руководствах мы рассматривали использование раскрывающегося списка, заполненного пользователями, но этот подход плохо масштабируется.</span><span class="sxs-lookup"><span data-stu-id="71ba3-280">In previous tutorials we looked at using a drop-down list populated with the users, but this approach does not scale well.</span></span> <span data-ttu-id="71ba3-281">В этом учебнике мы изучили лучшую альтернативу: интерфейс с фильтрацией, результаты которого отображаются в элементе GridView с страничным просмотром.</span><span class="sxs-lookup"><span data-stu-id="71ba3-281">In this tutorial we explored a better alternative: a filterable interface whose results are displayed in a paged GridView.</span></span> <span data-ttu-id="71ba3-282">С помощью этого пользовательского интерфейса администраторы могут быстро и эффективно находить и выбирать одну учетную запись пользователя из тысяч.</span><span class="sxs-lookup"><span data-stu-id="71ba3-282">With this user interface, administrators can quickly and efficiently locate and select one user account among thousands.</span></span>

<span data-ttu-id="71ba3-283">Поздравляем с программированием!</span><span class="sxs-lookup"><span data-stu-id="71ba3-283">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="71ba3-284">Дополнительные материалы</span><span class="sxs-lookup"><span data-stu-id="71ba3-284">Further Reading</span></span>

<span data-ttu-id="71ba3-285">Дополнительные сведения о разделах, обсуждаемых в этом руководстве, см. в следующих ресурсах:</span><span class="sxs-lookup"><span data-stu-id="71ba3-285">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="71ba3-286">Пользовательское разбиение по страницам в ASP.NET с SQL Server 2005</span><span class="sxs-lookup"><span data-stu-id="71ba3-286">Custom Paging in ASP.NET with SQL Server 2005</span></span>](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx)
- [<span data-ttu-id="71ba3-287">Эффективное разбиение на страницы больших объемов данных</span><span class="sxs-lookup"><span data-stu-id="71ba3-287">Efficiently Paging Through Large Amounts of Data</span></span>](https://asp.net/learn/data-access/tutorial-25-cs.aspx)
- [<span data-ttu-id="71ba3-288">Развертывание собственного средства администрирования веб-сайта</span><span class="sxs-lookup"><span data-stu-id="71ba3-288">Rolling Your Own Website Administration Tool</span></span>](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx)

### <a name="about-the-author"></a><span data-ttu-id="71ba3-289">Об авторе</span><span class="sxs-lookup"><span data-stu-id="71ba3-289">About the Author</span></span>

<span data-ttu-id="71ba3-290">Скотт Митчелл, автор нескольких книг по ASP/ASP. NET и основатель 4GuysFromRolla.com, работал с веб-технологиями Майкрософт с 1998.</span><span class="sxs-lookup"><span data-stu-id="71ba3-290">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="71ba3-291">Скотт работает как независимый консультант, преподаватель и модуль записи.</span><span class="sxs-lookup"><span data-stu-id="71ba3-291">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="71ba3-292">Его последняя книга — *[Sams обучать себя ASP.NET 2,0 за 24 часа](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)* .</span><span class="sxs-lookup"><span data-stu-id="71ba3-292">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="71ba3-293">Скотт можно получить по адресу [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) или через свой блог по адресу [http://ScottOnWriting.NET](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="71ba3-293">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="71ba3-294">Специальная благодарность</span><span class="sxs-lookup"><span data-stu-id="71ba3-294">Special Thanks To</span></span>

<span data-ttu-id="71ba3-295">Эта серия руководств была рассмотрена многими полезными рецензентами.</span><span class="sxs-lookup"><span data-stu-id="71ba3-295">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="71ba3-296">Специалист по интересу для этого руководства был Аликжа Мазиарз.</span><span class="sxs-lookup"><span data-stu-id="71ba3-296">Lead reviewer for this tutorial was Alicja Maziarz.</span></span> <span data-ttu-id="71ba3-297">Хотите ознакомиться с моими будущими статьями MSDN?</span><span class="sxs-lookup"><span data-stu-id="71ba3-297">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="71ba3-298">Если да, расположите строку в [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="71ba3-298">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="71ba3-299">Дальше</span><span class="sxs-lookup"><span data-stu-id="71ba3-299">Next</span></span>](recovering-and-changing-passwords-cs.md)
