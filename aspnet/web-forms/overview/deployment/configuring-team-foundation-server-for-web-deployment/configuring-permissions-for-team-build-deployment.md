---
uid: web-forms/overview/deployment/configuring-team-foundation-server-for-web-deployment/configuring-permissions-for-team-build-deployment
title: Настройка разрешений для развертывания Team Build | Документация Майкрософт
author: jrjlee
description: В этом разделе описывается настройка разрешений, позволяющих серверу сборки развертывать содержимое на веб-серверах и серверах баз данных в составе автоматизированной версии b...
ms.author: riande
ms.date: 05/04/2012
ms.assetid: 2488a91e-b0a8-465a-b874-3233f724b56b
msc.legacyurl: /web-forms/overview/deployment/configuring-team-foundation-server-for-web-deployment/configuring-permissions-for-team-build-deployment
msc.type: authoredcontent
ms.openlocfilehash: 5699f72af6b8d7f18d1a2c631dfdedd63c66e1e6
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78518508"
---
# <a name="configuring-permissions-for-team-build-deployment"></a><span data-ttu-id="bc304-103">Настройка разрешений для развертывания командной сборки</span><span class="sxs-lookup"><span data-stu-id="bc304-103">Configuring Permissions for Team Build Deployment</span></span>

<span data-ttu-id="bc304-104">кто [Джейсон Иванов](https://github.com/jrjlee)</span><span class="sxs-lookup"><span data-stu-id="bc304-104">by [Jason Lee](https://github.com/jrjlee)</span></span>

[<span data-ttu-id="bc304-105">Скачать в формате PDF</span><span class="sxs-lookup"><span data-stu-id="bc304-105">Download PDF</span></span>](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> <span data-ttu-id="bc304-106">В этом разделе описывается настройка разрешений, позволяющих серверу сборки развертывать содержимое на веб-серверах и серверах баз данных в рамках автоматизированного процесса сборки.</span><span class="sxs-lookup"><span data-stu-id="bc304-106">This topic describes how to configure permissions to enable your build server to deploy content to web servers and database servers as part of an automated build process.</span></span>

<span data-ttu-id="bc304-107">Этот раздел является частью серии руководств, основанных на требованиях Enterprise к развертыванию вымышленной компании Fabrikam, Inc. В этой серии руководств используется пример решения&#x2014; [диспетчера контактов](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;для представления веб-приложения с реалистичным уровнем сложности, включая приложение ASP.NET MVC 3, службу Windows Communication Foundation (WCF) и проект базы данных.</span><span class="sxs-lookup"><span data-stu-id="bc304-107">This topic forms part of a series of tutorials based around the enterprise deployment requirements of a fictional company named Fabrikam, Inc. This tutorial series uses a sample solution&#x2014;the [Contact Manager solution](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;to represent a web application with a realistic level of complexity, including an ASP.NET MVC 3 application, a Windows Communication Foundation (WCF) service, and a database project.</span></span>

<span data-ttu-id="bc304-108">Метод развертывания в сердце этих учебников основан на подходе к файлам проекта Split, описанному в разделе [понимание файла проекта](../web-deployment-in-the-enterprise/understanding-the-project-file.md), в котором процесс сборки управляется двумя файлами&#x2014;проекта, содержащими инструкции по сборке, которые применяются к каждой целевой среде, и одна содержит параметры сборки и развертывания, относящиеся к конкретной среде.</span><span class="sxs-lookup"><span data-stu-id="bc304-108">The deployment method at the heart of these tutorials is based on the split project file approach described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md), in which the build process is controlled by two project files&#x2014;one containing build instructions that apply to every destination environment, and one containing environment-specific build and deployment settings.</span></span> <span data-ttu-id="bc304-109">Во время сборки файл проекта, зависящий от среды, объединяется в файл проекта независимо от среды, чтобы сформировать полный набор инструкций по сборке.</span><span class="sxs-lookup"><span data-stu-id="bc304-109">At build time, the environment-specific project file is merged into the environment-agnostic project file to form a complete set of build instructions.</span></span>

## <a name="task-overview"></a><span data-ttu-id="bc304-110">Обзор задач</span><span class="sxs-lookup"><span data-stu-id="bc304-110">Task Overview</span></span>

<span data-ttu-id="bc304-111">При установке службы сборки Team Foundation Server (TFS) 2010 необходимо указать удостоверение, с которым должна выполняться служба.</span><span class="sxs-lookup"><span data-stu-id="bc304-111">When you install the Team Foundation Server (TFS) 2010 build service, you specify the identity with which you want the service to run.</span></span> <span data-ttu-id="bc304-112">По умолчанию это учетная запись сетевой службы.</span><span class="sxs-lookup"><span data-stu-id="bc304-112">By default, this is the Network Service account.</span></span> <span data-ttu-id="bc304-113">Кроме того, службу сборки можно настроить для запуска с использованием доменной учетной записи.</span><span class="sxs-lookup"><span data-stu-id="bc304-113">Alternatively, you can configure the build service to run using a domain account.</span></span>

<span data-ttu-id="bc304-114">Все задачи развертывания, для которых требуется проверка подлинности Windows и которые планируется автоматизировать с помощью Team Build, будут выполняться с использованием удостоверения службы сборки.</span><span class="sxs-lookup"><span data-stu-id="bc304-114">Any deployment tasks that require Windows authentication, and that you plan to automate using Team Build, will run using the build service identity.</span></span> <span data-ttu-id="bc304-115">Таким образом, необходимо предоставить удостоверению службы сборки все необходимые разрешения на веб-серверах и серверах баз данных.</span><span class="sxs-lookup"><span data-stu-id="bc304-115">As such, you'll need to grant the build service identity any required permissions on your web servers and your database servers.</span></span>

> [!NOTE]
> <span data-ttu-id="bc304-116">Учетная запись сетевой службы использует учетную запись компьютера для проверки подлинности на других компьютерах.</span><span class="sxs-lookup"><span data-stu-id="bc304-116">The Network Service account uses the machine account to authenticate to other computers.</span></span> <span data-ttu-id="bc304-117">Учетные записи компьютеров принимают форму \* [домен имя]\[имя компьютера] \* **$** &#x2014;например **фабрикам\тфсбуилд $** .</span><span class="sxs-lookup"><span data-stu-id="bc304-117">Machine accounts take the form \*[domain name]\[machine name]\***$**&#x2014;for example, **FABRIKAM\TFSBUILD$**.</span></span> <span data-ttu-id="bc304-118">Таким образом, если служба сборки выполняется с использованием удостоверения сетевой службы, необходимо предоставить всем необходимым пользователям разрешения на доступ к удостоверению учетной записи компьютера для сервера сборки.</span><span class="sxs-lookup"><span data-stu-id="bc304-118">As such, if your build service runs using the Network Service identity, you should grant any required permissions to the machine account identity for your build server.</span></span>

## <a name="configuring-web-server-permissions"></a><span data-ttu-id="bc304-119">Настройка разрешений веб-сервера</span><span class="sxs-lookup"><span data-stu-id="bc304-119">Configuring Web Server Permissions</span></span>

<span data-ttu-id="bc304-120">Как описано в разделе [Выбор правильного подхода к веб-развертыванию](../configuring-server-environments-for-web-deployment/choosing-the-right-approach-to-web-deployment.md), можно использовать два основных подхода к развертыванию веб-пакетов на удаленном веб-сервере.</span><span class="sxs-lookup"><span data-stu-id="bc304-120">As described in [Choosing the Right Approach to Web Deployment](../configuring-server-environments-for-web-deployment/choosing-the-right-approach-to-web-deployment.md), there are two main approaches you can use if you want to deploy web packages to a remote web server:</span></span>

- <span data-ttu-id="bc304-121">Разверните приложение из удаленного расположения, нацеливание на *службу веб-Deployment Agent* (также называемую удаленным агентом) на целевом сервере.</span><span class="sxs-lookup"><span data-stu-id="bc304-121">Deploy the application from a remote location by targeting the *Web Deployment Agent Service* (also known as the remote agent) on the destination server.</span></span>
- <span data-ttu-id="bc304-122">Разверните приложение из удаленного расположения, нацеливания на обработчик веб-развертывание *службы IIS* (*IIS)* на целевом сервере.</span><span class="sxs-lookup"><span data-stu-id="bc304-122">Deploy the application from a remote location by targeting the *Internet Information Services* (*IIS) Web Deploy Handler* on the destination server.</span></span>

<span data-ttu-id="bc304-123">В этом случае удаленный агент имеет два ключевых ограничения:</span><span class="sxs-lookup"><span data-stu-id="bc304-123">The remote agent has two key limitations in this case:</span></span>

- <span data-ttu-id="bc304-124">Удаленный агент поддерживает только проверку подлинности NTLM.</span><span class="sxs-lookup"><span data-stu-id="bc304-124">The remote agent supports only NTLM authentication.</span></span> <span data-ttu-id="bc304-125">Иными словами, развертывание должно использовать удостоверение&#x2014;службы сборки, но нельзя олицетворять другую учетную запись.</span><span class="sxs-lookup"><span data-stu-id="bc304-125">In other words, the deployment must use the build service identity&#x2014;you can't impersonate another account.</span></span>
- <span data-ttu-id="bc304-126">Чтобы использовать удаленный агент, учетная запись, выполняющая развертывание, должна иметь права администратора на целевом сервере.</span><span class="sxs-lookup"><span data-stu-id="bc304-126">To use the remote agent, the account that performs the deployment must be an administrator on the target server.</span></span>

<span data-ttu-id="bc304-127">Вместе эти два ограничения делают удаленный агент нежелательным для автоматизированного развертывания Team Build.</span><span class="sxs-lookup"><span data-stu-id="bc304-127">Together, these two limitations make the remote agent approach undesirable for an automated Team Build deployment.</span></span> <span data-ttu-id="bc304-128">Чтобы использовать этот подход, необходимо сделать учетную запись службы сборок администратором на любом целевом веб-сервере.</span><span class="sxs-lookup"><span data-stu-id="bc304-128">To use this approach, you'd need to make the build service account an administrator on any target web servers.</span></span>

<span data-ttu-id="bc304-129">В отличие от этого, подход обработчика веб-развертывание предлагает различные преимущества:</span><span class="sxs-lookup"><span data-stu-id="bc304-129">In contrast, the Web Deploy Handler approach offers various advantages:</span></span>

- <span data-ttu-id="bc304-130">Обработчик веб-развертывание поддерживает обычную проверку подлинности по протоколу HTTPS, что позволяет передавать учетные данные альтернативной учетной записи средству веб-развертывания IIS (веб-развертывание).</span><span class="sxs-lookup"><span data-stu-id="bc304-130">The Web Deploy Handler supports basic authentication over HTTPS, which allows you to pass the credentials of an alternative account to the IIS Web Deployment Tool (Web Deploy).</span></span>
- <span data-ttu-id="bc304-131">Можно настроить целевые веб-серверы, чтобы разрешить пользователям без прав администратора развертывать содержимое на определенные веб-сайты IIS с помощью обработчика веб-развертывание.</span><span class="sxs-lookup"><span data-stu-id="bc304-131">You can configure target web servers to allow non-administrator users to deploy content to specific IIS websites using the Web Deploy Handler.</span></span>

<span data-ttu-id="bc304-132">В результате, при автоматизации развертывания веб-пакета из Team Build, ясно предпочтительнее ориентироваться на обработчик веб-развертывание.</span><span class="sxs-lookup"><span data-stu-id="bc304-132">As a result, it's clearly preferable to target the Web Deploy Handler when you automate web package deployment from Team Build.</span></span> <span data-ttu-id="bc304-133">Это рекомендуемый процесс.</span><span class="sxs-lookup"><span data-stu-id="bc304-133">This is the recommended process:</span></span>

1. <span data-ttu-id="bc304-134">Создайте учетную запись домена с низким уровнем привилегий, которая будет использоваться для развертывания.</span><span class="sxs-lookup"><span data-stu-id="bc304-134">Create a low-privileged domain account to use for the deployment.</span></span>
2. <span data-ttu-id="bc304-135">Настройте обработчик веб-развертывание и предоставьте учетной записи необходимые разрешения для развертывания содержимого на определенном веб-сайте IIS, как описано в разделе [Настройка веб-сервера для публикации веб-развертывание (обработчик веб-развертывание)](../configuring-server-environments-for-web-deployment/configuring-a-web-server-for-web-deploy-publishing-web-deploy-handler.md).</span><span class="sxs-lookup"><span data-stu-id="bc304-135">Configure the Web Deploy Handler and grant the account the required permissions to deploy content to a specific IIS website, as described in [Configuring a Web Server for Web Deploy Publishing (Web Deploy Handler)](../configuring-server-environments-for-web-deployment/configuring-a-web-server-for-web-deploy-publishing-web-deploy-handler.md).</span></span>
3. <span data-ttu-id="bc304-136">Вызовите веб-развертывание и назначьте обработчик веб-развертывание, используя обычную проверку подлинности и указав учетные данные созданной учетной записи домена, чтобы выполнить развертывание.</span><span class="sxs-lookup"><span data-stu-id="bc304-136">Invoke Web Deploy and target the Web Deploy Handler, using basic authentication and supplying the credentials of the domain account you created, to perform the deployment.</span></span>

<span data-ttu-id="bc304-137">В образце решения [диспетчера контактов](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) вы указываете тип проверки подлинности (Basic или NTLM), веб-развертывание учетные данные и адрес конечной точки (удаленный агент или обработчик веб-развертывание) в файле проекта, относящемся к конкретной среде.</span><span class="sxs-lookup"><span data-stu-id="bc304-137">In the [Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) sample solution, you specify the authentication type (basic or NTLM), the Web Deploy credentials, and the endpoint address (remote agent or Web Deploy Handler) in the environment-specific project file.</span></span> <span data-ttu-id="bc304-138">Эти значения используются для формулировки и выполнения команды веб-развертывание при выполнении файла проекта.</span><span class="sxs-lookup"><span data-stu-id="bc304-138">These values are used to formulate and run a Web Deploy command when the project file is executed.</span></span> <span data-ttu-id="bc304-139">Дополнительные сведения см. в разделе [Развертывание веб-пакетов](../web-deployment-in-the-enterprise/deploying-web-packages.md).</span><span class="sxs-lookup"><span data-stu-id="bc304-139">For more information, see [Deploying Web Packages](../web-deployment-in-the-enterprise/deploying-web-packages.md).</span></span>

<span data-ttu-id="bc304-140">Дополнительные сведения о настройке обработчика веб-развертывание, включая настройку разрешений, см. в разделе [Настройка веб-сервера для публикации веб-развертывание (обработчик веб-развертывание)](../configuring-server-environments-for-web-deployment/configuring-a-web-server-for-web-deploy-publishing-web-deploy-handler.md).</span><span class="sxs-lookup"><span data-stu-id="bc304-140">For more information on configuring the Web Deploy Handler, including how to configure permissions, see [Configuring a Web Server for Web Deploy Publishing (Web Deploy Handler)](../configuring-server-environments-for-web-deployment/configuring-a-web-server-for-web-deploy-publishing-web-deploy-handler.md).</span></span> <span data-ttu-id="bc304-141">Дополнительные сведения о настройке удаленного агента см. в разделе [Настройка веб-сервера для веб-развертывание публикации (удаленный агент)](../configuring-server-environments-for-web-deployment/configuring-a-web-server-for-web-deploy-publishing-remote-agent.md).</span><span class="sxs-lookup"><span data-stu-id="bc304-141">For more information on configuring the remote agent, see [Configuring a Web Server for Web Deploy Publishing (Remote Agent)](../configuring-server-environments-for-web-deployment/configuring-a-web-server-for-web-deploy-publishing-remote-agent.md).</span></span>

## <a name="configuring-database-server-permissions"></a><span data-ttu-id="bc304-142">Настройка разрешений сервера базы данных</span><span class="sxs-lookup"><span data-stu-id="bc304-142">Configuring Database Server Permissions</span></span>

<span data-ttu-id="bc304-143">Для развертывания базы данных на SQL Server необходимо выполнить следующие действия.</span><span class="sxs-lookup"><span data-stu-id="bc304-143">To deploy a database to SQL Server, you must:</span></span>

- <span data-ttu-id="bc304-144">Создайте имя входа для учетной записи развертывания на экземпляре SQL Server.</span><span class="sxs-lookup"><span data-stu-id="bc304-144">Create a login for the deploying account on the SQL Server instance.</span></span>
- <span data-ttu-id="bc304-145">Предоставьте имени входа **dbcreator** разрешения на экземпляр SQL Server.</span><span class="sxs-lookup"><span data-stu-id="bc304-145">Grant the login **DBCreator** permissions on the SQL Server instance.</span></span>
- <span data-ttu-id="bc304-146">После первоначального развертывания добавьте имя входа в роль **владельца db\_** в целевой базе данных.</span><span class="sxs-lookup"><span data-stu-id="bc304-146">After the initial deployment, add the login to the **db\_owner** role on the target database.</span></span> <span data-ttu-id="bc304-147">Это необходимо, поскольку при последующих развертываниях вы изменяете существующую базу данных, а не создаете новую базу данных.</span><span class="sxs-lookup"><span data-stu-id="bc304-147">This is required because on subsequent deployments, you're modifying an existing database rather than creating a new database.</span></span>

<span data-ttu-id="bc304-148">Проверку подлинности в экземпляре SQL Server можно выполнить с помощью проверки подлинности NTLM или SQL Server проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="bc304-148">You can authenticate to a SQL Server instance using either NTLM authentication or SQL Server authentication:</span></span>

- <span data-ttu-id="bc304-149">При использовании проверки подлинности NTLM необходимо предоставить учетной записи службы сборки разрешения, описанные выше.</span><span class="sxs-lookup"><span data-stu-id="bc304-149">If you use NTLM authentication, you need to grant the permissions described above to the build service account.</span></span>
- <span data-ttu-id="bc304-150">При использовании SQL Server проверки подлинности необходимо предоставить учетной записи SQL Server разрешения, описанные выше.</span><span class="sxs-lookup"><span data-stu-id="bc304-150">If you use SQL Server authentication, you need to grant the permissions described above to the SQL Server account.</span></span> <span data-ttu-id="bc304-151">Также необходимо включить SQL Server имя пользователя и пароль в строку подключения, используемую для развертывания базы данных.</span><span class="sxs-lookup"><span data-stu-id="bc304-151">You also need to include the SQL Server user name and password in the connection string you use to deploy the database.</span></span>

<span data-ttu-id="bc304-152">Пошаговые инструкции по настройке разрешений для развертывания базы данных см. в разделе [Настройка сервера базы данных для веб-развертывание публикации](../configuring-server-environments-for-web-deployment/configuring-a-database-server-for-web-deploy-publishing.md).</span><span class="sxs-lookup"><span data-stu-id="bc304-152">For step-by-step details on how to configure permissions for database deployment, see [Configuring a Database Server for Web Deploy Publishing](../configuring-server-environments-for-web-deployment/configuring-a-database-server-for-web-deploy-publishing.md).</span></span>

## <a name="conclusion"></a><span data-ttu-id="bc304-153">Заключение</span><span class="sxs-lookup"><span data-stu-id="bc304-153">Conclusion</span></span>

<span data-ttu-id="bc304-154">На этом этапе следует понимать необходимые разрешения, а также открытые параметры проверки подлинности при автоматизации развертывания веб-приложений и баз данных из Team Build.</span><span class="sxs-lookup"><span data-stu-id="bc304-154">At this point, you should understand the permissions required, together with the authentication options open to you, when you automate web application and database deployments from Team Build.</span></span> <span data-ttu-id="bc304-155">Кроме того, вы должны иметь возможность реализовать необходимые разрешения на веб-серверах IIS и SQL Server серверах баз данных.</span><span class="sxs-lookup"><span data-stu-id="bc304-155">You should also be able to implement the necessary permissions on IIS web servers and SQL Server database servers.</span></span>

## <a name="further-reading"></a><span data-ttu-id="bc304-156">Дополнительные материалы</span><span class="sxs-lookup"><span data-stu-id="bc304-156">Further Reading</span></span>

<span data-ttu-id="bc304-157">Дополнительные сведения о настройке сред Windows Server для поддержки удаленного развертывания см. в разделе [Настройка серверных сред для веб-развертывания](../configuring-server-environments-for-web-deployment/configuring-server-environments-for-web-deployment.md).</span><span class="sxs-lookup"><span data-stu-id="bc304-157">For more information on configuring Windows server environments to support remote deployment, see [Configuring Server Environments for Web Deployment](../configuring-server-environments-for-web-deployment/configuring-server-environments-for-web-deployment.md).</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="bc304-158">Назад</span><span class="sxs-lookup"><span data-stu-id="bc304-158">Previous</span></span>](deploying-a-specific-build.md)
