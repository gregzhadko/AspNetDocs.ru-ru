---
uid: web-forms/overview/deployment/configuring-team-foundation-server-for-web-deployment/creating-a-build-definition-that-supports-deployment
title: Создание определения сборки, поддерживающего развертывание | Документация Майкрософт
author: jrjlee
description: Если вы хотите выполнить сборку любого типа в Team Foundation Server (TFS) 2010, необходимо создать определение сборки в командном проекте. В этом разделе DES...
ms.author: riande
ms.date: 05/04/2012
ms.assetid: fe47a018-f6d0-4979-80e7-5b1fa75a5865
msc.legacyurl: /web-forms/overview/deployment/configuring-team-foundation-server-for-web-deployment/creating-a-build-definition-that-supports-deployment
msc.type: authoredcontent
ms.openlocfilehash: e11c91a824446572aaf0b3bc6954b9b8ffb4eaff
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78489012"
---
# <a name="creating-a-build-definition-that-supports-deployment"></a>Создание определения сборки, поддерживающего развертывание

кто [Джейсон Иванов](https://github.com/jrjlee)

[Скачать в формате PDF](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> Если вы хотите выполнить сборку любого типа в Team Foundation Server (TFS) 2010, необходимо создать определение сборки в командном проекте. В этом разделе описывается создание нового определения сборки в TFS и управление веб-развертыванием в рамках процесса сборки в Team Build.

Этот раздел является частью серии руководств, основанных на требованиях Enterprise к развертыванию вымышленной компании Fabrikam, Inc. В этой серии руководств используется пример решения&#x2014; [диспетчера контактов](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;для представления веб-приложения с реалистичным уровнем сложности, включая приложение ASP.NET MVC 3, службу Windows Communication Foundation (WCF) и проект базы данных.

Метод развертывания в сердце этих учебников основан на подходе к файлам проекта Split, описанному в разделе [понимание файла проекта](../web-deployment-in-the-enterprise/understanding-the-project-file.md), в котором процесс сборки и развертывания управляется двумя файлами&#x2014;проекта, содержащими инструкции по сборке, которые применяются к каждой целевой среде, и одна содержит параметры сборки и развертывания, относящиеся к конкретной среде. Во время сборки файл проекта, зависящий от среды, объединяется в файл проекта независимо от среды, чтобы сформировать полный набор инструкций по сборке.

## <a name="task-overview"></a>Обзор задач

Определение сборки — это механизм, который управляет тем, как и когда выполняются сборки для командных проектов в TFS. Каждое определение сборки определяет:

- Объекты, которые необходимо собрать, например файлы решений Visual Studio или файлы проектов пользовательского Microsoft Build Engine (MSBuild).
- Критерии, определяющие, когда должна выполняться сборка, например ручные триггеры, непрерывная интеграция (CI) или условные записи с проверкой изменений.
- Расположение, в которое Team Build должна отсылать выходные данные сборки, включая артефакты развертывания, такие как веб-пакеты и скрипты базы данных.
- Время, в течение которого должна храниться каждая сборка.
- Различные другие параметры процесса сборки.

> [!NOTE]
> Дополнительные сведения об определениях сборки см. в разделе [Определение процесса сборки](https://msdn.microsoft.com/library/ms181715.aspx).

В этом разделе будет показано, как создать определение сборки, использующее CI, чтобы сборка активировалась при возврате нового содержимого разработчиком. Если сборка выполняется, служба сборки запускает пользовательский файл проекта для развертывания решения в тестовой среде.

При активации сборки должны произойти следующие действия.

- Во первых, Team Build должен создать решение. В рамках этого процесса Team Build будет вызывать конвейер веб-публикации (WPP) для создания пакетов веб-развертывания для каждого из проектов веб-приложений в решении. Team Build также будет выполнять любые модульные тесты, связанные с решением.
- В случае сбоя сборки решения Командная сборка не должна предпринимать никаких действий. Ошибки модульного теста следует рассматривать как сбой сборки.
- Если сборка решения будет выполнена, Team Build должен запустить файл пользовательского проекта, который управляет развертыванием решения. В рамках этого процесса Team Build вызовет средство веб-развертывания службы IIS (IIS) (веб-развертывание) для установки упакованных веб-приложений на конечных веб-серверах и вызовет служебную программу VSDBCMD. exe для запуска создания базы данных. сценарии на целевых серверах баз данных.

Это иллюстрирует процесс:

![](creating-a-build-definition-that-supports-deployment/_static/image1.png)

Пример решения [диспетчера контактов](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) включает файл пользовательского проекта MSBuild, *Publish. proj*, который можно запускать из MSBuild или Team Build. Как описано в разделе [Общие сведения о процессе сборки](../web-deployment-in-the-enterprise/understanding-the-build-process.md), этот файл проекта определяет логику, которая развертывает веб-пакеты и базы данных в целевой среде. Файл содержит логику, в которой не содержится процесс сборки и упаковки, если он выполняется в Team Build, и при этом выполняются только задачи развертывания. Это связано с тем, что при автоматизации развертывания таким образом, как правило, необходимо убедиться, что решение успешно построено и пройдет все модульные тесты перед началом процесса развертывания.

В следующем разделе объясняется, как реализовать этот процесс путем создания нового определения сборки.

> [!NOTE]
> Эта процедура&#x2014;, при которой один автоматизированный процесс создает, тестирует и развертывает решение&#x2014;, скорее всего, будет наиболее подходящим для развертывания в тестовых средах. Для промежуточной и рабочей сред гораздо чаще требуется развернуть содержимое из предыдущей сборки, которая уже проверена и проверена в тестовой среде. Этот подход описан в следующем разделе [развертывание определенной сборки](deploying-a-specific-build.md).

### <a name="who-performs-this-procedure"></a>Кто выполняет эту процедуру?

Как правило, эта процедура выполняется администратором Team Foundation Server. В некоторых случаях руководитель группы разработчиков может принять участие в данной коллекции командных проектов в TFS. Чтобы создать новое определение сборки, необходимо быть членом группы " **Администраторы сборки коллекции проектов** " для коллекции командных проектов, содержащей ваше решение.

## <a name="create-a-build-definition-for-ci-and-deployment"></a>Создание определения сборки для CI и Deployment

В следующей процедуре описывается создание определения сборки, запускающего CI. Если сборка выполняется, решение развертывается с помощью логики в пользовательском файле проекта MSBuild.

**Создание определения сборки для CI и Deployment**

1. В Visual Studio 2010 в окне **Team Explorer** разверните узел командного проекта, щелкните правой кнопкой мыши элемент **сборки**и выберите пункт **создать определение сборки**.

    ![](creating-a-build-definition-that-supports-deployment/_static/image2.png)
2. На вкладке **Общие** присвойте определению сборки имя (например, **деплойтотест**) и необязательное описание.
3. На вкладке **триггер** выберите условия, по которым необходимо активировать новую сборку. Например, если вы хотите создать решение и развернуть его в тестовой среде каждый раз, когда разработчик вернет новый код, выберите **Непрерывная интеграция**.
4. На вкладке **сборки по умолчанию** в поле **Копировать выходные данные сборки в следующую папку сброса** введите UNC-путь к транзитной папке (например, **\\тфсбуилд\дропс**).

    ![](creating-a-build-definition-that-supports-deployment/_static/image3.png)

    > [!NOTE]
    > В этом расположении сброса хранится несколько сборок в зависимости от настроенной политики хранения. Если требуется опубликовать артефакты развертывания из определенной сборки в промежуточную или рабочую среду, здесь они будут найдены.
5. На вкладке **процесс** в раскрывающемся списке **файл процесса сборки** оставьте выбранным **дефаулттемплате. XAML** . Это один из шаблонов процесса сборки по умолчанию, который добавляется во все новые командные проекты.
6. В таблице **Параметры процесса сборки** щелкните в строке **элементы для построения** , а затем нажмите кнопку **с многоточием** .

    ![](creating-a-build-definition-that-supports-deployment/_static/image4.png)
7. В диалоговом окне **элементы для построения** нажмите кнопку **Добавить**.
8. Перейдите к расположению файла решения и нажмите кнопку **ОК**.

    ![](creating-a-build-definition-that-supports-deployment/_static/image5.png)
9. В диалоговом окне **элементы для построения** нажмите кнопку **Добавить**.
10. В раскрывающемся списке **элементы типа** выберите **файлы проекта MSBuild**.
11. Перейдите к расположению файла настраиваемого проекта, в котором вы управляете процессом развертывания, выберите файл и нажмите кнопку **ОК**.

    ![](creating-a-build-definition-that-supports-deployment/_static/image6.png)
12. В диалоговом окне **элементы для построения** теперь должны отображаться два элемента. Нажмите кнопку **ОК**.

    ![](creating-a-build-definition-that-supports-deployment/_static/image7.png)
13. На вкладке **процесс** в таблице **Параметры процесса построения** разверните раздел **Дополнительно** .
14. В строке **Аргументы MSBuild** добавьте аргументы командной строки MSBuild, которые требуются для сборки *любого* из элементов. В сценарии решения диспетчера контактов эти аргументы являются обязательными:

    [!code-console[Main](creating-a-build-definition-that-supports-deployment/samples/sample1.cmd)]

    ![](creating-a-build-definition-that-supports-deployment/_static/image8.png)
15. В данном примере:

    1. Аргументы пакета **деплойонбуилд = true** и **деплойтаржет =** являются обязательными при построении решения диспетчера контактов. Это указывает MSBuild создавать пакеты веб-развертывания после сборки каждого проекта веб-приложения, как описано в статье [Создание и упаковка проектов веб-приложений](../web-deployment-in-the-enterprise/building-and-packaging-web-application-projects.md).
    2. Аргумент **таржетенвпропсфиле** является обязательным при построении файла *Publish. proj* . Это свойство указывает расположение файла конфигурации для конкретной среды, как описано в разделе [Основные сведения о процессе сборки](../web-deployment-in-the-enterprise/understanding-the-build-process.md).
16. На вкладке **Политика хранения** укажите, сколько сборок каждого типа необходимо хранить в соответствии с требованиями.
17. Выберите команду **Сохранить**.

## <a name="queue-a-build"></a>Помещение построения в очередь

На этом этапе вы создали по крайней мере одно новое определение сборки. Определенный процесс сборки теперь будет выполняться в соответствии с триггерами, указанными в определении сборки.

Если определение сборки настроено для использования CI, можно проверить определение сборки двумя способами:

- Верните некоторое содержимое в командный проект, чтобы активировать автоматическую сборку.
- Постановка сборки в очередь вручную.

**Постановка сборки в очередь вручную**

1. В окне **Team Explorer** щелкните правой кнопкой мыши определение сборки и выберите пункт **поставить в очередь новую сборку**.

    ![](creating-a-build-definition-that-supports-deployment/_static/image9.png)
2. В диалоговом окне **Создание очереди** просмотрите свойства сборки и нажмите кнопку **очередь**.

    ![](creating-a-build-definition-that-supports-deployment/_static/image10.png)

Чтобы проверить ход выполнения и результат сборки&#x2014;независимо от того, был ли он активирован вручную, или автоматически&#x2014;дважды щелкнуть определение сборки в окне **Team Explorer** . Откроется вкладка **Обозреватель сборок** .

![](creating-a-build-definition-that-supports-deployment/_static/image11.png)

Здесь можно устранить неполадки сборок со сбоями. Если дважды щелкнуть отдельную сборку, можно просмотреть сводные данные и перейти к подробным файлам журнала.

![](creating-a-build-definition-that-supports-deployment/_static/image12.png)

Эти сведения можно использовать для устранения неполадок сборок, завершившихся сбоем, и устранения всех проблем, прежде чем пытаться выполнить другую сборку.

> [!NOTE]
> Сборки, выполняющие логику развертывания, скорее всего, завершатся неудачей, пока вы не предоставили серверу сборки разрешения, необходимые в целевой среде. Дополнительные сведения см. в разделе [Настройка разрешений для развертывания Team Build](configuring-permissions-for-team-build-deployment.md).

## <a name="monitor-the-build-process"></a>Мониторинг процесса сборки

TFS предоставляет широкий спектр функций, помогающих отслеживать процесс сборки. Например, TFS может отправить вам сообщение электронной почты или отобразить оповещения в области уведомлений на панели задач после завершения сборки. Дополнительные сведения см. в разделе [Запуск и мониторинг сборок](https://msdn.microsoft.com/library/ms181721.aspx).

## <a name="conclusion"></a>Заключение

В этом разделе описано, как создать определение сборки в TFS. Определение сборки настроено для CI, поэтому процесс сборки выполняется каждый раз, когда разработчик возвращает содержимое в командный проект. Определение сборки выполняет пользовательский файл проекта MSBuild для развертывания веб-пакетов и скриптов базы данных в среде целевого сервера.

Чтобы автоматическое развертывание было завершено в рамках процесса сборки, необходимо предоставить соответствующие разрешения учетной записи службы сборки на целевых веб-серверах и целевом сервере базы данных. В последнем разделе этого руководства, [настройке разрешений для развертывания Team Build](configuring-permissions-for-team-build-deployment.md), описывается, как определить и настроить разрешения, необходимые для автоматического развертывания с сервера Team Build.

## <a name="further-reading"></a>Дополнительные материалы

Дополнительные сведения о создании определений сборки см. в разделе [Создание базового определения сборки](https://msdn.microsoft.com/library/ms181716.aspx) и [Определение процесса сборки](https://msdn.microsoft.com/library/ms181715.aspx). Дополнительные рекомендации по построению очередей см. в разделе [очередь сборки](https://msdn.microsoft.com/library/ms181722.aspx).

> [!div class="step-by-step"]
> [Назад](configuring-a-tfs-build-server-for-web-deployment.md)
> [Вперед](deploying-a-specific-build.md)
