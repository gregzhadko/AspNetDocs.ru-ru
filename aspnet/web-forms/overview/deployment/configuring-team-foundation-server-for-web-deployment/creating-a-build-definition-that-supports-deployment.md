---
uid: web-forms/overview/deployment/configuring-team-foundation-server-for-web-deployment/creating-a-build-definition-that-supports-deployment
title: Создание определения сборки, которая поддерживает развертывание | Документация Майкрософт
author: jrjlee
description: Если вы хотите выполнять любой вид сборки в Team Foundation Server (TFS) 2010, необходимо создать определение сборки в командный проект. Этот раздел des...
ms.author: riande
ms.date: 05/04/2012
ms.assetid: fe47a018-f6d0-4979-80e7-5b1fa75a5865
msc.legacyurl: /web-forms/overview/deployment/configuring-team-foundation-server-for-web-deployment/creating-a-build-definition-that-supports-deployment
msc.type: authoredcontent
ms.openlocfilehash: 97a60274d9306ea0ee332fcc1ab9e487355dbedb
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/09/2019
ms.locfileid: "59384946"
---
# <a name="creating-a-build-definition-that-supports-deployment"></a>Создание определения сборки, поддерживающего развертывание

по [Джейсон Lee](https://github.com/jrjlee)

[Скачать PDF](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> Если вы хотите выполнять любой вид сборки в Team Foundation Server (TFS) 2010, необходимо создать определение сборки в командный проект. В этом разделе описываются способы создания нового определения построения в Team Foundation Server и как управлять веб-развертывания в рамках процесса сборки в Team Build.


Этот раздел является частью серии учебников, исходя из требования к развертыванию enterprise вымышленной компании Fabrikam, Inc. В этой серии руководств используется пример решения&#x2014; [решения диспетчера контактов](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;для представления веб-приложения с более реалистичные уровень сложности, включая приложения ASP.NET MVC 3, Windows Communication Служба Foundation (WCF) и проект базы данных.

Метод развертывания в основе этих учебников основан на разбиение проекта файл подход, описанный в [основные сведения о файле проекта](../web-deployment-in-the-enterprise/understanding-the-project-file.md), в которой процесс построения и развертывания управляется двумя файлы проекта&#x2014;один содержащая инструкции сборки, которые применяются к каждой целевой среде и содержащего параметры построения и развертывания для конкретной среды. Во время сборки файл проекта для конкретной среды объединяется в файл проекта независимой от среды, чтобы полный набор инструкций построения.

## <a name="task-overview"></a>Общие сведения о задачах

Определение сборки — это механизм, который управляет, как и когда построения выполняются для командных проектов в TFS. Задает каждое определение сборки:

- Задачи, которые требуется выполнить сборку, таких как файлы решений среды Visual Studio или пользовательские файлы проекта Microsoft Build Engine (MSBuild).
- Критерии, которые определяют, когда сборка займет размещения, таких как ручные триггеры, непрерывной интеграции (CI), или проверкой.
- Расположение, в которую Team Build должны отправлять выходные данные сборки, включая развертывания артефактов, таких как веб-пакеты и скрипты базы данных.
- Количество времени, должны храниться каждой сборки.
- Различные другие параметры процесса сборки.

> [!NOTE]
> Дополнительные сведения о определений сборок, см. в разделе [определить процедуру сборки](https://msdn.microsoft.com/library/ms181715.aspx).


В этом разделе показано, как создать определение сборки, который использует CI, таким образом, чтобы сборки активируется в том случае, когда разработчик возвращает новое содержимое. В случае успешного построения, служба сборки запускает файл пользовательского проекта для развертывания решения в тестовой среде.

Когда вы запускаете сборки, эти действия нужно сделать:

- Во-первых Team Build следует сборку решения. В рамках этого процесса Team Build вызывает конвейер публикации Web (WPP) для создания веб-развертывания пакетов для каждого из проектов веб-приложений в решении. Team Build будет также выполняться все модульные тесты, связанные с решением.
- При сбое построения решения, Team Build следует предпринимать никаких дополнительных действий. Неудачными модульными тестами должны рассматриваться как сбой сборки.
- В случае успешного построения решения, Team Build следует запустить файле пользовательского проекта, который управляет развертыванием решения. В рамках этого процесса Team Build вызовет средство Internet Information Services (IIS) веб-развертывания (веб-развертывание) для установки упакованного веб-приложения на веб-серверах назначения, и она вызывает служебную программу VSDBCMD.exe, чтобы запустить процесс создания базы данных скрипты на конечных серверах базы данных.

Это иллюстрирует этот процесс.

![](creating-a-build-definition-that-supports-deployment/_static/image1.png)

[Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) примера решения включает в себя пользовательского файла проекта MSBuild, *Publish.proj*, который можно запустить из MSBuild или Team Build. Как описано в разделе [основные сведения о процессе построения](../web-deployment-in-the-enterprise/understanding-the-build-process.md), этот файл проекта определяет логику, которая развертывает веб-пакетов и баз данных в целевой среде. Этот файл содержит логику, которая пропускает сборку и упаковку, если оно выполняется в Team Build, оставляя только задачи развертывания для запуска. Это обусловлено тем, при автоматизации развертывания таким образом, обычно имеет смысл для обеспечения успешного построения решения и передает все модульные тесты, прежде чем начнется процесс развертывания.

В следующем разделе показано, как реализовать этот процесс, создав новое определение сборки.

> [!NOTE]
> Эта процедура&#x2014;в которой автоматической одного процесса построения, проверяет и развертывание решения&#x2014;будет наиболее подходит для развертывания в тестовых сред. Для промежуточной и рабочей среды вы гораздо более обычно требуется развернуть содержимое из предыдущего построения, которое уже проверен и проверен в тестовой среде. Этот подход описан в следующем разделе [развертывание конкретного построения](deploying-a-specific-build.md).


### <a name="who-performs-this-procedure"></a>Кто выполняет эту процедуру?

Как правило администратором TFS выполняет эту процедуру. В некоторых случаях руководитель группы разработчиков могут отвечать за коллекции командных проектов в TFS. Чтобы создать новое определение сборки, необходимо быть членом группы **Администраторы сборки коллекции проектов** группы для коллекции командных проектов, содержащую решение.

## <a name="create-a-build-definition-for-ci-and-deployment"></a>Создайте определение сборки для непрерывной Интеграции и развертывания

Далее описано, как создать определение сборки, которое активирует непрерывной Интеграции. В случае успешного построения, развертывания решения с помощью логику в пользовательский файл проекта MSBuild.

**Чтобы создать определение сборки для непрерывной Интеграции и развертывания**

1. В Visual Studio 2010 в **Team Explorer** окна, разверните узел командного проекта, щелкните правой кнопкой мыши **построения**, а затем нажмите кнопку **создать определение сборки**.

    ![](creating-a-build-definition-that-supports-deployment/_static/image2.png)
2. На **Общие** вкладке, присвойте имя определения сборки (например, **DeployToTest**) и необязательное описание.
3. На **триггера** выберите условия, на которых нужно активировать новую сборку. Например, если вы хотите создать решение, а также развертывание в тестовой среде, каждый раз, когда разработчик возвращает в новом коде, выберите **непрерывной интеграции**.
4. На **сборки по умолчанию** на вкладке **Копировать выходные данные в следующую папку сброса** введите путь к транзитному универсальными именами (UNC) (например,  **\\TFSBUILD\Drops**).

    ![](creating-a-build-definition-that-supports-deployment/_static/image3.png)

    > [!NOTE]
    > Это расположение сброса хранит несколько сборок, в зависимости от настроенной политики хранения. Если вы хотите опубликовать артефакты развертывания для конкретной сборки в промежуточной или рабочей среде, где их можно найти это.
5. На **процесс** на вкладке **файл процесса сборки** раскрывающегося списка, оставьте **DefaultTemplate.xaml** выбранного. Это один из шаблонов процесса сборки по умолчанию, добавляемых в новые командные проекты.
6. В **параметры процесса сборки** таблицы, щелкните поле **элементы для построения** строк, а затем нажмите кнопку **кнопку с многоточием** кнопки.

    ![](creating-a-build-definition-that-supports-deployment/_static/image4.png)
7. В **элементы для построения** диалоговом окне щелкните **добавить**.
8. Перейдите к расположению файла решения, а затем нажмите кнопку **ОК**.

    ![](creating-a-build-definition-that-supports-deployment/_static/image5.png)
9. В **элементы для построения** диалоговом окне щелкните **добавить**.
10. В **элементы типа** раскрывающемся списке выберите **файлы проекта MSBuild**.
11. Перейдите к расположению файла пользовательского проекта с помощью которого можно контролировать процесс развертывания, выберите файл и нажмите кнопку **ОК**.

    ![](creating-a-build-definition-that-supports-deployment/_static/image6.png)
12. **Элементы для построения** диалоговое окно должно отобразиться два элемента. Нажмите кнопку **ОК**.

    ![](creating-a-build-definition-that-supports-deployment/_static/image7.png)
13. На **процесс** на вкладке **параметры процесса сборки** таблицу, разверните узел **Дополнительно** раздел.
14. В **Аргументы MSBuild** строки, добавить аргументы командной строки MSBuild, *либо* элементов для построения требуется. В сценарии решения диспетчера контактов эти аргументы являются обязательными:

    [!code-console[Main](creating-a-build-definition-that-supports-deployment/samples/sample1.cmd)]

    ![](creating-a-build-definition-that-supports-deployment/_static/image8.png)
15. В этом примере:

    1. **DeployOnBuild = true** и **DeployTarget = пакет** аргументы являются обязательными при построении решения диспетчера контактов. Это указывает, что MSBuild для создания веб-развертывания пакетов после построения проекта каждого веб-приложения, как описано в разделе [сборка и упаковка проектов веб-приложений](../web-deployment-in-the-enterprise/building-and-packaging-web-application-projects.md).
    2. **TargetEnvPropsFile** аргумент является обязательным при построении *Publish.proj* файла. Это свойство указывает расположение файла конфигурации среды, как описано в разделе [основные сведения о процессе построения](../web-deployment-in-the-enterprise/understanding-the-build-process.md).
16. На **политику хранения** вкладке, настройте количество построений с результатами каждого типа, который вы хотите сохранить при необходимости.
17. Нажмите кнопку **Сохранить**.

## <a name="queue-a-build"></a>Помещение построения в очередь

На этом этапе вы создали по крайней мере одного нового определения построения. Процесс построения, который вы определили теперь будет выполняться в соответствии с триггерами, указанный в определении сборки.

Если вы настроили определение сборки для использования непрерывной Интеграции, определения построения можно проверить двумя способами:

- Верните часть содержимого к командному проекту для запуска автоматической сборки.
- Поставить в очередь сборку вручную.

**Построение в очередь вручную**

1. В **Team Explorer** окно, щелкните правой кнопкой мыши определение построения и нажмите кнопку **поставить новую сборку в**.

    ![](creating-a-build-definition-that-supports-deployment/_static/image9.png)
2. В **поставить сборку в очередь** диалоговое окно, просмотрите свойства построения и нажмите кнопку **очереди**.

    ![](creating-a-build-definition-that-supports-deployment/_static/image10.png)

Чтобы просмотреть ход выполнения и результат построения&#x2014;независимо от того, является ли его срабатывание, вручную или автоматически&#x2014;дважды щелкните определение построения в **Team Explorer** окна. Откроется **Build Explorer** вкладки.

![](creating-a-build-definition-that-supports-deployment/_static/image11.png)

На этой странице можно устранить сбоям построения. При двойном щелчке отдельной сборки, можно просмотреть сводные данные и детализация подробных файлов журнала.

![](creating-a-build-definition-that-supports-deployment/_static/image12.png)

Эти сведения можно использовать для устранения неполадок сбоям построения и устранения возможных проблем, прежде чем другой сборки.

> [!NOTE]
> Сборок, которые реализуют логику развертывания могут завершаться сбоем, пока сервер сборки были предоставлены все разрешения, необходимые в целевой среде. Дополнительные сведения см. в разделе [Настройка разрешений для развертывания сборки Team](configuring-permissions-for-team-build-deployment.md).


## <a name="monitor-the-build-process"></a>Монитор процесса построения

TFS предоставляет широкий набор функций для мониторинга процесса построения. Например TFS может отправить вам сообщение электронной почты или отображение оповещений в области уведомлений панели задач после завершения построения. Дополнительные сведения см. в разделе [выполнения и отслеживания построений](https://msdn.microsoft.com/library/ms181721.aspx).

## <a name="conclusion"></a>Заключение

В этом разделе описано, как создать определение сборки в TFS. Определение сборки настраивается для непрерывной Интеграции, поэтому процесс сборки выполняется каждый раз, когда разработчик возвращает содержимое к командному проекту. Определение построения выполняет пользовательского файла проекта MSBuild для развертывания веб-пакеты и скрипты базы данных в среде целевого сервера.

В порядке для автоматизированного развертывания для успешного выполнения как часть процесса построения необходимо предоставить соответствующие разрешения для учетной записи службы сборки на целевой веб-серверов и целевой сервер базы данных. Последний раздел, в этом руководстве [Настройка разрешений для развертывания сборки Team](configuring-permissions-for-team-build-deployment.md), описывается, как определять и настраивать разрешения, необходимые для автоматического развертывания с сервера Team Build.

## <a name="further-reading"></a>Дополнительные сведения

Дополнительные сведения о создании определений сборки см. в разделе [создание базового определения сборки](https://msdn.microsoft.com/library/ms181716.aspx) и [определить процедуру сборки](https://msdn.microsoft.com/library/ms181715.aspx). Дополнительные рекомендации по очереди сборок см. в разделе [поставить в очередь сборку](https://msdn.microsoft.com/library/ms181722.aspx).

> [!div class="step-by-step"]
> [Назад](configuring-a-tfs-build-server-for-web-deployment.md)
> [Вперед](deploying-a-specific-build.md)
