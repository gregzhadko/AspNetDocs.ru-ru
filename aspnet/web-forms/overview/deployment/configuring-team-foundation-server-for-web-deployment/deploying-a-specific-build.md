---
uid: web-forms/overview/deployment/configuring-team-foundation-server-for-web-deployment/deploying-a-specific-build
title: Развертывание определенной сборки | Документация Майкрософт
author: jrjlee
description: В этом разделе описывается развертывание веб-пакетов и скриптов базы данных из определенной предыдущей сборки в новое назначение, например промежуточная или Рабочая енвиро...
ms.author: riande
ms.date: 05/04/2012
ms.assetid: c979535f-48a3-4ec4-a633-a77889b86ddb
msc.legacyurl: /web-forms/overview/deployment/configuring-team-foundation-server-for-web-deployment/deploying-a-specific-build
msc.type: authoredcontent
ms.openlocfilehash: 6bede6b36c24ade928ab052e14daec1e017bd0b2
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78519576"
---
# <a name="deploying-a-specific-build"></a>Развертывание конкретной сборки

кто [Джейсон Иванов](https://github.com/jrjlee)

[Скачать в формате PDF](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> В этом разделе описывается, как развернуть веб-пакеты и скрипты базы данных из определенной предыдущей сборки в новое назначение, например в промежуточной или рабочей среде.

Этот раздел является частью серии руководств, основанных на требованиях Enterprise к развертыванию вымышленной компании Fabrikam, Inc. В этой серии руководств используется пример решения&#x2014; [диспетчера контактов](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;для представления веб-приложения с реалистичным уровнем сложности, включая приложение ASP.NET MVC 3, службу Windows Communication Foundation (WCF) и проект базы данных.

Метод развертывания в сердце этих учебников основан на подходе к файлам проекта Split, описанному в разделе [понимание файла проекта](../web-deployment-in-the-enterprise/understanding-the-project-file.md), в котором процесс сборки и развертывания управляется двумя файлами&#x2014;проекта, содержащими инструкции по сборке, которые применяются к каждой целевой среде, и одна содержит параметры сборки и развертывания, относящиеся к конкретной среде. Во время сборки файл проекта, зависящий от среды, объединяется в файл проекта независимо от среды, чтобы сформировать полный набор инструкций по сборке.

## <a name="task-overview"></a>Обзор задач

До настоящего момента темы в этом руководстве посвящены созданию, упаковке и развертыванию веб-приложений и баз данных в рамках единого этапа или автоматизированного процесса. Однако в некоторых распространенных сценариях необходимо выбрать развертываемые ресурсы из списка сборок в транзитной папке. Иными словами, последняя сборка может не быть сборкой, которую вы хотите развернуть.

Рассмотрим сценарий непрерывной интеграции (CI), описанный в предыдущем разделе [Создание определения сборки, поддерживающего развертывание](creating-a-build-definition-that-supports-deployment.md). Вы создали определение сборки в Team Foundation Server (TFS) 2010. Каждый раз, когда разработчик проверяет код в TFS, Team Build выполнит сборку кода, создаст веб-пакеты и скрипты баз данных в рамках процесса сборки, пропустит любые модульные тесты и развернет ресурсы в тестовой среде. В зависимости от политики хранения, настроенной при создании определения сборки, TFS будет хранить определенное число предыдущих сборок.

![](deploying-a-specific-build/_static/image1.png)

Теперь предположим, что вы выполнили проверку и проверочное тестирование для одной из этих сборок в тестовой среде, и вы готовы развернуть приложение в промежуточной среде. Пока разработчики могли вернуть новый код. Вы не хотите перестраивать решение и развертывать его в промежуточной среде, и вы не хотите развертывать последнюю сборку в промежуточной среде. Вместо этого необходимо развернуть определенную сборку, проверенную и проверенную на тестовых серверах.

Для этого необходимо сообщить Microsoft Build Engine (MSBuild), где найти веб-пакеты и скрипты базы данных, созданные определенной сборкой.

## <a name="overriding-the-outputroot-property"></a>Переопределение свойства Аутпутрут

В [примере решения](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)файл *Publish. proj* объявляет свойство с именем **аутпутрут**. Как видно из названия, это корневая папка, содержащая все, что создает процесс сборки. В файле *Publish. proj* видно, что свойство **аутпутрут** ссылается на корневое расположение всех ресурсов развертывания.

> [!NOTE]
> **Аутпутрут** — это часто используемое имя свойства. Файлы C# проекта Visual и Visual Basic также объявляют это свойство, чтобы сохранить корневое расположение для всех выходных данных сборки.

[!code-xml[Main](deploying-a-specific-build/samples/sample1.xml)]

Если вы хотите, чтобы файл проекта развернул веб-пакеты и скрипты базы данных&#x2014;из другого расположения, такого как выходные данные&#x2014;предыдущей сборки TFS, нужно просто переопределить свойство **аутпутрут** . Необходимо задать значение свойства в соответствующей папке сборки на сервере Team Build. Если MSBuild выполнялся из командной строки, можно указать значение **аутпутрут** в качестве аргумента командной строки:

[!code-console[Main](deploying-a-specific-build/samples/sample2.cmd)]

Однако на практике вам также нужно пропустить цель&#x2014; **сборки** , если вы не планируете использовать выходные данные сборки. Это можно сделать, указав целевые объекты, которые необходимо выполнить из командной строки:

[!code-console[Main](deploying-a-specific-build/samples/sample3.cmd)]

Однако в большинстве случаев необходимо создать логику развертывания в определении сборки TFS. Это позволяет пользователям, у которых есть **очередь** , создавать и запускать развертывание из любой установки Visual Studio с подключением к серверу TFS.

## <a name="creating-a-build-definition-to-deploy-specific-builds"></a>Создание определения сборки для развертывания конкретных сборок

В следующей процедуре описывается создание определения сборки, позволяющего пользователям запускать развертывания в промежуточной среде с помощью одной команды.

В этом случае вы не хотите, чтобы определение сборки действительно выполняло все&#x2014;, что нужно для выполнения логики развертывания в файле пользовательского проекта. Файл *Publish. proj* включает условную логику, которая пропускает целевой объект **сборки** , если файл выполняется в Team Build. Это достигается путем вычисления встроенного свойства **буилдингинтеамбуилд** , которое автоматически устанавливается в **значение true** при запуске файла проекта в Team Build. В результате можно пропустить процесс сборки и просто запустить файл проекта для развертывания существующей сборки.

**Создание определения сборки для активации развертывания вручную**

1. В Visual Studio 2010 в окне **Team Explorer** разверните узел командного проекта, щелкните правой кнопкой мыши элемент **сборки**и выберите пункт **создать определение сборки**.

    ![](deploying-a-specific-build/_static/image2.png)
2. На вкладке **Общие** присвойте определению сборки имя (например, **деплойтостагинг**) и необязательное описание.
3. На вкладке **триггер** выберите **вручную — возвраты не активируют новую сборку**.
4. На вкладке **сборки по умолчанию** в поле **Копировать выходные данные сборки в следующую папку сброса** введите UNC-путь к транзитной папке (например, **\\тфсбуилд\дропс**).

    ![](deploying-a-specific-build/_static/image3.png)
5. На вкладке **процесс** в раскрывающемся списке **файл процесса сборки** оставьте выбранным **дефаулттемплате. XAML** . Это один из шаблонов процесса сборки по умолчанию, который добавляется во все новые командные проекты.
6. В таблице **Параметры процесса сборки** щелкните в строке **элементы для построения** , а затем нажмите кнопку **с многоточием** .

    ![](deploying-a-specific-build/_static/image4.png)
7. В диалоговом окне **элементы для построения** нажмите кнопку **Добавить**.
8. В раскрывающемся списке **элементы типа** выберите **файлы проекта MSBuild**.
9. Перейдите к расположению файла настраиваемого проекта, в котором вы управляете процессом развертывания, выберите файл и нажмите кнопку **ОК**.

    ![](deploying-a-specific-build/_static/image5.png)
10. В диалоговом окне **элементы для построения** нажмите кнопку **ОК**.
11. В таблице **Параметры процесса сборки** разверните раздел **Дополнительно** .
12. В строке **Аргументы MSBuild** укажите расположение файла проекта для конкретной среды и добавьте заполнитель для расположения папки сборки:

    [!code-console[Main](deploying-a-specific-build/samples/sample4.cmd)]

    ![](deploying-a-specific-build/_static/image6.png)

    > [!NOTE]
    > Вам потребуется переопределить значение **аутпутрут** при каждой постановке сборки в очередь. Это описано в следующей процедуре.
13. Выберите команду **Сохранить**.

При активации сборки необходимо обновить свойство **аутпутрут** , чтобы оно указывало на сборку, которую требуется развернуть.

**Развертывание определенной сборки из определения сборки**

1. В окне **Team Explorer** щелкните правой кнопкой мыши определение сборки и выберите пункт **поставить в очередь новую сборку**.

    ![](deploying-a-specific-build/_static/image7.png)
2. В диалоговом окне **Создание очереди** на вкладке **Параметры** разверните раздел **Дополнительно** .
3. В строке **Аргументы MSBuild** замените значение свойства **аутпутрут** расположением папки сборки. Пример:

    [!code-console[Main](deploying-a-specific-build/samples/sample5.cmd)]

    ![](deploying-a-specific-build/_static/image8.png)

    > [!NOTE]
    > Не забудьте включить замыкающую косую черту в конце пути к папке сборки.
4. Щелкните **очередь**.

При постановке сборки в очередь файл проекта развертывает скрипты базы данных и веб-пакеты из папки сброса сборки, указанной в свойстве **аутпутрут** .

## <a name="conclusion"></a>Заключение

В этом разделе описано, как опубликовать ресурсы развертывания, такие как веб-пакеты и скрипты базы данных, из определенной предыдущей сборки с использованием модели развертывания файлов проекта с разделением. Было объяснено, как переопределить свойство **аутпутрут** и как внедрить логику развертывания в определение сборки TFS.

## <a name="further-reading"></a>Дополнительные материалы

Дополнительные сведения о создании определений сборки см. в разделе [Создание базового определения сборки](https://msdn.microsoft.com/library/ms181716.aspx) и [Определение процесса сборки](https://msdn.microsoft.com/library/ms181715.aspx). Дополнительные рекомендации по построению очередей см. в разделе [очередь сборки](https://msdn.microsoft.com/library/ms181722.aspx).

> [!div class="step-by-step"]
> [Назад](creating-a-build-definition-that-supports-deployment.md)
> [Вперед](configuring-permissions-for-team-build-deployment.md)
