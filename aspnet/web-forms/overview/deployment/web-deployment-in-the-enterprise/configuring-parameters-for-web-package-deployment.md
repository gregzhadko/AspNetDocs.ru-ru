---
uid: web-forms/overview/deployment/web-deployment-in-the-enterprise/configuring-parameters-for-web-package-deployment
title: Настройка параметров для развертывания веб-пакетов | Документация Майкрософт
author: jrjlee
description: В этом разделе описано, как задать значения параметров, например имена веб-приложений службы IIS (IIS), строки подключения и конечные точки службы,...
ms.author: riande
ms.date: 05/04/2012
ms.assetid: 37947d79-ab1e-4ba9-9017-52e7a2757414
msc.legacyurl: /web-forms/overview/deployment/web-deployment-in-the-enterprise/configuring-parameters-for-web-package-deployment
msc.type: authoredcontent
ms.openlocfilehash: f04ace98d81a33053b10cab7e40dbd75a6c0992c
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78438402"
---
# <a name="configuring-parameters-for-web-package-deployment"></a>Настройка параметров для развертывания веб-пакета

кто [Джейсон Иванов](https://github.com/jrjlee)

[Скачать в формате PDF](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> В этом разделе описано, как задать значения параметров, например имена веб-приложений службы IIS (IIS), строки подключения и конечные точки службы, при развертывании веб-пакета на удаленном веб-сервере IIS.

При построении проекта веб-приложения процесс сборки и упаковки создает три ключевых файла:

- ZIP-файл *[имя проекта]* . Это пакет веб-развертывания для проекта веб-приложения. Этот пакет содержит все сборки, файлы, скрипты баз данных и ресурсы, необходимые для повторного создания веб-приложения на удаленном веб-сервере IIS.
- Файл *[имя проекта]. deploy. cmd* . Он содержит набор параметризованных команд веб-развертывание (MSDeploy. exe), которые публикуют пакет веб-развертывания на удаленном веб-сервере IIS.
- A *[имя проекта]. Файл SetParameters. XML* . Это предоставляет набор значений параметров для команды MSDeploy. exe. Вы можете обновить значения в этом файле и передать его в веб-развертывание в качестве параметра командной строки при развертывании веб-пакета.

> [!NOTE]
> Дополнительные сведения о процессе сборки и упаковки см. в разделе [Создание и упаковка проектов веб-приложений](building-and-packaging-web-application-projects.md).

Файл *SetParameters. XML* создается динамически из файла проекта веб-приложения и всех файлов конфигурации в проекте. При сборке и упаковке проекта конвейер веб-публикаций (WPP) автоматически обнаруживает множество переменных, которые, скорее всего, меняются между средами развертывания, такими как целевое веб-приложение IIS и любые строки подключения к базам данных. Эти значения автоматически параметризованы в пакете веб-развертывания и добавляются в файл *SetParameters. XML* . Например, если добавить строку подключения в файл *Web. config* в проекте веб-приложения, процесс сборки обнаружит это изменение и добавит запись в файл *SetParameters. XML* соответствующим образом.

В большинстве случаев эта Автоматическая параметризация будет достаточной. Однако если пользователям необходимо изменить другие параметры между средами развертывания, такими как параметры приложения или URL-адреса конечной точки службы, необходимо сообщить конвейеру WPP, что эти значения следует параметризовать в пакете развертывания, и добавить соответствующие записи в файл *SetParameters. XML* . В следующих разделах объясняется, как это сделать.

### <a name="automatic-parameterization"></a>Автоматическая параметризация

При сборке и упаковке веб-приложения конвейер предложит автоматически параметризовать следующие компоненты:

- Путь и имя целевого веб-приложения IIS.
- Любые строки подключения в файле *Web. config* .
- Строки подключения для всех баз данных, добавляемых на вкладку **Пакет/Публикация SQL** на страницах свойств проекта.

Например, если вы хотите создать и упаковать пример решения [диспетчера контактов](the-contact-manager-solution.md) , не затрагивая процесс параметризации каким-либо образом, в конвейере WPP будет создан этот файл *ContactManager. MVC. SetParameters. XML* :

[!code-xml[Main](configuring-parameters-for-web-package-deployment/samples/sample1.xml)]

В данном случае:

- Параметр **Name веб-приложения IIS** — это путь IIS, по которому требуется развернуть веб-приложение. Значение по умолчанию берется из **веб-страницы пакет или публикация** на страницах свойств проекта.
- Параметр **строки подключения ApplicationServices-Web. config** был создан из элемента **ConnectionString/Add** в файле *Web. config* . Он представляет строку подключения, которую приложение должно использовать для связи с базой данных членства. Предоставленное здесь значение будет заменено на развернутый файл *Web. config* . Значение по умолчанию берется из файла *Web. config* , выполняемого перед развертыванием.

В конвейере WPP также параметризуются эти свойства в создаваемом пакете развертывания. Значения этих свойств можно указать при установке пакета развертывания. Если пакет устанавливается вручную с помощью диспетчера IIS, как описано в разделе [Установка веб-пакетов вручную](manually-installing-web-packages.md), мастер установки предлагает указать значения для всех параметров. Если пакет устанавливается удаленно с помощью файла *. deploy. cmd* , как описано в разделе [Развертывание веб-пакетов](deploying-web-packages.md), веб-развертывание будет искать этот файл *SetParameters. XML* для указания значений параметров. Можно изменить значения в файле *SetParameters. XML* вручную или настроить его как часть автоматизированного процесса сборки и развертывания. Этот процесс подробно описан далее в этом разделе.

### <a name="custom-parameterization"></a>Пользовательская параметризация

В более сложных сценариях развертывания часто требуется параметризовать дополнительные свойства перед развертыванием проекта. В целом, следует параметризовать все свойства и параметры, которые будут различаться в зависимости от среды назначения. К ним могут относиться следующие:

- Конечные точки службы в файле *Web. config* .
- Параметры приложения в файле *Web. config* .
- Любые другие декларативные свойства, которые необходимо указать пользователям.

Самый простой способ параметризовать эти свойства — добавить файл *Parameters. XML* в корневую папку проекта веб-приложения. Например, в решении диспетчера контактов проект ContactManager. MVC содержит файл *Parameters. XML* в корневой папке.

![](configuring-parameters-for-web-package-deployment/_static/image1.png)

Если открыть этот файл, вы увидите, что он содержит одну запись **параметра** . В записи используется запрос языка XML Path (XPath) для поиска и параметризации URL-адреса конечной точки службы Контактсервице Windows Communication Foundation (WCF) в файле *Web. config* .

[!code-xml[Main](configuring-parameters-for-web-package-deployment/samples/sample2.xml)]

Помимо параметризации URL-адреса конечной точки в пакете развертывания, конвейер предустановки также добавляет соответствующую запись в файл *SetParameters. XML* , который создается вместе с пакетом развертывания.

[!code-xml[Main](configuring-parameters-for-web-package-deployment/samples/sample3.xml)]

При установке пакета развертывания вручную Диспетчер IIS запрашивает адрес конечной точки службы рядом со свойствами, которые были автоматически параметризованы. Если пакет развертывания устанавливается путем запуска файла *. deploy. cmd* , можно изменить файл *SetParameters. XML* , чтобы предоставить значение для адреса конечной точки службы вместе со значениями свойств, которые были параметризованы автоматически.

Полные сведения о создании файла *Parameters. XML* см. в разделе [как использовать параметры для настройки параметров развертывания при установке пакета](https://msdn.microsoft.com/library/ff398068.aspx). Пошаговые инструкции приведены в процедуре **Использование параметров развертывания для параметров файла Web. config** .

## <a name="modifying-the-setparametersxml-file"></a>Изменение файла SetParameters. XML

&#x2014;Если планируется развертывание пакета веб-приложения вручную либо путем запуска файла *. deploy. cmd* , либо путем запуска msdeploy. exe из командной строки&#x2014;, нет никаких действий по изменению файла *SetParameters. XML* вручную до развертывания. Однако при работе над корпоративным решением может потребоваться развернуть пакет веб-приложения в рамках более крупного автоматизированного процесса сборки и развертывания. В этом сценарии вам потребуется Microsoft Build Engine (MSBuild), чтобы изменить файл *SetParameters. XML* . Это можно сделать с помощью задачи MSBuild **задача XmlPoke** .

Этот процесс показан в [образце решения диспетчера контактов](the-contact-manager-solution.md) . Приведенные ниже примеры кода были изменены для отображения только сведений, относящихся к этому примеру.

> [!NOTE]
> Более широкий обзор модели файла проекта в образце решения и общие сведения о файлах пользовательских проектов см. в разделе [Основные сведения о файле проекта](understanding-the-project-file.md) и [понимании процесса сборки](understanding-the-build-process.md).

Во-первых, интересующие значения параметров определяются как свойства в файле проекта для конкретной среды (например, *env-dev. proj*).

[!code-xml[Main](configuring-parameters-for-web-package-deployment/samples/sample4.xml)]

> [!NOTE]
> Рекомендации по настройке файлов проекта для конкретной среды сервера см. в разделе [Настройка свойств развертывания для целевой среды](../configuring-server-environments-for-web-deployment/configuring-deployment-properties-for-a-target-environment.md).

Затем файл *Publish. proj* импортирует эти свойства. Так как каждый файл *SetParameters. XML* связан с файлом *. deploy. cmd* , и в конечном итоге требуется, чтобы файл проекта вызывал все файлы *. deploy. cmd* , файл проекта создает *элемент* MSBuild для каждого файла *. deploy. cmd* и определяет свойства, представляющие *метаданные элемента*.

[!code-xml[Main](configuring-parameters-for-web-package-deployment/samples/sample5.xml)]

В данном случае:

- Значение метаданных **параметерсксмл** указывает расположение файла *SetParameters. XML* .
- Значение **иисвебаппнаме** — это путь IIS, на котором требуется развернуть веб-приложение.
- Значение **мембершипдбконнектионстринг** — это строка подключения для базы данных членства, а значение **мембершипдбконнектионнаме** — это атрибут **Name** соответствующего параметра в файле *SetParameters. XML* .
- Значение **сервицеендпоинтвалуе** — это адрес конечной точки службы WCF на целевом сервере, а значение **сервицеендпоинтпарамнаме** — это атрибут Name соответствующего параметра в файле *SetParameters. XML* .

Наконец, в файле *Publish. proj* целевой объект **Публишвебпаккажес** использует задачу **задача XmlPoke** для изменения этих значений в файле *SetParameters. XML* .

[!code-xml[Main](configuring-parameters-for-web-package-deployment/samples/sample6.xml)]

Вы заметите, что каждая задача **задача XmlPoke** задает четыре значения атрибута:

- Атрибут **XmlInputPath** сообщает задаче, где найти файл, который требуется изменить.
- Атрибут **запроса** — это запрос XPath, который определяет ИЗМЕНЯЕМЫЙ XML-узел.
- Атрибут **value** — это новое значение, которое необходимо вставить в ВЫБРАННЫЙ узел XML.
- Атрибут **Condition** — это критерий, в соответствии с которым задача должна запускаться или не выполняться. В этих случаях условие гарантирует, что вы не попытаетесь вставить значение null или пустое в файл *SetParameters. XML* .

## <a name="conclusion"></a>Заключение

В этом разделе описывается роль файла *SetParameters. XML* и объясняется, как он создается при построении проекта веб-приложения. В нем объясняется, как можно параметризовать дополнительные параметры, добавив файл *Parameters. XML* в проект. Также описано, как можно изменить файл *SetParameters. XML* как часть более крупного автоматизированного процесса сборки с помощью задачи **задача XmlPoke** в файлах проекта.

В следующем разделе [Развертывание веб-пакетов](deploying-web-packages.md)описано, как можно развернуть веб-пакет, запустив файл *. deploy. cmd* или непосредственно с помощью команд msdeploy. exe. В обоих случаях можно указать файл *SetParameters. XML* в качестве параметра развертывания.

## <a name="further-reading"></a>Дополнительные материалы

Сведения о создании веб-пакетов см. в разделе [Создание и упаковка проектов веб-приложений](building-and-packaging-web-application-projects.md). Рекомендации по фактическому развертыванию веб-пакета см. в разделе [Развертывание веб-пакетов](deploying-web-packages.md). Пошаговое руководство по созданию файла *Parameters. XML* см. в разделе [Практическое руководство. Использование параметров для настройки параметров развертывания при установке пакета](https://msdn.microsoft.com/library/ff398068.aspx).

Дополнительные общие сведения о параметризации в веб-развертывание см. в разделе [веб-развертывание параметризации в действии](https://go.microsoft.com/?linkid=9805119) (запись блога).

> [!div class="step-by-step"]
> [Назад](building-and-packaging-web-application-projects.md)
> [Вперед](deploying-web-packages.md)
