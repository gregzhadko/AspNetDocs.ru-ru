---
uid: web-forms/overview/deployment/web-deployment-in-the-enterprise/deploying-web-packages
title: Развертывание веб-пакетов | Документация Майкрософт
author: jrjlee
description: В этом разделе описывается публикация пакетов веб-развертывания на удаленном сервере с помощью средства веб-развертывания службы IIS (IIS) (Web...
ms.author: riande
ms.date: 05/04/2012
ms.assetid: a5c5eed2-8683-40a5-a2e1-35c9f8d17c29
msc.legacyurl: /web-forms/overview/deployment/web-deployment-in-the-enterprise/deploying-web-packages
msc.type: authoredcontent
ms.openlocfilehash: 91b99e6e250342851aea6860164b6f6af54818d1
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78464970"
---
# <a name="deploying-web-packages"></a>Развертывание веб-пакетов

кто [Джейсон Иванов](https://github.com/jrjlee)

[Скачать в формате PDF](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> В этом разделе описывается публикация пакетов веб-развертывания на удаленном сервере с помощью средства веб-развертывания службы IIS (IIS) (веб-развертывание) 2,0.
> 
> Существует два основных способа развертывания веб-пакета на удаленном сервере.
> 
> - Вы можете напрямую использовать служебную программу командной строки MSDeploy. exe.
> - Вы можете запустить файл *[Project name]. deploy. cmd* , который создает процесс сборки.
> 
> Конечный результат одинаков, независимо от используемого подхода. По сути, все файлы *. deploy. cmd* — это запуск msdeploy. exe с некоторыми предварительно определенными значениями, чтобы не нужно было предоставлять как можно больше сведений для развертывания пакета. Это упрощает процесс развертывания. С другой стороны, использование MSDeploy. exe напрямую дает гораздо большую гибкость по сравнению с тем, как именно развертывается пакет.
> 
> Используемый подход зависит от различных факторов, в том числе от того, какой объем контроля необходим для процесса развертывания и предназначен ли для веб-развертывание службы удаленного агента или обработчика веб-развертывание. В этом разделе объясняется, как использовать каждый из подходов и определять, когда подходит каждый подход.
> 
> В задачах и пошаговых руководствах этого раздела предполагается, что:
> 
> - Вы создали и упакованы веб-приложение, как описано в статье [Создание и упаковка проектов веб-приложений](building-and-packaging-web-application-projects.md).
> - Вы изменили файл *SetParameters. XML* , чтобы предоставить правильные значения параметров для целевой среды, как описано в разделе [Настройка параметров для развертывания веб-пакетов](configuring-parameters-for-web-package-deployment.md).

Запуск файла [*Project Name*] *. deploy. cmd* — это самый простой способ развертывания веб-пакета. В частности, использование файла *. deploy. cmd* обеспечивает эти преимущества непосредственно перед использованием msdeploy. exe:

- Не нужно указывать расположение пакета&#x2014;веб-развертывания файл *. deploy. cmd* уже знает, где он находится.
- Указывать расположение файла&#x2014; *SetParameters. XML* не требуется. *deploy. cmd* уже знает, где он находится.
- Не нужно указывать исходные и конечные поставщики&#x2014;msdeploy. *deploy. cmd* уже знает, какие значения следует использовать.
- Не нужно указывать параметры&#x2014;операции msdeploy. *deploy. cmd* автоматически добавляет к команде msdeploy. exe часто требуемые значения.

Прежде чем использовать файл *. deploy. cmd* для развертывания веб-пакета, необходимо убедиться в том, что:

- Файл *. deploy. cmd* , [*имя проекта*]. Файл *SetParameters. XML* и веб-пакет ([*имя проекта*]. *ZIP*) находятся в одной папке.
- Веб-развертывание (MSDeploy. exe) устанавливается на компьютер, на котором выполняется файл *. deploy. cmd* .

Файл *. deploy. cmd* поддерживает различные параметры командной строки. При запуске файла из командной строки это основной синтаксис:

[!code-console[Main](deploying-web-packages/samples/sample1.cmd)]

Необходимо указать либо флаг **/t** , либо параметр **/y** , чтобы указать, следует ли выполнять пробный запуск или динамическое развертывание соответственно (не использовать оба флага в одной команде). В этой таблице объясняется назначение каждого из этих флагов.

| Флаг | Description |
| --- | --- |
| **/T** | Вызывает MSDeploy. exe с флагом **– WhatIf** , который указывает на пробный запуск. Вместо того, чтобы развертывать пакет, он создает отчет о том, что произойдет при развертывании пакета. |
| **/Y** | Вызывает MSDeploy. exe без флага **-WhatIf** . При этом пакет развертывается на локальном компьютере или на указанном целевом сервере. |
| **/M** | Указывает имя целевого сервера или URL-адрес службы. Дополнительные сведения о значениях, которые можно указать здесь, см. в подразделе " **рекомендации для конечных точек** " этой статьи. Если опустить флаг **/m** , пакет будет развернут на локальном компьютере. |
| **/** | Указывает тип проверки подлинности, который MSDeploy. exe должен использовать для выполнения развертывания. Возможные значения: **NTLM** и **Basic**. Если опустить флаг **/a** , по умолчанию используется тип проверки подлинности **NTLM** для развертывания в службе удаленного агента веб-развертывание **и для развертывания** в обработчик веб-развертывание. |
| **/U** | Указывает имя пользователя. Это применимо только в том случае, если используется обычная проверка подлинности. |
| **/P** | Задает пароль. Это применимо только в том случае, если используется обычная проверка подлинности. |
| **/L** | Указывает, что пакет должен быть развернут в локальном экземпляре IIS Express. |
| **/G** | Указывает, что пакет развертывается с помощью [параметра поставщика темпажент](https://technet.microsoft.com/library/ee517345(WS.10).aspx). Если опустить флаг **/g** , по умолчанию будет задано значение **false**. |

> [!NOTE]
> Каждый раз, когда процесс сборки создает веб-пакет, он также создает файл с именем *[имя проекта]. деплой-реадме. txt* , объясняющий эти параметры развертывания.

В дополнение к этим флагам можно указать веб-развертывание параметры операции в качестве дополнительных параметров *. deploy. cmd* . Любые дополнительные параметры, заданные вами, просто передаются в соответствующую команду MSDeploy. exe. Дополнительные сведения об этих параметрах см. в разделе [параметры веб-развертывание операции](https://technet.microsoft.com/library/dd569089(WS.10).aspx).

Предположим, что вы хотите развернуть проект веб-приложения ContactManager. MVC в тестовой среде, запустив файл *. deploy. cmd* . Тестовая среда настроена для использования службы удаленного агента веб-развертывание, как описано в разделе [Настройка веб-сервера для публикации веб-развертывание (удаленный агент)](../configuring-server-environments-for-web-deployment/configuring-a-web-server-for-web-deploy-publishing-remote-agent.md). Чтобы развернуть веб-приложение, необходимо выполнить следующие действия.

**Развертывание веб-приложения с помощью файла. deploy. cmd**

1. Создайте и упакуйте проект веб-приложения, как описано в статье [Создание и упаковка проектов веб-приложений](building-and-packaging-web-application-projects.md).
2. Измените файл *ContactManager. MVC. SetParameters. XML* , чтобы он содержал правильные значения параметров для тестовой среды, как описано в разделе [Настройка параметров для развертывания веб-пакетов](configuring-parameters-for-web-package-deployment.md).
3. Откройте окно командной строки и перейдите к расположению файла *ContactManager. MVC. deploy. cmd* .
4. Введите эту команду и нажмите клавишу ВВОД:

    [!code-console[Main](deploying-web-packages/samples/sample2.cmd)]

В данном примере:

- Флаг **/y** означает, что вы хотите действительно развернуть пакет, а не выполнять пробный запуск.
- Флаг **/m** указывает, что необходимо развернуть пакет на сервере с именем TESTWEB1. По этому значению MSDeploy. exe попытается развернуть пакет в службе удаленного агента веб-развертывание на http://TESTWEB1/MSDeployAgentService.
- Флаг **/a** указывает, что вы хотите использовать проверку подлинности NTLM. Поэтому не нужно указывать имя пользователя и пароль.

Чтобы продемонстрировать, как использование файла *. deploy. cmd* упрощает процесс развертывания, Взгляните на команду msdeploy. exe, которая создается и выполняется при запуске *ContactManager. MVC. deploy. cmd* с помощью параметров, приведенных выше.

[!code-console[Main](deploying-web-packages/samples/sample3.cmd)]

Дополнительные сведения об использовании файла *. deploy. cmd* для развертывания веб-пакета см. в разделе [инструкции. Установка пакета развертывания с помощью файла deploy. cmd](https://msdn.microsoft.com/library/ff356104.aspx).

## <a name="using-msdeployexe"></a>Использование MSDeploy. exe

Хотя использование файла *. deploy. cmd* , как правило, упрощает процесс развертывания, в некоторых ситуациях предпочтительно использовать msdeploy. exe напрямую. Пример:

- Если требуется выполнить развертывание в обработчик веб-развертывание от имени пользователя без прав администратора, нельзя использовать файл *. deploy. cmd* . Это происходит из-за ошибки в веб-развертывание 2,0, как описано в разделе **рекомендации по конечной точке**.
- Если вы хотите вручную переключаться между различными файлами *SetParameters. XML* в разных местах, вы можете использовать msdeploy. exe напрямую.
- Если вы хотите переопределить несколько аргументов командной строки MSDeploy. exe, вы можете использовать MSDeploy. exe напрямую.

При использовании MSDeploy. exe необходимо предоставить три ключевых фрагмента информации:

- Параметр **– Source** , который указывает, откуда берутся данные.
- Параметр **– dest** , который указывает, куда будут находиться данные.
- Параметр **– verb** , указывающий [операцию](https://technet.microsoft.com/library/dd568989(WS.10).aspx) , которую необходимо выполнить.

MSDeploy. exe использует [поставщиков веб-развертывание](https://technet.microsoft.com/library/dd569040(WS.10).aspx) для обработки исходных и целевых данных. Веб-развертывание включает множество поставщиков, представляющих диапазон приложений и источников данных, с&#x2014;которыми он может работать. Например, существуют поставщики SQL Server баз данных, веб-серверов IIS, сертификатов, сборок глобального кэша сборок, различных файлов конфигурации и множества других типов данных. Оба параметра **– Source** и **– dest** должны указывать поставщик в формате **-Source**: [*providerName*] = [*Location*]. При развертывании веб-пакета на веб-сайте IIS следует использовать следующие значения:

- Поставщик **-источник** всегда является [пакетным](https://technet.microsoft.com/library/dd569019(WS.10).aspx). Пример:

    [!code-console[Main](deploying-web-packages/samples/sample4.cmd)]
- Поставщик **– dest** всегда имеет значение [Auto](https://technet.microsoft.com/library/dd569016(WS.10).aspx). Например:

    [!code-console[Main](deploying-web-packages/samples/sample5.cmd)]
- **Команда –** всегда **синхронизирована**.

    [!code-console[Main](deploying-web-packages/samples/sample6.cmd)]

Кроме того, необходимо указать другие [Параметры, зависящие от поставщика](https://technet.microsoft.com/library/dd569001(WS.10).aspx) , и общие [Параметры операций](https://technet.microsoft.com/library/dd569089(WS.10).aspx). Например, предположим, что вы хотите развернуть веб-приложение ContactManager. MVC в промежуточной среде. Развертывание будет нацелено на обработчик веб-развертывание и должно использовать обычную проверку подлинности. Чтобы развернуть веб-приложение, необходимо выполнить следующие действия.

**Развертывание веб-приложения с помощью MSDeploy. exe**

1. Создайте и упакуйте проект веб-приложения, как описано в статье [Создание и упаковка проектов веб-приложений](building-and-packaging-web-application-projects.md).
2. Измените файл *ContactManager. MVC. SetParameters. XML* , чтобы он содержал правильные значения параметров для промежуточной среды, как описано в разделе [Настройка параметров для развертывания веб-пакетов](configuring-parameters-for-web-package-deployment.md).
3. Откройте окно командной строки и перейдите в расположение MSDeploy. exe. Обычно это%Програмфилес%\иис\микрософт веб-развертывание V2\msdeploy.exe.
4. Введите эту команду и нажмите клавишу ВВОД (пропустите разрывы строк):

    [!code-console[Main](deploying-web-packages/samples/sample7.cmd)]

В данном примере:

- Параметр **-Source** указывает поставщик **пакета** и указывает расположение веб-пакета.
- Параметр **– dest** задает **Автоматическое** определение поставщика. Параметр **ComputerName** предоставляет URL-адрес службы обработчика веб-развертывание на целевом сервере. Параметр **AuthType** указывает, что требуется использовать обычную проверку подлинности, и, таким образом, необходимо указать **имя пользователя** и **пароль**. Наконец, параметр **инклудеаклс = "false"** указывает, что не нужно копировать списки управления доступом (ACL) файлов в исходном веб-приложении на целевой сервер.
- Аргумент **– глагол: Sync** указывает, что вы хотите реплицировать исходное содержимое на целевом сервере.
- Аргументы **– disableLink** указывают, что вы не хотите реплицировать пулы приложений, конфигурацию виртуального каталога или сертификаты SSL (SSL) на целевом сервере. Дополнительные сведения см. в разделе [расширения ссылок веб-развертывание](https://technet.microsoft.com/library/dd569028(WS.10).aspx).
- Параметр **– сетпарамфиле** задает расположение файла *SetParameters. XML* .
- Параметр **– алловунтрустед** указывает, что веб-развертывание должен принимать SSL-сертификаты, которые не были выданы доверенным центром сертификации. Если вы развертываете в обработчик веб-развертывание и используете самозаверяющий сертификат для защиты URL-адреса службы, необходимо включить этот параметр.

## <a name="automating-web-package-deployment"></a>Автоматизация развертывания веб-пакетов

В большинстве корпоративных сценариев вам потребуется развернуть веб-пакеты в рамках более крупного или автоматизированного развертывания. Независимо от того, выбрано ли развертывание веб-пакетов путем запуска файла *. deploy. cmd* или непосредственно с помощью MSDeploy. exe, можно параметризовать команды и вызывать их из целевого объекта в Microsoft Build Engineном файле проекта (MSBuild).

В образце решения диспетчера контактов ознакомьтесь с целевым объектом **публишвебпаккажес** в файле *Publish. proj* . Этот целевой объект выполняется один раз для каждого файла *. deploy. cmd* , идентифицируемого списком элементов с именем **публишпаккажес**. Целевой объект использует свойства и метаданные элемента для создания полного набора значений аргументов для каждого файла *. deploy. cmd* , а затем использует задачу **exec** для выполнения команды.

[!code-xml[Main](deploying-web-packages/samples/sample8.xml)]

> [!NOTE]
> Более широкий обзор модели файла проекта в образце решения и общие сведения о файлах пользовательских проектов см. в разделе [Основные сведения о файле проекта](understanding-the-project-file.md) и [понимании процесса сборки](understanding-the-build-process.md).

## <a name="endpoint-considerations"></a>Рекомендации по конечной точке

Независимо от того, выполняется ли развертывание веб-пакета путем запуска файла *deploy. cmd* или непосредственно с помощью MSDeploy. exe, необходимо указать имя компьютера или конечную точку службы для развертывания.

Если целевой веб-сервер настроен для развертывания с помощью службы веб-развертывание Remote Agent, укажите URL-адрес целевой службы в качестве места назначения.

[!code-console[Main](deploying-web-packages/samples/sample9.cmd)]

Кроме того, можно указать имя сервера в качестве места назначения, а веб-развертывание будет вычислять URL-адрес удаленной службы агента.

[!code-console[Main](deploying-web-packages/samples/sample10.cmd)]

Если целевой веб-сервер настроен для развертывания с помощью обработчика веб-развертывание, необходимо указать адрес конечной точки службы веб-управления IIS (WMSvc) в качестве места назначения. По умолчанию используется следующий вид:

[!code-console[Main](deploying-web-packages/samples/sample11.cmd)]

Вы можете ориентироваться на любую из этих конечных точек, используя либо непосредственно файл *. deploy. cmd* , либо msdeploy. exe. Однако если требуется выполнить развертывание в обработчик веб-развертывание как пользователя без прав администратора, как описано в разделе [Настройка веб-сервера для публикации веб-развертывание (обработчик веб-развертывание)](../configuring-server-environments-for-web-deployment/configuring-a-web-server-for-web-deploy-publishing-web-deploy-handler.md), необходимо добавить строку запроса в адрес конечной точки службы.

[!code-console[Main](deploying-web-packages/samples/sample12.cmd)]

Это обусловлено тем, что пользователь без прав администратора не имеет доступа на уровне сервера к службам IIS. Он имеет доступ только к определенному веб-сайту IIS. На момент написания статьи из-за ошибки в конвейере веб-публикаций нельзя запустить файл *. deploy. cmd* , используя адрес конечной точки, включающий строку запроса. В этом сценарии необходимо развернуть веб-пакет с помощью MSDeploy. exe напрямую.

> [!NOTE]
> Дополнительные сведения о службе удаленного агента веб-развертывание и обработчике веб-развертывание см. в разделе [Выбор правильного подхода к веб-развертыванию](../configuring-server-environments-for-web-deployment/choosing-the-right-approach-to-web-deployment.md). Инструкции по настройке файлов проекта для конкретной среды для развертывания в этих конечных точках см. в разделе [Настройка свойств развертывания для целевой среды](../configuring-server-environments-for-web-deployment/configuring-deployment-properties-for-a-target-environment.md).

## <a name="authentication-considerations"></a>Вопросы, касающиеся проверки подлинности

Независимо от того, выполняется ли развертывание веб-пакета путем запуска файла *. deploy. cmd* или непосредственно с помощью MSDeploy. exe, необходимо указать тип проверки подлинности. Веб-развертывание принимает два возможных значения: **NTLM** или **Basic**. При указании обычной проверки подлинности также необходимо указать имя пользователя и пароль. При выборе типа проверки подлинности необходимо учитывать различные факторы.

- Если выполняется развертывание в службе удаленного агента веб-развертывание, необходимо использовать проверку подлинности NTLM. Служба удаленного агента не принимает учетные данные обычной проверки подлинности.
- При развертывании в обработчик веб-развертывание можно использовать проверку подлинности NTLM или обычную. Значение по умолчанию — обычная проверка подлинности. Хотя обычная проверка подлинности зависит от имен пользователей и паролей, передаваемых в виде обычного текста, учетные данные защищаются, так как обработчик веб-развертывание всегда использует шифрование SSL.
- Если веб-пакет содержит базу данных, а веб-сервер и сервер базы данных являются отдельными компьютерами, то вы не сможете развернуть базу данных с помощью проверки подлинности NTLM из-за [ограничения "двойного прыжка" NTLM](https://go.microsoft.com/?linkid=9805120). Необходимо либо использовать учетные данные SQL Server в строке подключения развертывания, либо указать учетные данные обычной проверки подлинности для веб-развертывание. Эта проблема подробно описана в статье [развертывание баз данных членства в корпоративных средах](../advanced-enterprise-web-deployment/deploying-membership-databases-to-enterprise-environments.md).

## <a name="conclusion"></a>Заключение

В этом разделе описано, как развернуть веб-пакет, запустив файл *. deploy. cmd* или непосредственно с помощью MSDeploy. exe. Он объясняется, когда подходит каждый подход, и он описывает, как можно параметризовать и выполнить команду развертывания в рамках большого процесса одноэтапного или автоматизированного построения.

## <a name="further-reading"></a>Дополнительные материалы

Инструкции по созданию и параметризации пакета веб-развертывания см. в статьях [Создание и упаковка проектов веб-приложений](building-and-packaging-web-application-projects.md) и [Настройка параметров для развертывания веб-пакетов](configuring-parameters-for-web-package-deployment.md). Инструкции по созданию и развертыванию веб-пакетов из экземпляра Team Foundation Server (TFS) см. в разделе [настройка Team Foundation Server для автоматического веб-развертывания](../configuring-team-foundation-server-for-web-deployment/configuring-team-foundation-server-for-web-deployment.md). Сведения о настройке и устранении неполадок в процессе развертывания см. в разделе [исключение файлов и папок из развертывания](../advanced-enterprise-web-deployment/excluding-files-and-folders-from-deployment.md).

> [!div class="step-by-step"]
> [Назад](configuring-parameters-for-web-package-deployment.md)
> [Вперед](deploying-database-projects.md)
