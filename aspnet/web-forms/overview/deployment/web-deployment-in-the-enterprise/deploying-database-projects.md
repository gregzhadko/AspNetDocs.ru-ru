---
uid: web-forms/overview/deployment/web-deployment-in-the-enterprise/deploying-database-projects
title: Развертывание проектов баз данных | Документация Майкрософт
author: jrjlee
description: Примечание. во многих сценариях корпоративного развертывания требуется возможность публикации добавочных обновлений в развернутой базе данных. Альтернативой является повторное создание...
ms.author: riande
ms.date: 05/04/2012
ms.assetid: 832f226a-1aa3-4093-8c29-ce4196793259
msc.legacyurl: /web-forms/overview/deployment/web-deployment-in-the-enterprise/deploying-database-projects
msc.type: authoredcontent
ms.openlocfilehash: 221808758492aedb8e8329364e511df28fd11105
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78514944"
---
# <a name="deploying-database-projects"></a><span data-ttu-id="79bc3-104">Развертывание проектов баз данных</span><span class="sxs-lookup"><span data-stu-id="79bc3-104">Deploying Database Projects</span></span>

<span data-ttu-id="79bc3-105">кто [Джейсон Иванов](https://github.com/jrjlee)</span><span class="sxs-lookup"><span data-stu-id="79bc3-105">by [Jason Lee](https://github.com/jrjlee)</span></span>

[<span data-ttu-id="79bc3-106">Скачать в формате PDF</span><span class="sxs-lookup"><span data-stu-id="79bc3-106">Download PDF</span></span>](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> [!NOTE]
> <span data-ttu-id="79bc3-107">Во многих сценариях корпоративного развертывания требуется возможность публикации добавочных обновлений в развернутой базе данных.</span><span class="sxs-lookup"><span data-stu-id="79bc3-107">In lots of enterprise deployment scenarios, you need the ability to publish incremental updates to a deployed database.</span></span> <span data-ttu-id="79bc3-108">Альтернативой является повторное создание базы данных при каждом развертывании, что означает потерю всех данных в существующей базе данных.</span><span class="sxs-lookup"><span data-stu-id="79bc3-108">The alternative is to recreate the database on every deployment, which means you lose any data in the existing database.</span></span> <span data-ttu-id="79bc3-109">При работе с Visual Studio 2010 рекомендуется использовать VSDBCMD для добавочной публикации базы данных.</span><span class="sxs-lookup"><span data-stu-id="79bc3-109">When you work with Visual Studio 2010, using VSDBCMD is the recommended approach to incremental database publishing.</span></span> <span data-ttu-id="79bc3-110">Однако следующая версия Visual Studio и конвейер веб-публикаций (WPP) будут включать средства, поддерживающие добавочную публикацию напрямую.</span><span class="sxs-lookup"><span data-stu-id="79bc3-110">However, the next version of Visual Studio and the Web Publishing Pipeline (WPP) will include tooling that supports incremental publishing directly.</span></span>

<span data-ttu-id="79bc3-111">Если открыть пример решения диспетчера контактов в Visual Studio 2010, вы увидите, что проект базы данных содержит папку свойств, содержащую четыре файла.</span><span class="sxs-lookup"><span data-stu-id="79bc3-111">If you open the Contact Manager sample solution in Visual Studio 2010, you'll see that the database project includes a Properties folder that contains four files.</span></span>

![](deploying-database-projects/_static/image1.png)

<span data-ttu-id="79bc3-112">Вместе с файлом проекта (*ContactManager. Database. dbproj* в этом случае) эти файлы управляют различными аспектами процесса сборки и развертывания:</span><span class="sxs-lookup"><span data-stu-id="79bc3-112">Together with the project file (*ContactManager.Database.dbproj* in this case), these files control various aspects of the build and deployment process:</span></span>

- <span data-ttu-id="79bc3-113">Файл *Database. SQLCMDVARS* предоставляет значения для всех переменных SQLCMD, используемых при развертывании проекта.</span><span class="sxs-lookup"><span data-stu-id="79bc3-113">The *Database.sqlcmdvars* file provides values for any SQLCMD variables you use when you deploy the project.</span></span> <span data-ttu-id="79bc3-114">Для каждой конфигурации решения (например, отладка и выпуск) можно указать другой SQLCMDVARS-файл.</span><span class="sxs-lookup"><span data-stu-id="79bc3-114">Each solution configuration (for example, debug and release) can specify a different .sqlcmdvars file.</span></span>
- <span data-ttu-id="79bc3-115">Файл *Database. sqldeployment* предоставляет параметры, относящиеся к развертыванию, например, следует ли использовать параметры сортировки, определенные в проекте, или параметры сортировки целевого сервера, следует ли повторно создавать целевую базу данных каждый раз или просто внести изменения в существующую базу данных, чтобы она была актуальной и так далее.</span><span class="sxs-lookup"><span data-stu-id="79bc3-115">The *Database.sqldeployment* file provides deployment-specific settings, like whether to use the collation defined in your project or the collation of the destination server, whether to recreate the destination database every time or simply amend the existing database to bring it up to date, and so on.</span></span> <span data-ttu-id="79bc3-116">В каждой конфигурации решения можно указать другой SQLDEPLOYMENT-файл.</span><span class="sxs-lookup"><span data-stu-id="79bc3-116">Each solution configuration can specify a different .sqldeployment file.</span></span>
- <span data-ttu-id="79bc3-117">Файл *Database. склпермиссионс* — это XML-документ, который можно использовать для определения любых разрешений, которые необходимо добавить в целевую базу данных.</span><span class="sxs-lookup"><span data-stu-id="79bc3-117">The *Database.sqlpermissions* file is an XML document that you can use to define any permissions you want to add to the target database.</span></span> <span data-ttu-id="79bc3-118">Все конфигурации решений совместно используют один и тот же файл склпермиссионс.</span><span class="sxs-lookup"><span data-stu-id="79bc3-118">All solution configurations share the same .sqlpermissions file.</span></span>
- <span data-ttu-id="79bc3-119">В файле *Database. sqlsettings* указываются свойства уровня базы данных, используемые при создании базы данных, такие как параметры сортировки для использования, поведение операторов сравнения и т. д.</span><span class="sxs-lookup"><span data-stu-id="79bc3-119">The *Database.sqlsettings* file specifies the database-level properties to use when creating the database, like the collation to use, the behavior of comparison operators, and so on.</span></span> <span data-ttu-id="79bc3-120">Все конфигурации решений совместно используют один и тот же файл sqlsettings.</span><span class="sxs-lookup"><span data-stu-id="79bc3-120">All solution configurations share the same .sqlsettings file.</span></span>

<span data-ttu-id="79bc3-121">Стоит потратить немного времени, чтобы открыть эти файлы в Visual Studio и ознакомиться с содержимым.</span><span class="sxs-lookup"><span data-stu-id="79bc3-121">It's worth taking a moment to open these files in Visual Studio and familiarize yourself with the contents.</span></span>

<span data-ttu-id="79bc3-122">При построении проекта базы данных процесс сборки создает два файла:</span><span class="sxs-lookup"><span data-stu-id="79bc3-122">When you build a database project, the build process creates two files:</span></span>

- <span data-ttu-id="79bc3-123">*Схема базы данных* (DBSCHEMA-файл).</span><span class="sxs-lookup"><span data-stu-id="79bc3-123">A *database schema* (.dbschema file).</span></span> <span data-ttu-id="79bc3-124">Это описывает схему базы данных, которую необходимо создать в формате XML.</span><span class="sxs-lookup"><span data-stu-id="79bc3-124">This describes the schema of the database you want to create in XML format.</span></span>
- <span data-ttu-id="79bc3-125">*Манифест развертывания* (деплойманифест-файл).</span><span class="sxs-lookup"><span data-stu-id="79bc3-125">A *deployment manifest* (.deploymanifest file).</span></span> <span data-ttu-id="79bc3-126">В нем содержатся все сведения, необходимые для создания и развертывания базы данных.</span><span class="sxs-lookup"><span data-stu-id="79bc3-126">This contains all the information required to create and deploy your database.</span></span> <span data-ttu-id="79bc3-127">Он ссылается на DBSCHEMA-файл вместе с другими ресурсами, такими как инструкции по развертыванию (SQLDEPLOYMENT-файл) и любые скрипты SQL, выполняемые перед развертыванием или после развертывания.</span><span class="sxs-lookup"><span data-stu-id="79bc3-127">It references the .dbschema file along with other resources, like the deployment instructions (the .sqldeployment file) and any pre-deployment or post-deployment SQL scripts.</span></span>

<span data-ttu-id="79bc3-128">Это показывает связь между этими ресурсами:</span><span class="sxs-lookup"><span data-stu-id="79bc3-128">This shows the relationship between these resources:</span></span>

![](deploying-database-projects/_static/image2.png)

<span data-ttu-id="79bc3-129">Как видите, файл. sqlsettings и файл склпермиссионс являются входными данными для процесса сборки.</span><span class="sxs-lookup"><span data-stu-id="79bc3-129">As you can see, the .sqlsettings file and the .sqlpermissions file are inputs to the build process.</span></span> <span data-ttu-id="79bc3-130">Вместе с файлом проекта базы данных эти файлы используются для создания файла схемы базы данных.</span><span class="sxs-lookup"><span data-stu-id="79bc3-130">Along with the database project file, these files are used to create the database schema file.</span></span> <span data-ttu-id="79bc3-131">SQLDEPLOYMENT-файл и. SQLCMDVARS-файл проходят процесс сборки без изменений.</span><span class="sxs-lookup"><span data-stu-id="79bc3-131">The .sqldeployment file and the .sqlcmdvars file pass through the build process unchanged.</span></span> <span data-ttu-id="79bc3-132">Манифест развертывания указывает расположение схемы базы данных, файл sqldeployment, SQLCMDVARS-файл и все скрипты SQL, выполняемые перед развертыванием или после него.</span><span class="sxs-lookup"><span data-stu-id="79bc3-132">The deployment manifest indicates the location of the database schema, the .sqldeployment file, the .sqlcmdvars file, and any pre-deployment or post-deployment SQL scripts.</span></span>

## <a name="why-use-vsdbcmd-to-deploy-a-database-project"></a><span data-ttu-id="79bc3-133">Зачем использовать VSDBCMD для развертывания проекта базы данных?</span><span class="sxs-lookup"><span data-stu-id="79bc3-133">Why Use VSDBCMD to Deploy a Database Project?</span></span>

<span data-ttu-id="79bc3-134">Существует несколько различных подходов к развертыванию проектов баз данных.</span><span class="sxs-lookup"><span data-stu-id="79bc3-134">There are various different approaches to deploying database projects.</span></span> <span data-ttu-id="79bc3-135">Однако не все они подходят для развертывания проекта базы данных на удаленных серверах в корпоративной среде.</span><span class="sxs-lookup"><span data-stu-id="79bc3-135">However, not all of them are suitable for deploying a database project to remote servers in an enterprise environment.</span></span> <span data-ttu-id="79bc3-136">Рассмотрите, что нужно сделать с развертыванием проекта базы данных.</span><span class="sxs-lookup"><span data-stu-id="79bc3-136">Consider what you want from a database project deployment.</span></span> <span data-ttu-id="79bc3-137">В сценариях корпоративного развертывания, скорее всего, потребуется:</span><span class="sxs-lookup"><span data-stu-id="79bc3-137">In enterprise deployment scenarios, you're likely to want:</span></span>

- <span data-ttu-id="79bc3-138">Возможность развертывания проекта базы данных из удаленного расположения.</span><span class="sxs-lookup"><span data-stu-id="79bc3-138">The ability to deploy the database project from a remote location.</span></span>
- <span data-ttu-id="79bc3-139">Возможность выполнять добавочные обновления существующей базы данных.</span><span class="sxs-lookup"><span data-stu-id="79bc3-139">The ability to make incremental updates to an existing database.</span></span>
- <span data-ttu-id="79bc3-140">Возможность включать скрипты, выполняемые перед развертыванием или сценарии, выполняемые после развертывания.</span><span class="sxs-lookup"><span data-stu-id="79bc3-140">The ability to include pre-deployment scripts or post-deployment scripts.</span></span>
- <span data-ttu-id="79bc3-141">Возможность адаптации развертывания к нескольким конечным средам.</span><span class="sxs-lookup"><span data-stu-id="79bc3-141">The ability to tailor the deployment to multiple destination environments.</span></span>
- <span data-ttu-id="79bc3-142">Возможность развертывания проекта базы данных в составе более крупного, обычно допускающего одношагового развертывания решения с одним шагом.</span><span class="sxs-lookup"><span data-stu-id="79bc3-142">The ability to deploy the database project as part of a larger, typically scripted, single-step solution deployment.</span></span>

<span data-ttu-id="79bc3-143">Существует три основных подхода, которые можно использовать для развертывания проекта базы данных.</span><span class="sxs-lookup"><span data-stu-id="79bc3-143">There are three main approaches you can use to deploy a database project:</span></span>

- <span data-ttu-id="79bc3-144">Функции развертывания можно использовать с типом проекта базы данных в Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="79bc3-144">You can use the deployment functionality with the database project type in Visual Studio 2010.</span></span> <span data-ttu-id="79bc3-145">При сборке и развертывании проекта базы данных в Visual Studio 2010 в процессе развертывания используется манифест развертывания для создания файла развертывания на основе SQL, относящегося к конфигурации сборки.</span><span class="sxs-lookup"><span data-stu-id="79bc3-145">When you build and deploy a database project in Visual Studio 2010, the deployment process uses the deployment manifest to generate a SQL-based deployment file specific to the build configuration.</span></span> <span data-ttu-id="79bc3-146">При этом база данных будет создана, если она еще не существует, или внести необходимые изменения в базу данных, если она уже существует.</span><span class="sxs-lookup"><span data-stu-id="79bc3-146">This will create the database if it doesn't already exist or make any necessary changes to the database if it does already exist.</span></span> <span data-ttu-id="79bc3-147">Можно использовать SQLCMD. exe для запуска этого файла на целевом сервере или настроить Visual Studio для создания и запуска файла.</span><span class="sxs-lookup"><span data-stu-id="79bc3-147">You can use SQLCMD.exe to run this file on your destination server, or you can set Visual Studio to create and run the file.</span></span> <span data-ttu-id="79bc3-148">Недостаток этого подхода заключается в том, что у вас есть только ограниченный контроль над параметрами развертывания.</span><span class="sxs-lookup"><span data-stu-id="79bc3-148">The disadvantage of this approach is that you have only limited control over the deployment settings.</span></span> <span data-ttu-id="79bc3-149">Часто может также потребоваться изменить файл развертывания SQL для предоставления значений переменных, зависящих от среды.</span><span class="sxs-lookup"><span data-stu-id="79bc3-149">You may often also need to modify the SQL deployment file to provide environment-specific variable values.</span></span> <span data-ttu-id="79bc3-150">Этот подход можно использовать только на компьютере с установленным Visual Studio 2010, и разработчику необходимо знать и предоставить строки подключения и учетные данные для всех конечных сред.</span><span class="sxs-lookup"><span data-stu-id="79bc3-150">You can only use this approach from a computer with Visual Studio 2010 installed, and the developer would need to know and provide connection strings and credentials for all destination environments.</span></span>
- <span data-ttu-id="79bc3-151">Для [развертывания базы данных в составе проекта веб-приложения](https://msdn.microsoft.com/library/dd465343.aspx)можно использовать средство веб-развертывания службы IIS (IIS) (веб-развертывание).</span><span class="sxs-lookup"><span data-stu-id="79bc3-151">You can use the Internet Information Services (IIS) Web Deployment Tool (Web Deploy) to [deploy a database as part of a web application project](https://msdn.microsoft.com/library/dd465343.aspx).</span></span> <span data-ttu-id="79bc3-152">Однако этот подход гораздо сложнее, если требуется развернуть проект базы данных, а не просто реплицировать существующую локальную базу данных на целевом сервере.</span><span class="sxs-lookup"><span data-stu-id="79bc3-152">However, this approach is a lot more complex if you want to deploy a database project rather than simply replicate an existing local database on a destination server.</span></span> <span data-ttu-id="79bc3-153">Можно настроить веб-развертывание для запуска скрипта развертывания SQL, создаваемого проектом базы данных, но для этого необходимо создать пользовательский файл целевых объектов конвейера WPP для проекта веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="79bc3-153">You can configure Web Deploy to run the SQL deployment script that the database project generates, but in order to do this, you need to create a custom WPP targets file for your web application project.</span></span> <span data-ttu-id="79bc3-154">Это повышает сложность процесса развертывания.</span><span class="sxs-lookup"><span data-stu-id="79bc3-154">This adds a substantial amount of complexity to the deployment process.</span></span> <span data-ttu-id="79bc3-155">Кроме того, веб-развертывание напрямую не поддерживает добавочные обновления существующих баз данных.</span><span class="sxs-lookup"><span data-stu-id="79bc3-155">In addition, Web Deploy does not directly support incremental updates to existing databases.</span></span> <span data-ttu-id="79bc3-156">Дополнительные сведения об этом подходе см. в разделе [Расширение конвейера веб-публикаций до развернутого файла SQL проекта базы данных](https://go.microsoft.com/?linkid=9805121).</span><span class="sxs-lookup"><span data-stu-id="79bc3-156">For more information on this approach, see [Extending the Web Publishing Pipeline to package database project deployed SQL file](https://go.microsoft.com/?linkid=9805121).</span></span>
- <span data-ttu-id="79bc3-157">Можно использовать служебную программу VSDBCMD для развертывания базы данных с помощью схемы базы данных или манифеста развертывания.</span><span class="sxs-lookup"><span data-stu-id="79bc3-157">You can use the VSDBCMD utility to deploy the database, using either the database schema or the deployment manifest.</span></span> <span data-ttu-id="79bc3-158">Программу VSDBCMD. exe можно вызвать из целевого объекта MSBuild, который позволяет публиковать базы данных в рамках более крупного скриптового процесса развертывания.</span><span class="sxs-lookup"><span data-stu-id="79bc3-158">You can call VSDBCMD.exe from an MSBuild target, which lets you publish databases as part of a larger, scripted deployment process.</span></span> <span data-ttu-id="79bc3-159">Вы можете переопределить переменные в SQLCMDVARS-файле и много других свойств базы данных из команды VSDBCMD, которая позволяет настроить развертывание для различных сред без создания нескольких конфигураций сборки.</span><span class="sxs-lookup"><span data-stu-id="79bc3-159">You can override the variables in your .sqlcmdvars file and lots of other database properties from a VSDBCMD command, which allows you to customize your deployment for different environments without creating multiple build configurations.</span></span> <span data-ttu-id="79bc3-160">VSDBCMD предоставляет функции различения, что означает внесение только необходимых изменений для согласования целевой базы данных со схемой базы данных.</span><span class="sxs-lookup"><span data-stu-id="79bc3-160">VSDBCMD provides differentiation functionality, which means it will make only the necessary changes to align a destination database with your database schema.</span></span> <span data-ttu-id="79bc3-161">VSDBCMD также предлагает широкий спектр параметров командной строки, обеспечивающих точный контроль над процессом развертывания.</span><span class="sxs-lookup"><span data-stu-id="79bc3-161">VSDBCMD also offers a wide range of command-line options, which give you fine-grained control over the deployment process.</span></span>

<span data-ttu-id="79bc3-162">Из этого обзора можно увидеть, что использование VSDBCMD с MSBuild — подход, наиболее подходящий для типичного сценария корпоративного развертывания.</span><span class="sxs-lookup"><span data-stu-id="79bc3-162">From this overview, you can see that using VSDBCMD with MSBuild is the approach best suited to a typical enterprise deployment scenario:</span></span>

|  | <span data-ttu-id="79bc3-163">Visual Studio 2010</span><span class="sxs-lookup"><span data-stu-id="79bc3-163">Visual Studio 2010</span></span> | <span data-ttu-id="79bc3-164">Web Deploy 2.0</span><span class="sxs-lookup"><span data-stu-id="79bc3-164">Web Deploy 2.0</span></span> | <span data-ttu-id="79bc3-165">VSDBCMD.exe</span><span class="sxs-lookup"><span data-stu-id="79bc3-165">VSDBCMD.exe</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="79bc3-166">Поддерживает удаленное развертывание?</span><span class="sxs-lookup"><span data-stu-id="79bc3-166">Supports remote deployment?</span></span> | <span data-ttu-id="79bc3-167">Да</span><span class="sxs-lookup"><span data-stu-id="79bc3-167">Yes</span></span> | <span data-ttu-id="79bc3-168">Да</span><span class="sxs-lookup"><span data-stu-id="79bc3-168">Yes</span></span> | <span data-ttu-id="79bc3-169">Да</span><span class="sxs-lookup"><span data-stu-id="79bc3-169">Yes</span></span> |
| <span data-ttu-id="79bc3-170">Поддерживает добавочные обновления?</span><span class="sxs-lookup"><span data-stu-id="79bc3-170">Supports incremental updates?</span></span> | <span data-ttu-id="79bc3-171">Да</span><span class="sxs-lookup"><span data-stu-id="79bc3-171">Yes</span></span> | <span data-ttu-id="79bc3-172">нет</span><span class="sxs-lookup"><span data-stu-id="79bc3-172">No</span></span> | <span data-ttu-id="79bc3-173">Да</span><span class="sxs-lookup"><span data-stu-id="79bc3-173">Yes</span></span> |
| <span data-ttu-id="79bc3-174">Поддерживает скрипты, выполняемые до и после развертывания?</span><span class="sxs-lookup"><span data-stu-id="79bc3-174">Supports pre/post-deployment scripts?</span></span> | <span data-ttu-id="79bc3-175">Да</span><span class="sxs-lookup"><span data-stu-id="79bc3-175">Yes</span></span> | <span data-ttu-id="79bc3-176">Да</span><span class="sxs-lookup"><span data-stu-id="79bc3-176">Yes</span></span> | <span data-ttu-id="79bc3-177">Да</span><span class="sxs-lookup"><span data-stu-id="79bc3-177">Yes</span></span> |
| <span data-ttu-id="79bc3-178">Поддерживает развертывание в нескольких средах?</span><span class="sxs-lookup"><span data-stu-id="79bc3-178">Supports multi-environment deployment?</span></span> | <span data-ttu-id="79bc3-179">Ограничено</span><span class="sxs-lookup"><span data-stu-id="79bc3-179">Limited</span></span> | <span data-ttu-id="79bc3-180">Ограничено</span><span class="sxs-lookup"><span data-stu-id="79bc3-180">Limited</span></span> | <span data-ttu-id="79bc3-181">Да</span><span class="sxs-lookup"><span data-stu-id="79bc3-181">Yes</span></span> |
| <span data-ttu-id="79bc3-182">Поддерживает развертывание по сценарию?</span><span class="sxs-lookup"><span data-stu-id="79bc3-182">Supports scripted deployment?</span></span> | <span data-ttu-id="79bc3-183">Ограничено</span><span class="sxs-lookup"><span data-stu-id="79bc3-183">Limited</span></span> | <span data-ttu-id="79bc3-184">Да</span><span class="sxs-lookup"><span data-stu-id="79bc3-184">Yes</span></span> | <span data-ttu-id="79bc3-185">Да</span><span class="sxs-lookup"><span data-stu-id="79bc3-185">Yes</span></span> |

<span data-ttu-id="79bc3-186">Оставшаяся часть этого раздела описывает использование программы VSDBCMD с MSBuild для развертывания проектов баз данных.</span><span class="sxs-lookup"><span data-stu-id="79bc3-186">The remainder of this topic describes the use of VSDBCMD with MSBuild to deploy database projects.</span></span>

## <a name="understanding-the-deployment-process"></a><span data-ttu-id="79bc3-187">Основные сведения о процессе развертывания</span><span class="sxs-lookup"><span data-stu-id="79bc3-187">Understanding the Deployment Process</span></span>

<span data-ttu-id="79bc3-188">Служебная программа VSDBCMD позволяет развертывать базу данных с помощью схемы базы данных (DBSCHEMA-файл) или манифеста развертывания (файл. деплойманифест).</span><span class="sxs-lookup"><span data-stu-id="79bc3-188">The VSDBCMD utility lets you deploy a database using either the database schema (the .dbschema file) or the deployment manifest (the .deploymanifest file).</span></span> <span data-ttu-id="79bc3-189">На практике вы почти всегда будете использовать манифест развертывания, так как манифест развертывания позволяет предоставлять значения по умолчанию для различных свойств развертывания и находить скрипты SQL, выполняемые перед развертыванием или после развертывания, которые необходимо выполнить.</span><span class="sxs-lookup"><span data-stu-id="79bc3-189">In practice, you'll almost always use the deployment manifest, as the deployment manifest lets you provide default values for various deployment properties and identify any pre-deployment or post-deployment SQL scripts you want to run.</span></span> <span data-ttu-id="79bc3-190">Например, эта команда VSDBCMD используется для развертывания базы данных **ContactManager** на сервере базы данных в тестовой среде.</span><span class="sxs-lookup"><span data-stu-id="79bc3-190">For example, this VSDBCMD command is used to deploy the **ContactManager** database to a database server in a test environment:</span></span>

[!code-console[Main](deploying-database-projects/samples/sample1.cmd)]

<span data-ttu-id="79bc3-191">В данном случае:</span><span class="sxs-lookup"><span data-stu-id="79bc3-191">In this case:</span></span>

- <span data-ttu-id="79bc3-192">Параметр **/a** (или **/Action**) указывает, что нужно сделать с помощью программы VSDBCMD.</span><span class="sxs-lookup"><span data-stu-id="79bc3-192">The **/a** (or **/Action**) switch specifies what you want VSDBCMD to do.</span></span> <span data-ttu-id="79bc3-193">Его можно задать для **импорта** или **развертывания**.</span><span class="sxs-lookup"><span data-stu-id="79bc3-193">You can set this to **Import** or **Deploy**.</span></span> <span data-ttu-id="79bc3-194">Параметр **Import** используется для создания DBSCHEMA-файла из существующей базы данных, а параметр **deploy** используется для развертывания DBSCHEMA-файла в целевой базе данных.</span><span class="sxs-lookup"><span data-stu-id="79bc3-194">The **Import** option is used to generate a .dbschema file from an existing database, and the **Deploy** option is used to deploy a .dbschema file to a target database.</span></span>
- <span data-ttu-id="79bc3-195">Параметр **/manifest** (или **/MANIFESTFILE**) определяет файл деплойманифест, который требуется развернуть.</span><span class="sxs-lookup"><span data-stu-id="79bc3-195">The **/manifest** (or **/ManifestFile**) switch identifies the .deploymanifest file you want to deploy.</span></span> <span data-ttu-id="79bc3-196">Если вместо этого вы хотите использовать DBSCHEMA-файл, используйте параметр **/МОДЕЛ** (или **/моделфиле**).</span><span class="sxs-lookup"><span data-stu-id="79bc3-196">If you wanted to use the .dbschema file instead, you'd use the **/model** (or **/ModelFile**) switch.</span></span>
- <span data-ttu-id="79bc3-197">Параметр **/КС** (или **/коннектионстринг**) предоставляет строку подключения для целевого сервера базы данных.</span><span class="sxs-lookup"><span data-stu-id="79bc3-197">The **/cs** (or **/ConnectionString**) switch provides the connection string for the target database server.</span></span> <span data-ttu-id="79bc3-198">Обратите внимание, что это не включает имя базы&#x2014;данных, которое должно быть подключено к серверу для создания базы данных. не нужно подключаться к отдельной базе данных.</span><span class="sxs-lookup"><span data-stu-id="79bc3-198">Note that this doesn't include the name of the database&#x2014;VSDBCMD needs to connect to the server to create the database; it doesn't need to connect to an individual database.</span></span> <span data-ttu-id="79bc3-199">Если файл. деплойманифест содержит строку подключения, этот параметр можно опустить.</span><span class="sxs-lookup"><span data-stu-id="79bc3-199">If your .deploymanifest file includes a connection string, you can omit this switch.</span></span> <span data-ttu-id="79bc3-200">Если вы все равно используете параметр, значение Switch переопределит значение. деплойманифест.</span><span class="sxs-lookup"><span data-stu-id="79bc3-200">If you use the switch anyway, the switch value will override the .deploymanifest value.</span></span>
- <span data-ttu-id="79bc3-201">Свойство <strong>/p: TargetDatabase</strong> предоставляет имя, которое необходимо назначить целевой базе данных при создании.</span><span class="sxs-lookup"><span data-stu-id="79bc3-201">The <strong>/p:TargetDatabase</strong> property provides the name you want to assign to the target database on creation.</span></span> <span data-ttu-id="79bc3-202">Это переопределяет значение свойства <strong>TargetDatabase</strong> в файле. деплойманифест.</span><span class="sxs-lookup"><span data-stu-id="79bc3-202">This overrides the value of the <strong>TargetDatabase</strong> property in the .deploymanifest file.</span></span> <span data-ttu-id="79bc3-203">С помощью синтаксиса <strong>/p:</strong> <em>[Property Name]</em>можно задать разнообразные свойства развертывания и переопределить любые переменные SQLCMD, объявленные в файле. SQLCMDVARS.</span><span class="sxs-lookup"><span data-stu-id="79bc3-203">You can use the <strong>/p:</strong> <em>[property name]</em>syntax to set a wide variety of deployment properties and to override any SQLCMD variables declared in your .sqlcmdvars file.</span></span>
- <span data-ttu-id="79bc3-204">Параметр **/DD +** (или **/деплойтодатабасе +** ) указывает, что необходимо создать развертывание и развернуть его в целевой среде.</span><span class="sxs-lookup"><span data-stu-id="79bc3-204">The **/dd+** (or **/DeployToDatabase+**) switch indicates that you want to create a deployment and deploy it to the target environment.</span></span> <span data-ttu-id="79bc3-205">Если указать **/дд-** или опустить параметр, VSDBCMD создаст скрипт развертывания, но не будет развертывать его в целевой среде.</span><span class="sxs-lookup"><span data-stu-id="79bc3-205">If you specify **/dd-**, or omit the switch, VSDBCMD will generate a deployment script but will not deploy it to the target environment.</span></span> <span data-ttu-id="79bc3-206">Этот параметр часто является источником путаницы и более подробно описывается в следующем разделе.</span><span class="sxs-lookup"><span data-stu-id="79bc3-206">This switch is often the source of confusion and is explained in more detail in the next section.</span></span>
- <span data-ttu-id="79bc3-207">Параметр **/script** (или **/деплойментскриптфиле**) указывает, где нужно создать скрипт развертывания.</span><span class="sxs-lookup"><span data-stu-id="79bc3-207">The **/script** (or **/DeploymentScriptFile**) switch specifies where you want to generate the deployment script.</span></span> <span data-ttu-id="79bc3-208">Это значение не влияет на процесс развертывания.</span><span class="sxs-lookup"><span data-stu-id="79bc3-208">This value does not affect the deployment process.</span></span>

<span data-ttu-id="79bc3-209">Дополнительные сведения об VSDBCMD см. в [справочнике по командной строке для программы VSDBCMD. EXE (развертывание и импорт схемы)](https://msdn.microsoft.com/library/dd193283.aspx) и [инструкции: подготовка базы данных к развертыванию из командной строки с помощью программы VSDBCMD. EXE](https://msdn.microsoft.com/library/dd193258.aspx).</span><span class="sxs-lookup"><span data-stu-id="79bc3-209">For more information on VSDBCMD, see [Command-Line Reference for VSDBCMD.EXE (Deployment and Schema Import)](https://msdn.microsoft.com/library/dd193283.aspx) and [How to: Prepare a Database for Deployment From a Command Prompt by Using VSDBCMD.EXE](https://msdn.microsoft.com/library/dd193258.aspx).</span></span>

<span data-ttu-id="79bc3-210">Пример использования программы VSDBCMD из файла проекта MSBuild см. [в разделе Основные сведения о процессе сборки](understanding-the-build-process.md).</span><span class="sxs-lookup"><span data-stu-id="79bc3-210">For an example of how you can use VSDBCMD from an MSBuild project file, see [Understanding the Build Process](understanding-the-build-process.md).</span></span> <span data-ttu-id="79bc3-211">Примеры настройки параметров развертывания базы данных для нескольких сред см. в разделе [Настройка развертываний баз данных для нескольких сред](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md).</span><span class="sxs-lookup"><span data-stu-id="79bc3-211">For examples of how to configure database deployment settings for multiple environments, see [Customizing Database Deployments for Multiple Environments](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md).</span></span>

## <a name="understanding-the-deploytodatabase-switch"></a><span data-ttu-id="79bc3-212">Основные сведения о параметре Деплойтодатабасе</span><span class="sxs-lookup"><span data-stu-id="79bc3-212">Understanding the DeployToDatabase Switch</span></span>

<span data-ttu-id="79bc3-213">Поведение переключателя **/DD** или **/деплойтодатабасе** зависит от того, используется ли VSDBCMD с DBSCHEMA-файлом или деплойманифест-файлом.</span><span class="sxs-lookup"><span data-stu-id="79bc3-213">The behavior of the **/dd** or **/DeployToDatabase** switch depends on whether you're using VSDBCMD with a .dbschema file or a .deploymanifest file.</span></span> <span data-ttu-id="79bc3-214">Если вы используете DBSCHEMA-файл, поведение довольно просто:</span><span class="sxs-lookup"><span data-stu-id="79bc3-214">If you're using a .dbschema file, the behavior is fairly straightforward:</span></span>

- <span data-ttu-id="79bc3-215">Если указать **/DD +** или **/DD**, VSDBCMD создаст скрипт развертывания и развернет базу данных.</span><span class="sxs-lookup"><span data-stu-id="79bc3-215">If you specify **/dd+** or **/dd**, VSDBCMD will generate a deployment script and deploy the database.</span></span>
- <span data-ttu-id="79bc3-216">Если указать **/дд-** или опустить параметр, VSDBCMD создаст только скрипт развертывания.</span><span class="sxs-lookup"><span data-stu-id="79bc3-216">If you specify **/dd-** or omit the switch, VSDBCMD will generate a deployment script only.</span></span>

<span data-ttu-id="79bc3-217">Если вы используете деплойманифест-файл, поведение является гораздо более сложным.</span><span class="sxs-lookup"><span data-stu-id="79bc3-217">If you're using a .deploymanifest file, the behavior is a lot more complicated.</span></span> <span data-ttu-id="79bc3-218">Это связано с тем, что деплойманифест-файл содержит имя свойства **деплойтодатабасе** , которое также определяет, развернута ли база данных.</span><span class="sxs-lookup"><span data-stu-id="79bc3-218">This is because the .deploymanifest file contains a property name **DeployToDatabase** that also determines whether the database is deployed.</span></span>

[!code-xml[Main](deploying-database-projects/samples/sample2.xml)]

<span data-ttu-id="79bc3-219">Значение этого свойства задается в соответствии со свойствами проекта базы данных.</span><span class="sxs-lookup"><span data-stu-id="79bc3-219">The value of this property is set according to the properties of the database project.</span></span> <span data-ttu-id="79bc3-220">Если задать **действие развертывания** для **создания скрипта развертывания (SQL)** , значение будет равно **false**.</span><span class="sxs-lookup"><span data-stu-id="79bc3-220">If you set the **Deploy action** to **Create a deployment script (.sql)**, the value will be **False**.</span></span> <span data-ttu-id="79bc3-221">Если задать **действие развертывания** для **создания скрипта развертывания (SQL) и выполнить развертывание в базе данных**, будет установлено значение **true**.</span><span class="sxs-lookup"><span data-stu-id="79bc3-221">If you set the **Deploy action** to **Create a deployment script (.sql) and deploy to the database**, the value will be **True**.</span></span>

> [!NOTE]
> <span data-ttu-id="79bc3-222">Эти параметры связаны с определенной конфигурацией сборки и платформой.</span><span class="sxs-lookup"><span data-stu-id="79bc3-222">These settings are associated with a specific build configuration and platform.</span></span> <span data-ttu-id="79bc3-223">Например, если настроить параметры конфигурации **отладки** , а затем опубликовать их с помощью конфигурации **выпуска** , параметры не будут использоваться.</span><span class="sxs-lookup"><span data-stu-id="79bc3-223">For example, if you configure settings for the **Debug** configuration and then publish using the **Release** configuration, your settings will not be used.</span></span>

![](deploying-database-projects/_static/image3.png)

> [!NOTE]
> <span data-ttu-id="79bc3-224">В этом сценарии **действие развертывания** всегда должно быть настроено для **создания скрипта развертывания (. SQL)** , так как для развертывания базы данных не требуется Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="79bc3-224">In this scenario, the **Deploy action** should always be set to **Create a deployment script (.sql)**, because you don't want Visual Studio 2010 to deploy your database.</span></span> <span data-ttu-id="79bc3-225">Иными словами, свойство **деплойтодатабасе** всегда должно иметь **значение false**.</span><span class="sxs-lookup"><span data-stu-id="79bc3-225">In other words, the **DeployToDatabase** property should always be **False**.</span></span>

<span data-ttu-id="79bc3-226">Если указано свойство **деплойтодатабасе** , параметр **/DD** переопределяет свойство только в том случае, если свойство имеет значение **false**:</span><span class="sxs-lookup"><span data-stu-id="79bc3-226">When a **DeployToDatabase** property is specified, the **/dd** switch will only override the property if the property value is **false**:</span></span>

- <span data-ttu-id="79bc3-227">Если свойство **деплойтодатабасе** имеет **значение false**и вы указали **/DD +** или **/DD**, VSDBCMD переопределит свойство **деплойтодатабасе** и развернет базу данных.</span><span class="sxs-lookup"><span data-stu-id="79bc3-227">If the **DeployToDatabase** property is **False**, and you specify **/dd+** or **/dd**, VSDBCMD will override the **DeployToDatabase** property and deploy the database.</span></span>
- <span data-ttu-id="79bc3-228">Если свойство **деплойтодатабасе** имеет **значение false**и вы указываете **/дд-** или опустите параметр, VSDBCMD не будет развертывать базу данных.</span><span class="sxs-lookup"><span data-stu-id="79bc3-228">If the **DeployToDatabase** property is **False**, and you specify **/dd-** or omit the switch, VSDBCMD will not deploy the database.</span></span>
- <span data-ttu-id="79bc3-229">Если свойство **деплойтодатабасе** имеет **значение true**, VSDBCMD будет игнорировать параметр и развернуть базу данных.</span><span class="sxs-lookup"><span data-stu-id="79bc3-229">If the **DeployToDatabase** property is **True**, VSDBCMD will ignore the switch and deploy the database.</span></span>
- <span data-ttu-id="79bc3-230">Скрипт развертывания создается в каждом случае независимо от того, выполняется ли развертывание базы данных.</span><span class="sxs-lookup"><span data-stu-id="79bc3-230">A deployment script is generated in each case, regardless of whether you're deploying the database as well.</span></span>

## <a name="conclusion"></a><span data-ttu-id="79bc3-231">Заключение</span><span class="sxs-lookup"><span data-stu-id="79bc3-231">Conclusion</span></span>

<span data-ttu-id="79bc3-232">В этом разделе приводятся общие сведения о процессе сборки и развертывания для проектов баз данных в Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="79bc3-232">This topic provided an overview of the build and deployment process for database projects in Visual Studio 2010.</span></span> <span data-ttu-id="79bc3-233">Здесь также описано, как можно использовать программу VSDBCMD. exe с MSBuild для поддержки развертывания базы данных корпоративного масштаба.</span><span class="sxs-lookup"><span data-stu-id="79bc3-233">It also described how you can use VSDBCMD.exe with MSBuild to support enterprise-scale database deployment.</span></span>

<span data-ttu-id="79bc3-234">Дополнительные сведения о том, как это работает на практике, см. в разделе [Настройка развертываний баз данных для нескольких сред](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md).</span><span class="sxs-lookup"><span data-stu-id="79bc3-234">For more information on how this works in practice, see [Customizing Database Deployments for Multiple Environments](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md).</span></span>

## <a name="further-reading"></a><span data-ttu-id="79bc3-235">Дополнительные материалы</span><span class="sxs-lookup"><span data-stu-id="79bc3-235">Further Reading</span></span>

<span data-ttu-id="79bc3-236">Сведения о настройке развертываний базы данных путем создания отдельного файла конфигурации развертывания для каждой среды см. в разделе [Настройка развертываний баз данных для нескольких сред](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md).</span><span class="sxs-lookup"><span data-stu-id="79bc3-236">For information on how to customize database deployments by creating a separate deployment configuration file for each environment, see [Customizing Database Deployments for Multiple Environments](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md).</span></span> <span data-ttu-id="79bc3-237">Инструкции по настройке членства в ролях базы данных путем запуска скрипта, выполняемого после развертывания, см. [в разделе Развертывание членства в ролях базы данных в тестовых средах](../advanced-enterprise-web-deployment/deploying-database-role-memberships-to-test-environments.md).</span><span class="sxs-lookup"><span data-stu-id="79bc3-237">For guidance on how to configure database role memberships by running a post-deployment script, see [Deploying Database Role Memberships to Test Environments](../advanced-enterprise-web-deployment/deploying-database-role-memberships-to-test-environments.md).</span></span> <span data-ttu-id="79bc3-238">Рекомендации по управлению некоторыми из уникальных проблем, которые накладываются в базах данных членства, см. в разделе [развертывание баз данных членства в корпоративных средах](../advanced-enterprise-web-deployment/deploying-membership-databases-to-enterprise-environments.md).</span><span class="sxs-lookup"><span data-stu-id="79bc3-238">For guidance on managing some of the unique challenges that membership databases impose, see [Deploying Membership Databases to Enterprise Environments](../advanced-enterprise-web-deployment/deploying-membership-databases-to-enterprise-environments.md).</span></span>

<span data-ttu-id="79bc3-239">В этих разделах на сайте MSDN содержатся более подробные инструкции и общие сведения о проектах баз данных Visual Studio и процессе развертывания базы данных.</span><span class="sxs-lookup"><span data-stu-id="79bc3-239">These topics on MSDN provide broader guidance and background information on Visual Studio database projects and the database deployment process:</span></span>

- [<span data-ttu-id="79bc3-240">Проекты баз данных Visual Studio 2010 SQL Server</span><span class="sxs-lookup"><span data-stu-id="79bc3-240">Visual Studio 2010 SQL Server Database Projects</span></span>](https://msdn.microsoft.com/library/ff678491.aspx)
- [<span data-ttu-id="79bc3-241">Управление изменением базы данных</span><span class="sxs-lookup"><span data-stu-id="79bc3-241">Managing Database Change</span></span>](https://msdn.microsoft.com/library/aa833404.aspx)
- [<span data-ttu-id="79bc3-242">Инструкции. Подготовка базы данных к развертыванию из командной строки с помощью программы VSDBCMD. ПРОГРАММЫ</span><span class="sxs-lookup"><span data-stu-id="79bc3-242">How to: Prepare a Database for Deployment From a Command Prompt by Using VSDBCMD.EXE</span></span>](https://msdn.microsoft.com/library/dd193258.aspx)
- [<span data-ttu-id="79bc3-243">Общие сведения о сборка и развертывание базы данных</span><span class="sxs-lookup"><span data-stu-id="79bc3-243">An Overview of Database Build and Deployment</span></span>](https://msdn.microsoft.com/library/aa833165.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="79bc3-244">[Назад](deploying-web-packages.md)
> [Вперед](creating-and-running-a-deployment-command-file.md)</span><span class="sxs-lookup"><span data-stu-id="79bc3-244">[Previous](deploying-web-packages.md)
[Next](creating-and-running-a-deployment-command-file.md)</span></span>
