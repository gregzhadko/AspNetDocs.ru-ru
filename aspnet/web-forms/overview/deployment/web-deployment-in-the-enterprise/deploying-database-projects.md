---
uid: web-forms/overview/deployment/web-deployment-in-the-enterprise/deploying-database-projects
title: Развертывание проектов базы данных | Документация Майкрософт
author: jrjlee
description: Примечание. Во многих корпоративных сценариев развертывания требуется возможность публиковать добавочные обновления для развернутой базы данных. Вместо этого — это повторно создать...
ms.author: riande
ms.date: 05/04/2012
ms.assetid: 832f226a-1aa3-4093-8c29-ce4196793259
msc.legacyurl: /web-forms/overview/deployment/web-deployment-in-the-enterprise/deploying-database-projects
msc.type: authoredcontent
ms.openlocfilehash: f5b7cecdd1a8dbd9be1bd781cec31c53c9096546
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59383230"
---
# <a name="deploying-database-projects"></a>Развертывание проектов баз данных

по [Джейсон Lee](https://github.com/jrjlee)

[Загрузить PDF-файл](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> [!NOTE]
> Во многих корпоративных сценариев развертывания требуется возможность публиковать добавочные обновления для развернутой базы данных. Другим вариантом является для повторного создания базы данных при каждом развертывании, это означает, что вы потеряете все данные в существующую базу данных. При работе с Visual Studio 2010, используя средство VSDBCMD подход рекомендуется, чтобы Добавочная публикация баз данных. Тем не менее в следующей версии Visual Studio и конвейер публикации Web (WPP) будет включать средства, которые поддерживают добавочные публикацию напрямую.


При открытии примера решения диспетчера контактов в Visual Studio 2010, вы увидите сообщение о том, что проект базы данных включает свойства папку, содержащую четыре файла.

![](deploying-database-projects/_static/image1.png)

Вместе с файлом проекта (*ContactManager.Database.dbproj* в данном случае), эти файлы управлять различными аспектами процесса построения и развертывания:

- *Database.sqlcmdvars* файл предоставляет значения всех переменных SQLCMD, которые используются при развертывании проекта. Каждой конфигурации решения (например, отладки и выпуска) можно указать другой SQLCMDVARS-файл.
- *Database.sqldeployment* файл предоставляет определенные параметры развертывания, как и следует ли использовать параметры сортировки, определенные в проекте или параметры сортировки конечного сервера, следует ли повторно создать целевую базу данных каждые время, или просто исправить существующую базу данных и обновить его и т. д. Каждой конфигурации решения можно указать разные .sqldeployment файл.
- *Database.sqlpermissions* файл — это документ XML, который можно использовать для задания разрешений, на которые вы хотите добавить целевую базу данных. Все конфигурации решения совместно использовать же sqlpermissions-файл.
- *Database.sqlsettings* файл определяет свойств уровня базы данных, которые используются при создании базы данных, таких как параметры сортировки, чтобы использовать поведение операторов сравнения и т. д. Все конфигурации решения совместно использовать же sqlsettings-файл.

Стоит уделить немного времени на эти файлы можно открывать в Visual Studio и ознакомиться с содержанием.

При построении проекта базы данных в процессе сборки создается два файла:

- Объект *схемы базы данных* (DBSCHEMA-файл). Это описывающий схему базы данных, которую вы хотите создать в формате XML.
- Объект *манифест развертывания* (DEPLOYMANIFEST-файл). Этот файл содержит все сведения, необходимые для создания и развертывания базы данных. Он ссылается на DBSCHEMA-файл вместе с другими ресурсами, например инструкции по развертыванию (файл .sqldeployment) и любые скрипты SQL, перед развертыванием или после развертывания.

Это показана связь между этими ресурсами.

![](deploying-database-projects/_static/image2.png)

Как вы видите, sqlsettings-файл и sqlpermissions-файл являются входными данными для процесса сборки. А также файл проекта базы данных эти файлы используются для создания файла схемы базы данных. SQLDEPLOYMENT-файл и SQLCMDVARS-файл, проходит через процесс сборки без изменений. Манифест развертывания указывает на расположение схемы базы данных, SQLDEPLOYMENT-файл, SQLCMDVARS-файл и любые скрипты SQL, перед развертыванием или после развертывания.

## <a name="why-use-vsdbcmd-to-deploy-a-database-project"></a>Зачем использовать средство VSDBCMD для развертывания проекта базы данных?

Существуют различные различные подходы к развертывание проектов базы данных. Тем не менее не все из них подходят для развертывания проекта базы данных на удаленные серверы в корпоративной среде. Рассмотрим то, что нужно от развертывания проекта базы данных. В корпоративных сценариях развертывания скорее всего, необходимо:

- Возможность развертывания проекта базы данных из удаленного расположения.
- Возможность вносить добавочные обновления существующей базы данных.
- Возможность включить скрипты перед развертыванием или после развертывания сценарии.
- Возможность настройки развертывания в нескольких средах назначения.
- Возможность развертывания проекта базы данных как часть большего размера, обычно на основе сценария, решение один шаг развертывания.

Существует три основных подхода, которые можно использовать для развертывания проекта базы данных.

- Функциональные возможности развертывания можно использовать с типом проекта базы данных в Visual Studio 2010. При построении и развертывании проекта базы данных в Visual Studio 2010, процесс развертывания использует манифест развертывания для создания файла развертывания на основе SQL, относящиеся к конфигурации построения. Это создаст базу данных, если он уже не существует или внесите необходимые изменения в базу данных, если она уже существует. Вы можете использовать SQLCMD.exe для запуска этого файла на конечном сервере, или можно установить Visual Studio для создания и запустите файл. Недостаток этого подхода заключается в имеют только ограниченный контроль над параметры развертывания. Часто также может потребоваться изменить файл развертывания SQL для задания значений переменных среды. Этот подход с компьютера можно использовать только с Visual Studio 2010 установлен, и разработчик должен знать и укажите строки подключения и учетные данные для всех сред назначения.
- Можно использовать средство Internet Information Services (IIS) веб-развертывания (веб-развертывание) для [развернуть базу данных как часть проект веб-приложения](https://msdn.microsoft.com/library/dd465343.aspx). Тем не менее этот подход является гораздо сложнее, если вы хотите развернуть проект базы данных, а не просто реплицировать существующей локальной базы данных на целевом сервере. Можно настроить веб-развертывания для запуска скрипта развертывания SQL, которая создает проект базы данных, но чтобы сделать это, необходимо создать пользовательский файл WPP целевых объектов для проекта веб-приложения. Это добавляет значительный объем сложности в процесс развертывания. Кроме того веб-развертывания не поддерживает непосредственно добавочные обновления для существующих баз данных. Дополнительные сведения об этом подходе см. в разделе [расширение конвейера публикации в Интернете проект базы данных пакет развернут файл SQL](https://go.microsoft.com/?linkid=9805121).
- Служебную программу VSDBCMD можно использовать для развертывания базы данных, с помощью схемы базы данных, либо манифеста развертывания. VSDBCMD.exe можно вызывать из целевой объект MSBuild, что позволяет осуществлять публикацию баз данных в ходе процесса развертывания крупных и сценариев. Вы можете переопределить переменные в SQLCMDVARS-файл и множество других свойств базы данных из команды VSDBCMD, который позволяет настроить развертывание для разных сред, не создавая несколько конфигураций сборки. Средство VSDBCMD предоставляет функциональные возможности различия, это означает, что это сделает только изменения, необходимые для выравнивания в целевую базу данных с помощью схемы базы данных. Средство VSDBCMD также предлагает широкий спектр параметров командной строки, которые позволяют точно контролировать процесс развертывания.

В этом обзоре вы увидите, что VSDBCMD с помощью MSBuild используется подход, лучше всего подходит для Типичный корпоративный сценарий развертывания.

|  | Visual Studio 2010 | Web Deploy 2.0 | VSDBCMD.exe |
| --- | --- | --- | --- |
| Поддерживает удаленное развертывание? | Да | Да | Да |
| Поддерживает добавочные обновления? | Да | Нет | Да |
| Поддерживает до или после развертывания сценарии? | Да | Да | Да |
| Поддерживает развертывание в нескольких средах? | Ограниченный | Ограниченный | Да |
| Поддерживает сценарий развертывания? | Ограниченный | Да | Да |

В оставшейся части этого раздела описывается использование VSDBCMD с помощью MSBuild, чтобы развертывать проекты базы данных.

## <a name="understanding-the-deployment-process"></a>Общие сведения о процессе развертывания

Служебную программу VSDBCMD позволяет развернуть базу данных с помощью схемы базы данных (DBSCHEMA-файл) или манифест развертывания (DEPLOYMANIFEST-файл). На практике почти всегда используется манифест развертывания, так как манифест развертывания, которая позволяет предоставить значения по умолчанию для различных свойств развертывания и определите все до или после развертывания SQL-сценарии, которые вы хотите запустить. Например, эта команда VSDBCMD используется для развертывания **ContactManager** базы данных на сервер базы данных в тестовой среде:


[!code-console[Main](deploying-database-projects/samples/sample1.cmd)]


В этом случае:

- **/A** (или **/Action**) — указывает то, что нужно средство VSDBCMD делать. Вы можете задать **импорта** или **развернуть**. **Импорта** параметр используется для создания DBSCHEMA-файл из существующей базы данных и **развернуть** параметр используется для развертывания DBSCHEMA-файла в целевую базу данных.
- **/Manifest** (или **/ManifestFile**) коммутатора идентифицирует DEPLOYMANIFEST-файл, вы хотите развернуть. Если вы хотите вместо этого используйте DBSCHEMA-файл, используйте **/модели** (или **/ModelFile**) переключения.
- **/CS** (или **/ConnectionString**) коммутатор предоставляет строку подключения для базы данных целевого сервера. Обратите внимание, что сюда не входят имя базы данных&#x2014;VSDBCMD должен подключиться к серверу, чтобы создать базу данных; Это необязательно для подключения к отдельной базы данных. Если DEPLOYMANIFEST-файл содержит строку подключения, можно опустить этот параметр. Если параметр используется в любом случае, значение переключателя будет переопределять значение .deploymanifest.
- <strong>/P: targetdatabase</strong> предоставляет имя, вы хотите назначить целевую базу данных при создании. Это значение переопределяет значение <strong>TargetDatabase</strong> свойство в DEPLOYMANIFEST-файл. Можно использовать <strong>/p:</strong> <em>[имя свойства]</em>синтаксис для задания самые разнообразные свойства развертывания, а также переопределить все переменные SQLCMD, объявленные в SQLCMDVARS-файл.
- **/Dd+** (или **/DeployToDatabase+**) указывает, что вы хотите создать развертывание и развернуть его в целевой среде. Если указать **/dd-**, или ключ пропущен, средство VSDBCMD создаст скрипт развертывания, но не выполняет развертывание его в целевой среде. Этот ключ часто является источником путаницы и объясняется более подробно в следующем разделе.
- **/Script** (или **/DeploymentScriptFile**) — указывает, где вы хотите создать скрипт развертывания. Это значение не влияет на процесс развертывания.

Дополнительные сведения о VSDBCMD, см. в разделе [Справочник по командной строки VSDBCMD. EXE (развертывание и импорт схемы)](https://msdn.microsoft.com/library/dd193283.aspx) и [как: Подготовка базы данных для развертывания из командной строки с помощью VSDBCMD. EXE](https://msdn.microsoft.com/library/dd193258.aspx).

Пример того, как можно использовать средство VSDBCMD из файла проекта MSBuild, см. в разделе [основные сведения о процессе построения](understanding-the-build-process.md). Примеры для настройки параметров развертывания базы данных для нескольких сред, см. в разделе [Настройка развертываний баз данных для нескольких сред](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md).

## <a name="understanding-the-deploytodatabase-switch"></a>Основные сведения о DeployToDatabase коммутатора

Поведение **/dd** или **/DeployToDatabase** коммутатора зависит от того, используете ли вы VSDBCMD DBSCHEMA-файл или DEPLOYMANIFEST-файл. Если вы используете DBSCHEMA-файл, поведение не очевиден:

- Если указать **/dd+** или **/dd**, средство VSDBCMD создаст скрипт развертывания и развертывание базы данных.
- Если указать **/dd-** или ключ пропущен, средство VSDBCMD создаст только сценарий развертывания.

Если вы используете DEPLOYMANIFEST-файл, поведение не намного сложнее. Это обусловлено DEPLOYMANIFEST-файл содержит имя свойства **DeployToDatabase** , также определяет, является ли база данных развернута.


[!code-xml[Main](deploying-database-projects/samples/sample2.xml)]


Значение этого свойства устанавливается в соответствии со свойствами проекта базы данных. Если задать **развертывания** для **создать скрипт развертывания (.sql)**, значение будет **False**. Если задать **развертывания** для **создать скрипт развертывания (SQL) и развернуть в базе данных**, значение будет **True**.

> [!NOTE]
> Эти параметры связаны с определенной сборки конфигурации и платформы. Например, если настроить параметры для **Отладка** конфигурации, а затем опубликовать с помощью **выпуска** конфигурации, параметры не используются.


![](deploying-database-projects/_static/image3.png)

> [!NOTE]
> В этом случае **развертывания** всегда должны устанавливаться **создать скрипт развертывания (.sql)**, так как вы не хотите, Visual Studio 2010 для развертывания базы данных. Другими словами **DeployToDatabase** свойства всегда должно быть **False**.


Когда **DeployToDatabase** свойство указано, **/dd** коммутатор будет переопределить свойство, только если свойство имеет значение **false**:

- Если **DeployToDatabase** свойство **False**, и указать **/dd+** или **/dd**, средство VSDBCMD переопределит  **DeployToDatabase** свойство и развертывание базы данных.
- Если **DeployToDatabase** свойство **False**, и указать **/dd-** или ключ пропущен, средство VSDBCMD не будет выполнять развертывание базы данных.
- Если **DeployToDatabase** свойство **True**, средство VSDBCMD игнорирует параметр и развертывание базы данных.
- В каждом случае независимо от того, развертывается ли базы данных также формируется скрипт развертывания.

## <a name="conclusion"></a>Заключение

В этом разделе предоставлен Обзор процесса построения и развертывания для проектов баз данных в Visual Studio 2010. Он также описано, как использовать VSDBCMD.exe с MSBuild для поддержки развертывания корпоративного уровня базы данных.

Дополнительные сведения о том, как это работает на практике, см. в разделе [Настройка развертываний баз данных для нескольких сред](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md).

## <a name="further-reading"></a>Дополнительные сведения

Сведения о том, как настраивать развертывания баз данных, создавая файл конфигурации отдельного развертывания для каждой среды, см. в разделе [Настройка развертываний баз данных для нескольких сред](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md). Рекомендации по настройке членства в роли базы данных, выполнив сценарий после развертывания, см. в разделе [развертывание членства роли базы данных для сред тестирования](../advanced-enterprise-web-deployment/deploying-database-role-memberships-to-test-environments.md). Рекомендации по управлению некоторые уникальные трудности удалялась баз данных накладывают см. в разделе [развертывание баз данных членства в корпоративных средах](../advanced-enterprise-web-deployment/deploying-membership-databases-to-enterprise-environments.md).

Следующие разделы на MSDN предоставляют более широкие рекомендации и общие сведения о Visual Studio проекты баз данных и процесс развертывания базы данных:

- [Проекты базы данных Visual Studio 2010 SQL Server](https://msdn.microsoft.com/library/ff678491.aspx)
- [Управление изменениями баз данных](https://msdn.microsoft.com/library/aa833404.aspx)
- [Практическое руководство. Подготовка базы данных для развертывания из командной строки с помощью VSDBCMD. EXE-ФАЙЛА](https://msdn.microsoft.com/library/dd193258.aspx)
- [Обзор базы данных сборки и развертывания](https://msdn.microsoft.com/library/aa833165.aspx)

> [!div class="step-by-step"]
> [Назад](deploying-web-packages.md)
> [Вперед](creating-and-running-a-deployment-command-file.md)
