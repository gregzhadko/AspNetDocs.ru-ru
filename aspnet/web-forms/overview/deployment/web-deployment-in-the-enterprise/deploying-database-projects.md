---
uid: web-forms/overview/deployment/web-deployment-in-the-enterprise/deploying-database-projects
title: Развертывание проектов базы данных | Документация Майкрософт
author: jrjlee
description: Примечание. Во многих корпоративных сценариев развертывания требуется возможность публиковать добавочные обновления для развернутой базы данных. Вместо этого — это повторно создать...
ms.author: riande
ms.date: 05/04/2012
ms.assetid: 832f226a-1aa3-4093-8c29-ce4196793259
msc.legacyurl: /web-forms/overview/deployment/web-deployment-in-the-enterprise/deploying-database-projects
msc.type: authoredcontent
ms.openlocfilehash: f5b7cecdd1a8dbd9be1bd781cec31c53c9096546
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/09/2019
ms.locfileid: "59383230"
---
# <a name="deploying-database-projects"></a><span data-ttu-id="49ab2-104">Развертывание проектов баз данных</span><span class="sxs-lookup"><span data-stu-id="49ab2-104">Deploying Database Projects</span></span>

<span data-ttu-id="49ab2-105">по [Джейсон Lee](https://github.com/jrjlee)</span><span class="sxs-lookup"><span data-stu-id="49ab2-105">by [Jason Lee](https://github.com/jrjlee)</span></span>

[<span data-ttu-id="49ab2-106">Скачать PDF</span><span class="sxs-lookup"><span data-stu-id="49ab2-106">Download PDF</span></span>](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> [!NOTE]
> <span data-ttu-id="49ab2-107">Во многих корпоративных сценариев развертывания требуется возможность публиковать добавочные обновления для развернутой базы данных.</span><span class="sxs-lookup"><span data-stu-id="49ab2-107">In lots of enterprise deployment scenarios, you need the ability to publish incremental updates to a deployed database.</span></span> <span data-ttu-id="49ab2-108">Другим вариантом является для повторного создания базы данных при каждом развертывании, это означает, что вы потеряете все данные в существующую базу данных.</span><span class="sxs-lookup"><span data-stu-id="49ab2-108">The alternative is to recreate the database on every deployment, which means you lose any data in the existing database.</span></span> <span data-ttu-id="49ab2-109">При работе с Visual Studio 2010, используя средство VSDBCMD подход рекомендуется, чтобы Добавочная публикация баз данных.</span><span class="sxs-lookup"><span data-stu-id="49ab2-109">When you work with Visual Studio 2010, using VSDBCMD is the recommended approach to incremental database publishing.</span></span> <span data-ttu-id="49ab2-110">Тем не менее в следующей версии Visual Studio и конвейер публикации Web (WPP) будет включать средства, которые поддерживают добавочные публикацию напрямую.</span><span class="sxs-lookup"><span data-stu-id="49ab2-110">However, the next version of Visual Studio and the Web Publishing Pipeline (WPP) will include tooling that supports incremental publishing directly.</span></span>


<span data-ttu-id="49ab2-111">При открытии примера решения диспетчера контактов в Visual Studio 2010, вы увидите сообщение о том, что проект базы данных включает свойства папку, содержащую четыре файла.</span><span class="sxs-lookup"><span data-stu-id="49ab2-111">If you open the Contact Manager sample solution in Visual Studio 2010, you'll see that the database project includes a Properties folder that contains four files.</span></span>

![](deploying-database-projects/_static/image1.png)

<span data-ttu-id="49ab2-112">Вместе с файлом проекта (*ContactManager.Database.dbproj* в данном случае), эти файлы управлять различными аспектами процесса построения и развертывания:</span><span class="sxs-lookup"><span data-stu-id="49ab2-112">Together with the project file (*ContactManager.Database.dbproj* in this case), these files control various aspects of the build and deployment process:</span></span>

- <span data-ttu-id="49ab2-113">*Database.sqlcmdvars* файл предоставляет значения всех переменных SQLCMD, которые используются при развертывании проекта.</span><span class="sxs-lookup"><span data-stu-id="49ab2-113">The *Database.sqlcmdvars* file provides values for any SQLCMD variables you use when you deploy the project.</span></span> <span data-ttu-id="49ab2-114">Каждой конфигурации решения (например, отладки и выпуска) можно указать другой SQLCMDVARS-файл.</span><span class="sxs-lookup"><span data-stu-id="49ab2-114">Each solution configuration (for example, debug and release) can specify a different .sqlcmdvars file.</span></span>
- <span data-ttu-id="49ab2-115">*Database.sqldeployment* файл предоставляет определенные параметры развертывания, как и следует ли использовать параметры сортировки, определенные в проекте или параметры сортировки конечного сервера, следует ли повторно создать целевую базу данных каждые время, или просто исправить существующую базу данных и обновить его и т. д.</span><span class="sxs-lookup"><span data-stu-id="49ab2-115">The *Database.sqldeployment* file provides deployment-specific settings, like whether to use the collation defined in your project or the collation of the destination server, whether to recreate the destination database every time or simply amend the existing database to bring it up to date, and so on.</span></span> <span data-ttu-id="49ab2-116">Каждой конфигурации решения можно указать разные .sqldeployment файл.</span><span class="sxs-lookup"><span data-stu-id="49ab2-116">Each solution configuration can specify a different .sqldeployment file.</span></span>
- <span data-ttu-id="49ab2-117">*Database.sqlpermissions* файл — это документ XML, который можно использовать для задания разрешений, на которые вы хотите добавить целевую базу данных.</span><span class="sxs-lookup"><span data-stu-id="49ab2-117">The *Database.sqlpermissions* file is an XML document that you can use to define any permissions you want to add to the target database.</span></span> <span data-ttu-id="49ab2-118">Все конфигурации решения совместно использовать же sqlpermissions-файл.</span><span class="sxs-lookup"><span data-stu-id="49ab2-118">All solution configurations share the same .sqlpermissions file.</span></span>
- <span data-ttu-id="49ab2-119">*Database.sqlsettings* файл определяет свойств уровня базы данных, которые используются при создании базы данных, таких как параметры сортировки, чтобы использовать поведение операторов сравнения и т. д.</span><span class="sxs-lookup"><span data-stu-id="49ab2-119">The *Database.sqlsettings* file specifies the database-level properties to use when creating the database, like the collation to use, the behavior of comparison operators, and so on.</span></span> <span data-ttu-id="49ab2-120">Все конфигурации решения совместно использовать же sqlsettings-файл.</span><span class="sxs-lookup"><span data-stu-id="49ab2-120">All solution configurations share the same .sqlsettings file.</span></span>

<span data-ttu-id="49ab2-121">Стоит уделить немного времени на эти файлы можно открывать в Visual Studio и ознакомиться с содержанием.</span><span class="sxs-lookup"><span data-stu-id="49ab2-121">It's worth taking a moment to open these files in Visual Studio and familiarize yourself with the contents.</span></span>

<span data-ttu-id="49ab2-122">При построении проекта базы данных в процессе сборки создается два файла:</span><span class="sxs-lookup"><span data-stu-id="49ab2-122">When you build a database project, the build process creates two files:</span></span>

- <span data-ttu-id="49ab2-123">Объект *схемы базы данных* (DBSCHEMA-файл).</span><span class="sxs-lookup"><span data-stu-id="49ab2-123">A *database schema* (.dbschema file).</span></span> <span data-ttu-id="49ab2-124">Это описывающий схему базы данных, которую вы хотите создать в формате XML.</span><span class="sxs-lookup"><span data-stu-id="49ab2-124">This describes the schema of the database you want to create in XML format.</span></span>
- <span data-ttu-id="49ab2-125">Объект *манифест развертывания* (DEPLOYMANIFEST-файл).</span><span class="sxs-lookup"><span data-stu-id="49ab2-125">A *deployment manifest* (.deploymanifest file).</span></span> <span data-ttu-id="49ab2-126">Этот файл содержит все сведения, необходимые для создания и развертывания базы данных.</span><span class="sxs-lookup"><span data-stu-id="49ab2-126">This contains all the information required to create and deploy your database.</span></span> <span data-ttu-id="49ab2-127">Он ссылается на DBSCHEMA-файл вместе с другими ресурсами, например инструкции по развертыванию (файл .sqldeployment) и любые скрипты SQL, перед развертыванием или после развертывания.</span><span class="sxs-lookup"><span data-stu-id="49ab2-127">It references the .dbschema file along with other resources, like the deployment instructions (the .sqldeployment file) and any pre-deployment or post-deployment SQL scripts.</span></span>

<span data-ttu-id="49ab2-128">Это показана связь между этими ресурсами.</span><span class="sxs-lookup"><span data-stu-id="49ab2-128">This shows the relationship between these resources:</span></span>

![](deploying-database-projects/_static/image2.png)

<span data-ttu-id="49ab2-129">Как вы видите, sqlsettings-файл и sqlpermissions-файл являются входными данными для процесса сборки.</span><span class="sxs-lookup"><span data-stu-id="49ab2-129">As you can see, the .sqlsettings file and the .sqlpermissions file are inputs to the build process.</span></span> <span data-ttu-id="49ab2-130">А также файл проекта базы данных эти файлы используются для создания файла схемы базы данных.</span><span class="sxs-lookup"><span data-stu-id="49ab2-130">Along with the database project file, these files are used to create the database schema file.</span></span> <span data-ttu-id="49ab2-131">SQLDEPLOYMENT-файл и SQLCMDVARS-файл, проходит через процесс сборки без изменений.</span><span class="sxs-lookup"><span data-stu-id="49ab2-131">The .sqldeployment file and the .sqlcmdvars file pass through the build process unchanged.</span></span> <span data-ttu-id="49ab2-132">Манифест развертывания указывает на расположение схемы базы данных, SQLDEPLOYMENT-файл, SQLCMDVARS-файл и любые скрипты SQL, перед развертыванием или после развертывания.</span><span class="sxs-lookup"><span data-stu-id="49ab2-132">The deployment manifest indicates the location of the database schema, the .sqldeployment file, the .sqlcmdvars file, and any pre-deployment or post-deployment SQL scripts.</span></span>

## <a name="why-use-vsdbcmd-to-deploy-a-database-project"></a><span data-ttu-id="49ab2-133">Зачем использовать средство VSDBCMD для развертывания проекта базы данных?</span><span class="sxs-lookup"><span data-stu-id="49ab2-133">Why Use VSDBCMD to Deploy a Database Project?</span></span>

<span data-ttu-id="49ab2-134">Существуют различные различные подходы к развертывание проектов базы данных.</span><span class="sxs-lookup"><span data-stu-id="49ab2-134">There are various different approaches to deploying database projects.</span></span> <span data-ttu-id="49ab2-135">Тем не менее не все из них подходят для развертывания проекта базы данных на удаленные серверы в корпоративной среде.</span><span class="sxs-lookup"><span data-stu-id="49ab2-135">However, not all of them are suitable for deploying a database project to remote servers in an enterprise environment.</span></span> <span data-ttu-id="49ab2-136">Рассмотрим то, что нужно от развертывания проекта базы данных.</span><span class="sxs-lookup"><span data-stu-id="49ab2-136">Consider what you want from a database project deployment.</span></span> <span data-ttu-id="49ab2-137">В корпоративных сценариях развертывания скорее всего, необходимо:</span><span class="sxs-lookup"><span data-stu-id="49ab2-137">In enterprise deployment scenarios, you're likely to want:</span></span>

- <span data-ttu-id="49ab2-138">Возможность развертывания проекта базы данных из удаленного расположения.</span><span class="sxs-lookup"><span data-stu-id="49ab2-138">The ability to deploy the database project from a remote location.</span></span>
- <span data-ttu-id="49ab2-139">Возможность вносить добавочные обновления существующей базы данных.</span><span class="sxs-lookup"><span data-stu-id="49ab2-139">The ability to make incremental updates to an existing database.</span></span>
- <span data-ttu-id="49ab2-140">Возможность включить скрипты перед развертыванием или после развертывания сценарии.</span><span class="sxs-lookup"><span data-stu-id="49ab2-140">The ability to include pre-deployment scripts or post-deployment scripts.</span></span>
- <span data-ttu-id="49ab2-141">Возможность настройки развертывания в нескольких средах назначения.</span><span class="sxs-lookup"><span data-stu-id="49ab2-141">The ability to tailor the deployment to multiple destination environments.</span></span>
- <span data-ttu-id="49ab2-142">Возможность развертывания проекта базы данных как часть большего размера, обычно на основе сценария, решение один шаг развертывания.</span><span class="sxs-lookup"><span data-stu-id="49ab2-142">The ability to deploy the database project as part of a larger, typically scripted, single-step solution deployment.</span></span>

<span data-ttu-id="49ab2-143">Существует три основных подхода, которые можно использовать для развертывания проекта базы данных.</span><span class="sxs-lookup"><span data-stu-id="49ab2-143">There are three main approaches you can use to deploy a database project:</span></span>

- <span data-ttu-id="49ab2-144">Функциональные возможности развертывания можно использовать с типом проекта базы данных в Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="49ab2-144">You can use the deployment functionality with the database project type in Visual Studio 2010.</span></span> <span data-ttu-id="49ab2-145">При построении и развертывании проекта базы данных в Visual Studio 2010, процесс развертывания использует манифест развертывания для создания файла развертывания на основе SQL, относящиеся к конфигурации построения.</span><span class="sxs-lookup"><span data-stu-id="49ab2-145">When you build and deploy a database project in Visual Studio 2010, the deployment process uses the deployment manifest to generate a SQL-based deployment file specific to the build configuration.</span></span> <span data-ttu-id="49ab2-146">Это создаст базу данных, если он уже не существует или внесите необходимые изменения в базу данных, если она уже существует.</span><span class="sxs-lookup"><span data-stu-id="49ab2-146">This will create the database if it doesn't already exist or make any necessary changes to the database if it does already exist.</span></span> <span data-ttu-id="49ab2-147">Вы можете использовать SQLCMD.exe для запуска этого файла на конечном сервере, или можно установить Visual Studio для создания и запустите файл.</span><span class="sxs-lookup"><span data-stu-id="49ab2-147">You can use SQLCMD.exe to run this file on your destination server, or you can set Visual Studio to create and run the file.</span></span> <span data-ttu-id="49ab2-148">Недостаток этого подхода заключается в имеют только ограниченный контроль над параметры развертывания.</span><span class="sxs-lookup"><span data-stu-id="49ab2-148">The disadvantage of this approach is that you have only limited control over the deployment settings.</span></span> <span data-ttu-id="49ab2-149">Часто также может потребоваться изменить файл развертывания SQL для задания значений переменных среды.</span><span class="sxs-lookup"><span data-stu-id="49ab2-149">You may often also need to modify the SQL deployment file to provide environment-specific variable values.</span></span> <span data-ttu-id="49ab2-150">Этот подход с компьютера можно использовать только с Visual Studio 2010 установлен, и разработчик должен знать и укажите строки подключения и учетные данные для всех сред назначения.</span><span class="sxs-lookup"><span data-stu-id="49ab2-150">You can only use this approach from a computer with Visual Studio 2010 installed, and the developer would need to know and provide connection strings and credentials for all destination environments.</span></span>
- <span data-ttu-id="49ab2-151">Можно использовать средство Internet Information Services (IIS) веб-развертывания (веб-развертывание) для [развернуть базу данных как часть проект веб-приложения](https://msdn.microsoft.com/library/dd465343.aspx).</span><span class="sxs-lookup"><span data-stu-id="49ab2-151">You can use the Internet Information Services (IIS) Web Deployment Tool (Web Deploy) to [deploy a database as part of a web application project](https://msdn.microsoft.com/library/dd465343.aspx).</span></span> <span data-ttu-id="49ab2-152">Тем не менее этот подход является гораздо сложнее, если вы хотите развернуть проект базы данных, а не просто реплицировать существующей локальной базы данных на целевом сервере.</span><span class="sxs-lookup"><span data-stu-id="49ab2-152">However, this approach is a lot more complex if you want to deploy a database project rather than simply replicate an existing local database on a destination server.</span></span> <span data-ttu-id="49ab2-153">Можно настроить веб-развертывания для запуска скрипта развертывания SQL, которая создает проект базы данных, но чтобы сделать это, необходимо создать пользовательский файл WPP целевых объектов для проекта веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="49ab2-153">You can configure Web Deploy to run the SQL deployment script that the database project generates, but in order to do this, you need to create a custom WPP targets file for your web application project.</span></span> <span data-ttu-id="49ab2-154">Это добавляет значительный объем сложности в процесс развертывания.</span><span class="sxs-lookup"><span data-stu-id="49ab2-154">This adds a substantial amount of complexity to the deployment process.</span></span> <span data-ttu-id="49ab2-155">Кроме того веб-развертывания не поддерживает непосредственно добавочные обновления для существующих баз данных.</span><span class="sxs-lookup"><span data-stu-id="49ab2-155">In addition, Web Deploy does not directly support incremental updates to existing databases.</span></span> <span data-ttu-id="49ab2-156">Дополнительные сведения об этом подходе см. в разделе [расширение конвейера публикации в Интернете проект базы данных пакет развернут файл SQL](https://go.microsoft.com/?linkid=9805121).</span><span class="sxs-lookup"><span data-stu-id="49ab2-156">For more information on this approach, see [Extending the Web Publishing Pipeline to package database project deployed SQL file](https://go.microsoft.com/?linkid=9805121).</span></span>
- <span data-ttu-id="49ab2-157">Служебную программу VSDBCMD можно использовать для развертывания базы данных, с помощью схемы базы данных, либо манифеста развертывания.</span><span class="sxs-lookup"><span data-stu-id="49ab2-157">You can use the VSDBCMD utility to deploy the database, using either the database schema or the deployment manifest.</span></span> <span data-ttu-id="49ab2-158">VSDBCMD.exe можно вызывать из целевой объект MSBuild, что позволяет осуществлять публикацию баз данных в ходе процесса развертывания крупных и сценариев.</span><span class="sxs-lookup"><span data-stu-id="49ab2-158">You can call VSDBCMD.exe from an MSBuild target, which lets you publish databases as part of a larger, scripted deployment process.</span></span> <span data-ttu-id="49ab2-159">Вы можете переопределить переменные в SQLCMDVARS-файл и множество других свойств базы данных из команды VSDBCMD, который позволяет настроить развертывание для разных сред, не создавая несколько конфигураций сборки.</span><span class="sxs-lookup"><span data-stu-id="49ab2-159">You can override the variables in your .sqlcmdvars file and lots of other database properties from a VSDBCMD command, which allows you to customize your deployment for different environments without creating multiple build configurations.</span></span> <span data-ttu-id="49ab2-160">Средство VSDBCMD предоставляет функциональные возможности различия, это означает, что это сделает только изменения, необходимые для выравнивания в целевую базу данных с помощью схемы базы данных.</span><span class="sxs-lookup"><span data-stu-id="49ab2-160">VSDBCMD provides differentiation functionality, which means it will make only the necessary changes to align a destination database with your database schema.</span></span> <span data-ttu-id="49ab2-161">Средство VSDBCMD также предлагает широкий спектр параметров командной строки, которые позволяют точно контролировать процесс развертывания.</span><span class="sxs-lookup"><span data-stu-id="49ab2-161">VSDBCMD also offers a wide range of command-line options, which give you fine-grained control over the deployment process.</span></span>

<span data-ttu-id="49ab2-162">В этом обзоре вы увидите, что VSDBCMD с помощью MSBuild используется подход, лучше всего подходит для Типичный корпоративный сценарий развертывания.</span><span class="sxs-lookup"><span data-stu-id="49ab2-162">From this overview, you can see that using VSDBCMD with MSBuild is the approach best suited to a typical enterprise deployment scenario:</span></span>

|  | <span data-ttu-id="49ab2-163">Visual Studio 2010</span><span class="sxs-lookup"><span data-stu-id="49ab2-163">Visual Studio 2010</span></span> | <span data-ttu-id="49ab2-164">Web Deploy 2.0</span><span class="sxs-lookup"><span data-stu-id="49ab2-164">Web Deploy 2.0</span></span> | <span data-ttu-id="49ab2-165">VSDBCMD.exe</span><span class="sxs-lookup"><span data-stu-id="49ab2-165">VSDBCMD.exe</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="49ab2-166">Поддерживает удаленное развертывание?</span><span class="sxs-lookup"><span data-stu-id="49ab2-166">Supports remote deployment?</span></span> | <span data-ttu-id="49ab2-167">Да</span><span class="sxs-lookup"><span data-stu-id="49ab2-167">Yes</span></span> | <span data-ttu-id="49ab2-168">Да</span><span class="sxs-lookup"><span data-stu-id="49ab2-168">Yes</span></span> | <span data-ttu-id="49ab2-169">Да</span><span class="sxs-lookup"><span data-stu-id="49ab2-169">Yes</span></span> |
| <span data-ttu-id="49ab2-170">Поддерживает добавочные обновления?</span><span class="sxs-lookup"><span data-stu-id="49ab2-170">Supports incremental updates?</span></span> | <span data-ttu-id="49ab2-171">Да</span><span class="sxs-lookup"><span data-stu-id="49ab2-171">Yes</span></span> | <span data-ttu-id="49ab2-172">Нет</span><span class="sxs-lookup"><span data-stu-id="49ab2-172">No</span></span> | <span data-ttu-id="49ab2-173">Да</span><span class="sxs-lookup"><span data-stu-id="49ab2-173">Yes</span></span> |
| <span data-ttu-id="49ab2-174">Поддерживает до или после развертывания сценарии?</span><span class="sxs-lookup"><span data-stu-id="49ab2-174">Supports pre/post-deployment scripts?</span></span> | <span data-ttu-id="49ab2-175">Да</span><span class="sxs-lookup"><span data-stu-id="49ab2-175">Yes</span></span> | <span data-ttu-id="49ab2-176">Да</span><span class="sxs-lookup"><span data-stu-id="49ab2-176">Yes</span></span> | <span data-ttu-id="49ab2-177">Да</span><span class="sxs-lookup"><span data-stu-id="49ab2-177">Yes</span></span> |
| <span data-ttu-id="49ab2-178">Поддерживает развертывание в нескольких средах?</span><span class="sxs-lookup"><span data-stu-id="49ab2-178">Supports multi-environment deployment?</span></span> | <span data-ttu-id="49ab2-179">Ограниченный</span><span class="sxs-lookup"><span data-stu-id="49ab2-179">Limited</span></span> | <span data-ttu-id="49ab2-180">Ограниченный</span><span class="sxs-lookup"><span data-stu-id="49ab2-180">Limited</span></span> | <span data-ttu-id="49ab2-181">Да</span><span class="sxs-lookup"><span data-stu-id="49ab2-181">Yes</span></span> |
| <span data-ttu-id="49ab2-182">Поддерживает сценарий развертывания?</span><span class="sxs-lookup"><span data-stu-id="49ab2-182">Supports scripted deployment?</span></span> | <span data-ttu-id="49ab2-183">Ограниченный</span><span class="sxs-lookup"><span data-stu-id="49ab2-183">Limited</span></span> | <span data-ttu-id="49ab2-184">Да</span><span class="sxs-lookup"><span data-stu-id="49ab2-184">Yes</span></span> | <span data-ttu-id="49ab2-185">Да</span><span class="sxs-lookup"><span data-stu-id="49ab2-185">Yes</span></span> |

<span data-ttu-id="49ab2-186">В оставшейся части этого раздела описывается использование VSDBCMD с помощью MSBuild, чтобы развертывать проекты базы данных.</span><span class="sxs-lookup"><span data-stu-id="49ab2-186">The remainder of this topic describes the use of VSDBCMD with MSBuild to deploy database projects.</span></span>

## <a name="understanding-the-deployment-process"></a><span data-ttu-id="49ab2-187">Общие сведения о процессе развертывания</span><span class="sxs-lookup"><span data-stu-id="49ab2-187">Understanding the Deployment Process</span></span>

<span data-ttu-id="49ab2-188">Служебную программу VSDBCMD позволяет развернуть базу данных с помощью схемы базы данных (DBSCHEMA-файл) или манифест развертывания (DEPLOYMANIFEST-файл).</span><span class="sxs-lookup"><span data-stu-id="49ab2-188">The VSDBCMD utility lets you deploy a database using either the database schema (the .dbschema file) or the deployment manifest (the .deploymanifest file).</span></span> <span data-ttu-id="49ab2-189">На практике почти всегда используется манифест развертывания, так как манифест развертывания, которая позволяет предоставить значения по умолчанию для различных свойств развертывания и определите все до или после развертывания SQL-сценарии, которые вы хотите запустить.</span><span class="sxs-lookup"><span data-stu-id="49ab2-189">In practice, you'll almost always use the deployment manifest, as the deployment manifest lets you provide default values for various deployment properties and identify any pre-deployment or post-deployment SQL scripts you want to run.</span></span> <span data-ttu-id="49ab2-190">Например, эта команда VSDBCMD используется для развертывания **ContactManager** базы данных на сервер базы данных в тестовой среде:</span><span class="sxs-lookup"><span data-stu-id="49ab2-190">For example, this VSDBCMD command is used to deploy the **ContactManager** database to a database server in a test environment:</span></span>


[!code-console[Main](deploying-database-projects/samples/sample1.cmd)]


<span data-ttu-id="49ab2-191">В этом случае:</span><span class="sxs-lookup"><span data-stu-id="49ab2-191">In this case:</span></span>

- <span data-ttu-id="49ab2-192">**/A** (или **/Action**) — указывает то, что нужно средство VSDBCMD делать.</span><span class="sxs-lookup"><span data-stu-id="49ab2-192">The **/a** (or **/Action**) switch specifies what you want VSDBCMD to do.</span></span> <span data-ttu-id="49ab2-193">Вы можете задать **импорта** или **развернуть**.</span><span class="sxs-lookup"><span data-stu-id="49ab2-193">You can set this to **Import** or **Deploy**.</span></span> <span data-ttu-id="49ab2-194">**Импорта** параметр используется для создания DBSCHEMA-файл из существующей базы данных и **развернуть** параметр используется для развертывания DBSCHEMA-файла в целевую базу данных.</span><span class="sxs-lookup"><span data-stu-id="49ab2-194">The **Import** option is used to generate a .dbschema file from an existing database, and the **Deploy** option is used to deploy a .dbschema file to a target database.</span></span>
- <span data-ttu-id="49ab2-195">**/Manifest** (или **/ManifestFile**) коммутатора идентифицирует DEPLOYMANIFEST-файл, вы хотите развернуть.</span><span class="sxs-lookup"><span data-stu-id="49ab2-195">The **/manifest** (or **/ManifestFile**) switch identifies the .deploymanifest file you want to deploy.</span></span> <span data-ttu-id="49ab2-196">Если вы хотите вместо этого используйте DBSCHEMA-файл, используйте **/модели** (или **/ModelFile**) переключения.</span><span class="sxs-lookup"><span data-stu-id="49ab2-196">If you wanted to use the .dbschema file instead, you'd use the **/model** (or **/ModelFile**) switch.</span></span>
- <span data-ttu-id="49ab2-197">**/CS** (или **/ConnectionString**) коммутатор предоставляет строку подключения для базы данных целевого сервера.</span><span class="sxs-lookup"><span data-stu-id="49ab2-197">The **/cs** (or **/ConnectionString**) switch provides the connection string for the target database server.</span></span> <span data-ttu-id="49ab2-198">Обратите внимание, что сюда не входят имя базы данных&#x2014;VSDBCMD должен подключиться к серверу, чтобы создать базу данных; Это необязательно для подключения к отдельной базы данных.</span><span class="sxs-lookup"><span data-stu-id="49ab2-198">Note that this doesn't include the name of the database&#x2014;VSDBCMD needs to connect to the server to create the database; it doesn't need to connect to an individual database.</span></span> <span data-ttu-id="49ab2-199">Если DEPLOYMANIFEST-файл содержит строку подключения, можно опустить этот параметр.</span><span class="sxs-lookup"><span data-stu-id="49ab2-199">If your .deploymanifest file includes a connection string, you can omit this switch.</span></span> <span data-ttu-id="49ab2-200">Если параметр используется в любом случае, значение переключателя будет переопределять значение .deploymanifest.</span><span class="sxs-lookup"><span data-stu-id="49ab2-200">If you use the switch anyway, the switch value will override the .deploymanifest value.</span></span>
- <span data-ttu-id="49ab2-201"><strong>/P: targetdatabase</strong> предоставляет имя, вы хотите назначить целевую базу данных при создании.</span><span class="sxs-lookup"><span data-stu-id="49ab2-201">The <strong>/p:TargetDatabase</strong> property provides the name you want to assign to the target database on creation.</span></span> <span data-ttu-id="49ab2-202">Это значение переопределяет значение <strong>TargetDatabase</strong> свойство в DEPLOYMANIFEST-файл.</span><span class="sxs-lookup"><span data-stu-id="49ab2-202">This overrides the value of the <strong>TargetDatabase</strong> property in the .deploymanifest file.</span></span> <span data-ttu-id="49ab2-203">Можно использовать <strong>/p:</strong> <em>[имя свойства]</em>синтаксис для задания самые разнообразные свойства развертывания, а также переопределить все переменные SQLCMD, объявленные в SQLCMDVARS-файл.</span><span class="sxs-lookup"><span data-stu-id="49ab2-203">You can use the <strong>/p:</strong> <em>[property name]</em>syntax to set a wide variety of deployment properties and to override any SQLCMD variables declared in your .sqlcmdvars file.</span></span>
- <span data-ttu-id="49ab2-204">**/Dd+** (или **/DeployToDatabase+**) указывает, что вы хотите создать развертывание и развернуть его в целевой среде.</span><span class="sxs-lookup"><span data-stu-id="49ab2-204">The **/dd+** (or **/DeployToDatabase+**) switch indicates that you want to create a deployment and deploy it to the target environment.</span></span> <span data-ttu-id="49ab2-205">Если указать **/dd-**, или ключ пропущен, средство VSDBCMD создаст скрипт развертывания, но не выполняет развертывание его в целевой среде.</span><span class="sxs-lookup"><span data-stu-id="49ab2-205">If you specify **/dd-**, or omit the switch, VSDBCMD will generate a deployment script but will not deploy it to the target environment.</span></span> <span data-ttu-id="49ab2-206">Этот ключ часто является источником путаницы и объясняется более подробно в следующем разделе.</span><span class="sxs-lookup"><span data-stu-id="49ab2-206">This switch is often the source of confusion and is explained in more detail in the next section.</span></span>
- <span data-ttu-id="49ab2-207">**/Script** (или **/DeploymentScriptFile**) — указывает, где вы хотите создать скрипт развертывания.</span><span class="sxs-lookup"><span data-stu-id="49ab2-207">The **/script** (or **/DeploymentScriptFile**) switch specifies where you want to generate the deployment script.</span></span> <span data-ttu-id="49ab2-208">Это значение не влияет на процесс развертывания.</span><span class="sxs-lookup"><span data-stu-id="49ab2-208">This value does not affect the deployment process.</span></span>

<span data-ttu-id="49ab2-209">Дополнительные сведения о VSDBCMD, см. в разделе [Справочник по командной строки VSDBCMD. EXE (развертывание и импорт схемы)](https://msdn.microsoft.com/library/dd193283.aspx) и [как: Подготовка базы данных для развертывания из командной строки с помощью VSDBCMD. EXE](https://msdn.microsoft.com/library/dd193258.aspx).</span><span class="sxs-lookup"><span data-stu-id="49ab2-209">For more information on VSDBCMD, see [Command-Line Reference for VSDBCMD.EXE (Deployment and Schema Import)](https://msdn.microsoft.com/library/dd193283.aspx) and [How to: Prepare a Database for Deployment From a Command Prompt by Using VSDBCMD.EXE](https://msdn.microsoft.com/library/dd193258.aspx).</span></span>

<span data-ttu-id="49ab2-210">Пример того, как можно использовать средство VSDBCMD из файла проекта MSBuild, см. в разделе [основные сведения о процессе построения](understanding-the-build-process.md).</span><span class="sxs-lookup"><span data-stu-id="49ab2-210">For an example of how you can use VSDBCMD from an MSBuild project file, see [Understanding the Build Process](understanding-the-build-process.md).</span></span> <span data-ttu-id="49ab2-211">Примеры для настройки параметров развертывания базы данных для нескольких сред, см. в разделе [Настройка развертываний баз данных для нескольких сред](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md).</span><span class="sxs-lookup"><span data-stu-id="49ab2-211">For examples of how to configure database deployment settings for multiple environments, see [Customizing Database Deployments for Multiple Environments](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md).</span></span>

## <a name="understanding-the-deploytodatabase-switch"></a><span data-ttu-id="49ab2-212">Основные сведения о DeployToDatabase коммутатора</span><span class="sxs-lookup"><span data-stu-id="49ab2-212">Understanding the DeployToDatabase Switch</span></span>

<span data-ttu-id="49ab2-213">Поведение **/dd** или **/DeployToDatabase** коммутатора зависит от того, используете ли вы VSDBCMD DBSCHEMA-файл или DEPLOYMANIFEST-файл.</span><span class="sxs-lookup"><span data-stu-id="49ab2-213">The behavior of the **/dd** or **/DeployToDatabase** switch depends on whether you're using VSDBCMD with a .dbschema file or a .deploymanifest file.</span></span> <span data-ttu-id="49ab2-214">Если вы используете DBSCHEMA-файл, поведение не очевиден:</span><span class="sxs-lookup"><span data-stu-id="49ab2-214">If you're using a .dbschema file, the behavior is fairly straightforward:</span></span>

- <span data-ttu-id="49ab2-215">Если указать **/dd+** или **/dd**, средство VSDBCMD создаст скрипт развертывания и развертывание базы данных.</span><span class="sxs-lookup"><span data-stu-id="49ab2-215">If you specify **/dd+** or **/dd**, VSDBCMD will generate a deployment script and deploy the database.</span></span>
- <span data-ttu-id="49ab2-216">Если указать **/dd-** или ключ пропущен, средство VSDBCMD создаст только сценарий развертывания.</span><span class="sxs-lookup"><span data-stu-id="49ab2-216">If you specify **/dd-** or omit the switch, VSDBCMD will generate a deployment script only.</span></span>

<span data-ttu-id="49ab2-217">Если вы используете DEPLOYMANIFEST-файл, поведение не намного сложнее.</span><span class="sxs-lookup"><span data-stu-id="49ab2-217">If you're using a .deploymanifest file, the behavior is a lot more complicated.</span></span> <span data-ttu-id="49ab2-218">Это обусловлено DEPLOYMANIFEST-файл содержит имя свойства **DeployToDatabase** , также определяет, является ли база данных развернута.</span><span class="sxs-lookup"><span data-stu-id="49ab2-218">This is because the .deploymanifest file contains a property name **DeployToDatabase** that also determines whether the database is deployed.</span></span>


[!code-xml[Main](deploying-database-projects/samples/sample2.xml)]


<span data-ttu-id="49ab2-219">Значение этого свойства устанавливается в соответствии со свойствами проекта базы данных.</span><span class="sxs-lookup"><span data-stu-id="49ab2-219">The value of this property is set according to the properties of the database project.</span></span> <span data-ttu-id="49ab2-220">Если задать **развертывания** для **создать скрипт развертывания (.sql)**, значение будет **False**.</span><span class="sxs-lookup"><span data-stu-id="49ab2-220">If you set the **Deploy action** to **Create a deployment script (.sql)**, the value will be **False**.</span></span> <span data-ttu-id="49ab2-221">Если задать **развертывания** для **создать скрипт развертывания (SQL) и развернуть в базе данных**, значение будет **True**.</span><span class="sxs-lookup"><span data-stu-id="49ab2-221">If you set the **Deploy action** to **Create a deployment script (.sql) and deploy to the database**, the value will be **True**.</span></span>

> [!NOTE]
> <span data-ttu-id="49ab2-222">Эти параметры связаны с определенной сборки конфигурации и платформы.</span><span class="sxs-lookup"><span data-stu-id="49ab2-222">These settings are associated with a specific build configuration and platform.</span></span> <span data-ttu-id="49ab2-223">Например, если настроить параметры для **Отладка** конфигурации, а затем опубликовать с помощью **выпуска** конфигурации, параметры не используются.</span><span class="sxs-lookup"><span data-stu-id="49ab2-223">For example, if you configure settings for the **Debug** configuration and then publish using the **Release** configuration, your settings will not be used.</span></span>


![](deploying-database-projects/_static/image3.png)

> [!NOTE]
> <span data-ttu-id="49ab2-224">В этом случае **развертывания** всегда должны устанавливаться **создать скрипт развертывания (.sql)**, так как вы не хотите, Visual Studio 2010 для развертывания базы данных.</span><span class="sxs-lookup"><span data-stu-id="49ab2-224">In this scenario, the **Deploy action** should always be set to **Create a deployment script (.sql)**, because you don't want Visual Studio 2010 to deploy your database.</span></span> <span data-ttu-id="49ab2-225">Другими словами **DeployToDatabase** свойства всегда должно быть **False**.</span><span class="sxs-lookup"><span data-stu-id="49ab2-225">In other words, the **DeployToDatabase** property should always be **False**.</span></span>


<span data-ttu-id="49ab2-226">Когда **DeployToDatabase** свойство указано, **/dd** коммутатор будет переопределить свойство, только если свойство имеет значение **false**:</span><span class="sxs-lookup"><span data-stu-id="49ab2-226">When a **DeployToDatabase** property is specified, the **/dd** switch will only override the property if the property value is **false**:</span></span>

- <span data-ttu-id="49ab2-227">Если **DeployToDatabase** свойство **False**, и указать **/dd+** или **/dd**, средство VSDBCMD переопределит  **DeployToDatabase** свойство и развертывание базы данных.</span><span class="sxs-lookup"><span data-stu-id="49ab2-227">If the **DeployToDatabase** property is **False**, and you specify **/dd+** or **/dd**, VSDBCMD will override the **DeployToDatabase** property and deploy the database.</span></span>
- <span data-ttu-id="49ab2-228">Если **DeployToDatabase** свойство **False**, и указать **/dd-** или ключ пропущен, средство VSDBCMD не будет выполнять развертывание базы данных.</span><span class="sxs-lookup"><span data-stu-id="49ab2-228">If the **DeployToDatabase** property is **False**, and you specify **/dd-** or omit the switch, VSDBCMD will not deploy the database.</span></span>
- <span data-ttu-id="49ab2-229">Если **DeployToDatabase** свойство **True**, средство VSDBCMD игнорирует параметр и развертывание базы данных.</span><span class="sxs-lookup"><span data-stu-id="49ab2-229">If the **DeployToDatabase** property is **True**, VSDBCMD will ignore the switch and deploy the database.</span></span>
- <span data-ttu-id="49ab2-230">В каждом случае независимо от того, развертывается ли базы данных также формируется скрипт развертывания.</span><span class="sxs-lookup"><span data-stu-id="49ab2-230">A deployment script is generated in each case, regardless of whether you're deploying the database as well.</span></span>

## <a name="conclusion"></a><span data-ttu-id="49ab2-231">Заключение</span><span class="sxs-lookup"><span data-stu-id="49ab2-231">Conclusion</span></span>

<span data-ttu-id="49ab2-232">В этом разделе предоставлен Обзор процесса построения и развертывания для проектов баз данных в Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="49ab2-232">This topic provided an overview of the build and deployment process for database projects in Visual Studio 2010.</span></span> <span data-ttu-id="49ab2-233">Он также описано, как использовать VSDBCMD.exe с MSBuild для поддержки развертывания корпоративного уровня базы данных.</span><span class="sxs-lookup"><span data-stu-id="49ab2-233">It also described how you can use VSDBCMD.exe with MSBuild to support enterprise-scale database deployment.</span></span>

<span data-ttu-id="49ab2-234">Дополнительные сведения о том, как это работает на практике, см. в разделе [Настройка развертываний баз данных для нескольких сред](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md).</span><span class="sxs-lookup"><span data-stu-id="49ab2-234">For more information on how this works in practice, see [Customizing Database Deployments for Multiple Environments](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md).</span></span>

## <a name="further-reading"></a><span data-ttu-id="49ab2-235">Дополнительные сведения</span><span class="sxs-lookup"><span data-stu-id="49ab2-235">Further Reading</span></span>

<span data-ttu-id="49ab2-236">Сведения о том, как настраивать развертывания баз данных, создавая файл конфигурации отдельного развертывания для каждой среды, см. в разделе [Настройка развертываний баз данных для нескольких сред](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md).</span><span class="sxs-lookup"><span data-stu-id="49ab2-236">For information on how to customize database deployments by creating a separate deployment configuration file for each environment, see [Customizing Database Deployments for Multiple Environments](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md).</span></span> <span data-ttu-id="49ab2-237">Рекомендации по настройке членства в роли базы данных, выполнив сценарий после развертывания, см. в разделе [развертывание членства роли базы данных для сред тестирования](../advanced-enterprise-web-deployment/deploying-database-role-memberships-to-test-environments.md).</span><span class="sxs-lookup"><span data-stu-id="49ab2-237">For guidance on how to configure database role memberships by running a post-deployment script, see [Deploying Database Role Memberships to Test Environments](../advanced-enterprise-web-deployment/deploying-database-role-memberships-to-test-environments.md).</span></span> <span data-ttu-id="49ab2-238">Рекомендации по управлению некоторые уникальные трудности удалялась баз данных накладывают см. в разделе [развертывание баз данных членства в корпоративных средах](../advanced-enterprise-web-deployment/deploying-membership-databases-to-enterprise-environments.md).</span><span class="sxs-lookup"><span data-stu-id="49ab2-238">For guidance on managing some of the unique challenges that membership databases impose, see [Deploying Membership Databases to Enterprise Environments](../advanced-enterprise-web-deployment/deploying-membership-databases-to-enterprise-environments.md).</span></span>

<span data-ttu-id="49ab2-239">Следующие разделы на MSDN предоставляют более широкие рекомендации и общие сведения о Visual Studio проекты баз данных и процесс развертывания базы данных:</span><span class="sxs-lookup"><span data-stu-id="49ab2-239">These topics on MSDN provide broader guidance and background information on Visual Studio database projects and the database deployment process:</span></span>

- [<span data-ttu-id="49ab2-240">Проекты базы данных Visual Studio 2010 SQL Server</span><span class="sxs-lookup"><span data-stu-id="49ab2-240">Visual Studio 2010 SQL Server Database Projects</span></span>](https://msdn.microsoft.com/library/ff678491.aspx)
- [<span data-ttu-id="49ab2-241">Управление изменениями баз данных</span><span class="sxs-lookup"><span data-stu-id="49ab2-241">Managing Database Change</span></span>](https://msdn.microsoft.com/library/aa833404.aspx)
- [<span data-ttu-id="49ab2-242">Практическое руководство. Подготовка базы данных для развертывания из командной строки с помощью VSDBCMD. EXE-ФАЙЛА</span><span class="sxs-lookup"><span data-stu-id="49ab2-242">How to: Prepare a Database for Deployment From a Command Prompt by Using VSDBCMD.EXE</span></span>](https://msdn.microsoft.com/library/dd193258.aspx)
- [<span data-ttu-id="49ab2-243">Обзор базы данных сборки и развертывания</span><span class="sxs-lookup"><span data-stu-id="49ab2-243">An Overview of Database Build and Deployment</span></span>](https://msdn.microsoft.com/library/aa833165.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="49ab2-244">[Назад](deploying-web-packages.md)
> [Вперед](creating-and-running-a-deployment-command-file.md)</span><span class="sxs-lookup"><span data-stu-id="49ab2-244">[Previous](deploying-web-packages.md)
[Next](creating-and-running-a-deployment-command-file.md)</span></span>
