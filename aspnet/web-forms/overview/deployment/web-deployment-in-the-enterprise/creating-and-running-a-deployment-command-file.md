---
uid: web-forms/overview/deployment/web-deployment-in-the-enterprise/creating-and-running-a-deployment-command-file
title: Создание и запуск командного файла развертывания | Документация Майкрософт
author: jrjlee
description: В этом разделе описывается создание командного файла, который позволит запустить развертывание с помощью файлов проекта Microsoft Build Engine (MSBuild) в виде одного шага, Re...
ms.author: riande
ms.date: 05/04/2012
ms.assetid: c61560e9-9f6c-4985-834a-08a3eabf9c3c
msc.legacyurl: /web-forms/overview/deployment/web-deployment-in-the-enterprise/creating-and-running-a-deployment-command-file
msc.type: authoredcontent
ms.openlocfilehash: f1477ff423e4898385066a35b42503f3c70dcc68
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78514980"
---
# <a name="creating-and-running-a-deployment-command-file"></a>Создание и запуск командного файла развертывания

кто [Джейсон Иванов](https://github.com/jrjlee)

[Скачать в формате PDF](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> В этом разделе описывается создание командного файла, который позволяет запускать развертывание с помощью файлов проекта Microsoft Build Engine (MSBuild) в качестве одношагового, повторяемого процесса.

Этот раздел является частью серии руководств, основанных на требованиях Enterprise к развертыванию вымышленной компании Fabrikam, Inc. В этой серии руководств используется пример решения&#x2014; [диспетчера контактов](the-contact-manager-solution.md) &#x2014;для представления веб-приложения с реалистичным уровнем сложности, включая приложение ASP.NET MVC 3, службу Windows Communication Foundation (WCF) и проект базы данных.

Метод развертывания в сердце этих учебников основан на подходе к файлам проекта Split, описанному в разделе [понимание процесса сборки](understanding-the-build-process.md), в котором процесс сборки управляется двумя файлами&#x2014;проекта, содержащими инструкции по сборке, которые применяются к каждой целевой среде, и одна содержит параметры сборки и развертывания, относящиеся к конкретной среде. Во время сборки файл проекта, зависящий от среды, объединяется в файл проекта независимо от среды, чтобы сформировать полный набор инструкций по сборке.

## <a name="process-overview"></a>Обзор процесса

В этом разделе вы узнаете, как создать и запустить командный файл, использующий эти файлы проекта для выполнения повторяемого развертывания в целевой среде. По сути, командный файл просто должен содержать команду MSBuild, которая:

- Указывает MSBuild на выполнение файла *Publish. proj* , независимого от среды.
- Сообщает файлу *Publish. proj* , какой файл содержит параметры проекта для конкретной среды и где его найти.

## <a name="create-an-msbuild-command"></a>Создание команды MSBuild

Как описано в [статье Общие сведения о процессе сборки](understanding-the-build-process.md),&#x2014;файл проекта конкретной среды, например, *env-dev. proj*&#x2014;, предназначен для импорта в независимый от среды файл *Publish. proj* во время сборки. Вместе эти два файла содержат полный набор инструкций, которые указывают MSBuild, как создать и развернуть решение.

Файл *Publish. proj* использует элемент **Import** для импорта файла проекта, относящегося к конкретной среде.

[!code-xml[Main](creating-and-running-a-deployment-command-file/samples/sample1.xml)]

Таким образом, при использовании MSBuild. exe для создания и развертывания решения диспетчера контактов необходимо выполнить следующие действия.

- Запустите файл MSBuild. exe в файле *Publish. proj* .
- Укажите расположение файла проекта для конкретной среды, указав параметр командной строки с именем **таржетенвпропсфиле**.

Для этого команда MSBuild должна выглядеть следующим образом:

[!code-console[Main](creating-and-running-a-deployment-command-file/samples/sample2.cmd)]

Отсюда это простой шаг перехода к одношаговому развертыванию с повторяемым шагом. Все, что нужно сделать, — это добавить команду MSBuild в CMD-файл. В решении диспетчера контактов папка публикации включает файл с именем *публиш-дев. cmd* , который делает именно это.

[!code-console[Main](creating-and-running-a-deployment-command-file/samples/sample3.cmd)]

> [!NOTE]
> Параметр **/ФЛ** указывает MSBuild создать файл журнала с именем *MSBuild. log* в рабочем каталоге, в котором был вызван MSBuild. exe.

Чтобы развернуть или повторно развернуть решение диспетчера контактов, достаточно запустить файл *публиш-дев. cmd* . При запуске файла MSBuild выполняет следующие действия:

- Создание всех проектов в решении.
- Создание развертываемых веб-пакетов для проектов веб-приложений.
- Создание DBSCHEMA и деплойманифест файлов для проектов баз данных.
- Разверните веб-пакеты на веб-сервере.
- Разверните базу данных на сервере базы данных.

## <a name="run-the-deployment"></a>Запуск развертывания

Создав командный файл для целевой среды, вы сможете выполнить полное развертывание, просто запустив файл.

**Развертывание решения диспетчера контактов в тестовой среде**

1. На рабочей станции разработчика откройте проводник Windows и перейдите к расположению файла *публиш-дев. cmd* .
2. Дважды щелкните файл, чтобы выполнить его.
3. Если откроется диалоговое окно **Открытие файла — предупреждение безопасности** , нажмите кнопку **выполнить**.
4. Если параметры конфигурации и тестовые серверы настроены правильно, в окне командной строки отобразится сообщение **Сборка успешно выполнена** , когда MSBuild завершит обработку файлов проекта.

    ![](creating-and-running-a-deployment-command-file/_static/image1.png)
5. Если вы развернули решение в этой среде впервые, вам потребуется добавить учетную запись тестового компьютера веб-сервера в базу данных\_объект **записи** **данных,** а также в роли **DB\_Database DataReader** . Эта процедура описана в разделе [Настройка сервера базы данных для веб-развертывание публикации](../configuring-server-environments-for-web-deployment/configuring-a-database-server-for-web-deploy-publishing.md).

    > [!NOTE]
    > Эти разрешения необходимо назначить только при создании базы данных. По умолчанию процесс сборки не будет воссоздавать базу данных при каждом развертывании&#x2014;, а будет сравнивать существующую базу данных с последней схемой и внести только необходимые изменения. В результате вам нужно только сопоставлять эти роли базы данных при первом развертывании решения.
6. Откройте Internet Explorer и перейдите по URL-адресу приложения диспетчера контактов (например, `http://testweb1:85/ContactManager/`).
7. Убедитесь, что приложение работает правильно и вы можете добавить контакты.

    ![](creating-and-running-a-deployment-command-file/_static/image2.png)

## <a name="conclusion"></a>Заключение

Создание командного файла, содержащего инструкции MSBuild, обеспечивает быстрый и простой способ создания и развертывания решения с несколькими проектами в определенной целевой среде. Если требуется многократное развертывание решения в нескольких конечных средах, можно создать несколько командных файлов. В каждом командном файле команда MSBuild создаст тот же универсальный файл проекта, но будет указывать другой файл проекта для конкретной среды. Например, командный файл для публикации в среде разработчика или тестирования может содержать следующую команду MSBuild:

[!code-console[Main](creating-and-running-a-deployment-command-file/samples/sample4.cmd)]

Командный файл для публикации в промежуточной среде может содержать следующую команду MSBuild:

[!code-console[Main](creating-and-running-a-deployment-command-file/samples/sample5.cmd)]

> [!NOTE]
> Рекомендации по настройке файлов проекта для конкретной среды сервера см. в разделе [Настройка свойств развертывания для целевой среды](../configuring-server-environments-for-web-deployment/configuring-deployment-properties-for-a-target-environment.md).

Можно также настроить процесс сборки для каждой среды, переопределив свойства или задав различные другие параметры в команде MSBuild. Дополнительные сведения см. в [справочнике по командной строке MSBuild](https://msdn.microsoft.com/library/ms164311.aspx).

> [!div class="step-by-step"]
> [Назад](deploying-database-projects.md)
> [Вперед](manually-installing-web-packages.md)
