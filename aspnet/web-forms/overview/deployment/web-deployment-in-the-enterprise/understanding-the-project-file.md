---
uid: web-forms/overview/deployment/web-deployment-in-the-enterprise/understanding-the-project-file
title: Основные сведения о файле проекта | Документация Майкрософт
author: jrjlee
description: Файлы проекта Microsoft Build Engine (MSBuild) находятся в сердце процесса сборки и развертывания. Этот раздел начинается с концептуального обзора MSBuild...
ms.author: riande
ms.date: 05/04/2012
ms.assetid: 07978d9d-341c-4524-bcba-62976f390f77
msc.legacyurl: /web-forms/overview/deployment/web-deployment-in-the-enterprise/understanding-the-project-file
msc.type: authoredcontent
ms.openlocfilehash: 419fe51aaf65bddcc2c50380f099f842a8d9439c
ms.sourcegitcommit: 84b1681d4e6253e30468c8df8a09fe03beea9309
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/02/2019
ms.locfileid: "73445695"
---
# <a name="understanding-the-project-file"></a>Основные сведения о файле проекта

кто [Джейсон Иванов](https://github.com/jrjlee)

[Загрузить PDF-файл](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> Файлы проекта Microsoft Build Engine (MSBuild) находятся в сердце процесса сборки и развертывания. Этот раздел начинается с концептуального обзора MSBuild и файла проекта. В нем описываются ключевые компоненты, которые вы будете использовать при работе с файлами проекта, и работает пример использования файлов проекта для развертывания реальных приложений.
> 
> Что вы узнаете:
> 
> - Как MSBuild использует файлы проекта MSBuild для построения проектов.
> - Интеграция MSBuild с технологиями развертывания, такими как средство веб-развертывания службы IIS (IIS) (веб-развертывание).
> - Сведения о ключевых компонентах файла проекта.
> - Как можно использовать файлы проекта для создания и развертывания сложных приложений.

## <a name="msbuild-and-the-project-file"></a>MSBuild и файл проекта

При создании и сборке решений в Visual Studio Visual Studio использует MSBuild для построения каждого проекта в решении. Каждый проект Visual Studio включает файл проекта MSBuild с расширением файла, который отражает тип проекта&#x2014;, например C# проект (csproj), проект Visual Basic.NET (. vbproj) или проект базы данных (DBPROJ). Для сборки проекта MSBuild должен обработать файл проекта, связанный с проектом. Файл проекта представляет собой XML-документ, который содержит все сведения и инструкции, необходимые MSBuild для создания проекта, такие как содержимое для включения, требования к платформе, сведения об управлении версиями, параметры веб-сервера или сервера баз данных, а также задачи, которые необходимо выполнить.

Файлы проектов MSBuild основаны на [схеме XML MSBuild](/visualstudio/msbuild/msbuild-project-file-schema-reference), и в результате процесс сборки полностью открыт и прозрачен. Кроме того, не нужно устанавливать Visual Studio, чтобы использовать подсистему&#x2014;MSBuild исполняемый файл MSBuild. exe входит в .NET Framework, и его можно запустить из командной строки. Разработчик может создавать собственные файлы проекта MSBuild с помощью XML-схемы MSBuild для создания сложного и точного контроля над построением и развертыванием проектов. Эти файлы пользовательских проектов работают точно так же, как и файлы проекта, создаваемые Visual Studio автоматически.

> [!NOTE]
> Можно также использовать файлы проекта MSBuild со службой Team Build в Team Foundation Server (TFS). Например, можно использовать файлы проекта в сценариях непрерывной интеграции (CI) для автоматизации развертывания в тестовой среде при возврате нового кода. Дополнительные сведения см. в разделе [настройка Team Foundation Server для автоматического веб-развертывания](../configuring-team-foundation-server-for-web-deployment/configuring-team-foundation-server-for-web-deployment.md).

### <a name="project-file-naming-conventions"></a>Соглашения об именовании файлов проекта

При создании собственных файлов проекта можно использовать любое расширение файла. Тем не менее, чтобы облегчить понимание решений другими пользователями, следует использовать следующие общие соглашения:

- Используйте расширение proj при создании файла проекта, который строит проекты.
- Используйте расширение TARGETS при создании файла проекта с возможностью повторного использования для импорта в другие файлы проекта. Файлы с расширением TARGETS обычно не создают ничего сами, они просто содержат инструкции, которые можно импортировать в proj-файлы.

### <a name="integration-with-deployment-technologies"></a>Интеграция с технологиями развертывания

Если вы работали с проектами веб-приложений в Visual Studio 2010, таких как веб-приложения ASP.NET и веб-приложения ASP.NET MVC, вы узнаете, что эти проекты включают встроенную поддержку упаковки и развертывания веб-приложения в целевую среду. Страницы **свойств** этих проектов включают в себя **упаковку, публикацию веб-** страниц, а также ВКЛАДКИ **упаковки и публикации SQL** , которые можно использовать для настройки упаковки и развертывания компонентов приложения. Откроется вкладка **Пакет/Публикация веб-сайта** :

![](understanding-the-project-file/_static/image1.png)

Базовая технология, лежащая в основе этих возможностей, называется конвейером веб-публикаций (WPP). Конвейер WPP, по сути, объединяет MSBuild и [веб-развертывание](https://go.microsoft.com/?linkid=9805122) вместе, чтобы обеспечить полную сборку, пакет и процесс развертывания для веб-приложений.

Хорошая новость состоит в том, что можно воспользоваться преимуществами точек интеграции, предоставляемых конвейером WPP при создании пользовательских файлов проектов для веб-проектов. Инструкции по развертыванию можно включить в файл проекта, который позволяет создавать проекты, создавать пакеты веб-развертывания и устанавливать эти пакеты на удаленных серверах с помощью одного файла проекта и одного вызова в MSBuild. Кроме того, в процессе сборки можно вызывать любые другие исполняемые файлы. Например, можно запустить программу командной строки VSDBCMD. exe для развертывания базы данных из файла схемы. В рамках этого раздела вы узнаете, как можно воспользоваться преимуществами этих возможностей в соответствии с требованиями сценариев корпоративного развертывания.

> [!NOTE]
> Дополнительные сведения о том, как работает процесс развертывания веб-приложения, см. в разделе [ASP.NETing Project Web Application Deployment Overview](https://msdn.microsoft.com/library/dd394698.aspx).

## <a name="the-anatomy-of-a-project-file"></a>Структура файла проекта

Прежде чем рассматривать процесс сборки более подробно, стоит потратить несколько секунд на ознакомление с базовой структурой файла проекта MSBuild. В этом разделе приводятся общие сведения о наиболее распространенных элементах, которые возникают при просмотре, изменении или создании файла проекта. В частности, вы узнаете:

- Использование *свойств* для управления переменными для процесса сборки.
- Использование *элементов* для указания входных данных для процесса сборки, например файлов кода.
- Использование *целевых объектов* и *задач* для предоставления инструкций по выполнению в MSBuild с помощью *свойств* и *элементов* , определенных в других местах файла проекта.

Это показывает связь между ключевыми элементами в файле проекта MSBuild:

![](understanding-the-project-file/_static/image2.png)

### <a name="the-project-element"></a>Элемент Project

Элемент [Project](https://msdn.microsoft.com/library/bcxfsh87.aspx) является корневым элементом каждого файла проекта. Помимо определения схемы XML для файла проекта, элемент **Project** может включать атрибуты для указания точек входа для процесса сборки. Например, в [образце решения диспетчера контактов](the-contact-manager-solution.md)файл *Publish. proj* указывает, что сборка должна начаться с вызова целевого объекта с именем **фуллпублиш**.

[!code-xml[Main](understanding-the-project-file/samples/sample1.xml)]

### <a name="properties-and-conditions"></a>Свойства и условия

Для успешной сборки и развертывания проектов файл проекта обычно должен предоставлять множество различных частей информации. Эти сведения могут включать в себя имена серверов, строки подключения, учетные данные, конфигурации сборки, пути к исходному и целевому файлам, а также любые другие сведения, которые необходимо включить в настройку поддержки. В файле проекта свойства должны быть определены в элементе [PropertyGroup](https://msdn.microsoft.com/library/t4w159bs.aspx) . Свойства MSBuild состоят из пар "ключ-значение". В элементе **PropertyGroup** имя элемента определяет ключ свойства, а содержимое элемента определяет значение свойства. Например, можно определить свойства с именами **ServerName** и **ConnectionString** для хранения статического имени сервера и строки подключения.

[!code-xml[Main](understanding-the-project-file/samples/sample2.xml)]

Чтобы получить значение свойства, используйте формат *$ (PropertyName)* . Например, чтобы получить значение свойства **ServerName** , введите:

[!code-powershell[Main](understanding-the-project-file/samples/sample3.ps1)]

> [!NOTE]
> Вы увидите примеры того, как и когда использовать значения свойств далее в этом разделе.

Внедрение сведений в виде статических свойств в файле проекта не всегда является идеальным подходом к управлению процессом сборки. В большинстве случаев необходимо получить информацию из других источников или предоставить пользователю возможность предоставлять информацию из командной строки. MSBuild позволяет указать любое значение свойства в качестве параметра командной строки. Например, пользователь может указать значение **ServerName** при запуске MSBuild. exe из командной строки.

[!code-console[Main](understanding-the-project-file/samples/sample4.cmd)]

> [!NOTE]
> Дополнительные сведения о аргументах и параметрах, которые можно использовать с MSBuild. exe, см. в [справочнике по командной строке MSBuild](https://msdn.microsoft.com/library/ms164311.aspx).

Для получения значений переменных среды и встроенных свойств проекта можно использовать тот же синтаксис свойств. Многие часто используемые свойства определены для вас, и их можно использовать в файлах проекта, включив соответствующее имя параметра. Например,&#x2014;чтобы получить текущую платформу проекта, например, **x86** или **AnyCpu**&#x2014;, можно включить ссылку на свойство **$ (Platform)** в файл проекта. Дополнительные сведения см. в статьях [макросы для команд и свойств сборки](https://msdn.microsoft.com/library/c02as0cs.aspx), [Общие свойства проекта MSBuild](https://msdn.microsoft.com/library/bb629394.aspx)и [зарезервированные свойства](https://msdn.microsoft.com/library/ms164309.aspx).

Свойства часто используются в сочетании с *условиями*. Большинство элементов MSBuild поддерживают атрибут **Condition** , который позволяет указать критерии, по которым MSBuild должен оценивать элемент. Например, рассмотрим следующее определение свойства:

[!code-xml[Main](understanding-the-project-file/samples/sample5.xml)]

Когда MSBuild обрабатывает это определение свойства, сначала он проверяет, доступно ли значение свойства **$ (аутпутрут)** . Если значение свойства не задано&#x2014;другими словами, пользователь не предоставил значение для этого свойства&#x2014;, условие вычисляется как **true** , а значение свойства равно **.. \Публиш\аут**. Если пользователь предоставил значение для этого свойства, условие вычисляется как **false** , а значение статического свойства не используется.

Дополнительные сведения о различных способах указания условий см. в разделе [условия MSBuild](https://msdn.microsoft.com/library/7szfhaft.aspx).

### <a name="items-and-item-groups"></a>Элементы и группы элементов

Одной из важных ролей файла проекта является определение входных данных для процесса сборки. Как правило, эти входные&#x2014;данные представляют собой файлы кода, файлы конфигурации, командные файлы и любые другие файлы, которые необходимо обработать или скопировать в ходе процесса сборки. В схеме проекта MSBuild эти входные данные представлены элементами [Item](https://msdn.microsoft.com/library/ms164283.aspx) . В файле проекта элементы должны быть определены в элементе [ItemGroup](https://msdn.microsoft.com/library/646dk05y.aspx) . Так же, как и элементы **свойств** , можно присвоить имя элементу **Item** , но вам нравится. Однако необходимо указать атрибут **include** , чтобы определить файл или подстановочный знак, представляемый элементом.

[!code-xml[Main](understanding-the-project-file/samples/sample6.xml)]

Если указать несколько элементов **элементов** с одинаковым именем, вы фактически создаете именованный список ресурсов. Хорошим способом увидеть это в действии является просмотр в одном из файлов проекта, создаваемых Visual Studio. Например, файл *ContactManager. MVC. csproj* в примере решения включает множество групп элементов, каждый из которых имеет несколько одинаково именованных элементов **Item** .

[!code-xml[Main](understanding-the-project-file/samples/sample7.xml)]

Таким образом, файл проекта указывает MSBuild создать списки файлов, которые должны обрабатываться точно так же, как&#x2014;список **ссылок** включает сборки, которые должны быть выполнены для успешной сборки, список **компиляций** включает код. файлы, которые должны быть скомпилированы, а список **содержимого** включает ресурсы, которые необходимо скопировать без изменений. Мы рассмотрим, как процесс сборки ссылается и использует эти элементы далее в этом разделе.

Элементы Item также могут включать дочерние элементы [ItemMetadata](https://msdn.microsoft.com/library/ms164284.aspx) . Это определяемые пользователем пары "ключ-значение", которые по сути представляют свойства, относящиеся к этому элементу. Например, многие элементы **Compile** в файле проекта включают дочерние элементы **DependentUpon** .

[!code-xml[Main](understanding-the-project-file/samples/sample8.xml)]

> [!NOTE]
> Помимо метаданных элементов, созданных пользователем, всем элементам назначаются различные общие метаданные при создании. Дополнительные сведения см. в разделе [Стандартные метаданные элементов](https://msdn.microsoft.com/library/ms164313.aspx).

Элементы **ItemGroup** можно создавать в элементе **проекта** корневого уровня или в конкретных **целевых** элементах. Элементы **ItemGroup** также поддерживают атрибуты **условия** , которые позволяют настраивать входные данные для процесса сборки в соответствии с такими условиями, как конфигурация проекта или платформа.

### <a name="targets-and-tasks"></a>Целевые объекты и задачи

В схеме MSBuild элемент [Task](https://msdn.microsoft.com/library/77f2hx1s.aspx) представляет отдельную инструкцию сборки (или задачу). В состав MSBuild входит множество стандартных задач. Пример:

- Задача **копирования** копирует файлы в новое расположение.
- Задача **Csc** вызывает компилятор Visual C# .
- Задача **vbc** вызывает компилятор Visual Basic.
- Задача **exec** запускает указанную программу.
- Задача **Message** записывает сообщение в средство ведения журнала.

> [!NOTE]
> Полные сведения о задачах, доступных в списке, см. в разделе [Справочник по задачам MSBuild](https://msdn.microsoft.com/library/7z253716.aspx). Дополнительные сведения о задачах, включая создание собственных настраиваемых задач, см. в разделе [задачи MSBuild](https://msdn.microsoft.com/library/ms171466.aspx).

Задачи всегда должны содержаться в [целевых](https://msdn.microsoft.com/library/t50z2hka.aspx) элементах. **Целевой** элемент — это набор из одной или нескольких задач, которые выполняются последовательно, а файл проекта может содержать несколько целевых объектов. Если требуется выполнить задачу или набор задач, вы вызываете целевой объект, содержащий их. Например, предположим, что имеется простой файл проекта, в котором регистрируется сообщение.

[!code-xml[Main](understanding-the-project-file/samples/sample9.xml)]

Вы можете вызвать целевой объект из командной строки с помощью параметра **/t** , чтобы указать целевой объект.

[!code-console[Main](understanding-the-project-file/samples/sample10.cmd)]

Кроме того, можно добавить к элементу **проекта** атрибут **DefaultTargets** , чтобы указать целевые объекты, которые требуется вызвать.

[!code-xml[Main](understanding-the-project-file/samples/sample11.xml)]

В этом случае не нужно указывать целевой объект из командной строки. Можно просто указать файл проекта, и MSBuild будет вызывать целевой объект **фуллпублиш** .

[!code-console[Main](understanding-the-project-file/samples/sample12.cmd)]

Целевые объекты и задачи могут включать атрибуты **Condition** . Таким образом, при выполнении определенных условий можно пропустить все целевые объекты или отдельные задачи.

В общем случае при создании полезных задач и целевых объектов необходимо обратиться к свойствам и элементам, определенным в других местах файла проекта:

- Чтобы использовать значение свойства, введите **$ (***PropertyName***)** , где *PropertyName* — имя элемента **Свойства** или имя параметра.
- Чтобы использовать элемент, введите **@ (***ItemName***)** , где *ItemName* — это имя элемента **Item** .

> [!NOTE]
> Помните, что при создании нескольких элементов с одинаковым именем вы создаете список. Если же вы создаете несколько свойств с одним и тем же именем, Последнее предоставленное значение свойства перезаписывает все предыдущие свойства с тем же именем&#x2014;, а свойство может содержать только одно значение.

Например, в файле *Publish. proj* в примере решения Взгляните на целевой объект **буилдпрожектс** .

[!code-xml[Main](understanding-the-project-file/samples/sample13.xml)]

В этом примере можно наблюдать за следующими ключевыми точками:

- Если параметр **буилдингинтеамбуилд** указан и имеет значение **true**, то ни одна из задач в этом целевом объекте не будет выполнена.
- Целевой объект содержит один экземпляр задачи [MSBuild](https://msdn.microsoft.com/library/z7f65y0d.aspx) . Эта задача позволяет создавать другие проекты MSBuild.
- Элемент **ProjectsToBuild** передается задаче. Этот элемент может представлять список файлов проекта или решения, определенный элементами **ProjectsToBuild** Item в группе элементов. В этом случае элемент **ProjectsToBuild** ссылается на один файл решения.

    [!code-xml[Main](understanding-the-project-file/samples/sample14.xml)]
- Значения свойств, передаваемые в задачу **MSBuild** , включают параметры с именами **аутпутрут** и **Configuration**. Они устанавливаются в значения параметров, если они предоставлены, или на значения статических свойств, если это не так.

    [!code-xml[Main](understanding-the-project-file/samples/sample15.xml)]

Также можно увидеть, что задача **MSBuild** вызывает целевой объект с именем **Build**. Это один из нескольких встроенных целевых объектов, широко используемых в файлах проектов Visual Studio и доступных в пользовательских файлах проекта, таких как **Сборка**, **Очистка**, **Перестроение**и **Публикация**. Дополнительные сведения об использовании целевых объектов и задач для управления процессом сборки, а также о задачах **MSBuild** в частности, см. Далее в этом разделе.

> [!NOTE]
> Дополнительные сведения о целевых объектах см. в разделе [целевые объекты MSBuild](https://msdn.microsoft.com/library/ms171462.aspx).

## <a name="splitting-project-files-to-support-multiple-environments"></a>Разделение файлов проекта для поддержки нескольких сред

Предположим, что требуется возможность развертывания решения в нескольких средах, таких как тестовые серверы, промежуточные платформы и рабочие среды. Конфигурация может сильно различаться между этими средами&#x2014;, а не только с именами серверов, строк подключения и т. д., но также с точки зрения учетных данных, параметров безопасности и многих других факторов. Если вам необходимо регулярно делать это, не укороченного изменять несколько свойств в файле проекта каждый раз при переключении целевой среды. И не является идеальным решением для создания бесконечного списка значений свойств, которые должны быть предоставлены процессу сборки.

К счастью, существует альтернативный вариант. MSBuild позволяет разбивать конфигурацию сборки по нескольким файлам проекта. Чтобы увидеть, как это работает, в примере решения обратите внимание на два файла пользовательского проекта:

- *Publish. proj*, которая содержит свойства, элементы и целевые объекты, общие для всех сред.
- *Env-dev. proj*, которая содержит свойства, характерные для среды разработки.

Теперь обратите внимание, что файл *Publish. proj* включает элемент [Import](https://msdn.microsoft.com/library/92x05xfs.aspx) сразу под открывающим тегом **проекта** .

[!code-xml[Main](understanding-the-project-file/samples/sample16.xml)]

Элемент **Import** используется для импорта содержимого другого файла проекта MSBuild в текущий файл проекта MSBuild. В этом случае параметр **таржетенвпропсфиле** предоставляет имя файла проекта, который необходимо импортировать. Значение этого параметра можно указать при запуске MSBuild.

[!code-console[Main](understanding-the-project-file/samples/sample17.cmd)]

В результате содержимое этих двух файлов будет объединено в один файл проекта. С помощью этого подхода можно создать один файл проекта, содержащий универсальную конфигурацию сборки и несколько вспомогательных файлов проекта, содержащих свойства конкретной среды. В результате, простое выполнение команды с другим значением параметра позволяет развернуть решение в другой среде.

![](understanding-the-project-file/_static/image3.png)

Разделение файлов проекта таким способом является хорошей практикой. Она позволяет разработчикам развертывать в нескольких средах, выполняя одну команду, одновременно избегая дублирования универсальных свойств сборки в нескольких файлах проекта.

> [!NOTE]
> Рекомендации по настройке файлов проекта для конкретной среды сервера см. в разделе [Настройка свойств развертывания для целевой среды](../configuring-server-environments-for-web-deployment/configuring-deployment-properties-for-a-target-environment.md).

## <a name="conclusion"></a>Заключение

В этом разделе приводятся общие сведения о файлах проекта MSBuild, а также объясняется, как создавать собственные файлы проекта для управления процессом сборки. В нем также появилась концепция разбиения файлов проекта на универсальные инструкции сборки и свойства сборки, связанные с конкретной средой, чтобы упростить построение и развертывание проектов в нескольких назначениях.

Следующий раздел, посвященный [процессу сборки](understanding-the-build-process.md), предоставляет более подробные сведения о том, как можно использовать файлы проекта для управления построением и развертыванием путем пошагового развертывания решения с реалистичным уровнем сложности.

## <a name="further-reading"></a>Дополнительные сведения

Более подробные сведения о файлах проекта и конвейере WPP см. в разделе [Microsoft Build Engine: использование MSBuild и Team Foundation Build](http://amzn.com/0735645248) by Саид Ибрагим Хашими and Уильям БАРСОЛОМЕВ, ISBN: 978-0-7356-4524-0.

> [!div class="step-by-step"]
> [Назад](setting-up-the-contact-manager-solution.md)
> [Вперед](understanding-the-build-process.md)
