---
uid: web-forms/overview/deployment/web-deployment-in-the-enterprise/understanding-the-project-file
title: Общие сведения о файле проекта | Документация Майкрософт
author: jrjlee
description: Файлы проекта Microsoft Build Engine (MSBuild) лежат в основе процесса построения и развертывания. Этот раздел начинается с концептуальный обзор MSBuild...
ms.author: riande
ms.date: 05/04/2012
ms.assetid: 07978d9d-341c-4524-bcba-62976f390f77
msc.legacyurl: /web-forms/overview/deployment/web-deployment-in-the-enterprise/understanding-the-project-file
msc.type: authoredcontent
ms.openlocfilehash: a72de5c143bf760292975778b0cf5e0ccdda0973
ms.sourcegitcommit: 6a564984ad448db34cdfab5458af755d6b65e69c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/03/2019
ms.locfileid: "67538825"
---
# <a name="understanding-the-project-file"></a>Общие сведения о файле проекта

по [Джейсон Lee](https://github.com/jrjlee)

[Загрузить PDF-файл](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> Файлы проекта Microsoft Build Engine (MSBuild) лежат в основе процесса построения и развертывания. Этот раздел начинается с концептуальный обзор MSBuild и файл проекта. Он описывает ключевые компоненты, которые вы будете сталкиваться при работе с файлами проекта, и они работают, минуя пример того, как можно использовать файлы проекта для развертывания приложений в реальных условиях.
> 
> Вы узнаете, как:
> 
> - Как MSBuild использует файлы проекта MSBuild для построения проектов.
> - Как MSBuild интегрируется с технологиями развертывания, такие как средство Internet Information Services (IIS) веб-развертывания (веб-развертывания).
> - Как понять ключевые компоненты файла проекта.
> - Использование файлов проекта для создания и развертывания сложных приложений.

## <a name="msbuild-and-the-project-file"></a>MSBuild и файл проекта

При создании и сборке решений в Visual Studio, Visual Studio использует MSBuild для построения каждого проекта в решении. Каждый проект Visual Studio включает файл проекта MSBuild с расширением файла, который отражает типа проекта&#x2014;для этого проекта C# (CSPROJ-файл), проект Visual Basic.NET (с расширением VBPROJ) или проект базы данных (DBPROJ). Чтобы построить проект, MSBuild необходимо обработать файл проекта, связанные с проектом. Файл проекта — это документ XML, который содержит все сведения и инструкции, что MSBuild необходимы для сборки проекта, как содержимое для включения, требования к платформе, сведения об управлении версиями, веб-сервера или параметров сервера базы данных и задачи, которые должны быть выполнены.

Файлы проекта MSBuild основаны на [схемы MSBuild XML](https://msdn.microsoft.com/library/5dy88c2e.aspx), и в результате процесса построения и полностью открыто. Кроме того, не нужно установить Visual Studio, чтобы использовать обработчик MSBuild&#x2014;исполняемый файл MSBuild.exe является частью .NET Framework, и его можно запустить из командной строки. Как разработчик вы можете создать собственные файлы проекта MSBuild, с помощью схемы MSBuild XML, чтобы создать сложный и детальный контроль над как построение и развертывание проектов. Эти файлы пользовательского проекта работать точно так же, как файлы проекта, создаваемые в Visual Studio автоматически.

> [!NOTE]
> Можно также использовать файлы проекта MSBuild с помощью службы Team Build в Team Foundation Server (TFS). Например файлы проекта в сценариях непрерывной интеграции (CI) можно использовать для автоматизации развертывания в тестовой среде, при возврате нового кода. Дополнительные сведения см. в разделе [Настройка Team Foundation Server для автоматического развертывания веб-](../configuring-team-foundation-server-for-web-deployment/configuring-team-foundation-server-for-web-deployment.md).

### <a name="project-file-naming-conventions"></a>Файл проекта, соглашения об именовании

При создании файлов проекта, можно использовать любое расширение файла. Тем не менее чтобы упростить свои решения для других пользователей понять, следует использовать эти общие соглашения:

- Используйте расширение .proj при создании файла проекта, который выполняет сборку проектов.
- Используйте расширение TARGETS, при создании многократно используемых проекта файл для импорта в другие файлы проекта. Файлы с расширением TARGETS обычно не создавайте ничего себе, они просто содержат инструкции, которые можно импортировать в файлы .proj.

### <a name="integration-with-deployment-technologies"></a>Интеграция с технологиями развертывания

Если вы работали с проектами веб-приложения в Visual Studio 2010, такие как веб-приложений ASP.NET и веб-приложений ASP.NET MVC, вы будете знать, что эти проекты содержат встроенную поддержку для упаковки и развертывания веб-приложения к целевой среде. **Свойства** страниц для этих проектов, включают **пакета и публикация веб-** и **упаковка и публикация SQL** вкладки, которые можно использовать для настройки как компоненты вашей приложения упаковываются и развертываются. Это показывает **пакета и публикация веб-** вкладке:

![](understanding-the-project-file/_static/image1.png)

Базовая технология за эти возможности, известен как Web Publishing конвейера (WPP). WPP фактически переводит MSBuild и [веб-развертывания](https://go.microsoft.com/?linkid=9805122) друг с другом, чтобы предоставить полный процесс создания, упаковки и развертывания для веб-приложений.

Хорошо то, что можно воспользоваться преимуществами точек интеграции, предоставляемые WPP при создании пользовательского проекта файлы для веб-проектов. Инструкции по развертыванию можно включить в файле проекта, позволяющая выполнять построение проектов, создание веб-развертывания пакетов и установить эти пакеты на удаленных серверах через только одним файлом проекта и один вызов MSBuild. Также можно вызвать другие исполняемые объекты как часть процесса сборки. Например можно запустить средство командной строки VSDBCMD.exe развертывание базы данных из файла схемы. В ходе этой статьи вы узнаете, как можно воспользоваться преимуществами этих возможностей в соответствии с требованиями сценариев развертывания enterprise.

> [!NOTE]
> Дополнительные сведения о том, как работает процесс развертывания веб-приложений, см. в разделе [обзор ASP.NET веб-приложения проекта развертывания](https://msdn.microsoft.com/library/dd394698.aspx).

## <a name="the-anatomy-of-a-project-file"></a>Анатомия файл проекта

Прежде чем взглянуть на процесс построения более подробно, стоит уделить немного времени для ознакомления с базовая структура файла проекта MSBuild. Этот раздел содержит общие сведения о наиболее распространенных элементов, которые придется столкнуться при Просмотр, изменение или создание файла проекта. В частности вы узнаете следующее.

- Как использовать *свойства* управления переменными для процесса сборки.
- Как использовать *элементы* для идентификации входных данных для процесса построения, такие как файлы кода.
- Как использовать *целевых объектов* и *задачи* для обеспечения выполнения инструкций на MSBuild, с помощью *свойства* и *элементы* определен в другом месте файл проекта.

Это показана связь между ключевые элементы в файл проекта MSBuild:

![](understanding-the-project-file/_static/image2.png)

### <a name="the-project-element"></a>Элемент проекта

[Проекта](https://msdn.microsoft.com/library/bcxfsh87.aspx) элемент является корневым элементом файла каждого проекта. Помимо определения схемы XML для файла проекта, **проекта** элемент может включать атрибуты для указания точки входа для процесса сборки. Например, в [примера решения диспетчера контактов](the-contact-manager-solution.md), *Publish.proj* файл определяет, что сборки необходимо начать с вызова целевой объект, с именем **FullPublish**.

[!code-xml[Main](understanding-the-project-file/samples/sample1.xml)]

### <a name="properties-and-conditions"></a>Свойства и условия

Файл проекта обычно требуется представлено множество разные части сведений для успешной сборки и развертывания проектов. Эти части информации может включать имена серверов, строки подключения, учетные данные, конфигурации построения, исходный и конечный пути к файлам и другие сведения, которые вы хотите включить для поддержки настройки. В файле проекта, свойства должны быть определены в [PropertyGroup](https://msdn.microsoft.com/library/t4w159bs.aspx) элемент. Свойства MSBuild состоят из пар "ключ значение". В рамках **PropertyGroup** элемент, имя элемента определяет ключ свойства и содержимое элемента определяет значение свойства. Например, можно определить свойства с именем **ServerName** и **ConnectionString** для хранения статических серверных имя и строку подключения.

[!code-xml[Main](understanding-the-project-file/samples/sample2.xml)]

Чтобы получить значение свойства, используйте формат *$(PropertyName)* . Например, чтобы получить значение **ServerName** свойство, введите:

[!code-powershell[Main](understanding-the-project-file/samples/sample3.ps1)]

> [!NOTE]
> Вы увидите примеры того, как и когда следует использовать значения свойств далее в этом разделе.

Внедрение данных о как статические свойства в файле проекта не всегда является идеальной подход к управлению процесс сборки. В большинстве сценариев необходимо получить данные из других источников или расширить возможности пользователей для предоставления сведений из командной строки. MSBuild можно указать любое значение свойства в качестве параметра командной строки. Например, пользователь мог задать значение для **ServerName** при выполнении MSBuild.exe из командной строки.

[!code-console[Main](understanding-the-project-file/samples/sample4.cmd)]

> [!NOTE]
> Дополнительные сведения о аргументы и параметры, которые можно использовать с помощью MSBuild.exe, см. в разделе [Справочник по командной строке MSBuild](https://msdn.microsoft.com/library/ms164311.aspx).

Можно использовать один и тот же самый синтаксис свойства для получения значений переменных среды и свойства встроенных проекта. Множество часто используемые свойства определяются автоматически, и можно использовать в файлах проекта, включая имена соответствующих параметров. Например, для получения текущей платформы проекта&#x2014;к примеру, **x86** или **AnyCpu**&#x2014;можно включить **$(Platform)** ссылку на свойство в файл проекта. Дополнительные сведения см. в разделе [макросы для команд и свойств построения](https://msdn.microsoft.com/library/c02as0cs.aspx), [общие свойства проектов MSBuild](https://msdn.microsoft.com/library/bb629394.aspx), и [зарезервированные свойства](https://msdn.microsoft.com/library/ms164309.aspx).

Свойства часто используются в сочетании с *условия*. Большинство элементов MSBuild поддерживают **условие** атрибут, который позволяет указать критерии, от которых MSBuild следует оценить элемента. Например рассмотрим такое определение свойства:

[!code-xml[Main](understanding-the-project-file/samples/sample5.xml)]

Когда MSBuild обрабатывает такое определение свойства, он сначала проверяет ли **$(OutputRoot)** доступно значение свойства. Если значение свойства пусто&#x2014;другими словами, пользователь еще не предоставил значение для этого свойства&#x2014;условие принимает значение **true** и присваивается значение свойства **... \Publish\Out**. Если пользователь предоставил значение для этого свойства, условие принимает значение **false** и статическим значением свойства не используется.

Дополнительные сведения о различных способах, в котором можно указать условия, см. в разделе [условия MSBuild](https://msdn.microsoft.com/library/7szfhaft.aspx).

### <a name="items-and-item-groups"></a>Элементы и группы элементов

Одной из важных ролей файла проекта является определение входные данные для процесса построения. Как правило, эти входные данные представляют собой файлы&#x2014;кода файлов, файлов конфигурации, командные файлы и другие файлы, которые необходимо обработать или сохранить как часть процесса построения. В схеме проекта MSBuild эти входные данные представлены в виде [элемент](https://msdn.microsoft.com/library/ms164283.aspx) элементов. В файле проекта, элементов должны быть определены в [ItemGroup](https://msdn.microsoft.com/library/646dk05y.aspx) элемент. Так же, как **свойство** элементов, можно назвать **элемента** элемент своему усмотрению. Тем не менее, необходимо указать **Include** атрибутом опознания файл или подстановочный знак, который представляет элемент.

[!code-xml[Main](understanding-the-project-file/samples/sample6.xml)]

Путем указания нескольких **элемент** элементов с одинаковым именем, вы фактически создаете именованный список ресурсов. Чтобы увидеть это в действии рекомендуется для просмотра внутри одного из файлов проекта, которые создает Visual Studio. Например *ContactManager.Mvc.csproj* файл в примере решения содержит много групп элементов, каждый из которых несколько тем же названием **элемент** элементов.

[!code-xml[Main](understanding-the-project-file/samples/sample7.xml)]

Таким образом, что в проекте рекомендует MSBuild для создания списков файлов, которые должны обрабатываться так же&#x2014; **ссылку** список включает сборки, которые должны быть выполнены для успешной сборки,  **Скомпилируйте** список включает файлы кода, которые должны быть скомпилированы, и **содержимого** список содержит ресурсы, которые должны быть скопированы без изменений. Мы рассмотрим как ссылается на процесс построения и использует эти элементы ниже в этом разделе.

Можно также включить элементы элемента [ItemMetadata](https://msdn.microsoft.com/library/ms164284.aspx) дочерних элементов. Эти определяемые пользователем пары "ключ значение" и по сути представляют свойства, относящиеся к этому элементу. Например, много **компиляции** элементов в файле проекта включают **DependentUpon** дочерних элементов.

[!code-xml[Main](understanding-the-project-file/samples/sample8.xml)]

> [!NOTE]
> В дополнение к метаданные элементов, созданных пользователем все элементы назначаются различные общие метаданные при создании. Дополнительные сведения см. в разделе [Стандартные метаданные элементов](https://msdn.microsoft.com/library/ms164313.aspx).

Можно создать **ItemGroup** элементы внутри корневого уровня **проекта** элемента или в пределах определенного **целевой** элементов. **ItemGroup** элементы также поддерживают **условие** атрибуты, которые позволяют адаптировать входные данные для процесса сборки в соответствии с условиями, например конфигурации проекта или платформы.

### <a name="targets-and-tasks"></a>Целевые объекты и задачи

В схеме MSBuild [задачи](https://msdn.microsoft.com/library/77f2hx1s.aspx) элемент представляет инструкции отдельной сборки (или задач). В состав MSBuild входит множество предопределенные задачи. Пример:

- **Копирования** задача копирует файлы в новое расположение.
- **Csc** задача вызывает компилятор Visual C#.
- **Vbc** задача вызывает компилятор Visual Basic.
- **Exec** задача запускает указанную программу.
- **Сообщение** задача записывает сообщение в средство ведения журнала.

> [!NOTE]
> Более подробные сведения о задачи, которые доступны без дополнительной настройки, см. в разделе [справочные сведения о задачах MSBuild](https://msdn.microsoft.com/library/7z253716.aspx). Дополнительные сведения о задачах, включая создание собственных пользовательских задач см. в разделе [задачи MSBuild](https://msdn.microsoft.com/library/ms171466.aspx).

Задачи всегда должны содержаться в [целевой](https://msdn.microsoft.com/library/t50z2hka.aspx) элементов. Объект **целевой** элементом является набор одну или несколько задач, которые выполняются последовательно, а также файл проекта может содержать несколько целевых объектов. Для выполнения задачи или набора задач следует вызывать целевой объект, содержащий их. Например предположим, что имеется файл простой проект, который записывает сообщение.

[!code-xml[Main](understanding-the-project-file/samples/sample9.xml)]

Целевой объект из командной строки, можно вызвать с помощью **/t** для указания целевой объект.

[!code-console[Main](understanding-the-project-file/samples/sample10.cmd)]

Кроме того, можно добавить **DefaultTargets** атрибут **проекта** элемент, чтобы указать целевые объекты, которые вы хотите вызвать.

[!code-xml[Main](understanding-the-project-file/samples/sample11.xml)]

В этом случае нет необходимости указывать целевой объект из командной строки. Можно просто указать файл проекта, и будет вызывать MSBuild **FullPublish** целевой для вас.

[!code-console[Main](understanding-the-project-file/samples/sample12.cmd)]

Целевые объекты и задачи могут включать **условие** атрибуты. Таким образом вы можете исключить все целевые объекты или отдельные задачи, при соблюдении определенных условий.

Вообще говоря при создании полезных задач и целевых объектов, необходимо ссылаться на свойства и элементы, которые вы определили в другом месте в файле проекта:

- Чтобы использовать значение свойства, введите **$(***PropertyName***)** , где *PropertyName* имя **свойство** элемента или имя параметр.
- Чтобы использовать элемент, введите **@(***ItemName***)** , где *ItemName* имя **элемента** элемент.

> [!NOTE]
> Помните, что при создании нескольких элементов с одинаковым именем, вы создаете список. Напротив, при создании нескольких свойств с одинаковым именем, последнее значение свойства, указываемые перезапишет любые предыдущие свойства с тем же именем&#x2014;свойство может содержать только одно значение.

Например, в *Publish.proj* файл в примере решения, взгляните на **BuildProjects** целевой объект.

[!code-xml[Main](understanding-the-project-file/samples/sample13.xml)]

В этом примере вы можете наблюдать за следующие основные моменты:

- Если **BuildingInTeamBuild** параметр задан и имеет значение **true**, ни одна из задач в этом целевом объекте будет выполняться.
- Целевой объект содержит один экземпляр [MSBuild](https://msdn.microsoft.com/library/z7f65y0d.aspx) задачи. Эта задача позволяет создавать другие проекты MSBuild.
- **ProjectsToBuild** элемент передается в задачу. Этот элемент может представлять список файлов проекта или решения, все определенные по **ProjectsToBuild** элементы внутри группы элементов item. В этом случае **ProjectsToBuild** элемент ссылается на файл единое решение.

    [!code-xml[Main](understanding-the-project-file/samples/sample14.xml)]
- Свойство значения, передаваемые **MSBuild** задач включают параметры с именем **OutputRoot** и **конфигурации**. Они устанавливаются на значения параметров, если они указаны, или значения статического свойства, если они отсутствуют.

    [!code-xml[Main](understanding-the-project-file/samples/sample15.xml)]

Также можно увидеть, что **MSBuild** задача вызывает целевой объект с именем **построения**. Это один из нескольких встроенных целевых объектов, которые широко используются в файлах проектов Visual Studio, они также доступны вам в файлах проектов, например **построения**, **Очистить**, **Перестроить**, и **публикации**. Дополнительные сведения об использовании целевые объекты и задачи, чтобы контролировать процесс построения, а также о **MSBuild** задач в частности, далее в этом разделе.

> [!NOTE]
> Дополнительные сведения о целевых объектах см. в разделе [целевых объектов MSBuild](https://msdn.microsoft.com/library/ms171462.aspx).

## <a name="splitting-project-files-to-support-multiple-environments"></a>Разбиение файлов проекта для поддержки нескольких сред

Предположим, что вы хотите иметь возможность развернуть решение для нескольких сред, таких как тестовые серверы, платформ промежуточной и рабочей среды. Конфигурация может сильно варьироваться между этими средами&#x2014;не только с точки зрения имена серверов, строки подключения и т. д., но также потенциально с точки зрения учетные данные, параметры безопасности и множество других факторов. Если вам нужно делать это регулярно, это действительно подходящим изменить несколько свойств в файле проекта, каждый раз при переключении целевой среды. И это идеальное решение, требуется бесконечный список значений свойств, чтобы указать для процесса сборки.

К счастью, есть альтернатива. MSBuild позволяет разбить конфигурацию сборки в нескольких файлах проектов. Чтобы увидеть, как это работает, в примере решения, обратите внимание на два файла пользовательского проекта:

- *Publish.proj*, который содержит свойства, элементы, и целевых объектов, которые являются общими для всех сред.
- *Env Dev.proj*, который содержит свойства, характерные для среды разработки.

Обратите внимание, что *Publish.proj* файл включает [импорта](https://msdn.microsoft.com/library/92x05xfs.aspx) элемент непосредственно под открывающей **проекта** тега.

[!code-xml[Main](understanding-the-project-file/samples/sample16.xml)]

**Импорта** элемент используется для импорта содержимого другого файла проекта MSBuild в файле проекта MSBuild. В этом случае **TargetEnvPropsFile** параметр предоставляет имя файла для импорта файла проекта. Можно предоставить значение для этого параметра при запуске MSBuild.

[!code-console[Main](understanding-the-project-file/samples/sample17.cmd)]

Это фактически объединяет содержимое двух файлов в один файл проекта. При таком подходе можно создать один проект файл, содержащий конфигурацию универсальной построения и несколько файлов с дополнительными проект, содержащий свойства, относящиеся к среде. Таким образом просто выполнив команду с другое значение параметра позволяет развернуть решение в другой среде.

![](understanding-the-project-file/_static/image3.png)

Разделение файлы проекта в этом случае рекомендуется следовать. Она позволяет разработчикам для развертывания в нескольких средах, выполнив одну команду, избегая дублирование свойства универсальной сборки в нескольких файлах проектов.

> [!NOTE]
> Рекомендации по настройке файлы проекта для конкретной среды для серверных сред, см. в разделе [Настройка свойств развертывания для целевой среды](../configuring-server-environments-for-web-deployment/configuring-deployment-properties-for-a-target-environment.md).

## <a name="conclusion"></a>Заключение

В этом разделе предоставляются общие сведения о файлах проекта MSBuild и описано, как можно создать собственные пользовательские файлы проекта для управления процессом построения. В нем появилась также концепция разделения файлы проекта на инструкциях по построению универсальной и свойства конкретной среды построения, для упрощения построения и развертывания проектов в несколько назначений.

Следующий раздел, [основные сведения о процессе построения](understanding-the-build-process.md), предоставляет более полную информацию об использовании файлов проекта для построения элемента управления и развертывания посредством развертывания решения с реалистичные уровень сложности.

## <a name="further-reading"></a>Дополнительные сведения

Более подробное введение в файлы проекта и WPP, см. в разделе [Inside the Microsoft Build Engine: С помощью MSBuild и Team Foundation Build](http://amzn.com/0735645248) Саид Ибрагим Хашими и William Bartholomew, ISBN: 978-0-7356-4524-0.

> [!div class="step-by-step"]
> [Назад](setting-up-the-contact-manager-solution.md)
> [Вперед](understanding-the-build-process.md)
