---
uid: web-forms/overview/deployment/advanced-enterprise-web-deployment/taking-web-applications-offline-with-web-deploy
title: Перевод веб-приложений вне сети с веб-развертывание | Документация Майкрософт
author: jrjlee
description: В этом разделе описывается перевод веб-приложения автономно в течение автоматического развертывания с помощью о Web Internet Information Services (IIS)...
ms.author: riande
ms.date: 05/04/2012
ms.assetid: 3e9f6e7d-8967-4586-94d5-d3a122f12529
msc.legacyurl: /web-forms/overview/deployment/advanced-enterprise-web-deployment/taking-web-applications-offline-with-web-deploy
msc.type: authoredcontent
ms.openlocfilehash: 017eceb8567859fdbe28bb87af844eee20dfa525
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/09/2019
ms.locfileid: "59415483"
---
# <a name="taking-web-applications-offline-with-web-deploy"></a>Перевод веб-приложений в автономный режим с помощью веб-развертывания

по [Джейсон Lee](https://github.com/jrjlee)

[Скачать PDF](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> В этом разделе описывается перевод веб-приложения автономно в течение автоматического развертывания с помощью средство Internet Information Services (IIS) веб-развертывания (веб-развертывания). Пользователи, просматривающие веб-приложению перенаправляются *приложения\_offline.htm* файл до завершения развертывания.


Этот раздел является частью серии учебников, исходя из требования к развертыванию enterprise вымышленной компании Fabrikam, Inc. В этой серии руководств используется пример решения&#x2014; [решения диспетчера контактов](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;для представления веб-приложения с более реалистичные уровень сложности, включая приложения ASP.NET MVC 3, Windows Communication Служба Foundation (WCF) и проект базы данных.

Метод развертывания в основе этих учебников основан на разбиение проекта файл подход, описанный в [основные сведения о файле проекта](../web-deployment-in-the-enterprise/understanding-the-project-file.md), в которой процесс построения управляется двумя файлы проекта&#x2014;один с Создание инструкции, которые применяются для каждой целевой среде и содержащего параметры построения и развертывания для конкретной среды. Во время сборки файл проекта для конкретной среды объединяется в файл проекта независимой от среды, чтобы полный набор инструкций построения.

## <a name="task-overview"></a>Общие сведения о задачах

В большинстве сценариев необходимо перевести веб-приложения в автономный режим во время внесения изменений в связанных компонентов, таких как базы данных или веб-служб. Как правило, в IIS и ASP.NET, это сделать, поместив файл с именем *приложения\_offline.htm* в корневой папке веб-сайта или веб-приложения IIS. *Приложения\_offline.htm* файл является стандартным файлом HTML и обычно будет содержать простое сообщение, предлагающее пользователю, что сайт временно недоступен из-за обслуживания. Хотя *приложения\_offline.htm* файл существует в корневой папке веб-сайта, IIS автоматически будет перенаправлять все запросы к файлу. После завершения обновления, удаления *приложения\_offline.htm* файлов и веб-сайт возобновляется как обычно обслуживает запросы.

При использовании веб-развертывания для выполнения автоматической или один шаг развертывания к целевой среде, может потребоваться включить Добавление и удаление *приложения\_offline.htm* файла в процессе развертывания. Чтобы сделать это, необходимо выполнить следующие высокоуровневые задачи:

- В файле проекта Microsoft Build Engine (MSBuild), используемой для управления процессом развертывания, создать целевой объект MSBuild, который копирует *приложения\_offline.htm* файл на конечный сервер, прежде чем все задачи развертывания Начните.
- Добавить другой целевой объект MSBuild, который удаляет *приложения\_offline.htm* файл на конечном сервере, когда завершены все задачи по развертыванию.
- В проект веб-приложения, создайте *. wpp.targets* файл, который гарантирует, что *приложения\_offline.htm* файл добавляется в пакет развертывания, при вызове веб-развертывания.

В этом разделе будет показано, как для выполнения этих процедур. Задачи и пошаговые руководства в этом разделе предполагается, что вы уже создали решение, которое содержит хотя бы один проект веб-приложения и использовать для управления процессом развертывания, как описано в пользовательском файле проекта [веб-развертывание Enterprise](../web-deployment-in-the-enterprise/web-deployment-in-the-enterprise.md). Кроме того, можно использовать [Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) образец решения, чтобы выполнить примеры в разделе.

## <a name="adding-an-appoffline-file-to-a-web-application-project"></a>Добавление приложения\_автономный файл в проект веб-приложения

Первых, вам потребуется выполнить действия, необходимо добавить *приложения\_автономной* файл в проект веб-приложения:

- Для предотвращения конфликта в процессе разработки файла (вы не хотите приложения без возможности восстановления отключен), следует вызывать его что-то отличное от *приложения\_offline.htm*. Например, можно назвать файл *приложения\_автономной template.htm*.
- Чтобы предотвратить развернутым в качестве файла-является, необходимо присвоить значение действие построения **None**.

**Добавление приложения\_автономный файл в проект веб-приложения**

1. Откройте решение в Visual Studio 2010.
2. В **обозревателе решений** окно, щелкните правой кнопкой мыши проект веб-приложения, выберите пункт **добавить**, а затем нажмите кнопку **новый элемент**.
3. В **Добавление нового элемента** выберите **HTML-страницу**.
4. В **имя** введите **приложения\_автономной template.htm**, а затем нажмите кнопку **добавить**.

    ![](taking-web-applications-offline-with-web-deploy/_static/image1.png)
5. Добавление простого HTML для информирования пользователей о том, что приложение недоступно и затем сохраните файл. Не включайте все серверные теги (например, все теги, которые начинаются с префикса «asp:»). 

    ![](taking-web-applications-offline-with-web-deploy/_static/image2.png)
6. В **обозревателе решений** окно, щелкните правой кнопкой мыши новый файл и нажмите кнопку **свойства**.
7. В **свойства** окно в **действие при построении** строку, выберите **None**.

    ![](taking-web-applications-offline-with-web-deploy/_static/image3.png)

## <a name="deploying-and-deleting-an-appoffline-file"></a>Развертывание и удаление приложения\_файлов вне сети

Следующим шагом является изменение логики скопируйте файл на конечный сервер в начале процесса развертывания и удалить его по завершении развертывания.

> [!NOTE]
> В следующей процедуре предполагается, что вы используете пользовательский файл проекта MSBuild для управления процесс развертывания, как описано в разделе [основные сведения о файле проекта](../web-deployment-in-the-enterprise/understanding-the-project-file.md). При развертывании из Visual Studio, необходимо использовать другой подход. Саид Ибрагим Хашими описывает один такой новый подход в [как занять Your публикации веб-приложений вне сети во время](http://sedodream.com/2012/01/08/HowToTakeYourWebAppOfflineDuringPublishing.aspx).


Для развертывания *приложения\_автономной* файл на целевой веб-сайт IIS, необходимо вызвать с помощью MSDeploy.exe [веб-развертывания **contentPath** поставщика](https://technet.microsoft.com/library/dd569034(WS.10).aspx). **ContentPath** поставщик поддерживает физический каталог пути и пути к веб-сайта или приложения IIS, что делает его идеальным выбором для синхронизации файлов между папкой проекта Visual Studio и веб-приложение IIS. Чтобы развернуть файл, MSDeploy команда должна выглядеть следующим образом:


[!code-console[Main](taking-web-applications-offline-with-web-deploy/samples/sample1.cmd)]


Чтобы удалить файл из конечного сайта в конце процесса развертывания, MSDeploy команда должна выглядеть следующим образом:


[!code-console[Main](taking-web-applications-offline-with-web-deploy/samples/sample2.cmd)]


Чтобы автоматизировать эти команды в рамках процесса построения и развертывания, необходимо интегрировать их в пользовательский файл проекта MSBuild. Далее описано, как это сделать.

**Для развертывания и удалить приложение\_файлов вне сети**

1. В Visual Studio 2010 откройте файл проекта MSBuild, управляющий процесс развертывания. В [Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) это пример решения, *Publish.proj* файла.
2. В корневом каталоге **проекта** элемент, создайте новый **PropertyGroup** элемента для хранения переменных для *приложения\_автономной* развертывания:

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample3.xml)]
3. **SourceRoot** свойства определен в другом месте в *Publish.proj* файла. Указывает расположение исходного содержимого по отношению к текущему пути к корневой папке&#x2014;другими словами, относительно расположения *Publish.proj* файла.
4. **ContentPath** поставщик не будет принимать относительных путей к файлам, поэтому вам нужно получить абсолютный путь к файлу источника, чего вы сможете развернуть его. Можно использовать [ConvertToAbsolutePath](https://msdn.microsoft.com/library/bb882668.aspx) задач для этого.
5. Добавьте новый **целевой** элемент с именем **GetAppOfflineAbsolutePath**. В этом целевом объекте, используйте **ConvertToAbsolutePath** задачи, чтобы получить абсолютный путь к *приложения\_автономного шаблона* файл в папке проекта.

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample4.xml)]
6. Этот целевой объект принимает относительный путь к *приложения\_автономного шаблона* файл в папку проекта и сохраняет его в новое свойство как абсолютный путь на диске. **BeforeTargets** атрибут указывает, что этот целевой объект для выполнения перед **DeployAppOffline** целевой объект, который вы создадите на следующем шаге.
7. Добавить новый целевой объект с именем **DeployAppOffline**. В этом целевом объекте вызвать команду MSDeploy.exe, который развертывает вашей *приложения\_автономной* файл на веб-сервер назначения.

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample5.xml)]
8. В этом примере **ContactManagerIisPath** свойства определен в другом месте в файле проекта. Это просто путь к приложению IIS, в виде *[имя веб-сайта IIS] / [имя приложения]*. Включая условие в целевом объекте позволяет пользователям переключаться *приложения\_автономной* развертывания или отключить путем изменения значения свойства или указания параметра командной строки.
9. Добавить новый целевой объект с именем **DeleteAppOffline**. В этом целевом объекте вызов MSDeploy.exe команду, которая удаляет вашей *приложения\_автономной* файл веб-сервере назначения.

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample6.xml)]
10. Последняя задача заключается в вызове этих новых целевых объектов, в соответствующие моменты во время выполнения файла проекта. Это можно сделать разными способами. Например, в *Publish.proj* файл, **FullPublishDependsOn** свойство определяет список целевых объектов, которые должны быть выполнены в заказ **FullPublish** по умолчанию целевой объект вызова.
11. Изменить файл проекта MSBuild для вызова **DeployAppOffline** и **DeleteAppOffline** целевых объектов в соответствующие моменты в процесс публикации.

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample7.xml)]

При запуске пользовательского файла проекта MSBuild, *приложения\_автономной* будет развернут файл на сервер немедленно после успешной сборки. Оно затем удаляется с сервера после завершения всех задач по развертыванию.

## <a name="adding-an-appoffline-file-to-deployment-packages"></a>Добавление приложения\_автономный файл в пакеты развертывания

В зависимости от способа настройки развертывания, все существующее содержимое на целевом сервере IIS веб-приложение&#x2014;как *приложения\_offline.htm* файл&#x2014;могут быть удалены автоматически при развертывании веб-узел пакет в место назначения. Чтобы убедиться, что *приложения\_offline.htm* файл остается на месте на время развертывания, необходимо включить файл в пакет веб-развертывания, сам в дополнение к развертывание непосредственно в начале файла процесс развертывания.

- Если вы выполнили предыдущие задачи этого раздела, вы будете добавлены *приложения\_offline.htm* файл в проект веб-приложения в другое имя файла (мы использовали *приложения\_ автономный template.htm*) и будет задано действие построения **None**. Эти изменения необходимы для файл будет мешать разработки и отладки. Таким образом, необходимо настроить в процессе упаковки, чтобы убедиться, что *приложения\_offline.htm* файл включен в пакет веб-развертывания.

Конвейер публикации Web (WPP) использует список элементов с именем **FilesForPackagingFromProject** для построения списка файлов, которые должны быть включены в пакет веб-развертывания. Можно настроить содержимое вашего веб-пакетов, добавив собственные элементы в этот список. Чтобы сделать это, необходимо выполнить следующие действия:

1. Создайте файл пользовательского проекта *.wpp.targets [имя_проекта]* в той же папке с файлом проекта.

    > [!NOTE]
    > *. Wpp.targets* файл необходимо перейти в той же папке, как файл проекта веб-приложения&#x2014;к примеру, *ContactManager.Mvc.csproj*&#x2014;, а не в той же папке, что любые пользовательские файлы проекта, используемого для управления процессом построения и развертывания.
2. В *. wpp.targets* создайте новый целевой объект MSBuild, который выполняет *перед* **CopyAllFilesToSingleFolderForPackage** целевой объект. Это цель WPP, который создает список требований для включения в пакет.
3. В новый целевой объект, создайте **ItemGroup** элемент.
4. В **ItemGroup** элемента, добавьте **FilesForPackagingFromProject** элемент и укажите *приложения\_offline.htm* файла.

*. Wpp.targets* файл должен выглядеть примерно следующим образом:


[!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample8.xml)]


Ниже приведены основные преимущества Примечание в этом примере.

- **BeforeTargets** атрибут вставляет этот целевой объект в конвейере публикации в Интернете, указав, которая должна выполняться непосредственно перед **CopyAllFilesToSingleFolderForPackage** целевой объект.
- **FilesForPackagingFromProject** элемент использует **DestinationRelativePath** значение метаданных для переименования файла из *приложения\_автономной template.htm* Чтобы *приложения\_offline.htm* , добавляемой в список.

Следующей процедуре показано, как добавить *. wpp.targets* файл в проект веб-приложения.

**Чтобы добавить. файл wpp.targets в веб-пакет развертывания**

1. Откройте решение в Visual Studio 2010.
2. В **обозревателе решений** окно, щелкните правой кнопкой мыши узел проекта web application (например, **ContactManager.Mvc**), пункты **добавить**и нажмите кнопку **Новый элемент**.
3. В **Добавление нового элемента** выберите **XML-файл** шаблона.
4. В **имя** введите *[имя_проекта] ***.wpp.targets** (например, **ContactManager.Mvc.wpp.targets**), а затем нажмите кнопку **добавить**.

    ![](taking-web-applications-offline-with-web-deploy/_static/image4.png)

    > [!NOTE]
    > При добавлении нового элемента к корневому узлу проекта, файл создается в той же папке, что и файл проекта. Это можно проверить, открыв нужную папку в проводнике Windows.
5. В файле добавьте разметку MSBuild, описанных ранее.

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample9.xml)]
6. Сохраните и закройте *.wpp.targets [имя_проекта]* файл.

При повторном сборка и упаковка проекта веб-приложения, WPP автоматически обнаруживает *. wpp.targets* файл. *Приложения\_автономной template.htm* файла будут включены в итоговый пакет веб-развертывания как *приложения\_offline.htm*.

> [!NOTE]
> Если развертывание завершается сбоем, *приложения\_offline.htm* файл останется на месте, и приложение будет работать автономно. Обычно это требуемое поведение. Чтобы перенести приложение обратно в оперативный режим, вы можете удалить *приложения\_offline.htm* файл из веб-сервере. Кроме того, если вы устраните ошибки и выполнить успешное развертывание, *приложения\_offline.htm* файл будет удален.


## <a name="conclusion"></a>Заключение

В этом разделе описано, как использовать веб-приложения автономный режим на время развертывания, путем публикации *приложения\_offline.htm* файл на конечный сервер в начале процесса развертывания и удаления его в каталог Окончание. Здесь также рассматривалось включают *приложения\_offline.htm* файл в пакет веб-развертывания.

## <a name="further-reading"></a>Дополнительные сведения

Дополнительные сведения об упаковке и процесса развертывания см. в разделе [сборка и упаковка проектов веб-приложений](../web-deployment-in-the-enterprise/building-and-packaging-web-application-projects.md), [Настройка параметров для развертывания веб-пакета](../web-deployment-in-the-enterprise/configuring-parameters-for-web-package-deployment.md), и [ Развертывание веб-пакетов](../web-deployment-in-the-enterprise/deploying-web-packages.md).

Если опубликовать веб-приложений непосредственно из Visual Studio, а не с помощью пользовательских MSBuild проекта файл подход, описанный в этих учебниках, необходимо использовать немного другой подход к приложение перевести в автономный режим во время публикации процесс. Дополнительные сведения см. в разделе [как воспользоваться веб-приложения в автономный режим во время публикации](https://go.microsoft.com/?linkid=9805135) (запись блога).

> [!div class="step-by-step"]
> [Назад](excluding-files-and-folders-from-deployment.md)
> [Вперед](running-windows-powershell-scripts-from-msbuild-project-files.md)
