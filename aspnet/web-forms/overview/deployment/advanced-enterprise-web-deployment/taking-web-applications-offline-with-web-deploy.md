---
uid: web-forms/overview/deployment/advanced-enterprise-web-deployment/taking-web-applications-offline-with-web-deploy
title: Перевод веб-приложений вне сети с веб-развертывание | Документация Майкрософт
author: jrjlee
description: В этом разделе описывается перевод веб-приложения автономно в течение автоматического развертывания с помощью о Web Internet Information Services (IIS)...
ms.author: riande
ms.date: 05/04/2012
ms.assetid: 3e9f6e7d-8967-4586-94d5-d3a122f12529
msc.legacyurl: /web-forms/overview/deployment/advanced-enterprise-web-deployment/taking-web-applications-offline-with-web-deploy
msc.type: authoredcontent
ms.openlocfilehash: 017eceb8567859fdbe28bb87af844eee20dfa525
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/09/2019
ms.locfileid: "59415483"
---
# <a name="taking-web-applications-offline-with-web-deploy"></a><span data-ttu-id="98e8b-103">Перевод веб-приложений в автономный режим с помощью веб-развертывания</span><span class="sxs-lookup"><span data-stu-id="98e8b-103">Taking Web Applications Offline with Web Deploy</span></span>

<span data-ttu-id="98e8b-104">по [Джейсон Lee](https://github.com/jrjlee)</span><span class="sxs-lookup"><span data-stu-id="98e8b-104">by [Jason Lee](https://github.com/jrjlee)</span></span>

[<span data-ttu-id="98e8b-105">Скачать PDF</span><span class="sxs-lookup"><span data-stu-id="98e8b-105">Download PDF</span></span>](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> <span data-ttu-id="98e8b-106">В этом разделе описывается перевод веб-приложения автономно в течение автоматического развертывания с помощью средство Internet Information Services (IIS) веб-развертывания (веб-развертывания).</span><span class="sxs-lookup"><span data-stu-id="98e8b-106">This topic describes how to take a web application offline for the duration of an automated deployment using the Internet Information Services (IIS) Web Deployment Tool (Web Deploy).</span></span> <span data-ttu-id="98e8b-107">Пользователи, просматривающие веб-приложению перенаправляются *приложения\_offline.htm* файл до завершения развертывания.</span><span class="sxs-lookup"><span data-stu-id="98e8b-107">Users who browse to the web application are redirected to an *App\_offline.htm* file until the deployment is complete.</span></span>


<span data-ttu-id="98e8b-108">Этот раздел является частью серии учебников, исходя из требования к развертыванию enterprise вымышленной компании Fabrikam, Inc. В этой серии руководств используется пример решения&#x2014; [решения диспетчера контактов](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;для представления веб-приложения с более реалистичные уровень сложности, включая приложения ASP.NET MVC 3, Windows Communication Служба Foundation (WCF) и проект базы данных.</span><span class="sxs-lookup"><span data-stu-id="98e8b-108">This topic forms part of a series of tutorials based around the enterprise deployment requirements of a fictional company named Fabrikam, Inc. This tutorial series uses a sample solution&#x2014;the [Contact Manager solution](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;to represent a web application with a realistic level of complexity, including an ASP.NET MVC 3 application, a Windows Communication Foundation (WCF) service, and a database project.</span></span>

<span data-ttu-id="98e8b-109">Метод развертывания в основе этих учебников основан на разбиение проекта файл подход, описанный в [основные сведения о файле проекта](../web-deployment-in-the-enterprise/understanding-the-project-file.md), в которой процесс построения управляется двумя файлы проекта&#x2014;один с Создание инструкции, которые применяются для каждой целевой среде и содержащего параметры построения и развертывания для конкретной среды.</span><span class="sxs-lookup"><span data-stu-id="98e8b-109">The deployment method at the heart of these tutorials is based on the split project file approach described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md), in which the build process is controlled by two project files&#x2014;one containing build instructions that apply to every destination environment, and one containing environment-specific build and deployment settings.</span></span> <span data-ttu-id="98e8b-110">Во время сборки файл проекта для конкретной среды объединяется в файл проекта независимой от среды, чтобы полный набор инструкций построения.</span><span class="sxs-lookup"><span data-stu-id="98e8b-110">At build time, the environment-specific project file is merged into the environment-agnostic project file to form a complete set of build instructions.</span></span>

## <a name="task-overview"></a><span data-ttu-id="98e8b-111">Общие сведения о задачах</span><span class="sxs-lookup"><span data-stu-id="98e8b-111">Task Overview</span></span>

<span data-ttu-id="98e8b-112">В большинстве сценариев необходимо перевести веб-приложения в автономный режим во время внесения изменений в связанных компонентов, таких как базы данных или веб-служб.</span><span class="sxs-lookup"><span data-stu-id="98e8b-112">In a lot of scenarios, you'll want to take a web application offline while you make changes to related components, like databases or web services.</span></span> <span data-ttu-id="98e8b-113">Как правило, в IIS и ASP.NET, это сделать, поместив файл с именем *приложения\_offline.htm* в корневой папке веб-сайта или веб-приложения IIS.</span><span class="sxs-lookup"><span data-stu-id="98e8b-113">Typically, in IIS and ASP.NET, you accomplish this by placing a file named *App\_offline.htm* in the root folder of the IIS website or web application.</span></span> <span data-ttu-id="98e8b-114">*Приложения\_offline.htm* файл является стандартным файлом HTML и обычно будет содержать простое сообщение, предлагающее пользователю, что сайт временно недоступен из-за обслуживания.</span><span class="sxs-lookup"><span data-stu-id="98e8b-114">The *App\_offline.htm* file is a standard HTML file and will usually contain a simple message advising the user that the site is temporarily unavailable due to maintenance.</span></span> <span data-ttu-id="98e8b-115">Хотя *приложения\_offline.htm* файл существует в корневой папке веб-сайта, IIS автоматически будет перенаправлять все запросы к файлу.</span><span class="sxs-lookup"><span data-stu-id="98e8b-115">While the *App\_offline.htm* file exists in the root folder of the website, IIS will automatically redirect any requests to the file.</span></span> <span data-ttu-id="98e8b-116">После завершения обновления, удаления *приложения\_offline.htm* файлов и веб-сайт возобновляется как обычно обслуживает запросы.</span><span class="sxs-lookup"><span data-stu-id="98e8b-116">When you've finished making updates, you remove the *App\_offline.htm* file and the website resumes serving requests as usual.</span></span>

<span data-ttu-id="98e8b-117">При использовании веб-развертывания для выполнения автоматической или один шаг развертывания к целевой среде, может потребоваться включить Добавление и удаление *приложения\_offline.htm* файла в процессе развертывания.</span><span class="sxs-lookup"><span data-stu-id="98e8b-117">When you use Web Deploy to perform automated or single-step deployments to a target environment, you may want to incorporate adding and removing the *App\_offline.htm* file into your deployment process.</span></span> <span data-ttu-id="98e8b-118">Чтобы сделать это, необходимо выполнить следующие высокоуровневые задачи:</span><span class="sxs-lookup"><span data-stu-id="98e8b-118">To do this, you'll need to complete these high-level tasks:</span></span>

- <span data-ttu-id="98e8b-119">В файле проекта Microsoft Build Engine (MSBuild), используемой для управления процессом развертывания, создать целевой объект MSBuild, который копирует *приложения\_offline.htm* файл на конечный сервер, прежде чем все задачи развертывания Начните.</span><span class="sxs-lookup"><span data-stu-id="98e8b-119">In the Microsoft Build Engine (MSBuild) project file that you use to control the deployment process, create an MSBuild target that copies an *App\_offline.htm* file to the destination server before any deployment tasks begin.</span></span>
- <span data-ttu-id="98e8b-120">Добавить другой целевой объект MSBuild, который удаляет *приложения\_offline.htm* файл на конечном сервере, когда завершены все задачи по развертыванию.</span><span class="sxs-lookup"><span data-stu-id="98e8b-120">Add another MSBuild target that removes the *App\_offline.htm* file from the destination server when all deployment tasks are complete.</span></span>
- <span data-ttu-id="98e8b-121">В проект веб-приложения, создайте *. wpp.targets* файл, который гарантирует, что *приложения\_offline.htm* файл добавляется в пакет развертывания, при вызове веб-развертывания.</span><span class="sxs-lookup"><span data-stu-id="98e8b-121">In the web application project, create a *.wpp.targets* file that ensures that an *App\_offline.htm* file is added to the deployment package when Web Deploy is invoked.</span></span>

<span data-ttu-id="98e8b-122">В этом разделе будет показано, как для выполнения этих процедур.</span><span class="sxs-lookup"><span data-stu-id="98e8b-122">This topic will show you how to perform these procedures.</span></span> <span data-ttu-id="98e8b-123">Задачи и пошаговые руководства в этом разделе предполагается, что вы уже создали решение, которое содержит хотя бы один проект веб-приложения и использовать для управления процессом развертывания, как описано в пользовательском файле проекта [веб-развертывание Enterprise](../web-deployment-in-the-enterprise/web-deployment-in-the-enterprise.md).</span><span class="sxs-lookup"><span data-stu-id="98e8b-123">The tasks and walkthroughs in this topic assume that you've already created a solution that contains at least one web application project, and that you use a custom project file to control the deployment process as described in [Web Deployment in the Enterprise](../web-deployment-in-the-enterprise/web-deployment-in-the-enterprise.md).</span></span> <span data-ttu-id="98e8b-124">Кроме того, можно использовать [Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) образец решения, чтобы выполнить примеры в разделе.</span><span class="sxs-lookup"><span data-stu-id="98e8b-124">Alternatively, you can use the [Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) sample solution to follow the examples in the topic.</span></span>

## <a name="adding-an-appoffline-file-to-a-web-application-project"></a><span data-ttu-id="98e8b-125">Добавление приложения\_автономный файл в проект веб-приложения</span><span class="sxs-lookup"><span data-stu-id="98e8b-125">Adding an App\_Offline File to a Web Application Project</span></span>

<span data-ttu-id="98e8b-126">Первых, вам потребуется выполнить действия, необходимо добавить *приложения\_автономной* файл в проект веб-приложения:</span><span class="sxs-lookup"><span data-stu-id="98e8b-126">The first task you need to complete is to add an *App\_offline* file to your web application project:</span></span>

- <span data-ttu-id="98e8b-127">Для предотвращения конфликта в процессе разработки файла (вы не хотите приложения без возможности восстановления отключен), следует вызывать его что-то отличное от *приложения\_offline.htm*.</span><span class="sxs-lookup"><span data-stu-id="98e8b-127">To prevent the file from interfering with the development process (you don't want your application to be permanently offline), you should call it something other than *App\_offline.htm*.</span></span> <span data-ttu-id="98e8b-128">Например, можно назвать файл *приложения\_автономной template.htm*.</span><span class="sxs-lookup"><span data-stu-id="98e8b-128">For example, you could name the file *App\_offline-template.htm*.</span></span>
- <span data-ttu-id="98e8b-129">Чтобы предотвратить развернутым в качестве файла-является, необходимо присвоить значение действие построения **None**.</span><span class="sxs-lookup"><span data-stu-id="98e8b-129">To prevent the file from being deployed as-is, you should set the build action to **None**.</span></span>

**<span data-ttu-id="98e8b-130">Добавление приложения\_автономный файл в проект веб-приложения</span><span class="sxs-lookup"><span data-stu-id="98e8b-130">To add an App\_offline file to a web application project</span></span>**

1. <span data-ttu-id="98e8b-131">Откройте решение в Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="98e8b-131">Open your solution in Visual Studio 2010.</span></span>
2. <span data-ttu-id="98e8b-132">В **обозревателе решений** окно, щелкните правой кнопкой мыши проект веб-приложения, выберите пункт **добавить**, а затем нажмите кнопку **новый элемент**.</span><span class="sxs-lookup"><span data-stu-id="98e8b-132">In the **Solution Explorer** window, right-click your web application project, point to **Add**, and then click **New Item**.</span></span>
3. <span data-ttu-id="98e8b-133">В **Добавление нового элемента** выберите **HTML-страницу**.</span><span class="sxs-lookup"><span data-stu-id="98e8b-133">In the **Add New Item** dialog box, select **HTML Page**.</span></span>
4. <span data-ttu-id="98e8b-134">В **имя** введите **приложения\_автономной template.htm**, а затем нажмите кнопку **добавить**.</span><span class="sxs-lookup"><span data-stu-id="98e8b-134">In the **Name** box, type **App\_offline-template.htm**, and then click **Add**.</span></span>

    ![](taking-web-applications-offline-with-web-deploy/_static/image1.png)
5. <span data-ttu-id="98e8b-135">Добавление простого HTML для информирования пользователей о том, что приложение недоступно и затем сохраните файл.</span><span class="sxs-lookup"><span data-stu-id="98e8b-135">Add some simple HTML to inform users that the application is unavailable, and then save the file.</span></span> <span data-ttu-id="98e8b-136">Не включайте все серверные теги (например, все теги, которые начинаются с префикса «asp:»).</span><span class="sxs-lookup"><span data-stu-id="98e8b-136">Do not include any server-side tags (for example, any tags that are prefixed with "asp:").</span></span> 

    ![](taking-web-applications-offline-with-web-deploy/_static/image2.png)
6. <span data-ttu-id="98e8b-137">В **обозревателе решений** окно, щелкните правой кнопкой мыши новый файл и нажмите кнопку **свойства**.</span><span class="sxs-lookup"><span data-stu-id="98e8b-137">In the **Solution Explorer** window, right-click the new file, and then click **Properties**.</span></span>
7. <span data-ttu-id="98e8b-138">В **свойства** окно в **действие при построении** строку, выберите **None**.</span><span class="sxs-lookup"><span data-stu-id="98e8b-138">In the **Properties** window, in the **Build Action** row, select **None**.</span></span>

    ![](taking-web-applications-offline-with-web-deploy/_static/image3.png)

## <a name="deploying-and-deleting-an-appoffline-file"></a><span data-ttu-id="98e8b-139">Развертывание и удаление приложения\_файлов вне сети</span><span class="sxs-lookup"><span data-stu-id="98e8b-139">Deploying and Deleting an App\_Offline File</span></span>

<span data-ttu-id="98e8b-140">Следующим шагом является изменение логики скопируйте файл на конечный сервер в начале процесса развертывания и удалить его по завершении развертывания.</span><span class="sxs-lookup"><span data-stu-id="98e8b-140">The next step is to modify your deployment logic to copy the file to the destination server at the start of the deployment process and remove it at the end.</span></span>

> [!NOTE]
> <span data-ttu-id="98e8b-141">В следующей процедуре предполагается, что вы используете пользовательский файл проекта MSBuild для управления процесс развертывания, как описано в разделе [основные сведения о файле проекта](../web-deployment-in-the-enterprise/understanding-the-project-file.md).</span><span class="sxs-lookup"><span data-stu-id="98e8b-141">The next procedure assumes that you're using a custom MSBuild project file to control your deployment process, as described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md).</span></span> <span data-ttu-id="98e8b-142">При развертывании из Visual Studio, необходимо использовать другой подход.</span><span class="sxs-lookup"><span data-stu-id="98e8b-142">If you're deploying direct from Visual Studio, you'll need to use a different approach.</span></span> <span data-ttu-id="98e8b-143">Саид Ибрагим Хашими описывает один такой новый подход в [как занять Your публикации веб-приложений вне сети во время](http://sedodream.com/2012/01/08/HowToTakeYourWebAppOfflineDuringPublishing.aspx).</span><span class="sxs-lookup"><span data-stu-id="98e8b-143">Sayed Ibrahim Hashimi describes one such approach in [How to Take Your Web App Offline During Publishing](http://sedodream.com/2012/01/08/HowToTakeYourWebAppOfflineDuringPublishing.aspx).</span></span>


<span data-ttu-id="98e8b-144">Для развертывания *приложения\_автономной* файл на целевой веб-сайт IIS, необходимо вызвать с помощью MSDeploy.exe [веб-развертывания **contentPath** поставщика](https://technet.microsoft.com/library/dd569034(WS.10).aspx).</span><span class="sxs-lookup"><span data-stu-id="98e8b-144">To deploy an *App\_offline* file to a destination IIS website, you need to invoke MSDeploy.exe using the [Web Deploy **contentPath** provider](https://technet.microsoft.com/library/dd569034(WS.10).aspx).</span></span> <span data-ttu-id="98e8b-145">**ContentPath** поставщик поддерживает физический каталог пути и пути к веб-сайта или приложения IIS, что делает его идеальным выбором для синхронизации файлов между папкой проекта Visual Studio и веб-приложение IIS.</span><span class="sxs-lookup"><span data-stu-id="98e8b-145">The **contentPath** provider supports both physical directory paths and IIS website or application paths, which makes it the ideal choice for synchronizing a file between a Visual Studio project folder and an IIS web application.</span></span> <span data-ttu-id="98e8b-146">Чтобы развернуть файл, MSDeploy команда должна выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="98e8b-146">To deploy the file, your MSDeploy command should resemble this:</span></span>


[!code-console[Main](taking-web-applications-offline-with-web-deploy/samples/sample1.cmd)]


<span data-ttu-id="98e8b-147">Чтобы удалить файл из конечного сайта в конце процесса развертывания, MSDeploy команда должна выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="98e8b-147">To remove the file from the destination site at the end of the deployment process, your MSDeploy command should resemble this:</span></span>


[!code-console[Main](taking-web-applications-offline-with-web-deploy/samples/sample2.cmd)]


<span data-ttu-id="98e8b-148">Чтобы автоматизировать эти команды в рамках процесса построения и развертывания, необходимо интегрировать их в пользовательский файл проекта MSBuild.</span><span class="sxs-lookup"><span data-stu-id="98e8b-148">To automate these commands as part of a build and deployment process, you need to integrate them into your custom MSBuild project file.</span></span> <span data-ttu-id="98e8b-149">Далее описано, как это сделать.</span><span class="sxs-lookup"><span data-stu-id="98e8b-149">The next procedure describes how to do this.</span></span>

**<span data-ttu-id="98e8b-150">Для развертывания и удалить приложение\_файлов вне сети</span><span class="sxs-lookup"><span data-stu-id="98e8b-150">To deploy and delete an App\_offline file</span></span>**

1. <span data-ttu-id="98e8b-151">В Visual Studio 2010 откройте файл проекта MSBuild, управляющий процесс развертывания.</span><span class="sxs-lookup"><span data-stu-id="98e8b-151">In Visual Studio 2010, open the MSBuild project file that controls your deployment process.</span></span> <span data-ttu-id="98e8b-152">В [Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) это пример решения, *Publish.proj* файла.</span><span class="sxs-lookup"><span data-stu-id="98e8b-152">In the [Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) sample solution, this is the *Publish.proj* file.</span></span>
2. <span data-ttu-id="98e8b-153">В корневом каталоге **проекта** элемент, создайте новый **PropertyGroup** элемента для хранения переменных для *приложения\_автономной* развертывания:</span><span class="sxs-lookup"><span data-stu-id="98e8b-153">In the root **Project** element, create a new **PropertyGroup** element to store variables for the *App\_offline* deployment:</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample3.xml)]
3. <span data-ttu-id="98e8b-154">**SourceRoot** свойства определен в другом месте в *Publish.proj* файла.</span><span class="sxs-lookup"><span data-stu-id="98e8b-154">The **SourceRoot** property is defined elsewhere in the *Publish.proj* file.</span></span> <span data-ttu-id="98e8b-155">Указывает расположение исходного содержимого по отношению к текущему пути к корневой папке&#x2014;другими словами, относительно расположения *Publish.proj* файла.</span><span class="sxs-lookup"><span data-stu-id="98e8b-155">It indicates the location of the root folder for the source content relative to the current path&#x2014;in other words, relative to the location of the *Publish.proj* file.</span></span>
4. <span data-ttu-id="98e8b-156">**ContentPath** поставщик не будет принимать относительных путей к файлам, поэтому вам нужно получить абсолютный путь к файлу источника, чего вы сможете развернуть его.</span><span class="sxs-lookup"><span data-stu-id="98e8b-156">The **contentPath** provider will not accept relative file paths, so you need to get an absolute path to your source file before you can deploy it.</span></span> <span data-ttu-id="98e8b-157">Можно использовать [ConvertToAbsolutePath](https://msdn.microsoft.com/library/bb882668.aspx) задач для этого.</span><span class="sxs-lookup"><span data-stu-id="98e8b-157">You can use the [ConvertToAbsolutePath](https://msdn.microsoft.com/library/bb882668.aspx) task to do this.</span></span>
5. <span data-ttu-id="98e8b-158">Добавьте новый **целевой** элемент с именем **GetAppOfflineAbsolutePath**.</span><span class="sxs-lookup"><span data-stu-id="98e8b-158">Add a new **Target** element named **GetAppOfflineAbsolutePath**.</span></span> <span data-ttu-id="98e8b-159">В этом целевом объекте, используйте **ConvertToAbsolutePath** задачи, чтобы получить абсолютный путь к *приложения\_автономного шаблона* файл в папке проекта.</span><span class="sxs-lookup"><span data-stu-id="98e8b-159">Within this target, use the **ConvertToAbsolutePath** task to get an absolute path to the *App\_offline-template* file in your project folder.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample4.xml)]
6. <span data-ttu-id="98e8b-160">Этот целевой объект принимает относительный путь к *приложения\_автономного шаблона* файл в папку проекта и сохраняет его в новое свойство как абсолютный путь на диске.</span><span class="sxs-lookup"><span data-stu-id="98e8b-160">This target takes the relative path to the *App\_offline-template* file in your project folder and saves it to a new property as an absolute file path.</span></span> <span data-ttu-id="98e8b-161">**BeforeTargets** атрибут указывает, что этот целевой объект для выполнения перед **DeployAppOffline** целевой объект, который вы создадите на следующем шаге.</span><span class="sxs-lookup"><span data-stu-id="98e8b-161">The **BeforeTargets** attribute specifies that you want this target to execute before the **DeployAppOffline** target, which you'll create in the next step.</span></span>
7. <span data-ttu-id="98e8b-162">Добавить новый целевой объект с именем **DeployAppOffline**.</span><span class="sxs-lookup"><span data-stu-id="98e8b-162">Add a new target named **DeployAppOffline**.</span></span> <span data-ttu-id="98e8b-163">В этом целевом объекте вызвать команду MSDeploy.exe, который развертывает вашей *приложения\_автономной* файл на веб-сервер назначения.</span><span class="sxs-lookup"><span data-stu-id="98e8b-163">Within this target, invoke the MSDeploy.exe command that deploys your *App\_offline* file to the destination web server.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample5.xml)]
8. <span data-ttu-id="98e8b-164">В этом примере **ContactManagerIisPath** свойства определен в другом месте в файле проекта.</span><span class="sxs-lookup"><span data-stu-id="98e8b-164">In this example, the **ContactManagerIisPath** property is defined elsewhere in the project file.</span></span> <span data-ttu-id="98e8b-165">Это просто путь к приложению IIS, в виде *[имя веб-сайта IIS] / [имя приложения]*.</span><span class="sxs-lookup"><span data-stu-id="98e8b-165">This is simply an IIS application path, in the form *[IIS Website Name]/[Application Name]*.</span></span> <span data-ttu-id="98e8b-166">Включая условие в целевом объекте позволяет пользователям переключаться *приложения\_автономной* развертывания или отключить путем изменения значения свойства или указания параметра командной строки.</span><span class="sxs-lookup"><span data-stu-id="98e8b-166">Including a condition in the target enables users to switch the *App\_offline* deployment on or off by changing a property value or providing a command-line parameter.</span></span>
9. <span data-ttu-id="98e8b-167">Добавить новый целевой объект с именем **DeleteAppOffline**.</span><span class="sxs-lookup"><span data-stu-id="98e8b-167">Add a new target named **DeleteAppOffline**.</span></span> <span data-ttu-id="98e8b-168">В этом целевом объекте вызов MSDeploy.exe команду, которая удаляет вашей *приложения\_автономной* файл веб-сервере назначения.</span><span class="sxs-lookup"><span data-stu-id="98e8b-168">Within this target, invoke the MSDeploy.exe command that removes your *App\_offline* file from the destination web server.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample6.xml)]
10. <span data-ttu-id="98e8b-169">Последняя задача заключается в вызове этих новых целевых объектов, в соответствующие моменты во время выполнения файла проекта.</span><span class="sxs-lookup"><span data-stu-id="98e8b-169">The final task is to invoke these new targets at appropriate points during the execution of your project file.</span></span> <span data-ttu-id="98e8b-170">Это можно сделать разными способами.</span><span class="sxs-lookup"><span data-stu-id="98e8b-170">You can do this in various ways.</span></span> <span data-ttu-id="98e8b-171">Например, в *Publish.proj* файл, **FullPublishDependsOn** свойство определяет список целевых объектов, которые должны быть выполнены в заказ **FullPublish** по умолчанию целевой объект вызова.</span><span class="sxs-lookup"><span data-stu-id="98e8b-171">For example, in the *Publish.proj* file, the **FullPublishDependsOn** property specifies a list of targets that must be executed in order when the **FullPublish** default target is invoked.</span></span>
11. <span data-ttu-id="98e8b-172">Изменить файл проекта MSBuild для вызова **DeployAppOffline** и **DeleteAppOffline** целевых объектов в соответствующие моменты в процесс публикации.</span><span class="sxs-lookup"><span data-stu-id="98e8b-172">Modify your MSBuild project file to invoke the **DeployAppOffline** and **DeleteAppOffline** targets at appropriate points in the publishing process.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample7.xml)]

<span data-ttu-id="98e8b-173">При запуске пользовательского файла проекта MSBuild, *приложения\_автономной* будет развернут файл на сервер немедленно после успешной сборки.</span><span class="sxs-lookup"><span data-stu-id="98e8b-173">When you run your custom MSBuild project file, the *App\_offline* file will be deployed to the server immediately after a successful build.</span></span> <span data-ttu-id="98e8b-174">Оно затем удаляется с сервера после завершения всех задач по развертыванию.</span><span class="sxs-lookup"><span data-stu-id="98e8b-174">It will then be deleted from the server once all the deployment tasks are complete.</span></span>

## <a name="adding-an-appoffline-file-to-deployment-packages"></a><span data-ttu-id="98e8b-175">Добавление приложения\_автономный файл в пакеты развертывания</span><span class="sxs-lookup"><span data-stu-id="98e8b-175">Adding an App\_Offline File to Deployment Packages</span></span>

<span data-ttu-id="98e8b-176">В зависимости от способа настройки развертывания, все существующее содержимое на целевом сервере IIS веб-приложение&#x2014;как *приложения\_offline.htm* файл&#x2014;могут быть удалены автоматически при развертывании веб-узел пакет в место назначения.</span><span class="sxs-lookup"><span data-stu-id="98e8b-176">Depending on how you configure your deployment, any existing content at the destination IIS web application&#x2014;like the *App\_offline.htm* file&#x2014;may be deleted automatically when you deploy a web package to the destination.</span></span> <span data-ttu-id="98e8b-177">Чтобы убедиться, что *приложения\_offline.htm* файл остается на месте на время развертывания, необходимо включить файл в пакет веб-развертывания, сам в дополнение к развертывание непосредственно в начале файла процесс развертывания.</span><span class="sxs-lookup"><span data-stu-id="98e8b-177">To ensure that the *App\_offline.htm* file remains in place for the duration of the deployment, you need to include the file within the web deployment package itself in addition to deploying the file directly at the start of the deployment process.</span></span>

- <span data-ttu-id="98e8b-178">Если вы выполнили предыдущие задачи этого раздела, вы будете добавлены *приложения\_offline.htm* файл в проект веб-приложения в другое имя файла (мы использовали *приложения\_ автономный template.htm*) и будет задано действие построения **None**.</span><span class="sxs-lookup"><span data-stu-id="98e8b-178">If you've followed the previous tasks in this topic, you'll have added the *App\_offline.htm* file to your web application project under a different filename (we used *App\_offline-template.htm*) and you'll have set the build action to **None**.</span></span> <span data-ttu-id="98e8b-179">Эти изменения необходимы для файл будет мешать разработки и отладки.</span><span class="sxs-lookup"><span data-stu-id="98e8b-179">These changes are necessary to prevent the file from interfering with development and debugging.</span></span> <span data-ttu-id="98e8b-180">Таким образом, необходимо настроить в процессе упаковки, чтобы убедиться, что *приложения\_offline.htm* файл включен в пакет веб-развертывания.</span><span class="sxs-lookup"><span data-stu-id="98e8b-180">As a result, you need to customize the packaging process to ensure that the *App\_offline.htm* file is included in the web deployment package.</span></span>

<span data-ttu-id="98e8b-181">Конвейер публикации Web (WPP) использует список элементов с именем **FilesForPackagingFromProject** для построения списка файлов, которые должны быть включены в пакет веб-развертывания.</span><span class="sxs-lookup"><span data-stu-id="98e8b-181">The Web Publishing Pipeline (WPP) uses an item list named **FilesForPackagingFromProject** to build a list of files that should be included in the web deployment package.</span></span> <span data-ttu-id="98e8b-182">Можно настроить содержимое вашего веб-пакетов, добавив собственные элементы в этот список.</span><span class="sxs-lookup"><span data-stu-id="98e8b-182">You can customize the contents of your web packages by adding your own items to this list.</span></span> <span data-ttu-id="98e8b-183">Чтобы сделать это, необходимо выполнить следующие действия:</span><span class="sxs-lookup"><span data-stu-id="98e8b-183">To do this, you need to complete these high-level steps:</span></span>

1. <span data-ttu-id="98e8b-184">Создайте файл пользовательского проекта *.wpp.targets [имя_проекта]* в той же папке с файлом проекта.</span><span class="sxs-lookup"><span data-stu-id="98e8b-184">Create a custom project file named *[project name].wpp.targets* in the same folder as your project file.</span></span>

    > [!NOTE]
    > <span data-ttu-id="98e8b-185">*. Wpp.targets* файл необходимо перейти в той же папке, как файл проекта веб-приложения&#x2014;к примеру, *ContactManager.Mvc.csproj*&#x2014;, а не в той же папке, что любые пользовательские файлы проекта, используемого для управления процессом построения и развертывания.</span><span class="sxs-lookup"><span data-stu-id="98e8b-185">The *.wpp.targets* file needs to go in the same folder as your web application project file&#x2014;for example, *ContactManager.Mvc.csproj*&#x2014;rather than in the same folder as any custom project files you use to control the build and deployment process.</span></span>
2. <span data-ttu-id="98e8b-186">В *. wpp.targets* создайте новый целевой объект MSBuild, который выполняет *перед* **CopyAllFilesToSingleFolderForPackage** целевой объект.</span><span class="sxs-lookup"><span data-stu-id="98e8b-186">In the *.wpp.targets* file, create a new MSBuild target that executes *before* the **CopyAllFilesToSingleFolderForPackage** target.</span></span> <span data-ttu-id="98e8b-187">Это цель WPP, который создает список требований для включения в пакет.</span><span class="sxs-lookup"><span data-stu-id="98e8b-187">This is the WPP target that builds a list of things to include in the package.</span></span>
3. <span data-ttu-id="98e8b-188">В новый целевой объект, создайте **ItemGroup** элемент.</span><span class="sxs-lookup"><span data-stu-id="98e8b-188">In the new target, create an **ItemGroup** element.</span></span>
4. <span data-ttu-id="98e8b-189">В **ItemGroup** элемента, добавьте **FilesForPackagingFromProject** элемент и укажите *приложения\_offline.htm* файла.</span><span class="sxs-lookup"><span data-stu-id="98e8b-189">In the **ItemGroup** element, add a **FilesForPackagingFromProject** item and specify the *App\_offline.htm* file.</span></span>

<span data-ttu-id="98e8b-190">*. Wpp.targets* файл должен выглядеть примерно следующим образом:</span><span class="sxs-lookup"><span data-stu-id="98e8b-190">The *.wpp.targets* file should resemble this:</span></span>


[!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample8.xml)]


<span data-ttu-id="98e8b-191">Ниже приведены основные преимущества Примечание в этом примере.</span><span class="sxs-lookup"><span data-stu-id="98e8b-191">These are the key points of note in this example:</span></span>

- <span data-ttu-id="98e8b-192">**BeforeTargets** атрибут вставляет этот целевой объект в конвейере публикации в Интернете, указав, которая должна выполняться непосредственно перед **CopyAllFilesToSingleFolderForPackage** целевой объект.</span><span class="sxs-lookup"><span data-stu-id="98e8b-192">The **BeforeTargets** attribute inserts this target into the WPP by specifying that it should be executed immediately before the **CopyAllFilesToSingleFolderForPackage** target.</span></span>
- <span data-ttu-id="98e8b-193">**FilesForPackagingFromProject** элемент использует **DestinationRelativePath** значение метаданных для переименования файла из *приложения\_автономной template.htm* Чтобы *приложения\_offline.htm* , добавляемой в список.</span><span class="sxs-lookup"><span data-stu-id="98e8b-193">The **FilesForPackagingFromProject** item uses the **DestinationRelativePath** metadata value to rename the file from *App\_offline-template.htm* to *App\_offline.htm* as it's added to the list.</span></span>

<span data-ttu-id="98e8b-194">Следующей процедуре показано, как добавить *. wpp.targets* файл в проект веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="98e8b-194">The next procedure shows you how to add this *.wpp.targets* file to a web application project.</span></span>

**<span data-ttu-id="98e8b-195">Чтобы добавить. файл wpp.targets в веб-пакет развертывания</span><span class="sxs-lookup"><span data-stu-id="98e8b-195">To add a .wpp.targets file to a web deployment package</span></span>**

1. <span data-ttu-id="98e8b-196">Откройте решение в Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="98e8b-196">Open your solution in Visual Studio 2010.</span></span>
2. <span data-ttu-id="98e8b-197">В **обозревателе решений** окно, щелкните правой кнопкой мыши узел проекта web application (например, **ContactManager.Mvc**), пункты **добавить**и нажмите кнопку **Новый элемент**.</span><span class="sxs-lookup"><span data-stu-id="98e8b-197">In the **Solution Explorer** window, right-click your web application project node (for example, **ContactManager.Mvc**), point to **Add**, and then click **New Item**.</span></span>
3. <span data-ttu-id="98e8b-198">В **Добавление нового элемента** выберите **XML-файл** шаблона.</span><span class="sxs-lookup"><span data-stu-id="98e8b-198">In the **Add New Item** dialog box, select the **XML File** template.</span></span>
4. <span data-ttu-id="98e8b-199">В **имя** введите \*[имя_проекта] \***.wpp.targets** (например, **ContactManager.Mvc.wpp.targets**), а затем нажмите кнопку **добавить**.</span><span class="sxs-lookup"><span data-stu-id="98e8b-199">In the **Name** box, type *[project name]\*\*\*.wpp.targets*\* (for example, **ContactManager.Mvc.wpp.targets**), and then click **Add**.</span></span>

    ![](taking-web-applications-offline-with-web-deploy/_static/image4.png)

    > [!NOTE]
    > <span data-ttu-id="98e8b-200">При добавлении нового элемента к корневому узлу проекта, файл создается в той же папке, что и файл проекта.</span><span class="sxs-lookup"><span data-stu-id="98e8b-200">If you add a new item to the root node of a project, the file is created in the same folder as the project file.</span></span> <span data-ttu-id="98e8b-201">Это можно проверить, открыв нужную папку в проводнике Windows.</span><span class="sxs-lookup"><span data-stu-id="98e8b-201">You can verify this by opening the folder in Windows Explorer.</span></span>
5. <span data-ttu-id="98e8b-202">В файле добавьте разметку MSBuild, описанных ранее.</span><span class="sxs-lookup"><span data-stu-id="98e8b-202">In the file, add the MSBuild markup described previously.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample9.xml)]
6. <span data-ttu-id="98e8b-203">Сохраните и закройте *.wpp.targets [имя_проекта]* файл.</span><span class="sxs-lookup"><span data-stu-id="98e8b-203">Save and close the *[project name].wpp.targets* file.</span></span>

<span data-ttu-id="98e8b-204">При повторном сборка и упаковка проекта веб-приложения, WPP автоматически обнаруживает *. wpp.targets* файл.</span><span class="sxs-lookup"><span data-stu-id="98e8b-204">The next time you build and package your web application project, the WPP will automatically detect the *.wpp.targets* file.</span></span> <span data-ttu-id="98e8b-205">*Приложения\_автономной template.htm* файла будут включены в итоговый пакет веб-развертывания как *приложения\_offline.htm*.</span><span class="sxs-lookup"><span data-stu-id="98e8b-205">The *App\_offline-template.htm* file will be included in the resulting web deployment package as *App\_offline.htm*.</span></span>

> [!NOTE]
> <span data-ttu-id="98e8b-206">Если развертывание завершается сбоем, *приложения\_offline.htm* файл останется на месте, и приложение будет работать автономно.</span><span class="sxs-lookup"><span data-stu-id="98e8b-206">If your deployment fails, the *App\_offline.htm* file will remain in place and your application will remain offline.</span></span> <span data-ttu-id="98e8b-207">Обычно это требуемое поведение.</span><span class="sxs-lookup"><span data-stu-id="98e8b-207">This is typically the desired behavior.</span></span> <span data-ttu-id="98e8b-208">Чтобы перенести приложение обратно в оперативный режим, вы можете удалить *приложения\_offline.htm* файл из веб-сервере.</span><span class="sxs-lookup"><span data-stu-id="98e8b-208">To bring your application back online, you can delete the *App\_offline.htm* file from your web server.</span></span> <span data-ttu-id="98e8b-209">Кроме того, если вы устраните ошибки и выполнить успешное развертывание, *приложения\_offline.htm* файл будет удален.</span><span class="sxs-lookup"><span data-stu-id="98e8b-209">Alternatively, if you correct any errors and run a successful deployment, the *App\_offline.htm* file will be removed.</span></span>


## <a name="conclusion"></a><span data-ttu-id="98e8b-210">Заключение</span><span class="sxs-lookup"><span data-stu-id="98e8b-210">Conclusion</span></span>

<span data-ttu-id="98e8b-211">В этом разделе описано, как использовать веб-приложения автономный режим на время развертывания, путем публикации *приложения\_offline.htm* файл на конечный сервер в начале процесса развертывания и удаления его в каталог Окончание.</span><span class="sxs-lookup"><span data-stu-id="98e8b-211">This topic described how to take a web application offline for the duration of a deployment, by publishing an *App\_offline.htm* file to the destination server at the start of the deployment process and removing it at the end.</span></span> <span data-ttu-id="98e8b-212">Здесь также рассматривалось включают *приложения\_offline.htm* файл в пакет веб-развертывания.</span><span class="sxs-lookup"><span data-stu-id="98e8b-212">It also covered how to include an *App\_offline.htm* file in a web deployment package.</span></span>

## <a name="further-reading"></a><span data-ttu-id="98e8b-213">Дополнительные сведения</span><span class="sxs-lookup"><span data-stu-id="98e8b-213">Further Reading</span></span>

<span data-ttu-id="98e8b-214">Дополнительные сведения об упаковке и процесса развертывания см. в разделе [сборка и упаковка проектов веб-приложений](../web-deployment-in-the-enterprise/building-and-packaging-web-application-projects.md), [Настройка параметров для развертывания веб-пакета](../web-deployment-in-the-enterprise/configuring-parameters-for-web-package-deployment.md), и [ Развертывание веб-пакетов](../web-deployment-in-the-enterprise/deploying-web-packages.md).</span><span class="sxs-lookup"><span data-stu-id="98e8b-214">For more information on the packaging and deployment process, see [Building and Packaging Web Application Projects](../web-deployment-in-the-enterprise/building-and-packaging-web-application-projects.md), [Configuring Parameters for Web Package Deployment](../web-deployment-in-the-enterprise/configuring-parameters-for-web-package-deployment.md), and [Deploying Web Packages](../web-deployment-in-the-enterprise/deploying-web-packages.md).</span></span>

<span data-ttu-id="98e8b-215">Если опубликовать веб-приложений непосредственно из Visual Studio, а не с помощью пользовательских MSBuild проекта файл подход, описанный в этих учебниках, необходимо использовать немного другой подход к приложение перевести в автономный режим во время публикации процесс.</span><span class="sxs-lookup"><span data-stu-id="98e8b-215">If you publish your web applications directly from Visual Studio, rather than using the custom MSBuild project file approach described in these tutorials, you'll need to use a slightly different approach to take your application offline during the publishing process.</span></span> <span data-ttu-id="98e8b-216">Дополнительные сведения см. в разделе [как воспользоваться веб-приложения в автономный режим во время публикации](https://go.microsoft.com/?linkid=9805135) (запись блога).</span><span class="sxs-lookup"><span data-stu-id="98e8b-216">For more information, see [How to take your web app offline during publishing](https://go.microsoft.com/?linkid=9805135) (blog post).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="98e8b-217">[Назад](excluding-files-and-folders-from-deployment.md)
> [Вперед](running-windows-powershell-scripts-from-msbuild-project-files.md)</span><span class="sxs-lookup"><span data-stu-id="98e8b-217">[Previous](excluding-files-and-folders-from-deployment.md)
[Next](running-windows-powershell-scripts-from-msbuild-project-files.md)</span></span>
