---
uid: web-forms/overview/deployment/advanced-enterprise-web-deployment/excluding-files-and-folders-from-deployment
title: Исключение файлов и папок из развертывания | Документация Майкрософт
author: jrjlee
description: В этом разделе описывается, как можно исключить файлы и папки из пакета веб-развертывания при сборке и упаковке проекта веб-приложения.
ms.author: riande
ms.date: 05/04/2012
ms.assetid: f4cc2d40-6a78-429b-b06f-07d000d4caad
msc.legacyurl: /web-forms/overview/deployment/advanced-enterprise-web-deployment/excluding-files-and-folders-from-deployment
msc.type: authoredcontent
ms.openlocfilehash: a262ce43d7199fb1015d54d0b7c213857c360946
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78438420"
---
# <a name="excluding-files-and-folders-from-deployment"></a>Исключение файлов и папок из развертывания

кто [Джейсон Иванов](https://github.com/jrjlee)

[Скачать в формате PDF](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> В этом разделе описывается, как можно исключить файлы и папки из пакета веб-развертывания при сборке и упаковке проекта веб-приложения.

Этот раздел является частью серии руководств, основанных на требованиях Enterprise к развертыванию вымышленной компании Fabrikam, Inc. В этой серии руководств используется пример решения&#x2014; [диспетчера контактов](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;для представления веб-приложения с реалистичным уровнем сложности, включая приложение ASP.NET MVC 3, службу Windows Communication Foundation (WCF) и проект базы данных.

Метод развертывания в сердце этих учебников основан на подходе к файлам проекта Split, описанному в разделе [понимание файла проекта](../web-deployment-in-the-enterprise/understanding-the-project-file.md), в котором процесс сборки управляется двумя файлами&#x2014;проекта, содержащими инструкции по сборке, которые применяются к каждой целевой среде, и одна содержит параметры сборки и развертывания, относящиеся к конкретной среде. Во время сборки файл проекта, зависящий от среды, объединяется в файл проекта независимо от среды, чтобы сформировать полный набор инструкций по сборке.

## <a name="overview"></a>Обзор

При создании проекта веб-приложения в Visual Studio 2010 конвейер веб-публикаций (WPP) позволяет расширить этот процесс сборки, упаковывая скомпилированное веб-приложение в развертываемый веб-пакет. Затем можно использовать средство веб-развертывания службы IIS (IIS) (веб-развертывание), чтобы развернуть этот веб-пакет на удаленном веб-сервере IIS, или импортировать веб-пакет вручную с помощью диспетчера служб IIS. Этот процесс упаковки объясняется в [создании и упаковке проектов веб-приложений](../web-deployment-in-the-enterprise/building-and-packaging-web-application-projects.md).

Так как же вы управляете тем, что входит в веб-пакет? Параметры проекта в Visual Studio с помощью базового файла проекта предоставляют достаточный контроль для множества сценариев. Однако в некоторых случаях может потребоваться адаптировать содержимое веб-пакета к определенным конечным средам. Например, может потребоваться включить папку для файлов журнала при развертывании приложения в тестовой среде, но исключить папку при развертывании приложения в промежуточной или рабочей среде. В этом разделе будет показано, как это сделать.

## <a name="what-gets-included-by-default"></a>Какие данные включаются по умолчанию?

При настройке свойств проекта веб-приложения в Visual Studio список **элементы для развертывания** на **веб-странице Пакет/Публикация** позволяет указать, что нужно включить в пакет веб-развертывания. По умолчанию заданы **только файлы, необходимые для запуска этого приложения**.

![](excluding-files-and-folders-from-deployment/_static/image1.png)

Если выбраны **только файлы, необходимые для запуска этого приложения**, конвейер WPP попытается определить, какие файлы следует добавить в веб-пакет. В том числе:

- Все выходные данные сборки для проекта.
- Все файлы, помеченные действием сборки **содержимого**.

> [!NOTE]
> Логика, определяющая включаемые файлы, содержится в этом файле:   
> *%PROGRAMFILES%\MSBuild\Microsoft\VisualStudio\v10.0\Web\ Microsoft. Web. Publishing. Онлифилесторунсеапп. targets*

## <a name="excluding-specific-files-and-folders"></a>Исключение конкретных файлов и папок

В некоторых случаях требуется более детализированный контроль над тем, какие файлы и папки развертываются. Если известно, какие файлы необходимо исключить заранее, а исключение применяется ко всем конечным средам, можно просто установить **действие сборки** для каждого файла в значение **нет**.

**Исключение конкретных файлов из развертывания**

1. В окне **Обозреватель решений** щелкните правой кнопкой мыши файл и выберите пункт **свойства**.
2. В окне **Свойства** в строке **действие построения** выберите **нет**.

Однако этот подход не всегда удобен. Например, может потребоваться изменить, какие файлы и папки включаются в соответствии с целевой средой и вне Visual Studio. Например, в примере решения диспетчера контактов просмотрите содержимое проекта ContactManager. MVC:

![](excluding-files-and-folders-from-deployment/_static/image2.png)

- Внутренняя папка содержит некоторые скрипты SQL, используемые разработчиком для создания, удаления и заполнения локальных баз данных в целях разработки. Ни одна из этих папок не должна быть развернута в промежуточной или рабочей среде.
- Папка Scripts содержит несколько файлов JavaScript. Множество этих файлов включается исключительно для поддержки отладки или обеспечения технологии IntelliSense в Visual Studio. Некоторые из этих файлов не следует развертывать в промежуточной или рабочей среде. Однако может потребоваться развернуть их в тестовой среде разработчика, чтобы упростить устранение неполадок.

Несмотря на то, что вы можете манипулировать файлами проекта, чтобы исключить определенные файлы и папки, существует более простой способ. Конвейер WPP включает механизм для исключения файлов и папок путем создания списков элементов с именами **ексклудефромпаккажефолдерс** и **ексклудефромпаккажефилес**. Этот механизм можно расширить, добавив в эти списки собственные элементы. Для этого необходимо выполнить следующие общие действия.

1. Создайте пользовательский файл проекта с именем *[Project name]. wpp. targets* в той же папке, что и файл проекта.

    > [!NOTE]
    > Файл *. wpp. targets* должен находиться в той же папке, что и файл&#x2014;проекта веб-приложения, например *ContactManager. MVC. csproj*&#x2014;, а не в той же папке, что и все пользовательские файлы проекта, используемые для управления процессом сборки и развертывания.
2. В файле *. wpp. targets* добавьте элемент **ItemGroup** .
3. В элементе **ItemGroup** добавьте элементы **ексклудефромпаккажефолдерс** и **ексклудефромпаккажефилес** , чтобы исключить определенные файлы и папки по мере необходимости.

Это базовая структура этого файла *. wpp. targets* :

[!code-xml[Main](excluding-files-and-folders-from-deployment/samples/sample1.xml)]

Обратите внимание, что каждый элемент включает элемент метаданных элемента с именем **фромтаржет**. Это необязательное значение, которое не влияет на процесс сборки. Он просто указывает, почему определенные файлы или папки были пропущены, если кто-то просматривает журналы сборки.

## <a name="excluding-files-and-folders-from-a-web-package"></a>Исключение файлов и папок из веб-пакета

В следующей процедуре показано, как добавить файл *WPP. targets* в проект веб-приложения и как использовать файл для исключения конкретных файлов и папок из веб-пакета при сборке проекта.

**Исключение файлов и папок из пакета веб-развертывания**

1. Откройте решение в Visual Studio 2010.
2. В окне **Обозреватель решений** щелкните правой кнопкой мыши узел проекта веб-приложения (например, **ContactManager. MVC**), наведите указатель на пункт **добавить**и выберите пункт **новый элемент**.
3. В диалоговом окне **Добавление нового элемента** выберите шаблон **XML-файл** .
4. В поле **имя** введите *[имя проекта] * *. wpp. targets** (например, **ContactManager. MVC. wpp. targets**) и нажмите кнопку **Добавить**.

    ![](excluding-files-and-folders-from-deployment/_static/image3.png)

    > [!NOTE]
    > При добавлении нового элемента в корневой узел проекта файл создается в той же папке, что и файл проекта. Это можно проверить, открыв папку в проводнике Windows.
5. В файле добавьте элемент **проекта** и элемент **ItemGroup** :

    [!code-xml[Main](excluding-files-and-folders-from-deployment/samples/sample2.xml)]
6. Если вы хотите исключить папки из веб-пакета, добавьте элемент **ексклудефромпаккажефолдерс** в элемент **ItemGroup** :

   1. В атрибуте **include** Укажите разделенный точками с запятой список папок, которые необходимо исключить.
   2. В элементе метаданных **фромтаржет** укажите значимое значение, чтобы указать, почему папки исключаются, например имя файла *WPP. targets* .

      [!code-xml[Main](excluding-files-and-folders-from-deployment/samples/sample3.xml)]
7. Если вы хотите исключить файлы из веб-пакета, добавьте элемент **ексклудефромпаккажефилес** в элемент **ItemGroup** :

   1. В атрибуте **include** Укажите разделенный точками с запятой список файлов, которые необходимо исключить.
   2. В элементе метаданных **фромтаржет** укажите значимое значение, чтобы указать, почему файлы исключаются, например имя файла *WPP. targets* .

      [!code-xml[Main](excluding-files-and-folders-from-deployment/samples/sample4.xml)]
8. Теперь файл *[имя проекта]. wpp. targets* должен выглядеть следующим образом:

    [!code-xml[Main](excluding-files-and-folders-from-deployment/samples/sample5.xml)]
9. Сохраните и закройте файл *[имя проекта]. wpp. targets* .

В следующий раз при сборке и упаковке проекта веб-приложения в конвейере WPP автоматически обнаруживается файл с расширением *WPP. targets* . Все указанные файлы и папки не будут включаться в веб-пакет.

## <a name="conclusion"></a>Заключение

В этом разделе описано, как исключить определенные файлы и папки при создании веб-пакета, создав пользовательский файл *. wpp. targets* в той же папке, что и файл проекта веб-приложения.

## <a name="further-reading"></a>Дополнительные материалы

Дополнительные сведения об использовании пользовательских файлов проекта Microsoft Build Engine (MSBuild) для управления процессом развертывания см. в разделе [Основные сведения о файле проекта](../web-deployment-in-the-enterprise/understanding-the-project-file.md) и [понимании процесса сборки](../web-deployment-in-the-enterprise/understanding-the-build-process.md). Дополнительные сведения о процессе упаковки и развертывания см. в статьях [Создание и упаковка проектов веб-приложений](../web-deployment-in-the-enterprise/building-and-packaging-web-application-projects.md), [Настройка параметров для развертывания веб-пакетов](../web-deployment-in-the-enterprise/configuring-parameters-for-web-package-deployment.md)и [Развертывание веб-пакетов](../web-deployment-in-the-enterprise/deploying-web-packages.md).

> [!div class="step-by-step"]
> [Назад](deploying-membership-databases-to-enterprise-environments.md)
> [Вперед](taking-web-applications-offline-with-web-deploy.md)
