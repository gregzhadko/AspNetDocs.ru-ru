---
uid: web-forms/overview/deployment/advanced-enterprise-web-deployment/troubleshooting-the-packaging-process
title: Устранение неполадок процесса упаковки | Документация Майкрософт
author: jrjlee
description: В этом разделе описывается, как можно получить подробные сведения о процессе упаковки с помощью свойства Енаблепаккажепроцесслоггингандассерт в M...
ms.author: riande
ms.date: 05/04/2012
ms.assetid: 794bd819-00fc-47e2-876d-fc5d15e0de1c
msc.legacyurl: /web-forms/overview/deployment/advanced-enterprise-web-deployment/troubleshooting-the-packaging-process
msc.type: authoredcontent
ms.openlocfilehash: 8ad649dfff085a8774cc13c11d8a3e3d48277d66
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78509754"
---
# <a name="troubleshooting-the-packaging-process"></a><span data-ttu-id="5d0f7-103">Устранение неполадок в процессе упаковки</span><span class="sxs-lookup"><span data-stu-id="5d0f7-103">Troubleshooting the Packaging Process</span></span>

<span data-ttu-id="5d0f7-104">кто [Джейсон Иванов](https://github.com/jrjlee)</span><span class="sxs-lookup"><span data-stu-id="5d0f7-104">by [Jason Lee](https://github.com/jrjlee)</span></span>

[<span data-ttu-id="5d0f7-105">Скачать в формате PDF</span><span class="sxs-lookup"><span data-stu-id="5d0f7-105">Download PDF</span></span>](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> <span data-ttu-id="5d0f7-106">В этом разделе описывается, как можно собираются подробные сведения о процессе упаковки с помощью свойства **енаблепаккажепроцесслоггингандассерт** в Microsoft Build Engine (MSBuild).</span><span class="sxs-lookup"><span data-stu-id="5d0f7-106">This topic describes how you can collect detailed information about the packaging process by using the **EnablePackageProcessLoggingAndAssert** property in the Microsoft Build Engine (MSBuild).</span></span>
> 
> <span data-ttu-id="5d0f7-107">Если для свойства **енаблепаккажепроцесслоггингандассерт** задано **значение true**, MSBuild будет выполнять следующие действия:</span><span class="sxs-lookup"><span data-stu-id="5d0f7-107">When you set the **EnablePackageProcessLoggingAndAssert** property to **true**, MSBuild will:</span></span>
> 
> - <span data-ttu-id="5d0f7-108">Добавьте дополнительные сведения о процессе упаковки в журналы сборки.</span><span class="sxs-lookup"><span data-stu-id="5d0f7-108">Add additional information about the packaging process to the build logs.</span></span>
> - <span data-ttu-id="5d0f7-109">Регистрация ошибок при определенных условиях, например, если в списке упаковки найдены дублирующиеся файлы.</span><span class="sxs-lookup"><span data-stu-id="5d0f7-109">Log errors under certain conditions, for example, if duplicate files are found in the packaging list.</span></span>
> - <span data-ttu-id="5d0f7-110">Создайте каталог журнала в папке пакета *имяпроекта*\_и используйте его для записи сведений о файлах, которые вы собираетесь упаковать.</span><span class="sxs-lookup"><span data-stu-id="5d0f7-110">Create a Log directory in the *ProjectName*\_Package folder and use it to record information about the files you're packaging.</span></span>
> 
> <span data-ttu-id="5d0f7-111">Если в процессе упаковки произошел сбой или пакеты веб-развертывания не содержат нужных файлов, эти сведения можно использовать для устранения неполадок, а также определить, где происходит проблема.</span><span class="sxs-lookup"><span data-stu-id="5d0f7-111">If the packaging process is failing, or your web deployment packages don't contain the files that you expect, you can use this information to troubleshoot the process and pinpoint where things are going wrong.</span></span>
> 
> > [!NOTE]
> > <span data-ttu-id="5d0f7-112">Свойство **енаблепаккажепроцесслоггингандассерт** работает только при сборке проекта с помощью конфигурации **отладки** .</span><span class="sxs-lookup"><span data-stu-id="5d0f7-112">The **EnablePackageProcessLoggingAndAssert** property only works if you build your project using the **Debug** configuration.</span></span> <span data-ttu-id="5d0f7-113">Свойство не учитывается в других конфигурациях.</span><span class="sxs-lookup"><span data-stu-id="5d0f7-113">The property is ignored in other configurations.</span></span>

<span data-ttu-id="5d0f7-114">Этот раздел является частью серии руководств, основанных на требованиях Enterprise к развертыванию вымышленной компании Fabrikam, Inc. В этой серии руководств используется пример решения&#x2014; [диспетчера контактов](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;для представления веб-приложения с реалистичным уровнем сложности, включая приложение ASP.NET MVC 3, службу Windows Communication Foundation (WCF) и проект базы данных.</span><span class="sxs-lookup"><span data-stu-id="5d0f7-114">This topic forms part of a series of tutorials based around the enterprise deployment requirements of a fictional company named Fabrikam, Inc. This tutorial series uses a sample solution&#x2014;the [Contact Manager solution](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;to represent a web application with a realistic level of complexity, including an ASP.NET MVC 3 application, a Windows Communication Foundation (WCF) service, and a database project.</span></span>

<span data-ttu-id="5d0f7-115">Метод развертывания в сердце этих учебников основан на подходе к файлам проекта Split, описанному в разделе [понимание файла проекта](../web-deployment-in-the-enterprise/understanding-the-project-file.md), в котором процесс сборки управляется двумя файлами&#x2014;проекта, содержащими инструкции по сборке, которые применяются к каждой целевой среде, и одна содержит параметры сборки и развертывания, относящиеся к конкретной среде.</span><span class="sxs-lookup"><span data-stu-id="5d0f7-115">The deployment method at the heart of these tutorials is based on the split project file approach described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md), in which the build process is controlled by two project files&#x2014;one containing build instructions that apply to every destination environment, and one containing environment-specific build and deployment settings.</span></span> <span data-ttu-id="5d0f7-116">Во время сборки файл проекта, зависящий от среды, объединяется в файл проекта независимо от среды, чтобы сформировать полный набор инструкций по сборке.</span><span class="sxs-lookup"><span data-stu-id="5d0f7-116">At build time, the environment-specific project file is merged into the environment-agnostic project file to form a complete set of build instructions.</span></span>

## <a name="understanding-the-enablepackageprocessloggingandassert-property"></a><span data-ttu-id="5d0f7-117">Основные сведения о свойстве Енаблепаккажепроцесслоггингандассерт</span><span class="sxs-lookup"><span data-stu-id="5d0f7-117">Understanding the EnablePackageProcessLoggingAndAssert Property</span></span>

<span data-ttu-id="5d0f7-118">[Сборка и упаковка проектов веб-приложений](../web-deployment-in-the-enterprise/building-and-packaging-web-application-projects.md) описывает, как конвейер веб-публикаций (WPP) предоставляет набор целевых объектов MSBuild, расширяющих функциональные возможности MSBuild и позволяющий его интегрировать с помощью средства веб-развертывания службы IIS (IIS) (веб-развертывание).</span><span class="sxs-lookup"><span data-stu-id="5d0f7-118">[Building and Packaging Web Application Projects](../web-deployment-in-the-enterprise/building-and-packaging-web-application-projects.md) described how the Web Publishing Pipeline (WPP) provides a set of MSBuild targets that extend the functionality of MSBuild and enable it to integrate with the Internet Information Services (IIS) Web Deployment Tool (Web Deploy).</span></span> <span data-ttu-id="5d0f7-119">При упаковке проекта веб-приложения вы вызываете цели WPP.</span><span class="sxs-lookup"><span data-stu-id="5d0f7-119">When you package a web application project, you're invoking WPP targets.</span></span>

<span data-ttu-id="5d0f7-120">Многие из этих целевых объектов WPP включают условную логику, которая регистрирует дополнительные сведения, если свойство **енаблепаккажепроцесслоггингандассерт** имеет значение **true**.</span><span class="sxs-lookup"><span data-stu-id="5d0f7-120">Lots of these WPP targets include conditional logic that logs additional information when the **EnablePackageProcessLoggingAndAssert** property is set to **true**.</span></span> <span data-ttu-id="5d0f7-121">Например, если просмотреть целевой объект **пакета** , можно увидеть, что он создает дополнительный каталог журналов и записывает список файлов в текстовый файл, если **енаблепаккажепроцесслоггингандассерт** равен **true**.</span><span class="sxs-lookup"><span data-stu-id="5d0f7-121">For example, if you review the **Package** target, you can see that it creates an additional log directory and writes a list of files to a text file if **EnablePackageProcessLoggingAndAssert** is equal to **true**.</span></span>

[!code-xml[Main](troubleshooting-the-packaging-process/samples/sample1.xml)]

> [!NOTE]
> <span data-ttu-id="5d0f7-122">Цели WPP определены в файле *Microsoft. Web. Publishing. targets* в папке% ProgramFiles (x86)% \ MSBuild\Microsoft\VisualStudio\v10.0\Web.</span><span class="sxs-lookup"><span data-stu-id="5d0f7-122">The WPP targets are defined in the *Microsoft.Web.Publishing.targets* file in the %PROGRAMFILES(x86)%\MSBuild\Microsoft\VisualStudio\v10.0\Web folder.</span></span> <span data-ttu-id="5d0f7-123">Вы можете открыть этот файл и проверить целевые объекты в Visual Studio 2010 или любом редакторе XML.</span><span class="sxs-lookup"><span data-stu-id="5d0f7-123">You can open this file and review the targets in Visual Studio 2010 or any XML editor.</span></span> <span data-ttu-id="5d0f7-124">Следите за тем, чтобы не изменять содержимое файла.</span><span class="sxs-lookup"><span data-stu-id="5d0f7-124">Take care not to modify the contents of the file.</span></span>

## <a name="enabling-the-additional-logging"></a><span data-ttu-id="5d0f7-125">Включение дополнительного ведения журнала</span><span class="sxs-lookup"><span data-stu-id="5d0f7-125">Enabling the Additional Logging</span></span>

<span data-ttu-id="5d0f7-126">Значение для свойства **енаблепаккажепроцесслоггингандассерт** можно указать различными способами в зависимости от способа построения проекта.</span><span class="sxs-lookup"><span data-stu-id="5d0f7-126">You can supply a value for the **EnablePackageProcessLoggingAndAssert** property in various ways, depending on how you build your project.</span></span>

<span data-ttu-id="5d0f7-127">При построении проекта из командной строки можно указать значение свойства **енаблепаккажепроцесслоггингандассерт** в качестве аргумента командной строки:</span><span class="sxs-lookup"><span data-stu-id="5d0f7-127">If you build your project from the command line, you can supply a value for the **EnablePackageProcessLoggingAndAssert** property as a command-line argument:</span></span>

[!code-console[Main](troubleshooting-the-packaging-process/samples/sample2.cmd)]

<span data-ttu-id="5d0f7-128">Если вы используете пользовательский файл проекта для построения проектов, можно включить значение **енаблепаккажепроцесслоггингандассерт** в атрибут **Properties** задачи **MSBuild** :</span><span class="sxs-lookup"><span data-stu-id="5d0f7-128">If you're using a custom project file to build your projects, you can include the **EnablePackageProcessLoggingAndAssert** value in the **Properties** attribute of the **MSBuild** task:</span></span>

[!code-xml[Main](troubleshooting-the-packaging-process/samples/sample3.xml)]

<span data-ttu-id="5d0f7-129">Если вы используете определение сборки Team Foundation Server (TFS) для построения проектов, вы можете указать значение для свойства **енаблепаккажепроцесслоггингандассерт** в строке **аргументов MSBuild** :![](troubleshooting-the-packaging-process/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="5d0f7-129">If you're using a Team Foundation Server (TFS) build definition to build your projects, you can supply a value for the **EnablePackageProcessLoggingAndAssert** property in the **MSBuild Arguments** row:![](troubleshooting-the-packaging-process/_static/image1.png)</span></span>

> [!NOTE]
> <span data-ttu-id="5d0f7-130">Дополнительные сведения о создании и настройке определений сборки см. в разделе [Создание определения сборки, поддерживающего развертывание](../configuring-team-foundation-server-for-web-deployment/creating-a-build-definition-that-supports-deployment.md).</span><span class="sxs-lookup"><span data-stu-id="5d0f7-130">For more information on creating and configuring build definitions, see [Creating a Build Definition That Supports Deployment](../configuring-team-foundation-server-for-web-deployment/creating-a-build-definition-that-supports-deployment.md).</span></span>

<span data-ttu-id="5d0f7-131">Кроме того, если необходимо включить пакет в каждую сборку, можно изменить файл проекта для проекта веб-приложения, чтобы установить для свойства **енаблепаккажепроцесслоггингандассерт** значение **true**.</span><span class="sxs-lookup"><span data-stu-id="5d0f7-131">Alternatively, if you want to include the package in every build, you can modify the project file for your web application project to set the **EnablePackageProcessLoggingAndAssert** property to **true**.</span></span> <span data-ttu-id="5d0f7-132">Необходимо добавить свойство к первому элементу **PropertyGroup** в файле. csproj или. vbproj.</span><span class="sxs-lookup"><span data-stu-id="5d0f7-132">You should add the property to the first **PropertyGroup** element within your .csproj or .vbproj file.</span></span>

[!code-xml[Main](troubleshooting-the-packaging-process/samples/sample4.xml)]

## <a name="reviewing-the-log-files"></a><span data-ttu-id="5d0f7-133">Просмотр файлов журнала</span><span class="sxs-lookup"><span data-stu-id="5d0f7-133">Reviewing the Log Files</span></span>

<span data-ttu-id="5d0f7-134">При сборке и упаковке проекта веб-приложения с параметром **енаблепаккажепроцесслоггингандассерт** , для которого задано **значение true**, MSBuild создает дополнительную папку с именем log в папке пакета *имяПроекта*\_.</span><span class="sxs-lookup"><span data-stu-id="5d0f7-134">When you build and package a web application project with **EnablePackageProcessLoggingAndAssert** set to **true**, MSBuild creates an additional folder named Log in the *ProjectName*\_Package folder.</span></span> <span data-ttu-id="5d0f7-135">Папка журнала содержит различные файлы:</span><span class="sxs-lookup"><span data-stu-id="5d0f7-135">The Log folder contains various files:</span></span>

![](troubleshooting-the-packaging-process/_static/image2.png)

<span data-ttu-id="5d0f7-136">Список отображаемых файлов зависит от того, что в проекте и в процессе сборки.</span><span class="sxs-lookup"><span data-stu-id="5d0f7-136">The list of files that you see will vary according to the things in your project and your build process.</span></span> <span data-ttu-id="5d0f7-137">Однако эти файлы обычно используются для записи списка файлов, собираемых в КОНВЕЙЕРе для упаковки, на различных этапах процесса:</span><span class="sxs-lookup"><span data-stu-id="5d0f7-137">However, these files are typically used to record the list of files that the WPP is collecting for packaging, at various stages of the process:</span></span>

- <span data-ttu-id="5d0f7-138">В файле *приксклудепипелинеколлектфилесфасефилелист. txt* перечислены файлы, которые MSBuild собирает для упаковки, прежде чем будут удалены все файлы, указанные для исключения.</span><span class="sxs-lookup"><span data-stu-id="5d0f7-138">The *PreExcludePipelineCollectFilesPhaseFileList.txt* file lists the files that MSBuild collects for packaging before any files that are specified for exclusion are removed.</span></span>
- <span data-ttu-id="5d0f7-139">Файл *афтерексклудефилесфилеслист. txt* содержит измененный список файлов после удаления всех файлов, указанных для исключения.</span><span class="sxs-lookup"><span data-stu-id="5d0f7-139">The *AfterExcludeFilesFilesList.txt* file contains the modified file list after any files that are specified for exclusion are removed.</span></span>

    > [!NOTE]
    > <span data-ttu-id="5d0f7-140">Дополнительные сведения об исключении файлов и папок из процесса упаковки см. в разделе [исключение файлов и папок из развертывания](excluding-files-and-folders-from-deployment.md).</span><span class="sxs-lookup"><span data-stu-id="5d0f7-140">For more information on excluding files and folders from the packaging process, see [Excluding Files and Folders from Deployment](excluding-files-and-folders-from-deployment.md).</span></span>
- <span data-ttu-id="5d0f7-141">Файл *афтертрансформвебконфиг. txt* содержит список файлов, собранных для упаковки после выполнения всех преобразований *Web. config* .</span><span class="sxs-lookup"><span data-stu-id="5d0f7-141">The *AfterTransformWebConfig.txt* file lists the files collected for packaging after any *Web.config* transforms have been performed.</span></span> <span data-ttu-id="5d0f7-142">В этом списке все файлы преобразования *Web. config* для конкретной конфигурации, такие как *Web. Debug. config* и *Web. Release. config*, исключаются из списка файлов для упаковки.</span><span class="sxs-lookup"><span data-stu-id="5d0f7-142">In this list, any configuration-specific *Web.config* transform files, like *Web.Debug.config* and *Web.Release.config*, are excluded from the list of files for packaging.</span></span> <span data-ttu-id="5d0f7-143">В свое место включается один преобразованный *файл Web. config* .</span><span class="sxs-lookup"><span data-stu-id="5d0f7-143">A single transformed *Web.config* is included in their place.</span></span>
- <span data-ttu-id="5d0f7-144">Файл *постаутопараметеризатионвебконфигконнектионстрингс. txt* содержит список файлов после параметризации строк подключения в файле *Web. config* .</span><span class="sxs-lookup"><span data-stu-id="5d0f7-144">The *PostAutoParameterizationWebConfigConnectionStrings.txt* file contains the list of files after the connection strings in the *Web.config* file have been parameterized.</span></span> <span data-ttu-id="5d0f7-145">Это процесс, который позволяет заменить строки подключения правильными параметрами целевой среды при развертывании пакета.</span><span class="sxs-lookup"><span data-stu-id="5d0f7-145">This is the process that lets you replace your connection strings with the right settings for your target environment when you deploy the package.</span></span>
- <span data-ttu-id="5d0f7-146">Файл предварительной версии *. txt* содержит окончательный список файлов, предваряющих сборку, которые будут включены в пакет.</span><span class="sxs-lookup"><span data-stu-id="5d0f7-146">The *Prepackage.txt* file contains the finalized pre-build list of files to be included in the package.</span></span>

> [!NOTE]
> <span data-ttu-id="5d0f7-147">Имена дополнительных файлов журналов обычно соответствуют целевым объектам WPP.</span><span class="sxs-lookup"><span data-stu-id="5d0f7-147">The names of the additional log files typically correspond to WPP targets.</span></span> <span data-ttu-id="5d0f7-148">Эти целевые объекты можно проверить, изучив файл *Microsoft. Web. Publishing. targets* в папке% ProgramFiles (x86)% \ MSBuild\Microsoft\VisualStudio\v10.0\Web.</span><span class="sxs-lookup"><span data-stu-id="5d0f7-148">You can review these targets by examining the *Microsoft.Web.Publishing.targets* file in the %PROGRAMFILES(x86)%\MSBuild\Microsoft\VisualStudio\v10.0\Web folder.</span></span>

<span data-ttu-id="5d0f7-149">Если содержимое веб-пакета не соответствует ожидаемому, просмотр этих файлов может оказаться полезным способом определить, в какой точке процесса произошла ошибка.</span><span class="sxs-lookup"><span data-stu-id="5d0f7-149">If the contents of your web package aren't what you expected, reviewing these files can be a useful way to identify at what point in the process things went wrong.</span></span>

## <a name="conclusion"></a><span data-ttu-id="5d0f7-150">Заключение</span><span class="sxs-lookup"><span data-stu-id="5d0f7-150">Conclusion</span></span>

<span data-ttu-id="5d0f7-151">В этом разделе описано, как можно использовать свойство **енаблепаккажепроцесслоггингандассерт** в MSBuild для устранения неполадок в процессе упаковки.</span><span class="sxs-lookup"><span data-stu-id="5d0f7-151">This topic described how you can use the **EnablePackageProcessLoggingAndAssert** property in MSBuild to troubleshoot the packaging process.</span></span> <span data-ttu-id="5d0f7-152">В нем объясняются различные способы предоставления значения свойства процессу сборки и описаны дополнительные сведения, которые записываются при установке свойства в **значение true**.</span><span class="sxs-lookup"><span data-stu-id="5d0f7-152">It explained the different ways in which you can supply the property value to the build process, and it described the additional information that is recorded when you set the property to **true**.</span></span>

## <a name="further-reading"></a><span data-ttu-id="5d0f7-153">Дополнительные материалы</span><span class="sxs-lookup"><span data-stu-id="5d0f7-153">Further Reading</span></span>

<span data-ttu-id="5d0f7-154">Дополнительные сведения об использовании пользовательских файлов проекта MSBuild для управления процессом развертывания см. в разделе [Основные сведения о файле проекта](../web-deployment-in-the-enterprise/understanding-the-project-file.md) и [понимании процесса сборки](../web-deployment-in-the-enterprise/understanding-the-build-process.md).</span><span class="sxs-lookup"><span data-stu-id="5d0f7-154">For more information on using custom MSBuild project files to control the deployment process, see [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md) and [Understanding the Build Process](../web-deployment-in-the-enterprise/understanding-the-build-process.md).</span></span> <span data-ttu-id="5d0f7-155">Дополнительные сведения о конвейере WPP и управлении процессом упаковки см. в разделе [Создание и упаковка проектов веб-приложений](../web-deployment-in-the-enterprise/building-and-packaging-web-application-projects.md).</span><span class="sxs-lookup"><span data-stu-id="5d0f7-155">For more information on the WPP and how it manages the packaging process, see [Building and Packaging Web Application Projects](../web-deployment-in-the-enterprise/building-and-packaging-web-application-projects.md).</span></span> <span data-ttu-id="5d0f7-156">Инструкции по исключению конкретных файлов и папок из пакетов веб-развертывания см. в разделе [исключение файлов и папок из развертывания](excluding-files-and-folders-from-deployment.md).</span><span class="sxs-lookup"><span data-stu-id="5d0f7-156">For guidance on how to exclude specific files and folders from web deployment packages, see [Excluding Files and Folders from Deployment](excluding-files-and-folders-from-deployment.md).</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="5d0f7-157">Назад</span><span class="sxs-lookup"><span data-stu-id="5d0f7-157">Previous</span></span>](running-windows-powershell-scripts-from-msbuild-project-files.md)
