---
uid: web-forms/overview/deployment/advanced-enterprise-web-deployment/performing-a-what-if-deployment
title: What резервных, если развертывание | Документация Майкрософт
author: jrjlee
description: В этом разделе описывается выполнение «что если» (или simulated) развертываний с помощью средства веб-развертывания (Web Deploy) Internet Information Services (IIS) и V...
ms.author: riande
ms.date: 05/04/2012
ms.assetid: c711b453-01ac-4e65-a48c-93d99bf22e58
msc.legacyurl: /web-forms/overview/deployment/advanced-enterprise-web-deployment/performing-a-what-if-deployment
msc.type: authoredcontent
ms.openlocfilehash: a222aa6bf52ee72e6a0f4ac5503b4b4f78d294fb
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/09/2019
ms.locfileid: "59414326"
---
# <a name="performing-a-what-if-deployment"></a>Выполнение имитации развертывания

по [Джейсон Lee](https://github.com/jrjlee)

[Скачать PDF](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> В этом разделе описывается выполнение «что если» (или simulated) развертываний с помощью средства веб-развертывания (Web Deploy) Internet Information Services (IIS) и средство VSDBCMD. Это позволяет определить последствия логики развертывания в конкретной целевой среде до фактического развертывания приложения.


Этот раздел является частью серии учебников, исходя из требования к развертыванию enterprise вымышленной компании Fabrikam, Inc. В этой серии руководств используется пример решения&#x2014; [решения диспетчера контактов](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;для представления веб-приложения с более реалистичные уровень сложности, включая приложения ASP.NET MVC 3, Windows Communication Служба Foundation (WCF) и проект базы данных.

Метод развертывания в основе этих учебников основан на разбиение проекта файл подход, описанный в [основные сведения о файле проекта](../web-deployment-in-the-enterprise/understanding-the-project-file.md), в которой процесс построения и развертывания управляется двумя файлы проекта&#x2014;один содержащая инструкции сборки, которые применяются к каждой целевой среде и содержащего параметры построения и развертывания для конкретной среды. Во время сборки файл проекта для конкретной среды объединяется в файл проекта независимой от среды, чтобы полный набор инструкций построения.

## <a name="performing-a-what-if-deployment-for-web-packages"></a>Выполнение развертывания «What If» для веб-пакетов

Веб-развертывание включает в себя функции, которая позволяет выполнять развертывание в «что если» (или пробная версия) режиме. При развертывании артефактов в режиме «что если», веб-развертывания создает файл журнала, как если бы вы выполнили развертывание, но она ничего не меняет фактически на целевом сервере. Просмотрев файл журнала может помочь понять, как повлияет развертывания на конечном сервере, в частности:

- Будут добавляться новые.
- Что будет обновляться.
- Что будут удалены.

Так как развертывания «what if» ничего не меняет, фактически на конечном сервере, что он не всегда можно сделать прогноз ли развертывание успешно завершится.

Как описано в разделе [развертывание веб-пакеты](../web-deployment-in-the-enterprise/deploying-web-packages.md), можно развернуть веб-пакетов с помощью веб-развертывания в двух случаях&#x2014;с помощью программы командной строки MSDeploy.exe, напрямую или путем запуска *. deploy.cmd* файла что процесс построения создает.

Если вы используете MSDeploy.exe напрямую, можно выполнить развертывание «what if» путем добавления **whatif** флаг в команду. Например чтобы оценить, что произойдет, если пакет был развернут в ContactManager.Mvc.zip в промежуточной среде, MSDeploy команда должна выглядеть следующим образом:


[!code-console[Main](performing-a-what-if-deployment/samples/sample1.cmd)]


Когда вы будете удовлетворены результатами развертывания «what if», можно удалить **whatif** флаг выполнения динамической развертывания.

> [!NOTE]
> Дополнительные сведения о параметрах командной строки для MSDeploy.exe, см. в разделе [веб-развертывание параметров операции](https://technet.microsoft.com/library/dd569089(WS.10).aspx).


Если вы используете *. deploy.cmd* файл, вы можете запустить развертывания «what if», включая **/t** флаг флаг (режиме пробной версии), а не **/y** флаг («Да» или режим обновления) в команда. Например, чтобы оценить, что произойдет, если пакет был развернут в ContactManager.Mvc.zip, выполнив *. deploy.cmd* файл, команда должна выглядеть примерно следующим образом:


[!code-console[Main](performing-a-what-if-deployment/samples/sample2.cmd)]


Когда вы будете удовлетворены результатами развертывания «в режиме пробной версии», вы можете заменить **/t** флаг с **/y** флаг выполнения динамической развертывания:


[!code-console[Main](performing-a-what-if-deployment/samples/sample3.cmd)]


> [!NOTE]
> Дополнительные сведения о параметрах командной строки для *. deploy.cmd* файлы, см. в разделе [как: Установка пакета развертывания с помощью файла deploy.cmd](https://msdn.microsoft.com/library/ff356104.aspx). При запуске *. deploy.cmd* файл без указания всех флагов, в командной строке отображается список доступных флагов.


## <a name="performing-a-what-if-deployment-for-databases"></a>Выполнение развертывания «What If» для баз данных

В этом разделе предполагается, что вы используете служебную программу VSDBCMD для выполнения развертывания добавочный, на основе схемы базы данных. Этот подход описан более подробно в [развертывание проектов баз данных](../web-deployment-in-the-enterprise/deploying-database-projects.md). Мы рекомендуем ознакомиться с этим разделом, прежде чем применять описанные здесь принципы.

При использовании VSDBCMD в **развернуть** режиме, можно использовать **/dd** (или **/DeployToDatabase**) флаг, определяющий ли средство VSDBCMD фактически развертывает базы данных или просто приводит к возникновению ошибки скрипт развертывания. Если вы развертываете DBSCHEMA-файл, это поведение:

- Если указать **/dd+** или **/dd**, средство VSDBCMD создаст скрипт развертывания и развертывание базы данных.
- Если указать **/dd-** или ключ пропущен, средство VSDBCMD создаст только сценарий развертывания.

> [!NOTE]
> Если вы развертываете DEPLOYMANIFEST-файл, а не DBSCHEMA-файл, поведение **/dd** коммутатора гораздо более сложен. По сути, средство VSDBCMD будет игнорировать значение **/dd** переключение, если DEPLOYMANIFEST-файл включает в себя **DeployToDatabase** элемент со значением **True**. [Развертывание проектов базы данных](../web-deployment-in-the-enterprise/deploying-database-projects.md) описывает это поведение в полном объеме.


Например, чтобы создать скрипт развертывания для **ContactManager** базы данных без фактического развертывания базы данных, средство VSDBCMD команда должна выглядеть примерно следующим образом:


[!code-console[Main](performing-a-what-if-deployment/samples/sample4.cmd)]


Средство VSDBCMD это средство развертывания разностную копию базы данных, и таким образом скрипт развертывания создается динамически для хранения всех команд SQL, необходимые для обновления текущей базы данных, если таковой существует, к указанной схеме. Просмотр скрипта развертывания — удобный способ определить, какое влияние развертывания окажет на текущей базы данных и данных, содержащихся в нем. Например можно определить:

- Будут ли удалены все имеющиеся таблицы, и это приведет к потере данных.
- Ли порядок операций несет риск потери данных, например, если вы разбиения или слияния таблиц.

Если вас все устраивает, с помощью сценария развертывания, можно повторить VSDBCMD с **/dd+** флаг для внесения изменений. Кроме того можно изменить скрипт развертывания в соответствии с потребностями и затем выполнить его вручную на сервере базы данных.

## <a name="integrating-what-if-functionality-into-custom-project-files"></a>Интеграция «What If» функциональные возможности в файлах пользовательских проектов

В более сложных сценариев развертывания, появится желание использовать пользовательский файл проекта Microsoft Build Engine (MSBuild) для инкапсуляции логики сборки и развертывания, как описано в разделе [основные сведения о файле проекта](../web-deployment-in-the-enterprise/understanding-the-project-file.md). Например, в [Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) образец решения, *Publish.proj* файла:

- Выполняет сборку решения.
- Использует веб-развертывания для упаковки и развертывания приложения ContactManager.Mvc.
- Использует веб-развертывания для упаковки и развертывания приложения ContactManager.Service.
- Развертывает **ContactManager** базы данных.

При интеграции развертывания нескольких веб-пакетов и/или баз данных в один шаг процесс таким образом, вы также можете выполнять все развертывание в режиме «что если».

*Publish.proj* файл демонстрирует, как это можно сделать. Во-первых вам потребуется создать свойство для хранения значения «what if».


[!code-xml[Main](performing-a-what-if-deployment/samples/sample5.xml)]


В этом случае вы создали свойство с именем **WhatIf** со значением по умолчанию **false**. Пользователи могут переопределить это значение свойства значение **true** в параметре командной строки, как вы вскоре увидите.

Следующий этап заключается в параметризовать любой веб-развертывания и средство VSDBCMD команды, чтобы отразить флаги **WhatIf** значение свойства. Например, следующий целевой объект (из *Publish.proj* файл и упрощенное) выполняется *. deploy.cmd* файла развернуть веб-пакет. По умолчанию, команда включает **/Y** switch («Да» или режим обновления). Если **WhatIf** присваивается **true**, оно заменяется **/T** switch (пробная версия или «что если» режим).


[!code-xml[Main](performing-a-what-if-deployment/samples/sample6.xml)]


Аналогичным образом следующий целевой объект использует служебную программу VSDBCMD развертывание базы данных. По умолчанию **/dd** ключ не включен. Это означает, что VSDBCMD создаст скрипт развертывания, но не выполняет развертывание базы данных&#x2014;другими словами, «что, если» сценарий. Если **WhatIf** не задано значение **true**, **/dd** добавлен переключатель и средство VSDBCMD развертываются в базе данных.


[!code-xml[Main](performing-a-what-if-deployment/samples/sample7.xml)]


Можно использовать тот же подход можно параметризовать все используемые команды в файле проекта. Если вы хотите выполнить развертывание «what if», затем можно просто предоставить **WhatIf** значение свойства из командной строки:


[!code-console[Main](performing-a-what-if-deployment/samples/sample8.cmd)]


Таким образом можно запустить развертывания «what if» для всех компонентов проекта за один шаг.

## <a name="conclusion"></a>Заключение

В этом разделе описано, как запускать «what if» развертывание с помощью Web Deploy, средство VSDBCMD и MSBuild. Развертывание «what if» позволяет оценить влияние предложенное развертывания, прежде чем фактически вносить любые изменения в целевой среде.

## <a name="further-reading"></a>Дополнительные сведения

Дополнительные сведения о синтаксисе командной строки на веб-развертывания, см. в разделе [веб-развертывание параметров операции](https://technet.microsoft.com/library/dd569089(WS.10).aspx). Руководство по параметрам командной строки, при использовании *. deploy.cmd* файл, см. в разделе [как: Установка пакета развертывания с помощью файла deploy.cmd](https://msdn.microsoft.com/library/ff356104.aspx). Рекомендации о синтаксисе командной строки VSDBCMD, см. в разделе [Справочник по командной строки VSDBCMD. EXE (развертывание и импорт схемы)](https://msdn.microsoft.com/library/dd193283.aspx).

> [!div class="step-by-step"]
> [Назад](advanced-enterprise-web-deployment.md)
> [Вперед](customizing-database-deployments-for-multiple-environments.md)
