---
uid: web-forms/overview/deployment/advanced-enterprise-web-deployment/performing-a-what-if-deployment
title: Выполнение What If развертывания | Документация Майкрософт
author: jrjlee
description: В этом разделе описывается выполнение развертываний "что если" (или имитация) с помощью средства веб-развертывания службы IIS (IIS) (веб-развертывание) и V...
ms.author: riande
ms.date: 05/04/2012
ms.assetid: c711b453-01ac-4e65-a48c-93d99bf22e58
msc.legacyurl: /web-forms/overview/deployment/advanced-enterprise-web-deployment/performing-a-what-if-deployment
msc.type: authoredcontent
ms.openlocfilehash: 73a0e038cc0d4ebae0ffc8ed3fd2de4c9dad673c
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78510336"
---
# <a name="performing-a-what-if-deployment"></a>Выполнение имитации развертывания

кто [Джейсон Иванов](https://github.com/jrjlee)

[Скачать в формате PDF](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> В этом разделе описывается выполнение развертываний "что если" (или имитация) с помощью средства веб-развертывания службы IIS (IIS) (веб-развертывание) и инструмента VSDBCMD. Это позволяет определить влияние логики развертывания на конкретную целевую среду перед фактическим развертыванием приложения.

Этот раздел является частью серии руководств, основанных на требованиях Enterprise к развертыванию вымышленной компании Fabrikam, Inc. В этой серии руководств используется пример решения&#x2014; [диспетчера контактов](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;для представления веб-приложения с реалистичным уровнем сложности, включая приложение ASP.NET MVC 3, службу Windows Communication Foundation (WCF) и проект базы данных.

Метод развертывания в сердце этих учебников основан на подходе к файлам проекта Split, описанному в разделе [понимание файла проекта](../web-deployment-in-the-enterprise/understanding-the-project-file.md), в котором процесс сборки и развертывания управляется двумя файлами&#x2014;проекта, содержащими инструкции по сборке, которые применяются к каждой целевой среде, и одна содержит параметры сборки и развертывания, относящиеся к конкретной среде. Во время сборки файл проекта, зависящий от среды, объединяется в файл проекта независимо от среды, чтобы сформировать полный набор инструкций по сборке.

## <a name="performing-a-what-if-deployment-for-web-packages"></a>Выполнение развертывания "What If" для веб-пакетов

Веб-развертывание включает функции, позволяющие выполнять развертывания в режиме "что если" (или в пробной версии). При развертывании артефактов в режиме "что если" веб-развертывание создает файл журнала, как если бы вы выполняли развертывание, но на конечном сервере ничего не меняет. Просмотр файла журнала поможет понять, какое влияние на развертывание будет на целевом сервере, в частности:

- Что будет добавлено.
- Что будет обновлено.
- Что будет удалено.

Поскольку при развертывании "что если" на целевом сервере ничего не меняется, это не всегда позволяет предсказать успешность развертывания.

Как описано в разделе [Развертывание веб-пакетов](../web-deployment-in-the-enterprise/deploying-web-packages.md), можно развертывать веб-пакеты с помощью&#x2014;веб-развертывание двумя способами с помощью служебной программы командной строки msdeploy. exe непосредственно или путем запуска файла *. deploy. cmd* , создаваемого процессом сборки.

Если вы используете MSDeploy. exe напрямую, вы можете выполнить развертывание "что если", добавив к команде флаг **– WhatIf** . Например, чтобы оценить, что произойдет при развертывании пакета ContactManager. MVC. zip в промежуточной среде, команда MSDeploy должна выглядеть следующим образом:

[!code-console[Main](performing-a-what-if-deployment/samples/sample1.cmd)]

Если вы удовлетворены результатами развертывания "что если", можно удалить флаг **– WhatIf** , чтобы запустить динамическое развертывание.

> [!NOTE]
> Дополнительные сведения о параметрах командной строки для MSDeploy. exe см. в разделе [параметры веб-развертывание операции](https://technet.microsoft.com/library/dd569089(WS.10).aspx).

Если вы используете файл *. deploy. cmd* , вы можете выполнить развертывание "что если", включив флаг **/t** (режим пробной версии) вместо флага **/y** ("Да" или "режим обновления") в команде. Например, чтобы оценить, что произойдет, если вы развернули пакет ContactManager. MVC. zip, запустив файл *. deploy. cmd* , команда должна выглядеть примерно так:

[!code-console[Main](performing-a-what-if-deployment/samples/sample2.cmd)]

Когда вы удовлетворены результатами развертывания "пробного режима", вы можете заменить флаг **/t** флагом **/y** для запуска динамического развертывания:

[!code-console[Main](performing-a-what-if-deployment/samples/sample3.cmd)]

> [!NOTE]
> Дополнительные сведения о параметрах командной строки для файлов *. deploy. cmd* см. в разделе [как установить пакет развертывания с помощью файла deploy. cmd](https://msdn.microsoft.com/library/ff356104.aspx). При запуске файла *. deploy. cmd* без указания каких-либо флагов в командной строке отобразится список доступных флагов.

## <a name="performing-a-what-if-deployment-for-databases"></a>Выполнение развертывания "What If" для баз данных

В этом разделе предполагается, что вы используете служебную программу VSDBCMD для выполнения добавочного развертывания базы данных на основе схемы. Этот подход более подробно описан в разделе [развертывание проектов баз данных](../web-deployment-in-the-enterprise/deploying-database-projects.md). Мы рекомендуем ознакомиться с этим разделом перед применением описанных здесь концепций.

При использовании программы VSDBCMD в режиме **развертывания** можно использовать флаг **/DD** (или **/деплойтодатабасе**), чтобы указать, будет ли VSDBCMD фактически развертывать базу данных или просто создавать скрипт развертывания. Если вы развертываете DBSCHEMA-файл, это поведение будет следующим:

- Если указать **/DD +** или **/DD**, VSDBCMD создаст скрипт развертывания и развернет базу данных.
- Если указать **/дд-** или опустить параметр, VSDBCMD создаст только скрипт развертывания.

> [!NOTE]
> Если вы развертываете файл деплойманифест, а не DBSCHEMA-файл, поведение переключателя **/DD** гораздо сложнее. По сути, VSDBCMD будет игнорировать значение параметра **/DD** , если деплойманифест-файл содержит элемент **Деплойтодатабасе** со значением **true**. При [развертывании проектов баз данных](../web-deployment-in-the-enterprise/deploying-database-projects.md) это поведение описывается полностью.

Например, чтобы создать скрипт развертывания для базы данных **ContactManager** без фактического развертывания базы данных, команда VSDBCMD должна выглядеть следующим образом:

[!code-console[Main](performing-a-what-if-deployment/samples/sample4.cmd)]

VSDBCMD — это разностное средство развертывания базы данных, поэтому скрипт развертывания динамически создается для хранения всех команд SQL, необходимых для обновления текущей базы данных, если она существует, в указанную схему. Просмотр скрипта развертывания — это удобный способ определить, какое воздействие на развертывание будет в текущей базе данных и содержащихся в ней данных. Например, может потребоваться определить:

- Будут ли удалены какие бы то ни было существующие таблицы, и будет ли причиной потери данных.
- Является ли порядок операций риском потери данных, например при разбиении или объединении таблиц.

Если вы довольны сценарием развертывания, можно повторить программу VSDBCMD с флагом **/DD +** , чтобы внести изменения. Кроме того, можно изменить скрипт развертывания в соответствии с вашими требованиями, а затем выполнить его вручную на сервере базы данных.

## <a name="integrating-what-if-functionality-into-custom-project-files"></a>Интеграция функций "What If" в пользовательские файлы проекта

В более сложных сценариях развертывания необходимо использовать пользовательский файл проекта Microsoft Build Engine (MSBuild) для инкапсуляции логики построения и развертывания, как описано в разделе [Общие сведения о файле проекта](../web-deployment-in-the-enterprise/understanding-the-project-file.md). Например, в образце решения [диспетчера контактов](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) файл *Publish. proj* :

- Выполняет сборку решения.
- Использует веб-развертывание для упаковки и развертывания приложения ContactManager. MVC.
- Использует веб-развертывание для упаковки и развертывания приложения ContactManager. Service.
- Развертывает базу данных **ContactManager** .

При такой интеграции развертывания нескольких веб-пакетов и (или) баз данных в одношаговый процесс может также потребоваться выполнить развертывание в режиме "что если".

В файле *Publish. proj* показано, как это можно сделать. Сначала необходимо создать свойство для хранения значения "What If":

[!code-xml[Main](performing-a-what-if-deployment/samples/sample5.xml)]

В этом случае вы создали свойство с именем **WhatIf** и значением по умолчанию **false**. Пользователи могут переопределить это значение, задав для свойства значение **true** в параметре командной строки, как можно будет увидеть чуть позже.

Следующим этапом является параметризация всех команд веб-развертывание и VSDBCMD, чтобы Флаги отражали значение свойства **WhatIf** . Например, следующий целевой объект (взятый из файла *Publish. proj* и упрощенный) запускает файл *. deploy. cmd* для развертывания веб-пакета. По умолчанию команда включает параметр **/y** («да» или «режим обновления»). Если параметр **WhatIf** имеет значение **true**, он заменяется параметром **/t** (пробная версия или режим "что если").

[!code-xml[Main](performing-a-what-if-deployment/samples/sample6.xml)]

Аналогично, следующий целевой объект использует служебную программу VSDBCMD для развертывания базы данных. По умолчанию параметр **/DD** не включается. Это означает, что средство VSDBCMD создаст скрипт развертывания, но не будет развертывать&#x2014;базу данных другими словами, сценарий "что если". Если для свойства **WhatIf** не задано значение **true**, то добавляется параметр **/DD** , и VSDBCMD развернет базу данных.

[!code-xml[Main](performing-a-what-if-deployment/samples/sample7.xml)]

Этот же подход можно использовать для параметризации всех соответствующих команд в файле проекта. Если вы хотите выполнить развертывание "что если", можно просто предоставить значение свойства **WhatIf** из командной строки:

[!code-console[Main](performing-a-what-if-deployment/samples/sample8.cmd)]

Таким образом, можно выполнить развертывание "что если" для всех компонентов проекта за один шаг.

## <a name="conclusion"></a>Заключение

В этом разделе описано, как выполнять развертывания "что если" с помощью веб-развертывание, VSDBCMD и MSBuild. Развертывание "что если" позволяет оценить влияние предлагаемого развертывания, прежде чем фактически внести изменения в целевую среду.

## <a name="further-reading"></a>Дополнительные материалы

Дополнительные сведения о синтаксисе командной строки веб-развертывание см. в разделе [параметры веб-развертывание операции](https://technet.microsoft.com/library/dd569089(WS.10).aspx). Рекомендации по использованию параметров командной строки при использовании файла *. deploy. cmd* см. в разделе [как установить пакет развертывания с помощью файла deploy. cmd](https://msdn.microsoft.com/library/ff356104.aspx). Инструкции по синтаксису командной строки для программы VSDBCMD см [. в разделе Справочник по командной строке для программы VSDBCMD. EXE (развертывание и импорт схемы)](https://msdn.microsoft.com/library/dd193283.aspx).

> [!div class="step-by-step"]
> [Назад](advanced-enterprise-web-deployment.md)
> [Вперед](customizing-database-deployments-for-multiple-environments.md)
