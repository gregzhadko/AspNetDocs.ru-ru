---
uid: web-forms/overview/deployment/advanced-enterprise-web-deployment/deploying-membership-databases-to-enterprise-environments
title: Развертывание базы данных членства в корпоративных средах | Документация Майкрософт
author: jrjlee
description: В этом разделе объясняются ключевые соображения и проблем, которые необходимо преодолеть при подготовке базы данных служб приложения ASP.NET (чаще используется...
ms.author: riande
ms.date: 05/04/2012
ms.assetid: 3cf765df-d311-4f68-a295-c9685ceea830
msc.legacyurl: /web-forms/overview/deployment/advanced-enterprise-web-deployment/deploying-membership-databases-to-enterprise-environments
msc.type: authoredcontent
ms.openlocfilehash: eea0761ac85693553808e581a8712c822d19c226
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59390484"
---
# <a name="deploying-membership-databases-to-enterprise-environments"></a><span data-ttu-id="c58f6-103">Развертывание баз данных членства в корпоративных средах</span><span class="sxs-lookup"><span data-stu-id="c58f6-103">Deploying Membership Databases to Enterprise Environments</span></span>

<span data-ttu-id="c58f6-104">по [Джейсон Lee](https://github.com/jrjlee)</span><span class="sxs-lookup"><span data-stu-id="c58f6-104">by [Jason Lee](https://github.com/jrjlee)</span></span>

[<span data-ttu-id="c58f6-105">Загрузить PDF-файл</span><span class="sxs-lookup"><span data-stu-id="c58f6-105">Download PDF</span></span>](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> <span data-ttu-id="c58f6-106">В этом разделе объясняются ключевые соображения и проблем, с которой необходимо преодолеть, когда базы данных (более часто называют баз данных членства) в тестовой, промежуточной или рабочей средах служб подготовки приложения ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="c58f6-106">This topic explains the key considerations and challenges you'll need to overcome when you provision ASP.NET application services databases (more commonly referred to as membership databases) in test, staging, or production environments.</span></span> <span data-ttu-id="c58f6-107">Он также описывает подходы, которые можно использовать для выполнения этих задач.</span><span class="sxs-lookup"><span data-stu-id="c58f6-107">It also describes approaches you can use to meet these challenges.</span></span>


<span data-ttu-id="c58f6-108">Этот раздел является частью серии учебников, исходя из требования к развертыванию enterprise вымышленной компании Fabrikam, Inc. В этой серии руководств используется пример решения&#x2014; [решения диспетчера контактов](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;для представления веб-приложения с более реалистичные уровень сложности, включая приложения ASP.NET MVC 3, Windows Communication Служба Foundation (WCF) и проект базы данных.</span><span class="sxs-lookup"><span data-stu-id="c58f6-108">This topic forms part of a series of tutorials based around the enterprise deployment requirements of a fictional company named Fabrikam, Inc. This tutorial series uses a sample solution&#x2014;the [Contact Manager solution](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;to represent a web application with a realistic level of complexity, including an ASP.NET MVC 3 application, a Windows Communication Foundation (WCF) service, and a database project.</span></span>

<span data-ttu-id="c58f6-109">Метод развертывания в основе этих учебников основан на разбиение проекта файл подход, описанный в [основные сведения о файле проекта](../web-deployment-in-the-enterprise/understanding-the-project-file.md), в которой процесс построения управляется двумя файлы проекта&#x2014;один с Создание инструкции, которые применяются для каждой целевой среде и содержащего параметры построения и развертывания для конкретной среды.</span><span class="sxs-lookup"><span data-stu-id="c58f6-109">The deployment method at the heart of these tutorials is based on the split project file approach described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md), in which the build process is controlled by two project files&#x2014;one containing build instructions that apply to every destination environment, and one containing environment-specific build and deployment settings.</span></span> <span data-ttu-id="c58f6-110">Во время сборки файл проекта для конкретной среды объединяется в файл проекта независимой от среды, чтобы полный набор инструкций построения.</span><span class="sxs-lookup"><span data-stu-id="c58f6-110">At build time, the environment-specific project file is merged into the environment-agnostic project file to form a complete set of build instructions.</span></span>

## <a name="what-are-the-issues-when-you-deploy-a-membership-database"></a><span data-ttu-id="c58f6-111">При развертывании базы данных членства с какими проблемами?</span><span class="sxs-lookup"><span data-stu-id="c58f6-111">What Are the Issues When You Deploy a Membership Database?</span></span>

<span data-ttu-id="c58f6-112">В большинстве случаев разработать стратегию развертывания для базы данных, в первую очередь следует принять во внимание при какие данные вы хотите развернуть.</span><span class="sxs-lookup"><span data-stu-id="c58f6-112">In most cases, when you devise a deployment strategy for a database, the first thing you need to consider is what data you want to deploy.</span></span> <span data-ttu-id="c58f6-113">В среде разработки или тестирования может потребоваться развернуть данных учетной записи пользователя, чтобы упростить тестирование быстро и просто.</span><span class="sxs-lookup"><span data-stu-id="c58f6-113">In a development or test environment, you might want to deploy user account data to facilitate quick and easy testing.</span></span> <span data-ttu-id="c58f6-114">В промежуточной или рабочей среде это очень маловероятно, что нужно для развертывания данных учетной записи пользователя.</span><span class="sxs-lookup"><span data-stu-id="c58f6-114">In a staging or production environment, it's very unlikely that you'd want to deploy user account data.</span></span>

<span data-ttu-id="c58f6-115">К сожалению баз данных членства ASP.NET описываются некоторые проблемы, которые делают это решение гораздо более сложных:</span><span class="sxs-lookup"><span data-stu-id="c58f6-115">Unfortunately, ASP.NET membership databases introduce some specific challenges that make this decision a lot more complex:</span></span>

- <span data-ttu-id="c58f6-116">Только схема развертывания будет оставить базу данных членства в нерабочем состоянии.</span><span class="sxs-lookup"><span data-stu-id="c58f6-116">A schema-only deployment will leave the membership database in a non-operational state.</span></span> <span data-ttu-id="c58f6-117">Дело в базе данных членства включает в себя некоторые данные конфигурации (в **aspnet\_SchemaVersions** таблицы), база данных требует для работы.</span><span class="sxs-lookup"><span data-stu-id="c58f6-117">This is because the membership database includes some configuration data (in the **aspnet\_SchemaVersions** table) that the database requires in order to function.</span></span> <span data-ttu-id="c58f6-118">Таким образом при выполнении развертывания только схемы базы данных членства, чтобы исключить данные учетной записи пользователя, необходимо выполнить сценарий после развертывания для добавления данных настройки.</span><span class="sxs-lookup"><span data-stu-id="c58f6-118">As such, if you perform a schema-only deployment of your membership database in order to exclude user account data, you'll need to run a post-deployment script to add the essential configuration data.</span></span>
- <span data-ttu-id="c58f6-119">В зависимости от настройки вашей базы данных членства поставщик членства может использовать ключ компьютера для шифрования паролей и хранить их в базе данных.</span><span class="sxs-lookup"><span data-stu-id="c58f6-119">Depending on how your membership database is configured, the membership provider may use the machine key to encrypt passwords and store them in the database.</span></span> <span data-ttu-id="c58f6-120">В этом случае данные учетных записей пользователей, развертываемого с базой данных станет непригодным для использования на конечном сервере.</span><span class="sxs-lookup"><span data-stu-id="c58f6-120">In this case, any user account data you deploy with the database will become unusable on the destination server.</span></span> <span data-ttu-id="c58f6-121">По этой причине развернув данные учетной записи пользователя не является поддерживаемым сценарием.</span><span class="sxs-lookup"><span data-stu-id="c58f6-121">For this reason, deploying user account data is not a supported scenario.</span></span>

## <a name="choosing-a-membership-database-strategy"></a><span data-ttu-id="c58f6-122">Выбор стратегии базы данных членства</span><span class="sxs-lookup"><span data-stu-id="c58f6-122">Choosing a Membership Database Strategy</span></span>

<span data-ttu-id="c58f6-123">Используйте эти рекомендации при выборе как подготовить базу данных членства в корпоративной среде сервера.</span><span class="sxs-lookup"><span data-stu-id="c58f6-123">Use these guidelines when you choose how to provision a membership database in an enterprise server environment:</span></span>

- <span data-ttu-id="c58f6-124">По возможности не следует развертывать базы данных членства.</span><span class="sxs-lookup"><span data-stu-id="c58f6-124">Wherever possible, do not deploy membership databases.</span></span> <span data-ttu-id="c58f6-125">Вместо этого создайте базу данных членства вручную на целевом сервере базы данных.</span><span class="sxs-lookup"><span data-stu-id="c58f6-125">Instead, create the membership database manually on the target database server.</span></span> <span data-ttu-id="c58f6-126">Если вы не настроили схему базы данных членства, можно просто создать новый в situ на назначения с помощью [средство регистрации ASP.NET SQL Server (aspnet\_regsql.exe)](https://msdn.microsoft.com/library/ms229862(v=vs.100).aspx).</span><span class="sxs-lookup"><span data-stu-id="c58f6-126">If you haven't customized your membership database schema, you can simply create a new one in situ at the destination using the [ASP.NET SQL Server Registration Tool (aspnet\_regsql.exe)](https://msdn.microsoft.com/library/ms229862(v=vs.100).aspx).</span></span>
- <span data-ttu-id="c58f6-127">Если у вас нет, но чтобы развернуть базу данных членства&#x2014;к примеру, если вы внесли расширенных изменений в схему базы данных&#x2014;следует выполнить развертывание схемой членства в базе данных, чтобы исключить данные учетной записи пользователя, а затем Запустите сценарий после развертывания, чтобы добавить все необходимые данные конфигурации.</span><span class="sxs-lookup"><span data-stu-id="c58f6-127">If you have no option but to deploy a membership database&#x2014;for example, if you've made extensive modifications to the database schema&#x2014;you should perform a schema-only deployment of the membership database, to exclude user account data, and then run a post-deployment script to add any required configuration data.</span></span> <span data-ttu-id="c58f6-128">Общие рекомендации можно найти на этих способов [как: Развертывание базы данных членства ASP.NET без включения учетных записей пользователей](https://msdn.microsoft.com/library/ff361972(v=vs.100).aspx).</span><span class="sxs-lookup"><span data-stu-id="c58f6-128">You can find broad guidance on these approaches in [How to: Deploy the ASP.NET Membership Database Without Including User Accounts](https://msdn.microsoft.com/library/ff361972(v=vs.100).aspx).</span></span>

<span data-ttu-id="c58f6-129">Важно помнить, что *схему базы данных членства, вероятнее всего будут довольно статическими*.</span><span class="sxs-lookup"><span data-stu-id="c58f6-129">It's important to remember that *the schema of your membership database is likely to be fairly static*.</span></span> <span data-ttu-id="c58f6-130">Даже если вы настроили в базу данных членства, маловероятно, что вам потребуется обновить схему на регулярной основе&#x2014;он не будет изменяться с такой же частотой, что и код на веб-приложение или проект базы данных.</span><span class="sxs-lookup"><span data-stu-id="c58f6-130">Even if you've customized the membership database, it's unlikely that you'll need to update the schema on a regular basis&#x2014;it's not going to change with the same frequency as the code in a web application or a database project.</span></span> <span data-ttu-id="c58f6-131">Таким образом не требуется включать базы данных членства в отношении любого процесса автоматической или один шаг развертывания.</span><span class="sxs-lookup"><span data-stu-id="c58f6-131">As such, you shouldn't need to include the membership database in any automated or single-step deployment processes.</span></span>

## <a name="using-vsdbcmd-to-update-a-membership-database-schema"></a><span data-ttu-id="c58f6-132">Обновление схемы базы данных членства с помощью VSDBCMD</span><span class="sxs-lookup"><span data-stu-id="c58f6-132">Using VSDBCMD to Update a Membership Database Schema</span></span>

<span data-ttu-id="c58f6-133">Если вы изменяете структуру базы данных членства после первого развертывания, можно не использовать средство Internet Information Services (IIS) веб-развертывания (веб-развертывание) для повторного развертывания базы данных.</span><span class="sxs-lookup"><span data-stu-id="c58f6-133">If you modify the structure of your membership database after your first deployment, you may not want to use the Internet Information Services (IIS) Web Deployment Tool (Web Deploy) to redeploy the database.</span></span> <span data-ttu-id="c58f6-134">Функциональные возможности развертывания базы данных в веб-развертывания не включает возможность сделать разностные обновления в целевую базу данных&#x2014;вместо этого веб-развертывания необходимо удалить и повторно создать базу данных.</span><span class="sxs-lookup"><span data-stu-id="c58f6-134">The database deployment functionality in Web Deploy doesn't include the capability to make differential updates to a destination database&#x2014;instead, Web Deploy must drop and re-create the database.</span></span> <span data-ttu-id="c58f6-135">Это означает, что вы потеряете все существующие данные учетной записи пользователя, обычно нежелательно в промежуточной или рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="c58f6-135">This means that you lose any existing user account data, which is typically undesirable in staging or production environments.</span></span>

<span data-ttu-id="c58f6-136">Альтернативой является использование служебной программы VSDBCMD для обновления схемы целевой базы данных.</span><span class="sxs-lookup"><span data-stu-id="c58f6-136">The alternative is to use the VSDBCMD utility to update the schema of your destination database.</span></span> <span data-ttu-id="c58f6-137">Средство VSDBCMD включает в себя две важные возможности.</span><span class="sxs-lookup"><span data-stu-id="c58f6-137">VSDBCMD includes two important capabilities.</span></span> <span data-ttu-id="c58f6-138">Во-первых его можно импортировать схему существующей базы данных в DBSCHEMA-файл.</span><span class="sxs-lookup"><span data-stu-id="c58f6-138">First, it can import the schema of an existing database into a .dbschema file.</span></span> <span data-ttu-id="c58f6-139">Во-вторых его можно развернуть DBSCHEMA-файл для существующей базы данных как разностные обновления, это означает, что вносятся только изменения, необходимые для приведения целевой базы данных в актуальном состоянии, и вы не потеряете данные.</span><span class="sxs-lookup"><span data-stu-id="c58f6-139">Second, it can deploy a .dbschema file to an existing database as a differential update, which means that it only makes the changes required to bring the target database up to date and you don't lose any data.</span></span>

<span data-ttu-id="c58f6-140">Чтобы обновить схему базы данных членства можно использовать следующие общие действия:</span><span class="sxs-lookup"><span data-stu-id="c58f6-140">You can use these high-level steps to update a membership database schema:</span></span>

1. <span data-ttu-id="c58f6-141">Используйте средство VSDBCMD **импорта** действие для создания DBSCHEMA-файл для исходной базы данных членства.</span><span class="sxs-lookup"><span data-stu-id="c58f6-141">Use the VSDBCMD **Import** action to generate a .dbschema file for your source membership database.</span></span> <span data-ttu-id="c58f6-142">Эта процедура описана в [как: Импорт схемы из командной строки](https://msdn.microsoft.com/library/dd172135.aspx).</span><span class="sxs-lookup"><span data-stu-id="c58f6-142">This procedure is described in [How to: Import a Schema from a Command Prompt](https://msdn.microsoft.com/library/dd172135.aspx).</span></span>
2. <span data-ttu-id="c58f6-143">Используйте средство VSDBCMD **развернуть** действия для развертывания DBSCHEMA-файл на целевой базы данных членства.</span><span class="sxs-lookup"><span data-stu-id="c58f6-143">Use the VSDBCMD **Deploy** action to deploy the .dbschema file to your destination membership database.</span></span> <span data-ttu-id="c58f6-144">Эта процедура описана в [Справочник по командной строки VSDBCMD. EXE (развертывание и импорт схемы)](https://msdn.microsoft.com/library/dd193283.aspx).</span><span class="sxs-lookup"><span data-stu-id="c58f6-144">This procedure is described in [Command-Line Reference for VSDBCMD.EXE (Deployment and Schema Import)](https://msdn.microsoft.com/library/dd193283.aspx).</span></span>

## <a name="conclusion"></a><span data-ttu-id="c58f6-145">Заключение</span><span class="sxs-lookup"><span data-stu-id="c58f6-145">Conclusion</span></span>

<span data-ttu-id="c58f6-146">В этом разделе описываются некоторые проблемы, которые могут возникнуть, если вам нужно подготовить базы данных членства ASP.NET в различных целевых средах.</span><span class="sxs-lookup"><span data-stu-id="c58f6-146">This topic described some of the challenges you may face when you need to provision ASP.NET membership databases in various target environments.</span></span> <span data-ttu-id="c58f6-147">В частности это объяснить, почему схемой развертывания будет оставить базу данных членства в нерабочем состоянии и почему развертывание данных учетной записи пользователя не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="c58f6-147">In particular, it explained why schema-only deployments will leave the membership database in a non-operational state and why deploying user account data is not supported.</span></span> <span data-ttu-id="c58f6-148">Раздел также представлены рекомендации о том, как подготовить и развернуть обновления баз данных членства в различных сценариях.</span><span class="sxs-lookup"><span data-stu-id="c58f6-148">The topic also presented guidance on how to provision, deploy, and update membership databases in different scenarios.</span></span>

## <a name="further-reading"></a><span data-ttu-id="c58f6-149">Дополнительные сведения</span><span class="sxs-lookup"><span data-stu-id="c58f6-149">Further Reading</span></span>

<span data-ttu-id="c58f6-150">Дополнительные справочные сведения и примеры того, как использовать средство VSDBCMD см. в разделе [Справочник по командной строки VSDBCMD. EXE (развертывание и импорт схемы)](https://msdn.microsoft.com/library/dd193283.aspx) и [как: Импорт схемы из командной строки](https://msdn.microsoft.com/library/dd172135.aspx).</span><span class="sxs-lookup"><span data-stu-id="c58f6-150">For more guidance and examples of how to use VSDBCMD, see [Command-Line Reference for VSDBCMD.EXE (Deployment and Schema Import)](https://msdn.microsoft.com/library/dd193283.aspx) and [How to: Import a Schema from a Command Prompt](https://msdn.microsoft.com/library/dd172135.aspx).</span></span> <span data-ttu-id="c58f6-151">Дополнительные сведения об использовании aspnet\_regsql.exe на создание баз данных членства, см. в разделе [средство регистрации ASP.NET SQL Server (aspnet\_regsql.exe)](https://msdn.microsoft.com/library/ms229862(v=vs.100).aspx).</span><span class="sxs-lookup"><span data-stu-id="c58f6-151">For more information on using aspnet\_regsql.exe to create membership databases, see [ASP.NET SQL Server Registration Tool (aspnet\_regsql.exe)](https://msdn.microsoft.com/library/ms229862(v=vs.100).aspx).</span></span> <span data-ttu-id="c58f6-152">Дополнительные общие рекомендации по развертыванию баз данных членства, см. в разделе [как: Развертывание базы данных членства ASP.NET без включения учетных записей пользователей](https://msdn.microsoft.com/library/ff361972(v=vs.100).aspx).</span><span class="sxs-lookup"><span data-stu-id="c58f6-152">For more general guidance on deploying membership databases, see [How to: Deploy the ASP.NET Membership Database Without Including User Accounts](https://msdn.microsoft.com/library/ff361972(v=vs.100).aspx).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="c58f6-153">[Назад](deploying-database-role-memberships-to-test-environments.md)
> [Вперед](excluding-files-and-folders-from-deployment.md)</span><span class="sxs-lookup"><span data-stu-id="c58f6-153">[Previous](deploying-database-role-memberships-to-test-environments.md)
[Next](excluding-files-and-folders-from-deployment.md)</span></span>
