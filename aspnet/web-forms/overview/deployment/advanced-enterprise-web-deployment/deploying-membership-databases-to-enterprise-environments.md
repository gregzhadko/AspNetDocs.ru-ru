---
uid: web-forms/overview/deployment/advanced-enterprise-web-deployment/deploying-membership-databases-to-enterprise-environments
title: Развертывание баз данных членства в корпоративных средах | Документация Майкрософт
author: jrjlee
description: В этом разделе объясняются ключевые моменты и проблемы, которые необходимо решить при подготовке баз данных служб приложений ASP.NET (более распространенные...
ms.author: riande
ms.date: 05/04/2012
ms.assetid: 3cf765df-d311-4f68-a295-c9685ceea830
msc.legacyurl: /web-forms/overview/deployment/advanced-enterprise-web-deployment/deploying-membership-databases-to-enterprise-environments
msc.type: authoredcontent
ms.openlocfilehash: 50f49af502b75aa5ad52756a76a5e7340aca53f7
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78422160"
---
# <a name="deploying-membership-databases-to-enterprise-environments"></a>Развертывание баз данных членства в корпоративных средах

кто [Джейсон Иванов](https://github.com/jrjlee)

[Скачать в формате PDF](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> В этом разделе объясняются ключевые моменты и сложности, которые необходимо решить при подготовке баз данных служб приложений ASP.NET (более часто называемых базами данных членства) в тестовой, промежуточной или рабочей среде. Здесь также описываются подходы, которые можно использовать для удовлетворения этих сложностей.

Этот раздел является частью серии руководств, основанных на требованиях Enterprise к развертыванию вымышленной компании Fabrikam, Inc. В этой серии руководств используется пример решения&#x2014; [диспетчера контактов](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;для представления веб-приложения с реалистичным уровнем сложности, включая приложение ASP.NET MVC 3, службу Windows Communication Foundation (WCF) и проект базы данных.

Метод развертывания в сердце этих учебников основан на подходе к файлам проекта Split, описанному в разделе [понимание файла проекта](../web-deployment-in-the-enterprise/understanding-the-project-file.md), в котором процесс сборки управляется двумя файлами&#x2014;проекта, содержащими инструкции по сборке, которые применяются к каждой целевой среде, и одна содержит параметры сборки и развертывания, относящиеся к конкретной среде. Во время сборки файл проекта, зависящий от среды, объединяется в файл проекта независимо от среды, чтобы сформировать полный набор инструкций по сборке.

## <a name="what-are-the-issues-when-you-deploy-a-membership-database"></a>Каковы проблемы при развертывании базы данных членства?

В большинстве случаев при создании стратегии развертывания для базы данных сначала необходимо учитывать, какие данные необходимо развернуть. В среде разработки или тестирования может потребоваться развернуть данные учетной записи пользователя, чтобы упростить и быстро выполнить тестирование. В промежуточной или рабочей среде крайне маловероятно, чтобы развертывать данные учетной записи пользователя.

К сожалению, базы данных членства ASP.NET представляют некоторые конкретные проблемы, которые делают это решение гораздо более сложным:

- При развертывании только схемы база данных членства остается в нерабочем состоянии. Это связано с тем, что база данных членства содержит некоторые данные конфигурации (в таблице **aspnet\_счемаверсионс** ), необходимые для работы базы данных. Таким образом, если вы выполняете развертывание только схемы базы данных членства, чтобы исключить данные учетной записи пользователя, необходимо запустить скрипт, выполняемый после развертывания, чтобы добавить необходимые данные конфигурации.
- В зависимости от настройки базы данных членства поставщик членства может использовать ключ компьютера для шифрования паролей и сохранения их в базе данных. В этом случае любые данные учетной записи пользователя, развертываемые с помощью базы данных, станут непригодными для использования на целевом сервере. По этой причине развертывание данных учетной записи пользователя не является поддерживаемым сценарием.

## <a name="choosing-a-membership-database-strategy"></a>Выбор стратегии базы данных членства

Используйте эти рекомендации при выборе способа предоставления базы данных членства в среде Enterprise Server.

- Везде, где это возможно, не развертывайте базы данных членства. Вместо этого создайте базу данных членства вручную на целевом сервере базы данных. Если вы еще не настроили схему базы данных членства, можно просто создать новую в месте в месте назначения с помощью [средства ASP.NET SQL Server Registration Tool (aspnet\_регскл. exe)](https://msdn.microsoft.com/library/ms229862(v=vs.100).aspx).
- Если вы не имеете возможности развернуть базу данных&#x2014;членства, например, если вы внесли значительные изменения в схему&#x2014;базы данных, то следует выполнить развертывание только схемы базы данных членства, чтобы исключить данные учетной записи пользователя, а затем запустить скрипт, выполняемый после развертывания, чтобы добавить необходимые данные конфигурации. Общие рекомендации по этим подходам см. в статье [развертывание базы данных членства ASP.NET без включения учетных записей пользователей](https://msdn.microsoft.com/library/ff361972(v=vs.100).aspx).

Важно помнить, что *схема базы данных членства, скорее всего, будет довольно статической*. Даже если вы настроили базу данных членства, вряд ли придется обновлять схему регулярно,&#x2014;она не будет изменяться с той же частотой, что и код в веб-приложении или проекте базы данных. Таким образом, не следует включать базу данных членства в автоматизированные или одноэтапные процессы развертывания.

## <a name="using-vsdbcmd-to-update-a-membership-database-schema"></a>Использование программы VSDBCMD для обновления схемы базы данных членства

При изменении структуры базы данных членства после первого развертывания может потребоваться не использовать средство веб-развертывания службы IIS (IIS) (веб-развертывание) для повторного развертывания базы данных. Функции развертывания базы данных в веб-развертывание не включают возможность вносить разностные обновления в целевую базу данных&#x2014;, веб-развертывание должны удалять и повторно создавать базу данных. Это означает, что теряются все существующие данные учетной записи пользователя, которые обычно нежелательны в промежуточной или рабочей среде.

Альтернативой является использование служебной программы VSDBCMD для обновления схемы целевой базы данных. VSDBCMD включает две важные возможности. Сначала он может импортировать схему существующей базы данных в DBSCHEMA-файл. Во-вторых, он может развернуть DBSCHEMA-файл в существующей базе данных в качестве разностного обновления. Это означает, что он вносит только изменения, необходимые для обновления целевой базы данных, и данные не теряются.

Эти общие действия можно использовать для обновления схемы базы данных членства.

1. Используйте действие **импорта** VSDBCMD, чтобы создать DBSCHEMA-файл для исходной базы данных членства. Эта процедура описана в разделе [инструкции. Импорт схемы из командной строки](https://msdn.microsoft.com/library/dd172135.aspx).
2. Используйте действие VSDBCMD **deploy** , чтобы развернуть DBSCHEMA файл в целевой базе данных членства. Эта процедура описана в [справочнике по командной строке для программы VSDBCMD. EXE (развертывание и импорт схемы)](https://msdn.microsoft.com/library/dd193283.aspx).

## <a name="conclusion"></a>Заключение

В этом разделе описаны некоторые проблемы, с которыми вы можете столкнуться при подготовке баз данных членства ASP.NET в различных целевых средах. В частности, было объяснено, почему при развертывании только схемы база данных членства остается в нерабочем состоянии и не поддерживается развертывание данных учетной записи пользователя. В разделе также представлены рекомендации по подготовке, развертыванию и обновлению баз данных членства в различных сценариях.

## <a name="further-reading"></a>Дополнительные материалы

Дополнительные рекомендации и примеры использования VSDBCMD см [. в справочнике по командной строке для VSDBCMD. EXE (развертывание и импорт схемы)](https://msdn.microsoft.com/library/dd193283.aspx) и [руководство. Импорт схемы из командной строки](https://msdn.microsoft.com/library/dd172135.aspx). Дополнительные сведения об использовании ASPNET\_регскл. exe для создания баз данных членства см. в статье [ASP.NET SQL Server Registration Tool (aspnet\_регскл. exe)](https://msdn.microsoft.com/library/ms229862(v=vs.100).aspx). Общие рекомендации по развертыванию баз данных членства см. в разделе [развертывание базы данных членства ASP.NET без включения учетных записей пользователей](https://msdn.microsoft.com/library/ff361972(v=vs.100).aspx).

> [!div class="step-by-step"]
> [Назад](deploying-database-role-memberships-to-test-environments.md)
> [Вперед](excluding-files-and-folders-from-deployment.md)
