---
uid: web-forms/overview/deployment/advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments
title: Настройка развертываний баз данных для нескольких сред | Документация Майкрософт
author: jrjlee
description: В этом разделе описывается, как настроить свойства базы данных для конкретных целевых сред в рамках процесса развертывания. Примечание. В данном разделе предполагается th...
ms.author: riande
ms.date: 05/04/2012
ms.assetid: a172979a-1318-4318-a9c6-4f9560d26267
msc.legacyurl: /web-forms/overview/deployment/advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments
msc.type: authoredcontent
ms.openlocfilehash: 865e901618b48bc4bfdc6d7a3ca4e8868d4cb46b
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59412987"
---
# <a name="customizing-database-deployments-for-multiple-environments"></a>Настройка развертываний баз данных для нескольких сред

по [Джейсон Lee](https://github.com/jrjlee)

[Загрузить PDF-файл](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> В этом разделе описывается, как настроить свойства базы данных для конкретных целевых сред в рамках процесса развертывания.
> 
> > [!NOTE]
> > В данном разделе предполагается, что вы развертываете проект базы данных Visual Studio 2010, с помощью MSBuild.exe и VSDBCMD.exe. Дополнительные сведения о почему вы выбрали этот подход, см. в разделе [веб-развертывания на предприятии](../web-deployment-in-the-enterprise/web-deployment-in-the-enterprise.md) и [развертывание проектов баз данных](../web-deployment-in-the-enterprise/deploying-database-projects.md).
> 
> 
> При развертывании проекта базы данных в несколько назначений, часто нужно будет настраивать свойства развертывания базы данных для каждой целевой среды. Например в тестовой среде, необходимо обычно повторно создать базы данных при каждом развертывании, тогда как в промежуточной или рабочей среде будет гораздо более вероятно, вносить добавочные обновления для сохранения данных.
> 
> Параметры развертывания в проекте базы данных Visual Studio 2010 содержатся в файле конфигурации (.sqldeployment) развертывания. В этом разделе показано, как создать файлы конфигурации для конкретной среды развертывания и указать то, что вы хотите использовать в качестве параметра VSDBCMD.


Этот раздел является частью серии учебников, исходя из требования к развертыванию enterprise вымышленной компании Fabrikam, Inc. В этой серии руководств используется пример решения&#x2014; [решения диспетчера контактов](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;для представления веб-приложения с более реалистичные уровень сложности, включая приложения ASP.NET MVC 3, Windows Communication Служба Foundation (WCF) и проект базы данных.

Метод развертывания в основе этих учебников основан на разбиение проекта файл подход, описанный в [основные сведения о файле проекта](../web-deployment-in-the-enterprise/understanding-the-project-file.md), в которой процесс построения управляется двумя файлы проекта&#x2014;один с Создание инструкции, которые применяются для каждой целевой среде и содержащего параметры построения и развертывания для конкретной среды. Во время сборки файл проекта для конкретной среды объединяется в файл проекта независимой от среды, чтобы полный набор инструкций построения.

## <a name="task-overview"></a>Общие сведения о задачах

В этом разделе предполагается, что:

- Вам следует использовать разбиение проекта файл для развертывания решения, как описано в разделе [основные сведения о файле проекта](../web-deployment-in-the-enterprise/understanding-the-project-file.md).
- Вызовите средство VSDBCMD из файла проекта, чтобы развернуть проект базы данных, как описано в разделе [основные сведения о процессе построения](../web-deployment-in-the-enterprise/understanding-the-build-process.md).

Чтобы создать системы развертывания, который поддерживает различные свойства развертывания базы данных между целевых средах, вам потребуется:

- Создайте файл конфигурации (.sqldeployment) развертывания для каждой целевой среды.
- Создайте команду VSDBCMD, которая задает файл конфигурации развертывания в качестве параметра командной строки.
- Параметризовать VSDBCMD команды в файл проекта Microsoft Build Engine (MSBuild), чтобы средство VSDBCMD параметры подходят к целевой среде.

В этом разделе показано, как выполнить каждую из этих процедур.

## <a name="creating-environment-specific-deployment-configuration-files"></a>Создание файлов конфигурации для конкретной среды развертывания

По умолчанию проект базы данных содержит файл конфигурации одного развертывания *Database.sqldeployment*. Если открыть этот файл в Visual Studio 2010, вы увидите разных вариантов развертывания, которые будут доступны пользователю:

- **Параметры сортировки для сравнения развертывания**. Это позволяет выбрать, следует ли использовать параметры сортировки базы данных проекта ( *источника* параметров сортировки), либо параметры сортировки базы данных на конечном сервере ( *целевой* параметров сортировки). В большинстве случаев стоит использовать исходные параметры сортировки при развертывании в среде разработки или тестовой среде. При развертывании в промежуточной или рабочей среде, вы обычно хотите оставить без изменений, чтобы избежать проблем взаимодействия целевые параметры сортировки.
- **Развертывать свойства базы данных**. Это позволяет выбрать, следует ли применять свойства базы данных, как определено в *Database.sqlsettings* файла. При развертывании базы данных в первый раз, следует развертывать свойства базы данных. При обновлении существующей базы данных, свойства должны быть на месте, а вам не потребуется развернуть заново.
- **Всегда воссоздавать базу данных**. Это позволяет выбирать, следует ли повторно создать целевую базу данных каждый раз при развертывании или вносить добавочные изменения, переведите базу данных в целевой объект в актуальном состоянии с помощью схемы. Если вы повторно создать базу данных, будут потеряны все данные в существующую базу данных. Таким образом, вы должны обычно задать **false** для развертывания в промежуточной или рабочей среде.
- **Блокировать добавочное развертывание при возможности потери данных**. Это позволяет выбрать, должно ли останавливаться развертывание, если изменения в схему базы данных приведет к потере данных. Обычно выбрано значение **true** для развертывания в рабочей среде, чтобы предоставить возможность вмешаться и защитить все важные данные. Если вы задали **всегда воссоздавать базу данных** для **false**, этот параметр не повлияет.
- **Выполнение развертывания в однопользовательском режиме**. Обычно это не проблема в средах разработки и тестирования. Тем не менее, рекомендуется устанавливать это **true** для развертывания в промежуточной или рабочей среде. Это запрещает пользователям вносить изменения в базу данных во время развертывания.
- **Резервное копирование базы данных перед развертыванием**. Обычно выбрано значение **true** при развертывании в рабочей среде, для предотвращения потери данных. Можно также установить **true** при развертывании в промежуточной среде, если в промежуточной базе данных большого объема данных.
- **Создавать инструкции DROP для объектов, находящихся в целевую базу данных, но не входящие в проект базы данных**. В большинстве случаев это неотъемлемая и Основополагающая часть добавочные изменения в базе данных. Если вы задали **всегда воссоздавать базу данных** для **false**, этот параметр не повлияет.
- **Не используйте инструкции ALTER ASSEMBLY для обновления типов среды CLR**. Этот параметр определяет, как SQL Server необходимо обновить до более новых версий сборки типах языков среды CLR (CLR). Это должно быть присвоено **false** в большинстве сценариев.

В этой таблице описаны параметры типичное развертывание для сред другое назначение. Тем не менее параметры могут отличаться в зависимости от точных требований.

|  | Разработки и тестирования | Промежуточного хранения и интеграции | Рабочие |
| --- | --- | --- | --- |
| **Параметры сортировки для сравнения развертывания** | Source | целевого объекта | целевого объекта |
| **Развертывать свойства базы данных** | True | Только в первый раз | Только в первый раз |
| **Всегда воссоздавать базу данных** | True | False | False |
| **Блокировать добавочное развертывание при возможности потери данных** | False | Возможно | True |
| **Выполнить скрипт развертывания в однопользовательском режиме** | False | True | True |
| **Резервное копирование базы данных перед развертыванием** | False | Возможно | True |
| **Создавать инструкции DROP для объектов, находящихся в целевую базу данных, но не входящие в проект базы данных** | False | True | True |
| **Не используйте инструкции ALTER ASSEMBLY для обновления типов среды CLR** | False | False | False |
  

> [!NOTE]
> Дополнительные сведения о свойствах развертывания баз данных и соображения, касающиеся среды, см. в разделе [Обзор из параметры проекта базы данных](https://msdn.microsoft.com/library/aa833291(v=VS.100).aspx), [как: Настройка свойств для сведений о развертывании](https://msdn.microsoft.com/library/dd172125.aspx), [сборка и развертывание базы данных в изолированной среде разработки](https://msdn.microsoft.com/library/dd193409.aspx), и [построение и развертывание баз данных в тестовой или рабочей среде](https://msdn.microsoft.com/library/dd193413.aspx).


Для поддержки развертывания проекта базы данных в несколько назначений, следует создать файл конфигурации развертывания для каждой целевой среды.

**Чтобы создать файл конфигурации среды**

1. В Visual Studio 2010 в **обозревателе решений** окно, щелкните правой кнопкой мыши проект базы данных и нажмите кнопку **свойства**.
2. На странице свойств проекта базы данных на **развернуть** на вкладке **файл конфигурации развертывания** щелкните **New**.

    ![](customizing-database-deployments-for-multiple-environments/_static/image1.png)
3. В **новый файл конфигурации развертывания** диалогового окна поле, присвойте файлу понятное имя (например, **TestEnvironment.sqldeployment**) и нажмите кнопку **Сохранить**.
4. На *[имя_файла] *** .sqldeployment** странице, задание свойства развертывания в соответствии с требованиями целевой среды и затем сохраните файл.

    ![](customizing-database-deployments-for-multiple-environments/_static/image2.png)
5. Обратите внимание на то, что новый файл добавляется в папку "Свойства" в проекте базы данных.

    ![](customizing-database-deployments-for-multiple-environments/_static/image3.png)

## <a name="specifying-the-deployment-configuration-file-in-vsdbcmd"></a>Указание файла конфигурации развертывания в средство VSDBCMD

При использовании конфигураций решения (например, Debug и Release) в Visual Studio 2010, файл конфигурации развертывания можно связать с каждой конфигурации. При создании конкретной конфигурации, процесс сборки создает файл манифеста развертывания зависящие от конфигурации, который указывает на файл конфигурации развертывания, зависящие от конфигурации. Тем не менее одним из основных целей подход к развертыванию, описанные в этих учебниках является предоставить пользователям возможность контролировать процесс развертывания без использования Visual Studio 2010 и конфигурации решения. При таком подходе конфигурации решения не зависит от целевой среды развертывания. Для настройки развертывания базы данных в среде определенное место назначения, параметры командной строки VSDBCMD можно использовать для указания файла конфигурации развертывания.

Чтобы указать файл конфигурации развертывания в вашей VSDBCMD, используйте **p:/DeploymentConfigurationFile** переключения и укажите полный путь к файлу. Это переопределяет файл конфигурации развертывания, который идентифицирует манифест развертывания. Например, эта команда VSDBCMD можно использовать для развертывания **ContactManager** базы данных в тестовой среде:


[!code-console[Main](customizing-database-deployments-for-multiple-environments/samples/sample1.cmd)]


> [!NOTE]
> Обратите внимание на то, что процесс построения может переименовать SQLDEPLOYMENT-файл, когда он копирует файл в выходной каталог.


Если вы используете переменные команд SQL в скриптах SQL до или после развертывания, можно использовать аналогичный подход должен быть сопоставлен развертывания конкретной среды SQLCMDVARS-файл. В этом случае используется **p:/SqlCommandVariablesFile** для идентификации SQLCMDVARS-файл.

## <a name="running-the-vsdbcmd-command-from-an-msbuild-project-file"></a>Выполнив команду VSDBCMD из файла проекта MSBuild

Можно вызвать команду VSDBCMD из файла проекта MSBuild с помощью **Exec** задачу в целевой объект MSBuild. В простейшей форме оно выглядело следующим образом:


[!code-xml[Main](customizing-database-deployments-for-multiple-environments/samples/sample2.xml)]


- На практике чтобы облегчить чтение и повторное использование, файлы проекта необходимо создать свойства для хранения различных параметров командной строки. Это упрощает для пользователей, чтобы определить значения свойств в файле проекта для конкретной среды или для переопределения значения по умолчанию из командной строки MSBuild. При использовании разбиения проекта файл подход, описанный в [основные сведения о файле проекта](../web-deployment-in-the-enterprise/understanding-the-project-file.md), следует разделить на инструкциях по сборке и свойства между двумя файлами соответствующим образом:
- Параметры, относящиеся к среде, как имя файла конфигурации развертывания, строку подключения базы данных и имя целевой базы данных должны размещаться в файле проекта для конкретной среды.
- Целевой объект MSBuild, который запускает команду VSDBCMD, а также любые универсальные свойства, такие как расположение исполняемого файла средство VSDBCMD, должны начать выполняться в файле проекта универсальной.

Также следует построить проект базы данных, прежде чем вызывать VSDBCMD, чтобы DEPLOYMANIFEST-файл будет создан и готов для использования. Вы увидите полный пример такого подхода в разделе [основные сведения о процессе построения](../web-deployment-in-the-enterprise/understanding-the-build-process.md), где описано, как файлы проекта в [примера решения диспетчера контактов](../web-deployment-in-the-enterprise/the-contact-manager-solution.md).

## <a name="conclusion"></a>Заключение

В этом разделе описано, как можно настроить свойства базы данных в другой целевой среды при развертывании проектов баз данных с помощью MSBuild и средство VSDBCMD. Этот подход полезен в тех случаях, когда необходимо выполнить развертывание проектов баз данных как часть большего размера, решений корпоративного уровня. Эти решения часто развертываются в несколько назначений, таких как изолированные среды разработки или тестирования, промежуточной или интеграции платформ и рабочей среде или динамической среды. Каждый из этих целевых средах обычно требуется уникальный набор свойства развертывания базы данных.

## <a name="further-reading"></a>Дополнительные сведения

Дополнительные сведения о развертывании проектов баз данных, с помощью VSDBCMD.exe см. в разделе [развертывание проектов баз данных](../web-deployment-in-the-enterprise/deploying-database-projects.md). Дополнительные сведения об использовании настраиваемых файлов проекта MSBuild для управления процессом развертывания, см. в разделе [основные сведения о файле проекта](../web-deployment-in-the-enterprise/understanding-the-project-file.md) и [основные сведения о процессе построения](../web-deployment-in-the-enterprise/understanding-the-build-process.md).

В следующих статьях на сайте MSDN содержатся дополнительные общие рекомендации по развертыванию базы данных:

- [Общие сведения о параметры проекта базы данных](https://msdn.microsoft.com/library/aa833291(v=VS.100).aspx)
- [Практическое руководство. Настройка свойств для сведений о развертывании](https://msdn.microsoft.com/library/dd172125.aspx)
- [Создание и развертывание баз данных в изолированной среде разработки](https://msdn.microsoft.com/library/dd193409.aspx)
- [Создание и развертывание баз данных в тестовой или рабочей среде](https://msdn.microsoft.com/library/dd193413.aspx)

> [!div class="step-by-step"]
> [Назад](performing-a-what-if-deployment.md)
> [Вперед](deploying-database-role-memberships-to-test-environments.md)
