---
uid: web-forms/overview/deployment/advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments
title: Настройка развертываний баз данных для нескольких сред | Документация Майкрософт
author: jrjlee
description: В этом разделе описывается, как настроить свойства базы данных для конкретных целевых сред в рамках процесса развертывания. Примечание. В данном разделе предполагается th...
ms.author: riande
ms.date: 05/04/2012
ms.assetid: a172979a-1318-4318-a9c6-4f9560d26267
msc.legacyurl: /web-forms/overview/deployment/advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments
msc.type: authoredcontent
ms.openlocfilehash: 865e901618b48bc4bfdc6d7a3ca4e8868d4cb46b
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59412987"
---
# <a name="customizing-database-deployments-for-multiple-environments"></a><span data-ttu-id="a0aee-104">Настройка развертываний баз данных для нескольких сред</span><span class="sxs-lookup"><span data-stu-id="a0aee-104">Customizing Database Deployments for Multiple Environments</span></span>

<span data-ttu-id="a0aee-105">по [Джейсон Lee](https://github.com/jrjlee)</span><span class="sxs-lookup"><span data-stu-id="a0aee-105">by [Jason Lee](https://github.com/jrjlee)</span></span>

[<span data-ttu-id="a0aee-106">Загрузить PDF-файл</span><span class="sxs-lookup"><span data-stu-id="a0aee-106">Download PDF</span></span>](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> <span data-ttu-id="a0aee-107">В этом разделе описывается, как настроить свойства базы данных для конкретных целевых сред в рамках процесса развертывания.</span><span class="sxs-lookup"><span data-stu-id="a0aee-107">This topic describes how to tailor the properties of a database to specific target environments as part of the deployment process.</span></span>
> 
> > [!NOTE]
> > <span data-ttu-id="a0aee-108">В данном разделе предполагается, что вы развертываете проект базы данных Visual Studio 2010, с помощью MSBuild.exe и VSDBCMD.exe.</span><span class="sxs-lookup"><span data-stu-id="a0aee-108">The topic assumes that you're deploying a Visual Studio 2010 database project using MSBuild.exe and VSDBCMD.exe.</span></span> <span data-ttu-id="a0aee-109">Дополнительные сведения о почему вы выбрали этот подход, см. в разделе [веб-развертывания на предприятии](../web-deployment-in-the-enterprise/web-deployment-in-the-enterprise.md) и [развертывание проектов баз данных](../web-deployment-in-the-enterprise/deploying-database-projects.md).</span><span class="sxs-lookup"><span data-stu-id="a0aee-109">For more information on why you might choose this approach, see [Web Deployment in the Enterprise](../web-deployment-in-the-enterprise/web-deployment-in-the-enterprise.md) and [Deploying Database Projects](../web-deployment-in-the-enterprise/deploying-database-projects.md).</span></span>
> 
> 
> <span data-ttu-id="a0aee-110">При развертывании проекта базы данных в несколько назначений, часто нужно будет настраивать свойства развертывания базы данных для каждой целевой среды.</span><span class="sxs-lookup"><span data-stu-id="a0aee-110">When you deploy a database project to multiple destinations, you'll often want to customize the database deployment properties for each target environment.</span></span> <span data-ttu-id="a0aee-111">Например в тестовой среде, необходимо обычно повторно создать базы данных при каждом развертывании, тогда как в промежуточной или рабочей среде будет гораздо более вероятно, вносить добавочные обновления для сохранения данных.</span><span class="sxs-lookup"><span data-stu-id="a0aee-111">For example, in test environments you'd typically recreate the database on every deployment, whereas in staging or production environments you'd be a lot more likely to make incremental updates to preserve your data.</span></span>
> 
> <span data-ttu-id="a0aee-112">Параметры развертывания в проекте базы данных Visual Studio 2010 содержатся в файле конфигурации (.sqldeployment) развертывания.</span><span class="sxs-lookup"><span data-stu-id="a0aee-112">In a Visual Studio 2010 database project, deployment settings are contained within a deployment configuration (.sqldeployment) file.</span></span> <span data-ttu-id="a0aee-113">В этом разделе показано, как создать файлы конфигурации для конкретной среды развертывания и указать то, что вы хотите использовать в качестве параметра VSDBCMD.</span><span class="sxs-lookup"><span data-stu-id="a0aee-113">This topic will show you how to create environment-specific deployment configuration files and specify the one you want to use as a VSDBCMD parameter.</span></span>


<span data-ttu-id="a0aee-114">Этот раздел является частью серии учебников, исходя из требования к развертыванию enterprise вымышленной компании Fabrikam, Inc. В этой серии руководств используется пример решения&#x2014; [решения диспетчера контактов](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;для представления веб-приложения с более реалистичные уровень сложности, включая приложения ASP.NET MVC 3, Windows Communication Служба Foundation (WCF) и проект базы данных.</span><span class="sxs-lookup"><span data-stu-id="a0aee-114">This topic forms part of a series of tutorials based around the enterprise deployment requirements of a fictional company named Fabrikam, Inc. This tutorial series uses a sample solution&#x2014;the [Contact Manager solution](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;to represent a web application with a realistic level of complexity, including an ASP.NET MVC 3 application, a Windows Communication Foundation (WCF) service, and a database project.</span></span>

<span data-ttu-id="a0aee-115">Метод развертывания в основе этих учебников основан на разбиение проекта файл подход, описанный в [основные сведения о файле проекта](../web-deployment-in-the-enterprise/understanding-the-project-file.md), в которой процесс построения управляется двумя файлы проекта&#x2014;один с Создание инструкции, которые применяются для каждой целевой среде и содержащего параметры построения и развертывания для конкретной среды.</span><span class="sxs-lookup"><span data-stu-id="a0aee-115">The deployment method at the heart of these tutorials is based on the split project file approach described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md), in which the build process is controlled by two project files&#x2014;one containing build instructions that apply to every destination environment, and one containing environment-specific build and deployment settings.</span></span> <span data-ttu-id="a0aee-116">Во время сборки файл проекта для конкретной среды объединяется в файл проекта независимой от среды, чтобы полный набор инструкций построения.</span><span class="sxs-lookup"><span data-stu-id="a0aee-116">At build time, the environment-specific project file is merged into the environment-agnostic project file to form a complete set of build instructions.</span></span>

## <a name="task-overview"></a><span data-ttu-id="a0aee-117">Общие сведения о задачах</span><span class="sxs-lookup"><span data-stu-id="a0aee-117">Task Overview</span></span>

<span data-ttu-id="a0aee-118">В этом разделе предполагается, что:</span><span class="sxs-lookup"><span data-stu-id="a0aee-118">This topic assumes that:</span></span>

- <span data-ttu-id="a0aee-119">Вам следует использовать разбиение проекта файл для развертывания решения, как описано в разделе [основные сведения о файле проекта](../web-deployment-in-the-enterprise/understanding-the-project-file.md).</span><span class="sxs-lookup"><span data-stu-id="a0aee-119">You use the split project file approach to solution deployment, as described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md).</span></span>
- <span data-ttu-id="a0aee-120">Вызовите средство VSDBCMD из файла проекта, чтобы развернуть проект базы данных, как описано в разделе [основные сведения о процессе построения](../web-deployment-in-the-enterprise/understanding-the-build-process.md).</span><span class="sxs-lookup"><span data-stu-id="a0aee-120">You call VSDBCMD from the project file to deploy your database project, as described in [Understanding the Build Process](../web-deployment-in-the-enterprise/understanding-the-build-process.md).</span></span>

<span data-ttu-id="a0aee-121">Чтобы создать системы развертывания, который поддерживает различные свойства развертывания базы данных между целевых средах, вам потребуется:</span><span class="sxs-lookup"><span data-stu-id="a0aee-121">To create a deployment system that supports varying the database deployment properties between target environments, you'll need to:</span></span>

- <span data-ttu-id="a0aee-122">Создайте файл конфигурации (.sqldeployment) развертывания для каждой целевой среды.</span><span class="sxs-lookup"><span data-stu-id="a0aee-122">Create a deployment configuration (.sqldeployment) file for each target environment.</span></span>
- <span data-ttu-id="a0aee-123">Создайте команду VSDBCMD, которая задает файл конфигурации развертывания в качестве параметра командной строки.</span><span class="sxs-lookup"><span data-stu-id="a0aee-123">Create a VSDBCMD command that specifies the deployment configuration file as a command-line switch.</span></span>
- <span data-ttu-id="a0aee-124">Параметризовать VSDBCMD команды в файл проекта Microsoft Build Engine (MSBuild), чтобы средство VSDBCMD параметры подходят к целевой среде.</span><span class="sxs-lookup"><span data-stu-id="a0aee-124">Parameterize the VSDBCMD command in a Microsoft Build Engine (MSBuild) project file, so that the VSDBCMD options are appropriate to the target environment.</span></span>

<span data-ttu-id="a0aee-125">В этом разделе показано, как выполнить каждую из этих процедур.</span><span class="sxs-lookup"><span data-stu-id="a0aee-125">This topic will show you how to perform each of these procedures.</span></span>

## <a name="creating-environment-specific-deployment-configuration-files"></a><span data-ttu-id="a0aee-126">Создание файлов конфигурации для конкретной среды развертывания</span><span class="sxs-lookup"><span data-stu-id="a0aee-126">Creating Environment-Specific Deployment Configuration Files</span></span>

<span data-ttu-id="a0aee-127">По умолчанию проект базы данных содержит файл конфигурации одного развертывания *Database.sqldeployment*.</span><span class="sxs-lookup"><span data-stu-id="a0aee-127">By default, a database project contains a single deployment configuration file named *Database.sqldeployment*.</span></span> <span data-ttu-id="a0aee-128">Если открыть этот файл в Visual Studio 2010, вы увидите разных вариантов развертывания, которые будут доступны пользователю:</span><span class="sxs-lookup"><span data-stu-id="a0aee-128">If you open this file in Visual Studio 2010, you can see the different deployment options that are available to you:</span></span>

- <span data-ttu-id="a0aee-129">**Параметры сортировки для сравнения развертывания**.</span><span class="sxs-lookup"><span data-stu-id="a0aee-129">**Deployment comparison collation**.</span></span> <span data-ttu-id="a0aee-130">Это позволяет выбрать, следует ли использовать параметры сортировки базы данных проекта ( *источника* параметров сортировки), либо параметры сортировки базы данных на конечном сервере ( *целевой* параметров сортировки).</span><span class="sxs-lookup"><span data-stu-id="a0aee-130">This lets you choose whether to use the database collation of your project (the *source* collation) or the database collation of your destination server (the *target* collation).</span></span> <span data-ttu-id="a0aee-131">В большинстве случаев стоит использовать исходные параметры сортировки при развертывании в среде разработки или тестовой среде.</span><span class="sxs-lookup"><span data-stu-id="a0aee-131">In most cases, you'll want to use the source collation when you deploy to a development or test environment.</span></span> <span data-ttu-id="a0aee-132">При развертывании в промежуточной или рабочей среде, вы обычно хотите оставить без изменений, чтобы избежать проблем взаимодействия целевые параметры сортировки.</span><span class="sxs-lookup"><span data-stu-id="a0aee-132">When you deploy to a staging or production environment, you'll usually want to leave the target collation unchanged to avoid any interoperability issues.</span></span>
- <span data-ttu-id="a0aee-133">**Развертывать свойства базы данных**.</span><span class="sxs-lookup"><span data-stu-id="a0aee-133">**Deploy database properties**.</span></span> <span data-ttu-id="a0aee-134">Это позволяет выбрать, следует ли применять свойства базы данных, как определено в *Database.sqlsettings* файла.</span><span class="sxs-lookup"><span data-stu-id="a0aee-134">This lets you choose whether to apply the database properties, as defined in the *Database.sqlsettings* file.</span></span> <span data-ttu-id="a0aee-135">При развертывании базы данных в первый раз, следует развертывать свойства базы данных.</span><span class="sxs-lookup"><span data-stu-id="a0aee-135">When you deploy a database for the first time, you should deploy the database properties.</span></span> <span data-ttu-id="a0aee-136">При обновлении существующей базы данных, свойства должны быть на месте, а вам не потребуется развернуть заново.</span><span class="sxs-lookup"><span data-stu-id="a0aee-136">If you're updating an existing database, the properties should already be in place, and you shouldn't need to deploy them again.</span></span>
- <span data-ttu-id="a0aee-137">**Всегда воссоздавать базу данных**.</span><span class="sxs-lookup"><span data-stu-id="a0aee-137">**Always re-create database**.</span></span> <span data-ttu-id="a0aee-138">Это позволяет выбирать, следует ли повторно создать целевую базу данных каждый раз при развертывании или вносить добавочные изменения, переведите базу данных в целевой объект в актуальном состоянии с помощью схемы.</span><span class="sxs-lookup"><span data-stu-id="a0aee-138">This lets you choose whether to re-create the target database every time you deploy or make incremental changes to bring the target database up to date with your schema.</span></span> <span data-ttu-id="a0aee-139">Если вы повторно создать базу данных, будут потеряны все данные в существующую базу данных.</span><span class="sxs-lookup"><span data-stu-id="a0aee-139">If you re-create the database, you'll lose any data in the existing database.</span></span> <span data-ttu-id="a0aee-140">Таким образом, вы должны обычно задать **false** для развертывания в промежуточной или рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="a0aee-140">As such, you should usually set this to **false** for deployments to staging or production environments.</span></span>
- <span data-ttu-id="a0aee-141">**Блокировать добавочное развертывание при возможности потери данных**.</span><span class="sxs-lookup"><span data-stu-id="a0aee-141">**Block incremental deployment if data loss might occur**.</span></span> <span data-ttu-id="a0aee-142">Это позволяет выбрать, должно ли останавливаться развертывание, если изменения в схему базы данных приведет к потере данных.</span><span class="sxs-lookup"><span data-stu-id="a0aee-142">This lets you choose whether deployment should stop if a change to the database schema will cause the loss of data.</span></span> <span data-ttu-id="a0aee-143">Обычно выбрано значение **true** для развертывания в рабочей среде, чтобы предоставить возможность вмешаться и защитить все важные данные.</span><span class="sxs-lookup"><span data-stu-id="a0aee-143">You typically set this to **true** for a deployment to a production environment, to give you the opportunity to intervene and protect any important data.</span></span> <span data-ttu-id="a0aee-144">Если вы задали **всегда воссоздавать базу данных** для **false**, этот параметр не повлияет.</span><span class="sxs-lookup"><span data-stu-id="a0aee-144">If you have set **Always re-create database** to **false**, this setting will have no effect.</span></span>
- <span data-ttu-id="a0aee-145">**Выполнение развертывания в однопользовательском режиме**.</span><span class="sxs-lookup"><span data-stu-id="a0aee-145">**Execute deployment in single-user mode**.</span></span> <span data-ttu-id="a0aee-146">Обычно это не проблема в средах разработки и тестирования.</span><span class="sxs-lookup"><span data-stu-id="a0aee-146">This is not usually an issue in development or test environments.</span></span> <span data-ttu-id="a0aee-147">Тем не менее, рекомендуется устанавливать это **true** для развертывания в промежуточной или рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="a0aee-147">However, you should typically set this to **true** for deployments to staging or production environments.</span></span> <span data-ttu-id="a0aee-148">Это запрещает пользователям вносить изменения в базу данных во время развертывания.</span><span class="sxs-lookup"><span data-stu-id="a0aee-148">This prevents users from making changes to the database while the deployment is underway.</span></span>
- <span data-ttu-id="a0aee-149">**Резервное копирование базы данных перед развертыванием**.</span><span class="sxs-lookup"><span data-stu-id="a0aee-149">**Back up database before deployment**.</span></span> <span data-ttu-id="a0aee-150">Обычно выбрано значение **true** при развертывании в рабочей среде, для предотвращения потери данных.</span><span class="sxs-lookup"><span data-stu-id="a0aee-150">You typically set this to **true** when you deploy to a production environment, as a precaution against data loss.</span></span> <span data-ttu-id="a0aee-151">Можно также установить **true** при развертывании в промежуточной среде, если в промежуточной базе данных большого объема данных.</span><span class="sxs-lookup"><span data-stu-id="a0aee-151">You may also want to set it to **true** when you deploy to a staging environment, if your staging database contains a lot of data.</span></span>
- <span data-ttu-id="a0aee-152">**Создавать инструкции DROP для объектов, находящихся в целевую базу данных, но не входящие в проект базы данных**.</span><span class="sxs-lookup"><span data-stu-id="a0aee-152">**Generate DROP statements for objects that are in the target database but that are not in the database project**.</span></span> <span data-ttu-id="a0aee-153">В большинстве случаев это неотъемлемая и Основополагающая часть добавочные изменения в базе данных.</span><span class="sxs-lookup"><span data-stu-id="a0aee-153">In most cases, this is an integral and essential part of making incremental changes to a database.</span></span> <span data-ttu-id="a0aee-154">Если вы задали **всегда воссоздавать базу данных** для **false**, этот параметр не повлияет.</span><span class="sxs-lookup"><span data-stu-id="a0aee-154">If you have set **Always re-create database** to **false**, this setting will have no effect.</span></span>
- <span data-ttu-id="a0aee-155">**Не используйте инструкции ALTER ASSEMBLY для обновления типов среды CLR**.</span><span class="sxs-lookup"><span data-stu-id="a0aee-155">**Do not use ALTER ASSEMBLY statements to update CLR types**.</span></span> <span data-ttu-id="a0aee-156">Этот параметр определяет, как SQL Server необходимо обновить до более новых версий сборки типах языков среды CLR (CLR).</span><span class="sxs-lookup"><span data-stu-id="a0aee-156">This setting determines how SQL Server should update common language runtime (CLR) types to newer assembly versions.</span></span> <span data-ttu-id="a0aee-157">Это должно быть присвоено **false** в большинстве сценариев.</span><span class="sxs-lookup"><span data-stu-id="a0aee-157">This should be set to **false** in most scenarios.</span></span>

<span data-ttu-id="a0aee-158">В этой таблице описаны параметры типичное развертывание для сред другое назначение.</span><span class="sxs-lookup"><span data-stu-id="a0aee-158">This table shows typical deployment settings for different destination environments.</span></span> <span data-ttu-id="a0aee-159">Тем не менее параметры могут отличаться в зависимости от точных требований.</span><span class="sxs-lookup"><span data-stu-id="a0aee-159">However, your settings may be different depending on your exact requirements.</span></span>

|  | <span data-ttu-id="a0aee-160">Разработки и тестирования</span><span class="sxs-lookup"><span data-stu-id="a0aee-160">Developer/Test</span></span> | <span data-ttu-id="a0aee-161">Промежуточного хранения и интеграции</span><span class="sxs-lookup"><span data-stu-id="a0aee-161">Staging/Integration</span></span> | <span data-ttu-id="a0aee-162">Рабочие</span><span class="sxs-lookup"><span data-stu-id="a0aee-162">Production</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="a0aee-163">**Параметры сортировки для сравнения развертывания**</span><span class="sxs-lookup"><span data-stu-id="a0aee-163">**Deployment comparison collation**</span></span> | <span data-ttu-id="a0aee-164">Source</span><span class="sxs-lookup"><span data-stu-id="a0aee-164">Source</span></span> | <span data-ttu-id="a0aee-165">целевого объекта</span><span class="sxs-lookup"><span data-stu-id="a0aee-165">Target</span></span> | <span data-ttu-id="a0aee-166">целевого объекта</span><span class="sxs-lookup"><span data-stu-id="a0aee-166">Target</span></span> |
| <span data-ttu-id="a0aee-167">**Развертывать свойства базы данных**</span><span class="sxs-lookup"><span data-stu-id="a0aee-167">**Deploy database properties**</span></span> | <span data-ttu-id="a0aee-168">True</span><span class="sxs-lookup"><span data-stu-id="a0aee-168">True</span></span> | <span data-ttu-id="a0aee-169">Только в первый раз</span><span class="sxs-lookup"><span data-stu-id="a0aee-169">First time only</span></span> | <span data-ttu-id="a0aee-170">Только в первый раз</span><span class="sxs-lookup"><span data-stu-id="a0aee-170">First time only</span></span> |
| <span data-ttu-id="a0aee-171">**Всегда воссоздавать базу данных**</span><span class="sxs-lookup"><span data-stu-id="a0aee-171">**Always re-create database**</span></span> | <span data-ttu-id="a0aee-172">True</span><span class="sxs-lookup"><span data-stu-id="a0aee-172">True</span></span> | <span data-ttu-id="a0aee-173">False</span><span class="sxs-lookup"><span data-stu-id="a0aee-173">False</span></span> | <span data-ttu-id="a0aee-174">False</span><span class="sxs-lookup"><span data-stu-id="a0aee-174">False</span></span> |
| <span data-ttu-id="a0aee-175">**Блокировать добавочное развертывание при возможности потери данных**</span><span class="sxs-lookup"><span data-stu-id="a0aee-175">**Block incremental deployment if data loss might occur**</span></span> | <span data-ttu-id="a0aee-176">False</span><span class="sxs-lookup"><span data-stu-id="a0aee-176">False</span></span> | <span data-ttu-id="a0aee-177">Возможно</span><span class="sxs-lookup"><span data-stu-id="a0aee-177">Maybe</span></span> | <span data-ttu-id="a0aee-178">True</span><span class="sxs-lookup"><span data-stu-id="a0aee-178">True</span></span> |
| <span data-ttu-id="a0aee-179">**Выполнить скрипт развертывания в однопользовательском режиме**</span><span class="sxs-lookup"><span data-stu-id="a0aee-179">**Execute deployment script in single-user mode**</span></span> | <span data-ttu-id="a0aee-180">False</span><span class="sxs-lookup"><span data-stu-id="a0aee-180">False</span></span> | <span data-ttu-id="a0aee-181">True</span><span class="sxs-lookup"><span data-stu-id="a0aee-181">True</span></span> | <span data-ttu-id="a0aee-182">True</span><span class="sxs-lookup"><span data-stu-id="a0aee-182">True</span></span> |
| <span data-ttu-id="a0aee-183">**Резервное копирование базы данных перед развертыванием**</span><span class="sxs-lookup"><span data-stu-id="a0aee-183">**Back up database before deployment**</span></span> | <span data-ttu-id="a0aee-184">False</span><span class="sxs-lookup"><span data-stu-id="a0aee-184">False</span></span> | <span data-ttu-id="a0aee-185">Возможно</span><span class="sxs-lookup"><span data-stu-id="a0aee-185">Maybe</span></span> | <span data-ttu-id="a0aee-186">True</span><span class="sxs-lookup"><span data-stu-id="a0aee-186">True</span></span> |
| <span data-ttu-id="a0aee-187">**Создавать инструкции DROP для объектов, находящихся в целевую базу данных, но не входящие в проект базы данных**</span><span class="sxs-lookup"><span data-stu-id="a0aee-187">**Generate DROP statements for objects that are in the target database but that are not in the database project**</span></span> | <span data-ttu-id="a0aee-188">False</span><span class="sxs-lookup"><span data-stu-id="a0aee-188">False</span></span> | <span data-ttu-id="a0aee-189">True</span><span class="sxs-lookup"><span data-stu-id="a0aee-189">True</span></span> | <span data-ttu-id="a0aee-190">True</span><span class="sxs-lookup"><span data-stu-id="a0aee-190">True</span></span> |
| <span data-ttu-id="a0aee-191">**Не используйте инструкции ALTER ASSEMBLY для обновления типов среды CLR**</span><span class="sxs-lookup"><span data-stu-id="a0aee-191">**Do not use ALTER ASSEMBLY statements to update CLR types**</span></span> | <span data-ttu-id="a0aee-192">False</span><span class="sxs-lookup"><span data-stu-id="a0aee-192">False</span></span> | <span data-ttu-id="a0aee-193">False</span><span class="sxs-lookup"><span data-stu-id="a0aee-193">False</span></span> | <span data-ttu-id="a0aee-194">False</span><span class="sxs-lookup"><span data-stu-id="a0aee-194">False</span></span> |
  

> [!NOTE]
> <span data-ttu-id="a0aee-195">Дополнительные сведения о свойствах развертывания баз данных и соображения, касающиеся среды, см. в разделе [Обзор из параметры проекта базы данных](https://msdn.microsoft.com/library/aa833291(v=VS.100).aspx), [как: Настройка свойств для сведений о развертывании](https://msdn.microsoft.com/library/dd172125.aspx), [сборка и развертывание базы данных в изолированной среде разработки](https://msdn.microsoft.com/library/dd193409.aspx), и [построение и развертывание баз данных в тестовой или рабочей среде](https://msdn.microsoft.com/library/dd193413.aspx).</span><span class="sxs-lookup"><span data-stu-id="a0aee-195">For more information on database deployment properties and environment considerations, see [An Overview of Database Project Settings](https://msdn.microsoft.com/library/aa833291(v=VS.100).aspx), [How to: Configure Properties for Deployment Details](https://msdn.microsoft.com/library/dd172125.aspx), [Build and Deploy Database to an Isolated Development Environment](https://msdn.microsoft.com/library/dd193409.aspx), and [Build and Deploy Databases to a Staging or Production Environment](https://msdn.microsoft.com/library/dd193413.aspx).</span></span>


<span data-ttu-id="a0aee-196">Для поддержки развертывания проекта базы данных в несколько назначений, следует создать файл конфигурации развертывания для каждой целевой среды.</span><span class="sxs-lookup"><span data-stu-id="a0aee-196">To support the deployment of a database project to multiple destinations, you should create a deployment configuration file for each target environment.</span></span>

<span data-ttu-id="a0aee-197">**Чтобы создать файл конфигурации среды**</span><span class="sxs-lookup"><span data-stu-id="a0aee-197">**To create an environment-specific configuration file**</span></span>

1. <span data-ttu-id="a0aee-198">В Visual Studio 2010 в **обозревателе решений** окно, щелкните правой кнопкой мыши проект базы данных и нажмите кнопку **свойства**.</span><span class="sxs-lookup"><span data-stu-id="a0aee-198">In Visual Studio 2010, in the **Solution Explorer** window, right-click your database project, and then click **Properties**.</span></span>
2. <span data-ttu-id="a0aee-199">На странице свойств проекта базы данных на **развернуть** на вкладке **файл конфигурации развертывания** щелкните **New**.</span><span class="sxs-lookup"><span data-stu-id="a0aee-199">On the database project properties page, on the **Deploy** tab, in the **Deployment configuration file** row, click **New**.</span></span>

    ![](customizing-database-deployments-for-multiple-environments/_static/image1.png)
3. <span data-ttu-id="a0aee-200">В **новый файл конфигурации развертывания** диалогового окна поле, присвойте файлу понятное имя (например, **TestEnvironment.sqldeployment**) и нажмите кнопку **Сохранить**.</span><span class="sxs-lookup"><span data-stu-id="a0aee-200">In the **New Deployment Configuration File** dialog box, give the file a meaningful name (for example, **TestEnvironment.sqldeployment**), and then click **Save**.</span></span>
4. <span data-ttu-id="a0aee-201">На *[имя_файла] \*\*\* .sqldeployment*\* странице, задание свойства развертывания в соответствии с требованиями целевой среды и затем сохраните файл.</span><span class="sxs-lookup"><span data-stu-id="a0aee-201">On the *[Filename]\*\*\*.sqldeployment*\* page, set the deployment properties to match the requirements of your destination environment, and then save the file.</span></span>

    ![](customizing-database-deployments-for-multiple-environments/_static/image2.png)
5. <span data-ttu-id="a0aee-202">Обратите внимание на то, что новый файл добавляется в папку "Свойства" в проекте базы данных.</span><span class="sxs-lookup"><span data-stu-id="a0aee-202">Notice that the new file is added to the Properties folder in your database project.</span></span>

    ![](customizing-database-deployments-for-multiple-environments/_static/image3.png)

## <a name="specifying-the-deployment-configuration-file-in-vsdbcmd"></a><span data-ttu-id="a0aee-203">Указание файла конфигурации развертывания в средство VSDBCMD</span><span class="sxs-lookup"><span data-stu-id="a0aee-203">Specifying the Deployment Configuration File in VSDBCMD</span></span>

<span data-ttu-id="a0aee-204">При использовании конфигураций решения (например, Debug и Release) в Visual Studio 2010, файл конфигурации развертывания можно связать с каждой конфигурации.</span><span class="sxs-lookup"><span data-stu-id="a0aee-204">When you use solution configurations (like Debug and Release) within Visual Studio 2010, you can associate a deployment configuration file with each configuration.</span></span> <span data-ttu-id="a0aee-205">При создании конкретной конфигурации, процесс сборки создает файл манифеста развертывания зависящие от конфигурации, который указывает на файл конфигурации развертывания, зависящие от конфигурации.</span><span class="sxs-lookup"><span data-stu-id="a0aee-205">When you build a particular configuration, the build process generates a configuration-specific deployment manifest file that points to the configuration-specific deployment configuration file.</span></span> <span data-ttu-id="a0aee-206">Тем не менее одним из основных целей подход к развертыванию, описанные в этих учебниках является предоставить пользователям возможность контролировать процесс развертывания без использования Visual Studio 2010 и конфигурации решения.</span><span class="sxs-lookup"><span data-stu-id="a0aee-206">However, one of the main aims of the approach to deployment described in these tutorials is to give people the ability to control the deployment process without using Visual Studio 2010 and solution configurations.</span></span> <span data-ttu-id="a0aee-207">При таком подходе конфигурации решения не зависит от целевой среды развертывания.</span><span class="sxs-lookup"><span data-stu-id="a0aee-207">In this approach, the solution configuration is the same regardless of the target deployment environment.</span></span> <span data-ttu-id="a0aee-208">Для настройки развертывания базы данных в среде определенное место назначения, параметры командной строки VSDBCMD можно использовать для указания файла конфигурации развертывания.</span><span class="sxs-lookup"><span data-stu-id="a0aee-208">To tailor your database deployment to a specific destination environment, you can use the VSDBCMD command-line options to specify your deployment configuration file.</span></span>

<span data-ttu-id="a0aee-209">Чтобы указать файл конфигурации развертывания в вашей VSDBCMD, используйте **p:/DeploymentConfigurationFile** переключения и укажите полный путь к файлу.</span><span class="sxs-lookup"><span data-stu-id="a0aee-209">To specify a deployment configuration file in your VSDBCMD, use the **p:/DeploymentConfigurationFile** switch and provide the full path to your file.</span></span> <span data-ttu-id="a0aee-210">Это переопределяет файл конфигурации развертывания, который идентифицирует манифест развертывания.</span><span class="sxs-lookup"><span data-stu-id="a0aee-210">This will override the deployment configuration file that the deployment manifest identifies.</span></span> <span data-ttu-id="a0aee-211">Например, эта команда VSDBCMD можно использовать для развертывания **ContactManager** базы данных в тестовой среде:</span><span class="sxs-lookup"><span data-stu-id="a0aee-211">For example, you could use this VSDBCMD command to deploy the **ContactManager** database to a test environment:</span></span>


[!code-console[Main](customizing-database-deployments-for-multiple-environments/samples/sample1.cmd)]


> [!NOTE]
> <span data-ttu-id="a0aee-212">Обратите внимание на то, что процесс построения может переименовать SQLDEPLOYMENT-файл, когда он копирует файл в выходной каталог.</span><span class="sxs-lookup"><span data-stu-id="a0aee-212">Note that the build process may rename your .sqldeployment file when it copies the file to the output directory.</span></span>


<span data-ttu-id="a0aee-213">Если вы используете переменные команд SQL в скриптах SQL до или после развертывания, можно использовать аналогичный подход должен быть сопоставлен развертывания конкретной среды SQLCMDVARS-файл.</span><span class="sxs-lookup"><span data-stu-id="a0aee-213">If you use SQL command variables in your pre-deployment or post-deployment SQL scripts, you can use a similar approach to associate an environment-specific .sqlcmdvars file with your deployment.</span></span> <span data-ttu-id="a0aee-214">В этом случае используется **p:/SqlCommandVariablesFile** для идентификации SQLCMDVARS-файл.</span><span class="sxs-lookup"><span data-stu-id="a0aee-214">In this case, you use the **p:/SqlCommandVariablesFile** switch to identify your .sqlcmdvars file.</span></span>

## <a name="running-the-vsdbcmd-command-from-an-msbuild-project-file"></a><span data-ttu-id="a0aee-215">Выполнив команду VSDBCMD из файла проекта MSBuild</span><span class="sxs-lookup"><span data-stu-id="a0aee-215">Running the VSDBCMD Command from an MSBuild Project File</span></span>

<span data-ttu-id="a0aee-216">Можно вызвать команду VSDBCMD из файла проекта MSBuild с помощью **Exec** задачу в целевой объект MSBuild.</span><span class="sxs-lookup"><span data-stu-id="a0aee-216">You can invoke a VSDBCMD command from an MSBuild project file by using an **Exec** task within an MSBuild target.</span></span> <span data-ttu-id="a0aee-217">В простейшей форме оно выглядело следующим образом:</span><span class="sxs-lookup"><span data-stu-id="a0aee-217">In its simplest form, it would look like this:</span></span>


[!code-xml[Main](customizing-database-deployments-for-multiple-environments/samples/sample2.xml)]


- <span data-ttu-id="a0aee-218">На практике чтобы облегчить чтение и повторное использование, файлы проекта необходимо создать свойства для хранения различных параметров командной строки.</span><span class="sxs-lookup"><span data-stu-id="a0aee-218">In practice, to make your project files easy to read and reuse, you'll want to create properties to store the various command-line parameters.</span></span> <span data-ttu-id="a0aee-219">Это упрощает для пользователей, чтобы определить значения свойств в файле проекта для конкретной среды или для переопределения значения по умолчанию из командной строки MSBuild.</span><span class="sxs-lookup"><span data-stu-id="a0aee-219">This makes it easier for users to provide property values in an environment-specific project file or to override default values from the MSBuild command line.</span></span> <span data-ttu-id="a0aee-220">При использовании разбиения проекта файл подход, описанный в [основные сведения о файле проекта](../web-deployment-in-the-enterprise/understanding-the-project-file.md), следует разделить на инструкциях по сборке и свойства между двумя файлами соответствующим образом:</span><span class="sxs-lookup"><span data-stu-id="a0aee-220">If you use the split project file approach described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md), you should divide your build instructions and properties between the two files accordingly:</span></span>
- <span data-ttu-id="a0aee-221">Параметры, относящиеся к среде, как имя файла конфигурации развертывания, строку подключения базы данных и имя целевой базы данных должны размещаться в файле проекта для конкретной среды.</span><span class="sxs-lookup"><span data-stu-id="a0aee-221">Environment-specific settings, like the deployment configuration filename, the database connection string, and the target database name, should go in the environment-specific project file.</span></span>
- <span data-ttu-id="a0aee-222">Целевой объект MSBuild, который запускает команду VSDBCMD, а также любые универсальные свойства, такие как расположение исполняемого файла средство VSDBCMD, должны начать выполняться в файле проекта универсальной.</span><span class="sxs-lookup"><span data-stu-id="a0aee-222">The MSBuild target that runs the VSDBCMD command, together with any universal properties like the location of the VSDBCMD executable, should go in the universal project file.</span></span>

<span data-ttu-id="a0aee-223">Также следует построить проект базы данных, прежде чем вызывать VSDBCMD, чтобы DEPLOYMANIFEST-файл будет создан и готов для использования.</span><span class="sxs-lookup"><span data-stu-id="a0aee-223">You should also ensure that you build the database project before you invoke VSDBCMD so that the .deploymanifest file is created and ready to use.</span></span> <span data-ttu-id="a0aee-224">Вы увидите полный пример такого подхода в разделе [основные сведения о процессе построения](../web-deployment-in-the-enterprise/understanding-the-build-process.md), где описано, как файлы проекта в [примера решения диспетчера контактов](../web-deployment-in-the-enterprise/the-contact-manager-solution.md).</span><span class="sxs-lookup"><span data-stu-id="a0aee-224">You can see a full example of this approach in the topic [Understanding the Build Process](../web-deployment-in-the-enterprise/understanding-the-build-process.md), which walks you through the project files in the [Contact Manager sample solution](../web-deployment-in-the-enterprise/the-contact-manager-solution.md).</span></span>

## <a name="conclusion"></a><span data-ttu-id="a0aee-225">Заключение</span><span class="sxs-lookup"><span data-stu-id="a0aee-225">Conclusion</span></span>

<span data-ttu-id="a0aee-226">В этом разделе описано, как можно настроить свойства базы данных в другой целевой среды при развертывании проектов баз данных с помощью MSBuild и средство VSDBCMD.</span><span class="sxs-lookup"><span data-stu-id="a0aee-226">This topic described how you can tailor database properties to different destination environments when you deploy database projects using MSBuild and VSDBCMD.</span></span> <span data-ttu-id="a0aee-227">Этот подход полезен в тех случаях, когда необходимо выполнить развертывание проектов баз данных как часть большего размера, решений корпоративного уровня.</span><span class="sxs-lookup"><span data-stu-id="a0aee-227">This approach is useful when you need to deploy database projects as part of larger, enterprise-scale solutions.</span></span> <span data-ttu-id="a0aee-228">Эти решения часто развертываются в несколько назначений, таких как изолированные среды разработки или тестирования, промежуточной или интеграции платформ и рабочей среде или динамической среды.</span><span class="sxs-lookup"><span data-stu-id="a0aee-228">These solutions are often deployed to multiple destinations, like sandboxed development or test environments, staging or integration platforms, and production or live environments.</span></span> <span data-ttu-id="a0aee-229">Каждый из этих целевых средах обычно требуется уникальный набор свойства развертывания базы данных.</span><span class="sxs-lookup"><span data-stu-id="a0aee-229">Each of these target environments typically requires a unique set of database deployment properties.</span></span>

## <a name="further-reading"></a><span data-ttu-id="a0aee-230">Дополнительные сведения</span><span class="sxs-lookup"><span data-stu-id="a0aee-230">Further Reading</span></span>

<span data-ttu-id="a0aee-231">Дополнительные сведения о развертывании проектов баз данных, с помощью VSDBCMD.exe см. в разделе [развертывание проектов баз данных](../web-deployment-in-the-enterprise/deploying-database-projects.md).</span><span class="sxs-lookup"><span data-stu-id="a0aee-231">For more information on deploying database projects using VSDBCMD.exe, see [Deploying Database Projects](../web-deployment-in-the-enterprise/deploying-database-projects.md).</span></span> <span data-ttu-id="a0aee-232">Дополнительные сведения об использовании настраиваемых файлов проекта MSBuild для управления процессом развертывания, см. в разделе [основные сведения о файле проекта](../web-deployment-in-the-enterprise/understanding-the-project-file.md) и [основные сведения о процессе построения](../web-deployment-in-the-enterprise/understanding-the-build-process.md).</span><span class="sxs-lookup"><span data-stu-id="a0aee-232">For more information on using custom MSBuild project files to control the deployment process, see [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md) and [Understanding the Build Process](../web-deployment-in-the-enterprise/understanding-the-build-process.md).</span></span>

<span data-ttu-id="a0aee-233">В следующих статьях на сайте MSDN содержатся дополнительные общие рекомендации по развертыванию базы данных:</span><span class="sxs-lookup"><span data-stu-id="a0aee-233">These articles on MSDN provide more general guidance on database deployment:</span></span>

- <span data-ttu-id="a0aee-234">[Общие сведения о параметры проекта базы данных](https://msdn.microsoft.com/library/aa833291(v=VS.100).aspx)</span><span class="sxs-lookup"><span data-stu-id="a0aee-234">[An Overview of Database Project Settings](https://msdn.microsoft.com/library/aa833291(v=VS.100).aspx)</span></span>
- [<span data-ttu-id="a0aee-235">Практическое руководство. Настройка свойств для сведений о развертывании</span><span class="sxs-lookup"><span data-stu-id="a0aee-235">How to: Configure Properties for Deployment Details</span></span>](https://msdn.microsoft.com/library/dd172125.aspx)
- [<span data-ttu-id="a0aee-236">Создание и развертывание баз данных в изолированной среде разработки</span><span class="sxs-lookup"><span data-stu-id="a0aee-236">Build and Deploy Databases to an Isolated Development Environment</span></span>](https://msdn.microsoft.com/library/dd193409.aspx)
- [<span data-ttu-id="a0aee-237">Создание и развертывание баз данных в тестовой или рабочей среде</span><span class="sxs-lookup"><span data-stu-id="a0aee-237">Build and Deploy Databases to a Staging or Production Environment</span></span>](https://msdn.microsoft.com/library/dd193413.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="a0aee-238">[Назад](performing-a-what-if-deployment.md)
> [Вперед](deploying-database-role-memberships-to-test-environments.md)</span><span class="sxs-lookup"><span data-stu-id="a0aee-238">[Previous](performing-a-what-if-deployment.md)
[Next](deploying-database-role-memberships-to-test-environments.md)</span></span>
