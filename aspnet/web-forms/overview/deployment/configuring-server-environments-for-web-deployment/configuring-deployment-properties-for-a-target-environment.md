---
uid: web-forms/overview/deployment/configuring-server-environments-for-web-deployment/configuring-deployment-properties-for-a-target-environment
title: Настройка свойств развертывания для целевой среды | Документация Майкрософт
author: jrjlee
description: В этом разделе описывается настройка свойств конкретной среды для развертывания образца решения диспетчера контактов в определенной целевой среде...
ms.author: riande
ms.date: 05/04/2012
ms.assetid: b5b86e03-b8ed-46e6-90fa-e1da88ef34e9
msc.legacyurl: /web-forms/overview/deployment/configuring-server-environments-for-web-deployment/configuring-deployment-properties-for-a-target-environment
msc.type: authoredcontent
ms.openlocfilehash: 9742be7d718384c1b108d5f2c0c43e8e8d4fe8a9
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78516810"
---
# <a name="configuring-deployment-properties-for-a-target-environment"></a>Настройка свойств развертывания для целевой среды

кто [Джейсон Иванов](https://github.com/jrjlee)

[Скачать в формате PDF](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> В этом разделе описывается настройка свойств конкретной среды для развертывания примера решения диспетчера контактов в определенной целевой среде.

Этот раздел является частью серии руководств, основанных на требованиях Enterprise к развертыванию вымышленной компании Fabrikam, Inc. В этой серии руководств используется пример решения&#x2014; [диспетчера контактов](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) &#x2014;для представления веб-приложения с реалистичным уровнем сложности, включая приложение ASP.NET MVC 3, службу Windows Communication Foundation (WCF) и проект базы данных.

Метод развертывания в сердце этих учебников основан на подходе к файлам проекта Split, описанному в разделе [понимание процесса сборки](../web-deployment-in-the-enterprise/understanding-the-build-process.md), в котором процесс сборки управляется двумя файлами&#x2014;проекта, содержащими инструкции по сборке, которые применяются к каждой целевой среде, и одна содержит параметры сборки и развертывания, относящиеся к конкретной среде. Во время сборки файл проекта, зависящий от среды, объединяется в файл проекта независимо от среды, чтобы сформировать полный набор инструкций по сборке.

## <a name="process-overview"></a>Обзор процесса

Файл проекта, который будет использоваться для сборки и развертывания решения диспетчера контактов, делится на два физических файла:

- Один, содержащий универсальные параметры сборки и инструкции (файл *Publish. proj* ).
- Один содержит параметры сборки для конкретного окружения (*env-dev. proj*, *env-Stage. proj*и т. д.).

Во время сборки соответствующий файл проекта конкретной среды объединяется в файл универсальной *публикации. proj* для формирования полного набора инструкций по построению. Можно настроить развертывание в определенные целевые среды, создав или настроив файлы проекта для конкретной среды с помощью параметров, описывающих собственный сценарий развертывания.

Многие из этих значений определяются способом настройки&#x2014;целевой среды, независимо от того, настроен ли целевой веб-сервер для использования службы веб-Deployment Agent (удаленный агент) или обработчика веб-развертывание. Дополнительные сведения об этих подходах и рекомендации по выбору правильного подхода для вашей среды см. [в разделе Выбор правильного подхода к веб-развертыванию](choosing-the-right-approach-to-web-deployment.md).

Для [сценария диспетчера контактов](../deploying-web-applications-in-enterprise-scenarios/enterprise-web-deployment-scenario-overview.md) требуется два файла проекта для конкретной среды:

- Развертывание в тестовой среде разработчика (*env-dev. proj*). Среда тестирования для разработчиков настроена на прием удаленных развертываний с помощью удаленного агента, как описано в статье [Настройка тестовой среды для веб-развертывания](scenario-configuring-a-test-environment-for-web-deployment.md). Этот файл должен предоставлять адрес конечной точки удаленного агента, а также параметры для конкретного расположения, такие как строки подключения и конечные точки службы.
- Развертывание в промежуточной среде (*env-Stage. proj*). Промежуточная среда настроена для приема удаленных развертываний с помощью обработчика веб-развертывание, как описано в разделе [сценарий: Настройка промежуточной среды для веб-развертывания](scenario-configuring-a-staging-environment-for-web-deployment.md). Этот файл должен предоставить адрес конечной точки обработчика веб-развертывание, а также параметры для конкретного расположения, такие как строки подключения и конечные точки службы.

Важно отметить, что параметры, настроенные в файле проекта для конкретной среды, не влияют на содержимое самого&#x2014;веб-пакета, а определяют способ развертывания пакета и значения параметров, предоставляемые при извлечении пакета. Вы импортируете веб-пакет в рабочую среду вручную, как описано в [сценарии: Настройка рабочей среды для веб-развертывания](scenario-configuring-a-production-environment-for-web-deployment.md) и [Ручная установка веб-пакетов](../web-deployment-in-the-enterprise/manually-installing-web-packages.md), поэтому не имеет значения, какие параметры использовались в файле проекта конкретной среды при создании пакета. Диспетчер службы IIS (IIS) выводит запрос на ввод любых параметризованных значений, таких как строки подключения и конечные точки службы, при импорте пакета.

Чтобы развернуть решение диспетчера контактов в собственной целевой среде, можно либо настроить этот файл или использовать его в качестве шаблона, а также создать собственный файл.

**Настройка параметров развертывания, зависящих от среды, для решения диспетчера контактов**

1. Откройте решение ContactManager-WCF в Visual Studio 2010.
2. В окне **Обозреватель решений** разверните папку **Публикация** , разверните папку **енвконфиг** , а затем дважды щелкните **env-dev. proj**.

    ![](configuring-deployment-properties-for-a-target-environment/_static/image1.png)
3. Замените значения свойств в файле *env-dev. proj* на правильные значения для собственной тестовой среды.

    > [!NOTE]
    > В таблице, следующей за этой процедурой, содержатся дополнительные сведения о каждом из этих свойств.
4. Сохраните свою работу и закройте файл *env-dev. proj* .

## <a name="choosing-the-right-deployment-properties"></a>Выбор правильных свойств развертывания

В этой таблице описывается назначение каждого свойства в файле проекта Sample- *dev. proj*для конкретного окружения, а также приводятся некоторые рекомендации по предоставленным значениям.

|                                                        Имя свойства                                                         |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        Сведения                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|              <strong>Мсдеплойкомпутернаме</strong> Имя целевого веб-сервера или конечной точки службы.               |                                                                                                                                                                                                                                              При развертывании в службе удаленного агента на целевом веб-сервере можно указать имя целевого компьютера (например, <strong>TESTWEB1</strong> или <strong>TESTWEB1.fabrikam.NET</strong>) или указать конечную точку удаленного агента (например, `http://TESTWEB1/MSDEPLOYAGENTSERVICE`). В каждом случае развертывание работает одинаковым образом. Если выполняется развертывание в обработчик веб-развертывание на целевом веб-сервере, следует указать конечную точку службы и включить имя веб-сайта IIS в качестве параметра строки запроса (например, `https://STAGEWEB1:8172/MSDeploy.axd?site=DemoSite`).                                                                                                                                                                                                                                              |
|         <strong>Мсдеплойаус</strong> Метод, который веб-развертывание должен использоваться для проверки подлинности на удаленном компьютере.          |                                                                                                                                                                                                                          Это значение должно быть равно <strong>NTLM</strong> или <strong>Basic</strong>. Как правило, <strong>NTLM</strong> используется при развертывании в службе удаленного <strong>агента и при</strong> развертывании в обработчике веб-развертывание. При использовании обычной проверки подлинности также необходимо указать имя пользователя и пароль, которые должен олицетворять средство веб-развертывания IIS (веб-развертывание) для выполнения развертывания. В этом примере эти значения предоставляются с помощью свойств <strong>мсдеплойусернаме</strong> и <strong>мсдеплойпассворд</strong> . При использовании проверки подлинности NTLM можно опустить эти свойства или оставить их пустыми.                                                                                                                                                                                                                          |
| <strong>Мсдеплойусернаме</strong> Если используется обычная проверка подлинности, веб-развертывание будет использовать эту учетную запись на удаленном компьютере.  |                                                                                                                                                                                                                                                                                                                                                                                                                       Это должна быть форма <em>DOMAIN</em>\*имя_пользователя * (например, <strong>фабрикам\матт</strong>). Это значение используется только в том случае, если указана обычная проверка подлинности. Если используется проверка подлинности NTLM, свойство можно опустить. Если указано значение, оно будет пропущено.                                                                                                                                                                                                                                                                                                                                                                                                                        |
| <strong>Мсдеплойпассворд</strong> При использовании обычной проверки подлинности веб-развертывание будет использовать этот пароль на удаленном компьютере. |                                                                                                                                                                                                                                                                                                                                                                                                                    Это пароль для учетной записи пользователя, указанной в свойстве <strong>мсдеплойусернаме</strong> . Это значение используется только в том случае, если указана обычная проверка подлинности. Если используется проверка подлинности NTLM, свойство можно опустить. Если указано значение, оно будет пропущено.                                                                                                                                                                                                                                                                                                                                                                                                                    |
|     <strong>Контактманажерииспас</strong> Путь IIS, по которому необходимо развернуть приложение MVC диспетчера контактов.     |                                                                                                                                                                                                                                                                                                                                                                        Это должен быть путь, отображаемый в диспетчере IIS, в формате [<em>имя веб-сайта IIS</em>]/[имя<em>веб-</em><em>приложения</em>]. Помните, что веб-сайт IIS должен существовать до развертывания приложения. Например, если вы создали веб-сайт IIS с именем Демосите, можно указать путь IIS для приложения MVC как Демосите/ContactManager.                                                                                                                                                                                                                                                                                                                                                                        |
|   <strong>Контактманажерсервицеииспас</strong> Путь IIS, по которому требуется развернуть службу WCF диспетчера контактов.    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                          Например, если вы создали веб-сайт IIS с именем Демосите, можно указать путь IIS для службы WCF как <strong>демосите/контактманажерсервице</strong>.                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|                  <strong>Контактманажертаржетурл</strong> URL-адрес, по которому может быть достигнута служба WCF.                   |                                                                                                                                                     Будет получен следующий вид: [<em>корневой URL-адрес сайта IIS</em>]/[<em>имя приложения службы</em>]/[<em>Конечная точка службы</em>]. Например, если вы создали веб-сайт IIS на порту 85, URL-адрес будет иметь форму `http://localhost:85/ContactManagerService/ContactService.svc`. Помните, что приложение MVC и служба WCF развертываются на одном и том же сервере. Поэтому доступ к этому URL-адресу возможен только с компьютера, на котором он установлен. По этой причине лучше использовать localhost или IP-адрес, а не имя компьютера или заголовок узла в URL-адресе. Если вы используете имя компьютера или заголовок узла, функция безопасности [проверки на замыкание на себя](https://go.microsoft.com/?linkid=9805131) в IIS может заблокировать URL-адрес и вернуть ошибку <strong>HTTP 401,1-несанкционированный</strong> доступ.                                                                                                                                                     |
|                  <strong>Кмдатабасеконнектионстринг</strong> Строка подключения для сервера базы данных.                  | Строка подключения определяет как учетные данные, которые будут использоваться VSDBCMD для связи с сервером базы данных, так и учетные данные, которые будут использоваться пулом приложений веб-сервера для связи с сервером базы данных и взаимодействия с базой данных. По сути, у вас есть два варианта. Можно указать <strong>встроенную безопасность = true</strong>. в этом случае используется встроенная проверка подлинности Windows: <strong>Data Source = TESTDB1; Integrated Security = true</strong> в этом случае база данных будет создана с использованием учетных данных пользователя, запускающего исполняемый файл VSDBCMD, и приложение будет обращаться к базе данных, используя удостоверение учетной записи компьютера веб-сервера. Кроме того, можно указать имя пользователя и пароль учетной записи SQL Server. В этом случае учетные данные SQL Server используются программой VSDBCMD для создания базы данных и пулом приложений для взаимодействия с базой данных: <strong>Data Source = TESTDB1; Идентификатор пользователя = Асклусер; Password = PA $ $w 0rd</strong> . в этом разделе пошаговые руководства предполагают, что используется встроенная проверка подлинности Windows. |
|        <strong>Кмтаржетдатабасе</strong> Имя, которое будет присвоено базе данных, создаваемой на сервере базы данных.        |                                                                                                                                                                                                                                                                                                                                                                                                                                                     Предоставленное здесь значение добавляется в команду VSDBCMD в качестве параметра. Он также используется для создания полной строки подключения, которую пул приложений на веб-сервере может использовать для взаимодействия с базой данных.                                                                                                                                                                                                                                                                                                                                                                                                                                                     |

В этих примерах показано, как можно настроить эти свойства для конкретных сценариев развертывания.

### <a name="example-1x2014deployment-to-the-remote-agent-service"></a>Пример 1&#x2014;. Развертывание в удаленной службе агента

В данном примере:

- Выполняется развертывание в службу удаленного агента на TESTWEB1.
- Вы указываете веб-развертывание использовать проверку подлинности NTLM. Веб-развертывание будут выполняться с использованием учетных данных, которые использовались для вызова Microsoft Build Engine (MSBuild).
- Вы используете встроенную проверку подлинности для развертывания базы данных **ContactManager** в TESTDB1. База данных будет развернута с использованием учетных данных, которые использовались для вызова MSBuild.

[!code-xml[Main](configuring-deployment-properties-for-a-target-environment/samples/sample1.xml)]

### <a name="example-2x2014deployment-to-the-web-deploy-handler-endpoint"></a>Пример 2&#x2014;. Развертывание в конечной точке обработчика веб-развертывание

В данном примере:

- Выполняется развертывание в конечной точке службы обработчика веб-развертывание в STAGEWEB1.
- Вы указываете веб-развертывание использовать обычную проверку подлинности.
- Вы указываете, что веб-развертывание должен олицетворять учетную запись Фабрикам\стагингдеплойер на удаленном компьютере.
- Вы используете SQL Server проверку подлинности для развертывания базы данных **ContactManager** в STAGEDB1.

[!code-xml[Main](configuring-deployment-properties-for-a-target-environment/samples/sample2.xml)]

## <a name="conclusion"></a>Заключение

На этом этапе файлы проекта полностью настроены для создания и развертывания решения диспетчера контактов в одной или нескольких конечных средах.

Чтобы использовать эти файлы проекта в рамках одношагового, повторяемого процесса развертывания, необходимо выполнить файл *Publish. proj* с помощью MSBuild и передать в качестве параметра расположение файла проекта, относящегося к конкретной среде. Это можно сделать различными способами.

- Общие сведения о MSBuild и общие сведения о файлах пользовательских проектов см. [в разделе Основные сведения о файле проекта](../web-deployment-in-the-enterprise/understanding-the-project-file.md).
- Сведения о том, как сформулировать команду MSBuild, которая выполняет файлы пользовательских проектов, см. в разделе [Развертывание веб-пакетов](../web-deployment-in-the-enterprise/deploying-web-packages.md).
- Сведения о том, как внедрять команды MSBuild в командный файл для одношаговых и повторяемых развертываний, см. в разделе [Создание и запуск командного файла развертывания](../web-deployment-in-the-enterprise/creating-and-running-a-deployment-command-file.md).
- Сведения о том, как выполнять пользовательские файлы проекта из Team Build, см. в разделе [Создание определения сборки, поддерживающего развертывание](../configuring-team-foundation-server-for-web-deployment/creating-a-build-definition-that-supports-deployment.md).

> [!div class="step-by-step"]
> [Назад](creating-a-server-farm-with-the-web-farm-framework.md)
