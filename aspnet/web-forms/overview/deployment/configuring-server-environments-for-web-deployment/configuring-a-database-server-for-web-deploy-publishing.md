---
uid: web-forms/overview/deployment/configuring-server-environments-for-web-deployment/configuring-a-database-server-for-web-deploy-publishing
title: Настройка сервера базы данных для веб-публикации развертывания | Документация Майкрософт
author: jrjlee
description: В этом разделе описывается настройка сервера базы данных SQL Server 2008 R2 для поддержки веб-развертывания и публикации. Задачи, описанные в этом разделе, co...
ms.author: riande
ms.date: 05/04/2012
ms.assetid: e7c447f9-eddf-4bbe-9f18-3326d965d093
msc.legacyurl: /web-forms/overview/deployment/configuring-server-environments-for-web-deployment/configuring-a-database-server-for-web-deploy-publishing
msc.type: authoredcontent
ms.openlocfilehash: ade3c1ba1c470092f512436f39b8831458408c2c
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2019
ms.locfileid: "65131576"
---
# <a name="configuring-a-database-server-for-web-deploy-publishing"></a>Настройка сервера базы данных для публикации веб-развертывания

по [Джейсон Lee](https://github.com/jrjlee)

[Загрузить PDF-файл](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> В этом разделе описывается настройка сервера базы данных SQL Server 2008 R2 для поддержки веб-развертывания и публикации.
> 
> Задачи, описанные в этом разделе являются общими для всех сценариев развертывания&#x2014;неважно веб-серверы настроены для использования удаленной службы агента средство веб-развертывания IIS (веб-развертывания), веб-обработчик развертывания или развертывания в автономном режиме или в приложение выполняется на одном веб-сервере или ферме серверов. Способ развертывания базы данных могут быть изменены в соответствии с требованиями безопасности и другие вопросы. К примеру вы можете развернуть базы данных с или без образец данных и может развернуть сопоставлений ролей пользователей или настроить их вручную после развертывания. Однако способ настройки сервера базы данных остается неизменным.

Установите все дополнительные продукты и средства для настройки сервера базы данных для поддержки веб-развертывания не нужно. Предположим, что серверу базы данных и веб-сервер работают на разных компьютерах, нужно просто:

- Разрешить SQL Server обмениваться данными по протоколу TCP/IP.
- Разрешает трафик SQL Server через все брандмауэры.
- Предоставьте учетную запись компьютера сервера web имени входа SQL Server.
- Сопоставьте имя входа учетной записи компьютера в любые роли базы данных.
- Предоставьте учетной записи, которая будет выполняться развертывание разрешения создатель имя входа и базы данных SQL Server.
- Для поддержки повторных развертываний, сопоставить имя входа учетной записи развертывания для **db\_владельца** роли базы данных.

В этом разделе показано, как выполнить каждую из этих процедур. Задачи и пошаговые руководства в этом разделе предполагается, что вы начинаете с экземпляром по умолчанию SQL Server 2008 R2 для систем под управлением Windows Server 2008 R2. Прежде чем продолжить, убедитесь, что:

- Пакет обновления 1 для Windows Server 2008 R2 и все доступные обновления будут установлены.
- Сервер присоединен к домену.
- Сервер имеет статический IP-адрес.
- SQL Server 2008 R2 с пакетом обновления 1 и все доступные обновления будут установлены.

Экземпляр SQL Server требуется только включить **службы компонента Database Engine** роли, которая автоматически включается в любой установке SQL Server. Однако для простоты настройки и обслуживания, мы рекомендуем добавить **основные средства управления** и **средства управления — полный** ролей сервера.

> [!NOTE]
> Дополнительные сведения о присоединении к домену компьютеров, см. в разделе [присоединение к домену и вход](https://technet.microsoft.com/library/cc725618(v=WS.10).aspx). Дополнительные сведения о настройке статического IP-адресов, см. в разделе [настроить статический IP-адрес](https://technet.microsoft.com/library/cc754203(v=ws.10).aspx). Дополнительные сведения об установке SQL Server см. в разделе [Установка SQL Server 2008 R2](https://technet.microsoft.com/library/bb500395.aspx).

## <a name="enable-remote-access-to-sql-server"></a>Включить удаленный доступ к SQL Server

SQL Server использует TCP/IP для взаимодействия с удаленными компьютерами. Если серверу базы данных и веб-сервер находятся на разных компьютерах, необходимо:

- Настройка сетевых параметров SQL Server, чтобы обеспечить обмен данными по протоколу TCP/IP.
- Настройте все брандмауэры оборудования или программного обеспечения, чтобы разрешить TCP-трафик (и в некоторых случаях протокола UDP (User Datagram) трафик) через порты, которые использует экземпляр SQL Server.

Чтобы включить SQL Server обмениваться данными по протоколу TCP/IP, используйте диспетчер конфигурации SQL Server для изменения конфигурации сети для экземпляра SQL Server.

**Чтобы включить SQL Server обмениваться данными по протоколу TCP/IP**

1. На **запустить** последовательно выберите пункты **все программы**, нажмите кнопку **Microsoft SQL Server 2008 R2**, нажмите кнопку **средства настройки**, а затем нажмите кнопку **Диспетчер конфигурации SQL Server**.
2. В области представления дерева разверните **сетевая конфигурация SQL Server**, а затем нажмите кнопку **протоколы для MSSQLSERVER**.

   > [!NOTE]
   > Если вы установили несколько экземпляров SQL Server, вы увидите <strong>протоколы для</strong><em>[имя_экземпляра]</em> элемента для каждого экземпляра. Необходимо настроить параметры сети на основе экземпляра, экземпляр.
3. В области сведений щелкните правой кнопкой мыши **TCP/IP** строк, а затем нажмите кнопку **включить**.

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image1.png)
4. В **предупреждение** диалоговом окне щелкните **ОК**.

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image2.png)
5. Необходимо перезапустить службы MSSQLSERVER, прежде чем конфигурацию сети вступят в силу. Это выполняется в командной строке, из консоли "службы" или из SQL Server Management Studio. В этой процедуре вы используете SQL Server Management Studio.
6. Закройте диспетчер конфигурации SQL Server.
7. На **запустить** последовательно выберите пункты **все программы**, нажмите кнопку **Microsoft SQL Server 2008 R2**, а затем нажмите кнопку **SQL Server Management Studio**.
8. В **соединение с сервером** отображаемое в диалоговом окне **имя_сервера** введите имя сервера базы данных и нажмите кнопку **Connect**.

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image3.png)
9. В **обозревателя объектов** панели, щелкните правой кнопкой мыши родительский узел сервера (например, **TESTDB1**) и нажмите кнопку **перезапустите**.

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image4.png)
10. В **Microsoft SQL Server Management Studio** диалоговом окне щелкните **Да**.

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image5.png)
11. После перезапуска службы, закройте SQL Server Management Studio.

Чтобы разрешить трафик SQL Server через брандмауэр, сначала необходимо знать, какие порты использует экземпляр SQL Server. Это будет зависеть как экземпляр SQL Server был создан и настроен:

- Объект *экземпляр по умолчанию* из SQL Server прослушивает (и реагирует на) запросы через порт TCP 1433.
- Объект *именованный экземпляр* из SQL Server прослушивает (и реагирует на) запросов динамически назначаемый порт TCP.
- Если служба обозревателя SQL Server включена, клиенты могут запрашивать службы через порт UDP 1434, чтобы узнать, какие TCP-порт, используемый для конкретного экземпляра SQL Server. Тем не менее эта служба отключена часто по соображениям безопасности.

При условии, что вы используете экземпляр SQL Server по умолчанию, необходимо настроить брандмауэр для разрешения трафика.

| Направление | Из порта | К порту | Тип порта |
| --- | --- | --- | --- |
| Входящих подключений | Любой | 1433 | TCP |
| Исходящие | 1433 | Любой | TCP |

> [!NOTE]
> С технической точки зрения клиентский компьютер будет использовать назначенный случайным образом TCP-порт от 1024 до 5000 для взаимодействия с SQL Server, и правила брандмауэра можно ограничить соответствующим образом. Дополнительные сведения о SQL Server порты и брандмауэры, см. в разделе [номерами портов TCP/IP, необходимые для взаимодействия с SQL через брандмауэр](https://go.microsoft.com/?linkid=9805125) и [как: Настройка сервера для прослушивания определенного TCP-порта (диспетчер конфигурации SQL Server)](https://msdn.microsoft.com/library/ms177440.aspx).

В большинстве сред Windows Server скорее всего появится для настройки брандмауэра Windows на сервере базы данных. По умолчанию брандмауэр Windows разрешает весь исходящий трафик, если правило специально запрещает его. Чтобы включить веб-сервера для доступа к базе данных, необходимо настроить правило входящего трафика, разрешающее трафик TCP на номер порта, используемый экземпляром SQL Server. Если вы используете экземпляр SQL Server по умолчанию, можно использовать следующую процедуру для настройки этого правила.

**Чтобы настроить брандмауэр Windows для разрешения взаимодействия с экземпляром SQL Server по умолчанию**

1. На сервере базы данных на **запустить** последовательно выберите пункты **Администрирование**, а затем нажмите кнопку **брандмауэр Windows в режиме повышенной безопасности**.
2. В области представления дерева щелкните **правила для входящих подключений**.

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image6.png)
3. В **действия** панели в разделе **правила для входящих подключений**, нажмите кнопку **новое правило**.
4. В мастера на **тип правила** выберите **порт**, а затем нажмите кнопку **Далее**.

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image7.png)
5. На **протокол и порты** странице, убедитесь, что **TCP** выбран и в **определенные локальные порты** введите **1433**, а затем нажмите кнопку **Далее**.

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image8.png)
6. На **действие** странице, оставьте **разрешить подключение** и нажмите кнопку **Далее**.
7. На **профиль** странице, оставьте **домена** выбран, снимите **частного** и **открытый** флажки и нажмите кнопку  **Далее**.

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image9.png)
8. На **имя** странице, введите подходящим образом описательное имя правила (например, **экземпляр SQL Server по умолчанию — доступ к сети**) и нажмите кнопку **Готово**.

Дополнительные сведения о настройке брандмауэра Windows для SQL Server, особенно в том случае, если вам нужно обмениваться данными с SQL Server через нестандартные или динамических портов, см. в разделе [как: Настройка брандмауэра Windows для доступа к ядру СУБД](https://technet.microsoft.com/library/ms175043.aspx).

## <a name="configure-logins-and-database-permissions"></a>Настройка имен входа и разрешения базы данных

При развертывании веб-приложения для Internet Information Services (IIS), приложение выполняется с помощью удостоверения пула приложений. В среде домена удостоверения пула приложений используйте учетную запись компьютера сервера, на котором они выполняются для доступа к сетевым ресурсам. Учетные записи компьютера имеют вид <em>[домен]</em><strong>\</ strong ><em>[имя_компьютера]</em><strong>$</strong>&#x2014;к примеру, <strong>FABRIKAM\TESTWEB1$</strong>. Чтобы разрешить веб-приложения для доступа к базе данных по сети, вам потребуется:

- Добавьте имя входа для учетной записи компьютера web server к экземпляру SQL Server.
- Сопоставить имя входа учетной записи компьютера в любые роли базы данных (обычно **db\_datareader** и **db\_datawriter**).

Если веб-приложение работает на ферме серверов, а не один сервер, необходимо повторить эти действия для каждого веб-сервера в ферме серверов.

> [!NOTE]
> Дополнительные сведения о удостоверения пула приложений, доступ к ресурсам, см. в разделе [удостоверения пула приложений](https://go.microsoft.com/?linkid=9805123).

Можно использовать эти задачи по-разному. Чтобы создать имя входа, вы можете сделать следующее.

- Вручную создайте имя входа на сервере базы данных, с помощью Transact-SQL или SQL Server Management Studio.
- Использование проекта сервера SQL Server 2008 в Visual Studio для создания и развертывания имени входа.

Имени входа SQL Server является объектом уровня сервера, а не объект уровня базы данных, поэтому он не зависит от базы данных, которую вы хотите развернуть. Таким образом в любой момент можно создать имя входа и самый простой подход часто применяются для создания имени входа вручную на сервере базы данных, прежде чем приступать к развертыванию баз данных. Создание имени входа в SQL Server Management Studio можно использовать следующую процедуру.

**Создание имени входа SQL Server для учетной записи компьютера сервера web**

1. На сервере базы данных на **запустить** последовательно выберите пункты **все программы**, нажмите кнопку **Microsoft SQL Server 2008 R2**, а затем нажмите кнопку **SQL Server Management Studio** .
2. В **соединение с сервером** отображаемое в диалоговом окне **имя_сервера** введите имя сервера базы данных и нажмите кнопку **Connect**.

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image10.png)
3. В **обозревателя объектов** области щелкните правой кнопкой мыши **безопасности**, пункты **New**, а затем нажмите кнопку **входа**.
4. В **Создание имени входа** отображаемое в диалоговом окне **имя входа** введите имя учетной записи компьютера сервера веб (например, **FABRIKAM\TESTWEB1$**).

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image11.png)
5. Нажмите кнопку **ОК**.

На этом этапе сервер базы данных будет готов для публикации веб-развертывания. Тем не менее все решения, развертываемого не будет работать, пока сопоставить имя входа учетной записи компьютера в роли базы данных требуется. Сопоставление имени входа к роли базы данных требует много более рассматривать, как вы не карты роли до, после того как вы развернули базы данных. Чтобы сопоставить имя входа учетной записи компьютера в роли базы данных требуется, вы можете сделать следующее.

- Назначение ролей базы данных с именем входа вручную, после развертывания базы данных в первый раз.
- Используйте сценарий после развертывания для назначения ролей базы данных с именем входа.

Дополнительные сведения об автоматизации создания имен входа и сопоставления роли базы данных см. в разделе [развертывание членства роли базы данных для сред тестирования](../advanced-enterprise-web-deployment/deploying-database-role-memberships-to-test-environments.md). В качестве альтернативы можно использовать следующую процедуру для сопоставления имени входа учетной записи компьютера в роли базы данных требуется вручную. Помните, что нельзя выполнить эту процедуру до *после* развертывания базы данных.

**Чтобы сопоставить базу данных ролей для веб-сервере, учетной записи входа**

1. Откройте SQL Server Management Studio, как и раньше.
2. В **обозревателя объектов** панели разверните **безопасности** узел, разверните **имена входа** узел и дважды щелкните имя входа учетной записи компьютера (например,  **FABRIKAM\TESTWEB1$**).

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image12.png)
3. В **свойства имени входа** диалоговом окне щелкните **сопоставления пользователей**.
4. В **пользователи, сопоставленные с этим именем входа** таблицы, выберите имя базы данных (например, **ContactManager**).
5. В **членство в роли для базы данных:** *[Имя_базы_данных]* выберите необходимые разрешения. В случае пример решения диспетчера контактов, необходимо выбрать **db\_datareader** и **db\_datawriter** ролей.

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image13.png)
6. Нажмите кнопку **ОК**.

Хотя вручную сопоставление ролей базы данных часто является более чем достаточно для тестовых сред, это менее предпочтителен для развертывания автоматической или одним щелчком в промежуточной или рабочей среде. Можно найти дополнительные сведения об автоматизации такого рода задач с помощью сценариев после развертывания в [развертывание членства роли базы данных для сред тестирования](../advanced-enterprise-web-deployment/deploying-database-role-memberships-to-test-environments.md).

> [!NOTE]
> Дополнительные сведения о проектам сервера и базы данных, см. в разделе [проекты базы данных Visual Studio 2010 SQL Server](https://msdn.microsoft.com/library/ff678491.aspx).

## <a name="configure-permissions-for-the-deployment-account"></a>Настройка разрешений для учетной записи развертывания

Если учетной записи, которое будет использоваться для запуска развертывания не является администратором SQL Server, вам также потребуется создать имя входа для этой учетной записи. Чтобы создать базу данных, учетная запись должна быть членом **dbcreator** роли сервера или иметь равнозначные права.

> [!NOTE]
> При использовании веб-развертывания или средство VSDBCMD развертывание базы данных, можно использовать учетные данные Windows или SQL Server (если экземпляр SQL Server настроен для поддержки проверки подлинности в смешанном режиме). Следующая процедура подразумевает, что вы хотите использовать учетные данные Windows, но ничто не мешает вам указывать имя пользователя SQL Server и пароль в строке подключения, при настройке развертывания.

**Чтобы задать разрешения для учетной записи развертывания**

1. Откройте SQL Server Management Studio, как и раньше.
2. В **обозревателя объектов** области щелкните правой кнопкой мыши **безопасности**, пункты **New**, а затем нажмите кнопку **входа**.
3. В **Создание имени входа** отображаемое в диалоговом окне **имя входа** введите имя учетной записи развертывания (например, **FABRIKAM\matt**).
4. В **Выбор страницы** панели щелкните **ролей сервера**.
5. Выберите **dbcreator**, а затем нажмите кнопку **ОК**.

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image14.png)

Для поддержки последующих развертываний, вам также потребуется добавить учетную запись, развертывание для **db\_владельца** роль в базе данных после первого развертывания. Это обусловлено тем, в последующих развертываниях вы изменение схемы существующей базы данных вместо создания новой базы данных. Как описано в предыдущем разделе, невозможно добавить пользователя к роли базы данных, пока не будут созданы базы данных, по очевидным причинам.

**Чтобы сопоставить имя входа учетной записи развертывания базы данных\_владельца роли базы данных**

1. Откройте SQL Server Management Studio, как и раньше.
2. В **обозревателя объектов** окне разверните **безопасности** узел, разверните **имена входа** узел и дважды щелкните имя входа учетной записи компьютера (например,  **FABRIKAM\matt**).
3. В **свойства имени входа** диалоговом окне щелкните **сопоставления пользователей**.
4. В **пользователи, сопоставленные с этим именем входа** таблицы, выберите имя базы данных (например, **ContactManager**).
5. В **членство в роли для базы данных:** *[Имя_базы_данных]* выберите **db\_владельца** роли.

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image15.png)
6. Нажмите кнопку **ОК**.

## <a name="conclusion"></a>Заключение

Сервер базы данных теперь должен быть готов для принятия развертываний удаленных баз данных и разрешить удаленный веб-серверы IIS, чтобы доступ к базам данных. Прежде чем развертывать и использовать базы данных, вы можете проверить следующие основные моменты:

- Вы настроили SQL Server для удаленных соединений TCP/IP?
- Вы настроили все брандмауэры, чтобы разрешить трафик SQL Server?
- Вы создали имя входа учетной записи компьютера для каждого веб-сервера, который получит доступ к SQL Server?
- Развертывание базы данных включает скрипт для создания сопоставлений ролей пользователей, или необходимо создать их вручную после развертывания базы данных в первый раз?
- Вы создали имя входа для учетной записи развертывания и добавили его **dbcreator** роли сервера?

## <a name="further-reading"></a>Дополнительные сведения

Руководство по развертыванию проектов баз данных, см. в разделе [развертывание проектов баз данных](../web-deployment-in-the-enterprise/deploying-database-projects.md). Рекомендации по созданию членства в роли базы данных, выполнив сценарий после развертывания, см. в разделе [развертывание членства роли базы данных для сред тестирования](../advanced-enterprise-web-deployment/deploying-database-role-memberships-to-test-environments.md). Рекомендации о том, как для решения проблем развертывания, которые баз данных членства, см. в разделе [развертывание баз данных членства в корпоративных средах](../advanced-enterprise-web-deployment/deploying-membership-databases-to-enterprise-environments.md).

> [!div class="step-by-step"]
> [Назад](configuring-a-web-server-for-web-deploy-publishing-offline-deployment.md)
> [Вперед](creating-a-server-farm-with-the-web-farm-framework.md)
