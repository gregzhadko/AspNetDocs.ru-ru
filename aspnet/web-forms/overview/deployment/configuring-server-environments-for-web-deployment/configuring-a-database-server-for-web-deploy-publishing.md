---
uid: web-forms/overview/deployment/configuring-server-environments-for-web-deployment/configuring-a-database-server-for-web-deploy-publishing
title: Настройка сервера базы данных для веб-развертывание публикации | Документация Майкрософт
author: jrjlee
description: В этом разделе описывается настройка сервера базы данных SQL Server 2008 R2 для поддержки веб-развертывания и публикации. Задачи, описанные в этом разделе, относятся ко всем
ms.author: riande
ms.date: 05/04/2012
ms.assetid: e7c447f9-eddf-4bbe-9f18-3326d965d093
msc.legacyurl: /web-forms/overview/deployment/configuring-server-environments-for-web-deployment/configuring-a-database-server-for-web-deploy-publishing
msc.type: authoredcontent
ms.openlocfilehash: ade3c1ba1c470092f512436f39b8831458408c2c
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78515244"
---
# <a name="configuring-a-database-server-for-web-deploy-publishing"></a>Настройка сервера базы данных для публикации веб-развертывания

кто [Джейсон Иванов](https://github.com/jrjlee)

[Скачать в формате PDF](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> В этом разделе описывается настройка сервера базы данных SQL Server 2008 R2 для поддержки веб-развертывания и публикации.
> 
> Задачи, описанные в этом разделе, являются общими для всех&#x2014;сценариев развертывания, но не имеет значения, настроены ли веб-серверы для использования службы удаленного агента веб-развертывания IIS (веб-развертывание), обработчика веб-развертывание или автономного развертывания или приложения, работающего на одном веб-сервере или ферме серверов. Способ развертывания базы данных может изменяться в соответствии с требованиями безопасности и другими соображениями. Например, вы можете развернуть базу данных с демонстрационными данными или без них, а также развернуть сопоставления ролей пользователей или настроить их вручную после развертывания. Однако способ настройки сервера базы данных остается неизменным.

Чтобы настроить сервер базы данных для поддержки веб-развертывания, не нужно устанавливать дополнительные продукты или средства. Если сервер базы данных и веб-сервер работают на разных компьютерах, необходимо просто:

- Разрешение SQL Server на обмен данными по протоколу TCP/IP.
- Разрешение SQL Server трафика через брандмауэры.
- Присвойте учетной записи компьютера веб-сервера имя входа SQL Server.
- Сопоставьте имя входа учетной записи компьютера с любыми необходимыми ролями базы данных.
- Предоставьте учетной записи, которая будет запускать развертывание, разрешения SQL Server входа и создателя базы данных.
- Для поддержки повторных развертываний сопоставьте учетной записи развертывания имя входа с ролью базы данных **\_владелец** .

В этом разделе будет показано, как выполнить каждую из этих процедур. В задачах и пошаговых руководствах этого раздела предполагается, что вы начинаете с экземпляра по умолчанию SQL Server 2008 R2 под Windows Server 2008 R2. Прежде чем продолжить, убедитесь в том, что:

- Windows Server 2008 R2 с пакетом обновления 1 (SP1) и все доступные обновления установлены.
- Сервер присоединен к домену.
- Сервер имеет статический IP-адрес.
- SQL Server 2008 R2 с пакетом обновления 1 (SP1) и все доступные обновления установлены.

Экземпляр SQL Server должен содержать роль **ядро СУБД Services** , которая автоматически включается в любой SQL Server установки. Однако для простоты настройки и обслуживания рекомендуется включить **средства управления — основные** **средства и инструменты управления — полные** роли сервера.

> [!NOTE]
> Дополнительные сведения о присоединении компьютеров к домену см. в разделе [Присоединение компьютеров к домену и вход в систему](https://technet.microsoft.com/library/cc725618(v=WS.10).aspx). Дополнительные сведения о настройке статических IP-адресов см. в статье [Настройка статического IP-](https://technet.microsoft.com/library/cc754203(v=ws.10).aspx)адреса. Дополнительные сведения об установке SQL Server см. в разделе [installing SQL Server 2008 R2](https://technet.microsoft.com/library/bb500395.aspx).

## <a name="enable-remote-access-to-sql-server"></a>Включение удаленного доступа к SQL Server

SQL Server использует протокол TCP/IP для связи с удаленными компьютерами. Если сервер базы данных и веб-сервер находятся на разных компьютерах, необходимо:

- Настройте SQL Server параметры сети, чтобы разрешить обмен данными по протоколу TCP/IP.
- Настройте все брандмауэры и оборудование, чтобы разрешить трафик TCP (а в некоторых случаях трафик UDP) на портах, используемых экземпляром SQL Server.

Чтобы разрешить SQL Server взаимодействие по протоколу TCP/IP, используйте диспетчер конфигурации SQL Server, чтобы изменить конфигурацию сети для экземпляра SQL Server.

**Включение SQL Server для взаимодействия по протоколу TCP/IP**

1. В меню **Пуск** последовательно выберите пункты **все программы**, **Microsoft SQL Server 2008 R2**, **средства настройки**и щелкните **Диспетчер конфигурации SQL Server**.
2. На панели древовидного представления разверните узел **SQL Server конфигурация сети**, а затем щелкните **протоколы для MSSQLSERVER**.

   > [!NOTE]
   > Если вы установили несколько экземпляров SQL Server, вы увидите для каждого экземпляра <strong>протоколы для</strong>элемента<em>[имя экземпляра]</em> . Необходимо настроить параметры сети на основе экземпляра.
3. В области сведений щелкните правой кнопкой мыши строку **TCP/IP** и выберите пункт **включить**.

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image1.png)
4. В диалоговом окне **предупреждение** нажмите кнопку **ОК**.

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image2.png)
5. Прежде чем новая конфигурация сети вступит в силу, необходимо перезапустить службу MSSQLSERVER. Это можно сделать из командной строки, из консоли служб или из SQL Server Management Studio. В этой процедуре вы будете использовать SQL Server Management Studio.
6. Закройте диспетчер конфигурации SQL Server.
7. В меню **Пуск** укажите пункт **все программы**, выберите **Microsoft SQL Server 2008 R2**, а затем щелкните **SQL Server Management Studio**.
8. В диалоговом окне **соединение с сервером** в поле **имя сервера** введите имя сервера базы данных и нажмите кнопку **подключить**.

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image3.png)
9. В области **Обозреватель объектов** щелкните правой кнопкой мыши родительский узел сервера (например, **TESTDB1**) и выберите пункт **перезапустить**.

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image4.png)
10. В диалоговом окне **Management Studio Microsoft SQL Server** нажмите кнопку **Да**.

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image5.png)
11. После перезапуска службы закройте SQL Server Management Studio.

Чтобы разрешить SQL Server трафика через брандмауэр, сначала необходимо знать, какие порты использует экземпляр SQL Server. Это будет зависеть от того, как был создан и настроен экземпляр SQL Server.

- *Экземпляр по умолчанию* SQL Server прослушивает запросы к TCP-порту 1433 (и отвечает на него).
- *Именованный экземпляр* SQL Server прослушивает запросы к динамически НАЗНАЧЕНному TCP-порту (и отвечает на него).
- Если служба обозреватель SQL Server включена, клиенты могут запрашивать службу через UDP-порт 1434, чтобы узнать, какой порт TCP использовать для конкретного экземпляра SQL Server. Однако эта служба часто отключена по соображениям безопасности.

Если вы используете экземпляр SQL Server по умолчанию, необходимо настроить брандмауэр для разрешения трафика.

| Направление | Из порта | В порт | Тип порта |
| --- | --- | --- | --- |
| Входящий трафик | Любой | 1433 | TCP |
| Исходящие | 1433 | Любой | TCP |

> [!NOTE]
> С технической точки зрения, клиентский компьютер будет использовать для связи с SQL Server случайным образом назначенный TCP-порт между 1024 и 5000, а правила брандмауэра можно ограничить соответствующим образом. Дополнительные сведения о SQL Server портах и брандмауэрах см. в разделе [номера портов TCP/IP, необходимые для обмена данными с SQL через брандмауэр](https://go.microsoft.com/?linkid=9805125) и [как настроить сервер для прослушивания определенного TCP-порта (диспетчер конфигурации SQL Server)](https://msdn.microsoft.com/library/ms177440.aspx).

В большинстве сред Windows Server, скорее всего, потребуется настроить брандмауэр Windows на сервере базы данных. По умолчанию брандмауэр Windows разрешает весь исходящий трафик, если только правило не запрещает его. Чтобы веб-сервер был доступен для базы данных, необходимо настроить правило входящего трафика, разрешающее трафик TCP по номеру порта, который используется экземпляром SQL Server. Если вы используете экземпляр SQL Server по умолчанию, для настройки этого правила можно использовать следующую процедуру.

**Настройка брандмауэра Windows для разрешения взаимодействия с экземпляром SQL Server по умолчанию**

1. На сервере базы данных в меню " **Пуск** " выберите пункт " **Администрирование**", а затем " **Брандмауэр Windows в области повышенной безопасности**".
2. На панели древовидного представления щелкните **правила для входящих подключений**.

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image6.png)
3. В области **действия** в разделе **правила для входящих подключений**щелкните **новое правило**.
4. В мастере создания правила для нового входящего подключения на странице **тип правила** выберите **порт**и нажмите кнопку **Далее**.

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image7.png)
5. На странице **протокол и порты** убедитесь, что выбран **протокол TCP** , а в поле **определенные локальные порты** введите **1433**, а затем нажмите кнопку **Далее**.

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image8.png)
6. На странице **действие** оставьте выбранным **параметр Разрешить подключение** и нажмите кнопку **Далее**.
7. На странице **профиль** оставьте выбранным параметр **домен** , снимите флажки **закрыто** и **общедоступно** и нажмите кнопку **Далее**.

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image9.png)
8. На странице **имя** присвойте правилу уникальное описательное имя (например, **SQL Server экземпляр по умолчанию — сетевой доступ**), а затем нажмите кнопку **Готово**.

Дополнительные сведения о настройке брандмауэра Windows для SQL Server, особенно если необходимо взаимодействовать с SQL Server по нестандартным или динамическим портам, см. [в разделе как настроить брандмауэр Windows для доступа ядро СУБД](https://technet.microsoft.com/library/ms175043.aspx).

## <a name="configure-logins-and-database-permissions"></a>Настройка имен для входа и разрешений базы данных

При развертывании веб-приложения на службы IIS (IIS) приложение выполняется с использованием удостоверения пула приложений. В среде домена удостоверения пула приложений используют учетную запись компьютера сервера, на котором они работают для доступа к сетевым ресурсам. Учетные записи компьютеров принимают <em>форму [домен имя]</em><strong>\</strong ><em>[имя компьютера]</em> <strong>$</strong> &#x2014;например <strong>FABRIKAM\TESTWEB1 $</strong>. Чтобы разрешить веб-приложению доступ к базе данных по сети, необходимо:

- Добавьте имя входа для учетной записи компьютера веб-сервера в экземпляр SQL Server.
- Сопоставьте имя входа учетной записи компьютера с любыми необходимыми ролями базы данных (как правило, **db\_DataReader** и **DB\_Write**).

Если веб-приложение выполняется в ферме серверов, а не на одном сервере, необходимо повторить эти процедуры для каждого веб-сервера в ферме серверов.

> [!NOTE]
> Дополнительные сведения о удостоверениях пула приложений и доступе к сетевым ресурсам см. в разделе [удостоверения пула приложений](https://go.microsoft.com/?linkid=9805123).

Эти задачи можно подходить различными способами. Чтобы создать имя входа, можно выполнить одно из следующих действий.

- Вручную создайте имя входа на сервере базы данных с помощью Transact-SQL или SQL Server Management Studio.
- Используйте проект сервера SQL Server 2008 в Visual Studio для создания и развертывания имени входа.

SQL Server имя входа является объектом уровня сервера, а не объектом уровня базы данных, поэтому он не зависит от базы данных, которую требуется развернуть. Таким образом, можно создать имя входа в любой момент, и проще всего создать имя входа вручную на сервере базы данных до начала развертывания баз данных. Следующую процедуру можно использовать для создания имени входа в SQL Server Management Studio.

**Создание SQL Server имени входа для учетной записи компьютера веб-сервера**

1. На сервере базы данных в меню **Пуск** наведите указатель на пункт **все программы**, выберите **Microsoft SQL Server 2008 R2**, а затем щелкните **SQL Server Management Studio**.
2. В диалоговом окне **соединение с сервером** в поле **имя сервера** введите имя сервера базы данных и нажмите кнопку **подключить**.

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image10.png)
3. В области **Обозреватель объектов** щелкните правой кнопкой мыши элемент **Безопасность**, наведите указатель на пункт **создать**и выберите пункт **Вход**.
4. В диалоговом окне имя **входа — создать** введите имя своей учетной записи компьютера веб-сервера (например, **FABRIKAM\TESTWEB1 $** ) в поле **имени входа** .

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image11.png)
5. Нажмите кнопку **ОК**.

На этом этапе сервер базы данных готов к веб-развертывание публикации. Однако все развертываемые решения будут работать только после того, как вы сопоставьте учетной записи компьютера имя входа с необходимыми ролями базы данных. Сопоставление имени входа с ролями базы данных требует гораздо больше усилий, так как сопоставление ролей невозможно до тех пор, пока вы не развернете базу данных. Для соответствия имени входа учетной записи компьютера с требуемыми ролями базы данных можно выполнить одно из следующих действий.

- Назначьте роли базы данных имени входа вручную после развертывания базы данных в первый раз.
- Используйте скрипт, выполняемый после развертывания, чтобы назначить роли базы данных для имени входа.

Дополнительные сведения об автоматизации создания имен входа и сопоставлений ролей базы данных см. в разделе [развертывание членства в ролях базы данных в тестовых средах](../advanced-enterprise-web-deployment/deploying-database-role-memberships-to-test-environments.md). Кроме того, можно использовать следующую процедуру, чтобы вручную связать учетную запись компьютера с необходимыми ролями базы данных. Помните, что эту процедуру невозможно *выполнить до тех* пор, пока не развернута база данных.

**Привязка ролей базы данных к имени входа учетной записи компьютера веб-сервера**

1. Откройте SQL Server Management Studio как раньше.
2. В области **Обозреватель объектов** разверните узел **Безопасность** , разверните узел **имена входа** , а затем дважды щелкните имя входа учетной записи компьютера (например, **FABRIKAM\TESTWEB1 $** ).

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image12.png)
3. В диалоговом окне **Свойства имени входа** щелкните **Сопоставление пользователей**.
4. В таблице **Пользователи, сопоставленные с этим именем входа** выберите имя базы данных (например, **ContactManager**).
5. В списке **членство в роли базы данных для:** *[имя базы данных]* выберите необходимые разрешения. В случае с примером решения диспетчера контактов необходимо выбрать **базу данных\_DataReader** и **базу данных\_** роли объекта записи.

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image13.png)
6. Нажмите кнопку **ОК**.

При ручном сопоставлении ролей баз данных часто бывает больше, чем достаточно для тестовых сред, но это не всегда желательно для развертывания в промежуточной или рабочей среде. Дополнительные сведения об автоматизации этой задачи с помощью скриптов, выполняемых после развертывания, см. в этой этой задаче при [развертывании членства в ролях базы данных в тестовых средах](../advanced-enterprise-web-deployment/deploying-database-role-memberships-to-test-environments.md).

> [!NOTE]
> Дополнительные сведения о серверных проектах и проектах баз данных см. в статье [Visual Studio 2010 SQL Server проекты баз данных](https://msdn.microsoft.com/library/ff678491.aspx).

## <a name="configure-permissions-for-the-deployment-account"></a>Настройка разрешений для учетной записи развертывания

Если учетная запись, используемая для запуска развертывания, не является администратором SQL Server, вам также потребуется создать имя входа для этой учетной записи. Чтобы создать базу данных, учетная запись должна быть членом роли сервера **dbcreator** или иметь эквивалентные разрешения.

> [!NOTE]
> При использовании веб-развертывание или программы VSDBCMD для развертывания базы данных можно использовать учетные данные Windows или учетные данные SQL Server (если ваш экземпляр SQL Server настроен для поддержки проверки подлинности в смешанном режиме). В следующей процедуре предполагается, что вы хотите использовать учетные данные Windows, но при настройке развертывания ничего не нужно указывать SQL Server имя пользователя и пароль в строке подключения.

**Настройка разрешений для учетной записи развертывания**

1. Откройте SQL Server Management Studio как раньше.
2. В области **Обозреватель объектов** щелкните правой кнопкой мыши элемент **Безопасность**, наведите указатель на пункт **создать**и выберите пункт **Вход**.
3. В диалоговом окне имя **входа — создать** введите имя учетной записи развертывания (например, **фабрикам\матт**) в поле **имени входа** .
4. На панели **Выбор страницы** щелкните **роли сервера**.
5. Выберите **dbcreator**и нажмите кнопку **ОК**.

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image14.png)

Для поддержки последующих развертываний также потребуется добавить учетную запись развертывания в роль **владельца\_DB** в базе данных после первого развертывания. Это обусловлено тем, что при последующих развертываниях вы изменяете схему существующей базы данных, а не создаете новую базу данных. Как описано в предыдущем разделе, нельзя добавить пользователя к роли базы данных до тех пор, пока не будет создана база данных, по очевидным причинам.

**Привязка имени входа учетной записи развертывания к роли базы данных "владелец\_"**

1. Откройте SQL Server Management Studio как раньше.
2. В окне **Обозреватель объектов** разверните узел **Безопасность** , разверните узел **имена входа** , а затем дважды щелкните имя входа учетной записи компьютера (например, **фабрикам\матт**).
3. В диалоговом окне **Свойства имени входа** щелкните **Сопоставление пользователей**.
4. В таблице **Пользователи, сопоставленные с этим именем входа** выберите имя базы данных (например, **ContactManager**).
5. В списке **членство в роли базы данных для:** *[имя базы данных]* выберите роль **владельца DB\_** .

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image15.png)
6. Нажмите кнопку **ОК**.

## <a name="conclusion"></a>Заключение

Теперь сервер базы данных должен быть готов к принятию удаленных развертываний баз данных и разрешать удаленным веб-серверам IIS доступ к Вашим базам данных. Прежде чем пытаться развернуть и использовать базы данных, вам может потребоваться проверить следующие ключевые моменты:

- Настроены ли SQL Server принимать удаленные подключения TCP/IP?
- Вы настроили брандмауэры для разрешения SQL Server трафика?
- Создали ли вы имя входа учетной записи компьютера для каждого веб-сервера, который будет получать доступ к SQL Server?
- Включает ли развертывание базы данных скрипт для создания сопоставлений ролей пользователей или необходимо создавать их вручную после первого развертывания базы данных?
- Создали ли вы имя входа для учетной записи развертывания и добавили его к роли сервера **dbcreator** ?

## <a name="further-reading"></a>Дополнительные материалы

Рекомендации по развертыванию проектов баз данных см. в разделе [развертывание проектов баз данных](../web-deployment-in-the-enterprise/deploying-database-projects.md). Рекомендации по созданию членства в ролях базы данных путем запуска скрипта, выполняемого после развертывания, см. [в разделе Развертывание членства в ролях базы данных в тестовых средах](../advanced-enterprise-web-deployment/deploying-database-role-memberships-to-test-environments.md). Рекомендации по решению уникальных проблем развертывания, которые создает база данных членства, см. [в разделе Развертывание баз данных членства в корпоративных средах](../advanced-enterprise-web-deployment/deploying-membership-databases-to-enterprise-environments.md).

> [!div class="step-by-step"]
> [Назад](configuring-a-web-server-for-web-deploy-publishing-offline-deployment.md)
> [Вперед](creating-a-server-farm-with-the-web-farm-framework.md)
