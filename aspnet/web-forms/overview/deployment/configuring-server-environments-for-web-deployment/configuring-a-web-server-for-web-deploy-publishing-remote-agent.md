---
uid: web-forms/overview/deployment/configuring-server-environments-for-web-deployment/configuring-a-web-server-for-web-deploy-publishing-remote-agent
title: Настройка веб-сервера для публикации веб-развертывание (удаленный агент) | Документация Майкрософт
author: jrjlee
description: В этом разделе описывается настройка веб-сервера службы IIS (IIS) для поддержки веб-публикации и развертывания с помощью веб-развертывания IIS...
ms.author: riande
ms.date: 05/04/2012
ms.assetid: 239c7aa8-d09a-4d02-9c0e-6bd52be5f0d5
msc.legacyurl: /web-forms/overview/deployment/configuring-server-environments-for-web-deployment/configuring-a-web-server-for-web-deploy-publishing-remote-agent
msc.type: authoredcontent
ms.openlocfilehash: ce0d246afdfb65c2ea15a287064511e7d1d58622
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/28/2019
ms.locfileid: "74589055"
---
# <a name="configuring-a-web-server-for-web-deploy-publishing-remote-agent"></a>Настройка веб-сервера для публикации веб-развертывания (удаленный агент)

кто [Джейсон Иванов](https://github.com/jrjlee)

[Загрузить PDF-файл](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> В этом разделе описано, как настроить веб-сервер службы IIS (IIS) для поддержки веб-публикации и развертывания с помощью службы удаленного агента веб-развертывания IIS (веб-развертывание).
> 
> При работе с веб-развертывание 2,0 или более поздней версии существует три основных подхода, которые можно использовать для получения приложений или сайтов на веб-сервер. Вы можете выполнить следующие действия.
> 
> - Используйте *службу удаленного агента веб-развертывание*. Этот подход требует меньшей настройки веб-сервера, но для развертывания любых данных на сервере необходимо предоставить учетные данные администратора локального сервера.
> - Используйте *обработчик веб-развертывание*. Этот подход гораздо более сложен и требует более первоначальных усилий по настройке веб-сервера. Однако при использовании этого подхода можно настроить службы IIS, чтобы разрешить пользователям без прав администратора выполнять развертывание. Обработчик веб-развертывание доступен только в службах IIS версии 7 или более поздней.
> - Используйте *автономное развертывание*. Этот подход требует минимальной настройки веб-сервера, но администратор сервера должен вручную скопировать веб-пакет на сервер и импортировать его с помощью диспетчера служб IIS.
> 
> Дополнительные сведения о ключевых функциях, преимуществах и недостатках этих подходов см. [в разделе Выбор правильного подхода к веб-развертыванию](choosing-the-right-approach-to-web-deployment.md).

## <a name="is-the-web-deploy-remote-agent-the-right-approach-for-you"></a>Является ли веб-развертывание удаленным агентом правильным подходом?

Да, если пользователь, который будет развертывать содержимое, может предоставить учетные данные администратора на целевом сервере. Этот подход часто желательно применять в сценариях такого типа:

- Среды разработки или тестирования, где разработчик имеет полный контроль над целевым веб-сервером и сервером базы данных.
- Небольшие организации, в которых один пользователь или небольшая группа пользователей управляют всем жизненным циклом приложения.

В многих крупных организациях, особенно для промежуточной или рабочей среды, зачастую не дает пользователям прав администратора на веб-серверах. В случае размещенных веб-серверов это особенно маловероятно. Кроме того, если планируется автоматизировать развертывание с сервера сборки, может потребоваться не использовать учетные данные администратора для процесса развертывания. В этих сценариях Настройка веб-серверов для поддержки развертывания с помощью [обработчика веб-развертывание](configuring-a-web-server-for-web-deploy-publishing-web-deploy-handler.md) может обеспечить более приемлемый вариант.

## <a name="task-overview"></a>Обзор задач

В этом разделе описано, как настроить веб-сервер службы IIS (IIS) 7,5 для приема и развертывания веб-пакетов с удаленного компьютера с помощью метода веб-развертывание удаленного агента. Вам потребуется:

- Установите IIS 7,5 и рекомендуемую конфигурацию IIS 7.
- Установите веб-развертывание 2,1 или более поздней версии.
- Создайте веб-сайт IIS для размещения развернутого содержимого.
- Убедитесь, что служба веб-Deployment Agent запущена.

Чтобы разместить пример решения, вам также потребуется:

- Установите .NET Framework 4,0.
- Установите ASP.NET MVC 3.

В этом разделе будет показано, как выполнить каждую из этих процедур. В задачах и пошаговых руководствах этого раздела предполагается, что вы начинаете с чистой серверной сборки, работающей под Windows Server 2008 R2. Прежде чем продолжить, убедитесь в том, что:

- Windows Server 2008 R2 с пакетом обновления 1 (SP1) и все доступные обновления установлены.
- Сервер присоединен к домену.
- Сервер имеет статический IP-адрес.

> [!NOTE]
> Дополнительные сведения о присоединении компьютеров к домену см. в разделе [Присоединение компьютеров к домену и вход в систему](https://technet.microsoft.com/library/cc725618(v=WS.10).aspx). Дополнительные сведения о настройке статических IP-адресов см. в статье [Настройка статического IP-](https://technet.microsoft.com/library/cc754203(v=ws.10).aspx)адреса. Служба удаленного агента поддерживается в IIS 6 и не требует присоединения к домену. Однако действия, описанные в этом руководстве, были разработаны и протестированы на IIS 7,5, а процедуры для других версий могут различаться.

## <a name="install-products-and-components"></a>Установка продуктов и компонентов

Этот раздел поможет вам установить необходимые продукты и компоненты на веб-сервере. Прежде чем начать, рекомендуется запустить Центр обновления Windows, чтобы гарантировать, что сервер будет полностью обновлен.

В этом случае необходимо установить следующие компоненты:

- **Рекомендуемая конфигурация IIS 7**. Это включает роль **веб-сервера (IIS)** на веб-сервере и устанавливает набор модулей и компонентов IIS, необходимых для размещения приложения ASP.NET.
- **.NET Framework 4,0**. Это необходимо для запуска приложений, созданных на основе этой версии .NET Framework.
- **Средство веб-развертывания 2,1 или более поздней версии**. При этом на сервере устанавливаются веб-развертывание (и его базовый исполняемый файл, MSDeploy. exe). В рамках этого процесса он устанавливает и запускает службу веб-Deployment Agent. Эта служба позволяет развертывать веб-пакеты с удаленного компьютера.
- **ASP.NET MVC 3**. При этом устанавливаются сборки, необходимые для запуска приложений MVC 3.

> [!NOTE]
> В этом пошаговом руководстве описывается использование установщика веб-платформы для установки и настройки необходимых компонентов. Хотя вам не нужно использовать установщик веб-платформы, он упрощает процесс установки, автоматически выявляя зависимости и гарантируя, что вы всегда получаете новейшие версии продукта. Дополнительные сведения см. в разделе [установщик веб-платформы Майкрософт 3,0](https://go.microsoft.com/?linkid=9805118).

**Установка необходимых продуктов и компонентов**

1. Скачайте и установите [установщик веб-платформы](https://go.microsoft.com/?linkid=9805118).
2. После завершения установки установщик веб-платформы запустится автоматически.

    > [!NOTE]
    > Теперь можно запустить установщик веб-платформы в любое время из меню " **Пуск** ". Для этого в меню **Пуск** выберите пункт **все программы**, а затем щелкните **установщик веб-платформы Майкрософт**.
3. В верхней части окна **установщика веб-платформы 3,0** щелкните **Products (продукты**).
4. В левой части окна в области навигации щелкните **платформы**.
5. В строке **Microsoft .NET Framework 4** , если .NET Framework еще не установлен, нажмите кнопку **Добавить**.

    > [!NOTE]
    > Возможно, вы уже установили .NET Framework 4,0 с помощью Центр обновления Windows. Если продукт или компонент уже установлен, установщик веб-платформы сообщит это, заменив кнопку **Добавить** на **установленный**текст.

    ![](configuring-a-web-server-for-web-deploy-publishing-remote-agent/_static/image1.png)
6. В строке **ASP.NET MVC 3 (Visual Studio 2010)** нажмите кнопку **Добавить**.
7. В области навигации щелкните **сервер**.
8. В строке **рекомендуемой конфигурации IIS 7** нажмите кнопку **Добавить**.
9. В строке **средства веб-развертывания 2,1** нажмите кнопку **Добавить**.
10. Нажмите кнопку **Установить**. Установщик веб-платформы отобразит список продуктов&#x2014;вместе со всеми связанными зависимостями&#x2014;, которые будут установлены, и предложит принять условия лицензионного соглашения.

    ![](configuring-a-web-server-for-web-deploy-publishing-remote-agent/_static/image2.png)
11. Ознакомьтесь с условиями лицензионного соглашения и, если вы согласны с условиями, нажмите кнопку **принимаю**.
12. По завершении установки нажмите кнопку **Готово**, а затем закройте окно **установщик веб-платформы 3,0** .

Если вы установили .NET Framework 4,0 до установки служб IIS, необходимо запустить [средство регистрации служб iis ASP.NET](https://msdn.microsoft.com/library/k6h9cz8h(v=VS.100).aspx) (ASPNET\_regiis. exe), чтобы зарегистрировать последнюю версию ASP.NET с IIS. В противном случае вы обнаружите, что IIS будет обслуживать статическое содержимое (например, HTML-файлы) без проблем, но при попытке перейти к содержимому ASP.NET будет возвращена **Ошибка HTTP 404,0 — не найдена** . Эту процедуру можно использовать, чтобы убедиться, что ASP.NET 4,0 зарегистрирован.

**Регистрация ASP.NET 4,0 в службах IIS**

1. Нажмите кнопку **Пуск**и введите **Командная строка**.
2. В результатах поиска щелкните правой кнопкой мыши пункт **Командная строка**и выберите команду **Запуск от имени администратора**.
3. В окне командной строки перейдите в каталог **%WINDIR%\Microsoft.NET\Framework\v4.0.30319** .
4. Введите эту команду и нажмите клавишу ВВОД:

    [!code-console[Main](configuring-a-web-server-for-web-deploy-publishing-remote-agent/samples/sample1.cmd)]
5. Если вы планируете размещать в системе 64-разрядные веб-приложения в любой момент, необходимо также зарегистрировать 64-разрядную версию ASP.NET с IIS. Для этого в окне командной строки перейдите в каталог **%WINDIR%\Microsoft.NET\Framework64\v4.0.30319** .
6. Введите эту команду и нажмите клавишу ВВОД:

    [!code-console[Main](configuring-a-web-server-for-web-deploy-publishing-remote-agent/samples/sample2.cmd)]

Рекомендуется использовать Центр обновления Windows на этом этапе, чтобы скачать и установить все доступные обновления для новых продуктов и компонентов, которые вы установили.

## <a name="configure-the-iis-website"></a>Настройка веб-сайта IIS

Прежде чем можно будет развернуть веб-содержимое на сервере, необходимо создать и настроить веб-сайт IIS для размещения содержимого. Веб-развертывание может развертывать только веб-пакеты на существующем веб-сайте IIS; Он не может создать веб-сайт. На высоком уровне необходимо выполнить следующие задачи:

- Создайте папку в файловой системе для размещения содержимого.
- Создайте веб-сайт IIS для обслуживания содержимого и свяжите его с локальной папкой.
- Предоставьте разрешения на чтение удостоверению пула приложений в локальной папке.

Хотя ничто не мешает развертывать содержимое на веб-сайте по умолчанию в службах IIS, этот подход не рекомендуется использовать ни для тестов, ни для демонстрационных сценариев. Для имитации рабочей среды следует создать новый веб-сайт IIS с параметрами, зависящими от требований приложения.

**Создание и Настройка веб-сайта IIS**

1. В локальной файловой системе создайте папку для хранения содержимого (например, **к:\демосите**).
2. В меню **Пуск** укажите пункт **Администрирование**, а затем выберите пункт **Диспетчер службы IIS (IIS)** .
3. В диспетчере служб IIS в области **подключения** разверните узел сервера (например, **TESTWEB1**).

    ![](configuring-a-web-server-for-web-deploy-publishing-remote-agent/_static/image3.png)
4. Щелкните правой кнопкой мыши узел **сайты** и выберите команду **Добавить веб-сайт**.
5. В поле **имя сайта** введите имя веб-сайта IIS (например, **демосите**).
6. В поле **физический путь** введите (или перейдите к) путь к локальной папке (например, **к:\демосите**).
7. В поле **порт** введите номер порта, на котором будет размещен веб-сайт (например, **85**).

    > [!NOTE]
    > Номера стандартных портов 80 для HTTP и 443 для HTTPS. Однако при размещении этого веб-сайта на порту 80 необходимо будет закрыть веб-сайт по умолчанию, прежде чем можно будет получить доступ к сайту.
8. Оставьте поле **имя узла** пустым, если не требуется настроить запись службы доменных имен (DNS) для веб-сайта, а затем нажмите кнопку **ОК**.

    ![](configuring-a-web-server-for-web-deploy-publishing-remote-agent/_static/image4.png)

    > [!NOTE]
    > В рабочей среде вам, скорее всего, потребуется разместить веб-сайт через порт 80 и настроить заголовок узла вместе с соответствующими записями DNS. Дополнительные сведения о настройке заголовков узлов в IIS 7 см. в разделе [Настройка заголовка узла для веб-сайта (IIS 7)](https://technet.microsoft.com/library/cc753195(WS.10).aspx). Дополнительные сведения о роли DNS-сервера в Windows Server 2008 R2 см. в разделе [Обзор DNS-сервера](https://technet.microsoft.com/library/cc770392.aspx) и [DNS-сервер](https://technet.microsoft.com/windowsserver/dd448607).
9. В области **Действия** в разделе **Изменение веб-сайта**выберите пункт **Привязки**.
10. В диалоговом окне " **привязки сайта** " нажмите кнопку **Добавить**.

    ![](configuring-a-web-server-for-web-deploy-publishing-remote-agent/_static/image5.png)
11. В диалоговом окне **Добавление привязки сайта** задайте **IP-адрес** и **порт** в соответствии с существующей конфигурацией сайта.
12. В поле **имя узла** введите имя веб-сервера (например, **TESTWEB1**) и нажмите кнопку **ОК**.

    ![](configuring-a-web-server-for-web-deploy-publishing-remote-agent/_static/image6.png)

    > [!NOTE]
    > Первая привязка сайта позволяет локально получить доступ к сайту с помощью IP-адреса и порта или `http://localhost:85`. Вторая привязка сайта позволяет получить доступ к сайту с других компьютеров в домене, используя имя компьютера (например, http://testweb1:85).
13. В диалоговом окне **привязки сайта** нажмите кнопку **Закрыть**.
14. В области **подключения** щелкните **Пулы приложений**.
15. В области **Пулы приложений** щелкните правой кнопкой мыши имя пула приложений и выберите пункт **Основные параметры**. По умолчанию имя пула приложений будет совпадать с именем вашего веб-сайта (например, **демосите**).
16. В списке **версия .NET Framework** выберите **.NET Framework v 4.0.30319**и нажмите кнопку **ОК**.

    ![](configuring-a-web-server-for-web-deploy-publishing-remote-agent/_static/image7.png)

    > [!NOTE]
    > Для примера решения требуется .NET Framework 4,0. Это не является обязательным для веб-развертывание в целом.

Чтобы веб-сайт мог обслуживать содержимое, удостоверение пула приложений должно иметь разрешения на чтение для локальной папки, в которой хранится содержимое. В IIS 7,5 пулы приложений работают с уникальным удостоверением пула приложений по умолчанию (в отличие от предыдущих версий IIS, где пулы приложений обычно выполнялись с использованием учетной записи сетевой службы). Удостоверение пула приложений не является реальной учетной записью пользователя и не отображается ни в каких списках пользователей или групп&#x2014;, но и динамически создается при запуске пула приложений. Каждое удостоверение пула приложений добавляется в группу безопасности Local **IIS\_IUSR** в качестве скрытого элемента.

Чтобы предоставить разрешения удостоверению пула приложений для файла или папки, можно использовать два варианта:

- Назначьте разрешения для удостоверения пула приложений напрямую, используя формат <strong>IIS AppPool\</strong ><em>[имя пула приложений]</em>(например, <strong>IIS апппул\демосите</strong>).
- Назначьте разрешения группе **IIS\_IUSR** .

Наиболее распространенным подходом является назначение разрешений локальной группе **IIS\_IUSR** , так как этот подход позволяет изменять пулы приложений без перенастройки разрешений файловой системы. Следующая процедура использует этот подход на основе группы.

> [!NOTE]
> Дополнительные сведения о удостоверениях пула приложений в IIS 7,5 см. в разделе [удостоверения пула приложений](https://go.microsoft.com/?linkid=9805123).

**Настройка разрешений папки для веб-сайта IIS**

1. В проводнике найдите расположение локальной папки.
2. Щелкните правой кнопкой мыши папку и выберите пункт **Свойства**.
3. На вкладке **Безопасность** нажмите кнопку **изменить**, а затем нажмите кнопку **добавить**.
4. Щелкните **расположения**. В диалоговом окне **расположения** выберите локальный сервер и нажмите кнопку **ОК**.

    ![](configuring-a-web-server-for-web-deploy-publishing-remote-agent/_static/image8.png)
5. В диалоговом окне **Выбор пользователей или групп** введите **IIS\_IUSR**, щелкните **Проверить имена**, а затем нажмите кнопку **ОК**.
6. В диалоговом окне <strong>разрешения для</strong><em>[имя папки]</em>Обратите внимание, что новой группе назначено разрешение <strong>Чтение &amp; выполнение</strong>, <strong>список содержимого папки</strong>и разрешения на <strong>Чтение</strong> по умолчанию. Оставьте это без изменений и нажмите кнопку <strong>ОК</strong>.
7. Нажмите кнопку <strong>ОК</strong> , чтобы закрыть диалоговое окно<strong>Свойства</strong> <em>[имя папки]</em>.

В качестве конечной задачи перед развертыванием веб-пакетов на сервере необходимо убедиться, что служба веб-Deployment Agent запущена. При развертывании пакета с удаленного компьютера служба веб-Deployment Agent отвечает за извлечение и установку содержимого пакета. Служба запускается по умолчанию при установке средства веб-развертывания и запускается под удостоверением сетевой службы.

Проверить, работает ли служба различными способами, можно с помощью различных служебных программ командной строки или командлетов Windows PowerShell. Эта процедура описывает простой подход на основе пользовательского интерфейса.

**Проверка работы службы веб-Deployment Agent**

1. Нажмите кнопку **Пуск** , выберите команду **Администрирование**, а затем выберите **Службы**.
2. Найдите строку **Служба веб-Deployment Agent** и убедитесь, что для параметра **состояние** установлено значение **запущено**.

    ![](configuring-a-web-server-for-web-deploy-publishing-remote-agent/_static/image9.png)
3. Если служба еще не запущена, нажмите кнопку **Пуск**.

## <a name="configure-firewall-exceptions"></a>Настройка исключений брандмауэра

По умолчанию служба удаленного агента прослушивает TCP-порт 80 по этому АДРЕСу:

<http://servername.com/MSDEPLOYAGENTSERVICE>

В большинстве случаев вам не нужно настраивать дополнительные правила брандмауэра для службы удаленного агента, так как веб-серверы обычно прослушивают запросы HTTP через порт 80. Если вы настроили установку для прослушивания нестандартного порта, при необходимости необходимо настроить исключения брандмауэра.

## <a name="conclusion"></a>Заключение

На этом этапе веб-сервер готов принять и установить веб-пакеты с удаленного компьютера. Перед развертыванием веб-приложения на сервере может потребоваться проверить следующие ключевые моменты:

- Зарегистрировали ли вы ASP.NET 4,0 с IIS?
- Имеет ли удостоверение пула приложений доступ на чтение к исходной папке веб-сайта?
- Запущена ли служба веб-Deployment Agent?

## <a name="further-reading"></a>Дополнительные сведения

Инструкции по настройке файлов проекта пользовательских Microsoft Build Engine (MSBuild) для развертывания веб-пакетов в службе удаленного агента см. в разделе [Настройка свойств развертывания для целевой среды](configuring-deployment-properties-for-a-target-environment.md).

> [!div class="step-by-step"]
> [Назад](scenario-configuring-a-production-environment-for-web-deployment.md)
> [Вперед](configuring-a-web-server-for-web-deploy-publishing-web-deploy-handler.md)
