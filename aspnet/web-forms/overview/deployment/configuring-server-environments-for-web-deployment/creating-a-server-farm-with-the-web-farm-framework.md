---
uid: web-forms/overview/deployment/configuring-server-environments-for-web-deployment/creating-a-server-farm-with-the-web-farm-framework
title: Создание фермы серверов с платформой веб-фермы | Документация Майкрософт
author: jrjlee
description: В этом разделе описывается использование платформы веб-фермы (WFF) 2,0 для создания и настройки фермы веб-серверов из коллекции серверов.
ms.author: riande
ms.date: 05/04/2012
ms.assetid: 656dd06d-806c-467c-863d-9fc45e5ba3ab
msc.legacyurl: /web-forms/overview/deployment/configuring-server-environments-for-web-deployment/creating-a-server-farm-with-the-web-farm-framework
msc.type: authoredcontent
ms.openlocfilehash: 204996514bed336e60ab77f184a923f04e7e2bba
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78517500"
---
# <a name="creating-a-server-farm-with-the-web-farm-framework"></a>Создание фермы серверов с помощью Web Farm Framework

кто [Джейсон Иванов](https://github.com/jrjlee)

[Скачать в формате PDF](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> В этом разделе описывается использование платформы веб-фермы (WFF) 2,0 для создания и настройки фермы веб-серверов из коллекции серверов.

WFF позволяет синхронизировать продукты и компоненты веб-платформы, веб-приложения, сайты и параметры конфигурации на нескольких веб-серверах с балансировкой нагрузки. В сценариях, где требуется несколько веб-серверов, таких как промежуточные и рабочие среды, это может значительно упростить процесс развертывания и настройки. Вы можете развернуть веб-приложение на отдельном сервере&#x2014;,&#x2014;и WFF будет автоматически реплицировать это веб-приложение на все другие веб-серверы фермы серверов.

## <a name="understanding-the-web-farm-framework"></a>Основные сведения о платформе веб-фермы

С помощью WFF 2,0 можно подготавливать и развертывать содержимое в группе веб-серверов, а также управлять ими. Развертывание WFF состоит из трех ключевых ролей сервера:

- *Сервер контроллера*. Этот сервер используется для создания и настройки ферм серверов WFF. Сервер контроллера управляет синхронизацией компонентов веб-платформы, параметров конфигурации и приложений между веб-серверами в ферме серверов. На сервере контроллера устанавливается WFF 2,0, а сервер контроллера, в свою очередь, устанавливает агент WFF на каждом из серверов в ферме серверов. Сервер контроллера не принадлежит ни к одной ферме серверов WFF, а один сервер контроллера может управлять несколькими фермами серверов. В этом сценарии используется один сервер контроллера WFF для создания фермы промежуточного сервера и рабочей фермы серверов и управления ею.
- *Сервер источника*. Каждая ферма серверов WFF включает один сервер-источник. При установке компонентов веб-платформы или развертывании приложений на сервере-источнике WFF синхронизирует изменения со всеми остальными серверами в ферме серверов.
- *Сервер-получатель*. Каждая ферма серверов WFF включает один или несколько серверов-получателей. Любые изменения, вносимые на сервер-источник, реплицируются на каждый сервер-получатель в пределах фермы серверов.

В этом примере показано, как эти роли сервера связаны с промежуточной и рабочей средами Fabrikam, Inc.:

![](creating-a-server-farm-with-the-web-farm-framework/_static/image1.png)

В этом сценарии промежуточная среда и Рабочая среда настраиваются как фермы серверов WFF. Один сервер контроллера WFF управляет обеими фермами. На каждой ферме серверов все изменения на сервере-источнике реплицируются на каждый сервер-получатель.

Прежде чем приступить к настройке промежуточной и рабочей сред, рекомендуется ознакомиться с этими статьями, чтобы ознакомиться с основными понятиями WFF 2,0:

- [Обзор инфраструктуры веб-фермы 2,0 для IIS 7](https://go.microsoft.com/?linkid=9805126)
- [Настройка фермы серверов с платформой веб-фермы 2,0 для IIS 7](https://go.microsoft.com/?linkid=9805127)
- [Требования к системе и платформе для платформы веб-фермы 2,0 для IIS 7](https://go.microsoft.com/?linkid=9805128)

## <a name="task-overview"></a>Обзор задач

Для выполнения задач и пошаговых руководств в этом разделе потребуется по крайней мере три сервера&#x2014;: один контроллер WFF, один основной веб-сервер для фермы серверов и один или несколько вторичных веб-серверов для фермы серверов. Дополнительные серверы-получатели можно добавить в ферму серверов WFF в любое время. На высоком уровне, чтобы создать и настроить ферму серверов WFF для промежуточной или рабочей среды, потребуется:

- Создайте сервер контроллера, установив службы IIS (IIS) 7,5 и WFF 2,0.
- Подготовьте первичные и вторичные серверы, создав общую учетную запись администратора и настроив исключения брандмауэра.
- Настройте ферму серверов с помощью диспетчера служб IIS на сервере контроллера.
- Настройте балансировку нагрузки с помощью маршрутизации запросов приложений IIS (ARR) или альтернативной технологии балансировки нагрузки.

В задачах и пошаговых руководствах этого раздела предполагается, что вы начинаете с чистых серверных сборок, работающих под Windows Server 2008 R2. Прежде чем начать, для каждого сервера убедитесь в том, что:

- Windows Server 2008 R2 с пакетом обновления 1 (SP1) и все доступные обновления установлены.
- Сервер присоединен к домену.
- Сервер имеет статический IP-адрес.

> [!NOTE]
> Дополнительные сведения о присоединении компьютеров к домену см. в разделе [Присоединение компьютеров к домену и вход в систему](https://technet.microsoft.com/library/cc725618(v=WS.10).aspx). Дополнительные сведения о настройке статических IP-адресов см. в статье [Настройка статического IP-](https://technet.microsoft.com/library/cc754203(v=ws.10).aspx)адреса.

## <a name="create-the-wff-controller-server"></a>Создание сервера контроллера WFF

Чтобы создать сервер контроллера WFF, необходимо установить службы IIS 7 или более поздней версии и WFF 2,0 или более поздней версии. На самом деле WFF использует средство веб-развертывания IIS (веб-развертывание) 2. x для синхронизации серверов в ферме. Если для установки WFF используется установщик веб-платформы, установщик автоматически скачивает и устанавливает веб-развертывание.

**Создание сервера контроллера WFF**

1. Скачайте и установите [установщик веб-платформы](https://go.microsoft.com/?linkid=9739157).
2. В верхней части окна **установщика веб-платформы 3,0** щелкните **Products (продукты**).
3. В левой части окна в области навигации щелкните **сервер**.
4. В строке **рекомендуемой конфигурации IIS 7** нажмите кнопку **Добавить**.
5. В <strong>инфраструктуре веб-фермы 2.</strong> <em>x</em> строка, нажмите кнопку <strong>Добавить</strong>.

    ![](creating-a-server-farm-with-the-web-farm-framework/_static/image2.png)
6. Щелкните **Install**(Установить). Обратите внимание, что установщик веб-платформы добавил в список установки средство веб-развертывания, а также различные зависимости.

    ![](creating-a-server-farm-with-the-web-farm-framework/_static/image3.png)
7. Ознакомьтесь с условиями лицензионного соглашения и, если вы согласны с условиями, нажмите кнопку **принимаю**.
8. По завершении установки нажмите кнопку **Готово**, а затем закройте окно **установщик веб-платформы 3,0** .

## <a name="configure-the-primary-and-secondary-servers"></a>Настройка основного и дополнительного серверов

Перед созданием фермы серверов WFF необходимо выполнить некоторые подготовительные задачи на веб-серверах, которые будут создавать ферму.

- Добавьте исключения брандмауэра, чтобы обеспечить взаимодействие **основных функций сети**, **удаленного администрирования**и **общего доступа к файлам и принтерам** с сервером контроллера WFF.
- Создайте учетную запись домена (например, **фабрикам\стагингфарм**) в Active Directory и добавьте ее в локальную группу администраторов на каждом сервере. Эта учетная запись будет использоваться в качестве учетной записи администратора фермы серверов при создании фермы серверов.

Дополнительные сведения о настройке этих исключений брандмауэра в брандмауэре Windows см. в разделе [требования к системе и платформе для платформы веб-фермы 2,0 для IIS 7](https://go.microsoft.com/?linkid=9805128). Для других систем брандмауэров обратитесь к документации по продукту.

Следующую процедуру можно использовать для добавления учетной записи домена в локальную группу администраторов в Windows Server 2008 R2. Эту процедуру следует выполнять на каждом сервере, который вы хотите добавить на ферму&#x2014;серверов другими словами, добавить ту же учетную запись домена в локальную группу администраторов на сервере-источнике и на каждом сервере-получателе.

**Добавление учетной записи домена в группу локальных администраторов**

1. В меню **Пуск** выберите пункт **Администрирование**, а затем щелкните **Диспетчер сервера**.
2. В окне **Диспетчер сервера** на панели древовидное представление разверните узел **Конфигурация**, разверните узел **Локальные пользователи и группы**и выберите пункт **группы**.

    ![](creating-a-server-farm-with-the-web-farm-framework/_static/image4.png)
3. В области **группы** дважды щелкните **Администраторы**.
4. В диалоговом окне **Свойства администратора** нажмите кнопку **Добавить**.
5. В диалоговом окне **Выбор пользователей, компьютеров, учетных записей служб или групп** введите (или перейдите) к своей учетной записи домена (например, **фабрикам\стагингфарм**), а затем нажмите кнопку **ОК**.

    ![](creating-a-server-farm-with-the-web-farm-framework/_static/image5.png)
6. В диалоговом окне **Свойства администратора** нажмите кнопку **ОК**.

Теперь ваши серверы готовы к добавлению в ферму серверов. В случае сервера-источника можно настроить сервер в соответствии с требованиями приложения до или после создания фермы&#x2014;серверов в обоих случаях, WFF синхронизирует серверы, развертывая на серверах-получателях те же продукты, компоненты или конфигурацию. Для простоты в этом учебнике предполагается, что вы настроили основной сервер по завершении создания фермы серверов.

## <a name="create-the-wff-server-farm"></a>Создание фермы серверов WFF

На этом этапе все серверы готовы к добавлению в ферму серверов WFF:

- Вы установили WFF на сервере контроллера.
- Вы настроили исключения брандмауэра на основном и на вторичном веб-серверах.
- Вы добавили учетную запись домена в локальную группу администраторов на основном и на вторичном веб-серверах.

Следующим шагом является создание фермы серверов в WFF. Это можно сделать из диспетчера IIS на сервере контроллера WFF.

**Создание фермы серверов WFF**

1. На сервере контроллера WFF в меню **Пуск** укажите пункт **Администрирование**, а затем выберите пункт **Диспетчер службы IIS (IIS)** .
2. В области **подключения** разверните узел локального сервера, щелкните правой кнопкой мыши элемент **фермы серверов**и выберите пункт **создать ферму серверов**.
3. В диалоговом окне **Создание фермы серверов** введите понятное имя фермы серверов (например, **Промежуточная ферма**), а затем выберите **подготовить ферму серверов**.
4. Введите имя пользователя и пароль учетной записи домена, добавленной в локальную группу администраторов на каждом сервере.

    ![](creating-a-server-farm-with-the-web-farm-framework/_static/image6.png)
5. Щелкните **Далее**.
6. На странице **Добавление серверов** введите полное доменное имя (FQDN) сервера-источника, выберите **сервер-источник**и нажмите кнопку **добавить**.
7. На этом этапе WFF будет пытаться связаться с основным сервером, используя предоставленные учетные данные. Если соединение установлено, сервер-источник будет добавлен в таблицу на странице **Добавление серверов** .

    ![](creating-a-server-farm-with-the-web-farm-framework/_static/image7.png)

    > [!NOTE]
    > Возможно, вы заметили, что **сервер, доступный для балансировки нагрузки** , выбран по умолчанию. WFF использует модуль IIS ARR для реализации балансировки нагрузки и, таким образом, распределяет запросы между веб-серверами в ферме серверов. В большинстве случаев только **сервер доступен для балансировки нагрузки** , если вместо этого требуется использовать решение для балансировки нагрузки стороннего производителя.
8. На странице **Добавление серверов** введите полное доменное имя первого сервера-получателя, а затем нажмите кнопку **Добавить**.

    ![](creating-a-server-farm-with-the-web-farm-framework/_static/image8.png)
9. Повторите шаг 7 для дополнительных серверов-получателей в ферме, а затем нажмите кнопку **Готово**.

Ферма серверов WFF теперь запущена и работает. Все продукты или компоненты веб-платформы, которые устанавливаются на сервере-источнике, а также все приложения или содержимое, развертываемое на сервере источника, будут автоматически подготовлены на всех вторичных серверах.

WFF — это обширный и сложный раздел, и вы можете узнать больше о нем на веб [-сайте Microsoft Web ферма 2,0 для IIS 7](https://go.microsoft.com/?linkid=9805129) . Но в то же время есть две области, которые необходимо учитывать:

- *Подготовка приложений* — это процесс, который реплицирует содержимое с первичного сервера, например веб-приложения и параметры конфигурации, на все вторичные серверы фермы серверов. Например, при развертывании примера решения Contact Manager на основном промежуточном сервере процесс подготовки приложений WFF будет развертывать это решение на всех дополнительных промежуточных серверах. По умолчанию процесс подготовки приложений выполняется каждые 30 секунд.
- *Подготовка платформы* — это процесс, который синхронизирует продукты и компоненты веб-платформы, начиная с основного сервера и до всех вторичных серверов в ферме серверов. Например, если установить ASP.NET MVC 3 на основной промежуточный сервер, процесс подготовки платформы будет использовать установщик веб-платформы для установки ASP.NET MVC 3 на всех дополнительных промежуточных серверах. По умолчанию процесс подготовки платформы выполняется каждые пять минут.

Вы можете управлять базовыми параметрами подготовки приложений и платформ из диспетчера IIS на сервере контроллера WFF.

**Изучение параметров подготовки приложений и платформ**

1. В диспетчере служб IIS в области **подключения** выберите свою ферму серверов.

    ![](creating-a-server-farm-with-the-web-farm-framework/_static/image9.png)
2. В области **ферма серверов** дважды щелкните элемент **Подготовка приложений**.

    ![](creating-a-server-farm-with-the-web-farm-framework/_static/image10.png)
3. Как видите, ферма серверов в настоящее время настроена на синхронизацию веб-содержимого и параметров конфигурации между основным сервером и дополнительными серверами каждые 30 секунд.
4. Нажмите кнопку **назад**, а затем дважды щелкните **Подготовка платформы**.

    ![](creating-a-server-farm-with-the-web-farm-framework/_static/image11.png)
5. Как видите, ферма серверов в настоящее время настроена для синхронизации продуктов и компонентов веб-платформы между основным сервером и дополнительными серверами каждые пять минут.
6. Нажмите кнопку **Назад**.
7. Чтобы настроить ферму серверов на синхронизацию продуктов веб-платформы немедленно, на панели " **действия** " щелкните "выполнить **инициализацию платформы**".

    ![](creating-a-server-farm-with-the-web-farm-framework/_static/image12.png)

    > [!NOTE]
    > Подготовка платформы может занять некоторое время. Процесс установки выполняется в фоновом режиме на серверах-получателях фермы серверов.
8. Добавив достаточное время для завершения процесса подготовки, вы можете проверить, что продукты и компоненты, добавленные на сервер-источник, теперь реплицируются на серверах-получателях. Например, можно войти на сервер-получатель и использовать окно **Диспетчер сервера** , чтобы убедиться, что роль веб-сервера установлена.

    ![](creating-a-server-farm-with-the-web-farm-framework/_static/image13.png)
9. Можно также проверить список установленные программы, чтобы убедиться, что добавлены различные компоненты веб-платформы.

    ![](creating-a-server-farm-with-the-web-farm-framework/_static/image14.png)

## <a name="configure-load-balancing"></a>Настройка балансировки нагрузки

При создании веб-фермы необходимо настроить определенную форму балансировки нагрузки для распределения HTTP-запросов между вашими веб-серверами. Это может быть балансировка сетевой нагрузки Windows Server 2008, IIS ARR или программное решение для балансировки нагрузки на основе сторонних производителей или оборудования.

WFF предназначен для тесной интеграции с IIS ARR. Чтобы воспользоваться этой интеграцией, необходимо установить модуль ARR на сервере контроллера WFF. Затем весь веб-трафик направляется на сервер контроллера, обычно путем настройки записей системы доменных имен (DNS). Сервер контроллера будет распределять входящие запросы между серверами в ферме на основе доступности сервера и других критериев.

> [!NOTE]
> Не нужно использовать ARR с WFF; Вы можете настроить WFF для работы с решениями балансировки нагрузки сторонних производителей. Дополнительные сведения см. [в разделе Обзор инфраструктуры веб-фермы 2,0 для IIS 7](https://go.microsoft.com/?linkid=9805126).

Балансировка нагрузки с помощью ARR — сложная тема, большая часть которой выходит за рамки данного руководства. Однако вы можете использовать следующую процедуру, чтобы установить модуль ARR и начать работу с балансировкой нагрузки.

**Настройка балансировки нагрузки на сервере контроллера WFF**

1. На сервере контроллера WFF запустите установщик веб-платформы.
2. В верхней части окна **установщика веб-платформы 3,0** щелкните **Products (продукты**).
3. В левой части окна в области навигации щелкните **сервер**.
4. В строке **запрос приложения маршрутизация 2,5** нажмите кнопку **Добавить**.

    ![](creating-a-server-farm-with-the-web-farm-framework/_static/image15.png)
5. Нажмите кнопку **установить**, а затем следуйте инструкциям в окне **Установка веб-платформы** .
6. После завершения установки запустите Диспетчер IIS и в области **подключения** щелкните узел фермы серверов. Обратите внимание, что на панель « **ферма серверов** » Добавлено несколько новых значков.

    ![](creating-a-server-farm-with-the-web-farm-framework/_static/image16.png)
7. На панели **Ферма серверов** дважды щелкните **Балансировка нагрузки**.
8. В области **Балансировка нагрузки** выберите алгоритм балансировки нагрузки (например, по **крайней мере текущий запрос**).

    > [!NOTE]
    > Дополнительные сведения о алгоритмах балансировки нагрузки и других параметрах конфигурации см. в разделе [модуль маршрутизации запросов приложений](https://go.microsoft.com/?linkid=9805130).

    ![](creating-a-server-farm-with-the-web-farm-framework/_static/image17.png)
9. На панели **действия** нажмите кнопку **Применить**.

Теперь вы настроили базовую балансировку нагрузки для серверов в ферме серверов. Если направлять весь трафик веб-фермы на сервер контроллера, запросы будут распределяться между серверами в ферме в соответствии с доступностью и выбранным алгоритмом балансировки нагрузки.

Дополнительные сведения о настройке балансировки нагрузки с помощью ARR см. в разделе [модуль маршрутизации запросов приложений](https://go.microsoft.com/?linkid=9805130).

## <a name="monitor-the-server-farm"></a>Мониторинг фермы серверов

Вы можете в любое время отслеживать работоспособность фермы серверов с помощью диспетчера IIS на сервере контроллера. В области **подключения** разверните ферму сервера, а затем щелкните **серверы**. В центральной области отобразится сводка по каждому серверу в ферме вместе с журналом трассировки недавних действий.

![](creating-a-server-farm-with-the-web-farm-framework/_static/image18.png)

## <a name="conclusion"></a>Заключение

Ферма серверов WFF теперь должна быть запущена. Можно настроить сервер-источник для поддержки любого подхода к развертыванию,&#x2014;чтобы получить дополнительные сведения&#x2014;, а конфигурация будет реплицироваться на каждом сервере-получателе в ферме серверов.

## <a name="further-reading"></a>Дополнительные материалы

Дополнительные рекомендации по настройке и использованию WFF см. на веб [-сайте Microsoft Web siteing Framework 2,0 для IIS 7](https://go.microsoft.com/?linkid=9805129) .

> [!div class="step-by-step"]
> [Назад](configuring-a-database-server-for-web-deploy-publishing.md)
> [Вперед](configuring-deployment-properties-for-a-target-environment.md)
