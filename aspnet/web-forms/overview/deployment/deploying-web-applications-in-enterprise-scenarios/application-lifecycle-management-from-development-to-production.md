---
uid: web-forms/overview/deployment/deploying-web-applications-in-enterprise-scenarios/application-lifecycle-management-from-development-to-production
title: 'Управление жизненным циклом приложений: от разработки до рабочей среды | Документация Майкрософт'
author: jrjlee
description: В этом разделе показано, как вымышленная компания управляет развертыванием веб-приложения ASP.NET с помощью тестовых, промежуточных и рабочих сред в качестве номинала...
ms.author: riande
ms.date: 05/04/2012
ms.assetid: f97a1145-6470-4bca-8f15-ccfb25fb903c
msc.legacyurl: /web-forms/overview/deployment/deploying-web-applications-in-enterprise-scenarios/application-lifecycle-management-from-development-to-production
msc.type: authoredcontent
ms.openlocfilehash: 230cf4393db0ee19cfc42ed54359d61e7926a49d
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78520428"
---
# <a name="application-lifecycle-management-from-development-to-production"></a>Управление жизненным циклом приложений: от разработки до рабочей среды

кто [Джейсон Иванов](https://github.com/jrjlee)

[Скачать в формате PDF](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> В этом разделе показано, как вымышленная компания управляет развертыванием веб-приложения ASP.NET с помощью тестовой, промежуточной и рабочей сред в рамках процесса непрерывной разработки. В этом разделе приведены ссылки на дополнительные сведения и пошаговые руководства по выполнению конкретных задач.
> 
> Эта статья содержит общий обзор [ряда учебников](deploying-web-applications-in-enterprise-scenarios.md) по веб-развертыванию на предприятии. Не беспокойтесь, если вы не знакомы с некоторыми концепциями, описанными&#x2014;здесь, ознакомьтесь с подробными сведениями о всех этих задачах и методах.
> 
> > [!NOTE]
> > Для простоты в этом разделе не рассматривается обновление баз данных в рамках процесса развертывания. Однако выполнение добавочных обновлений функций баз данных является требованием многих сценариев корпоративного развертывания, и вы можете узнать, как это сделать дальше в этой серии руководств. Дополнительные сведения см. в разделе [развертывание проектов баз данных](../web-deployment-in-the-enterprise/deploying-database-projects.md).

## <a name="overview"></a>Обзор

Процесс развертывания, показанный здесь, основан на сценарии Fabrikam, Inc., описанном в разделе [Обзор корпоративного веб-развертывания: сценарий](enterprise-web-deployment-scenario-overview.md). Прежде чем изучите этот раздел, ознакомьтесь с обзором сценария. По сути, в этом сценарии рассматривается, как организация управляет развертыванием достаточно сложного веб-приложения, [решения диспетчера контактов](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)на различных этапах типичной корпоративной среды.

На высоком уровне решение диспетчера контактов проходит через эти этапы в рамках процесса разработки и развертывания:

1. Разработчик проверяет некоторый код на Team Foundation Server (TFS) 2010.
2. TFS создает код и выполняет все модульные тесты, связанные с командным проектом.
3. TFS развертывает решение в тестовой среде.
4. Группа разработчиков проверяет и проверяет решение в тестовой среде.
5. Администратор промежуточной среды выполняет развертывание "что если" в промежуточной среде, чтобы определить, будет ли развертывание вызывать проблемы.
6. Администратор промежуточной среды выполняет динамическое развертывание в промежуточной среде.
7. Решение проходит приемочное тестирование пользователем в промежуточной среде.
8. Пакеты веб-развертывания импортируются вручную в рабочую среду.

Эти этапы формируют часть цикла непрерывной разработки.

![](application-lifecycle-management-from-development-to-production/_static/image1.png)

На практике процесс немного сложнее, как можно увидеть, когда мы рассмотрим каждый этап более подробно. Fabrikam, Inc. использует другой подход к развертыванию для каждой целевой среды.

![](application-lifecycle-management-from-development-to-production/_static/image2.png)

В оставшейся части этого раздела рассматриваются следующие ключевые этапы этого жизненного цикла развертывания.

- **Предварительные требования**. Настройка серверной инфраструктуры перед размещением логики развертывания.
- **Начальная разработка и развертывание**: что необходимо сделать перед первым развертыванием решения.
- **Развертывание для тестирования**: как упаковывать и развертывать содержимое в тестовую среду автоматически при возврате разработчиком нового кода.
- **Развертывание в промежуточное хранение**. Развертывание конкретных сборок в промежуточной среде и выполнение развертываний "что если", чтобы гарантировать, что развертывание не приведет к возникновению каких-либо проблем.
- **Развертывание в рабочей**среде. Импорт веб-пакетов в рабочую среду, если сетевая инфраструктура предотвращает удаленное развертывание.

## <a name="prerequisites"></a>предварительные требования

Первая задача в любом сценарии развертывания заключается в том, чтобы серверная инфраструктура соответствовала требованиям средств и методов развертывания. В этом случае Fabrikam, Inc. настроила свою серверную инфраструктуру следующим образом:

- TFS настроен для включения коллекции командных проектов, контроллеров сборки и агентов сборки. Дополнительные сведения см. в разделе [настройка Team Foundation Server для автоматического веб-развертывания](../configuring-team-foundation-server-for-web-deployment/configuring-team-foundation-server-for-web-deployment.md) .
- Тестовая среда настроена для приема удаленных развертываний с помощью службы веб-Deployment Agent ("удаленный агент"), как описано в разделе [сценарий: Настройка тестовой среды для веб-развертывания](../configuring-server-environments-for-web-deployment/scenario-configuring-a-test-environment-for-web-deployment.md) и [Настройка веб-сервера для публикации веб-развертывание (удаленный агент)](../configuring-server-environments-for-web-deployment/configuring-a-web-server-for-web-deploy-publishing-remote-agent.md).
- Промежуточная среда настроена для приема удаленных развертываний с помощью конечной точки обработчика веб-развертывание, как описано в разделе [сценарий: Настройка промежуточной среды для веб-развертывания](../configuring-server-environments-for-web-deployment/scenario-configuring-a-staging-environment-for-web-deployment.md) и [Настройка веб-сервера для публикации веб-развертывание (обработчик веб-развертывание)](../configuring-server-environments-for-web-deployment/configuring-a-web-server-for-web-deploy-publishing-web-deploy-handler.md).
- Рабочая среда настроена таким образом, чтобы администратор вручную импортировал пакеты веб-развертывания в службы IIS (IIS), как описано в статье [о настройке рабочей среды для веб-развертывания](../configuring-server-environments-for-web-deployment/scenario-configuring-a-production-environment-for-web-deployment.md) и [настройке веб-сервера для публикации веб-развертывание (автономное развертывание)](../configuring-server-environments-for-web-deployment/configuring-a-web-server-for-web-deploy-publishing-offline-deployment.md).

## <a name="initial-development-and-deployment"></a>Начальная разработка и развертывание

Прежде чем компания Fabrikam, Inc. сможет развернуть решение диспетчера контактов в первый раз, необходимо выполнить следующие задачи:

- Создание нового командного проекта в TFS.
- Создайте файлы проекта Microsoft Build Engine (MSBuild), содержащие логику развертывания.
- Создайте определения сборки TFS, которые активируют процессы развертывания.

### <a name="create-a-new-team-project"></a>Создание нового командного проекта

- Администратор TFS, Вадим Валтерс, создает новый командный проект для приложения, как описано в разделе [Создание командного проекта в TFS](../configuring-team-foundation-server-for-web-deployment/creating-a-team-project-in-tfs.md). Затем ведущий разработчик, Мэтт Хинк, создает скелетное решение. Он проверяет свои файлы в новом командном проекте в TFS, как описано в разделе [Добавление содержимого в систему управления версиями](../configuring-team-foundation-server-for-web-deployment/adding-content-to-source-control.md).

### <a name="create-the-deployment-logic"></a>Создание логики развертывания

Мэтт Хинк создает различные пользовательские файлы проектов MSBuild, используя подход к файлам с разделением проекта, описанный в разделе [Общие сведения о файле проекта](../web-deployment-in-the-enterprise/understanding-the-project-file.md). Мэтт создает:

- Файл проекта с именем *Publish. proj* , который запускает процесс развертывания. Этот файл содержит целевые объекты MSBuild, которые создают проекты в решении, создают веб-пакеты и развертывают пакеты в среде целевого сервера.
- Файлы проекта для конкретной среды с именами *env-dev. proj* и *env-Stage. proj*. Они содержат параметры, характерные для тестовой среды и промежуточной среды соответственно, например строки подключения, конечные точки службы и сведения об удаленной службе, которая будет принимать веб-пакет. Рекомендации по выбору правильных параметров для конкретных целевых сред см. в разделе [Настройка свойств развертывания для целевой среды](../configuring-server-environments-for-web-deployment/configuring-deployment-properties-for-a-target-environment.md).

Для запуска развертывания пользователь выполняет файл *Publish. proj* с помощью MSBuild или Team Build и задает расположение соответствующего файла проекта конкретной среды (*env-dev. proj* или *env-Stage. proj*) в качестве аргумента командной строки. Затем файл *Publish. proj* импортирует файл проекта конкретной среды, чтобы создать полный набор инструкций по публикации для каждой целевой среды.

> [!NOTE]
> Способ работы этих файлов пользовательских проектов не зависит от механизма, используемого для вызова MSBuild. Например, можно напрямую использовать командную строку MSBuild, как описано в разделе [Общие сведения о файле проекта](../web-deployment-in-the-enterprise/understanding-the-project-file.md). Файлы проекта можно запустить из командного файла, как описано в разделе [Создание и запуск командного файла развертывания](../web-deployment-in-the-enterprise/creating-and-running-a-deployment-command-file.md). Кроме того, можно запускать файлы проекта из определения сборки в TFS, как описано в разделе [Создание определения сборки, поддерживающего развертывание](../configuring-team-foundation-server-for-web-deployment/creating-a-build-definition-that-supports-deployment.md).  
> В каждом случае конечный результат совпадает с тем,&#x2014;что MSBuild выполняет объединенный файл проекта и развертывает решение в целевой среде. Это обеспечивает большую гибкость при запуске процесса публикации.

После создания пользовательских файлов проекта Мэтт добавляет их в папку решения и выполняет их возврат в систему управления версиями.

### <a name="create-build-definitions"></a>Создание определений построений

Как окончательная задача подготовки, Мэтт и Вадим работают вместе для создания трех определений сборки для нового командного проекта:

- **Деплойтотест**. Это позволяет построить решение диспетчера контактов и развернуть его в тестовой среде каждый раз, когда происходит возврат.
- **Деплойтостагинг**. При этом ресурсы из указанной предыдущей сборки развертываются в промежуточной среде, когда разработчик помещает сборку в очередь.
- **Деплойтостагинг-WhatIf**. При этом выполняется развертывание в промежуточной среде, когда разработчик помещает сборку в очередь.

В последующих разделах приводятся дополнительные сведения о каждом из этих определений сборки.

## <a name="deployment-to-test"></a>Развертывание для тестирования

Группа разработчиков компании Fabrikam, Inc. обслуживает тестовые среды для выполнения различных действий тестирования программного обеспечения, таких как проверка и проверка, тестирование на удобство использования, тестирование совместимости, прямое или произвольное тестирование.

Группа разработки создала определение сборки в TFS с именем **деплойтотест**. В этом определении сборки используется триггер непрерывной интеграции. Это означает, что процесс сборки выполняется каждый раз, когда член группы разработчиков Fabrikam, Inc. выполняет возврат. При запуске сборки определение сборки будет следующим образом:

- Создайте решение ContactManager. sln. Это, в свою очередь, создает каждый проект в решении.
- Выполните все модульные тесты в структуре папок решения (если решение успешно построено).
- Запустите пользовательские файлы проекта, управляющие процессом развертывания (если решение успешно построено и проходят все модульные тесты).

Конечный результат заключается в том, что если решение успешно построено и прошло модульные тесты, веб-пакеты и другие ресурсы развертывания развертываются в тестовой среде.

![](application-lifecycle-management-from-development-to-production/_static/image3.png)

### <a name="how-does-the-deployment-process-work"></a>Как работает процесс развертывания?

Определение сборки **деплойтотест** предоставляет эти аргументы MSBuild:

[!code-console[Main](application-lifecycle-management-from-development-to-production/samples/sample1.cmd)]

Свойства пакета **деплойонбуилд = true** и **деплойтаржет =** используются при сборке проектов в решении Team Build. Если проект является проектом веб-приложения, эти свойства указывают MSBuild создать пакет веб-развертывания для проекта. Свойство **таржетенвпропсфиле** сообщает файлу *Publish. proj* , где найти файл проекта конкретной среды для импорта.

> [!NOTE]
> Подробное пошаговое руководство по созданию определения сборки, подобно этому, см. в разделе [Создание определения сборки, поддерживающего развертывание](../configuring-team-foundation-server-for-web-deployment/creating-a-build-definition-that-supports-deployment.md).

Файл *Publish. proj* содержит целевые объекты, которые создают каждый проект в решении. Однако он также включает условную логику, которая пропускает эти целевые объекты сборки, если вы выполняете файл в Team Build. Это позволяет воспользоваться преимуществами дополнительных функций сборки, предоставляемых Team Build, таких как возможность выполнять модульные тесты. Если сборка решения или модульные тесты завершились ошибкой, файл *Publish. proj* не будет выполнен и приложение не будет развернуто.

Условная логика достигается путем вычисления свойства **буилдингинтеамбуилд** . Это свойство MSBuild, которое автоматически устанавливается в **значение true** при использовании Team Build для построения проектов.

## <a name="deployment-to-staging"></a>Развертывание в промежуточное хранение

Когда сборка отвечает всем требованиям группы разработчиков в тестовой среде, группе может потребоваться развернуть ту же сборку в промежуточной среде. Промежуточные среды обычно настраиваются таким образом, чтобы они соответствовали характеристикам рабочей или "живой" среды, например, с точки зрения серверных спецификаций, операционных систем и программного обеспечения и сетевой конфигурации. Промежуточные среды часто используются для нагрузочного тестирования, приемочного тестирования пользователей и более подробных внутренних проверок. Сборки развертываются в промежуточной среде непосредственно с сервера сборки.

![](application-lifecycle-management-from-development-to-production/_static/image4.png)

Определения сборки, используемые для развертывания решения в промежуточной среде, **деплойтостагинг-WhatIf** и **деплойтостагинг**, имеют следующие характеристики:

- Они вообще ничего не создают. Когда Вадим развертывает решение в промежуточной среде, он хочет развернуть определенную существующую сборку, которая уже проверена и проверена в тестовой среде. Для определения сборки необходимо только запустить пользовательские файлы проекта, которые управляют процессом развертывания.
- Когда Вадим запускает сборку, он использует параметры сборки, чтобы указать, какая сборка содержит ресурсы, которые он хочет развернуть на сервере сборки.
- Определения сборки не запускаются автоматически. Вадим вручную помещает сборку в очередь, когда ему требуется развернуть решение в промежуточной среде.

Это высокоуровневая процедура развертывания в промежуточной среде.

1. Администратор промежуточной среды, Вадим Валтерс, помещает сборку в очередь с помощью определения сборки **деплойтостагинг-WhatIf** . Вадим использует параметры определения сборки, чтобы указать, какую сборку нужно развернуть.
2. Определение сборки **деплойтостагинг-WhatIf** запускает пользовательские файлы проекта в режиме "что если". При этом создаются файлы журнала, как если бы Вадим выполнял динамическое развертывание, но фактически не вносит никаких изменений в целевую среду.
3. Вадим проверяет файлы журнала, чтобы определить последствия развертывания в промежуточной среде. В частности, Вадим хочет проверить, что будет добавлено, что будет обновлено и что будет удалено.
4. Если Вадим удовлетворен тем, что развертывание не внесет нежелательные изменения в существующие ресурсы или данные, он помещает сборку в очередь с помощью определения сборки **деплойтостагинг** .
5. Определение сборки **деплойтостагинг** запускает пользовательские файлы проекта. Они публикуют ресурсы развертывания на основном веб-сервере в промежуточной среде.
6. Контроллер инфраструктуры веб-фермы (WFF) синхронизирует веб-серверы в промежуточной среде. Это сделает приложение доступным на всех веб-серверах фермы серверов.

### <a name="how-does-the-deployment-process-work"></a>Как работает процесс развертывания?

Определение сборки **деплойтостагинг** предоставляет эти аргументы MSBuild:

[!code-console[Main](application-lifecycle-management-from-development-to-production/samples/sample2.cmd)]

Свойство **таржетенвпропсфиле** сообщает файлу *Publish. proj* , где найти файл проекта конкретной среды для импорта. Свойство **аутпутрут** переопределяет встроенное значение и указывает расположение папки сборки, содержащей ресурсы, которые требуется развернуть. Когда Вадим помещает сборку в очередь, он использует вкладку **Параметры** для предоставления обновленного значения для свойства **аутпутрут** .

![](application-lifecycle-management-from-development-to-production/_static/image5.png)

> [!NOTE]
> Дополнительные сведения о том, как создать определение сборки подобным образом, см. в разделе [развертывание определенной сборки](../configuring-team-foundation-server-for-web-deployment/deploying-a-specific-build.md).

Определение сборки **деплойтостагинг-WhatIf** содержит ту же логику развертывания, что и определение сборки **деплойтостагинг** . Однако он включает дополнительный аргумент **WhatIf = true**:

[!code-console[Main](application-lifecycle-management-from-development-to-production/samples/sample3.cmd)]

В файле *Publish. proj* свойство **WhatIf** указывает, что все ресурсы развертывания должны быть опубликованы в режиме "что если". Иными словами, файлы журнала создаются так, как если бы развертывание выполнялось раньше, но в целевой среде ничего не изменилось. Это позволяет оценить влияние предлагаемого развертывания&#x2014;в частности, то, что будет добавлено, что будет обновлено и что будет удалено&#x2014;до фактического внесения изменений.

> [!NOTE]
> Дополнительные сведения о настройке развертываний "что если" см. в разделе [выполнение развертывания "What If"](../advanced-enterprise-web-deployment/performing-a-what-if-deployment.md).

После развертывания приложения на основном веб-сервере в промежуточной среде WFF будет автоматически синхронизировать приложение на всех серверах фермы серверов.

> [!NOTE]
> Дополнительные сведения о настройке WFF для синхронизации веб-серверов см. в статье [Создание фермы серверов с помощью платформы веб-фермы](../configuring-server-environments-for-web-deployment/creating-a-server-farm-with-the-web-farm-framework.md).

## <a name="deployment-to-production"></a>Развертывание в рабочей среде

При утверждении сборки в промежуточной среде группа Fabrikam, Inc. может опубликовать приложение в рабочей среде. Рабочая среда — это то место, где приложение переходит в активное расположение, и достигает целевой аудитории конечных пользователей.

Рабочая среда находится в сети периметра с выходом в Интернет. Это изолировано от внутренней сети, содержащей сервер сборки. Администратор рабочей среды, Lisa Andrews), должен вручную скопировать пакеты веб-развертывания с сервера сборки и импортировать их в службы IIS на основном рабочем веб-сервере.

![](application-lifecycle-management-from-development-to-production/_static/image6.png)

Это высокоуровневая процедура развертывания в рабочей среде:

1. Группа разработчиков рекомендует Lisa, что сборка готова к развертыванию в рабочей среде. Команда рекомендует Lisa расположение пакетов веб-развертывания в транзитной папке на сервере сборки.
2. Lisa собирает веб-пакеты с сервера сборки и копирует их на основной веб-сервер в рабочей среде.
3. Lisa использует диспетчер IIS для импорта и публикации веб-пакетов на основном веб-сервере.
4. Контроллер WFF синхронизирует веб-серверы в рабочей среде. Это сделает приложение доступным на всех веб-серверах фермы серверов.

### <a name="how-does-the-deployment-process-work"></a>Как работает процесс развертывания?

Диспетчер IIS включает мастер импорта пакетов приложений, который упрощает публикацию веб-пакетов на веб-сайте IIS. Пошаговое руководство по выполнению этой процедуры см. в разделе [Установка веб-пакетов вручную](../web-deployment-in-the-enterprise/manually-installing-web-packages.md).

## <a name="conclusion"></a>Заключение

В этом разделе приведена схема жизненного цикла развертывания для типичного веб-приложения корпоративного уровня.

Этот раздел является частью серии руководств, в которых содержатся рекомендации по различным аспектам развертывания веб-приложений. На практике существует множество дополнительных задач и вопросов на каждом этапе процесса развертывания, и их невозможно охватить в одном пошаговом руководстве. Дополнительные сведения см. в следующих руководствах:

- [Веб-развертывание на предприятии](../web-deployment-in-the-enterprise/web-deployment-in-the-enterprise.md). Это руководство содержит исчерпывающие сведения о методах веб-развертывания с помощью MSBuild и средства веб-развертывания IIS (веб-развертывание).
- [Настройка серверных сред для веб-развертывания](../configuring-server-environments-for-web-deployment/configuring-server-environments-for-web-deployment.md). В этом учебнике содержатся инструкции по настройке сред Windows Server для поддержки различных сценариев развертывания.
- [Настройка Team Foundation Server для автоматического веб-развертывания](../configuring-team-foundation-server-for-web-deployment/configuring-team-foundation-server-for-web-deployment.md). В этом руководстве содержатся рекомендации по интеграции логики развертывания в процессы сборки TFS.
- [Расширенное корпоративное веб-развертывание](../advanced-enterprise-web-deployment/advanced-enterprise-web-deployment.md). В этом учебнике содержатся рекомендации по решению некоторых из более сложных проблем развертывания, которые сталкиваются с организациями.

> [!div class="step-by-step"]
> [Назад](enterprise-web-deployment-scenario-overview.md)
