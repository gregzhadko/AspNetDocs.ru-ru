---
uid: web-forms/overview/deployment/visual-studio-web-deployment/command-line-deployment
title: 'ASP.NET веб-развертывание с помощью Visual Studio: развертывание из командной строки | Документация Майкрософт'
author: tdykstra
description: В этой серии руководств показано, как развернуть (опубликовать) веб-приложение ASP.NET в веб-приложениях службы приложений Azure или поставщике услуг размещения стороннего поставщика, Усин...
ms.author: riande
ms.date: 02/15/2013
ms.assetid: 82b8dea0-f062-4ee4-8784-3ffa30fbb1ca
msc.legacyurl: /web-forms/overview/deployment/visual-studio-web-deployment/command-line-deployment
msc.type: authoredcontent
ms.openlocfilehash: 13cfe4492398b59f2c80394689cc113ccb218c60
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/28/2019
ms.locfileid: "74634205"
---
# <a name="aspnet-web-deployment-using-visual-studio-command-line-deployment"></a>ASP.NET веб-развертывание с помощью Visual Studio: развертывание из командной строки

от [Tom Dykstra)](https://github.com/tdykstra)

[Скачать начальный проект](https://go.microsoft.com/fwlink/p/?LinkId=282627)

> В этой серии руководств показано, как развернуть (опубликовать) веб-приложение ASP.NET в веб-приложениях службы приложений Azure или поставщике услуг размещения стороннего поставщика с помощью Visual Studio 2012 или Visual Studio 2010. Сведения о ряде см. в [первом руководстве по ряду](introduction.md).

## <a name="overview"></a>Обзор

В этом руководстве показано, как вызвать конвейер веб-публикации Visual Studio из командной строки. Это полезно для сценариев, в которых необходимо [автоматизировать процесс развертывания](../../../../aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery.md) вместо ручного выполнения в Visual Studio, обычно с помощью [системы управления версиями исходного кода](../../../../aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control.md).

## <a name="make-a-change-to-deploy"></a>Внесение изменений в развертывание

В настоящее время на странице About отображается код шаблона.

![Страница "о программе" с кодом шаблона](command-line-deployment/_static/image1.png)

Вы замените это на код, отображающий сводку по регистрации учащихся.

Откройте страницу *About. aspx* , удалите всю разметку в элементе `MainContent` `Content` и вставьте в нее следующую разметку:

[!code-aspx[Main](command-line-deployment/samples/sample1.aspx)]

Запустите проект и выберите страницу **About (о программе** ).

![Страница About](command-line-deployment/_static/image2.png)

## <a name="deploy-to-test-by-using-the-command-line"></a>Развертывание для тестирования с помощью командной строки

Вы не будете развертывать еще одно изменение базы данных, поэтому отключите развертывание базы данных Дбдакфкс для базы данных ASPNET-ContosoUniversity. Откройте мастер **публикации веб-сайта** и в каждом из трех профилей публикации снимите флажок **обновить базу данных** на вкладке **Параметры** .

На начальной странице Windows 8 выполните поиск **Командная строка разработчика для VS2012**.

Щелкните правой кнопкой мыши значок **Командная строка разработчика для VS2012** и выберите команду **Запуск от имени администратора**.

В командной строке введите следующую команду, заменив путь к файлу решения на путь к файлу решения:

[!code-console[Main](command-line-deployment/samples/sample2.cmd)]

MSBuild создает решение и развертывает его в тестовой среде.

![Данные, выводимые в командной строке](command-line-deployment/_static/image3.png)

Откройте браузер и перейдите в `http://localhost/ContosoUniversity`, а затем щелкните страницу " **о программе** ", чтобы убедиться, что развертывание прошло успешно.

Если вы еще не создали учащихся в тесте, вы увидите пустую страницу под заголовком **Статистика текста учащегося** . Перейдите на страницу **учащихся** , нажмите кнопку **Добавить учащийся**и добавьте учащихся, а затем вернитесь на страницу **About** , чтобы просмотреть статистику учащихся.

![Сведения о странице в тестовой среде](command-line-deployment/_static/image4.png)

## <a name="key-command-line-options"></a>Ключевые параметры командной строки

Введенная команда передала путь к файлу решения и два свойства в MSBuild:

[!code-console[Main](command-line-deployment/samples/sample3.cmd)]

### <a name="deploying-the-solution-versus-deploying-individual-projects"></a>Развертывание решения и развертывание отдельных проектов

Указание файла решения вызывает построение всех проектов в решении. Если в решении имеется несколько веб-проектов, применяется следующее поведение MSBuild:

- Свойства, указанные в командной строке, передаются в каждый проект. Таким образом, каждый веб-проект должен иметь профиль публикации с указанным именем. При указании `/p:PublishProfile=Test`каждый веб-проект должен иметь профиль публикации с именем *Test*.
- Вы можете успешно опубликовать один проект, если он еще не построен. Дополнительные сведения см. в описании StackOverflow потока [MSBuild с двумя пакетами](http://stackoverflow.com/questions/14226451/msbuild-fails-with-two-packages).

Если вместо решения указан отдельный проект, необходимо добавить параметр, указывающий версию Visual Studio. При использовании Visual Studio 2012 Командная строка будет выглядеть так, как показано в следующем примере:

[!code-console[Main](command-line-deployment/samples/sample4.cmd?highlight=1)]

Номер версии Visual Studio 2010 — 10,0. Дополнительные сведения см. в разделе [Совместимость проектов Visual Studio и VisualStudioVersion](http://sedodream.com/2012/08/19/VisualStudioProjectCompatabilityAndVisualStudioVersion.aspx) в блоге Саид Хашими.

### <a name="specifying-the-publish-profile"></a>Указание профиля публикации

Профиль публикации можно указать по имени или по полному пути к *pubxml* файлу, как показано в следующем примере:

[!code-console[Main](command-line-deployment/samples/sample5.cmd?highlight=1)]

### <a name="web-publish-methods-supported-for-command-line-publishing"></a>Методы веб-публикации, поддерживаемые для публикации из командной строки

Для публикации из командной строки поддерживаются три метода публикации:

- `MSDeploy`-Publish с помощью веб-развертывание.
- `Package` опубликовать, создав пакет веб-развертывание. Пакет необходимо установить отдельно от команды MSBuild, которая его создает.
- `FileSystem` — публикация путем копирования файлов в указанную папку.

### <a name="specifying-the-build-configuration-and-platform"></a>Указание конфигурации и платформы сборки

Конфигурация и платформа сборки должны быть установлены в Visual Studio или в командной строке. Профили публикации содержат свойства с именами `LastUsedBuildConfiguration` и `LastUsedPlatform`, но эти свойства нельзя задать для определения способа построения проекта. Дополнительные сведения см. в разделе [MSBuild: как задать свойство конфигурации](http://sedodream.com/2012/10/27/MSBuildHowToSetTheConfigurationProperty.aspx) в блоге Саид Хашими.

## <a name="deploy-to-staging"></a>Развертывание в промежуточное хранение

Чтобы выполнить развертывание в Azure, необходимо добавить пароль в командную строку. Если вы сохранили пароль в профиле публикации в Visual Studio, он хранился в зашифрованном виде в файле *. pubxml. User* . Этот файл не доступен для MSBuild при выполнении развертывания из командной строки, поэтому необходимо передать пароль в параметре командной строки.

1. Скопируйте необходимый пароль из файла *. publishsettings* , скачанного ранее для промежуточного веб-сайта. Пароль — это значение атрибута `userPWD` для элемента веб-развертывание `publishProfile`.

    ![веб-развертывание пароль](command-line-deployment/_static/image5.png)
2. На начальной странице Windows 8 найдите **Командная строка разработчика для VS2012**и щелкните значок, чтобы открыть командную строку. (Вам не нужно открывать его в качестве администратора в этот раз, так как вы не развертываете IIS на локальном компьютере.)
3. В командной строке введите следующую команду, заменив путь к файлу решения на путь к файлу решения и пароль с паролем:

    [!code-console[Main](command-line-deployment/samples/sample6.cmd)]

    Обратите внимание, что эта командная строка включает дополнительный параметр: `/p:AllowUntrustedCertificate=true`. По мере написания этого руководства во время публикации в Azure из командной строки необходимо задать свойство `AllowUntrustedCertificate`. Когда исправление для этой ошибки будет выпущено, этот параметр не потребуется.
4. Откройте браузер и перейдите по URL-адресу промежуточного сайта, а затем щелкните страницу **About (сведения** ), чтобы проверить успешность развертывания.

    Как было показано ранее для тестовой среды, для просмотра статистики на странице **About** может потребоваться создать несколько учащихся.

## <a name="deploy-to-production"></a>Развертывание в рабочей среде

Процесс развертывания в рабочей среде аналогичен процессу для промежуточного хранения.

1. Скопируйте необходимый пароль из файла *. publishsettings* , скачанного ранее для рабочего веб-сайта.
2. Откройте **Командная строка разработчика для VS2012**.
3. В командной строке введите следующую команду, заменив путь к файлу решения на путь к файлу решения и пароль с паролем:

    [!code-console[Main](command-line-deployment/samples/sample7.cmd)]

    При работе с реальным рабочим сайтом, если также изменилась база данных, то, как правило, вы копируете *приложение\_автономный htm* -файл на сайт перед развертыванием и удаляете его после успешного развертывания.
4. Откройте браузер и перейдите по URL-адресу промежуточного сайта, а затем щелкните страницу **About (сведения** ), чтобы проверить успешность развертывания.

## <a name="summary"></a>Сводка

Теперь вы развернули обновление приложения с помощью командной строки.

![Сведения о странице в тестовой среде](command-line-deployment/_static/image6.png)

В следующем руководстве вы увидите пример расширения конвейера веб-публикации. В примере показано, как развернуть файлы, которые не включены в проект.

> [!div class="step-by-step"]
> [Назад](deploying-a-database-update.md)
> [Вперед](deploying-extra-files.md)
