---
uid: web-forms/overview/deployment/visual-studio-web-deployment/web-config-transformations
title: 'ASP.NET веб-развертывание с помощью визуальной студии: Web.config Файлов Преобразование (ru) Документы Майкрософт'
author: tdykstra
description: Эта серия учебников показывает, как развернуть (опубликовать) ASP.NET веб-приложений для Web Apps App Sazure или стороннего хостинг-провайдера, usin...
ms.author: riande
ms.date: 02/15/2013
ms.assetid: 5a2a927b-14cb-40bc-867a-f0680f9febd7
msc.legacyurl: /web-forms/overview/deployment/visual-studio-web-deployment/web-config-transformations
msc.type: authoredcontent
ms.openlocfilehash: a9d39547c94a63003442ba6fe1257693dde24b05
ms.sourcegitcommit: ce28244209db8615bc9bdd576a2e2c88174d318d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2020
ms.locfileid: "80675751"
---
# <a name="aspnet-web-deployment-using-visual-studio-webconfig-file-transformations"></a>ASP.NET веб-развертывание с помощью визуальной студии: Web.config Файлов Преобразования

[Том Дайкстра](https://github.com/tdykstra)

[Скачать стартовый проект](https://go.microsoft.com/fwlink/p/?LinkId=282627)

> Эта серия учебников показывает, как развернуть (опубликовать) веб-приложение ASP.NET в Web Apps App Service или стороннему хостинг-провайдеру, используя Visual Studio 2012 или Visual Studio 2010. Для получения информации о серии, смотрите [первый учебник в серии](introduction.md).

## <a name="overview"></a>Обзор

В этом учебнике показано, как автоматизировать процесс изменения файла *Web.config* при развертывании его в различных средах назначения. Большинство приложений имеют настройки в файле *Web.config,* которые должны отличаться при развертывании приложения. Автоматизация процесса внесения этих изменений удерживает вас от необходимости делать их вручную каждый раз при развертывании, что было бы утомительно и подвержено ошибкам.

Напоминание: Если вы получаете сообщение об ошибке или что-то не работает, как вы идете через учебник, не забудьте проверить [страницу устранения неполадок](troubleshooting.md).

## <a name="webconfig-transformations-versus-web-deploy-parameters"></a>Преобразования Web.config по сравнению с параметрами Web Deploy

Существует два способа автоматизации процесса изменения параметров файла *Web.config:* [преобразования Web.config](https://msdn.microsoft.com/library/dd465326.aspx) и [параметры Web Deploy.](https://msdn.microsoft.com/library/ff398068.aspx) Файл преобразования *Web.config* содержит разметку XML, которая определяет, как изменить файл *Web.config* при развертывании. Можно указать различные изменения для определенных конфигураций сборки и для определенных профилей публикаций. Конфигурации сборки по умолчанию — это отогладить и выпустить, и можно создавать пользовательские конфигурации сборки. Профиль публикации обычно соответствует среде назначения. (Вы узнаете больше об публикации профилей в [развертывании на IIS](deploying-to-iis.md) в качестве учебника по тестовой среде.)

Параметры Web Deploy можно использовать для указания различных параметров, которые необходимо настроить во время развертывания, включая параметры, найденные в файлах *Web.config.* При использовании для указания изменений файла *Web.config* параметры Web Deploy являются более сложными для настройки, но они полезны, когда вы не знаете значение, необходимое для развертывания. Например, в корпоративной среде можно создать *пакет развертывания* и передать его сотруднику ИТ-отдела для установки в производственном отделе, и этот человек должен иметь возможность вводить строки соединения или пароли, которые вы не знаете.

Для сценария, который охватывает эта серия учебников, вы заранее знаете все, что должно быть сделано с файлом *Web.config,* поэтому вам не нужно использовать параметры Web Deploy. Вы настраиваете некоторые преобразования, которые различаются в зависимости от используемой конфигурации сборки, и некоторые из них отличаются в зависимости от используемого профиля публикации.

<a id="watransforms"></a>

## <a name="specifying-webconfig-settings-in-azure"></a>Уточнение настроек Web.config в Azure

Если настройки файла *Web.config,* которые вы `<connectionStrings>` хотите `<appSettings>` изменить, находятся в элементе или элементе, и если вы развертываете в Web-приложениях в службе приложений Azure, у вас есть другой вариант автоматизации изменений во время развертывания. Можно ввести параметры, которые необходимо ввести в Azure, во вкладке **Настройка** страницы портала управления для веб-приложения (прокрутите вниз к **настройкам приложения** и **разделам строк подключения).** При развертывании проекта Azure автоматически применяет изменения. Для получения дополнительной информации [см. веб-сайты Windows Azure: Как работают строки приложений и строки подключения.](https://blogs.msdn.com/b/windowsazure/archive/2013/07/17/windows-azure-web-sites-how-application-strings-and-connection-strings-work.aspx)

## <a name="default-transformation-files"></a>Файлы преобразования по умолчанию

В **Solution Explorer**расширьте *Web.config,* чтобы просмотреть *Web.Debug.config* и *Web.Release.config* файлы трансформации, которые создаются по умолчанию для двух конфигураций сборки по умолчанию.

![Web.config_transform_files](web-config-transformations/_static/image1.png)

Можно создать файлы преобразования для пользовательских конфигураций сборки, нажав правой кнопкой мыши на файл Web.config и выбрав **Add Config Transforms** из контекстного меню. Для этого учебника вам не нужно этого делать, и параметр меню отключен, потому что вы не создали никаких пользовательских конфигураций сборки.

Позже вы создадите еще три файла трансформации, по одному для тестирования, постановки и публикации профилей production. Типичным примером параметра, который можно обрабатывать в файле преобразования профиля публикации, поскольку это зависит от среды назначения, является конечная точка WCF, которая отличается для тестирования и производства. Вы создадите файлы преобразования профиля в более поздних учебниках после создания профилей публикаций, с которыми они идут.

## <a name="disable-debug-mode"></a>Режим отсвасывательного отсваги

Примером параметра, который зависит от конфигурации `debug` сборки, а не среды назначения, является атрибут. Для сборки выпуска обычно требуется отключение отладки независимо от среды, в которую вы развертываете. Поэтому по умолчанию шаблоны проекта Visual Studio создают *Web.Release.config* `debug` преобразующие файлы с кодом, который удаляет атрибут из элемента. `compilation` Вот *Web.Release.config*по умолчанию : в дополнение к некоторым кодом преобразования `compilation` образца, `debug` который комментируется, он включает в себя код в элементе, который удаляет атрибут:

[!code-xml[Main](web-config-transformations/samples/sample1.xml?highlight=18)]

Атрибут `xdt:Transform="RemoveAttributes(debug)"` указывает, что `debug` атрибут должен быть удален из `system.web/compilation` элемента в развернутом файле *Web.config.* Это будет сделано каждый раз, когда вы развертываете сборку release.

## <a name="limit-error-log-access-to-administrators"></a>Ограничьте доступ к администраторам журналов ошибок

При ошибке во время работы приложения приложение отображает общую страницу ошибки вместо генерируемой системой страницы ошибок и использует [пакет Elmah NuGet](http://www.hanselman.com/blog/NuGetPackageOfTheWeek7ELMAHErrorLoggingModulesAndHandlersWithSQLServerCompact.aspx) для регистрации ошибок и отчетности. Элемент `customErrors` в файле приложения *Web.config* определяет страницу ошибки:

[!code-xml[Main](web-config-transformations/samples/sample2.xml)]

Чтобы увидеть страницу ошибки, `mode` временно `customErrors` измените атрибут элемента с "RemoteOnly" на "On" и запустите приложение из Visual Studio. Причина ошибки, запрашивая недействительный URL, например *Studentsxxx.aspx*. Вместо страницы ошибок, генерируемой IIS "Ресурс не может быть найден", вы видите страницу *GenericErrorPage.aspx.*

![Страница ошибки](web-config-transformations/_static/image2.png)

Чтобы увидеть журнал ошибок, замените все в URL-адресе после номера `http://localhost:51130/elmah.axd`порта *на elmah.axd* (например, ) и нажмите Enter:

![Страница ELMAH](web-config-transformations/_static/image3.png)

Не забудьте настроить `customErrors` элемент обратно в режим "RemoteOnly", когда вы закончите.

На компьютере разработки удобно обеспечить свободный доступ к странице журнала ошибок, но в процессе производства, что будет угрозой безопасности. Для производственной площадки необходимо добавить правило авторизации, ограничивающее доступ к администраторам журналов ошибок, а также убедиться, что ограничение также работает в тестовом и постановке. Таким образом, это еще одно изменение, которое требуется реализовать при развертывании сборки release, и поэтому оно принадлежит файлу *Web.Release.config.*

Откройте *Web.Release.config* и `location` добавьте новый элемент непосредственно перед тегом закрытия, `configuration` как показано здесь.

[!code-xml[Main](web-config-transformations/samples/sample3.xml?highlight=27-34)]

Значение `Transform` атрибута "Вставка" `location` приводит к тому, что `location` этот элемент добавляется в качестве брата к любым существующим элементам в файле *Web.config.* (Уже есть `location` один элемент, который определяет правила авторизации для **страницы «Кредиты обновления».)**

Теперь вы можете просмотреть преобразование, чтобы убедиться, что вы закодировали его правильно.

В **Solution Explorer**, правой кнопкой мыши *Web.Release.config* и нажмите **Предварительный преобразование**.

![Предварительный просмотр меню Преобразование](web-config-transformations/_static/image4.png)

Открывается страница, повествующий о файле *Web.config* развития слева и о том, как будет выглядеть развернутый файл *Web.config* справа с выделенными изменениями.

![Предварительный просмотр преобразования отладки](web-config-transformations/_static/image5.png)

![Предварительный просмотр преобразования местоположения](web-config-transformations/_static/image6.png)

( В предварительном просмотре вы можете заметить некоторые дополнительные изменения, которые вы не написали преобразования для: они обычно связаны с удалением белого пространства, которое не влияет на функциональность.)

При тестировании сайта после развертывания вы также проверите, чтобы убедиться, что правило авторизации является эффективным.

> [!NOTE] 
> 
> **Примечание безопасности** Никогда не отображайте сведения об ошибках в производственном приложении и не храните эту информацию в общедоступном месте. Злоумышленники могут использовать информацию об ошибках для обнаружения уязвимостей на сайте. Если вы используете ELMAH в собственном приложении, наймите ELMAH, чтобы минимизировать риски безопасности. Пример ELMAH в этом уроке не следует рассматривать как рекомендуемую конфигурацию. Это пример, который был выбран для того, чтобы проиллюстрировать, как обрабатывать папку, в которую приложение должно быть в состоянии создавать файлы. Для получения дополнительной [информации см.](https://code.google.com/p/elmah/wiki/SecuringErrorLogPages)

## <a name="a-setting-that-youll-handle-in-publish-profile-transformation-files"></a>Настройка, которую вы будете обрабатывать в файлах преобразования профиля

Распространенным сценарием является создание параметров файлов *Web.config,* которые должны отличаться в каждой среде, в которую вы развертываете. Например, приложению, которое вызывает службу WCF, может потребоваться другая конечная точка в тестовых и производственных средах. Приложение Университета Контосо также включает в себя настройки такого рода. Эта настройка управляет видимым индикатором на страницах сайта, который показывает, в какой среде вы находитесь, например, разработка, тестирование или производство. Значение настройки определяет, будет ли приложение придатить "(Dev)" или "(Test)" к основному заголовку на главной странице *Master Site.Master:*

![Индикатор окружающей среды](web-config-transformations/_static/image7.png)

Индикатор среды не пропускается при запуске приложения в постановке или производстве.

Веб-страницы Университета Контосо читают `appSettings` значение, которое устанавливается в файле *Web.config,* чтобы определить, в какой среде работает приложение:

[!code-xml[Main](web-config-transformations/samples/sample4.xml)]

Значение должно быть "Тест" в тестовой среде, и "Prod" для постановки и производства.

Следующий код в файле преобразования будет реализовывать эту трансформацию:

[!code-xml[Main](web-config-transformations/samples/sample5.xml)]

Значение `xdt:Transform` атрибута "SetAttributes" указывает на то, что цель этого преобразования заключается в изменении значений атрибутов существующего элемента в файле *Web.config.* Значение `xdt:Locator` атрибута "Матч(ключ)" указывает на то, что `key` элемент, `key` который будет изменен, является элементом, атрибут которого соответствует указанному здесь атрибуту. Единственным другим атрибутом `add` элемента является, `value`и это то, что будет изменено в развернутом файле *Web.config.* `value` Показанный здесь код приводит `Environment` `appSettings` к тому, что атрибут элемента будет установлен на "Тест" в развернутом файле *Web.config.*

Это преобразование относится к файлам преобразования файлов преобразования файлов публикации, которые вы еще не создали. Вы будете создавать и обновлять преобразующие файлы, которые реализуют это изменение при создании профилей публикаций для сред тестирования, постановки и производства. Вы сделаете это при [развертывании в IIS](deploying-to-iis.md) и [развернете в учебниках по производству.](deploying-to-production.md)

> [!NOTE]
> Поскольку эта настройка находится в `<appSettings>` элементе, у вас есть другая альтернатива для указания преобразования при развертывании в Web-приложениях в службе приложений Azure [См. Указать настройки Web.config в Azure](#watransforms) ранее в этой теме.

## <a name="setting-connection-strings"></a>Настройка строк подключения

Хотя файл преобразования по умолчанию содержит пример, который показывает, как обновить строку соединения, в большинстве случаев не требуется настроить преобразования строки соединения, потому что можно указать строки соединения в профиле публикации. Вы сделаете это при [развертывании в IIS](deploying-to-iis.md) и [развернете в учебниках по производству.](deploying-to-production.md)

## <a name="summary"></a>Сводка

Теперь вы сделали столько, сколько вы можете с *Web.config* преобразований, прежде чем создать публикацию профилей, и вы видели предварительный просмотр того, что будет в развернутом файле Web.config.

![Предварительный просмотр преобразования местоположения](web-config-transformations/_static/image8.png)

В следующем уроке вы будете заботиться о задачах настройки развертывания, которые требуют установки свойств проекта.

## <a name="more-information"></a>Дополнительные сведения

Для получения дополнительной информации о темах, охватываемых этим учебником, [см. См. С помощью преобразований Web.config для изменения настроек в файле назначения Web.config или файле app.config во время развертывания](https://go.microsoft.com/fwlink/p/?LinkId=282413#transforms) в Веб-карте содержимого развертывания для Visual Studio и ASP.NET.

> [!div class="step-by-step"]
> [Назад](preparing-databases.md)
> [Вперед](project-properties.md)
