---
uid: web-forms/overview/deployment/visual-studio-web-deployment/web-config-transformations
title: Веб-развертывание ASP.NET с помощью Visual Studio. Преобразования файла Web.config | Документация Майкрософт
author: tdykstra
description: В этой серии руководств показано, как развернуть ASP.NET (публикации) веб-приложения, веб-приложениях службы приложений Azure или у стороннего поставщика размещения, Пол...
ms.author: riande
ms.date: 02/15/2013
ms.assetid: 5a2a927b-14cb-40bc-867a-f0680f9febd7
msc.legacyurl: /web-forms/overview/deployment/visual-studio-web-deployment/web-config-transformations
msc.type: authoredcontent
ms.openlocfilehash: 15a5984048ba2aca9fedcb7bc4bb77eb440f21ee
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59379460"
---
# <a name="aspnet-web-deployment-using-visual-studio-webconfig-file-transformations"></a>Веб-развертывание ASP.NET с помощью Visual Studio. Преобразования файла Web.config

по [том Дайкстра](https://github.com/tdykstra)

[Загрузите начальный проект](http://go.microsoft.com/fwlink/p/?LinkId=282627)

> В этой серии руководств показано, как развернуть ASP.NET (публикации) веб-приложения для веб-приложениях службы приложений Azure или стороннего поставщика услуг размещения, с помощью Visual Studio 2012 или Visual Studio 2010. Сведения об этой серии см. в разделе [в первом учебнике серии](introduction.md).


## <a name="overview"></a>Обзор

Этом руководстве показано, как автоматизировать процесс изменения *Web.config* файла при его развертывании в средах другое назначение. Большинство приложений имеют параметры *Web.config* файл, который должны быть разными, при развертывании приложения. Автоматизация процесса внесения этих изменений позволяет избежать выполнения вручную каждый раз при развертывании, который бы весьма утомительно и подвержено ошибкам.

Напоминание. Если вы получаете сообщение об ошибке, или что-то не работает, как работать с руководством, обязательно проверьте [страница устранения неполадок](troubleshooting.md).

## <a name="webconfig-transformations-versus-web-deploy-parameters"></a>Преобразование Web.config на веб-развертывания параметров

Существует два способа для автоматизации процесса изменения *Web.config* параметры: [Преобразования Web.config](https://msdn.microsoft.com/library/dd465326.aspx) и [параметры веб-развертывания](https://msdn.microsoft.com/library/ff398068.aspx). Объект *Web.config* файл преобразования содержит XML-разметку, которая определяет способ изменения *Web.config* файл при его развертывании. Можно указать различные изменения для конкретных конфигураций сборки и для конкретных профилей публикации. Конфигурации построения по умолчанию, отладки и выпуска, и можно создать пользовательские конфигурации построения. Профиль публикации обычно соответствует в целевой среде. (Вы узнаете больше о таких профилей в [развертывание в IIS в качестве тестовой среды](deploying-to-iis.md) руководства.)

Параметры веб-развертывания можно использовать для указания различных параметров, которые должны быть настроены во время развертывания, включая параметры, которые находятся в *Web.config* файлов. Для указания *Web.config* изменения в файле, для настройки параметров веб-развертывание более сложны, но они полезны, если вы не знаете значение, устанавливаемое, если. Например, в корпоративной среде, можно создать *пакет развертывания* и присвойте ему определенному человеку в ИТ-отдел для установки в рабочей среде, и этот пользователь получит возможность введите строки подключения или пароли, которые не знаете.

Для сценария, в котором рассматриваются в этой серии руководств, вы заранее знаете все, что необходимо сделать для *Web.config* файла, поэтому необходимо использовать параметры веб-развертывания. Нужно настроить некоторые преобразования, отличаются в зависимости от конфигурации построения, который используется, и некоторые, отличающиеся в зависимости от того, используется профиль публикации.

<a id="watransforms"></a>

## <a name="specifying-webconfig-settings-in-azure"></a>Задание параметров Web.config в Azure

Если *Web.config* файл параметров, которые вы хотите изменить `<connectionStrings>` или `<appSettings>` элемент, и если вы развертываете веб-приложения в службе приложений Azure, можно использовать другой вариант для автоматического изменения во время развертывание. Можно ввести параметры вступили в силу в Azure в **Настройка** вкладку страницы портала управления для веб-приложения (Прокрутите вниз до раздела **параметры приложения** и **строки подключения**  разделах). При развертывании проекта, Azure автоматически применяет изменения. Дополнительные сведения см. в разделе [веб-сайтов Windows Azure: How Application Strings and Connection Strings Work](https://blogs.msdn.com/b/windowsazure/archive/2013/07/17/windows-azure-web-sites-how-application-strings-and-connection-strings-work.aspx) (Веб-сайты Microsoft Azure: как работают строки приложения и строки подключения).

## <a name="default-transformation-files"></a>Файлы преобразования по умолчанию

В **обозревателе решений**, разверните *Web.config* для см. в разделе *Web.Debug.config* и *Web.Release.config* , файлы преобразования создаются по умолчанию для конфигурации построения два заданных по умолчанию.

![Web.config_transform_files](web-config-transformations/_static/image1.png)

Можно создать файлы преобразования для конфигураций настраиваемой сборки, щелкнув правой кнопкой мыши файл Web.config и выбрав **добавить преобразования конфигурации** в контекстном меню. В этом руководстве вам не нужно, и команды меню отключено, так как вы еще не создали все конфигурации пользовательские сборки.

Позже вы создадите три дополнительные преобразования файла, по одной для тестирования, размещения и профили публикации в рабочей среде. Типичный пример параметра, который будет обрабатывать в файле преобразования профиль публикации, так как он зависит от целевой среде — конечную точку WCF, которая отличается для тестирования и производства. Вы создадите опубликовать профиль преобразования файлов в последующих руководствах создав профили публикации, которые переходят с.

## <a name="disable-debug-mode"></a>Отключить режим отладки

Пример установки, который зависит от конфигурации построения, а не является целевой среде `debug` атрибута. Для сборки выпуска обычно требуется отключенной отладкой независимо от того, какой среде выполняется развертывание. Таким образом, создание шаблонов проектов Visual Studio по умолчанию *Web.Release.config* преобразования файлов с кодом, который удаляет `debug` из атрибута `compilation` элемент. Здесь используется по умолчанию *Web.Release.config*: в дополнение к образец кода преобразования, закомментирован, он включает код в `compilation` элемент, который удаляет `debug` атрибут:

[!code-xml[Main](web-config-transformations/samples/sample1.xml?highlight=18)]

`xdt:Transform="RemoveAttributes(debug)"` Атрибут указывает, следует ли `debug` атрибут, который необходимо удалить из `system.web/compilation` элемент в развернутой *Web.config* файл. Это будет выполняться каждый раз при развертывании сборки выпуска.

## <a name="limit-error-log-access-to-administrators"></a>Ограничение доступа к журналу ошибок для администраторов

Если возникает ошибка во время выполнения приложения, оно выводит типовой страницы ошибки вместо страницы системные ошибки и использует [пакет Elmah NuGet](http://www.hanselman.com/blog/NuGetPackageOfTheWeek7ELMAHErrorLoggingModulesAndHandlersWithSQLServerCompact.aspx) для регистрации ошибок и создания отчетов. `customErrors` Элемент в приложении *Web.config* файла указывает на страницу ошибки:

[!code-xml[Main](web-config-transformations/samples/sample2.xml)]

Чтобы просмотреть страницу ошибки, то временно измените `mode` атрибут `customErrors` элемент из «RemoteOnly» значение «Вкл.» и запустите приложение из Visual Studio. Вызывает ошибку, запрашивая недопустимый URL-адрес, например *Studentsxxx.aspx*. Вместо ошибки созданный IIS «не удается найти ресурс» странице, вы увидите *GenericErrorPage.aspx* страницы.

![Страница ошибки](web-config-transformations/_static/image2.png)

Чтобы просмотреть журнал ошибок, замените весь код в URL-адрес после номера порта с *elmah.axd* (например, `http://localhost:51130/elmah.axd`) и нажмите клавишу ВВОД:

![ELMAH страницы](web-config-transformations/_static/image3.png)

Не забудьте задать `customErrors` элемент обратно в режим «RemoteOnly», когда все будет готово.

На компьютере разработчика является удобным разрешить бесплатный доступ к странице журнала ошибки, но в рабочей среде, которая будет представлять угрозу безопасности. Для рабочего сайта, необходимо добавить правило авторизации, которое ограничивает доступ к журналу ошибок для администраторов, а также чтобы убедиться в том, что ограничение работает, он должен находиться в тестовых и промежуточных также. Таким образом, это еще одно изменение, необходимо реализовать каждый раз при развертывании сборки выпуска, и поэтому она принадлежит к *Web.Release.config* файла.

Откройте *Web.Release.config* и добавьте новую `location` элемент непосредственно перед закрывающим `configuration` тег, как показано ниже.

[!code-xml[Main](web-config-transformations/samples/sample3.xml?highlight=27-34)]

`Transform` Значение атрибута «Insert» вызывает это `location` элемента для добавления в качестве одноуровневого элемента существующим `location` элементов в *Web.config* файл. (Уже существует один `location` элемент, который задает авторизации правила для **обновления кредиты** страницы.)

Теперь можно просмотреть преобразования, чтобы убедиться в том, закодированных его правильно.

В **обозревателе решений**, щелкните правой кнопкой мыши *Web.Release.config* и нажмите кнопку **преобразования предварительной версии**.

![Преобразование меню предварительного просмотра](web-config-transformations/_static/image4.png)

Открывается страница, где показано, разработки *Web.config* файл слева, а также что развернутому *Web.config* файла будет выглядеть как в правой части, изменения выделены.

![Предварительный просмотр преобразования отладки](web-config-transformations/_static/image5.png)

![Предварительная версия расположение преобразования](web-config-transformations/_static/image6.png)

(В предварительной версии, вы можете заметить, преобразующий некоторые дополнительные изменения не написали: они обычно включают в себя удаление пробелов, не влияет на функциональность.)

Если вы тестируете сайта после развертывания, вы также сможете протестировать чтобы убедиться, что правило авторизации является эффективным.

> [!NOTE] 
> 
> **Примечание по безопасности** никогда не отображать сведения об ошибке для просмотра в реальном приложении, или сохранить эту информацию в общедоступном расположении. Злоумышленники могут использовать сведения об ошибке, чтобы обнаружить уязвимости на узле. Если вы используете ELMAH в приложении, настройте ELMAH, чтобы свести к минимуму угрозы безопасности. В примере ELMAH в этом руководстве не должен считаться рекомендуемой конфигурацией. Это пример, в котором был сделан для иллюстрации способ обработки приложения должен уметь создавать файлы в папку. Дополнительные сведения см. в разделе [защиты конечной точки ELMAH](https://code.google.com/p/elmah/wiki/SecuringErrorLogPages).


## <a name="a-setting-that-youll-handle-in-publish-profile-transformation-files"></a>Параметр, который будет обрабатывать в публикации профиля преобразования файлов

Распространенным сценарием является иметь *Web.config* , которые должны быть разными в каждой среде, которое развертывается в настройках файла. Например приложение, вызывающее службу WCF может потребоваться другой конечной точке в тестовой и рабочей средах. Приложение университета Contoso также включает параметр такого рода. Этот параметр определяет, отображается индикатор на страницах веб узла, который покажет, какие используемой среды, например, разработки, тестирования или производства. Определяет значение параметра приложения, которые будут добавлены «(Dev)» или «(Test)» в заголовке главного в *Site.Master* главной страницы:

![Индикатор среды](web-config-transformations/_static/image7.png)

Индикатор среды учитывается, если приложение выполняется в промежуточной или рабочей среде.

Веб-страниц университета Contoso считывают значение, заданное в `appSettings` в *Web.config* файл, чтобы определить, какие среды, приложение выполняется в:

[!code-xml[Main](web-config-transformations/samples/sample4.xml)]

Значение должно быть «Test» в тестовой среде и «Prod» для промежуточной и рабочей.

Следующий код в файл преобразования будет реализовать это преобразование.

[!code-xml[Main](web-config-transformations/samples/sample5.xml)]

`xdt:Transform` «SetAttributes» указывает, что это преобразование предназначено для изменения значений атрибутов существующего элемента в значение атрибута *Web.config* файл. `xdt:Locator` «Match(key)» указывает, что элемента, который требуется изменить одно значение атрибута которого `key` атрибут соответствует `key` атрибут, указанный здесь. Только другие атрибут `add` элемент является `value`, и это, что будет изменен в развернутой *Web.config* файл. Код, показанный здесь причины `value` атрибут `Environment` `appSettings` элемент, чтобы установить значение «Test» *Web.config* файл, который развертывается.

Это преобразование принадлежит в файлах преобразования профиль публикации, которые еще не созданы. Можно создать и обновить файлы преобразования, для реализации этого изменения при создании профилей публикации для тестирования, промежуточной и рабочей среды. Это можно сделать [развертывания в IIS](deploying-to-iis.md) и [развертывания в рабочей среде](deploying-to-production.md) учебники.

> [!NOTE]
> Так как этот параметр находится в `<appSettings>` элемент, у вас есть другой вариант для задания преобразования, когда вы развертываете веб-приложений в Azure приложения службы см. в разделе [Web.config, указав параметры в Azure](#watransforms) ранее в в этом разделе.


## <a name="setting-connection-strings"></a>Настройка строк подключения

Несмотря на то, что файл преобразования по умолчанию содержит пример, в котором показано, как обновить строку подключения, в большинстве случаев вам не обязательно для настройки преобразования строки подключения, так как строки подключения можно указать в профиле публикации. Это можно сделать [развертывания в IIS](deploying-to-iis.md) и [развертывания в рабочей среде](deploying-to-production.md) учебники.

## <a name="summary"></a>Сводка

Вы теперь выполняется так же, как вы можете с помощью *Web.config* преобразований, прежде чем создавать профили публикации, и вы уже видели Предварительный просмотр будет находиться в развернутый файл Web.config.

![Предварительная версия расположение преобразования](web-config-transformations/_static/image8.png)

В следующем руководстве вы займусь задачи установки развертывания, которые требуется установить для свойства проекта.

## <a name="more-information"></a>Дополнительные сведения

Дополнительные сведения о разделах рассматриваются в этом руководстве, см. в разделе [преобразования Web.config с помощью, чтобы изменить параметры в файле app.config или в файл Web.config во время развертывания](https://go.microsoft.com/fwlink/p/?LinkId=282413#transforms) в веб-развертывания содержимого карты для Visual Studio и ASP.NET.

> [!div class="step-by-step"]
> [Назад](preparing-databases.md)
> [Вперед](project-properties.md)
