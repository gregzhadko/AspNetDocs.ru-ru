---
uid: web-forms/overview/deployment/visual-studio-web-deployment/deploying-to-iis
title: Веб-развертывание ASP.NET с помощью Visual Studio. Развертывание в тестовой среде | Документация Майкрософт
author: tdykstra
description: В этой серии руководств показано, как развернуть ASP.NET (публикации) веб-приложения, веб-приложениях службы приложений Azure или у стороннего поставщика размещения, Пол...
ms.author: riande
ms.date: 01/16/2019
ms.assetid: 8bf2c4fb-4ee5-4841-bfc2-03462c1f7a7a
msc.legacyurl: /web-forms/overview/deployment/visual-studio-web-deployment/deploying-to-iis
msc.type: authoredcontent
ms.openlocfilehash: 39502e03196d2ba51e826d248ff0ff1e84258131
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59420202"
---
# <a name="aspnet-web-deployment-using-visual-studio-deploying-to-test"></a>Веб-развертывание ASP.NET с помощью Visual Studio. Развертывание в тестовой среде

по [том Дайкстра](https://github.com/tdykstra)

> В этой серии руководств показано, как развернуть ASP.NET (публикации) веб-приложения, веб-приложениях службы приложений Azure или стороннего поставщика услуг размещения с помощью Visual Studio 2017. Сведения об этой серии см. в разделе [в первом учебнике серии](introduction.md).

## <a name="overview"></a>Обзор

В этом руководстве вы развернете веб-приложение ASP.NET для Internet Information Server (IIS) на локальном компьютере.

Обычно при разработке приложения, запустите его и протестировать его в Visual Studio. По умолчанию проекты веб-приложений в Visual Studio 2017 использования IIS Express в качестве веб-сервера разработки. IIS Express поведение во многом напоминает полноценного сервера IIS, чем Visual Studio Development Server (также известном как Cassini), которая по умолчанию использует Visual Studio 2017. Но ни одна из веб-сервера разработки работает так же, как IIS. Следовательно приложение может запускать и правильно тестирования в Visual Studio но завершиться ошибкой при его развертывании в IIS.

Приложение надежно можно проверить двумя способами:

1. Развернете приложение в службах IIS на компьютере разработчика, используя тот же процесс, который будет использоваться в дальнейшем для его развертывания в рабочей среде.

   Можно настроить Visual Studio для использования IIS при запуске веб-проекта, но, не нужно проверить процесс развертывания. Этот метод проверяет процесс развертывания, и что приложение правильно работает в IIS.

2. Развернете приложение в тестовой среде, аналогичную рабочей среды. 
 
   В рабочую среду для этих учебников — веб-приложений в службе приложений Azure. Идеальный тестовая среда имеет дополнительные веб-приложение, созданное в версии службы Azure. Хотя он настраивается так же, как рабочее веб-приложение, вы бы только использовать для тестирования.

Вариант 2 – – наиболее надежный способ проверки. Если вы используете вариант 2, не нужно обязательно использовать вариант 1. Тем не менее если вы развертываете третьей стороне размещения поставщика, вариант 2 может не подойти или может быть дорогостоящим, поэтому в этой серии руководств продемонстрированы оба способа. Вариант 2 описаны в [развертывание в рабочей среде](deploying-to-production.md) руководства.

Дополнительные сведения об использовании веб-серверов в Visual Studio, см. в разделе [веб-серверов в Visual Studio для веб-проектов ASP.NET](https://msdn.microsoft.com/library/58wxa9w5.aspx).

Напоминание. Если появляется сообщение об ошибке, или что-то не работает, как работать с руководством, обязательно проверьте [страница устранения неполадок](troubleshooting.md).

## <a name="download-the-contoso-university-starter-project"></a>Загрузите начальный проект университета Contoso

Скачайте и установите Visual Studio университета Contoso starter решение и проект. Это решение содержит полное руководство. 

[Загрузите начальный проект](http://go.microsoft.com/fwlink/p/?LinkId=282627)

## <a name="install-iis"></a>Установка служб IIS

Для развертывания в IIS на компьютере разработчика, убедитесь, что установлены службы IIS и веб-развертывания. По умолчанию Visual Studio устанавливает веб-развертывания, но IIS не включена в конфигурации Windows 10, Windows 8 или Windows 7 по умолчанию. Если вы уже установили IIS и пул приложений по умолчанию задана .NET 4, перейдите к [разделу](#sqlexpress).

1. Рекомендуется использовать [установщик Web платформы (Майкрософт)](https://www.microsoft.com/web/downloads/platform.aspx) установки служб IIS и веб-развертывания. WPI устанавливает Рекомендуемая конфигурация IIS, который включает в себя необходимые компоненты IIS и веб-развертывания, при необходимости.

   Если вы уже установили IIS, веб-развертывания или любой из необходимых компонентов для них, WPI устанавливает только что здесь отсутствует.

   * Используйте установщик веб-платформы для установки IIS и веб-развертывания.
    
     ![Установка служб IIS, с помощью удостоверения рабочего Процесса](deploying-to-iis/_static/image30.png)

     ![Установка веб-развертывания с помощью удостоверения рабочего Процесса](deploying-to-iis/_static/image31.png)

     Вы увидите сообщения о том, что будут установлены службы IIS 7. Ссылка действует для IIS 8 в Windows 8; но Windows 8 и более поздних версий, выполните следующие действия, чтобы убедиться, что установлен ASP.NET 4.7:

   * Откройте **панели управления** > **программы** > **программы и компоненты** > **или отключение компонентов Windows, включение** .

   * Разверните **Internet Information Services**, **World Wide Web Services**, и **компоненты разработки приложений**.
   
   * Убедитесь, что **ASP.NET 4.7** выбран.

     ![Выберите ASP.NET 4.7](deploying-to-iis/_static/image1a.png)

   * Убедитесь, что **World Wide Web Services** и **консоль управления IIS** выбран. При этом устанавливаются службы IIS и диспетчера служб IIS.
    
     ![Выберите веб-службы](deploying-to-iis/_static/image24.png)    
  
   * Нажмите кнопку **ОК**. Отображаются сообщения, указывающий, что установка выполняется.

После установки служб IIS, запустите **диспетчера служб IIS** чтобы убедиться в том, что пул приложений по умолчанию назначается в .NET Framework версии 4.

1. Нажмите клавиши WINDOWS + R, чтобы открыть **запуска** диалоговое окно.

   (В Windows 8 или более поздней версии, введите «выполнить» на **запустить** страницы. В Windows 7, выберите **запуска** из **запустить** меню. Если **запуска** не находится в **запустить** меню, щелкните панель задач правой кнопкой мыши **свойства**выберите **меню "Пуск"** выберите **Настройка**и выберите **выполните команду**.)

2. Введите «inetmgr» и выберите **ОК**.

3. В **подключений** области, разверните узел сервера и выберите **пулы приложений**. В **пулы приложений** панели Если **DefaultAppPool** будет назначено .NET framework версии 4, как показано на следующем рисунке, перейдите к следующему разделу.

   ![Inetmgr_showing_4.0_app_pools](deploying-to-iis/_static/image5a.png)

4. Если вы видите только два пула приложений и равными в .NET Framework 2.0, необходимо установите ASP.NET 4 в IIS.

   Для Windows 8 или более поздней версии, см. инструкции в предыдущем разделе, для убедившись, что ASP.NET 4.7 должен быть установлен, или см. в разделе [установке ASP.NET 4.5 в Windows 8 и Windows Server 2012](https://support.microsoft.com/kb/2736284). Для Windows 7, откройте окно командной строки, щелкнув правой кнопкой мыши **командной** в Windows **запустить** меню и выбрав **Запуск от имени администратора**. Запустите [aspnet\_regiis.exe](https://msdn.microsoft.com/library/k6h9cz8h.aspx) установить ASP.NET 4 в IIS, используя следующие команды. (В 32-разрядных системах, замените «Framework64» с «Платформа»).

   [!code-console[Main](deploying-to-iis/samples/sample1.cmd)]

   Эта команда создает новое приложение, которое будет оставаться пулы для .NET Framework 4, но пул приложений по умолчанию установлена равной 2.0. Вы развертываете приложение, что предназначено для .NET 4 с этим пулом приложений, поэтому изменение пула приложений для .NET 4.

5. Если вы закрыли **диспетчера служб IIS**, запустите его снова, раскройте узел сервера и выберите **пулы приложений**.

6. В **пулы приложений** области выберите **DefaultAppPool**. В **действия** области выберите **основные параметры**.

   ![Inetmgr_selecting_Basic_Settings_for_app_pool](deploying-to-iis/_static/image25.png)

7. В **изменение пула приложений** » диалогового окна «Изменение **версия среды CLR .NET** для **среды CLR .NET v4.0.30319**. Нажмите кнопку **ОК**.

   ![Selecting_.NET_4_for_DefaultAppPool](deploying-to-iis/_static/image6a.png)

Теперь вы готовы к публикации веб-приложения IIS. Во-первых тем не менее, создание баз данных для тестирования.

<a id="sqlexpress"></a>

## <a name="install-sql-server-express"></a>Установка SQL Server Express

LocalDB не предназначена для работы со службами IIS, поэтому тестовой среды должен содержать установки SQL Server Express. Если вы используете Visual Studio 2010 SQL Server Express, он уже установлен по умолчанию. Если вы используете Visual Studio 2012 или более поздней версии, установите SQL Server Express.

Чтобы установить SQL Server Express, загрузите и установите его из [центра загрузки: Выпуск Microsoft SQL Server 2017 Express](https://www.microsoft.com/sql-server/sql-server-editions-express). 

На первой странице Центр установки SQL Server, выберите **автономная установка нового SQL Server или добавление компонентов к существующей установке** и следуйте инструкциям, принимая параметры по умолчанию. В мастере установки примите параметры по умолчанию. Дополнительные сведения о параметрах установки см. в разделе [Установка SQL Server с помощью мастера установки (программа установки)](https://msdn.microsoft.com/library/ms143219.aspx).

## <a name="create-sql-server-express-databases-for-the-test-environment"></a>Создание баз данных на SQL Server Express для тестовой среды

Приложение университета Contoso имеет две базы данных: 

1. Базы данных членства 
2. База данных приложения 

Эти базы данных можно развернуть две отдельные базы данных или в одной базе данных. Их объединения делает базы данных соединения между ними проще. 

Если вы развертываете стороннего поставщика услуг размещения, план размещения может также пробудить их объединение. Например поставщик может взимать плату сведения для нескольких баз данных или может даже не позволить изменять более одной базы данных.

В этом руководстве вы развернете для двух баз данных в тестовой среде и к одной базе данных в промежуточной и рабочей средах.

Из **представление** меню в Visual Studio, выберите пункт **обозревателя серверов** (**обозреватель баз данных** в Visual Web Developer). Щелкните правой кнопкой мыши **подключения к данным** и выберите **создать новую базу данных SQL Server**.

![Selecting_Create_New_SQL_Server_Database](deploying-to-iis/_static/image8.png)

В **создать новую базу данных SQL Server** диалогового окна введите «. \SQLExpress» в **имя_сервера** поле и «aspnet-ContosoUniversity» в **новое имя базы данных** поле. Нажмите кнопку **ОК**.

![Создание aspnet ContosoUniversity](deploying-to-iis/_static/image9.png)

Выполните ту же процедуру, чтобы создать новую базу данных SQL Server Express School с именем `ContosoUniversity`.

**Обозреватель серверов** показаны два новых баз данных.

![Новые базы данных в обозревателе серверов](deploying-to-iis/_static/image10.png)

## <a name="create-a-grant-script-for-the-new-databases"></a>Создание скрипта предоставления доступа для новых баз данных

При выполнении приложения в службах IIS на компьютере разработчика, приложение использует учетные данные пула приложений по умолчанию для доступа к базе данных. Тем не менее по умолчанию пула приложений не имеет разрешения на открытие баз данных. Это означает, что необходимо для запуска сценария предоставлять ему такое разрешение. В этом разделе будет создать этот скрипт и запустить его позже, чтобы убедиться в том, что приложение можно открыть баз данных, когда оно работает в IIS.

В текстовом редакторе, скопируйте следующие команды SQL в новый файл и сохраните его как *Grant.sql*. 

[!code-sql[Main](deploying-to-iis/samples/sample2.sql)]

В Visual Studio откройте решение университета Contoso. Щелкните правой кнопкой мыши решение (не из проектов) и выберите **добавить**. Выберите **существующий элемент**, перейдите к *Grant.sql*и откройте его.

> [!NOTE]
> Этот сценарий предназначен для работы с SQL Server Express 2012 или более поздней версии и с параметрами IIS в Windows 10, Windows 8 или Windows 7, как они указаны в этом руководстве. Если вы используете другую версию SQL Server или Windows, или если вы настроили IIS на компьютере по-разному, изменения в этот сценарий может потребоваться. Дополнительные сведения о сценарии SQL Server, см. в разделе [SQL Server Books Online](https://go.microsoft.com/fwlink/?LinkId=132511).

> [!NOTE] 
> **Примечание по безопасности** этот сценарий дает `db_owner` разрешения пользователю, который обращается к базе данных во время выполнения, который является то, что вы в рабочей среде. В некоторых сценариях может потребоваться указать пользователя, имеющего полной схемы обновлять разрешения только для развертывания и указать во время выполнения другого пользователя с разрешениями только для чтения и записи данных. Дополнительные сведения см. в разделе [просмотрите автоматического изменения в файл Web.config для Code First Migrations](#reviewingmigrations) далее в этом учебнике.

<a id="publish"></a>

## <a name="run-the-grant-script-in-the-application-database"></a>Запустите сценарий grant в базе данных приложения

Можно настроить профиль публикации для запуска скрипта grant в базе данных членства во время развертывания, так как это развертывание базы данных использует [dbDacFx](https://docs.microsoft.com/iis/publish/using-web-deploy/dbdacfx-provider-for-incremental-database-publishing) поставщика. Не может выполнять скрипты во время развертывания Code First Migrations, который является, как вы развертываете базы данных приложения. Это означает, что вам нужно вручную запустить скрипт перед развертыванием в базе данных приложения.

1. В Visual Studio откройте *Grant.sql* файл, который был создан ранее.

2. Выберите **подключения**. 

    ![Кнопка "Подключить"](deploying-to-iis/_static/image11.png)

3. В **соединение с сервером** диалогового окна введите *. \SQLExpress* как **имя сервера**. Выберите **подключения**.

4. В раскрывающемся списке баз данных выберите **ContosoUniversity**. Выберите **выполнение**. 

   ![](deploying-to-iis/_static/image12.png)

Удостоверение пула приложений по умолчанию теперь имеет достаточные разрешения в базе данных приложения для Code First Migrations для создания таблиц базы данных при запуске приложения.

## <a name="publish-to-iis"></a>Публикация в службах IIS

Существует несколько способов, которые можно развернуть с помощью Visual Studio и веб-развертывания IIS:

* С помощью Visual Studio, публикация одним щелчком.
* Публикация из командной строки.
* Создание пакета развертывания и установить его с помощью диспетчера служб IIS. Пакет содержит ZIP-файл со всеми файлы и метаданные, необходимые для установки сайта в IIS.
* Создание пакета развертывания и установить его с помощью командной строки.

Процесс, который вы выполнили в предыдущих учебных курсах, чтобы настроить Visual Studio для автоматизации задач развертывания применяется ко всем из этих методов. В этих руководствах вы используете первые два метода. Для получения сведений о пакетах развертывания, см. в разделе [развертывание веб-приложения необходимо создать и установить пакет веб-развертывания](https://go.microsoft.com/fwlink/p/?LinkId=282413#package) в веб-развертывания содержимого карты для Visual Studio и ASP.NET.

Перед публикацией, убедитесь, что вы используете Visual Studio в режиме администратора. Если вы не видите **(администратор)** в заголовке окна, закройте Visual Studio. В Windows 8 (или более поздней версии) **запустить** страницы или Windows 7 **запустить** меню, щелкните правой кнопкой мыши значок Visual Studio и выберите **Запуск от имени администратора**. Режим администратора используется только необходимые для публикации во время публикации в службах IIS на локальном компьютере.

### <a name="create-the-publish-profile"></a>Создание профиля публикации

1. В **обозревателе решений**, щелкните правой кнопкой мыши **ContosoUniversity** проекта (не **ContosoUniversity.DAL** проекта). Нажмите **Публиковать**. **Публикации** появится страница.

2. Выберите **новый профиль**. **Выберите целевой объект публикации** откроется диалоговое окно.

3. Выберите **IIS, FTP, д**. Выберите **Создать профиль**. **Публикации** откроется мастер.

   ![Публикация веб-мастера профиля tab](deploying-to-iis/_static/image26.png)

4. Из **метод публикации** раскрывающееся меню, выберите **веб-развертывания**.

5. Для **Server**, введите *localhost*.

6. Для **имя_сайта**, введите *веб-сайт по умолчанию/ContosoUniversity*.

7. Для **URL-адрес назначения**, введите *http://localhost/ContosoUniversity*.

   **URL-адрес назначения** параметр не требуется. Когда Visual Studio завершит развертывание приложения, автоматически откроется браузер по умолчанию этот URL-адрес. Если вы не хотите в браузере открывается автоматически после развертывания, оставьте это поле пустым.

8. Выберите **проверить подключение** для убедитесь, что параметры указаны правильно, и можно подключиться к службам IIS на локальном компьютере.

   Зеленая галочка проверяет, что подключение выполнено успешно.

   ![Публикация веб-tab, мастер подключения](deploying-to-iis/_static/image27.png)

9. Выберите **Далее** для перехода к **параметры** вкладки.

10. **Конфигурации** раскрывающемся списке указывает конфигурацию сборки для развертывания. Оставьте значение по умолчанию **выпуска**. Вы не развертывать отладочных сборок в этом руководстве.

11. Разверните **параметры публикации файлов**. Выберите **исключить файлы из приложения\_папка данных**.

    В тестовой среде, приложение получает доступ к базе данных, созданные в локальном экземпляре SQL Server Express, не MDF-файлов в *приложения\_данных* папки.

12. Оставьте **Precompile во время публикации** и **удалять дополнительные файлы в месте назначения** флажки.

    ![Параметры публикации файлов на вкладке "Параметры"](deploying-to-iis/_static/image15a.png)

    Предварительная компиляция — это, главным образом для больших веб-узлов. Он может сократить время запуска при первом запросе страницы после публикации сайта.

    Удалять дополнительные файлы, так как это первый развертывания и не будет все файлы в папке назначения еще не нужно.

    > [!NOTE] 
    > При выборе **удалять дополнительные файлы в месте назначения** для последующего развертывания на том же сайте, убедитесь, что использовать эту предварительную версию функции, чтобы увидеть заранее какие файлы будут удалены перед развертыванием. Ожидаемым поведением является то, что веб-развертывания приведет к удалению файлов на целевом сервере, удаленные в проекте. Тем не менее сравнивается структуры всю папку в исходной и целевой папки; и в некоторых сценариях веб-развертывания может удалить файлы, которые вы не хотите удалить.
    > 
    > Например, если у вас есть веб-приложение во вложенной папке на сервере при развертывании проекта в корневую папку, вложенную папку будут удалены. Возможно, один проект для основного сайта в домене contoso.com, а второй проект для блог по адресу contoso.com/blog. Приложение блога находится во вложенной папке. При выборе **удалять дополнительные файлы в месте назначения** при развертывании основного сайта, блога приложения будут удалены.
    > 
    > Еще один пример: приложение\_папка данных могут быть неожиданно удалены. Определенные базы данных, таких как SQL Server Compact хранить файлы базы данных в приложении\_папку данных. После первоначального развертывания, вы не хотите сохранять копирование файлов базы данных в последующих развертываниях, чтобы выбрать **исключить приложение\_данных** на вкладке "Упаковка и публикация Web". После выполнения, если у вас есть **удалять дополнительные файлы в месте назначения** установлен, файлы базы данных и приложение\_самой папке данных будут удалены следующий раз при публикации.

### <a name="configure-deployment-for-the-membership-database"></a>Настройка развертывания для базы данных членства

Приведенные ниже инструкции относятся к **DefaultConnection** базы данных в диалоговом окне **баз данных** раздел.

1. В **строку подключения к удаленному** введите следующую строку соединения, указывающий на базе членства SQL Server Express.

   [!code-console[Main](deploying-to-iis/samples/sample3.cmd)]

   Процесс развертывания помещает эту строку подключения в развернутый файл Web.config, так как **использовать эту строку подключения во время выполнения** выбран.

    Также можно получить строку подключения из **обозревателя серверов**. В **обозревателя серверов**, разверните **подключения к данным** и выберите  **&lt;machinename&gt;\sqlexpress.aspnet-ContosoUniversity** базы данных, а затем из **свойства** окно копирования **строку подключения** значение. Что строка подключения будет иметь один дополнительный параметр, который можно удалить: `Pooling=False`.

2. Выберите **обновления базы данных**.

   В результате будет создан в целевой базе данных во время развертывания схемы базы данных. В следующих шагах укажите дополнительные сценарии, которые необходимы для запуска: один для предоставления доступа к базе данных в пуле приложений по умолчанию, а для развертывания данных.

3. Выберите **настроить обновление базы данных**.
 
4. В **Настройка обновления базы данных** выберите **добавить скрипт SQL**. Перейдите к *Grant.sql* скрипт, который был ранее сохранен в папке решения.

5. Повторите процедуру, чтобы добавить *aspnet-data-dev.sql* скрипта.

   ![Настройка обновления базы данных для базы данных членства](deploying-to-iis/_static/image16.png)

6. Нажмите кнопку **Закрыть**.

### <a name="configure-deployment-for-the-application-database"></a>Настройка развертывания для базы данных приложения

Когда Visual Studio обнаруживает Entity Framework `DbContext` класс, он создает запись в **баз данных** раздел с **выполнить Code First Migrations** флажок вместо  **Обновить базу данных** "флажок". В этом руководстве вы используете этот флажок для указать развертывание Code First Migrations.

В некоторых сценариях, возможно, вы используете `DbContext` базы данных, но вы хотите использовать поставщик dbDacFx вместо миграции для развертывания базы данных. В этом случае см. в разделе [как развернуть базу данных Code First без миграции?](https://msdn.microsoft.com/library/ee942158.aspx#deploy_code_first_without_migrations) в ASP.NET Web Deployment вопросы и ответы по на сайте MSDN.

Приведенные ниже инструкции относятся к **SchoolContext** базы данных в диалоговом окне **баз данных** раздел.

1. В **строку подключения к удаленному** введите следующую строку соединения, указывающий на базе приложения SQL Server Express.

   [!code-console[Main](deploying-to-iis/samples/sample4.cmd)]

   Процесс развертывания помещает эту строку подключения в развернутый файл Web.config, так как **использовать эту строку подключения во время выполнения** выбран.

   Также можно получить строку подключения базы данных приложения из **обозревателя серверов** таким же образом, вы получили строку подключения базы данных членства.

2. Выберите **выполнить Code First Migrations (при запуске приложения)**.

   Этот параметр вызывает завершение процесса развертывания для настройки развернутый файл Web.config для указания `MigrateDatabaseToLatestVersion` инициализатор. Это инициализатор автоматически обновляет базу данных до последней версии, когда приложение получает доступ к базе данных в первый раз после развертывания.

### <a name="configure-publish-profile-transforms"></a>Настройка преобразования профиля публикации

1. Нажмите кнопку **Закрыть**. Выберите **Да** при появлении, если вы хотите сохранить изменения.

2. В **обозревателе решений**, разверните **свойства**, разверните **PublishProfiles**.

3. Щелкните правой кнопкой мыши *CustomProfile.pubxml* и переименуйте его *Test.pubxml*.

4. Щелкните правой кнопкой мыши *Test.pubxml*. Выберите **добавить преобразование конфигурации**.

   ![Преобразование конфигурации меню "Добавить"](deploying-to-iis/_static/image17.png)

   Visual Studio создает *Web.Test.config* файла преобразования и открывает его.

5. В *Web.Test.config* файл преобразования, вставьте следующий код сразу после открывающего тега конфигурации.

   [!code-xml[Main](deploying-to-iis/samples/sample5.xml)]

    При использовании теста профиль публикации, это преобразование задает индикатор среды «Test». Развернутого веб-сайта вы увидите («Test») после заголовок H1 «Contoso University».

6. Сохраните и закройте файл.

7. Щелкните правой кнопкой мыши *Web.Test.config* файл и выберите **преобразования предварительной версии** чтобы убедиться в том, что преобразование коде создает необходимые изменения.

    **Web.config предварительной версии** окна показан результат применения обоих *Web.Release.config* преобразует и *Web.Test.config* преобразования.

### <a name="preview-the-deployment-updates"></a>Предварительный просмотр обновлений развертывания

1. Откройте **веб-публикации** еще раз мастер (проект ContosoUniversity правой кнопкой мыши, выберите **публикации**, затем **предварительной версии**).

2. В **предварительной версии** выберите **начать просмотр** для просмотра списка файлов, которые будут скопированы. 

   ![Предварительный просмотр публикации](deploying-to-iis/_static/image29.png)

   Можно также выбрать **предварительной версии базы данных** ссылку, чтобы просмотреть скрипты, которые будут выполняться в базе данных членства. (Скрипты не выполняются для развертывания Code First Migrations, поэтому нет ничего для предварительного просмотра для базы данных приложения.)

3. Нажмите **Публиковать**.

   Если Visual Studio не находится в режиме администратора, может появиться сообщение об ошибке разрешения. В этом случае закройте Visual Studio, откройте его в режиме администратора и повторите попытку публикации.

   Если Visual Studio находится в режиме администратора, **вывода** отчеты окно успешной сборки и публикации.

   ![Output_window_publish_Test](deploying-to-iis/_static/image20.png)

   Если вы ввели URL-адрес в **URL-адрес назначения** поле в профиле публикации **подключения** вкладке в браузере автоматически откроется на Contoso University домашнюю страницу, работающих в службах IIS на компьютере.

## <a name="test-in-the-test-environment"></a>В среде тестирования

Обратите внимание на то, что среда индикатор отображает «(тест)» вместо «(Dev)», который показывает, что *Web.config* выполнено преобразование для индикатора среды.

Запустите **преподавателей** страницу, чтобы убедиться, что Code First заполнена начальными значениями базу данных данными преподавателя. Если выбрать эту страницу, может занять несколько минут, чтобы загрузить, так как Code First создает базу данных и затем запускает `Seed` метод. (Ничего не произошло, когда вы были на домашней странице, так как приложение не пытается получить доступ к базе данных еще.)

Выберите **учащихся** tab, чтобы убедитесь, что развернутая база данных не учащихся.

Выберите **добавить учащихся** из **учащихся** меню. Добавить учащегося, а затем просмотрите нового учащегося в **учащихся** страницы. Это подтверждает, что вы можете успешно записи в базу данных.

Из **курсы** меню, выберите **обновления кредиты**. **Кредиты обновления** страницы требуются права администратора, поэтому **вход** откроется страница. Введите учетные данные учетной записи администратора, что вы создали ранее («admin» и «devpwd»). **Обновления кредиты** откроется страница. Это подтверждает, что учетную запись администратора, созданную в предыдущем учебном курсе был правильно развернут в тестовую среду.

Убедитесь, что *ELMAH* папка существует в *c:\inetpub\wwwroot\ContosoUniversity* папку с файлом заполнитель только в ней.

<a id="reviewingmigrations"></a>

## <a name="review-the-automatic-webconfig-changes-for-code-first-migrations"></a>Просмотрите автоматического изменения Web.config для Code First Migrations

Откройте *Web.config* файл в развернутом приложении в *C:\inetpub\wwwroot\ContosoUniversity* и вы увидите, где процесс развертывания автоматически настроить Code First Migrations для Обновите базу данных до последней версии.

![](deploying-to-iis/_static/image21.png)

Процесс развертывания, также создается новая строка подключения для Code First Migrations для использования исключительно для обновления схемы базы данных:

![Строка подключения Database_Publish](deploying-to-iis/_static/image22.png)

Эта строка дополнительные подключения можно указать одну учетную запись пользователя для обновления схемы баз данных и учетной записи другого пользователя для доступа к данным приложения. Например, можно назначить **db\_владельца** роли для Code First Migrations и **db\_datareader** с **db\_datawriter**роли для приложения. Это общий шаблон защиты в глубину, не позволяющая потенциально вредоносного кода в приложении изменять схему базы данных. (Например, это может произойти в успешной атаки путем внедрения кода SQL.) Эти учебники не используйте этот шаблон. Чтобы реализовать этот шаблон в рамках сценария, выполните следующие действия:

1. В **веб-публикации** мастера в разделе **параметры** введите строку подключения, задающий пользователя с разрешениями на обновление схемы всей базы данных. Очистить **использовать эту строку подключения во время выполнения** "флажок". В развернутый файл Web.config, это становится `DatabasePublish` строку подключения.

2. Создайте преобразование файла Web.config для строки подключения, приложение для использования во время выполнения.

## <a name="summary"></a>Сводка

Теперь вы развернули приложение в службах IIS на компьютере разработчика и протестировали его там.

![Домашняя страница в тесте](deploying-to-iis/_static/image23.png)

Это подтверждает, что процесс развертывания копируется содержимое приложения в нужном направлении (за исключением файлов, которые вы не хотите развернуть), а также что веб-развертывания настроен IIS правильно во время развертывания. В следующем руководстве вы выполните еще один тест, который находит задачу развертывания, которая еще не было сделано: Установка разрешений для папки на *вяз ah* папки.

## <a name="more-information"></a>Дополнительные сведения

Сведения о запуске IIS или IIS Express в Visual Studio см. следующие ресурсы:

- [Обзор IIS Express](https://www.iis.net/learn/extensions/introduction-to-iis-express/iis-express-overview) на веб-узле IIS.net.
- [Знакомство с IIS Express](https://weblogs.asp.net/scottgu/archive/2010/06/28/introducing-iis-express.aspx) в блоге Скотта Гатри.
- [Веб-серверы в Visual Studio для проектов ASP.NET Web](https://msdn.microsoft.com/library/58wxa9w5.aspx).
- [Основные различия между IIS и ASP.NET Development Server](../../older-versions-getting-started/deploying-web-site-projects/core-differences-between-iis-and-the-asp-net-development-server-cs.md) на веб-сайте ASP.NET.

Сведения о проблемах могут возникнуть при запуске приложения в среднем уровне доверия, см. в разделе [размещения приложений ASP.NET в средний уровень доверия](http://www.4guysfromrolla.com/articles/100307-1.aspx) на четыре ребята из Rolla сайта.

> [!div class="step-by-step"]
> [Назад](project-properties.md)
> [Вперед](setting-folder-permissions.md)
