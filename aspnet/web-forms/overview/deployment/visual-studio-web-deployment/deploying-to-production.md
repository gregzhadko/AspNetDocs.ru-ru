---
uid: web-forms/overview/deployment/visual-studio-web-deployment/deploying-to-production
title: 'ASP.NET веб-развертывание с помощью Visual Studio: развертывание в рабочей среде | Документация Майкрософт'
author: tdykstra
description: В этой серии руководств показано, как развернуть (опубликовать) веб-приложение ASP.NET в веб-приложениях службы приложений Azure или поставщике услуг размещения стороннего поставщика, Усин...
ms.author: riande
ms.date: 02/15/2013
ms.assetid: 416438a1-3b2f-4d27-bf53-6b76223c33bf
msc.legacyurl: /web-forms/overview/deployment/visual-studio-web-deployment/deploying-to-production
msc.type: authoredcontent
ms.openlocfilehash: ec025e757d00cbfbfbcda9408739d2593908bc07
ms.sourcegitcommit: 0cf7d06071a8ff986e6c028ac9daf0c0e7490412
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/23/2020
ms.locfileid: "85240631"
---
# <a name="aspnet-web-deployment-using-visual-studio-deploying-to-production"></a><span data-ttu-id="6f10e-103">Веб-развертывание ASP.NET с помощью Visual Studio: развертывание в рабочей среде</span><span class="sxs-lookup"><span data-stu-id="6f10e-103">ASP.NET Web Deployment using Visual Studio: Deploying to Production</span></span>

<span data-ttu-id="6f10e-104">от [Tom Dykstra)](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="6f10e-104">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

[<span data-ttu-id="6f10e-105">Скачать начальный проект</span><span class="sxs-lookup"><span data-stu-id="6f10e-105">Download Starter Project</span></span>](https://go.microsoft.com/fwlink/p/?LinkId=282627)

> <span data-ttu-id="6f10e-106">В этой серии руководств показано, как развернуть (опубликовать) веб-приложение ASP.NET в веб-приложениях службы приложений Azure или поставщике услуг размещения стороннего поставщика с помощью Visual Studio 2012 или Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="6f10e-106">This tutorial series shows you how to deploy (publish) an ASP.NET web application to Azure App Service Web Apps or to a third-party hosting provider, by using Visual Studio 2012 or Visual Studio 2010.</span></span> <span data-ttu-id="6f10e-107">Сведения о ряде см. в [первом руководстве по ряду](introduction.md).</span><span class="sxs-lookup"><span data-stu-id="6f10e-107">For information about the series, see [the first tutorial in the series](introduction.md).</span></span>

## <a name="overview"></a><span data-ttu-id="6f10e-108">Обзор</span><span class="sxs-lookup"><span data-stu-id="6f10e-108">Overview</span></span>

<span data-ttu-id="6f10e-109">В этом руководстве описано, как настроить учетную запись Microsoft Azure, создать промежуточную и рабочую среду и развернуть веб-приложение ASP.NET в промежуточной и рабочей средах с помощью функции публикации одним щелчком в Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="6f10e-109">In this tutorial, you set up a Microsoft Azure account, create staging and production environments, and deploy your ASP.NET web application to the staging and production environments by using the Visual Studio one-click publish feature.</span></span>

<span data-ttu-id="6f10e-110">При желании можно выполнить развертывание на сторонних поставщика услуг размещения.</span><span class="sxs-lookup"><span data-stu-id="6f10e-110">If you prefer, you can deploy to a third-party hosting provider.</span></span> <span data-ttu-id="6f10e-111">Большинство процедур, описанных в этом руководстве, одинаковы для поставщика услуг размещения или для Azure, за исключением того, что каждый поставщик имеет собственный пользовательский интерфейс для управления учетными записями и веб-сайтами.</span><span class="sxs-lookup"><span data-stu-id="6f10e-111">Most of the procedures described in this tutorial are the same for a hosting provider or for Azure, except that each provider has its own user interface for account and web site management.</span></span> <span data-ttu-id="6f10e-112">Поставщик услуг размещения можно найти в [коллекции поставщиков](https://www.microsoft.com/web/hosting) на веб-сайте Microsoft.com.</span><span class="sxs-lookup"><span data-stu-id="6f10e-112">You can find a hosting provider in the [gallery of providers](https://www.microsoft.com/web/hosting) on the Microsoft.com web site.</span></span>

<span data-ttu-id="6f10e-113">Напоминание. Если вы получаете сообщение об ошибке или что-то не работает при работе с этим руководством, обязательно ознакомьтесь со страницей устранения неполадок в этой серии руководств.</span><span class="sxs-lookup"><span data-stu-id="6f10e-113">Reminder: If you get an error message or something doesn't work as you go through the tutorial, be sure to check the Troubleshooting page in this tutorial series.</span></span>

## <a name="get-a-microsoft-azure-account"></a><span data-ttu-id="6f10e-114">Получение учетной записи Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="6f10e-114">Get a Microsoft Azure account</span></span>

<span data-ttu-id="6f10e-115">Если у вас еще нет учетной записи Azure, вы можете создать бесплатную пробную учетную запись всего за несколько минут.</span><span class="sxs-lookup"><span data-stu-id="6f10e-115">If you don't already have an Azure account, you can create a free trial account in just a couple of minutes.</span></span> <span data-ttu-id="6f10e-116">Дополнительные сведения см. в разделе [Бесплатная пробная версия Azure](https://azure.microsoft.com/free/dotnet/).</span><span class="sxs-lookup"><span data-stu-id="6f10e-116">For details, see [Azure Free Trial](https://azure.microsoft.com/free/dotnet/).</span></span>

## <a name="create-a-staging-environment"></a><span data-ttu-id="6f10e-117">Создание промежуточной среды</span><span class="sxs-lookup"><span data-stu-id="6f10e-117">Create a staging environment</span></span>

> [!NOTE]
> <span data-ttu-id="6f10e-118">Поскольку этот учебник написан, служба приложений Azure добавила новую функцию для автоматизации многих процессов создания промежуточных и рабочих сред.</span><span class="sxs-lookup"><span data-stu-id="6f10e-118">Since this tutorial was written, Azure App Service added a new feature to automate many of the processes for creating staging and production environments.</span></span> <span data-ttu-id="6f10e-119">См. раздел [Настройка промежуточных сред для веб-приложений в службе приложений Azure](https://azure.microsoft.com/documentation/articles/web-sites-staged-publishing/).</span><span class="sxs-lookup"><span data-stu-id="6f10e-119">See [Set up staging environments for web apps in Azure App Service](https://azure.microsoft.com/documentation/articles/web-sites-staged-publishing/).</span></span>

<span data-ttu-id="6f10e-120">Как описано в [руководстве по развертыванию в среде тестирования](deploying-to-iis.md), самая надежная тестовая среда — это веб-сайт поставщика услуг размещения, который аналогичен рабочему веб-узлу.</span><span class="sxs-lookup"><span data-stu-id="6f10e-120">As explained in the [Deploy to the Test Environment tutorial](deploying-to-iis.md), the most reliable test environment is a web site at the hosting provider that's just like the production web site.</span></span> <span data-ttu-id="6f10e-121">Во многих поставщиках услуг размещения вам пришлось бы взвесить преимущества этого по значительному дополнительным затратам, но в Azure вы можете создать дополнительное бесплатное веб-приложение в качестве промежуточного приложения.</span><span class="sxs-lookup"><span data-stu-id="6f10e-121">At many hosting providers you would have to weigh the benefits of this against significant additional cost, but in Azure you can create an additional free web app as your staging app.</span></span> <span data-ttu-id="6f10e-122">Кроме того, требуется база данных, а дополнительные затраты на это для вашей рабочей базы данных будут не ниже, чем в случае незначительных затрат.</span><span class="sxs-lookup"><span data-stu-id="6f10e-122">You also need a database, and the additional expense for that over the expense of your production database will be either none or minimal.</span></span> <span data-ttu-id="6f10e-123">В Azure вы платите за используемое количество хранилища базы данных, а не для каждой базы данных, и объем дополнительного хранилища, который будет использоваться в промежуточном хранилище, будет минимальным.</span><span class="sxs-lookup"><span data-stu-id="6f10e-123">In Azure you pay for the amount of database storage you use rather than for each database, and the amount of additional storage you'll use in staging will be minimal.</span></span>

<span data-ttu-id="6f10e-124">Как описано в [руководстве по развертыванию в тестовой среде](deploying-to-iis.md), в промежуточной и рабочей средах вы собираетесь развернуть две базы данных в одной базе данных.</span><span class="sxs-lookup"><span data-stu-id="6f10e-124">As explained in the [Deploy to the Test Environment tutorial](deploying-to-iis.md), in staging and production you're going to deploy your two databases into one database.</span></span> <span data-ttu-id="6f10e-125">Если вы хотите, чтобы они были раздельными, процесс будет таким же, за исключением того, что вы создадите дополнительную базу данных для каждой среды и при создании профиля публикации выбрали правильную строку назначения для каждой базы данных.</span><span class="sxs-lookup"><span data-stu-id="6f10e-125">If you wanted to keep them separate, the process would be the same except that you'd create an additional database for each environment and you would select the correct destination string for each database when you create the publish profile.</span></span>

<span data-ttu-id="6f10e-126">В этом разделе учебника вы создадите веб-приложение и базу данных для промежуточной среды, а затем развернетесь на промежуточное хранение и протестируйте их перед созданием и развертыванием в рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="6f10e-126">In this section of the tutorial you'll create a web app and database to use for the staging environment, and you'll deploy to staging and test there before creating and deploying to the production environment.</span></span>

> [!NOTE]
> <span data-ttu-id="6f10e-127">Ниже описано, как создать веб-приложение в службе приложений Azure с помощью портала управления Azure.</span><span class="sxs-lookup"><span data-stu-id="6f10e-127">The following steps show how to create a web app in Azure App Service by using the Azure management portal.</span></span> <span data-ttu-id="6f10e-128">В последней версии пакета SDK для Azure это также можно сделать, не открывая Visual Studio с помощью обозреватель сервера.</span><span class="sxs-lookup"><span data-stu-id="6f10e-128">In the latest version of the Azure SDK, you can also do this without leaving Visual Studio, by using Server Explorer.</span></span> <span data-ttu-id="6f10e-129">В Visual Studio 2013 можно также создать веб-приложение непосредственно из диалогового окна Публикация.</span><span class="sxs-lookup"><span data-stu-id="6f10e-129">In Visual Studio 2013, you can also create a web app directly from the Publish dialog.</span></span> <span data-ttu-id="6f10e-130">Дополнительные сведения см [. в статье Создание веб-приложения ASP.NET в службе приложений Azure.](https://docs.microsoft.com/azure/app-service-web/app-service-web-get-started-dotnet)</span><span class="sxs-lookup"><span data-stu-id="6f10e-130">For more information, see [Create an ASP.NET web app in Azure App Service.](https://docs.microsoft.com/azure/app-service-web/app-service-web-get-started-dotnet)</span></span>

1. <span data-ttu-id="6f10e-131">В [портал управления Azure](https://manage.windowsazure.com/)щелкните **веб-сайты**, а затем — **создать**.</span><span class="sxs-lookup"><span data-stu-id="6f10e-131">In the [Azure Management Portal](https://manage.windowsazure.com/), click **Websites**, and then click **New**.</span></span>
2. <span data-ttu-id="6f10e-132">Щелкните **веб-сайт**и выберите **настраиваемое создание**.</span><span class="sxs-lookup"><span data-stu-id="6f10e-132">Click **Website**, and then click **Custom Create**.</span></span>

    <span data-ttu-id="6f10e-133">Откроется **новый веб-сайт — настраиваемый мастер создания** .</span><span class="sxs-lookup"><span data-stu-id="6f10e-133">The **New Website - Custom Create** wizard opens.</span></span> <span data-ttu-id="6f10e-134">Мастер **настраиваемого создания** позволяет одновременно создавать веб-сайт и базу данных.</span><span class="sxs-lookup"><span data-stu-id="6f10e-134">The **Custom Create** wizard enables you to create a web site and a database at the same time.</span></span>
3. <span data-ttu-id="6f10e-135">На шаге **создать веб-сайт** мастера введите строку в поле **URL-адрес** , чтобы использовать его в качестве уникального URL-адреса для промежуточной среды приложения.</span><span class="sxs-lookup"><span data-stu-id="6f10e-135">In the **Create Website** step of the wizard, enter a string in the **URL** box to use as the unique URL for your application's staging environment.</span></span> <span data-ttu-id="6f10e-136">Например, введите ContosoUniversity-staging123 (включая случайные числа в конце, чтобы сделать его уникальным в случае, если используется ContosoUniversity-промежуточное развертывание).</span><span class="sxs-lookup"><span data-stu-id="6f10e-136">For example, enter ContosoUniversity-staging123 (including random numbers at the end to make it unique in case ContosoUniversity-staging is taken).</span></span>

    <span data-ttu-id="6f10e-137">Полный URL-адрес будет состоять из введенной здесь строки и суффикса, который отображается рядом с текстовым полем.</span><span class="sxs-lookup"><span data-stu-id="6f10e-137">The complete URL will consist of what you enter here plus the suffix that you see next to the text box.</span></span>
4. <span data-ttu-id="6f10e-138">В раскрывающемся списке **регион** выберите ближайший к вам регион.</span><span class="sxs-lookup"><span data-stu-id="6f10e-138">In the **Region** drop-down list, choose the region that is closest to you.</span></span>

    <span data-ttu-id="6f10e-139">Этот параметр указывает центр обработки данных, в котором будет выполняться веб-приложение.</span><span class="sxs-lookup"><span data-stu-id="6f10e-139">This setting specifies which data center your web app will run in.</span></span>
5. <span data-ttu-id="6f10e-140">В раскрывающемся списке **база данных** выберите **создать новую базу данных SQL**.</span><span class="sxs-lookup"><span data-stu-id="6f10e-140">In the **Database** drop-down list, choose **Create a new SQL database**.</span></span>
6. <span data-ttu-id="6f10e-141">В поле **имя строки подключения к базе данных** оставьте значение по умолчанию *DefaultConnection*.</span><span class="sxs-lookup"><span data-stu-id="6f10e-141">In the **DB Connection String Name** box, leave the default value, *DefaultConnection*.</span></span>
7. <span data-ttu-id="6f10e-142">Щелкните стрелку, расположенную справа внизу окна.</span><span class="sxs-lookup"><span data-stu-id="6f10e-142">Click the arrow that points to the right at the bottom of the box.</span></span>

    <span data-ttu-id="6f10e-143">На следующем рисунке показано диалоговое окно **Создание веб-сайта** с примерами значений в нем.</span><span class="sxs-lookup"><span data-stu-id="6f10e-143">The following illustration shows the **Create Website** dialog with sample values in it.</span></span> <span data-ttu-id="6f10e-144">Введенный URL-адрес и регион будут разными.</span><span class="sxs-lookup"><span data-stu-id="6f10e-144">The URL and Region that you have entered will be different.</span></span>

    ![Шаг создания веб-сайта](deploying-to-production/_static/image1.png)

    <span data-ttu-id="6f10e-146">Мастер перейдет к шагу **Указать параметры базы данных** .</span><span class="sxs-lookup"><span data-stu-id="6f10e-146">The wizard advances to the **Specify database settings** step.</span></span>
8. <span data-ttu-id="6f10e-147">В поле **имя** введите *ContosoUniversity* плюс случайное число, чтобы сделать его уникальным, например *ContosoUniversity123*.</span><span class="sxs-lookup"><span data-stu-id="6f10e-147">In the **Name** box, enter *ContosoUniversity* plus a random number to make it unique, for example *ContosoUniversity123*.</span></span>
9. <span data-ttu-id="6f10e-148">В поле **сервер** выберите **новый сервер базы данных SQL**.</span><span class="sxs-lookup"><span data-stu-id="6f10e-148">In the **Server** box, select **New SQL Database Server**.</span></span>
10. <span data-ttu-id="6f10e-149">Введите имя администратора и пароль.</span><span class="sxs-lookup"><span data-stu-id="6f10e-149">Enter an administrator name and password.</span></span>

    <span data-ttu-id="6f10e-150">Вы не вводите здесь имя и пароль.</span><span class="sxs-lookup"><span data-stu-id="6f10e-150">You aren't entering an existing name and password here.</span></span> <span data-ttu-id="6f10e-151">Введите новые имя и пароль, которые в дальнейшем будут использоваться при обращении к базе данных.</span><span class="sxs-lookup"><span data-stu-id="6f10e-151">You're entering a new name and password that you're defining now to use later when you access the database.</span></span>
11. <span data-ttu-id="6f10e-152">В поле **регион** выберите тот же регион, который вы выбрали для веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="6f10e-152">In the **Region** box, choose the same region that you chose for the web app.</span></span>

    <span data-ttu-id="6f10e-153">Поддержание веб-сервера и сервера базы данных в одном регионе обеспечивает максимальную производительность и уменьшает расходы.</span><span class="sxs-lookup"><span data-stu-id="6f10e-153">Keeping the web server and the database server in the same region gives you the best performance and minimizes expenses.</span></span>
12. <span data-ttu-id="6f10e-154">Установите флажок в нижней части окна, чтобы указать, что все готово.</span><span class="sxs-lookup"><span data-stu-id="6f10e-154">Click the check mark at the bottom of the box to indicate that you're finished.</span></span>

    <span data-ttu-id="6f10e-155">На следующем рисунке показано диалоговое окно **Указание параметров базы данных** с примерами значений.</span><span class="sxs-lookup"><span data-stu-id="6f10e-155">The following illustration shows the **Specify database settings** dialog with sample values in it.</span></span> <span data-ttu-id="6f10e-156">Введенные значения могут отличаться.</span><span class="sxs-lookup"><span data-stu-id="6f10e-156">The values you have entered may be different.</span></span>

    ![Шаг "Параметры базы данных" для нового веб-сайта — мастер создания базы данных](deploying-to-production/_static/image2.png)

    <span data-ttu-id="6f10e-158">Портал управления возвращается на страницу веб-сайтов, а в столбце **состояние** показано, что создается веб-приложение.</span><span class="sxs-lookup"><span data-stu-id="6f10e-158">The Management Portal returns to the Websites page, and the **Status** column shows that the web app is being created.</span></span> <span data-ttu-id="6f10e-159">Через некоторое время (обычно меньше минуты) в столбце **состояние** показано, что веб-приложение успешно создано.</span><span class="sxs-lookup"><span data-stu-id="6f10e-159">After a while (typically less than a minute), the **Status** column shows that the web app was successfully created.</span></span> <span data-ttu-id="6f10e-160">На панели навигации слева отображается число веб-приложений в вашей учетной записи рядом со значком **веб-сайтов** , а рядом со значком **базы данных SQL** отображается число баз данных.</span><span class="sxs-lookup"><span data-stu-id="6f10e-160">In the navigation bar at the left, the number of web apps you have in your account appears next to the **Websites** icon, and the number of databases appears next to the **SQL Databases** icon.</span></span>

    ![Страница веб-сайтов портал управления, созданный веб-сайт](deploying-to-production/_static/image3.png)

    <span data-ttu-id="6f10e-162">Имя веб-приложения будет отличаться от примера приложения на рисунке.</span><span class="sxs-lookup"><span data-stu-id="6f10e-162">Your web app name will be different from the example app in the illustration.</span></span>

## <a name="deploy-the-application-to-staging"></a><span data-ttu-id="6f10e-163">Развертывание приложения в промежуточной среде</span><span class="sxs-lookup"><span data-stu-id="6f10e-163">Deploy the application to staging</span></span>

<span data-ttu-id="6f10e-164">Теперь, когда вы создали веб-приложение и базу данных для промежуточной среды, можно развернуть в ней проект.</span><span class="sxs-lookup"><span data-stu-id="6f10e-164">Now that you have created a web app and database for the staging environment, you can deploy the project to it.</span></span>

> [!NOTE]
> <span data-ttu-id="6f10e-165">В этих инструкциях показано, как создать профиль публикации, загрузив файл *publishsettings* , который работает не только для Azure, но также и для сторонних поставщиков услуг размещения.</span><span class="sxs-lookup"><span data-stu-id="6f10e-165">These instructions show how to create a publish profile by downloading a *.publishsettings* file, which works not only for Azure but also for third-party hosting providers.</span></span> <span data-ttu-id="6f10e-166">Последний пакет Azure SDK также позволяет напрямую подключаться к Azure из Visual Studio и выбирать из списка веб-приложений, которые имеются в вашей учетной записи Azure.</span><span class="sxs-lookup"><span data-stu-id="6f10e-166">The latest Azure SDK also enables you to connect directly to Azure from Visual Studio, and choose from a list of web apps that you have in your Azure account.</span></span> <span data-ttu-id="6f10e-167">В Visual Studio 2013 можно войти в Azure из диалогового окна **веб-публикация** или из окна **Обозреватель сервера** .</span><span class="sxs-lookup"><span data-stu-id="6f10e-167">In Visual Studio 2013, you can sign in to Azure from the **Web Publish** dialog or from the **Server Explorer** window.</span></span> <span data-ttu-id="6f10e-168">Дополнительные сведения см. [в статье Создание веб-приложения ASP.NET в службе приложений Azure](https://docs.microsoft.com/azure/app-service-web/app-service-web-get-started-dotnet).</span><span class="sxs-lookup"><span data-stu-id="6f10e-168">For more information, see [Create an ASP.NET web app in Azure App Service](https://docs.microsoft.com/azure/app-service-web/app-service-web-get-started-dotnet).</span></span>

### <a name="download-the-publishsettings-file"></a><span data-ttu-id="6f10e-169">Скачивание файла publishsettings</span><span class="sxs-lookup"><span data-stu-id="6f10e-169">Download the .publishsettings file</span></span>

1. <span data-ttu-id="6f10e-170">Щелкните имя только что созданного веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="6f10e-170">Click the name of the web app that you just created.</span></span>

    ![Щелкните сайт, чтобы открыть панель мониторинга.](deploying-to-production/_static/image4.png)
2. <span data-ttu-id="6f10e-172">В разделе **краткий обзор** на вкладке **панель мониторинга** щелкните **скачать профиль публикации**.</span><span class="sxs-lookup"><span data-stu-id="6f10e-172">Under **Quick glance** in the **Dashboard** tab, click **Download publish profile**.</span></span>

    ![Загрузить ссылку на профиль публикации](deploying-to-production/_static/image5.png)

    <span data-ttu-id="6f10e-174">На этом шаге загружается файл, содержащий все параметры, необходимые для развертывания приложения в веб-приложении.</span><span class="sxs-lookup"><span data-stu-id="6f10e-174">This step downloads a file that contains all of the settings that you need in order to deploy an application to your web app.</span></span> <span data-ttu-id="6f10e-175">Вы импортируете этот файл в Visual Studio, поэтому вам не придется вводить эти сведения вручную.</span><span class="sxs-lookup"><span data-stu-id="6f10e-175">You'll import this file into Visual Studio so you don't have to enter this information manually.</span></span>
3. <span data-ttu-id="6f10e-176">Сохраните *publishsettings* -файл в папку, к которой можно получить доступ из Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="6f10e-176">Save the *.publishsettings* file in a folder that you can access from Visual Studio.</span></span>

    ![Сохранение файла. publishsettings](deploying-to-production/_static/image6.png)

    > [!WARNING]
    > <span data-ttu-id="6f10e-178">Безопасность *. publishsettings* -файл содержит ваши учетные данные (незакодированные), которые используются для администрирования подписок и служб Azure.</span><span class="sxs-lookup"><span data-stu-id="6f10e-178">Security - The *.publishsettings* file contains your credentials (unencoded) that are used to administer your Azure subscriptions and services.</span></span> <span data-ttu-id="6f10e-179">В целях безопасности для этого файла рекомендуется временно хранить его за пределами исходных каталогов (например, в папке Libraries\Documents), а затем удалять после завершения импорта.</span><span class="sxs-lookup"><span data-stu-id="6f10e-179">The security best practice for this file is to store it temporarily outside your source directories (for example in the Libraries\Documents folder), and then delete it once the import has completed.</span></span> <span data-ttu-id="6f10e-180">Злонамеренный пользователь, получивший доступ к *publishsettings* -файлу, может изменять, создавать и удалять службы Azure.</span><span class="sxs-lookup"><span data-stu-id="6f10e-180">A malicious user who gains access to the *.publishsettings* file can edit, create, and delete your Azure services.</span></span>

### <a name="create-a-publish-profile"></a><span data-ttu-id="6f10e-181">Создание профиля публикации</span><span class="sxs-lookup"><span data-stu-id="6f10e-181">Create a publish profile</span></span>

1. <span data-ttu-id="6f10e-182">В Visual Studio щелкните правой кнопкой мыши проект ContosoUniversity в **Обозреватель решений** и выберите в контекстном меню пункт **опубликовать** .</span><span class="sxs-lookup"><span data-stu-id="6f10e-182">In Visual Studio, right-click the ContosoUniversity project in **Solution Explorer** and select **Publish** from the context menu.</span></span>

    <span data-ttu-id="6f10e-183">Откроется мастер **Публикация веб-сайта** .</span><span class="sxs-lookup"><span data-stu-id="6f10e-183">The **Publish Web** wizard opens.</span></span>
2. <span data-ttu-id="6f10e-184">Перейдите на вкладку **профиль** .</span><span class="sxs-lookup"><span data-stu-id="6f10e-184">Click the **Profile** tab.</span></span>
3. <span data-ttu-id="6f10e-185">Щелкните **Импорт**.</span><span class="sxs-lookup"><span data-stu-id="6f10e-185">Click **Import**.</span></span>
4. <span data-ttu-id="6f10e-186">Перейдите к файлу *publishsettings* , скачанному ранее, и нажмите кнопку **Открыть**.</span><span class="sxs-lookup"><span data-stu-id="6f10e-186">Navigate to the *.publishsettings* file you downloaded earlier, and then click **Open**.</span></span>

    ![Диалоговое окно «Импорт параметров публикации»](deploying-to-production/_static/image7.png)
5. <span data-ttu-id="6f10e-188">На вкладке **Подключение** щелкните **проверить подключение** , чтобы убедиться в правильности параметров.</span><span class="sxs-lookup"><span data-stu-id="6f10e-188">In the **Connection** tab, click **Validate Connection** to make sure that the settings are correct.</span></span>

    <span data-ttu-id="6f10e-189">После проверки соединения рядом с кнопкой **проверить подключение** отображается зеленая галочка.</span><span class="sxs-lookup"><span data-stu-id="6f10e-189">When the connection has been validated, a green check mark is shown next to the **Validate Connection** button.</span></span>

    <span data-ttu-id="6f10e-190">Для некоторых поставщиков услуг размещения при нажатии кнопки **проверить подключение**может появиться диалоговое окно **Ошибка сертификата** .</span><span class="sxs-lookup"><span data-stu-id="6f10e-190">For some hosting providers, when you click **Validate Connection**, you might see a **Certificate Error** dialog box.</span></span> <span data-ttu-id="6f10e-191">В этом случае убедитесь, что имя сервера отличается от предполагаемого.</span><span class="sxs-lookup"><span data-stu-id="6f10e-191">If you do, verify that the server name is what you expect.</span></span> <span data-ttu-id="6f10e-192">Если имя сервера указано правильно, выберите **сохранить этот сертификат для будущих сеансов Visual Studio** и нажмите кнопку **принять**.</span><span class="sxs-lookup"><span data-stu-id="6f10e-192">If the server name is correct, select **Save this certificate for future sessions of Visual Studio** and click **Accept**.</span></span> <span data-ttu-id="6f10e-193">(Эта ошибка означает, что поставщик услуг размещения решил избежать расходов на приобретение сертификата SSL для URL-адреса, на который выполняется развертывание.</span><span class="sxs-lookup"><span data-stu-id="6f10e-193">(This error means that the hosting provider has chosen to avoid the expense of purchasing an SSL certificate for the URL that you are deploying to.</span></span> <span data-ttu-id="6f10e-194">Если вы предпочитаете установить безопасное подключение с помощью действительного сертификата, обратитесь к поставщику услуг размещения.)</span><span class="sxs-lookup"><span data-stu-id="6f10e-194">If you prefer to establish a secure connection by using a valid certificate, contact your hosting provider.)</span></span>
6. <span data-ttu-id="6f10e-195">Щелкните **Далее**.</span><span class="sxs-lookup"><span data-stu-id="6f10e-195">Click **Next**.</span></span>

    ![значок успешного подключения и кнопка "Далее" на вкладке "подключение"](deploying-to-production/_static/image8.png)
7. <span data-ttu-id="6f10e-197">На вкладке **Параметры** разверните узел **Параметры публикации файла**, а затем выберите **исключить файлы из \_ папки данных приложения**.</span><span class="sxs-lookup"><span data-stu-id="6f10e-197">In the **Settings** tab, expand **File Publish Options**, and then select **Exclude files from the App\_Data folder**.</span></span>

    <span data-ttu-id="6f10e-198">Дополнительные сведения о других параметрах в разделе **Параметры публикации файлов**см. в учебнике [развертывание в IIS](deploying-to-iis.md) .</span><span class="sxs-lookup"><span data-stu-id="6f10e-198">For information about the other options under **File Publish Options**, see the [deploying to IIS](deploying-to-iis.md) tutorial.</span></span> <span data-ttu-id="6f10e-199">Снимок экрана, на котором показан результат этого шага, и следующие этапы настройки базы данных выполняются в конце этапов настройки базы данных.</span><span class="sxs-lookup"><span data-stu-id="6f10e-199">The screen shot that shows the result of this step and the following database configuration steps is at the end of the database configuration steps.</span></span>
8. <span data-ttu-id="6f10e-200">В разделе **DefaultConnection** в разделе **базы** данных настройте развертывание базы данных для базы данных членства.</span><span class="sxs-lookup"><span data-stu-id="6f10e-200">Under **DefaultConnection** in the **Databases** section, configure database deployment for the membership database.</span></span>
9. 1. <span data-ttu-id="6f10e-201">Выберите **обновить базу данных**.</span><span class="sxs-lookup"><span data-stu-id="6f10e-201">Select **Update database**.</span></span>

        <span data-ttu-id="6f10e-202">Поле **строки удаленного подключения** , расположенное непосредственно под **DefaultConnection** , заполняется строкой подключения из publishsettings-файла. Строка подключения включает SQL Server учетные данные, которые хранятся в виде обычного текста в файле *pubxml* .</span><span class="sxs-lookup"><span data-stu-id="6f10e-202">The **Remote connection string** box directly below **DefaultConnection** is filled in with the connection string from the .publishsettings file.The connection string includes SQL Server credentials, which are stored in plain text in the *.pubxml* file.</span></span> <span data-ttu-id="6f10e-203">Если вы не хотите хранить их окончательно, их можно удалить из профиля публикации после развертывания базы данных и сохранить в Azure.</span><span class="sxs-lookup"><span data-stu-id="6f10e-203">If you prefer not to store them permanently there, you can remove them from the publish profile after the database is deployed and store them in Azure instead.</span></span> <span data-ttu-id="6f10e-204">Дополнительные сведения см. в статье [как обеспечить безопасность строк подключения к базе данных ASP.NET при развертывании в Azure из источника](http://www.hanselman.com/blog/HowToKeepYourASPNETDatabaseConnectionStringsSecureWhenDeployingToAzureFromSource.aspx) в блоге Скотта Hanselman.</span><span class="sxs-lookup"><span data-stu-id="6f10e-204">For more information, see [How to keep your ASP.NET database connection strings secure when deploying to Azure from Source](http://www.hanselman.com/blog/HowToKeepYourASPNETDatabaseConnectionStringsSecureWhenDeployingToAzureFromSource.aspx) on Scott Hanselman's blog.</span></span>
      2. <span data-ttu-id="6f10e-205">Щелкните **настроить обновления базы данных**.</span><span class="sxs-lookup"><span data-stu-id="6f10e-205">Click **Configure database updates**.</span></span>
      3. <span data-ttu-id="6f10e-206">В диалоговом окне **Настройка обновлений базы данных** нажмите кнопку **Добавить скрипт SQL**.</span><span class="sxs-lookup"><span data-stu-id="6f10e-206">In the **Configure Database Updates** dialog box, click **Add SQL Script**.</span></span>
      4. <span data-ttu-id="6f10e-207">В поле **Добавить скрипт SQL** перейдите к скрипту *АСПнет-Дата-прод. SQL* , сохраненному ранее в папке решения, и нажмите кнопку **Открыть**.</span><span class="sxs-lookup"><span data-stu-id="6f10e-207">In the **Add SQL Script** box, navigate to the *aspnet-data-prod.sql* script that you saved earlier in the solution folder, and then click **Open**.</span></span>
      5. <span data-ttu-id="6f10e-208">Закройте диалоговое окно **Настройка обновлений базы данных** .</span><span class="sxs-lookup"><span data-stu-id="6f10e-208">Close the **Configure Database Updates** dialog box.</span></span>
10. <span data-ttu-id="6f10e-209">В разделе **SchoolContext** ( **базы данных** ) выберите **Execute Code First migrations (выполняется при запуске приложения)**.</span><span class="sxs-lookup"><span data-stu-id="6f10e-209">Under **SchoolContext** in the **Databases** section, select **Execute Code First Migrations (runs on application start)**.</span></span>

    <span data-ttu-id="6f10e-210">Visual Studio отображает **Execute Code First migrations** вместо **базы данных Update** для `DbContext` классов.</span><span class="sxs-lookup"><span data-stu-id="6f10e-210">Visual Studio displays **Execute Code First Migrations** instead of **Update Database** for `DbContext` classes.</span></span> <span data-ttu-id="6f10e-211">Если вы хотите использовать поставщик Дбдакфкс вместо миграции для развертывания базы данных, к которой вы обращаетесь с помощью `DbContext` класса, см. раздел [разделы справки развертывание базы данных Code First без миграции?](https://msdn.microsoft.com/library/ee942158.aspx#deploy_code_first_without_migrations) в статье вопросы и ответы по веб-развертыванию для Visual Studio и ASP.NET на сайте MSDN.</span><span class="sxs-lookup"><span data-stu-id="6f10e-211">If you want to use the dbDacFx provider instead of Migrations to deploy a database that you access by using a `DbContext` class, see [How do I deploy a Code First database without Migrations?](https://msdn.microsoft.com/library/ee942158.aspx#deploy_code_first_without_migrations) in the Web Deployment FAQ for Visual Studio and ASP.NET on MSDN.</span></span>

    <span data-ttu-id="6f10e-212">Вкладка **Параметры** теперь выглядит, как показано в следующем примере:</span><span class="sxs-lookup"><span data-stu-id="6f10e-212">The **Settings** tab now looks like the following example:</span></span>

    ![Вкладка "Параметры" для промежуточного хранения](deploying-to-production/_static/image9.png)
11. <span data-ttu-id="6f10e-214">Чтобы сохранить профиль и переименовать его в *промежуточное хранение*, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="6f10e-214">Perform the following steps to save the profile and rename it to *Staging*:</span></span>

    1. <span data-ttu-id="6f10e-215">Перейдите на вкладку **профиль** и выберите **Управление профилями**.</span><span class="sxs-lookup"><span data-stu-id="6f10e-215">Click the **Profile** tab, and then click **Manage Profiles**.</span></span>
    2. <span data-ttu-id="6f10e-216">Импорт создал два новых профиля: один для FTP и один для веб-развертывание.</span><span class="sxs-lookup"><span data-stu-id="6f10e-216">The import created two new profiles, one for FTP and one for Web Deploy.</span></span> <span data-ttu-id="6f10e-217">Вы настроили профиль веб-развертывание: Переименуйте этот профиль в *промежуточный*.</span><span class="sxs-lookup"><span data-stu-id="6f10e-217">You configured the Web Deploy profile: rename this profile to *Staging*.</span></span>

        ![Переименование профиля в промежуточное хранение](deploying-to-production/_static/image10.png)
    3. <span data-ttu-id="6f10e-219">Закройте диалоговое окно **изменение профилей веб-публикации** .</span><span class="sxs-lookup"><span data-stu-id="6f10e-219">Close the **Edit Web Publish Profiles** dialog box.</span></span>
    4. <span data-ttu-id="6f10e-220">Закройте мастер **публикации веб-сайта** .</span><span class="sxs-lookup"><span data-stu-id="6f10e-220">Close the **Publish Web** wizard.</span></span>

### <a name="configure-a-publish-profile-transform-for-the-environment-indicator"></a><span data-ttu-id="6f10e-221">Настройка преобразования профиля публикации для индикатора среды</span><span class="sxs-lookup"><span data-stu-id="6f10e-221">Configure a publish profile transform for the environment indicator</span></span>

> [!NOTE]
> <span data-ttu-id="6f10e-222">В этом разделе показано, как настроить преобразование Web.config для индикатора среды.</span><span class="sxs-lookup"><span data-stu-id="6f10e-222">This section shows how to set up a Web.config transform for the environment indicator.</span></span> <span data-ttu-id="6f10e-223">Поскольку индикатор находится в `<appSettings>` элементе, у вас есть другая альтернатива для указания преобразования при развертывании в службе приложений Azure.</span><span class="sxs-lookup"><span data-stu-id="6f10e-223">Because the indicator is in the `<appSettings>` element, you have another alternative for specifying the transformation when you're deploying to Azure App Service.</span></span> <span data-ttu-id="6f10e-224">Дополнительные сведения см. [в статье указание параметров Web.config в Azure](web-config-transformations.md#watransforms).</span><span class="sxs-lookup"><span data-stu-id="6f10e-224">For more information, see [Specifying Web.config settings in Azure](web-config-transformations.md#watransforms).</span></span>

1. <span data-ttu-id="6f10e-225">В **Обозреватель решений**разверните узел **свойства**, а затем разверните узел **PublishProfiles**.</span><span class="sxs-lookup"><span data-stu-id="6f10e-225">In **Solution Explorer**, expand **Properties**, and then expand **PublishProfiles**.</span></span>
2. <span data-ttu-id="6f10e-226">Щелкните правой кнопкой мыши файл *промежуточного развертывания. pubxml*и выберите команду **добавить преобразование конфигурации**.</span><span class="sxs-lookup"><span data-stu-id="6f10e-226">Right-click *Staging.pubxml*, and then click **Add Config Transform**.</span></span>

    ![Добавление преобразования конфигурации для промежуточного хранения](deploying-to-production/_static/image11.png)

    <span data-ttu-id="6f10e-228">Visual Studio создаст файл преобразования *Web.Staging.config* и откроет его.</span><span class="sxs-lookup"><span data-stu-id="6f10e-228">Visual Studio creates the *Web.Staging.config* transform file and opens it.</span></span>
3. <span data-ttu-id="6f10e-229">В файле преобразования *Web.Staging.config* вставьте следующий код сразу после открывающего `configuration` тега.</span><span class="sxs-lookup"><span data-stu-id="6f10e-229">In the *Web.Staging.config* transform file, insert the following code immediately after the opening `configuration` tag.</span></span>

    [!code-xml[Main](deploying-to-production/samples/sample1.xml)]

    <span data-ttu-id="6f10e-230">При использовании профиля промежуточной публикации это преобразование задает для индикатора среды значение "произ.".</span><span class="sxs-lookup"><span data-stu-id="6f10e-230">When you use the Staging publish profile, this transform sets the environment indicator to "Prod".</span></span> <span data-ttu-id="6f10e-231">В развернутом веб-приложении не отображаются суффиксы, такие как "(dev)" или "(тест)" после заголовка "H1" университета Contoso ".</span><span class="sxs-lookup"><span data-stu-id="6f10e-231">In the deployed web app, you won't see any suffix such as "(Dev)" or "(Test)" after the "Contoso University" H1 heading.</span></span>
4. <span data-ttu-id="6f10e-232">Щелкните правой кнопкой мыши файл *Web.Staging.config* и выберите команду **предварительное преобразование** , чтобы убедиться, что преобразование, которое вы закодируете, создает ожидаемые изменения.</span><span class="sxs-lookup"><span data-stu-id="6f10e-232">Right-click the *Web.Staging.config* file and click **Preview Transform** to make sure that the transform you coded produces the expected changes.</span></span>

    <span data-ttu-id="6f10e-233">В окне **Предварительный просмотрWeb.config** отображается результат применения преобразований *Web.Release.config* и *Web.Staging.config* преобразований.</span><span class="sxs-lookup"><span data-stu-id="6f10e-233">The **Web.config Preview** window shows the result of applying both the *Web.Release.config* transforms and the *Web.Staging.config* transforms.</span></span>

### <a name="prevent-public-use-of-the-test-app"></a><span data-ttu-id="6f10e-234">Запрет общего использования тестового приложения</span><span class="sxs-lookup"><span data-stu-id="6f10e-234">Prevent public use of the test app</span></span>

<span data-ttu-id="6f10e-235">Важное замечание для промежуточного приложения заключается в том, что оно будет находиться в Интернете, но вы не хотите, чтобы он использовался в общедоступной среде.</span><span class="sxs-lookup"><span data-stu-id="6f10e-235">An important consideration for the staging app is that it will be live on the Internet, but you don't want the public to use it.</span></span> <span data-ttu-id="6f10e-236">Чтобы максимально увеличить вероятность того, что пользователи смогут найти и использовать его, можно использовать один или несколько следующих методов.</span><span class="sxs-lookup"><span data-stu-id="6f10e-236">To minimize the likelihood that people will find and use it, you can use one or more of the following methods:</span></span>

- <span data-ttu-id="6f10e-237">Настройте правила брандмауэра, которые разрешают доступ к промежуточному приложению только с IP-адресов, используемых для проверки промежуточного хранения.</span><span class="sxs-lookup"><span data-stu-id="6f10e-237">Set firewall rules that allow access to the staging app only from IP addresses that you use to test staging.</span></span>
- <span data-ttu-id="6f10e-238">Используйте скрытый URL-адрес, который невозможно угадать.</span><span class="sxs-lookup"><span data-stu-id="6f10e-238">Use an obfuscated URL that would be impossible to guess.</span></span>
- <span data-ttu-id="6f10e-239">Создайте файл *robots.txt* , чтобы поисковые системы не выполняли сканирование тестового приложения и сообщают о нем ссылки в результатах поиска.</span><span class="sxs-lookup"><span data-stu-id="6f10e-239">Create a *robots.txt* file to ensure that search engines will not crawl the test app and report links to it in search results.</span></span>

<span data-ttu-id="6f10e-240">Первый из этих методов является наиболее эффективным, но не рассматривается в этом руководстве, так как для этого потребуется выполнить развертывание в облачной службе Azure вместо службы приложений Azure.</span><span class="sxs-lookup"><span data-stu-id="6f10e-240">The first of these methods is the most effective but is not covered in this tutorial because it would require that you deploy to an Azure Cloud Service instead of Azure App Service.</span></span> <span data-ttu-id="6f10e-241">Дополнительные сведения об ограничениях облачных служб и IP-адресов в Azure см. в статье [варианты размещения вычислений, предоставляемые Azure](https://docs.microsoft.com/azure/cloud-services/cloud-services-choose-me) , и [заблокируйте доступ к веб-роли определенным IP-адресам](https://msdn.microsoft.com/library/windowsazure/jj154098.aspx).</span><span class="sxs-lookup"><span data-stu-id="6f10e-241">For more information about Cloud Services and IP restrictions in Azure, see [Compute Hosting Options Provided by Azure](https://docs.microsoft.com/azure/cloud-services/cloud-services-choose-me) and [Block Specific IP Addresses from Accessing a Web Role](https://msdn.microsoft.com/library/windowsazure/jj154098.aspx).</span></span> <span data-ttu-id="6f10e-242">Если вы развертываете поставщик услуг размещения стороннего производителя, обратитесь к поставщику, чтобы узнать, как реализовать ограничения IP-адресов.</span><span class="sxs-lookup"><span data-stu-id="6f10e-242">If you are deploying to a third-party hosting provider, contact the provider to find out how to implement IP restrictions.</span></span>

<span data-ttu-id="6f10e-243">В этом руководстве вы создадите файл *robots.txt* .</span><span class="sxs-lookup"><span data-stu-id="6f10e-243">For this tutorial, you'll create a *robots.txt* file.</span></span>

1. <span data-ttu-id="6f10e-244">В **Обозреватель решений**щелкните правой кнопкой мыши проект ContosoUniversity и выберите команду **Добавить новый элемент**.</span><span class="sxs-lookup"><span data-stu-id="6f10e-244">In **Solution Explorer**, right-click the ContosoUniversity project and click **Add New Item**.</span></span>
2. <span data-ttu-id="6f10e-245">Создайте новый **текстовый файл** с именем *robots.txt*и вставьте в него следующий текст:</span><span class="sxs-lookup"><span data-stu-id="6f10e-245">Create a new **Text File** named *robots.txt*, and put the following text in it:</span></span>

    [!code-console[Main](deploying-to-production/samples/sample2.cmd)]

    <span data-ttu-id="6f10e-246">Эта `User-agent` строка указывает поисковым системам, что правила в файле применяются ко всем поисковым средствам поисковой системы (роботы), а в `Disallow` строке указано, что обход страниц на сайте не должен выполняться.</span><span class="sxs-lookup"><span data-stu-id="6f10e-246">The `User-agent` line tells search engines that the rules in the file apply to all search engine web crawlers (robots), and the `Disallow` line specifies that no pages on the site should be crawled.</span></span>

    <span data-ttu-id="6f10e-247">Вы хотите, чтобы поисковые системы были в каталоге рабочего приложения, поэтому необходимо исключить этот файл из рабочего развертывания.</span><span class="sxs-lookup"><span data-stu-id="6f10e-247">You do want search engines to catalog your production app, so you need to exclude this file from production deployment.</span></span> <span data-ttu-id="6f10e-248">Для этого вы настроите параметр в рабочем профиле публикации при его создании.</span><span class="sxs-lookup"><span data-stu-id="6f10e-248">To do that, you'll configure a setting in the Production publish profile when you create it.</span></span>

### <a name="deploy-to-staging"></a><span data-ttu-id="6f10e-249">Развертывание в промежуточное хранилище</span><span class="sxs-lookup"><span data-stu-id="6f10e-249">Deploy to staging</span></span>

1. <span data-ttu-id="6f10e-250">Откройте мастер **публикации веб-сайта** , щелкнув правой кнопкой мыши проект университета Contoso и выбрав пункт **опубликовать**.</span><span class="sxs-lookup"><span data-stu-id="6f10e-250">Open the **Publish Web** wizard by right-clicking the Contoso University project and clicking **Publish**.</span></span>
2. <span data-ttu-id="6f10e-251">Убедитесь, что выбран **промежуточный** профиль.</span><span class="sxs-lookup"><span data-stu-id="6f10e-251">Make sure that the **Staging** profile is selected.</span></span>
3. <span data-ttu-id="6f10e-252">Нажмите кнопку **Опубликовать**.</span><span class="sxs-lookup"><span data-stu-id="6f10e-252">Click **Publish**.</span></span>

    <span data-ttu-id="6f10e-253">В окне **Вывод** указывается, какие действия по развертыванию были выполнены, а также сообщается об успешном завершении развертывания.</span><span class="sxs-lookup"><span data-stu-id="6f10e-253">The **Output** window shows what deployment actions were taken and reports successful completion of the deployment.</span></span> <span data-ttu-id="6f10e-254">Браузер по умолчанию автоматически открывается по URL-адресу развернутого приложения.</span><span class="sxs-lookup"><span data-stu-id="6f10e-254">The default browser automatically opens to the URL of the deployed web app.</span></span>

## <a name="test-in-the-staging-environment"></a><span data-ttu-id="6f10e-255">Тестирование в промежуточной среде</span><span class="sxs-lookup"><span data-stu-id="6f10e-255">Test in the staging environment</span></span>

<span data-ttu-id="6f10e-256">Обратите внимание, что индикатор среды отсутствует (отсутствует "(тест)" или "(dev)" после заголовка H1, который показывает, что преобразование *Web.config* для индикатора среды прошло успешно.</span><span class="sxs-lookup"><span data-stu-id="6f10e-256">Notice that the environment indicator is absent (there is no "(Test)" or "(Dev)" after the H1 heading, which shows that the *Web.config* transformation for the environment indicator was successful.</span></span>

![Промежуточное размещение домашней страницы](deploying-to-production/_static/image12.png)

<span data-ttu-id="6f10e-258">Запустите страницу **учащихся** , чтобы убедиться, что развернутая база данных не содержит учащихся.</span><span class="sxs-lookup"><span data-stu-id="6f10e-258">Run the **Students** page to verify that the deployed database has no students.</span></span>

<span data-ttu-id="6f10e-259">Запустите страницу **инструкторы** , чтобы убедиться, что Code First заполнена базой данных с помощью инструкторов:</span><span class="sxs-lookup"><span data-stu-id="6f10e-259">Run the **Instructors** page to verify that Code First seeded the database with instructor data:</span></span>

<span data-ttu-id="6f10e-260">Выберите **Добавить учащихся** в меню **учащихся** , добавьте учащийся, а затем просмотрите новый учащийся на странице **учащихся** , чтобы убедиться, что вы можете успешно выполнить запись в базу данных.</span><span class="sxs-lookup"><span data-stu-id="6f10e-260">Select **Add Students** from the **Students** menu, add a student, and then view the new student in the **Students** page to verify that you can successfully write to the database.</span></span>

<span data-ttu-id="6f10e-261">На странице **курсы** щелкните **Обновить кредиты**.</span><span class="sxs-lookup"><span data-stu-id="6f10e-261">From the **Courses** page, click **Update Credits**.</span></span> <span data-ttu-id="6f10e-262">На странице " **Обновление кредитов** " требуются разрешения администратора, поэтому отображается страница **входа** .</span><span class="sxs-lookup"><span data-stu-id="6f10e-262">The **Update Credits** page requires administrator permissions, so the **Log In** page is displayed.</span></span> <span data-ttu-id="6f10e-263">Введите учетные данные администратора, созданные ранее ("admin" и "продпвд").</span><span class="sxs-lookup"><span data-stu-id="6f10e-263">Enter the administrator account credentials that you created earlier ("admin" and "prodpwd").</span></span> <span data-ttu-id="6f10e-264">Отобразится страница **Обновление кредитов** , которая подтверждает, что учетная запись администратора, созданная в предыдущем руководстве, правильно развернута в тестовой среде.</span><span class="sxs-lookup"><span data-stu-id="6f10e-264">The **Update Credits** page is displayed, which verifies that the administrator account that you created in the previous tutorial was correctly deployed to the test environment.</span></span>

<span data-ttu-id="6f10e-265">Запросите недопустимый URL-адрес, чтобы вызвать ошибку, которую будет отчитываться ELMAH, а затем запросите отчет об ошибках ELMAH.</span><span class="sxs-lookup"><span data-stu-id="6f10e-265">Request an invalid URL to cause an error that ELMAH will track, and then request the ELMAH error report.</span></span> <span data-ttu-id="6f10e-266">При развертывании на поставщик услуг размещения стороннего производителя, вероятно, вы обнаружите, что отчет пуст по той же причине, что он был пустым в предыдущем руководстве.</span><span class="sxs-lookup"><span data-stu-id="6f10e-266">If you are deploying to a third-party hosting provider, you will probably find that the report is empty for the same reason that it was empty in the previous tutorial.</span></span> <span data-ttu-id="6f10e-267">Необходимо использовать средства управления учетными записями поставщика услуг размещения, чтобы настроить разрешения для папки, чтобы разрешить ELMAH запись в папку журнала.</span><span class="sxs-lookup"><span data-stu-id="6f10e-267">You will have to use the hosting provider's account management tools to configure folder permissions to enable ELMAH to write to the log folder.</span></span>

<span data-ttu-id="6f10e-268">Созданное вами приложение теперь выполняется в облаке в веб-приложении, которое точно похоже на то, что будет использоваться для рабочей среды.</span><span class="sxs-lookup"><span data-stu-id="6f10e-268">The application that you created is now running in the cloud in a web app that is just like what you will use for production.</span></span> <span data-ttu-id="6f10e-269">Так как все работает правильно, следующий шаг заключается в развертывании в рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="6f10e-269">Since everything is working correctly, the next step is to deploy to production.</span></span>

## <a name="deploy-to-production"></a><span data-ttu-id="6f10e-270">Развертывание в рабочую среду</span><span class="sxs-lookup"><span data-stu-id="6f10e-270">Deploy to production</span></span>

<span data-ttu-id="6f10e-271">Процесс создания рабочего веб-приложения и развертывания в рабочей среде аналогичен процессу для промежуточного хранения, за исключением того, что необходимо исключить *robots.txt* из развертывания.</span><span class="sxs-lookup"><span data-stu-id="6f10e-271">The process for creating a production web app and deploying to production is the same as for staging, except that you need to exclude the *robots.txt* from deployment.</span></span> <span data-ttu-id="6f10e-272">Для этого необходимо изменить файл профиля публикации.</span><span class="sxs-lookup"><span data-stu-id="6f10e-272">To do that you'll edit the publish profile file.</span></span>

### <a name="create-the-production-environment-and-the-production-publish-profile"></a><span data-ttu-id="6f10e-273">Создание рабочей среды и профиля публикации в рабочей среде</span><span class="sxs-lookup"><span data-stu-id="6f10e-273">Create the production environment and the production publish profile</span></span>

1. <span data-ttu-id="6f10e-274">Создайте рабочее веб-приложение и базу данных в Azure, следуя той же процедуре, которая использовалась для промежуточного хранения.</span><span class="sxs-lookup"><span data-stu-id="6f10e-274">Create the production web app and database in Azure, following the same procedure that you used for staging.</span></span>

    <span data-ttu-id="6f10e-275">При создании базы данных ее можно выбрать на том же сервере, который был создан ранее, или создать новый сервер.</span><span class="sxs-lookup"><span data-stu-id="6f10e-275">When you create the database, you can choose to put it on the same server you created earlier, or create a new server.</span></span>
2. <span data-ttu-id="6f10e-276">Скачайте файл *publishsettings* .</span><span class="sxs-lookup"><span data-stu-id="6f10e-276">Download the *.publishsettings* file.</span></span>
3. <span data-ttu-id="6f10e-277">Создайте профиль публикации, импортировав файл Production *. publishsettings* , следуя той же процедуре, которая использовалась для промежуточного хранения.</span><span class="sxs-lookup"><span data-stu-id="6f10e-277">Create the publish profile by importing the production *.publishsettings* file, following the same procedure that you used for staging.</span></span>

    <span data-ttu-id="6f10e-278">Не забудьте настроить скрипт развертывания данных в разделе **DefaultConnection** в разделе **базы данных** на вкладке **Параметры** .</span><span class="sxs-lookup"><span data-stu-id="6f10e-278">Don't forget to configure the data deployment script under **DefaultConnection** in the **Databases** section of the **Settings** tab.</span></span>
4. <span data-ttu-id="6f10e-279">Переименуйте профиль публикации в *рабочую среду*.</span><span class="sxs-lookup"><span data-stu-id="6f10e-279">Rename the publish profile to *Production*.</span></span>
5. <span data-ttu-id="6f10e-280">Настройте преобразование профиля публикации для индикатора среды, следуя той же процедуре, которая использовалась для промежуточного хранения.</span><span class="sxs-lookup"><span data-stu-id="6f10e-280">Configure a publish profile transform for the environment indicator, following the same procedure that you used for staging..</span></span>

### <a name="edit-the-pubxml-file-to-exclude-robotstxt"></a><span data-ttu-id="6f10e-281">Измените файл pubxml, чтобы исключить robots.txt</span><span class="sxs-lookup"><span data-stu-id="6f10e-281">Edit the .pubxml file to exclude robots.txt</span></span>

<span data-ttu-id="6f10e-282">Файлы профиля публикации имеют имя &lt; имя_профиля &gt; *. pubxml* и находятся в папке *PublishProfiles* .</span><span class="sxs-lookup"><span data-stu-id="6f10e-282">Publish profile files are named &lt;profilename&gt;*.pubxml* and are located in the *PublishProfiles* folder.</span></span> <span data-ttu-id="6f10e-283">Папка *PublishProfiles* находится в папке *Properties* проекта веб-приложения C#, в папке *My Project* в проекте веб-приложения VB или в папке \* \_ данных приложения\* в проекте веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="6f10e-283">The *PublishProfiles* folder is under the *Properties* folder in a C# web application project, under the *My Project* folder in a VB web application project, or under the *App\_Data* folder in a web app project.</span></span> <span data-ttu-id="6f10e-284">Каждый файл *. pubxml* содержит параметры, которые применяются к одному профилю публикации.</span><span class="sxs-lookup"><span data-stu-id="6f10e-284">Each *.pubxml* file contains settings that apply to one publish profile.</span></span> <span data-ttu-id="6f10e-285">Значения, введенные в мастере публикации веб-сайта, хранятся в этих файлах, и их можно изменить для создания или изменения параметров, которые не становятся доступными в пользовательском интерфейсе Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="6f10e-285">The values you enter in the Publish Web wizard are stored in these files, and you can edit them to create or change settings that aren't made available in the Visual Studio UI.</span></span>

<span data-ttu-id="6f10e-286">По умолчанию файлы *. pubxml* включаются в проект при создании профиля публикации, но их можно исключить из проекта, и Visual Studio по-прежнему будет использовать их.</span><span class="sxs-lookup"><span data-stu-id="6f10e-286">By default, *.pubxml* files are included in the project when you create a publish profile, but you can exclude them from the project and Visual Studio will still use them.</span></span> <span data-ttu-id="6f10e-287">Visual Studio ищет в папке *PublishProfiles* файлы *. pubxml* , независимо от того, включены ли они в проект.</span><span class="sxs-lookup"><span data-stu-id="6f10e-287">Visual Studio looks in the *PublishProfiles* folder for *.pubxml* files, regardless of whether they are included in the project.</span></span>

<span data-ttu-id="6f10e-288">Для каждого *pubxml* -файла существует файл *. pubxml. User* .</span><span class="sxs-lookup"><span data-stu-id="6f10e-288">For each *.pubxml* file there is a *.pubxml.user* file.</span></span> <span data-ttu-id="6f10e-289">Файл *. pubxml. User* содержит зашифрованный пароль, если выбран параметр **Сохранить пароль** , и по умолчанию он исключается из проекта.</span><span class="sxs-lookup"><span data-stu-id="6f10e-289">The *.pubxml.user* file contains the encrypted password if you selected the **Save password** option, and by default it is excluded from the project.</span></span>

<span data-ttu-id="6f10e-290">Файл *. pubxml* содержит параметры, относящиеся к конкретному профилю публикации.</span><span class="sxs-lookup"><span data-stu-id="6f10e-290">A *.pubxml* file contains the settings that pertain to a specific publish profile.</span></span> <span data-ttu-id="6f10e-291">Если необходимо настроить параметры, применяемые ко всем профилям, можно создать файл *.. targets* .</span><span class="sxs-lookup"><span data-stu-id="6f10e-291">If you want to configure settings that apply to all profiles, you can create a *.wpp.targets* file.</span></span> <span data-ttu-id="6f10e-292">Процесс сборки импортирует эти файлы в файл проекта *CSPROJ* или *VBPROJ* , поэтому большинство параметров, которые можно настроить в файле проекта, можно настроить в этих файлах.</span><span class="sxs-lookup"><span data-stu-id="6f10e-292">The build process imports these files into the *.csproj* or *.vbproj* project file, so most settings that you can configure in the project file can be configured in these files.</span></span> <span data-ttu-id="6f10e-293">Дополнительные сведения о файлах *. pubxml* и *. wpp. targets* см. в разделе [как изменить параметры развертывания в файлах профиля публикации (. pubxml) и в файле. wpp. targets в веб-проектах Visual Studio](https://msdn.microsoft.com/library/ff398069.aspx).</span><span class="sxs-lookup"><span data-stu-id="6f10e-293">For more information about *.pubxml* files and *.wpp.targets* files, see [How to: Edit Deployment Settings in Publish Profile (.pubxml) Files and the .wpp.targets File in Visual Studio Web Projects](https://msdn.microsoft.com/library/ff398069.aspx).</span></span>

1. <span data-ttu-id="6f10e-294">В **Обозреватель решений**разверните узел **Свойства** и разверните узел **PublishProfiles**.</span><span class="sxs-lookup"><span data-stu-id="6f10e-294">In **Solution Explorer**, expand **Properties** and expand **PublishProfiles**.</span></span>
2. <span data-ttu-id="6f10e-295">Щелкните правой кнопкой мыши *Production. pubxml* и нажмите кнопку **Открыть**.</span><span class="sxs-lookup"><span data-stu-id="6f10e-295">Right-click *Production.pubxml* and click **Open**.</span></span>

    ![Открытие файла pubxml](deploying-to-production/_static/image13.png)
3. <span data-ttu-id="6f10e-297">Щелкните правой кнопкой мыши *Production. pubxml* и нажмите кнопку **Открыть**.</span><span class="sxs-lookup"><span data-stu-id="6f10e-297">Right-click *Production.pubxml* and click **Open**.</span></span>
4. <span data-ttu-id="6f10e-298">Добавьте следующие строки непосредственно перед закрывающим `PropertyGroup` элементом:</span><span class="sxs-lookup"><span data-stu-id="6f10e-298">Add the following lines immediately before the closing `PropertyGroup` element:</span></span>

    [!code-xml[Main](deploying-to-production/samples/sample3.xml)]

    <span data-ttu-id="6f10e-299">Файл. pubxml теперь выглядит как в следующем примере:</span><span class="sxs-lookup"><span data-stu-id="6f10e-299">The .pubxml file now looks like the following example:</span></span>

    [!code-xml[Main](deploying-to-production/samples/sample4.xml?highlight=18-20)]

    <span data-ttu-id="6f10e-300">Дополнительные сведения об исключении файлов и папок см. в разделе [можно ли исключить определенные файлы или папки из развертывания?](https://msdn.microsoft.com/library/ee942158.aspx#can_i_exclude_specific_files_or_folders_from_deployment) в статье **вопросы и ответы по веб-развертыванию Visual Studio и ASP.NET** на сайте MSDN.</span><span class="sxs-lookup"><span data-stu-id="6f10e-300">For more information about how to exclude files and folders, see [Can I exclude specific files or folders from deployment?](https://msdn.microsoft.com/library/ee942158.aspx#can_i_exclude_specific_files_or_folders_from_deployment) in the **Web Deployment FAQ for Visual Studio and ASP.NET** on MSDN.</span></span>

### <a name="deploy-to-production"></a><span data-ttu-id="6f10e-301">Развертывание в рабочую среду</span><span class="sxs-lookup"><span data-stu-id="6f10e-301">Deploy to production</span></span>

1. <span data-ttu-id="6f10e-302">Откройте мастер **публикации веб-сайта** , убедитесь, что выбран профиль **рабочей** публикации, и нажмите кнопку **запустить предварительный просмотр** на вкладке **Предварительный просмотр** , чтобы убедиться, что файл *robots.txt* не будет скопирован в рабочее приложение.</span><span class="sxs-lookup"><span data-stu-id="6f10e-302">Open the **Publish Web** wizard make sure that the **Production** publish profile is selected, and then click **Start Preview** on the **Preview** tab to verify that the *robots.txt* file will not be copied to the production app.</span></span>

    ![Предварительный просмотр файлов для публикации в рабочей среде](deploying-to-production/_static/image14.png)

    <span data-ttu-id="6f10e-304">Проверьте список файлов, которые будут скопированы.</span><span class="sxs-lookup"><span data-stu-id="6f10e-304">Review the list of files that will be copied.</span></span> <span data-ttu-id="6f10e-305">Вы увидите, что все файлы *. CS* , включая файлы *. aspx.cs*, *. aspx.Designer.CS*, *master.CS*и *master.Designer.CS* , пропущены.</span><span class="sxs-lookup"><span data-stu-id="6f10e-305">You'll see that all of the *.cs* files, including *.aspx.cs*, *.aspx.designer.cs*, *Master.cs*, and *Master.designer.cs* files are omitted.</span></span> <span data-ttu-id="6f10e-306">Весь этот код был скомпилирован в файлы *ContosoUniversity.dll* и *ContosoUniversity. pdb* , которые можно найти в папке *bin* .</span><span class="sxs-lookup"><span data-stu-id="6f10e-306">All of this code has been compiled into the *ContosoUniversity.dll* and *ContosoUniversity.pdb* files that you'll find in the *bin* folder.</span></span> <span data-ttu-id="6f10e-307">Поскольку для запуска приложения требуется только *DLL-файл* , и вы указали ранее, что только файлы, необходимые для запуска приложения, должны быть развернуты, а файлы *. CS* не были скопированы в целевую среду.</span><span class="sxs-lookup"><span data-stu-id="6f10e-307">Because only the *.dll* is needed to run the application, and you specified earlier that only files needed to run the application should be deployed, no *.cs* files were copied to the destination environment.</span></span> <span data-ttu-id="6f10e-308">Папка *obj* и файлы *ContosoUniversity. csproj* и *. csproj. User* опущены по той же причине.</span><span class="sxs-lookup"><span data-stu-id="6f10e-308">The *obj* folder and the *ContosoUniversity.csproj* and *.csproj.user* files are omitted for the same reason.</span></span>

    <span data-ttu-id="6f10e-309">Щелкните **опубликовать** , чтобы развернуть в рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="6f10e-309">Click **Publish** to deploy to the production environment.</span></span>
2. <span data-ttu-id="6f10e-310">Протестируйте в рабочей среде, следуя той же процедуре, которая использовалась для промежуточного хранения.</span><span class="sxs-lookup"><span data-stu-id="6f10e-310">Test in production, following the same procedure you used for staging.</span></span>

    <span data-ttu-id="6f10e-311">Все идентично промежуточному развертыванию, за исключением URL-адреса и отсутствия файла *robots.txt* .</span><span class="sxs-lookup"><span data-stu-id="6f10e-311">Everything is identical to staging except for the URL and the absence of the *robots.txt* file.</span></span>

## <a name="summary"></a><span data-ttu-id="6f10e-312">Сводка</span><span class="sxs-lookup"><span data-stu-id="6f10e-312">Summary</span></span>

<span data-ttu-id="6f10e-313">Теперь вы успешно развернули и протестировали веб-приложение и общедоступно через Интернет.</span><span class="sxs-lookup"><span data-stu-id="6f10e-313">You have now successfully deployed and tested your web app and it is available publicly over the Internet.</span></span>

![Рабочая страница Home](deploying-to-production/_static/image15.png)

<span data-ttu-id="6f10e-315">В следующем руководстве вы обновите код приложения и развернете изменения в тестовой, промежуточной и рабочей средах.</span><span class="sxs-lookup"><span data-stu-id="6f10e-315">In the next tutorial, you'll update application code and deploy the change to the test, staging, and production environments.</span></span>

> [!NOTE]
> <span data-ttu-id="6f10e-316">Хотя приложение используется в рабочей среде, необходимо реализовать план восстановления.</span><span class="sxs-lookup"><span data-stu-id="6f10e-316">While your application is in use in the production environment you should be implementing a recovery plan.</span></span> <span data-ttu-id="6f10e-317">Это значит, что необходимо периодически выполнять резервное копирование баз данных из рабочего приложения в защищенное место хранения, а также хранить несколько поколений таких резервных копий.</span><span class="sxs-lookup"><span data-stu-id="6f10e-317">That is, you should be periodically backing up your databases from the production app to a secure storage location, and you should be keeping several generations of such backups.</span></span> <span data-ttu-id="6f10e-318">При обновлении базы данных необходимо создать резервную копию непосредственно перед изменением.</span><span class="sxs-lookup"><span data-stu-id="6f10e-318">When you update the database, you should make a backup copy from immediately before the change.</span></span> <span data-ttu-id="6f10e-319">Если вы сделаете ошибку и не обнаружите ее до тех пор, пока вы не развернете ее в рабочую среду, то сможете восстановить базу данных до состояния, в котором она находилась до повреждения.</span><span class="sxs-lookup"><span data-stu-id="6f10e-319">Then, if you make a mistake and don't discover it until after you have deployed it to production, you will still be able to recover the database to the state it was in before it became corrupted.</span></span> <span data-ttu-id="6f10e-320">Дополнительные сведения см. в статье [Резервное копирование и восстановление базы данных SQL Azure](https://msdn.microsoft.com/library/windowsazure/jj650016.aspx).</span><span class="sxs-lookup"><span data-stu-id="6f10e-320">For more information, see [Azure SQL Database Backup and Restore](https://msdn.microsoft.com/library/windowsazure/jj650016.aspx).</span></span>
> 
> 
> [!NOTE]
> <span data-ttu-id="6f10e-321">В этом учебнике SQL Server выпуск, на котором выполняется развертывание, — это база данных SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="6f10e-321">In this tutorial the SQL Server edition that you are deploying to is Azure SQL Database.</span></span> <span data-ttu-id="6f10e-322">Хотя процесс развертывания аналогичен другим выпускам SQL Server, в некоторых сценариях для работы с базой данных SQL Azure может потребоваться специальный код.</span><span class="sxs-lookup"><span data-stu-id="6f10e-322">While the deployment process is similar to other editions of SQL Server, a real production application might require special code for Azure SQL Database in some scenarios.</span></span> <span data-ttu-id="6f10e-323">Дополнительные сведения см. в статьях [Работа с базой данных SQL Azure](../../../../whitepapers/aspnet-data-access-content-map.md#ssdb) и [Выбор между SQL Server и базой данных SQL Azure](../../../../whitepapers/aspnet-data-access-content-map.md#ssdbchoosing).</span><span class="sxs-lookup"><span data-stu-id="6f10e-323">For more information, see [Working with Azure SQL Database](../../../../whitepapers/aspnet-data-access-content-map.md#ssdb) and [Choosing between SQL Server and Azure SQL Database](../../../../whitepapers/aspnet-data-access-content-map.md#ssdbchoosing).</span></span>
> 
> [!div class="step-by-step"]
> <span data-ttu-id="6f10e-324">[Назад](setting-folder-permissions.md)
> [Вперед](deploying-a-code-update.md)</span><span class="sxs-lookup"><span data-stu-id="6f10e-324">[Previous](setting-folder-permissions.md)
[Next](deploying-a-code-update.md)</span></span>
