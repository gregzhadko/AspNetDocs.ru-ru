---
uid: web-forms/overview/security/create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset
title: Создание безопасного приложения веб-форм ASP.NET с регистрацией пользователя, подтверждением электронной почты иC#сбросом пароля () | Документация Майкрософт
author: Erikre
description: В этом руководстве показано, как создать приложение веб-форм ASP.NET с регистрацией пользователя, подтверждением электронной почты и сбросом пароля с помощью члена ASP.NET Identity...
ms.author: riande
ms.date: 10/02/2014
ms.assetid: 0a8d6044-5fab-4213-82d6-5618d5601358
msc.legacyurl: /web-forms/overview/security/create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset
msc.type: authoredcontent
ms.openlocfilehash: af3653bc164810126bc3bf8f1b1794d75642d807
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78507132"
---
# <a name="create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset-c"></a><span data-ttu-id="8fc37-103">Создание безопасного приложения веб-форм ASP.NET с регистрацией пользователей, подтверждением электронной почты и сбросом пароля (C#)</span><span class="sxs-lookup"><span data-stu-id="8fc37-103">Create a secure ASP.NET Web Forms app with user registration, email confirmation and password reset (C#)</span></span>

<span data-ttu-id="8fc37-104">по [Эрик Реитан](https://github.com/Erikre)</span><span class="sxs-lookup"><span data-stu-id="8fc37-104">by [Erik Reitan](https://github.com/Erikre)</span></span>

> <span data-ttu-id="8fc37-105">В этом руководстве показано, как создать приложение веб-форм ASP.NET с регистрацией пользователя, подтверждением электронной почты и сбросом пароля с помощью системы членства ASP.NET Identity.</span><span class="sxs-lookup"><span data-stu-id="8fc37-105">This tutorial shows you how to build an ASP.NET Web Forms app with user registration, email confirmation and password reset using the ASP.NET Identity membership system.</span></span> <span data-ttu-id="8fc37-106">Это руководство основано на [руководстве по MVC](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md)в Рик Андерсон (.</span><span class="sxs-lookup"><span data-stu-id="8fc37-106">This tutorial was based on Rick Anderson's [MVC tutorial](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md).</span></span>

## <a name="introduction"></a><span data-ttu-id="8fc37-107">Введение</span><span class="sxs-lookup"><span data-stu-id="8fc37-107">Introduction</span></span>

<span data-ttu-id="8fc37-108">В этом руководстве описано, как создать приложение веб-форм ASP.NET с помощью Visual Studio и ASP.NET 4,5, чтобы создать защищенное приложение веб-форм с регистрацией пользователей, подтверждением электронной почты и сбросом пароля.</span><span class="sxs-lookup"><span data-stu-id="8fc37-108">This tutorial guides you through the steps required to create an ASP.NET Web Forms application using Visual Studio and ASP.NET 4.5 to create a secure Web Forms app with user registration, email confirmation and password reset.</span></span>

### <a name="tutorial-tasks-and-information"></a><span data-ttu-id="8fc37-109">Задачи и сведения в учебнике:</span><span class="sxs-lookup"><span data-stu-id="8fc37-109">Tutorial Tasks and Information:</span></span>

- [<span data-ttu-id="8fc37-110">Создание приложения веб-форм ASP.NET</span><span class="sxs-lookup"><span data-stu-id="8fc37-110">Create an ASP.NET Web Forms app</span></span>](#createWebForms)
- [<span data-ttu-id="8fc37-111">Подключение SendGrid</span><span class="sxs-lookup"><span data-stu-id="8fc37-111">Hook Up SendGrid</span></span>](#SG)
- [<span data-ttu-id="8fc37-112">Требовать подтверждение по электронной почте перед входом</span><span class="sxs-lookup"><span data-stu-id="8fc37-112">Require Email Confirmation Before Log In</span></span>](#require)
- [<span data-ttu-id="8fc37-113">Восстановление и сброс пароля</span><span class="sxs-lookup"><span data-stu-id="8fc37-113">Password Recovery and Reset</span></span>](#reset)
- [<span data-ttu-id="8fc37-114">Ссылка для подтверждения повторной отправки по электронной почте</span><span class="sxs-lookup"><span data-stu-id="8fc37-114">Resend Email Confirmation Link</span></span>](#rsend)
- [<span data-ttu-id="8fc37-115">Устранение неполадок приложения</span><span class="sxs-lookup"><span data-stu-id="8fc37-115">Troubleshooting the App</span></span>](#dbg)
- [<span data-ttu-id="8fc37-116">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="8fc37-116">Additional Resources</span></span>](#addRes)

<a id="createWebForms"></a>
## <a name="create-an-aspnet-web-forms-app"></a><span data-ttu-id="8fc37-117">Создание приложения веб-форм ASP.NET</span><span class="sxs-lookup"><span data-stu-id="8fc37-117">Create an ASP.NET Web Forms App</span></span>

<span data-ttu-id="8fc37-118">Начните с установки и запуска [Visual Studio Express 2013 для Web](https://go.microsoft.com/fwlink/?LinkId=299058) или [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span><span class="sxs-lookup"><span data-stu-id="8fc37-118">Start by installing and running [Visual Studio Express 2013 for Web](https://go.microsoft.com/fwlink/?LinkId=299058) or [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span></span> <span data-ttu-id="8fc37-119">Установите [Visual Studio 2013 обновление 3](https://go.microsoft.com/fwlink/?LinkId=390465) или более поздней версии.</span><span class="sxs-lookup"><span data-stu-id="8fc37-119">Install [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) or higher as well.</span></span>

> [!NOTE]
> <span data-ttu-id="8fc37-120">Предупреждение. для работы с этим руководством необходимо установить [Visual Studio 2013 обновление 3](https://go.microsoft.com/fwlink/?LinkId=390465) или более поздней версии.</span><span class="sxs-lookup"><span data-stu-id="8fc37-120">Warning: You must install [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) or higher to complete this tutorial.</span></span>

1. <span data-ttu-id="8fc37-121">Создайте новый проект (**файл** -&gt; **Новый проект**) и выберите шаблон **веб-приложение ASP.NET** и последнюю версию .NET Framework в диалоговом окне **Новый проект** .</span><span class="sxs-lookup"><span data-stu-id="8fc37-121">Create a new project (**File** -&gt; **New Project**) and select the **ASP.NET Web Application** template and the latest .NET Framework version from the **New Project** dialog box.</span></span>
2. <span data-ttu-id="8fc37-122">В диалоговом окне **Новый проект ASP.NET** выберите шаблон **веб-формы** .</span><span class="sxs-lookup"><span data-stu-id="8fc37-122">From the **New ASP.NET Project** dialog box, select the **Web Forms** template.</span></span> <span data-ttu-id="8fc37-123">Оставьте проверку подлинности по умолчанию как **учетные записи отдельных пользователей**.</span><span class="sxs-lookup"><span data-stu-id="8fc37-123">Leave the default authentication as **Individual User Accounts**.</span></span> <span data-ttu-id="8fc37-124">Если вы хотите разместить приложение в Azure, оставьте установленным флажок **узел в облаке** .</span><span class="sxs-lookup"><span data-stu-id="8fc37-124">If you'd like to host the app in Azure, leave the **Host in the cloud** check box checked.</span></span>   
 <span data-ttu-id="8fc37-125">Затем нажмите кнопку **ОК** , чтобы создать новый проект.</span><span class="sxs-lookup"><span data-stu-id="8fc37-125">Then, click **OK** to create the new project.</span></span>  
    <span data-ttu-id="8fc37-126">![Диалоговое окно "Новый проект ASP.NET"](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="8fc37-126">![New ASP.NET Project dialog box](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image1.png)</span></span>
3. <span data-ttu-id="8fc37-127">Включите SSL (SSL) для проекта.</span><span class="sxs-lookup"><span data-stu-id="8fc37-127">Enable Secure Sockets Layer (SSL) for the project.</span></span> <span data-ttu-id="8fc37-128">Выполните действия, описанные в разделе **Включение SSL для проекта** статьи [учебник начало работы with Web Forms](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#SSLWebForms).</span><span class="sxs-lookup"><span data-stu-id="8fc37-128">Follow the steps available in the **Enable SSL for the Project** section of the [Getting Started with Web Forms tutorial series](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#SSLWebForms).</span></span>
4. <span data-ttu-id="8fc37-129">Запустите приложение, щелкните ссылку **Register (регистрация** ) и зарегистрируйте нового пользователя.</span><span class="sxs-lookup"><span data-stu-id="8fc37-129">Run the app, click the **Register** link and register a new user.</span></span> <span data-ttu-id="8fc37-130">На этом этапе единственная проверка по электронной почте основана на атрибуте [[EmailAddress]](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) , чтобы убедиться, что адрес электронной почты имеет правильный формат.</span><span class="sxs-lookup"><span data-stu-id="8fc37-130">At this point, the only validation on the email is based on the [[EmailAddress]](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) attribute to ensure the email address is well-formed.</span></span> <span data-ttu-id="8fc37-131">Вы измените код, чтобы добавить подтверждение по электронной почте.</span><span class="sxs-lookup"><span data-stu-id="8fc37-131">You will modify the code to add email confirmation.</span></span> <span data-ttu-id="8fc37-132">Закройте окно браузера.</span><span class="sxs-lookup"><span data-stu-id="8fc37-132">Close the browser window.</span></span>
5. <span data-ttu-id="8fc37-133">В **Обозреватель сервера** Visual Studio (**View** -&gt; **Обозреватель сервера**) перейдите к **коннектионс\дефаултконнектион\таблес\аспнетусерс данных**, щелкните правой кнопкой мыши и выберите **Открыть определение таблицы**.</span><span class="sxs-lookup"><span data-stu-id="8fc37-133">In **Server Explorer** of Visual Studio (**View** -&gt; **Server Explorer**), navigate to **Data Connections\DefaultConnection\Tables\AspNetUsers**, right click and select **Open table definition**.</span></span> 

    <span data-ttu-id="8fc37-134">На следующем рисунке показана схема таблицы `AspNetUsers`:</span><span class="sxs-lookup"><span data-stu-id="8fc37-134">The following image shows the `AspNetUsers` table schema:</span></span>

    ![Схема таблицы AspNetUsers](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image2.png)
6. <span data-ttu-id="8fc37-136">В **Обозреватель сервера**щелкните правой кнопкой мыши таблицу **AspNetUsers** и выберите команду **отобразить данные таблицы**.</span><span class="sxs-lookup"><span data-stu-id="8fc37-136">In **Server Explorer**, right-click on the **AspNetUsers** table and select **Show Table Data**.</span></span>  
  
    ![Данные таблицы AspNetUsers](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image3.png)  
 <span data-ttu-id="8fc37-138">На этом этапе электронная почта зарегистрированного пользователя не подтверждена.</span><span class="sxs-lookup"><span data-stu-id="8fc37-138">At this point the email for the registered user has not been confirmed.</span></span>
7. <span data-ttu-id="8fc37-139">Щелкните строку и выберите Удалить, чтобы удалить пользователя.</span><span class="sxs-lookup"><span data-stu-id="8fc37-139">Click on the row and select delete to delete the user.</span></span> <span data-ttu-id="8fc37-140">Вы снова добавите это сообщение электронной почты на следующем шаге и отправите на адрес электронной почты сообщение с подтверждением.</span><span class="sxs-lookup"><span data-stu-id="8fc37-140">You'll add this email again in the next step and send a confirmation message to the email address.</span></span>

## <a name="email-confirmation"></a><span data-ttu-id="8fc37-141">Подтверждение по электронной почте</span><span class="sxs-lookup"><span data-stu-id="8fc37-141">Email Confirmation</span></span>

<span data-ttu-id="8fc37-142">Рекомендуется подтвердить сообщение электронной почты во время регистрации нового пользователя, чтобы убедиться, что он не олицетворяет кого-то другого (то есть они не зарегистрированы в электронной почте).</span><span class="sxs-lookup"><span data-stu-id="8fc37-142">It's a best practice to confirm the email during the registration of a new user to verify they are not impersonating someone else (that is, they haven't registered with someone else's email).</span></span> <span data-ttu-id="8fc37-143">Предположим, у вас есть дискуссионный форум, и вы хотели бы предотвратить регистрацию `"bob@cpandl.com"` как `"joe@contoso.com"`.</span><span class="sxs-lookup"><span data-stu-id="8fc37-143">Suppose you had a discussion forum, you would want to prevent `"bob@cpandl.com"` from registering as `"joe@contoso.com"`.</span></span> <span data-ttu-id="8fc37-144">Без подтверждения по электронной почте `"joe@contoso.com"` может получить от приложения нежелательную почту.</span><span class="sxs-lookup"><span data-stu-id="8fc37-144">Without email confirmation, `"joe@contoso.com"` could get unwanted email from your app.</span></span> <span data-ttu-id="8fc37-145">Предположим, что Боб случайно зарегистрировался как `"bib@cpandl.com"` и не заметил его, он не сможет использовать восстановление пароля, так как у приложения нет нужной электронной почты.</span><span class="sxs-lookup"><span data-stu-id="8fc37-145">Suppose Bob accidentally registered as `"bib@cpandl.com"` and hadn't noticed it, he wouldn't be able to use password recovery because the app doesn't have his correct email.</span></span> <span data-ttu-id="8fc37-146">Подтверждение электронной почты обеспечивает только ограниченную защиту от программы-роботы и не обеспечивает защиту от определенных отправителей.</span><span class="sxs-lookup"><span data-stu-id="8fc37-146">Email confirmation provides only limited protection from bots and doesn't provide protection from determined spammers.</span></span>

<span data-ttu-id="8fc37-147">Обычно требуется запретить новым пользователям отправлять данные на веб-сайт, прежде чем они будут подтверждены электронной почтой, SMS-сообщением или другим механизмом.</span><span class="sxs-lookup"><span data-stu-id="8fc37-147">You generally want to prevent new users from posting any data to your website before they have been confirmed by either email, an SMS text message or another mechanism.</span></span> <span data-ttu-id="8fc37-148">В следующих разделах мы допустили подтверждение по электронной почте и изменим код, чтобы предотвратить вход новых зарегистрированных пользователей до подтверждения их электронной почты.</span><span class="sxs-lookup"><span data-stu-id="8fc37-148">In the sections below, we will enable email confirmation and modify the code to prevent newly registered users from logging in until their email has been confirmed.</span></span> <span data-ttu-id="8fc37-149">В этом руководстве вы будете использовать службу электронной почты SendGrid.</span><span class="sxs-lookup"><span data-stu-id="8fc37-149">You'll use the email service SendGrid in this tutorial.</span></span>

<a id="SG"></a>
## <a name="hook-up-sendgrid"></a><span data-ttu-id="8fc37-150">Подключение SendGrid</span><span class="sxs-lookup"><span data-stu-id="8fc37-150">Hook up SendGrid</span></span>

<span data-ttu-id="8fc37-151">SendGrid изменил API, так как этот учебник написан.</span><span class="sxs-lookup"><span data-stu-id="8fc37-151">SendGrid has changed it's API since this tutorial was written.</span></span> <span data-ttu-id="8fc37-152">Текущие инструкции SendGrid см. в разделе [SendGrid](http://sendgrid.com/) или [Включение подтверждения учетной записи и восстановление пароля](xref:security/authentication/accconfirm#enable-account-confirmation-and-password-recovery).</span><span class="sxs-lookup"><span data-stu-id="8fc37-152">For current SendGrid instructions, see [SendGrid](http://sendgrid.com/) or [Enable account confirmation and password recovery](xref:security/authentication/accconfirm#enable-account-confirmation-and-password-recovery).</span></span>

<span data-ttu-id="8fc37-153">Хотя в этом учебнике показано, как добавлять уведомления по электронной почте через [SendGrid](http://sendgrid.com/), можно отправлять электронную почту с помощью SMTP и других механизмов (см. [Дополнительные ресурсы](#addRes)).</span><span class="sxs-lookup"><span data-stu-id="8fc37-153">Although this tutorial only shows how to add email notification through [SendGrid](http://sendgrid.com/), you can send email using SMTP and other mechanisms (see [additional resources](#addRes)).</span></span>

1. <span data-ttu-id="8fc37-154">В Visual Studio откройте **консоль диспетчера пакетов** (**средства** -&gt; диспетчер **пакетов NuGet** -&gt; **консоли диспетчера пакетов**) и введите следующую команду:</span><span class="sxs-lookup"><span data-stu-id="8fc37-154">In Visual Studio, open the **Package Manager Console** (**Tools** -&gt; **NuGet Package Manger** -&gt; **Package Manager Console**), and enter the following command:</span></span>  
    `Install-Package SendGrid`
2. <span data-ttu-id="8fc37-155">Перейдите на [страницу регистрации Azure SendGrid](https://azure.microsoft.com/gallery/store/sendgrid/sendgrid-azure/) и зарегистрируйтесь для бесплатной учетной записи SendGrid.</span><span class="sxs-lookup"><span data-stu-id="8fc37-155">Go to the [Azure SendGrid sign-up page](https://azure.microsoft.com/gallery/store/sendgrid/sendgrid-azure/) and register for free SendGrid account.</span></span> <span data-ttu-id="8fc37-156">Вы также можете зарегистрироваться для бесплатной учетной записи SendGrid непосредственно на [сайте SendGrid](http://www.sendgrid.com).</span><span class="sxs-lookup"><span data-stu-id="8fc37-156">You can also sign-up for a free SendGrid account directly on [SendGrid's site](http://www.sendgrid.com).</span></span>
3. <span data-ttu-id="8fc37-157">В **Обозреватель решений** откройте файл *IdentityConfig.CS* в папке *app\_Start* и добавьте следующий код, выделенный желтым цветом в класс `EmailService` для настройки **SendGrid**:</span><span class="sxs-lookup"><span data-stu-id="8fc37-157">From **Solution Explorer** open the *IdentityConfig.cs* file in the *App\_Start* folder and add the following code highlighted in yellow to the `EmailService` class to configure **SendGrid**:</span></span>

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample1.cs?highlight=3,5,8-37)]
4. <span data-ttu-id="8fc37-158">Кроме того, добавьте следующие `using` операторы в начало файла *IdentityConfig.CS* :</span><span class="sxs-lookup"><span data-stu-id="8fc37-158">Also, add the following `using` statements to the beginning of the *IdentityConfig.cs* file:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample2.cs?highlight=1-4)]
5. <span data-ttu-id="8fc37-159">Чтобы не усложнять этот пример, вы храните значения учетной записи службы электронной почты в разделе `appSettings` файла *Web. config* .</span><span class="sxs-lookup"><span data-stu-id="8fc37-159">To keep this sample simple, you'll store the email service account values in the `appSettings` section of the *web.config* file.</span></span> <span data-ttu-id="8fc37-160">Добавьте следующий код XML, выделенный желтым цветом, в файл *Web. config* в корне проекта:</span><span class="sxs-lookup"><span data-stu-id="8fc37-160">Add the following XML highlighted in yellow to the *web.config* file at the root of your project:</span></span>

    [!code-xml[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample3.xml?highlight=2-5)]

    > [!WARNING]
    > <span data-ttu-id="8fc37-161">Безопасность — никогда не храните конфиденциальные данные в исходном коде.</span><span class="sxs-lookup"><span data-stu-id="8fc37-161">Security - Never store sensitive data in your source code.</span></span> <span data-ttu-id="8fc37-162">В этом примере учетная запись и учетные данные хранятся в разделе **appSetting** файла *Web. config* .</span><span class="sxs-lookup"><span data-stu-id="8fc37-162">In this example, the account and credentials are stored in the **appSetting** section of the *Web.config* file.</span></span> <span data-ttu-id="8fc37-163">В Azure эти значения можно безопасно сохранить на вкладке **[Настройка](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)** в портал Azure.</span><span class="sxs-lookup"><span data-stu-id="8fc37-163">On Azure, you can securely store these values on the **[Configure](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)** tab in the Azure portal.</span></span> <span data-ttu-id="8fc37-164">Дополнительные сведения см. в разделе Рик Андерсон (, озаглавленном рекомендации [по развертыванию паролей и других конфиденциальных данных в ASP.NET и Azure](https://go.microsoft.com/fwlink/?LinkId=513141).</span><span class="sxs-lookup"><span data-stu-id="8fc37-164">For related information see Rick Anderson's topic titled [Best practices for deploying passwords and other sensitive data to ASP.NET and Azure](https://go.microsoft.com/fwlink/?LinkId=513141).</span></span>
6. <span data-ttu-id="8fc37-165">Добавьте значения службы электронной почты, чтобы они отражали значения проверки подлинности SendGrid (имя пользователя и пароль), чтобы можно было успешно отправлять электронную почту из приложения.</span><span class="sxs-lookup"><span data-stu-id="8fc37-165">Add the email service values to reflect your SendGrid authentication values (User Name and Password) so that you can successful send email from your app.</span></span> <span data-ttu-id="8fc37-166">Не забудьте использовать имя учетной записи SendGrid, а не адрес электронной почты, предоставленный SendGrid.</span><span class="sxs-lookup"><span data-stu-id="8fc37-166">Be sure to use your SendGrid account name rather than the email address you provided SendGrid.</span></span>

### <a name="enable-email-confirmation"></a><span data-ttu-id="8fc37-167">Включить подтверждение электронной почты</span><span class="sxs-lookup"><span data-stu-id="8fc37-167">Enable Email Confirmation</span></span>

 <span data-ttu-id="8fc37-168">Чтобы включить подтверждение по электронной почте, измените регистрационный код, выполнив следующие действия.</span><span class="sxs-lookup"><span data-stu-id="8fc37-168">To enable email confirmation, you'll modify the registration code using the following steps.</span></span>  

1. <span data-ttu-id="8fc37-169">В папке *Account* Откройте код программной части *Register.aspx.CS* и обновите метод `CreateUser_Click`, чтобы включить следующие выделенные изменения:</span><span class="sxs-lookup"><span data-stu-id="8fc37-169">In the *Account* folder, open the *Register.aspx.cs* code-behind and update the `CreateUser_Click` method to enable the following highlighted changes:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample4.cs?highlight=9-11)]
2. <span data-ttu-id="8fc37-170">В **Обозреватель решений**щелкните правой кнопкой мыши *Default. aspx* и выберите **задать в качестве начальной страницы**.</span><span class="sxs-lookup"><span data-stu-id="8fc37-170">In **Solution Explorer**, right-click *Default.aspx* and select **Set As Start Page**.</span></span>
3. <span data-ttu-id="8fc37-171">Запустите приложение, нажав клавишу **F5.**</span><span class="sxs-lookup"><span data-stu-id="8fc37-171">Run the app by pressing **F5.**</span></span> <span data-ttu-id="8fc37-172">После отображения страницы щелкните ссылку **Регистрация** , чтобы отобразить страницу Регистрация.</span><span class="sxs-lookup"><span data-stu-id="8fc37-172">After the page is displayed, click the **Register** link to display the Register page.</span></span>
4. <span data-ttu-id="8fc37-173">Введите свой адрес электронной почты и пароль, а затем нажмите кнопку **Register (зарегистрировать** ), чтобы отправить сообщение электронной почты через SendGrid.</span><span class="sxs-lookup"><span data-stu-id="8fc37-173">Enter your email and password, then click the **Register** button to send an email message via SendGrid.</span></span>  
   <span data-ttu-id="8fc37-174">Текущее состояние проекта и кода позволит пользователю выполнить вход после заполнения регистрационной формы, даже если они не подтвердили свою учетную запись.</span><span class="sxs-lookup"><span data-stu-id="8fc37-174">The current state of your project and code will allow the user to log in once they complete the registration form, even though they haven't confirmed their account.</span></span>
5. <span data-ttu-id="8fc37-175">Проверьте учетную запись электронной почты и щелкните ссылку, чтобы подтвердить свою электронную почту.</span><span class="sxs-lookup"><span data-stu-id="8fc37-175">Check your email account and click on the link to confirm your email.</span></span>  
   <span data-ttu-id="8fc37-176">После отправки регистрационной формы вы войдете в систему.</span><span class="sxs-lookup"><span data-stu-id="8fc37-176">Once you submit the registration form, you will be logged in.</span></span>  
    ![Пример веб-сайта — вход выполнен](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image4.png)

<a id="require"></a>
## <a name="require-email-confirmation-before-log-in"></a><span data-ttu-id="8fc37-178">Требовать подтверждение по электронной почте перед входом</span><span class="sxs-lookup"><span data-stu-id="8fc37-178">Require Email Confirmation Before Log In</span></span>

<span data-ttu-id="8fc37-179">Хотя вы подтвердили учетную запись электронной почты, на этом этапе вам не нужно щелкать ссылку, содержащуюся в электронном письме с подтверждением, для полного входа.</span><span class="sxs-lookup"><span data-stu-id="8fc37-179">Although you have confirmed the email account, at this point you would not need to click on the link contained in the verification email to be fully signed-in.</span></span> <span data-ttu-id="8fc37-180">В следующем разделе вы измените код, требующий, чтобы новые пользователи имели подтвержденное сообщение электронной почты, прежде чем они будут входить в систему (с проверкой подлинности).</span><span class="sxs-lookup"><span data-stu-id="8fc37-180">In the following section, you will modify the code requiring new users to have a confirmed email before they are logged in (authenticated).</span></span>

1. <span data-ttu-id="8fc37-181">В **Обозреватель решений** Visual Studio обновите событие `CreateUser_Click` в коде программной части *Register.aspx.CS* , который содержится в папке *Accounts* со следующими выделенными изменениями:</span><span class="sxs-lookup"><span data-stu-id="8fc37-181">In **Solution Explorer** of Visual Studio, update the `CreateUser_Click` event in the *Register.aspx.cs* code-behind contained in the *Accounts* folder with the following highlighted changes:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample5.cs?highlight=13-14,17-21)]
2. <span data-ttu-id="8fc37-182">Обновите метод `LogIn` *в коде программной части,* выделив следующие изменения:</span><span class="sxs-lookup"><span data-stu-id="8fc37-182">Update the `LogIn` method in the *Login.aspx.cs* code-behind with the following highlighted changes:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample6.cs?highlight=9-19,45-46)]

### <a name="run-the-application"></a><span data-ttu-id="8fc37-183">Запуск приложения</span><span class="sxs-lookup"><span data-stu-id="8fc37-183">Run the Application</span></span>

 <span data-ttu-id="8fc37-184">Теперь, когда вы реализовали код для проверки того, подтвержден ли адрес электронной почты пользователя, можно проверить функциональность на страницах **Регистрация** и **Вход** в систему.</span><span class="sxs-lookup"><span data-stu-id="8fc37-184">Now that you have implemented the code to check whether a user's email address has been confirmed, you can check the functionality on both the **Register** and **Login** pages.</span></span> 

1. <span data-ttu-id="8fc37-185">Удалите все учетные записи в таблице **AspNetUsers** , содержащие псевдоним электронной почты, который нужно протестировать.</span><span class="sxs-lookup"><span data-stu-id="8fc37-185">Delete any accounts in the **AspNetUsers** table that contain the email alias you wish to test.</span></span>
2. <span data-ttu-id="8fc37-186">Запустите приложение (**F5**) и убедитесь, что вы не можете зарегистрироваться в качестве пользователя, пока не подтвердите свой адрес электронной почты.</span><span class="sxs-lookup"><span data-stu-id="8fc37-186">Run the app (**F5**) and verify you cannot register as a user until you have confirmed your email address.</span></span>
3. <span data-ttu-id="8fc37-187">Перед подтверждением новой учетной записи через отправленное сообщение электронной почты попытайтесь войти в систему с помощью новой учетной записи.</span><span class="sxs-lookup"><span data-stu-id="8fc37-187">Before confirming your new account via the email that was just sent, attempt to log in with the new account.</span></span>  
 <span data-ttu-id="8fc37-188">Вы увидите, что вы не можете войти в систему и у вас должна быть подтвержденная учетная запись электронной почты.</span><span class="sxs-lookup"><span data-stu-id="8fc37-188">You'll see that you are unable to log in and that you must have a confirmed email account.</span></span>
4. <span data-ttu-id="8fc37-189">После подтверждения адреса электронной почты войдите в приложение.</span><span class="sxs-lookup"><span data-stu-id="8fc37-189">Once you confirm your email address, log in to the app.</span></span>

<a id="reset"></a>
## <a name="password-recovery-and-reset"></a><span data-ttu-id="8fc37-190">Восстановление и сброс пароля</span><span class="sxs-lookup"><span data-stu-id="8fc37-190">Password Recovery and Reset</span></span>

1. <span data-ttu-id="8fc37-191">В Visual Studio удалите символы комментариев из метода `Forgot` в коде программной части *Forgot.aspx.CS* , который содержится в папке *Account* , чтобы метод был представлен следующим образом:</span><span class="sxs-lookup"><span data-stu-id="8fc37-191">In Visual Studio, remove the comment characters from the `Forgot` method in the *Forgot.aspx.cs* code-behind contained in the *Account* folder, so that the method appears as follows:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample7.cs?highlight=16-18)]
2. <span data-ttu-id="8fc37-192">Откройте страницу *Login. aspx* .</span><span class="sxs-lookup"><span data-stu-id="8fc37-192">Open the *Login.aspx* page.</span></span> <span data-ttu-id="8fc37-193">Замените разметку рядом с концом раздела **loginForm** , как показано ниже:</span><span class="sxs-lookup"><span data-stu-id="8fc37-193">Replace the markup near the end of the **loginForm** section as highlighted below:</span></span> 

    [!code-aspx[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample8.aspx?highlight=52-53)]
3. <span data-ttu-id="8fc37-194">Откройте код программной части *Login.aspx.CS* и раскомментируйте следующую строку кода, выделенную желтым цветом, из обработчика событий `Page_Load`:</span><span class="sxs-lookup"><span data-stu-id="8fc37-194">Open the *Login.aspx.cs* code-behind and uncomment the following line of code highlighted in yellow from the `Page_Load` event handler:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample9.cs?highlight=5)]
4. <span data-ttu-id="8fc37-195">Запустите приложение, нажав клавишу **F5.**</span><span class="sxs-lookup"><span data-stu-id="8fc37-195">Run the app by pressing **F5.**</span></span> <span data-ttu-id="8fc37-196">После отображения страницы щелкните ссылку **Вход** .</span><span class="sxs-lookup"><span data-stu-id="8fc37-196">After the page is displayed, click the **Log in** link.</span></span>
5. <span data-ttu-id="8fc37-197">Щелкните ссылку **забыли пароль?** , чтобы отобразить страницу **забытый пароль** .</span><span class="sxs-lookup"><span data-stu-id="8fc37-197">Click the **Forgot your password?** link to display the **Forgot Password** page.</span></span>
6. <span data-ttu-id="8fc37-198">Введите свой адрес электронной почты и нажмите кнопку " **Отправить** ", чтобы отправить сообщение электронной почты на ваш адрес, что позволит сбросить пароль.</span><span class="sxs-lookup"><span data-stu-id="8fc37-198">Enter your email address and click the **Submit** button to send an email to your address which will allow you to reset your password.</span></span>   
   <span data-ttu-id="8fc37-199">Проверьте учетную запись электронной почты и щелкните ссылку, чтобы отобразить страницу **сброса пароля** .</span><span class="sxs-lookup"><span data-stu-id="8fc37-199">Check your email account and click on the link to display the **Reset Password** page.</span></span>
7. <span data-ttu-id="8fc37-200">На странице **Сброс пароля** введите адрес электронной почты, пароль и подтверждение пароля.</span><span class="sxs-lookup"><span data-stu-id="8fc37-200">On the **Reset Password** page, enter your email, password, and confirmed password.</span></span> <span data-ttu-id="8fc37-201">Затем нажмите кнопку **Reset (Сброс** ).</span><span class="sxs-lookup"><span data-stu-id="8fc37-201">Then, press the **Reset** button.</span></span>  
   <span data-ttu-id="8fc37-202">При успешном сбросе пароля будет отображаться страница **изменения пароля** .</span><span class="sxs-lookup"><span data-stu-id="8fc37-202">When you successfully reset your password, the **Password Changed** page will be displayed.</span></span> <span data-ttu-id="8fc37-203">Теперь вы можете войти в систему, используя новый пароль.</span><span class="sxs-lookup"><span data-stu-id="8fc37-203">Now you can log in with your new password.</span></span>

<a id="rsend"></a>
## <a name="resend-email-confirmation-link"></a><span data-ttu-id="8fc37-204">Ссылка для подтверждения повторной отправки по электронной почте</span><span class="sxs-lookup"><span data-stu-id="8fc37-204">Resend Email Confirmation Link</span></span>

<span data-ttu-id="8fc37-205">После того как пользователь создает новую локальную учетную запись, он отправляет по электронной почте ссылку на подтверждение, которую необходимо использовать, прежде чем они смогут войти в систему.</span><span class="sxs-lookup"><span data-stu-id="8fc37-205">Once a user creates a new local account, they are emailed a confirmation link they are required to use before they can log on.</span></span> <span data-ttu-id="8fc37-206">Если пользователь случайно удалил сообщение электронной почты с подтверждением или сообщение не будет доставлено, ему потребуется снова отправить ссылку на подтверждение.</span><span class="sxs-lookup"><span data-stu-id="8fc37-206">If the user accidentally deletes the confirmation email, or the email never arrives, they will need the confirmation link sent again.</span></span> <span data-ttu-id="8fc37-207">В следующем примере кода показано, как это сделать.</span><span class="sxs-lookup"><span data-stu-id="8fc37-207">The following code changes show how to enable this.</span></span>

1. <span data-ttu-id="8fc37-208">В Visual Studio откройте код программной части **Login.aspx.CS** и добавьте следующий обработчик событий после обработчика событий `LogIn`:</span><span class="sxs-lookup"><span data-stu-id="8fc37-208">In Visual Studio, open the **Login.aspx.cs** code-behind and add the following event handler after the `LogIn` event handler:</span></span>   

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample10.cs)]
2. <span data-ttu-id="8fc37-209">Измените обработчик событий `LogIn` в коде программной части *Login.aspx.CS* , изменив код, выделенный желтым цветом, следующим образом:</span><span class="sxs-lookup"><span data-stu-id="8fc37-209">Modify the `LogIn` event handler in the *Login.aspx.cs* code-behind by changing the code highlighted in yellow as follows:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample11.cs?highlight=15-17)]
3. <span data-ttu-id="8fc37-210">Обновите страницу *Login. aspx* , добавив код, выделенный желтым цветом, следующим образом:</span><span class="sxs-lookup"><span data-stu-id="8fc37-210">Update the *Login.aspx* page by adding the code highlighted in yellow as follows:</span></span> 

    [!code-aspx[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample12.aspx?highlight=45-46)]
4. <span data-ttu-id="8fc37-211">Удалите все учетные записи в таблице **AspNetUsers** , содержащие псевдоним электронной почты, который нужно протестировать.</span><span class="sxs-lookup"><span data-stu-id="8fc37-211">Delete any accounts in the **AspNetUsers** table that contain the email alias you wish to test.</span></span>
5. <span data-ttu-id="8fc37-212">Запустите приложение (**F5**) и зарегистрируйте свой адрес электронной почты.</span><span class="sxs-lookup"><span data-stu-id="8fc37-212">Run the app (**F5**) and register your email address.</span></span>
6. <span data-ttu-id="8fc37-213">Перед подтверждением новой учетной записи через отправленное сообщение электронной почты попытайтесь войти в систему с помощью новой учетной записи.</span><span class="sxs-lookup"><span data-stu-id="8fc37-213">Before confirming your new account via the email that was just sent, attempt to log in with the new account.</span></span>  
   <span data-ttu-id="8fc37-214">Вы увидите, что вы не можете войти в систему и у вас должна быть подтвержденная учетная запись электронной почты.</span><span class="sxs-lookup"><span data-stu-id="8fc37-214">You'll see that you are unable to log in and that you must have a confirmed email account.</span></span> <span data-ttu-id="8fc37-215">Кроме того, теперь можно повторно отправить сообщение с подтверждением в учетную запись электронной почты.</span><span class="sxs-lookup"><span data-stu-id="8fc37-215">In addition, you can now resend a confirmation message to your email account.</span></span>
7. <span data-ttu-id="8fc37-216">Введите свой адрес электронной почты и пароль, а затем нажмите кнопку **повторно отправить подтверждение** .</span><span class="sxs-lookup"><span data-stu-id="8fc37-216">Enter your email address and password, then press the **Resend confirmation** button.</span></span>
8. <span data-ttu-id="8fc37-217">После подтверждения адреса электронной почты на основе недавно отправленного сообщения электронной почты войдите в приложение.</span><span class="sxs-lookup"><span data-stu-id="8fc37-217">Once you confirm your email address based on the newly sent email message, log in to the app.</span></span>

<a id="dbg"></a>
## <a name="troubleshooting-the-app"></a><span data-ttu-id="8fc37-218">Устранение неполадок приложения</span><span class="sxs-lookup"><span data-stu-id="8fc37-218">Troubleshooting the App</span></span>

<span data-ttu-id="8fc37-219">Если вы не получаете электронное сообщение со ссылкой для проверки учетных данных:</span><span class="sxs-lookup"><span data-stu-id="8fc37-219">If you don't receive an email containing the link to verify your credentials:</span></span>

- <span data-ttu-id="8fc37-220">Проверьте папку нежелательной почты или спама.</span><span class="sxs-lookup"><span data-stu-id="8fc37-220">Check your junk or spam folder.</span></span>
- <span data-ttu-id="8fc37-221">Войдите в учетную запись SendGrid и щелкните [ссылку действие электронной почты](https://sendgrid.com/logs/index).</span><span class="sxs-lookup"><span data-stu-id="8fc37-221">Log into your SendGrid account and click on the [Email Activity link](https://sendgrid.com/logs/index).</span></span>
- <span data-ttu-id="8fc37-222">Убедитесь, что вы использовали имя учетной записи пользователя SendGrid в качестве значения *Web. config* , а не адреса электронной почты вашей учетной записи SendGrid.</span><span class="sxs-lookup"><span data-stu-id="8fc37-222">Be certain you used your SendGrid user account name as a *Web.config* value rather than your SendGrid account email address.</span></span>

<a id="addRes"></a>
## <a name="additional-resources"></a><span data-ttu-id="8fc37-223">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="8fc37-223">Additional Resources</span></span>

- [<span data-ttu-id="8fc37-224">Ссылки на ASP.NET Identity Рекомендуемые ресурсы</span><span class="sxs-lookup"><span data-stu-id="8fc37-224">Links to ASP.NET Identity Recommended Resources</span></span>](../../../identity/overview/getting-started/aspnet-identity-recommended-resources.md)
- [<span data-ttu-id="8fc37-225">Подтверждение учетной записи и восстановление пароля с ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="8fc37-225">Account Confirmation and Password Recovery with ASP.NET Identity</span></span>](../../../identity/overview/features-api/account-confirmation-and-password-recovery-with-aspnet-identity.md)
- [<span data-ttu-id="8fc37-226">Серия руководств по веб-формам ASP.NET. Добавление поставщика OAuth 2,0</span><span class="sxs-lookup"><span data-stu-id="8fc37-226">ASP.NET Web Forms tutorial series - Add an OAuth 2.0 Provider</span></span>](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#OAuthWebForms)
- [<span data-ttu-id="8fc37-227">Развертывание безопасного приложения веб-форм ASP.NET с членством, OAuth и базой данных SQL в службе приложений Azure</span><span class="sxs-lookup"><span data-stu-id="8fc37-227">Deploy a Secure ASP.NET Web Forms App with Membership, OAuth, and SQL Database to Azure App Service</span></span>](https://azure.microsoft.com/documentation/articles/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/)
- [<span data-ttu-id="8fc37-228">Серия руководств по веб-формам ASP.NET. Включение SSL для проекта</span><span class="sxs-lookup"><span data-stu-id="8fc37-228">ASP.NET Web Forms tutorial series - Enable SSL for the Project</span></span>](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#SSLWebForms)
