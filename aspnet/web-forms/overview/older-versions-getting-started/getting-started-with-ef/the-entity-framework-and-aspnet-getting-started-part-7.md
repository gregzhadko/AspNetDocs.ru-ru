---
uid: web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-7
title: Начало работы с Entity Framework 4.0 Database First и ASP.NET 4 Web Forms - часть 7 | Документация Майкрософт
author: tdykstra
description: Пример веб-приложение университета Contoso демонстрирует создание приложений веб-форм ASP.NET, с помощью Entity Framework. Пример приложения является...
ms.author: riande
ms.date: 12/03/2010
ms.assetid: f8afb245-b705-419c-8790-0b295e90d5e2
msc.legacyurl: /web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-7
msc.type: authoredcontent
ms.openlocfilehash: b976e8d611596f2cb58661a2e91b7a640ac04b9f
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59416081"
---
# <a name="getting-started-with-entity-framework-40-database-first-and-aspnet-4-web-forms---part-7"></a><span data-ttu-id="b83d6-104">Начало работы с Entity Framework 4.0 Database First и ASP.NET 4 Web Forms - часть 7</span><span class="sxs-lookup"><span data-stu-id="b83d6-104">Getting Started with Entity Framework 4.0 Database First and ASP.NET 4 Web Forms - Part 7</span></span>

<span data-ttu-id="b83d6-105">по [том Дайкстра](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="b83d6-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="b83d6-106">Пример веб-приложение университета Contoso демонстрирует создание приложения веб-форм ASP.NET, используя Entity Framework 4.0 и Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="b83d6-106">The Contoso University sample web application demonstrates how to create ASP.NET Web Forms applications using the Entity Framework 4.0 and Visual Studio 2010.</span></span> <span data-ttu-id="b83d6-107">Сведения об этой серии руководств см. в разделе [в первом учебнике серии](the-entity-framework-and-aspnet-getting-started-part-1.md)</span><span class="sxs-lookup"><span data-stu-id="b83d6-107">For information about the tutorial series, see [the first tutorial in the series](the-entity-framework-and-aspnet-getting-started-part-1.md)</span></span>


## <a name="using-stored-procedures"></a><span data-ttu-id="b83d6-108">Использование хранимых процедур</span><span class="sxs-lookup"><span data-stu-id="b83d6-108">Using Stored Procedures</span></span>

<span data-ttu-id="b83d6-109">В предыдущем учебнике было реализовано шаблон таблица на иерархию наследования.</span><span class="sxs-lookup"><span data-stu-id="b83d6-109">In the previous tutorial you implemented a table-per-hierarchy inheritance pattern.</span></span> <span data-ttu-id="b83d6-110">Этом учебнике показано, как использовать хранимые процедуры для получения большего контроля над доступа к базе данных.</span><span class="sxs-lookup"><span data-stu-id="b83d6-110">This tutorial will show you how to use stored procedures to gain more control over database access.</span></span>

<span data-ttu-id="b83d6-111">Платформа Entity Framework позволяет указать, следует использовать хранимые процедуры для доступа к базе данных.</span><span class="sxs-lookup"><span data-stu-id="b83d6-111">The Entity Framework lets you specify that it should use stored procedures for database access.</span></span> <span data-ttu-id="b83d6-112">Для любого типа сущности можно указать хранимую процедуру для создания, обновления или удаления сущностей этого типа.</span><span class="sxs-lookup"><span data-stu-id="b83d6-112">For any entity type, you can specify a stored procedure to use for creating, updating, or deleting entities of that type.</span></span> <span data-ttu-id="b83d6-113">Затем в модели данных можно добавить ссылки на хранимые процедуры, которые можно использовать для выполнения задач, таких как извлечение наборов сущностей.</span><span class="sxs-lookup"><span data-stu-id="b83d6-113">Then in the data model you can add references to stored procedures that you can use to perform tasks such as retrieving sets of entities.</span></span>

<span data-ttu-id="b83d6-114">Использование хранимых процедур является общим требованием для доступа к базе данных.</span><span class="sxs-lookup"><span data-stu-id="b83d6-114">Using stored procedures is a common requirement for database access.</span></span> <span data-ttu-id="b83d6-115">В некоторых случаях администратор базы данных может потребоваться, что все доступа к базе данных проходят через хранимые процедуры, по соображениям безопасности.</span><span class="sxs-lookup"><span data-stu-id="b83d6-115">In some cases a database administrator may require that all database access go through stored procedures for security reasons.</span></span> <span data-ttu-id="b83d6-116">В других случаях может потребоваться создать бизнес-логики в некоторые процессы Entity Framework, используемых при обновлении базы данных.</span><span class="sxs-lookup"><span data-stu-id="b83d6-116">In other cases you may want to build business logic into some of the processes that the Entity Framework uses when it updates the database.</span></span> <span data-ttu-id="b83d6-117">Например при каждом удалении сущности можно скопировать его в базу данных архива.</span><span class="sxs-lookup"><span data-stu-id="b83d6-117">For example, whenever an entity is deleted you might want to copy it to an archive database.</span></span> <span data-ttu-id="b83d6-118">Или всякий раз, когда строка обновляется для записи строки в таблицу журнала, записываемых, выполнившей изменение.</span><span class="sxs-lookup"><span data-stu-id="b83d6-118">Or whenever a row is updated you might want to write a row to a logging table that records who made the change.</span></span> <span data-ttu-id="b83d6-119">Такого рода задач можно выполнять в хранимую процедуру, которая вызывается каждый раз, когда Entity Framework удаляет сущность или обновляет сущность.</span><span class="sxs-lookup"><span data-stu-id="b83d6-119">You can perform these kinds of tasks in a stored procedure that's called whenever the Entity Framework deletes an entity or updates an entity.</span></span>

<span data-ttu-id="b83d6-120">Как и в предыдущем руководстве вы не создадите новые страницы.</span><span class="sxs-lookup"><span data-stu-id="b83d6-120">As in the previous tutorial, you'll not create any new pages.</span></span> <span data-ttu-id="b83d6-121">Вместо этого вам предстоит изменить способ, Entity Framework обращается к базе данных для некоторых страниц, вы уже создали.</span><span class="sxs-lookup"><span data-stu-id="b83d6-121">Instead, you'll change the way the Entity Framework accesses the database for some of the pages you already created.</span></span>

<span data-ttu-id="b83d6-122">В этом руководстве вы создадите хранимых процедур в базе данных для вставки `Student` и `Instructor` сущностей.</span><span class="sxs-lookup"><span data-stu-id="b83d6-122">In this tutorial you'll create stored procedures in the database for inserting `Student` and `Instructor` entities.</span></span> <span data-ttu-id="b83d6-123">Вы добавите их в модель данных, и потребуется указать, что платформа Entity Framework следует использовать их для добавления `Student` и `Instructor` сущностей в базу данных.</span><span class="sxs-lookup"><span data-stu-id="b83d6-123">You'll add them to the data model, and you'll specify that the Entity Framework should use them for adding `Student` and `Instructor` entities to the database.</span></span> <span data-ttu-id="b83d6-124">Вы также создадите хранимую процедуру, которая используется для извлечения `Course` сущностей.</span><span class="sxs-lookup"><span data-stu-id="b83d6-124">You'll also create a stored procedure that you can use to retrieve `Course` entities.</span></span>

## <a name="creating-stored-procedures-in-the-database"></a><span data-ttu-id="b83d6-125">Создание хранимых процедур в базе данных</span><span class="sxs-lookup"><span data-stu-id="b83d6-125">Creating Stored Procedures in the Database</span></span>

<span data-ttu-id="b83d6-126">(Если вы используете *файл School.mdf* файл из проекта, можно загрузить с этим руководством, можно пропустить этот раздел, поскольку уже существуют хранимые процедуры.)</span><span class="sxs-lookup"><span data-stu-id="b83d6-126">(If you're using the *School.mdf* file from the project available for download with this tutorial, you can skip this section because the stored procedures already exist.)</span></span>

<span data-ttu-id="b83d6-127">В **обозревателя серверов**, разверните *файл School.mdf*, щелкните правой кнопкой мыши **хранимые процедуры**и выберите **добавить новую хранимую процедуру**.</span><span class="sxs-lookup"><span data-stu-id="b83d6-127">In **Server Explorer**, expand *School.mdf*, right-click **Stored Procedures**, and select **Add New Stored Procedure**.</span></span>

<span data-ttu-id="b83d6-128">[![Image15](the-entity-framework-and-aspnet-getting-started-part-7/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="b83d6-128">[![image15](the-entity-framework-and-aspnet-getting-started-part-7/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image1.png)</span></span>

<span data-ttu-id="b83d6-129">Скопируйте следующие инструкции SQL и вставьте их в окно хранимой процедуры, заменив скелет хранимой процедуры.</span><span class="sxs-lookup"><span data-stu-id="b83d6-129">Copy the following SQL statements and paste them into the stored procedure window, replacing the skeleton stored procedure.</span></span>

[!code-sql[Main](the-entity-framework-and-aspnet-getting-started-part-7/samples/sample1.sql)]

<span data-ttu-id="b83d6-130">[![Image14](the-entity-framework-and-aspnet-getting-started-part-7/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="b83d6-130">[![image14](the-entity-framework-and-aspnet-getting-started-part-7/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image3.png)</span></span>

<span data-ttu-id="b83d6-131">`Student` сущности имеют четыре свойства: `PersonID`, `LastName`, `FirstName`, и `EnrollmentDate`.</span><span class="sxs-lookup"><span data-stu-id="b83d6-131">`Student` entities have four properties: `PersonID`, `LastName`, `FirstName`, and `EnrollmentDate`.</span></span> <span data-ttu-id="b83d6-132">База данных автоматически создает значение идентификатора, а хранимая процедура принимает параметры для других трех.</span><span class="sxs-lookup"><span data-stu-id="b83d6-132">The database generates the ID value automatically, and the stored procedure accepts parameters for the other three.</span></span> <span data-ttu-id="b83d6-133">Хранимая процедура возвращает значение ключа записи новой строки, чтобы платформа Entity Framework можно отслеживать, что в версии сущности, которую он сохраняет в памяти.</span><span class="sxs-lookup"><span data-stu-id="b83d6-133">The stored procedure returns the value of the new row's record key so that the Entity Framework can keep track of that in the version of the entity it keeps in memory.</span></span>

<span data-ttu-id="b83d6-134">Сохраните и закройте окно хранимой процедуры.</span><span class="sxs-lookup"><span data-stu-id="b83d6-134">Save and close the stored procedure window.</span></span>

<span data-ttu-id="b83d6-135">Создание `InsertInstructor` хранимую процедуру таким же образом, с помощью следующих инструкций SQL:</span><span class="sxs-lookup"><span data-stu-id="b83d6-135">Create an `InsertInstructor` stored procedure in the same manner, using the following SQL statements:</span></span>

[!code-sql[Main](the-entity-framework-and-aspnet-getting-started-part-7/samples/sample2.sql)]

<span data-ttu-id="b83d6-136">Создание `Update` хранимых процедур для `Student` и `Instructor` сущности также.</span><span class="sxs-lookup"><span data-stu-id="b83d6-136">Create `Update` stored procedures for `Student` and `Instructor` entities also.</span></span> <span data-ttu-id="b83d6-137">(База данных уже содержит `DeletePerson` хранимую процедуру, которая работает в обоих `Instructor` и `Student` сущностей.)</span><span class="sxs-lookup"><span data-stu-id="b83d6-137">(The database already has a `DeletePerson` stored procedure which will work for both `Instructor` and `Student` entities.)</span></span>

[!code-sql[Main](the-entity-framework-and-aspnet-getting-started-part-7/samples/sample3.sql)]

[!code-sql[Main](the-entity-framework-and-aspnet-getting-started-part-7/samples/sample4.sql)]

<span data-ttu-id="b83d6-138">В этом руководстве необходимо сопоставить все три функции--insert, update и delete — для каждого типа сущности.</span><span class="sxs-lookup"><span data-stu-id="b83d6-138">In this tutorial you'll map all three functions -- insert, update, and delete -- for each entity type.</span></span> <span data-ttu-id="b83d6-139">Платформа Entity Framework версии 4 позволяет сопоставить только один или два из этих функций для хранимых процедур без сопоставления с другими, за одним исключением: Если сопоставить функцию обновления, но не функцию удаления, Entity Framework приведет к возникновению исключения при вы Попытка удалить сущность.</span><span class="sxs-lookup"><span data-stu-id="b83d6-139">The Entity Framework version 4 allows you to map just one or two of these functions to stored procedures without mapping the others, with one exception: if you map the update function but not the delete function, the Entity Framework will throw an exception when you attempt to delete an entity.</span></span> <span data-ttu-id="b83d6-140">В Entity Framework версии 3.5, можно было не такой большой объем гибкость при сопоставлении хранимых процедур: Если сопоставить одну функцию нужно было сопоставить все три.</span><span class="sxs-lookup"><span data-stu-id="b83d6-140">In the Entity Framework version 3.5, you did not have this much flexibility in mapping stored procedures: if you mapped one function you were required to map all three.</span></span>

<span data-ttu-id="b83d6-141">Чтобы создать хранимую процедуру, которая считывает, а не обновляет данные, создать новый, выбирает все `Course` сущностей, с помощью следующих инструкций SQL:</span><span class="sxs-lookup"><span data-stu-id="b83d6-141">To create a stored procedure that reads rather than updates data, create one that selects all `Course` entities, using the following SQL statements:</span></span>

[!code-sql[Main](the-entity-framework-and-aspnet-getting-started-part-7/samples/sample5.sql)]

## <a name="adding-the-stored-procedures-to-the-data-model"></a><span data-ttu-id="b83d6-142">Добавление модели данных хранимые процедуры</span><span class="sxs-lookup"><span data-stu-id="b83d6-142">Adding the Stored Procedures to the Data Model</span></span>

<span data-ttu-id="b83d6-143">Теперь определенные хранимые процедуры в базе данных, но они должны быть добавлены в модель данных, чтобы сделать их доступными на платформу Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="b83d6-143">The stored procedures are now defined in the database, but they must be added to the data model to make them available to the Entity Framework.</span></span> <span data-ttu-id="b83d6-144">Откройте *SchoolModel.edmx*, щелкните правой кнопкой мыши область конструктора и выберите **обновить модель из базы данных**.</span><span class="sxs-lookup"><span data-stu-id="b83d6-144">Open *SchoolModel.edmx*, right-click the design surface, and select **Update Model from Database**.</span></span> <span data-ttu-id="b83d6-145">В **добавить** вкладке **Выбор объектов базы данных** диалогового окна разверните узел **хранимые процедуры**, выберите только что созданный хранимые процедуры и `DeletePerson` Хранимая процедура, а затем нажмите кнопку **Готово**.</span><span class="sxs-lookup"><span data-stu-id="b83d6-145">In the **Add** tab of the **Choose Your Database Objects** dialog box, expand **Stored Procedures**, select the newly created stored procedures and the `DeletePerson` stored procedure, and then click **Finish**.</span></span>

<span data-ttu-id="b83d6-146">[![Image20](the-entity-framework-and-aspnet-getting-started-part-7/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="b83d6-146">[![image20](the-entity-framework-and-aspnet-getting-started-part-7/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image5.png)</span></span>

## <a name="mapping-the-stored-procedures"></a><span data-ttu-id="b83d6-147">Сопоставление хранимых процедур</span><span class="sxs-lookup"><span data-stu-id="b83d6-147">Mapping the Stored Procedures</span></span>

<span data-ttu-id="b83d6-148">В конструкторе моделей, щелкните правой кнопкой мыши `Student` сущности и выберите **сопоставление хранимых процедур**.</span><span class="sxs-lookup"><span data-stu-id="b83d6-148">In the data model designer, right-click the `Student` entity and select **Stored Procedure Mapping**.</span></span>

<span data-ttu-id="b83d6-149">[![Image21](the-entity-framework-and-aspnet-getting-started-part-7/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="b83d6-149">[![image21](the-entity-framework-and-aspnet-getting-started-part-7/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image7.png)</span></span>

<span data-ttu-id="b83d6-150">**Сведения о сопоставлении** появится окно, в котором можно указать хранимые процедуры, которые Entity Framework следует использовать для вставки, обновления и удаления сущностей этого типа.</span><span class="sxs-lookup"><span data-stu-id="b83d6-150">The **Mapping Details** window appears, in which you can specify stored procedures that the Entity Framework should use for inserting, updating, and deleting entities of this type.</span></span>

<span data-ttu-id="b83d6-151">[![image22](the-entity-framework-and-aspnet-getting-started-part-7/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="b83d6-151">[![image22](the-entity-framework-and-aspnet-getting-started-part-7/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image9.png)</span></span>

<span data-ttu-id="b83d6-152">Задайте **вставить** функцию **InsertStudent**.</span><span class="sxs-lookup"><span data-stu-id="b83d6-152">Set the **Insert** function to **InsertStudent**.</span></span> <span data-ttu-id="b83d6-153">В окне отображаются список параметров хранимых процедур, каждый из которых должен быть сопоставлен со свойством сущности.</span><span class="sxs-lookup"><span data-stu-id="b83d6-153">The window shows a list of stored procedure parameters, each of which must be mapped to an entity property.</span></span> <span data-ttu-id="b83d6-154">Два из них сопоставляются автоматически, так как имена совпадают.</span><span class="sxs-lookup"><span data-stu-id="b83d6-154">Two of these are mapped automatically because the names are the same.</span></span> <span data-ttu-id="b83d6-155">Отсутствует свойство сущности с именем `FirstName`, поэтому необходимо вручную выбрать `FirstMidName` из приведены свойства доступных сущностей в списке.</span><span class="sxs-lookup"><span data-stu-id="b83d6-155">There's no entity property named `FirstName`, so you must manually select `FirstMidName` from a drop-down list that shows available entity properties.</span></span> <span data-ttu-id="b83d6-156">(Это так, как вы изменили имя `FirstName` свойства `FirstMidName` в первом руководстве.)</span><span class="sxs-lookup"><span data-stu-id="b83d6-156">(This is because you changed the name of the `FirstName` property to `FirstMidName` in the first tutorial.)</span></span>

<span data-ttu-id="b83d6-157">[![image23](the-entity-framework-and-aspnet-getting-started-part-7/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="b83d6-157">[![image23](the-entity-framework-and-aspnet-getting-started-part-7/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image11.png)</span></span>

<span data-ttu-id="b83d6-158">В том же **сведения о сопоставлении** окна, карты `Update` функцию `UpdateStudent` хранимой процедуры (Убедитесь, что указано `FirstMidName` как значение параметра для `FirstName`, как это было сделано для `Insert` Хранимая процедура) и `Delete` функцию `DeletePerson` хранимой процедуры.</span><span class="sxs-lookup"><span data-stu-id="b83d6-158">In the same **Mapping Details** window, map the `Update` function to the `UpdateStudent` stored procedure (make sure you specify `FirstMidName` as the parameter value for `FirstName`, as you did for the `Insert` stored procedure) and the `Delete` function to the `DeletePerson` stored procedure.</span></span>

<span data-ttu-id="b83d6-159">[!["Image01"](the-entity-framework-and-aspnet-getting-started-part-7/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="b83d6-159">[![image01](the-entity-framework-and-aspnet-getting-started-part-7/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image13.png)</span></span>

<span data-ttu-id="b83d6-160">Выполните ту же процедуру, чтобы сопоставить insert, update и delete хранимых процедур для инструкции выделялись на `Instructor` сущности.</span><span class="sxs-lookup"><span data-stu-id="b83d6-160">Follow the same procedure to map the insert, update, and delete stored procedures for instructors to the `Instructor` entity.</span></span>

<span data-ttu-id="b83d6-161">[![Image02](the-entity-framework-and-aspnet-getting-started-part-7/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="b83d6-161">[![image02](the-entity-framework-and-aspnet-getting-started-part-7/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image15.png)</span></span>

<span data-ttu-id="b83d6-162">Для хранимых процедур, которые считывают вместо того, чтобы обновить данные, использовать **браузер моделей** окно, чтобы сопоставить хранимую процедуру с сущностью вводить его возвращает.</span><span class="sxs-lookup"><span data-stu-id="b83d6-162">For stored procedures that read rather than update data, you use the **Model Browser** window to map the stored procedure to the entity type it returns.</span></span> <span data-ttu-id="b83d6-163">В конструкторе моделей, щелкните правой кнопкой мыши область конструктора и выберите **браузер моделей**.</span><span class="sxs-lookup"><span data-stu-id="b83d6-163">In the data model designer, right-click the design surface and select **Model Browser**.</span></span> <span data-ttu-id="b83d6-164">Откройте **SchoolModel.Store** узел и откройте **хранимые процедуры** узла.</span><span class="sxs-lookup"><span data-stu-id="b83d6-164">Open the **SchoolModel.Store** node and then open the **Stored Procedures** node.</span></span> <span data-ttu-id="b83d6-165">Щелкните правой кнопкой мыши `GetCourses` хранимой процедуры и выберите **добавить импорт функции**.</span><span class="sxs-lookup"><span data-stu-id="b83d6-165">Then right-click the `GetCourses` stored procedure and select **Add Function Import**.</span></span>

<span data-ttu-id="b83d6-166">[![image24](the-entity-framework-and-aspnet-getting-started-part-7/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="b83d6-166">[![image24](the-entity-framework-and-aspnet-getting-started-part-7/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image17.png)</span></span>

<span data-ttu-id="b83d6-167">В **добавить импорт функции** диалогового **возвращает коллекцию** выберите **сущностей**, а затем выберите `Course` как тип сущности возвращаются.</span><span class="sxs-lookup"><span data-stu-id="b83d6-167">In the **Add Function Import** dialog box, under **Returns a Collection Of** select **Entities**, and then select `Course` as the entity type returned.</span></span> <span data-ttu-id="b83d6-168">Когда все будет готово, нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="b83d6-168">When you're done, click **OK**.</span></span> <span data-ttu-id="b83d6-169">Сохраните и закройте *.edmx* файл.</span><span class="sxs-lookup"><span data-stu-id="b83d6-169">Save and close the *.edmx* file.</span></span>

<span data-ttu-id="b83d6-170">[![Image25](the-entity-framework-and-aspnet-getting-started-part-7/_static/image20.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="b83d6-170">[![image25](the-entity-framework-and-aspnet-getting-started-part-7/_static/image20.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image19.png)</span></span>

## <a name="using-insert-update-and-delete-stored-procedures"></a><span data-ttu-id="b83d6-171">С помощью вставки, обновления и удаления хранимых процедур</span><span class="sxs-lookup"><span data-stu-id="b83d6-171">Using Insert, Update, and Delete Stored Procedures</span></span>

<span data-ttu-id="b83d6-172">Хранимые процедуры для вставки, обновления и удаления данных используются платформой Entity Framework автоматически после их добавления в модель данных и сопоставить их в соответствующие сущности.</span><span class="sxs-lookup"><span data-stu-id="b83d6-172">Stored procedures to insert, update, and delete data are used by the Entity Framework automatically after you've added them to the data model and mapped them to the appropriate entities.</span></span> <span data-ttu-id="b83d6-173">Теперь вы можете запустить *StudentsAdd.aspx* страницы, и каждый раз при создании нового учащегося, Entity Framework будет использовать `InsertStudent` хранимую процедуру для добавления новой строки к `Student` таблицы.</span><span class="sxs-lookup"><span data-stu-id="b83d6-173">You can now run the *StudentsAdd.aspx* page, and every time you create a new student, the Entity Framework will use the `InsertStudent` stored procedure to add the new row to the `Student` table.</span></span>

<span data-ttu-id="b83d6-174">[![Image03](the-entity-framework-and-aspnet-getting-started-part-7/_static/image22.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="b83d6-174">[![image03](the-entity-framework-and-aspnet-getting-started-part-7/_static/image22.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image21.png)</span></span>

<span data-ttu-id="b83d6-175">Запустите *Students.aspx* страницы и нового учащегося появится в списке.</span><span class="sxs-lookup"><span data-stu-id="b83d6-175">Run the *Students.aspx* page and the new student appears in the list.</span></span>

<span data-ttu-id="b83d6-176">[![Image04](the-entity-framework-and-aspnet-getting-started-part-7/_static/image24.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="b83d6-176">[![image04](the-entity-framework-and-aspnet-getting-started-part-7/_static/image24.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image23.png)</span></span>

<span data-ttu-id="b83d6-177">Изменить имя, чтобы убедиться, что функция обновления работает и удалите учащегося, чтобы убедиться, что функция удаления работает.</span><span class="sxs-lookup"><span data-stu-id="b83d6-177">Change the name to verify that the update function works, and then delete the student to verify that the delete function works.</span></span>

<span data-ttu-id="b83d6-178">[![Image05](the-entity-framework-and-aspnet-getting-started-part-7/_static/image26.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="b83d6-178">[![image05](the-entity-framework-and-aspnet-getting-started-part-7/_static/image26.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image25.png)</span></span>

## <a name="using-select-stored-procedures"></a><span data-ttu-id="b83d6-179">Использование Select хранимых процедур</span><span class="sxs-lookup"><span data-stu-id="b83d6-179">Using Select Stored Procedures</span></span>

<span data-ttu-id="b83d6-180">Платформа Entity Framework не запускаются автоматически хранимых процедур например `GetCourses`, и не может использовать их с помощью `EntityDataSource` элемента управления.</span><span class="sxs-lookup"><span data-stu-id="b83d6-180">The Entity Framework does not automatically run stored procedures such as `GetCourses`, and you cannot use them with the `EntityDataSource` control.</span></span> <span data-ttu-id="b83d6-181">Чтобы воспользоваться ими, их можно вызывать из кода.</span><span class="sxs-lookup"><span data-stu-id="b83d6-181">To use them, you call them from code.</span></span>

<span data-ttu-id="b83d6-182">Откройте *InstructorsCourses.aspx.cs* файла.</span><span class="sxs-lookup"><span data-stu-id="b83d6-182">Open the *InstructorsCourses.aspx.cs* file.</span></span> <span data-ttu-id="b83d6-183">`PopulateDropDownLists` Метод использует запрос LINQ to Entities для получения всех сущностей course, чтобы он мог циклического прохода по списку и определить, какие из них назначается преподавателя и какие из них не были назначены:</span><span class="sxs-lookup"><span data-stu-id="b83d6-183">The `PopulateDropDownLists` method uses a LINQ-to-Entities query to retrieve all course entities so that it can loop through the list and determine which ones an instructor is assigned to and which ones are unassigned:</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-7/samples/sample6.cs)]

<span data-ttu-id="b83d6-184">Замените следующий код:</span><span class="sxs-lookup"><span data-stu-id="b83d6-184">Replace this with the following code:</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-7/samples/sample7.cs)]

<span data-ttu-id="b83d6-185">На странице теперь используется `GetCourses` хранимой процедуры для получения списка всех курсов.</span><span class="sxs-lookup"><span data-stu-id="b83d6-185">The page now uses the `GetCourses` stored procedure to retrieve the list of all courses.</span></span> <span data-ttu-id="b83d6-186">Запустите страницу, чтобы убедиться, что оно работает, как и раньше.</span><span class="sxs-lookup"><span data-stu-id="b83d6-186">Run the page to verify that it works as it did before.</span></span>

<span data-ttu-id="b83d6-187">(Свойства навигации сущностей, полученные с помощью хранимой процедуры не могут быть заполнены автоматически с данными, относящимися к этим сущностям, в зависимости от `ObjectContext` параметры по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="b83d6-187">(Navigation properties of entities retrieved by a stored procedure might not be automatically populated with the data related to those entities, depending on `ObjectContext` default settings.</span></span> <span data-ttu-id="b83d6-188">Дополнительные сведения см. в разделе [загрузка связанных объектов](https://msdn.microsoft.com/library/bb896272.aspx) в библиотеке MSDN.)</span><span class="sxs-lookup"><span data-stu-id="b83d6-188">For more information, see [Loading Related Objects](https://msdn.microsoft.com/library/bb896272.aspx) in the MSDN Library.)</span></span>

<span data-ttu-id="b83d6-189">В следующем руководстве вы узнаете, как использовать функциональные возможности платформы динамических данных для упрощения программы тестирования данных форматирования и проверки правила и.</span><span class="sxs-lookup"><span data-stu-id="b83d6-189">In the next tutorial, you'll learn how to use Dynamic Data functionality to make it easier to program and test data formatting and validation rules.</span></span> <span data-ttu-id="b83d6-190">Вместо указания на каждой веб-страницу правил, таких как строки формата данных и того, является ли поле является обязательным, можно указать такие правила в метаданных модели данных, и они автоматически применяются на каждой странице.</span><span class="sxs-lookup"><span data-stu-id="b83d6-190">Instead of specifying on each web page rules such as data format strings and whether or not a field is required, you can specify such rules in data model metadata and they're automatically applied on every page.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="b83d6-191">[Назад](the-entity-framework-and-aspnet-getting-started-part-6.md)
> [Вперед](the-entity-framework-and-aspnet-getting-started-part-8.md)</span><span class="sxs-lookup"><span data-stu-id="b83d6-191">[Previous](the-entity-framework-and-aspnet-getting-started-part-6.md)
[Next](the-entity-framework-and-aspnet-getting-started-part-8.md)</span></span>
