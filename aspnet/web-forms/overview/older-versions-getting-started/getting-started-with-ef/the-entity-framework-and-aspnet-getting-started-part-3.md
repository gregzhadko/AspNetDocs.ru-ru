---
uid: web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-3
title: Начало работы с Entity Framework 4.0 Database First и ASP.NET 4 Web Forms — часть 3 | Документация Майкрософт
author: tdykstra
description: Пример веб-приложение университета Contoso демонстрирует создание приложений веб-форм ASP.NET, с помощью Entity Framework. Пример приложения является...
ms.author: riande
ms.date: 12/03/2010
ms.assetid: ccdc3f8c-2568-40a7-8f8b-3c23d2e05388
msc.legacyurl: /web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-3
msc.type: authoredcontent
ms.openlocfilehash: 8f3eced3c482291203383c53aa97b97101839cce
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59392824"
---
# <a name="getting-started-with-entity-framework-40-database-first-and-aspnet-4-web-forms---part-3"></a><span data-ttu-id="e3a95-104">Начало работы с Entity Framework 4.0 Database First и ASP.NET 4 Web Forms — часть 3</span><span class="sxs-lookup"><span data-stu-id="e3a95-104">Getting Started with Entity Framework 4.0 Database First and ASP.NET 4 Web Forms - Part 3</span></span>

<span data-ttu-id="e3a95-105">по [том Дайкстра](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="e3a95-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="e3a95-106">Пример веб-приложение университета Contoso демонстрирует создание приложения веб-форм ASP.NET, используя Entity Framework 4.0 и Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="e3a95-106">The Contoso University sample web application demonstrates how to create ASP.NET Web Forms applications using the Entity Framework 4.0 and Visual Studio 2010.</span></span> <span data-ttu-id="e3a95-107">Сведения об этой серии руководств см. в разделе [в первом учебнике серии](the-entity-framework-and-aspnet-getting-started-part-1.md)</span><span class="sxs-lookup"><span data-stu-id="e3a95-107">For information about the tutorial series, see [the first tutorial in the series](the-entity-framework-and-aspnet-getting-started-part-1.md)</span></span>


## <a name="filtering-ordering-and-grouping-data"></a><span data-ttu-id="e3a95-108">Фильтрация, упорядочение и группирование данных</span><span class="sxs-lookup"><span data-stu-id="e3a95-108">Filtering, Ordering, and Grouping Data</span></span>

<span data-ttu-id="e3a95-109">В предыдущем учебном курсе мы использовали `EntityDataSource` элемента управления для отображения и редактирования данных.</span><span class="sxs-lookup"><span data-stu-id="e3a95-109">In the previous tutorial you used the `EntityDataSource` control to display and edit data.</span></span> <span data-ttu-id="e3a95-110">В этом руководстве вы фильтрации, заказа и группирования данных.</span><span class="sxs-lookup"><span data-stu-id="e3a95-110">In this tutorial you'll filter, order, and group data.</span></span> <span data-ttu-id="e3a95-111">После этого путем задания свойств `EntityDataSource` элемента управления, синтаксис отличается от других элементов управления источниками данных.</span><span class="sxs-lookup"><span data-stu-id="e3a95-111">When you do this by setting properties of the `EntityDataSource` control, the syntax is different from other data source controls.</span></span> <span data-ttu-id="e3a95-112">Как вы увидите, тем не менее, можно использовать `QueryExtender` элемента управления, чтобы свести к минимуму эти различия.</span><span class="sxs-lookup"><span data-stu-id="e3a95-112">As you'll see, however, you can use the `QueryExtender` control to minimize these differences.</span></span>

<span data-ttu-id="e3a95-113">Вам предстоит изменить *Students.aspx* страницы для фильтрации для студентов, сортировка по имени и поиск по имени.</span><span class="sxs-lookup"><span data-stu-id="e3a95-113">You'll change the *Students.aspx* page to filter for students, sort by name, and search on name.</span></span> <span data-ttu-id="e3a95-114">Вы также измените *Courses.aspx* страницы для отображения курсов для выбранного отдела и найдите курсы по имени.</span><span class="sxs-lookup"><span data-stu-id="e3a95-114">You'll also change the *Courses.aspx* page to display courses for the selected department and search for courses by name.</span></span> <span data-ttu-id="e3a95-115">Наконец, вы добавите статистики учащихся к *About.aspx* страницы.</span><span class="sxs-lookup"><span data-stu-id="e3a95-115">Finally, you'll add student statistics to the *About.aspx* page.</span></span>

<span data-ttu-id="e3a95-116">[![Image02](the-entity-framework-and-aspnet-getting-started-part-3/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="e3a95-116">[![Image02](the-entity-framework-and-aspnet-getting-started-part-3/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image1.png)</span></span>

<span data-ttu-id="e3a95-117">[![Image11](the-entity-framework-and-aspnet-getting-started-part-3/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="e3a95-117">[![Image11](the-entity-framework-and-aspnet-getting-started-part-3/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image3.png)</span></span>

<span data-ttu-id="e3a95-118">[![Image10](the-entity-framework-and-aspnet-getting-started-part-3/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="e3a95-118">[![Image10](the-entity-framework-and-aspnet-getting-started-part-3/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image5.png)</span></span>

<span data-ttu-id="e3a95-119">[![Image14](the-entity-framework-and-aspnet-getting-started-part-3/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="e3a95-119">[![Image14](the-entity-framework-and-aspnet-getting-started-part-3/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image7.png)</span></span>

## <a name="using-the-entitydatasource-where-property-to-filter-data"></a><span data-ttu-id="e3a95-120">С помощью EntityDataSource «Where» свойства для фильтрации данных</span><span class="sxs-lookup"><span data-stu-id="e3a95-120">Using the EntityDataSource "Where" Property to Filter Data</span></span>

<span data-ttu-id="e3a95-121">Откройте *Students.aspx* страницу, созданную в предыдущем учебном курсе.</span><span class="sxs-lookup"><span data-stu-id="e3a95-121">Open the *Students.aspx* page that you created in the previous tutorial.</span></span> <span data-ttu-id="e3a95-122">В настоящее время `GridView` элемента управления на странице отображаются все имена из `People` набора сущностей.</span><span class="sxs-lookup"><span data-stu-id="e3a95-122">As currently configured, the `GridView` control in the page displays all the names from the `People` entity set.</span></span> <span data-ttu-id="e3a95-123">Тем не менее, вы хотите показать только учащихся, который можно найти, выбрав `Person` сущностей, которые имеют дат зачисления отличное от null.</span><span class="sxs-lookup"><span data-stu-id="e3a95-123">However, you want to show only students, which you can find by selecting `Person` entities that have non-null enrollment dates.</span></span>

<span data-ttu-id="e3a95-124">Переключиться в режим **разработки** просматривать и выбирать `EntityDataSource` элемента управления.</span><span class="sxs-lookup"><span data-stu-id="e3a95-124">Switch to **Design** view and select the `EntityDataSource` control.</span></span> <span data-ttu-id="e3a95-125">В окне **Свойства** присвойте свойству `Where` значение `it.EnrollmentDate is not null`.</span><span class="sxs-lookup"><span data-stu-id="e3a95-125">In the **Properties** window, set the `Where` property to `it.EnrollmentDate is not null`.</span></span>

<span data-ttu-id="e3a95-126">[!["Image01"](the-entity-framework-and-aspnet-getting-started-part-3/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="e3a95-126">[![Image01](the-entity-framework-and-aspnet-getting-started-part-3/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image9.png)</span></span>

<span data-ttu-id="e3a95-127">Использовать в синтаксис `Where` свойство `EntityDataSource` элемент управления является Entity SQL.</span><span class="sxs-lookup"><span data-stu-id="e3a95-127">The syntax you use in the `Where` property of the `EntityDataSource` control is Entity SQL.</span></span> <span data-ttu-id="e3a95-128">Язык Entity SQL аналогична Transact-SQL, но он настраивается для использования с сущностями, а не объекты базы данных.</span><span class="sxs-lookup"><span data-stu-id="e3a95-128">Entity SQL is similar to Transact-SQL, but it's customized for use with entities rather than database objects.</span></span> <span data-ttu-id="e3a95-129">В выражении `it.EnrollmentDate is not null`, слово `it` представляет ссылку на сущность, возвращенных запросом.</span><span class="sxs-lookup"><span data-stu-id="e3a95-129">In the expression `it.EnrollmentDate is not null`, the word `it` represents a reference to the entity returned by the query.</span></span> <span data-ttu-id="e3a95-130">Таким образом `it.EnrollmentDate` ссылается на `EnrollmentDate` свойство `Person` сущности, `EntityDataSource` управления возвращает.</span><span class="sxs-lookup"><span data-stu-id="e3a95-130">Therefore, `it.EnrollmentDate` refers to the `EnrollmentDate` property of the `Person` entity that the `EntityDataSource` control returns.</span></span>

<span data-ttu-id="e3a95-131">Откройте страницу.</span><span class="sxs-lookup"><span data-stu-id="e3a95-131">Run the page.</span></span> <span data-ttu-id="e3a95-132">В список учащихся теперь содержит только учащихся.</span><span class="sxs-lookup"><span data-stu-id="e3a95-132">The students list now contains only students.</span></span> <span data-ttu-id="e3a95-133">(Нет ни одной строки, где отображается дата регистрации не установлена.)</span><span class="sxs-lookup"><span data-stu-id="e3a95-133">(There are no rows displayed where there's no enrollment date.)</span></span>

<span data-ttu-id="e3a95-134">[![Image02](the-entity-framework-and-aspnet-getting-started-part-3/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="e3a95-134">[![Image02](the-entity-framework-and-aspnet-getting-started-part-3/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image11.png)</span></span>

## <a name="using-the-entitydatasource-orderby-property-to-order-data"></a><span data-ttu-id="e3a95-135">С помощью свойства «OrderBy» EntityDataSource для упорядочения данных</span><span class="sxs-lookup"><span data-stu-id="e3a95-135">Using the EntityDataSource "OrderBy" Property to Order Data</span></span>

<span data-ttu-id="e3a95-136">Требуется, этот список отсортирован по фамилиям, при первом отображении.</span><span class="sxs-lookup"><span data-stu-id="e3a95-136">You also want this list to be in name order when it's first displayed.</span></span> <span data-ttu-id="e3a95-137">С *Students.aspx* страницы, все еще открыт в **разработки** представление и с `EntityDataSource` по-прежнему выбран в элемент управления **свойства** задайте  **OrderBy** свойства `it.LastName`.</span><span class="sxs-lookup"><span data-stu-id="e3a95-137">With the *Students.aspx* page still open in **Design** view, and with the `EntityDataSource` control still selected, in the **Properties** window set the **OrderBy** property to `it.LastName`.</span></span>

<span data-ttu-id="e3a95-138">[![Image05](the-entity-framework-and-aspnet-getting-started-part-3/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="e3a95-138">[![Image05](the-entity-framework-and-aspnet-getting-started-part-3/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image13.png)</span></span>

<span data-ttu-id="e3a95-139">Откройте страницу.</span><span class="sxs-lookup"><span data-stu-id="e3a95-139">Run the page.</span></span> <span data-ttu-id="e3a95-140">В список учащихся теперь находится в порядке по фамилии.</span><span class="sxs-lookup"><span data-stu-id="e3a95-140">The students list is now in order by last name.</span></span>

<span data-ttu-id="e3a95-141">[![Image04](the-entity-framework-and-aspnet-getting-started-part-3/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="e3a95-141">[![Image04](the-entity-framework-and-aspnet-getting-started-part-3/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image15.png)</span></span>

## <a name="using-a-control-parameter-to-set-the-where-property"></a><span data-ttu-id="e3a95-142">С помощью параметра управления установить свойство «Where»</span><span class="sxs-lookup"><span data-stu-id="e3a95-142">Using a Control Parameter to Set the "Where" Property</span></span>

<span data-ttu-id="e3a95-143">Как с помощью других источников данных, можно передать значения параметров для `Where` свойство.</span><span class="sxs-lookup"><span data-stu-id="e3a95-143">As with other data source controls, you can pass parameter values to the `Where` property.</span></span> <span data-ttu-id="e3a95-144">На *Courses.aspx* странице, что вы создали в части 2 этого руководства, этот метод можно использовать для отображения курсов, которые связаны с отделу, который пользователь выбирает из раскрывающегося списка.</span><span class="sxs-lookup"><span data-stu-id="e3a95-144">On the *Courses.aspx* page that you created in part 2 of the tutorial, you can use this method to display courses that are associated with the department that a user selects from the drop-down list.</span></span>

<span data-ttu-id="e3a95-145">Откройте *Courses.aspx* и переключиться в режим **разработки** представления.</span><span class="sxs-lookup"><span data-stu-id="e3a95-145">Open *Courses.aspx* and switch to **Design** view.</span></span> <span data-ttu-id="e3a95-146">Добавьте второй `EntityDataSource` к странице и назовите его `CoursesEntityDataSource`.</span><span class="sxs-lookup"><span data-stu-id="e3a95-146">Add a second `EntityDataSource` control to the page, and name it `CoursesEntityDataSource`.</span></span> <span data-ttu-id="e3a95-147">Подключите его к `SchoolEntities` модели и выберите `Courses` как **EntitySetName** значение.</span><span class="sxs-lookup"><span data-stu-id="e3a95-147">Connect it to the `SchoolEntities` model, and select `Courses` as the **EntitySetName** value.</span></span>

<span data-ttu-id="e3a95-148">В **свойства** окно, нажмите кнопку с многоточием в **где** «свойство».</span><span class="sxs-lookup"><span data-stu-id="e3a95-148">In the **Properties** window, click the ellipsis in the **Where** property box.</span></span> <span data-ttu-id="e3a95-149">(Убедитесь, что `CoursesEntityDataSource` сохраняя выбранным элемент управления перед использованием **свойства** окна.)</span><span class="sxs-lookup"><span data-stu-id="e3a95-149">(Make sure the `CoursesEntityDataSource` control is still selected before using the **Properties** window.)</span></span>

<span data-ttu-id="e3a95-150">[![Image06](the-entity-framework-and-aspnet-getting-started-part-3/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="e3a95-150">[![Image06](the-entity-framework-and-aspnet-getting-started-part-3/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image17.png)</span></span>

<span data-ttu-id="e3a95-151">**Редактор выражений** диалоговое окно.</span><span class="sxs-lookup"><span data-stu-id="e3a95-151">The **Expression Editor** dialog box is displayed.</span></span> <span data-ttu-id="e3a95-152">В этом диалоговом окне выберите **Where создавалось автоматически выражения на основе предоставленного параметров**, а затем нажмите кнопку **добавить параметр**.</span><span class="sxs-lookup"><span data-stu-id="e3a95-152">In this dialog box, select **Automatically generate the Where expression based on the provided parameters**, and then click **Add Parameter**.</span></span> <span data-ttu-id="e3a95-153">Имя параметра `DepartmentID`выберите **управления** как **источник параметра** значение и выберите **DepartmentsDropDownList** как **ControlID**  значение.</span><span class="sxs-lookup"><span data-stu-id="e3a95-153">Name the parameter `DepartmentID`, select **Control** as the **Parameter source** value, and select **DepartmentsDropDownList** as the **ControlID** value.</span></span>

<span data-ttu-id="e3a95-154">[![Image07](the-entity-framework-and-aspnet-getting-started-part-3/_static/image20.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="e3a95-154">[![Image07](the-entity-framework-and-aspnet-getting-started-part-3/_static/image20.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image19.png)</span></span>

<span data-ttu-id="e3a95-155">Нажмите кнопку **Показать дополнительные свойства**и в **свойства** окно **редактор выражений** » диалогового окна «Изменение `Type` свойства `Int32`.</span><span class="sxs-lookup"><span data-stu-id="e3a95-155">Click **Show advanced properties**, and in the **Properties** window of the **Expression Editor** dialog box, change the `Type` property to `Int32`.</span></span>

<span data-ttu-id="e3a95-156">[![Image15](the-entity-framework-and-aspnet-getting-started-part-3/_static/image22.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="e3a95-156">[![Image15](the-entity-framework-and-aspnet-getting-started-part-3/_static/image22.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image21.png)</span></span>

<span data-ttu-id="e3a95-157">Когда все будет готово, нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="e3a95-157">When you're done, click **OK**.</span></span>

<span data-ttu-id="e3a95-158">Выберите в раскрывающемся списке, добавьте `GridView` на страницу элемент управления и назовите его `CoursesGridView`.</span><span class="sxs-lookup"><span data-stu-id="e3a95-158">Below the drop-down list, add a `GridView` control to the page and name it `CoursesGridView`.</span></span> <span data-ttu-id="e3a95-159">Подключите его к `CoursesEntityDataSource` источника данных элемента управления, нажмите кнопку **обновить схему**, нажмите кнопку **Правка столбцов**и удалите `DepartmentID` столбца.</span><span class="sxs-lookup"><span data-stu-id="e3a95-159">Connect it to the `CoursesEntityDataSource` data source control, click **Refresh Schema**, click **Edit Columns**, and remove the `DepartmentID` column.</span></span> <span data-ttu-id="e3a95-160">`GridView` Разметка элемента управления аналогичный приведенному ниже.</span><span class="sxs-lookup"><span data-stu-id="e3a95-160">The `GridView` control markup resembles the following example.</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-3/samples/sample1.aspx)]

<span data-ttu-id="e3a95-161">Когда пользователь изменяет отдела, выбранного в раскрывающемся списке, необходим список связанных курсов для изменения автоматически.</span><span class="sxs-lookup"><span data-stu-id="e3a95-161">When the user changes the selected department in the drop-down list, you want the list of associated courses to change automatically.</span></span> <span data-ttu-id="e3a95-162">Для этого выберите стрелку раскрывающегося списка и в **свойства** задайте `AutoPostBack` свойства `True`.</span><span class="sxs-lookup"><span data-stu-id="e3a95-162">To make this happen, select the drop-down list, and in the **Properties** window set the `AutoPostBack` property to `True`.</span></span>

<span data-ttu-id="e3a95-163">[![Image08](the-entity-framework-and-aspnet-getting-started-part-3/_static/image24.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="e3a95-163">[![Image08](the-entity-framework-and-aspnet-getting-started-part-3/_static/image24.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image23.png)</span></span>

<span data-ttu-id="e3a95-164">Теперь, когда вы закончите, с помощью конструктора, переключитесь в **источника** просмотра и замените `ConnectionString` и `DefaultContainer` называют свойства `CoursesEntityDataSource` управления `ContextTypeName="ContosoUniversity.DAL.SchoolEntities"` атрибута.</span><span class="sxs-lookup"><span data-stu-id="e3a95-164">Now that you're finished using the designer, switch to **Source** view and replace the `ConnectionString` and `DefaultContainer` name properties of the `CoursesEntityDataSource` control with the `ContextTypeName="ContosoUniversity.DAL.SchoolEntities"` attribute.</span></span> <span data-ttu-id="e3a95-165">Когда все будет готово, разметку для элемента управления будет выглядеть как в следующем примере.</span><span class="sxs-lookup"><span data-stu-id="e3a95-165">When you're done, the markup for the control will look like the following example.</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-3/samples/sample2.aspx)]

<span data-ttu-id="e3a95-166">Откройте страницу и используйте стрелку раскрывающегося списка для выбора различных отделов.</span><span class="sxs-lookup"><span data-stu-id="e3a95-166">Run the page and use the drop-down list to select different departments.</span></span> <span data-ttu-id="e3a95-167">Только курсы, предлагаемые выбранного отдела отображаются в `GridView` элемента управления.</span><span class="sxs-lookup"><span data-stu-id="e3a95-167">Only courses that are offered by the selected department are displayed in the `GridView` control.</span></span>

<span data-ttu-id="e3a95-168">[![Image09](the-entity-framework-and-aspnet-getting-started-part-3/_static/image26.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="e3a95-168">[![Image09](the-entity-framework-and-aspnet-getting-started-part-3/_static/image26.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image25.png)</span></span>

## <a name="using-the-entitydatasource-groupby-property-to-group-data"></a><span data-ttu-id="e3a95-169">С помощью свойства «GroupBy» EntityDataSource для группирования данных</span><span class="sxs-lookup"><span data-stu-id="e3a95-169">Using the EntityDataSource "GroupBy" Property to Group Data</span></span>

<span data-ttu-id="e3a95-170">Предположим, что университета Contoso хочет поместить некоторую статистику текст учащегося на страницу About по его.</span><span class="sxs-lookup"><span data-stu-id="e3a95-170">Suppose Contoso University wants to put some student-body statistics on its About page.</span></span> <span data-ttu-id="e3a95-171">В частности он хочет показать декомпозиция количество студентов по дате, когда они зарегистрированы.</span><span class="sxs-lookup"><span data-stu-id="e3a95-171">Specifically, it wants to show a breakdown of numbers of students by the date they enrolled.</span></span>

<span data-ttu-id="e3a95-172">Откройте *About.aspx*и в **источника** Просмотр, замените содержимое существующего файла `BodyContent` управления с «Статистики учащихся текст» между `h2` теги:</span><span class="sxs-lookup"><span data-stu-id="e3a95-172">Open *About.aspx*, and in **Source** view, replace the existing contents of the `BodyContent` control with "Student Body Statistics" between `h2` tags:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-3/samples/sample3.aspx)]

<span data-ttu-id="e3a95-173">После заголовка, добавить `EntityDataSource` управления и назовите его `StudentStatisticsEntityDataSource`.</span><span class="sxs-lookup"><span data-stu-id="e3a95-173">After the heading, add an `EntityDataSource` control and name it `StudentStatisticsEntityDataSource`.</span></span> <span data-ttu-id="e3a95-174">Подключите его к `SchoolEntities`выберите `People` набор сущностей и оставить **выберите** поле в мастере без изменений.</span><span class="sxs-lookup"><span data-stu-id="e3a95-174">Connect it to `SchoolEntities`, select the `People` entity set, and leave the **Select** box in the wizard unchanged.</span></span> <span data-ttu-id="e3a95-175">Задайте следующие свойства **свойства** окна:</span><span class="sxs-lookup"><span data-stu-id="e3a95-175">Set the following properties in the **Properties** window:</span></span>

- <span data-ttu-id="e3a95-176">Чтобы отфильтровать только для учащихся, установить `Where` свойства `it.EnrollmentDate is not null`.</span><span class="sxs-lookup"><span data-stu-id="e3a95-176">To filter for students only, set the `Where` property to `it.EnrollmentDate is not null`.</span></span>
- <span data-ttu-id="e3a95-177">Чтобы сгруппировать результаты по дате зачисления, задайте `GroupBy` свойства `it.EnrollmentDate`.</span><span class="sxs-lookup"><span data-stu-id="e3a95-177">To group the results by the enrollment date, set the `GroupBy` property to `it.EnrollmentDate`.</span></span>
- <span data-ttu-id="e3a95-178">Чтобы выбрать дату регистрации и число учащихся, присвойте `Select` свойства `it.EnrollmentDate, Count(it.EnrollmentDate) AS NumberOfStudents`.</span><span class="sxs-lookup"><span data-stu-id="e3a95-178">To select the enrollment date and the number of students, set the `Select` property to `it.EnrollmentDate, Count(it.EnrollmentDate) AS NumberOfStudents`.</span></span>
- <span data-ttu-id="e3a95-179">Чтобы упорядочить результаты по дате зачисления, задайте `OrderBy` свойства `it.EnrollmentDate`.</span><span class="sxs-lookup"><span data-stu-id="e3a95-179">To order the results by the enrollment date, set the `OrderBy` property to `it.EnrollmentDate`.</span></span>

<span data-ttu-id="e3a95-180">В **источника** Просмотр, замените `ConnectionString` и `DefaultContainer` имя свойства с `ContextTypeName` свойство.</span><span class="sxs-lookup"><span data-stu-id="e3a95-180">In **Source** view, replace the `ConnectionString` and `DefaultContainer` name properties with a `ContextTypeName` property.</span></span> <span data-ttu-id="e3a95-181">`EntityDataSource` Разметка элемента управления, теперь, аналогичный приведенному ниже.</span><span class="sxs-lookup"><span data-stu-id="e3a95-181">The `EntityDataSource` control markup now resembles the following example.</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-3/samples/sample4.aspx)]

<span data-ttu-id="e3a95-182">Синтаксис `Select`, `GroupBy`, и `Where` свойства напоминает Transact-SQL, за исключением `it` ключевое слово, которое указывает текущую сущность.</span><span class="sxs-lookup"><span data-stu-id="e3a95-182">The syntax of the `Select`, `GroupBy`, and `Where` properties resembles Transact-SQL except for the `it` keyword that specifies the current entity.</span></span>

<span data-ttu-id="e3a95-183">Добавьте следующую разметку для создания `GridView` управления для отображения данных.</span><span class="sxs-lookup"><span data-stu-id="e3a95-183">Add the following markup to create a `GridView` control to display the data.</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-3/samples/sample5.aspx)]

<span data-ttu-id="e3a95-184">Откройте страницу для просмотра полного перечня, в которой отображается число учащихся по дате зачисления.</span><span class="sxs-lookup"><span data-stu-id="e3a95-184">Run the page to see a list showing the number of students by enrollment date.</span></span>

<span data-ttu-id="e3a95-185">[![Image10](the-entity-framework-and-aspnet-getting-started-part-3/_static/image28.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="e3a95-185">[![Image10](the-entity-framework-and-aspnet-getting-started-part-3/_static/image28.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image27.png)</span></span>

## <a name="using-the-queryextender-control-for-filtering-and-ordering"></a><span data-ttu-id="e3a95-186">С помощью элемента управления для фильтрации и сортировки</span><span class="sxs-lookup"><span data-stu-id="e3a95-186">Using the QueryExtender Control for Filtering and Ordering</span></span>

<span data-ttu-id="e3a95-187">`QueryExtender` Элемент управления предоставляет способ указания фильтрации и сортировки в разметке.</span><span class="sxs-lookup"><span data-stu-id="e3a95-187">The `QueryExtender` control provides a way to specify filtering and sorting in markup.</span></span> <span data-ttu-id="e3a95-188">Синтаксис не зависит от системы управления базами данных (СУБД), который вы используете.</span><span class="sxs-lookup"><span data-stu-id="e3a95-188">The syntax is independent of the database management system (DBMS) you're using.</span></span> <span data-ttu-id="e3a95-189">Это также обычно зависит от платформы Entity Framework, за исключением, что синтаксис, используемый для свойств навигации является уникальным на платформу Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="e3a95-189">It's also generally independent of the Entity Framework, with the exception that syntax you use for navigation properties is unique to the Entity Framework.</span></span>

<span data-ttu-id="e3a95-190">В этой части руководства вы будете использовать `QueryExtender` элемент управления для фильтрации и порядок данных и одно из полей предложение order by будет свойством навигации.</span><span class="sxs-lookup"><span data-stu-id="e3a95-190">In this part of the tutorial you'll use a `QueryExtender` control to filter and order data, and one of the order-by fields will be a navigation property.</span></span>

<span data-ttu-id="e3a95-191">(Если вы предпочитаете использовать код вместо разметки для расширения запросы, которые автоматически создаются путем `EntityDataSource` элемента управления, это можно сделать обработки `QueryCreated` событий.</span><span class="sxs-lookup"><span data-stu-id="e3a95-191">(If you prefer to use code instead of markup to extend the queries that are automatically generated by the `EntityDataSource` control, you can do that by handling the `QueryCreated` event.</span></span> <span data-ttu-id="e3a95-192">Это как `QueryExtender` расширяет `EntityDataSource` также контролировать запросы.)</span><span class="sxs-lookup"><span data-stu-id="e3a95-192">This is how the `QueryExtender` control extends `EntityDataSource` control queries also.)</span></span>

<span data-ttu-id="e3a95-193">Откройте *Courses.aspx* странице и ниже разметку, добавленный ранее, вставьте следующую разметку, чтобы создать заголовок, текстовое поле для ввода строки поиска, кнопку поиска и `EntityDataSource` элемента управления, привязанного к `Courses` набора сущностей.</span><span class="sxs-lookup"><span data-stu-id="e3a95-193">Open the *Courses.aspx* page, and below the markup you added previously, insert the following markup to create a heading, a text box for entering search strings, a search button, and an `EntityDataSource` control that's bound to the `Courses` entity set.</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-3/samples/sample6.aspx)]

<span data-ttu-id="e3a95-194">Обратите внимание, что `EntityDataSource` элемента управления `Include` свойству `Department`.</span><span class="sxs-lookup"><span data-stu-id="e3a95-194">Notice that the `EntityDataSource` control's `Include` property is set to `Department`.</span></span> <span data-ttu-id="e3a95-195">В базе данных `Course` таблица не содержит название отдела; он содержит `DepartmentID` внешний ключевой столбец.</span><span class="sxs-lookup"><span data-stu-id="e3a95-195">In the database, the `Course` table does not contain the department name; it contains a `DepartmentID` foreign key column.</span></span> <span data-ttu-id="e3a95-196">Если запросы к базе данных напрямую, чтобы получить названия отдела вместе с данными курс, вам будет нужно присоединить `Course` и `Department` таблицы.</span><span class="sxs-lookup"><span data-stu-id="e3a95-196">If you were querying the database directly, to get the department name along with course data, you would have to join the `Course` and `Department` tables.</span></span> <span data-ttu-id="e3a95-197">Установив `Include` свойства `Department`, вы укажите, что платформа Entity Framework необходимо выполнить работу по началу связанный `Department` сущности, когда он получает `Course` сущности.</span><span class="sxs-lookup"><span data-stu-id="e3a95-197">By setting the `Include` property to `Department`, you specify that the Entity Framework should do the work of getting the related `Department` entity when it gets a `Course` entity.</span></span> <span data-ttu-id="e3a95-198">`Department` Сущность сохраняется в `Department` свойство навигации `Course` сущности.</span><span class="sxs-lookup"><span data-stu-id="e3a95-198">The `Department` entity is then stored in the `Department` navigation property of the `Course` entity.</span></span> <span data-ttu-id="e3a95-199">(По умолчанию `SchoolEntities` класс, который был создан конструктором моделей данных получающего связанные данные, при необходимости, а элемент управления источником данных был присоединен к этому классу, поэтому установка `Include` свойство не требуется.</span><span class="sxs-lookup"><span data-stu-id="e3a95-199">(By default, the `SchoolEntities` class that was generated by the data model designer retrieves related data when it's needed, and you've bound the data source control to that class, so setting the `Include` property is not necessary.</span></span> <span data-ttu-id="e3a95-200">Тем не менее, его установка повышает производительность страницы, так как в противном случае Entity Framework сделает отдельные вызовы к базе данных для получения данных для `Course` сущностей и для соответствующего `Department` сущностей.)</span><span class="sxs-lookup"><span data-stu-id="e3a95-200">However, setting it improves performance of the page, because otherwise the Entity Framework would make separate calls to the database to retrieve data for the `Course` entities and for the related `Department` entities.)</span></span>

<span data-ttu-id="e3a95-201">После `EntityDataSource` элемента управления, вы только что создали, вставьте следующую разметку для создания `QueryExtender` элемента управления, привязанного к этому `EntityDataSource` элемента управления.</span><span class="sxs-lookup"><span data-stu-id="e3a95-201">After the `EntityDataSource` control you just created, insert the following markup to create a `QueryExtender` control that's bound to that `EntityDataSource` control.</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-3/samples/sample7.aspx)]

<span data-ttu-id="e3a95-202">`SearchExpression` Элемент указывает, что вы хотите выбрать курсы, названия которых соответствуют значению, введенному в текстовом поле.</span><span class="sxs-lookup"><span data-stu-id="e3a95-202">The `SearchExpression` element specifies that you want to select courses whose titles match the value entered in the text box.</span></span> <span data-ttu-id="e3a95-203">Только по мере столько вводятся в текстовом поле символов будут сравниваться, так как `SearchType` указывает свойство `StartsWith`.</span><span class="sxs-lookup"><span data-stu-id="e3a95-203">Only as many characters as are entered in the text box will be compared, because the `SearchType` property specifies `StartsWith`.</span></span>

<span data-ttu-id="e3a95-204">`OrderByExpression` Элемент указывает, что результирующий набор будет упорядочен по название курса в название отдела.</span><span class="sxs-lookup"><span data-stu-id="e3a95-204">The `OrderByExpression` element specifies that the result set will be ordered by course title within department name.</span></span> <span data-ttu-id="e3a95-205">Обратите внимание на то, как указывается название отдела: `Department.Name`.</span><span class="sxs-lookup"><span data-stu-id="e3a95-205">Notice how department name is specified: `Department.Name`.</span></span> <span data-ttu-id="e3a95-206">Так как связь между `Course` сущности и `Department` сущности взаимно-однозначное, `Department` свойство навигации содержит `Department` сущности.</span><span class="sxs-lookup"><span data-stu-id="e3a95-206">Because the association between the `Course` entity and the `Department` entity is one-to-one, the `Department` navigation property contains a `Department` entity.</span></span> <span data-ttu-id="e3a95-207">(Если бы это было отношение один ко многим, свойство будет содержать коллекция.) Чтобы получить названия отдела, необходимо указать `Name` свойство `Department` сущности.</span><span class="sxs-lookup"><span data-stu-id="e3a95-207">(If this were a one-to-many relationship, the property would contain a collection.) To get the department name, you must specify the `Name` property of the `Department` entity.</span></span>

<span data-ttu-id="e3a95-208">Наконец, добавьте `GridView` управления для отображения списка курсов:</span><span class="sxs-lookup"><span data-stu-id="e3a95-208">Finally, add a `GridView` control to display the list of courses:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-3/samples/sample8.aspx)]

<span data-ttu-id="e3a95-209">Первый столбец имеет поле шаблона, которое отображает название отдела.</span><span class="sxs-lookup"><span data-stu-id="e3a95-209">The first column is a template field that displays the department name.</span></span> <span data-ttu-id="e3a95-210">Указывает выражение привязки данных `Department.Name`, так же, как видно из `QueryExtender` элемента управления.</span><span class="sxs-lookup"><span data-stu-id="e3a95-210">The databinding expression specifies `Department.Name`, just as you saw in the `QueryExtender` control.</span></span>

<span data-ttu-id="e3a95-211">Откройте страницу.</span><span class="sxs-lookup"><span data-stu-id="e3a95-211">Run the page.</span></span> <span data-ttu-id="e3a95-212">Исходное отображение показывает список курсов, все в порядке по отделам, а затем по название курса.</span><span class="sxs-lookup"><span data-stu-id="e3a95-212">The initial display shows a list of all courses in order by department and then by course title.</span></span>

<span data-ttu-id="e3a95-213">[![Image11](the-entity-framework-and-aspnet-getting-started-part-3/_static/image30.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="e3a95-213">[![Image11](the-entity-framework-and-aspnet-getting-started-part-3/_static/image30.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image29.png)</span></span>

<span data-ttu-id="e3a95-214">Введите «m» и нажмите кнопку **поиска** Чтобы просмотреть все курсы, названия которых начинаются с буквы «m» (поиск является не с учетом регистра).</span><span class="sxs-lookup"><span data-stu-id="e3a95-214">Enter an "m" and click **Search** to see all courses whose titles begin with "m" (the search is not case sensitive).</span></span>

<span data-ttu-id="e3a95-215">[![Image12](the-entity-framework-and-aspnet-getting-started-part-3/_static/image32.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="e3a95-215">[![Image12](the-entity-framework-and-aspnet-getting-started-part-3/_static/image32.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image31.png)</span></span>

## <a name="using-the-like-operator-to-filter-data"></a><span data-ttu-id="e3a95-216">Использование оператора «Как» для фильтрации данных</span><span class="sxs-lookup"><span data-stu-id="e3a95-216">Using the "Like" Operator to Filter Data</span></span>

<span data-ttu-id="e3a95-217">Можно достичь эффекта, подобного действию `QueryExtender` элемента управления `StartsWith`, `Contains`, и `EndsWith` поиск типов с помощью `Like` оператор в `EntityDataSource` элемента управления `Where` свойство.</span><span class="sxs-lookup"><span data-stu-id="e3a95-217">You can achieve an effect similar to the `QueryExtender` control's `StartsWith`, `Contains`, and `EndsWith` search types by using a `Like` operator in the `EntityDataSource` control's `Where` property.</span></span> <span data-ttu-id="e3a95-218">В этой части руководства, вы увидите, как использовать `Like` оператора для поиска учащегося по имени.</span><span class="sxs-lookup"><span data-stu-id="e3a95-218">In this part of the tutorial, you'll see how to use the `Like` operator to search for a student by name.</span></span>

<span data-ttu-id="e3a95-219">Откройте *Students.aspx* в **источника** представления.</span><span class="sxs-lookup"><span data-stu-id="e3a95-219">Open *Students.aspx* in **Source** view.</span></span> <span data-ttu-id="e3a95-220">После `GridView` управления, добавьте следующую разметку:</span><span class="sxs-lookup"><span data-stu-id="e3a95-220">After the `GridView` control, add the following markup:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-3/samples/sample9.aspx)]

<span data-ttu-id="e3a95-221">Эта разметка похоже на то, что вы уже видели ранее за исключением `Where` значение свойства.</span><span class="sxs-lookup"><span data-stu-id="e3a95-221">This markup is similar to what you've seen earlier except for the `Where` property value.</span></span> <span data-ttu-id="e3a95-222">Во второй части `Where` выражение определяет поиск подстроки (`LIKE %FirstMidName% or LIKE %LastName%`), выполняет поиск первого и последнего имена для вводятся в текстовом поле.</span><span class="sxs-lookup"><span data-stu-id="e3a95-222">The second part of the `Where` expression defines a substring search (`LIKE %FirstMidName% or LIKE %LastName%`) that searches both the first and last names for whatever is entered in the text box.</span></span>

<span data-ttu-id="e3a95-223">Откройте страницу.</span><span class="sxs-lookup"><span data-stu-id="e3a95-223">Run the page.</span></span> <span data-ttu-id="e3a95-224">Изначально отображаются все учащиеся, так как значение по умолчанию для `StudentName` равен «%».</span><span class="sxs-lookup"><span data-stu-id="e3a95-224">Initially you see all of the students because the default value for the `StudentName` parameter is "%".</span></span>

<span data-ttu-id="e3a95-225">[![Image13](the-entity-framework-and-aspnet-getting-started-part-3/_static/image34.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image33.png)</span><span class="sxs-lookup"><span data-stu-id="e3a95-225">[![Image13](the-entity-framework-and-aspnet-getting-started-part-3/_static/image34.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image33.png)</span></span>

<span data-ttu-id="e3a95-226">Введите букву «g» в текстовом поле и нажмите кнопку **поиска**.</span><span class="sxs-lookup"><span data-stu-id="e3a95-226">Enter the letter "g" in the text box and click **Search**.</span></span> <span data-ttu-id="e3a95-227">Появится список учащихся, которые имеют «g» в либо имени или фамилии.</span><span class="sxs-lookup"><span data-stu-id="e3a95-227">You see a list of students that have a "g" in either the first or last name.</span></span>

<span data-ttu-id="e3a95-228">[![Image14](the-entity-framework-and-aspnet-getting-started-part-3/_static/image36.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="e3a95-228">[![Image14](the-entity-framework-and-aspnet-getting-started-part-3/_static/image36.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image35.png)</span></span>

<span data-ttu-id="e3a95-229">Вы теперь отображаются, обновлены, отфильтрованы, упорядоченные и сгруппированные данные из отдельных таблиц.</span><span class="sxs-lookup"><span data-stu-id="e3a95-229">You've now displayed, updated, filtered, ordered, and grouped data from individual tables.</span></span> <span data-ttu-id="e3a95-230">В следующем руководстве вы начнете работать со связанными данными (сценарии «основной-подробности»).</span><span class="sxs-lookup"><span data-stu-id="e3a95-230">In the next tutorial you'll begin to work with related data (master-detail scenarios).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="e3a95-231">[Назад](the-entity-framework-and-aspnet-getting-started-part-2.md)
> [Вперед](the-entity-framework-and-aspnet-getting-started-part-4.md)</span><span class="sxs-lookup"><span data-stu-id="e3a95-231">[Previous](the-entity-framework-and-aspnet-getting-started-part-2.md)
[Next](the-entity-framework-and-aspnet-getting-started-part-4.md)</span></span>
