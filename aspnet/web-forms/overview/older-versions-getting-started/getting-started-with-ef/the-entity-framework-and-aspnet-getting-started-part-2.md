---
uid: web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-2
title: Начало работы с Entity Framework 4.0 Database First и ASP.NET 4 Web Forms — часть 2 | Документация Майкрософт
author: tdykstra
description: Пример веб-приложение университета Contoso демонстрирует создание приложений веб-форм ASP.NET, с помощью Entity Framework. Пример приложения является...
ms.author: riande
ms.date: 12/03/2010
ms.assetid: fb63a326-a4ae-4b0c-a4f5-412327197216
msc.legacyurl: /web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-2
msc.type: authoredcontent
ms.openlocfilehash: f436044b0887d6b092ab18a6128019aa87747566
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59422308"
---
# <a name="getting-started-with-entity-framework-40-database-first-and-aspnet-4-web-forms---part-2"></a><span data-ttu-id="b2b41-104">Начало работы с Entity Framework 4.0 Database First и ASP.NET 4 Web Forms — часть 2</span><span class="sxs-lookup"><span data-stu-id="b2b41-104">Getting Started with Entity Framework 4.0 Database First and ASP.NET 4 Web Forms - Part 2</span></span>

<span data-ttu-id="b2b41-105">по [том Дайкстра](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="b2b41-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="b2b41-106">Пример веб-приложение университета Contoso демонстрирует создание приложения веб-форм ASP.NET, используя Entity Framework 4.0 и Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="b2b41-106">The Contoso University sample web application demonstrates how to create ASP.NET Web Forms applications using the Entity Framework 4.0 and Visual Studio 2010.</span></span> <span data-ttu-id="b2b41-107">Сведения об этой серии руководств см. в разделе [в первом учебнике серии](the-entity-framework-and-aspnet-getting-started-part-1.md)</span><span class="sxs-lookup"><span data-stu-id="b2b41-107">For information about the tutorial series, see [the first tutorial in the series](the-entity-framework-and-aspnet-getting-started-part-1.md)</span></span>


## <a name="the-entitydatasource-control"></a><span data-ttu-id="b2b41-108">Элемент управления EntityDataSource</span><span class="sxs-lookup"><span data-stu-id="b2b41-108">The EntityDataSource Control</span></span>

<span data-ttu-id="b2b41-109">В предыдущем руководстве вы создали веб-сайт, базу данных и модель данных.</span><span class="sxs-lookup"><span data-stu-id="b2b41-109">In the previous tutorial you created a web site, a database, and a data model.</span></span> <span data-ttu-id="b2b41-110">В этом руководстве вы работаете с `EntityDataSource` элемента управления, предоставляемых ASP.NET для упрощения работы с моделью Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="b2b41-110">In this tutorial you work with the `EntityDataSource` control that ASP.NET provides in order to make it easy to work with an Entity Framework data model.</span></span> <span data-ttu-id="b2b41-111">Вы создадите `GridView` управления для отображения и редактирования данных об учащихся `DetailsView` управления для добавления новых студентов и `DropDownList` управления для выбора подразделения (которая будет использоваться в дальнейшем для отображения связанных курсов).</span><span class="sxs-lookup"><span data-stu-id="b2b41-111">You'll create a `GridView` control for displaying and editing student data, a `DetailsView` control for adding new students, and a `DropDownList` control for selecting a department (which you'll use later for displaying associated courses).</span></span>

<span data-ttu-id="b2b41-112">[![Image20](the-entity-framework-and-aspnet-getting-started-part-2/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="b2b41-112">[![Image20](the-entity-framework-and-aspnet-getting-started-part-2/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image1.png)</span></span>

<span data-ttu-id="b2b41-113">[![Image09](the-entity-framework-and-aspnet-getting-started-part-2/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="b2b41-113">[![Image09](the-entity-framework-and-aspnet-getting-started-part-2/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image3.png)</span></span>

<span data-ttu-id="b2b41-114">[![Image18](the-entity-framework-and-aspnet-getting-started-part-2/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="b2b41-114">[![Image18](the-entity-framework-and-aspnet-getting-started-part-2/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image5.png)</span></span>

<span data-ttu-id="b2b41-115">Обратите внимание, что в этом приложении вы не добавления проверки входных данных на страницы, обновить базу данных и обработка ошибок не будет настолько надежно, как потребовался бы в рабочем приложении.</span><span class="sxs-lookup"><span data-stu-id="b2b41-115">Note that in this application you won't be adding input validation to pages that update the database, and some of the error handling will not be as robust as would be required in a production application.</span></span> <span data-ttu-id="b2b41-116">Который отслеживает руководства, посвященные Entity Framework и предотвращает получение слишком много времени.</span><span class="sxs-lookup"><span data-stu-id="b2b41-116">That keeps the tutorial focused on the Entity Framework and keeps it from getting too long.</span></span> <span data-ttu-id="b2b41-117">Дополнительные сведения о том, как добавить эти функции в приложение, см. в разделе [проверка пользовательского ввода в ASP.NET Web Pages](https://msdn.microsoft.com/library/7kh55542.aspx) и [обработка ошибок в страницах ASP.NET и приложений](https://msdn.microsoft.com/library/w16865z6.aspx).</span><span class="sxs-lookup"><span data-stu-id="b2b41-117">For details about how to add these features to your application, see [Validating User Input in ASP.NET Web Pages](https://msdn.microsoft.com/library/7kh55542.aspx) and [Error Handling in ASP.NET Pages and Applications](https://msdn.microsoft.com/library/w16865z6.aspx).</span></span>

## <a name="adding-and-configuring-the-entitydatasource-control"></a><span data-ttu-id="b2b41-118">Добавление и настройка элемента управления EntityDataSource</span><span class="sxs-lookup"><span data-stu-id="b2b41-118">Adding and Configuring the EntityDataSource Control</span></span>

<span data-ttu-id="b2b41-119">Сначала вы создадите, настроив `EntityDataSource` управления для чтения `Person` сущностей из `People` набора сущностей.</span><span class="sxs-lookup"><span data-stu-id="b2b41-119">You'll begin by configuring an `EntityDataSource` control to read `Person` entities from the `People` entity set.</span></span>

<span data-ttu-id="b2b41-120">Убедитесь, что у вас есть Visual Studio открыта, и что вы работаете с проектом, созданной в первой части.</span><span class="sxs-lookup"><span data-stu-id="b2b41-120">Make sure you have Visual Studio open and that you're working with the project you created in part 1.</span></span> <span data-ttu-id="b2b41-121">Если проект еще не создан, с момента создания модели данных или с момента последнего изменения, внесенные в него, сборку проекта прямо сейчас.</span><span class="sxs-lookup"><span data-stu-id="b2b41-121">If you haven't built the project since you created the data model or since the last change you made to it, build the project now.</span></span> <span data-ttu-id="b2b41-122">Изменения в модель данных не становятся доступными в конструктор до построения проекта.</span><span class="sxs-lookup"><span data-stu-id="b2b41-122">Changes to the data model are not made available to the designer until the project is built.</span></span>

<span data-ttu-id="b2b41-123">Создайте новый веб-страницы с помощью **веб-форма, использующая главную страницу** шаблона и назовите его *Students.aspx*.</span><span class="sxs-lookup"><span data-stu-id="b2b41-123">Create a new web page using the **Web Form using Master Page** template, and name it *Students.aspx*.</span></span>

<span data-ttu-id="b2b41-124">[![Image23](the-entity-framework-and-aspnet-getting-started-part-2/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="b2b41-124">[![Image23](the-entity-framework-and-aspnet-getting-started-part-2/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image7.png)</span></span>

<span data-ttu-id="b2b41-125">Укажите *Site.Master* как Главная страница.</span><span class="sxs-lookup"><span data-stu-id="b2b41-125">Specify *Site.Master* as the master page.</span></span> <span data-ttu-id="b2b41-126">Все страницы, созданные для этих учебников будет использовать эту главную страницу.</span><span class="sxs-lookup"><span data-stu-id="b2b41-126">All of the pages you create for these tutorials will use this master page.</span></span>

<span data-ttu-id="b2b41-127">[![Image24](the-entity-framework-and-aspnet-getting-started-part-2/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="b2b41-127">[![Image24](the-entity-framework-and-aspnet-getting-started-part-2/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image9.png)</span></span>

<span data-ttu-id="b2b41-128">В **источника** просматривать, добавлять `h2` заголовок для `Content` управления с именем `Content2`, как показано в следующем примере:</span><span class="sxs-lookup"><span data-stu-id="b2b41-128">In **Source** view, add an `h2` heading to the `Content` control named `Content2`, as shown in the following example:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample1.aspx)]

<span data-ttu-id="b2b41-129">Из **данных** вкладке **элементов**, перетащите `EntityDataSource` к странице, поместите его под заголовком и измените идентификатор на `StudentsEntityDataSource`:</span><span class="sxs-lookup"><span data-stu-id="b2b41-129">From the **Data** tab of the **Toolbox**, drag an `EntityDataSource` control to the page, drop it below the heading, and change the ID to `StudentsEntityDataSource`:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample2.aspx)]

<span data-ttu-id="b2b41-130">Переключиться в режим **разработки** просмотра, щелкните смарт-тег элемента управления источником данных и нажмите кнопку **Настройка источника данных** для запуска **Настройка источника данных** мастера.</span><span class="sxs-lookup"><span data-stu-id="b2b41-130">Switch to **Design** view, click the data source control's smart tag, and then click **Configure Data Source** to launch the **Configure Data Source** wizard.</span></span>

<span data-ttu-id="b2b41-131">[!["Image01"](the-entity-framework-and-aspnet-getting-started-part-2/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="b2b41-131">[![Image01](the-entity-framework-and-aspnet-getting-started-part-2/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image11.png)</span></span>

<span data-ttu-id="b2b41-132">В **Настройка ObjectContext** шага мастера, выберите **SchoolEntities** как значение для **именованное соединение**и выберите **SchoolEntities**как **DefaultContainerName** значение.</span><span class="sxs-lookup"><span data-stu-id="b2b41-132">In the **Configure ObjectContext** wizard step, select **SchoolEntities** as the value for **Named Connection**, and select **SchoolEntities** as the **DefaultContainerName** value.</span></span> <span data-ttu-id="b2b41-133">Затем нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="b2b41-133">Then click **Next**.</span></span>

<span data-ttu-id="b2b41-134">[![Image02](the-entity-framework-and-aspnet-getting-started-part-2/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="b2b41-134">[![Image02](the-entity-framework-and-aspnet-getting-started-part-2/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image13.png)</span></span>

<span data-ttu-id="b2b41-135">Примечание. Если на этом этапе появится следующее диалоговое окно, необходимо выполнить сборку проекта перед продолжением.</span><span class="sxs-lookup"><span data-stu-id="b2b41-135">Note: If you get the following dialog box at this point, you have to build the project before proceeding.</span></span>

<span data-ttu-id="b2b41-136">[![Image25](the-entity-framework-and-aspnet-getting-started-part-2/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="b2b41-136">[![Image25](the-entity-framework-and-aspnet-getting-started-part-2/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image15.png)</span></span>

<span data-ttu-id="b2b41-137">В **Настройка отбора данных** выберите **людей** как значение для **EntitySetName**.</span><span class="sxs-lookup"><span data-stu-id="b2b41-137">In the **Configure Data Selection** step, select **People** as the value for **EntitySetName**.</span></span> <span data-ttu-id="b2b41-138">В разделе **выберите**, убедитесь, что **выберите объект** ll флажок.</span><span class="sxs-lookup"><span data-stu-id="b2b41-138">Under **Select**, make sure the **Select A** ll check box is selected.</span></span> <span data-ttu-id="b2b41-139">Затем выберите параметры для включения обновления и удаления.</span><span class="sxs-lookup"><span data-stu-id="b2b41-139">Then select the options to enable update and delete.</span></span> <span data-ttu-id="b2b41-140">Когда все будет готово, нажмите кнопку **Готово**.</span><span class="sxs-lookup"><span data-stu-id="b2b41-140">When you're done, click **Finish**.</span></span>

<span data-ttu-id="b2b41-141">[![Image03](the-entity-framework-and-aspnet-getting-started-part-2/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="b2b41-141">[![Image03](the-entity-framework-and-aspnet-getting-started-part-2/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image17.png)</span></span>

## <a name="configuring-database-rules-to-allow-deletion"></a><span data-ttu-id="b2b41-142">Настройка правил базы данных, чтобы разрешить удаление</span><span class="sxs-lookup"><span data-stu-id="b2b41-142">Configuring Database Rules to Allow Deletion</span></span>

<span data-ttu-id="b2b41-143">Вы создадите страницу, которая позволяет пользователям удалить учащихся из `Person` таблицу, которая содержит три связи с другими таблицами (`Course`, `StudentGrade`, и `OfficeAssignment`).</span><span class="sxs-lookup"><span data-stu-id="b2b41-143">You'll be creating a page that lets users delete students from the `Person` table, which has three relationships with other tables (`Course`, `StudentGrade`, and `OfficeAssignment`).</span></span> <span data-ttu-id="b2b41-144">По умолчанию базы данных будет не позволяют удалить строку в `Person` при наличии связанных строк в одной из других таблиц.</span><span class="sxs-lookup"><span data-stu-id="b2b41-144">By default, the database will prevent you from deleting a row in `Person` if there are related rows in one of the other tables.</span></span> <span data-ttu-id="b2b41-145">Можно вручную удалить связанные строки во-первых, или можно настроить базу данных, чтобы удалить их автоматически при удалении `Person` строки.</span><span class="sxs-lookup"><span data-stu-id="b2b41-145">You can manually delete the related rows first, or you can configure the database to delete them automatically when you delete a `Person` row.</span></span> <span data-ttu-id="b2b41-146">Для записей учащихся в этом руководстве вы настроите базы данных, чтобы автоматически удалять связанные данные.</span><span class="sxs-lookup"><span data-stu-id="b2b41-146">For student records in this tutorial, you'll configure the database to delete the related data automatically.</span></span> <span data-ttu-id="b2b41-147">Поскольку учащиеся могут связанные с ней строки только в `StudentGrade` таблицы, необходимо настроить только один из трех связи.</span><span class="sxs-lookup"><span data-stu-id="b2b41-147">Because students can have related rows only in the `StudentGrade` table, you need to configure only one of the three relationships.</span></span>

<span data-ttu-id="b2b41-148">Если вы используете *файл School.mdf* файл, загруженный из проекта, который переходит к этому учебнику, этот раздел можно пропустить, так как эти изменения конфигурации, уже выполнены.</span><span class="sxs-lookup"><span data-stu-id="b2b41-148">If you're using the *School.mdf* file that you downloaded from the project that goes with this tutorial, you can skip this section because these configuration changes have already been done.</span></span> <span data-ttu-id="b2b41-149">Если база данных создана путем выполнения сценария, необходимо Настройте базу данных, выполнив следующие процедуры.</span><span class="sxs-lookup"><span data-stu-id="b2b41-149">If you created the database by running a script, configure the database by performing the following procedures.</span></span>

<span data-ttu-id="b2b41-150">В **обозревателя серверов**, открытие диаграммы базы данных, созданной в первой части.</span><span class="sxs-lookup"><span data-stu-id="b2b41-150">In **Server Explorer**, open the database diagram that you created in part 1.</span></span> <span data-ttu-id="b2b41-151">Щелкните правой кнопкой мыши связь между `Person` и `StudentGrade` (линии между таблицами), а затем выберите **свойства**.</span><span class="sxs-lookup"><span data-stu-id="b2b41-151">Right-click the relationship between `Person` and `StudentGrade` (the line between tables), and then select **Properties**.</span></span>

<span data-ttu-id="b2b41-152">[![Image04](the-entity-framework-and-aspnet-getting-started-part-2/_static/image20.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="b2b41-152">[![Image04](the-entity-framework-and-aspnet-getting-started-part-2/_static/image20.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image19.png)</span></span>

<span data-ttu-id="b2b41-153">В **свойства** окне разверните **спецификация INSERT и UPDATE** и задайте **DeleteRule** свойства **Cascade**.</span><span class="sxs-lookup"><span data-stu-id="b2b41-153">In the **Properties** window, expand **INSERT and UPDATE Specification** and set the **DeleteRule** property to **Cascade**.</span></span>

<span data-ttu-id="b2b41-154">[![Image05](the-entity-framework-and-aspnet-getting-started-part-2/_static/image22.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="b2b41-154">[![Image05](the-entity-framework-and-aspnet-getting-started-part-2/_static/image22.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image21.png)</span></span>

<span data-ttu-id="b2b41-155">Сохраните и закройте диаграмму.</span><span class="sxs-lookup"><span data-stu-id="b2b41-155">Save and close the diagram.</span></span> <span data-ttu-id="b2b41-156">При появлении запроса ли вы хотите обновить базу данных, нажмите кнопку **Да**.</span><span class="sxs-lookup"><span data-stu-id="b2b41-156">If you're asked whether you want to update the database, click **Yes**.</span></span>

<span data-ttu-id="b2b41-157">Чтобы убедиться в том, что модель сохраняет сущности, находящиеся в памяти, в соответствии с действиями базы данных, необходимо задать соответствующие правила в модели данных.</span><span class="sxs-lookup"><span data-stu-id="b2b41-157">To make sure that the model keeps entities that are in memory in sync with what the database is doing, you must set corresponding rules in the data model.</span></span> <span data-ttu-id="b2b41-158">Откройте *SchoolModel.edmx*, щелкните правой кнопкой мыши линию связи между `Person` и `StudentGrade`, а затем выберите **свойства**.</span><span class="sxs-lookup"><span data-stu-id="b2b41-158">Open *SchoolModel.edmx*, right-click the association line between `Person` and `StudentGrade`, and then select **Properties**.</span></span>

<span data-ttu-id="b2b41-159">[![Image21](the-entity-framework-and-aspnet-getting-started-part-2/_static/image24.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="b2b41-159">[![Image21](the-entity-framework-and-aspnet-getting-started-part-2/_static/image24.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image23.png)</span></span>

<span data-ttu-id="b2b41-160">В **свойства** окне **End1 OnDelete** для **Cascade**.</span><span class="sxs-lookup"><span data-stu-id="b2b41-160">In the **Properties** window, set **End1 OnDelete** to **Cascade**.</span></span>

<span data-ttu-id="b2b41-161">[![Image22](the-entity-framework-and-aspnet-getting-started-part-2/_static/image26.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="b2b41-161">[![Image22](the-entity-framework-and-aspnet-getting-started-part-2/_static/image26.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image25.png)</span></span>

<span data-ttu-id="b2b41-162">Сохраните и закройте *SchoolModel.edmx* файл, а затем перестройте проект.</span><span class="sxs-lookup"><span data-stu-id="b2b41-162">Save and close the *SchoolModel.edmx* file, and then rebuild the project.</span></span>

<span data-ttu-id="b2b41-163">В общем случае при изменениях базы данных, есть несколько вариантов для как синхронизировать модель:</span><span class="sxs-lookup"><span data-stu-id="b2b41-163">In general, when the database changes, you have several choices for how to sync up the model:</span></span>

- <span data-ttu-id="b2b41-164">Для некоторых видов изменений (например, добавление или обновление таблицы, представления или хранимые процедуры), щелкните правой кнопкой мыши в конструкторе и выберите пункт **обновить модель из базы данных** чтобы конструктора внесите изменения автоматически.</span><span class="sxs-lookup"><span data-stu-id="b2b41-164">For certain kinds of changes (such as adding or refreshing tables, views, or stored procedures), right-click in the designer and select **Update Model from Database** to have the designer make the changes automatically.</span></span>
- <span data-ttu-id="b2b41-165">Повторное создание модели данных.</span><span class="sxs-lookup"><span data-stu-id="b2b41-165">Regenerate the data model.</span></span>
- <span data-ttu-id="b2b41-166">Выполнять ручные обновления следующего вида.</span><span class="sxs-lookup"><span data-stu-id="b2b41-166">Make manual updates like this one.</span></span>

<span data-ttu-id="b2b41-167">В этом случае могут восстановлены модели или обновлении таблицы, затрагиваемый изменением связи, но затем пришлось бы сделать имя поля (из `FirstName` для `FirstMidName`).</span><span class="sxs-lookup"><span data-stu-id="b2b41-167">In this case, you could have regenerated the model or refreshed the tables affected by the relationship change, but then you'd have to make the field-name change again (from `FirstName` to `FirstMidName`).</span></span>

## <a name="using-a-gridview-control-to-read-and-update-entities"></a><span data-ttu-id="b2b41-168">С помощью элемента управления GridView для чтения и обновления сущностей</span><span class="sxs-lookup"><span data-stu-id="b2b41-168">Using a GridView Control to Read and Update Entities</span></span>

<span data-ttu-id="b2b41-169">В этом разделе вы используете `GridView` элемента управления для отображения, обновить или удалить учащихся.</span><span class="sxs-lookup"><span data-stu-id="b2b41-169">In this section you'll use a `GridView` control to display, update, or delete students.</span></span>

<span data-ttu-id="b2b41-170">Откройте или переключитесь на *Students.aspx* и переключиться в режим **разработки** представления.</span><span class="sxs-lookup"><span data-stu-id="b2b41-170">Open or switch to *Students.aspx* and switch to **Design** view.</span></span> <span data-ttu-id="b2b41-171">Из **данных** вкладке **элементов**, перетащите `GridView` управления справа от `EntityDataSource` управления, назовите его `StudentsGridView`, щелкните смарт-тег и выберите  **StudentsEntityDataSource** как источник данных.</span><span class="sxs-lookup"><span data-stu-id="b2b41-171">From the **Data** tab of the **Toolbox**, drag a `GridView` control to the right of the `EntityDataSource` control, name it `StudentsGridView`, click the smart tag, and then select **StudentsEntityDataSource** as the data source.</span></span>

<span data-ttu-id="b2b41-172">[![Image06](the-entity-framework-and-aspnet-getting-started-part-2/_static/image28.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="b2b41-172">[![Image06](the-entity-framework-and-aspnet-getting-started-part-2/_static/image28.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image27.png)</span></span>

<span data-ttu-id="b2b41-173">Нажмите кнопку **обновить схему** (щелкните **Да** при появлении запроса на подтверждение), затем нажмите кнопку **Enable Paging**, **включить сортировку**, **Включить редактирование**, и **Включение удаления**.</span><span class="sxs-lookup"><span data-stu-id="b2b41-173">Click **Refresh Schema** (click **Yes** if you're prompted to confirm), then click **Enable Paging**, **Enable Sorting**, **Enable Editing**, and **Enable Deleting**.</span></span>

<span data-ttu-id="b2b41-174">Нажмите кнопку **изменить столбцы**.</span><span class="sxs-lookup"><span data-stu-id="b2b41-174">Click **Edit Columns**.</span></span>

<span data-ttu-id="b2b41-175">[![Image10](the-entity-framework-and-aspnet-getting-started-part-2/_static/image30.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="b2b41-175">[![Image10](the-entity-framework-and-aspnet-getting-started-part-2/_static/image30.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image29.png)</span></span>

<span data-ttu-id="b2b41-176">В **выбранные поля** поле, удалите **PersonID**, **LastName**, и **HireDate**.</span><span class="sxs-lookup"><span data-stu-id="b2b41-176">In the **Selected fields** box, delete **PersonID**, **LastName**, and **HireDate**.</span></span> <span data-ttu-id="b2b41-177">Вы обычно не отображать ключа записи для пользователей, дата приема на работу, не имеет значения для учащихся и будет находиться обе части имени в одно поле, поэтому требуется только одно поле имени.)</span><span class="sxs-lookup"><span data-stu-id="b2b41-177">You typically don't display a record key to users, hire date is not relevant to students, and you'll put both parts of the name in one field, so you only need one of the name fields.)</span></span>

<span data-ttu-id="b2b41-178">[![Image11](the-entity-framework-and-aspnet-getting-started-part-2/_static/image32.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="b2b41-178">[![Image11](the-entity-framework-and-aspnet-getting-started-part-2/_static/image32.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image31.png)</span></span>

<span data-ttu-id="b2b41-179">Выберите **FirstMidName** поле и нажмите кнопку **Преобразуйте это поле в TemplateField**.</span><span class="sxs-lookup"><span data-stu-id="b2b41-179">Select the **FirstMidName** field and then click **Convert this field into a TemplateField**.</span></span>

<span data-ttu-id="b2b41-180">Сделайте то же самое **EnrollmentDate**.</span><span class="sxs-lookup"><span data-stu-id="b2b41-180">Do the same for **EnrollmentDate**.</span></span>

<span data-ttu-id="b2b41-181">[![Image13](the-entity-framework-and-aspnet-getting-started-part-2/_static/image34.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image33.png)</span><span class="sxs-lookup"><span data-stu-id="b2b41-181">[![Image13](the-entity-framework-and-aspnet-getting-started-part-2/_static/image34.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image33.png)</span></span>

<span data-ttu-id="b2b41-182">Нажмите кнопку **ОК** и перейдите в **источника** представления.</span><span class="sxs-lookup"><span data-stu-id="b2b41-182">Click **OK** and then switch to **Source** view.</span></span> <span data-ttu-id="b2b41-183">Оставшиеся изменения будет проще выполнить непосредственно в разметке.</span><span class="sxs-lookup"><span data-stu-id="b2b41-183">The remaining changes will be easier to do directly in markup.</span></span> <span data-ttu-id="b2b41-184">`GridView` Управления разметки сейчас выглядит как в следующем примере.</span><span class="sxs-lookup"><span data-stu-id="b2b41-184">The `GridView` control markup now looks like the following example.</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample3.aspx)]

<span data-ttu-id="b2b41-185">В первом столбце, после поле команды — это поле шаблона, который в настоящее время отображается имя.</span><span class="sxs-lookup"><span data-stu-id="b2b41-185">The first column after the command field is a template field that currently displays the first name.</span></span> <span data-ttu-id="b2b41-186">Измените разметку для этого шаблона поля, как показано в следующем примере:</span><span class="sxs-lookup"><span data-stu-id="b2b41-186">Change the markup for this template field to look like the following example:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample4.aspx)]

<span data-ttu-id="b2b41-187">В режиме отображения двух `Label` элементы управления отображают имя и Фамилия.</span><span class="sxs-lookup"><span data-stu-id="b2b41-187">In display mode, two `Label` controls display the first and last name.</span></span> <span data-ttu-id="b2b41-188">В режиме редактирования два текстовых поля, приведенными в можно изменить имя и Фамилия.</span><span class="sxs-lookup"><span data-stu-id="b2b41-188">In edit mode, two text boxes are provided so you can change the first and last name.</span></span> <span data-ttu-id="b2b41-189">Как и в `Label` элементов управления в режим отображения, использовать `Bind` и `Eval` выражениях точно так, как и для ASP.NET источников данных, которые подключаются непосредственно к базам данных.</span><span class="sxs-lookup"><span data-stu-id="b2b41-189">As with the `Label` controls in display mode, you use `Bind` and `Eval` expressions exactly as you would with ASP.NET data source controls that connect directly to databases.</span></span> <span data-ttu-id="b2b41-190">Единственная разница в том, что при указании свойства сущности, а не столбцы базы данных.</span><span class="sxs-lookup"><span data-stu-id="b2b41-190">The only difference is that you're specifying entity properties instead of database columns.</span></span>

<span data-ttu-id="b2b41-191">Последний столбец является шаблон поле, отображающее даты регистрации.</span><span class="sxs-lookup"><span data-stu-id="b2b41-191">The last column is a template field that displays the enrollment date.</span></span> <span data-ttu-id="b2b41-192">Измените разметку для этого поля, как показано в следующем примере:</span><span class="sxs-lookup"><span data-stu-id="b2b41-192">Change the markup for this field to look like the following example:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample5.aspx)]

<span data-ttu-id="b2b41-193">В обоих отображения и изменения режима, строка формата «{0, d}» приводит к даты для отображения в формате «краткий формат даты».</span><span class="sxs-lookup"><span data-stu-id="b2b41-193">In both display and edit mode, the format string "{0,d}" causes the date to be displayed in the "short date" format.</span></span> <span data-ttu-id="b2b41-194">(Компьютер может быть настроен для отображения этот формат отличается от изображения на экране, в этом учебнике.)</span><span class="sxs-lookup"><span data-stu-id="b2b41-194">(Your computer might be configured to display this format differently from the screen images shown in this tutorial.)</span></span>

<span data-ttu-id="b2b41-195">Обратите внимание на то, что в каждом из этих полей шаблона, конструктор использовать `Bind` выражение по умолчанию, но вы изменили, чтобы `Eval` выражение в `ItemTemplate` элементов.</span><span class="sxs-lookup"><span data-stu-id="b2b41-195">Notice that in each of these template fields, the designer used a `Bind` expression by default, but you've changed that to an `Eval` expression in the `ItemTemplate` elements.</span></span> <span data-ttu-id="b2b41-196">`Bind` Выражение делает данные доступными в `GridView` свойства элемента управления в случае, если вам требуется доступ к данным в коде.</span><span class="sxs-lookup"><span data-stu-id="b2b41-196">The `Bind` expression makes the data available in `GridView` control properties in case you need to access the data in code.</span></span> <span data-ttu-id="b2b41-197">На этой странице не нужен доступ к этим данным в коде, чтобы можно было использовать `Eval`, который является более эффективным.</span><span class="sxs-lookup"><span data-stu-id="b2b41-197">In this page you don't need to access this data in code, so you can use `Eval`, which is more efficient.</span></span> <span data-ttu-id="b2b41-198">Дополнительные сведения см. в разделе [получения данных из данных элементов управления](https://weblogs.asp.net/davidfowler/archive/2008/12/12/getting-your-data-out-of-the-data-controls.aspx).</span><span class="sxs-lookup"><span data-stu-id="b2b41-198">For more information, see [Getting your data out of the data controls](https://weblogs.asp.net/davidfowler/archive/2008/12/12/getting-your-data-out-of-the-data-controls.aspx).</span></span>

## <a name="revising-entitydatasource-control-markup-to-improve-performance"></a><span data-ttu-id="b2b41-199">Измените разметку элемента управления EntityDataSource для повышения производительности</span><span class="sxs-lookup"><span data-stu-id="b2b41-199">Revising EntityDataSource Control Markup to Improve Performance</span></span>

<span data-ttu-id="b2b41-200">В разметке для `EntityDataSource` управления, удалите `ConnectionString` и `DefaultContainerName` атрибуты и замените их значением `ContextTypeName="ContosoUniversity.DAL.SchoolEntities"` атрибута.</span><span class="sxs-lookup"><span data-stu-id="b2b41-200">In the markup for the `EntityDataSource` control, remove the `ConnectionString` and `DefaultContainerName` attributes and replace them with a `ContextTypeName="ContosoUniversity.DAL.SchoolEntities"` attribute.</span></span> <span data-ttu-id="b2b41-201">Это изменение, следует убедиться в том случае, каждый раз при создании `EntityDataSource` управления, если не нужно использовать соединение, которое отличается от той, которая жестко задано в классе контекста объекта.</span><span class="sxs-lookup"><span data-stu-id="b2b41-201">This is a change you should make every time you create an `EntityDataSource` control, unless you need to use a connection that is different from the one that's hard-coded in the object context class.</span></span> <span data-ttu-id="b2b41-202">С помощью `ContextTypeName` атрибут предоставляет следующие преимущества:</span><span class="sxs-lookup"><span data-stu-id="b2b41-202">Using the `ContextTypeName` attribute provides the following benefits:</span></span>

- <span data-ttu-id="b2b41-203">Повышенная производительность.</span><span class="sxs-lookup"><span data-stu-id="b2b41-203">Better performance.</span></span> <span data-ttu-id="b2b41-204">Когда `EntityDataSource` управления инициализирует модель данных с помощью `ConnectionString` и `DefaultContainerName` атрибуты, он выполняет дополнительную работу, чтобы загрузить метаданные при каждом запросе.</span><span class="sxs-lookup"><span data-stu-id="b2b41-204">When the `EntityDataSource` control initializes the data model using the `ConnectionString` and `DefaultContainerName` attributes, it performs additional work to load metadata on every request.</span></span> <span data-ttu-id="b2b41-205">Это не является обязательным, если указать `ContextTypeName` атрибута.</span><span class="sxs-lookup"><span data-stu-id="b2b41-205">This isn't necessary if you specify the `ContextTypeName` attribute.</span></span>
- <span data-ttu-id="b2b41-206">Отложенная загрузка включена по умолчанию в классах контекста объектов (таких как `SchoolEntities` в этом руководстве) в Entity Framework 4.0.</span><span class="sxs-lookup"><span data-stu-id="b2b41-206">Lazy loading is turned on by default in generated object context classes (such as `SchoolEntities` in this tutorial) in Entity Framework 4.0.</span></span> <span data-ttu-id="b2b41-207">Это означает, что свойства навигации будут загружены с взаимосвязанными данными автоматически прямо в том случае, когда она нужна.</span><span class="sxs-lookup"><span data-stu-id="b2b41-207">This means that navigation properties are loaded with related data automatically right when you need it.</span></span> <span data-ttu-id="b2b41-208">Отложенная загрузка описан более подробно далее в этом руководстве.</span><span class="sxs-lookup"><span data-stu-id="b2b41-208">Lazy loading is explained in more detail later in this tutorial.</span></span>
- <span data-ttu-id="b2b41-209">Все настройки, которые вы применили к класс контекста объекта (в этом случае `SchoolEntities` класс) будут доступны для элементов управления, использующих `EntityDataSource` элемента управления.</span><span class="sxs-lookup"><span data-stu-id="b2b41-209">Any customizations that you've applied to the object context class (in this case, the `SchoolEntities` class) will be available to controls that use the `EntityDataSource` control.</span></span> <span data-ttu-id="b2b41-210">Настройка класса контекста объекта довольно сложная тема, которая не рассматривается в этой серии руководств.</span><span class="sxs-lookup"><span data-stu-id="b2b41-210">Customizing the object context class is an advanced topic that is not covered in this tutorial series.</span></span> <span data-ttu-id="b2b41-211">Дополнительные сведения см. в разделе [расширение Entity Framework сгенерированным типам](https://msdn.microsoft.com/library/dd456844.aspx).</span><span class="sxs-lookup"><span data-stu-id="b2b41-211">For more information, see [Extending Entity Framework Generated Types](https://msdn.microsoft.com/library/dd456844.aspx).</span></span>

<span data-ttu-id="b2b41-212">Разметка теперь будет выглядеть примерно так (порядок свойств могут отличаться):</span><span class="sxs-lookup"><span data-stu-id="b2b41-212">The markup will now resemble the following example (the order of the properties might be different):</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample6.aspx)]

<span data-ttu-id="b2b41-213">`EnableFlattening` Атрибут ссылается на функцию, которая была нужна в более ранних версиях Entity Framework, так как столбцы внешнего ключа не были доступны в виде свойств.</span><span class="sxs-lookup"><span data-stu-id="b2b41-213">The `EnableFlattening` attribute refers to a feature that was needed in earlier versions of the Entity Framework because foreign key columns were not exposed as entity properties.</span></span> <span data-ttu-id="b2b41-214">Текущая версия дает возможность использовать *ассоциации внешних ключей*, означающее свойств внешнего ключа предоставляются для всех, за исключением многие ко многим ассоциаций.</span><span class="sxs-lookup"><span data-stu-id="b2b41-214">The current version makes it possible to use *foreign key associations*, which means foreign key properties are exposed for all but many-to-many associations.</span></span> <span data-ttu-id="b2b41-215">Если сущности нет свойств внешнего ключа и нет [сложные типы](https://msdn.microsoft.com/library/bb738472.aspx), можно оставить этот атрибут, значение `False`.</span><span class="sxs-lookup"><span data-stu-id="b2b41-215">If your entities have foreign key properties and no [complex types](https://msdn.microsoft.com/library/bb738472.aspx), you can leave this attribute set to `False`.</span></span> <span data-ttu-id="b2b41-216">Не удаляйте атрибута из разметки, так как значение по умолчанию — `True`.</span><span class="sxs-lookup"><span data-stu-id="b2b41-216">Don't remove the attribute from the markup, because the default value is `True`.</span></span> <span data-ttu-id="b2b41-217">Дополнительные сведения см. в разделе [выравнивание объектов (EntityDataSource)](https://msdn.microsoft.com/library/ee404746.aspx).</span><span class="sxs-lookup"><span data-stu-id="b2b41-217">For more information, see [Flattening Objects (EntityDataSource)](https://msdn.microsoft.com/library/ee404746.aspx).</span></span>

<span data-ttu-id="b2b41-218">Запустить эту страницу, и вы увидите список учащихся и сотрудников (выполнить фильтрацию для просто учащихся в следующем учебном курсе).</span><span class="sxs-lookup"><span data-stu-id="b2b41-218">Run the page and you see a list of students and employees (you'll filter for just students in the next tutorial).</span></span> <span data-ttu-id="b2b41-219">Имя и фамилия будут отображаться.</span><span class="sxs-lookup"><span data-stu-id="b2b41-219">The first name and last name are displayed together.</span></span>

<span data-ttu-id="b2b41-220">[![Image07](the-entity-framework-and-aspnet-getting-started-part-2/_static/image36.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="b2b41-220">[![Image07](the-entity-framework-and-aspnet-getting-started-part-2/_static/image36.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image35.png)</span></span>

<span data-ttu-id="b2b41-221">Для сортировки списка, щелкните имя столбца.</span><span class="sxs-lookup"><span data-stu-id="b2b41-221">To sort the display, click a column name.</span></span>

<span data-ttu-id="b2b41-222">Нажмите кнопку **изменить** в любой строке.</span><span class="sxs-lookup"><span data-stu-id="b2b41-222">Click **Edit** in any row.</span></span> <span data-ttu-id="b2b41-223">Текстовые поля отображаются, где можно изменить имя и Фамилия.</span><span class="sxs-lookup"><span data-stu-id="b2b41-223">Text boxes are displayed where you can change the first and last name.</span></span>

<span data-ttu-id="b2b41-224">[![Image08](the-entity-framework-and-aspnet-getting-started-part-2/_static/image38.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="b2b41-224">[![Image08](the-entity-framework-and-aspnet-getting-started-part-2/_static/image38.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image37.png)</span></span>

<span data-ttu-id="b2b41-225">**Удалить** работает кнопка также.</span><span class="sxs-lookup"><span data-stu-id="b2b41-225">The **Delete** button also works.</span></span> <span data-ttu-id="b2b41-226">Для строки, Дата регистрации и строка не отображается, нажмите кнопку "Удалить".</span><span class="sxs-lookup"><span data-stu-id="b2b41-226">Click delete for a row that has an enrollment date and the row disappears.</span></span> <span data-ttu-id="b2b41-227">(Строки без даты регистрации представляют преподавателей и может появиться ошибка ссылочной целостности.</span><span class="sxs-lookup"><span data-stu-id="b2b41-227">(Rows without an enrollment date represent instructors and you may get a referential integrity error.</span></span> <span data-ttu-id="b2b41-228">В следующем учебном курсе вы будете фильтровать этот список, чтобы включить учащихся, точно так же.)</span><span class="sxs-lookup"><span data-stu-id="b2b41-228">In the next tutorial you'll filter this list to include just students.)</span></span>

## <a name="displaying-data-from-a-navigation-property"></a><span data-ttu-id="b2b41-229">Отображение данных из свойства навигации</span><span class="sxs-lookup"><span data-stu-id="b2b41-229">Displaying Data from a Navigation Property</span></span>

<span data-ttu-id="b2b41-230">Теперь предположим, что нужно знать, сколько курсы в регистрации каждого учащегося.</span><span class="sxs-lookup"><span data-stu-id="b2b41-230">Now suppose you want to know how many courses each student is enrolled in.</span></span> <span data-ttu-id="b2b41-231">Платформа Entity Framework предоставляет эту информацию в `StudentGrades` свойство навигации `Person` сущности.</span><span class="sxs-lookup"><span data-stu-id="b2b41-231">The Entity Framework provides that information in the `StudentGrades` navigation property of the `Person` entity.</span></span> <span data-ttu-id="b2b41-232">Поскольку структуры базы данных не допускает учащихся к регистрации в курс без необходимости оценку назначена, в этом руководстве можно предположить, что наличие строки в `StudentGrade` строки таблицы, которая связана с курсом совпадает со значением зарегистрированных в этом курсе.</span><span class="sxs-lookup"><span data-stu-id="b2b41-232">Because the database design does not allow a student to be enrolled in a course without having a grade assigned, for this tutorial you can assume that having a row in the `StudentGrade` table row that is associated with a course is the same as being enrolled in the course.</span></span> <span data-ttu-id="b2b41-233">( `Courses` Свойство навигации является свойством только для преподавателей.)</span><span class="sxs-lookup"><span data-stu-id="b2b41-233">(The `Courses` navigation property is only for instructors.)</span></span>

<span data-ttu-id="b2b41-234">При использовании `ContextTypeName` атрибут `EntityDataSource` элемента управления, Entity Framework автоматически извлекает данные для свойства навигации при доступе к этому свойству.</span><span class="sxs-lookup"><span data-stu-id="b2b41-234">When you use the `ContextTypeName` attribute of the `EntityDataSource` control, the Entity Framework automatically retrieves information for a navigation property when you access that property.</span></span> <span data-ttu-id="b2b41-235">Это называется *отложенная загрузка*.</span><span class="sxs-lookup"><span data-stu-id="b2b41-235">This is called *lazy loading*.</span></span> <span data-ttu-id="b2b41-236">Тем не менее это может быть неэффективным, за счет отдельный вызов к базе данных, необходима дополнительная информация каждый раз.</span><span class="sxs-lookup"><span data-stu-id="b2b41-236">However, this can be inefficient, because it results in a separate call to the database each time additional information is needed.</span></span> <span data-ttu-id="b2b41-237">Если необходимо получить данные из свойства навигации для каждой сущности, возвращенные `EntityDataSource` элемента управления, это более эффективно извлекать данные вместе с самой сущности за один вызов к базе данных.</span><span class="sxs-lookup"><span data-stu-id="b2b41-237">If you need data from the navigation property for every entity returned by the `EntityDataSource` control, it's more efficient to retrieve the related data along with the entity itself in a single call to the database.</span></span> <span data-ttu-id="b2b41-238">Это называется *Безотложная загрузка*, и укажите безотложную загрузку для свойства навигации, задав `Include` свойство `EntityDataSource` элемента управления.</span><span class="sxs-lookup"><span data-stu-id="b2b41-238">This is called *eager loading*, and you specify eager loading for a navigation property by setting the `Include` property of the `EntityDataSource` control.</span></span>

<span data-ttu-id="b2b41-239">В *Students.aspx*, вы хотите отобразить число курсов для каждого учащегося, поэтому Безотложная загрузка является лучшим выбором.</span><span class="sxs-lookup"><span data-stu-id="b2b41-239">In *Students.aspx*, you want to show the number of courses for every student, so eager loading is the best choice.</span></span> <span data-ttu-id="b2b41-240">Если вы отображение всех учащихся, но отображаются количество курсов только для некоторые из них (что потребовало бы написания кода вместе с разметкой), отложенная загрузка может быть лучшим выбором.</span><span class="sxs-lookup"><span data-stu-id="b2b41-240">If you were displaying all students but showing the number of courses only for a few of them (which would require writing some code in addition to the markup), lazy loading might be a better choice.</span></span>

<span data-ttu-id="b2b41-241">Откройте или переключитесь на *Students.aspx*, переключитесь в **разработки** представление, выберите `StudentsEntityDataSource`и в **свойства** задайте **Include**свойства **StudentGrades**.</span><span class="sxs-lookup"><span data-stu-id="b2b41-241">Open or switch to *Students.aspx*, switch to **Design** view, select `StudentsEntityDataSource`, and in the **Properties** window set the **Include** property to **StudentGrades**.</span></span> <span data-ttu-id="b2b41-242">(Если вы хотите получить несколько свойств навигации, можно указать их имена, разделенные запятыми, например, **StudentGrades, курсы**.)</span><span class="sxs-lookup"><span data-stu-id="b2b41-242">(If you wanted to get multiple navigation properties, you could specify their names separated by commas — for example, **StudentGrades, Courses**.)</span></span>

<span data-ttu-id="b2b41-243">[![Image19](the-entity-framework-and-aspnet-getting-started-part-2/_static/image40.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image39.png)</span><span class="sxs-lookup"><span data-stu-id="b2b41-243">[![Image19](the-entity-framework-and-aspnet-getting-started-part-2/_static/image40.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image39.png)</span></span>

<span data-ttu-id="b2b41-244">Переключиться в режим **источника** представления.</span><span class="sxs-lookup"><span data-stu-id="b2b41-244">Switch to **Source** view.</span></span> <span data-ttu-id="b2b41-245">В `StudentsGridView` управления после последнего `asp:TemplateField` элемента, добавьте новое поле шаблона:</span><span class="sxs-lookup"><span data-stu-id="b2b41-245">In the `StudentsGridView` control, after the last `asp:TemplateField` element, add the following new template field:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample7.aspx)]

<span data-ttu-id="b2b41-246">В `Eval` выражения могут ссылаться на свойство навигации `StudentGrades`.</span><span class="sxs-lookup"><span data-stu-id="b2b41-246">In the `Eval` expression, you can reference the navigation property `StudentGrades`.</span></span> <span data-ttu-id="b2b41-247">Так как это свойство содержит коллекцию, он имеет `Count` свойство, которое можно использовать для отображения число курсов, в которых зарегистрирован студент.</span><span class="sxs-lookup"><span data-stu-id="b2b41-247">Because this property contains a collection, it has a `Count` property that you can use to display the number of courses in which the student is enrolled.</span></span> <span data-ttu-id="b2b41-248">В этом руководстве вы увидите, как отобразить данные из свойства навигации, которые содержат отдельные объекты, а не коллекции.</span><span class="sxs-lookup"><span data-stu-id="b2b41-248">In a later tutorial you'll see how to display data from navigation properties that contain single entities instead of collections.</span></span> <span data-ttu-id="b2b41-249">(Обратите внимание, что нельзя использовать `BoundField` элементов для отображения данных из свойства навигации.)</span><span class="sxs-lookup"><span data-stu-id="b2b41-249">(Note that you cannot use `BoundField` elements to display data from navigation properties.)</span></span>

<span data-ttu-id="b2b41-250">Откройте страницу, и теперь вы видите, сколько курсы регистрации учащихся в.</span><span class="sxs-lookup"><span data-stu-id="b2b41-250">Run the page and you now see how many courses each student is enrolled in.</span></span>

<span data-ttu-id="b2b41-251">[![Image20](the-entity-framework-and-aspnet-getting-started-part-2/_static/image42.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image41.png)</span><span class="sxs-lookup"><span data-stu-id="b2b41-251">[![Image20](the-entity-framework-and-aspnet-getting-started-part-2/_static/image42.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image41.png)</span></span>

## <a name="using-a-detailsview-control-to-insert-entities"></a><span data-ttu-id="b2b41-252">С помощью элемента управления DetailsView для вставки сущности</span><span class="sxs-lookup"><span data-stu-id="b2b41-252">Using a DetailsView Control to Insert Entities</span></span>

<span data-ttu-id="b2b41-253">Следующим шагом является создание страницы, `DetailsView` элемент управления, который позволит добавить новые учащиеся.</span><span class="sxs-lookup"><span data-stu-id="b2b41-253">The next step is to create a page that has a `DetailsView` control that will let you add new students.</span></span> <span data-ttu-id="b2b41-254">Закройте браузер, а затем создайте новый веб-страницы с помощью *Site.Master* главной страницы.</span><span class="sxs-lookup"><span data-stu-id="b2b41-254">Close the browser and then create a new web page using the *Site.Master* master page.</span></span> <span data-ttu-id="b2b41-255">Присвойте странице имя *StudentsAdd.aspx*, а затем переключиться в **источника** представления.</span><span class="sxs-lookup"><span data-stu-id="b2b41-255">Name the page *StudentsAdd.aspx*, and then switch to **Source** view.</span></span>

<span data-ttu-id="b2b41-256">Добавьте следующую разметку, чтобы заменить существующую разметку для `Content` управления с именем `Content2`:</span><span class="sxs-lookup"><span data-stu-id="b2b41-256">Add the following markup to replace the existing markup for the `Content` control named `Content2`:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample8.aspx)]

<span data-ttu-id="b2b41-257">Эта разметка создает `EntityDataSource` элемента управления, которая похожа на созданном в *Students.aspx*, за исключением того, он позволяет вставки.</span><span class="sxs-lookup"><span data-stu-id="b2b41-257">This markup creates an `EntityDataSource` control that is similar to the one you created in *Students.aspx*, except it enables insertion.</span></span> <span data-ttu-id="b2b41-258">Как и в `GridView` управления, привязанных полей `DetailsView` управления кодируются, именно так, как они будут для элемента управления данными, который подключается непосредственно к базе данных, за исключением того, что они ссылаются на свойства сущности.</span><span class="sxs-lookup"><span data-stu-id="b2b41-258">As with the `GridView` control, the bound fields of the `DetailsView` control are coded exactly as they would be for a data control that connects directly to a database, except that they reference entity properties.</span></span> <span data-ttu-id="b2b41-259">В этом случае `DetailsView` элемент управления используется только для вставки строк, поэтому выбран режим по умолчанию `Insert`.</span><span class="sxs-lookup"><span data-stu-id="b2b41-259">In this case, the `DetailsView` control is used only for inserting rows, so you have set the default mode to `Insert`.</span></span>

<span data-ttu-id="b2b41-260">Откройте страницу и добавить нового учащегося.</span><span class="sxs-lookup"><span data-stu-id="b2b41-260">Run the page and add a new student.</span></span>

<span data-ttu-id="b2b41-261">[![Image09](the-entity-framework-and-aspnet-getting-started-part-2/_static/image44.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image43.png)</span><span class="sxs-lookup"><span data-stu-id="b2b41-261">[![Image09](the-entity-framework-and-aspnet-getting-started-part-2/_static/image44.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image43.png)</span></span>

<span data-ttu-id="b2b41-262">Ничего не происходит после вставки нового учащегося, но в том случае, если выполнить *Students.aspx*, вы увидите данные нового учащегося.</span><span class="sxs-lookup"><span data-stu-id="b2b41-262">Nothing will happen after you insert a new student, but if you now run *Students.aspx*, you'll see the new student information.</span></span>

## <a name="displaying-data-in-a-drop-down-list"></a><span data-ttu-id="b2b41-263">Отображение данных в раскрывающемся списке</span><span class="sxs-lookup"><span data-stu-id="b2b41-263">Displaying Data in a Drop-Down List</span></span>

<span data-ttu-id="b2b41-264">В следующих шагах будет databind `DropDownList` управления к сущности, заданные с помощью `EntityDataSource` элемента управления.</span><span class="sxs-lookup"><span data-stu-id="b2b41-264">In the following steps you'll databind a `DropDownList` control to an entity set using an `EntityDataSource` control.</span></span> <span data-ttu-id="b2b41-265">В этой части руководства не большая с помощью этого списка.</span><span class="sxs-lookup"><span data-stu-id="b2b41-265">In this part of the tutorial, you won't do much with this list.</span></span> <span data-ttu-id="b2b41-266">В последующих частях, вы используете списка для пользователям предоставляется возможность выбрать подразделение для отображения курсов, связанные с подразделением.</span><span class="sxs-lookup"><span data-stu-id="b2b41-266">In subsequent parts, though, you'll use the list to let users select a department to display courses associated with the department.</span></span>

<span data-ttu-id="b2b41-267">Создание нового веб-страницы с именем *Courses.aspx*.</span><span class="sxs-lookup"><span data-stu-id="b2b41-267">Create a new web page named *Courses.aspx*.</span></span> <span data-ttu-id="b2b41-268">В **источника** просматривать, добавлять заголовок, чтобы `Content` элемент управления, который называется `Content2`:</span><span class="sxs-lookup"><span data-stu-id="b2b41-268">In **Source** view, add a heading to the `Content` control that's named `Content2`:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample9.aspx)]

<span data-ttu-id="b2b41-269">В **разработки** просматривать, добавлять `EntityDataSource` на страницу элемент управления как раньше, но в этом случае имя `DepartmentsEntityDataSource`.</span><span class="sxs-lookup"><span data-stu-id="b2b41-269">In **Design** view, add an `EntityDataSource` control to the page as you did before, except this time name it `DepartmentsEntityDataSource`.</span></span> <span data-ttu-id="b2b41-270">Выберите **отделов** как **EntitySetName** значение и выберите только **DepartmentID** и **имя** свойства.</span><span class="sxs-lookup"><span data-stu-id="b2b41-270">Select **Departments** as the **EntitySetName** value, and select only the **DepartmentID** and **Name** properties.</span></span>

<span data-ttu-id="b2b41-271">[![Image15](the-entity-framework-and-aspnet-getting-started-part-2/_static/image46.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image45.png)</span><span class="sxs-lookup"><span data-stu-id="b2b41-271">[![Image15](the-entity-framework-and-aspnet-getting-started-part-2/_static/image46.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image45.png)</span></span>

<span data-ttu-id="b2b41-272">Из **стандартный** вкладке **элементов**, перетащите `DropDownList` на страницу элемент управления, назовите его `DepartmentsDropDownList`, щелкните смарт-тег и выберите **Выбор источника данных** для Запуск **мастер настройки источника данных**.</span><span class="sxs-lookup"><span data-stu-id="b2b41-272">From the **Standard** tab of the **Toolbox**, drag a `DropDownList` control to the page, name it `DepartmentsDropDownList`, click the smart tag, and select **Choose Data Source** to start the **DataSource Configuration Wizard**.</span></span>

<span data-ttu-id="b2b41-273">[![Image16](the-entity-framework-and-aspnet-getting-started-part-2/_static/image48.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image47.png)</span><span class="sxs-lookup"><span data-stu-id="b2b41-273">[![Image16](the-entity-framework-and-aspnet-getting-started-part-2/_static/image48.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image47.png)</span></span>

<span data-ttu-id="b2b41-274">В **Выбор источника данных** выберите **DepartmentsEntityDataSource** как источник данных, нажмите кнопку **обновить схему**, а затем выберите **имя** как поле данных для отображения и **DepartmentID** как поле значений данных.</span><span class="sxs-lookup"><span data-stu-id="b2b41-274">In the **Choose a Data Source** step, select **DepartmentsEntityDataSource** as the data source, click **Refresh Schema**, and then select **Name** as the data field to display and **DepartmentID** as the value data field.</span></span> <span data-ttu-id="b2b41-275">Нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="b2b41-275">Click **OK**.</span></span>

<span data-ttu-id="b2b41-276">[![Image17](the-entity-framework-and-aspnet-getting-started-part-2/_static/image50.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image49.png)</span><span class="sxs-lookup"><span data-stu-id="b2b41-276">[![Image17](the-entity-framework-and-aspnet-getting-started-part-2/_static/image50.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image49.png)</span></span>

<span data-ttu-id="b2b41-277">Метод, используемый databind элемента управления, используя Entity Framework совпадает с другими данными ASP.NET элементов управления источниками, за исключением того, вы при указании сущности и свойства сущности.</span><span class="sxs-lookup"><span data-stu-id="b2b41-277">The method you use to databind the control using the Entity Framework is the same as with other ASP.NET data source controls except you're specifying entities and entity properties.</span></span>

<span data-ttu-id="b2b41-278">Переключиться в режим **источника** просмотра и добавления «выбрать отдел:» непосредственно перед `DropDownList` элемента управления.</span><span class="sxs-lookup"><span data-stu-id="b2b41-278">Switch to **Source** view and add "Select a department:" immediately before the `DropDownList` control.</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample10.aspx)]

<span data-ttu-id="b2b41-279">Напоминаем, измените разметку для `EntityDataSource` управления на этом этапе, заменив `ConnectionString` и `DefaultContainerName` атрибуты с помощью `ContextTypeName="ContosoUniversity.DAL.SchoolEntities"` атрибута.</span><span class="sxs-lookup"><span data-stu-id="b2b41-279">As a reminder, change the markup for the `EntityDataSource` control at this point by replacing the `ConnectionString` and `DefaultContainerName` attributes with a `ContextTypeName="ContosoUniversity.DAL.SchoolEntities"` attribute.</span></span> <span data-ttu-id="b2b41-280">Часто лучше дождаться, когда вы создали элемент управления с привязкой к данным, связанного с элементом управления источником данных перед изменением `EntityDataSource` -разметке элементов управления, так как после внесения изменений, конструктор не предоставляет с **обновления Схемы** параметр в элементе управления с привязкой к данным.</span><span class="sxs-lookup"><span data-stu-id="b2b41-280">It's often best to wait until after you've created the data-bound control that is linked to the data source control before you change the `EntityDataSource` control markup, because after you make the change, the designer will not provide you with a **Refresh Schema** option in the data-bound control.</span></span>

<span data-ttu-id="b2b41-281">Откройте страницу, и в раскрывающемся списке можно выбрать отдел.</span><span class="sxs-lookup"><span data-stu-id="b2b41-281">Run the page and you can select a department from the drop-down list.</span></span>

<span data-ttu-id="b2b41-282">[![Image18](the-entity-framework-and-aspnet-getting-started-part-2/_static/image52.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image51.png)</span><span class="sxs-lookup"><span data-stu-id="b2b41-282">[![Image18](the-entity-framework-and-aspnet-getting-started-part-2/_static/image52.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image51.png)</span></span>

<span data-ttu-id="b2b41-283">На этом завершается введение в использование `EntityDataSource` элемента управления.</span><span class="sxs-lookup"><span data-stu-id="b2b41-283">This completes the introduction to using the `EntityDataSource` control.</span></span> <span data-ttu-id="b2b41-284">Работа с этот элемент управления обычно не отличается от работы с другими данными ASP.NET элементов управления источниками, за исключением того, что вы ссылаетесь, сущности и свойства, а не таблиц и столбцов.</span><span class="sxs-lookup"><span data-stu-id="b2b41-284">Working with this control is generally no different from working with other ASP.NET data source controls, except that you reference entities and properties instead of tables and columns.</span></span> <span data-ttu-id="b2b41-285">Единственное исключение — если вы хотите получить доступ к свойствам навигации.</span><span class="sxs-lookup"><span data-stu-id="b2b41-285">The only exception is when you want to access navigation properties.</span></span> <span data-ttu-id="b2b41-286">В следующем учебном курсе вы увидите, что синтаксис, используемом с `EntityDataSource` управления также может отличаться от других элементов управления источниками данных, если фильтрация, группирование и упорядочивания данных.</span><span class="sxs-lookup"><span data-stu-id="b2b41-286">In the next tutorial you'll see that the syntax you use with `EntityDataSource` control might also differ from other data source controls when you filter, group, and order data.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="b2b41-287">[Назад](the-entity-framework-and-aspnet-getting-started-part-1.md)
> [Вперед](the-entity-framework-and-aspnet-getting-started-part-3.md)</span><span class="sxs-lookup"><span data-stu-id="b2b41-287">[Previous](the-entity-framework-and-aspnet-getting-started-part-1.md)
[Next](the-entity-framework-and-aspnet-getting-started-part-3.md)</span></span>
