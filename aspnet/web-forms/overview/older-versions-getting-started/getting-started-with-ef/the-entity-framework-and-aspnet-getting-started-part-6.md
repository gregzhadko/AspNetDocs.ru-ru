---
uid: web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-6
title: Начало работы с Entity Framework 4,0 Database First и веб-форм ASP.NET 4. часть 6 | Документация Майкрософт
author: tdykstra
description: Пример веб-приложения Contoso университета демонстрирует создание приложений ASP.NET Web Forms с помощью Entity Framework. Пример приложения:...
ms.author: riande
ms.date: 12/03/2010
ms.assetid: 994a5496-c648-4830-b03c-55bb43f325d2
msc.legacyurl: /web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-6
msc.type: authoredcontent
ms.openlocfilehash: 8bfbe74f90eb03ea9aab7610842ef2578e80d113
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78454920"
---
# <a name="getting-started-with-entity-framework-40-database-first-and-aspnet-4-web-forms---part-6"></a><span data-ttu-id="bf05c-104">Начало работы с Entity Framework 4,0 Database First и веб-форм ASP.NET 4. часть 6</span><span class="sxs-lookup"><span data-stu-id="bf05c-104">Getting Started with Entity Framework 4.0 Database First and ASP.NET 4 Web Forms - Part 6</span></span>

<span data-ttu-id="bf05c-105">от [Tom Dykstra)](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="bf05c-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="bf05c-106">Пример веб-приложения университета Contoso демонстрирует создание приложений ASP.NET Web Forms с помощью Entity Framework 4,0 и Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="bf05c-106">The Contoso University sample web application demonstrates how to create ASP.NET Web Forms applications using the Entity Framework 4.0 and Visual Studio 2010.</span></span> <span data-ttu-id="bf05c-107">Сведения о серии руководств см. в [первом учебнике серии](the-entity-framework-and-aspnet-getting-started-part-1.md) .</span><span class="sxs-lookup"><span data-stu-id="bf05c-107">For information about the tutorial series, see [the first tutorial in the series](the-entity-framework-and-aspnet-getting-started-part-1.md)</span></span>

## <a name="implementing-table-per-hierarchy-inheritance"></a><span data-ttu-id="bf05c-108">Реализация наследования типа «одна таблица на иерархию»</span><span class="sxs-lookup"><span data-stu-id="bf05c-108">Implementing Table-per-Hierarchy Inheritance</span></span>

<span data-ttu-id="bf05c-109">В предыдущем руководстве вы работали с связанными данными, добавляя и удаляя связи и добавляя новую сущность, имеющую связь с существующей сущностью.</span><span class="sxs-lookup"><span data-stu-id="bf05c-109">In the previous tutorial you worked with related data by adding and deleting relationships and by adding a new entity that had a relationship to an existing entity.</span></span> <span data-ttu-id="bf05c-110">В этом учебнике демонстрируется, как реализовать наследование в модели данных.</span><span class="sxs-lookup"><span data-stu-id="bf05c-110">This tutorial will show you how to implement inheritance in the data model.</span></span>

<span data-ttu-id="bf05c-111">В объектно-ориентированном программировании можно использовать наследование, чтобы упростить работу с связанными классами.</span><span class="sxs-lookup"><span data-stu-id="bf05c-111">In object-oriented programming, you can use inheritance to make it easier to work with related classes.</span></span> <span data-ttu-id="bf05c-112">Например, можно создать классы `Instructor` и `Student`, производные от базового класса `Person`.</span><span class="sxs-lookup"><span data-stu-id="bf05c-112">For example, you could create `Instructor` and `Student` classes that derive from a `Person` base class.</span></span> <span data-ttu-id="bf05c-113">Вы можете создавать одни и те же структуры наследования между сущностями в Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="bf05c-113">You can create the same kinds of inheritance structures among entities in the Entity Framework.</span></span>

<span data-ttu-id="bf05c-114">В этой части руководства вы не создадите новые веб-страницы.</span><span class="sxs-lookup"><span data-stu-id="bf05c-114">In this part of the tutorial, you won't create any new web pages.</span></span> <span data-ttu-id="bf05c-115">Вместо этого необходимо добавить Производные сущности в модель данных и изменить существующие страницы для использования новых сущностей.</span><span class="sxs-lookup"><span data-stu-id="bf05c-115">Instead, you'll add derived entities to the data model and modify existing pages to use the new entities.</span></span>

## <a name="table-per-hierarchy-versus-table-per-type-inheritance"></a><span data-ttu-id="bf05c-116">Таблица на иерархию и наследование типа «таблица на тип»</span><span class="sxs-lookup"><span data-stu-id="bf05c-116">Table-per-Hierarchy versus Table-per-Type Inheritance</span></span>

<span data-ttu-id="bf05c-117">База данных может хранить сведения о связанных объектах в одной таблице или в нескольких таблицах.</span><span class="sxs-lookup"><span data-stu-id="bf05c-117">A database can store information about related objects in one table or in multiple tables.</span></span> <span data-ttu-id="bf05c-118">Например, в `School` базе данных `Person` таблица содержит сведения о студентах и преподавателях в одной таблице.</span><span class="sxs-lookup"><span data-stu-id="bf05c-118">For example, in the `School` database, the `Person` table includes information about both students and instructors in a single table.</span></span> <span data-ttu-id="bf05c-119">Некоторые из столбцов относятся только к преподавателям (`HireDate`), только к учащимся (`EnrollmentDate`) и к обеим (`LastName`, `FirstName`).</span><span class="sxs-lookup"><span data-stu-id="bf05c-119">Some of the columns apply only to instructors (`HireDate`), some only to students (`EnrollmentDate`), and some to both (`LastName`, `FirstName`).</span></span>

<span data-ttu-id="bf05c-120">[![image11](the-entity-framework-and-aspnet-getting-started-part-6/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="bf05c-120">[![image11](the-entity-framework-and-aspnet-getting-started-part-6/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image1.png)</span></span>

<span data-ttu-id="bf05c-121">Можно настроить Entity Framework для создания сущностей `Instructor` и `Student`, которые наследуют от сущности `Person`.</span><span class="sxs-lookup"><span data-stu-id="bf05c-121">You can configure the Entity Framework to create `Instructor` and `Student` entities that inherit from the `Person` entity.</span></span> <span data-ttu-id="bf05c-122">Этот шаблон создания структуры наследования сущностей из одной таблицы базы данных называется наследованием типа «одна *таблица на иерархию* ».</span><span class="sxs-lookup"><span data-stu-id="bf05c-122">This pattern of generating an entity inheritance structure from a single database table is called *table-per-hierarchy* (TPH) inheritance.</span></span>

<span data-ttu-id="bf05c-123">Для курсов `School` база данных использует другой шаблон.</span><span class="sxs-lookup"><span data-stu-id="bf05c-123">For courses, the `School` database uses a different pattern.</span></span> <span data-ttu-id="bf05c-124">Онлайн-курсы и курсы на сайте хранятся в отдельных таблицах, каждый из которых имеет внешний ключ, указывающий на `Course` таблицу.</span><span class="sxs-lookup"><span data-stu-id="bf05c-124">Online courses and onsite courses are stored in separate tables, each of which has a foreign key that points to the `Course` table.</span></span> <span data-ttu-id="bf05c-125">Сведения, общие для обоих типов курсов, хранятся только в таблице `Course`.</span><span class="sxs-lookup"><span data-stu-id="bf05c-125">Information common to both course types is stored only in the `Course` table.</span></span>

<span data-ttu-id="bf05c-126">[![image12](the-entity-framework-and-aspnet-getting-started-part-6/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="bf05c-126">[![image12](the-entity-framework-and-aspnet-getting-started-part-6/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image3.png)</span></span>

<span data-ttu-id="bf05c-127">Модель данных Entity Framework можно настроить таким образом, чтобы сущности `OnlineCourse` и `OnsiteCourse` наследовались от сущности `Course`.</span><span class="sxs-lookup"><span data-stu-id="bf05c-127">You can configure the Entity Framework data model so that `OnlineCourse` and `OnsiteCourse` entities inherit from the `Course` entity.</span></span> <span data-ttu-id="bf05c-128">Этот шаблон создания структуры наследования сущностей из отдельных таблиц для каждого типа, при котором каждая отдельная таблица, ссылающаяся обратно на таблицу, в которой хранятся данные, общие для всех типов, называется наследованием *таблицы на тип* (TPT).</span><span class="sxs-lookup"><span data-stu-id="bf05c-128">This pattern of generating an entity inheritance structure from separate tables for each type, with each separate table referring back to a table that stores data common to all types, is called *table per type* (TPT) inheritance.</span></span>

<span data-ttu-id="bf05c-129">Шаблоны наследования, как правило, обеспечивают лучшую производительность в Entity Framework, чем шаблоны наследования TPT, так как шаблоны TPT могут привести к созданию сложных запросов JOIN.</span><span class="sxs-lookup"><span data-stu-id="bf05c-129">TPH inheritance patterns generally deliver better performance in the Entity Framework than TPT inheritance patterns, because TPT patterns can result in complex join queries.</span></span> <span data-ttu-id="bf05c-130">В этом пошаговом руководстве показано, как реализовать наследование «подтаблица».</span><span class="sxs-lookup"><span data-stu-id="bf05c-130">This walkthrough demonstrates how to implement TPH inheritance.</span></span> <span data-ttu-id="bf05c-131">Это можно сделать, выполнив следующие действия.</span><span class="sxs-lookup"><span data-stu-id="bf05c-131">You'll do that by performing the following steps:</span></span>

- <span data-ttu-id="bf05c-132">Создание `Instructor` и `Student` типов сущностей, производных от `Person`.</span><span class="sxs-lookup"><span data-stu-id="bf05c-132">Create `Instructor` and `Student` entity types that derive from `Person`.</span></span>
- <span data-ttu-id="bf05c-133">Переместите свойства, относящиеся к производным сущностям из сущности `Person`, в производные сущности.</span><span class="sxs-lookup"><span data-stu-id="bf05c-133">Move properties that pertain to the derived entities from the `Person` entity to the derived entities.</span></span>
- <span data-ttu-id="bf05c-134">Задайте ограничения для свойств в производных типах.</span><span class="sxs-lookup"><span data-stu-id="bf05c-134">Set constraints on properties in the derived types.</span></span>
- <span data-ttu-id="bf05c-135">Сделайте `Person` сущностью абстрактной сущностью.</span><span class="sxs-lookup"><span data-stu-id="bf05c-135">Make the `Person` entity an abstract entity.</span></span>
- <span data-ttu-id="bf05c-136">Сопоставьте каждую производную сущность с `Person` таблицей с условием, определяющим, как определить, представляет ли строка `Person` производный тип.</span><span class="sxs-lookup"><span data-stu-id="bf05c-136">Map each derived entity to the `Person` table with a condition that specifies how to determine whether a `Person` row represents that derived type.</span></span>

## <a name="adding-instructor-and-student-entities"></a><span data-ttu-id="bf05c-137">Добавление сущностей инструкторов и учащихся</span><span class="sxs-lookup"><span data-stu-id="bf05c-137">Adding Instructor and Student Entities</span></span>

<span data-ttu-id="bf05c-138">Откройте файл <em>счулмодел. EDMX</em> , щелкните правой кнопкой мыши незанятую область в конструкторе, выберите <strong>Добавить</strong>, а затем выберите <strong>сущность</strong><em>.</em></span><span class="sxs-lookup"><span data-stu-id="bf05c-138">Open the <em>SchoolModel.edmx</em> file, right-click an unoccupied area in the designer, select <strong>Add</strong>, then select <strong>Entity</strong><em>.</em></span></span>

<span data-ttu-id="bf05c-139">[![image01](the-entity-framework-and-aspnet-getting-started-part-6/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="bf05c-139">[![image01](the-entity-framework-and-aspnet-getting-started-part-6/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image5.png)</span></span>

<span data-ttu-id="bf05c-140">В диалоговом окне **Добавление сущности** назовите сущность `Instructor` и присвойте параметру **базового типа** значение `Person`.</span><span class="sxs-lookup"><span data-stu-id="bf05c-140">In the **Add Entity** dialog box, name the entity `Instructor` and set its **Base type** option to `Person`.</span></span>

<span data-ttu-id="bf05c-141">[![image02](the-entity-framework-and-aspnet-getting-started-part-6/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="bf05c-141">[![image02](the-entity-framework-and-aspnet-getting-started-part-6/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image7.png)</span></span>

<span data-ttu-id="bf05c-142">Нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="bf05c-142">Click **OK**.</span></span> <span data-ttu-id="bf05c-143">Конструктор создает сущность `Instructor`, производную от сущности `Person`.</span><span class="sxs-lookup"><span data-stu-id="bf05c-143">The designer creates an `Instructor` entity that derives from the `Person` entity.</span></span> <span data-ttu-id="bf05c-144">Новая сущность еще не имеет свойств.</span><span class="sxs-lookup"><span data-stu-id="bf05c-144">The new entity does not yet have any properties.</span></span>

<span data-ttu-id="bf05c-145">[![image03](the-entity-framework-and-aspnet-getting-started-part-6/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="bf05c-145">[![image03](the-entity-framework-and-aspnet-getting-started-part-6/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image9.png)</span></span>

<span data-ttu-id="bf05c-146">Повторите процедуру, чтобы создать сущность `Student`, которая также является производной от `Person`.</span><span class="sxs-lookup"><span data-stu-id="bf05c-146">Repeat the procedure to create a `Student` entity that also derives from `Person`.</span></span>

<span data-ttu-id="bf05c-147">Только преподаватели имеют даты найма, поэтому необходимо переместить это свойство из сущности `Person` в сущность `Instructor`.</span><span class="sxs-lookup"><span data-stu-id="bf05c-147">Only instructors have hire dates, so you need to move that property from the `Person` entity to the `Instructor` entity.</span></span> <span data-ttu-id="bf05c-148">В `Person` сущности щелкните правой кнопкой мыши свойство `HireDate` и выберите команду **Вырезать**.</span><span class="sxs-lookup"><span data-stu-id="bf05c-148">In the `Person` entity, right-click the `HireDate` property and click **Cut**.</span></span> <span data-ttu-id="bf05c-149">Затем щелкните правой кнопкой мыши **Свойства** в сущности `Instructor` и выберите команду **Вставить**.</span><span class="sxs-lookup"><span data-stu-id="bf05c-149">Then right-click **Properties** in the `Instructor` entity and click **Paste**.</span></span>

<span data-ttu-id="bf05c-150">[![image04](the-entity-framework-and-aspnet-getting-started-part-6/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="bf05c-150">[![image04](the-entity-framework-and-aspnet-getting-started-part-6/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image11.png)</span></span>

<span data-ttu-id="bf05c-151">Дата найма `Instructor` сущности не может быть неопределенной.</span><span class="sxs-lookup"><span data-stu-id="bf05c-151">The hire date of an `Instructor` entity cannot be null.</span></span> <span data-ttu-id="bf05c-152">Щелкните правой кнопкой мыши свойство `HireDate`, выберите пункт **Свойства**, а затем в окне **свойства** измените `Nullable` на `False`.</span><span class="sxs-lookup"><span data-stu-id="bf05c-152">Right-click the `HireDate` property, click **Properties**, and then in the **Properties** window change `Nullable` to `False`.</span></span>

<span data-ttu-id="bf05c-153">[![image05](the-entity-framework-and-aspnet-getting-started-part-6/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="bf05c-153">[![image05](the-entity-framework-and-aspnet-getting-started-part-6/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image13.png)</span></span>

<span data-ttu-id="bf05c-154">Повторите процедуру, чтобы переместить свойство `EnrollmentDate` из сущности `Person` в сущность `Student`.</span><span class="sxs-lookup"><span data-stu-id="bf05c-154">Repeat the procedure to move the `EnrollmentDate` property from the `Person` entity to the `Student` entity.</span></span> <span data-ttu-id="bf05c-155">Убедитесь, что для свойства `EnrollmentDate` также задано значение `False` `Nullable`.</span><span class="sxs-lookup"><span data-stu-id="bf05c-155">Make sure that you also set `Nullable` to `False` for the `EnrollmentDate` property.</span></span>

<span data-ttu-id="bf05c-156">Теперь, когда сущность `Person` имеет только те свойства, которые являются общими для `Instructor` и `Student` сущностей (помимо свойств навигации, которые вы не перемещаете), сущность может использоваться только в качестве базовой сущности в структуре наследования.</span><span class="sxs-lookup"><span data-stu-id="bf05c-156">Now that a `Person` entity has only the properties that are common to `Instructor` and `Student` entities (aside from navigation properties, which you're not moving), the entity can only be used as a base entity in the inheritance structure.</span></span> <span data-ttu-id="bf05c-157">Поэтому необходимо убедиться, что она никогда не будет рассматриваться как независимая сущность.</span><span class="sxs-lookup"><span data-stu-id="bf05c-157">Therefore, you need to ensure that it's never treated as an independent entity.</span></span> <span data-ttu-id="bf05c-158">Щелкните правой кнопкой мыши сущность `Person`, выберите пункт **Свойства**, а затем в окне **Свойства** измените значение свойства **abstract** на **true**.</span><span class="sxs-lookup"><span data-stu-id="bf05c-158">Right-click the `Person` entity, select **Properties**, and then in the **Properties** window change the value of the **Abstract** property to **True**.</span></span>

<span data-ttu-id="bf05c-159">[![image06](the-entity-framework-and-aspnet-getting-started-part-6/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="bf05c-159">[![image06](the-entity-framework-and-aspnet-getting-started-part-6/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image15.png)</span></span>

## <a name="mapping-instructor-and-student-entities-to-the-person-table"></a><span data-ttu-id="bf05c-160">Сопоставление сущностей инструктора и учащихся с таблицей Person</span><span class="sxs-lookup"><span data-stu-id="bf05c-160">Mapping Instructor and Student Entities to the Person Table</span></span>

<span data-ttu-id="bf05c-161">Теперь необходимо сообщить Entity Framework, как различать `Instructor` и `Student` сущности в базе данных.</span><span class="sxs-lookup"><span data-stu-id="bf05c-161">Now you need to tell the Entity Framework how to differentiate between `Instructor` and `Student` entities in the database.</span></span>

<span data-ttu-id="bf05c-162">Щелкните правой кнопкой мыши сущность `Instructor` и выберите пункт **Сопоставление таблиц**.</span><span class="sxs-lookup"><span data-stu-id="bf05c-162">Right-click the `Instructor` entity and select **Table Mapping**.</span></span> <span data-ttu-id="bf05c-163">В окне **сведения о сопоставлении** щелкните **Добавить таблицу или представление** и выберите **Person**.</span><span class="sxs-lookup"><span data-stu-id="bf05c-163">In the **Mapping Details** window, click **Add a Table or View** and select **Person**.</span></span>

<span data-ttu-id="bf05c-164">[![image07](the-entity-framework-and-aspnet-getting-started-part-6/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="bf05c-164">[![image07](the-entity-framework-and-aspnet-getting-started-part-6/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image17.png)</span></span>

<span data-ttu-id="bf05c-165">Нажмите кнопку **Добавить условие**, а затем выберите **HireDate**.</span><span class="sxs-lookup"><span data-stu-id="bf05c-165">Click **Add a Condition**, and then select **HireDate**.</span></span>

<span data-ttu-id="bf05c-166">[![image09](the-entity-framework-and-aspnet-getting-started-part-6/_static/image20.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="bf05c-166">[![image09](the-entity-framework-and-aspnet-getting-started-part-6/_static/image20.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image19.png)</span></span>

<span data-ttu-id="bf05c-167">Измените **оператор** на **is** , а **значение или свойство** — на **NOT NULL**.</span><span class="sxs-lookup"><span data-stu-id="bf05c-167">Change **Operator** to **Is** and **Value / Property** to **Not Null**.</span></span>

<span data-ttu-id="bf05c-168">[![image10](the-entity-framework-and-aspnet-getting-started-part-6/_static/image22.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="bf05c-168">[![image10](the-entity-framework-and-aspnet-getting-started-part-6/_static/image22.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image21.png)</span></span>

<span data-ttu-id="bf05c-169">Повторите процедуру для сущности `Students`, указав, что эта сущность сопоставляется с `Person` таблицей, если столбец `EnrollmentDate` не равен null.</span><span class="sxs-lookup"><span data-stu-id="bf05c-169">Repeat the procedure for the `Students` entity, specifying that this entity maps to the `Person` table when the `EnrollmentDate` column is not null.</span></span> <span data-ttu-id="bf05c-170">Затем сохраните и закройте модель данных.</span><span class="sxs-lookup"><span data-stu-id="bf05c-170">Then save and close the data model.</span></span>

<span data-ttu-id="bf05c-171">Выполните сборку проекта, чтобы создать новые сущности в качестве классов и сделать их доступными в конструкторе.</span><span class="sxs-lookup"><span data-stu-id="bf05c-171">Build the project in order to create the new entities as classes and make them available in the designer.</span></span>

## <a name="using-the-instructor-and-student-entities"></a><span data-ttu-id="bf05c-172">Использование сущностей преподавателей и учащихся</span><span class="sxs-lookup"><span data-stu-id="bf05c-172">Using the Instructor and Student Entities</span></span>

<span data-ttu-id="bf05c-173">При создании веб-страниц, работающих с данными учащихся и преподавателей, вы привязываете их к `Person` набору сущностей и фильтруете по свойству `HireDate` или `EnrollmentDate`, чтобы ограничить возвращаемые данные студентам или преподавателям.</span><span class="sxs-lookup"><span data-stu-id="bf05c-173">When you created the web pages that work with student and instructor data, you databound them to the `Person` entity set, and you filtered on the `HireDate` or `EnrollmentDate` property to restrict the returned data to students or instructors.</span></span> <span data-ttu-id="bf05c-174">Однако теперь при привязке каждого элемента управления источниками данных к `Person` набору сущностей можно указать, что должны быть выбраны только типы сущностей `Student` или `Instructor`.</span><span class="sxs-lookup"><span data-stu-id="bf05c-174">However, now when you bind each data source control to the `Person` entity set, you can specify that only `Student` or `Instructor` entity types should be selected.</span></span> <span data-ttu-id="bf05c-175">Поскольку Entity Framework знает, как отличать учащихся и преподавателей в `Person`ном наборе сущностей, вы можете удалить параметры свойства `Where`, введенные вручную.</span><span class="sxs-lookup"><span data-stu-id="bf05c-175">Because the Entity Framework knows how to differentiate students and instructors in the `Person` entity set, you can remove the `Where` property settings you entered manually to do that.</span></span>

<span data-ttu-id="bf05c-176">В конструкторе Visual Studio можно указать тип сущности, который должен выбрать элемент управления `EntityDataSource` в раскрывающемся списке **EntityTypeFilter** мастера `Configure Data Source`, как показано в следующем примере.</span><span class="sxs-lookup"><span data-stu-id="bf05c-176">In the Visual Studio Designer, you can specify the entity type that an `EntityDataSource` control should select in the **EntityTypeFilter** drop-down box of the `Configure Data Source` wizard, as shown in the following example.</span></span>

<span data-ttu-id="bf05c-177">[![image13](the-entity-framework-and-aspnet-getting-started-part-6/_static/image24.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="bf05c-177">[![image13](the-entity-framework-and-aspnet-getting-started-part-6/_static/image24.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image23.png)</span></span>

<span data-ttu-id="bf05c-178">Кроме того, в окне " **Свойства** " можно удалить значения `Where` предложения, которые больше не нужны, как показано в следующем примере.</span><span class="sxs-lookup"><span data-stu-id="bf05c-178">And in the **Properties** window you can remove `Where` clause values that are no longer needed, as shown in the following example.</span></span>

<span data-ttu-id="bf05c-179">[![image14](the-entity-framework-and-aspnet-getting-started-part-6/_static/image26.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="bf05c-179">[![image14](the-entity-framework-and-aspnet-getting-started-part-6/_static/image26.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image25.png)</span></span>

<span data-ttu-id="bf05c-180">Однако, поскольку разметка для `EntityDataSource` элементов управления была изменена для использования атрибута `ContextTypeName`, мастер **настройки источника данных** нельзя запустить в уже созданных элементах управления `EntityDataSource`.</span><span class="sxs-lookup"><span data-stu-id="bf05c-180">However, because you've changed the markup for `EntityDataSource` controls to use the `ContextTypeName` attribute, you cannot run the **Configure Data Source** wizard on `EntityDataSource` controls that you've already created.</span></span> <span data-ttu-id="bf05c-181">Поэтому необходимо внести необходимые изменения, изменив вместо этого разметку.</span><span class="sxs-lookup"><span data-stu-id="bf05c-181">Therefore, you'll make the required changes by changing markup instead.</span></span>

<span data-ttu-id="bf05c-182">Откройте страницу *students. aspx* .</span><span class="sxs-lookup"><span data-stu-id="bf05c-182">Open the *Students.aspx* page.</span></span> <span data-ttu-id="bf05c-183">В элементе управления `StudentsEntityDataSource` удалите атрибут `Where` и добавьте атрибут `EntityTypeFilter="Student"`.</span><span class="sxs-lookup"><span data-stu-id="bf05c-183">In the `StudentsEntityDataSource` control, remove the `Where` attribute and add an `EntityTypeFilter="Student"` attribute.</span></span> <span data-ttu-id="bf05c-184">Теперь разметка будет выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="bf05c-184">The markup will now resemble the following example:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-6/samples/sample1.aspx)]

<span data-ttu-id="bf05c-185">Установка атрибута `EntityTypeFilter` гарантирует, что элемент управления `EntityDataSource` выберет только указанный тип сущности.</span><span class="sxs-lookup"><span data-stu-id="bf05c-185">Setting the `EntityTypeFilter` attribute ensures that the `EntityDataSource` control will select only the specified entity type.</span></span> <span data-ttu-id="bf05c-186">Если требуется получить как `Student`, так `Instructor` типы сущностей, этот атрибут задавать не нужно.</span><span class="sxs-lookup"><span data-stu-id="bf05c-186">If you wanted to retrieve both `Student` and `Instructor` entity types, you would not set this attribute.</span></span> <span data-ttu-id="bf05c-187">(Можно получить несколько типов сущностей с одним `EntityDataSource` элементом управления, только если вы используете элемент управления для доступа к данным только для чтения.</span><span class="sxs-lookup"><span data-stu-id="bf05c-187">(You have the option of retrieving multiple entity types with one `EntityDataSource` control only if you're using the control for read-only data access.</span></span> <span data-ttu-id="bf05c-188">Если для вставки, обновления или удаления сущностей используется элемент управления `EntityDataSource`, и если набор сущностей, к которому он привязан, может содержать несколько типов, то можно работать только с одним типом сущности, и необходимо задать этот атрибут.)</span><span class="sxs-lookup"><span data-stu-id="bf05c-188">If you're using an `EntityDataSource` control to insert, update, or delete entities, and if the entity set it's bound to can contain multiple types, you can only work with one entity type, and you have to set this attribute.)</span></span>

<span data-ttu-id="bf05c-189">Повторите процедуру для элемента управления `SearchEntityDataSource`, за исключением удаления только части атрибута `Where`, которая выбирает `Student` сущностей вместо того, чтобы полностью удалить свойство.</span><span class="sxs-lookup"><span data-stu-id="bf05c-189">Repeat the procedure for the `SearchEntityDataSource` control, except remove only the part of the `Where` attribute that selects `Student` entities instead of removing the property altogether.</span></span> <span data-ttu-id="bf05c-190">Открывающий тег элемента управления теперь будет выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="bf05c-190">The opening tag of the control will now resemble the following example:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-6/samples/sample2.aspx)]

<span data-ttu-id="bf05c-191">Запустите страницу, чтобы убедиться, что она все еще работает, как и раньше.</span><span class="sxs-lookup"><span data-stu-id="bf05c-191">Run the page to verify that it still works as it did before.</span></span>

<span data-ttu-id="bf05c-192">[![image15](the-entity-framework-and-aspnet-getting-started-part-6/_static/image28.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="bf05c-192">[![image15](the-entity-framework-and-aspnet-getting-started-part-6/_static/image28.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image27.png)</span></span>

<span data-ttu-id="bf05c-193">Обновите следующие страницы, созданные в предыдущих учебных курсах, чтобы они использовали новые `Student` и `Instructor` сущности вместо сущностей `Person`, затем запустите их, чтобы убедиться, что они работают, как раньше:</span><span class="sxs-lookup"><span data-stu-id="bf05c-193">Update the following pages that you created in earlier tutorials so that they use the new `Student` and `Instructor` entities instead of `Person` entities, then run them to verify that they work as they did before:</span></span>

- <span data-ttu-id="bf05c-194">В *студентсадд. aspx*добавьте `EntityTypeFilter="Student"` в элемент управления `StudentsEntityDataSource`.</span><span class="sxs-lookup"><span data-stu-id="bf05c-194">In *StudentsAdd.aspx*, add `EntityTypeFilter="Student"` to the `StudentsEntityDataSource` control.</span></span> <span data-ttu-id="bf05c-195">Теперь разметка будет выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="bf05c-195">The markup will now resemble the following example:</span></span> 

    [!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-6/samples/sample3.aspx)]

    <span data-ttu-id="bf05c-196">[![image16](the-entity-framework-and-aspnet-getting-started-part-6/_static/image30.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="bf05c-196">[![image16](the-entity-framework-and-aspnet-getting-started-part-6/_static/image30.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image29.png)</span></span>
- <span data-ttu-id="bf05c-197">В файле *About. aspx*добавьте `EntityTypeFilter="Student"` в элемент управления `StudentStatisticsEntityDataSource` и удалите `Where="it.EnrollmentDate is not null"`.</span><span class="sxs-lookup"><span data-stu-id="bf05c-197">In *About.aspx*, add `EntityTypeFilter="Student"` to the `StudentStatisticsEntityDataSource` control and remove `Where="it.EnrollmentDate is not null"`.</span></span> <span data-ttu-id="bf05c-198">Теперь разметка будет выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="bf05c-198">The markup will now resemble the following example:</span></span> 

    [!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-6/samples/sample4.aspx)]

    <span data-ttu-id="bf05c-199">[![image17](the-entity-framework-and-aspnet-getting-started-part-6/_static/image32.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="bf05c-199">[![image17](the-entity-framework-and-aspnet-getting-started-part-6/_static/image32.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image31.png)</span></span>
- <span data-ttu-id="bf05c-200">В *инструкторах. aspx* и *инструкторскаурсес. aspx*добавьте `EntityTypeFilter="Instructor"` в элемент управления `InstructorsEntityDataSource` и удалите `Where="it.HireDate is not null"`.</span><span class="sxs-lookup"><span data-stu-id="bf05c-200">In *Instructors.aspx* and *InstructorsCourses.aspx*, add `EntityTypeFilter="Instructor"` to the `InstructorsEntityDataSource` control and remove `Where="it.HireDate is not null"`.</span></span> <span data-ttu-id="bf05c-201">Разметка в *инструкторах. aspx* теперь напоминает следующий пример:</span><span class="sxs-lookup"><span data-stu-id="bf05c-201">The markup in *Instructors.aspx* now resembles the following example:</span></span> 

    [!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-6/samples/sample5.aspx)]

    <span data-ttu-id="bf05c-202">[![image18](the-entity-framework-and-aspnet-getting-started-part-6/_static/image34.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image33.png)</span><span class="sxs-lookup"><span data-stu-id="bf05c-202">[![image18](the-entity-framework-and-aspnet-getting-started-part-6/_static/image34.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image33.png)</span></span>

    <span data-ttu-id="bf05c-203">Разметка в *инструкторскаурсес. aspx* теперь будет выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="bf05c-203">The markup in *InstructorsCourses.aspx* will now resemble the following example:</span></span>

    [!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-6/samples/sample6.aspx)]

    <span data-ttu-id="bf05c-204">[![image19](the-entity-framework-and-aspnet-getting-started-part-6/_static/image36.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="bf05c-204">[![image19](the-entity-framework-and-aspnet-getting-started-part-6/_static/image36.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image35.png)</span></span>

<span data-ttu-id="bf05c-205">В результате этих изменений вы улучшили удобство обслуживания приложения Contoso университета несколькими способами.</span><span class="sxs-lookup"><span data-stu-id="bf05c-205">As a result of these changes, you've improved the Contoso University application's maintainability in several ways.</span></span> <span data-ttu-id="bf05c-206">Вы переместили выборку и логику проверки из слоя пользовательского интерфейса (разметки*ASPX* ) и сделали ее неотъемлемой частью уровня доступа к данным.</span><span class="sxs-lookup"><span data-stu-id="bf05c-206">You've moved selection and validation logic out of the UI layer (*.aspx* markup) and made it an integral part of the data access layer.</span></span> <span data-ttu-id="bf05c-207">Это помогает изолировать код приложения от изменений, которые могут быть внесены в будущем для схемы базы данных или модели данных.</span><span class="sxs-lookup"><span data-stu-id="bf05c-207">This helps to isolate your application code from changes that you might make in the future to the database schema or the data model.</span></span> <span data-ttu-id="bf05c-208">Например, можно принять решение о том, что учащиеся могут быть приняты на работу в качестве вспомогательных средств преподавателей и, следовательно, получат дату найма.</span><span class="sxs-lookup"><span data-stu-id="bf05c-208">For example, you could decide that students might be hired as teachers' aids and therefore would get a hire date.</span></span> <span data-ttu-id="bf05c-209">Затем можно добавить новое свойство, чтобы отличать учащихся от инструкторов и обновлять модель данных.</span><span class="sxs-lookup"><span data-stu-id="bf05c-209">You could then add a new property to differentiate students from instructors and update the data model.</span></span> <span data-ttu-id="bf05c-210">Код в веб-приложении не должен изменяться, за исключением тех случаев, когда требуется отобразить дату найма для учащихся.</span><span class="sxs-lookup"><span data-stu-id="bf05c-210">No code in the web application would need to change except where you wanted to show a hire date for students.</span></span> <span data-ttu-id="bf05c-211">Еще одно преимущество добавления `Instructor` и `Student` сущностей заключается в том, что код более понятен, чем когда бы он ссылался на `Person` объекты, которые фактически являются студентами или преподавателями.</span><span class="sxs-lookup"><span data-stu-id="bf05c-211">Another benefit of adding `Instructor` and `Student` entities is that your code is more readily understandable than when it referred to `Person` objects that were actually students or instructors.</span></span>

<span data-ttu-id="bf05c-212">Теперь вы видели один из способов реализации шаблона наследования в Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="bf05c-212">You've now seen one way to implement an inheritance pattern in the Entity Framework.</span></span> <span data-ttu-id="bf05c-213">В следующем руководстве вы узнаете, как использовать хранимые процедуры, чтобы получить более полный контроль над тем, как Entity Framework обращается к базе данных.</span><span class="sxs-lookup"><span data-stu-id="bf05c-213">In the following tutorial, you'll learn how to use stored procedures in order to have more control over how the Entity Framework accesses the database.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="bf05c-214">[Назад](the-entity-framework-and-aspnet-getting-started-part-5.md)
> [Вперед](the-entity-framework-and-aspnet-getting-started-part-7.md)</span><span class="sxs-lookup"><span data-stu-id="bf05c-214">[Previous](the-entity-framework-and-aspnet-getting-started-part-5.md)
[Next](the-entity-framework-and-aspnet-getting-started-part-7.md)</span></span>
