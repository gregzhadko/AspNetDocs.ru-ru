---
uid: web-forms/overview/older-versions-getting-started/aspnet-ajax/understanding-asp-net-ajax-web-services
title: Основные сведения о веб-служб ASP.NET AJAX | Документация Майкрософт
author: scottcate
description: Веб-служб являются неотъемлемой частью платформы .NET framework, которые обеспечивают кроссплатформенного решения для обмена данными между распределенных систем. Несмотря на то что Web...
ms.author: riande
ms.date: 03/28/2008
ms.assetid: 3332d6e7-e2e1-4144-b805-e71d51e7e415
msc.legacyurl: /web-forms/overview/older-versions-getting-started/aspnet-ajax/understanding-asp-net-ajax-web-services
msc.type: authoredcontent
ms.openlocfilehash: 5e59077373b68b907391eff5349e1925222792a3
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/01/2019
ms.locfileid: "57028111"
---
<a name="understanding-aspnet-ajax-web-services"></a>Общие сведения о веб-службах ASP.NET AJAX
====================
по [(Scott cate)](https://github.com/scottcate)

[Загрузить PDF-файл](http://download.microsoft.com/download/C/1/9/C19A3451-1D14-477C-B703-54EF22E197EE/AJAX_tutorial05_Web_Services_with_MS_Ajax_cs.pdf)

> Веб-служб являются неотъемлемой частью платформы .NET framework, которые обеспечивают кроссплатформенного решения для обмена данными между распределенных систем. Несмотря на то, что веб-службы обычно используются для разрешения разных операционных систем, объектных моделей и языков программирования для отправки и получения данных, они также могут использоваться для динамически Вставка данных в странице ASP.NET AJAX или отправлять данные со страницы в обслуживающей системе. Все это можно сделать, не прибегая к обратной передаче операции.


## <a name="calling-web-services-with-aspnet-ajax"></a>Вызов веб-служб с помощью ASP.NET AJAX

Дэна Вахлина

Веб-служб являются неотъемлемой частью платформы .NET framework, которые обеспечивают кроссплатформенного решения для обмена данными между распределенных систем. Несмотря на то, что веб-службы обычно используются для разрешения разных операционных систем, объектных моделей и языков программирования для отправки и получения данных, они также могут использоваться для динамически Вставка данных в странице ASP.NET AJAX или отправлять данные со страницы в обслуживающей системе. Все это можно сделать, не прибегая к обратной передаче операции.

Хотя элемент управления ASP.NET AJAX UpdatePanel предоставляет простой способ AJAX включить любой страницы ASP.NET, могут возникнуть ситуации, когда необходимо динамически получить доступ к данным на сервере без использования элемента управления UpdatePanel. В этой статье вы увидите, как выполнить эту задачу путем создания и использования веб-служб в пределах страницы ASP.NET AJAX.

В этой статье основное внимание уделяется функциям, доступным в расширения AJAX для ASP.NET core, а также элемент управления веб-службы, которые включены в наборе средств AJAX ASP.NET, вызывается AutoCompleteExtender. Рассматриваются определение веб-служб с поддержкой AJAX, создания клиентских прокси-серверы и вызова веб-служб с помощью JavaScript. Вы также увидите, как веб-службы можно вызывать напрямую методы страниц ASP.NET.

## <a name="web-services-configuration"></a>Настройка веб-служб

При создании нового проекта веб-сайта с помощью Visual Studio 2008 в файле web.config имеет ряд дополнений, которые могут быть знакомы пользователям предыдущих версий Visual Studio. Некоторые из этих изменений сопоставить префикс «asp» к элементам управления ASP.NET AJAX, чтобы можно было использовать на страницах, если другие определяют обязательные HttpHandlers и HttpModules. В листинге 1 показан изменения, внесенные в `<httpHandlers>` элемент в файле web.config, влияющим на вызовы веб-службы. По умолчанию, используемые HttpHandler для обработки вызовов .asmx удаляется и заменяется ScriptHandlerFactory класс находится в сборке System.Web.Extensions.dll. System.Web.Extensions.dll содержит все основные функциональные возможности, используемые ASP.NET AJAX.

**Листинг 1. Конфигурация обработчик ASP.NET AJAX веб-службы**

[!code-xml[Main](understanding-asp-net-ajax-web-services/samples/sample1.xml)]

Этот обработчик HttpHandler замещения чтобы разрешить вызовы JavaScript Object Notation (JSON) предприниматься из страницы ASP.NET AJAX для веб-служб .NET через прокси JavaScript веб-службы. AJAX для ASP.NET отправляет сообщения JSON веб-служб в отличие от стандартных вызовов Simple Object Access Protocol (SOAP), обычно связаны с веб-служб. Это приводит небольших запросов и общую сообщений-ответов. Он также позволяет более эффективную обработку на стороне клиента данных так, как библиотека ASP.NET AJAX JavaScript оптимизирована для работы с объектами JSON. Листинг 2 и листинге 3 Показать примеры веб-службы сообщений запросов и ответов сериализации в формат JSON. Сообщение запроса, показанный в листинге 2 передает параметра страны со значением «Бельгия», а ответное сообщение в листинге 3 передает массив объектов клиента и связанные с ними свойства.

**Листинг 2. Сообщения запроса веб-службы сериализации в JSON**

[!code-json[Main](understanding-asp-net-ajax-web-services/samples/sample2.json)]

> *> [!NOTE] Имя операции, определяется как часть URL-адрес веб-службы; Кроме того запросы всегда отправляются через JSON. Веб-службы можно использовать атрибут ScriptMethod с параметром UseHttpGet значение true, в результате чего параметры для передачи через параметры строки запроса.*


**Листинг 3. Сообщения ответа веб-службы сериализации в JSON**

[!code-json[Main](understanding-asp-net-ajax-web-services/samples/sample3.json)]

В следующем разделе вы узнаете, как создавать веб-службы для обработки сообщения запроса JSON и отвечать на запросы с помощью простых и сложных типов.

## <a name="creating-ajax-enabled-web-services"></a>Создании поддерживающих AJAX веб-служб

Платформа AJAX для ASP.NET предоставляет несколько разных способов для вызова веб-служб. Можно использовать элемент управления AutoCompleteExtender (доступно в наборе средств AJAX ASP.NET) или JavaScript. Тем не менее перед вызовом службы AJAX, обеспечив он имеется, может быть вызвана код клиентского скрипта.

Ли вы не знакомы с веб-служб ASP.NET, вы найдете его легко создавать и службы с поддержкой AJAX. .NET framework поддерживала Создание веб-служб ASP.NET с момента своего появления в 2002 г. и расширения AJAX для ASP.NET обеспечивают дополнительные функциональные возможности AJAX, который построен на основе платформы .NET framework по умолчанию набором функций. Visual Studio .NET 2008 бета-версии 2 имеет встроенную поддержку для создания веб-службы файлы .asmx и автоматически наследует класс System.Web.Services.WebService соответствующий код рядом с классами. Как добавить методы в класс необходимо применить атрибут WebMethod, они должна вызываться потребителей веб-службы.

В листинге 4 показан пример применения атрибут WebMethod метод с именем GetCustomersByCountry().

**Листинг 4. С помощью атрибута WebMethod для веб-службы**

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample4.cs)]

Метод GetCustomersByCountry() принимает параметр страны и возвращает массив объектов клиента. Значение страны, передаваемый в метод передается класс слоя бизнес, который в свою очередь вызывает класс уровень данных для получения данных из базы данных, заполнить свойства объекта клиента с данными и возвращать массив.

## <a name="using-the-scriptservice-attribute"></a>С помощью атрибута ScriptService

При добавлении WebMethod, атрибут позволяет GetCustomersByCountry() метод, вызываемый клиенты, отправляющие стандартные сообщения SOAP в веб-службу, он не допускает вызовов JSON из приложений ASP.NET AJAX без дополнительной настройки. Чтобы разрешить применение расширения AJAX ASP.NET, что делать вызовы JSON `ScriptService` атрибута к классу веб-службы. Это позволяет веб-службы для отправки сообщений-ответов в формате с помощью JSON и скрипт на стороне клиента для вызова службы, отправляя сообщения JSON.

В листинге 5 показан пример применения атрибута ScriptService к классу веб-службы с именем CustomersService.

**Листинг 5. С помощью атрибута ScriptService на веб-службы с поддержкой AJAX**

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample5.cs)]

Атрибут ScriptService действует как маркер, который указывает, что он может вызываться из кода сценария AJAX. Он не обрабатывает фактически любой задачи сериализации или десериализации JSON, которые возникают в фоновом. ScriptHandlerFactory, (настраивается в файле web.config) и другие классы и выполняют основную часть обработки JSON.

## <a name="using-the-scriptmethod-attribute"></a>С помощью атрибута ScriptMethod

Атрибут ScriptService является единственным атрибутом ASP.NET AJAX, который должен быть определен в веб-службы .NET для его для использования страниц ASP.NET AJAX. Тем не менее другой атрибут с именем ScriptMethod также может применяться непосредственно к веб-методы в службе. ScriptMethod определены три свойства, в том числе `UseHttpGet`, `ResponseFormat` и `XmlSerializeString`. Изменение значения этих свойств может быть полезно в случаях, где требуется сменить GET, пока веб-метод должен возвращать необработанные данные XML в виде типа запрос принят методом веб- `XmlDocument` или `XmlElement` объекта или при возвращении данных из  службы всегда должно быть сериализовано как XML вместо JSON.

UseHttpGet, свойство может использоваться при веб-метод должен принимать получение запросов, в отличие от запросов POST. Запросы, отправляемые с помощью URL-адрес с входными параметрами веб-метода, переведенную в параметры строки запроса. UseHttpGet свойство по умолчанию равно false и только следует установить значение `true` при операции известно, что оказываются надежными, а также когда конфиденциальные данные не передается на веб-службу. В листинге 6 показан пример использования данного атрибута ScriptMethod со свойством UseHttpGet.

**Листинг 6. Используя атрибут ScriptMethod со свойством UseHttpGet.**

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample6.cs)]

Пример заголовков, отправляется, когда вызывается метод веб-HttpGetEcho, показано в листинге 6 показаны далее:

`GET /CustomerViewer/DemoService.asmx/HttpGetEcho?input=%22Input Value%22 HTTP/1.1`

Кроме веб-методы принимать запросы HTTP GET, атрибут ScriptMethod можно также использовать при XML-ответов должны быть возвращены из службы, а не JSON. Например веб-службы может получить RSS-канал с удаленного узла и возвращения в качестве объекта XmlDocument или XmlElement. Обработка XML-данных затем наблюдается на стороне клиента.

Листинг 7 показан пример использования свойство ResponseFormat, чтобы указать, что XML-данные будут возвращены из веб-метода.

**Листинг 7. Используя атрибут ScriptMethod со свойством ResponseFormat.**

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample7.cs)]

Свойство ResponseFormat может также использоваться вместе со свойством XmlSerializeString. Свойство XmlSerializeString имеет значение по умолчанию false, это означает, что все возвращаемые типы, за исключением строк, возвращаемых из веб-метода сериализуются в формат XML при `ResponseFormat` свойству `ResponseFormat.Xml`. Когда `XmlSerializeString` присваивается `true`, все типы, возвращаемые из веб-метода сериализуются как XML, включая строковые типы. Если свойство ResponseFormat имеет значение `ResponseFormat.Json` XmlSerializeString свойство учитывается.

Листинг 8 показывает пример использования свойства XmlSerializeString для принудительного строк должно быть сериализовано как XML.

**Листинг 8. Используя атрибут ScriptMethod со свойством XmlSerializeString**

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample8.cs)]

Значение, возвращаемое из вызова метода веб-GetXmlString, показано в листинге 8 показан далее:

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample9.cs)]

Несмотря на то, что формат JSON по умолчанию сокращает общий размер сообщения запроса и ответа и более эффективно используется ASP.NET AJAX клиентами в определенном обозреватели, могут быть свойства ResponseFormat и XmlSerializeString используются, когда клиент приложения, такие как Internet Explorer 5 или более поздней версии ожидают XML-данных, возвращаемых методом веб.

## <a name="working-with-complex-types"></a>Работа со сложными типами

В листинге 5 был приведен пример возвращает сложный тип с именем Customer из веб-службы. Классу "Customer" определяет несколько различных типов простой внутренне как свойства, такие как FirstName и LastName. Сложные типы, используемые в качестве входного параметра или тип возвращаемого значения для метода с поддержкой AJAX Web автоматически сериализуется в JSON перед отправкой на стороне клиента. Тем не менее вложенные сложные типы (наборы, определенные внутри внутри другого типа) не становятся доступными клиенту качестве автономных объектов по умолчанию.

В случаях, где вложенным сложным типом, используемые веб-службы также должно использоваться страницей клиента можно добавить атрибут ASP.NET AJAX GenerateScriptType в веб-службу. Например, класс CustomerDetails, показанный в листинге 9 содержит адрес и пол свойства которого ***представляют вложенные сложные типы.***

**Листинг 9. Класс CustomerDetails, показанный здесь содержит две вложенные сложные типы.**

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample10.cs)]

Адрес и пол объекты, определенные в классе CustomerDetails, показано в листинге 9 не будет автоматически доступны для использования на стороне клиента через JavaScript, так как они представляют собой вложенные типы (адрес — это класс и Пол является перечислением). В ситуациях, где вложенный тип, используемый в веб-службы должны быть доступны на стороне клиента, можно использовать атрибут GenerateScriptType, упомянутых ранее (см. Листинг 10). Этот атрибут можно добавить несколько раз в случаях, где различные вложенные сложные типы возвращаются из службы. Оно может применяться непосредственно к классу веб-службы или выше отдельные веб-методы.

**Листинг 10. С помощью атрибута GenerateScriptService определить вложенные типы, которые должны быть доступны клиенту.**

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample11.cs)]

Применяя `GenerateScriptType` атрибута в веб-службы, адрес и пол типы будут автоматически доступны для использования с код ASP.NET AJAX JavaScript на стороне клиента. В листинге 11 показан пример JavaScript, который автоматически создается и отправляется клиенту путем добавления атрибута GenerateScriptType на веб-службы. Вы узнаете, как использовать вложенные сложные типы чуть позже.

**Листинг 11. Вложенные сложные типы, становятся доступными для страницы ASP.NET AJAX.**

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample12.cs)]

Теперь, когда вы узнали, как создать веб-служб и сделать их доступными для страницы ASP.NET AJAX, давайте рассмотрим, как создать и использовать прокси-серверы JavaScript, таким образом, чтобы данные можно извлечь или отправляемые веб-служб.

## <a name="creating-javascript-proxies"></a>Создание прокси-серверы JavaScript

Вызов стандартных веб-службы (.NET или другой платформы) обычно включает в себя создание прокси-объект, который абстрагирует вас от необходимости отправки сообщения запроса и ответа SOAP. С помощью вызовов веб-службы ASP.NET AJAX можно создать прокси JavaScript и позволяет без труда вызвать службы, не беспокоясь о сериализации и десериализации сообщений JSON. Прокси-серверы JavaScript может создаваться автоматически с помощью элемента управления ASP.NET AJAX ScriptManager.

Создание прокси JavaScript, который может вызывать веб-службы осуществляется с помощью элемента управления ScriptManager свойство служб. Это свойство можно задать одну или несколько служб, которые страницы ASP.NET AJAX можно асинхронно вызывают отправку или получение данных без необходимости операций обратной передачи. Определения службы с помощью ASP.NET AJAX `ServiceReference` управления и назначения URL веб-службы для элемента управления `Path` свойство. В листинге 12 показан пример ссылается на службу, с именем CustomersService.asmx.

[!code-aspx[Main](understanding-asp-net-ajax-web-services/samples/sample13.aspx)]

**Листинг 12. Определение веб-служба, используемая на странице ASP.NET AJAX.**

Добавление ссылки на CustomersService.asmx элемент управления ScriptManager вызывает прокси JavaScript для динамически сгенерированных и ссылку на страницу. Прокси-сервера внедряется с помощью &lt;скрипт&gt; теги и динамически загружается путем вызова CustomersService.asmx файл и добавления в конец/js. В следующем примере показано, как прокси JavaScript внедряется в странице, когда отладка была отключена в файле web.config:

[!code-html[Main](understanding-asp-net-ajax-web-services/samples/sample14.html)]

> *> [!NOTE] Если вы хотите просмотреть фактический код прокси-сервера JavaScript, который создается можно ввести URL-адрес нужного веб-службы .NET в поле адреса Internet Explorer и добавьте в конец/js.*


Если отладка включена в файле web.config, это отладочная версия прокси JavaScript будет внедрен в страницу, как показано далее:

[!code-html[Main](understanding-asp-net-ajax-web-services/samples/sample15.html)]

Созданные ScriptManager прокси JavaScript может быть также внедрен непосредственно в страницу, а не с помощью &lt;скрипт&gt; атрибут src тега. Это можно сделать, задав свойство InlineScript ServiceReference элемента управления значение true (по умолчанию — false). Это может быть полезно, когда прокси-сервер не предоставлен общий доступ на нескольких страницах и в случае, если вы хотите уменьшить количество сетевых вызовов к серверу. Когда InlineScript имеет значение true скрипт прокси-сервера не кэшируются обозревателем, значение по умолчанию false рекомендуется в случаях, где используется прокси-сервера через несколько страниц в приложении ASP.NET AJAX. Далее показан пример использования свойства InlineScript:

[!code-aspx[Main](understanding-asp-net-ajax-web-services/samples/sample16.aspx)]

## <a name="using-javascript-proxies"></a>С помощью прокси-серверы JavaScript

После страницы ASP.NET AJAX с помощью элемента управления ScriptManager ссылается на веб-службы, выполняется вызов веб-службе и возвращаемые данные могут обрабатываться с помощью функции обратного вызова. Веб-службы вызывается (если он существует), ссылки на пространства имен, имя класса и имя веб-метода. А также функцию обратного вызова, который обрабатывает возвращаемые данные могут быть определены все параметры, передаваемые в веб-службу.

Пример использования прокси JavaScript для вызова веб-метода с именем GetCustomersByCountry() показано в листинге 13. Функция GetCustomersByCountry() вызывается в том случае, когда пользователь нажимает кнопку на странице.

**Листинг 13. Вызов веб-службы с прокси JavaScript.**

[!code-javascript[Main](understanding-asp-net-ajax-web-services/samples/sample17.js)]

Этот вызов ссылается на пространство имен InterfaceTraining, класс CustomersService и веб-метода GetCustomersByCountry определенной в службе. Он передает значение страны, полученное из элемента textbox, а также функцию обратного вызова с именем OnWSRequestComplete, который должен вызываться при возврате асинхронный вызов веб-службы. OnWSRequestComplete обрабатывает массива объектов клиента, возвращаемый службой и преобразует их в таблицу, которая отображается на странице. Выходные данные из вызова показан на рис. 1.


[![Привязка данных, полученные путем внесения асинхронный вызов AJAX на веб-службу.](understanding-asp-net-ajax-web-services/_static/image2.png)](understanding-asp-net-ajax-web-services/_static/image1.png)

**Рис. 1**: Привязка данных, полученные путем внесения асинхронный вызов AJAX на веб-службу.  ([Просмотр полноразмерного изображения](understanding-asp-net-ajax-web-services/_static/image3.png))


Прокси-серверы JavaScript также может направлять односторонние вызовы к веб-службам в случаях, когда веб-метода должен быть вызван, но прокси-сервер не должен ожидать ответа. Например можно вызвать веб-службу, чтобы начать процесс, например рабочий процесс, но не ждать, пока возвращаемое значение из службы. В случаях, где односторонний вызов должен выполняться в службу можно просто опустить функцию обратного вызова, показано в листинге 13. Так как функция обратного вызова не определен объект прокси-сервера не будут ожидать веб-службы для возврата данных.

## <a name="handling-errors"></a>Обработка ошибок

Асинхронные обратные вызовы веб-служб могут возникнуть различные типы ошибок, таких как сети из строя, веб-служба недоступна или исключение возвращается. К счастью JavaScript прокси-объекты, создаваемые ScriptManager разрешить несколько обратных вызовов, должна определяться для обработки ошибок и сбоев в дополнение к успешный обратный вызов, показанный ранее. Можно определить функцию обратного вызова ошибки сразу же после функции стандартный обратного вызова в вызове метода веб-, как показано в листинге 14.

**Листинг 14. Определение функцию обратного вызова ошибки и отображения ошибок.**

[!code-javascript[Main](understanding-asp-net-ajax-web-services/samples/sample18.js)]

Функция обратного вызова OnWSRequestFailed() для вызова, принимающий объект, представляющий ошибки в виде параметра будет активирована все ошибки, возникающие при вызове веб-службы. Объект error предоставляет несколько разных функций для определения причины ошибки, а также того, является ли время ожидания вызова. В листинге 14 показан пример использования функции различных ошибок и рис. 2 показан пример выходных данных, созданных этими функциями.


[![Выходные данные, созданные путем вызова функции ошибок ASP.NET AJAX.](understanding-asp-net-ajax-web-services/_static/image5.png)](understanding-asp-net-ajax-web-services/_static/image4.png)

**Рис. 2**: Выходные данные, созданные путем вызова функции ошибок ASP.NET AJAX.  ([Просмотр полноразмерного изображения](understanding-asp-net-ajax-web-services/_static/image6.png))


## <a name="handling-xml-data-returned-from-a-web-service"></a>Обработка XML-данные, возвращенные из веб-службы

Вы уже видели, как веб-метод может возвращать необработанных XML-данных с помощью атрибута ScriptMethod вместе с его свойство ResponseFormat. Если ResponseFormat имеет значение ResponseFormat.Xml, данные, возвращенные из веб-службы сериализуется как XML, а не JSON. Это может быть полезно, если данные XML должны передаваться непосредственно клиенту для обработки с помощью JavaScript или XSLT. В настоящее время Internet Explorer 5 или более поздней версии обеспечивает оптимальную модель объектов на стороне клиента для синтаксического анализа и фильтрация данных XML из-за его встроенную поддержку для MSXML.

Извлечение XML-данных из веб-службы не отличается от извлечения других типов данных. Начнем с вызова прокси JavaScript вызывает соответствующую функцию и определить функцию обратного вызова. После возвращения вызова можно приступить к обработке данных в функции обратного вызова.

В листинге 15 показан пример вызова веб-метода с именем GetRssFeed(), который возвращает объект XmlElement. GetRssFeed() принимает один параметр, представляющий URL-адрес RSS-канала для получения.

**Листинг 15. Работа с XML-данные, возвращенные из веб-службы.**

[!code-html[Main](understanding-asp-net-ajax-web-services/samples/sample19.html)]

В этом примере передается URL-адрес RSS-канала и обрабатывает полученные данные XML в функции OnWSRequestComplete(). OnWSRequestComplete() сначала проверяет, находится ли браузер Internet Explorer, чтобы узнать, доступно ли средство синтаксического анализа MSXML. В противном случае инструкция XPath позволяет найти все &lt;элемент&gt; теги в RSS-канала. Каждый элемент затем выполняется итерация и связанным &lt;title&gt; и &lt;ссылку&gt; теги обнаруживаются и обрабатываются для отображения каждого элемента данных. Рис. 3 показан пример выходных данных, созданных делать вызовы через прокси JavaScript в веб-метода GetRssFeed() AJAX ASP.NET.

## <a name="handling-complex-types"></a>Обработка сложных типов

Сложные типы принятые или возвращаемых веб-службой, автоматически предоставляется через прокси JavaScript. Тем не менее вложенные сложные типы не доступны непосредственно на стороне клиента Если атрибут GenerateScriptType не применяется к службе, как обсуждалось выше. Зачем использовать вложенного сложного типа на стороне клиента?

Чтобы ответить на этот вопрос, предполагается, что страницы ASP.NET AJAX, отображаются данные клиентов и позволяет конечным пользователям Обновить адрес клиента. Если веб-службы указывает, что тип адреса (сложный тип, определенный в классе CustomerDetails) могут отправляться клиенту процесс обновления можно разделить на отдельные функции для повышения повторного использования кода.


[![Выходные данные при создании вызова веб-служб, который возвращает данные RSS.](understanding-asp-net-ajax-web-services/_static/image8.png)](understanding-asp-net-ajax-web-services/_static/image7.png)

**Рис. 3**: Выходные данные при создании вызова веб-служб, который возвращает данные RSS.  ([Просмотр полноразмерного изображения](understanding-asp-net-ajax-web-services/_static/image9.png))


В листинге 16 показан пример кода на стороне клиента, который вызывает объект адрес, определенный в пространстве имен модели, заполняет его с использованием новых данных и присваивает его свойству объекта CustomerDetails адрес. CustomerDetails объект затем передается в веб-службу для обработки.

**Листинг 16. Использование вложенных сложных типов**

[!code-javascript[Main](understanding-asp-net-ajax-web-services/samples/sample20.js)]

## <a name="creating-and-using-page-methods"></a>Создание и использование методы страниц

Веб-службы предоставляют прекрасный способ предоставления повторно готовый к применению служб для различных клиентов, включая страницы ASP.NET AJAX. Однако возможны ситуации, где страницу необходимо получить данные, которые никогда не будет использоваться или общими для других страниц. Таким образом что ASMX-файла, чтобы разрешить доступ к данным страницы может показаться избыточным, так как служба используется только с одной страницы.

AJAX для ASP.NET предоставляет другой механизм для выполнения вызовов веб-службы по принципу без создания автономные файлы .asmx. Это делается с помощью метода, называются «методы страниц». Методы страницы являются методы статические (совместно используется в VB.NET), внедренными непосредственно в файл страницы или сторонний код, которые имеют атрибут WebMethod, примененный к ним. Применяя атрибут WebMethod они могут вызываться с помощью специальных объекта JavaScript с именем PageMethods, который создается динамически во время выполнения. Объект PageMethods выступает в качестве прокси-сервера, защита от процесс сериализации и десериализации JSON. Обратите внимание на то, что для использования объекта PageMethods необходимо задать свойства EnablePageMethods в ScriptManager значение true.

[!code-aspx[Main](understanding-asp-net-ajax-web-services/samples/sample21.aspx)]

В листинге 17 показан пример определения двух методы страниц в классе побочного кода ASP.NET. Эти методы извлечения данных из слоя бизнес в приложении\_папке кода веб-сайта.

**Листинг 17. Определение методов страницы.**

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample22.cs)]

Когда ScriptManager определяет наличие методов веб-страницы, он создает динамическую ссылку на объект PageMethods, упомянутых ранее. Вызова метода веб-достигается путем ссылки на класс PageMethods, за которым следует имя метода и любые данные обязательного параметра, которые должны быть переданы. В листинге 18 показан примеры вызова два метода страницы, показанный ранее.

**Листинг 18. Вызов методов страницы с помощью объекта PageMethods JavaScript.**

[!code-javascript[Main](understanding-asp-net-ajax-web-services/samples/sample23.js)]

С помощью объекта PageMethods очень похоже на использование прокси-объект JavaScript. Сначала необходимо указать все данных параметра, которые должны передаваться в метод страницы, а затем определите функцию обратного вызова, который должен быть вызван, когда асинхронный вызов возвращается. Также можно задать обратный вызов сбоя (приведены в листинге 14 пример обработки ошибок).

## <a name="the-autocompleteextender-and-the-aspnet-ajax-toolkit"></a>AutoCompleteExtender и набора средств ASP.NET AJAX

Набор AJAX ASP.NET (доступные из [ http://ajax.asp.net ](http://ajax.asp.net)) предлагает несколько элементов управления, которые могут использоваться для доступа к веб-служб. В частности, этот набор содержит полезные элемента управления с именем `AutoCompleteExtender` , можно использовать для вызова веб-служб и отображение данных на страницах без написания кода JavaScript вообще.

Элемент управления AutoCompleteExtender можно расширить существующие функциональные возможности элемента textbox и позволяют пользователям легко найти данные, которые они ищут. Вводе в текстовое поле элемента управления можно использовать для запроса веб-службе и показывает результаты под текстовым полем динамически. Рис. 4 показан пример использования элемента управления AutoCompleteExtender, чтобы просмотреть идентификаторы клиентов для поддержки приложения. Как пользователь вводит различными символами в текстовое поле, будут показаны разные элементы под ним в зависимости от своих входных данных. Затем пользователи могут выбрать идентификатор нужного клиента.

Использование AutoCompleteExtender в пределах страницы ASP.NET AJAX требует, что файл AjaxControlToolkit.dll сборка добавлена в папку bin веб сайта. После добавления сборки набора средств, необходимо сослаться на него в файле web.config, таким образом, чтобы элементы управления, содержащихся в нем доступны для всех страниц в приложении. Это можно сделать, добавив следующий тег в web.config &lt;элементов управления&gt; тега:

[!code-xml[Main](understanding-asp-net-ajax-web-services/samples/sample24.xml)]

В случаях, где требуется использовать элемент управления в определенную страницу вы можете обратиться, добавив Reference-директива в верхней части страницы, как показано далее, а не выполняется обновление файла web.config.

[!code-aspx[Main](understanding-asp-net-ajax-web-services/samples/sample25.aspx)]


[![Использование элемента управления AutoCompleteExtender.](understanding-asp-net-ajax-web-services/_static/image11.png)](understanding-asp-net-ajax-web-services/_static/image10.png)

**Рис. 4**: Использование элемента управления AutoCompleteExtender.  ([Просмотр полноразмерного изображения](understanding-asp-net-ajax-web-services/_static/image12.png))


После настройки веб-сайта с помощью набора средств AJAX ASP.NET, управляющего элемента AutoCompleteExtender можно добавить на страницу гораздо, как вы добавляете регулярных серверный элемент управления ASP.NET. В листинге 19 показан пример использования элемента управления для вызова веб-службы.

**Листинг 19. Использование элемента управления ASP.NET AJAX Toolkit AutoCompleteExtender.**

[!code-aspx[Main](understanding-asp-net-ajax-web-services/samples/sample26.aspx)]

AutoCompleteExtender имеет несколько различных свойств, включая стандартные свойства ID и runat, найденных на серверных элементов управления. Помимо этого можно задать количество символов, конечный пользователь типы перед веб-службы запрашиваются данные. Свойство MinimumPrefixLength, показано в листинге 19 вызывает службу, вызываемый каждый раз, когда символ в текстовое поле. Необходимо соблюдать осторожность, что установка этого значения, так как каждый раз при вводе очередного знака веб-служба будет вызываться для поиска значений, которые определяют сопоставление символов в текстовом поле. Веб-служба для вызова, а также целевой веб-метода определяются с помощью свойства ServicePath и ServiceMethod соответственно. И, наконец свойство TargetControlID указывает какое текстовое поле для привязки элемента управления AutoCompleteExtender.

Вызов веб-службы должны иметь атрибут ScriptService, применения как обсуждалось выше и целевой веб-метода должно принимать два параметра с именем prefixText и count. Параметр prefixText представляет символы, введенные конечным пользователем, и параметр count представляет, сколько элементов для возврата (по умолчанию — 10). В листинге 20 показан пример метода веб-GetCustomerIDs вызывается элементом управления AutoCompleteExtender, приведенные ранее в листинге 19. Веб-метод вызывает метод слоя бизнес, что в свою очередь вызывает данных слоя метод, который выполняет фильтрацию данных и возвращение результатов сопоставления. В листинге 21 показан код для метода уровня данных.

**Листинг 20. Фильтрация данных, отправленных из элемента управления AutoCompleteExtender.**

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample27.cs)]

**Листинг 21. Фильтрация результатов в зависимости от входных данных конечного пользователя.**

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample28.cs)]

## <a name="conclusion"></a>Заключение

AJAX для ASP.NET предоставляет отличную поддержку для вызова веб-служб без написания большого объема пользовательский код JavaScript для обработки сообщений запросов и ответов. В этой статье вы увидели, как с поддержкой AJAX .NET веб-служб, чтобы включить их для обработки сообщений JSON, а также определение прокси JavaScript, с помощью элемента управления ScriptManager. Также вы узнали, как JavaScript, прокси-серверы можно использовать для вызова веб-служб, обрабатывать простые и сложные типы и работать со сбоями. Наконец вы увидели, как методы страниц позволяют упростить процесс создания и вызова веб-службы и как AutoCompleteExtender элемент управления можно обеспечить справку для конечных пользователей в процессе их набора. Несмотря на то, что UpdatePanel в AJAX для ASP.NET, несомненно, будут требуемого для многие программисты AJAX благодаря своей простоте элемента управления, нужно знать, как вызов веб-служб через прокси JavaScript можно использовать во многих приложениях.

## <a name="bio"></a>Биография

Дэна Вахлина (Microsoft Most Valuable Professional для ASP.NET и веб-службы) — .NET разработки instructor и архитектура консультант в интерфейс техническое обучение ([http://www.interfacett.com](http://www.interfacett.com)). Дэн основал XML для разработчиков веб-узла ASP.NET ([www.XMLforASP.NET](http://www.XMLforASP.NET)), на Бюро является СПИКЕРОМ INETA и выступает с докладами на нескольких конференциях. Дэн соавтором DNA Windows Professional (Wrox), ASP.NET: Советы, учебники и кода (SAM), ASP.NET 1.1 Insider решения, Professional ASP.NET 2.0 AJAX (Wrox), Hacks обладателя звания MVP по ASP.NET 2.0 и созданные XML для разработчиков ASP.NET (SAM). Когда он также не пишет код, статей или книг, Дэн получает записи и записи музыки и играть в Гольф и баскетбольных со своей женой и детьми.

(Scott cate) работает с веб-технологиями Microsoft с 1997 года и является президентом myKB.com ([www.myKB.com](http://www.myKB.com)) приложений, внимание уделяется знаний программных решений, где он специализируется на написание ASP.NET на основе. Скоттом можно связаться по электронной почте [ scott.cate@myKB.com ](mailto:scott.cate@myKB.com) или его блог по адресу [ScottCate.com](http://ScottCate.com)

> [!div class="step-by-step"]
> [Назад](understanding-asp-net-ajax-localization.md)
> [Вперед](understanding-asp-net-ajax-debugging-capabilities.md)
