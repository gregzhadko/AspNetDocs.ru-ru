---
uid: web-forms/overview/older-versions-getting-started/aspnet-ajax/understanding-partial-page-updates-with-asp-net-ajax
title: Основные сведения об обновлениях частичной страницы с помощью ASP.NET AJAX | Документация Майкрософт
author: scottcate
description: Возможно, наиболее видимой функцией расширений AJAX ASP.NET является возможность выполнения частичного или добавочного обновления страницы без выполнения полной обратной передачи в t...
ms.author: riande
ms.date: 03/28/2008
ms.assetid: 54d9df99-1161-4899-b4e8-2679c85915e7
msc.legacyurl: /web-forms/overview/older-versions-getting-started/aspnet-ajax/understanding-partial-page-updates-with-asp-net-ajax
msc.type: authoredcontent
ms.openlocfilehash: 4b87cb8f58dbd7f27b16bcb0d488ff361770d4fe
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78439272"
---
# <a name="understanding-partial-page-updates-with-aspnet-ajax"></a>Общие сведения о частичных обновлениях страниц с помощью ASP.NET AJAX

по [Скотт Cate](https://github.com/scottcate)

[Скачать в формате PDF](https://download.microsoft.com/download/C/1/9/C19A3451-1D14-477C-B703-54EF22E197EE/AJAX_tutorial01_Partial_Page_Updates_cs.pdf)

> Возможно, наиболее видимой функцией расширений AJAX ASP.NET является возможность выполнять частичное или добавочное обновление страницы без выполнения полной обратной передачи на сервер, не внося изменений в код и минимальных изменений разметки. Преимущества очень обширны — состояние мультимедиа (например, Adobe Flash или Windows Media) не изменяется, затраты на пропускную способность уменьшаются, и клиент не может столкнуться с мерцанием, обычно связанным с обратной передачей.

## <a name="introduction"></a>Введение

Технология ASP.NET Майкрософт предоставляет объектно-ориентированную и основанную на событиях модель программирования и объединяет их с преимуществами скомпилированного кода. Однако модель обработки на стороне сервера имеет несколько недостатков, присущих этой технологии:

- Для обновления страниц требуется циклический обмен данными с сервером, для которого требуется обновление страницы.
- Круговые передачи не сохраняют никаких эффектов, созданных JavaScript или другими клиентскими технологиями (например, Adobe Flash).
- Во время обратной передачи браузеры, отличные от Microsoft Internet Explorer, не поддерживают автоматическое восстановление расположения прокрутки. Даже в Internet Explorer по мере обновления страницы все равно возникает мерцание.
- Обратная передача может занимать большой объем пропускной способности, так как размер поля формы \_\_VIEWSTATE может увеличиваться, особенно при работе с такими элементами управления, как GridView или Repeater.
- Нет единой модели для доступа к веб-службам с помощью JavaScript или другой клиентской технологии.

Введите расширения AJAX для Microsoft ASP.NET. AJAX, который **означает синхронный** **J** аваскрипт A ND **X** ml, представляет собой интегрированную платформу для обеспечения добавочных обновлений страниц **с** помощью межплатформенного сценария JavaScript, состоящего из кода на стороне сервера, включающего платформу Microsoft AJAX Framework, и компонента скрипта, который называется библиотекой скриптов Microsoft AJAX. Расширения AJAX ASP.NET также обеспечивают кросс-платформенную поддержку для доступа к веб-службам ASP.NET через JavaScript.

В этом техническом документе рассматриваются функции частичного обновления страниц для расширений AJAX ASP.NET, включая компонент ScriptManager, элемент управления UpdatePanel и элемент управления UpdateProgress, и рассматриваются сценарии, в которых они должны или не должны быть используется.

Этот технический документ основан на выпуске бета-версии 2 Visual Studio 2008 и .NET Framework 3,5, который интегрирует расширения AJAX ASP.NET в библиотеку базовых классов (где ранее был добавлен компонент, доступный для ASP.NET 2,0). В этом техническом документе также предполагается, что вы используете Visual Studio 2008, а не Visual Web Developer Express Edition. Некоторые шаблоны проектов, на которые имеются ссылки, могут быть недоступны пользователям Visual Web Developer Express.

## <a name="partial-page-updates"></a>Частичные обновления страниц

Возможно, наиболее видимой функцией расширений AJAX ASP.NET является возможность выполнять частичное или добавочное обновление страницы без выполнения полной обратной передачи на сервер, не внося изменений в код и минимальных изменений разметки. Преимущества очень обширны — состояние мультимедиа (например, Adobe Flash или Windows Media) не изменяется, затраты на пропускную способность уменьшаются, и клиент не может столкнуться с мерцанием, обычно связанным с обратной передачей.

Возможность интеграции частичной отрисовки страниц интегрирована в ASP.NET с минимальными изменениями в проекте.

## <a name="walkthrough-integrating-partial-rendering-into-an-existing-project"></a>Пошаговое руководство. Интеграция частичной визуализации в существующий проект

1. В Microsoft Visual Studio 2008 создайте новый проект веб-сайта ASP.NET, последовательно выбрав <em>файл</em> <em>-&gt; новый</em> <em>-&gt; веб-сайт</em> и выбрав в диалоговом окне веб-сайт ASP.NET. Можно присвоить ему любое имя и установить его либо в файловую систему, либо в службы IIS (IIS).
2. Отобразится пустая страница по умолчанию с базовой разметкой ASP.NET (форма на стороне сервера и директива `@Page`). Перетащите метку с именем `Label1` и кнопку с именем `Button1` на страницу в элементе Form. Можно задать свои свойства текста по своему усмотрению.
3. В представление конструирования дважды щелкните `Button1`, чтобы создать обработчик событий кода программной части. В этом обработчике событий задайте `Label1.Text`, щелкнув кнопку! .

**Листинг 1. Разметка для Default. aspx перед включением частичной визуализации**

[!code-aspx[Main](understanding-partial-page-updates-with-asp-net-ajax/samples/sample1.aspx)]

**Листинг 2: CodeBehind (обрезанный) в default.aspx.cs**

[!code-csharp[Main](understanding-partial-page-updates-with-asp-net-ajax/samples/sample2.cs)]

1. Нажмите клавишу F5, чтобы запустить веб-сайт. Visual Studio предложит добавить файл Web. config, чтобы включить отладку; Сделайте это. При нажатии кнопки Обратите внимание, что страница обновляется для изменения текста в метке, и при перерисовке страницы возникает небольшая мерцание.
2. После закрытия окна браузера вернитесь в Visual Studio и на страницу разметки. Прокрутите окно вниз на панели элементов Visual Studio и найдите вкладку расширения AJAX. (Если эта вкладка отсутствует, поскольку используется более старая версия расширений AJAX или Atlas, см. Пошаговое руководство по регистрации элементов инструментария расширений AJAX далее в этом техническом документе или установка текущей версии с установщик Windows скачать. с веб-сайта).

[![](understanding-partial-page-updates-with-asp-net-ajax/_static/image2.png)](understanding-partial-page-updates-with-asp-net-ajax/_static/image1.png)

([Щелкните, чтобы просмотреть изображение с полным размером](understanding-partial-page-updates-with-asp-net-ajax/_static/image3.png))

1. <em>Известная ошибка:</em> При установке Visual Studio 2008 на компьютер, на котором уже установлена Visual Studio 2005 с расширениями AJAX ASP.NET 2,0, Visual Studio 2008 импортирует элементы панели элементов расширений AJAX. Определить, является ли это случайным, можно, изучив подсказку компонентов. они должны сказать версию 3.5.0.0. Если они говорят как версия 2.0.0.0, вы импортировали старые элементы панели элементов и вам потребуется вручную импортировать их с помощью диалогового окна Выбор элементов панели элементов в Visual Studio. Вы не сможете добавить элементы управления версии 2 с помощью конструктора.

2. Перед началом тега `<asp:Label>` создайте строку пробелов и дважды щелкните элемент управления UpdatePanel на панели элементов. Обратите внимание, что в верхней части страницы включена новая директива `@Register`, указывающая, что элементы управления в пространстве имен System. Web. UI следует импортировать с помощью префикса `asp:`.
3. Перетащите закрывающий тег `</asp:UpdatePanel>` после конца элемента Button, чтобы элемент был правильно сформирован с помощью элемента управления Label и Button.
4. После открывающего тега `<asp:UpdatePanel>` Начните открывать новый тег. Обратите внимание, что IntelliSense предлагает два варианта. В этом случае создайте тег `<ContentTemplate>`. Не забудьте поместить этот тег вокруг метки и кнопки, чтобы разметка была правильно сформирована.

[![](understanding-partial-page-updates-with-asp-net-ajax/_static/image5.png)](understanding-partial-page-updates-with-asp-net-ajax/_static/image4.png)

([Щелкните, чтобы просмотреть изображение с полным размером](understanding-partial-page-updates-with-asp-net-ajax/_static/image6.png))

1. В любом месте элемента `<form>` включите элемент управления ScriptManager, дважды щелкнув элемент `ScriptManager` на панели элементов.
2. Измените тег `<asp:ScriptManager>`, чтобы он включал `EnablePartialRendering= true`атрибута.

**Листинг 3. Разметка для Default. aspx с включенной частичной отрисовкой**

[!code-aspx[Main](understanding-partial-page-updates-with-asp-net-ajax/samples/sample3.aspx)]

1. Откройте файл Web. config. Обратите внимание, что Visual Studio автоматически добавила ссылку на компиляцию в библиотеку System. Web. Extensions. dll.

1. Новые возможности Visual Studio 2008: файл Web. config, поставляемый с шаблонами проекта веб-сайта ASP.NET, автоматически включает все необходимые ссылки на расширения AJAX ASP.NET и включает разделы с комментариями в сведениях о конфигурации, которые могут быть некомментирование для включения дополнительных функций. В Visual Studio 2005 существовали похожие шаблоны при установке расширений AJAX ASP.NET 2,0. Однако в Visual Studio 2008 расширения AJAX являются отказаться по умолчанию (то есть на них ссылаются по умолчанию, но их можно удалить в виде ссылок).

[![](understanding-partial-page-updates-with-asp-net-ajax/_static/image8.png)](understanding-partial-page-updates-with-asp-net-ajax/_static/image7.png)

([Щелкните, чтобы просмотреть изображение с полным размером](understanding-partial-page-updates-with-asp-net-ajax/_static/image9.png))

1. Нажмите клавишу F5, чтобы запустить веб-сайт. Обратите внимание, что изменения исходного кода не требовались для поддержки частичной отрисовки разметки.

При запуске веб-сайта вы увидите, что частичная визуализация теперь включена, так как при нажатии кнопки не будет мерцания, а также не будет никаких изменений в положении прокрутки страницы (в этом примере это не демонстрируется). Если после нажатия кнопки вы хотите взглянуть на отображаемый источник страницы, он подтвердит, что на самом деле не выполнена обратная передача — исходный текст метки по-прежнему является частью исходной разметки, а метка изменилась с помощью JavaScript.

Visual Studio 2008 не поставляется с предварительно определенным шаблоном для веб-сайта с поддержкой AJAX ASP.NET. Однако такой шаблон был доступен в Visual Studio 2005, если установлены расширения AJAX для Visual Studio 2005 и ASP.NET 2,0. Таким образом, Настройка веб-сайта и запуск шаблона веб-сайта с поддержкой AJAX, скорее всего, будут еще проще, так как шаблон должен включать полностью настроенный файл Web. config (поддерживающий все расширения ASP.NET AJAX, включая доступ к веб-службам). и сериализация JSON — нотация объектов JavaScript), которая по умолчанию включает UpdatePanel и ContentTemplate на главной странице веб-форм. Включение частичной визуализации со страницей по умолчанию сводится к переходу на шаг 10 из этого пошагового руководства и перетаскивании элементов управления на страницу.

## <a name="the-scriptmanager-control"></a>Элемент управления ScriptManager

## <a name="scriptmanager-control-reference"></a>Справочник по элементу управления ScriptManager

Свойства с поддержкой разметки:

| **Имя свойства** | **Тип** | **Описание** |
| --- | --- | --- |
| Алловкустомеррорс — перенаправление | Bool | Указывает, следует ли использовать пользовательский раздел ошибок файла Web. config для работы с ошибками. |
| Асинкпостбаккеррор — сообщение | String | Возвращает или задает сообщение об ошибке, отправляемое клиенту при возникновении ошибки. |
| Асинкпостбакк — время ожидания | Int32 | Возвращает или задает количество времени по умолчанию, по истечении которого клиент должен ожидать завершения асинхронного запроса. |
| Енаблескрипт — глобализация | Bool | Возвращает или задает, включена ли глобализация скриптов. |
| Енаблескрипт-локализация | Bool | Возвращает или задает, включена ли локализация скриптов. |
| скриптлоадтимеаут | Int32 | Определяет количество секунд, разрешенное для загрузки скриптов в клиент |
| скриптмоде | Enum (авто, отладка, выпуск, наследовать) | Возвращает или задает значение, указывающее, следует ли визуализировать окончательные версии скриптов |
| ScriptPath | String | Возвращает или задает корневой путь к расположению файлов скрипта, отправляемых клиенту. |

Свойства только для кода:

| **Имя свойства** | **Тип** | **Описание** |
| --- | --- | --- |
| AuthenticationService | Диспетчер AuthenticationService | Возвращает сведения о прокси-сервере службы проверки подлинности ASP.NET, который будет отправлен клиенту. |
| исдебуггинженаблед | Bool | Возвращает, включена ли отладка скриптов и кода. |
| исинасинкпостбакк | Bool | Возвращает значение, указывающее, находится ли страница в данный момент в асинхронном обратном запросе POST. |
| ProfileService | Диспетчер ProfileService-Manager | Возвращает сведения о прокси-сервере службы профилирования ASP.NET, который будет отправлен клиенту. |
| Сценарии | Справочник по скрипту&lt;коллекции&gt; | Возвращает коллекцию ссылок на скрипт, которые будут отправлены клиенту. |
| Службы | Ссылка на службу&lt;коллекции&gt; | Возвращает коллекцию ссылок прокси веб-службы, которые будут отправлены клиенту. |
| SupportsPartialRendering | Bool | Возвращает значение, указывающее, поддерживает ли текущий клиент частичную визуализацию. Если это свойство возвращает **значение false**, все запросы страниц будут стандартными обратными вызовами. |

Методы открытого кода:

| **Имя метода** | **Тип** | **Описание** |
| --- | --- | --- |
| SetFocus (String) | Void | Устанавливает фокус клиента на определенный элемент управления после завершения запроса. |

Дочерние элементы разметки:

| **Тег** | **Описание** |
| --- | --- |
| &lt;AuthenticationService&gt; | Предоставляет сведения о прокси-сервере для службы проверки подлинности ASP.NET. |
| &lt;ProfileService&gt; | Предоставляет сведения о прокси-сервере для службы профилирования ASP.NET. |
| &lt;Сценарии&gt; | Предоставляет дополнительные ссылки на скрипты. |
| &lt;ASP: ScriptReference&gt; | Обозначает определенную ссылку на скрипт. |
| &lt;Служба&gt; | Предоставляет дополнительные ссылки на веб-службы, которые будут создаваться классами прокси. |
| &lt;ASP: укзать&gt; | Обозначает определенную ссылку на веб-службу. |

Элемент управления ScriptManager является основным ядром для расширений AJAX ASP.NET. Он предоставляет доступ к библиотеке сценариев (включая обширную систему типов сценариев на стороне клиента), поддерживает частичную визуализацию и обеспечивает расширенную поддержку дополнительных служб ASP.NET (таких как проверка подлинности и профилирование, но также другие веб-службы). Элемент управления ScriptManager также обеспечивает поддержку глобализации и локализации клиентских сценариев.

## <a name="providing-alternative-and-supplemental-scripts"></a>Предоставление альтернативных и дополнительных сценариев

Хотя расширения AJAX для Microsoft ASP.NET 2,0 включают весь код скрипта как в отладочных, так и в выпусках выпуска как ресурсы, внедренные в упоминаемые сборки, разработчики могут перенаправить ScriptManager на настраиваемые файлы сценариев, а также зарегистрировать Дополнительные необходимые скрипты.

Чтобы переопределить привязку по умолчанию для обычно включаемых скриптов (например, для поддержки пространства имен sys. WebForms и пользовательской системы ввода), можно зарегистрировать событие `ResolveScriptReference` класса ScriptManager. При вызове этого метода обработчик событий имеет возможность изменить путь к файлу скрипта. затем Диспетчер скриптов отправляет клиенту другую или настроенную копию скриптов.

Кроме того, ссылки на скрипты (представленные классом `ScriptReference`) можно добавить программно или с помощью разметки. Для этого либо программно измените `ScriptManager.Scripts` коллекцию, либо включите теги `<asp:ScriptReference>` в тег `<Scripts>`, который является дочерним элементом первого уровня элемента управления ScriptManager.

## <a name="custom-error-handling-for-updatepanels"></a>Настраиваемая обработка ошибок для UpdatePanel

Хотя обновления обрабатываются триггерами, заданными элементами управления UpdatePanel, поддержка обработки ошибок и пользовательских сообщений об ошибках обрабатывается экземпляром элемента управления ScriptManager страницы. Это делается путем предоставления на страницу события `AsyncPostBackError`, которое затем может предоставить настраиваемую логику обработки исключений.

Используя событие Асинкпостбаккеррор, можно указать свойство `AsyncPostBackErrorMessage`, которое затем вызывает появление окна предупреждения после завершения обратного вызова.

Настройка на стороне клиента также возможна, вместо использования поля предупреждения по умолчанию. Например, может потребоваться отобразить настроенный элемент `<div>`, а не модальное диалоговое окно браузера по умолчанию. В этом случае ошибку можно решить в клиентском скрипте:

**Листинг 5. сценарий на стороне клиента для отображения пользовательских ошибок**

[!code-html[Main](understanding-partial-page-updates-with-asp-net-ajax/samples/sample4.html)]

Довольно просто, приведенный выше скрипт регистрирует обратный вызов с клиентской средой выполнения AJAX для завершения асинхронного запроса. Затем он проверяет, была ли обнаружена ошибка, и, если это так, обрабатывает сведения о ней, и, наконец, указывает среде выполнения, что ошибка была обработана в пользовательском скрипте.

## <a name="globalization-and-localization-support"></a>Поддержка глобализации и локализации

Элемент управления ScriptManager обеспечивает расширенную поддержку локализации строк скриптов и компонентов пользовательского интерфейса. Однако этот раздел находится за пределами области этого технического документа. Дополнительные сведения см. в техническом документе поддержка глобализации в ASP.NET AJAX Extensions.

## <a name="the-updatepanel-control"></a>Элемент управления UpdatePanel

## <a name="updatepanel-control-reference"></a>Справочник по элементу UpdatePanel

Свойства с поддержкой разметки:

| **Имя свойства** | **Тип** | **Описание** |
| --- | --- | --- |
| ChildrenAsTriggers | bool | Указывает, будут ли дочерние элементы управления автоматически вызывать обновление при обратной передаче. |
| RenderMode | Enum (Block, inline) | Указывает способ визуального представления содержимого. |
| UpdateMode | Enum (всегда, условный) | Указывает, всегда ли обновляется UpdatePanel во время частичной визуализации или обновляется только при достижении триггера. |

Свойства только для кода:

| **Имя свойства** | **Тип** | **Описание** |
| --- | --- | --- |
| исинпартиалрендеринг | bool | Возвращает значение, указывающее, поддерживает ли UpdatePanel частичную визуализацию для текущего запроса. |
| ContentTemplate | итемплате | Возвращает шаблон разметки для запроса на обновление. |
| контенттемплатеконтаинер | Control | Возвращает программный шаблон для запроса на обновление. |
| Триггеры | UpdatePanel — Тригжерколлектион | Возвращает список триггеров, связанных с текущим элементом UpdatePanel. |

Методы открытого кода:

| **Имя метода** | **Тип** | **Описание** |
| --- | --- | --- |
| Update () | Void | Обновляет указанную UpdatePanel программным образом. Разрешает серверу запрос на запуск частичной прорисовки UpdatePanel, не активированной в противном случае. |

Дочерние элементы разметки:

| **Тег** | **Описание** |
| --- | --- |
| &lt;ContentTemplate&gt; | Указывает разметку, используемую для визуализации результата частичной визуализации. Дочерний элемент &lt;ASP: UpdatePanel&gt;. |
| &lt;Триггеры&gt; | Указывает коллекцию элементов управления *n* , связанных с обновлением этой UpdatePanel. Дочерний элемент &lt;ASP: UpdatePanel&gt;. |
| &lt;ASP: Асинкпостбакктригжер&gt; | Указывает триггер, который вызывает частичную отрисовку страницы для заданной UpdatePanel. Это может быть или не быть элементом управления в качестве потомка элемента UpdatePanel. Детализация по имени события. Дочерний элемент &lt;триггеры&gt;. |
| &lt;ASP: Постбакктригжер&gt; | Указывает элемент управления, который вызывает обновление всей страницы. Это может быть или не быть элементом управления в качестве потомка элемента UpdatePanel. Детализация для объекта. Дочерний элемент &lt;триггеры&gt;. |

Элемент управления `UpdatePanel` — это элемент управления, который разделяет содержимое на стороне сервера, которое будет принимать участие в функции частичной визуализации расширений AJAX. Количество элементов управления UpdatePanel, которые могут быть на странице, не ограничено, и они могут быть вложенными. Каждая UpdatePanel изолирована, поэтому каждая из них может работать независимо (одновременно могут выполняться два элемента UpdatePanel, которые отображают различные части страницы независимо от обратной передачи страницы).

Элемент управления UpdatePanel в основном работает с триггерами управления. по умолчанию любой элемент управления, содержащийся в `ContentTemplate` UpdatePanel, который создает обратную передачу, регистрируется в качестве триггера для UpdatePanel. Это означает, что UpdatePanel может работать с элементами управления, привязанными к данным по умолчанию (например, GridView), с пользовательскими элементами управления, и их можно программировать в сценарии.

По умолчанию при запуске частичной визуализации страницы все элементы управления UpdatePanel на странице будут обновлены независимо от того, определены ли в элементе управления UpdatePanel триггеры для такого действия. Например, если одна UpdatePanel определяет элемент управления Button, и этот элемент управления Button нажат, все элементы управления UpdatePanel на этой странице будут обновляться по умолчанию. Это вызвано тем, что по умолчанию свойству `UpdateMode` элемента UpdatePanel присвоено значение `Always`. Кроме того, можно задать для свойства UpdateMode значение `Conditional`. Это означает, что UpdatePanel будет обновляться только при попадании определенного триггера.

## <a name="custom-control-notes"></a>Заметки пользовательского элемента управления

UpdatePanel можно добавить к любому пользовательскому элементу управления или пользовательскому элементу управления; Однако страница, на которой включены эти элементы управления, также должна включать элемент управления ScriptManager, свойство EnablePartialRendering которого имеет значение **true**.

Один из способов, с помощью которого вы можете учитывать это при использовании пользовательских веб-элементов управления, — переопределить защищенный метод `CreateChildControls()` класса `CompositeControl`. Таким образом, вы можете внедрить элемент управления UpdatePanel между дочерними элементами и внешним миром, если вы определили, что страница поддерживает частичную визуализацию. в противном случае дочерние элементы управления можно просто дослойировать в контейнер `Control` экземпляр.

## <a name="updatepanel-considerations"></a>Рекомендации по UpdatePanel

UpdatePanel работает как что-нибудь из черного ящика, заключив обратную передачу ASP.NET в контексте JavaScript XMLHttpRequest. Однако существуют значительные соображения по производительности, которые следует учитывать в плане поведения и скорости. Чтобы понять, как работает UpdatePanel, вы сможете лучше решить, когда подходит ее использование, следует изучить обмен AJAX. В следующем примере используется существующий сайт и Mozilla Firefox с расширением Firebug (Firebug фиксирует данные XMLHttpRequest).

Рассмотрим форму, которая, помимо прочего, содержит текстовое поле Почтовый индекс, которое должно заполнять поля город и штат в форме или элементе управления. Эта форма в конечном итоге собирает сведения о членстве, включая имя пользователя, адрес и контактные данные. В зависимости от требований конкретного проекта необходимо учитывать множество аспектов проектирования.

[![](understanding-partial-page-updates-with-asp-net-ajax/_static/image11.png)](understanding-partial-page-updates-with-asp-net-ajax/_static/image10.png)

([Щелкните, чтобы просмотреть изображение с полным размером](understanding-partial-page-updates-with-asp-net-ajax/_static/image12.png))

[![](understanding-partial-page-updates-with-asp-net-ajax/_static/image14.png)](understanding-partial-page-updates-with-asp-net-ajax/_static/image13.png)

([Щелкните, чтобы просмотреть изображение с полным размером](understanding-partial-page-updates-with-asp-net-ajax/_static/image15.png))

В исходной итерации этого приложения был создан элемент управления, включающий все данные регистрации пользователя, включая почтовый индекс, город и штат. Весь элемент управления был заключен в UpdatePanel и помещен в веб-форму. Когда почтовый индекс вводит пользователь, UpdatePanel обнаруживает событие (соответствующее событие TextChanged в серверной части, указывая триггеры или используя свойство ChildrenAsTriggers, установленное в значение true). AJAX отправляет все поля внутри UpdatePanel в соответствии с захватом FireBug (см. диаграмму справа).

По мере того как снимок экрана показывает, доставляются значения всех элементов управления в UpdatePanel (в данном случае все они пусты), а также поле ViewState. Отправляются все запросы, направленные на 9Kb данных, когда в действительности для выполнения этого запроса требуется только пять байт данных. Ответ еще более чрезмерно: в итоге 57kb отправляется клиенту, просто для обновления текстового поля и раскрывающегося поля.

Он также может представлять интерес, чтобы увидеть, как ASP.NET AJAX обновляет презентацию. Часть ответа в запросе на обновление UpdatePanel отображается в левой части окна консоли Firebug. Это особая формулировка строки с разделением каналов, которая разбивается клиентским сценарием и затем собирается на странице. В частности, ASP.NET AJAX устанавливает свойство *InnerHtml* элемента HTML на клиенте, который представляет элемент UpdatePanel. Так как браузер повторно создает модель DOM, возникает небольшая задержка, в зависимости от объема информации, которую необходимо обработать.

Повторное создание модели DOM вызывает ряд дополнительных проблем:

[![](understanding-partial-page-updates-with-asp-net-ajax/_static/image17.png)](understanding-partial-page-updates-with-asp-net-ajax/_static/image16.png)

([Щелкните, чтобы просмотреть изображение с полным размером](understanding-partial-page-updates-with-asp-net-ajax/_static/image18.png))

- Если элемент HTML с фокусом находится внутри UpdatePanel, фокус будет утерян. Таким образом, для пользователей, которые нажал клавишу TAB для выхода из текстового поля Почтовый индекс, их следующее назначение было бы текстовым полем город. Однако после того, как UpdatePanel обновила отображение, форма больше не будет иметь фокус, а нажатие клавиши TAB начнет выделять элементы фокуса (например, ссылки).
- Если используется любой тип пользовательского клиентского скрипта, обращающегося к элементам DOM, ссылки, сохраняемые функциями, могут быть уничтожены после частичной обратной передачи.

UpdatePanel не предназначена для перехватывать все решения. Вместо этого они предоставляют быстрое решение для определенных ситуаций, включая создание прототипов, обновление небольших элементов управления и предоставление привычного интерфейса для ASP.NET разработчиков, которые могут быть знакомы с объектной моделью .NET, но меньше, чем с моделью DOM. Существует несколько альтернатив, которые могут привести к лучшей производительности в зависимости от сценария приложения.

- Рассмотрите возможность использования Pagemethod и JSON (нотация объектов JavaScript), позволяя разработчику вызывать статические методы на странице, как если бы вызывался вызов веб-службы. Поскольку методы являются статическими, состояние не требуется. вызывающий сценарий предоставляет параметры, и результат возвращается асинхронно.
- Рассмотрите возможность использования веб-службы и JSON, если один элемент управления необходимо использовать в нескольких местах приложения. Это снова требует очень небольшой работы и работает асинхронно.

Включение функций с помощью веб-служб или методов страниц также имеет свои недостатки. В первую и самое главное, разработчики ASP.NET обычно создают небольшие компоненты функциональности в пользовательских элементах управления (ASCX-файлах). Методы страниц не могут размещаться в этих файлах; они должны размещаться в фактическом классе ASPX-страницы. Веб-службы, аналогично, должны размещаться в классе. asmx. В зависимости от приложения эта архитектура может нарушать принцип одной ответственности, в то же самое, что функциональные возможности одного компонента теперь распределены по двум или более физическим компонентам, которые могут иметь небольшую или не имеющую связную взаимосвязей.

Наконец, если приложение требует использования UpdatePanel, следующие рекомендации должны помочь при устранении неполадок и обслуживании.

- **Старайтесь как можно меньшее количество элементов UpdatePanel, не только внутри единиц, но и в разных единицах кода.** Например, наличие UpdatePanel на странице, которая является оболочкой для элемента управления, а также содержит элемент управления UpdatePanel, который содержит другой элемент управления, содержащий UpdatePanel, — это вложенность между единицами. Это позволяет не только очищать элементы, которые необходимо обновить, но и предотвращает непредвиденные обновления дочерних элементов UpdatePanel.
- **Установите для свойства *ChildrenAsTriggers* значение false и явно задавайте события, вызывающие срабатывание.** Использование коллекции `<Triggers>` является намного более четким способом обработки событий и может привести к непредсказуемому поведению, помогая задачам обслуживания и принудительному участию разработчика в отношении события.
- **Используйте наименьшую возможную единицу для достижения функциональных возможностей.** Как отмечалось в обсуждении службы почтовых индексов, следует заключить в оболочку только минимальное время до сервера, общую обработку и объем обмена данными между клиентом и сервером, повышая производительность.

## <a name="the-updateprogress-control"></a>Элемент управления UpdateProgress

## <a name="updateprogress-control-reference"></a>Справочник по элементу управления UpdateProgress

Свойства с поддержкой разметки:

| **Имя свойства** | **Тип** | **Описание** |
| --- | --- | --- |
| АссоЦиатедупдате — Панелид | String | Указывает идентификатор элемента UpdatePanel, по которому должен быть отчет UpdateProgress. |
| дисплайафтер | Int | Указывает время ожидания в миллисекундах перед отображением этого элемента управления после начала асинхронного запроса. |
| динамиклайаут | bool | Указывает, отображается ли ход выполнения динамически. |

Дочерние элементы разметки:

| **Тег** | **Описание** |
| --- | --- |
| &lt;Прогресстемплате&gt; | Содержит шаблон элемента управления, заданный для содержимого, которое будет отображаться с этим элементом управления. |

Элемент управления UpdateProgress дает возможность отследить Отзывы пользователей, чтобы они не изменялись при выполнении необходимой работы для передачи на сервер. Это поможет вашим пользователям знать, что вы выполняете какие-либо действия, даже если они не очевидны, особенно потому, что большинство пользователей используются для обновления страницы и отображения выделения в строке состояния.

Обратите внимание, что элементы управления UpdateProgress могут располагаться в любом месте иерархии страниц. Однако в случаях, когда частичная обратная передача инициируется из дочерней UpdatePanel (где UpdatePanel вложена в другую UpdatePanel), обратная передача, вызывающая дочерние элементы UpdatePanel, приведет к отображению шаблонов UpdateProgress для дочернего элемента UpdatePanel и родительская UpdatePanel. Но если триггер является прямым дочерним элементом родительской UpdatePanel, то будут отображаться только шаблоны UpdateProgress, связанные с родительским элементом.

## <a name="summary"></a>Сводка

Расширения Microsoft ASP.NET AJAX — это сложные продукты, разработанные для упрощения доступа к веб-содержимому и предоставления пользователям возможности работы с веб-приложениями. В рамках расширений AJAX ASP.NET элементы управления частичной отрисовкой страницы, включая ScriptManager, UpdatePanel и UpdateProgress, являются некоторыми из наиболее видимых компонентов набора инструментов.

Компонент ScriptManager интегрирует код JavaScript клиента для расширений, а также позволяет различным серверным и клиентским компонентам работать вместе с минимальными вложениями в разработку.

Элемент управления UpdatePanel является очевидным волшебным полем, разметкой в UpdatePanel может быть фоновый код на стороне сервера и не запускается обновление страницы. Элементы управления UpdatePanel могут быть вложенными и могут зависеть от элементов управления в других элементах UpdatePanel. По умолчанию UpdatePanel обрабатывает любые обратные передачи, вызванные их дочерними элементами управления, хотя эту функцию можно настроить с помощью декларативного или программного кода.

При использовании элемента управления UpdatePanel разработчики должны учитывать воздействие на производительность, которое потенциально может возникнуть. К потенциальным альтернативам относятся веб-службы и методы страниц, хотя необходимо учитывать структуру приложения.

Элемент управления UpdateProgress позволяет пользователю знать, что он или он не пропускается, а фоновый запрос выполняется, пока страница не выполняет никаких действий для ответа на вводимые пользователем данные. Он также включает возможность прерывать результаты частичной визуализации.

Вместе эти средства помогают создавать полнофункциональный и удобный пользовательский интерфейс, делая сервер более очевидным для пользователя и уменьшая процесс прерывания работы.

## <a name="bio"></a>Биография

Скотт Cate работал с веб-технологиями Майкрософт с 1997 и является президентом myKB.com ([www.myKB.com](http://www.myKB.com)), где он специализируется на написании приложений ASP.NET на базе знаний, посвященных программным решениям. Скотт может связаться по электронной почте по адресу [scott.cate@myKB.com](mailto:scott.cate@myKB.com) или в блоге по адресу [ScottCate.com](http://ScottCate.com)

> [!div class="step-by-step"]
> [Дальше](understanding-asp-net-ajax-updatepanel-triggers.md)
