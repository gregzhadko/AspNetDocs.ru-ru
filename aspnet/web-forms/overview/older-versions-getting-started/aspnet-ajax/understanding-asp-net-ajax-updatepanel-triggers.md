---
uid: web-forms/overview/older-versions-getting-started/aspnet-ajax/understanding-asp-net-ajax-updatepanel-triggers
title: Основные сведения о триггерах UpdatePanel ASP.NET AJAX | Документация Майкрософт
author: scottcate
description: При работе в редакторе разметки в Visual Studio, можно заметить в (от IntelliSense), что существуют два дочерних элементов элемента управления UpdatePanel. Один из ч...
ms.author: riande
ms.date: 03/12/2008
ms.assetid: faab8503-2984-48a9-8a40-7728461abc50
msc.legacyurl: /web-forms/overview/older-versions-getting-started/aspnet-ajax/understanding-asp-net-ajax-updatepanel-triggers
msc.type: authoredcontent
ms.openlocfilehash: e3821eee8c7bf2c2f9b45ea75ade2bd5b3b8ef19
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59406266"
---
# <a name="understanding-aspnet-ajax-updatepanel-triggers"></a>Общие сведения о триггерах UpdatePanel ASP.NET AJAX

по [(Scott cate)](https://github.com/scottcate)

[Загрузить PDF-файл](http://download.microsoft.com/download/C/1/9/C19A3451-1D14-477C-B703-54EF22E197EE/AJAX_tutorial02_Triggers_cs.pdf)

> При работе в редакторе разметки в Visual Studio, можно заметить в (от IntelliSense), что существуют два дочерних элементов элемента управления UpdatePanel. Одно из них — элемент триггеров, который определяет элементы управления на странице (или пользовательского элемента управления, если вы используете) наступлении частичная отрисовка элемента управления UpdatePanel, в которой находится элемент.


## <a name="introduction"></a>Вступление

Технологии ASP.NET корпорации Майкрософт предоставляет модель программирования объектно ориентированные и управляемые событиями и объединяет его преимущества скомпилированного кода. Тем не менее его модель обработки на сервере имеет несколько недостатков, присущих технологии, многие из которых можно обратиться по новым функциям в расширениях AJAX для Microsoft ASP.NET 3.5. Эти расширения позволяют множество новых клиентских функций, включая частичную визуализацию страниц без необходимости полного обновления всей страницы, возможность доступа к веб-служб с помощью клиентского скрипта (в том числе ASP.NET, API профилирования) и расширенного клиентского API-интерфейса разработан для отражения, многие из схемы управления, в набор серверных элементов управления ASP.NET.

В этом официальном документе проверяет триггеры XML функциональные возможности ASP.NET AJAX `UpdatePanel` компонента. Триггеры XML обеспечивают четкий контроль над компонентами, которые могут привести к частичной визуализации для определенного элемента управления UpdatePanel.

Этот технический документ основан на бета-версии 2 .NET Framework 3.5 и Visual Studio 2008. Расширения AJAX ASP.NET, ранее сборку надстройки, предназначенные для ASP.NET 2.0 теперь встроены в библиотеке базовых классов .NET Framework. Этот технический документ также предполагается, что будете работать с Visual Studio 2008, не Visual Web Developer Express и предоставит пошаговые руководства, в соответствии с пользовательского интерфейса Visual Studio (несмотря на то, что Листинги кода будут полностью совместимы, вне зависимости от среда разработки).

## <a name="triggers"></a>*Триггеры*

Триггеры для заданного UpdatePanel, по умолчанию автоматически включают все дочерние элементы, которые вызывают обратную передачу, включая, например, элементы управления TextBox, имеющие их `AutoPostBack` свойство значение **true**. Однако триггеры также могут быть включены, декларативно с помощью разметки; Это можно сделать в `<triggers>` разделе объявление элемента управления UpdatePanel. Несмотря на то, что триггеры может осуществляться через `Triggers` свойство коллекции, рекомендуется зарегистрировать какие-либо триггеры частичной отрисовки во время выполнения (например, если элемент управления недоступен во время разработки) с помощью `RegisterAsyncPostBackControl(Control)` метод ScriptManager в объект страницы, `Page_Load` событий. Помните, что не имеют состояния, и поэтому необходимо повторно зарегистрировать эти элементы управления каждый раз, когда они создаются.

Включение триггера автоматического дочерних также может быть отключена (таким образом, дочерние элементы управления, которые создают обратных передач автоматически не запустит частичного подготавливает к просмотру), задав `ChildrenAsTriggers` свойства **false**. Благодаря этому можно наибольшую гибкость при присвоении какие конкретные элементы управления могут вызывать отрисовка страницы и рекомендуется, так что разработчик будет согласиться реагировать на события, а не обработки событий, которые могут возникнуть.

Обратите внимание, что когда UpdatePanel элементы управления являются вложенными, если UpdateMode присвоено **условного**, если запускается дочерний UpdatePanel, но родительский не, затем только дочерние, будет обновляться UpdatePanel. Тем не менее если родительский UpdatePanel обновляется, затем дочерний UpdatePanel также будет обновлен.

## <a name="the-lttriggersgt-element"></a>*&lt;Триггеры&gt; элемент*

При работе в редакторе разметки в Visual Studio, вы можете заметить (от IntelliSense), два дочерних элемента из `UpdatePanel` элемента управления. Наиболее часто появления элемента является `<ContentTemplate>` элемент, который по сути инкапсулирует содержимое, которое будет нести панели обновления (содержимое, для которого мы поощряем частичная визуализация). Второй элемент — `<Triggers>` элемент, который определяет элементы управления на странице (или пользовательского элемента управления, если вы используете) наступлении частичная отрисовка элемента управления UpdatePanel в которой &lt;триггеры&gt; находится элемент.

`<Triggers>` Элемент может содержать любое количество каждого два дочерних узла: `<asp:AsyncPostBackTrigger>` и `<asp:PostBackTrigger>`. Они принимают два атрибута `ControlID` и `EventName`и можно указать любой элемент управления в текущей единице измерения инкапсуляции (к примеру, если элемент управления UpdatePanel, находится в пределах веб-элементе управления пользователя, не следует ссылаться на элемент управления на Страница, на котором будет находиться пользовательский элемент управления).

`<asp:AsyncPostBackTrigger>` Элемент особенно полезна в том, что могут работать любого события из элемента управления, который существует в виде дочернего элемента *любой* элемент управления UpdatePanel в единице инкапсуляции, а не только UpdatePanel, от имени которой этот триггер является дочерним . Таким образом любой элемент управления можно сделать для активации частичного обновления.

Аналогичным образом `<asp:PostBackTrigger>` элемент может использоваться для триггера, частичной визуализации, но, используется полный круговое обращение к серверу. Этот элемент триггера могут также использоваться для принудительной отрисовки всю страницу, если элемент управления обычно в противном случае активирует частичной визуализации (например, в том случае, когда `Button` элемент управления присутствует в `<ContentTemplate>` элемент управления UpdatePanel). Опять же PostBackTrigger элемента можно указать любой элемент управления, который является потомком любого элемента управления UpdatePanel в текущей единице измерения инкапсуляции.

## <a name="lttriggersgt-element-reference"></a>*&lt;Триггеры&gt; Справочник по элементам*

*Потомки разметки:*

| **Тег** | **Описание** |
| --- | --- |
| &lt;asp:AsyncPostBackTrigger&gt; | Указывает элемент управления и события, которое будет вызвать частичное обновление страницы для UpdatePanel, содержащий эту ссылку для триггера. |
| &lt;asp:PostBackTrigger&gt; | Указывает элемент управления и события, которое приведет к ее полного обновления (полного обновления всей страницы). Этот тег используется для принудительного полного обновления, когда элемент управления, в противном случае приведет к запуску частичной визуализации. |

## <a name="walkthrough-cross-updatepanel-triggers"></a>*Пошаговое руководство: Триггеры кросс UpdatePanel*

1. Создайте новую страницу ASP.NET с помощью объекта ScriptManager, задать для включения частичной визуализации. Добавление двух элементов UpdatePanel на эту страницу — в первом, включают в себя элемент управления Label (Label1) и два элемента управления Button (Button1 и Button2). Нажмите, чтобы обновить оба должно быть указано button1 и Button2 должно быть указано нажмите, чтобы обновить это или что-то роде. В втором UpdatePanel включают только элемент управления Label (Label2), но значение свойства ForeColor от значения по умолчанию для его различения.
2. Задайте для свойства UpdateMode оба тега UpdatePanel для **условного**.

**В листинге 1: Разметка для default.aspx:** 

[!code-aspx[Main](understanding-asp-net-ajax-updatepanel-triggers/samples/sample1.aspx)]

1. В обработчик событий Click для Button1 установите Label1.Text и Label2.Text зависящие от времени (например, DateTime.Now.ToLongTimeString()). В обработчик событий Click для Button2 Label1.Text должен быть только значение зависит от времени.

**В листинге 2: Фонового кода (фрагмент) в default.aspx.cs:** 

[!code-csharp[Main](understanding-asp-net-ajax-updatepanel-triggers/samples/sample2.cs)]

1. Нажмите клавишу F5 для сборки и запуска проекта. Обратите внимание, что при нажатии кнопки обновления как панелей, обе метки изменить текст; Тем не менее если щелкнуть эту панель обновления, обновляет только Label1.


[![](understanding-asp-net-ajax-updatepanel-triggers/_static/image2.png)](understanding-asp-net-ajax-updatepanel-triggers/_static/image1.png)

([Просмотр полноразмерного изображения](understanding-asp-net-ajax-updatepanel-triggers/_static/image3.png))


## <a name="under-the-hood"></a>*Внутренняя структура*

Использование в примере, который мы только что создан, мы может рассмотрим действия AJAX для ASP.NET и принципы работы наших триггеры кросс панель UpdatePanel. Чтобы сделать это, мы будем работать с генерируемой страницы исходный код HTML, а также расширение Mozilla Firefox, под названием FireBug - с его помощью можно легко проверить обратных вызовов AJAX. Мы также будем использовать средства .NET Reflector Лутца Рёдера. Оба эти средства являются общедоступными через Интернет, а также можно найти с помощью поиска в Интернете.

Изучение исходный код страницы показан почти ничего экстраординарного; элементы управления UpdatePanel, отображаются как `<div>` контейнеры, мы сможем увидеть, ресурс скрипта включает в себя, предоставляемых по `<asp:ScriptManager>`. Кроме того, существуют также некоторые новые относящегося к AJAX вызовов PageRequestManager, которые являются внутренними для библиотеки клиентских сценариев AJAX. Наконец, мы видим, два контейнера UpdatePanel — один с создаваемые `<input>` кнопки с двумя `<asp:Label>` элементов управления к просмотру в виде `<span>` контейнеры. (Если проверить дерево DOM, в FireBug можно заметить, метки будут недоступны, чтобы указать, что они не создает видимого содержимого).

Нажмите кнопку обновления этой панели и обратите внимание, что верхний UpdatePanel обновляется с текущее время сервера. В FireBug перейдите на вкладку консоли, чтобы можно было проверить запрос. Сначала проверьте параметры запроса POST:


[![](understanding-asp-net-ajax-updatepanel-triggers/_static/image5.png)](understanding-asp-net-ajax-updatepanel-triggers/_static/image4.png)

([Просмотр полноразмерного изображения](understanding-asp-net-ajax-updatepanel-triggers/_static/image6.png))


Обратите внимание, что UpdatePanel указал, код AJAX на стороне сервера точно, укажите дерево элемента управления было запущено через параметр ScriptManager1: `Button1` из `UpdatePanel1` элемента управления. Теперь нажмите кнопку обновления как панелей. Затем анализируя ответ, возникнуть серия разделением вертикальной чертой переменные, заданные в строке; в частности, мы см. в разделе верхнего UpdatePanel, `UpdatePanel1`, имеет весь его HTML, отправляемых в браузер. Библиотека клиентских сценариев AJAX подставляет UpdatePanel исходный HTML-содержимого с новым содержимым через `.innerHTML` свойство, и поэтому сервер отправляет измененное содержимое с сервера как HTML.

Теперь нажмите кнопку обновления панелей, так и проанализировать результаты с сервера. Результаты очень похожи — обоих элементов UpdatePanel получение новых HTML с сервера. Как и в предыдущем обратного вызова, отправляется состояния дополнительные страницы.

Как вы видите, так как нет специального кода используется для выполнения обратной передачи AJAX, библиотеки клиентских сценариев AJAX способен перехватывать обратной передачи формы без дополнительного кода. Серверные элементы управления автоматически использовать JavaScript, таким образом, чтобы они автоматически не отправить форму — ASP.NET автоматически внедряет код для проверки формы и состояния, главным образом достигается включения автоматического сценария ресурса, класс PostBackOptions и классу ClientScriptManager.

Например рассмотрим элемент управления CheckBox; Проверьте класс дизассемблированного кода в .NET Reflector. Чтобы сделать это, убедитесь, что сборку System.Web открыт и перейдите к `System.Web.UI.WebControls.CheckBox` класс, открыв `RenderInputTag` метод. Найдите условного выражения, которое проверяет `AutoPostBack` свойство:


[![](understanding-asp-net-ajax-updatepanel-triggers/_static/image8.png)](understanding-asp-net-ajax-updatepanel-triggers/_static/image7.png)

([Просмотр полноразмерного изображения](understanding-asp-net-ajax-updatepanel-triggers/_static/image9.png))


При включенной автоматической обратной передачи на `CheckBox` управления (с помощью свойства AutoPostBack, true), полученный `<input>` тег таким образом отображается с помощью обработки сценария в ASP.NET событий его `onclick` атрибута. Перехват отправкой формы, затем позволяет ASP.NET AJAX, которые следует вставить в страницу nonintrusively, помогая избежать возможных критических изменений, которые могут возникнуть за счет использования возможно неточный строку замены. Кроме того, это позволяет *любой* пользовательский элемент управления ASP.NET, использующие всю мощь ASP.NET AJAX без дополнительного кода для поддержки его использования в контейнере UpdatePanel.

`<triggers>` Функциональные возможности соответствует значения, инициализируемые при вызове PageRequestManager \_updateControls (Обратите внимание, что библиотека клиентских сценариев ASP.NET AJAX использует соглашение, методы, события и имена полей, которые начинаются с символа подчеркивания помеченных как внутренние и не предназначены для использования за пределами этой библиотеки). С ее помощью можно наблюдать, какие элементы управления предназначены для обратных вызовов AJAX.

Например давайте добавим два дополнительных элемента управления на страницу, оставляя один элемент управления за пределами панели UpdatePanel, полностью и оставив один раз в пределах элемента управления UpdatePanel. Мы добавим элемент управления CheckBox в верхнем UpdatePanel и перетащите DropDownList с количеством цветов, определенных в списке. Вот Новая разметка:

**Листинг 3: Новая разметка**

[!code-aspx[Main](understanding-asp-net-ajax-updatepanel-triggers/samples/sample3.aspx)]

А вот новый код программной части:

**Листинг 4: CodeBehind**

[!code-csharp[Main](understanding-asp-net-ajax-updatepanel-triggers/samples/sample4.cs)]

Идея этой странице том стрелку раскрывающегося списка выбирается один из трех цветами, у второй метки, что флажок определяет, является ли он полужирным шрифтом, и ли отображать метки даты, а также время. Флажок не должны вызывать обновление AJAX, но следует стрелку раскрывающегося списка, несмотря на то, что он не размещается внутри UpdatePanel.


[![](understanding-asp-net-ajax-updatepanel-triggers/_static/image11.png)](understanding-asp-net-ajax-updatepanel-triggers/_static/image10.png)

([Просмотр полноразмерного изображения](understanding-asp-net-ajax-updatepanel-triggers/_static/image12.png))


Как происходит в том, что на приведенном выше снимке экрана, последнюю кнопку, чтобы выбрать был этот панели обновления, которое обновляется независимо top время от времени нижней правой кнопки. Дата также выключения щелчков, как дата отображается в нижнюю метку. Наконец интерес представляет цвет нижней метки: он был обновлен позже, чем текст, который показывает, что состояние элемента управления важна, и пользователи ожидают, что он сохраняется с помощью обратной передачи AJAX. *Тем не менее*, время не был обновлен. Время автоматически повторно заполнен через сохраняемость \_ \_поле состояния ПРЕДСТАВЛЕНИЯ страницы интерпретируются средой выполнения ASP.NET, когда элемент управления повторно подготовленных к просмотру на сервере. Код сервера ASP.NET AJAX не распознает, в котором элементы управления методы их состояние изменяется; он просто повторно заполняет из состояния представления, а затем выполняется события, которые подходят.

Его следует обратить внимание, однако, что бы я инициализирована времени на странице\_событие Load, время будет увеличения правильно. Таким образом, разработчикам следует опасаться, что соответствующий код выполняется во время соответствующие обработчики событий и не рекомендуется использовать страницы\_загрузки при подойдут и обработчик событий управления.

## <a name="summary"></a>Сводка

Элемент управления UpdatePanel расширений AJAX ASP.NET универсален и может использовать ряд методов для идентификации события элементов управления, которые должны быть причиной может быть обновлена. Он поддерживает обновляется автоматически его дочерние элементы управления, но также может отвечать на события элементов управления на странице.

Чтобы уменьшить вероятность нагрузку сервера, рекомендуется `ChildrenAsTriggers` быть присвоено свойству элемента управления UpdatePanel `false`, и что события быть исключены в, а не включены по умолчанию. Также благодаря этому все ненужные события из-за потенциально нежелательные эффекты, включая проверки и изменения для полей ввода. Эти типы ошибок может быть трудно локализовать, потому что на странице обновятся сведения прозрачно для пользователя, и причину таким образом не может сразу очевидно.

С помощью проверки внутренней работы ASP.NET AJAX формы post перехвата модели, мы смогли определить, что она использует framework, уже обеспечиваемые ASP.NET. Таким образом, он сохраняет максимальную совместимость с элементами управления, разработанные с применением та же платформа и как минимум intrudes на любые дополнительные JavaScript, написанный для страницы.

## <a name="bio"></a>Биография

Роб Paveza — старший разработчик приложения .NET Terralever ([www.terralever.com](http://www.terralever.com)), ведущая компания интерактивного маркетинга в Tempe, AZ. Ним можно связаться по адресу [ robpaveza@gmail.com ](mailto:robpaveza@gmail.com), а его блог находится в каталоге [ http://geekswithblogs.net/robp/ ](http://geekswithblogs.net/robp/).

(Scott cate) работает с веб-технологиями Microsoft с 1997 года и является президентом myKB.com ([www.myKB.com](http://www.myKB.com)) приложений, внимание уделяется знаний программных решений, где он специализируется на написание ASP.NET на основе. Скоттом можно связаться по электронной почте [ scott.cate@myKB.com ](mailto:scott.cate@myKB.com) или его блог по адресу [ScottCate.com](http://ScottCate.com)

> [!div class="step-by-step"]
> [Назад](understanding-partial-page-updates-with-asp-net-ajax.md)
> [Вперед](understanding-asp-net-ajax-authentication-and-profile-application-services.md)
