---
uid: web-forms/overview/older-versions-getting-started/aspnet-ajax/understanding-asp-net-ajax-updatepanel-triggers
title: Основные сведения о триггерах UpdatePanel ASP.NET AJAX | Документация Майкрософт
author: scottcate
description: При работе в редакторе разметки в Visual Studio можно заметить, что в IntelliSense есть два дочерних элемента элемента управления UpdatePanel. Один из них:...
ms.author: riande
ms.date: 03/12/2008
ms.assetid: faab8503-2984-48a9-8a40-7728461abc50
msc.legacyurl: /web-forms/overview/older-versions-getting-started/aspnet-ajax/understanding-asp-net-ajax-updatepanel-triggers
msc.type: authoredcontent
ms.openlocfilehash: b1cc869f373d4f8283b4d92af74707c3f11fef61
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/28/2019
ms.locfileid: "74588840"
---
# <a name="understanding-aspnet-ajax-updatepanel-triggers"></a><span data-ttu-id="67e46-104">Общие сведения о триггерах UpdatePanel ASP.NET AJAX</span><span class="sxs-lookup"><span data-stu-id="67e46-104">Understanding ASP.NET AJAX UpdatePanel Triggers</span></span>

<span data-ttu-id="67e46-105">по [Скотт Cate](https://github.com/scottcate)</span><span class="sxs-lookup"><span data-stu-id="67e46-105">by [Scott Cate](https://github.com/scottcate)</span></span>

[<span data-ttu-id="67e46-106">Загрузить PDF-файл</span><span class="sxs-lookup"><span data-stu-id="67e46-106">Download PDF</span></span>](https://download.microsoft.com/download/C/1/9/C19A3451-1D14-477C-B703-54EF22E197EE/AJAX_tutorial02_Triggers_cs.pdf)

> <span data-ttu-id="67e46-107">При работе в редакторе разметки в Visual Studio можно заметить, что в IntelliSense есть два дочерних элемента элемента управления UpdatePanel.</span><span class="sxs-lookup"><span data-stu-id="67e46-107">When working in the markup editor in Visual Studio, you may notice (from IntelliSense) that there are two child elements of an UpdatePanel control.</span></span> <span data-ttu-id="67e46-108">Одним из которых является элемент Triggers, указывающий элементы управления на странице (или пользовательский элемент управления, если вы используете его), который запускает частичную визуализацию элемента управления UpdatePanel, в котором находится элемент.</span><span class="sxs-lookup"><span data-stu-id="67e46-108">One of which is the Triggers element, which specifies the controls on the page (or the user control, if you are using one) that will trigger a partial render of the UpdatePanel control in which the element resides.</span></span>

## <a name="introduction"></a><span data-ttu-id="67e46-109">Введение</span><span class="sxs-lookup"><span data-stu-id="67e46-109">Introduction</span></span>

<span data-ttu-id="67e46-110">Технология ASP.NET Майкрософт предоставляет объектно-ориентированную и основанную на событиях модель программирования и объединяет их с преимуществами скомпилированного кода.</span><span class="sxs-lookup"><span data-stu-id="67e46-110">Microsoft's ASP.NET technology brings an object-oriented and event-driven programming model and unites it with the benefits of compiled code.</span></span> <span data-ttu-id="67e46-111">Однако модель обработки на стороне сервера имеет несколько недостатков в технологии, многие из которых могут быть решены новыми функциями, включенными в расширения AJAX для Microsoft ASP.NET 3,5.</span><span class="sxs-lookup"><span data-stu-id="67e46-111">However, its server-side processing model has several drawbacks inherent in the technology, many of which can be addressed by the new features included in the Microsoft ASP.NET 3.5 AJAX Extensions.</span></span> <span data-ttu-id="67e46-112">Эти расширения включают в себя множество новых многофункциональных клиентских функций, включая частичную визуализацию страниц без полного обновления страницы, возможность доступа к веб-службам через клиентский сценарий (включая API профилирования ASP.NET) и обширный API на стороне клиента. предназначен для отражения многих схем управления, наблюдаемых в наборе серверных элементов управления ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="67e46-112">These extensions enable many new rich client features, including partial rendering of pages without requiring a full page refresh, the ability to access Web Services via client script (including the ASP.NET profiling API), and an extensive client-side API designed to mirror many of the control schemes seen in the ASP.NET server-side control set.</span></span>

<span data-ttu-id="67e46-113">В этом техническом документе рассматриваются функции триггеров XML ASP.NET компонента AJAX `UpdatePanel`.</span><span class="sxs-lookup"><span data-stu-id="67e46-113">This whitepaper examines the XML Triggers functionality of the ASP.NET AJAX `UpdatePanel` component.</span></span> <span data-ttu-id="67e46-114">Триггеры XML предоставляют детальный контроль над компонентами, которые могут вызвать частичную визуализацию для отдельных элементов управления UpdatePanel.</span><span class="sxs-lookup"><span data-stu-id="67e46-114">XML Triggers give granular control over the components that can cause partial rendering for specific UpdatePanel controls.</span></span>

<span data-ttu-id="67e46-115">Этот технический документ основан на выпуске бета-версии 2 .NET Framework 3,5 и Visual Studio 2008.</span><span class="sxs-lookup"><span data-stu-id="67e46-115">This whitepaper is based on the Beta 2 release of the .NET Framework 3.5 and Visual Studio 2008.</span></span> <span data-ttu-id="67e46-116">Расширения AJAX ASP.NET, ранее надстройка, предназначенная для ASP.NET 2,0, теперь интегрированы в библиотеку базовых классов .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="67e46-116">The ASP.NET AJAX Extensions, previously an add-on assembly targeted at ASP.NET 2.0, are now integrated into the .NET Framework Base Class Library.</span></span> <span data-ttu-id="67e46-117">В этом техническом документе также предполагается, что вы будете работать с Visual Studio 2008, а не с Visual Web Developer Express и предоставите пошаговые руководства в соответствии с пользовательским интерфейсом Visual Studio (хотя списки кода будут полностью совместимы независимо от среда разработки).</span><span class="sxs-lookup"><span data-stu-id="67e46-117">This whitepaper also assumes that you will be working with Visual Studio 2008, not Visual Web Developer Express, and will provide walkthroughs according to the user interface of Visual Studio (although code listings will be entirely compatible regardless of development environment).</span></span>

## <a name="triggers"></a><span data-ttu-id="67e46-118">*Триггеры*</span><span class="sxs-lookup"><span data-stu-id="67e46-118">*Triggers*</span></span>

<span data-ttu-id="67e46-119">По умолчанию триггеры для заданной UpdatePanel автоматически включают любые дочерние элементы управления, которые вызывают обратную передачу, включая (например) элементы управления TextBox, для которых свойство `AutoPostBack` установлено в **значение true**.</span><span class="sxs-lookup"><span data-stu-id="67e46-119">Triggers for a given UpdatePanel, by default, automatically include any child controls that invoke a postback, including (for example) TextBox controls that have their `AutoPostBack` property set to **true**.</span></span> <span data-ttu-id="67e46-120">Однако триггеры также можно включать декларативно с помощью разметки. Это делается в разделе `<triggers>` объявления элемента управления UpdatePanel.</span><span class="sxs-lookup"><span data-stu-id="67e46-120">However, triggers can also be included declaratively using markup; this is done within the `<triggers>` section of the UpdatePanel control declaration.</span></span> <span data-ttu-id="67e46-121">Хотя доступ к триггерам можно получить через свойство коллекции `Triggers`, рекомендуется зарегистрировать все триггеры частичного отображения во время выполнения (например, если элемент управления недоступен во время разработки) с помощью метода `RegisterAsyncPostBackControl(Control)` объекта ScriptManager на странице в событии `Page_Load`.</span><span class="sxs-lookup"><span data-stu-id="67e46-121">Although triggers can be accessed via the `Triggers` collection property, it is recommended that you register any partial render triggers at run-time (for instance, if a control is not available at design time) by using the `RegisterAsyncPostBackControl(Control)` method of the ScriptManager object for your page, within the `Page_Load` event.</span></span> <span data-ttu-id="67e46-122">Помните, что страницы не имеют состояния, поэтому следует повторно регистрировать эти элементы управления при каждом создании.</span><span class="sxs-lookup"><span data-stu-id="67e46-122">Remember that Pages are stateless, and so you should re-register these controls every time they are created.</span></span>

<span data-ttu-id="67e46-123">Автоматическое включение дочерних триггеров также может быть отключено (чтобы дочерние элементы управления, создающие обратные передачи, не запускают частичные рендерингы), устанавливая для свойства `ChildrenAsTriggers` **значение false**.</span><span class="sxs-lookup"><span data-stu-id="67e46-123">Automatic child trigger inclusion can also be disabled (so that child controls that create postbacks do not automatically trigger partial renders) by setting the `ChildrenAsTriggers` property to **false**.</span></span> <span data-ttu-id="67e46-124">Это обеспечивает наибольшую гибкость при назначении отдельных элементов управления, которые могут вызывать отрисовку страницы, и рекомендуется, чтобы разработчик мог ответить на событие, а не обрабатывать все события, которые могут возникнуть.</span><span class="sxs-lookup"><span data-stu-id="67e46-124">This allows you the greatest flexibility in assigning which specific controls may invoke a page render, and is recommended, so that a developer will opt-in to respond to an event, rather than handling any events that may arise.</span></span>

<span data-ttu-id="67e46-125">Обратите внимание, что когда элементы управления UpdatePanel являются вложенными, если для UpdateMode задано значение **Conditional**, то если дочерняя UpdatePanel запускается, а родитель — нет, будет обновлена только дочерняя UpdatePanel.</span><span class="sxs-lookup"><span data-stu-id="67e46-125">Note that when UpdatePanel controls are nested, when the UpdateMode is set to **Conditional**, if the child UpdatePanel is triggered, but the parent is not, then only the child UpdatePanel will refresh.</span></span> <span data-ttu-id="67e46-126">Однако если обновляется родительская UpdatePanel, то дочерняя UpdatePanel также будет обновлена.</span><span class="sxs-lookup"><span data-stu-id="67e46-126">However, if the parent UpdatePanel is refreshed, then the child UpdatePanel will also be refreshed.</span></span>

## <a name="the-lttriggersgt-element"></a><span data-ttu-id="67e46-127">*Элемент&gt; &lt;Triggers*</span><span class="sxs-lookup"><span data-stu-id="67e46-127">*The &lt;Triggers&gt; Element*</span></span>

<span data-ttu-id="67e46-128">При работе в редакторе разметки в Visual Studio можно заметить, что в IntelliSense есть два дочерних элемента элемента управления `UpdatePanel`.</span><span class="sxs-lookup"><span data-stu-id="67e46-128">When working in the markup editor in Visual Studio, you may notice (from IntelliSense) that there are two child elements of an `UpdatePanel` control.</span></span> <span data-ttu-id="67e46-129">Наиболее часто наблюдаемым элементом является элемент `<ContentTemplate>`, который по сути инкапсулирует содержимое, которое будет храниться на панели обновления (содержимое, для которого включается частичная визуализация).</span><span class="sxs-lookup"><span data-stu-id="67e46-129">The most-frequently seen element is the `<ContentTemplate>` element, which essentially encapsulates the content that will be held by the update panel (the content for which we are enabling partial rendering).</span></span> <span data-ttu-id="67e46-130">Другим элементом является элемент `<Triggers>`, указывающий элементы управления на странице (или пользовательский элемент управления, если вы используете его), который запускает частичную визуализацию элемента управления UpdatePanel, в котором находится &lt;триггеры&gt; элемента.</span><span class="sxs-lookup"><span data-stu-id="67e46-130">The other element is the `<Triggers>` element, which specifies the controls on the page (or the user control, if you are using one) that will trigger a partial render of the UpdatePanel control in which the &lt;Triggers&gt; element resides.</span></span>

<span data-ttu-id="67e46-131">Элемент `<Triggers>` может содержать любое число для каждого из двух дочерних узлов: `<asp:AsyncPostBackTrigger>` и `<asp:PostBackTrigger>`.</span><span class="sxs-lookup"><span data-stu-id="67e46-131">The `<Triggers>` element can contain any number each of two child nodes: `<asp:AsyncPostBackTrigger>` and `<asp:PostBackTrigger>`.</span></span> <span data-ttu-id="67e46-132">Они оба принимают два атрибута, `ControlID` и `EventName`и могут указывать любой элемент управления в текущей единице инкапсуляции (например, если элемент управления UpdatePanel находится в пользовательском веб-элементе управления), не следует пытаться ссылаться на элемент управления на странице, на которой будет располагаться пользовательский элемент управления).</span><span class="sxs-lookup"><span data-stu-id="67e46-132">They both accept two attributes, `ControlID` and `EventName`, and can specify any Control within the current unit of encapsulation (for instance, if your UpdatePanel control resides within a Web User Control, you should not attempt to reference a Control on the Page on which the User Control will reside).</span></span>

<span data-ttu-id="67e46-133">Элемент `<asp:AsyncPostBackTrigger>` особенно полезен в том, что он может ориентироваться на любое событие из элемента управления, который существует как дочерний элемент *любого* элемента управления UpdatePanel в единице инкапсуляции, а не только UpdatePanel, в которой этот триггер является дочерним.</span><span class="sxs-lookup"><span data-stu-id="67e46-133">The `<asp:AsyncPostBackTrigger>` element is particularly useful in that it can target any event from a Control that exists as a child of *any* UpdatePanel control in the unit of encapsulation, not just the UpdatePanel under which this trigger is a child.</span></span> <span data-ttu-id="67e46-134">Таким же может быть любой элемент управления для активации частичного обновления страницы.</span><span class="sxs-lookup"><span data-stu-id="67e46-134">Thus, any control can be made to trigger a partial page update.</span></span>

<span data-ttu-id="67e46-135">Аналогичным образом элемент `<asp:PostBackTrigger>` можно использовать для запуска частичной визуализации страницы, но для одной, которая требует полного кругового пути к серверу.</span><span class="sxs-lookup"><span data-stu-id="67e46-135">Similarly, the `<asp:PostBackTrigger>` element can be used to trigger a partial page render, but one that requires a full round-trip to the server.</span></span> <span data-ttu-id="67e46-136">Этот элемент Trigger также может использоваться для принудительной отрисовки полной страницы, когда элемент управления в противном случае обычно запускает частичную отрисовку страницы (например, если элемент управления `Button` существует в элементе `<ContentTemplate>` элемента управления UpdatePanel).</span><span class="sxs-lookup"><span data-stu-id="67e46-136">This trigger element can also be used to force a full page render when a control would otherwise normally trigger a partial page render (for instance, when a `Button` control exists in the `<ContentTemplate>` element of an UpdatePanel control).</span></span> <span data-ttu-id="67e46-137">Опять же, элемент Постбакктригжер может указывать любой элемент управления, который является дочерним для любого элемента управления UpdatePanel в текущей единице инкапсуляции.</span><span class="sxs-lookup"><span data-stu-id="67e46-137">Again, the PostBackTrigger element can specify any control that is a child of any UpdatePanel control in the current unit of encapsulation.</span></span>

## <a name="lttriggersgt-element-reference"></a><span data-ttu-id="67e46-138">*&lt;триггеры&gt; ссылка на элемент*</span><span class="sxs-lookup"><span data-stu-id="67e46-138">*&lt;Triggers&gt; Element Reference*</span></span>

<span data-ttu-id="67e46-139">*Дочерние элементы разметки:*</span><span class="sxs-lookup"><span data-stu-id="67e46-139">*Markup Descendants:*</span></span>

| <span data-ttu-id="67e46-140">**Тегами**</span><span class="sxs-lookup"><span data-stu-id="67e46-140">**Tag**</span></span> | <span data-ttu-id="67e46-141">**Описание**</span><span class="sxs-lookup"><span data-stu-id="67e46-141">**Description**</span></span> |
| --- | --- |
| <span data-ttu-id="67e46-142">&lt;ASP: Асинкпостбакктригжер&gt;</span><span class="sxs-lookup"><span data-stu-id="67e46-142">&lt;asp:AsyncPostBackTrigger&gt;</span></span> | <span data-ttu-id="67e46-143">Указывает элемент управления и событие, которое приведет к частичному обновлению страницы для UpdatePanel, содержащей ссылку на этот триггер.</span><span class="sxs-lookup"><span data-stu-id="67e46-143">Specifies a control and event that will cause a partial page update for the UpdatePanel that contains this trigger reference.</span></span> |
| <span data-ttu-id="67e46-144">&lt;ASP: Постбакктригжер&gt;</span><span class="sxs-lookup"><span data-stu-id="67e46-144">&lt;asp:PostBackTrigger&gt;</span></span> | <span data-ttu-id="67e46-145">Указывает элемент управления и событие, которое приведет к полному обновлению страницы (полное обновление страницы).</span><span class="sxs-lookup"><span data-stu-id="67e46-145">Specifies a control and event that will cause a full page update (a full page refresh).</span></span> <span data-ttu-id="67e46-146">Этот тег можно использовать для принудительного полного обновления, когда элемент управления в противном случае вызывает частичную визуализацию.</span><span class="sxs-lookup"><span data-stu-id="67e46-146">This tag can be used to force a full refresh when a control would otherwise trigger partial rendering.</span></span> |

## <a name="walkthrough-cross-updatepanel-triggers"></a><span data-ttu-id="67e46-147">*Пошаговое руководство. триггеры между UpdatePanel*</span><span class="sxs-lookup"><span data-stu-id="67e46-147">*Walkthrough: Cross-UpdatePanel Triggers*</span></span>

1. <span data-ttu-id="67e46-148">Создайте новую страницу ASP.NET с набором объектов ScriptManager, чтобы включить частичную визуализацию.</span><span class="sxs-lookup"><span data-stu-id="67e46-148">Create a new ASP.NET page with a ScriptManager object set to enable partial rendering.</span></span> <span data-ttu-id="67e46-149">Добавьте на эту страницу две UpdatePanel — в первую очередь включите элемент управления "метка" (Label1) и два элемента управления "Кнопка" (Button1 и Button2).</span><span class="sxs-lookup"><span data-stu-id="67e46-149">Add two UpdatePanels to this page - in the first, include a Label control ( Label1 ) and two Button controls ( Button1 and Button2 ).</span></span> <span data-ttu-id="67e46-150">При нажатии кнопки Button1 следует нажать кнопку "Обновить" и "Button2", чтобы обновить это или что-нибудь на этих строках.</span><span class="sxs-lookup"><span data-stu-id="67e46-150">Button1 should say Click to Update Both and Button2 should say Click to Update This, or something along those lines.</span></span> <span data-ttu-id="67e46-151">Во второй UpdatePanel включите только элемент управления Label (Ярлык2), но задайте для его свойства ForeColor значение, отличное от значения по умолчанию, чтобы отличать его.</span><span class="sxs-lookup"><span data-stu-id="67e46-151">In the second UpdatePanel, include only a Label control ( Label2 ), but set its ForeColor property to something other than the default to differentiate it.</span></span>
2. <span data-ttu-id="67e46-152">Задайте для свойства UpdateMode обоих тегов UpdatePanel значение **Conditional**.</span><span class="sxs-lookup"><span data-stu-id="67e46-152">Set the UpdateMode property of both UpdatePanel tags to **Conditional**.</span></span>

<span data-ttu-id="67e46-153">**Листинг 1. Разметка для Default. aspx:**</span><span class="sxs-lookup"><span data-stu-id="67e46-153">**Listing 1: Markup for default.aspx:**</span></span> 

[!code-aspx[Main](understanding-asp-net-ajax-updatepanel-triggers/samples/sample1.aspx)]

1. <span data-ttu-id="67e46-154">В обработчике событий Click для Button1 присвойте Label1. Text и Ярлык2. Text значение, зависящее от времени (например, DateTime. Now. Толонгтиместринг ()).</span><span class="sxs-lookup"><span data-stu-id="67e46-154">In the Click event handler for Button1, set Label1.Text and Label2.Text to something time-dependent (such as DateTime.Now.ToLongTimeString()).</span></span> <span data-ttu-id="67e46-155">Для обработчика событий Click для свойства Button2 задайте для параметра значение, зависящее от времени, только Label1. Text.</span><span class="sxs-lookup"><span data-stu-id="67e46-155">For the Click event handler for Button2, set only Label1.Text to the time-dependent value.</span></span>

<span data-ttu-id="67e46-156">**Листинг 2: CodeBehind (обрезанный) в default.aspx.cs:**</span><span class="sxs-lookup"><span data-stu-id="67e46-156">**Listing 2: Codebehind (trimmed) in default.aspx.cs:**</span></span> 

[!code-csharp[Main](understanding-asp-net-ajax-updatepanel-triggers/samples/sample2.cs)]

1. <span data-ttu-id="67e46-157">Нажмите клавишу F5, чтобы создать и запустить проект.</span><span class="sxs-lookup"><span data-stu-id="67e46-157">Press F5 to build and run the project.</span></span> <span data-ttu-id="67e46-158">Обратите внимание, что при нажатии кнопки обновить обе панели будут изменены текстовые метки. Однако при нажатии кнопки Обновить эту панель будут обновлены только метки Label1.</span><span class="sxs-lookup"><span data-stu-id="67e46-158">Note that, when you click Update Both Panels, both labels change text; however, when you click Update This Panel, only Label1 updates.</span></span>

[![](understanding-asp-net-ajax-updatepanel-triggers/_static/image2.png)](understanding-asp-net-ajax-updatepanel-triggers/_static/image1.png)

<span data-ttu-id="67e46-159">([Щелкните, чтобы просмотреть изображение с полным размером](understanding-asp-net-ajax-updatepanel-triggers/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="67e46-159">([Click to view full-size image](understanding-asp-net-ajax-updatepanel-triggers/_static/image3.png))</span></span>

## <a name="under-the-hood"></a><span data-ttu-id="67e46-160">*Внутренняя структура*</span><span class="sxs-lookup"><span data-stu-id="67e46-160">*Under the Hood*</span></span>

<span data-ttu-id="67e46-161">Используя только что созданный вами пример, мы рассмотрим, что делает AJAX ASP.NET и как работают триггеры кросс-Panel UpdatePanel.</span><span class="sxs-lookup"><span data-stu-id="67e46-161">Utilizing the example we just constructed, we can take a look at what ASP.NET AJAX is doing and how our UpdatePanel cross-panel triggers work.</span></span> <span data-ttu-id="67e46-162">Для этого мы будем работать с созданным HTML-кодом страницы, а также с расширением Mozilla Firefox, именуемым FireBug, мы легко проанализировать обратные передачи AJAX.</span><span class="sxs-lookup"><span data-stu-id="67e46-162">To do so, we will work with the generated page source HTML, as well as the Mozilla Firefox extension called FireBug - with it, we can easily examine the AJAX postbacks.</span></span> <span data-ttu-id="67e46-163">Мы также будем использовать средство отражения .NET, Лутз (.</span><span class="sxs-lookup"><span data-stu-id="67e46-163">We will also use the .NET Reflector tool by Lutz Roeder.</span></span> <span data-ttu-id="67e46-164">Оба эти средства свободно доступны в Интернете, и их можно найти с помощью поиска в Интернете.</span><span class="sxs-lookup"><span data-stu-id="67e46-164">Both of these tools are freely available online, and can be found with an internet search.</span></span>

<span data-ttu-id="67e46-165">Анализ исходного кода страницы показывает практически ничего из обычного. элементы управления UpdatePanel подготавливаются к просмотру как `<div>` контейнеры, и мы видим, что ресурсы скрипта включают в себя `<asp:ScriptManager>`.</span><span class="sxs-lookup"><span data-stu-id="67e46-165">An examination of the page source code shows almost nothing out of the ordinary; the UpdatePanel controls are rendered as `<div>` containers, and we can see the script resource includes provided by the `<asp:ScriptManager>`.</span></span> <span data-ttu-id="67e46-166">Также существуют некоторые новые вызовы к PageRequestManager, относящиеся к AJAX, которые являются внутренними для библиотеки клиентских скриптов AJAX.</span><span class="sxs-lookup"><span data-stu-id="67e46-166">There are also some new AJAX-specific calls to the PageRequestManager that are internal to the AJAX client script library.</span></span> <span data-ttu-id="67e46-167">Наконец, мы видим два контейнера UpdatePanel — один с отображаемыми `<input>` кнопками, в которых два элемента управления `<asp:Label>` отображаются как контейнеры `<span>`.</span><span class="sxs-lookup"><span data-stu-id="67e46-167">Finally, we see the two UpdatePanel containers - one with the rendered `<input>` buttons with the two `<asp:Label>` controls rendered as `<span>` containers.</span></span> <span data-ttu-id="67e46-168">(Если вы просматриваете дерево DOM в FireBug, вы заметите, что метки затемнены, чтобы показать, что они не создают видимого содержимого).</span><span class="sxs-lookup"><span data-stu-id="67e46-168">(If you inspect the DOM tree in FireBug, you will notice that the labels are dimmed to indicate that they are not producing visible content).</span></span>

<span data-ttu-id="67e46-169">Нажмите кнопку обновить эту панель и обратите внимание, что верхний элемент UpdatePanel будет обновлен с учетом текущего времени сервера.</span><span class="sxs-lookup"><span data-stu-id="67e46-169">Click the Update This Panel button, and notice the top UpdatePanel will be updated with the current server time.</span></span> <span data-ttu-id="67e46-170">В FireBug выберите вкладку Console (консоль), чтобы можно было проверить запрос.</span><span class="sxs-lookup"><span data-stu-id="67e46-170">In FireBug, choose the Console tab so that you can examine the request.</span></span> <span data-ttu-id="67e46-171">Сначала проверьте параметры запроса POST:</span><span class="sxs-lookup"><span data-stu-id="67e46-171">Examine the POST request parameters first:</span></span>

[![](understanding-asp-net-ajax-updatepanel-triggers/_static/image5.png)](understanding-asp-net-ajax-updatepanel-triggers/_static/image4.png)

<span data-ttu-id="67e46-172">([Щелкните, чтобы просмотреть изображение с полным размером](understanding-asp-net-ajax-updatepanel-triggers/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="67e46-172">([Click to view full-size image](understanding-asp-net-ajax-updatepanel-triggers/_static/image6.png))</span></span>

<span data-ttu-id="67e46-173">Обратите внимание, что UpdatePanel обозначает код AJAX на стороне сервера, точно то, какое дерево управления было запущено с помощью параметра ScriptManager1: `Button1` элемента управления `UpdatePanel1`.</span><span class="sxs-lookup"><span data-stu-id="67e46-173">Note that the UpdatePanel has indicated to the server-side AJAX code precisely which control tree was fired via the ScriptManager1 parameter: `Button1` of the `UpdatePanel1` control.</span></span> <span data-ttu-id="67e46-174">Теперь нажмите кнопку обновить обе панели.</span><span class="sxs-lookup"><span data-stu-id="67e46-174">Now, click on the Update Both Panels button.</span></span> <span data-ttu-id="67e46-175">Затем, изучив ответ, мы видим разделенный каналами набор переменных, заданных в строке. в частности, верхняя UpdatePanel, `UpdatePanel1`, содержит весь HTML-код, отправленный в браузер.</span><span class="sxs-lookup"><span data-stu-id="67e46-175">Then, examining the response, we see a pipe-delimited series of variables set in a string; specifically, we see the top UpdatePanel, `UpdatePanel1`, has the entirety of its HTML sent to the browser.</span></span> <span data-ttu-id="67e46-176">Библиотека клиентских скриптов AJAX заменяет исходное содержимое элемента UpdatePanel на новое содержимое с помощью свойства `.innerHTML`, поэтому сервер отправляет измененное содержимое с сервера в виде HTML.</span><span class="sxs-lookup"><span data-stu-id="67e46-176">The AJAX client script library substitutes the UpdatePanel's original HTML content with the new content via the `.innerHTML` property, and so the server sends the changed content from the server as HTML.</span></span>

<span data-ttu-id="67e46-177">Теперь нажмите кнопку обновить обе панели и изучите результаты с сервера.</span><span class="sxs-lookup"><span data-stu-id="67e46-177">Now, click on the Update Both Panels button and examine the results from the server.</span></span> <span data-ttu-id="67e46-178">Результаты очень похожи. обе UpdatePanel получают новый HTML с сервера.</span><span class="sxs-lookup"><span data-stu-id="67e46-178">The results are very similar - both UpdatePanels receive new HTML from the server.</span></span> <span data-ttu-id="67e46-179">Как и в предыдущем ответном вызове, отправляется дополнительное состояние страницы.</span><span class="sxs-lookup"><span data-stu-id="67e46-179">As with the previous callback, additional page state is sent.</span></span>

<span data-ttu-id="67e46-180">Как можно увидеть, поскольку Специальный код не используется для выполнения обратной передачи AJAX, библиотека клиентских скриптов AJAX может перехватывать обратные вызовы форм без дополнительного кода.</span><span class="sxs-lookup"><span data-stu-id="67e46-180">As we can see, because no special code is utilized to perform an AJAX postback, the AJAX client script library is able to intercept form postbacks without any additional code.</span></span> <span data-ttu-id="67e46-181">Серверные элементы управления автоматически используют JavaScript, поэтому они не автоматически отправляют форму — ASP.NET автоматически внедряет код для проверки и состояния формы, в основном за счет автоматического включения ресурсов скриптов, класс Постбаккоптионс и класс ClientScriptManager.</span><span class="sxs-lookup"><span data-stu-id="67e46-181">Server controls automatically utilize JavaScript so that they do not automatically submit the form - ASP.NET automatically injects code for form validation and state already, primarily achieved by automatic script resource inclusion, the PostBackOptions class, and the ClientScriptManager class.</span></span>

<span data-ttu-id="67e46-182">Например, рассмотрим элемент управления CheckBox; Изучите Дизассемблированный код класса в .NET Reflector.</span><span class="sxs-lookup"><span data-stu-id="67e46-182">For instance, consider a CheckBox control; examine the class disassembly in .NET Reflector.</span></span> <span data-ttu-id="67e46-183">Для этого убедитесь, что ваша сборка System. Web открыта, и перейдите к классу `System.Web.UI.WebControls.CheckBox`, открыв метод `RenderInputTag`.</span><span class="sxs-lookup"><span data-stu-id="67e46-183">To do so, ensure that your System.Web assembly is open, and navigate to the `System.Web.UI.WebControls.CheckBox` class, opening the `RenderInputTag` method.</span></span> <span data-ttu-id="67e46-184">Найдите условие, проверяющее свойство `AutoPostBack`:</span><span class="sxs-lookup"><span data-stu-id="67e46-184">Look for a conditional that checks the `AutoPostBack` property:</span></span>

[![](understanding-asp-net-ajax-updatepanel-triggers/_static/image8.png)](understanding-asp-net-ajax-updatepanel-triggers/_static/image7.png)

<span data-ttu-id="67e46-185">([Щелкните, чтобы просмотреть изображение с полным размером](understanding-asp-net-ajax-updatepanel-triggers/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="67e46-185">([Click to view full-size image](understanding-asp-net-ajax-updatepanel-triggers/_static/image9.png))</span></span>

<span data-ttu-id="67e46-186">Если автоматическая обратная передача включена для элемента управления `CheckBox` (с помощью свойства AutoPostBack true), то результирующий тег `<input>`, таким образом, подготавливается к просмотру с помощью скрипта обработки событий ASP.NET в его атрибуте `onclick`.</span><span class="sxs-lookup"><span data-stu-id="67e46-186">When automatic postback is enabled on a `CheckBox` control (via the AutoPostBack property being true), the resultant `<input>` tag is therefore rendered with an ASP.NET event handling script in its `onclick` attribute.</span></span> <span data-ttu-id="67e46-187">Перехват отправки формы, затем, позволяет ASP.NET AJAX внедряться в страницу неагрессивно, помогая избежать возможных критических изменений, которые могут возникнуть при использовании замены строки, возможно, неточной.</span><span class="sxs-lookup"><span data-stu-id="67e46-187">The interception of the form's submission, then, allows ASP.NET AJAX to be injected into the page nonintrusively, helping to avoid any potential breaking changes that might occur by utilizing a possibly-imprecise string replacement.</span></span> <span data-ttu-id="67e46-188">Кроме того, это позволяет *любому* пользовательскому элементу управления ASP.NET использовать возможности ASP.NET AJAX без дополнительного кода для поддержки его использования в контейнере UpdatePanel.</span><span class="sxs-lookup"><span data-stu-id="67e46-188">Furthermore, this enables *any* custom ASP.NET control to utilize the power of ASP.NET AJAX without any additional code to support its use within an UpdatePanel container.</span></span>

<span data-ttu-id="67e46-189">`<triggers>` функции соответствуют значениям, инициализированным в вызове PageRequestManager для \_Упдатеконтролс (Обратите внимание, что библиотека клиентских сценариев ASP.NET AJAX использует соглашение о том, что методы, события и имена полей, начинающиеся с символа подчеркивания, помечаются как внутренние и не предназначены для использования вне самой библиотеки).</span><span class="sxs-lookup"><span data-stu-id="67e46-189">The `<triggers>` functionality corresponds to the values initialized in the PageRequestManager call to \_updateControls (note that the ASP.NET AJAX client script library utilizes the convention that methods, events, and field names that begin with an underscore are marked as internal, and are not meant for use outside of the library itself).</span></span> <span data-ttu-id="67e46-190">С его помощью можно наблюдать, какие элементы управления должны вызывать обратные передачи AJAX.</span><span class="sxs-lookup"><span data-stu-id="67e46-190">With it, we can observe which controls are intended to cause AJAX postbacks.</span></span>

<span data-ttu-id="67e46-191">Например, давайте добавим на страницу два дополнительных элемента управления, полагая одним элементом управления за пределами UpdatePanel, и покидает одно из них в UpdatePanel.</span><span class="sxs-lookup"><span data-stu-id="67e46-191">For example, let's add two additional controls to the page, leaving one control outside of the UpdatePanels entirely, and leaving one within an UpdatePanel.</span></span> <span data-ttu-id="67e46-192">Мы добавим элемент управления CheckBox в верхней UpdatePanel и разместите DropDownList с несколькими цветами, определенными в списке.</span><span class="sxs-lookup"><span data-stu-id="67e46-192">We will add a CheckBox control within the upper UpdatePanel, and drop a DropDownList with a number of colors defined within the list.</span></span> <span data-ttu-id="67e46-193">Вот новая разметка:</span><span class="sxs-lookup"><span data-stu-id="67e46-193">Here is the new markup:</span></span>

<span data-ttu-id="67e46-194">**Листинг 3. Новая разметка**</span><span class="sxs-lookup"><span data-stu-id="67e46-194">**Listing 3: New Markup**</span></span>

[!code-aspx[Main](understanding-asp-net-ajax-updatepanel-triggers/samples/sample3.aspx)]

<span data-ttu-id="67e46-195">Вот новый код программной части:</span><span class="sxs-lookup"><span data-stu-id="67e46-195">And here is the new code-behind:</span></span>

<span data-ttu-id="67e46-196">**Листинг 4. код поддержки**</span><span class="sxs-lookup"><span data-stu-id="67e46-196">**Listing 4: Codebehind**</span></span>

[!code-csharp[Main](understanding-asp-net-ajax-updatepanel-triggers/samples/sample4.cs)]

<span data-ttu-id="67e46-197">Идея этой страницы заключается в том, что раскрывающийся список выбирает один из трех цветов для отображения второй метки, что флажок определяет, как он является полужирным, и указывает, отображаются ли в метках Дата и время.</span><span class="sxs-lookup"><span data-stu-id="67e46-197">The idea behind this page is that the drop-down list selects one of three colors to show the second label, that the check box determines both whether it is bold, and whether the labels display the date as well as the time.</span></span> <span data-ttu-id="67e46-198">Этот флажок не должен вызывать обновление AJAX, но раскрывающийся список должен быть, даже если он не размещен в UpdatePanel.</span><span class="sxs-lookup"><span data-stu-id="67e46-198">The check box should not cause an AJAX update, but the drop-down list should, even though it is not housed within an UpdatePanel.</span></span>

[![](understanding-asp-net-ajax-updatepanel-triggers/_static/image11.png)](understanding-asp-net-ajax-updatepanel-triggers/_static/image10.png)

<span data-ttu-id="67e46-199">([Щелкните, чтобы просмотреть изображение с полным размером](understanding-asp-net-ajax-updatepanel-triggers/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="67e46-199">([Click to view full-size image](understanding-asp-net-ajax-updatepanel-triggers/_static/image12.png))</span></span>

<span data-ttu-id="67e46-200">Как видно на приведенном выше снимке экрана, кнопка, которая была нажата, является правой кнопкой. обновите эту панель, которая обновила время в верхней части независимо от самого нижнего времени.</span><span class="sxs-lookup"><span data-stu-id="67e46-200">As is apparent in the above screen shot, the most-recent button to be clicked was the right button Update This Panel, which updated the top time independent of the bottom time.</span></span> <span data-ttu-id="67e46-201">Дата также выключается между щелчками, так как дата отображается в нижней метке.</span><span class="sxs-lookup"><span data-stu-id="67e46-201">The date was also switched off between clicks, as the date is visible in the bottom label.</span></span> <span data-ttu-id="67e46-202">Последний интерес — цвет нижней Метки: он был обновлен более поздней, чем текст метки, что показывает, что состояние элемента управления важно, и пользователи предполагают, что он сохраняется через обратную передачу AJAX.</span><span class="sxs-lookup"><span data-stu-id="67e46-202">Finally of interest is the bottom label's color: it was updated more recently than the label's text, which demonstrates that control state is important, and users expect it to be preserved through AJAX postbacks.</span></span> <span data-ttu-id="67e46-203">*Однако*время не обновлялось.</span><span class="sxs-lookup"><span data-stu-id="67e46-203">*However*, the time was not updated.</span></span> <span data-ttu-id="67e46-204">Время было автоматически повторно заполнено с помощью сохраняемости поля \_\_VIEWSTATE на странице, интерпретируемой средой выполнения ASP.NET при повторной отрисовке элемента управления на сервере.</span><span class="sxs-lookup"><span data-stu-id="67e46-204">The time was automatically repopulated through the persistence of the \_\_VIEWSTATE field of the page being interpreted by the ASP.NET runtime when the control was being re-rendered on the server.</span></span> <span data-ttu-id="67e46-205">Серверный код AJAX ASP.NET не распознает, в каких методах элементы управления изменяют состояние. оно просто перезаполняется из состояния представления, а затем запускает соответствующие события.</span><span class="sxs-lookup"><span data-stu-id="67e46-205">The ASP.NET AJAX server code does not recognize in which methods the controls are changing state; it simply repopulates from view state and then runs the events that are appropriate.</span></span>

<span data-ttu-id="67e46-206">Тем не менее, следует обратить внимание на то, что я инициализировал время на странице\_загрузки, время будет увеличено правильно.</span><span class="sxs-lookup"><span data-stu-id="67e46-206">It should be pointed out, however, that had I initialized the time within the Page\_Load event, the time would have been incremented correctly.</span></span> <span data-ttu-id="67e46-207">Следовательно, разработчики должны быть осторожными в том, что соответствующий код выполняется во время соответствующих обработчиков событий, и при этом не рекомендуется использовать загрузку\_страниц, если бы обработчик событий элемента управления был бы соответствующим.</span><span class="sxs-lookup"><span data-stu-id="67e46-207">Consequently, developers should be wary that the appropriate code is being run during the appropriate event handlers, and avoid use of Page\_Load when a control event handler would be appropriate.</span></span>

## <a name="summary"></a><span data-ttu-id="67e46-208">Сводка</span><span class="sxs-lookup"><span data-stu-id="67e46-208">Summary</span></span>

<span data-ttu-id="67e46-209">Элемент управления UpdatePanel с расширениями ASP.NET AJAX является универсальным и может использовать ряд методов для идентификации событий элемента управления, которые должны привести к его обновлению.</span><span class="sxs-lookup"><span data-stu-id="67e46-209">The ASP.NET AJAX Extensions UpdatePanel control is versatile, and can utilize a number of methods for identifying control events that should cause it to be updated.</span></span> <span data-ttu-id="67e46-210">Он поддерживает автоматическое обновление дочерних элементов управления, но также может реагировать на события управления в других местах страницы.</span><span class="sxs-lookup"><span data-stu-id="67e46-210">It supports being updated automatically by its child controls, but can also respond to control events elsewhere on the page.</span></span>

<span data-ttu-id="67e46-211">Чтобы снизить вероятность возникновения нагрузки на сервер, рекомендуется установить свойство `ChildrenAsTriggers` элемента UpdatePanel в значение `false`, а события будут включаться, а не включать по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="67e46-211">To reduce potential for server processing load, it is recommended that the `ChildrenAsTriggers` property of an UpdatePanel be set to `false`, and that events be opted-into rather than included by default.</span></span> <span data-ttu-id="67e46-212">Это также предотвращает возникновение ненужных событий потенциально нежелательных эффектов, включая проверку и изменение полей ввода.</span><span class="sxs-lookup"><span data-stu-id="67e46-212">This also prevents any unneeded events from causing potentially-unwanted effects, including validation, and changes to input fields.</span></span> <span data-ttu-id="67e46-213">Эти типы ошибок могут быть трудно изолировать, так как страница обновляется прозрачно для пользователя, и причина может быть не сразу очевидна.</span><span class="sxs-lookup"><span data-stu-id="67e46-213">These types of bugs may be difficult to isolate, because the page updates transparently to the user, and the cause may therefore not be immediately obvious.</span></span>

<span data-ttu-id="67e46-214">Изучив внутреннюю работу модели перехвата на основе формы AJAX ASP.NET, мы смогли определить, что в ней используется инфраструктура, уже предоставляемая ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="67e46-214">By examining the inner workings of the ASP.NET AJAX form post interception model, we were able to determine that it utilizes the framework already provided by ASP.NET.</span></span> <span data-ttu-id="67e46-215">При этом он сохраняет максимальную совместимость с элементами управления, разработанными с помощью той же платформы, и минимальное количество подлинности для любого дополнительного кода JavaScript, написанного для страницы.</span><span class="sxs-lookup"><span data-stu-id="67e46-215">In doing so, it preserves maximum compatibility with controls designed using the same framework, and intrudes minimally on any additional JavaScript written for the page.</span></span>

## <a name="bio"></a><span data-ttu-id="67e46-216">Биография</span><span class="sxs-lookup"><span data-stu-id="67e46-216">Bio</span></span>

<span data-ttu-id="67e46-217">Вадим павеза является старшим разработчиком приложений .NET по адресу Терралевер ([www.Terralever.com](http://www.terralever.com)), ведущей интерактивной маркетинговой компании в темпе, AZ.</span><span class="sxs-lookup"><span data-stu-id="67e46-217">Rob Paveza is a senior .NET application developer at Terralever ([www.terralever.com](http://www.terralever.com)), a leading interactive marketing firm in Tempe, AZ.</span></span> <span data-ttu-id="67e46-218">Он доступен по адресу [robpaveza@gmail.com](mailto:robpaveza@gmail.com), а его блог находится по адресу [http://geekswithblogs.net/robp/](http://geekswithblogs.net/robp/).</span><span class="sxs-lookup"><span data-stu-id="67e46-218">He can be reached at [robpaveza@gmail.com](mailto:robpaveza@gmail.com), and his blog is located at [http://geekswithblogs.net/robp/](http://geekswithblogs.net/robp/).</span></span>

<span data-ttu-id="67e46-219">Скотт Cate работал с веб-технологиями Майкрософт с 1997 и является президентом myKB.com ([www.myKB.com](http://www.myKB.com)), где он специализируется на написании приложений ASP.NET на базе знаний, посвященных программным решениям.</span><span class="sxs-lookup"><span data-stu-id="67e46-219">Scott Cate has been working with Microsoft Web technologies since 1997 and is the President of myKB.com ([www.myKB.com](http://www.myKB.com)) where he specializes in writing ASP.NET based applications focused on Knowledge Base Software solutions.</span></span> <span data-ttu-id="67e46-220">Скотт может связаться по электронной почте по адресу [scott.cate@myKB.com](mailto:scott.cate@myKB.com) или в блоге по адресу [ScottCate.com](http://ScottCate.com)</span><span class="sxs-lookup"><span data-stu-id="67e46-220">Scott can be contacted via email at [scott.cate@myKB.com](mailto:scott.cate@myKB.com) or his blog at [ScottCate.com](http://ScottCate.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="67e46-221">[Назад](understanding-partial-page-updates-with-asp-net-ajax.md)
> [Вперед](understanding-asp-net-ajax-authentication-and-profile-application-services.md)</span><span class="sxs-lookup"><span data-stu-id="67e46-221">[Previous](understanding-partial-page-updates-with-asp-net-ajax.md)
[Next](understanding-asp-net-ajax-authentication-and-profile-application-services.md)</span></span>
