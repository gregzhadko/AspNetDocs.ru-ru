---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/logging-error-details-with-elmah-cs
title: Записи сведений об ошибках с помощью ELMAH (C#) | Документация Майкрософт
author: rick-anderson
description: Ошибка ведения журнала модулей и обработчиков (ELMAH) предлагает другой подход к ведение журнала ошибок времени выполнения в рабочей среде. ELMAH, является ошибкой бесплатно, открытый код...
ms.author: riande
ms.date: 06/09/2009
ms.assetid: 11f6fe44-64ef-4a38-a3b4-35c7bb992352
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/logging-error-details-with-elmah-cs
msc.type: authoredcontent
ms.openlocfilehash: fedf3261fd1c73107575ea94186c6c895a7fd529
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2019
ms.locfileid: "65127904"
---
# <a name="logging-error-details-with-elmah-c"></a>Запись в журнал сведений об ошибках с помощью ELMAH (C#)

по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Скачать код](http://download.microsoft.com/download/1/0/C/10CC829F-A808-4302-97D3-59989B8F9C01/ASPNET_Hosting_Tutorial_14_CS.zip) или [скачать PDF](http://download.microsoft.com/download/5/C/5/5C57DB8C-5DEA-4B3A-92CA-4405544D313B/aspnet_tutorial14_ELMAH_cs.pdf)

> Ошибка ведения журнала модулей и обработчиков (ELMAH) предлагает другой подход к ведение журнала ошибок времени выполнения в рабочей среде. ELMAH — это библиотека ведения журнала бесплатно, открытый код ошибки, которая включает в себя функции, такие как фильтрация ошибок и возможность просмотра журнала ошибок на страницу веб-канала RSS, или загрузить его в виде файла с разделителями запятыми. В этом учебнике скачаете и настроите ELMAH.

## <a name="introduction"></a>Вступление

[Предыдущем учебном курсе](logging-error-details-with-asp-net-health-monitoring-cs.md) исследуется ASP. Система, предоставляющая готовую библиотека окна записи широкого спектра веб-события наблюдения за работоспособностью NET. Многие разработчики используют для входа и отправить по электронной почте сведения о необработанных исключениях мониторинга работоспособности. Тем не менее существует несколько болевые точки с этой системой. В первую очередь, — отсутствие каких-либо пользовательского интерфейса для просмотра сведений о записи журнала событий. Если вы хотите просмотреть сводку по 10 последней ошибки, или просмотреть сведения об ошибке, которое произошло на прошлой неделе, необходимо либо Вставка через базу данных, просмотр папки "Входящие", ваш адрес электронной почты или создавать веб-страницы, на которой отображаются сведения из `aspnet_WebEvent_Events` таблицы.

Другой болевые точки основано на мониторинг работоспособности сложности. Так как мониторинг работоспособности можно использовать для записи множество различных событий, а так как существуют различные параметры для указания того, как и когда событий, при правильной настройке система наблюдения за работоспособностью может быть сложно. Наконец внесен целый ряд проблем совместимости. Так как наблюдение за работоспособностью сначала была добавлена в .NET Framework версии 2.0, она недоступна для более старых веб-приложений, построенных с помощью ASP.NET версии 1.x. Кроме того `SqlWebEventProvider` класс, который мы использовали в предыдущем учебном курсе для сведений об ошибках журналы базы данных, работает только с базами данных Microsoft SQL Server. Необходимо будет создать класс поставщика настраиваемого журнала возникновения необходимости для ведения журнала ошибок в альтернативное хранилище данных, например XML-файла или базы данных Oracle.

Альтернативой система наблюдения за работоспособностью является ошибка ведения журнала модулей и обработчиков (ELMAH), системы ведения журнала ошибок бесплатно, открытым исходным кодом, созданные [Атиф Азиз](http://www.raboof.com/). Самое заметное различие между двумя системами — ELAMH на возможность отображения списка ошибок и сведения о конкретной ошибки из веб-страницы и как RSS-канала. ELMAH проще в настройке, чем наблюдение за работоспособностью, так как она только регистрирует ошибки. Кроме того ELMAH включает поддержку для ASP.NET 1.x, приложений ASP.NET 2.0 и ASP.NET 3.5 и поставляется с разнообразными источника регистраторов.

В этом учебнике описываются шаги, необходимые в ELMAH вы добавляете в приложение ASP.NET. Давайте начнем!

> [!NOTE]
> Мониторинг системы и ELMAH оба имеют свои собственные наборы преимущества и недостатки. Я советую вам попробовать обеих систем и выбрать один из наиболее масти вашим потребностям.

## <a name="adding-elmah-to-an-aspnet-web-application"></a>Добавление ELMAH веб-приложения ASP.NET

Интеграция ELMAH в новые или существующие приложения ASP.NET — это процесс прост и четок, принимающий менее чем за пять минут. По сути он включает в себя четыре простых шага:

1. Загрузить ELMAH и добавить `Elmah.dll` сборки веб-приложению
2. Зарегистрировать модули HTTP ELMAH и обработчик в `Web.config`,
3. Укажите параметры конфигурации ELMAH, и
4. Создание инфраструктуры источника журнала ошибок, при необходимости.

Давайте подробно рассмотрим каждый из этих четырех шагов, по одному.

### <a name="step-1-downloading-the-elmah-project-files-and-addingelmahdllto-your-web-application"></a>Шаг 1. Загрузка файлов проекта ELMAH и добавление`Elmah.dll`в веб-приложение

ELMAH 1.0 бета-версии 3 (10617 сборки), самой последней версии на момент написания статьи, включен в загружаемый, доступные в этом руководстве. Кроме того, можно найти на [ELMAH веб-сайт](https://code.google.com/p/elmah/) для получения самой последней версии или загрузить исходный код. Извлеките файл ELMAH в папку на рабочем столе и файл сборки ELMAH (`Elmah.dll`).

> [!NOTE]
> `Elmah.dll` Файл находится в загружаемом `Bin` папке, которая содержит вложенные папки для разных версий .NET Framework, а также для сборок выпуска и отладки. Используйте сборки выпуска для версии соответствующие платформы. К примеру, если вы создаете веб-приложения ASP.NET 3.5, скопируйте `Elmah.dll` файла из `Bin\net-3.5\Release` папки.

Далее откройте Visual Studio и добавьте сборку в проект, щелкнув правой кнопкой имя веб-сайта в обозревателе решений и выбрав команду Добавить ссылку в контекстном меню. Откроется диалоговое окно «Добавление ссылки». Перейдите на вкладку "Обзор" и выберите `Elmah.dll` файл. Это действие добавляет `Elmah.dll` файл в веб-приложение `Bin` папки.

> [!NOTE]
> Тип проекта приложений Web (WAP) не содержит `Bin` папку в обозревателе решений. Вместо этого в ней перечислены эти элементы в папке "ссылки".

`Elmah.dll` Сборка содержит классы, используемые системой ELMAH. Эти классы делятся на три категории:

- **HTTP-модули** -модуль HTTP — это класс, который определяет обработчики событий для `HttpApplication` события, такие как `Error` событий. ELMAH включает в себя несколько модулей HTTP, три из них наиболее связан с темой: 

    - `ErrorLogModule` -систему источник журнала необработанных исключений.
    - `ErrorMailModule` -отправляет сведения о необработанного исключения в сообщении электронной почты.
    - `ErrorFilterModule` -применяет фильтры, определенные разработчиком, чтобы определить, какие исключения заносятся и что те, которые учитываются.
- **Обработчики HTTP** -обработчик HTTP является классом, который отвечает за создание разметки для определенного типа запроса. ELMAH содержит обработчики HTTP, которое отрисовывает сведения об ошибке, как веб-страницы, RSS-канал или файл с разделителями запятыми (CSV).
- **Источники журналов ошибок** — по умолчанию ELMAH могут входить ошибки памяти, базе данных Microsoft SQL Server, базы данных Microsoft Access, базы данных Oracle, XML-файл, в базу данных SQLite, или к базе данных Vista DB. Как система наблюдения за работоспособностью архитектура ELMAH был создан с помощью модели поставщика, это означает, что можно создавать и легко интегрировать свои собственные пользовательские источника регистраторы, при необходимости.

### <a name="step-2-registering-elmahs-http-module-and-handler"></a>Шаг 2. Регистрация модуля HTTP и обработчик ELMAH

Хотя `Elmah.dll` файл содержит модули HTTP и обработчик необходимо, чтобы автоматически журнала необработанных исключений, так и для отображения сведения об ошибке на веб-странице, они должны быть явно зарегистрированы в конфигурации веб-приложения. `ErrorLogModule` Модуль HTTP, после их регистрации подписывается на `HttpApplication`в `Error` событий. Каждый раз, когда это событие возникает `ErrorLogModule` записывает сведения о исключения в предусмотренный источник журнала. Узнаете, как для определения источника регистратора в следующем разделе «Настройка ELMAH.» `ErrorLogPageFactory` Фабрика обработчиков HTTP отвечает за создание разметки, при просмотре журнала ошибок веб-страницы.

Особый синтаксис для регистрации модулей и обработчиков HTTP зависит от веб-сервер, который подготавливается сайт. Для ASP.NET Development Server, а также Microsoft IIS версии 6.0 и более ранних версий, HTTP-модули и обработчики регистрируются в `<httpModules>` и `<httpHandlers>` разделы, которые отображаются в `<system.web>` элемент. Если вы используете IIS 7.0, то они должны быть зарегистрированы в `<system.webServer>` элемента `<modules>` и `<handlers>` разделы. К счастью, можно определить HTTP-модули и обработчики в *оба* помещает независимо от того, используется веб-сервера. Этот параметр является максимальной переносимости тот, так как оно обеспечивает ту же конфигурацию для использования в средах разработки и эксплуатации, независимо от того, используется веб-сервера.

Запуск зарегистрировав `ErrorLogModule` модуль HTTP и `ErrorLogPageFactory` обработчика HTTP в `<httpModules>` и `<httpHandlers>` статьи `<system.web>`. Если настройки уже определяет эти два элемента и затем просто включите `<add>` элемент для HTTP-модуль и обработчик ELMAH.

[!code-xml[Main](logging-error-details-with-elmah-cs/samples/sample1.xml)]

Затем зарегистрировать модуль HTTP ELMAH и обработчик в `<system.webServer>` элемент. Как и раньше Если этот элемент отсутствует в конфигурации добавьте его.

[!code-xml[Main](logging-error-details-with-elmah-cs/samples/sample2.xml)]

По умолчанию IIS 7 выдаст ошибку при HTTP-модули и обработчики, регистрируются в `<system.web>` разделе. `validateIntegratedModeConfiguration` Атрибут в `<validation>` элемент указывает, что IIS 7 для отключения таких сообщений об ошибках.

Обратите внимание, что синтаксис для регистрации `ErrorLogPageFactory` обработчика HTTP-данных включает в себя `path` атрибута, который имеет значение `elmah.axd`. Этот атрибут сообщает веб-приложения, если запрос прибывает страницы с именем `elmah.axd` то запрос должен обрабатываться `ErrorLogPageFactory` обработчика HTTP-данных. Мы увидим `ErrorLogPageFactory` обработчика HTTP в действии далее в этом руководстве.

### <a name="step-3-configuring-elmah"></a>Шаг 3. Настройка ELMAH

ELMAH ищет его параметры конфигурации на веб-сайте `Web.config` файл в настраиваемого раздела конфигурации с именем `<elmah>`. Чтобы использовать пользовательский раздел в `Web.config` должен быть сначала определен в `<configSections>` элемент. Откройте `Web.config` файл и добавьте следующую разметку, чтобы `<configSections>`:

[!code-xml[Main](logging-error-details-with-elmah-cs/samples/sample3.xml)]

> [!NOTE]
> Если вы настраиваете ELMAH для приложений ASP.NET 1.x, удалите `requirePermission="false"` из атрибута `<section>` элементов, описанных выше.

Выше синтаксис регистрирует пользовательский `<elmah>` раздел и его подразделы: `<security>`, `<errorLog>`, `<errorMail>`, и `<errorFilter>`.

Затем добавьте `<elmah>` раздел `Web.config`. Этот раздел должен выглядеть на том же уровне, что `<system.web>` элемент. Внутри `<elmah>` добавьте раздел `<security>` и `<errorLog>` разделы следующим образом:

[!code-xml[Main](logging-error-details-with-elmah-cs/samples/sample4.xml)]

`<security>` Раздела `allowRemoteAccess` атрибут указывает, разрешен ли удаленный доступ. Если имеет значение 0, то ошибка журнала веб-страницы можно просматривать только локально. Если этот атрибут имеет значение 1 для удаленных и локальных посетителей включена веб-страницы журнала ошибок. Пока давайте отключить веб-страницы журнала ошибок для удаленных посетителей. Мы будем разрешить удаленный доступ позже, после у нас есть возможность обсуждать вопросы безопасности таким образом.

`<errorLog>` Раздел определяет источник журнала ошибок, какие определяет, где записываются сведения об ошибке; она аналогична `<providers>` статьи система наблюдения за работоспособностью. Приведенный выше синтаксис указывает `SqlErrorLog` класс в качестве источника журнала ошибки, какие журналы ошибок базы данных Microsoft SQL Server, указанной `connectionStringName` значение атрибута.

> [!NOTE]
> ELMAH поставляется с дополнительной ошибке регистраторы, которые могут использоваться для ведения журнала ошибок в XML-файл, базу данных Microsoft Access, базы данных Oracle и другие хранилища данных. См. пример `Web.config` файл, который входит в состав загрузки ELMAH сведения об использовании регистраторов эти альтернативные ошибки.

### <a name="step-4-creating-the-error-log-source-infrastructure"></a>Шаг 4. Создание инфраструктуры источника журнала ошибок

В ELMAH `SqlErrorLog` поставщик регистрирует сведения об ошибке в указанной базе данных Microsoft SQL Server. `SqlErrorLog` Поставщик ожидает, что эта база данных, таблица с именем `ELMAH_Error` и три хранимых процедур: `ELMAH_GetErrorsXml`, `ELMAH_GetErrorXml`, и `ELMAH_LogError`. ELMAH загружаемый файл содержит файл с именем `SQLServer.sql` в `db` папку, содержащую T-SQL для создания этой таблицы и эти хранимые процедуры. Вам потребуется выполнить эти инструкции в базе данных для использования `SqlErrorLog` поставщика.

**Рис. 1** и **2** Показать обозреватель баз данных в Visual Studio после объекты базы данных, необходимые `SqlErrorLog` поставщика были добавлены.

[![](logging-error-details-with-elmah-cs/_static/image2.png)](logging-error-details-with-elmah-cs/_static/image1.png)

**Рис. 1**: `SqlErrorLog` Поставщик регистрирует ошибки `ELMAH_Error` таблицы

[![](logging-error-details-with-elmah-cs/_static/image4.png)](logging-error-details-with-elmah-cs/_static/image3.png)

**Рис. 2**: `SqlErrorLog` Поставщик использует три хранимые процедуры

## <a name="elmah-in-action"></a>ELMAH в действии

На этом этапе мы добавили ELMAH веб-приложения, зарегистрированные `ErrorLogModule` модуль HTTP и `ErrorLogPageFactory` обработчик HTTP, заданными параметрами конфигурации ELMAH в `Web.config`и добавить объекты базы данных необходимые для `SqlErrorLog` Поставщик журнала ошибок. Теперь мы готовы см. в разделе ELMAH в действии! Посетите веб-сайт рецензий на книги и посетите страницу, которая вызывает ошибку времени выполнения, такие как `Genre.aspx?ID=foo`, или несуществующий страницы, такие как `NoSuchPage.aspx`. Отображается при просмотре этих страниц зависит от `<customErrors>` конфигурации и посещается ли локально или удаленно. (Обратитесь к [ *отображения настраиваемой страницы ошибки* руководстве](displaying-a-custom-error-page-cs.md) в памяти в этом разделе.)

ELMAH не влияет на какое содержимое отображается для пользователя при возникновении необработанного исключения; она просто записывает сведения о нем. Этот журнал ошибок доступен на веб-странице `elmah.axd` из корневого каталога веб-сайта, такие как `http://localhost/BookReviews/elmah.axd`. (Этот файл физически не существует в проекте, но при поступлении запроса для `elmah.axd` среда выполнения пересылает его `ErrorLogPageFactory` обработчик HTTP, который создает разметку, отправляемых в браузер.)

> [!NOTE]
> Можно также использовать `elmah.axd` страницы, чтобы дать указание ELMAH для формирования ошибки теста. Посетив `elmah.axd/test` (как в `http://localhost/BookReviews/elmah.axd/test`) вызывает ELMAH исключение типа `Elmah.TestException`, который содержит сообщение об ошибке: " Это исключение теста, которое можно спокойно проигнорировать.»

**Рис. 3** показывает журнал ошибок при посещении `elmah.axd` из среды разработки.

[![](logging-error-details-with-elmah-cs/_static/image6.png)](logging-error-details-with-elmah-cs/_static/image5.png)

**Рис. 3**: `Elmah.axd` Отображает журнал ошибок с веб-страниц  
([Просмотр полноразмерного изображения](logging-error-details-with-elmah-cs/_static/image7.png))

Журнал ошибок и **рис. 3** содержит шесть записей ошибок. Каждая запись включает в себя код состояния HTTP (404 или 500, для этих ошибок), тип, описание, имя пользователя, выполнившего вход на момент возникновения ошибки и Дата и время. Щелкнув ссылку сведения отображает страницу, которая включает в себя же сообщение об ошибке, показанный в ошибки сведения желтый экрана из смертью (см. в разделе **рис. 4**) и значения переменных сервера во время возникновения ошибки (см. в разделе  **Рис. 5**). Можно также просмотреть необработанного XML, в котором сохраняются сведения об ошибке, который содержит дополнительные сведения, например значения в заголовке HTTP POST.

[![](logging-error-details-with-elmah-cs/_static/image9.png)](logging-error-details-with-elmah-cs/_static/image8.png)

**Рис. 4**: Просмотреть сведения об ошибке YSOD  
([Просмотр полноразмерного изображения](logging-error-details-with-elmah-cs/_static/image10.png))

[![](logging-error-details-with-elmah-cs/_static/image12.png)](logging-error-details-with-elmah-cs/_static/image11.png)

**Рис. 5**: Изучите значения коллекции переменных сервера во время ошибки  
([Просмотр полноразмерного изображения](logging-error-details-with-elmah-cs/_static/image13.png))

Влечет за собой развертывания ELMAH на рабочем веб-сайте:

- Копирование `Elmah.dll` файл `Bin` папку в рабочей среде,
- Копирование ELMAH параметров конфигурации для `Web.config` файлом, используемым в рабочей среде, и
- Добавление инфраструктуры источника журнала ошибок в производственной базе данных.

Мы изучили способы для копирования файлов из среды разработки в рабочую среду в предыдущих учебных курсах. Возможно — это самый простой способ получить инфраструктуры источника журнала ошибок в рабочей базе данных для использования SQL Server Management Studio подключитесь к рабочей базе данных, а также выполнять `SqlServer.sql` файл скрипта, который будет создавать необходимые таблицы и хранимые процедуры.

### <a name="viewing-the-error-details-page-on-production"></a>Просмотр на страницу сведений о ошибки в рабочей среде

После развертывания веб-узла в рабочей среде, посетите веб-сайт рабочей среде и создать необработанное исключение. Как и в среде разработки ELMAH не влияет на ошибки страницу, отображаемую при возникновении необработанного исключения; Вместо этого он просто записывает ошибку. Если вы попытаетесь см. на странице журнала ошибок (`elmah.axd`) в рабочей среде, вам будет сталкивается с запрещено страница, показанная на **рис. 6**.

[![](logging-error-details-with-elmah-cs/_static/image15.png)](logging-error-details-with-elmah-cs/_static/image14.png)

**Рис. 6**: По умолчанию удаленный посетители не может просматривать веб-страницы журнала ошибок  
([Просмотр полноразмерного изображения](logging-error-details-with-elmah-cs/_static/image16.png))

Помните, что в настройках ELMAH `<security>` разделе, мы устанавливаем `allowRemoteAccess` равным 0, что запрещает удаленным пользователям просмотр журнала ошибок. Важно запретить анонимным посетителям Просмотр журнала ошибок, так как сведения об ошибке, можно выявить уязвимости системы безопасности или другой конфиденциальной информацией. Если вы решили присвоить этому атрибуту значение 1 и включить удаленный доступ к журналу ошибок, то необходимо заблокировать `elmah.axd` путь, так что только авторизованные посетители доступа к нему. Это можно сделать, добавив `<location>` элемент `Web.config` файла.

Следующая конфигурация разрешает только пользователи в роли администратора для доступа к веб-страницы журнала ошибок:

[!code-xml[Main](logging-error-details-with-elmah-cs/samples/sample5.xml)]

> [!NOTE]
> В добавлены ролью "Администратор" и трех пользователей в системе - Скотт, Цзисунь и Алиса - [ *Настройка веб-сайт, использует службы приложений* руководстве](configuring-a-website-that-uses-application-services-cs.md). Скотт пользователей и Цзисунь являются членами роли администратора. Дополнительные сведения о проверке подлинности и авторизации см. Мой [учебники по безопасности веб-сайт](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).

Теперь можно просмотреть в журнале ошибок для рабочей среды удаленными пользователями; вернуться к **рисунки 3**, **4**, и **5** для снимков экрана журнала ошибок веб-страницы. Тем не менее, если пользователь с правами анонимных или без прав администратора пытается просматривать страницу журнала ошибок они автоматически перенаправляются на страницу входа (`Login.aspx`), как **рис. 7** показано.

[![](logging-error-details-with-elmah-cs/_static/image18.png)](logging-error-details-with-elmah-cs/_static/image17.png)

**Рис. 7**: У пользователей, автоматически перенаправляется на страницу входа  
([Просмотр полноразмерного изображения](logging-error-details-with-elmah-cs/_static/image19.png))

### <a name="programmatically-logging-errors"></a>Программными средствами ведения журнала ошибок

В ELMAH `ErrorLogModule` HTTP-модуль автоматически регистрирует необработанных исключений в указанном журнале источник. Кроме того, может регистрировать ошибку без необходимости выдано необработанное исключение с помощью `ErrorSignal` класса и его `Raise` метод. `Raise` Методу передается `Exception` объект и записывает его в журнал так, будто это исключение были исключение и дошло до среды выполнения ASP.NET без обработки. Разница, то, что запрос продолжает выполнение обычно после того, как `Raise` метод был вызван, то время как порождается необработанное исключение прерывает работу обычного выполнения запроса и заставляет среду выполнения ASP.NET для отображения настроенного страница ошибки.

`ErrorSignal` Класс полезен в ситуациях, где имеется некоторое действие, которое может завершиться ошибкой, но сбой в его работе не являются критическими, выполняемой операции. Например, веб-сайт может содержать форму, которая принимает входные данные пользователя, сохраняет его в базе данных и затем отправляет пользователю сообщение электронной почты о том, что они обработки информации. Что делать, если сведения сохраняются в базу данных, успешно, но возникает ошибка при отправке сообщения электронной почты? Один из вариантов следует вызвать исключение и отправить пользователю страницу ошибки. Тем не менее это может запутать пользователя думать, что данные, введенные не был сохранен. Другой подход будет журнал ошибок, связанных с электронной почты, но не удалось изменить взаимодействие с пользователем каким-либо образом. Именно здесь `ErrorSignal` класс полезен.

[!code-csharp[Main](logging-error-details-with-elmah-cs/samples/sample6.cs)]

## <a name="error-notification-via-email"></a>Уведомление об ошибке по электронной почте

А также ведение журнала ошибок в базе данных ELMAH можно настроить по электронной почте сведения об ошибке для указанного получателя. Эта функциональность обеспечивается `ErrorMailModule` модуль HTTP; таким образом, необходимо зарегистрировать этот модуль HTTP в `Web.config` Чтобы отправить сведения об ошибке по электронной почте.

[!code-xml[Main](logging-error-details-with-elmah-cs/samples/sample7.xml)]

Затем укажите сведения о сообщении ошибки в `<elmah>` элемента `<errorMail>` разделе, указывающее, отправитель и получатель, тема, адрес электронной почты и ли электронное письмо отправляется асинхронно.

[!code-xml[Main](logging-error-details-with-elmah-cs/samples/sample8.xml)]

Параметры выше заданы каждый раз, когда возникнет ошибка времени выполнения ELMAH отправляет сообщение электронной почты для support@example.com с сообщением об ошибке. По электронной почте об ELMAH включает в себя те же сведения, показанный в ошибки сведения о веб-страницы, а именно: сообщение об ошибке, трассировку стека и переменные сервера (вернуться к **рис** и **5**). Адрес электронной почты ошибка включает содержимое исключение сведения желтый экрана из смерти как вложение (`YSOD.html`).

**Рис. 8** показывает электронных сообщений ошибка ELMAH, создаваемых в статье, посвященной `Genre.aspx?ID=foo`. Хотя **рис. 8** показано только ошибки сообщение и трассировка стека, переменные сервера, содержатся в работу в текст сообщения электронной почты.

[![](logging-error-details-with-elmah-cs/_static/image21.png)](logging-error-details-with-elmah-cs/_static/image20.png)

**Рис. 8**: Можно настроить ELMAH отправлять сведения об ошибке по электронной почте  
([Просмотр полноразмерного изображения](logging-error-details-with-elmah-cs/_static/image22.png))

## <a name="only-logging-errors-of-interest"></a>Только запись в журнал ошибок интерес

По умолчанию ELMAH записывает сведения о каждом необработанном исключении, включая 404 и другие ошибки HTTP. Можно указать ELMAH игнорировать эти или другие типы ошибок, с помощью фильтрации ошибок. Выполняет логику фильтрации ELMAH `ErrorFilterModule` модуль HTTP, который необходимо зарегистрировать в `Web.config` для использования логику фильтрации. Правила для фильтрации указаны в `<errorFilter>` разделе.

Следующая разметка предписывает ELMAH регистрирует ошибки 404.

[!code-xml[Main](logging-error-details-with-elmah-cs/samples/sample9.xml)]

> [!NOTE]
> Напоминаем, что для использования фильтрации ошибок необходимо зарегистрировать `ErrorFilterModule` HTTP-модуль.

`<equal>` Элемент внутри `<test>` раздел называется утверждение. Если утверждение имеет значение true, ошибки фильтруется из журнала ELMAH. Доступны другие утверждения, включая: `<greater>`, `<greater-or-equal>`, `<not-equal>`, `<lesser>`, `<lesser-or-equal>`, и т. д. Можно также объединять утверждения, используя `<and>` и `<or>` логических операторов. Более того можно даже включить простое выражение JavaScript как утверждение, или написать собственные утверждения в C# или Visual Basic.

Дополнительные сведения об ошибке ELMAH, возможности фильтрации, см. [Фильтрация ошибок разделе](https://code.google.com/p/elmah/wiki/ErrorFiltering) в [ELMAH вики-сайте](https://code.google.com/p/elmah/w/list).

## <a name="summary"></a>Сводка

ELMAH предоставляет простую, но мощный механизм для ведения журнала ошибок в веб-приложения ASP.NET. Как система наблюдения за работоспособностью корпорации Майкрософт ELMAH могут входить ошибки в базе данных, а затем можно отправить сведения об ошибке для разработчиков по электронной почте. В отличие от система наблюдения за работоспособностью ELMAH включает встроенную поддержку для более широкий набор хранилищ данных журнала ошибок, включая: Microsoft SQL Server, Microsoft Access, Oracle, XML-файлов и несколько других. Кроме того, ELMAH предлагает встроенный механизм для просмотра журнала ошибок и сведения о конкретной ошибке на веб-странице `elmah.axd`. `elmah.axd` Страница также может выводить сведения об ошибке, как RSS-канал или в формате значений с разделителями запятыми (CSV), который можно прочитать с помощью Microsoft Excel. Можно также указать ELMAH чтобы отфильтровать ошибки из журнала, используя декларативный или программный утверждения. И ELMAH может использоваться с приложениями ASP.NET версии 1.x.

Каждый развернутого приложения должны иметь некий механизм для автоматической записи необработанных исключений и отправка уведомления группе разработчиков. Является ли это достигается с помощью наблюдение за работоспособностью и ELMAH — получатель. Другими словами не важно, действительно ли вы использовать наблюдение за работоспособностью и ELMAH; Оценка обеих систем, а затем выберите тот, который лучше всего соответствует вашим потребностям. Принципиально важно то, что какой-либо механизм помещается в место для журнала необработанных исключений в рабочей среде.

Счастливого вам программирования!

### <a name="further-reading"></a>Дополнительные сведения

Дополнительные сведения по темам, обсуждавшимся в этом руководстве см. в следующих ресурсах:

- [ELMAH - Ошибка ведения журнала модулей и обработчиков](http://dotnetslackers.com/articles/aspnet/ErrorLoggingModulesAndHandlers.aspx)
- [Страница проекта ELMAH](https://code.google.com/p/elmah/) (исходный код, примеры, вики-сайт)
- [Подключить ELMAH в веб-приложение для перехвата необработанных исключений](http://screencastaday.com/ScreenCasts/43_Plugging_Elmah_into_Web_Application_to_Catch_Unhandled_Exceptions.aspx) (видео)
- [Страницы журнала ошибок безопасности](https://code.google.com/p/elmah/wiki/SecuringErrorLogPages)
- [Создание подключаемых компонентов ASP.NET с помощью HTTP-модули и обработчики](https://msdn.microsoft.com/library/aa479332.aspx)
- [Учебники по безопасности веб-сайта](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)

> [!div class="step-by-step"]
> [Назад](logging-error-details-with-asp-net-health-monitoring-cs.md)
> [Вперед](precompiling-your-website-cs.md)
