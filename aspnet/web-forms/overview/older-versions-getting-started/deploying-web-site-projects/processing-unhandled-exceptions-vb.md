---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/processing-unhandled-exceptions-vb
title: Обработка необработанных исключений (Visual Basic) | Документация Майкрософт
author: rick-anderson
description: При возникновении ошибки среды выполнения веб-приложения в рабочей среде важно для уведомления разработчик и записать ошибку в журнал, чтобы она может обнаружить в a la...
ms.author: riande
ms.date: 06/09/2009
ms.assetid: 051296f0-9519-4e78-835c-d868da13b0a0
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/processing-unhandled-exceptions-vb
msc.type: authoredcontent
ms.openlocfilehash: 0783d59fe70ebed9f1f074d35a9f2e063720d27a
ms.sourcegitcommit: 289e051cc8a90e8f7127e239fda73047bde4de12
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/25/2019
ms.locfileid: "58424753"
---
<a name="processing-unhandled-exceptions-vb"></a><span data-ttu-id="b35e9-103">Обработка необработанных исключений (VB)</span><span class="sxs-lookup"><span data-stu-id="b35e9-103">Processing Unhandled Exceptions (VB)</span></span>
====================
<span data-ttu-id="b35e9-104">по [Скотт Митчелл](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="b35e9-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="b35e9-105">[Просмотреть или скачать образец кода](https://github.com/aspnet/AspNetDocs/tree/master/aspnet/web-forms/overview/older-versions-getting-started/deploying-web-site-projects/processing-unhandled-exceptions-vb/samples) ([как скачивать](/aspnet/core/tutorials/index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="b35e9-105">[View or download sample code](https://github.com/aspnet/AspNetDocs/tree/master/aspnet/web-forms/overview/older-versions-getting-started/deploying-web-site-projects/processing-unhandled-exceptions-vb/samples) ([how to download](/aspnet/core/tutorials/index#how-to-download-a-sample))</span></span>

> <span data-ttu-id="b35e9-106">При возникновении ошибки среды выполнения веб-приложения в рабочей среде важно для уведомления разработчик и регистрировать в журнале ошибки может быть диагностированы последующий момент времени.</span><span class="sxs-lookup"><span data-stu-id="b35e9-106">When a runtime error occurs on a web application in production it is important to notify a developer and to log the error so that it may be diagnosed at a later point in time.</span></span> <span data-ttu-id="b35e9-107">Этот учебник содержит общие сведения о том, как ASP.NET обрабатывает ошибки времени выполнения и рассматривает позволяют обеспечить выполнение всякий раз, когда необработанное исключение пузырьки до среды выполнения ASP.NET пользовательский код.</span><span class="sxs-lookup"><span data-stu-id="b35e9-107">This tutorial provides an overview of how ASP.NET processes runtime errors and looks at one way to have custom code execute whenever an unhandled exception bubbles up to the ASP.NET runtime.</span></span>


## <a name="introduction"></a><span data-ttu-id="b35e9-108">Вступление</span><span class="sxs-lookup"><span data-stu-id="b35e9-108">Introduction</span></span>

<span data-ttu-id="b35e9-109">При возникновении необработанного исключения в приложении ASP.NET, поднимается среду выполнения ASP.NET, которая вызывает `Error` событий и отображает страницу соответствующее сообщение об ошибке.</span><span class="sxs-lookup"><span data-stu-id="b35e9-109">When an unhandled exception occurs in an ASP.NET application, it bubbles up to the ASP.NET runtime, which raises the `Error` event and displays the appropriate error page.</span></span> <span data-ttu-id="b35e9-110">Существует три типа страниц ошибок: среда выполнения ошибка желтый экрана из смерти (YSOD); сведения об исключении YSOD; и настраиваемые страницы ошибок.</span><span class="sxs-lookup"><span data-stu-id="b35e9-110">There are three different types of error pages: the Runtime Error Yellow Screen of Death (YSOD); the Exception Details YSOD; and custom error pages.</span></span> <span data-ttu-id="b35e9-111">В [предыдущем учебном курсе](displaying-a-custom-error-page-vb.md) мы настраивали приложение для использования на пользовательскую страницу ошибки для удаленных пользователей и YSOD сведения об исключении для пользователей, посещающими локально.</span><span class="sxs-lookup"><span data-stu-id="b35e9-111">In the [preceding tutorial](displaying-a-custom-error-page-vb.md) we configured the application to use a custom error page for remote users and the Exception Details YSOD for users visiting locally.</span></span>

<span data-ttu-id="b35e9-112">С помощью на понятном пользовательскую страницу ошибки, соответствующий вид сайта является предпочтительным по умолчанию YSOD ошибка среды выполнения, но отображение страницы пользовательской ошибки является только частью комплексное решение ошибок.</span><span class="sxs-lookup"><span data-stu-id="b35e9-112">Using a human-friendly custom error page that matches the look and feel of the site is preferred to the default Runtime Error YSOD, but displaying a custom error page is only one part of a comprehensive error handling solution.</span></span> <span data-ttu-id="b35e9-113">При возникновении ошибки в приложении в рабочей среде, важно, что разработчики получает уведомление об ошибке, чтобы они могли новые причину исключения и устранить ее.</span><span class="sxs-lookup"><span data-stu-id="b35e9-113">When an error occurs in an application in production, it is important that the developers are notified of the error so that they can unearth the cause of the exception and address it.</span></span> <span data-ttu-id="b35e9-114">Кроме того сведения об ошибке должны войти, чтобы ошибки можно проверить и диагностируются последующий момент времени.</span><span class="sxs-lookup"><span data-stu-id="b35e9-114">Furthermore, the error's details should be logged so that the error can be examined and diagnosed at a later point in time.</span></span>

<span data-ttu-id="b35e9-115">Этом руководстве показано, как получить доступ к аспекты необработанное исключение, таким образом, они могут регистрироваться и разработчик получает уведомление.</span><span class="sxs-lookup"><span data-stu-id="b35e9-115">This tutorial shows how to access the details of an unhandled exception so that they can be logged and a developer notified.</span></span> <span data-ttu-id="b35e9-116">Два руководства, которые после этого изучите библиотек ведения журнала ошибки, которые после небольшой настройки, автоматически уведомление разработчиков о ошибки времени выполнения и регистрировать их данные.</span><span class="sxs-lookup"><span data-stu-id="b35e9-116">The two tutorials following this one explore error logging libraries that, after a bit of configuration, will automatically notify developers of runtime errors and log their details.</span></span>

> [!NOTE]
> <span data-ttu-id="b35e9-117">Сведения, рассмотренный наиболее полезна в тех случаях, если требуется обработка необработанных исключений некоторым способом уникальный или настроенные.</span><span class="sxs-lookup"><span data-stu-id="b35e9-117">The information examined in this tutorial is most useful if you need to process unhandled exceptions in some unique or customized manner.</span></span> <span data-ttu-id="b35e9-118">В случаях, где требуется занести исключение в журнал и уведомить разработчик библиотек ведения журнала ошибок с является наилучшим вариантом.</span><span class="sxs-lookup"><span data-stu-id="b35e9-118">In cases where you only need to log the exception and notify a developer, using an error logging library is the way to go.</span></span> <span data-ttu-id="b35e9-119">В следующих двух учебниках содержатся общие сведения о двух таких библиотеках.</span><span class="sxs-lookup"><span data-stu-id="b35e9-119">The next two tutorials provide an overview of two such libraries.</span></span>


## <a name="executing-code-when-theerrorevent-is-raised"></a><span data-ttu-id="b35e9-120">Выполнение кода при`Error`события</span><span class="sxs-lookup"><span data-stu-id="b35e9-120">Executing Code When The`Error`Event Is Raised</span></span>

<span data-ttu-id="b35e9-121">События предоставляют объект механизм для сигнализации, что произошло нечто интересное и другим объектом, чтобы выполнить код в ответ.</span><span class="sxs-lookup"><span data-stu-id="b35e9-121">Events provide an object a mechanism for signaling that something interesting has occurred, and for another object to execute code in response.</span></span> <span data-ttu-id="b35e9-122">Как разработчик ASP.NET вы привыкли думать с точки зрения событий.</span><span class="sxs-lookup"><span data-stu-id="b35e9-122">As an ASP.NET developer you are accustomed to thinking in terms of events.</span></span> <span data-ttu-id="b35e9-123">Если вы хотите выполнять определенный код, при выборе определенной кнопки, можно создать обработчик событий для этой кнопки `Click` событий и поместите код существует.</span><span class="sxs-lookup"><span data-stu-id="b35e9-123">If you want to run some code when the visitor clicks a particular Button, you create an event handler for that Button's `Click` event and put your code there.</span></span> <span data-ttu-id="b35e9-124">Учитывая, что среда выполнения ASP.NET вызывает его [ `Error` событий](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx) всякий раз, когда происходит необработанное исключение, следует, что код для записи сведений об ошибках, попадут в обработчике событий.</span><span class="sxs-lookup"><span data-stu-id="b35e9-124">Given that the ASP.NET runtime raises its [`Error` event](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx) whenever an unhandled exception occurs, it follows that the code for logging the error's details would go in an event handler.</span></span> <span data-ttu-id="b35e9-125">Но как создать обработчик событий для `Error` событий?</span><span class="sxs-lookup"><span data-stu-id="b35e9-125">But how do you create an event handler for the `Error` event?</span></span>

<span data-ttu-id="b35e9-126">`Error` Событий является одним из многих событий в [ `HttpApplication` класс](https://msdn.microsoft.com/library/system.web.httpapplication.aspx) вызываются на определенном этапе в конвейере HTTP в течение времени существования запроса.</span><span class="sxs-lookup"><span data-stu-id="b35e9-126">The `Error` event is one of many events in the [`HttpApplication` class](https://msdn.microsoft.com/library/system.web.httpapplication.aspx) that are raised at certain stages in the HTTP pipeline during the lifetime of a request.</span></span> <span data-ttu-id="b35e9-127">Например `HttpApplication` класса [ `BeginRequest` событий](https://msdn.microsoft.com/library/system.web.httpapplication.beginrequest.aspx) вызывается в начале каждого запроса; его [ `AuthenticateRequest` событие](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx) возникает, когда модуль безопасности определил запрашивающей стороне.</span><span class="sxs-lookup"><span data-stu-id="b35e9-127">For example, the `HttpApplication` class's [`BeginRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.beginrequest.aspx) is raised at the start of every request; its [`AuthenticateRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx) is raised when a security module has identified the requestor.</span></span> <span data-ttu-id="b35e9-128">Эти `HttpApplication` события предоставления разработчикам страниц способа исполнения пользовательскую логику в различные моменты времени жизни запроса.</span><span class="sxs-lookup"><span data-stu-id="b35e9-128">These `HttpApplication` events give the page developer a means to execute custom logic at the various points in the lifetime of a request.</span></span>

<span data-ttu-id="b35e9-129">Обработчики событий для `HttpApplication` события можно поместить в специальном файле с именем `Global.asax`.</span><span class="sxs-lookup"><span data-stu-id="b35e9-129">Event handlers for the `HttpApplication` events can be placed in a special file named `Global.asax`.</span></span> <span data-ttu-id="b35e9-130">Для создания этого файла в веб-сайта, Добавление нового элемента в корень веб-сайта с помощью шаблона глобальный класс приложения с именем `Global.asax`.</span><span class="sxs-lookup"><span data-stu-id="b35e9-130">To create this file in your website, add a new item to the root of your website using the Global Application Class template with the name `Global.asax`.</span></span>

[![](processing-unhandled-exceptions-vb/_static/image2.png)](processing-unhandled-exceptions-vb/_static/image1.png)

<span data-ttu-id="b35e9-131">**Рис. 1**: Добавить `Global.asax` в веб-приложение</span><span class="sxs-lookup"><span data-stu-id="b35e9-131">**Figure 1**: Add `Global.asax` To Your Web Application</span></span>  
 <span data-ttu-id="b35e9-132">([Просмотр полноразмерного изображения](processing-unhandled-exceptions-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="b35e9-132">([Click to view full-size image](processing-unhandled-exceptions-vb/_static/image3.png))</span></span>

<span data-ttu-id="b35e9-133">Содержимое и структуру `Global.asax` файл, созданный средой Visual Studio немного отличаются в использовании проекта приложений Web (WAP) или проекта веб-сайта (WSP).</span><span class="sxs-lookup"><span data-stu-id="b35e9-133">The contents and structure of the `Global.asax` file created by Visual Studio differ slightly based on whether you are using a Web Application Project (WAP) or Web Site Project (WSP).</span></span> <span data-ttu-id="b35e9-134">С WAP `Global.asax` реализуется как два отдельных файла - `Global.asax` и `Global.asax.vb`.</span><span class="sxs-lookup"><span data-stu-id="b35e9-134">With a WAP, the `Global.asax` is implemented as two separate files - `Global.asax` and `Global.asax.vb`.</span></span> <span data-ttu-id="b35e9-135">`Global.asax` Ничего не содержит файл, но `@Application` директива, которая ссылается на `.vb` файл; события обработчики интерес определяются в `Global.asax.vb` файл.</span><span class="sxs-lookup"><span data-stu-id="b35e9-135">The `Global.asax` file contains nothing but an `@Application` directive that references the `.vb` file; the event handlers of interest are defined in the `Global.asax.vb` file.</span></span> <span data-ttu-id="b35e9-136">Для пакетов WSP, создается только один файл, `Global.asax`, и обработчики событий определяются в `<script runat="server">` блока.</span><span class="sxs-lookup"><span data-stu-id="b35e9-136">For WSPs, only a single file is created, `Global.asax`, and the event handlers are defined in a `<script runat="server">` block.</span></span>

<span data-ttu-id="b35e9-137">`Global.asax` Файла, созданного в WAP шаблоном глобальный класс приложения Visual Studio включает в себя обработчики событий с именем `Application_BeginRequest`, `Application_AuthenticateRequest`, и `Application_Error`, которые являются обработчики событий для `HttpApplication` события `BeginRequest`, `AuthenticateRequest`, и `Error`, соответственно.</span><span class="sxs-lookup"><span data-stu-id="b35e9-137">The `Global.asax` file created in a WAP by Visual Studio's Global Application Class template includes event handlers named `Application_BeginRequest`, `Application_AuthenticateRequest`, and `Application_Error`, which are event handlers for the `HttpApplication` events `BeginRequest`, `AuthenticateRequest`, and `Error`, respectively.</span></span> <span data-ttu-id="b35e9-138">Также существуют обработчики событий с именем `Application_Start`, `Session_Start`, `Application_End`, и `Session_End`, которые являются обработчики событий, которые возникают при запуске веб-приложения, при запуске нового сеанса при завершении приложения, и при завершении сеанса соответственно.</span><span class="sxs-lookup"><span data-stu-id="b35e9-138">There are also event handlers named `Application_Start`, `Session_Start`, `Application_End`, and `Session_End`, which are event handlers that fire when the web application starts, when a new session starts, when the application ends, and when a session ends, respectively.</span></span> <span data-ttu-id="b35e9-139">`Global.asax` Файл, созданный Visual Studio в WSP-ФАЙЛ содержит только `Application_Error`, `Application_Start`, `Session_Start`, `Application_End`, и `Session_End` обработчики событий.</span><span class="sxs-lookup"><span data-stu-id="b35e9-139">The `Global.asax` file created in a WSP by Visual Studio contains just the `Application_Error`, `Application_Start`, `Session_Start`, `Application_End`, and `Session_End` event handlers.</span></span>

> [!NOTE]
> <span data-ttu-id="b35e9-140">При развертывании приложения ASP.NET необходимо скопировать `Global.asax` файл в рабочую среду.</span><span class="sxs-lookup"><span data-stu-id="b35e9-140">When deploying the ASP.NET application you need to copy the `Global.asax` file to the production environment.</span></span> <span data-ttu-id="b35e9-141">`Global.asax.vb` Файл, который создается в WAP, необходимо скопировать в рабочей среде, так как этот код компилируется в сборку проекта.</span><span class="sxs-lookup"><span data-stu-id="b35e9-141">The `Global.asax.vb` file, which is created in the WAP, does not need to be copied to production because this code is compiled into the project's assembly.</span></span>


<span data-ttu-id="b35e9-142">Обработчики событий, создаваемого шаблоном глобальный класс приложения Visual Studio не являются исчерпывающими.</span><span class="sxs-lookup"><span data-stu-id="b35e9-142">The event handlers created by Visual Studio's Global Application Class template are not exhaustive.</span></span> <span data-ttu-id="b35e9-143">Можно добавить обработчик событий для любого `HttpApplication` событий путем именования в обработчике событий `Application_EventName`.</span><span class="sxs-lookup"><span data-stu-id="b35e9-143">You can add an event handler for any `HttpApplication` event by naming the event handler `Application_EventName`.</span></span> <span data-ttu-id="b35e9-144">Например, можно добавить следующий код, чтобы `Global.asax` файл, чтобы создать обработчик событий для [ `AuthorizeRequest` событий](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx):</span><span class="sxs-lookup"><span data-stu-id="b35e9-144">For example, you could add the following code to the `Global.asax` file to create an event handler for the [`AuthorizeRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx):</span></span>

[!code-vb[Main](processing-unhandled-exceptions-vb/samples/sample1.vb)]

<span data-ttu-id="b35e9-145">Аналогичным образом вы можете удалить все обработчики событий создан с помощью шаблона глобальный класс приложения, которые не требуются.</span><span class="sxs-lookup"><span data-stu-id="b35e9-145">Likewise, you can remove any event handlers created by the Global Application Class template that are not needed.</span></span> <span data-ttu-id="b35e9-146">В этом руководстве потребуется только обработчик событий для `Error` задание, можно удалить другие обработчики событий из `Global.asax` файла.</span><span class="sxs-lookup"><span data-stu-id="b35e9-146">For this tutorial we only require an event handler for the `Error` event; feel free to remove the other event handlers from the `Global.asax` file.</span></span>

> [!NOTE]
> <span data-ttu-id="b35e9-147">*HTTP-модули* другим способом для определения обработчиков событий для `HttpApplication` события.</span><span class="sxs-lookup"><span data-stu-id="b35e9-147">*HTTP Modules* offer another way to define event handlers for `HttpApplication` events.</span></span> <span data-ttu-id="b35e9-148">Модули HTTP, создаются как файл класса, который может быть непосредственно в проект веб-приложения или выделены в отдельную библиотеку классов.</span><span class="sxs-lookup"><span data-stu-id="b35e9-148">HTTP Modules are created as a class file that can be placed directly within the web application project or separated out into a separate class library.</span></span> <span data-ttu-id="b35e9-149">Так как они могут быть разделены в библиотеку классов, модулей HTTP предлагают более гибкую и многократно используемых модель для создания `HttpApplication` обработчики событий.</span><span class="sxs-lookup"><span data-stu-id="b35e9-149">Because they can be separated out into a class library, HTTP Modules offer a more flexible and reusable model for creating `HttpApplication` event handlers.</span></span> <span data-ttu-id="b35e9-150">Тогда как `Global.asax` относится файл веб-приложение, в которых они находятся, можно скомпилировать модули HTTP в сборки, после чего модуль HTTP к веб-сайта добавляется простым, например удаление сборки `Bin` папку и регистрации Модуль в `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="b35e9-150">Whereas the `Global.asax` file is specific to the web application where it resides, HTTP Modules can be compiled into assemblies, at which point adding the HTTP Module to a website is as simple as dropping the assembly in the `Bin` folder and registering the Module in `Web.config`.</span></span> <span data-ttu-id="b35e9-151">Этот учебник не рассмотрим создание и использование модулей HTTP, но библиотеки два ведения журнала ошибок, используемые в следующих двух учебных реализованы как модули HTTP.</span><span class="sxs-lookup"><span data-stu-id="b35e9-151">This tutorial does not look at creating and using HTTP Modules, but the two error logging libraries used in the following two tutorials are implemented as HTTP Modules.</span></span> <span data-ttu-id="b35e9-152">Дополнительные сведения о преимуществах модулей HTTP, см. в разделе [с помощью модулей и обработчиков HTTP для создания подключаемых компонентов ASP.NET](https://msdn.microsoft.com/library/aa479332.aspx).</span><span class="sxs-lookup"><span data-stu-id="b35e9-152">For more background on the benefits of HTTP Modules refer to [Using HTTP Modules and Handlers to Create Pluggable ASP.NET Components](https://msdn.microsoft.com/library/aa479332.aspx).</span></span>


## <a name="retrieving-information-about-the-unhandled-exception"></a><span data-ttu-id="b35e9-153">Получение сведений о необработанном исключении</span><span class="sxs-lookup"><span data-stu-id="b35e9-153">Retrieving Information About the Unhandled Exception</span></span>

<span data-ttu-id="b35e9-154">На этом этапе у нас есть файл Global.asax с `Application_Error` обработчик событий.</span><span class="sxs-lookup"><span data-stu-id="b35e9-154">At this point we have a Global.asax file with an `Application_Error` event handler.</span></span> <span data-ttu-id="b35e9-155">При выполнении этого обработчика событий, нам нужно уведомлять разработчика ошибки и журнал сведения о нем.</span><span class="sxs-lookup"><span data-stu-id="b35e9-155">When this event handler executes we need to notify a developer of the error and log its details.</span></span> <span data-ttu-id="b35e9-156">Для выполнения этих задач необходимо сначала определить подробности исключения, которое было вызвано.</span><span class="sxs-lookup"><span data-stu-id="b35e9-156">To accomplish these tasks we first need to determine the details of the exception that was raised.</span></span> <span data-ttu-id="b35e9-157">Используйте объект сервера [ `GetLastError` метод](https://msdn.microsoft.com/library/system.web.httpserverutility.getlasterror.aspx) для получения сведений об необработанное исключение, вызвавшее `Error` событие.</span><span class="sxs-lookup"><span data-stu-id="b35e9-157">Use the Server object's [`GetLastError` method](https://msdn.microsoft.com/library/system.web.httpserverutility.getlasterror.aspx) to retrieve details of the unhandled exception that caused the `Error` event to fire.</span></span>

[!code-vb[Main](processing-unhandled-exceptions-vb/samples/sample2.vb)]

<span data-ttu-id="b35e9-158">`GetLastError` Метод возвращает объект типа `Exception`, который является базовым типом для всех исключений в .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="b35e9-158">The `GetLastError` method returns an object of type `Exception`, which is the base type for all exceptions in the .NET Framework.</span></span> <span data-ttu-id="b35e9-159">Тем не менее, в приведенном выше коде я приведение объекта исключения, возвращаемые `GetLastError` в `HttpException` объекта.</span><span class="sxs-lookup"><span data-stu-id="b35e9-159">However, in the code above I am casting the Exception object returned by `GetLastError` into an `HttpException` object.</span></span> <span data-ttu-id="b35e9-160">Если `Error` событие, так как возникло исключение во время обработки ресурса ASP.NET то исключение, выданное переносится внутри `HttpException`.</span><span class="sxs-lookup"><span data-stu-id="b35e9-160">If the `Error` event is being fired because an exception was thrown during the processing of an ASP.NET resource then the exception that was thrown is wrapped within an `HttpException`.</span></span> <span data-ttu-id="b35e9-161">Чтобы получить фактическое исключение, ставшее причиной использования событий ошибки `InnerException` свойство.</span><span class="sxs-lookup"><span data-stu-id="b35e9-161">To get the actual exception that precipitated the Error event use the `InnerException` property.</span></span> <span data-ttu-id="b35e9-162">Если `Error` события из-за исключения на основе HTTP, например запрос для страницы не существует, `HttpException` возникает исключение, но не предоставляет внутреннее исключение.</span><span class="sxs-lookup"><span data-stu-id="b35e9-162">If the `Error` event was raised because of an HTTP-based exception, such as a request for a non-existent page, an `HttpException` is thrown, but it does not have an inner exception.</span></span>

<span data-ttu-id="b35e9-163">В следующем коде используется `GetLastErrormessage` для получения сведений об исключении, вызвавшей `Error` событий, хранение `HttpException` в переменной с именем `lastErrorWrapper`.</span><span class="sxs-lookup"><span data-stu-id="b35e9-163">The following code uses the `GetLastErrormessage` to retrieve information about the exception that triggered the `Error` event, storing the `HttpException` in a variable named `lastErrorWrapper`.</span></span> <span data-ttu-id="b35e9-164">Она сохраняет тип, сообщение и трассировка стека исходного исключения в три строковые переменные, проверять `lastErrorWrapper` — это фактическое исключение, вызвавшее `Error` событий (в случае исключения на основе HTTP), или это просто Программа-оболочка для исключения, выданное при обработке запроса.</span><span class="sxs-lookup"><span data-stu-id="b35e9-164">It then stores the type, message, and stack trace of the originating exception in three string variables, checking to see if the `lastErrorWrapper` is the actual exception that triggered the `Error` event (in the case of HTTP-based exceptions) or if it's merely a wrapper for an exception that was thrown while processing the request.</span></span>

[!code-vb[Main](processing-unhandled-exceptions-vb/samples/sample3.vb)]

<span data-ttu-id="b35e9-165">На этом этапе у вас есть все сведения, необходимые для написания кода, которая будет записывать сведения об исключении в таблицу базы данных.</span><span class="sxs-lookup"><span data-stu-id="b35e9-165">At this point you have all the information you need to write code that will log the exception's details to a database table.</span></span> <span data-ttu-id="b35e9-166">Можно создать таблицу базы данных со столбцами для каждого из сведения об ошибке таким образом, интерес - тип, сообщение, трассировка стека и т. д. — а также другие важные сведения, такие как URL-адрес запрошенной страницы и имя текущего пользователя.</span><span class="sxs-lookup"><span data-stu-id="b35e9-166">You could create a database table with columns for each of the error details of interest - the type, the message, the stack trace, and so on - along with other useful pieces of information, such as the URL of the requested page and the name of the currently logged on user.</span></span> <span data-ttu-id="b35e9-167">В `Application_Error` обработчика событий необходимо затем соединиться с базой данных и вставить запись в таблицу.</span><span class="sxs-lookup"><span data-stu-id="b35e9-167">In the `Application_Error` event handler you would then connect to the database and insert a record into the table.</span></span> <span data-ttu-id="b35e9-168">Аналогичным образом можно добавить код для создания предупреждения, разработчик ошибки по электронной почте.</span><span class="sxs-lookup"><span data-stu-id="b35e9-168">Likewise, you could add code to alert a developer of the error via email.</span></span>

<span data-ttu-id="b35e9-169">Ошибка библиотеки ведения журналов, проверены в следующих двух учебных курсах обеспечения возможности по умолчанию, поэтому нет необходимости это ведение журнала ошибок и уведомления самостоятельно создавать.</span><span class="sxs-lookup"><span data-stu-id="b35e9-169">The error logging libraries examined in the next two tutorials provide such functionality out of the box, so there's no need to build this error logging and notification yourself.</span></span> <span data-ttu-id="b35e9-170">Тем не менее чтобы проиллюстрировать, `Error` вызывается событие и что `Application_Error` обработчик событий может использоваться в журнал сведения об ошибке и уведомлять разработчика, давайте добавим код, который уведомляет разработчика при возникновении ошибки.</span><span class="sxs-lookup"><span data-stu-id="b35e9-170">However, to illustrate that the `Error` event is being raised and that the `Application_Error` event handler can be used to log error details and notify a developer, let's add code that notifies a developer when an error occurs.</span></span>

## <a name="notifying-a-developer-when-an-unhandled-exception-occurs"></a><span data-ttu-id="b35e9-171">Уведомления разработчик, при возникновении необработанного исключения</span><span class="sxs-lookup"><span data-stu-id="b35e9-171">Notifying a Developer When an Unhandled Exception Occurs</span></span>

<span data-ttu-id="b35e9-172">При возникновении необработанного исключения в рабочей среде важно для предупреждения разработчиков, чтобы они могут оценить ошибки и определить, какие действия необходимо выполнить.</span><span class="sxs-lookup"><span data-stu-id="b35e9-172">When an unhandled exception occurs in the production environment it is important to alert the development team so that they can assess the error and determine what actions need to be taken.</span></span> <span data-ttu-id="b35e9-173">К примеру при возникновении ошибки в подключении к базе данных, вам потребуется double Проверьте строки подключения и, возможно, откройте запрос в службу поддержки с веб-хостинга компанию.</span><span class="sxs-lookup"><span data-stu-id="b35e9-173">For example, if there is an error in connecting to the database then you'll need to double check your connection string and, perhaps, open a support ticket with your web hosting company.</span></span> <span data-ttu-id="b35e9-174">Если исключение произошло из-за ошибки программирования, дополнительный код или логику проверки может потребоваться добавить избежать таких ошибок в будущем.</span><span class="sxs-lookup"><span data-stu-id="b35e9-174">If the exception occurred because of a programming error, additional code or validation logic may need to be added to prevent such errors in the future.</span></span>

<span data-ttu-id="b35e9-175">Классы .NET Framework в [ `System.Net.Mail` пространства имен](https://msdn.microsoft.com/library/system.net.mail.aspx) позволяют легко отправить сообщение электронной почты.</span><span class="sxs-lookup"><span data-stu-id="b35e9-175">The .NET Framework classes in the [`System.Net.Mail` namespace](https://msdn.microsoft.com/library/system.net.mail.aspx) make it easy to send an email.</span></span> <span data-ttu-id="b35e9-176">[ `MailMessage` Класс](https://msdn.microsoft.com/library/system.net.mail.mailmessage.aspx) представляет сообщение электронной почты и имеет свойства, такие как `To`, `From`, `Subject`, `Body`, и `Attachments`.</span><span class="sxs-lookup"><span data-stu-id="b35e9-176">The [`MailMessage` class](https://msdn.microsoft.com/library/system.net.mail.mailmessage.aspx) represents an email message and has properties like `To`, `From`, `Subject`, `Body`, and `Attachments`.</span></span> <span data-ttu-id="b35e9-177">`SmtpClass` Используется для отправки `MailMessage` с помощью указанного сервера SMTP; параметры SMTP-сервера могут быть заданы программным или декларативным способом в [ `<system.net>` элемент](https://msdn.microsoft.com/library/6484zdc1.aspx) в `Web.config file`.</span><span class="sxs-lookup"><span data-stu-id="b35e9-177">The `SmtpClass` is used to send a `MailMessage` object using a specified SMTP server; the SMTP server settings can be specified programmatically or declaratively in the [`<system.net>` element](https://msdn.microsoft.com/library/6484zdc1.aspx) in the `Web.config file`.</span></span> <span data-ttu-id="b35e9-178">Дополнительные сведения об отправке по электронной почте сообщений в приложении ASP.NET ознакомьтесь с моей статье [отправки электронной почты в ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx)и [System.Net.Mail часто задаваемые вопросы о](http://systemnetmail.com/).</span><span class="sxs-lookup"><span data-stu-id="b35e9-178">For more information on sending email messages in an ASP.NET application check out my article, [Sending Email in ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx), and the [System.Net.Mail FAQ](http://systemnetmail.com/).</span></span>

> [!NOTE]
> <span data-ttu-id="b35e9-179">`<system.net>` Элемент содержит параметры SMTP-сервера, используемые `SmtpClient` класса при отправке сообщения электронной почты.</span><span class="sxs-lookup"><span data-stu-id="b35e9-179">The `<system.net>` element contains the SMTP server settings used by the `SmtpClient` class when sending an email.</span></span> <span data-ttu-id="b35e9-180">Веб-хостинга компанию, скорее всего, имеет SMTP-сервер, который можно использовать для отправки электронной почты из приложения.</span><span class="sxs-lookup"><span data-stu-id="b35e9-180">Your web hosting company likely has an SMTP server that you can use to send email from your application.</span></span> <span data-ttu-id="b35e9-181">Сведения о параметры SMTP-сервера, который следует использовать в веб-приложении см в разделе поддержки работы веб-узла.</span><span class="sxs-lookup"><span data-stu-id="b35e9-181">Consult your web host's support section for information on the SMTP server settings you should use in your web application.</span></span>


<span data-ttu-id="b35e9-182">Добавьте следующий код, чтобы `Application_Error` обработчик событий для отправки сообщения электронной почты разработчика, при возникновении ошибки:</span><span class="sxs-lookup"><span data-stu-id="b35e9-182">Add the following code to the `Application_Error` event handler to send a developer an email when an error occurs:</span></span>

[!code-vb[Main](processing-unhandled-exceptions-vb/samples/sample4.vb)]

<span data-ttu-id="b35e9-183">Хотя приведенный выше код является довольно длинный, основная часть его создается HTML, отображаемый в сообщении электронной почты, отправленных для разработчика.</span><span class="sxs-lookup"><span data-stu-id="b35e9-183">While the above code is quite lengthy, the bulk of it creates the HTML that appears in the email sent to the developer.</span></span> <span data-ttu-id="b35e9-184">Запускает код, ссылаясь на `HttpException` возвращаемые `GetLastError` метод (`lastErrorWrapper`).</span><span class="sxs-lookup"><span data-stu-id="b35e9-184">The code starts by referencing the `HttpException` returned by the `GetLastError` method (`lastErrorWrapper`).</span></span> <span data-ttu-id="b35e9-185">Фактическое исключение, возникшее в запросе получается через `lastErrorWrapper.InnerException` и присваивается переменной `lastError`.</span><span class="sxs-lookup"><span data-stu-id="b35e9-185">The actual exception that was raised by the request is retrieved via `lastErrorWrapper.InnerException` and is assigned to the variable `lastError`.</span></span> <span data-ttu-id="b35e9-186">Тип, сообщение и стек трассировки информация извлекается из `lastError` и хранятся в трех строковых переменных.</span><span class="sxs-lookup"><span data-stu-id="b35e9-186">The type, message, and stack trace information is retrieved from `lastError` and stored in three string variables.</span></span>

<span data-ttu-id="b35e9-187">Далее, `MailMessage` объект с именем `mm` создается.</span><span class="sxs-lookup"><span data-stu-id="b35e9-187">Next, a `MailMessage` object named `mm` is created.</span></span> <span data-ttu-id="b35e9-188">Текст сообщения электронной почты в формате HTML и отображает URL-адрес запрошенной страницы, имя текущего пользователя и сведения об исключении (тип, сообщение и трассировка стека).</span><span class="sxs-lookup"><span data-stu-id="b35e9-188">The email body is HTML formatted and displays the URL of the requested page, the name of the currently logged on user, and information about the exception (the type, message, and stack trace).</span></span> <span data-ttu-id="b35e9-189">Одно из замечательных особенностей `HttpException` класс является то, что можно создать HTML-код, используемый для создания исключения сведения желтый экрана из смерти (YSOD) путем вызова [GetHtmlErrorMessage метод](https://msdn.microsoft.com/library/system.web.httpexception.gethtmlerrormessage.aspx).</span><span class="sxs-lookup"><span data-stu-id="b35e9-189">One of the cool things about the `HttpException` class is that you can generate the HTML used to create the Exception Details Yellow Screen of Death (YSOD) by calling the [GetHtmlErrorMessage method](https://msdn.microsoft.com/library/system.web.httpexception.gethtmlerrormessage.aspx).</span></span> <span data-ttu-id="b35e9-190">Этот метод используется здесь для получения разметки YSOD сведения об исключении и его добавления в виде вложения сообщения электронной почты.</span><span class="sxs-lookup"><span data-stu-id="b35e9-190">This method is used here to retrieve the Exception Details YSOD markup and add it to the email as an attachment.</span></span> <span data-ttu-id="b35e9-191">Будьте осторожны: Если на исключение, которое вызвало `Error` событие произошло исключение на основе HTTP (например, запрос страницы не существуют) то `GetHtmlErrorMessage` метод возвратит `null`.</span><span class="sxs-lookup"><span data-stu-id="b35e9-191">One word of caution: if the exception that triggered the `Error` event was an HTTP-based exception (such as a request for a non-existent page) then the `GetHtmlErrorMessage` method will return `null`.</span></span>

<span data-ttu-id="b35e9-192">Последним шагом является отправка `MailMessage`.</span><span class="sxs-lookup"><span data-stu-id="b35e9-192">The final step is to send the `MailMessage`.</span></span> <span data-ttu-id="b35e9-193">Это делается путем создания нового `SmtpClient` метод и вызвать его `Send` метод.</span><span class="sxs-lookup"><span data-stu-id="b35e9-193">This is done by creating a new `SmtpClient` method and calling its `Send` method.</span></span>

> [!NOTE]
> <span data-ttu-id="b35e9-194">Для использования этого кода в веб-приложения нужно будет изменить значения в `ToAddress` и `FromAddress` константы из support@example.com на любой адрес электронной почты должны отправляться на адрес уведомления по электронной почте об и получаются из.</span><span class="sxs-lookup"><span data-stu-id="b35e9-194">Before using this code in your web application you'll want to change the values in the `ToAddress` and `FromAddress` constants from support@example.com to whatever email address the error notification email should be sent to and originate from.</span></span> <span data-ttu-id="b35e9-195">Также необходимо указать параметры SMTP-сервера в `<system.net>` статьи `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="b35e9-195">You'll also need to specify SMTP server settings in the `<system.net>` section in `Web.config`.</span></span> <span data-ttu-id="b35e9-196">См. в поставщике веб-размещения, чтобы определить параметры SMTP-сервера для использования.</span><span class="sxs-lookup"><span data-stu-id="b35e9-196">Consult your web host provider to determine the SMTP server settings to use.</span></span>


<span data-ttu-id="b35e9-197">В таком коде каждый раз, когда возникает ошибка разработчик отправляется сообщение электронной почты, содержатся сведения о ней и YSOD.</span><span class="sxs-lookup"><span data-stu-id="b35e9-197">With this code in place anytime there's an error the developer is sent an email message that summarizes the error and includes the YSOD.</span></span> <span data-ttu-id="b35e9-198">В предыдущем учебном курсе мы продемонстрировали ошибка времени выполнения, посетив Genre.aspx и передача недействительного `ID` значение через строку запроса, например `Genre.aspx?ID=foo`.</span><span class="sxs-lookup"><span data-stu-id="b35e9-198">In the preceding tutorial we demonstrated a runtime error by visiting Genre.aspx and passing in an invalid `ID` value through the querystring, like `Genre.aspx?ID=foo`.</span></span> <span data-ttu-id="b35e9-199">Посетив страницу с `Global.asax` файла на месте создает пользователям те же возможности, как в предыдущем учебном курсе — в среде разработки вы перейдете к см. в разделе исключения сведения желтый экрана из смертью, хотя в рабочей среде вам потребуется см. в разделе пользовательскую страницу ошибки.</span><span class="sxs-lookup"><span data-stu-id="b35e9-199">Visiting the page with the `Global.asax` file in place produces the same user experience as in the preceding tutorial - in the development environment you'll continue to see the Exception Details Yellow Screen of Death, while in the production environment you'll see the custom error page.</span></span> <span data-ttu-id="b35e9-200">Помимо этого поведения существующих разработчик отправляется сообщение электронной почты.</span><span class="sxs-lookup"><span data-stu-id="b35e9-200">In addition to this existing behavior, the developer is sent an email.</span></span>

<span data-ttu-id="b35e9-201">**Рис. 2** показаны сообщения, полученные при посещении `Genre.aspx?ID=foo`.</span><span class="sxs-lookup"><span data-stu-id="b35e9-201">**Figure 2** shows the email received when visiting `Genre.aspx?ID=foo`.</span></span> <span data-ttu-id="b35e9-202">Текст сообщения электронной почты представлены сведения об исключении, хотя `YSOD.htm` вложения отображается содержимое, которое отображается в YSOD подробности исключения (см. в разделе **рис. 3**).</span><span class="sxs-lookup"><span data-stu-id="b35e9-202">The email body summarizes the exception information, while the `YSOD.htm` attachment displays the content that is shown in the Exception Details YSOD (see **Figure 3**).</span></span>

[![](processing-unhandled-exceptions-vb/_static/image5.png)](processing-unhandled-exceptions-vb/_static/image4.png)

<span data-ttu-id="b35e9-203">**Рис. 2**: Разработчик отправляется уведомление по электронной почте при каждом обнаружении необработанного исключения</span><span class="sxs-lookup"><span data-stu-id="b35e9-203">**Figure 2**: The Developer Is Sent An Email Notification Whenever There's An Unhandled Exception</span></span>  
 <span data-ttu-id="b35e9-204">([Просмотр полноразмерного изображения](processing-unhandled-exceptions-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="b35e9-204">([Click to view full-size image](processing-unhandled-exceptions-vb/_static/image6.png))</span></span>

[![](processing-unhandled-exceptions-vb/_static/image8.png)](processing-unhandled-exceptions-vb/_static/image7.png)

<span data-ttu-id="b35e9-205">**Рис. 3**: Уведомление по электронной почте включает в себя сведения об исключении YSOD как вложение</span><span class="sxs-lookup"><span data-stu-id="b35e9-205">**Figure 3**: The Email Notification Includes the Exception Details YSOD As An Attachment</span></span>  
 <span data-ttu-id="b35e9-206">([Просмотр полноразмерного изображения](processing-unhandled-exceptions-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="b35e9-206">([Click to view full-size image](processing-unhandled-exceptions-vb/_static/image9.png))</span></span>

## <a name="what-about-using-the-custom-error-page"></a><span data-ttu-id="b35e9-207">Как насчет используете пользовательскую страницу ошибки?</span><span class="sxs-lookup"><span data-stu-id="b35e9-207">What About Using the Custom Error Page?</span></span>

<span data-ttu-id="b35e9-208">Этом руководстве было показано, как использовать `Global.asax` и `Application_Error` обработчик событий для выполнения кода при возникновении необработанного исключения.</span><span class="sxs-lookup"><span data-stu-id="b35e9-208">This tutorial showed how to use `Global.asax` and the `Application_Error` event handler to execute code when an unhandled exception occurs.</span></span> <span data-ttu-id="b35e9-209">В частности мы использовали этот обработчик событий для уведомления разработчиков ошибки; Теперь можно расширить ее также могут регистрировать сведения об ошибке в базе данных.</span><span class="sxs-lookup"><span data-stu-id="b35e9-209">Specifically, we used this event handler to notify a developer of an error; we could extend it to also log the error details in a database.</span></span> <span data-ttu-id="b35e9-210">Наличие `Application_Error` обработчик событий не влияет на взаимодействие с пользователем.</span><span class="sxs-lookup"><span data-stu-id="b35e9-210">The presence of the `Application_Error` event handler does not affect the end user's experience.</span></span> <span data-ttu-id="b35e9-211">Они по-прежнему см. в разделе страницы настроенные ошибки, будь то YSOD сведения об ошибке, YSOD ошибка среды выполнения или пользовательскую страницу ошибки.</span><span class="sxs-lookup"><span data-stu-id="b35e9-211">They still see the configured error page, be it the Error Details YSOD, the Runtime Error YSOD, or the custom error page.</span></span>

<span data-ttu-id="b35e9-212">Это бы логичным проверить ли `Global.asax` файл и `Application_Error` событий требуется, при использовании на пользовательскую страницу ошибки.</span><span class="sxs-lookup"><span data-stu-id="b35e9-212">It's natural to wonder whether the `Global.asax` file and `Application_Error` event is necessary when using a custom error page.</span></span> <span data-ttu-id="b35e9-213">При возникновении ошибки, то пользователю будет показано пользовательскую страницу ошибки так почему не удается мы поместите код уведомлять разработчика и журнала сведения об ошибке в класс кода программной части страницы настраиваемых ошибок?</span><span class="sxs-lookup"><span data-stu-id="b35e9-213">When an error occurs the user is shown the custom error page so why can't we put the code to notify the developer and log the error details into the code-behind class of the custom error page?</span></span> <span data-ttu-id="b35e9-214">Хотя безусловно можно добавить код к вспомогательному классу страницы настраиваемых ошибок у вас нет доступа к сведениям о исключение, вызвавшее `Error` событие при помощи технологии мы изучили в предыдущем учебном курсе.</span><span class="sxs-lookup"><span data-stu-id="b35e9-214">While you can certainly add code to the custom error page's code-behind class you do not have access to the details of the exception that triggered the `Error` event when using the technique we explored in the preceding tutorial.</span></span> <span data-ttu-id="b35e9-215">Вызов `GetLastError` метод из пользовательскую страницу ошибки возвращает `Nothing`.</span><span class="sxs-lookup"><span data-stu-id="b35e9-215">Calling the `GetLastError` method from the custom error page returns `Nothing`.</span></span>

<span data-ttu-id="b35e9-216">Причина такого поведения — так, как пользовательскую страницу ошибки достигается с помощью перенаправления.</span><span class="sxs-lookup"><span data-stu-id="b35e9-216">The reason for this behavior is because the custom error page is reached via a redirect.</span></span> <span data-ttu-id="b35e9-217">Когда необработанное исключение достигает среда выполнения ASP.NET механизм ASP.NET вызывает его `Error` событий (которая выполняет `Application_Error` обработчик событий) и затем *перенаправляет* пользователя на пользовательскую страницу ошибки, выполнив `Response.Redirect(customErrorPageUrl)`.</span><span class="sxs-lookup"><span data-stu-id="b35e9-217">When an unhandled exception reaches the ASP.NET runtime the ASP.NET engine raises its `Error` event (which executes the `Application_Error` event handler) and then *redirects* the user to the custom error page by issuing a `Response.Redirect(customErrorPageUrl)`.</span></span> <span data-ttu-id="b35e9-218">`Response.Redirect` Метод отправляет ответ клиенту с кодом состояния HTTP 302, предписывая браузер для запроса нового URL-адрес, а именно пользовательскую страницу ошибки.</span><span class="sxs-lookup"><span data-stu-id="b35e9-218">The `Response.Redirect` method sends a response to the client with an HTTP 302 status code, instructing the browser to request a new URL, namely the custom error page.</span></span> <span data-ttu-id="b35e9-219">Затем браузер автоматически запрашивает эта новая страница.</span><span class="sxs-lookup"><span data-stu-id="b35e9-219">The browser then automatically requests this new page.</span></span> <span data-ttu-id="b35e9-220">Чтобы узнать что пользовательскую страницу ошибки была запрошена отдельно на странице где возникла ошибка, так как в адресной строке браузера изменяется на URL-адрес страницы настраиваемых ошибок (см. в разделе **рис. 4**).</span><span class="sxs-lookup"><span data-stu-id="b35e9-220">You can tell that the custom error page was requested separately from the page where the error originated because the browser's Address bar changes to the custom error page URL (see **Figure 4**).</span></span>

[![](processing-unhandled-exceptions-vb/_static/image11.png)](processing-unhandled-exceptions-vb/_static/image10.png)

<span data-ttu-id="b35e9-221">**Рис. 4**: При возникновении ошибки браузер перенаправляется на URL-адрес страницы настраиваемых ошибок</span><span class="sxs-lookup"><span data-stu-id="b35e9-221">**Figure 4**: When an Error Occurs the Browser Gets Redirected to the Custom Error Page URL</span></span>  
 <span data-ttu-id="b35e9-222">([Просмотр полноразмерного изображения](processing-unhandled-exceptions-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="b35e9-222">([Click to view full-size image](processing-unhandled-exceptions-vb/_static/image12.png))</span></span>

<span data-ttu-id="b35e9-223">В итоге получается, что запрос, где произошло необработанное исключение заканчивается, когда сервер не ответит перенаправления HTTP 302.</span><span class="sxs-lookup"><span data-stu-id="b35e9-223">The net effect is that the request where the unhandled exception occurred ends when the server responds with the HTTP 302 redirect.</span></span> <span data-ttu-id="b35e9-224">Последующие запросы к пользовательскую страницу ошибки — это новый запрос; к этому моменту ASP.NET ядра отменила сведения об ошибке и, кроме того, не должен быть сопоставлен необработанное исключение в предыдущем запросе нового запроса для пользовательскую страницу ошибки.</span><span class="sxs-lookup"><span data-stu-id="b35e9-224">The subsequent request to the custom error page is a brand new request; by this point the ASP.NET engine has discarded the error information and, moreover, has no way to associate the unhandled exception in the previous request with the new request for the custom error page.</span></span> <span data-ttu-id="b35e9-225">Вот почему `GetLastError` возвращает `null` при вызове из пользовательскую страницу ошибки.</span><span class="sxs-lookup"><span data-stu-id="b35e9-225">This is why `GetLastError` returns `null` when called from the custom error page.</span></span>

<span data-ttu-id="b35e9-226">Тем не менее это может быть пользовательскую страницу ошибки во время тот же запрос, который вызвал ошибку.</span><span class="sxs-lookup"><span data-stu-id="b35e9-226">However, it is possible to have the custom error page executed during the same request that caused the error.</span></span> <span data-ttu-id="b35e9-227">[ `Server.Transfer(url)` ](https://msdn.microsoft.com/library/system.web.httpserverutility.transfer.aspx) Метод передает выполнение на указанный URL-адрес и обрабатывает его в тот же запрос.</span><span class="sxs-lookup"><span data-stu-id="b35e9-227">The [`Server.Transfer(url)`](https://msdn.microsoft.com/library/system.web.httpserverutility.transfer.aspx) method transfers execution to the specified URL and processes it within the same request.</span></span> <span data-ttu-id="b35e9-228">Можно переместить код `Application_Error` обработчик событий к вспомогательному классу страницы настраиваемых ошибок, заменяя его в `Global.asax` следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="b35e9-228">You could move the code in the `Application_Error` event handler to the custom error page's code-behind class, replacing it in `Global.asax` with the following code:</span></span>

[!code-vb[Main](processing-unhandled-exceptions-vb/samples/sample5.vb)]

<span data-ttu-id="b35e9-229">Когда происходит необработанное исключение `Application_Error` обработчик событий передает управление соответствующие пользовательскую страницу ошибки на основании кода состояния HTTP.</span><span class="sxs-lookup"><span data-stu-id="b35e9-229">Now when an unhandled exception occurs the `Application_Error` event handler transfers control to the appropriate custom error page based on the HTTP status code.</span></span> <span data-ttu-id="b35e9-230">Так как элемент управления был передан, пользовательскую страницу ошибки имеет доступ к сведениям необработанное исключение с помощью `Server.GetLastError` уведомлять разработчика ошибки и журнал сведения о нем.</span><span class="sxs-lookup"><span data-stu-id="b35e9-230">Because control was transferred, the custom error page has access to the unhandled exception information via `Server.GetLastError` and can notify a developer of the error and log its details.</span></span> <span data-ttu-id="b35e9-231">`Server.Transfer` Вызов останавливает ядро ASP.NET из перенаправления пользователя на пользовательскую страницу ошибки.</span><span class="sxs-lookup"><span data-stu-id="b35e9-231">The `Server.Transfer` call stops the ASP.NET engine from redirecting the user to the custom error page.</span></span> <span data-ttu-id="b35e9-232">Вместо этого содержимое страницы пользовательской ошибки возвращаются в виде ответа на страницу, вызвавшего ошибку.</span><span class="sxs-lookup"><span data-stu-id="b35e9-232">Instead, the custom error page's content is returned as the response to the page that generated the error.</span></span>

## <a name="summary"></a><span data-ttu-id="b35e9-233">Сводка</span><span class="sxs-lookup"><span data-stu-id="b35e9-233">Summary</span></span>

<span data-ttu-id="b35e9-234">При возникновении необработанного исключения в веб-приложении ASP.NET среда выполнения ASP.NET вызывает `Error` событий и отображает страницу настроенные ошибки.</span><span class="sxs-lookup"><span data-stu-id="b35e9-234">When an unhandled exception occurs in an ASP.NET web application the ASP.NET runtime raises the `Error` event and displays the configured error page.</span></span> <span data-ttu-id="b35e9-235">Мы сообщим, разработчик ошибки, войдите в сведения о нем или обрабатывает каким-либо другим образом, Создание обработчика событий для события ошибки.</span><span class="sxs-lookup"><span data-stu-id="b35e9-235">We can notify the developer of the error, log its details, or process it in some other fashion, by creating an event handler for the Error event.</span></span> <span data-ttu-id="b35e9-236">Существует два способа, чтобы создать обработчик событий для `HttpApplication` событий, таких как `Error`: в `Global.asax` файла или с помощью модуля HTTP.</span><span class="sxs-lookup"><span data-stu-id="b35e9-236">There are two ways to create an event handler for `HttpApplication` events like `Error`: in the `Global.asax` file or from an HTTP Module.</span></span> <span data-ttu-id="b35e9-237">Этом руководстве были рассмотрены способы создания `Error` обработчик событий в `Global.asax` файл, который уведомляет разработчиков ошибки в сообщении электронной почты.</span><span class="sxs-lookup"><span data-stu-id="b35e9-237">This tutorial showed how to create an `Error` event handler in the `Global.asax` file that notifies developers of an error by means of an email message.</span></span>

<span data-ttu-id="b35e9-238">Создание `Error` обработчик событий полезно, если требуется обработка необработанных исключений некоторым способом уникальный или настроенные.</span><span class="sxs-lookup"><span data-stu-id="b35e9-238">Creating an `Error` event handler is useful if you need to process unhandled exceptions in some unique or customized manner.</span></span> <span data-ttu-id="b35e9-239">Однако создание собственной `Error` обработчик событий исключений в журнале или для уведомления разработчик не наиболее эффективно использовать свое время, так как уже существующие библиотеки ведения журналов бесплатный и простой в использовании ошибки, которые можно настроить в считанные минуты.</span><span class="sxs-lookup"><span data-stu-id="b35e9-239">However, creating your own `Error` event handler to log the exception or to notify a developer is not the most efficient use of your time as there already exist free and easy to use error logging libraries that can be setup in a matter of minutes.</span></span> <span data-ttu-id="b35e9-240">Следующие два руководства изучите двух таких библиотеках.</span><span class="sxs-lookup"><span data-stu-id="b35e9-240">The next two tutorials examine two such libraries.</span></span>

<span data-ttu-id="b35e9-241">Счастливого вам программирования!</span><span class="sxs-lookup"><span data-stu-id="b35e9-241">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="b35e9-242">Дополнительные сведения</span><span class="sxs-lookup"><span data-stu-id="b35e9-242">Further Reading</span></span>

<span data-ttu-id="b35e9-243">Дополнительные сведения по темам, обсуждавшимся в этом руководстве см. в следующих ресурсах:</span><span class="sxs-lookup"><span data-stu-id="b35e9-243">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="b35e9-244">HTTP-модули ASP.NET и общие сведения об обработчиках HTTP</span><span class="sxs-lookup"><span data-stu-id="b35e9-244">ASP.NET HTTP Modules and HTTP Handlers Overview</span></span>](https://support.microsoft.com/kb/307985)
- [<span data-ttu-id="b35e9-245">Корректно отвечать на необработанные исключения - обработка необработанных исключений</span><span class="sxs-lookup"><span data-stu-id="b35e9-245">Gracefully Responding to Unhandled Exceptions - Processing Unhandled Exceptions</span></span>](http://aspnet.4guysfromrolla.com/articles/091306-1.aspx)
- [<span data-ttu-id="b35e9-246">`HttpApplication` Класс и объект приложения ASP.NET</span><span class="sxs-lookup"><span data-stu-id="b35e9-246">`HttpApplication` Class and the ASP.NET Application Object</span></span>](http://www.eggheadcafe.com/articles/20030211.asp)
- [<span data-ttu-id="b35e9-247">HTTP-обработчики и модули HTTP в ASP.NET</span><span class="sxs-lookup"><span data-stu-id="b35e9-247">HTTP Handlers and HTTP Modules in ASP.NET</span></span>](http://www.15seconds.com/Issue/020417.htm)
- [<span data-ttu-id="b35e9-248">Отправка сообщения электронной почты в ASP.NET</span><span class="sxs-lookup"><span data-stu-id="b35e9-248">Sending Email in ASP.NET</span></span>](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx)
- [<span data-ttu-id="b35e9-249">Основные сведения о `Global.asax` файла</span><span class="sxs-lookup"><span data-stu-id="b35e9-249">Understanding the `Global.asax` File</span></span>](http://aspalliance.com/1114_Understanding_the_Globalasax_file.all)
- [<span data-ttu-id="b35e9-250">Создание подключаемых компонентов ASP.NET с помощью HTTP-модули и обработчики</span><span class="sxs-lookup"><span data-stu-id="b35e9-250">Using HTTP Modules and Handlers to Create Pluggable ASP.NET Components</span></span>](https://msdn.microsoft.com/library/aa479332.aspx)
- [<span data-ttu-id="b35e9-251">Работа с ASP.NET `Global.asax` файла</span><span class="sxs-lookup"><span data-stu-id="b35e9-251">Working with the ASP.NET `Global.asax` File</span></span>](http://articles.techrepublic.com.com/5100-10878_11-5771721.html)
- [<span data-ttu-id="b35e9-252">Работа с `HttpApplication` экземпляров</span><span class="sxs-lookup"><span data-stu-id="b35e9-252">Working with `HttpApplication` Instances</span></span>](https://msdn.microsoft.com/library/a0xez8f2.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="b35e9-253">[Назад](displaying-a-custom-error-page-vb.md)
> [Вперед](logging-error-details-with-asp-net-health-monitoring-vb.md)</span><span class="sxs-lookup"><span data-stu-id="b35e9-253">[Previous](displaying-a-custom-error-page-vb.md)
[Next](logging-error-details-with-asp-net-health-monitoring-vb.md)</span></span>
