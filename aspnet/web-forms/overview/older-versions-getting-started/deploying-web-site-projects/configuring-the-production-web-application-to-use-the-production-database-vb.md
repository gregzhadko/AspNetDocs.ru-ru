---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/configuring-the-production-web-application-to-use-the-production-database-vb
title: Настройка рабочего веб-приложения для использования рабочей базы данных (VB) | Документация Майкрософт
author: rick-anderson
description: Как обсуждалось в предыдущих учебных курсах, информация о конфигурации не часто различается в средах разработки и рабочей среде. Это ES...
ms.author: riande
ms.date: 04/23/2009
ms.assetid: a64a7aa0-6608-449e-83bf-1ef8cceee504
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/configuring-the-production-web-application-to-use-the-production-database-vb
msc.type: authoredcontent
ms.openlocfilehash: 7fe4f545a76992ad687827af447d9a9e95bea73f
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78516624"
---
# <a name="configuring-the-production-web-application-to-use-the-production-database-vb"></a>Настройка рабочего веб-приложения для использования рабочей базы данных (VB)

по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Скачать код](https://download.microsoft.com/download/E/6/F/E6FE3A1F-EE3A-4119-989A-33D1A9F6F6DD/ASPNET_Hosting_Tutorial_08_VB.zip) или [скачать PDF](https://download.microsoft.com/download/C/3/9/C391A649-B357-4A7B-BAA4-48C96871FEA6/aspnet_tutorial08_DBConfig_vb.pdf)

> Как обсуждалось в предыдущих учебных курсах, информация о конфигурации не часто различается в средах разработки и рабочей среде. Это особенно справедливо для управляемых данными веб-приложений, так как строки подключения к базе данных отличаются в средах разработки и рабочей среде. В этом руководстве рассматриваются способы настройки рабочей среды для более подробного включения соответствующей строки подключения.

## <a name="introduction"></a>Введение

Веб-приложения, управляемые данными, обычно используют другую базу данных при разработке, а не в рабочей среде. Для приложений, размещенных в поставщике веб-узла и разработанных локально, база данных разработки обычно находится на компьютере разработчика, а Рабочая база данных размещается на сервере базы данных в компании, размещенной в Интернете. Развертывание управляемого данными веб-приложения влечет за собой копирование базы данных разработки на сервер рабочей базы данных. В предыдущем учебном курсе мы рассматривали способы выполнения этого шага.

Веб-приложение использует сведения в *строке подключения* для установления соединения с базой данных. Строка подключения, которая обычно хранится в `Web.config`, указывает имя сервера базы данных, имя базы данных, контекст безопасности и другие сведения. Поскольку база данных, используемая веб-приложением, зависит от того, выполняется ли веб-приложение в средах разработки или рабочей среде, строки подключения должны различаться между этими двумя средами.

Нередко информация о конфигурации различается в средах разработки и рабочей среде. *Общие различия конфигураций* в учебнике по разработке и производству обсуждают методики обслуживания отдельных сведений о конфигурации между этими двумя средами, а также краткое обсуждение строк подключения к базам данных. В этом руководстве рассматриваются способы настройки рабочей среды для более подробного включения соответствующей строки подключения.

## <a name="examining-the-connection-string-information"></a>Проверка сведений о строке подключения

Строка подключения, используемая веб-приложением для рецензирования книги, хранится в файле конфигурации приложения `Web.config`. `Web.config` включает специальный раздел для хранения строк подключения, выразился с именем [&lt;connectionstring&gt;](https://msdn.microsoft.com/library/bf7sd233.aspx). Файл `Web.config` для веб-сайта проверки книги содержит одну строку подключения, определенную в этом разделе с именем `ReviewsConnectionString`:

[!code-xml[Main](configuring-the-production-web-application-to-use-the-production-database-vb/samples/sample1.xml)]

Строка подключения — источник данных = .\SQLEXPRESS; AttachDbFilename = | DataDirectory | \Ревиевс.МДФ; Integrated Security = true; User Instance = true — состоит из ряда параметров и значений, в которых пары "ключ-значение" ограничены точкой с запятой, а каждый параметр и значение разделяются знаком равенства. В этой строке подключения используются четыре параметра:

- `Data Source` — указывает расположение сервера базы данных и имя экземпляра сервера базы данных (если есть). Значение, `.\SQLEXPRESS`, — это пример, в котором есть сервер базы данных и имя экземпляра. Период указывает, что сервер базы данных находится на том же компьютере, что и приложение; имя экземпляра — `SQLEXPRESS`.
- `AttachDbFilename` — указывает расположение файла базы данных. Значение содержит заполнитель `|DataDirectory|`, который разрешается в полный путь к папке приложения `App_Data` во время выполнения.
- `Integrated Security` — логическое значение, указывающее, следует ли использовать указанное имя пользователя и пароль при подключении к базе данных (false) или учетные данные текущей учетной записи Windows (true).
- `User Instance` — параметр конфигурации, относящийся к выпускам SQL Server Express, которые указывают, следует ли разрешать пользователям, не являющимся администраторами, на локальном компьютере присоединяться к базе данных SQL Server Express Edition и подключаться к ней. Дополнительные сведения об этом параметре см. в разделе [SQL Server Express User Instances](https://msdn.microsoft.com/library/ms254504.aspx) .

Допустимые параметры строки подключения зависят от базы данных, к которой вы подключаетесь, и используемого поставщика базы данных [ADO.NET](http://ADO.NET) . Например, строка подключения для соединения с Microsoft SQL Server базой данных отличается от той, которая использовалась для подключения к базе данных Oracle. Аналогичным образом, при подключении к базе данных Microsoft SQL Server с помощью поставщика SqlClient используется строка подключения, отличная от строки соединения, используемой поставщиком OLE DB.

Вы можете создать строку подключения к базе данных вручную, используя сайт, например [connectionStrings.com](http://www.connectionstrings.com/) , в качестве ресурса для выбора доступных параметров. Однако проще подходить к добавлению базы данных в обозреватель сервера в Visual Studio, а затем извлечь строку подключения из окно свойств. Позвольте использовать этот второй метод для создания строки подключения к рабочему серверу базы данных.

Откройте Visual Studio и перейдите в окно обозреватель сервера (в Visual Web Developer это окно называется обозреватель базы данных). Щелкните правой кнопкой мыши параметр подключения к данным и выберите в контекстном меню пункт Добавить подключение. Откроется мастер, показанный на рис. 1. Выберите соответствующий источник данных и нажмите кнопку продолжить.

[![выберите Добавление новой базы данных в обозреватель сервера](configuring-the-production-web-application-to-use-the-production-database-vb/_static/image2.jpg)](configuring-the-production-web-application-to-use-the-production-database-vb/_static/image1.jpg) 

**Рис. 1**. Добавление новой базы данных в обозреватель сервера ([щелкните, чтобы просмотреть изображение с полным размером](configuring-the-production-web-application-to-use-the-production-database-vb/_static/image3.jpg))

Затем укажите различные сведения о подключении к базе данных (см. рис. 2). При регистрации в компании для размещения веб-узлов им должны быть предоставлены сведения о подключении к базе данных: имя сервера базы данных, имя базы данных, имя пользователя и пароль, используемые для подключения к базе данных и т. д. После ввода этих сведений нажмите кнопку ОК, чтобы завершить работу мастера и добавить базу данных в обозреватель сервера.

[![указать сведения о подключении к базе данных](configuring-the-production-web-application-to-use-the-production-database-vb/_static/image5.jpg)](configuring-the-production-web-application-to-use-the-production-database-vb/_static/image4.jpg) 

**Рис. 2**. Указание сведений о подключении к базе данных ([щелкните, чтобы просмотреть изображение с полным размером](configuring-the-production-web-application-to-use-the-production-database-vb/_static/image6.jpg))

Теперь база данных рабочей среды должна быть указана в обозреватель сервера. Выберите базу данных из обозреватель сервера и перейдите к окно свойств. Здесь вы найдете свойство с именем строка соединения с строкой подключения базы данных. При условии, что вы используете базу данных Microsoft SQL Server в рабочей среде и Поставщик SqlClient, строка подключения должна выглядеть следующим образом:

<strong>Источник данных =<em>ServerName</em>; Исходный каталог =<em>DatabaseName</em>; Сохранить сведения о безопасности = true; Идентификатор пользователя =<em>username</em>; Password =*пароль</strong>*

Где *ServerName*, *DatabaseName*, *username*и *Password* имеют значения для имени сервера базы данных, имени базы данных и имени пользователя и пароля, предоставленных вашей компанией веб-узла.

## <a name="deploying-the-book-reviews-web-application"></a>Развертывание веб-приложения для рецензирования книги

Предыдущая пошаговая руководства повышена при копировании базы данных разработки в рабочую среду, но не изучается при развертывании приложения, управляемого данными. На этом этапе Рабочая среда содержит базу данных, но использует версию приложения для рецензирования книги со статическими проверками. Необходимо развернуть новое приложение, управляемое данными, на рабочем сервере вместе с обновленными сведениями о конфигурации.

Уделите немного времени развертыванию приложения, управляемого данными, из среды разработки в рабочей среде. Этот процесс подробно описан в предыдущих руководствах. Если вам требуется Обновитель, см. раздел *Развертывание веб-сайта с помощью FTP-клиента* или *Развертывание веб-сайта с помощью Visual Studio* . Необходимо убедиться, что строка подключения к рабочей базе данных используется в рабочей среде. Это означает, что необходимо развернуть альтернативный файл `Web.config`. В частности, этот измененный `Web.config` файл `<connectionStrings>` должен содержать строку подключения к рабочей базе данных и должен выглядеть следующим образом:

[!code-xml[Main](configuring-the-production-web-application-to-use-the-production-database-vb/samples/sample2.xml)]

Обратите внимание, что строка подключения в элементе `<connectionStrings>` имеет то же имя (`ReviewsConnectionString`), но теперь содержит строку подключения к рабочей базе данных, а не строку подключения к базе данных разработки.

Если у вас нет более формального рабочего процесса развертывания, вручную измените файл `Web.config` для использования строки подключения к рабочей базе данных перед развертыванием (не забывайте вернуться к использованию строки подключения к базе данных разработки позже) или сохраните отдельный файл `Web.config` с данными конфигурации рабочей среды, которые передаются в рабочую среду в рамках процесса развертывания.

> [!NOTE]
> Если случайно развернуть `Web.config` файл, содержащий строку подключения к базе данных разработки, то при попытке приложения в рабочей среде подключиться к базе данных произойдет ошибка. Эта ошибка манифеста `SqlException` с сообщением о том, что сервер не найден или недоступен.

После развертывания сайта в рабочей среде перейдите на рабочий сайт в браузере. Вы должны увидеть тот же пользовательский интерфейс, что и при локальном запуске приложения, управляемого данными. Разумеется, при посещении веб-сайта в рабочей среде рабочий сервер базы данных, в то время как на веб-сайте среды разработки используется база данных для разработки. На рис. 3 показана страница проверки *ASP.NET 3,5 в течение 24 часов* с веб-сайта в рабочей среде (Обратите внимание на URL-адрес в адресной строке браузера).

[![приложение, управляемое данными, теперь доступно в рабочей среде.](configuring-the-production-web-application-to-use-the-production-database-vb/_static/image8.jpg)](configuring-the-production-web-application-to-use-the-production-database-vb/_static/image7.jpg) 

**Рис. 3**. приложение, управляемое данными, теперь доступно в рабочей среде. ([Щелкните, чтобы просмотреть изображение с полным размером](configuring-the-production-web-application-to-use-the-production-database-vb/_static/image9.jpg))

### <a name="storing-connection-strings-in-a-separate-configuration-file"></a>Хранение строк подключения в отдельном файле конфигурации

Распространенной методикой для поддержки отдельных сведений о конфигурации в средах разработки и рабочей среде являются две версии `Web.config`: одна для среды разработки, а другая — для рабочей. Во время развертывания соответствующую версию `Web.config` можно скопировать в рабочую среду. В идеале этот процесс будет автоматизирован в рамках рабочего процесса развертывания.

Вместо поддержки двух отдельных файлов `Web.config` можно, при необходимости, предоставить более детализированные различия. Элементы, составляющие файл `Web.config`, можно определить во внешних файлах конфигурации, на которые затем ссылаются в файле `Web.config`. В двух словах, у обеих сред может быть один файл `Web.config`, который ссылается на файл Датабасеконнектионстрингс. config, который будет содержать строки подключения, используемые приложением, и будет уникальным для каждой среды. Я вижу, что разделение различных сведений о конфигурации на отдельные файлы предоставляет аккуратная и более простой файл `Web.config` и более четко описывает различия в конфигурации сред разработки и рабочей среды.

Чтобы использовать этот метод, начните с создания новой папки в веб-приложении с именем `ConfigSections`. Затем добавьте два файла в эту новую папку с именем Датабасеконнектионстрингс. dev. config и Датабасеконнектионстрингс. Production. config. Затем скопируйте элемент `<connectionStrings>` из `Web.config` в файлы Датабасеконнектионстрингс. dev. config и Датабасеконнектионстрингс. Production. config, а затем измените строку подключения в файле Датабасеконнектионстрингс. Production. config, чтобы указать строку подключения к рабочей базе данных. Например, файл Датабасеконнектионстрингс. dev. config должен содержать только элемент `<connectionStrings>` со строкой подключения, которая ссылается на базу данных разработки:

[!code-xml[Main](configuring-the-production-web-application-to-use-the-production-database-vb/samples/sample3.xml)]

Аналогичным образом файл Датабасеконнектионстрингс. Production. config должен содержать только элемент `<connectionStrings>`, но со строкой подключения к рабочей базе данных.

Создайте копию файла Датабасеконнектионстрингс. dev. config и назовите ее Датабасеконнектионстрингс. config.

> [!NOTE]
> Можно присвоить файлу конфигурации значение, отличное от Датабасеконнектионстрингс. config, если вы d Like, например `connectionStrings.config` или `dbInfo.config`. Однако не забудьте присвоить файлу расширение `.config`, так как `.config` файлы по умолчанию не обслуживаются подсистемой ASP.NET. Если вы назначите файл в другом месте, например `connectionStrings.txt`, пользователь может указать обозревателю [www.yoursite.com/ConfigSettings/connectionStrings.txt](http://www.yoursite.com/ConfigSettings/connectionStrings.txt) и просмотреть содержимое файла!

На этом этапе папка `ConfigSections` должна содержать три файла (см. рис. 4). Файлы Датабасеконнектионстрингс. dev. config и Датабасеконнектионстрингс. Production. config содержат строки подключения для сред разработки и рабочей среды соответственно. Файл Датабасеконнектионстрингс. config содержит сведения строки подключения, которые будут использоваться веб-приложением во время выполнения. Следовательно, файл Датабасеконнектионстрингс. config должен быть идентичен файлу Датабасеконнектионстрингс. dev. config в среде разработки, в то время как в производстве файл Датабасеконнектионстрингс. config должен быть идентичен Датабасеконнектионстрингс. Production. config.

[![ConfigSections](configuring-the-production-web-application-to-use-the-production-database-vb/_static/image11.jpg)](configuring-the-production-web-application-to-use-the-production-database-vb/_static/image10.jpg) 

**Рисунок 4**. ConfigSections ([щелкните, чтобы просмотреть изображение с полным размером](configuring-the-production-web-application-to-use-the-production-database-vb/_static/image12.jpg))

Теперь необходимо указать `Web.config` использовать файл Датабасеконнектионстрингс. config для хранилища строк подключения. Откройте файл `Web.config` и замените существующий элемент `<connectionStrings>` следующим кодом:

[!code-xml[Main](configuring-the-production-web-application-to-use-the-production-database-vb/samples/sample4.xml)]

Атрибут `configSource` задает физический путь относительно файла `Web.config`. Если внешний `.config` файл находится в том же каталоге, что и `Web.config`, присвойте этому атрибуту имя файла `.config`. Если он находится в подкаталоге, как в случае с Датабасеконнектионстрингс. config, укажите подпапку с помощью обратной косой черты, чтобы разделить имена папок и файлов, например Конфигсектионс\датабасеконнектионстрингс.Конфиг.

При таком изменении среды разработки и рабочей среде содержат один и тот же файл `Web.config`. Теперь единственным отличием является файл Датабасеконнектионстрингс. config. Скопируйте файл Датабасеконнектионстрингс. Production. config в рабочую среду и переименуйте его в Датабасеконнектионстрингс. config. Если в будущем в строке подключения к рабочей базе данных будут внесены изменения, необходимо внести их в файл Датабасеконнектионстрингс. Production. config, а затем передать этот файл в рабочую среду, переименовав его Датабасеконнектионстрингс. config.

> [!NOTE]
> Можно указать сведения для любого элемента `Web.config` в отдельном файле и использовать атрибут `configSource` для ссылки на этот файл из `Web.config`.

## <a name="summary"></a>Сводка

Приложения, управляемые данными, обычно используют разные базы данных в средах разработки и рабочей среде. Следовательно, строки подключения к базе данных, которые хранятся в конфигурации веб-приложения, должны быть уникальными для каждой среды. В этом учебнике мы рассмотрели, как определить строку подключения к рабочей базе данных и способы сохранения уникальных данных строки подключения в двух средах.

Поздравляем с программированием!

### <a name="further-reading"></a>Дополнительные материалы

Дополнительные сведения о разделах, обсуждаемых в этом руководстве, см. в следующих ресурсах:

- [Строки подключения и файлы конфигурации](https://msdn.microsoft.com/library/ms254494.aspx)
- [Сведения о строках конфигурации базы данных @ ConnectionStrings.com](http://www.connectionstrings.com/)
- [Переместить параметры из файла Web. config](http://www.asp101.com/tips/index.asp?id=154)
- [Техническая документация по &lt;connectionString&gt; element](https://msdn.microsoft.com/library/bf7sd233.aspx)

> [!div class="step-by-step"]
> [Назад](deploying-a-database-vb.md)
> [Вперед](configuring-a-website-that-uses-application-services-vb.md)
