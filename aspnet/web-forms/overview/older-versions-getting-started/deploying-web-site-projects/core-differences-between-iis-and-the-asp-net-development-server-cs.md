---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/core-differences-between-iis-and-the-asp-net-development-server-cs
title: Основные различия между IIS и ASP.NET Development Server (C#) | Документация Майкрософт
author: rick-anderson
description: При локальном тестировании приложения ASP.NET, вероятно, вы используете веб-сервер разработки ASP.NET. Тем не менее, Рабочий веб-сайт, скорее всего, Pow...
ms.author: riande
ms.date: 04/01/2009
ms.assetid: 13a5a423-9235-4dde-b408-2fd10f791d63
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/core-differences-between-iis-and-the-asp-net-development-server-cs
msc.type: authoredcontent
ms.openlocfilehash: 7fea3939bd910a052340215c207013e2269f32a2
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78522084"
---
# <a name="core-differences-between-iis-and-the-aspnet-development-server-c"></a>Основные различия между IIS и ASP.NET Development Server (C#)

по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Скачать код](https://download.microsoft.com/download/4/5/F/45F815EC-8B0E-46D3-9FB8-2DC015CCA306/ASPNET_Hosting_Tutorial_06_CS.zip) или [скачать PDF](https://download.microsoft.com/download/E/8/9/E8920AE6-D441-41A7-8A77-9EF8FF970D8B/aspnet_tutorial06_WebServerDiff_cs.pdf)

> При локальном тестировании приложения ASP.NET, вероятно, вы используете веб-сервер разработки ASP.NET. Однако рабочий веб-сайт, скорее всего, будет включен в IIS. Существуют некоторые различия между обработкой запросов этими веб-серверами, и эти различия могут иметь важные последствия. В этом руководстве рассматриваются некоторые из более различий в немецком языке.

## <a name="introduction"></a>Введение

Каждый раз, когда пользователь посещает приложение ASP.NET, его браузер отправляет запрос на веб-сайт. Этот запрос выбирается программным обеспечением веб-сервера, которое координирует с исполняющей средой ASP.NET для создания и возврата содержимого для запрошенного ресурса. [Ернет **i** нформатион **S** ервицес (IIS) **—** ](http://en.wikipedia.org/wiki/Internet_Information_Services) это набор служб, которые предоставляют общие Интернет-функции для серверов Windows. IIS — это наиболее часто используемый веб-сервер для приложений ASP.NET в рабочих средах. скорее всего, это программное обеспечение веб-сервера, используемое поставщиком веб-узла для обслуживания приложения ASP.NET. Службы IIS также можно использовать в качестве программного обеспечения веб-сервера в среде разработки, хотя это влечет за собой установку IIS и их правильной настройки.

ASP.NET Development Server является альтернативным вариантом веб-сервера для среды разработки; Она поставляется вместе с и интегрирована в Visual Studio. Если веб-приложение не настроено для использования служб IIS, то ASP.NET Development Server автоматически запускается и используется в качестве веб-сервера при первом посещении веб-страницы в Visual Studio. Демонстрационные веб-приложения, которые мы создали в учебнике [*Определение файлов для развертывания*](determining-what-files-need-to-be-deployed-cs.md) , были как веб-приложения на основе файловой системы, которые не были настроены для использования IIS. Поэтому при посещении любого из этих веб-сайтов в Visual Studio используется ASP.NET Development Server.

В идеальном мире среда разработки и рабочей среды будут идентичны. Однако, как мы обсуждали в предыдущем учебном курсе, в средах не очень часто используются разные параметры конфигурации. Использование различных программного обеспечения веб-сервера в средах добавляет еще одну переменную, которую следует учитывать при развертывании приложения. В этом учебнике рассматриваются основные различия между IIS и ASP.NET Development Server. Из-за этих различий существуют сценарии, в которых код, который работает безупречно в среде разработки, создает исключение или ведет себя иначе при выполнении в производстве.

## <a name="security-context-differences"></a>Различия контекста безопасности

Каждый раз, когда программное обеспечение веб-сервера обрабатывает входящий запрос, он связывает этот запрос с определенным контекстом безопасности. Эти сведения о контексте безопасности используются операционной системой для определения действий, допустимых для запроса. Например, страница ASP.NET может содержать код, записывающий некоторое сообщение в файл на диске. Чтобы эта страница ASP.NET была выполнена без ошибок, контекст безопасности должен иметь соответствующие разрешения на уровне файловой системы, а именно разрешения на запись в этот файл.

ASP.NET Development Server связывает входящие запросы с контекстом безопасности вошедшего в систему пользователя. Если вы выполнили вход на Рабочий стол в качестве администратора, то страницы ASP.NET, обслуживаемые ASP.NET Development Server, будут иметь те же права доступа, что и администратор. Однако запросы ASP.NET, обрабатываемые службами IIS, связаны с определенной учетной записью компьютера. По умолчанию учетная запись компьютера сетевой службы используется службами IIS версии 6 и 7, хотя поставщик веб-узла может настроить уникальную учетную запись для каждого клиента. Более того, поставщик веб-узла, вероятно, предоставил ограниченные разрешения на эту учетную запись компьютера. В итоге у вас могут быть веб-страницы, которые выполняются без ошибок в среде разработки, но при размещении в рабочей среде создаются исключения, связанные с авторизацией.

Чтобы отобразить этот тип ошибки в действии, я создал страницу на веб-сайте обзоров книг, создающий файл на диске, в котором хранится самая последняя Дата и время, когда кто-то просматривает *ASP.NET 3,5 за 24 часа* . Чтобы выполнить переход, откройте страницу `~/Tech/TYASP35.aspx` и добавьте следующий код в обработчик событий `Page_Load`:

[!code-csharp[Main](core-differences-between-iis-and-the-asp-net-development-server-cs/samples/sample1.cs)]

> [!NOTE]
> [Метод`File.WriteAllText`](https://msdn.microsoft.com/library/system.io.file.writealltext.aspx) создает новый файл, если он не существует, а затем записывает в него указанное содержимое. Если файл уже существует, существующее содержимое перезаписывается.

Затем посетите страницу проверки книги *ASP.NET 3,5 в течение 24 часов* в среде разработки с помощью ASP.NET Development Server. При условии, что вы вошли в систему на компьютере с учетной записью, имеющей достаточные разрешения для создания и изменения текстового файла в корневом каталоге веб-приложения, обзор книги будет таким же, как и раньше, но при каждом посещении страницы в файл `LastTYASP35Access.txt` будет сохранен IP-адрес пользователя. Укажите в браузере этот файл. должно отобразиться примерно такое сообщение, как показано на рис. 1.

[![текстовый файл содержит последнюю дату и время посещения книги.](core-differences-between-iis-and-the-asp-net-development-server-cs/_static/image2.png)](core-differences-between-iis-and-the-asp-net-development-server-cs/_static/image1.png)

**Рис. 1**. текстовый файл содержит дату и время посещения просмотренной книги ([щелкните, чтобы просмотреть изображение с полным размером](core-differences-between-iis-and-the-asp-net-development-server-cs/_static/image3.png))

Разверните веб-приложение в рабочей среде, а затем перейдите на страницу проверки книги *ASP.NET 3,5 за 24 часа* . На этом этапе вы должны увидеть страницу проверки книги как обычное или сообщение об ошибке, показанное на рис. 2. Некоторые поставщики веб-узлов предоставляют разрешения на запись для учетной записи анонимного ASP.NET компьютера. в этом случае страница будет работать без ошибок. Однако если поставщик веб-узла запрещает доступ на запись для анонимной учетной записи, то [`UnauthorizedAccessException` исключение](https://msdn.microsoft.com/library/system.unauthorizedaccessexception.aspx) возникает, когда `TYASP35.aspx` страница пытается записать текущую дату и время в `LastTYASP35Access.txt` файл.

[![учетная запись компьютера по умолчанию, используемая службами IIS, не имеет разрешений на запись в файловую систему](core-differences-between-iis-and-the-asp-net-development-server-cs/_static/image5.png)](core-differences-between-iis-and-the-asp-net-development-server-cs/_static/image4.png)

**Рис. 2**. учетная запись компьютера по умолчанию, ИСПОЛЬЗУЕМАЯ службами IIS, не имеет разрешений на запись в файловую систему ([щелкните, чтобы просмотреть изображение с полным размером](core-differences-between-iis-and-the-asp-net-development-server-cs/_static/image6.png))

Хорошая новость в том, что большинство поставщиков веб-узлов имеют некоторые средства разрешения, позволяющие указать разрешения файловой системы на веб-сайте. Предоставьте анонимной учетной записи ASP.NET доступ на запись в корневой каталог, а затем снова перейдите на страницу проверки книги. (При необходимости обратитесь к поставщику веб-узла за помощью по предоставлению разрешений на запись в учетную запись ASP.NET по умолчанию.) На этот раз страница должна загружаться без ошибок, и файл `LastTYASP35Access.txt` должен быть успешно создан.

Вот что из-за того, что ASP.NET Development Server работает в контексте безопасности, отличном от контекста IIS, возможно, что страницы ASP.NET, которые считывают или записывают в файловую систему, считывают или записывают в журнал событий Windows либо считывают или записывают в Windows.  реестр будет работать должным образом при разработке, но создавать исключения в рабочей среде. При создании веб-приложения, которое будет развернуто в общей среде размещения, не следует выполнять чтение или запись в журнал событий или реестр Windows. Также запишите все страницы ASP.NET, которые считывают или записывают в файловую систему, так как может потребоваться предоставить права на чтение и запись в соответствующих папках в рабочей среде.

## <a name="differences-on-serving-static-content"></a>Различия в обслуживании статического содержимого

Другим основным различием между IIS и ASP.NET Development Server является то, как они обрабатывали запросы к статическому содержимому. Каждый запрос, поступающий в ASP.NET Development Server, будь то страница ASP.NET, изображение или файл JavaScript, обрабатывается средой выполнения ASP.NET. По умолчанию службы IIS вызывают только среду выполнения ASP.NET, когда запрос поступает для ресурса ASP.NET, например веб-страницы ASP.NET, веб-службы и т. д. Запросы на статическое содержимое — изображения, CSS-файлы, файлы JavaScript, PDF-файлы, ZIP-файлы и т. д. извлекаются службами IIS без участия среды выполнения ASP.NET. (Можно настроить IIS для работы со средой выполнения ASP.NET при обслуживании статического содержимого. Дополнительные сведения см. в подразделе "выполнение проверки подлинности на основе форм и проверка подлинности URL-адресов для статических файлов с IIS 7" этого руководства.)

Среда выполнения ASP.NET выполняет ряд действий по формированию запрошенного содержимого, включая проверку подлинности (идентификацию запрашивающей стороны) и авторизацию (определяет, имеет ли запрашивающий разрешение на просмотр запрошенного содержимого). Популярная форма проверки подлинности — это *Проверка подлинности на основе форм*, в которой пользователь вводит свои учетные данные (обычно это имя пользователя и пароль в текстовые поля на веб-странице). После проверки учетных данных веб-сайт сохраняет файл cookie *билета проверки подлинности* в браузере пользователя, который отправляется при каждом последующем запросе к веб-сайту и используется для проверки подлинности пользователя. Кроме того, можно указать правила *авторизации URL-адресов* , определяющие, какие пользователи могут или не могут получить доступ к определенной папке. Многие веб-сайты ASP.NET используют проверку подлинности на основе форм и авторизацию URL-адресов для поддержки учетных записей пользователей и определения частей сайта, которые доступны только пользователям, прошедшим проверку подлинности, или пользователям, принадлежащим к определенной роли.

> [!NOTE]
> Для тщательного изучения ASP. Проверка подлинности на основе форм, авторизация по URL-адресу и другие функции, связанные с учетными записями пользователей, обязательно изучите [учебники по безопасности веб-сайтов](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).

Рассмотрим веб-сайт, который поддерживает учетные записи пользователей с помощью авторизации на основе форм и имеет папку, которая использует авторизацию по URL-адресу, настроенную на разрешение только пользователей, прошедших проверку подлинности. Представьте, что эта папка содержит страницы ASP.NET и PDF-файлы, и что цель состоит в том, что только пользователи, прошедшие проверку подлинности, могут просматривать эти PDF-файлы.

Что произойдет, если посетитель пытается просмотреть один из этих PDF-файлов, введя его непосредственно в адресной строке браузера? Чтобы узнать это, создадим новую папку на сайте рецензий книги, добавим PDF-файлы и настроим сайт на использование авторизации URL-адресов, чтобы запретить анонимным пользователям доступ к этой папке. Если вы загрузили демонстрационное приложение, вы увидите, что создали папку с именем `PrivateDocs` и добавили PDF-файл из [учебников по безопасности веб-сайта](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md) (как подгонка!). В папке `PrivateDocs` также содержится файл `Web.config`, в котором указываются правила авторизации URL-адресов для запрета анонимных пользователей:

[!code-xml[Main](core-differences-between-iis-and-the-asp-net-development-server-cs/samples/sample2.xml)]

Наконец, я настроил веб-приложение для использования проверки подлинности на основе форм, обновив файл `Web.config` в корневом каталоге, заменив:

[!code-xml[Main](core-differences-between-iis-and-the-asp-net-development-server-cs/samples/sample3.xml)]

на:

[!code-xml[Main](core-differences-between-iis-and-the-asp-net-development-server-cs/samples/sample4.xml)]

Используя ASP.NET Development Server, перейдите на сайт и введите прямой URL-адрес для одного из PDF-файлов в адресной строке браузера. Если вы скачали веб-сайт, связанный с этим руководством, URL-адрес должен выглядеть примерно так: `http://localhost:portNumber/PrivateDocs/aspnet_tutorial01_Basics_vb.pdf`

Если ввести этот URL-адрес в адресную строку, браузер отправит запрос в ASP.NET Development Server файла. ASP.NET Development Server передает запрос в среду выполнения ASP.NET для обработки. Так как мы еще не выполнили вход, а `Web.config` в папке `PrivateDocs` настроены для запрета анонимного доступа, среда выполнения ASP.NET автоматически перенаправит нас на страницу входа, `Login.aspx` (см. рис. 3). При перенаправлении пользователя на страницу входа в ASP.NET включает параметр строки запроса `ReturnUrl`, указывающий страницу, которую пользователь пытался просмотреть. После успешного входа в систему пользователь может вернуться на эту страницу.

[![неавторизованные пользователи автоматически перенаправляются на страницу входа](core-differences-between-iis-and-the-asp-net-development-server-cs/_static/image8.png)](core-differences-between-iis-and-the-asp-net-development-server-cs/_static/image7.png)

**Рис. 3**. неавторизованные пользователи автоматически перенаправляются на страницу входа ([щелкните, чтобы просмотреть изображение с полным размером](core-differences-between-iis-and-the-asp-net-development-server-cs/_static/image9.png))

Теперь давайте посмотрим, как это работает в рабочей среде. Разверните приложение и введите прямой URL-адрес для одного из документов PDF в папке `PrivateDocs` в рабочей среде. В браузере будет предложено отправить запрос IIS для файла. Поскольку запрашивается статический файл, IIS извлекает и возвращает файл без вызова среды выполнения ASP.NET. В результате Проверка авторизации URL-адреса не выполнялась. содержимое действительно закрытого PDF-документа доступно всем, кто знает прямой URL-адрес файла.

[![анонимные пользователи могут загружать частные файлы PDF, вводя прямой URL-адрес файла.](core-differences-between-iis-and-the-asp-net-development-server-cs/_static/image11.png)](core-differences-between-iis-and-the-asp-net-development-server-cs/_static/image10.png)

**Рис. 4**. анонимные пользователи могут скачивать личные PDF-файлы, вводя прямой URL – адрес файла ([щелкните, чтобы просмотреть изображение с полным размером](core-differences-between-iis-and-the-asp-net-development-server-cs/_static/image12.png)).

### <a name="performing-forms-based-authentication-and-url-authentication-on-static-files-with-iis-7"></a>Выполнение проверки подлинности на основе форм и URL-адреса для статических файлов с IIS 7

Существует несколько приемов, которые можно использовать для защиты статического содержимого от неавторизованных пользователей. В IIS 7 появился *интегрированный конвейер*, сочетает рабочий процесс IIS с рабочим процессом среды выполнения ASP.NET. В двух словах, вы можете указать службам IIS вызывать модули проверки подлинности и авторизации среды выполнения ASP.NET все входящие запросы (включая статическое содержимое, например PDF-файлы). Обратитесь к поставщику веб-узла, чтобы узнать, как настроить веб-сайт для использования интегрированного конвейера.

После настройки IIS для использования интегрированного конвейера добавьте следующую разметку в файл `Web.config` в корневом каталоге:

[!code-xml[Main](core-differences-between-iis-and-the-asp-net-development-server-cs/samples/sample5.xml)]

Эта разметка указывает IIS 7 на использование модулей проверки подлинности и авторизации на основе ASP.NET. Повторно разверните приложение, а затем снова перейдите в PDF-файл. На этот раз, когда IIS обрабатывает запрос, он предоставляет логике проверки подлинности и авторизации среды выполнения ASP.NET возможность проверить запрос. Так как только пользователи, прошедшие проверку подлинности, авторизованы для просмотра содержимого в папке `PrivateDocs`, анонимный посетитель автоматически перенаправляется на страницу входа (см. рис. 3).

> [!NOTE]
> Если поставщик веб-узла все еще использует IIS 6, то нельзя использовать встроенную функцию конвейера. Одним из способов решения этой проблемы является помещение частных документов в папку, которая запрещает доступ по протоколу HTTP (например, `App_Data`), а затем создание страницы для обслуживания этих документов. Эта страница может называться `GetPDF.aspx`, и ей передается имя PDF-файла с помощью параметра QueryString. Страница `GetPDF.aspx` сначала проверит, имеет ли пользователь разрешение на просмотр файла, и, если да, будет использовать метод [`Response.WriteFile(filePath)`](https://msdn.microsoft.com/library/system.web.httpresponse.writefile.aspx) для отправки содержимого ЗАПРОШЕННОГО PDF-файла обратно запрашивающему клиенту. Этот метод также будет работать для IIS 7, если вы не хотите включать интегрированный конвейер.

## <a name="summary"></a>Сводка

Веб-приложения в рабочей среде размещаются с помощью программного обеспечения веб-сервера IIS корпорации Майкрософт. Однако в среде разработки приложение может размещаться с помощью служб IIS или ASP.NET Development Server. В идеале одно и то же программное обеспечение веб-сервера должно использоваться в обеих средах, поскольку использование разных программ добавляет другую переменную в набор. Однако простота использования ASP.NET Development Server делает его привлекательным выбором в среде разработки. Хорошая новость состоит в том, что существует лишь несколько фундаментальных различий между IIS и ASP.NET Development Server, и если вы осведомлены об этих различиях, можно предпринять действия по обеспечению работы приложения и работать точно так же, независимо от PXE.

Поздравляем с программированием!

### <a name="further-reading"></a>Дополнительные материалы

Дополнительные сведения о разделах, обсуждаемых в этом руководстве, см. в следующих ресурсах:

- [Интеграция ASP.NET с IIS 7,0](https://www.iis.net/learn/application-frameworks/building-and-running-aspnet-applications/aspnet-integration-with-iis)
- [Использование проверки подлинности на форумах ASP.NET со всеми типами содержимого в IIS 7](https://blogs.iis.net/bills/archive/2007/05/19/using-asp-net-forms-authentication-with-all-types-of-content-with-iis7-video.aspx) (видео)
- [Веб-серверы в Visual Web Developer](https://msdn.microsoft.com/library/58wxa9w5.aspx)

> [!div class="step-by-step"]
> [Назад](common-configuration-differences-between-development-and-production-cs.md)
> [Вперед](deploying-a-database-cs.md)
