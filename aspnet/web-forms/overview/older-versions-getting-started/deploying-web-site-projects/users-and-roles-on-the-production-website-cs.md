---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/users-and-roles-on-the-production-website-cs
title: Пользователи и роли на рабочем веб-сайте (C#) | Документация Майкрософт
author: rick-anderson
description: Средство администрирования веб-сайт ASP.NET (WSAT) веб-пользовательский интерфейс для настройки параметров членства и ролей, а также для создания, редактирования,...
ms.author: riande
ms.date: 06/09/2009
ms.assetid: dbc54313-5d05-4285-98b3-726edea6d0c9
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/users-and-roles-on-the-production-website-cs
msc.type: authoredcontent
ms.openlocfilehash: f08afe5f4ab379d1532f50267299892829c95dcc
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/01/2019
ms.locfileid: "57048851"
---
<a name="users-and-roles-on-the-production-website-c"></a>Пользователи и роли на рабочем веб-сайте (C#)
====================
по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Загрузить PDF-файл](http://download.microsoft.com/download/5/C/5/5C57DB8C-5DEA-4B3A-92CA-4405544D313B/aspnet_tutorial16_CustomAWAT_cs.pdf)

> Средство администрирования веб-сайт ASP.NET (WSAT) предоставляет пользовательский веб-интерфейс для настройки членства и ролей и создание, изменение и удаление пользователей и ролей. К сожалению WSAT работает только при посещении от localhost, это означает, что средство администрирования рабочий веб-сайт недоступен через браузер. Хорошая новость: существуют обходные пути, которые позволяют управлять пользователями и ролями в рабочей среде. Этот учебник рассматривает эти методы обхода проблемы и другие.


## <a name="introduction"></a>Вступление

ASP.NET 2.0 появился целый ряд *служб приложений*, которые представляют собой набор служб стандартных блоков, которые можно добавить в веб-приложение. Мы добавили службы членства и ролей на веб-сайт рецензий на книги обратно в [ *Настройка веб-сайт, использует службы приложений* руководстве](configuring-a-website-that-uses-application-services-cs.md). Службы членства упрощает создание и управление учетных записей пользователей; службы ролей есть API, распределение пользователей по группам. На сайте рецензий на книги имеет три учетные записи пользователей - Скотт, Цзисунь и Алиса - и одна роль, Admin, Скотт и Цзисунь в роли администратора.

ASP. NET приложения службы не привязаны к конкретной реализации. Вместо этого вы указываете службы приложений, чтобы использовать конкретную *поставщика*, и этот поставщик реализует службу с помощью определенной технологии. Мы настроили рецензий веб-приложении использование `SqlMembershipProvider` и `SqlRoleProvider` поставщиков членства и ролей служб. Эти два поставщика сохранения данных учетная запись и роль пользователя базы данных SQL Server и наиболее часто используемые поставщиками для веб-приложений, размещенных на веб-хостинга.

Управляет общей проблемой для разработчиков, использующих службы членства и ролей пользователей и ролей в рабочей среде. Как можно удалить учетную запись пользователя из рабочей веб-сайт, добавить новую роль или Добавление существующего пользователя в существующую роль? В этом руководстве рассматриваются различные методы для управления пользователями и ролями на рабочем веб-сайте.

## <a name="using-the-aspnet-web-site-administration-tool"></a>Средство администрирования веб-ASP.NET узла

ASP.NET включает в себя [Web Site Administration Tool](https://msdn.microsoft.com/library/yy40ytx0.aspx) (WSAT) который позволяет легко создавать и контролировать учетные записи пользователей и ролей и указать правила авторизации пользователей и ролей. Чтобы использовать WSAT, щелкните значок Конфигурация ASP.NET в обозревателе решений, или перейдите в меню веб-сайт или проект и выбрать параметр конфигурации ASP.NET. Любой из этих подходов запускает веб-браузер и пытается с его WSAT по адресу, например: `http://localhost:portNumber/asp.netwebadminfiles/default.aspx?applicationPhysicalPath=pathToApplication`

WSAT состоит из трех разделов:

- **Безопасность** -Управление пользователями, ролями и правила авторизации.
- **ApplicationConfiguration** -управление &lt;appSettings&gt; и параметры SMTP отсюда. Вы можно также перевести приложение в автономный режим и управлять параметры отсюда отладки и трассировки, а также указать значение по умолчанию пользовательскую страницу ошибки.
- **ProviderConfiguration** -Настройка поставщиков, используемых службами приложения.

Разделе «Безопасность» (показано в **рис.1**) ссылки правил доступа, создание новых пользователей, управление пользователями, создание и управление ролями и создание и управление. Здесь можно добавить новую роль в системе, удаление существующего пользователя, или добавить или удалить роли из учетной записи пользователя.

[![](users-and-roles-on-the-production-website-cs/_static/image2.png)](users-and-roles-on-the-production-website-cs/_static/image1.png)

**Рис. 1**: В разделе WSAT безопасности включает в себя параметры для управления пользователями и ролями  
([Просмотр полноразмерного изображения](users-and-roles-on-the-production-website-cs/_static/image3.png))

К сожалению WSAT доступно только локально. Не удается открывать WSAT на удаленный рабочий веб-сайте; Если вы посещаете `www.yoursite.com/asp.netwebadminfiles/default.aspx` отобразится ответ 404 не найдено. Код, который обеспечивает питание WSAT использует `Membership` и `Roles` классы в .NET Framework для создания, изменения и удаления пользователей и ролей. Эти классы можно найти сведения о конфигурации веб-приложения, чтобы определить, какой поставщик для использования; Вернитесь в [ *Настройка веб-сайт, использует службы приложений* руководстве](configuring-a-website-that-uses-application-services-cs.md) мы настраиваем рецензий веб-сайта по `SqlMembershipProvider` и `SqlRoleProvider` поставщиков. Это следующая добавление `<membership>` и `<roleManager>` разделы для `Web.config`.

[!code-xml[Main](users-and-roles-on-the-production-website-cs/samples/sample1.xml)]

Обратите внимание, что `<membership>` и `<roleManager>` разделы ссылку `SqlMembershipProvider` и `SqlRoleProvider` поставщиков в их `type` атрибут, соответственно. Эти поставщики сохранить пользователя и сведения о роли в указанной базе данных SQL Server. Базы данных, используемой этими поставщиками задается `connectionStringName` атрибут, `ReviewsConnectionString`, который определен в `~/ConfigSections/databaseConnectionStrings.config` файл. Помните, что `databaseConnectionStrings.config` файл в среде разработки содержит строку подключения к базе данных разработки, тогда как `databaseConnectionStrings.config` файл в рабочей среде содержит строку подключения к рабочей базе данных.

По сути, WSAT должен осуществляться локально через среду разработки и работы с данными пользователя и роли базы данных, указанной в `databaseConnectionStrings.config` файл. Следовательно Если изменить строку подключения в `databaseConnectionStrings.config` файл в среде разработки можно использовать WSAT локально для управления пользователями и ролями в рабочей среде.

Чтобы продемонстрировать эту функцию, откройте `databaseConnectionStrings.config` в Visual Studio в среде разработки и замените строку подключения базы данных разработки со строкой подключения рабочей базы данных. Затем запустите WSAT, перейдите на вкладку «Безопасность» и добавить нового пользователя с именем Sam с паролем «password»! (меньше кавычки). **Рис. 2** показан экран WSAT, при создании этой учетной записи.

[![](users-and-roles-on-the-production-website-cs/_static/image5.png)](users-and-roles-on-the-production-website-cs/_static/image4.png)

**Рис. 2**: Создайте нового пользователя с именем Sam в рабочей среде  
([Просмотр полноразмерного изображения](users-and-roles-on-the-production-website-cs/_static/image6.png))

Так как мы изменили строку подключения в `databaseConnectionStrings.config` для указания на рабочий сервер базы данных Sam, добавленная в качестве пользователя в рабочей среде. Чтобы проверить это, измените строку подключения в `databaseConnectionStrings.config` файл обратно в базу данных разработки, а затем перейдите `Login.aspx` страницы в среде разработки. Попробуйте выполнить вход как Sam (см. в разделе **рис. 3**).

[![](users-and-roles-on-the-production-website-cs/_static/image8.png)](users-and-roles-on-the-production-website-cs/_static/image7.png)

**Рис. 3**: Не удается войти в качестве Sam в среде разработки  
([Просмотр полноразмерного изображения](users-and-roles-on-the-production-website-cs/_static/image9.png))

Не удается войти в качестве Sam в среде разработки, так как учетная запись пользователя не существует в локальной базе данных. Вместо этого будет добавлен в производственной базе данных. Чтобы проверить это, просмотреть содержимое `aspnet_Users` таблицы в средах разработки, так и в рабочих базах данных. В среде разработки должен быть только три записи для пользователей, Скотт, Цзисунь и Алиса. Тем не менее `aspnet_Users` таблица рабочей базы данных содержит четыре записи: Скотт, Цзисунь, Алиса и Sam. Следовательно Sam могут входить через веб-сайт в рабочей среде, но не с помощью среды разработки.

[![](users-and-roles-on-the-production-website-cs/_static/image11.png)](users-and-roles-on-the-production-website-cs/_static/image10.png)

**Рис. 4**: SAM можно войти на рабочем веб-сайте  
([Просмотр полноразмерного изображения](users-and-roles-on-the-production-website-cs/_static/image12.png))

> [!NOTE]
> Не забудьте изменить строку подключения в `databaseConnectionStrings.config` файл обратно в базу данных разработки строка подключения после завершения работы с WSAT в противном случае вы будете работать с рабочими данными при тестировании на сайте через разработку Среда. Также имейте в виду, что методики, которую мы только что обсудили позволяет нам использовать WSAT для удаленного управления пользователями и ролями, изменения в любые другие WSAT конфигурации параметры (правила доступа, SMTP настройки, отладки и трассировки параметров и т. д.) изменение `Web.config` файл. Следовательно любые изменения, внесенные в параметры применимы к среде разработки, а не к рабочей среде.


## <a name="creating-custom-user-and-role-management-web-pages"></a>Создание настраиваемого пользовательского и роль управления веб-страниц

WSAT предоставляет готовую поле системы для управления пользователями и ролями, но может быть запущен только локально и требует внесения изменений в строку подключения для управления пользователями и ролями в рабочей среде. Большинство веб-сайтов, которые поддерживают учетные записи пользователей также включают ряд пользователей и роли администрирования веб-страниц, которые позволяют администраторам управлять пользователями и ролями из страниц на узле. Таких страниц веб-администрирования было гораздо проще управлять пользователями и ролями и крайне важны для сайтов, где это возможно, многие администраторы или Администраторы, у которых нет доступа к или техническими знаниями с помощью Visual Studio для запуска WSAT.

ASP.NET включает ряд встроенных относящихся ко входу веб-элементы управления, которые делают реализации многих из этих веб-страниц администрирования так же просто, как перетаскивание. Например можно создать страницу для администраторов создать учетную запись пользователя, перетащив элемент управления CreateUserWizard на страницу несколько свойств. На самом деле, на странице для создания пользователей в WSAT, показанный на **рис. 2** использует тот же элемент управления CreateUserWizard, который можно добавить на страницы. Кроме того, становятся доступны программным способом с помощью функции членства и ролей служб `Membership` и `Roles` классы в .NET Framework. Эти классы можно написать код для создания, изменение и удаление пользователей и ролей, а также добавлять или удалять пользователей в ролях, для определения пользователей в роли и выполнять другие задачи, связанные с пользователем и ролями.

В [ *Настройка веб-сайт, использует службы приложений* руководстве](configuring-a-website-that-uses-application-services-cs.md) я добавил страницу, чтобы `Admin` папку с именем `CreateAccount.aspx`. Эта страница позволяет администратору для добавления учетной записи пользователя к сайту и для указания того, является ли только что созданного пользователя в роли администратора (см. в разделе **рис. 5**).

[![](users-and-roles-on-the-production-website-cs/_static/image14.png)](users-and-roles-on-the-production-website-cs/_static/image13.png)

**Рис. 5**: Администраторы могут создавать новые учетные записи пользователей  
([Просмотр полноразмерного изображения](users-and-roles-on-the-production-website-cs/_static/image15.png))

Более подробное рассмотрение построения страниц администрирования пользователей и ролей, а также пошаговые инструкции по использованию `Membership` и `Roles` классы и связанные с входом ASP.NET веб-элементов управления, не забудьте прочитать Мой [безопасности веб-сайта Учебники по](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md). Вы найдете рекомендации по созданию веб-страниц для создания новых учетных записей, создание и управление ролями, назначения пользователям ролей и прочих обычных административных задач.

Для реализации функции типа WSAT на рабочем веб-сайте всегда можно разработать собственную серию веб-страниц, которые реализуют функции WSAT. Чтобы помочь приступить к работе, ознакомьтесь с WSAT исходный код, который находится в папке `%WINDIR%\Microsoft.NET\Framework\v2.0.50727\ASP.NETWebAdminFiles`. Другой вариант — использовать Дэн Clem WSAT альтернативного варианта делится в своей статье [последовательное свой собственный Web Site Administration Tool](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx). Дэн проходит читателя через процесс создания пользовательского средства наподобие WSAT, включает исходный код своего приложения для загрузки (в C#) и предоставляет пошаговые инструкции по добавлению его пользовательские WSAT размещенного веб-сайт.

## <a name="summary"></a>Сводка

Средство администрирования веб-сайт ASP.NET (WSAT) можно использовать вместе со службами приложений членства и ролей для управления информацией пользователя и роли для веб-сайта. К сожалению WSAT доступен только локально и не может быть посещен с веб-сайта в рабочей среде. Тем не менее, изменив строку подключения в разработке среды, чтобы он указывал на производственную базу данных можно использовать WSAT для управления пользователями и ролями на рабочем веб-сайте.

Хотя этот подход WSAT данных позволяет быстро и легко управлять пользователями и ролями, требует не только запуск WSAT из Visual Studio, а также внесения временных изменений к данным строки подключения. WSAT предоставляет быстрый способ управления пользователями и ролями в рабочей среде, но неудобно и подходит для веб-сайтов, с помощью нескольких администраторов или администраторов, которые не имеют или не знакомы с Visual Studio и WSAT. По этим причинам большинство веб-сайтов, которые поддерживают учетные записи пользователей содержат набор веб-страниц администрирования. Такой набор веб-страниц избавляет WSAT и использовать различные пользователями с правами администратора на любом компьютере.

Счастливого вам программирования!

### <a name="further-reading"></a>Дополнительные сведения

Дополнительные сведения по темам, обсуждавшимся в этом руководстве см. в следующих ресурсах:

- [Проверка ASP. NET членства, ролей и профиля](http://aspnet.4guysfromrolla.com/articles/120705-1.aspx)
- [Развертывание собственного средства администрирования веб-сайта](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx)
- [Обзор средства администрирования веб-сайта](https://msdn.microsoft.com/library/yy40ytx0.aspx)
- [Учебники по безопасности веб-сайта](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)

> [!div class="step-by-step"]
> [Назад](precompiling-your-website-cs.md)
> [Вперед](asp-net-hosting-options-vb.md)
