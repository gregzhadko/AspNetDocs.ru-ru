---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/configuring-the-production-web-application-to-use-the-production-database-cs
title: Настройка веб-приложение для использования рабочей базы данных (C#) | Документация Майкрософт
author: rick-anderson
description: Как уже обсуждалось в предыдущих учебных курсах, нередко различия между средами разработки и эксплуатации сведения о конфигурации. Это es...
ms.author: riande
ms.date: 04/23/2009
ms.assetid: 0177dabd-d888-449f-91b2-24190cf5e842
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/configuring-the-production-web-application-to-use-the-production-database-cs
msc.type: authoredcontent
ms.openlocfilehash: e2560ae7a845c27f7fa5f420eaf1d89618397c60
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/01/2019
ms.locfileid: "57056741"
---
<a name="configuring-the-production-web-application-to-use-the-production-database-c"></a>Настройка рабочего веб-приложения для использования рабочей базы данных (C#)
====================
по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Скачать код](http://download.microsoft.com/download/E/6/F/E6FE3A1F-EE3A-4119-989A-33D1A9F6F6DD/ASPNET_Hosting_Tutorial_08_CS.zip) или [скачать PDF](http://download.microsoft.com/download/C/3/9/C391A649-B357-4A7B-BAA4-48C96871FEA6/aspnet_tutorial08_DBConfig_cs.pdf)

> Как уже обсуждалось в предыдущих учебных курсах, нередко различия между средами разработки и эксплуатации сведения о конфигурации. Это особенно верно для управляемых данными веб-приложений, как строки подключения базы данных отличаются между средами разработки и эксплуатации. В этом руководстве рассматриваются способы настройки рабочей среде для включения соответствующей строкой подключения более подробно.


## <a name="introduction"></a>Вступление

Управляемые данными веб-приложения обычно использовать другую базу данных в разработку, чем когда в рабочей среде. Для приложений, расположенных на поставщике веб-размещения и разработанных локально в базу данных разработки обычно размещается на компьютере s разработчика а рабочей базы данных размещается на сервере базы данных в веб-размещения помещению s компании. Развертывание управляемых данными веб-приложения включает в себя копирование базы данных разработки на рабочий сервер базы данных. В предыдущем учебном курсе мы рассмотрели способы выполнения этого шага.

Веб-приложение использует эти сведения в *строку подключения* для установления соединения с базой данных. Строка подключения, которая обычно хранится в `Web.config`, указывает имя сервера базы данных, имя базы данных, контекст безопасности и другие сведения. Так как база данных, используемая для веб-приложения зависит от того, выполняется ли веб-приложения в средах разработки или рабочей среде, строки подключения различается между двумя средами.

Он не будет разным в средах разработки и эксплуатации сведения о конфигурации. *Распространенные конфигурации различия между разработки и эксплуатации* руководстве обсуждаются методики для обслуживания сведений о конфигурации между этих двух средах, а также краткое описание на строки подключения базы данных. В этом руководстве рассматриваются способы настройки рабочей среде для включения соответствующей строкой подключения более подробно.

## <a name="examining-the-connection-string-information"></a>Изучив сведения строки подключения

Строка подключения, используемая веб-приложением рецензий на книги хранится в файле конфигурации приложения s `Web.config`. `Web.config` включает в себя специальный раздел для хранения строки подключения, соответствующее имя [ &lt;connectionStrings&gt;](https://msdn.microsoft.com/library/bf7sd233.aspx). `Web.config` -Файле для веб-сайта рецензий одну строку соединения, заданные в этом разделе с именем `ReviewsConnectionString`:

[!code-xml[Main](configuring-the-production-web-application-to-use-the-production-database-cs/samples/sample1.xml)]

Строка подключения - источник данных =. \SQLEXPRESS; AttachDbFilename = | DataDirectory|\Reviews.mdf;Integrated Security = True; User Instance = True — состоит из числа возможностей и значения, с помощью пары "параметр значение", разделенных точкой с запятой и каждого параметра и значение, разделенные знаком равенства. Ниже приведены четыре параметры, используемые в этой строке подключения.

- `Data Source` — Указывает расположение сервера базы данных и имя экземпляра сервера базы данных (если таковые имеются). Значение, `.\SQLEXPRESS`, является примером там, где есть сервер базы данных и имя экземпляра. Период указывает, что сервер базы данных на том же компьютере, что и приложение; Имя экземпляра должно `SQLEXPRESS`.
- `AttachDbFilename` — Указывает расположение файла базы данных. Значение содержит заполнитель `|DataDirectory|`, который разрешается в полное приложение s `App_Data` папку во время выполнения.
- `Integrated Security` — Логическое значение, указывающее, следует ли использовать указанного имени пользователя и пароля при подключении к базе данных (false) или текущего Windows учетные данные учетной записи (true).
- `User Instance` — параметр конфигурации, относящиеся к выпусков SQL Server Express, указывающее, следует ли разрешить пользователям без прав администратора на локальном компьютере, присоединяться и подключаться к базе данных SQL Server Express Edition. См. в разделе [Express пользовательские экземпляры SQL Server](https://msdn.microsoft.com/library/ms254504.aspx) Дополнительные сведения об этом параметре.
  

Параметры строки подключения допустимый зависят от базы данных, к которому вы подключаетесь и используемого поставщика базы данных ADO.NET. Например строка подключения для подключения к Microsoft SQL Server базы данных отличается от, используемый для подключения к базе данных Oracle. Аналогично подключению к базе данных Microsoft SQL Server, с помощью поставщика SqlClient использует другую строку подключения, чем при использовании поставщика OLE DB.

Можно создать строку подключения базы данных вручную с помощью сайта, например [ConnectionStrings.com](http://www.connectionstrings.com/) как к ресурсу, какие варианты доступны. Однако это более простой подход — добавить базу данных в проводник по серверам в Visual Studio и затем, чтобы скопировать строку подключения из окна свойств. Позвольте s использовать этот второй прием для создания строки подключения к серверу рабочей базы данных.

Откройте Visual Studio и перейдите в окно обозревателя сервера (в Visual Web Developer, это окно называется обозреватель баз данных). Щелкните правой кнопкой мыши на параметр подключения к данным и выберите параметр Добавить подключение в контекстном меню. Откроется мастер, показанный на рис. 1. Выберите необходимый источник данных и нажмите кнопку Продолжить.


[![Выберите Добавить новую базу данных в проводник по серверам](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image2.jpg)](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image1.jpg) 

**Рис. 1**: Выберите Добавить новую базу данных в проводник по серверам ([Просмотр полноразмерного изображения](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image3.jpg))


Затем укажите различных базы данных сведения о подключении (см. рис. 2). Если вы зарегистрировались с помощью веб-хостинга компанию, они должны предоставлять сведения о том, как подключиться к базе данных — имя сервера базы данных, имя базы данных, имя пользователя и пароль, используемый для соединения с базой данных и т. д. После ввода этой информации нажмите кнопку ОК для завершения работы мастера и добавления базы данных в проводник по серверам.


[![Укажите подключение к базе данных](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image5.jpg)](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image4.jpg) 

**Рис. 2**: Укажите подключение к базе данных ([Просмотр полноразмерного изображения](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image6.jpg))


Среда рабочей базы данных должны появиться в обозревателе серверов. Выберите базу данных из обозревателя сервера и перейдите в окно свойств. Там вы найдете свойство с именем строки подключения строкой подключения s базы данных. При условии, что вы используете базу данных Microsoft SQL Server в рабочей среде и Поставщик SqlClient строки подключения должен выглядеть следующим образом:

<strong>Источник данных =<em>serverName</em>; Начальный каталог =<em>databaseName</em>; Persist Security Info = True; Идентификатор пользователя =<em>username</em>; Пароль =*пароль</strong>*

Где *serverName*, *databaseName*, *username*, и *пароль* являются значениями, имя сервера базы данных, базы данных имя и имя пользователя и пароль, Предъявляемый компании веб узла.

## <a name="deploying-the-book-reviews-web-application"></a>Развертывание веб-приложения проверки книги

Предыдущем учебном курсе были рассмотрены копирование базы данных разработки в рабочую среду, но не было изучение, развертывание приложения, управляемые данными. На этом этапе в рабочей среде содержит базу данных, но использует версию книги рассматривает приложения с помощью статических проверок. Нам нужно развернуть новый, управляемые данными приложения на рабочем сервере, а также обновленную конфигурацию.

Отвлекитесь и развернуть управляемое данными приложение из среды разработки в рабочую среду. Этот процесс был подробно рассматривается в предыдущих учебных курсах. Если вы хотите освежить, см. в разделе *развертывание веб-сайта, с помощью FTP-клиент* или *развертывание ваш веб-сайт с помощью Visual Studio* учебники. Необходимо будет убедитесь, что строкой подключения рабочей базы данных от применяемой в рабочей среде, это означает, что альтернативный `Web.config` файл должен быть развернут. В частности, это изменить `Web.config` файл s `<connectionStrings>` элемент должен содержать строкой подключения рабочей базы данных и должен выглядеть следующим образом:

[!code-xml[Main](configuring-the-production-web-application-to-use-the-production-database-cs/samples/sample2.xml)]

Обратите внимание, что строка соединения в `<connectionStrings>` элемента совпадает с именем (`ReviewsConnectionString`), но теперь содержит строкой подключения рабочей базы данных вместо строки подключения базы данных разработки.

Если у вас нет более Формализованная рабочий процесс развертывания, либо вручную изменить `Web.config` файл, используемый строкой подключения рабочей базы данных перед развертыванием (не забудьте восстановить его с помощью строки подключения базы данных разработки После этого) или поддерживать отдельные `Web.config` файл с информацией о конфигурации рабочей среды, который загружается в рабочую среду как часть процесса развертывания.

> [!NOTE]
> Если вы случайно развернуть `Web.config` файла, содержащего строку подключения базы данных разработки, то произойдет ошибка при попытке соединиться с базой данных приложения в рабочей среде. Эта ошибка объявляется в качестве `SqlException` с сообщение, что сервер не найден или недоступен.


После развертывания сайта в рабочей среде, посетите на рабочем сайте через браузер. Следует см. в разделе и наслаждайтесь подобное удобство работы как при локальном запуске приложения, управляемые данными. Само собой при посещении веб-сайта в рабочей среде сайт основан на рабочий сервер базы данных, тогда как посетить веб-сайт в среде разработки используется база данных в разработке. Рис. 3 показан *обучение самостоятельно ASP.NET 3.5 за 24 часа* просмотрите страницу с веб-сайта в рабочей среде (Обратите внимание, URL-адрес в адресной строке браузера s).


[![Управляемые данными приложения — теперь доступны в рабочей среде!](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image8.jpg)](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image7.jpg) 

**Рис. 3**: Управляемые данными приложения — теперь доступны в рабочей среде! ([Просмотр полноразмерного изображения](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image9.jpg))


### <a name="storing-connection-strings-in-a-separate-configuration-file"></a>Хранение строк подключений в отдельный файл конфигурации

Является общим приемом для сведения о конфигурации для сред разработки и эксплуатации две версии `Web.config`: один для среды разработки и один для рабочей среды. Во время развертывания соответствующий `Web.config` версии можно скопировать в рабочую среду. В идеале этот процесс будет автоматизировать как часть рабочего процесса развертывания.

Вместо сохранения два отдельных `Web.config` файлы, возможно, при необходимости, предоставляют более детализированные различия. Элементы, составляющие `Web.config` файла могут быть определены в внешних файлов конфигурации, которые будут использоваться далее в `Web.config` файл. В двух словах можно иметь один `Web.config` -файле для обеих сред, на которые ссылается файл databaseConnectionStrings.config, который будет содержать строки подключения используется приложением и должен быть уникальным для каждой среды. Найти что отделение различные сведения о конфигурации в отдельные файлы обеспечивает более аккуратными и проще `Web.config` выделяет различия конфигурации между средами разработки и рабочих файлов и многое другое.

Использовать этот прием, начните с создания новой папки в веб-приложение с именем `ConfigSections`. Добавьте два файла в эту новую папку с именем databaseConnectionStrings.dev.config и databaseConnectionStrings.production.config. Затем скопируйте `<connectionStrings>` элемент из `Web.config` databaseConnectionStrings.dev.config и databaseConnectionStrings.production.config файлы, а затем изменить строку подключения в databaseConnectionStrings.production.config файла, чтобы она строкой подключения рабочей базы данных. Например, файл databaseConnectionStrings.dev.config должен содержать только `<connectionStrings>` элемент со строкой подключения, разработки базы данных:

[!code-xml[Main](configuring-the-production-web-application-to-use-the-production-database-cs/samples/sample3.xml)]

Аналогичным образом файл databaseConnectionStrings.production.config должен содержать только `<connectionStrings>` элемент, но со значением строкой подключения рабочей базы данных.

Создайте копию файла databaseConnectionStrings.dev.config и назовите его databaseConnectionStrings.config.

> [!NOTE]
> Вы можете назовите файл конфигурации отличные от databaseConnectionStrings.config, если d, такие как `connectionStrings.config` или `dbInfo.config`. Тем не менее, убедитесь, что имя файла с `.config` расширение как `.config` файлы по умолчанию не предоставляются обработчиком ASP.NET. Если вы используете имя файла, что-то еще, например `connectionStrings.txt`, пользователь может указывать браузер, чтобы [www.yoursite.com/ConfigSettings/connectionStrings.txt](http://www.yoursite.com/ConfigSettings/connectionStrings.txt) и просмотреть содержимое файла!


На этом этапе `ConfigSections` папка должна содержать три файла (см. рис. 4). Файлы databaseConnectionStrings.dev.config и databaseConnectionStrings.production.config содержат строки подключения для сред разработки и эксплуатации, соответственно. Файл databaseConnectionStrings.config содержит строку подключения, который будет использоваться для веб-приложения во время выполнения. Следовательно databaseConnectionStrings.config файл должен быть идентичен databaseConnectionStrings.dev.config файл в среде разработки, тогда как на рабочих databaseConnectionStrings.config файл должен быть идентичен databaseConnectionStrings.production.config.


[![ConfigSections](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image11.jpg)](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image10.jpg) 

**Рис. 4**: ConfigSections ([Просмотр полноразмерного изображения](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image12.jpg))


Теперь нам нужно указать `Web.config` для использования файла databaseConnectionStrings.config для его хранилища строк подключения. Откройте файл `Web.config` и замените существующий элемент `<connectionStrings>` следующим кодом:

[!code-xml[Main](configuring-the-production-web-application-to-use-the-production-database-cs/samples/sample4.xml)]

`configSource` Атрибут указывает физический путь относительно `Web.config` файл. Если внешние `.config` файл находится в той же папке, что `Web.config` затем атрибуту присваивается имя файла `.config` файл. Если он в подкаталоге, как в случае с databaseConnectionStrings.config, определяют с помощью обратной косой черты в качестве разделителя имен файлов и папок, например ConfigSections\databaseConnectionStrings.config во вложенную папку.

Этого изменения в средах разработки и эксплуатации содержат одинаковые `Web.config` файл. Теперь единственным различием является файл databaseConnectionStrings.config. Скопируйте файл databaseConnectionStrings.production.config в рабочей среде и переименуйте его в databaseConnectionStrings.config. Если в будущем, были внесены изменения строкой подключения рабочей базы данных необходимо будет внести их в файл databaseConnectionStrings.production.config и затем отправить этот файл в рабочую среду, его переименованием databaseConnectionStrings.config.

> [!NOTE]
> Можно указать сведения для любого `Web.config` элемента в отдельный файл и использовать `configSource` атрибут для ссылки на этот файл изнутри `Web.config`.


## <a name="summary"></a>Сводка

Управляемые данными приложения обычно использовать разные базы данных в средах разработки и эксплуатации. Следовательно строк подключения базы данных, хранящихся в конфигурации веб-приложений s должно быть уникальным в каждой среде. В этом учебнике мы рассмотрели определение строкой подключения рабочей базы данных и способы обеспечить уникальный строку подключения в двух средах.

Счастливого вам программирования!

#### <a name="further-reading"></a>Дополнительные сведения

Дополнительные сведения по темам, обсуждавшимся в этом руководстве см. в следующих ресурсах:

- [Строки подключения и файлы конфигурации](https://msdn.microsoft.com/library/ms254494.aspx)
- [Сведения о @ ConnectionStrings.com строки конфигурации базы данных](http://www.connectionstrings.com/)
- [Параметры можно вывести из файла Web.config](http://www.asp101.com/tips/index.asp?id=154)
- [Техническая документация по &lt;connectionStrings&gt; элемент](https://msdn.microsoft.com/library/bf7sd233.aspx)

> [!div class="step-by-step"]
> [Назад](deploying-a-database-cs.md)
> [Вперед](configuring-a-website-that-uses-application-services-cs.md)
