---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/displaying-a-custom-error-page-cs
title: Отображение страницы пользовательской ошибки (C#) | Документация Майкрософт
author: rick-anderson
description: Пользователь видят при возникновении ошибки среды выполнения в веб-приложения ASP.NET? Ответ зависит от веб сайта &lt;customErrors&gt; конфигурации...
ms.author: riande
ms.date: 06/09/2009
ms.assetid: cb061642-faf3-41b2-9372-69e13444d458
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/displaying-a-custom-error-page-cs
msc.type: authoredcontent
ms.openlocfilehash: 2b84b4e0f57bdddb83fc79494b66be76edcad664
ms.sourcegitcommit: dd0dc556a3d99a31d8fdbc763e9a2e53f3441b70
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/27/2019
ms.locfileid: "67411005"
---
# <a name="displaying-a-custom-error-page-c"></a>Отображение страницы пользовательской ошибки (C#)

по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Скачать код](http://download.microsoft.com/download/1/0/C/10CC829F-A808-4302-97D3-59989B8F9C01/ASPNET_Hosting_Tutorial_11_CS.zip) или [скачать PDF](http://download.microsoft.com/download/5/C/5/5C57DB8C-5DEA-4B3A-92CA-4405544D313B/aspnet_tutorial11_CustomErrors_cs.pdf)

> Пользователь видят при возникновении ошибки среды выполнения в веб-приложения ASP.NET? Ответ зависит от веб сайта &lt;customErrors&gt; конфигурации. По умолчанию пользователи отображаются родительной желтый экрана, proclaiming, что произошла ошибка среды выполнения. Этом руководстве показано, как настроить эти параметры отображения красоту приятная пользовательскую страницу ошибки, соответствующий вид веб сайта.

## <a name="introduction"></a>Вступление

В идеальном мире будет без ошибок времени выполнения. Программисты написать код с n-арных объектов ошибки и с помощью надежной проверки ввода данных и внешние ресурсы, такие как серверы баз данных и электронной почты никогда не будет перейти в автономный режим. Конечно на самом деле неизбежны ошибки. Классы в .NET Framework сообщения об ошибке, создается исключение. Например метод Open для объекта вызова объекта SqlConnection устанавливает подключение к базе данных, указанной строкой подключения. Тем не менее, если базы данных не работает или недопустимые учетные данные в строке подключения метод Open создаст `SqlException`. Исключения могут обрабатываться с помощью `try/catch/finally` блоков. Если код в `try` блок вызывает исключение, управление передается блоку catch соответствующие, где разработчик может пытаться восстановиться после ошибки. Если нет соответствующего блока catch, или если код, который вызвал исключение не находится в блоке try, исключение percolates вверх по стеку вызовов search из `try/catch/finally` блоков.

Если исключение поднимается вплоть до среды выполнения ASP.NET без обработки, [ `HttpApplication` класс](https://msdn.microsoft.com/library/system.web.httpapplication.aspx) [ `Error` событий](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx) возникает и настроенный *страницу ошибки*  отображается. По умолчанию ASP.NET отображаются на странице ошибки с Нежно называется [желтый экрана смерти](http://en.wikipedia.org/wiki/Yellow_Screen_of_Death#Yellow) (YSOD). Существуют две версии YSOD: один показывает сведения об исключении, трассировку стека и другие сведения полезны для разработчиков, отладку приложения (см. в разделе **рис.1**); другой просто утверждает, что произошла ошибка во время выполнения (см.  **Рис. 2**).

Сведения об исключении YSOD весьма полезна для разработчиков, отладку приложения, но отображение YSOD конечным пользователям невзрачное и непрофессионально. Вместо этого пользователям следует принимать на страницу ошибки, поддерживающий внешний вид веб-узла с более удобные прозой описываете ситуацию. Хорошей новостью является создание таких на пользовательскую страницу ошибки довольно просто. Этот учебник начинается со взгляда на ASP. Страницы NET различных ошибок. Затем показано, как настроить веб-приложение для отображения пользователей на пользовательскую страницу ошибки при возникновении ошибки.

### <a name="examining-the-three-types-of-error-pages"></a>Изучение три вида страницы ошибок

Если возникает необработанное исключение в приложении ASP.NET, один из трех видов страницы ошибок отображается:

- Исключение сведения желтый экрана из смерти страницы ошибки
- Страницы ошибки среды выполнения ошибка желтый экрана из смерти или
- На пользовательскую страницу ошибки

Разработчики страниц ошибок, знакомые с YSOD сведения об исключении. По умолчанию эта страница отображается для пользователей, которые посещают локально и таким образом — это страница, который появляется при возникновении ошибки во время тестирования на сайте в среде разработки. Как понятно из названия, YSOD подробности исключения предоставляет сведения об исключении - тип, сообщение и трассировка стека. Более того Если исключение было вызвано код в классе фонового кода страницы ASP.NET, и если приложение настроено для отладки YSOD подробности исключения также будет показано эту строку кода (и несколько строк кода выше и ниже).

**Рис. 1** показана страница YSOD сведения об исключении. Запишите URL-адрес в адрес браузера: `http://localhost:62275/Genre.aspx?ID=foo`. Помните, что `Genre.aspx` странице перечислены обзоры книг определенного жанра. Для нее необходимо выполнение `GenreId` значение ( `uniqueidentifier`) нужно передать строку запроса; приведен пример, соответствующий URL-адрес, чтобы просмотреть обзоры художественной `Genre.aspx?ID=7683ab5d-4589-4f03-a139-1c26044d0146`. Если не`uniqueidentifier` значение передается в через строку запроса (например, «foo») создается исключение.

> [!NOTE]
> Воспроизведение ошибки в демонстрационное веб-приложение можно загрузить вы можете открыть страницу `Genre.aspx?ID=foo` напрямую или щелкните ссылку «Создать ошибка среды выполнения» в `Default.aspx`.

Обратите внимание, сведения об исключении, представленные в **рис.1**. Сообщение об исключении, «ошибка при преобразовании строки символов в тип uniqueidentifier» находится в верхней части страницы. Тип исключения, `System.Data.SqlClient.SqlException`, присутствует в списке, а также. Также показана трассировка стека.

[![](displaying-a-custom-error-page-cs/_static/image2.png)](displaying-a-custom-error-page-cs/_static/image1.png)

**Рис. 1**: Сведения об исключении YSOD включает в себя сведения об исключении  
 ([Просмотр полноразмерного изображения](displaying-a-custom-error-page-cs/_static/image3.png))

Другие виды YSOD YSOD ошибка среды выполнения и отображается в **рис. 2**. YSOD ошибка среды выполнения сообщает посетитель, который произошла ошибка во время выполнения, но не включает все сведения об исключении, вызванное исключение. (Тем не менее предоставляют инструкции о том, как сделать можно просмотреть сведения об ошибке, изменив `Web.config` файл, который входит в том, что делает такие YSOD выглядеть непрофессионально.)

По умолчанию YSOD ошибка среды выполнения отображается для пользователей, посетив удаленно (через http://www.yoursite.com), о чем свидетельствуют URL-адрес в адресной строке браузера в **рис. 2**: `http://httpruntime.web703.discountasp.net/Genre.aspx?ID=foo`. Существуют две различные экраны YSOD, поскольку разработчики, хочет знать, сведения об ошибке, но такая информация не должна присутствовать на действующем сайте, как она может выявить потенциальные уязвимости системы безопасности или другой конфиденциальной информацией, всем, кто посещает вашей веб-узел.

> [!NOTE]
> Если кто Усвоил материал и при использовании в качестве работы веб-узла компании DiscountASP.NET, вы можете заметить, что YSOD ошибка среды выполнения не отображаются при просмотре на действующем сайте. Это обусловлено компании DiscountASP.NET имеет свои серверы, настроенные для отображения YSOD подробности исключения по умолчанию. Хорошая новость состоит в том, что это поведение по умолчанию можно переопределить, добавив `<customErrors>` раздел вашей `Web.config` файл. В разделе «Настройка которой ошибка откроется страница» проверяет `<customErrors>` раздел подробно.

[![](displaying-a-custom-error-page-cs/_static/image5.png)](displaying-a-custom-error-page-cs/_static/image4.png)

**Рис. 2**: Ошибка времени выполнения YSOD не включает все сведения об ошибке  
 ([Просмотр полноразмерного изображения](displaying-a-custom-error-page-cs/_static/image6.png))

Третий тип страницы ошибок — пользовательскую страницу ошибки, который является веб-страницы, созданной. Преимущество на пользовательскую страницу ошибки заключается в том, что вы получаете полный контроль над информацией, который отображается для пользователя, а также внешний вид страницы; пользовательскую страницу ошибки можно использовать одну главную страницу и стили, как другие страницы. В разделе «Использование пользовательские страницы ошибок» описывается создание на пользовательскую страницу ошибки и настроить его для отображения в случае необработанного исключения. **Рис. 3** предлагает конферениций части этой страницы настраиваемых ошибок. Как вы видите, внешний вид страницы ошибки является гораздо более профессионально выглядящие отличную от желтый экраны из смертью показано на рисунках 1 и 2.

[![](displaying-a-custom-error-page-cs/_static/image8.png)](displaying-a-custom-error-page-cs/_static/image7.png)

**Рис. 3**: На пользовательскую страницу ошибки предлагает более специализированных внешнего вида и поведения  
 ([Просмотр полноразмерного изображения](displaying-a-custom-error-page-cs/_static/image9.png))

Отвлекитесь и проверьте адресную строку браузера в **рис. 3**. Обратите внимание, что в адресной строке указывается URL-адрес пользовательскую страницу ошибки (`/ErrorPages/Oops.aspx`). На рисунках 1 и 2 желтый экраны смерти отображаются на этой же странице, являющийся источником ошибки (`Genre.aspx`). Пользовательскую страницу ошибки передается URL-адрес страницы, где произошла ошибка с помощью `aspxerrorpath` параметр строки запроса.

## <a name="configuring-which-error-page-is-displayed"></a>Настройка страницы ошибки которого отображается

Какой из трех возможных ошибок страниц отображается основана на двух переменных:

- Сведения о конфигурации в `<customErrors>` разделе и
- Ли пользователь посещает сайт локально или удаленно.

[ `<customErrors>` Разделе](https://msdn.microsoft.com/library/h0hfz6fc.aspx) в `Web.config` имеет два атрибута, которые влияют на какой странице ошибка отображается: `defaultRedirect` и `mode`. Атрибут `defaultRedirect` является необязательным. Если предоставляется, он указывает URL-адрес пользовательскую страницу ошибки и указывает, что вместо YSOD ошибка среды выполнения должен отображаться пользовательскую страницу ошибки. `mode` Атрибут является обязательным и принимает одно из трех значений: `On`, `Off`, или `RemoteOnly`. Эти значения имеют следующие особенности:

- `On` — Указывает, что пользовательскую страницу ошибки или YSOD ошибка среды выполнения отображается для всех посетителей, независимо от того, являются ли они локальными или удаленными.
- `Off` — Указывает, что YSOD сведения об исключении отображаются для всех посетителей, независимо от того, являются ли они локальными или удаленными.
- `RemoteOnly` — Указывает, что пользовательскую страницу ошибки или YSOD ошибка среды выполнения отображается для удаленного посетителей, хотя YSOD сведения об исключении отображается локальный посетителям.

Если не указано обратное, ASP.NET действует так, будто устанавливают атрибут режима `RemoteOnly` и не был указан `defaultRedirect` значение. Другими словами по умолчанию выполняется отображение YSOD подробности исключения локального посетителям хотя YSOD ошибка среды выполнения отображается для удаленного посетителей. Это поведение по умолчанию можно переопределить, добавив `<customErrors>` раздел в веб-приложение `Web.config file.`

## <a name="using-a-custom-error-page"></a>С помощью на пользовательскую страницу ошибки

Каждый веб-приложении должен быть на пользовательскую страницу ошибки. Он является альтернативой более профессионально YSOD ошибка среды выполнения, его можно легко создать и настройка приложения для использования пользовательскую страницу ошибки только через несколько мгновений. Первым шагом является создание пользовательскую страницу ошибки. Я добавил новую папку с именем приложению рецензий `ErrorPages` и добавить новую страницу ASP.NET с именем `Oops.aspx`. У страницы использовать одну главную страницу как остальная часть страницы узла, чтобы она автоматически наследует с оформлением.

[![](displaying-a-custom-error-page-cs/_static/image11.png)](displaying-a-custom-error-page-cs/_static/image10.png)

**Рис. 4**: Создайте на пользовательскую страницу ошибки

Далее Потратьте несколько минут, создание содержимого для страницы ошибки. Я создал на довольно простой пользовательскую страницу ошибки с сообщение о том, что произошла непредвиденная ошибка, и обратной ссылки на домашнюю страницу веб-узла.

[![](displaying-a-custom-error-page-cs/_static/image13.png)](displaying-a-custom-error-page-cs/_static/image12.png)

**Рис. 5**: Проектирование на пользовательскую страницу ошибки  
 ([Просмотр полноразмерного изображения](displaying-a-custom-error-page-cs/_static/image14.png))

Страницы ошибок, завершено настройте веб-приложение, чтобы использовать пользовательскую страницу ошибки вместо YSOD ошибка среды выполнения. Это достигается путем указания URL-адрес страницы ошибки в `<customErrors>` раздела `defaultRedirect` атрибута. Добавьте следующую разметку в приложение `Web.config` файла:

[!code-xml[Main](displaying-a-custom-error-page-cs/samples/sample1.xml)]

Приведенная выше разметка настраивает приложение для отображения YSOD подробности исключения для посетителей локально, используя пользовательскую страницу ошибки Oops.aspx для тех пользователей, посетив удаленно. Чтобы увидеть это в действии, разверните веб-сайт в рабочей среде и перейдите на страницу Genre.aspx на действующем сайте со значением недопустимые строки запроса. Вы должны увидеть страницу пользовательской ошибки (вернуться к **рис. 3**).

Чтобы убедиться, что пользовательскую страницу ошибки отображается только для удаленных пользователей, посетите `Genre.aspx` страница с недопустимые строки запроса, из среды разработки. Вы по-прежнему должны увидеть YSOD подробности исключения (вернуться к **рис.1**). `RemoteOnly` Параметр гарантирует, что пользователи, посещающие сайта в рабочей среде см. в разделе пользовательскую страницу ошибки пока разработчики, работающие локально продолжают подробные сведения об исключении.

## <a name="notifying-developers-and-logging-error-details"></a>Уведомление разработчиков и записи сведений об ошибках

Ошибки, возникающие в среде разработки были вызваны на своем компьютере разработчика. Она показывается сведения об исключении в YSOD подробности исключения, и она знает, какие действия, она во время возникновения ошибки. Однако при возникновении ошибки в рабочей среде, разработчик может не знает, что произошла ошибка, если конечный пользователь узле потратит время на отчет об ошибке. И даже если пользователь выходит за пределы своей способ предупреждения разработчиков, произошла ошибка, не зная тип исключения, сообщение и трассировка стека, он может быть трудно диагностировать причину ошибки, не говоря уже об ее устранению.

По этим причинам это первостепенное значение, что любая ошибка в рабочей среде регистрируется в постоянном хранилище (например, в базе данных) и что разработчики знают об этой ошибки. Пользовательскую страницу ошибки может показаться лучше всего сделать это ведение журнала и уведомления. К сожалению пользовательскую страницу ошибки не имеет доступа, сведения об ошибке и таким образом, не может использоваться для входа эту информацию. Хорошая новость — существует несколько способов для перехвата сведения об ошибке и регистрировать их, что в этом разделе более подробно изучить трех следующих руководствах.

## <a name="using-different-custom-error-pages-for-different-http-error-statuses"></a>С помощью различных настраиваемые страницы ошибок для состояния ошибки HTTP

Когда исключение генерируется страницей ASP.NET и не обрабатывается, до среды выполнения ASP.NET, который выведет страницу настроенных percolates исключение. Если запрос поступает в подсистему ASP.NET, но не может обрабатываться по некоторым причинам — возможно запрошенный файл не найден или не читать разрешения отключены для файла -, а затем вызывает механизм ASP.NET `HttpException`. Это исключение, например исключения, вызванные из страницы ASP.NET, поднимается среды выполнения, соответствующее сообщение об ошибке страницы для отображения.

Для веб-приложения в рабочей среде это значит, что если пользователь запрашивает страницу, которая не найден, то он увидит пользовательскую страницу ошибки. **Рис. 6** показан такой пример. Так как запрашивается страница не существует (`NoSuchPage.aspx`), `HttpException` возникает исключение и пользовательскую страницу ошибки отображается (Обратите внимание на ссылку, чтобы `NoSuchPage.aspx` в `aspxerrorpath` параметр строки запроса).

[![](displaying-a-custom-error-page-cs/_static/image16.png)](displaying-a-custom-error-page-cs/_static/image15.png)

**Рис. 6**: Среда выполнения ASP.NET отображает настройки страницы в ответ на ошибку недопустимый запрос ([Просмотр полноразмерного изображения](displaying-a-custom-error-page-cs/_static/image17.png))

По умолчанию все типы ошибок вызывают же пользовательскую страницу ошибки для отображения. Тем не менее, можно указать на разных пользовательскую страницу ошибки для определенных HTTP состояние кода с использованием `<error>` дочерние элементы в пределах `<customErrors>` раздел. Например, другую ошибку страницы, в случае страницы, не найдены ошибки, которая содержит код состояния HTTP 404, обновить `<customErrors>` раздел, посвященный следующую разметку:

[!code-xml[Main](displaying-a-custom-error-page-cs/samples/sample2.xml)]

После этого изменения на месте при каждом посещении удаленно пользователь запрашивает ресурс ASP.NET, который не существует, он будет перенаправлен к `404.aspx` пользовательскую страницу ошибки вместо `Oops.aspx`. Как **рис. 7** иллюстрирует, `404.aspx` страница может содержать более конкретные сообщения, чем общие пользовательскую страницу ошибки.

> [!NOTE]
> Ознакомьтесь с [страницы ошибок 404, один раз более](http://www.smashingmagazine.com/2009/01/29/404-error-pages-one-more-time/) рекомендации по созданию эффективной страницы ошибок 404.

[![](displaying-a-custom-error-page-cs/_static/image19.png)](displaying-a-custom-error-page-cs/_static/image18.png)

**Рис. 7**: Чем точнее сообщение отображается страница ошибки 404 с помощью пользовательской `Oops.aspx`  
([Просмотр полноразмерного изображения](displaying-a-custom-error-page-cs/_static/image20.png)) 

Так как вы знаете, что `404.aspx` страницы достигается только в том случае, если пользователь запрашивает страницу, которая не найдена, можно улучшить данную страницу для включения функции, чтобы помочь пользователю устранить этот особого типа ошибки. Например, можно создавать таблицу базы данных, которая сопоставляет известно неправильный URL-адреса, хороший URL-адреса и затем `404.aspx` пользовательскую страницу ошибки выполните запрос к таблице и предложить страниц, пользователь может пытаться связаться.

> [!NOTE]
> Пользовательскую страницу ошибки отображается только в том случае, когда выполняется запрос к ресурсу, обрабатывается обработчиком ASP.NET. Как уже говорилось в [основные различия между IIS и ASP.NET Development Server](core-differences-between-iis-and-the-asp-net-development-server-cs.md) руководства, веб-сервер может обрабатывать определенные запросы сам. По умолчанию IIS веб-сервер обрабатывает запросы для статического содержимого, такие как изображения и файлы HTML без вызова ядро ASP.NET. Следовательно Если пользователь запрашивает файл образа несуществующие они получат обратно сообщение об ошибке 404 IIS по умолчанию, а не ASP. NET настроить страницу ошибки.

## <a name="summary"></a>Сводка

При возникновении необработанного исключения в приложении ASP.NET, то пользователю будет показано одно из трех страниц ошибок: исключение сведения желтый экрана из смертью; Ошибка времени выполнения желтый экраном смерти; или на пользовательскую страницу ошибки. Ошибка-страница зависит от приложения `<customErrors>` конфигурации и ли пользователь использует локально или удаленно. Поведение по умолчанию — Показать YSOD подробности исключения для локального посетителей и YSOD ошибка среды выполнения для удаленного посетителей.

Хотя YSOD ошибка среды выполнения скрывает конфиденциальные сведения от пользователя на узле, он прерывается из веб сайта внешним видом и делает вид коляска приложения. Лучшим подходом является использование на пользовательскую страницу ошибки, который влечет за собой создание и проектирование пользовательскую страницу ошибки и указав его URL-адрес в `<customErrors>` раздела `defaultRedirect` атрибута. Вы получаете несколько настраиваемые страницы ошибок для различных состояний ошибок HTTP.

Пользовательскую страницу ошибки является первым шагом в комплексную стратегию для веб-сайта в рабочей среде ошибок. Оповещения, чтобы разработчик ошибки и ведения журнала сведения о нем также являются важные действия. Следующие три руководствах рассматриваются методы уведомления об ошибках и ведение журнала.

Счастливого вам программирования!

### <a name="further-reading"></a>Дополнительные сведения

Дополнительные сведения по темам, обсуждавшимся в этом руководстве см. в следующих ресурсах:

- [Страницы ошибок, еще раз](http://www.smashingmagazine.com/2009/01/29/404-error-pages-one-more-time/)
- [Правила разработки исключений](https://msdn.microsoft.com/library/ms229014.aspx)
- [Страницы ошибок понятное](http://aspnet.4guysfromrolla.com/articles/090606-1.aspx)
- [Обработка и создание исключений](https://msdn.microsoft.com/library/5b2yeyab.aspx)
- [Надлежащим образом, используя настраиваемые страницы ошибок в ASP.NET](http://professionalaspnet.com/archive/2007/09/30/Properly-Using-Custom-Error-Pages-in-ASP.NET.aspx)

> [!div class="step-by-step"]
> [Назад](strategies-for-database-development-and-deployment-cs.md)
> [Вперед](processing-unhandled-exceptions-cs.md)
