---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/logging-error-details-with-asp-net-health-monitoring-cs
title: Записи сведений об ошибках с помощью ASP.NET Health Monitoring (C#) | Документация Майкрософт
author: rick-anderson
description: Система наблюдения за работоспособностью корпорации Майкрософт предоставляет простой и настраиваемый способ входа различных веб-события, включая необработанных исключений. В этом учебнике должен быть...
ms.author: riande
ms.date: 06/09/2009
ms.assetid: b1abb452-642a-4ff3-8504-37b85590ff79
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/logging-error-details-with-asp-net-health-monitoring-cs
msc.type: authoredcontent
ms.openlocfilehash: 52b1aec577634dfb9fec7753e4f9b8bf46d159f0
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/09/2019
ms.locfileid: "59416264"
---
# <a name="logging-error-details-with-aspnet-health-monitoring-c"></a><span data-ttu-id="6226e-104">Запись в журнал сведений об ошибках с помощью наблюдения за состоянием системы ASP.NET (C#)</span><span class="sxs-lookup"><span data-stu-id="6226e-104">Logging Error Details with ASP.NET Health Monitoring (C#)</span></span>

<span data-ttu-id="6226e-105">по [Скотт Митчелл](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="6226e-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="6226e-106">[Скачать код](http://download.microsoft.com/download/1/0/C/10CC829F-A808-4302-97D3-59989B8F9C01/ASPNET_Hosting_Tutorial_13_CS.zip) или [скачать PDF](http://download.microsoft.com/download/5/C/5/5C57DB8C-5DEA-4B3A-92CA-4405544D313B/aspnet_tutorial13_HealthMonitoring_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="6226e-106">[Download Code](http://download.microsoft.com/download/1/0/C/10CC829F-A808-4302-97D3-59989B8F9C01/ASPNET_Hosting_Tutorial_13_CS.zip) or [Download PDF](http://download.microsoft.com/download/5/C/5/5C57DB8C-5DEA-4B3A-92CA-4405544D313B/aspnet_tutorial13_HealthMonitoring_cs.pdf)</span></span>

> <span data-ttu-id="6226e-107">Система наблюдения за работоспособностью корпорации Майкрософт предоставляет простой и настраиваемый способ входа различных веб-события, включая необработанных исключений.</span><span class="sxs-lookup"><span data-stu-id="6226e-107">Microsoft's health monitoring system provides an easy and customizable way to log various web events, including unhandled exceptions.</span></span> <span data-ttu-id="6226e-108">Этом руководстве описаны шаги по настройке система наблюдения за работоспособностью для журнала необработанных исключений в базу данных и для уведомления разработчиков через сообщение электронной почты.</span><span class="sxs-lookup"><span data-stu-id="6226e-108">This tutorial walks through setting up the health monitoring system to log unhandled exceptions to a database and to notify developers via an email message.</span></span>


## <a name="introduction"></a><span data-ttu-id="6226e-109">Вступление</span><span class="sxs-lookup"><span data-stu-id="6226e-109">Introduction</span></span>

<span data-ttu-id="6226e-110">Ведение журнала является удобным инструментом для мониторинга работоспособности развернутого приложения, а также для диагностики проблем, которые могут возникнуть.</span><span class="sxs-lookup"><span data-stu-id="6226e-110">Logging is a useful tool for monitoring the health of a deployed application and for diagnosing any problems that may arise.</span></span> <span data-ttu-id="6226e-111">Это особенно важно для ведения журнала ошибок, возникающих в развернутом приложении, таким образом, чтобы их можно исправить.</span><span class="sxs-lookup"><span data-stu-id="6226e-111">It is especially important to log errors that occur in a deployed application so that they can be remedied.</span></span> <span data-ttu-id="6226e-112">`Error` Событие вызывается при возникновении необработанного исключения в приложении ASP.NET; [предыдущем учебном курсе](processing-unhandled-exceptions-cs.md) было показано, как можно уведомить разработчик ошибки и журналов сведения о нем, Создание обработчика событий для `Error` событий.</span><span class="sxs-lookup"><span data-stu-id="6226e-112">The `Error` event is raised whenever an unhandled exception occurs in an ASP.NET application; the [preceding tutorial](processing-unhandled-exceptions-cs.md) showed how to notify a developer of an error and log its details by creating an event handler for the `Error` event.</span></span> <span data-ttu-id="6226e-113">Тем не менее, создание `Error` обработчик событий в журнал сведения об ошибке, а также отправлять уведомления разработчик необязателен, так как эта задача может выполняться по ASP. NET *система наблюдения за работоспособностью*.</span><span class="sxs-lookup"><span data-stu-id="6226e-113">However, creating an `Error` event handler to log the error's details and notify a developer is unnecessary, as this task can be performed by ASP.NET's *health monitoring system*.</span></span>

<span data-ttu-id="6226e-114">Система наблюдения за работоспособностью появилась в ASP.NET 2.0 и предназначен для мониторинга работоспособности развернутого приложения ASP.NET с помощью записи событий, возникающих во время приложения или время существования запроса.</span><span class="sxs-lookup"><span data-stu-id="6226e-114">The health monitoring system was introduced in ASP.NET 2.0 and is designed to monitor the health of a deployed ASP.NET application by logging events that occur during the application or request's lifetime.</span></span> <span data-ttu-id="6226e-115">События в журнале, система наблюдения за работоспособностью, называются *событий мониторинга состояния* или *веб-события*и включают:</span><span class="sxs-lookup"><span data-stu-id="6226e-115">The events logged by the health monitoring system are referred to as *health monitoring events* or *Web events*, and include:</span></span>

- <span data-ttu-id="6226e-116">События времени существования приложения, например когда приложение запускает или останавливает</span><span class="sxs-lookup"><span data-stu-id="6226e-116">Application lifetime events, such as when an application starts or stops</span></span>
- <span data-ttu-id="6226e-117">События безопасности, включая неудачных попыток входа и невыполненные запросы авторизации URL-адрес</span><span class="sxs-lookup"><span data-stu-id="6226e-117">Security events, including failed login attempts and failed URL authorization requests</span></span>
- <span data-ttu-id="6226e-118">Ошибки приложений, включая необработанные исключения, состояние представления синтаксический анализ исключений, запрос проверки исключений и ошибок компиляции, помимо других типов ошибок.</span><span class="sxs-lookup"><span data-stu-id="6226e-118">Application errors, including unhandled exceptions, view state parsing exceptions, request validation exceptions, and compilation errors, among other types of errors.</span></span>

<span data-ttu-id="6226e-119">При возникновении события мониторинга работоспособности его можно записать в любое количество указанного *журнала источников*.</span><span class="sxs-lookup"><span data-stu-id="6226e-119">When a health monitoring event is raised it can be logged to any number of specified *log sources*.</span></span> <span data-ttu-id="6226e-120">Система наблюдения за работоспособностью поставляется с источники журналов, которые входят веб-события в базу данных Microsoft SQL Server, или через сообщение электронной почты, среди прочего в журнале событий Windows.</span><span class="sxs-lookup"><span data-stu-id="6226e-120">The health monitoring system ships with log sources that log Web events to a Microsoft SQL Server database, to the Windows Event Log, or via an email message, among others.</span></span> <span data-ttu-id="6226e-121">Можно также создать свои собственные источники журналов.</span><span class="sxs-lookup"><span data-stu-id="6226e-121">You can also create your own log sources.</span></span>

<span data-ttu-id="6226e-122">События, журналы система наблюдения за работоспособностью, а также источники журналов, которые использовали, определены в `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="6226e-122">The events the health monitoring system logs, along with the log sources used, are defined in `Web.config`.</span></span> <span data-ttu-id="6226e-123">Всего несколько строк конфигурации разметки можно использовать мониторинг для входа в базу данных все необработанные исключения и сообщить исключения по электронной почте.</span><span class="sxs-lookup"><span data-stu-id="6226e-123">With a few lines of configuration markup you can use health monitoring to log all unhandled exceptions to a database and to notify you of the exception via email.</span></span>

## <a name="exploring-the-health-monitoring-systems-configuration"></a><span data-ttu-id="6226e-124">Изучение системы мониторинга работоспособности</span><span class="sxs-lookup"><span data-stu-id="6226e-124">Exploring the Health Monitoring System's Configuration</span></span>

<span data-ttu-id="6226e-125">Поведение системы мониторинга работоспособности определяется сведения о конфигурации, который находится в [ `<healthMonitoring>` элемент](https://msdn.microsoft.com/library/2fwh2ss9.aspx) в `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="6226e-125">The health monitoring system's behavior is defined by its configuration information, which is located in the [`<healthMonitoring>` element](https://msdn.microsoft.com/library/2fwh2ss9.aspx) in `Web.config`.</span></span> <span data-ttu-id="6226e-126">Этот раздел конфигурации определяет, помимо прочего, следующие три важных элемента информации:</span><span class="sxs-lookup"><span data-stu-id="6226e-126">This configuration section defines, among other things, the following three important pieces of information:</span></span>

1. <span data-ttu-id="6226e-127">Наблюдение за событиями работоспособности, когда возникло, следует записывать в журнал</span><span class="sxs-lookup"><span data-stu-id="6226e-127">The health monitoring events that, when raised, should be logged,</span></span>
2. <span data-ttu-id="6226e-128">Источники журналов, и</span><span class="sxs-lookup"><span data-stu-id="6226e-128">The log sources, and</span></span>
3. <span data-ttu-id="6226e-129">Сопоставление каждого события, определенные в (1) мониторинга состояния источники журналов, определенные в (2).</span><span class="sxs-lookup"><span data-stu-id="6226e-129">How each health monitoring event defined in (1) is mapped to the log sources defined in (2).</span></span>

<span data-ttu-id="6226e-130">Эта информация указывается с помощью тремя дочерними элементами конфигурации: [ `<eventMappings>` ](https://msdn.microsoft.com/library/yc5yk01w.aspx), [ `<providers>` ](https://msdn.microsoft.com/library/zaa41kz1.aspx), и [ `<rules>` ](https://msdn.microsoft.com/library/fe5wyxa0.aspx), соответственно.</span><span class="sxs-lookup"><span data-stu-id="6226e-130">This information is specified through three children configuration elements: [`<eventMappings>`](https://msdn.microsoft.com/library/yc5yk01w.aspx), [`<providers>`](https://msdn.microsoft.com/library/zaa41kz1.aspx), and [`<rules>`](https://msdn.microsoft.com/library/fe5wyxa0.aspx), respectively.</span></span>

<span data-ttu-id="6226e-131">Сведения о конфигурации системы мониторинга работоспособности по умолчанию можно найти в `Web.config` файл `%WINDIR%\Microsoft.NET\Framework\version\CONFIG` папки.</span><span class="sxs-lookup"><span data-stu-id="6226e-131">The default health monitoring system configuration information can be found in the `Web.config` file in `%WINDIR%\Microsoft.NET\Framework\version\CONFIG` folder.</span></span> <span data-ttu-id="6226e-132">Сведений о конфигурации по умолчанию, некоторые разметкой, удалены для краткости, показан ниже:</span><span class="sxs-lookup"><span data-stu-id="6226e-132">This default configuration information, with some markup removed for brevity, is shown below:</span></span>

[!code-xml[Main](logging-error-details-with-asp-net-health-monitoring-cs/samples/sample1.xml)]

<span data-ttu-id="6226e-133">Работоспособность интерес для мониторинга событий определяются в `<eventMappings>` элемент, который предоставляет имя понятном для класса событий мониторинга работоспособности.</span><span class="sxs-lookup"><span data-stu-id="6226e-133">The health monitoring events of interest are defined in the `<eventMappings>` element, which gives a human-friendly name to a class of health monitoring events.</span></span> <span data-ttu-id="6226e-134">В разметке выше `<eventMappings>` элемент присваивает имя понятном «Все ошибки» для мониторинга событий типа работоспособности `WebBaseErrorEvent` и имя «сбоев аудита» для мониторинга событий типа работоспособности `WebFailureAuditEvent`.</span><span class="sxs-lookup"><span data-stu-id="6226e-134">In the markup above, the `<eventMappings>` element assigns the human-friendly name "All Errors" to the health monitoring events of type `WebBaseErrorEvent` and the name "Failure Audits" to health monitoring events of type `WebFailureAuditEvent`.</span></span>

<span data-ttu-id="6226e-135">`<providers>` Элемент определяет источники журналов, присваивая имен понятном и указав все сведения о конфигурации зависящие от источника журнала.</span><span class="sxs-lookup"><span data-stu-id="6226e-135">The `<providers>` element defines the log sources, giving them a human-friendly name and specifying any log source-specific configuration information.</span></span> <span data-ttu-id="6226e-136">Первый `<add>` элемент определяет поставщика «EventLogProvider», который заносит в журнал мониторинга событий с помощью указанного состояния `EventLogWebEventProvider` класса.</span><span class="sxs-lookup"><span data-stu-id="6226e-136">The first `<add>` element defines the "EventLogProvider" provider, which logs the specified health monitoring events using the `EventLogWebEventProvider` class.</span></span> <span data-ttu-id="6226e-137">`EventLogWebEventProvider` Класс регистрирует событие в журнале событий Windows.</span><span class="sxs-lookup"><span data-stu-id="6226e-137">The `EventLogWebEventProvider` class logs the event to the Windows Event Log.</span></span> <span data-ttu-id="6226e-138">Второй `<add>` элемент определяет поставщика «SqlWebEventProvider», который записывает события в базе данных Microsoft SQL Server через `SqlWebEventProvider` класса.</span><span class="sxs-lookup"><span data-stu-id="6226e-138">The second `<add>` element defines the "SqlWebEventProvider" provider, which logs events to a Microsoft SQL Server database via the `SqlWebEventProvider` class.</span></span> <span data-ttu-id="6226e-139">Конфигурация «SqlWebEventProvider» указывает строку подключения базы данных (`connectionStringName`) среди других параметров конфигурации.</span><span class="sxs-lookup"><span data-stu-id="6226e-139">The "SqlWebEventProvider" configuration specifies the database's connection string (`connectionStringName`) among other configuration options.</span></span>

<span data-ttu-id="6226e-140">`<rules>` Сопоставляет события, заданные параметром `<eventMappings>` элемент вход источников `<providers>` элемент.</span><span class="sxs-lookup"><span data-stu-id="6226e-140">The `<rules>` element maps the events specified in the `<eventMappings>` element to log sources in the `<providers>` element.</span></span> <span data-ttu-id="6226e-141">По умолчанию веб-приложений ASP.NET, регистрировать все необработанные исключения и аудита сбоев в журнале событий Windows.</span><span class="sxs-lookup"><span data-stu-id="6226e-141">By default, ASP.NET web applications log all unhandled exceptions and audit failures to the Windows Event Log.</span></span>

## <a name="logging-events-to-a-database"></a><span data-ttu-id="6226e-142">События ведения журнала в базе данных</span><span class="sxs-lookup"><span data-stu-id="6226e-142">Logging Events to a Database</span></span>

<span data-ttu-id="6226e-143">Конфигурации по умолчанию системы мониторинга работоспособности можно настроить на основе приложений с веб-приложения web, добавив `<healthMonitoring>` раздел, чтобы приложения `Web.config` файл.</span><span class="sxs-lookup"><span data-stu-id="6226e-143">The health monitoring system's default configuration can be customized on a web application-by-web application basis by adding a `<healthMonitoring>` section to the application's `Web.config` file.</span></span> <span data-ttu-id="6226e-144">Можно включить дополнительные элементы в `<eventMappings>`, `<providers>`, и `<rules>` разделы с помощью `<add>` элемент.</span><span class="sxs-lookup"><span data-stu-id="6226e-144">You can include additional elements in the `<eventMappings>`, `<providers>`, and `<rules>` sections by using the `<add>` element.</span></span> <span data-ttu-id="6226e-145">Для удаления параметров с использованием конфигурации по умолчанию `<remove>` элемент, или используйте `<clear />` для удаления всех значений по умолчанию из одного из этих разделов.</span><span class="sxs-lookup"><span data-stu-id="6226e-145">To remove a setting from the default configuration use the `<remove>` element, or use `<clear />` to remove all default values from one of these sections.</span></span> <span data-ttu-id="6226e-146">Давайте настроим рецензий веб-приложения в журнал всех необработанных исключений в базе данных Microsoft SQL Server с помощью `SqlWebEventProvider` класса.</span><span class="sxs-lookup"><span data-stu-id="6226e-146">Let's configure the Book Reviews web application to log all unhandled exceptions to a Microsoft SQL Server database using the `SqlWebEventProvider` class.</span></span>

<span data-ttu-id="6226e-147">`SqlWebEventProvider` Класс является частью система наблюдения за работоспособностью и записывает события в указанную базу данных SQL Server мониторинга состояния.</span><span class="sxs-lookup"><span data-stu-id="6226e-147">The `SqlWebEventProvider` class is part of the health monitoring system and logs a health monitoring event to a specified SQL Server database.</span></span> <span data-ttu-id="6226e-148">`SqlWebEventProvider` Класс ожидает, что указанная база данных содержит хранимую процедуру с именем `aspnet_WebEvent_LogEvent`.</span><span class="sxs-lookup"><span data-stu-id="6226e-148">The `SqlWebEventProvider` class expects that the specified database includes a stored procedure named `aspnet_WebEvent_LogEvent`.</span></span> <span data-ttu-id="6226e-149">Эта хранимая процедура передается сведения о событии и является поставили задачу сохранять сведения о событии.</span><span class="sxs-lookup"><span data-stu-id="6226e-149">This stored procedure is passed the details of the event and is tasked with storing the event details.</span></span> <span data-ttu-id="6226e-150">Хорошо то, что не нужно создавать Эта хранимая процедура, ни таблицы для хранения сведений о событии.</span><span class="sxs-lookup"><span data-stu-id="6226e-150">The good news is that you do not need to create this stored procedure nor the table to store the event details.</span></span> <span data-ttu-id="6226e-151">Эти объекты можно добавить базу данных с помощью `aspnet_regsql.exe` средство.</span><span class="sxs-lookup"><span data-stu-id="6226e-151">You can add these objects to your database using the `aspnet_regsql.exe` tool.</span></span>

> [!NOTE]
> <span data-ttu-id="6226e-152">`aspnet_regsql.exe` Средства, которые обсуждались в [ *Настройка веб-сайт, использует службы приложений* руководстве](configuring-a-website-that-uses-application-services-cs.md) когда мы добавили поддержку для ASP. Службы приложений NET.</span><span class="sxs-lookup"><span data-stu-id="6226e-152">The `aspnet_regsql.exe` tool was discussed back in the [*Configuring a Website That Uses Application Services* tutorial](configuring-a-website-that-uses-application-services-cs.md) when we added support for ASP.NET's application services.</span></span> <span data-ttu-id="6226e-153">Следовательно, веб-сайт рецензий база данных уже содержит `aspnet_WebEvent_LogEvent` хранимые процедуры, которая сохраняет информацию о событиях в таблицу с именем `aspnet_WebEvent_Events`.</span><span class="sxs-lookup"><span data-stu-id="6226e-153">Consequently, the Book Reviews website's database already contains the `aspnet_WebEvent_LogEvent` stored procedure, which stores the event information into a table named `aspnet_WebEvent_Events`.</span></span>


<span data-ttu-id="6226e-154">Получив необходимые хранимая процедура и таблица добавлена в базу данных, остается только для указания работоспособности, мониторинга, чтобы регистрировать все необработанные исключения в базу данных.</span><span class="sxs-lookup"><span data-stu-id="6226e-154">Once you have the necessary stored procedure and table added to your database, all that remains is to instruct health monitoring to log all unhandled exceptions to the database.</span></span> <span data-ttu-id="6226e-155">Это сделать, добавив следующую разметку на веб-сайт `Web.config` файла:</span><span class="sxs-lookup"><span data-stu-id="6226e-155">Accomplish this by adding the following markup to your website's `Web.config` file:</span></span>

[!code-xml[Main](logging-error-details-with-asp-net-health-monitoring-cs/samples/sample2.xml)]

<span data-ttu-id="6226e-156">Мониторинг разметку настройки выше используется `<clear />` элементы для очистки мониторинга сведений о конфигурации из предварительно определенных работоспособности `<eventMappings>`, `<providers>`, и `<rules>` разделы.</span><span class="sxs-lookup"><span data-stu-id="6226e-156">The health monitoring configuration markup above uses `<clear />` elements to wipe the pre-defined health monitoring configuration information from the `<eventMappings>`, `<providers>`, and `<rules>` sections.</span></span> <span data-ttu-id="6226e-157">Затем добавляется одна запись для каждого из этих разделов.</span><span class="sxs-lookup"><span data-stu-id="6226e-157">It then adds a single entry to each of these sections.</span></span>

- <span data-ttu-id="6226e-158">`<eventMappings>` Элемент определяет работоспособности выполняется один с именем «Все ошибки», которое происходит всякий раз, когда необработанное исключение происходит определенное событие.</span><span class="sxs-lookup"><span data-stu-id="6226e-158">The `<eventMappings>` element defines a single health monitoring event of interest named "All Errors", which is raised whenever an unhandled exception occurs.</span></span>
- <span data-ttu-id="6226e-159">`<providers>` Элемент определяет источник одного журнала с именем «SqlWebEventProvider», который использует `SqlWebEventProvider` класса.</span><span class="sxs-lookup"><span data-stu-id="6226e-159">The `<providers>` element defines a single log source named "SqlWebEventProvider" that uses the `SqlWebEventProvider` class.</span></span> <span data-ttu-id="6226e-160">`connectionStringName` Установлен атрибут «ReviewsConnectionString», которое является именем подключения строке, заданной в `<connectionStrings>` разделе.</span><span class="sxs-lookup"><span data-stu-id="6226e-160">The `connectionStringName` attribute has been set to "ReviewsConnectionString", which is the name of our connection string defined in the `<connectionStrings>` section.</span></span>
- <span data-ttu-id="6226e-161">Наконец &lt;правила&gt; элемент указывает, когда событие «Все ошибки» процесс, который он занесение с помощью поставщика «SqlWebEventProvider».</span><span class="sxs-lookup"><span data-stu-id="6226e-161">Finally, the &lt;rules&gt; element indicates that when an "All Errors" event transpires that it should be logged using the "SqlWebEventProvider" provider.</span></span>

<span data-ttu-id="6226e-162">Эти сведения конфигурации указывает, что в системе, чтобы регистрировать все необработанные исключения в базу данных рецензий мониторинга состояния.</span><span class="sxs-lookup"><span data-stu-id="6226e-162">This configuration information instructs the health monitoring system to log all unhandled exceptions to the Book Reviews database.</span></span>

> [!NOTE]
> <span data-ttu-id="6226e-163">`WebBaseErrorEvent` Событие создается только для ошибок сервера; оно не возникает ошибок HTTP, например запрос для ресурса ASP.NET, который не найден.</span><span class="sxs-lookup"><span data-stu-id="6226e-163">The `WebBaseErrorEvent` event is only raised for server errors; it is not raised for HTTP errors, such as a request for an ASP.NET resource that is not found.</span></span> <span data-ttu-id="6226e-164">Это отличается от поведения `HttpApplication` класса `Error` события, которое вызывается для сервера и ошибки HTTP.</span><span class="sxs-lookup"><span data-stu-id="6226e-164">This differs from the behavior of the `HttpApplication` class's `Error` event, which is raised for both server and HTTP errors.</span></span>


<span data-ttu-id="6226e-165">Для просмотра в системе в действии мониторинга состояния, на веб-узле и создать ошибку во время выполнения, посетив `Genre.aspx?ID=foo`.</span><span class="sxs-lookup"><span data-stu-id="6226e-165">To see the health monitoring system in action, visit the website and generate a runtime error by visiting `Genre.aspx?ID=foo`.</span></span> <span data-ttu-id="6226e-166">Вы увидите соответствующее сообщение об ошибке страницы - исключение сведения желтый экрана из смертью (при посещении локально) или пользовательскую страницу ошибки (при посещении сайта в рабочей среде).</span><span class="sxs-lookup"><span data-stu-id="6226e-166">You should see the appropriate error page - either the Exception Details Yellow Screen of Death (when visiting locally) or the custom error page (when visiting the site in production).</span></span> <span data-ttu-id="6226e-167">На самом деле система наблюдения за работоспособностью в журнал сведения об ошибке в базу данных.</span><span class="sxs-lookup"><span data-stu-id="6226e-167">Behind the scenes, the health monitoring system logged the error information to the database.</span></span> <span data-ttu-id="6226e-168">Должна существовать одна запись в `aspnet_WebEvent_Events` таблицы (см. в разделе **рис.1**); эта запись содержит сведения об ошибке среды выполнения, которая только что была выполнена.</span><span class="sxs-lookup"><span data-stu-id="6226e-168">There should be one record in the `aspnet_WebEvent_Events` table (see **Figure 1**); this record contains information about the runtime error that just occurred.</span></span>

[![](logging-error-details-with-asp-net-health-monitoring-cs/_static/image2.png)](logging-error-details-with-asp-net-health-monitoring-cs/_static/image1.png)

<span data-ttu-id="6226e-169">**Рис. 1**: Сведения об ошибке были зарегистрированы в журнале для `aspnet_WebEvent_Events` таблицы</span><span class="sxs-lookup"><span data-stu-id="6226e-169">**Figure 1**: The Error Details Were Logged to the `aspnet_WebEvent_Events` Table</span></span>  
<span data-ttu-id="6226e-170">([Просмотр полноразмерного изображения](logging-error-details-with-asp-net-health-monitoring-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="6226e-170">([Click to view full-size image](logging-error-details-with-asp-net-health-monitoring-cs/_static/image3.png))</span></span>

### <a name="displaying-the-error-log-in-a-web-page"></a><span data-ttu-id="6226e-171">Отображение журнала ошибок в веб-страницы</span><span class="sxs-lookup"><span data-stu-id="6226e-171">Displaying the Error Log In a Web Page</span></span>

<span data-ttu-id="6226e-172">Текущая конфигурация веб сайта система наблюдения за работоспособностью входит все необработанные исключения в базу данных.</span><span class="sxs-lookup"><span data-stu-id="6226e-172">With the website's current configuration, the health monitoring system logs all unhandled exceptions to the database.</span></span> <span data-ttu-id="6226e-173">Тем не менее наблюдение за работоспособностью предоставляет механизм для просмотра журнала ошибок через веб-страницы.</span><span class="sxs-lookup"><span data-stu-id="6226e-173">However, health monitoring does not provide any mechanism to view the error log through a web page.</span></span> <span data-ttu-id="6226e-174">Тем не менее можно создать страницу ASP.NET, отображения этой информации из базы данных.</span><span class="sxs-lookup"><span data-stu-id="6226e-174">However, you could build an ASP.NET page that displays this information from the database.</span></span> <span data-ttu-id="6226e-175">(Как мы увидим моментально, вы можете иметь сведения об ошибке, отправленном вам по электронной почте.)</span><span class="sxs-lookup"><span data-stu-id="6226e-175">(As we'll see momentarily, you can opt to have the error details sent to you in an email message.)</span></span>

<span data-ttu-id="6226e-176">При создании такой страницы, убедитесь, что выполнить действия, чтобы разрешить только авторизованные пользователи просмотреть сведения об ошибке.</span><span class="sxs-lookup"><span data-stu-id="6226e-176">If you create such a page, make sure you take steps to allow only authorized users to view the error details.</span></span> <span data-ttu-id="6226e-177">Если сайт уже использует учетные записи пользователей можно использовать правила авторизации URL-адрес для ограничения доступа к странице для определенных пользователей или ролей.</span><span class="sxs-lookup"><span data-stu-id="6226e-177">If your site already employs user accounts then you can use URL authorization rules to restrict access to the page to certain users or roles.</span></span> <span data-ttu-id="6226e-178">Дополнительные сведения о том, как предоставить или ограничить доступ к веб-страниц, в зависимости от вошедшего в систему пользователя см. Мой [учебники по безопасности веб-сайт](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span><span class="sxs-lookup"><span data-stu-id="6226e-178">For more information on how to grant or restrict access to web pages based on the logged in user, refer to my [Website Security Tutorials](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span></span>

> [!NOTE]
> <span data-ttu-id="6226e-179">Последующие руководства рассматриваются альтернативные Ошибка ведения журнала и уведомления систему с именем ELMAH.</span><span class="sxs-lookup"><span data-stu-id="6226e-179">The subsequent tutorial explores an alternative error logging and notification system named ELMAH.</span></span> <span data-ttu-id="6226e-180">ELMAH включает встроенный механизм для просмотра журнала ошибок на страницу веб- и как RSS-канала.</span><span class="sxs-lookup"><span data-stu-id="6226e-180">ELMAH includes a built-in mechanism to view the error log from both a web page and as an RSS feed.</span></span>


## <a name="logging-events-to-email"></a><span data-ttu-id="6226e-181">Ведение журнала событий на адрес электронной почты</span><span class="sxs-lookup"><span data-stu-id="6226e-181">Logging Events to Email</span></span>

<span data-ttu-id="6226e-182">Система наблюдения за работоспособностью включает регистратор источника, «журналы» события в сообщение электронной почты.</span><span class="sxs-lookup"><span data-stu-id="6226e-182">The health monitoring system includes a log source provider that "logs" an event to an email message.</span></span> <span data-ttu-id="6226e-183">Источник журнала включает в себя те же сведения, которые регистрируются в базе данных в теле сообщения электронной почты.</span><span class="sxs-lookup"><span data-stu-id="6226e-183">The log source includes the same information that is logged to the database in the email message body.</span></span> <span data-ttu-id="6226e-184">Этот источник журнала можно использовать для уведомления разработчик, при возникновении определенных событий мониторинга работоспособности.</span><span class="sxs-lookup"><span data-stu-id="6226e-184">You can use this log source to notify a developer when a certain health monitoring event occurs.</span></span>

<span data-ttu-id="6226e-185">Давайте обновим рецензий на книги, таким образом, мы получали сообщения электронной почты каждый раз, когда исключение происходит конфигурации веб-сайта.</span><span class="sxs-lookup"><span data-stu-id="6226e-185">Let's update the Book Reviews website's configuration so that we receive an email whenever an exception occurs.</span></span> <span data-ttu-id="6226e-186">Для выполнения этой задачи необходимо выполнить три задачи:</span><span class="sxs-lookup"><span data-stu-id="6226e-186">To accomplish this we need to perform three tasks:</span></span>

1. <span data-ttu-id="6226e-187">Настройка веб-приложение ASP.NET для отправки электронной почты.</span><span class="sxs-lookup"><span data-stu-id="6226e-187">Configure the ASP.NET web application to send email.</span></span> <span data-ttu-id="6226e-188">Это достигается путем указания того, как сообщения электронной почты отправляются через `<system.net>` элемента конфигурации.</span><span class="sxs-lookup"><span data-stu-id="6226e-188">This is accomplished by specifying how email messages are sent via the `<system.net>` configuration element.</span></span> <span data-ttu-id="6226e-189">Дополнительные сведения об отправке по электронной почте сообщения в приложении ASP.NET, ссылаться на [отправки электронной почты в ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx) и [System.Net.Mail часто задаваемые вопросы о](http://systemnetmail.com/).</span><span class="sxs-lookup"><span data-stu-id="6226e-189">For more information on sending email messages in an ASP.NET application refer to [Sending Email in ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx) and the [System.Net.Mail FAQ](http://systemnetmail.com/).</span></span>
2. <span data-ttu-id="6226e-190">Зарегистрировать поставщик источника журнала по электронной почте в `<providers>` элемент, и</span><span class="sxs-lookup"><span data-stu-id="6226e-190">Register the email log source provider in the `<providers>` element, and</span></span>
3. <span data-ttu-id="6226e-191">Добавить запись `<rules>` сопоставляет события «Все ошибки» в регистратор источника, добавленным на шаге (2).</span><span class="sxs-lookup"><span data-stu-id="6226e-191">Add an entry to the `<rules>` element that maps the "All Errors" event to the log source provider added in step (2).</span></span>

<span data-ttu-id="6226e-192">Система наблюдения за работоспособностью включает два класса поставщика источника журнала по электронной почте: `SimpleMailWebEventProvider` и `TemplatedMailWebEventProvider`.</span><span class="sxs-lookup"><span data-stu-id="6226e-192">The health monitoring system includes two email log source provider classes: `SimpleMailWebEventProvider` and `TemplatedMailWebEventProvider`.</span></span> <span data-ttu-id="6226e-193">[ `SimpleMailWebEventProvider` Класс](https://msdn.microsoft.com/library/system.web.management.simplemailwebeventprovider.aspx) отправляет сообщение электронной почты в формате обычного текста, содержащее события подробно и предоставляет Настройка текста сообщения электронной почты.</span><span class="sxs-lookup"><span data-stu-id="6226e-193">The [`SimpleMailWebEventProvider` class](https://msdn.microsoft.com/library/system.web.management.simplemailwebeventprovider.aspx) sends a plain-text email message that includes the event details and provides little customization of the email body.</span></span> <span data-ttu-id="6226e-194">С помощью [ `TemplatedMailWebEventProvider` класс](https://msdn.microsoft.com/library/system.web.management.templatedmailwebeventprovider.aspx) указать страницу ASP.NET, в которых уже визуализированной разметке используется в теле сообщения электронной почты.</span><span class="sxs-lookup"><span data-stu-id="6226e-194">With the [`TemplatedMailWebEventProvider` class](https://msdn.microsoft.com/library/system.web.management.templatedmailwebeventprovider.aspx) you specify an ASP.NET page whose rendered markup is used as the body for the email message.</span></span> <span data-ttu-id="6226e-195">[ `TemplatedMailWebEventProvider` Класс](https://msdn.microsoft.com/library/system.web.management.templatedmailwebeventprovider.aspx) обеспечивает больший контроль над содержимое и формат сообщения электронной почты, но требует немного больше усилий переднего плана, как вам нужно создать страницу ASP.NET, создающий текст сообщения электронной почты.</span><span class="sxs-lookup"><span data-stu-id="6226e-195">The [`TemplatedMailWebEventProvider` class](https://msdn.microsoft.com/library/system.web.management.templatedmailwebeventprovider.aspx) gives you much greater control over the contents and format of the email message, but requires a bit more upfront work as you have to create the ASP.NET page that generates the email message's body.</span></span> <span data-ttu-id="6226e-196">Этот учебник посвящен использованию `SimpleMailWebEventProvider` класса.</span><span class="sxs-lookup"><span data-stu-id="6226e-196">This tutorial focuses on using the `SimpleMailWebEventProvider` class.</span></span>

<span data-ttu-id="6226e-197">Обновление системы мониторинга работоспособности `<providers>` элемент в `Web.config` файл источника журнала для `SimpleMailWebEventProvider` класса:</span><span class="sxs-lookup"><span data-stu-id="6226e-197">Update the health monitoring system's `<providers>` element in the `Web.config` file to include a log source for the `SimpleMailWebEventProvider` class:</span></span>

[!code-xml[Main](logging-error-details-with-asp-net-health-monitoring-cs/samples/sample3.xml)]

<span data-ttu-id="6226e-198">Приведенная выше разметка использует `SimpleMailWebEventProvider` класс как поставщик источника журнала и присваивает его понятное имя «EmailWebEventProvider».</span><span class="sxs-lookup"><span data-stu-id="6226e-198">The above markup uses the `SimpleMailWebEventProvider` class as the log source provider, and assigns it the friendly name "EmailWebEventProvider".</span></span> <span data-ttu-id="6226e-199">Кроме того `<add>` атрибут содержит дополнительные параметры конфигурации, такие как Кому и из адреса сообщения электронной почты.</span><span class="sxs-lookup"><span data-stu-id="6226e-199">Moreover, the `<add>` attribute includes additional configuration options, such as the To and From addresses of the email message.</span></span>

<span data-ttu-id="6226e-200">Источник журнала по электронной почте, в определенные все, что остается лишь указать работоспособности, мониторинг системы, чтобы использовать этот источник для необработанных исключений «вход».</span><span class="sxs-lookup"><span data-stu-id="6226e-200">With the email log source defined, all that remains is to instruct the health monitoring system to use this source to "log" unhandled exceptions.</span></span> <span data-ttu-id="6226e-201">Это достигается путем добавления нового правила в `<rules>` разделе:</span><span class="sxs-lookup"><span data-stu-id="6226e-201">This is accomplished by adding a new rule in the `<rules>` section:</span></span>

[!code-xml[Main](logging-error-details-with-asp-net-health-monitoring-cs/samples/sample4.xml)]

<span data-ttu-id="6226e-202">`<rules>` Раздел теперь включает два правила.</span><span class="sxs-lookup"><span data-stu-id="6226e-202">The `<rules>` section now includes two rules.</span></span> <span data-ttu-id="6226e-203">Первое, с именем «Всех ошибок для сообщений электронной почты», отправляет все необработанные исключения источник журнала «EmailWebEventProvider».</span><span class="sxs-lookup"><span data-stu-id="6226e-203">The first one, named "All Errors To Email", sends all unhandled exceptions to the "EmailWebEventProvider" log source.</span></span> <span data-ttu-id="6226e-204">Это правило действует как при отправке сведений об ошибках веб-сайта в указанный адрес.</span><span class="sxs-lookup"><span data-stu-id="6226e-204">This rule has the effect of sending details about errors on the website to the specified To address.</span></span> <span data-ttu-id="6226e-205">Правило «Всех ошибок для базы данных» база данных сайта регистрирует сведения об ошибке.</span><span class="sxs-lookup"><span data-stu-id="6226e-205">The "All Errors To Database" rule logs the error details to the site's database.</span></span> <span data-ttu-id="6226e-206">Следовательно каждый раз, когда происходит необработанное исключение на сайте сведения о нем обе записи в базу данных и отправке на указанный адрес электронной почты.</span><span class="sxs-lookup"><span data-stu-id="6226e-206">Consequently, whenever an unhandled exception occurs on the site its details are both logged to the database and sent to specified email address.</span></span>

<span data-ttu-id="6226e-207">**Рис. 2** показано сообщение электронной почты, созданных `SimpleMailWebEventProvider` класса при посещении `Genre.aspx?ID=foo`.</span><span class="sxs-lookup"><span data-stu-id="6226e-207">**Figure 2** shows the email generated by the `SimpleMailWebEventProvider` class when visiting `Genre.aspx?ID=foo`.</span></span>

[![](logging-error-details-with-asp-net-health-monitoring-cs/_static/image5.png)](logging-error-details-with-asp-net-health-monitoring-cs/_static/image4.png)

<span data-ttu-id="6226e-208">**Рис. 2**: Сведения об ошибке отправляются в сообщении электронной почты</span><span class="sxs-lookup"><span data-stu-id="6226e-208">**Figure 2**: The Error Details are Sent in an Email Message</span></span>  
<span data-ttu-id="6226e-209">([Просмотр полноразмерного изображения](logging-error-details-with-asp-net-health-monitoring-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="6226e-209">([Click to view full-size image](logging-error-details-with-asp-net-health-monitoring-cs/_static/image6.png))</span></span>

## <a name="summary"></a><span data-ttu-id="6226e-210">Сводка</span><span class="sxs-lookup"><span data-stu-id="6226e-210">Summary</span></span>

<span data-ttu-id="6226e-211">Система наблюдения за работоспособностью ASP.NET позволяет администраторам отслеживать работоспособность развернутого веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="6226e-211">The ASP.NET health monitoring system is designed to allow administrators to monitor the health of a deployed web application.</span></span> <span data-ttu-id="6226e-212">События мониторинга работоспособности вызываются в том случае, когда unfold определенные действия, например, при остановке приложения, когда пользователь успешно входит на сайт, или возникает необработанное исключение.</span><span class="sxs-lookup"><span data-stu-id="6226e-212">Health monitoring events are raised when certain actions unfold, such as when the application stops, when a user successfully logs onto the site, or when an unhandled exception occurs.</span></span> <span data-ttu-id="6226e-213">Эти события могут регистрироваться в любое количество источников журнала.</span><span class="sxs-lookup"><span data-stu-id="6226e-213">These events can be logged to any number of log sources.</span></span> <span data-ttu-id="6226e-214">Этом руководстве показано, как для записи сведений о необработанных исключений, в базе данных и через сообщение электронной почты.</span><span class="sxs-lookup"><span data-stu-id="6226e-214">This tutorial showed how to log the details of unhandled exceptions to a database and through an email message.</span></span>

<span data-ttu-id="6226e-215">В этом руководстве описывается по использованию мониторинга журнала необработанных исключений, но имейте в виду, что наблюдение за работоспособностью предназначен для оценки общей работоспособности развернутого приложения ASP.NET и содержат множество событий мониторинга состояния и журнала источников не работоспособности Рассмотренные здесь.</span><span class="sxs-lookup"><span data-stu-id="6226e-215">This tutorial focused on using health monitoring to log unhandled exceptions, but keep in mind that health monitoring is designed to measure the overall health of a deployed ASP.NET application and includes a wealth of health monitoring events and log sources not explored here.</span></span> <span data-ttu-id="6226e-216">Что такое дополнительные, можно создать собственные мониторинг событий и источники журналов, в случае необходимости возникают.</span><span class="sxs-lookup"><span data-stu-id="6226e-216">What's more, you can create your own health monitoring events and log sources, should the need arise.</span></span> <span data-ttu-id="6226e-217">Если вы заинтересованы в ознакомлении наблюдение за работоспособностью, хорошим первым шагом является прочтите [Erik Reitan](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx) [мониторинга часто задаваемые вопросы о работоспособности](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx).</span><span class="sxs-lookup"><span data-stu-id="6226e-217">If you are interested in learning more about health monitoring, a good first step is to read through [Erik Reitan](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx)'s [health monitoring FAQ](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx).</span></span> <span data-ttu-id="6226e-218">После этого, обратитесь к [How To: Использовать наблюдение за работоспособностью в ASP.NET 2.0](https://msdn.microsoft.com/library/ms998306.aspx).</span><span class="sxs-lookup"><span data-stu-id="6226e-218">Following that, consult [How To: Use Health Monitoring in ASP.NET 2.0](https://msdn.microsoft.com/library/ms998306.aspx).</span></span>

<span data-ttu-id="6226e-219">Счастливого вам программирования!</span><span class="sxs-lookup"><span data-stu-id="6226e-219">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="6226e-220">Дополнительные сведения</span><span class="sxs-lookup"><span data-stu-id="6226e-220">Further Reading</span></span>

<span data-ttu-id="6226e-221">Дополнительные сведения по темам, обсуждавшимся в этом руководстве см. в следующих ресурсах:</span><span class="sxs-lookup"><span data-stu-id="6226e-221">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="6226e-222">Обзор наблюдения за состоянием системы ASP.NET</span><span class="sxs-lookup"><span data-stu-id="6226e-222">ASP.NET Health Monitoring Overview</span></span>](https://msdn.microsoft.com/library/bb398933.aspx)
- [<span data-ttu-id="6226e-223">Конфигурации и настройке мониторинга системы ASP.NET работоспособности</span><span class="sxs-lookup"><span data-stu-id="6226e-223">Configuring and Customizing the Health Monitoring System of ASP.NET</span></span>](http://dotnetslackers.com/articles/aspnet/ConfiguringAndCustomizingTheHealthMonitoringSystemOfASPNET.aspx)
- [<span data-ttu-id="6226e-224">Часто задаваемые вопросы — наблюдение за работоспособностью в ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="6226e-224">FAQ - Health Monitoring in ASP.NET 2.0</span></span>](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx)
- [<span data-ttu-id="6226e-225">Как выполнить: Отправить сообщение электронной почты для мониторинга уведомлений о работоспособности</span><span class="sxs-lookup"><span data-stu-id="6226e-225">How To: Send E-Mail for Health Monitoring Notifications</span></span>](https://msdn.microsoft.com/library/ms227553.aspx)
- [<span data-ttu-id="6226e-226">Как выполнить: Использовать наблюдение за работоспособностью в ASP.NET</span><span class="sxs-lookup"><span data-stu-id="6226e-226">How To: Use Health Monitoring in ASP.NET</span></span>](https://msdn.microsoft.com/library/ms998306.aspx)
- [<span data-ttu-id="6226e-227">Наблюдение за работоспособностью в ASP.NET</span><span class="sxs-lookup"><span data-stu-id="6226e-227">Health Monitoring in ASP.NET</span></span>](http://aspnet.4guysfromrolla.com/articles/031407-1.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="6226e-228">[Назад](processing-unhandled-exceptions-cs.md)
> [Вперед](logging-error-details-with-elmah-cs.md)</span><span class="sxs-lookup"><span data-stu-id="6226e-228">[Previous](processing-unhandled-exceptions-cs.md)
[Next](logging-error-details-with-elmah-cs.md)</span></span>
