---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/strategies-for-database-development-and-deployment-cs
title: Стратегии разработки баз данных и развертывания (C#) | Документация Майкрософт
author: rick-anderson
description: При развертывании приложения на основе данных в первый раз, вы можете просто скопируйте базу данных в среде разработки в рабочую среду. B...
ms.author: riande
ms.date: 04/23/2009
ms.assetid: 3e8b0627-3eb7-488e-807e-067cba7cec05
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/strategies-for-database-development-and-deployment-cs
msc.type: authoredcontent
ms.openlocfilehash: 3951ab4562e2c172f418c74136d511f0f9f50454
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/09/2019
ms.locfileid: "59415847"
---
# <a name="strategies-for-database-development-and-deployment-c"></a>Стратегии разработки и развертывания баз данных (C#)

по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Скачать PDF](http://download.microsoft.com/download/C/3/9/C391A649-B357-4A7B-BAA4-48C96871FEA6/aspnet_tutorial10_DBDevel_cs.pdf)

> При развертывании приложения на основе данных в первый раз, вы можете просто скопируйте базу данных в среде разработки в рабочую среду. Но выполнение вслепую копирования при следующем развертывании перезапишет любые данные, вводимые в рабочей базе данных. Вместо этого для развертывания базы данных включает применение изменения, внесенные в базу данных разработки с момента последнего развертывания в рабочей базе данных. Этот учебник проверяет эти проблемы и предлагает различные стратегии для помощи с chronicling и применяет эти изменения, внесенные в базу данных с момента последнего развертывания.


## <a name="introduction"></a>Вступление

Как уже обсуждалось в предыдущих учебных курсах, развертывание приложения ASP.NET влечет за собой копирование нужных содержимого из среды разработки в рабочую среду. Развертывания не является одноразовым событием, но вместо что-то, что происходит каждый раз при выпуске новой версии программного обеспечения, или когда "ошибки" или определены и устранены проблемы безопасности. При копировании страниц ASP.NET, изображения, файлы JavaScript и других таких файлов в рабочую среду, не нужно заботиться как эти файлы изменены с момента последнего развертывания. Можно просто скопируйте файл в рабочей среде, перезапись существующего контента. К сожалению этой простоты не распространяется на развертывании базы данных.

При развертывании приложения на основе данных в первый раз, вы можете просто скопируйте базу данных в среде разработки в рабочую среду. Но выполнение вслепую копирования при следующем развертывании перезапишет любые данные, вводимые в рабочей базе данных. Вместо этого развертывание базы данных подразумевает применение *изменения* внесенных в базу данных разработки с момента последнего развертывания в рабочей базе данных. Этот учебник проверяет эти проблемы и предлагает различные стратегии для помощи с chronicling и применяет эти изменения, внесенные в базу данных с момента последнего развертывания.

## <a name="the-challenges-of-deploying-a-database"></a>Задачи развертывания базы данных

Прежде чем управляемое данными приложение будет развернуто в первый раз, имеется только одна база данных, а именно базе данных в среде разработки, поэтому при развертывании приложения на основе данных в первый раз вы можете просто скопировать базу данных в среда разработки в рабочую среду. Но после развертывания приложения существуют две копии базы данных: один в разработке, а другой в рабочей среде.

Между развертываниями разработки и рабочей баз данных может стать не синхронизировано. Хотя схему рабочей базы данных s не изменяется, можно изменить схему s разработки базы данных, по мере добавления новых функций. Может добавить или удалить столбцы, таблицы, представления или хранимые процедуры. Также могут быть важные данные, которые добавляются в базу данных разработки. Многие приложения на основе данных включают таблицы подстановки, заполненную данными жестко, относящиеся к приложению, недоступны для редактирования для пользователя. Например на веб-сайте аукциона есть стрелку раскрывающегося списка для выбора, которые описывают условия auctioned элемента: Новые такие как новые, Good и прямым. Вместо того чтобы жестко программировать этих параметров непосредственно в раскрывающемся списке — как правило, лучше поместить их в таблицу базы данных. Если во время разработки, новое условие с именем плохо добавляется в таблицу затем при развертывании приложения этой же записи должен быть добавлен в таблицу подстановок в рабочей базе данных.

В идеале развертывание базы данных будет включать в себя копирование базы данных из среды разработки в рабочую среду. Но имейте в виду, что после развертывания приложения и возобновить разработки, рабочая база данных заполняется с реальными данными от реальных пользователей. Таким образом Если были просто скопировать базу данных из среды разработки в рабочей среде с следующего развертывания необходимо перезаписать рабочей базы данных и потеря его существующих данных. Конечным результатом является то, что развертывании базы данных сводится к применяет эти изменения, внесенные в базу данных разработки с момента последнего развертывания.

Поскольку развертывание базы данных подразумевает применение изменений в схеме и, возможно, данные с момента последнего развертывания, историю изменений должны поддерживаться (или определяется во время развертывания), чтобы эти изменения могут применяться в рабочей среде. Существуют различные методы для применения изменений в модель данных и управления ими.

### <a name="defining-the-baseline"></a>Определение базовых показателей

Чтобы сохранить изменения в базе данных s приложения необходимо иметь некоторые начальное состояние базовых показателей, к которому применяются изменения для. С одной стороны начальное состояние может быть пустой базы данных без таблиц, представлений или хранимых процедур. Такие базовые показатели приводит в журнале большие изменения, так как она должна включать создание всех таблиц базы данных s, представлений и хранимых процедур, а также любые изменения, внесенные после первоначального развертывания. На другом конце спектра можно задать базовый план как версия базы данных, сначала развертывается в рабочей среде. Этот выбор приводит гораздо меньшего размера журнала изменений, так как он включает только изменения, внесенные в базу данных после первого развертывания. Именно этот подход, который я предпочитаю. И конечно вы можете выбрать дополнительные среднего подхода road, определение базовых показателей в какой-то момент между первоначальное Создание базы данных и при первоначальном развертывании базы данных.

При наличии выбранного базового плана по возможности создавать скрипт SQL, который может быть выполнен для повторного создания базовой версии. Такой сценарий дает возможность быстро повторно создать базовую версию базы данных. Эта функция особенно полезна в крупных проектах, где может быть несколько разработчиков работают над проекта или дополнительные среды, таких как тестирование или промежуточной и, в которых требуется свою собственную копию базы данных.

Существует широкий набор средств в вашем распоряжении, для создания скрипта SQL для базовой версии. Из SQL Server Management Studio (SSMS) можно щелкнуть правой кнопкой мыши в базе данных, перейдите в меню задач и выберите «Создать сценарий». Будет запущен мастер скрипт, который можно указать для создания файла, содержащего команды SQL для создания базы данных s объектов. Другой вариант — мастер публикации баз данных, который будет генерировать команды SQL, чтобы не только создавать схему базы данных, но данные в таблицах базы данных. Мастер публикации базы данных было подробно рассматриваемую в *развертывание базы данных* руководства. Независимо от того, какое средство используется, в конечном счете, должны иметь файл скрипта, который можно использовать для повторного создания базовой версии базы данных, в случае необходимости возникают.

## <a name="documenting-the-database-changes-in-prose"></a>Документирование изменений в базе данных в Прозе

Самый простой способ вести журнал изменений в модель данных на этапе разработки — для записи изменений в прозе. Например, если во время разработки, уже развернутые приложения добавьте новый столбец для `Employees` таблицы, удаления столбца из `Orders` таблицу и добавить новую таблицу (`ProductCategories`), вы бы Ведение текстового файла или документа Microsoft Word с журналом, следующие:

<a id="0.4_table01"></a>


| **Дата изменения** | **Изменить сведения** |
| --- | --- |
| 2009-02-03: | Добавленный столбец `DepartmentID` (`int`, NOT NULL) для `Employees` таблицы. Добавить ограничение внешнего ключа из `Departments.DepartmentID` для `Employees.DepartmentID`. |
| 2009-02-05: | Удален столбец `TotalWeight` из `Orders` таблицы. Связанные данные уже `OrderDetails` записей. |
| 2009-02-12: | Создан `ProductCategories` таблицы. Есть три столбца: `ProductCategoryID` (`int`, `IDENTITY`, `NOT NULL`), `CategoryName` (`nvarchar(50)`, `NOT NULL`), и `Active` (`bit`, `NOT NULL`). Добавить ограничение первичного ключа для `ProductCategoryID`и значение по умолчанию 1, `Active`. |


Существует ряд недостатков этого подхода. Во-первых есть надежда, не для службы автоматизации. В любое время эти изменения должны применяться к базе данных - например, при развертывании приложения — разработчик должен вручную реализовать каждого изменения, по одному. Кроме того Если необходимо восстановить на конкретную версию базы данных от базового плана, с помощью журнала изменений, это таким образом займет больше времени по мере роста размера журнала. Другим недостатком этого метода является ясность и уровень детализации для каждой записи журнала изменений остается пользователю, запись изменения. В команде, где несколько разработчиков некоторые могут вносить записи дополнительные, более удобном для чтения или точнее, чем другие. Кроме того возможны опечатки и другие данные, связанные с human запись ошибки.

Документирование изменений в базе данных в прозе основное преимущество заключается в простоте. Нигде не необходимости t, знакомый синтаксис SQL для создания и изменения объектов базы данных. Вместо этого можно записывать изменения в прозой и реализовать их через графический пользовательский интерфейс s SQL Server Management Studio.

Обслуживание ваш журнал изменений в прозе, надо признать, не очень сложным и не будет работать с определенных проектов, например те, которые имеют большой размер, в области, которых часто происходят изменения в модель данных, или содержать несколько разработчиков. Но я раз видел такой подход весьма хорошо работать в небольших в нем проектов, имеющих только случайные изменения в модель данных и когда разработчику-одиночке, не имеет большой опыт в синтаксисе SQL для создания и изменения объектов базы данных.

> [!NOTE]
> Хотя сведения в журнале изменений, с технической точки зрения требуется только до время развертывания, я рекомендую хранение журнала изменений. Но вместо того чтобы хранить один, когда-либо увеличении файла журнала изменений, рассмотрите возможность установки файл журнала другое изменение для каждой версии базы данных. Обычно требуется версия базы данных каждый раз, когда она развернута. За счет журнал журналы изменений, можно начиная от базового плана, повторно создать любой версии базы данных, выполнение сценариев журнала изменений, начиная с версии 1 и продолжая вплоть до версии необходимо повторно создать.


## <a name="recording-the-sql-change-statements"></a>Запись изменения инструкций SQL

Ведение журнала изменений в прозе основным недостатком является отсутствие автоматизации. В идеальном случае реализация изменений базы данных в производственной базе данных во время развертывания будет так же просто, как нажатие кнопки для выполнения скрипта, а не приходится вручную осуществлять список инструкций. Такая автоматизация возможна за счет журнал изменений, который содержит эти команды SQL, используемая для изменения модели данных.

Синтаксис SQL включает ряд инструкций для создания и изменения различных объектов базы данных. Например [ *инструкции CREATE TABLE*](https://msdn.microsoft.com/library/ms174979.aspx), при выполнении создает новую таблицу с указанных столбцов и ограничений. [ *Инструкции ALTER TABLE* ](https://msdn.microsoft.com/library/ms190273.aspx) изменяет существующую таблицу, добавление, удаление или изменение его столбцы и ограничения. Кроме того, существуют также инструкции, чтобы создавать, изменять и удалять индексы, представления, определяемые пользователем функции, хранимые процедуры, триггеры и другие объекты базы данных.

Возвращаясь к наш предыдущий пример, образа, который во время разработки, добавьте новый столбец в уже развернутые приложения `Employees` таблицы, удаления столбца из `Orders` таблицу и добавить новую таблицу (`ProductCategories`). Такие действия, приведет к файл журнала изменений с помощью следующих команд SQL:

[!code-sql[Main](strategies-for-database-development-and-deployment-cs/samples/sample1.sql)]

Отправляя эти изменения в производственной базе данных во время развертывания — это Быстрая операция: Откройте SQL Server Management Studio, подключиться к рабочей базе данных, откройте окно нового запроса, вставить содержимое буфера журнала изменений и нажмите кнопку выполнить, чтобы запустить сценарий.

## <a name="using-a-comparison-tool-to-synchronize-the-data-models"></a>С помощью инструмента сравнения для синхронизации модели данных

Документирование изменений базы данных в прозе прост, но для реализации изменений требуется разработчику создавать каждое изменение в рабочей базе данных один момент времени; Документирование команды SQL изменений позволяет применить эти изменения в рабочей базе данных как легко и быстро, как нажатие кнопки, но требует обучения и захвата инструкций SQL и синтаксис для создания и изменения объектов базы данных. Инструменты для баз данных сравнения себя лучшие из обоих подходов и отменить худшее.

Средство сравнения базы данных, сравнение схем или данных двух баз данных и отображает сводный отчет, показывающий, как базы данных отличаются. Затем с одним нажатием кнопки, можно создавать команды SQL для синхронизации одного или нескольких объектов базы данных. По сути, средство сравнения базы данных можно использовать для сравнения разработки и рабочих баз данных во время развертывания, создается файл, который содержит SQL команды, при выполнении применяют изменения в схему рабочей базы данных s так что он зеркально отражает схему базы данных s разработки.

Существуют разнообразные средства сравнения стороннюю базу данных, предоставляемые разными поставщиками. Например, вы [ *SQL Compare*](http://www.red-gate.com/products/SQL_Compare/), по [ *компании Red Gate Software*](http://www.red-gate.com/). Позвольте s рассмотрен процесс использования SQL Compare для сравнение и Синхронизация схем баз данных разработки и эксплуатации.

> [!NOTE]
> Во время написания этой статьи текущей версией SQL Compare был версии 7.1, с выпуском Standard, расчет затрат 395 долларов США. Читатели могут проследить, загрузив бесплатную пробную версию 14 дней.


При запуске SQL Compare откроется диалоговое окно сравнения проекты, отображая сохраненные проекты SQL Compare. Создайте новый проект. Запустится мастер конфигурации проекта, который запрашивает сведения о базах данных для сравнения (см. рис. 1). Введите сведения для разработки и рабочей среды баз данных.


[![Compare разработки и рабочих баз данных](strategies-for-database-development-and-deployment-cs/_static/image2.jpg)](strategies-for-database-development-and-deployment-cs/_static/image1.jpg)

**Рис. 1**: Сравните разработки и рабочих баз данных ([Просмотр полноразмерного изображения](strategies-for-database-development-and-deployment-cs/_static/image3.jpg))


> [!NOTE]
> Если базы данных среды разработки является файлом базы данных SQL, экспресс-выпуск в `App_Data` папку веб-сайта, вам потребуется зарегистрировать базу данных на сервере базы данных SQL Server Express, чтобы выбрать его из диалоговое окно, показанное на рис. 1. Самый простой способ сделать это — открыть SQL Server Management Studio (SSMS), соединиться с сервером базы данных SQL Server Express и присоедините базу данных. Если у вас нет SSMS, установленной на компьютере можно загрузить и установить бесплатное [ *версии SQL Server 2008 Management Studio Basic*](https://www.microsoft.com/downloads/details.aspx?FamilyId=7522A683-4CB2-454E-B908-E805E9BD4E28&amp;displaylang=en).


Помимо выбора баз данных для сравнения, можно также указать различные параметры сравнения, на вкладке "Параметры". Один из вариантов, вы можете включить — «игнорировать ограничения и индекса имена.» Помните, что в предыдущем учебном курсе мы добавили приложение служб объектов базы данных для разработки и рабочей баз данных. Если вы использовали `aspnet_regsql.exe` средство для создания этих объектов в рабочей базе данных, то обнаружится, что первичный ключ и ограничение уникальности имен отличаются между базами данных разработки и эксплуатации. Следовательно SQL Compare помечаются все таблиц службы приложений как отличающийся. Можно либо оставить «игнорировать ограничения и индекса имена» снят флажок и синхронизировать имена ограничений, или настройте Выполнение SQL Compare, чтобы не учитывать эти различия.

После выбора базы данных для сравнения (и просмотрев параметры сравнения), нажмите кнопку теперь сравнения, чтобы начать сравнение. На следующих нескольких секунд SQL Compare проверяет схем двух баз данных и создает отчет о том, как они отличаются. Я ve намеренно произведены некоторые изменения в базу данных разработки, чтобы показать, как такие расхождения отмечаются в интерфейсе SQL Compare. Как показано на рис. 2, я добавил `BirthDate` столбец `Authors` таблица, удаляется `ISBN` столбец из `Books` таблицу и добавить новую таблицу, `Ratings`, которая предназначена для пользователей, посещающими скорость сайта проверенные электронной документации по.

> [!NOTE]
> Изменения модели данных, сделанные в этом руководстве были выполнены, чтобы показано, как использовать средство сравнения базы данных. Вы не найдете эти изменения в базе данных в последующих учебных курсах.


[![SСравнение QL перечислены различия между разработкой и рабочих баз данных](strategies-for-database-development-and-deployment-cs/_static/image5.jpg)](strategies-for-database-development-and-deployment-cs/_static/image4.jpg)

**Рис. 2**: SQL Compare перечислены различия между разработки и рабочих баз данных ([Просмотр полноразмерного изображения](strategies-for-database-development-and-deployment-cs/_static/image6.jpg))


SQL Compare разбивает объекты базы данных на группы, быстро покажем, какие объекты существуют в обеих базах данных, но различаются, объекты существуют в одной базе данных, но не в другой и какие объекты идентичны. Как вы видите, существуют два объекта, которые существуют в обеих базах данных, но отличаются: `Authors` таблицу, которая есть столбец добавлен, и `Books` таблицы, имеющий один удалены. Только один объект, который существует только в базе данных разработки, а именно: созданный `Ratings` таблицы. И 117 объектов, которые идентичны в обеих базах данных.

При выборе объекта базы данных появляется окно отличия SQL, в которой показано, как эти объекты отличаются. В окне SQL различия, отображаются внизу на рис. 2, выделяются, который `Authors` таблица в базе данных разработки имеет `BirthDate` столбец, который не найден в `Authors` таблицы в рабочей базе данных.

После рассмотрения различия и выбрав какие объекты, которые нужно синхронизировать, следующим шагом является создают команды SQL, необходимые для обновления схемы s рабочей базы данных в соответствии с разработки базы данных. Для этого в мастере синхронизации. Мастер синхронизации подтверждает, что объекты для синхронизации и перечислены действия плана (см. рис. 3). Можно немедленно синхронизировать базы данных или создать скрипт с помощью команд SQL, которые могут выполняться в свободное время.


[![USE мастер синхронизации, чтобы синхронизировать схем баз данных](strategies-for-database-development-and-deployment-cs/_static/image8.jpg)](strategies-for-database-development-and-deployment-cs/_static/image7.jpg)

**Рис. 3**: Используйте мастер синхронизации, чтобы синхронизировать схем баз данных ([Просмотр полноразмерного изображения](strategies-for-database-development-and-deployment-cs/_static/image9.jpg))


Сравнение инструменты для баз данных, такие как SQL Compare элементами применение изменений в схему базы данных разработки в производственной базе данных, так же просто, и щелкнув компании Red Gate Software.

> [!NOTE]
> SQL Compare сравнивает и синхронизирует две базы данных *схемы*. К сожалению он не сравнение и синхронизация данных в таблицах двух баз данных. Компании Red Gate Software предлагает продукт с именем [ *SQL Data Compare* ](http://www.red-gate.com/products/SQL_Data_Compare/) , сравнивает и синхронизирует данные между двумя базами данных, но также – это отдельный продукт из SQL Compare и расходы на другой 395 долларов США.


## <a name="taking-the-application-offline-during-deployment"></a>Переводя приложение в автономный режим во время развертывания

Как мы ve показывается в этих руководствах развертывания — это процесс, который состоит из нескольких этапов: копирование страницы ASP.NET, главные страницы, CSS файлы, JavaScript файлы, изображения и другое необходимое содержимое из среды разработки в рабочей среде среды; Копирование сведений о конфигурации среды рабочей среде, при необходимости; и применяет эти изменения к модели данных с момента последнего развертывания. В зависимости от числа файлов и сложности базы данных изменяется эти действия может занять от нескольких секунд до нескольких минут для завершения. В течение этого периода веб-приложение находится в flux и посещения веб-узла могут возникать ошибки или непредвиденное поведение.

При развертывании веб-сайта рекомендуется перевести веб-приложения в «автономный режим» до завершения развертывания. Переведите приложение в автономный режим (и восстановите его работоспособность после завершения процесса развертывания) так же просто, как отправка файла и последующего удаления. Начиная с ASP.NET 2.0, простое присутствие файла с именем `app_offline.htm` в s приложения корневой каталог занимает всего веб-сайта, «автономный режим.» Любой запрос к странице ASP.NET на этом сайте автоматически выводила содержимое `app_offline.htm` файла. После удаления этого файла приложения становится доступной.

Перевод автономный режим во время развертывания, после этого приложения сложнее, чем отправка `app_offline.htm` файл в рабочую среду s корневой каталог перед началом процесса развертывания и последующего удаления (или переименованием на другое), после развертывания завершена. Дополнительные сведения об этом приеме см. в статье s Джон Питерсон, принимая [ *ASP.NET приложения в автономный режим*](http://www.15seconds.com/issue/061207.htm).

## <a name="summary"></a>Сводка

Основная проблема при развертывании приложения, управляемые данными основано на развертывании базы данных. Так как существуют две версии базы данных — в среде разработки — и в рабочей среде этих схем двух баз данных может усложнить синхронизированы, так как в разработке добавлены новые функции. Какие дополнительные, поскольку рабочей базы данных, как были заполнены реальные данные из реальных пользователей, невозможно перезаписать рабочей базы данных с базой данных измененный разработки, как и при развертывании файлы, составляющие приложение (страницы ASP.NET, s файлы изображений и т. д). Вместо этого развертывание базы данных влечет за собой реализации точного набора изменений, внесенных в базу данных разработки в рабочей базе данных с момента последнего развертывания.

Этот учебник рассмотрели три приемы обслуживания и применения журнала изменений базы данных. Самый простой подход заключается в записи изменений в прозе. Хотя это делает применение этих изменений на рабочую базу данных вручную, он не требовалось знание команд SQL для создания и изменения объектов базы данных. Более сложный подход, а другой — гораздо более удобной в больших проектов или проектов с множеством разработчиков является для записи изменений как ряд команд SQL. Это значительно ускоряет развертывание этих изменений в целевой базе данных. Лучшее из обоих подходов может осуществляться с помощью средства сравнения базы данных, таких как SQL Compare s компании Red Gate Software.

Этот учебник завершает основное внимание на развертывание приложения, управляемые данными. Следующий набор учебных курсов рассказывается, как реагировать на ошибки в рабочей среде. Мы рассмотрим способ отображения страницы понятное сообщение скорее вместо желтый экрана смерти. И мы увидим, как регистрировать s сведения об ошибке и как создавать оповещения, при возникновении таких ошибок.

Счастливого вам программирования!

> [!div class="step-by-step"]
> [Назад](configuring-a-website-that-uses-application-services-cs.md)
> [Вперед](displaying-a-custom-error-page-cs.md)
