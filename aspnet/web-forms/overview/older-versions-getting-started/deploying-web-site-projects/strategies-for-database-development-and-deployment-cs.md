---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/strategies-for-database-development-and-deployment-cs
title: Стратегии разработки и развертывания баз данных (C#) | Документация Майкрософт
author: rick-anderson
description: При первом развертывании приложения, управляемого данными, можно в первый раз скопировать базу данных в среду разработки в рабочую среду. Б...
ms.author: riande
ms.date: 04/23/2009
ms.assetid: 3e8b0627-3eb7-488e-807e-067cba7cec05
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/strategies-for-database-development-and-deployment-cs
msc.type: authoredcontent
ms.openlocfilehash: 4d9dbaf41926b43af171619ee34f58da84b5dab1
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/28/2019
ms.locfileid: "74582204"
---
# <a name="strategies-for-database-development-and-deployment-c"></a><span data-ttu-id="2e7f6-104">Стратегии разработки и развертывания баз данных (C#)</span><span class="sxs-lookup"><span data-stu-id="2e7f6-104">Strategies for Database Development and Deployment (C#)</span></span>

<span data-ttu-id="2e7f6-105">по [Скотт Митчелл](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="2e7f6-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

[<span data-ttu-id="2e7f6-106">Загрузить PDF-файл</span><span class="sxs-lookup"><span data-stu-id="2e7f6-106">Download PDF</span></span>](https://download.microsoft.com/download/C/3/9/C391A649-B357-4A7B-BAA4-48C96871FEA6/aspnet_tutorial10_DBDevel_cs.pdf)

> <span data-ttu-id="2e7f6-107">При первом развертывании приложения, управляемого данными, можно в первый раз скопировать базу данных в среду разработки в рабочую среду.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-107">When deploying a data-driven application for the first time you can blindly copy the database in the development environment to the production environment.</span></span> <span data-ttu-id="2e7f6-108">Но при последующих развертываниях при выполнении скрытой копии все данные, содержащиеся в рабочей базе данных, будут перезаписаны.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-108">But performing a blind copy in subsequent deployments will overwrite any data entered into the production database.</span></span> <span data-ttu-id="2e7f6-109">Вместо этого развертывание базы данных включает в себя применение изменений, внесенных в базу данных разработки с момента последнего развертывания в рабочей базе данных.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-109">Instead, deploying a database involves applying the changes made to the development database since the last deployment onto the production database.</span></span> <span data-ttu-id="2e7f6-110">В этом учебнике рассматриваются эти проблемы и предлагаются различные стратегии для помощи с хрониками и применением изменений, внесенных в базу данных с момента последнего развертывания.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-110">This tutorial examines these challenges and offers various strategies to assist with chronicling and applying the changes made to the database since the last deployment.</span></span>

## <a name="introduction"></a><span data-ttu-id="2e7f6-111">Введение</span><span class="sxs-lookup"><span data-stu-id="2e7f6-111">Introduction</span></span>

<span data-ttu-id="2e7f6-112">Как обсуждалось в предыдущих руководствах, развертывание приложения ASP.NET влечет за собой копирование нужного содержимого из среды разработки в рабочую среду.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-112">As discussed in previous tutorials, deploying an ASP.NET application entails copying the pertinent content from the development environment to the production environment.</span></span> <span data-ttu-id="2e7f6-113">Развертывание — это не одноразовое событие, но и то, что происходит каждый раз при выпуске новой версии программного обеспечения, а также при обнаружении и устранении ошибок или проблем безопасности.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-113">Deployment is not a one-time event, but rather something that happens every time a new version of the software is released or when bugs or security concerns have been identified and addressed.</span></span> <span data-ttu-id="2e7f6-114">При копировании страниц ASP.NET, изображений, файлов JavaScript и других таких файлов в рабочую среду не нужно беспокоиться о том, как этот файл был изменен с момента последнего развертывания.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-114">When copying ASP.NET pages, images, JavaScript files, and other such files to the production environment you do not need to concern yourself with how these file have been changed since the last deployment.</span></span> <span data-ttu-id="2e7f6-115">Вы можете просто скопировать файл в рабочую среду, перезаписав существующее содержимое.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-115">You can blindly copy the file to production, overwriting the existing content.</span></span> <span data-ttu-id="2e7f6-116">К сожалению, эта простота не распространяется на развертывание базы данных.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-116">Unfortunately, this simplicity does not extend to deploying the database.</span></span>

<span data-ttu-id="2e7f6-117">При первом развертывании приложения, управляемого данными, можно в первый раз скопировать базу данных в среду разработки в рабочую среду.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-117">When deploying a data-driven application for the first time you can blindly copy the database in the development environment to the production environment.</span></span> <span data-ttu-id="2e7f6-118">Но при последующих развертываниях при выполнении скрытой копии все данные, содержащиеся в рабочей базе данных, будут перезаписаны.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-118">But performing a blind copy in subsequent deployments will overwrite any data entered into the production database.</span></span> <span data-ttu-id="2e7f6-119">Вместо этого развертывание базы данных включает в себя применение *изменений* , внесенных в базу данных разработки с момента последнего развертывания в рабочей базе данных.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-119">Instead, deploying a database involves applying the *changes* made to the development database since the last deployment onto the production database.</span></span> <span data-ttu-id="2e7f6-120">В этом учебнике рассматриваются эти проблемы и предлагаются различные стратегии для помощи с хрониками и применением изменений, внесенных в базу данных с момента последнего развертывания.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-120">This tutorial examines these challenges and offers various strategies to assist with chronicling and applying the changes made to the database since the last deployment.</span></span>

## <a name="the-challenges-of-deploying-a-database"></a><span data-ttu-id="2e7f6-121">Проблемы развертывания базы данных</span><span class="sxs-lookup"><span data-stu-id="2e7f6-121">The Challenges of Deploying a Database</span></span>

<span data-ttu-id="2e7f6-122">Перед развертыванием приложения, управляемого данными, в первый раз существует только одна база данных, а именно база данных в среде разработки. Почему при первом развертывании приложения, управляемого данными, можно в первый раз скопировать базу данных в среда разработки в рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-122">Before a data-driven application has been deployed for the first time, there is only one database, namely the database in the development environment, which is why when deploying a data-driven application for the first time you can blindly copy the database in the development environment to the production environment.</span></span> <span data-ttu-id="2e7f6-123">Но после развертывания приложения существует две копии базы данных: одна в разработке и одна в рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-123">But once the application has been deployed there are two copies of the database: one in development and one in production.</span></span>

<span data-ttu-id="2e7f6-124">Между развертываниями базы данных разработки и рабочей среды могут стать несинхронизированными. Несмотря на то, что схема рабочей базы данных не изменяется, схема базы данных разработки может измениться по мере добавления новых функций.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-124">Between deployments the development and production databases can become out of sync. While the production database s schema remains unchanged, the development database s schema may change as new features are added.</span></span> <span data-ttu-id="2e7f6-125">Вы можете добавлять или удалять столбцы, таблицы, представления или хранимые процедуры.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-125">You might add or remove columns, tables, views, or stored procedures.</span></span> <span data-ttu-id="2e7f6-126">Также могут быть важные данные, добавляемые в базу данных разработки.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-126">There may also be important data that gets added to the development database.</span></span> <span data-ttu-id="2e7f6-127">Многие приложения, управляемые данными, включают таблицы подстановки, заполненные жестко заданными данными приложения, которые не могут быть изменены пользователем.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-127">Many data-driven applications include lookup tables populated with hard-coded, application-specific data that are not user-editable.</span></span> <span data-ttu-id="2e7f6-128">Например, веб-сайт аукциона может иметь раскрывающийся список с вариантами, описывающими условия для создаваемого элемента: новое, хорошее и справедливое.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-128">For example, an auction website might have a drop-down list with choices that describe the condition of the item being auctioned: New, Like New, Good, and Fair.</span></span> <span data-ttu-id="2e7f6-129">Вместо того, чтобы жестко программировать эти параметры непосредственно в раскрывающемся списке, обычно лучше поместить их в таблицу базы данных.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-129">Rather than hard-coding these options directly in the drop-down list it is usually better to place them in a database table.</span></span> <span data-ttu-id="2e7f6-130">Если во время разработки в таблицу добавляется новое условие с именем «плохое», то при развертывании приложения эта же запись должна быть добавлена в таблицу уточняющих запросов рабочей базы данных.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-130">If, during development, a new condition named Poor is added to the table then when deploying the application this same record needs to be added to the lookup table in the production database.</span></span>

<span data-ttu-id="2e7f6-131">В идеале развертывание базы данных влечет за собой копирование базы данных из среды разработки в рабочую среду.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-131">Ideally, deploying the database would involve copying the database from development to production.</span></span> <span data-ttu-id="2e7f6-132">Но помните, что после развертывания приложения и возобновления разработки Рабочая база данных заполняется реальными данными от реальных пользователей.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-132">But keep in mind that after you have deployed the application and resumed development, the production database is being populated with real data from real users.</span></span> <span data-ttu-id="2e7f6-133">Таким образом, если бы вы просто скопировали базу данных из среды разработки в рабочую среду при следующем развертывании, вы перезапишете рабочую базу данных и потеряли ее существующие данные.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-133">Therefore, if you were to simply copy the database from development to production at the next deployment you would overwrite the production database and lose its existing data.</span></span> <span data-ttu-id="2e7f6-134">В итоге развертывание базы данных сводится к применению изменений, внесенных в базу данных разработки с момента последнего развертывания.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-134">The net result is that deploying the database boils down to applying the changes made to the development database since the last deployment.</span></span>

<span data-ttu-id="2e7f6-135">Поскольку развертывание базы данных включает в себя применение изменений в схеме и, возможно, данных с момента последнего развертывания, необходимо сохранить журнал изменений (или определить во время развертывания), чтобы эти изменения можно было применить в рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-135">Because deploying a database involves applying the changes in the schema and, possibly, the data since the last deployment, a history of changes must be maintained (or determined at deploy-time) so that those changes can be applied on production.</span></span> <span data-ttu-id="2e7f6-136">Существует множество методов управления изменениями и их применения к модели данных.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-136">There are a variety of techniques for managing and applying changes to the data model.</span></span>

### <a name="defining-the-baseline"></a><span data-ttu-id="2e7f6-137">Определение базовых показателей</span><span class="sxs-lookup"><span data-stu-id="2e7f6-137">Defining the Baseline</span></span>

<span data-ttu-id="2e7f6-138">Чтобы сохранить изменения в базе данных приложения, необходимо иметь некоторое начальное состояние — базовый уровень, к которому применяются изменения.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-138">To maintain the changes to your application s database you need to have some starting state, a baseline to which the changes are applied to.</span></span> <span data-ttu-id="2e7f6-139">В одном крайнем случае начальное состояние может быть пустой базой данных без таблиц, представлений или хранимых процедур.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-139">At one extreme the starting state could be an empty database with no tables, views, or stored procedures.</span></span> <span data-ttu-id="2e7f6-140">Такой базовый план приводит к большому журналу изменений, так как он должен включать создание всех таблиц, представлений и хранимых процедур базы данных, а также любые изменения, внесенные после первоначального развертывания.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-140">Such a baseline results in a large change log because it must include the creation of all of the database s tables, views, and stored procedures along with any changes made after the initial deployment.</span></span> <span data-ttu-id="2e7f6-141">На другом конце спектра можно задать базовую базу в качестве версии базы данных, изначально развернутой в рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-141">At the other end of the spectrum you could set the baseline as the version of the database that is initially deployed to the production environment.</span></span> <span data-ttu-id="2e7f6-142">Этот вариант приводит к значительно меньшему журналу изменений, поскольку он включает только изменения, внесенные в базу данных после первого развертывания.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-142">This choice results in a much smaller change log because it only includes the changes made to the database following the first deployment.</span></span> <span data-ttu-id="2e7f6-143">Это предпочтительный подход.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-143">This is the approach I prefer.</span></span> <span data-ttu-id="2e7f6-144">И, конечно, можно выбрать более середину пути, определив базовую основу в качестве некоторой точки между первоначальным созданием базы данных и моментом развертывания базы данных.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-144">And of course you can choose a more middle of the road approach, defining the baseline as some point between the initial creation of the database and when the database is first deployed.</span></span>

<span data-ttu-id="2e7f6-145">После выбора базового плана рассмотрите возможность создания скрипта SQL, который можно выполнить для повторного создания базовой версии.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-145">Once you have chosen a baseline consider generating a SQL script that can be executed to recreate the baseline version.</span></span> <span data-ttu-id="2e7f6-146">Такой сценарий позволяет быстро воссоздать базовую версию базы данных.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-146">Such a script makes it possible to quickly recreate the baseline version of the database.</span></span> <span data-ttu-id="2e7f6-147">Эта функция особенно полезна в больших проектах, где может быть несколько разработчиков, работающих над проектом или в дополнительных средах, таких как тестирование или промежуточное развертывание, для каждой из которых требуется собственная копия базы данных.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-147">This functionality is especially useful in larger projects, where there may be multiple developers working on the project or additional environments, such as testing or staging, that each need their own copy of the database.</span></span>

<span data-ttu-id="2e7f6-148">Существует множество средств для создания скрипта SQL базовой версии.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-148">There are a variety of tools at your disposal to generate a SQL script of the baseline version.</span></span> <span data-ttu-id="2e7f6-149">В SQL Server Management Studio (SSMS) можно щелкнуть правой кнопкой мыши базу данных, открыть подменю задачи и выбрать параметр Создать скрипты.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-149">From SQL Server Management Studio (SSMS) you can right-click on the database, go to the Tasks submenu, and choose the Generate Scripts option.</span></span> <span data-ttu-id="2e7f6-150">Запустится мастер скриптов, который позволит создать файл, содержащий команды SQL для создания объектов базы данных.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-150">This launches the Script Wizard, which you can instruct to generate a file that contains the SQL commands to create your database s objects.</span></span> <span data-ttu-id="2e7f6-151">Другой вариант — Мастер публикации баз данных, который может создавать команды SQL, чтобы не только создать схему базы данных, но и данные в таблицах базы данных.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-151">Another option is the Database Publishing Wizard, which can generate the SQL commands to not only create the database schema, but also the data in the database tables.</span></span> <span data-ttu-id="2e7f6-152">Мастер публикации баз данных был подробно проанализирован в учебнике *развертывание базы данных* .</span><span class="sxs-lookup"><span data-stu-id="2e7f6-152">The Database Publishing Wizard was examined in detail back in the *Deploying a Database* tutorial.</span></span> <span data-ttu-id="2e7f6-153">Независимо от используемого средства в конце должен быть файл скрипта, который можно использовать для повторного создания базовой версии базы данных, если это необходимо.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-153">Regardless of what tool you use, in the end you should have a script file that you can use to recreate the baseline version of your database, should the need arise.</span></span>

## <a name="documenting-the-database-changes-in-prose"></a><span data-ttu-id="2e7f6-154">Документирование изменений базы данных в Prose</span><span class="sxs-lookup"><span data-stu-id="2e7f6-154">Documenting the Database Changes in Prose</span></span>

<span data-ttu-id="2e7f6-155">Самый простой способ сохранить журнал изменений в модели данных на этапе разработки — записать изменения в prose.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-155">The simplest way to maintain a log of changes to the data model during the development phase is to record the changes in prose.</span></span> <span data-ttu-id="2e7f6-156">Например, если во время разработки уже развернутого приложения вы добавляете новый столбец в `Employees` таблицу, удаляете столбец из таблицы `Orders` и добавляете новую таблицу (`ProductCategories`), вы сохраняете текстовый файл или документ Microsoft Word со следующим журналом:</span><span class="sxs-lookup"><span data-stu-id="2e7f6-156">For example, if during development of an already-deployed application you add a new column to the `Employees` table, remove a column from the `Orders` table, and add a new table (`ProductCategories`), you would maintain a text file or Microsoft Word document with the following history:</span></span>

<a id="0.4_table01"></a>

| <span data-ttu-id="2e7f6-157">**Дата изменения**</span><span class="sxs-lookup"><span data-stu-id="2e7f6-157">**Change Date**</span></span> | <span data-ttu-id="2e7f6-158">**Изменить сведения**</span><span class="sxs-lookup"><span data-stu-id="2e7f6-158">**Change Details**</span></span> |
| --- | --- |
| <span data-ttu-id="2e7f6-159">2009-02-03:</span><span class="sxs-lookup"><span data-stu-id="2e7f6-159">2009-02-03:</span></span> | <span data-ttu-id="2e7f6-160">В таблицу `Employees` добавлен столбец `DepartmentID` (`int`, а не NULL).</span><span class="sxs-lookup"><span data-stu-id="2e7f6-160">Added column `DepartmentID` (`int`, NOT NULL) to the `Employees` table.</span></span> <span data-ttu-id="2e7f6-161">Добавлено ограничение внешнего ключа из `Departments.DepartmentID` в `Employees.DepartmentID`.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-161">Added a foreign key constraint from `Departments.DepartmentID` to `Employees.DepartmentID`.</span></span> |
| <span data-ttu-id="2e7f6-162">2009-02-05:</span><span class="sxs-lookup"><span data-stu-id="2e7f6-162">2009-02-05:</span></span> | <span data-ttu-id="2e7f6-163">Удален столбец `TotalWeight` из таблицы `Orders`.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-163">Removed column `TotalWeight` from the `Orders` table.</span></span> <span data-ttu-id="2e7f6-164">Данные, уже захваченные в связанных записях `OrderDetails`.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-164">Data already captured in associated `OrderDetails` records.</span></span> |
| <span data-ttu-id="2e7f6-165">2009-02-12:</span><span class="sxs-lookup"><span data-stu-id="2e7f6-165">2009-02-12:</span></span> | <span data-ttu-id="2e7f6-166">Создана таблица `ProductCategories`.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-166">Created the `ProductCategories` table.</span></span> <span data-ttu-id="2e7f6-167">Существует три столбца: `ProductCategoryID` (`int`, `IDENTITY`, `NOT NULL`), `CategoryName` (`nvarchar(50)`, `NOT NULL`) и `Active` (`bit`, `NOT NULL`).</span><span class="sxs-lookup"><span data-stu-id="2e7f6-167">There are three columns: `ProductCategoryID` (`int`, `IDENTITY`, `NOT NULL`), `CategoryName` (`nvarchar(50)`, `NOT NULL`), and `Active` (`bit`, `NOT NULL`).</span></span> <span data-ttu-id="2e7f6-168">Для `ProductCategoryID`Добавлено ограничение первичного ключа, а для `Active`значение по умолчанию — 1.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-168">Added a primary key constraint to `ProductCategoryID`, and a default value of 1 to `Active`.</span></span> |

<span data-ttu-id="2e7f6-169">Этот подход имеет ряд недостатков.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-169">There are a number of drawbacks to this approach.</span></span> <span data-ttu-id="2e7f6-170">Для начинающих не существует никаких предникаких средств для автоматизации.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-170">For starters, there is no hope for automation.</span></span> <span data-ttu-id="2e7f6-171">Каждый раз, когда эти изменения необходимо применить к базе данных, например при развертывании приложения, разработчик должен вручную реализовать каждое изменение по одному.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-171">Anytime these changes need to be applied to a database - such as when the application is deployed - a developer must manually implement each change, one at a time.</span></span> <span data-ttu-id="2e7f6-172">Более того, если необходимо восстановить определенную версию базы данных из базового плана с помощью журнала изменений, то это займет больше времени, чем растет размер журнала.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-172">Moreover, if you need to reconstruct a particular version of the database from the baseline using the change log, doing so will take more and more time as the size of the log grows.</span></span> <span data-ttu-id="2e7f6-173">Другой недостаток этого метода заключается в том, что ясность и уровень детализации каждой записи журнала изменений остается для человека, записывающего изменение.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-173">Another drawback to this method is that the clarity and level of detail of each change log entry is left to the person recording the change.</span></span> <span data-ttu-id="2e7f6-174">В группе с несколькими разработчиками некоторые разработчики могут создавать более подробные, более удобочитаемые и более точные записи, чем другие.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-174">In a team with multiple developers some may make more detailed, more readable, or more precise entries than others.</span></span> <span data-ttu-id="2e7f6-175">Кроме того, возможны опечатки и другие ошибки ввода данных, связанные с человеком.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-175">Also, typos and other human-related data entry errors are possible.</span></span>

<span data-ttu-id="2e7f6-176">Основное преимущество документирования изменений в базе данных в prose — простота.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-176">The primary benefit of documenting the database changes in prose is simplicity.</span></span> <span data-ttu-id="2e7f6-177">Вам не нужно знать синтаксис SQL для создания и изменения объектов базы данных.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-177">You don t need familiarity with the SQL syntax for creating and altering database objects.</span></span> <span data-ttu-id="2e7f6-178">Вместо этого можно записать изменения в prose и реализовать их с помощью графического пользовательского интерфейса SQL Server Management Studio s.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-178">Instead, you can record the changes in prose and implement them through SQL Server Management Studio s graphical user interface.</span></span>

<span data-ttu-id="2e7f6-179">Обслуживание журнала изменений в prose, конечно, не очень сложно и не будет работать с определенными проектами, например большими в области охвата, часто изменять модель данных или включать несколько разработчиков.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-179">Maintaining your change log in prose is, admittedly, not very sophisticated and won't work well with certain projects, such as ones that are large in scope, have frequent changes to the data model, or involve multiple developers.</span></span> <span data-ttu-id="2e7f6-180">Но я видел, что этот подход хорошо работает в небольших, односторонних проектах, которые имеют только случайные изменения в модели данных, и если у разработчика Solo нет строгого опыта в синтаксисе SQL для создания и изменения объектов базы данных.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-180">But I have seen this approach work quite well in small, one-man projects that have only occasional changes to the data model and where the solo developer does not have a strong background in the SQL syntax for creating and altering database objects.</span></span>

> [!NOTE]
> <span data-ttu-id="2e7f6-181">Хотя сведения в журнале изменений, технически, необходимы только до времени развертывания, я рекомендую сохранить историю изменений.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-181">While the information in the change log is, technically, only needed until deploy-time, I recommend keeping a history of changes.</span></span> <span data-ttu-id="2e7f6-182">Но вместо того, чтобы хранить один постоянно увеличивающийся файл журнала изменений, рассмотрите возможность наличия другого файла журнала изменений для каждой версии базы данных.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-182">But rather than maintaining a single, ever growing change log file, consider having a different change log file for each database version.</span></span> <span data-ttu-id="2e7f6-183">Обычно потребуется версия базы данных при каждом развертывании.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-183">Typically you will want to version the database each time it is deployed.</span></span> <span data-ttu-id="2e7f6-184">Сохраняя журнал изменений, вы можете, начиная с базового плана, повторно создавать любую версию базы данных, выполняя сценарии журнала изменений, начиная с версии 1, и продолжая до тех пор, пока не будет достигнута версия, которую необходимо создать заново.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-184">By maintaining a log of change logs you can, starting from the baseline, recreate any database version by executing the change log scripts starting from version 1 and continuing until you reach the version you need to recreate.</span></span>

## <a name="recording-the-sql-change-statements"></a><span data-ttu-id="2e7f6-185">Запись инструкций SQL Change</span><span class="sxs-lookup"><span data-stu-id="2e7f6-185">Recording the SQL Change Statements</span></span>

<span data-ttu-id="2e7f6-186">Основным недостатком поддержки журнала изменений в prose является отсутствие автоматизации.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-186">The primary drawback of maintaining the change log in prose is the lack of automation.</span></span> <span data-ttu-id="2e7f6-187">В идеале для реализации изменений базы данных в рабочей базе данных во время развертывания можно было бы просто нажать кнопку, чтобы выполнить сценарий, а не вручную выполнить список инструкций.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-187">Ideally, implementing the database changes to the production database at deploy-time would be as easy as clicking a button to execute a script rather than having to manually perform a list of instructions.</span></span> <span data-ttu-id="2e7f6-188">Такую автоматизацию можно выполнить, сохранив журнал изменений, содержащий команды SQL, используемые для изменения модели данных.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-188">Such automation is possible by maintaining a change log that contains those SQL commands used to alter the data model.</span></span>

<span data-ttu-id="2e7f6-189">Синтаксис SQL включает несколько инструкций для создания и изменения различных объектов базы данных.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-189">The SQL syntax includes a number of statements for creating and modifying various database objects.</span></span> <span data-ttu-id="2e7f6-190">Например, при выполнении [*инструкции CREATE TABLE*](https://msdn.microsoft.com/library/ms174979.aspx)создает новую таблицу с указанными столбцами и ограничениями.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-190">For example, the [*CREATE TABLE statement*](https://msdn.microsoft.com/library/ms174979.aspx), when executed, creates a new table with the specified columns and constraints.</span></span> <span data-ttu-id="2e7f6-191">[*Инструкция ALTER TABLE*](https://msdn.microsoft.com/library/ms190273.aspx) изменяет существующую таблицу, добавляя, удаляя или изменяя ее столбцы или ограничения.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-191">The [*ALTER TABLE statement*](https://msdn.microsoft.com/library/ms190273.aspx) modifies an existing table, adding, removing, or modifying its columns or constraints.</span></span> <span data-ttu-id="2e7f6-192">Существуют также инструкции для создания, изменения и удаления индексов, представлений, определяемых пользователем функций, хранимых процедур, триггеров и других объектов базы данных.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-192">There are also statements to create, modify, and drop indexes, views, user-defined functions, stored procedures, triggers, and other database objects.</span></span>

<span data-ttu-id="2e7f6-193">Вернувшись к предыдущему примеру, образ, который во время разработки уже развернутого приложения добавляет новый столбец в `Employees` таблицу, удаляет столбец из таблицы `Orders` и добавляет новую таблицу (`ProductCategories`).</span><span class="sxs-lookup"><span data-stu-id="2e7f6-193">Returning to our earlier example, image that during development of an already-deployed application you add a new column to the `Employees` table, remove a column from the `Orders` table, and add a new table (`ProductCategories`).</span></span> <span data-ttu-id="2e7f6-194">Такие действия приведут к созданию файла журнала изменений с помощью следующих команд SQL:</span><span class="sxs-lookup"><span data-stu-id="2e7f6-194">Such actions would result in a change log file with the following SQL commands:</span></span>

[!code-sql[Main](strategies-for-database-development-and-deployment-cs/samples/sample1.sql)]

<span data-ttu-id="2e7f6-195">Принудительная отправка этих изменений в рабочую базу данных во время развертывания — это операция, выполняемая одним щелчком: откройте SQL Server Management Studio, подключитесь к рабочей базе данных, откройте новое окно запроса, вставьте содержимое журнала изменений и нажмите кнопку выполнить, чтобы запустить скрипт.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-195">Pushing these changes to the production database at deploy-time is a one-click operation: open SQL Server Management Studio, connect to your production database, open a New Query window, paste the contents of the change log, and click Execute to run the script.</span></span>

## <a name="using-a-comparison-tool-to-synchronize-the-data-models"></a><span data-ttu-id="2e7f6-196">Использование средства сравнения для синхронизации моделей данных</span><span class="sxs-lookup"><span data-stu-id="2e7f6-196">Using a Comparison Tool to Synchronize the Data Models</span></span>

<span data-ttu-id="2e7f6-197">Документирование изменений в базе данных в prose несложно, но реализация изменений требует от разработчика вносить каждое изменение в рабочую базу данных по одному за раз. Документирование команд изменений SQL упрощает реализацию этих изменений в рабочей базе данных и позволяет быстро и просто нажать кнопку, но требует изучения инструкций SQL и синтаксиса для создания и изменения объектов базы данных.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-197">Documenting database changes in prose is easy, but implementing the changes requires a developer to make each change on the production database one at a time; documenting the change SQL commands makes implementing those changes on the production database as easy and quick as clicking a button, but requires learning and mastering the SQL statements and syntax for creating and altering database objects.</span></span> <span data-ttu-id="2e7f6-198">Средства сравнения баз данных лучше использовать оба подхода и отбросить худшее.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-198">Database comparison tools take the best from both approaches and discard the worst.</span></span>

<span data-ttu-id="2e7f6-199">Средство сравнения баз данных сравнивает схему или данные двух баз данных и отображает сводный отчет, в котором показано, как отличаются базы данных.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-199">A database comparison tool compares the schema or data of two databases and displays a summary report showing you how the databases differ.</span></span> <span data-ttu-id="2e7f6-200">Затем, нажав кнопку, можно создать команды SQL для синхронизации одного или нескольких объектов базы данных.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-200">Then, with the click of a button, you can generate the SQL commands for synchronizing one or more database objects.</span></span> <span data-ttu-id="2e7f6-201">В двух словах, средство сравнения баз данных можно использовать для сравнения баз данных разработки и рабочей среды во время развертывания, создавая файл, содержащий команды SQL, которые при исполнении применяют изменения к схеме рабочей базы данных, чтобы она отражает схему базы данных разработки.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-201">In a nutshell, you can use a database comparison tool to compare the development and production databases at deploy-time, generating a file that contains the SQL commands that, when executed, will apply the changes to the production database s schema so that it mirrors the development database s schema.</span></span>

<span data-ttu-id="2e7f6-202">Существует множество сторонних средств сравнения баз данных, предлагаемых многими разными поставщиками.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-202">There are a variety of third-party database comparison tools offered by many different vendors.</span></span> <span data-ttu-id="2e7f6-203">Одним из таких примеров является [*Сравнение SQL*](http://www.red-gate.com/products/SQL_Compare/)с помощью [*программного обеспечения Красного шлюза*](http://www.red-gate.com/).</span><span class="sxs-lookup"><span data-stu-id="2e7f6-203">One such example is [*SQL Compare*](http://www.red-gate.com/products/SQL_Compare/), by [*Red Gate Software*](http://www.red-gate.com/).</span></span> <span data-ttu-id="2e7f6-204">Давайте разберем процесс использования сравнения SQL для сравнения и синхронизации схем разработки и рабочей базы данных.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-204">Let s walk through the process of using SQL Compare to compare and synchronize the development and production databases schemas.</span></span>

> [!NOTE]
> <span data-ttu-id="2e7f6-205">На момент написания этой статьи в качестве текущей версии SQL Compare использовалась версия 7,1 со стандартными затратами на выпуск $395.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-205">At the time of this writing the current version of SQL Compare was version 7.1, with the Standard Edition costing $395.</span></span> <span data-ttu-id="2e7f6-206">Вы можете выполнить процедуру, загрузив бесплатную 14-дневную пробную версию.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-206">You can follow along by downloading a free 14-day trial.</span></span>

<span data-ttu-id="2e7f6-207">При запуске сравнения SQL открывается диалоговое окно проекты сравнения, в котором отображаются сохраненные проекты SQL Compare.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-207">When SQL Compare starts the Comparison Projects dialog box opens, showing the saved SQL Compare projects.</span></span> <span data-ttu-id="2e7f6-208">Создайте новый проект.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-208">Create a new project.</span></span> <span data-ttu-id="2e7f6-209">Запустится мастер настройки проекта, в котором запрашиваются сведения о сравниваемых базах данных (см. рис. 1).</span><span class="sxs-lookup"><span data-stu-id="2e7f6-209">This launches the Project Configuration wizard, which prompts for information about the databases to compare (see Figure 1).</span></span> <span data-ttu-id="2e7f6-210">Введите сведения для баз данных разработки и рабочей среды.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-210">Enter the information for the development and production environment databases.</span></span>

<span data-ttu-id="2e7f6-211">[![сравнения баз данных разработки и рабочей среды](strategies-for-database-development-and-deployment-cs/_static/image2.jpg)](strategies-for-database-development-and-deployment-cs/_static/image1.jpg)</span><span class="sxs-lookup"><span data-stu-id="2e7f6-211">[![Compare the Development and Production Databases](strategies-for-database-development-and-deployment-cs/_static/image2.jpg)](strategies-for-database-development-and-deployment-cs/_static/image1.jpg)</span></span>

<span data-ttu-id="2e7f6-212">**Рис. 1**. Сравнение баз данных для разработки и рабочей среды ([щелкните, чтобы просмотреть изображение с полным размером](strategies-for-database-development-and-deployment-cs/_static/image3.jpg))</span><span class="sxs-lookup"><span data-stu-id="2e7f6-212">**Figure 1**: Compare the Development and Production Databases ([Click to view full-size image](strategies-for-database-development-and-deployment-cs/_static/image3.jpg))</span></span>

> [!NOTE]
> <span data-ttu-id="2e7f6-213">Если база данных среды разработки представляет собой файл базы данных SQL Express Edition, расположенный в папке `App_Data` веб-сайта, необходимо зарегистрировать базу данных на сервере базы данных SQL Server Express, чтобы выбрать ее из диалогового окна, показанного на рис. 1.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-213">If your development environment database is a SQL Express Edition database file in the `App_Data` folder of your website you will need to register the database in the SQL Server Express database server in order to select it from the dialog box shown in Figure 1.</span></span> <span data-ttu-id="2e7f6-214">Самый простой способ сделать это — открыть SQL Server Management Studio (SSMS), подключиться к серверу базы данных SQL Server Express и присоединить базу данных.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-214">The easiest way to accomplish this is to open SQL Server Management Studio (SSMS), connect to the SQL Server Express database server, and attach the database.</span></span> <span data-ttu-id="2e7f6-215">Если на компьютере не установлена среда SSMS, можно загрузить и установить бесплатную [*версию бесплатной SQL Server 2008 Management Studio Basic*](https://www.microsoft.com/downloads/details.aspx?FamilyId=7522A683-4CB2-454E-B908-E805E9BD4E28&amp;displaylang=en).</span><span class="sxs-lookup"><span data-stu-id="2e7f6-215">If you do not have SSMS installed on your computer you can download and install the free [*SQL Server 2008 Management Studio Basic version*](https://www.microsoft.com/downloads/details.aspx?FamilyId=7522A683-4CB2-454E-B908-E805E9BD4E28&amp;displaylang=en).</span></span>

<span data-ttu-id="2e7f6-216">Помимо выбора сравниваемых баз данных, на вкладке Параметры можно также указать различные параметры сравнения. Одним из вариантов, который вы можете включить, является "игнорировать ограничения и имена индексов".</span><span class="sxs-lookup"><span data-stu-id="2e7f6-216">In addition to selecting the databases to compare, you can also specify a variety of comparison settings from the Options tab. One option you may want to turn on is the "Ignore constraint and index names."</span></span> <span data-ttu-id="2e7f6-217">Вспомним, что в предыдущем руководстве мы добавили объекты базы данных служб приложений в базы данных разработки и рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-217">Recall that in the preceding tutorial we added the application services database objects to the development and production databases.</span></span> <span data-ttu-id="2e7f6-218">Если для создания этих объектов в рабочей базе данных использовалось средство `aspnet_regsql.exe`, вы обнаружите, что имена первичного ключа и уникального ограничения между базами данных разработки и рабочей базой различаются.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-218">If you used the `aspnet_regsql.exe` tool to create these objects on the production database then you will find that the primary key and unique constraint names differ between the development and production databases.</span></span> <span data-ttu-id="2e7f6-219">Следовательно, SQL Compare пометит все таблицы служб приложений как отличающиеся.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-219">Consequently, SQL Compare will flag all of the application services tables as differing.</span></span> <span data-ttu-id="2e7f6-220">Можно либо оставить флажок игнорировать ограничения и имена индексов неустановленным и синхронизировать имена ограничений, либо поручить SQL Compare игнорировать эти различия.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-220">You can either leave the "Ignore constraint and index names" unchecked and synchronize the constraint names, or instruct SQL Compare to ignore these differences.</span></span>

<span data-ttu-id="2e7f6-221">Выбрав базы данных для сравнения (и просмотрев параметры сравнения), нажмите кнопку сравнить Now, чтобы начать сравнение.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-221">After selecting the databases to compare (and reviewing the comparison options), click the Compare Now button to begin the comparison.</span></span> <span data-ttu-id="2e7f6-222">В течение следующих нескольких секунд сравнение SQL анализирует схемы двух баз данных и формирует отчет о том, как они отличаются.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-222">Over the next several seconds, SQL Compare examines the schemas of the two databases and generates a report of how they differ.</span></span> <span data-ttu-id="2e7f6-223">Я сохранил намеренно, внеся некоторые изменения в базу данных разработки, чтобы продемонстрировать, как эти несоответствия отмечены в интерфейсе SQL Compare.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-223">I ve purposefully made some modifications to the development database to show how such discrepancies are noted in the SQL Compare interface.</span></span> <span data-ttu-id="2e7f6-224">Как показано на рис. 2, я добавил столбец `BirthDate` в таблицу `Authors`, удалил столбец `ISBN` из таблицы `Books` и добавил новую таблицу `Ratings`, которая позволяет пользователям посетить веб-сайт, оценить прорецензированные книги.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-224">As Figure 2 shows, I ve added a `BirthDate` column to the `Authors` table, removed the `ISBN` column from the `Books` table, and added a new table, `Ratings`, which is meant to let users visiting the site rate the reviewed books.</span></span>

> [!NOTE]
> <span data-ttu-id="2e7f6-225">Изменения модели данных, внесенные в этом руководстве, иллюстрируют использование средства сравнения баз данных.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-225">The data model changes made in this tutorial were done to illustrate using a database comparison tool.</span></span> <span data-ttu-id="2e7f6-226">Эти изменения не будут найдены в базе данных в следующих учебных курсах.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-226">You will not find these changes in the database in future tutorials.</span></span>

<span data-ttu-id="2e7f6-227">[![SQL Compare перечисляет различия между базами данных разработки и рабочей базой](strategies-for-database-development-and-deployment-cs/_static/image5.jpg)](strategies-for-database-development-and-deployment-cs/_static/image4.jpg)</span><span class="sxs-lookup"><span data-stu-id="2e7f6-227">[![SQL Compare Lists the Differences Between the Development and Production Databases](strategies-for-database-development-and-deployment-cs/_static/image5.jpg)](strategies-for-database-development-and-deployment-cs/_static/image4.jpg)</span></span>

<span data-ttu-id="2e7f6-228">**Рис. 2**. Сравнение баз данных Development и Production в SQL Compare ([щелкните, чтобы просмотреть изображение с полным размером](strategies-for-database-development-and-deployment-cs/_static/image6.jpg))</span><span class="sxs-lookup"><span data-stu-id="2e7f6-228">**Figure 2**: SQL Compare Lists the Differences Between the Development and Production Databases ([Click to view full-size image](strategies-for-database-development-and-deployment-cs/_static/image6.jpg))</span></span>

<span data-ttu-id="2e7f6-229">SQL Compare разделяет объекты базы данных на группы, быстро отображая объекты, существующие в обеих базах данных, но разные объекты, которые находятся в одной базе данных, но не являются объектами, и какие объекты идентичны.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-229">SQL Compare breaks down the database objects into groups, quickly showing you what objects exist in both databases but are different, which objects exist in one database but not the other, and which objects are identical.</span></span> <span data-ttu-id="2e7f6-230">Как видите, существуют два объекта, которые существуют в обеих базах данных, но различаются: таблица `Authors`, в которой был добавлен столбец, и таблица `Books`, в которой была удалена одна.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-230">As you can see, there are two objects that exist in both databases but are different: the `Authors` table, which had a column added, and the `Books` table, which had one removed.</span></span> <span data-ttu-id="2e7f6-231">Существует один объект, который существует только в базе данных разработки, а именно вновь созданной `Ratings` таблице.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-231">There is one object that exists only in the development database, namely the newly created `Ratings` table.</span></span> <span data-ttu-id="2e7f6-232">И существует 117 объектов, идентичных в обеих базах данных.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-232">And there are 117 objects that are identical in both databases.</span></span>

<span data-ttu-id="2e7f6-233">При выборе объекта базы данных отображается окно различия в SQL, в котором показано, как эти объекты отличаются.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-233">Selecting a database object displays the SQL Differences window, which shows how these objects differ.</span></span> <span data-ttu-id="2e7f6-234">Окно "различия в SQL", отображаемое в нижней части на рис. 2, демонстрирует, что таблица `Authors` в базе данных разработки содержит столбец `BirthDate`, который не найден в таблице `Authors` в рабочей базе данных.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-234">The SQL Differences window, displayed at the bottom in Figure 2, highlights that the `Authors` table in the development database has the `BirthDate` column, which is not found in the `Authors` table on the production database.</span></span>

<span data-ttu-id="2e7f6-235">После рассмотрения различий и выбора объектов, которые необходимо синхронизировать, следующим шагом является создание команд SQL, необходимых для обновления схемы рабочей базы данных в соответствии с базой данных разработки.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-235">After reviewing the differences and selecting which objects you want to synchronize, the next step is to generate the SQL commands needed to update the production database s schema to match the development database.</span></span> <span data-ttu-id="2e7f6-236">Это выполняется с помощью мастера синхронизации.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-236">This is accomplished through the Synchronization Wizard.</span></span> <span data-ttu-id="2e7f6-237">Мастер синхронизации подтверждает, какие объекты следует синхронизировать, и суммирует план действий (см. рис. 3).</span><span class="sxs-lookup"><span data-stu-id="2e7f6-237">The Synchronization Wizard confirms what objects to synchronize and summarizes the action plan (see Figure 3).</span></span> <span data-ttu-id="2e7f6-238">Можно немедленно синхронизировать базы данных или создать скрипт с командами SQL, которые можно запустить в свободное время.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-238">You can synchronize the databases immediately or generate a script with the SQL commands that can be run at your leisure.</span></span>

<span data-ttu-id="2e7f6-239">[![использовании мастера синхронизации для синхронизации схем баз данных](strategies-for-database-development-and-deployment-cs/_static/image8.jpg)](strategies-for-database-development-and-deployment-cs/_static/image7.jpg)</span><span class="sxs-lookup"><span data-stu-id="2e7f6-239">[![Use the Synchronization Wizard to Synchronize Your Databases Schemas](strategies-for-database-development-and-deployment-cs/_static/image8.jpg)](strategies-for-database-development-and-deployment-cs/_static/image7.jpg)</span></span>

<span data-ttu-id="2e7f6-240">**Рис. 3**. синхронизация схем баз данных с помощью мастера синхронизации ([щелкните, чтобы просмотреть изображение с полным размером](strategies-for-database-development-and-deployment-cs/_static/image9.jpg))</span><span class="sxs-lookup"><span data-stu-id="2e7f6-240">**Figure 3**: Use the Synchronization Wizard to Synchronize Your Databases Schemas ([Click to view full-size image](strategies-for-database-development-and-deployment-cs/_static/image9.jpg))</span></span>

<span data-ttu-id="2e7f6-241">Средства сравнения баз данных, такие как сравнение SQL с помощью Red Gate, применяют изменения к схеме базы данных разработки в рабочую базу данных так же просто, как и щелчок.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-241">Database comparison tools like Red Gate Software s SQL Compare make applying the changes to the development database schema to the production database as easy as point and click.</span></span>

> [!NOTE]
> <span data-ttu-id="2e7f6-242">SQL Compare сравнивает и синхронизирует две *схемы*баз данных.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-242">SQL Compare compares and synchronizes two databases *schemas*.</span></span> <span data-ttu-id="2e7f6-243">К сожалению, она не сравнивает и не синхронизирует данные в двух таблицах базы данных.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-243">Unfortunately, it does not compare and synchronize the data within two databases tables.</span></span> <span data-ttu-id="2e7f6-244">В программном обеспечении "Красное шлюз" предлагается продукт с именем [*SQL Data Compare*](http://www.red-gate.com/products/SQL_Data_Compare/) , который сравнивает и синхронизирует данные между двумя базами данных, но это отдельный продукт от SQL Compare и другие затраты $395.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-244">Red Gate Software does offer a product named [*SQL Data Compare*](http://www.red-gate.com/products/SQL_Data_Compare/) that compares and synchronizes the data between two databases, but it is a separate product from SQL Compare and costs another $395.</span></span>

## <a name="taking-the-application-offline-during-deployment"></a><span data-ttu-id="2e7f6-245">Перевод приложения в автономный режим во время развертывания</span><span class="sxs-lookup"><span data-stu-id="2e7f6-245">Taking the Application Offline During Deployment</span></span>

<span data-ttu-id="2e7f6-246">Как мы видели в этих учебниках, развертывание — это процесс, включающий в себя несколько этапов: копирование страниц ASP.NET, главных страниц, CSS-файлов, файлов JavaScript, изображений и другого необходимого содержимого из среды разработки в рабочую среду. PXE При необходимости скопируйте сведения о конфигурации рабочей среды. и применение изменений к модели данных с момента последнего развертывания.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-246">As we ve seen throughout these tutorials, deployment is a process that involves multiple steps: copying the ASP.NET pages, master pages, CSS files, JavaScript files, images, and other necessary content from the development environment to the production environment; copying up the production environment-specific configuration information, if needed; and applying the changes to the data model since the last deployment.</span></span> <span data-ttu-id="2e7f6-247">В зависимости от количества файлов и сложности изменений базы данных выполнение этих действий может занять от нескольких секунд до нескольких минут.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-247">Depending on the number of files and the complexity of your database changes, these steps can take anywhere from a few seconds to several minutes to complete.</span></span> <span data-ttu-id="2e7f6-248">В этом окне веб-приложение находится в Flux, а пользователи, посещающие сайт, могут столкнуться с ошибками или непредвиденным поведением.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-248">During this window the web application is in flux and users visiting the site may experience errors or unexpected behavior.</span></span>

<span data-ttu-id="2e7f6-249">При развертывании веб-сайта лучше перевести веб-приложение в автономный режим до завершения развертывания.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-249">When deploying a website it is best to take the web application "offline" until deployment has completed.</span></span> <span data-ttu-id="2e7f6-250">Перевод приложения в автономный режим (и его восстановление после завершения процесса развертывания) — это так же просто, как передача файла и последующее его удаление.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-250">Taking the application offline (and bringing it back up once the deployment process has finished) is as easy as uploading a file and then deleting it.</span></span> <span data-ttu-id="2e7f6-251">Начиная с ASP.NET 2,0, достаточное присутствие файла с именем `app_offline.htm` в корневом каталоге приложения переводит весь веб-сайт в автономный режим.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-251">Starting with ASP.NET 2.0, the mere presence of a file named `app_offline.htm` in the application s root directory takes the entire website "offline."</span></span> <span data-ttu-id="2e7f6-252">Любой запрос к странице ASP.NET на этом сайте автоматически подает ответ с содержимым файла `app_offline.htm`.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-252">Any request to an ASP.NET page on that site is automatically responded with the contents of the `app_offline.htm` file.</span></span> <span data-ttu-id="2e7f6-253">После удаления файла приложение возвращается в режим «в сети».</span><span class="sxs-lookup"><span data-stu-id="2e7f6-253">Once that file is removed, the application comes back online.</span></span>

<span data-ttu-id="2e7f6-254">Перевод приложения в автономный режим во время развертывания — это просто передача файла `app_offline.htm` в корневой каталог рабочей среды до начала процесса развертывания, а затем его удаление (или переименование в другом месте) после завершения развертывания.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-254">Taking an application offline during deployment, then, is as simple as uploading an `app_offline.htm` file to the production environment s root directory prior to beginning the deployment process and then deleting it (or renaming it to something else) once deployment is complete.</span></span> <span data-ttu-id="2e7f6-255">Дополнительные сведения об этом способе см. в статье Джон Петерсон s (перевод [*приложения ASP.NET в автономный режим*](http://www.15seconds.com/issue/061207.htm)).</span><span class="sxs-lookup"><span data-stu-id="2e7f6-255">For more information on this technique refer to John Peterson s article, Taking an [*ASP.NET Application Offline*](http://www.15seconds.com/issue/061207.htm).</span></span>

## <a name="summary"></a><span data-ttu-id="2e7f6-256">Сводка</span><span class="sxs-lookup"><span data-stu-id="2e7f6-256">Summary</span></span>

<span data-ttu-id="2e7f6-257">Основной задачей при развертывании центров приложений на основе данных, связанных с развертыванием базы данных.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-257">The main challenge in deploying a data-driven application centers around deploying the database.</span></span> <span data-ttu-id="2e7f6-258">Поскольку существует две версии базы данных — одна в среде разработки, а другая — в рабочей среде, эти две схемы баз данных могут стать синхронизированными, так как новые функции добавляются в разработку.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-258">Because there are two versions of the database - one in the development environment and one in the production environment - these two databases schemas can become out of sync as new features are added in development.</span></span> <span data-ttu-id="2e7f6-259">Что еще больше, поскольку Рабочая база данных заполняется реальными данными от реальных пользователей, нельзя перезаписывать рабочую базу данных с измененной базой данных разработки, как при развертывании файлов, составляющих приложение (страницы ASP.NET). файлы изображений и т. д.).</span><span class="sxs-lookup"><span data-stu-id="2e7f6-259">What s more, because the production database as being populated with real data from real users, you cannot overwrite the production database with the modified development database like you can when deploying the files that make up the application (the ASP.NET pages, image files, and so forth).</span></span> <span data-ttu-id="2e7f6-260">Вместо этого развертывание базы данных влечет за собой реализацию точного набора изменений, внесенных в базу данных разработки в рабочей базе данных с момента последнего развертывания.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-260">Instead, deploying a database entails implementing the precise set of changes made to the development database on the production database since the last deployment.</span></span>

<span data-ttu-id="2e7f6-261">В этом учебнике рассмотрены три методики обслуживания и применения журнала изменений в базе данных.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-261">This tutorial looked at three techniques for maintaining and applying a log of database changes.</span></span> <span data-ttu-id="2e7f6-262">Самый простой подход — записать изменения в prose.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-262">The simplest approach is to record the changes in prose.</span></span> <span data-ttu-id="2e7f6-263">Хотя эта способов делает реализацию этих изменений в рабочей базе данных в ручном режиме, ей не требуются знания о командах SQL для создания и изменения объектов базы данных.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-263">While this tactic makes implementing these changes on the production database a manual process, it does not require knowledge of the SQL commands for creating and altering database objects.</span></span> <span data-ttu-id="2e7f6-264">Более сложный подход, который гораздо более терпима в крупных проектах или проектах с несколькими разработчиками, заключается в записи изменений в виде последовательности команд SQL.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-264">A more sophisticated approach, and one that is much more palatable in larger projects or projects with multiple developers, is to record the changes as a series of SQL commands.</span></span> <span data-ttu-id="2e7f6-265">Это значительно хастенс эти изменения в целевую базу данных.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-265">This greatly hastens rolling out these changes to the target database.</span></span> <span data-ttu-id="2e7f6-266">Лучшее из обоих подходов можно достичь с помощью средства сравнения баз данных, такого как "Сравнение SQL" по сравнению с Red Gate.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-266">The best of both approaches can be achieved by using a database comparison tool, such as Red Gate Software s SQL Compare.</span></span>

<span data-ttu-id="2e7f6-267">В этом руководстве мы заключительным руководством по развертыванию приложения, управляемого данными.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-267">This tutorial concludes our focus on deploying a data-driven application.</span></span> <span data-ttu-id="2e7f6-268">В следующем наборе руководств рассматриваются способы реагирования на ошибки в рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-268">The next set of tutorials looks at how to respond to errors in the production environment.</span></span> <span data-ttu-id="2e7f6-269">Мы рассмотрим, как отобразить понятную страницу ошибки вместо желтого экрана смерти.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-269">We'll look at how to display a friendly error page rather instead of the Yellow Screen of Death.</span></span> <span data-ttu-id="2e7f6-270">Мы покажем, как заносить в журнал сведения об ошибках и как оповещать вас при возникновении таких ошибок.</span><span class="sxs-lookup"><span data-stu-id="2e7f6-270">And we'll see how to log the error s details and how to alert you when such errors occur.</span></span>

<span data-ttu-id="2e7f6-271">Поздравляем с программированием!</span><span class="sxs-lookup"><span data-stu-id="2e7f6-271">Happy Programming!</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="2e7f6-272">[Назад](configuring-a-website-that-uses-application-services-cs.md)
> [Вперед](displaying-a-custom-error-page-cs.md)</span><span class="sxs-lookup"><span data-stu-id="2e7f6-272">[Previous](configuring-a-website-that-uses-application-services-cs.md)
[Next](displaying-a-custom-error-page-cs.md)</span></span>
