---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/logging-error-details-with-elmah-vb
title: Ведение журнала сведений об ошибках с помощью ELMAH (VB) | Документация Майкрософт
author: rick-anderson
description: Модули и обработчики ведения журнала ошибок (ELMAH) предлагают другой подход к регистрации ошибок времени выполнения в рабочей среде. ELMAH — это бесплатная ошибка с открытым кодом...
ms.author: riande
ms.date: 06/09/2009
ms.assetid: a5f0439f-18b2-4c89-96ab-75b02c616f46
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/logging-error-details-with-elmah-vb
msc.type: authoredcontent
ms.openlocfilehash: 46b7fc22807c8cb9f47ff035639815d7b6104735
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/28/2019
ms.locfileid: "74622241"
---
# <a name="logging-error-details-with-elmah-vb"></a>Запись в журнал сведений об ошибках с помощью ELMAH (VB)

по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Скачать код](https://download.microsoft.com/download/1/0/C/10CC829F-A808-4302-97D3-59989B8F9C01/ASPNET_Hosting_Tutorial_14_VB.zip) или [скачать PDF](https://download.microsoft.com/download/5/C/5/5C57DB8C-5DEA-4B3A-92CA-4405544D313B/aspnet_tutorial14_ELMAH_vb.pdf)

> Модули и обработчики ведения журнала ошибок (ELMAH) предлагают другой подход к регистрации ошибок времени выполнения в рабочей среде. ELMAH — это бесплатная библиотека регистрации ошибок с открытым исходным кодом, которая включает в себя такие функции, как фильтрация ошибок и возможность просмотра журнала ошибок с веб-страницы, в виде RSS-канала или загрузки в виде файла, разделенного запятыми. В этом руководстве описывается загрузка и настройка ELMAH.

## <a name="introduction"></a>Введение

[Предыдущее руководство](logging-error-details-with-asp-net-health-monitoring-vb.md) было проверено на ASP. Система мониторинга работоспособности сети, которая предоставляет собственную библиотеку для записи широкого массива веб-событий. Многие разработчики используют мониторинг работоспособности для ведения журнала и отправки сведений о необработанных исключениях. Однако в этой системе есть несколько проблем. Первая и самое главное — отсутствие какого-либо пользовательского интерфейса для просмотра сведений о зарегистрированных событиях. Если вы хотите просмотреть сводку по 10 последним ошибкам или просмотреть подробные сведения об ошибке, возникшей за прошлую неделю, необходимо либо выполнить поиск по базе данных, либо просмотреть ее в папке "Входящие" электронной почты, либо создать веб-страницу, отображающую сведения из таблицы `aspnet_WebEvent_Events`.

Еще одна точка зрения заключается в направлении сложности мониторинга работоспособности. Так как наблюдение за работоспособностью можно использовать для записи множества различных событий, и, поскольку существует множество параметров для указания того, как и когда регистрируются события, правильная настройка системы мониторинга работоспособности может быть обременительным задачей. Наконец, существуют проблемы совместимости. Так как мониторинг работоспособности впервые был добавлен к .NET Framework в версии 2,0, он недоступен для старых веб-приложений, созданных с помощью ASP.NET версии 1. x. Более того, класс `SqlWebEventProvider`, который мы использовали в предыдущем руководстве для регистрации сведений об ошибках в базе данных, работает только с Microsoft SQL Server базами данных. Необходимо создать пользовательский класс регистратора, чтобы записывать ошибки в альтернативное хранилище данных, например в XML-файл или базу данных Oracle.

Альтернативой системы мониторинга работоспособности являются модули регистрации ошибок и обработчики (ELMAH) — бесплатная система регистрации ошибок с открытым кодом, созданная с помощью [Атиф Азиз](http://www.raboof.com/). Самым важным различием между двумя системами является способность ЕЛАМХ отображать список ошибок и подробные сведения о конкретной ошибке с веб-страницы и в виде RSS. ELMAH проще настроить, чем мониторинг работоспособности, так как он только регистрирует ошибки. Более того, ELMAH включает поддержку приложений ASP.NET 1. x, ASP.NET 2,0 и ASP.NET 3,5 и поставляется с различными поставщиками источников журналов.

В этом учебнике рассматриваются шаги, связанные с добавлением ELMAH в приложение ASP.NET. Приступим к работе!

> [!NOTE]
> Система мониторинга работоспособности и ELMAH имеют собственные наборы достоинств и недостатков. Я рекомендую опробовать обе системы и решить, какой из них наилучшим образом соответствует вашим потребностям.

## <a name="adding-elmah-to-an-aspnet-web-application"></a>Добавление ELMAH в веб-приложение ASP.NET

Интеграция ELMAH в новое или существующее приложение ASP.NET является простым и простым процессом, который занимает пять минут. Вкратце, он включает четыре простых шага:

1. Скачайте ELMAH и добавьте сборку `Elmah.dll` в веб-приложение,
2. Регистрация модулей HTTP и обработчика ELMAH в `Web.config`
3. Укажите параметры конфигурации ELMAH и
4. При необходимости создайте исходную инфраструктуру журнала ошибок.

Давайте рассмотрим каждый из этих четырех шагов, по одному за раз.

### <a name="step-1-downloading-the-elmah-project-files-and-addingelmahdllto-your-web-application"></a>Шаг 1. Загрузка файлов проекта ELMAH и добавление`Elmah.dll`в веб-приложение

ELMAH 1,0 BETA 3 (сборка 10617), последняя версия на момент написания статьи включается в загрузку, доступную в этом руководстве. Кроме того, вы можете посетить [веб-сайт ELMAH](https://code.google.com/p/elmah/) , чтобы получить последнюю версию или загрузить исходный код. Извлеките файл ELMAH в папку на рабочем столе и нахождение файла сборки ELMAH (`Elmah.dll`).

> [!NOTE]
> Файл `Elmah.dll` находится в папке `Bin` загрузки, которая содержит вложенные папки для разных версий .NET Framework, а также для сборок выпуска и отладки. Используйте сборку выпуска для соответствующей версии платформы. Например, если вы создаете веб-приложение ASP.NET 3,5, скопируйте файл `Elmah.dll` из папки `Bin\net-3.5\Release`.

Затем откройте Visual Studio и добавьте сборку в проект, щелкнув правой кнопкой мыши имя веб-сайта в обозреватель решений и выбрав пункт Добавить ссылку из контекстного меню. Откроется диалоговое окно Добавление ссылки. Перейдите на вкладку Обзор и выберите файл `Elmah.dll`. Это действие добавляет файл `Elmah.dll` в папку `Bin` веб-приложения.

> [!NOTE]
> Тип проекта веб-приложения (WAP) не отображает папку `Bin` в обозреватель решений. Вместо этого эти элементы перечисляются в папке References.

Сборка `Elmah.dll` включает классы, используемые системой ELMAH. Эти классы относятся к одной из трех категорий:

- **Модули HTTP** . http-модуль — это класс, определяющий обработчики событий для `HttpApplication` событий, таких как событие `Error`. ELMAH включает несколько модулей HTTP, три наиболее немецких из них: 

    - `ErrorLogModule` — записывает необработанные исключения в источник журнала.
    - `ErrorMailModule` — отправляет сведения о необработанном исключении в сообщении электронной почты.
    - `ErrorFilterModule` — применяет фильтры, заданные разработчиком, для определения того, какие исключения заносятся в журнал и какие из них игнорируются.
- **Обработчики HTTP** — обработчик HTTP — это класс, отвечающий за создание разметки для конкретного типа запроса. ELMAH включает обработчики HTTP, которые отображают сведения об ошибках в виде веб-канала, RSS или в виде файла с разделителями-запятыми (CSV).
- **Источники журнала ошибок** — из Box ELMAH может записывать ошибки в память, в базу данных Microsoft SQL Server, в базу данных Microsoft Access, в базу данных Oracle, в XML-файл, в базу данных SQLite или в базу данных Vista DB. Как и в системе мониторинга работоспособности, архитектура ELMAH была построена с использованием модели поставщика, что означает, что при необходимости можно создать и легко интегрировать собственные поставщики пользовательского источника журнала.

### <a name="step-2-registering-elmahs-http-module-and-handler"></a>Шаг 2. Регистрация модуля HTTP и обработчика ELMAH

Хотя файл `Elmah.dll` содержит модули HTTP и обработчик, необходимый для автоматического ведения журнала необработанных исключений, а также для вывода сведений об ошибках с веб-страницы, они должны быть явно зарегистрированы в конфигурации веб-приложения. После регистрации HTTP-модуль `ErrorLogModule` подписывается на событие `Error` `HttpApplication`. При возникновении этого события `ErrorLogModule` записывает сведения об исключении в указанный источник журнала. Мы посмотрим, как определить поставщика источника журнала в следующем разделе «Настройка ELMAH». Фабрика обработчиков HTTP `ErrorLogPageFactory` отвечает за создание разметки при просмотре журнала ошибок с веб-страницы.

Специальный синтаксис для регистрации модулей и обработчиков HTTP зависит от веб-сервера, который является его питанием. Для ASP.NET Development Server и служб Microsoft IIS версии 6,0 и более ранних версий модули HTTP и обработчики регистрируются в разделах `<httpModules>` и `<httpHandlers>`, которые отображаются в элементе `<system.web>`. Если вы используете IIS 7,0, то они должны быть зарегистрированы в разделах `<modules>` и `<handlers>` элемента `<system.webServer>`. К счастью, модули HTTP и обработчики можно определить в *обоих* местах независимо от используемого веб-сервера. Этот вариант является наиболее переносимым, так как позволяет использовать ту же конфигурацию в средах разработки и рабочей среде независимо от используемого веб-сервера.

Начните с регистрации HTTP-модуля `ErrorLogModule` и `ErrorLogPageFactory` обработчика HTTP в разделе `<httpModules>` и `<httpHandlers>` в `<system.web>`. Если в конфигурации уже определены эти два элемента, просто включите элемент `<add>` для модуля HTTP ELMAH и обработчика.

[!code-xml[Main](logging-error-details-with-elmah-vb/samples/sample1.xml)]

Затем зарегистрируйте модуль HTTP и обработчик ELMAH в элементе `<system.webServer>`. Как и ранее, если этот элемент еще не существует в конфигурации, добавьте его.

[!code-xml[Main](logging-error-details-with-elmah-vb/samples/sample2.xml)]

По умолчанию IIS 7 выдает ошибку, если модули и обработчики HTTP зарегистрированы в разделе `<system.web>`. Атрибут `validateIntegratedModeConfiguration` в элементе `<validation>` указывает IIS 7 подавлять такие сообщения об ошибках.

Обратите внимание, что синтаксис регистрации `ErrorLogPageFactory` обработчик HTTP-данных включает атрибут `path`, для которого задано значение `elmah.axd`. Этот атрибут информирует веб-приложение о том, что при поступлении запроса на страницу с именем `elmah.axd` запрос должен обрабатываться `ErrorLogPageFactory`ным обработчиком HTTP. Далее в этом учебнике вы увидите `ErrorLogPageFactory` обработчик HTTP в действии.

### <a name="step-3-configuring-elmah"></a>Шаг 3. Настройка ELMAH

ELMAH ищет параметры конфигурации в файле `Web.config` веб-сайта в пользовательском разделе конфигурации с именем `<elmah>`. Чтобы использовать пользовательский раздел в `Web.config` необходимо сначала определить его в элементе `<configSections>`. Откройте файл `Web.config` и добавьте в `<configSections>`следующую разметку:

[!code-xml[Main](logging-error-details-with-elmah-vb/samples/sample3.xml)]

> [!NOTE]
> Если вы настраиваете ELMAH для приложения ASP.NET 1. x, удалите атрибут `requirePermission="false"` из `<section>` элементов выше.

Приведенный выше синтаксис регистрирует пользовательский раздел `<elmah>` и его подразделы: `<security>`, `<errorLog>`, `<errorMail>`и `<errorFilter>`.

Затем добавьте раздел `<elmah>` в `Web.config`. Этот раздел должен отображаться на том же уровне, что и элемент `<system.web>`. В разделе `<elmah>` добавьте `<security>` и `<errorLog>` разделы следующим образом:

[!code-xml[Main](logging-error-details-with-elmah-vb/samples/sample4.xml)]

Атрибут `allowRemoteAccess` раздела `<security>` указывает, разрешен ли удаленный доступ. Если это значение равно 0, веб-страницу журнала ошибок можно просматривать только локально. Если этот атрибут имеет значение 1, то веб-страница журнала ошибок включена для удаленных и локальных посетителей. Сейчас давайте отключим веб-страницу журнала ошибок для удаленных посетителей. Мы разберем удаленный доступ позже, когда у нас есть возможность обсудить вопросы, связанные с безопасностью.

В разделе `<errorLog>` определяется источник журнала ошибок, который определяет, где записываются сведения об ошибке. Он аналогичен разделу `<providers>` в системе мониторинга работоспособности. В приведенном выше синтаксисе в качестве источника журнала ошибок указывается класс `SqlErrorLog`, который регистрирует ошибки в Microsoft SQL Server базе данных, указанной в значении атрибута `connectionStringName`.

> [!NOTE]
> ELMAH поставляется с дополнительными регистраторами ошибок, которые можно использовать для записи ошибок в XML-файл, базу данных Microsoft Access, базу данных Oracle и другие хранилища данных. Сведения о том, как использовать эти альтернативные регистраторы, см. в примере файла `Web.config`, который входит в состав загрузки ELMAH.

### <a name="step-4-creating-the-error-log-source-infrastructure"></a>Шаг 4. создание исходной инфраструктуры журнала ошибок

Поставщик `SqlErrorLog` ELMAH записывает сведения об ошибке в указанную Microsoft SQL Server базу данных. Поставщик `SqlErrorLog` предписывает этой базе данных наличие таблицы с именем `ELMAH_Error` и трех хранимых процедур: `ELMAH_GetErrorsXml`, `ELMAH_GetErrorXml`и `ELMAH_LogError`. Скачивание ELMAH включает файл с именем `SQLServer.sql` в папку `db`, содержащую T-SQL для создания этой таблицы и этих хранимых процедур. Чтобы использовать поставщик `SqlErrorLog`, необходимо выполнить эти инструкции в базе данных.

На **рисунках 1** и **2** показан Обозреватель базы данных в Visual Studio после добавления объектов базы данных, необходимых для поставщика `SqlErrorLog`.

[![](logging-error-details-with-elmah-vb/_static/image2.png)](logging-error-details-with-elmah-vb/_static/image1.png)

**Рис. 1**. поставщик `SqlErrorLog` регистрирует ошибки в таблице `ELMAH_Error`

[![](logging-error-details-with-elmah-vb/_static/image4.png)](logging-error-details-with-elmah-vb/_static/image3.png)

**Рис. 2**. поставщик `SqlErrorLog` использует три хранимых процедуры

## <a name="elmah-in-action"></a>ELMAH в действии

На этом этапе мы добавили ELMAH в веб-приложение, зарегистрировали модуль HTTP `ErrorLogModule` и `ErrorLogPageFactory` обработчик HTTP, заданные параметры конфигурации ELMAH в `Web.config`и добавили необходимые объекты базы данных для `SqlErrorLog` регистратора. Теперь все готово для просмотра ELMAH в действии. Посетите веб-сайт обзоры книг и посетите страницу, которая создает ошибку времени выполнения, например `Genre.aspx?ID=foo`или несуществующую страницу, например `NoSuchPage.aspx`. То, что вы видите при посещении этих страниц, зависит от конфигурации `<customErrors>` и от того, посещаете ли вы локально или удаленно. (См. Руководство по [ *отображению настраиваемой страницы ошибок* ](displaying-a-custom-error-page-vb.md) для обновления в этом разделе.)

ELMAH не влияет на содержимое, отображаемое пользователю при возникновении необработанного исключения; Он просто записывает в журнал сведения о нем. Этот журнал ошибок доступен с веб-страницы `elmah.axd` из корневого каталога веб-сайта, например `http://localhost/BookReviews/elmah.axd`. (Этот файл физически не существует в проекте, но когда поступает запрос на `elmah.axd` среда выполнения отправляет его в обработчик `ErrorLogPageFactory` HTTP, который создает разметку, отправляемую обратно в браузер.)

> [!NOTE]
> Можно также использовать страницу `elmah.axd`, чтобы сообщить ELMAH о формировании ошибки теста. Посещение `elmah.axd/test` (как и `http://localhost/BookReviews/elmah.axd/test`) приводит к тому, что ELMAH создает исключение типа `Elmah.TestException`, которое содержит сообщение об ошибке: «это тестовое исключение, которое можно спокойно проигнорировать».

На **рис. 3** показан журнал ошибок при посещении `elmah.axd` из среды разработки.

[![](logging-error-details-with-elmah-vb/_static/image6.png)](logging-error-details-with-elmah-vb/_static/image5.png)

**Рис. 3**. `Elmah.axd` отображение журнала ошибок на веб-странице  
([Щелкните, чтобы просмотреть изображение с полным размером](logging-error-details-with-elmah-vb/_static/image7.png))

Журнал ошибок на **рис. 3** содержит шесть записей об ошибках. Каждая запись содержит код состояния HTTP (404 или 500 для этих ошибок), тип, описание, имя вошедшего в систему пользователя в момент возникновения ошибки, а также дату и время. Если щелкнуть ссылку "сведения", откроется страница с тем же сообщением об ошибке, которое отображается на желтом экране "сведения об ошибке" (см. **рис. 4**) вместе со значениями переменных сервера на момент возникновения ошибки (см. **рис. 5**). Можно также просмотреть необработанный XML-код, в котором сохраняются сведения об ошибке, включая дополнительные сведения, такие как значения в заголовке HTTP POST.

[![](logging-error-details-with-elmah-vb/_static/image9.png)](logging-error-details-with-elmah-vb/_static/image8.png)

**Рис. 4**. Просмотр сведений об ОШИБКе исод  
([Щелкните, чтобы просмотреть изображение с полным размером](logging-error-details-with-elmah-vb/_static/image10.png))

[![](logging-error-details-with-elmah-vb/_static/image12.png)](logging-error-details-with-elmah-vb/_static/image11.png)

**Рис. 5**. Просмотр значений коллекции Server Variables во время возникновения ошибки  
([Щелкните, чтобы просмотреть изображение с полным размером](logging-error-details-with-elmah-vb/_static/image13.png))

Развертывание ELMAH на рабочем веб-сайте влечет за собой:

- Копирование файла `Elmah.dll` в папку `Bin` в рабочей среде;
- Копирование параметров конфигурации ELMAH в файл `Web.config`, используемый в рабочей среде.
- Добавление исходной инфраструктуры журнала ошибок в рабочую базу данных.

Мы изучили методы копирования файлов из разработки в рабочую среду в предыдущих руководствах. Возможно, самый простой способ получить инфраструктуру источника журнала ошибок в рабочей базе данных — использовать SQL Server Management Studio для подключения к рабочей базе данных, а затем выполнить `SqlServer.sql` файл скрипта, который создаст необходимую таблицу и хранимые процедуры.

### <a name="viewing-the-error-details-page-on-production"></a>Просмотр страницы "сведения об ошибке" в рабочей среде

После развертывания сайта в рабочей среде перейдите на рабочий веб-сайт и создайте необработанное исключение. Как и в среде разработки, ELMAH не влияет на страницу ошибки, отображаемую при возникновении необработанного исключения. Вместо этого он просто регистрирует ошибку. Если вы попытаетесь посетить страницу журнала ошибок (`elmah.axd`) из рабочей среды, вы будете сталкивается с запрещенной страницей, показанной на **рис. 6**.

[![](logging-error-details-with-elmah-vb/_static/image15.png)](logging-error-details-with-elmah-vb/_static/image14.png)

**Рис. 6**. по умолчанию удаленные посетители не могут просматривать веб-страницу журнала ошибок  
([Щелкните, чтобы просмотреть изображение с полным размером](logging-error-details-with-elmah-vb/_static/image16.png))

Вспомним, что в разделе `<security>` конфигурации ELMAH для атрибута `allowRemoteAccess` задано значение 0, что запрещает удаленным пользователям просматривать журнал ошибок. Важно запретить анонимным посетителям просматривать журнал ошибок, так как сведения об ошибке могут обнаружить уязвимости системы безопасности или другие конфиденциальные сведения. Если вы решили присвоить этому атрибуту значение 1 и разрешить удаленный доступ к журналу ошибок, важно заблокировать `elmah.axd` путь, чтобы только авторизованные посетители могли получить к нему доступ. Это можно сделать, добавив элемент `<location>` в файл `Web.config`.

Следующая конфигурация разрешает доступ к веб-странице журнала ошибок только пользователям с ролью администратора:

[!code-xml[Main](logging-error-details-with-elmah-vb/samples/sample5.xml)]

> [!NOTE]
> Роль администратора и три пользователя в системе (Скотт, Цзисунь и Алиса) были добавлены в окне [ *Настройка веб-сайта, использующего* учебник по службы приложений](configuring-a-website-that-uses-application-services-vb.md). Пользователи Скотт и Цзисунь являются членами роли администратора. Дополнительные сведения о проверке подлинности и авторизации см. в [руководствах по безопасности веб-сайтов](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).

Журнал ошибок в рабочей среде теперь может быть просмотрен удаленными пользователями; снимки экрана веб-страницы журнала ошибок см. на **рисунках 3**, **4**и **5** . Однако, если пользователь с анонимным или без прав администратора попытается просмотреть страницу журнала ошибок, он автоматически перенаправляется на страницу входа (`Login.aspx`), как показано **на рис. 7** .

[![](logging-error-details-with-elmah-vb/_static/image18.png)](logging-error-details-with-elmah-vb/_static/image17.png)

**Рис. 7**. неавторизованные пользователи автоматически перенаправляются на страницу входа  
([Щелкните, чтобы просмотреть изображение с полным размером](logging-error-details-with-elmah-vb/_static/image19.png))

### <a name="programmatically-logging-errors"></a>Программное ведение журнала ошибок

HTTP-модуль ELMAH `ErrorLogModule` автоматически регистрирует необработанные исключения в указанном источнике журнала. Кроме того, можно зарегистрировать ошибку без необходимости вызывать необработанное исключение с помощью класса `ErrorSignal` и его метода `Raise`. Методу `Raise` передается объект `Exception` и заносится в журнал так, как если бы это исключение было создано и достигло времени выполнения ASP.NET без обработки. Однако различие заключается в том, что выполнение запроса продолжается нормально после вызова метода `Raise`, в то время как выдаваемое, необработанное исключение прерывает нормальное выполнение запроса и заставляет среду выполнения ASP.NET отображать настроенную страницу ошибки.

Класс `ErrorSignal` полезен в ситуациях, когда существует какое-либо действие, которое может завершиться ошибкой, но его сбой не является критическим к выполнению общей операции. Например, веб-сайт может содержать форму, которая принимает входные данные пользователя, сохраняет ее в базе данных, а затем отправляет пользователю сообщение электронной почты, информирующее о том, что информация была обработана. Что произойдет, если информация успешно сохранена в базе данных, но при отправке сообщения электронной почты возникает ошибка? Один из вариантов — создать исключение и отправить пользователю на страницу ошибки. Однако это может запутать пользователя в том, что данные, которые они указали, не сохранялись. Другой подход — зарегистрировать ошибку, связанную с электронной почтой, но не изменять взаимодействие с пользователем каким-либо образом. Именно здесь полезен класс `ErrorSignal`.

[!code-vb[Main](logging-error-details-with-elmah-vb/samples/sample6.vb)]

## <a name="error-notification-via-email"></a>Уведомление об ошибке по электронной почте

Наряду с регистрацией ошибок в базе данных ELMAH можно настроить для отправки сведений об ошибке указанному получателю по электронной почте. Эта функция предоставляется модулем `ErrorMailModule` HTTP. Поэтому необходимо зарегистрировать этот HTTP-модуль в `Web.config`, чтобы отправлять сведения об ошибке по электронной почте.

[!code-xml[Main](logging-error-details-with-elmah-vb/samples/sample7.xml)]

Затем укажите сведения об электронной почте об ошибке в разделе `<errorMail>` элемента `<elmah>`, указывающем отправителя и получателя сообщения электронной почты, тему и способ отправки сообщения в асинхронном режиме.

[!code-xml[Main](logging-error-details-with-elmah-vb/samples/sample8.xml)]

При наличии указанных выше параметров при возникновении ошибки времени выполнения ELMAH отправляет электронное сообщение на support@example.com с подробными сведениями об ошибке. Сообщение об ошибке ELMAH содержит те же сведения, которые отображаются на веб-странице сведения об ошибке, а именно сообщение об ошибке, трассировка стека и переменные сервера (см. **рис. 4** и **5**). В сообщении об ошибке также содержится желтый экран сведений об исключении для содержимого смерти в виде вложения (`YSOD.html`).

**На рис. 8** показаны сообщения об ошибках ELMAH, созданные при посещении `Genre.aspx?ID=foo`. Хотя на **рис. 8** показано только сообщение об ошибке и трассировка стека, переменные сервера добавляются в текст сообщения электронной почты.

[![](logging-error-details-with-elmah-vb/_static/image21.png)](logging-error-details-with-elmah-vb/_static/image20.png)

**Рис. 8**. можно настроить ELMAH для отправки сведений об ошибках по электронной почте  
([Щелкните, чтобы просмотреть изображение с полным размером](logging-error-details-with-elmah-vb/_static/image22.png))

## <a name="only-logging-errors-of-interest"></a>Запись только тех ошибок, которые представляют интерес

По умолчанию ELMAH записывает в журнал подробные сведения о каждом необработанном исключении, включая 404 и другие ошибки HTTP. Можно указать ELMAH игнорировать эти или другие типы ошибок с помощью фильтрации ошибок. Логика фильтрации выполняется модулем `ErrorFilterModule` HTTP ELMAH, который необходимо зарегистрировать в `Web.config`, чтобы использовать логику фильтрации. Правила фильтрации указываются в разделе `<errorFilter>`.

Следующая разметка указывает, что ELMAH не регистрирует ошибки 404.

[!code-xml[Main](logging-error-details-with-elmah-vb/samples/sample9.xml)]

> [!NOTE]
> Не забывайте, что для использования фильтрации ошибок необходимо зарегистрировать HTTP-модуль `ErrorFilterModule`.

Элемент `<equal>` внутри раздела `<test>` называется утверждением. Если утверждение принимает значение true, то ошибка фильтруется из журнала ELMAH. Существуют и другие доступные утверждения, в том числе: `<greater>`, `<greater-or-equal>`, `<not-equal>`, `<lesser>`, `<lesser-or-equal>`и т. д. Можно также комбинировать утверждения с помощью логических операторов `<and>` и `<or>`. Более того, можно даже включить простое выражение JavaScript в качестве утверждения или написать собственные утверждения в C# или Visual Basic.

Дополнительные сведения о возможностях фильтрации ошибок ELMAH см. в [разделе Фильтрация ошибок](https://code.google.com/p/elmah/wiki/ErrorFiltering) в вики- [сайте ELMAH](https://code.google.com/p/elmah/w/list).

## <a name="summary"></a>Сводка

ELMAH предоставляет простой, но мощный механизм ведения журнала ошибок в веб-приложении ASP.NET. Как и система мониторинга работоспособности корпорации Майкрософт, ELMAH может записывать ошибки в базу данных и отправлять сведения об ошибке разработчику по электронной почте. В отличие от системы мониторинга работоспособности, ELMAH включает в себя поддержку более широкого спектра хранилищ данных журнала ошибок, в том числе: Microsoft SQL Server, Microsoft Access, Oracle, XML-файлы и некоторые другие. Более того, ELMAH предлагает встроенный механизм просмотра журнала ошибок и сведений о конкретной ошибке на веб-странице `elmah.axd`. `elmah.axd`ная страница может также отображать сведения об ошибках в виде RSS-канала или в виде файла данных, разделенного запятыми (CSV), который можно прочитать с помощью Microsoft Excel. Также можно указать ELMAH, чтобы отфильтровать ошибки из журнала с помощью декларативных или программных утверждений. И ELMAH можно использовать с приложениями ASP.NET версии 1. x.

Каждое развернутое приложение должно иметь некоторый механизм для автоматического ведения журнала необработанных исключений и отправки уведомлений группе разработчиков. Выполняется ли это при использовании мониторинга работоспособности или ELMAH. Иными словами, это не имеет большого значения, используется ли мониторинг работоспособности или ELMAH; Оцените обе системы и выберите ту, которая наилучшим образом соответствует вашим потребностям. Основная важность заключается в том, что для регистрации необработанных исключений в рабочей среде используется некоторый механизм.

Поздравляем с программированием!

### <a name="further-reading"></a>Дополнительные сведения

Дополнительные сведения о разделах, обсуждаемых в этом руководстве, см. в следующих ресурсах:

- [ELMAH — модули и обработчики ведения журнала ошибок](http://dotnetslackers.com/articles/aspnet/ErrorLoggingModulesAndHandlers.aspx)
- [Страница проекта ELMAH](https://code.google.com/p/elmah/) (исходный код, примеры, вики-страницы)
- [Подключение ELMAH к веб-приложению для перехвата необработанных исключений](http://screencastaday.com/ScreenCasts/43_Plugging_Elmah_into_Web_Application_to_Catch_Unhandled_Exceptions.aspx) (видео)
- [Страницы журнала ошибок безопасности](https://code.google.com/p/elmah/wiki/SecuringErrorLogPages)
- [Использование модулей и обработчиков HTTP для создания подключаемых компонентов ASP.NET](https://msdn.microsoft.com/library/aa479332.aspx)
- [Учебники по безопасности веб-сайтов](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)

> [!div class="step-by-step"]
> [Назад](logging-error-details-with-asp-net-health-monitoring-vb.md)
> [Вперед](precompiling-your-website-vb.md)
