---
uid: web-forms/overview/older-versions-getting-started/deployment-to-a-hosting-provider/deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12
title: 'Развертывание веб-приложения ASP.NET с SQL Server Compact с помощью Visual Studio или Visual Web Developer: развертывание обновления базы данных-9 из 12 | Документация Майкрософт'
author: tdykstra
description: В этой серии учебников показано, как развернуть (опубликовать) проект веб-приложения ASP.NET, включающий базу данных SQL Server Compact, с помощью Visual Stu...
ms.author: riande
ms.date: 11/17/2011
ms.assetid: a8d776af-4735-4612-87f6-9f326587f2d3
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deployment-to-a-hosting-provider/deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12
msc.type: authoredcontent
ms.openlocfilehash: 3385e1019d9e7a9263fd9513c39b25eb85febbb5
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78455106"
---
# <a name="deploying-an-aspnet-web-application-with-sql-server-compact-using-visual-studio-or-visual-web-developer-deploying-a-database-update---9-of-12"></a><span data-ttu-id="cd0f7-103">Развертывание веб-приложения ASP.NET с SQL Server Compact с помощью Visual Studio или Visual Web Developer: развертывание обновления базы данных-9 из 12</span><span class="sxs-lookup"><span data-stu-id="cd0f7-103">Deploying an ASP.NET Web Application with SQL Server Compact using Visual Studio or Visual Web Developer: Deploying a Database Update - 9 of 12</span></span>

<span data-ttu-id="cd0f7-104">от [Tom Dykstra)](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="cd0f7-104">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

[<span data-ttu-id="cd0f7-105">Скачать начальный проект</span><span class="sxs-lookup"><span data-stu-id="cd0f7-105">Download Starter Project</span></span>](https://code.msdn.microsoft.com/Deploying-an-ASPNET-Web-4e31366b)

> <span data-ttu-id="cd0f7-106">В этой серии учебников показано, как развернуть (опубликовать) проект веб-приложения ASP.NET, включающий базу данных SQL Server Compact, с помощью Visual Studio 2012 RC или Visual Studio Express 2012 RC для Web.</span><span class="sxs-lookup"><span data-stu-id="cd0f7-106">This series of tutorials shows you how to deploy (publish) an ASP.NET web application project that includes a SQL Server Compact database by using Visual Studio 2012 RC or Visual Studio Express 2012 RC for Web.</span></span> <span data-ttu-id="cd0f7-107">При установке обновления веб-публикации можно также использовать Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="cd0f7-107">You can also use Visual Studio 2010 if you install the Web Publish Update.</span></span> <span data-ttu-id="cd0f7-108">Введение в серию см. [в первом учебнике серии](deployment-to-a-hosting-provider-introduction-1-of-12.md).</span><span class="sxs-lookup"><span data-stu-id="cd0f7-108">For an introduction to the series, see [the first tutorial in the series](deployment-to-a-hosting-provider-introduction-1-of-12.md).</span></span>
> 
> <span data-ttu-id="cd0f7-109">Руководство, в котором показаны функции развертывания, появившиеся после выпуска версии-КАНДИДАТа Visual Studio 2012, демонстрирует развертывание SQL Server выпусков, отличных от SQL Server Compact, и демонстрация развертывания в веб-приложениях службы приложений Azure см. в разделе [ASP.NET Web Deploying using Visual Studio](../../deployment/visual-studio-web-deployment/introduction.md).</span><span class="sxs-lookup"><span data-stu-id="cd0f7-109">For a tutorial that shows deployment features introduced after the RC release of Visual Studio 2012, shows how to deploy SQL Server editions other than SQL Server Compact, and shows how to deploy to Azure App Service Web Apps, see [ASP.NET Web Deployment using Visual Studio](../../deployment/visual-studio-web-deployment/introduction.md).</span></span>

## <a name="overview"></a><span data-ttu-id="cd0f7-110">Обзор</span><span class="sxs-lookup"><span data-stu-id="cd0f7-110">Overview</span></span>

<span data-ttu-id="cd0f7-111">В этом руководстве вы вносите изменения в базу данных и связанную с ней изменения кода, тестируете изменения в Visual Studio, а затем развертываете обновление в тестовой и рабочей средах.</span><span class="sxs-lookup"><span data-stu-id="cd0f7-111">In this tutorial, you make a database change and related code changes, test the changes in Visual Studio, then deploy the update to both the test and production environments.</span></span>

<span data-ttu-id="cd0f7-112">Напоминание. Если вы получаете сообщение об ошибке или что-то не работает при работе с этим руководством, обязательно ознакомьтесь со [страницей устранения неполадок](deployment-to-a-hosting-provider-creating-and-installing-deployment-packages-12-of-12.md).</span><span class="sxs-lookup"><span data-stu-id="cd0f7-112">Reminder: If you get an error message or something doesn't work as you go through the tutorial, be sure to check the [troubleshooting page](deployment-to-a-hosting-provider-creating-and-installing-deployment-packages-12-of-12.md).</span></span>

## <a name="adding-a-new-column-to-a-table"></a><span data-ttu-id="cd0f7-113">Добавление нового столбца в таблицу</span><span class="sxs-lookup"><span data-stu-id="cd0f7-113">Adding a New Column to a Table</span></span>

<span data-ttu-id="cd0f7-114">В этом разделе вы добавите столбец даты рождения в базовый класс `Person` для сущностей `Student` и `Instructor`.</span><span class="sxs-lookup"><span data-stu-id="cd0f7-114">In this section, you add a birth date column to the `Person` base class for the `Student` and `Instructor` entities.</span></span> <span data-ttu-id="cd0f7-115">Затем вы обновите страницу, на которой отображаются данные о преподавателе, чтобы отобразить новый столбец.</span><span class="sxs-lookup"><span data-stu-id="cd0f7-115">Then you update the page that displays instructor data so that it displays the new column.</span></span>

<span data-ttu-id="cd0f7-116">В проекте *ContosoUniversity. DAL* откройте *Person.CS* и добавьте следующее свойство в конце класса `Person` (после него должны быть две закрывающие фигурные скобки):</span><span class="sxs-lookup"><span data-stu-id="cd0f7-116">In the *ContosoUniversity.DAL* project, open *Person.cs* and add the following property at the end of the `Person` class (there should be two closing curly braces following it):</span></span>

[!code-csharp[Main](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/samples/sample1.cs)]

<span data-ttu-id="cd0f7-117">Затем обновите метод SEED, чтобы он выдает значение для нового столбца.</span><span class="sxs-lookup"><span data-stu-id="cd0f7-117">Next, update the Seed method so that it provides a value for the new column.</span></span> <span data-ttu-id="cd0f7-118">Откройте *Migrations\Configuration.CS* и замените блок кода, который начинается `var instructors = new List<Instructor>`, на следующий блок кода, содержащий сведения о дате рождения:</span><span class="sxs-lookup"><span data-stu-id="cd0f7-118">Open *Migrations\Configuration.cs* and replace the code block that begins `var instructors = new List<Instructor>` with the following code block which includes birth date information:</span></span>

[!code-csharp[Main](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/samples/sample2.cs)]

<span data-ttu-id="cd0f7-119">В проекте ContosoUniversity откройте *инструкторы. aspx* и добавьте новое поле шаблона, чтобы отобразить дату рождения.</span><span class="sxs-lookup"><span data-stu-id="cd0f7-119">In the ContosoUniversity project, open *Instructors.aspx* and add a new template field to display the birth date.</span></span> <span data-ttu-id="cd0f7-120">Добавьте его между ними для даты найма и назначения Office:</span><span class="sxs-lookup"><span data-stu-id="cd0f7-120">Add it between the ones for hire date and office assignment:</span></span>

[!code-aspx[Main](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/samples/sample3.aspx)]

<span data-ttu-id="cd0f7-121">(Если отступы кода не синхронизированы, можно нажать сочетание клавиш CTRL-K и CTRL-D, чтобы автоматически переформатировать файл.)</span><span class="sxs-lookup"><span data-stu-id="cd0f7-121">(If code indentation gets out of sync, you can press CTRL-K and then CTRL-D to automatically reformat the file.)</span></span>

<span data-ttu-id="cd0f7-122">Выполните сборку решения, а затем откройте окно **консоли диспетчера пакетов** .</span><span class="sxs-lookup"><span data-stu-id="cd0f7-122">Build the solution, and then open the **Package Manager Console** window.</span></span> <span data-ttu-id="cd0f7-123">Убедитесь, что ContosoUniversity. DAL по-прежнему выбран в качестве **проекта по умолчанию**.</span><span class="sxs-lookup"><span data-stu-id="cd0f7-123">Make sure that ContosoUniversity.DAL is still selected as the **Default project**.</span></span>

<span data-ttu-id="cd0f7-124">В окне **консоли диспетчера пакетов** выберите **ContosoUniversity. DAL** в качестве **проекта по умолчанию**, а затем введите следующую команду:</span><span class="sxs-lookup"><span data-stu-id="cd0f7-124">In the **Package Manager Console** window, select **ContosoUniversity.DAL** as the **Default project**, and then enter the following command:</span></span>

[!code-powershell[Main](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/samples/sample4.ps1)]

<span data-ttu-id="cd0f7-125">По завершении этой команды Visual Studio открывает файл класса, который определяет новый класс `DbMigration`, а в методе `Up` можно увидеть код, создающий новый столбец.</span><span class="sxs-lookup"><span data-stu-id="cd0f7-125">When this command finishes, Visual Studio opens the class file that defines the new `DbMigration` class, and in the `Up` method you can see the code that creates the new column.</span></span>

![AddBirthDate_migration_code](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image1.png)

<span data-ttu-id="cd0f7-127">Выполните сборку решения, а затем введите следующую команду в окне **консоли диспетчера пакетов** (убедитесь, что проект CONTOSOUNIVERSITY. DAL по-прежнему выбран):</span><span class="sxs-lookup"><span data-stu-id="cd0f7-127">Build the solution, and then enter the following command in the **Package Manager Console** window (make sure the ContosoUniversity.DAL project is still selected):</span></span>

[!code-powershell[Main](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/samples/sample5.ps1)]

<span data-ttu-id="cd0f7-128">По завершении выполнения команды запустите приложение и выберите страницу инструкторы.</span><span class="sxs-lookup"><span data-stu-id="cd0f7-128">When the command finishes, run the application and select the Instructors page.</span></span> <span data-ttu-id="cd0f7-129">Когда страница загрузится, вы увидите, что в ней есть новое поле даты рождения.</span><span class="sxs-lookup"><span data-stu-id="cd0f7-129">When the page loads, you see that it has the new birth date field.</span></span>

<span data-ttu-id="cd0f7-130">[![Instructors_page_with_birth_date](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image3.png)](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image2.png)</span><span class="sxs-lookup"><span data-stu-id="cd0f7-130">[![Instructors_page_with_birth_date](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image3.png)](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image2.png)</span></span>

## <a name="deploying-the-database-update-to-the-test-environment"></a><span data-ttu-id="cd0f7-131">Развертывание обновления базы данных в тестовой среде</span><span class="sxs-lookup"><span data-stu-id="cd0f7-131">Deploying the Database Update to the Test Environment</span></span>

<span data-ttu-id="cd0f7-132">В **Обозреватель решений** выберите проект ContosoUniversity.</span><span class="sxs-lookup"><span data-stu-id="cd0f7-132">In **Solution Explorer** select the ContosoUniversity project.</span></span>

<span data-ttu-id="cd0f7-133">На панели инструментов **веб-публикация одним щелчком** выберите профиль **тестовой** публикации и щелкните **Опубликовать веб-сайт**.</span><span class="sxs-lookup"><span data-stu-id="cd0f7-133">In the **Web One Click Publish** toolbar, select the **Test** publish profile, and then click **Publish Web**.</span></span> <span data-ttu-id="cd0f7-134">(Если панель инструментов отключена, выберите проект ContosoUniversity в **Обозреватель решений**.)</span><span class="sxs-lookup"><span data-stu-id="cd0f7-134">(If the toolbar is disabled, select the ContosoUniversity project in **Solution Explorer**.)</span></span>

<span data-ttu-id="cd0f7-135">Visual Studio развертывает обновленное приложение, и браузер открывается на домашней странице.</span><span class="sxs-lookup"><span data-stu-id="cd0f7-135">Visual Studio deploys the updated application, and the browser opens to the home page.</span></span> <span data-ttu-id="cd0f7-136">Запустите страницу инструкторы, чтобы убедиться, что обновление успешно развернуто.</span><span class="sxs-lookup"><span data-stu-id="cd0f7-136">Run the Instructors page to verify that the update was successfully deployed.</span></span> <span data-ttu-id="cd0f7-137">Когда приложение пытается получить доступ к базе данных для этой страницы, Code First обновляет схему базы данных и выполняет метод `Seed`.</span><span class="sxs-lookup"><span data-stu-id="cd0f7-137">When the application tries to access the database for this page, Code First updates the database schema and runs the `Seed` method.</span></span> <span data-ttu-id="cd0f7-138">При отображении страницы отображается столбец ожидаемая **Дата рождения** с датами в нем.</span><span class="sxs-lookup"><span data-stu-id="cd0f7-138">When the page displays, you see the expected **Birth Date** column with dates in it.</span></span>

<span data-ttu-id="cd0f7-139">[![Instructors_page_with_birth_date_Test](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image5.png)](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="cd0f7-139">[![Instructors_page_with_birth_date_Test](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image5.png)](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image4.png)</span></span>

## <a name="deploying-the-database-update-to-the-production-environment"></a><span data-ttu-id="cd0f7-140">Развертывание обновления базы данных в рабочей среде</span><span class="sxs-lookup"><span data-stu-id="cd0f7-140">Deploying the Database Update to the Production Environment</span></span>

<span data-ttu-id="cd0f7-141">Теперь можно выполнить развертывание в рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="cd0f7-141">You can now deploy to production.</span></span> <span data-ttu-id="cd0f7-142">Единственное отличие заключается в том, что вы будете использовать *приложение\_offline. htm* , чтобы запретить пользователям доступ к сайту и тем самым обновить базу данных при развертывании изменений.</span><span class="sxs-lookup"><span data-stu-id="cd0f7-142">The only difference is that you'll use *app\_offline.htm* to prevent users from accessing the site and thus updating the database while you're deploying changes.</span></span> <span data-ttu-id="cd0f7-143">Для рабочего развертывания выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="cd0f7-143">For production deployment perform the following steps:</span></span>

- <span data-ttu-id="cd0f7-144">Отправьте *приложение\_автономный htm* -файл на рабочий сайт.</span><span class="sxs-lookup"><span data-stu-id="cd0f7-144">Upload the *app\_offline.htm* file to the production site.</span></span>
- <span data-ttu-id="cd0f7-145">В Visual Studio выберите рабочий профиль на панели инструментов **веб-публикация одним щелчком** и щелкните **Опубликовать веб-сайт**.</span><span class="sxs-lookup"><span data-stu-id="cd0f7-145">In Visual Studio, choose the Production profile in the **Web One Click Publish** toolbar and click **Publish Web**.</span></span>
- <span data-ttu-id="cd0f7-146">Удалите *приложение\_автономный htm* -файл с рабочего сайта.</span><span class="sxs-lookup"><span data-stu-id="cd0f7-146">Delete the *app\_offline.htm* file from the production site.</span></span>

> [!NOTE]
> <span data-ttu-id="cd0f7-147">Хотя приложение используется в рабочей среде, необходимо реализовать план резервного копирования.</span><span class="sxs-lookup"><span data-stu-id="cd0f7-147">While your application is in use in the production environment you should be implementing a backup plan.</span></span> <span data-ttu-id="cd0f7-148">То есть следует периодически копировать файлы *счул-прод. sdf* и *АСПнет-прод. sdf* с рабочего сайта в безопасное место хранения, и вы должны поддерживать несколько поколений таких резервных копий.</span><span class="sxs-lookup"><span data-stu-id="cd0f7-148">That is, you should be periodically copying the *School-Prod.sdf* and *aspnet-Prod.sdf* files from the production site to a secure storage location, and you should be keeping several generations of such backups.</span></span> <span data-ttu-id="cd0f7-149">При обновлении базы данных необходимо создать резервную копию непосредственно перед изменением.</span><span class="sxs-lookup"><span data-stu-id="cd0f7-149">When you update the database, you should make a backup copy from immediately before the change.</span></span> <span data-ttu-id="cd0f7-150">Если вы сделаете ошибку и не обнаружите ее до тех пор, пока вы не развернете ее в рабочую среду, то сможете восстановить базу данных до состояния, в котором она находилась до повреждения.</span><span class="sxs-lookup"><span data-stu-id="cd0f7-150">Then, if you make a mistake and don't discover it until after you have deployed it to production, you will still be able to recover the database to the state it was in before it became corrupted.</span></span>

<span data-ttu-id="cd0f7-151">Когда Visual Studio откроет URL-адрес домашней страницы в браузере, отобразится страница *приложение\_автономно. htm* .</span><span class="sxs-lookup"><span data-stu-id="cd0f7-151">When Visual Studio opens the home page URL in the browser, the *app\_offline.htm* page is displayed.</span></span> <span data-ttu-id="cd0f7-152">После удаления *приложения\_автономном htm* -файле можно снова перейти на домашнюю страницу, чтобы убедиться, что обновление успешно развернуто.</span><span class="sxs-lookup"><span data-stu-id="cd0f7-152">After you delete the *app\_offline.htm* file, you can browse to your home page again to verify that the update was successfully deployed.</span></span>

<span data-ttu-id="cd0f7-153">[![Instructors_page_with_birth_date_Prod](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image7.png)](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image6.png)</span><span class="sxs-lookup"><span data-stu-id="cd0f7-153">[![Instructors_page_with_birth_date_Prod](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image7.png)](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image6.png)</span></span>

<span data-ttu-id="cd0f7-154">Теперь вы развернули обновление приложения, которое включало изменение базы данных в тестовую и рабочую среду.</span><span class="sxs-lookup"><span data-stu-id="cd0f7-154">You've now deployed an application update that included a database change to both test and production.</span></span> <span data-ttu-id="cd0f7-155">В следующем руководстве показано, как перенести базу данных из SQL Server Compact в SQL Server Express и SQL Server.</span><span class="sxs-lookup"><span data-stu-id="cd0f7-155">The next tutorial shows you how to migrate your database from SQL Server Compact to SQL Server Express and SQL Server.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="cd0f7-156">[Назад](deployment-to-a-hosting-provider-deploying-a-code-only-update-8-of-12.md)
> [Вперед](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12.md)</span><span class="sxs-lookup"><span data-stu-id="cd0f7-156">[Previous](deployment-to-a-hosting-provider-deploying-a-code-only-update-8-of-12.md)
[Next](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12.md)</span></span>
