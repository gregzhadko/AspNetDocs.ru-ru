---
uid: web-forms/overview/older-versions-getting-started/deployment-to-a-hosting-provider/deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12
title: 'Развертывание веб-приложения ASP.NET с SQL Server Compact с помощью Visual Studio или Visual Web Developer: Преобразования файла Web.Config — 3 из 12 | Документация Майкрософт'
author: tdykstra
description: Этой серии руководств показано, как развернуть (публикации) ASP.NET проекта веб-приложения, который содержит базу данных SQL Server Compact с помощью Visual Stu...
ms.author: riande
ms.date: 11/17/2011
ms.assetid: 2b0df3d9-450b-4ea6-b315-4c9650722cad
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deployment-to-a-hosting-provider/deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12
msc.type: authoredcontent
ms.openlocfilehash: 2b289099f7f9a928b2d63a09ac5ccd685d9d4386
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/09/2019
ms.locfileid: "59406540"
---
# <a name="deploying-an-aspnet-web-application-with-sql-server-compact-using-visual-studio-or-visual-web-developer-webconfig-file-transformations---3-of-12"></a>Развертывание веб-приложения ASP.NET с SQL Server Compact с помощью Visual Studio или Visual Web Developer: Преобразования файла Web.Config — 3 из 12

по [том Дайкстра](https://github.com/tdykstra)

[Загрузите начальный проект](http://code.msdn.microsoft.com/Deploying-an-ASPNET-Web-4e31366b)

> Этой серии руководств показано, как развернуть (публикации) ASP.NET проекта веб-приложения, который содержит базу данных SQL Server Compact с помощью Visual Studio 2012 RC или Visual Studio Express 2012 RC для Web. Также можно использовать Visual Studio 2010, если установить обновление веб-публикации. Введение в серии, см. в разделе [в первом учебнике серии](deployment-to-a-hosting-provider-introduction-1-of-12.md).
> 
> Учебник, в котором показаны компоненты развертывания, появившиеся после выпуска версии-КАНДИДАТА Visual Studio 2012, содержит сведения о развертывании выпусков SQL Server, отличных от SQL Server Compact и содержит сведения о развертывании веб-приложения службы приложений Azure, см. в разделе [веб-развертывание ASP.NET с помощью Visual Studio](../../deployment/visual-studio-web-deployment/introduction.md).


## <a name="overview"></a>Обзор

Этом руководстве показано, как автоматизировать процесс изменения *Web.config* файла при его развертывании в средах другое назначение. Большинство приложений имеют параметры *Web.config* файл, который должны быть разными, при развертывании приложения. Автоматизация процесса внесения этих изменений позволяет избежать выполнения вручную каждый раз при развертывании, который бы весьма утомительно и подвержено ошибкам.

Напоминание. Если вы получаете сообщение об ошибке, или что-то не работает, как работать с руководством, обязательно проверьте [страница устранения неполадок](deployment-to-a-hosting-provider-creating-and-installing-deployment-packages-12-of-12.md).

## <a name="webconfig-transformations-versus-web-deploy-parameters"></a>Преобразование Web.config на веб-развертывание параметров

Существует два способа для автоматизации процесса изменения *Web.config* параметры: [Преобразования Web.config](https://msdn.microsoft.com/library/dd465326.aspx) и [параметры веб-развертывания](https://msdn.microsoft.com/library/ff398068.aspx). Объект *Web.config* файл преобразования содержит XML-разметку, которая определяет способ изменения *Web.config* файл при его развертывании. Можно указать различные изменения для конкретных конфигураций сборки и для конкретных профилей публикации. Конфигурации построения по умолчанию, отладки и выпуска, и можно создать пользовательские конфигурации построения. Профиль публикации обычно соответствует в целевой среде. (Вы узнаете больше о таких профилей в [развертывание в IIS в качестве тестовой среды](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12.md) руководства.)

Параметры веб-развертывания можно использовать для указания различных параметров, которые должны быть настроены во время развертывания, включая параметры, которые находятся в *Web.config* файлов. Для указания *Web.config* изменения в файле, для настройки параметров веб-развертывание более сложны, но они полезны, если вы не знаете значение, устанавливаемое, если. Например, в корпоративной среде, можно создать *пакет развертывания* и присвойте ему определенному человеку в ИТ-отдел для установки в рабочей среде, и этот пользователь получит возможность введите строки подключения или пароли, которые не знаете.

Для сценария, в этом учебнике, вы знаете, все, что необходимо сделать для *Web.config* файла, поэтому необходимо использовать параметры веб-развертывания. Нужно настроить некоторые преобразования, отличаются в зависимости от конфигурации построения, который используется, и некоторые, отличающиеся в зависимости от того, используется профиль публикации.

## <a name="creating-transformation-files-for-publish-profiles"></a>Создание файлов преобразования для профили публикации

В **обозревателе решений**, разверните *Web.config* для см. в разделе *Web.Debug.config* и *Web.Release.config* , файлы преобразования создаются по умолчанию для конфигурации построения два заданных по умолчанию.

![Web.config_transform_files](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/_static/image1.png)

Можно создать файлы преобразования для конфигураций настраиваемой сборки, щелкнув правой кнопкой мыши файл Web.config и выбрав **добавить преобразования конфигурации** в контекстном меню, но в этом руководстве не нужно это сделать.

Два дополнительных файла преобразования, необходимые для настройки изменения, которые связаны, назначение развертывания, а не конфигурацию сборки. Типичный пример такого рода параметра — конечную точку WCF, которая отличается для тестирования и производства. В последующих руководствах вы создадите публикации профилей с именем тестирования и эксплуатации, поэтому вам *Web.Test.config* файл и *Web.Production.config* файла.

Файлы преобразования, которые связаны с профилями публикации должны быть созданы вручную. В **обозревателе решений**, щелкните правой кнопкой мыши проект ContosoUniversity и выберите **открыть папку в проводнике Windows**.

![Open_folder_in_Windows_Explorer](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/_static/image2.png)

В **Windows Explorer**выберите *Web.Release.config* файл, скопируйте файл и вставьте две копии. Переименовать эти копии *Web.Production.config* и *Web.Test.config*, затем закройте **Windows Explorer**.

В **обозревателе решений**, нажмите кнопку **обновить** для отображения новых файлов.

Выберите новые файлы, щелкните правой кнопкой мыши и выберите команду **включить в проект** в контекстном меню.

![Включая тестирования и производственная среда файлы конфигурации в проекте](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/_static/image3.png)

Чтобы заблокировать эти файлы, выберите их в **обозревателе решений**, а затем в **свойства** окна Изменение **действие при построении** свойства из **Содержимого** для **None**. (Преобразование файлов, основанные на конфигурации построения автоматически запрещено развертывание.)

Теперь вы готовы ввести *Web.config* преобразований в *Web.config* файлы преобразования.

## <a name="limiting-error-log-access-to-administrators"></a>Ограничение доступа к журналу ошибок для администраторов

Если возникает ошибка во время выполнения приложения, оно выводит типовой страницы ошибки вместо страницы системные ошибки и использует [пакет Elmah NuGet](http://www.hanselman.com/blog/NuGetPackageOfTheWeek7ELMAHErrorLoggingModulesAndHandlersWithSQLServerCompact.aspx) для регистрации ошибок и создания отчетов. `customErrors` Элемент в *Web.config* файла указывает на страницу ошибки:

[!code-xml[Main](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/samples/sample1.xml)]

Чтобы просмотреть страницу ошибки, то временно измените `mode` атрибут `customErrors` элемент из «RemoteOnly» значение «Вкл.» и запустите приложение из Visual Studio. Вызывает ошибку, запрашивая недопустимый URL-адрес, например *Studentsxxx.aspx*. Вместо сформированных IIS «страница не найдена» страница ошибки, пользователь видит *GenericErrorPage.aspx* страницы.

[![Error_page](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/_static/image5.png)](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/_static/image4.png)

Чтобы просмотреть журнал ошибок, замените весь код в URL-адрес после номера порта с *elmah.axd* (например, на снимке экрана, `http://localhost:51130/elmah.axd`) и нажмите клавишу ВВОД:

[![Elmah_log_page](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/_static/image7.png)](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/_static/image6.png)

Не забудьте задать `customErrors` элемент обратно в режим «RemoteOnly», когда все будет готово.

На компьютере разработчика является удобным разрешить бесплатный доступ к странице журнала ошибки, но в рабочей среде, которая будет представлять угрозу безопасности. Для рабочего сайта, можно добавить правило авторизации, которое ограничивает доступ к журналу ошибок только для администраторов, настроив преобразование в *Web.Production.config* файла.

Откройте *Web.Production.config* и добавьте новую `location` сразу же после открывающего элемента `configuration` тег, как показано ниже. (Убедитесь, что только `location` элемента и не окружающей разметкой, показанный здесь только для предоставления некоторый контекст.)

[!code-xml[Main](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/samples/sample2.xml?highlight=2-9)]

`Transform` Значение атрибута «Insert» вызывает это `location` элемента для добавления в качестве одноуровневого элемента существующим `location` элементов в *Web.config* файл. (Уже существует один `location` элемент, который задает авторизации правила для **обновления кредиты** страницы.) При тестировании на рабочий сайт после развертывания, тестируемый убедитесь, что это правило авторизации является эффективным.

У вас нет для ограничения доступа к журналу ошибок в тестовой среде, поэтому нет необходимости добавьте следующий код в *Web.Test.config* файла.

> [!NOTE] 
> 
> **Примечание по безопасности** никогда не отображать сведения об ошибке для просмотра в реальном приложении, или сохранить эту информацию в общедоступном расположении. Злоумышленники могут использовать сведения об ошибке, чтобы обнаружить уязвимости на узле. Если вы используете ELMAH в приложении, не забудьте скачков, в котором можно настроить ELMAH, чтобы свести к минимуму угрозы безопасности. В примере ELMAH в этом руководстве не должен считаться рекомендуемой конфигурацией. Это пример, в котором был сделан для иллюстрации способ обработки приложения должен уметь создавать файлы в папку.


## <a name="setting-an-environment-indicator"></a>Настройка индикатора среды

Распространенным сценарием является иметь *Web.config* , которые должны быть разными в каждой среде, которое развертывается в настройках файла. Например приложение, вызывающее службу WCF может потребоваться другой конечной точке в тестовой и рабочей средах. Приложение университета Contoso также включает параметр такого рода. Этот параметр определяет, отображается индикатор на страницах веб узла, который покажет, какие используемой среды, например, разработки, тестирования или производства. Определяет значение параметра приложения, которые будут добавлены «(Dev)» или «(Test)» в заголовке главного в *Site.Master* главной страницы:

[![Environment_indicator](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/_static/image9.png)](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/_static/image8.png)

Индикатор среды учитывается, если приложение выполняется в рабочей среде.

Веб-страниц университета Contoso считывают значение, заданное в `appSettings` в *Web.config* файл, чтобы определить, какие среды, приложение выполняется в:

[!code-xml[Main](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/samples/sample3.xml)]

Значение должно быть «Test» в тестовой среде, а «Prod» в рабочей среде.

Откройте *Web.Production.config* и добавьте `appSettings` элемент непосредственно перед открывающим тегом элемента `location` элемент, добавленный ранее:

[!code-xml[Main](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/samples/sample4.xml)]

`xdt:Transform` «SetAttributes» указывает, что это преобразование предназначено для изменения значений атрибутов существующего элемента в значение атрибута *Web.config* файл. `xdt:Locator` «Match(key)» указывает, что элемента, который требуется изменить одно значение атрибута которого `key` атрибут соответствует `key` атрибут, указанный здесь. Только другие атрибут `add` элемент является `value`, и это, что будет изменен в развернутой *Web.config* файл. Этот код приводит к `value` атрибут `Environment` `appSettings` элемент будет присвоено «Prod» *Web.config* файл, который развертывается в рабочей среде.

Затем примените те же изменения для *Web.Test.config* файла, за исключением набора `value` «Тест» вместо «Prod». Когда вы закончите, `appSettings` статьи *Web.Test.config* будет выглядеть как в следующем примере:

[!code-xml[Main](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/samples/sample5.xml)]

## <a name="disabling-debug-mode"></a>Отключение режима отладки

Для сборки выпуска вы не требуется запускать независимо от того, среда, которая развертывается. По умолчанию *Web.Release.config* файла преобразования создается автоматически с кодом, который удаляет `debug` из атрибута `compilation` элемент:

[!code-xml[Main](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/samples/sample6.xml)]

`Transform` Атрибут причины `debug` атрибута из развернутого *Web.config* файл при каждом развертывании сборки выпуска.

— Это же преобразование в тестовой и рабочей файлы преобразования, так как их создать, скопировав файл преобразования выпуска. Не требуется его дублирование существует, откройте каждый из этих файлов, удалите **компиляции** элемент и сохраните и закройте все файлы.

## <a name="setting-connection-strings"></a>Настройка строк подключения

В большинстве случаев вам не обязательно для настройки преобразования строки подключения, так как строки подключения можно указать в профиле публикации. Но есть исключение, если вы развертываете базу данных SQL Server Compact, и вы используете Entity Framework Code First Migrations для обновления базы данных на целевом сервере. В этом сценарии необходимо указать строку дополнительные подключения, который будет использоваться для обновления схемы базы данных на сервере. Чтобы настроить это преобразование, добавьте **&lt;connectionStrings&gt;** сразу же после открывающего элемента **&lt;конфигурации&gt;** тег в обоих *Web.Test.config* и *Web.Production.config* преобразования файлов:

[!code-xml[Main](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/samples/sample7.xml)]

`Transform` Атрибут указывает, что эта строка подключения будут добавляться к *connectionStrings* элемент в развернутой *Web.config* файл. (Процесс публикации автоматически создает эту строку дополнительные подключения для вас, если он не существует, но по умолчанию **providerName** атрибут получает значение `System.Data.SqlClient`, который не подходит не для SQL Server Compact. Добавив строку подключения вручную, вы сохраните процесс развертывания от создания элемент строку подключения с именем неверного поставщика.)

Вы теперь указания всех перечисленных *Web.config* преобразований, которые необходимы для развертывания приложения университета Contoso для тестирования и производства. В следующем руководстве вы займусь задачи установки развертывания, которые требуется установить для свойства проекта.

## <a name="more-information"></a>Дополнительные сведения

Дополнительные сведения о разделах рассматриваются в этом руководстве, см. в сценарии преобразования Web.config в [Карта содержимого развертывания ASP.NET](https://msdn.microsoft.com/library/bb386521.aspx).

> [!div class="step-by-step"]
> [Назад](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12.md)
> [Вперед](deployment-to-a-hosting-provider-configuring-project-properties-4-of-12.md)
