---
uid: web-forms/overview/older-versions-getting-started/deployment-to-a-hosting-provider/deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12
title: 'Развертывание веб-приложения ASP.NET с SQL Server Compact с помощью Visual Studio или Visual Web Developer: Миграция на SQL Server - 10 12 | Документация Майкрософт'
author: tdykstra
description: Этой серии руководств показано, как развернуть (публикации) ASP.NET проекта веб-приложения, который содержит базу данных SQL Server Compact с помощью Visual Stu...
ms.author: riande
ms.date: 11/17/2011
ms.assetid: a89d6f32-b71b-4036-8ff7-5f8ac2a6eca8
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deployment-to-a-hosting-provider/deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12
msc.type: authoredcontent
ms.openlocfilehash: 98e521f348cdf1c2bd563f96badbaea6b23f4bcf
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/09/2019
ms.locfileid: "59398960"
---
# <a name="deploying-an-aspnet-web-application-with-sql-server-compact-using-visual-studio-or-visual-web-developer-migrating-to-sql-server---10-of-12"></a>Развертывание веб-приложения ASP.NET с SQL Server Compact с помощью Visual Studio или Visual Web Developer: Миграция на SQL Server - 10 12

по [том Дайкстра](https://github.com/tdykstra)

[Загрузите начальный проект](http://code.msdn.microsoft.com/Deploying-an-ASPNET-Web-4e31366b)

> Этой серии руководств показано, как развернуть (публикации) ASP.NET проекта веб-приложения, который содержит базу данных SQL Server Compact с помощью Visual Studio 2012 RC или Visual Studio Express 2012 RC для Web. Также можно использовать Visual Studio 2010, если установить обновление веб-публикации. Введение в серии, см. в разделе [в первом учебнике серии](deployment-to-a-hosting-provider-introduction-1-of-12.md).
> 
> Учебник, в котором показаны компоненты развертывания, появившиеся после выпуска версии-КАНДИДАТА Visual Studio 2012, содержит сведения о развертывании выпусков SQL Server, отличных от SQL Server Compact и содержит сведения о развертывании веб-приложения службы приложений Azure, см. в разделе [веб-развертывание ASP.NET с помощью Visual Studio](../../deployment/visual-studio-web-deployment/introduction.md).


## <a name="overview"></a>Обзор

Этом руководстве показано, как перенести из SQL Server Compact в SQL Server. Одна из причин, вы можете это сделать, — воспользоваться преимуществами функций SQL Server, SQL Server Compact не поддерживает, таких как хранимые процедуры, триггеры, представления или репликации. Дополнительные сведения о различиях между SQL Server Compact и SQL Server, см. в разделе [развертывание SQL Server Compact](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12.md) руководства.

### <a name="sql-server-express-versus-full-sql-server-for-development"></a>SQL Server Express и полной версии SQL Server для разработки

Если вы решили выполнить обновление до SQL Server, может потребоваться использовать SQL Server или SQL Server Express в средах разработки и тестирования. Помимо различий в средства поддержки и в функциях ядра СУБД существуют различия в реализации поставщика SQL Server Compact и других версиях SQL Server. Эти различия может вызвать один и тот же код для формирования различных результатов. Таким образом Если необходимо сохранить в SQL Server Compact, как базы данных разработки, необходимо тщательно протестировать свой сайт в SQL Server или SQL Server Express в тестовой среде перед каждого развертывания в рабочей среде.

В отличие от SQL Server Compact SQL Server Express — это по сути тот же механизм базы данных и использует один и тот же поставщик .NET в качестве полной версии SQL Server. При тестировании с SQL Server Express, вы можете быть уверены, получения те же результаты, как будет с помощью SQL Server. Можно использовать большую часть тех же средств базы данных с SQL Server Express, можно использовать с SQL Server (важным исключением, [SQL Server Profiler](https://msdn.microsoft.com/library/ms181091.aspx)), а также поддерживает другие функции SQL Server, таких как хранимые процедуры, представления, триггеры, и репликации. (Обычно необходимо использовать полную версию SQL Server в рабочем веб-сайте, однако. SQL Server Express можно запускать в общей среде размещения, но она не предназначалась для этого и многие поставщики услуг размещения не поддерживают его.)

Если вы используете Visual Studio 2012, обычно выбирается SQL Server Express LocalDB для среды разработки так, как это установленных по умолчанию с помощью Visual Studio. Тем не менее LocalDB не работает в IIS, поэтому для тестовой среды, необходимо использовать SQL Server или SQL Server Express.

### <a name="combining-databases-versus-keeping-them-separate"></a>Объединение и их поддержка отдельных баз данных

Приложение университета Contoso имеет две базы данных SQL Server Compact: базы данных членства (*aspnet.sdf*) и базе данных приложения (*School.sdf*). При миграции, можно перенести эти базы данных на две отдельные базы данных или в одной базе данных. Может потребоваться объединить их для упрощения базы данных соединения между вашей базы данных приложения и базы данных членства. План размещения также может указать причину их объединение. Например поставщика услуг размещения может взимать плату сведения для нескольких баз данных или даже не поддерживают более одной базы данных. Это в случае с Cytanium Lite, размещение учетной записи, которая используется для этого руководства, что позволяет только отдельной базы данных SQL Server.

В этом руководстве будет перенести две базы данных таким образом:

- Перенос в две базы данных LocalDB в среде разработки.
- Перенос в двух баз данных на SQL Server Express в тестовой среде.
- Перенос одного объединенного полную базу данных SQL Server в рабочей среде.

Напоминание. Если вы получаете сообщение об ошибке, или что-то не работает, как работать с руководством, обязательно проверьте [страница устранения неполадок](deployment-to-a-hosting-provider-creating-and-installing-deployment-packages-12-of-12.md).

## <a name="installing-sql-server-express"></a>Установка SQL Server Express

SQL Server, экспресс-выпуск автоматически устанавливается по умолчанию вместе с Visual Studio 2010, но по умолчанию он не устанавливается вместе с Visual Studio 2012. Чтобы установить SQL Server 2012 Express, щелкните следующую ссылку

- [SQL Server Express 2012](https://www.microsoft.com/download/details.aspx?id=29062)

Выберите *ENU/x64/SQLEXPR\_x64\_ENU.exe* или *ENU/x86/SQLEXPR\_x86\_ENU.exe*и в мастере установки примите имя по умолчанию Параметры. Дополнительные сведения о параметрах установки см. в разделе [Установка SQL Server 2012 с помощью мастера установки (программа установки)](https://msdn.microsoft.com/library/ms143219.aspx).

## <a name="creating-sql-server-express-databases-for-the-test-environment"></a>Создание баз данных SQL Server Express для тестовой среды

Следующим шагом является создание членства ASP.NET и базы данных School.

Из **представление** меню выберите **обозревателя серверов** (**обозреватель баз данных** в Visual Web Developer) и щелкните правой кнопкой мыши **подключения к данным**и выберите **создать новую базу данных SQL Server**.

![Selecting_Create_New_SQL_Server_Database](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image1.png)

В **создать новую базу данных SQL Server** диалогового окна введите «. \SQLExpress» в **имя сервера** поле и «aspnet-Test» в **новое имя базы данных** , а затем нажмите кнопку **ОК**.

![Create_New_SQL_Server_Database_aspnet](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image2.png)

Выполните ту же процедуру, чтобы создать новую базу данных SQL Server Express School с именем «School-Test».

(Добавляются «Test» эти имена баз данных, так как позже вы создадите дополнительный экземпляр каждой базы данных для среды разработки, и вам нужно иметь возможность провести различие двух наборов баз данных.)

**Обозреватель серверов** теперь отображаются два новых баз данных.

![New_databases_in_Server_Explorer](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image3.png)

## <a name="creating-a-grant-script-for-the-new-databases"></a>Создание скрипта предоставления доступа для новых баз данных

При выполнении приложения в службах IIS на компьютере разработчика, приложение обращается к базе данных, используя учетные данные пула приложений по умолчанию. Тем не менее по умолчанию удостоверение пула приложений имеет разрешение на открытие баз данных. Так что вам нужно запустить сценарий предоставлять ему такое разрешение. В этом разделе описано создание скрипта, что вы запустите более поздней версии, чтобы убедиться в том, что приложение можно открыть баз данных, когда оно работает в IIS.

В решении *SolutionFiles* папку, созданную в [развертывание в рабочей среде](deployment-to-a-hosting-provider-deploying-to-the-production-environment-7-of-12.md) руководства, создайте новый файл SQL *Grant.sql*. Скопируйте следующие команды SQL в файл, а затем сохраните и закройте файл:

[!code-sql[Main](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/samples/sample1.sql)]

> [!NOTE]
> Этот сценарий предназначен для работы с SQL Server 2008 и параметры IIS в Windows 7, как они указаны в этом руководстве. При использовании другой версии SQL Server или Windows или если вы настроили IIS на компьютере по-разному, изменения в этот сценарий может потребоваться. Дополнительные сведения о сценарии SQL Server, см. в разделе [SQL Server Books Online](https://go.microsoft.com/fwlink/?LinkId=132511).


> [!NOTE] 
> 
> **Примечание по безопасности** этот сценарий дает db\_права владельца для пользователя, который обращается к базе данных во время выполнения, который является то, что вы в рабочей среде. В некоторых сценариях может потребоваться указать пользователя, имеющего схемы всей базы данных, обновить разрешения только для развертывания и указать во время выполнения другого пользователя с разрешениями только для чтения и записи данных. Дополнительные сведения см. в разделе **просмотрите автоматического изменения в файл Web.config для Code First Migrations** в [развертывание в IIS в качестве тестовой среды](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12.md).


## <a name="configuring-database-deployment-for-the-test-environment"></a>Настройка развертывания базы данных для тестовой среды

Далее можно настроить Visual Studio, то есть он будет выполнять следующие задачи для каждой базы данных:

- Создайте скрипт SQL, который создает структуру исходной базы данных (таблицы, столбцы, ограничения и т. д.) в целевой базе данных.
- Создайте скрипт SQL, который вставляет исходной базы данных в таблицы в целевой базе данных.
- Запустите сформированные скрипты и предоставление сценарий, который вы создали, в целевой базе данных.

Откройте **свойства проекта** и выберите **упаковка и публикация SQL** вкладки.

Убедитесь, что **Активная (Release)** или **выпуска** выбран в **конфигурации** стрелку раскрывающегося списка.

Нажмите кнопку **включить эту страницу**.

![Package_Publish_SQL_tab_Enable_This_page](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image4.png)

**Упаковка и публикация SQL** вкладка обычно отключена, поскольку он указывает метод развертывания устаревших версий. В большинстве случаев необходимо настроить развертывание базы данных в **веб-публикации** мастера. Миграция из SQL Server Compact в SQL Server или SQL Server Express является особым случаем, для которого этот метод является хорошим выбором.

Нажмите кнопку **Импорт из Web.config**.

![Selecting_Import_from_Web.config](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image5.png)

Visual Studio выполняет поиск строки подключения в *Web.config* файла, находит один для базы данных членства и один для базы данных School и добавляет строку, соответствующую каждой строки соединения в **записи базы данных**  таблицы. Находит строки подключения для существующих баз данных SQL Server Compact и следующим шагом будет Настройка, способ и место для развертывания этих баз данных.

Введите параметры развертывания базы данных в **Подробности записи базы данных** раздел ниже **записи базы данных** таблицы. Параметры, отображаемые в **Подробности записи базы данных** разделе относятся к какой строки в **записи базы данных** выбрана таблица, как показано на следующем рисунке.

![Database_Entry_Details_section_of_Package_Publish_SQL_tab](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image6.png)

### <a name="configuring-deployment-settings-for-the-membership-database"></a>Настройка параметров развертывания для базы данных членства

Выберите **DefaultConnection развертывания** строки в **записи базы данных** таблицы, чтобы настроить параметры, которые применяются к базе данных членства.

В **строку подключения для целевой базы данных**, введите строку подключения, который указывает на базе членства SQL Server Express. Вы можете получить строку подключения, вам понадобятся из **обозревателя серверов**. В **обозревателя серверов**, разверните **подключения к данным** и выберите **aspnetTest** базы данных, а затем из **свойства** окно копирования **Строку подключения** значение.

![aspnet_connection_string_in_Server_Explorer](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image7.png)

Здесь приведен ту же строку подключения:

[!code-console[Main](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/samples/sample2.cmd)]

Скопируйте и вставьте строку подключения в **строку подключения для целевой базы данных** в **упаковка и публикация SQL** вкладки.

Убедитесь, что **запрос данных или схемы из существующей базы данных** выбран. Это, что вызывает скрипты SQL для автоматически создается и запустить в целевой базе данных.

**Строку подключения для базы данных-источника** значение извлекается из *Web.config* файл и указывает на базу данных SQL Server Compact разработки. Это база данных источника, который будет использоваться для создания сценариев, которые будут выполняться далее в целевой базе данных. Так как вы хотите выполнить развертывание рабочей версии базы данных, измените «aspnet-Dev.sdf» на «aspnet-Prod.sdf».

Изменение **параметры скрипта базы данных** из **только схема** для **схему и данные**, поскольку требуется скопировать данные (учетные записи пользователей и роли), а также структуру базы данных.

Для настройки развертывания для выполнения скриптов grant, которые вы создали ранее, необходимо добавить их в **скрипты базы данных** раздел. Нажмите кнопку **добавить сценарий**и в **Добавление скриптов SQL** диалоговом окне перейдите в папку, в котором был сохранен сценарий предоставления (это папку, содержащую файл решения). Выберите файл с именем *Grant.sql*и нажмите кнопку **откройте**.

[![Select_File_dialog_box_grant_script](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image9.png)](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image8.png)

Параметры для **DefaultConnection развертывания** строки в **записи базы данных** теперь выглядеть как на следующем рисунке:

![Database_Entry_Details_for_DefaultConnection_Test](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image10.png)

### <a name="configuring-deployment-settings-for-the-school-database"></a>Настройка параметров развертывания для базы данных School

Затем выберите **SchoolContext развертывания** строки в **записи базы данных** таблицы, чтобы настроить параметры развертывания для базы данных School.

Можно использовать тот же метод, который использовался ранее для получения строки подключения для новой базы данных SQL Server Express. Скопируйте эту строку подключения в **строку подключения для целевой базы данных** в **упаковка и публикация SQL** вкладки.

[!code-console[Main](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/samples/sample3.cmd)]

Убедитесь, что **запрос данных или схемы из существующей базы данных** выбран.

**Строку подключения для базы данных-источника** значение извлекается из *Web.config* файл и указывает на базу данных SQL Server Compact разработки. Измените «School Dev.sdf» на «School-Prod.sdf» для развертывания рабочей версии базы данных. (Никогда не был создан файл School Prod.sdf в приложении\_папку данных, поэтому вы скопируете этот файл из тестовой среды в приложение\_папка данных в папке проекта ContosoUniversity позже.)

Изменение **параметры скрипта базы данных** для **схему и данные**.

Требуется, чтобы запустить сценарий предоставляют права чтения и записи разрешения для этой базы данных пула приложений, поэтому необходимо добавить *Grant.sql* файл сценария, как это делалось для базы данных членства.

Когда все будет готово, параметры **SchoolContext развертывания** строки в **записи базы данных** выглядеть как на следующем рисунке:

![Database_Entry_Details_for_SchoolContext_Test](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image11.png)

Сохраните изменения в **упаковка и публикация SQL** вкладки.

Копировать *School-Prod.sdf* файла из *c:\inetpub\wwwroot\ContosoUniversity\App\_данных* папку для *приложения\_данных* папки в проект "ContosoUniversity".

### <a name="specifying-transacted-mode-for-the-grant-script"></a>Указание режима транзакций для предоставления скрипта

Процесс развертывания создает скрипты, которые развертывание схемы базы данных и данных. По умолчанию эти скрипты выполняются в транзакции. Тем не менее пользовательские скрипты (например, сценарии grant) по умолчанию не запускаются в транзакции. Если процесс развертывания содержатся одновременно режимы транзакций, может возникнуть ошибка времени ожидания, скрипты запускаются во время развертывания. В этом разделе вы измените файл проекта для настройки пользовательских скриптов для запуска в транзакции.

В **обозревателе решений**, щелкните правой кнопкой мыши **ContosoUniversity** проекта и выберите **выгрузить проект**.

![Unload_Project_in_Solution_Explorer](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image12.png)

Затем щелкните правой кнопкой мыши проект и выберите **изменить ContosoUniversity.csproj**.

![Edit_Project_in_Solution_Explorer](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image13.png)

В редакторе Visual Studio показано XML-содержимое файла проекта. Обратите внимание на то, что существует несколько `PropertyGroup` элементов. (На рисунке, содержимое `PropertyGroup` элементы опущены.)

![Окно редактора файла проекта](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image15.png)

Первый, который не имеет `Condition` атрибут, для параметров, которые применяются независимо от конфигурации построения. Один `PropertyGroup` элемент применяется только к отладочной конфигурации сборки (Примечание `Condition` атрибут), один применяется только к конфигурации построения выпуска, и один применяется только к конфигурации сборки теста. В рамках `PropertyGroup` элемент конфигурации построения выпуска, вы увидите `PublishDatabaseSettings` элемент, который содержит параметры, введенные на **упаковка и публикация SQL** вкладки. Имеется `Object` элемент, соответствующий каждому сценариев grant заданных (Обратите внимание, что два экземпляра класса «Grant.sql»). По умолчанию `Transacted` атрибут `Source` отсутствует элемент для каждого сценария предоставления `False`.

![Transacted_false](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image16.png)

Измените значение свойства `Transacted` атрибут `Source` элемент `True`.

![Transacted_true](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image17.png)

Сохраните и закройте файл проекта щелкните правой кнопкой мыши проект в **обозревателе решений** и выберите **перезагрузить проект**.

![Reload_project](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image18.png)

## <a name="setting-up-webconfig-transformations-for-the-connection-strings"></a>Настройка преобразования Web.Config для строки подключения

Строки подключения для нового выпуска SQL Express баз данных, было введено **упаковка и публикация SQL** вкладке используются веб-развертывания только для обновления целевой базы данных во время развертывания. Вам по-прежнему нужно настроить *Web.config* преобразования таким образом, чтобы строки подключения в развернутой *Web.config* файл точки в новые базы данных SQL Server Express. (При использовании **упаковка и публикация SQL** вкладке нельзя настроить строки подключения в профиле публикации.)

Откройте *Web.Test.config* и замените `connectionStrings` элемент с `connectionStrings` элемента в следующем примере. (Убедитесь, что вы только скопируйте элемент connectionStrings, не окружающий код, показанный здесь для предоставления контекста.)

[!code-xml[Main](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/samples/sample4.xml?highlight=2-11)]

Этот код приводит к `connectionString` и `providerName` атрибуты каждого `add` элемента, заменяемого в развернутой *Web.config* файл. Эти строки подключения не идентичны тем, введенный в **упаковка и публикация SQL** вкладки. Параметр «MultipleActiveResultSets = True» был добавлен к ним, так как это обязательно для Entity Framework и универсальные поставщики.

## <a name="installing-sql-server-compact"></a>Установка SQL Server Compact

Пакет SqlServerCompact NuGet предоставляет базе данных SQL Server Compact ядра сборок для приложения университета Contoso. Но теперь это не приложение, но веб-развертывания, который должен иметь возможность читать базы данных SQL Server Compact, чтобы создать скрипты для запуска в базах данных SQL Server. Чтобы включить веб-развертывание для чтения базы данных SQL Server Compact, установите SQL Server Compact на компьютере разработчика, с помощью следующей ссылки: [Microsoft SQL Server Compact 4.0](https://www.microsoft.com/downloads/details.aspx?FamilyID=15F7C9B3-A150-4AD2-823E-E4E0DCF85DF6).

## <a name="deploying-to-the-test-environment"></a>Развертывание в тестовой среде

Чтобы опубликовать в тестовую среду, необходимо создать профиль публикации, который настроен для использования **упаковка и публикация SQL** вкладку для базы данных публикации, а не параметры базы данных профиля публикации.

Сначала удалите существующий профиль тестирования.

В **обозревателе решений**, щелкните правой кнопкой мыши проект ContosoUniversity и нажмите кнопку **публикации**.

Выберите **профиль** вкладки.

Нажмите кнопку **Управление профилями**.

Выберите **теста**, нажмите кнопку **удалить**, а затем нажмите кнопку **закрыть**.

Закрыть **веб-публикации** мастер должен сохранить это изменение.

Затем создайте новый профиль тестирования и использовать его для публикации проекта.

В **обозревателе решений**, щелкните правой кнопкой мыши проект ContosoUniversity и нажмите кнопку **публикации**.

Выберите **профиль** вкладки.

Выберите **&lt;New... &gt;** из раскрывающегося списка и введите имя профиля «Тестирование».

В **URL-адрес службы** введите *localhost*.

В **сайт и приложение** введите *веб-сайт по умолчанию/ContosoUniversity*.

В **URL-адрес назначения** введите `http://localhost/ContosoUniversity/`.

Нажмите кнопку **Далее**.

**Параметры** вкладке предупреждает, **упаковка и публикация SQL** вкладке будет настроена, и он дает возможность переопределить их, нажав кнопку Разрешить улучшения публикации новой базы данных. Для этого развертывания не требуется переопределять **упаковка и публикация SQL** параметров вкладки, поэтому просто нажмите кнопку **Далее**.

![Publish_Web_wizard_Settings_tab_Migrate](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image19.png)

Сообщение на **предварительной версии** вкладке указывает, что **не выбраны базы данных для публикации**, но это только означает, что публикация баз данных не настроена в профиле публикации.

Нажмите кнопку **Опубликовать**.

![Publish_Web_wizard_Preview_tab_Migrate](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image20.png)

Visual Studio развертывает приложение и открывает браузер на домашнюю страницу сайта в тестовой среде. Откройте страницу Instructors для см. в разделе, отображаются те же данные, обсуждавшейся ранее. Запустите **добавить учащихся** странице, добавить нового учащегося, а затем просмотрите нового учащегося в **учащихся** страницы. Это подтверждает, что можно обновлять базы данных. Выберите **обновления кредиты** страницы (вам потребуется снова войти) для проверки базы данных членства была развернута и у вас есть доступ к нему.

## <a name="creating-a-sql-server-database-for-the-production-environment"></a>Создание базы данных SQL Server для рабочей среды

Теперь, когда вы развернули в тестовую среду, вы будете готовы настроить развертывание в рабочей среде. Как начать, как это делалось для тестовой среды, создав базу данных для развертывания. Как вы помните из обзора, Cytanium Lite плана размещения разрешает только отдельной базы данных SQL Server, поэтому необходимо настроить только одну базу данных, не как два. Все таблицы и данные из членства и базы данных School SQL Server Compact будут развернуты в одной базе данных SQL Server в рабочей среде.

Перейдите к панели управления Cytanium в [ http://panel.cytanium.com ](http://panel.cytanium.com). Наведите указатель мыши на **баз данных** и нажмите кнопку **SQL Server 2008**.

[![Selecting_Databases_in_Control_Panel](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image22.png)](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image21.png)

В **SQL Server 2008** щелкните **Create Database**.

[![Selecting_Create_Database](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image24.png)](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image23.png)

Имя базы данных «School» и нажмите кнопку **Сохранить**. (Страницы автоматически добавляет префикс «contosou», поэтому эффективный будет называться «contosouSchool».)

[![Naming_the_database](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image26.png)](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image25.png)

На этой же странице щелкните **Create User**. На Cytanium на серверах, а не с использованием встроенной безопасности Windows и позволить удостоверение пула приложений откройте нужную базу данных вы создадите пользователя, имеющего полномочия открывать базы данных. Вам предстоит добавить учетные данные пользователя строки подключения, которые необходимо выполнить в рабочей среде *Web.config* файл. На этом шаге вы создадите эти учетные данные.

[![Creating_a_database_user](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image28.png)](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image27.png)

Заполните обязательные поля в **свойства пользователя SQL** страницы:

- Введите «ContosoUniversityUser» в качестве имени.
- Введите пароль.
- Выберите **contosouSchool** как базы данных по умолчанию.
- Выберите **contosouSchool** "флажок".

[![SQL_User_Properties_page](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image30.png)](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image29.png)

## <a name="configuring-database-deployment-for-the-production-environment"></a>Настройка развертывания базы данных для рабочей среды

Теперь все готово к настройке параметров развертывания базы данных в **упаковка и публикация SQL** вкладке, как это делалось ранее для тестовой среды.

Откройте **свойства проекта** выберите **упаковка и публикация SQL** вкладке и убедитесь, что **Активная (Release)** или **выпуска** — выбранные в **конфигурации** стрелку раскрывающегося списка.

При настройке параметров развертывания для каждой базы данных, основное различие между возможностях для рабочей и тестовой сред находится в том, как настроить строки подключения. Для тестовой среды, вы ввели строк подключения для другой базы данных, но для рабочей среды целевой строки подключения будет одинаковым для обеих баз данных. Это так, как вы развертываете обе базы данных к одной базе данных в рабочей среде.

### <a name="configuring-deployment-settings-for-the-membership-database"></a>Настройка параметров развертывания для базы данных членства

Чтобы настроить параметры, которые применяются к базе данных членства, выберите **DefaultConnection развертывания** строки в **записи базы данных** таблицы.

В **строку подключения для целевой базы данных**, введите строку соединения, указывающий на новой базы данных SQL Server рабочей среде, вы только что создали. Строку подключения можно получить из вашей приветственное сообщение электронной почты. Нужная часть сообщения электронной почты содержит следующий пример строки подключения:

[!code-console[Main](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/samples/sample5.cmd)]

После замены три переменные, строки подключения, необходимые выглядит следующим образом:

[!code-console[Main](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/samples/sample6.cmd)]

Скопируйте и вставьте строку подключения в **строку подключения для целевой базы данных** в **упаковка и публикация SQL** вкладки.

Убедитесь, что **запрос данных или схемы из существующей базы данных** снимая выделение, и что **параметры скрипта базы данных** по-прежнему **схему и данные**.

В **скрипты базы данных** снимите флажок рядом с Grant.sql скрипт.

![Disable_Grant_script](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image31.png)

### <a name="configuring-deployment-settings-for-the-school-database"></a>Настройка параметров развертывания для базы данных School

Затем выберите **SchoolContext развертывания** строки в **записи базы данных** таблицы для настройки параметров базы данных School.

Скопируйте одну и ту же строку подключения в **строку подключения для целевой базы данных** , скопированные в это поле для базы данных членства.

Убедитесь, что **запрос данных или схемы из существующей базы данных** снимая выделение, и что **параметры скрипта базы данных** по-прежнему **схему и данные**.

В **скрипты базы данных** снимите флажок рядом с Grant.sql скрипт.

Сохраните изменения в **упаковка и публикация SQL** вкладки.

## <a name="setting-up-webconfig-transforms-for-the-connection-strings-to-production-databases"></a>Настройка Web.Config преобразований для строк подключения к производственным базам данных

Далее необходимо настроить *Web.config* преобразования таким образом, чтобы строки подключения в развернутой *Web.config* в файле для новой рабочей базы данных. Строка подключения, введенных на **упаковка и публикация SQL** вкладка для веб-развертывания для использования является таким же, как приложение должно использовать, за исключением добавления `MultipleResultSets` параметр.

Откройте *Web.Production.config* и замените `connectionStrings` элемент с `connectionStrings` элемент, который выглядит как в следующем примере. (Копировать только `connectionStrings` элемент, не окружающей теги, которые показывают контекста.)

[!code-xml[Main](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/samples/sample7.xml?highlight=2-11)]

Иногда см. Советы о том, чтобы всегда шифрования строк подключения в *Web.config* файл. Это может быть целесообразным, если вы выполняли развертывание серверов в сети вашей компании. При развертывании в общей среде размещения, вы просто Верите по обеспечению безопасности поставщика услуг размещения, и он является необязательным и удобным для шифрования строк подключения.

## <a name="deploying-to-the-production-environment"></a>Развертывание в рабочей среде

Теперь все готово к развертыванию в рабочей среде. Веб-развертывание будет считывать базах данных SQL Server Compact в вашем проекте *приложения\_данных* папки и заново создайте все таблицы и данных в SQL Server рабочей базы данных. Для публикации с помощью **пакета и публикация веб-** параметрами табуляции, то необходимо создать новый профиль публикации для рабочей среды.

Во-первых можно удалите существующий профиль рабочей среде, как и раньше профиль тестирования.

В **обозревателе решений**, щелкните правой кнопкой мыши проект ContosoUniversity и нажмите кнопку **публикации**.

Выберите **профиль** вкладки.

Нажмите кнопку **Управление профилями**.

Выберите **рабочей**, нажмите кнопку **удалить**, а затем нажмите кнопку **закрыть**.

Закрыть **веб-публикации** мастер должен сохранить это изменение.

Затем создайте новый профиль для производства и использовать его для публикации проекта.

В **обозревателе решений**, щелкните правой кнопкой мыши проект ContosoUniversity и нажмите кнопку **публикации**.

Выберите **профиль** вкладки.

Нажмите кнопку **импорта**и выберите файл .publishsettings, который вы загрузили ранее.

На **подключения** вкладке **URL-адрес назначения** на правильный временный URL-адрес, который в данном примере — http://contosouniversity.com.vserver01.cytanium.com.

Переименуйте профиль в рабочей среде. (Выберите **профиль** вкладку и нажмите кнопку **Управление профилями** для этого).

Закрыть **веб-публикации** мастера, чтобы сохранить изменения.

В реальном приложении, в котором при обновлении базы данных в рабочей среде вы бы делать еще два действия перед публикацией:

1. Отправка *приложения\_offline.htm*, как показано в [развертывание в рабочей среде](deployment-to-a-hosting-provider-deploying-to-the-production-environment-7-of-12.md) руководства.
2. Используйте **диспетчер файлов** компонент панели управления Cytanium копируемые *aspnet Prod.sdf* и *School-Prod.sdf* файлы с рабочего сайта *Приложения\_данных* папку проекта ContosoUniversity. Это гарантирует, что данные, которые вы развертываете в новую базу данных SQL Server включает последние обновления, выполненные на рабочем веб-сайте.

В **веб-публикация одним щелкните** панели инструментов, убедитесь, что **рабочей** выбран, а затем нажмите кнопку **публикации**.

Если вы отправили <em>приложения\_offline.htm</em> перед публикацией, необходимо использовать <strong>диспетчер файлов</strong> в панели управления Cytanium удалить <em>приложения\_вне сети.</em> htm, прежде чем тестировать. Также можно одновременно удалить <em>.sdf</em> файлов из <em>приложения\_данных</em> папки.

Теперь можно открыть браузер и перейдите к URL-адрес общедоступного веб-сайта для тестирования приложения так же, как и после развертывания в тестовую среду.

## <a name="switching-to-sql-server-express-localdb-in-development"></a>Переключение на SQL Server Express LocalDB в разработке

Как было упомянуто в обзоре, обычно лучше использовать один и тот же механизм базы данных в разработке, используемом в тестовой и рабочей. (Помните, что с помощью SQL Server Express в разработке удобен тем, что базы данных работают также в средах разработки, тестовой и рабочей). В этом разделе настроим ContosoUniversity проект для использования SQL Server Express LocalDB, при запуске приложения из Visual Studio.

Самый простой способ выполнить миграцию для Code First и система членства создать оба новые базы данных разработки для вас. С помощью этого метода для переноса состоит из трех шагов:

1. Измените строку подключения для указания новых баз данных SQL Express LocalDB.
2. Запустите средство администрирования веб-сайта, чтобы создать пользователя-администратора. При этом создается в базе данных членства.
3. Команда обновления базы данных Code First Migrations для создания и заполнения базы данных приложения.

### <a name="updating-connection-strings-in-the-webconfig-file"></a>Обновление строки подключения в файле Web.config

Откройте *Web.config* и заменить `connectionStrings` следующим кодом:

[!code-xml[Main](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/samples/sample8.xml)]

### <a name="creating-the-membership-database"></a>Создание базы данных членства

В **обозревателе решений**, выберите проект ContosoUniversity и нажмите кнопку **Конфигурация ASP.NET** в **проекта** меню.

Выберите вкладку «Безопасность».

Нажмите кнопку **Создание или управление ролями**, а затем создайте **администратора** роли.

Вернитесь на вкладку Безопасность.

Нажмите кнопку **создать пользователя**, а затем выберите **администратора** флажок и создайте пользователя с именем администратора.

Закрыть **Web Site Administration Tool**.

### <a name="creating-the-school-database"></a>Создание базы данных School

Откройте окно консоли диспетчера пакетов.

В **проект по умолчанию** раскрывающегося списка выберите ContosoUniversity.DAL проекта.

Введите следующую команду:

[!code-powershell[Main](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/samples/sample9.ps1)]

Code First Migrations применяется начальной миграции, который создает базу данных, а затем применяет AddBirthDate миграции, а затем он выполняет метод заполнения.

Запустите сайт, нажав клавишу Control F5. Как это делалось для сред тестирования и производственная среда выполнения **добавить учащихся** странице, добавить нового учащегося, а затем просмотрите нового учащегося в **учащихся** страницы. Это подтверждает, что базы данных School был создан и инициализирован, и что вы прочитали и доступ на запись к нему.

Выберите **обновления кредиты** странице и войдите в систему, чтобы убедиться, что базе данных членства была развернута и у вас доступ к нему. Если не перенести учетные записи пользователей, создать учетную запись администратора, а затем выберите **обновления кредиты** страницу, чтобы убедиться, что оно работает.

## <a name="cleaning-up-sql-server-compact-files"></a>Очистка файлы SQL Server Compact

Ненужные файлы и пакеты NuGet, которые были включены для поддержки SQL Server Compact. Если вы хотите, чтобы (этот шаг не является обязательным), можно удалить ненужные файлы и ссылки.

В **обозревателе решений**, удалить *.sdf* файлов из *приложения\_данных* папки и *amd64* и *x86* папок из *bin* папки.

В **обозревателе решений**, щелкните правой кнопкой мыши решение (не из проектов) и нажмите кнопку **управление пакетами NuGet для решения**.

В левой части **управление пакетами NuGet** выберите **установленные пакеты**.

Выберите **EntityFramework.SqlServerCompact** пакета и нажмите кнопку **управление**.

В **выберите проекты** диалоговом окне выбраны оба проекта. Чтобы удалить пакет, в обоих проектах, снимите оба флажка, а затем нажмите кнопку **ОК**.

В диалоговом окне с вопросом, следует ли также удалить зависимые пакеты, нажмите кнопку "Нет". Один из них — это платформа Entity Framework, вам необходимо следить.

Выполните ту же процедуру для удаления **SqlServerCompact** пакета. (Пакеты необходимо удалить в указанном порядке, так как **EntityFramework.SqlServerCompact** зависит от пакета **SqlServerCompact** пакета.)

Вы успешно перенесли в SQL Server Express и полной версии SQL Server. В следующем учебнике, другого изменения базы данных, и будет показано, как для развертывания изменений базы данных при тестовой и рабочей баз данных с помощью SQL Server Express и полной версии SQL Server.

> [!div class="step-by-step"]
> [Назад](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12.md)
> [Вперед](deployment-to-a-hosting-provider-deploying-a-sql-server-database-update-11-of-12.md)
