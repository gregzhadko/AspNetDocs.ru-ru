---
uid: web-forms/overview/older-versions-getting-started/master-pages/specifying-the-master-page-programmatically-cs
title: Программное указание главной страницы (C#) | Документация Майкрософт
author: rick-anderson
description: Ищет на уровне страницы содержимого главной страницы программно через обработчик событий PreInit.
ms.author: riande
ms.date: 07/28/2008
ms.assetid: 7c4a3445-2440-4aee-b9fd-779c05e6abb2
msc.legacyurl: /web-forms/overview/older-versions-getting-started/master-pages/specifying-the-master-page-programmatically-cs
msc.type: authoredcontent
ms.openlocfilehash: 0d56a600b1b97d9d044fa90b678c942f0dc6fc00
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/09/2019
ms.locfileid: "59413832"
---
# <a name="specifying-the-master-page-programmatically-c"></a>Программное указание эталонной страницы (C#)

по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Скачать код](http://download.microsoft.com/download/d/6/6/d66ad554-afdd-409e-a5c3-201b774fbb31/ASPNET_MasterPages_Tutorial_09_CS.zip) или [скачать PDF](http://download.microsoft.com/download/d/6/6/d66ad554-afdd-409e-a5c3-201b774fbb31/ASPNET_MasterPages_Tutorial_09_CS.pdf)

> Ищет на уровне страницы содержимого главной страницы программно через обработчик событий PreInit.


## <a name="introduction"></a>Вступление

Так как в примере со вступительной статьей в [ *Создание сайта макета с помощью главных страниц*](creating-a-site-wide-layout-using-master-pages-cs.md), все содержимое страницы ссылаетесь на их главную страницу декларативно с помощью `MasterPageFile` атрибут в `@Page`директива. Например, следующая `@Page` директива связывает страницы содержимого на главную страницу `Site.master`:


[!code-aspx[Main](specifying-the-master-page-programmatically-cs/samples/sample1.aspx)]

[ `Page` Класс](https://msdn.microsoft.com/library/system.web.ui.page.aspx) в `System.Web.UI` пространство имен включает [ `MasterPageFile` свойство](https://msdn.microsoft.com/library/system.web.ui.page.masterpagefile.aspx) , возвращает путь к странице содержимого главной страницы; именно это свойство, которое устанавливается с `@Page` директива. Это свойство также может использоваться программное указание главной страницы на странице содержимого. Этот подход полезен, если вы хотите динамически назначать главной страницы, в зависимости от внешних факторов, таких как пользователя, посещающего страницу.

В этом руководстве мы добавьте второй главную страницу для нашего веб-сайта и динамически решать, какие главной страницы, используемой во время выполнения.

## <a name="step-1-a-look-at-the-page-lifecycle"></a>Шаг 1. Краткий обзор жизненного цикла страницы

Каждый раз, когда запрос прибывает в веб-сервера для страницы ASP.NET, которая является страницей содержимого, механизм ASP.NET необходимо объединять страницы содержимого элементов управления в файл главной страницы, соответствующая элементов управления ContentPlaceHolder. Этот fusion создает иерархию одного элемента управления, который затем можно перейти через жизненный цикл страницы обычно.

Рис. 1 иллюстрирует этот fusion. Шаг 1 на рис. 1 показаны исходное содержимое и иерархий управления главной страницы. Элементы управления страницы добавляются в конец этапа PreInit содержимое соответствующих элементов управления ContentPlaceHolder на главной странице (шаг 2). После этого fusion главной страницы служит в качестве корневого элемента иерархии склеенную элемента управления. Это совмещенного управления иерархии затем добавляется на страницу для создания иерархии завершенных элементов управления (шаг 3). Конечным результатом является, включающее иерархии склеенную элементов управления в иерархии элементов управления страницы.


[![Tон главной страницы и страницы содержимого элемента управления иерархии являются совмещенного друг с другом на этапе PreInit](specifying-the-master-page-programmatically-cs/_static/image2.png)](specifying-the-master-page-programmatically-cs/_static/image1.png)

**Рис 01**: Главной страницы и страницы содержимого элемента управления иерархии являются совмещенного друг с другом на этапе PreInit ([Просмотр полноразмерного изображения](specifying-the-master-page-programmatically-cs/_static/image3.png))


## <a name="step-2-setting-themasterpagefileproperty-from-code"></a>Шаг 2. Параметр`MasterPageFile`свойство из кода

Partakes главную страницу в этом fusion зависит от значения `Page` объекта `MasterPageFile` свойство. Установка `MasterPageFile` атрибут в `@Page` директива имеет в итоге назначение `Page`в `MasterPageFile` свойства на этапе инициализации, который является самый первый этап жизненного цикла страницы. Мы также это свойство можно задать программным образом. Тем не менее крайне важно, что это свойство быть задано до выполнения fusion на рис. 1.

В начале этапа PreInit `Page` объекта вызывает его [ `PreInit` событий](https://msdn.microsoft.com/library/system.web.ui.page.preinit.aspx) и вызывает его [ `OnPreInit` метод](https://msdn.microsoft.com/library/system.web.ui.page.onpreinit.aspx). Чтобы программно задать главной страницы, затем мы можно создать обработчик событий для `PreInit` событий или переопределение `OnPreInit` метод. Давайте взглянем на оба подхода.

Сначала откройте `Default.aspx.cs`, файл класса фонового кода для домашней страницы в нашем сайте. Добавьте обработчик событий для страницы `PreInit` событий, введя следующий код:


[!code-csharp[Main](specifying-the-master-page-programmatically-cs/samples/sample2.cs)]

Здесь можно задать `MasterPageFile` свойства. Обновите код, чтобы он присваивает значение «~ / Site.master» для `MasterPageFile` свойство.


[!code-csharp[Main](specifying-the-master-page-programmatically-cs/samples/sample3.cs)]

Если установить точку останова и запуск с отладкой, вы увидите, что каждый раз, когда `Default.aspx` посещенные страницы или каждый раз, когда имеется обратную передачу на эту страницу `Page_PreInit` выполнения обработчика событий и `MasterPageFile` назначается свойство «~ / Site.master».

Кроме того, можно переопределить `Page` класса `OnPreInit` метод и набор `MasterPageFile` существует свойство. В этом примере не установим главной страницы в конкретной страницы, а лишь из `BasePage`. Помните, мы создали пользовательского базового класса страницы (`BasePage`) обратно в [ *указание названия, метатегов и других заголовков HTML на главной странице* ](specifying-the-title-meta-tags-and-other-html-headers-in-the-master-page-cs.md) руководства. В настоящее время `BasePage` переопределяет `Page` класса `OnLoadComplete` метод, где он задает страницы `Title` значение в зависимости от данных карты узла. Давайте обновим `BasePage` также переопределить `OnPreInit` метод программное указание главной страницы.


[!code-csharp[Main](specifying-the-master-page-programmatically-cs/samples/sample4.cs)]

Так как все наши страницы содержимого являются производными от `BasePage`, все они теперь имеют свои главной страницы, которые назначены программными методами. На этом этапе `PreInit` обработчик событий в `Default.aspx.cs` является излишним; вы можете удалить его.

### <a name="what-about-thepagedirective"></a>Как насчет`@Page`директива?

Что может быть немного сбить с толку является то, что страницы содержимого `MasterPageFile` свойства сейчас указываются в двух местах: в обработчике `BasePage` класса `OnPreInit` метод а также `MasterPageFile` атрибут в каждую страницу содержимого `@Page` директива.

Первый этап в жизненном цикле страницы находится на этапе инициализации. На этом этапе `Page` объекта `MasterPageFile` присваивается значение `MasterPageFile` атрибут в `@Page` директива (если он указан). В рабочей области PreInit следует этап инициализации, и именно здесь где мы программно задать `Page` объекта `MasterPageFile` свойства, тем самым переписывая значение, присвоенное из `@Page` директива. Так как мы указываем для `Page` объекта `MasterPageFile` свойства программным способом, можно устранить `MasterPageFile` из атрибута `@Page` директив без ущерба для производительности конечного пользователя. Чтобы убедиться в это, продолжим и удалить `MasterPageFile` из атрибута `@Page` директиву `Default.aspx` и перейдите на страницу через обозреватель. Как и следовало ожидать, выводится так же, как прежде, чем атрибут был удален.

Ли `MasterPageFile` свойство задается с помощью `@Page` директива или программным образом не имеет значения, чтобы взаимодействие с пользователем. Тем не менее `MasterPageFile` атрибут в `@Page` директива используется средой Visual Studio во время разработки для создания WYSIWYG представление в конструкторе. Если вернуться к `Default.aspx` в Visual Studio и перейдите в конструктор вы увидите сообщение «Ошибка главной страницы: Страница содержит элементы управления, которые требуют наличия ссылки главной страницы, но ничего не указано» (см. рис. 2).

Иными словами, необходимо оставить `MasterPageFile` атрибут в `@Page` директива слушать получить обширные возможности разработки в Visual Studio.


[![Visual Studio использует @Page атрибут MasterPageFile директивы для подготовки к просмотру в конструкторе](specifying-the-master-page-programmatically-cs/_static/image5.png)](specifying-the-master-page-programmatically-cs/_static/image4.png)

**Рис. 02**: Visual Studio использует `@Page` директивы `MasterPageFile` атрибута для визуализации в режим конструктора ([Просмотр полноразмерного изображения](specifying-the-master-page-programmatically-cs/_static/image6.png))


## <a name="step-3-creating-an-alternative-master-page"></a>Шаг 3. Создание альтернатива главную страницу

Так как страницу содержимого главной страницы могут устанавливаться программными средствами во время выполнения, которые можно динамически Загрузите определенной главной страницы, на основании некоторых внешних условий. Эта возможность может быть полезна в случаях, где сайта макет должен различаться зависимости от пользователя. К примеру веб-приложение блога ядра может позволяют его выбран макет для их блога, где каждая структура связан с другой главной страницы. Во время выполнения просматривая блога пользователя посетитель веб-приложения необходимо определить макет блога и динамически связывать соответствующей главной страницы со страницей содержимого.

Давайте рассмотрим способ динамической загрузки главной страницы во время выполнения, на основании некоторых внешних условий. Наш веб-сайт содержит только одну главную страницу (`Site.master`). Нам нужен другой главной страницы, чтобы проиллюстрировать, Выбор главной страницы во время выполнения. Этот шаг рассматривается создание и настройка новой главной страницы. Шаг 4 ищет надо определить, какие главной страницы, используемой во время выполнения.

Создание новой главной страницы в корневой папке с именем `Alternate.master`. Также добавить новую таблицу стилей на веб-сайт с именем `AlternateStyles.css`.


[![Add другой главной страницы и CSS-файл на веб-сайт](specifying-the-master-page-programmatically-cs/_static/image8.png)](specifying-the-master-page-programmatically-cs/_static/image7.png)

**Рис 03**: Добавить другой главной страницы и CSS-файл на веб-сайт ([Просмотр полноразмерного изображения](specifying-the-master-page-programmatically-cs/_static/image9.png))


Я разработал `Alternate.master` главной страницы, чтобы заголовок, отображаемый в верхней части страницы, по центру и на темно-синего цвета фона. Я выданных левого столбца и перемещены, содержимое под `MainContent` управления ContentPlaceHolder, который теперь распространяется на всю ширину страницы. Кроме того, одобрила неупорядоченный список занятий и заменены горизонтальный список выше `MainContent`. Также обновим шрифтов и цветов, используемых главной страницы (и, следовательно, и его страниц). Рис. 4 показан `Default.aspx` при использовании `Alternate.master` главной страницы.

> [!NOTE]
> ASP.NET включает в себя возможность определить *темы*. Тема — коллекция изображений, CSS-файлов, относящихся к стилю параметры и веб-элемента управления свойства, которые могут применяться к странице во время выполнения. Темы — способ перейти, если веб сайта макеты отличаются только в изображений, отображаемых и их правила CSS. Если макеты отличаются более значительно, например с помощью различных веб-элементов управления или необходимости радикально другой макет, затем необходимо будет использовать отдельный главные страницы. Обратитесь к дополнительными материалами в конце этого руководства, Дополнительные сведения о темах.


[![OСтраниц содержимого, теперь можно использовать благодаря новому интерфейсу](specifying-the-master-page-programmatically-cs/_static/image11.png)](specifying-the-master-page-programmatically-cs/_static/image10.png)

**Рис. 04**: Страниц содержимого теперь можно использовать новый интерфейс ([Просмотр полноразмерного изображения](specifying-the-master-page-programmatically-cs/_static/image12.png))


Когда главным и разметки страницы содержимого включенные, `MasterPage` класса проверки, чтобы убедиться, что каждый содержимое ContentPlaceHolder на главной странице, ссылается на элемент управления на странице содержимого. Исключение возникает в том случае, если найден элемент управления содержимым, который ссылается на несуществующий ContentPlaceHolder. Другими словами, крайне важно наличие ContentPlaceHolder, назначаемый страницы содержимого главной страницы для каждого содержимого элемента управления на странице содержимого.

`Site.master` Главной страницы включает четыре элемента управления ContentPlaceHolder:

- `head`
- `MainContent`
- `QuickLoginUI`
- `LeftColumnContent`

Некоторые из страниц содержимого в наш веб-сайт включают только одного или двух элементов управления содержимым; другие варианты включают элемент управления содержимым для каждого из доступных элементов управления ContentPlaceHolder. Если новый нас на главной странице (`Alternate.master`) когда-нибудь может назначаться для этих страниц, которые содержат элементы управления содержимым для всех элементов управления ContentPlaceHolder в `Site.master` то очень важно, `Alternate.master` также включают те же элементы управления ContentPlaceHolder, как `Site.master`.

Чтобы получить ваши `Alternate.master` главной страницы, чтобы выглядеть примерно так, чтобы анализировать (см. рис. 4), начинается с определения стилей на главной странице в `AlternateStyles.css` стилей. Добавьте следующие правила в `AlternateStyles.css`:


[!code-css[Main](specifying-the-master-page-programmatically-cs/samples/sample5.css)]

Затем добавьте следующие декларативная разметка для `Alternate.master`. Как вы видите, `Alternate.master` содержит четыре элемента управления ContentPlaceHolder с тем же `ID` значения, что и элементы управления ContentPlaceHolder `Site.master`. Кроме того он включает элемент управления ScriptManager, который необходим для этих страниц в наш веб-сайт, использующих платформа AJAX для ASP.NET.


[!code-aspx[Main](specifying-the-master-page-programmatically-cs/samples/sample6.aspx)]

### <a name="testing-the-new-master-page"></a>Тестирование новой главной страницы

Чтобы проверить это новое обновление главной страницы `BasePage` класса `OnPreInit` метод, чтобы `MasterPageFile` свойству присваивается значение «~ / Alternate.master» и затем на веб-узле. Каждой странице, должны работать без ошибок, за исключением двух: `~/Admin/AddProduct.aspx` и `~/Admin/Products.aspx`. Добавление продукта к элементу управления DetailsView в `~/Admin/AddProduct.aspx` приводит `NullReferenceException` из строки кода, который пытается установить на главной странице `GridMessageText` свойство. При посещении `~/Admin/Products.aspx` `InvalidCastException` возникает исключение при загрузке страницы с сообщением: «Не удалось привести объект типа "ASP.alternate\_master" к типу "ASP.site\_master".»

Эти ошибки возникают, поскольку `Site.master` кода класс содержит открытые события, свойства и методы, которые не определены в `Alternate.master`. У части эти две страницы, содержащей разметку `@MasterType` директива, которая ссылается на `Site.master` главной страницы.


[!code-aspx[Main](specifying-the-master-page-programmatically-cs/samples/sample7.aspx)]

Кроме того, в элементе DetailsView `ItemInserted` обработчик событий в `~/Admin/AddProduct.aspx` включает в себя код, к которому приводятся слабо типизированной `Page.Master` свойство для объекта типа `Site`. `@MasterType` Директива (используется таким образом) и приведения в `ItemInserted` жестко связывает обработчик событий `~/Admin/AddProduct.aspx` и `~/Admin/Products.aspx` страниц к `Site.master` главной страницы.

Для прерывания этой тесной связи, мы сможем `Site.master` и `Alternate.master` являются производными от общий базовый класс, который содержит определения для открытых членов. После этого, мы можем обновить `@MasterType` директиву, чтобы ссылаться на этот общий базовый тип.

### <a name="creating-a-custom-base-master-page-class"></a>Создание класса пользовательской базы главной страницы

Добавьте новый файл класса для `App_Code` папку с именем `BaseMasterPage.cs` , который будет наследовать `System.Web.UI.MasterPage`. Необходимо определить `RefreshRecentProductsGrid` метод и `GridMessageText` свойство в `BaseMasterPage`, но мы не можем перевести просто туда, из `Site.master` так, как эти члены работают с веб-элементы управления, относящиеся к `Site.master` главной страницы ( `RecentProducts` GridView и `GridMessage` метки).

Нам нужно будет настроить `BaseMasterPage` таким образом, что эти члены определяются существует, но на самом деле реализованы с `BaseMasterPage`производных классах (`Site.master` и `Alternate.master`). Этот тип наследования возможна, помечая класса и его члены как `abstract`. Короче говоря, добавление `abstract` ключевое слово для двух членов объявляет о выпуске, `BaseMasterPage` еще не реализован `RefreshRecentProductsGrid` и `GridMessageText`, но это будет его производных классов.

Мы также необходимо определить `PricesDoubled` событие в `BaseMasterPage` и предоставляют средства производными классами для вызова события. Шаблон, используемый в .NET Framework, чтобы упростить это поведение — создайте открытое событие в базовом классе и добавить защищенный, `virtual` метод с именем `OnEventName`. Производные классы затем можно вызвать этот метод для вызова события или его для выполнения кода непосредственно перед или после события можно переопределить.

Обновление вашей `BaseMasterPage` таким образом, чтобы он содержит следующий код:


[!code-csharp[Main](specifying-the-master-page-programmatically-cs/samples/sample8.cs)]

Перейдите к `Site.master` кода класса и его производными `BaseMasterPage`. Так как `BaseMasterPage` — `abstract` нам нужно переопределить их `abstract` члены в `Site.master`. Добавление `override` ключевое слово для определения методов и свойств. Также обновить код, который вызывает `PricesDoubled` событие в `DoublePrice` кнопки `Click` обработчик событий с помощью вызова на базовый класс `OnPricesDoubled` метод.

После внесения этих изменений `Site.master` вспомогательного класса должен содержать следующий код:


[!code-csharp[Main](specifying-the-master-page-programmatically-cs/samples/sample9.cs)]

Необходимо также обновить `Alternate.master`элемента вспомогательного класса для наследования от `BaseMasterPage` и переопределите два `abstract` членов. Но поскольку `Alternate.master` не содержит элемент управления GridView, что списки самым свежим продуктам и меткой, которая выводит сообщение после нового продукта не добавляется в базу данных, эти методы не нужно ничего делать.


[!code-csharp[Main](specifying-the-master-page-programmatically-cs/samples/sample10.cs)]

### <a name="referencing-the-base-master-page-class"></a>Ссылка на класс страницы Base Master

Теперь, когда мы завершили `BaseMasterPage` класса и имеете наши два главных страниц, расширяет его, последним этапом является обновление `~/Admin/AddProduct.aspx` и `~/Admin/Products.aspx` страниц для ссылки на данный общий тип. Сначала измените `@MasterType` директив в обе страницы из:


[!code-aspx[Main](specifying-the-master-page-programmatically-cs/samples/sample11.aspx)]

В:


[!code-aspx[Main](specifying-the-master-page-programmatically-cs/samples/sample12.aspx)]

Вместо ссылки на путь к файлу, `@MasterType` теперь ссылается на базовый тип (`BaseMasterPage`). Следовательно, строго типизированный `Master` свойство используется в классах кода обе страницы больше не типа `BaseMasterPage` (вместо типа `Site`). Это изменение на месте пересмотреть `~/Admin/Products.aspx`. Ранее, это привело к ошибке приведения так, как страница настроена для использования `Alternate.master` главной страницы, но `@MasterType` директивы ссылки на `Site.master` файл. Но теперь отображает без ошибок. Это обусловлено `Alternate.master` главной страницы может быть приведен к объекту типа `BaseMasterPage` (поскольку он расширяет его).

Имеется одно небольшое изменение, который должен выполняться в `~/Admin/AddProduct.aspx`. Элемента управления DetailsView `ItemInserted` обработчик событий использует оба строго типизированный `Master` свойство и слабо типизированной `Page.Master` свойство. Мы исправили строго типизированную ссылку, когда мы обновили `@MasterType` директива, но мы по-прежнему необходимо обновить слабо типизированную ссылку. Замените следующую строку кода:


[!code-csharp[Main](specifying-the-master-page-programmatically-cs/samples/sample13.cs)]

Следующим образом, что приводит к `Page.Master` к базовому типу:


[!code-csharp[Main](specifying-the-master-page-programmatically-cs/samples/sample14.cs)]

## <a name="step-4-determining-what-master-page-to-bind-to-the-content-pages"></a>Шаг 4. Определить, какие главной страницы для привязки к страницам содержимого

Наши `BasePage` класс в настоящее время устанавливает все страницы содержимого `MasterPageFile` свойства для жестко запрограммированных значений в PreInit этапа жизненного цикла страницы. Мы можем обновить этот код для главной страницы на внешних признакам. Возможно главной страницы для загрузки зависит от предпочтений пользователя, выполнившего вход. В этом случае необходимо написать код `OnPreInit` метод в `BasePage` , ищет главной страницы в настоящее время выполняется посещение пользовательских настроек.

Давайте создадим страницу, которая позволяет пользователю выбрать главную страницу для использования - `Site.master` или `Alternate.master` - и сохранить этот выбор в переменной сеанса. Начнем с создания нового веб-страницы в корневом каталоге с именем `ChooseMasterPage.aspx`. При создании этой странице (или любые другие страницы содержимого этого момента) не нужно привязать его к главной странице, так как главной страницы устанавливается программно `BasePage`. Тем не менее если новая страница не привязан к главной странице то декларативная разметка по умолчанию новая страница содержит веб-формы и другие материалы, предоставляемые главной страницы. Вам потребуется вручную заменить эту разметку соответствующие элементы управления содержимым. По этой причине мне проще привязать новую страницу ASP.NET к главной странице.

> [!NOTE]
> Так как `Site.master` и `Alternate.master` же задали элементов управления ContentPlaceHolder неважно, какие главной страницы, выбирается при создании новой страницы содержимого. Для обеспечения согласованности, я бы предложил с помощью `Site.master`.


[![Aдд новую страницу содержимого на веб-сайт](specifying-the-master-page-programmatically-cs/_static/image14.png)](specifying-the-master-page-programmatically-cs/_static/image13.png)

**05 рис**: Добавьте новую страницу содержимого на веб-сайт ([Просмотр полноразмерного изображения](specifying-the-master-page-programmatically-cs/_static/image15.png))


Обновление `Web.sitemap` файл, чтобы включить запись для этого занятия. Добавьте следующую разметку под `<siteMapNode>` занятия главные страницы и ASP.NET AJAX:


[!code-xml[Main](specifying-the-master-page-programmatically-cs/samples/sample15.xml)]

Прежде чем добавлять любое содержимое, `ChooseMasterPage.aspx` страницы Отвлекитесь и обновить вспомогательному классу страницы, чтобы сделать его производным от `BasePage` (а не `System.Web.UI.Page`). Затем добавьте элемент управления DropDownList на страницу, задайте его `ID` свойства `MasterPageChoice`, и добавьте два ListItems с `Text` значения «~ / Site.master» и «~ / Alternate.master».

Добавьте кнопку веб-элемент управления на страницу и задайте его `ID` и `Text` свойства `SaveLayout` и «Выбор макета сохранить», соответственно. На этом этапе декларативная разметка страницы должна выглядеть следующего вида:


[!code-aspx[Main](specifying-the-master-page-programmatically-cs/samples/sample16.aspx)]

При первом посещении страницы необходимо отобразить выбранный главную страницу выбора пользователя. Создание `Page_Load` обработчик событий и добавьте следующий код:


[!code-csharp[Main](specifying-the-master-page-programmatically-cs/samples/sample17.cs)]

Приведенный выше код выполняется только при первом посещении страницы (а не при последующих обратных передачах). Сначала она проверяет наличие переменной сеанса `MyMasterPage` существует. Если Да, предпринимается попытка найти соответствующий элемент списка в `MasterPageChoice` DropDownList. Если найден соответствующий ListItem, его `Selected` свойству `true`.

Также необходимо написать код, который сохраняет выбора пользователя в `MyMasterPage` переменной сеанса. Создайте обработчик событий для `SaveLayout` кнопки `Click` событий и добавьте следующий код:


[!code-csharp[Main](specifying-the-master-page-programmatically-cs/samples/sample18.cs)]

> [!NOTE]
> К моменту `Click` выполнения обработчика событий при обратной передаче, главной страницы уже выбран. Таким образом выбора с раскрывающимся списком пользователя не будет действовать, пока не посетите следующую страницу. `Response.Redirect` Заставляет браузер, чтобы повторно запросить `ChooseMasterPage.aspx`.


С помощью `ChooseMasterPage.aspx` страница полностью, наша последняя задача — иметь `BasePage` назначить `MasterPageFile` значение в зависимости от значения `MyMasterPage` переменной сеанса. Если не задано переменной сеанса `BasePage` по умолчанию `Site.master`.


[!code-csharp[Main](specifying-the-master-page-programmatically-cs/samples/sample19.cs)]

> [!NOTE]
> После перемещения кода, который назначает `Page` объекта `MasterPageFile` свойство из `OnPreInit` обработчик событий и на два отдельных метода. Это первый метод `SetMasterPageFile`, назначает `MasterPageFile` свойства равным значению, возвращенному методом второй `GetMasterPageFileFromSession`. Я сделал `SetMasterPageFile` метод `virtual` таким образом, чтобы будущие классы, расширяющие `BasePage` можно при необходимости переопределить его, чтобы реализовать пользовательскую логику, при необходимости. Мы рассмотрим пример переопределения `BasePage`в `SetMasterPageFile` свойство в следующем учебном курсе.


Этот код в месте, посетите `ChooseMasterPage.aspx` страницы. Изначально `Site.master` Главная страница является выбранный (см. рис. 6), но пользователь может выбрать другой главной страницы из раскрывающегося списка.


[![Cсодержимого страницы отображаются с помощью Site.master главной страницы](specifying-the-master-page-programmatically-cs/_static/image17.png)](specifying-the-master-page-programmatically-cs/_static/image16.png)

**Рис 06**: Содержимое страницы, отображаемых с помощью `Site.master` главной страницы ([Просмотр полноразмерного изображения](specifying-the-master-page-programmatically-cs/_static/image18.png))


[![CСтраницы содержимого теперь отображаются с помощью Alternate.master главной страницы](specifying-the-master-page-programmatically-cs/_static/image20.png)](specifying-the-master-page-programmatically-cs/_static/image19.png)

**07 рис**: Содержимое страницы, теперь отображаются с помощью `Alternate.master` главной страницы ([Просмотр полноразмерного изображения](specifying-the-master-page-programmatically-cs/_static/image21.png))


## <a name="summary"></a>Сводка

При посещении страницы содержимого, его элементы управления содержимым включенные с помощью элементов управления ContentPlaceHolder главной страницы. Страницы содержимого главной страницы обозначается `Page` класса `MasterPageFile` свойство, которое назначено типу `@Page` директивы `MasterPageFile` атрибут во время этапа инициализации. Что в этом учебнике показано, можно назначить значение `MasterPageFile` свойства, пока мы этого до окончания этапа PreInit. Возможность программно указать главную страницу открывает возможность для более сложных сценариев, такие как динамическая привязка страницы содержимого на главную страницу, в зависимости от внешних факторов.

Счастливого вам программирования!

### <a name="further-reading"></a>Дополнительные сведения

Дополнительные сведения по темам, обсуждавшимся в этом руководстве см. в следующих ресурсах:

- [Схема жизненного цикла страницы ASP.NET](http://emanish.googlepages.com/Asp.Net2.0Lifecycle.PNG)
- [Общие сведения о жизненном цикле страницы ASP.NET](https://msdn.microsoft.com/library/ms178472.aspx)
- [ASP.NET темы и обложки](https://msdn.microsoft.com/library/ykzx33wh.aspx)
- [Главные страницы: Советы, приемы и ловушки](http://www.odetocode.com/articles/450.aspx)
- [Темы в ASP.NET](http://www.odetocode.com/articles/423.aspx)

### <a name="about-the-author"></a>Об авторе

[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор из нескольких книг по ASP/ASP.NET и основатель веб-узла 4GuysFromRolla.com, работает с веб-технологиями Microsoft с 1998 года. Скотт — независимый консультант, преподаватель и автор. Его последняя книга — [ *Sams Teach самостоятельно ASP.NET 3.5 за 24 часа*](https://www.amazon.com/exec/obidos/ASIN/0672329972/4guysfromrollaco). Скоттом можно связаться по адресу [ mitchell@4GuysFromRolla.com ](mailto:mitchell@4GuysFromRolla.com) или через его блог по адресу [ http://ScottOnWriting.NET ](http://scottonwriting.net/).

### <a name="special-thanks-to"></a>Особая благодарность

В этой серии руководств пособий рецензировалась многими компетентными редакторами. Основной рецензент этого учебного был Банерджи Suchi. Хотите поработать с моих последующих статей для MSDN? Если Да, напишите мне [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)

> [!div class="step-by-step"]
> [Назад](master-pages-and-asp-net-ajax-cs.md)
> [Вперед](nested-master-pages-cs.md)
