---
uid: web-forms/overview/older-versions-getting-started/master-pages/nested-master-pages-vb
title: Вложенные главные страницы (Visual Basic) | Документация Майкрософт
author: rick-anderson
description: Показано, как вложить одну главную страницу внутри другого.
ms.author: riande
ms.date: 07/28/2008
ms.assetid: 14d9aa1b-4dca-43a0-aa9d-a6e891fee019
msc.legacyurl: /web-forms/overview/older-versions-getting-started/master-pages/nested-master-pages-vb
msc.type: authoredcontent
ms.openlocfilehash: 10cb11d75b278acc5dfbdf3d7560c3e268ad6e7d
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2019
ms.locfileid: "65132048"
---
# <a name="nested-master-pages-vb"></a>Вложенные эталонные страницы (VB)

по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Скачать код](http://download.microsoft.com/download/d/6/6/d66ad554-afdd-409e-a5c3-201b774fbb31/ASPNET_MasterPages_Tutorial_10_VB.zip) или [скачать PDF](http://download.microsoft.com/download/d/6/6/d66ad554-afdd-409e-a5c3-201b774fbb31/ASPNET_MasterPages_Tutorial_10_VB.pdf)

> Показано, как вложить одну главную страницу внутри другого.

## <a name="introduction"></a>Вступление

В ходе предыдущих девять учебных курсах мы узнали, как реализация макета сайта с помощью главных страниц. По сути главные страницы позволяют нам, разработчик страницы, для определения общих разметки на главной странице, а также определенные регионы, которые могут быть настроены на основе содержимого страницы, содержимое страницы. Элементы управления ContentPlaceHolder на главной странице отображения настраиваемых регионов; настраиваемые разметки для элементов управления ContentPlaceHolder определяются на странице содержимого с помощью элементов управления содержимым.

Методы главной страницы, которые мы рассматривали до сих удобны, если у вас есть один макет, используемый на всем сайте. Тем не менее многие больших веб-сайтов иметь макетом веб-узла, который настроен в различные разделы. Например рассмотрим здравоохранения приложение используется сотрудниками больнице для управления информацией о пациентах, действий и выставления счетов. Возможны три типа веб-страниц в этом приложении:

- Страницы член конкретных сотрудников, где сотрудников можно обновить доступности, просматривать расписания, или запрос отпуска.
- Страниц, относящихся к пациента которой сотрудники просмотреть или изменить сведения для конкретного пациента.
- Которой бухгалтеров ознакомиться с текущей страницы для выставления счетов конкретных утверждений, состояния и финансовые отчеты.

Каждой странице могут совместно использовать общий макет, таких как меню в верхней части и ряд часто используемых ссылок в нижней. Но персонала, пациентов и страниц, относящихся к выставления счетов может потребоваться настроить этот универсального макета. Например возможно все страницы для конкретных сотрудников должны содержать список календарь и задачи, доступности и ежедневное расписание текущего пользователя. Возможно всех страниц, относящихся к пациента необходимо отобразить имя, адрес и сведения о страховании для пациента, сведения о котором редактируется.

Можно создать такие настраиваемые макеты с помощью *вложенные главные страницы*. Чтобы реализовать сценарии выше, мы первым шагом будет создание главной страницы, который определен содержимое макета, меню и нижний колонтитул сайта, с помощью элементов управления ContentPlaceHolder, определяющий настраиваемые области. Затем мы бы создали три вложенные главные страницы, одной для каждого типа веб-страницы. Каждой вложенной главной страницы будет определять содержимого между типом содержимого страниц, использующих главную страницу. Другими словами разметки и программная логика для отображения сведений о редактируемого пациента, будет включать вложенной главной страницы для страниц содержимого конкретного пациента. При создании новой страницы конкретного пациента мы будет привязан к этой вложенной главной страницы.

Это руководство начинается с информацию о преимуществах вложенные главные страницы. Затем показано, как создать и использовать вложенные главные страницы.

> [!NOTE]
> Вложенные главные страницы были возможных начиная с версии 2.0 платформы .NET Framework. Тем не менее Visual Studio 2005 не поддерживал времени разработки для вложенных главных страниц. Хорошо то, что Visual Studio 2008 предлагает широкие возможности разработки для вложенных главных страниц. Если вы планируете использовать вложенные главные страницы, но по-прежнему используете Visual Studio 2005, ознакомьтесь с [Скотт Гатри](https://weblogs.asp.net/scottgu/)на запись в блоге [советы по вложенные главные страницы в VS 2005 разработки](https://weblogs.asp.net/scottgu/archive/2005/11/11/430382.aspx).

## <a name="the-benefits-of-nested-master-pages"></a>Преимущества вложенные главные страницы

Всеобъемлющая узла разработки, а также более настраиваемые макеты отдельных типов страниц, у многих веб-сайтов. Например, в нашем демонстрационное веб-приложение мы создали элементарные разделе «Администрирование» (страницы `~/Admin` папку). В настоящее время веб-страниц в `~/Admin` папку использовать одну главную страницу, как эти страницы не в разделе «Администрирование» (а именно, `Site.master` или `Alternate.master`в зависимости от выбора пользователя).

> [!NOTE]
> Теперь представьте, что наш сайт имеет только одну главную страницу, `Site.master`. Нам удалось удовлетворить с помощью вложенные главные страницы с помощью двух (или более) главных страниц, начиная с «С помощью вложенных Master для администрирования раздел страницы» далее в этом руководстве.

Представьте себе, что мы предлагали для настройки макета страниц администрирования, чтобы включить дополнительные сведения или ссылки, в противном случае не будет присутствовать на других страницах на сайте. Существует четыре метода, чтобы реализовать это требование:

1. Вручную добавить сведения об особенностях администрирования и ссылки на все страницы содержимого `~/Admin` папки.
2. Обновление `Site.master` главной страницы, необходимо включить сведения об особенностях раздел администрирования и ссылки, а затем добавьте код на главную страницу, чтобы показать или скрыть эти разделы основании ли посещений на страницах администрирования.
3. Создание главной страницы специально для области администрирования скопировать разметку из `Site.master`, добавить сведения об особенностях раздел администрирования и ссылки и обновите страниц содержимого в `~/Admin` папку для использования этого нового шаблона страница.
4. Создание вложенной главной страницы, который привязывается к `Site.master` и страницах содержимого в `~/Admin` папки используйте этот новый вложенной главной страницы. Этой вложенной главной страницы будет включать только Дополнительные сведения и ссылки, относящиеся к страницам администрирования и не потребуется повторять уже определен в разметке `Site.master`.

Первый вариант — бы удобной. Весь смысл с помощью главных страниц является отойти от необходимости вручную скопировать и вставить общие разметки для новых страниц ASP.NET. Второй вариант приемлема, но делает приложение более простым в обслуживании, так как он слегка главной страницы разметки, который отображается лишь время от времени и требует от разработчиков, изменении главной страницы Чтобы обойти эту разметку и запоминать, когда, точно определенных разметки отображается и, если он скрыт. Этот подход будет менее tenable как настройки из больше и больше типов веб-страниц, необходимо быть приспособлены это одна главная страница.

Третий вариант устраняет скопления и сложность проблемы отображается во втором случае. Основным недостатком параметр три элемента то, что он требует скопируйте и вставьте общий макет из `Site.master` для новой главной страницы администрирования конкретного раздела. Если в дальнейшем мы захочет изменение макета всего веб-узла, нам нужно помнить о необходимости изменить его в двух местах.

Четвертый параметр вложенные главные страницы, ждем лучшее из второй и третий варианты. Сведения о макете сайта сохраняется в одном файле - верхнего уровня главной страницы -, пока содержимое, относящиеся к конкретной области разделена на разные файлы.

Этот учебник начинается со взгляда на создание и использование простого вложенной главной страницы. Мы создадим совершенно новой главной страницы верхнего уровня, две вложенные главные страницы и две страницы содержимого. Начиная с «С помощью вложенных Master для администрирования раздел страницы», мы рассмотрим обновление наших существующую архитектуру главной страницы и включают в себя использование вложенных главных страниц. В частности, мы Создание вложенной главной страницы и использовать его для включения дополнительных пользовательское содержимое для страниц содержимого в `~/Admin` папку.

## <a name="step-1-creating-a-simple-top-level-master-page"></a>Шаг 1. Создание простой главную страницу верхнего уровня

Создание вложенных master на основе одного из имеющегося образца страницы и затем обновить существующую страницу содержимого для использования этой новой вложенной главной страницы вместо главной страницы верхнего уровня влечет за собой некоторые сложности, поскольку существующие содержимого страницы уже предполагают, что определенные Элементы управления ContentPlaceHolder, определенные в главной страницы верхнего уровня. Следовательно вложенной главной страницы также должна содержать те же элементы управления ContentPlaceHolder, с теми же именами. Кроме того, наши определенного демонстрационное приложение имеет два главных страниц (`Site.master` и `Alternate.master`), которые динамически назначены страницы содержимого на основе предпочтений пользователя, что дополнительно увеличивает сложность. Мы рассмотрим обновление существующего приложения для использования вложенные главные страницы далее в этом руководстве, но давайте сначала остановиться на простой вложенные главные страницы примера.

Создайте новую папку с именем `NestedMasterPages` и добавьте новый файл главной страницы к этой папке с именем `Simple.master`. (См. рис. 1 снимок экрана обозревателя решений после добавления этой папки и файла.) Перетащите `AlternateStyles.css` файла таблицы стилей из обозревателя решений в конструктор. Это добавляет `<link>` элемент файл таблицы стилей в `<head>` , после какого элемента главной страницы `<head>` разметки элемента должен выглядеть так:

[!code-aspx[Main](nested-master-pages-vb/samples/sample1.aspx)]

Добавьте следующую разметку в веб-формы из `Simple.master`:

[!code-aspx[Main](nested-master-pages-vb/samples/sample2.aspx)]

Эта разметка отображает ссылку под названием «Вложенные главные страницы (простой)» в верхней части страницы крупным шрифтом белого на темно-синего цвета фона. Ниже, является `MainContent` ContentPlaceHolder. Рис. 1 показаны `Simple.master` главной страницы, при загрузке в конструкторе Visual Studio.

[![Вложенная Эталонная страница определяет от содержимого на страницы в разделе «Администрирование»](nested-master-pages-vb/_static/image2.png)](nested-master-pages-vb/_static/image1.png)

**Рис 01**: Вложенные Master страницы определяет содержимого конкретных на страницы в разделе «Администрирование» ([Просмотр полноразмерного изображения](nested-master-pages-vb/_static/image3.png))

## <a name="step-2-creating-a-simple-nested-master-page"></a>Шаг 2. Создание простой вложенной главной страницы

`Simple.master` содержит два элемента управления ContentPlaceHolder: `MainContent` ContentPlaceHolder, мы добавили в веб-формы вместе с `head` ContentPlaceHolder в `<head>` элемент. Если страница содержимого и привяжите его к `Simple.master` страницы содержимого будет иметь двух элементов управления содержимым, ссылающиеся на двух элементов управления ContentPlaceHolder. Аналогично Если мы Создание вложенной главной страницы и привяжите его к `Simple.master` вложенной главной страницы будет иметь два содержимого элемента управления.

Давайте добавим новый вложенной главной страницы для `NestedMasterPages` папку с именем `SimpleNested.master`. Щелкните правой кнопкой мыши `NestedMasterPages` папку и выберите Add New Item. Откроется диалоговое окно Добавление нового элемента, показанное на рис. 2. Выберите тип шаблона главной страницы и введите имя новой главной страницы. Указывает, что новая главная страница необходимо вложенной главной страницы, установите флажок «Выбрать главную страницу».

Затем нажмите кнопку Добавить. При этом отобразится же выберите диалоговое окно главной страницы, вы увидите при привязке страницы содержимого на главную страницу (см. рис. 3). Выберите `Simple.master` главной страницы в `NestedMasterPages` папку и нажмите кнопку ОК.

> [!NOTE]
> Если вы создали веб-сайта ASP.NET с помощью модели проекта веб-приложения, вместо модели проекта веб-сайта не появится флажок «Выбрать главную страницу» в диалоговом окне Добавить новый элемент, показанный на рис. 2. Создание вложенной главной страницы, при использовании модели проекта веб-приложения необходимо выбрать шаблон вложенная Эталонная страница (вместо шаблона Master Page). После выбора шаблона вложенную эталонную страницу и нажмите кнопку Добавить, же Выбор главной страницы будет отображаться диалоговое окно, показанное на рис. 3.

[![Проверьте &quot;выбрать главную страницу&quot; флажок, чтобы добавить вложенную эталонную страницу](nested-master-pages-vb/_static/image5.png)](nested-master-pages-vb/_static/image4.png)

**Рис. 02**: Установите флажок «Выбрать главную страницу», чтобы добавить вложенную эталонную страницу ([Просмотр полноразмерного изображения](nested-master-pages-vb/_static/image6.png))

[![Привязка к Simple.master главной страницы вложенной главной страницы](nested-master-pages-vb/_static/image8.png)](nested-master-pages-vb/_static/image7.png)

**Рис 03**: Привязать вложенную эталонную страницу для `Simple.master` главной страницы ([Просмотр полноразмерного изображения](nested-master-pages-vb/_static/image9.png))

Декларативная разметка вложенной главной страницы, показанный ниже, содержит два элементы управления содержимым, ссылающиеся на двух элементов управления ContentPlaceHolder на верхнего уровня главной страницы.

[!code-aspx[Main](nested-master-pages-vb/samples/sample3.aspx)]

За исключением `<%@ Master %>` директиве вложенной главной страницы начальной декларативная разметка идентична разметку, которая изначально создается при привязке страницы содержимого на одну главную страницу верхнего уровня. Страница содержимого, такие как `<%@ Page %>` директивы, `<%@ Master %>` здесь директива включает `MasterPageFile` атрибут, указывающий вложенной главной страницы родительскую главную страницу. Основное различие между вложенной главной страницы и страницы содержимого, привязанного к одну главную страницу верхнего уровня является включение элементов управления ContentPlaceHolder вложенной главной страницы. Элементы управления ContentPlaceHolder вложенной главной страницы определяют области, где страницы содержимого можно настроить разметку.

Обновление этой вложенной главной страницы, чтобы он отображал текст «Hello, из SimpleNested!» в элементе управления содержимым, который соответствует `MainContent` управления ContentPlaceHolder.

[!code-aspx[Main](nested-master-pages-vb/samples/sample4.aspx)]

После этого добавления, сохранить вложенной главной страницы и затем добавить новую страницу содержимого для `NestedMasterPages` папку с именем `Default.aspx`и привяжите его к `SimpleNested.master` главной страницы. После добавления этой страницы может быть удивлен тем увидеть, что он не содержит содержимого элементов управления (см. рис. 4)! Страница содержимого доступны только его *родительского* главные страницы элементов управления ContentPlaceHolder. `SimpleNested.master` не содержит все элементы управления ContentPlaceHolder; Таким образом все страницы содержимого, связанные с этой главной страницей, не может содержать любые элементы управления содержимым.

[![Новая страница содержимого не содержит содержимого элементов управления](nested-master-pages-vb/_static/image11.png)](nested-master-pages-vb/_static/image10.png)

**Рис. 04**: Новые страницы содержит нет содержимого элементов управления содержимым ([Просмотр полноразмерного изображения](nested-master-pages-vb/_static/image12.png))

Нам нужно будет обновить вложенной главной страницы (`SimpleNested.master`) для включения элемента управления ContentPlaceHolder. Обычно стоит вложенные главные страницы для включения ContentPlaceHolder для каждого элемента ContentPlaceHolder определяется ее родительскую главную страницу, тем самым позволяя ее дочернюю главную страницу или страницы содержимого, для работы с любой из элемента ContentPlaceHolder верхнего уровня главной страницы элементы управления.

Обновление `SimpleNested.master` главной страницы для включения в двух содержимого элементов управления ContentPlaceHolder. Присвойте имя, совпадающее с именем управления ContentPlaceHolder, их содержимого элемента управления ссылается на элементы управления ContentPlaceHolder. То есть, добавьте элемент управления ContentPlaceHolder `MainContent` к содержимому элемента управления в `SimpleNested.master` , ссылающийся на `MainContent` ContentPlaceHolder в `Simple.master`. Сделать то же самое в элементе управления содержимым, который ссылается на `head` ContentPlaceHolder.

> [!NOTE]
> Хотя я и рекомендую именования элементов управления ContentPlaceHolder вложенной главной страницы, так же, как элементов управления ContentPlaceHolder на главной странице верхнего уровня, этот баланс именования не является обязательным. Из вложенной главной странице любое имя, но следует можно предоставить элементы управления ContentPlaceHolder. Тем не менее, я нахожу легче запомнить, что соответствующих элементов управления ContentPlaceHolder какие области страницы, если мой верхнего уровня главной страницы и вложенные главные страницы используются одинаковые имена.

После внесения этих изменений в `SimpleNested.master` главной страницы должна выглядеть следующим образом:

[!code-aspx[Main](nested-master-pages-vb/samples/sample5.aspx)]

Удалить `Default.aspx` только что созданная страница содержимого и снова добавьте его, привязав его к `SimpleNested.master` главной страницы. Настоящее время Visual Studio добавляет два элементы управления содержимым к `Default.aspx`, ссылающиеся на элементов управления ContentPlaceHolder определен в `SimpleNested.master` (см. рис. 6). Добавьте текст «Hello, из Default.aspx!» в содержимом элемента управления, на который ссылка `MainContent`.

Рис. 5 показаны три сущности, связанные - `Simple.master`, `SimpleNested.master`, и `Default.aspx` - и как они связаны друг с другом. Как показано на схеме, вложенной главной страницы реализует элементы управления содержимым для его родительского элемента ContentPlaceHolder. Если эти области должны быть доступны на странице содержимого, вложенной главной страницы необходимо добавить свой собственный элементов управления ContentPlaceHolder к элементам управления содержимым.

[![Верхнего уровня и вложенные главные страницы определяют макета содержимого страницы](nested-master-pages-vb/_static/image14.png)](nested-master-pages-vb/_static/image13.png)

**05 рис**: Макет страницы содержимого определяют верхнего уровня и вложенные главные страницы ([Просмотр полноразмерного изображения](nested-master-pages-vb/_static/image15.png))

Это поведение показано, как страницы содержимого или главной страницы только представление о ее родительскую главную страницу. Это поведение также обозначается в конструкторе Visual Studio. Рис. 6 показан конструктор для `Default.aspx`. Хотя конструктор видно, в каких регионах можно изменять на странице содержимого и не частей, не устранить неоднозначность, каковы неизменяемые области из вложенной главной страницы и какие регионы с главной страницы верхнего уровня.

[![Содержимого страницы теперь включает в себя элементы управления содержимым для элементов управления ContentPlaceHolder вложенной главной страницы](nested-master-pages-vb/_static/image17.png)](nested-master-pages-vb/_static/image16.png)

**Рис 06**: Содержимое страницы теперь включает в себя элементы управления содержимым для главной страницы вложенных элементов управления ContentPlaceHolder ([Просмотр полноразмерного изображения](nested-master-pages-vb/_static/image18.png))

## <a name="step-3-adding-a-second-simple-nested-master-page"></a>Шаг 3. Добавление второй простой вложенной главной страницы

Преимущество вложенные главные страницы становится очевидным, при наличии нескольких вложенных главных страниц. Чтобы проиллюстрировать это преимущество, создайте другой вложенной главной страницы в `NestedMasterPages` папку; это новое имя вложенной главной страницы `SimpleNestedAlternate.master` и привяжите его к `Simple.master` главной страницы. Добавление элементов управления ContentPlaceHolder в вложенной главной страницы элемента управления содержимым, как это делалось в шаге 2. Также добавьте текст «Hello, из SimpleNestedAlternate!» в элементе управления содержимым, соответствующий верхнего уровня главной страницы `MainContent` ContentPlaceHolder. После внесения этих изменений декларативная разметка вашей новой вложенной главной страницы должен выглядеть следующим образом:

[!code-aspx[Main](nested-master-pages-vb/samples/sample6.aspx)]

Страница содержимого с именем `Alternate.aspx` в `NestedMasterPages` папки и привяжите его к `SimpleNestedAlternate.master` вложенной главной страницы. Добавьте текст «Hello, от альтернативных!» в элементе управления содержимым, который соответствует `MainContent`. Рис. 7 показан `Alternate.aspx` выполненной работы в конструкторе Visual Studio.

[![Alternate.aspx привязан к SimpleNestedAlternate.master главной страницы](nested-master-pages-vb/_static/image20.png)](nested-master-pages-vb/_static/image19.png)

**Рис 07**: `Alternate.aspx` привязан к `SimpleNestedAlternate.master` главной страницы ([Просмотр полноразмерного изображения](nested-master-pages-vb/_static/image21.png))

Сравните конструктор на рис. 7 в конструктор на рис. 6. Обе страницы содержимого, совместно использовать тот же макет, определенные в главной страницы верхнего уровня (`Simple.master`), а именно title «Nested Master Pages Учебное пособие по (простое)». Еще имеют различных содержимого, определенного в их родительские главные страницы - текст «Hello, из SimpleNested!» на рис. 6 и «Hello, из SimpleNestedAlternate!» на рис. 7. Конечно, эти различия здесь просты, но вы можете расширить этот пример для включения более значимые различия. Например `SimpleNested.master` страница может содержать меню с параметрами, относящимися к его страниц, тогда как `SimpleNestedAlternate.master` , возможно, информации, необходимой для страниц содержимого, которые привязаны к нему.

Теперь представим, что нам нужно внести изменения в ключевой макет узла. Например представьте, что мы хотели бы добавить список ссылок, общие для всех страниц содержимого. Для этого мы обновляем главной страницы верхнего уровня, `Simple.master`. Любые изменения немедленно отражаются в его вложенные главные страницы и, следовательно, и их содержимого страницы.

Чтобы продемонстрировать легкость, с которым мы можем изменить всеобъемлющая макетом веб-узла, откройте `Simple.master` главную страницу и добавьте следующую разметку между `topContent` и `mainContent` `<div>` элементов:

[!code-aspx[Main](nested-master-pages-vb/samples/sample7.aspx)]

Это добавляет две ссылки в верхней части каждой страницы, который привязывается к `Simple.master`, `SimpleNested.master`, или `SimpleNestedAlternate.master`; эти изменения немедленно применяются для всех вложенных главных страниц и страниц содержимого. На рисунке 8 показана `Alternate.aspx` при просмотре через браузер. Обратите внимание на добавление ссылок в верхней части страницы (по сравнению с рис. 7).

[![Изменено на главную страницу верхнего уровня, немедленно отражаются в его вложенные главные страницы и их содержимого страницы](nested-master-pages-vb/_static/image23.png)](nested-master-pages-vb/_static/image22.png)

**Рис 08**: Изменено на главную страницу верхнего уровня, немедленно отражаются в его вложенные главные страницы и их содержимого страницы ([Просмотр полноразмерного изображения](nested-master-pages-vb/_static/image24.png))

## <a name="using-a-nested-master-page-for-the-administration-section"></a>С помощью вложенной главной страницы для области администрирования

На этом этапе мы исследовали преимущества вложенной главной страницы и показано, как создать и использовать их в приложении ASP.NET. В примерах в шаги 1 и 2, 3, тем не менее, нужно было создать новую главную страницу верхнего уровня, вложенные главные страницы и новые страницы содержимого. Как насчет Добавление новой вложенной главной страницы на веб-сайт с существующей эталонной страницы верхнего уровня и страницах содержимого?

Интеграция вложенной главной страницы в существующий веб-сайт и связывание его с существующей страницы содержимого требует немного больше усилий, чем начинать с нуля. Шаги 4, 5, 6 и 7 изучить эти проблемы, как мы расширяем набор доступных наших демонстрационного приложения для включения новой вложенной главной страницы с именем `AdminNested.master` , содержащий инструкции для администратора и используемых страниц ASP.NET в `~/Admin` папку.

Интеграция вложенной главной страницы в нашем демонстрационное приложение предоставляет следующие свойственных:

- Существующее содержимое страниц в `~/Admin` папке имеются определенные ожидания из их главной страницы. Во-первых они ожидают некоторых элементов управления ContentPlaceHolder, должны присутствовать. Кроме того `~/Admin/AddProduct.aspx` и `~/Admin/Products.aspx` страницы вызывать на главной странице public `RefreshRecentProductsGrid` метод, его `GridMessageText` свойство, или обработчик событий для его `PricesDoubled` событий. Следовательно вложенные нас на главной странице необходимо указать же элементов управления ContentPlaceHolder и открытых членов.
- В предыдущем учебном курсе мы улучшили `BasePage` классу динамически задать `Page` объекта `MasterPageFile` значение в зависимости от переменной сеанса. Как для мы поддерживаем динамические главные страницы при использовании вложенные главные страницы?

Эти две задачи будет предоставлять как сборки вложенной главной страницы и использовать его из существующих страниц содержимого. Мы будем исследовать и преодоления этих проблем по мере их возникновения.

## <a name="step-4-creating-the-nested-master-page"></a>Шаг 4. Создание вложенной главной страницы

Наша первая задача является создание вложенной главной страницы для использования на страницах, в разделе «Администрирование». Как мы видели в шаге 2, при добавлении нового вложенных главной страницы, нам нужно указать вложенной главной страницы родительскую главную страницу. Но у нас есть две верхнего уровня главные страницы: `Site.master` и `Alternate.master`. Вспомним, что мы создали `Alternate.master` в предыдущем учебном курсе и написал код `BasePage` класса этого набора `Page` объекта `MasterPageFile` свойство во время выполнения либо `Site.master` или `Alternate.master` в зависимости от значения `MyMasterPage` Переменная сеанса.

Как мы Настройка вложенной нас на главной странице, чтобы он использовал соответствующей главной страницы верхнего уровня? У нас есть два варианта:

- Создайте две вложенные главные страницы, `AdminNestedSite.master` и `AdminNestedAlternate.master`и привязывать их к верхнего уровня главных страниц `Site.master` и `Alternate.master`, соответственно. В `BasePage`, то мы бы указали `Page` объекта `MasterPageFile` для соответствующей вложенной главной страницы.
- Создайте единый вложенной главной страницы и страницы содержимого используйте главную страницу. Затем, во время выполнения, необходимо задать вложенной главной страницы `MasterPageFile` свойства верхнего уровня соответствующей главной страницы во время выполнения. (Как вы может поняли к этому моменту, главных страниц также имеют `MasterPageFile` свойство.)

Давайте использовать второй вариант. Создайте один вложенный файл главной страницы в `~/Admin` папку с именем `AdminNested.master`. Так как оба `Site.master` и `Alternate.master` имеют тот же набор элементов управления ContentPlaceHolder, неважно, какие главной страницы вы привязываете его к, несмотря на то, что я советую вам привяжите его к `Site.master` ради согласованности и.

[![Добавьте в папку ~/Admin вложенной главной страницы.](nested-master-pages-vb/_static/image26.png)](nested-master-pages-vb/_static/image25.png)

**Рис 09**: Добавление вложенной главной страницы для `~/Admin` папки. ([Просмотр полноразмерного изображения](nested-master-pages-vb/_static/image27.png))

Так как вложенной главной страницы привязана к главной странице с четырьмя элементами управления ContentPlaceHolder, Visual Studio добавляет четыре средств управления содержимым для первоначальной разметки новый файл вложенной главной страницы. Как это делалось в шагах 2 и 3, добавьте элемент управления ContentPlaceHolder в каждый элемент управления содержимым, указав его имя, совпадающее с именем управления ContentPlaceHolder верхнего уровня главной страницы. Также добавьте следующую разметку в элемент управления содержимым, который соответствует `MainContent` ContentPlaceHolder:

[!code-html[Main](nested-master-pages-vb/samples/sample8.html)]

Затем определите `instructions` класса CSS, в `Styles.css` и `AlternateStyles.css` файлов CSS. Следующие правила CSS, привести к HTML-элементов с `instructions` класс для отображения с цветом Светло-желтый фон и черный сплошная граница:

[!code-css[Main](nested-master-pages-vb/samples/sample9.css)]

Поскольку эта разметка была добавлена к вложенной главной страницы, оно будет отображаться только на этих страницах, использующих вложенной главной страницы (то есть страницы в разделе «Администрирование»).

После внесения этих изменений на вложенной главной страницы, его декларативная разметка должен выглядеть следующим образом:

[!code-aspx[Main](nested-master-pages-vb/samples/sample10.aspx)]

Обратите внимание, что каждый элемент управления содержимым и управления ContentPlaceHolder, элементов управления ContentPlaceHolder `ID` свойства назначаются те же значения, что соответствующие элементы управления ContentPlaceHolder на главной странице верхнего уровня. Кроме того, появляется раздел администрирования-разметку в `MainContent` ContentPlaceHolder.

Рис. 10 показана `AdminNested.master` вложенной главной страницы, при просмотре через конструктор Visual Studio. Вы увидите инструкции в желтый прямоугольник в верхней части `MainContent` элемент управления содержимым.

[![Вложенная Эталонная страница расширяет главную страницу верхнего уровня для включения инструкции для администратора.](nested-master-pages-vb/_static/image29.png)](nested-master-pages-vb/_static/image28.png)

**Рис. 10**: Вложенная Эталонная страница расширяет главную страницу верхнего уровня для включения инструкции для администратора. ([Просмотр полноразмерного изображения](nested-master-pages-vb/_static/image30.png))

## <a name="step-5-updating-the-existing-content-pages-to-use-the-new-nested-master-page"></a>Шаг 5. Обновление существующего содержимого страниц для использования новой вложенной главной страницы

Каждый раз, когда мы добавим новую страницу содержимого в разделе «Администрирование», нам нужно привязать его к `AdminNested.master` главную страницу, мы только что создали. Но как насчет существующего содержимого страниц? В настоящее время все страницы содержимого на сайте являются производными от `BasePage` класс, который программно задает страницы содержимого главной страницы во время выполнения. Это поведение, которое необходимо для страниц содержимого в разделе «Администрирование». Вместо этого мы хотим, чтобы эти страницы содержимого, чтобы всегда использовать `AdminNested.master` страницы. Он будет отвечать вложенной главной страницы для выбора прямо верхнего уровня страницы содержимого во время выполнения.

Лучший способ добиться этого требуемой поведение является создание нового пользовательского базового класса страницы с именем `AdminBasePage` , расширяющий `BasePage` класса. `AdminBasePage` Затем можно переопределить `SetMasterPageFile` и задайте `Page` объекта `MasterPageFile` для жестко запрограммированных значений «~ / Admin/AdminNested.master». Таким образом, любой страницы, производный от `AdminBasePage` будет использовать `AdminNested.master`, тогда как любой страницы, производный от `BasePage` будет иметь его `MasterPageFile` свойство динамически принимать значение «~ / Site.master» или «~ / Alternate.master» на основе значения `MyMasterPage` Переменной сеанса.

Начните с добавления новый файл класса для `App_Code` папку с именем `AdminBasePage.vb`. У `AdminBasePage` расширить `BasePage` и затем Переопределите `SetMasterPageFile` метод. В этом методе назначить `MasterPageFile` значение «~ / Admin/AdminNested.master». После внесения этих изменений ваш класс файл должен выглядеть следующим образом:

[!code-vb[Main](nested-master-pages-vb/samples/sample11.vb)]

Теперь нам нужно добавить для существующих страниц содержимого в разделе, являются производными от администрирования `AdminBasePage` вместо `BasePage`. Перейдите к файлу класса кода для каждой страницы содержимого в `~/Admin` папку и внести это изменение. Например, в `~/Admin/Default.aspx` необходимо изменить объявление класса фонового кода из:

[!code-vb[Main](nested-master-pages-vb/samples/sample12.vb)]

В:

[!code-vb[Main](nested-master-pages-vb/samples/sample13.vb)]

Рис. 11 показана как верхнего уровня главной страницы (`Site.master` или `Alternate.master`), вложенной главной страницы (`AdminNested.master`), и страниц администрирования разделе связаны друг с другом.

[![Вложенная Эталонная страница определяет от содержимого на страницы в разделе «Администрирование»](nested-master-pages-vb/_static/image32.png)](nested-master-pages-vb/_static/image31.png)

**Рис. 11**: Вложенные Master страницы определяет содержимого конкретных на страницы в разделе «Администрирование» ([Просмотр полноразмерного изображения](nested-master-pages-vb/_static/image33.png))

## <a name="step-6-mirroring-the-master-pages-public-methods-and-properties"></a>Шаг 6. Зеркальное отображение открытые методы и свойства главной страницы

Помните, что `~/Admin/AddProduct.aspx` и `~/Admin/Products.aspx` страниц программно взаимодействовать с главной страницы: `~/Admin/AddProduct.aspx` вызовы главной страницы общих `RefreshRecentProductsGrid` метод и задает его `GridMessageText` свойство; `~/Admin/Products.aspx` имеет обработчик событий для `PricesDoubled` событий. В предыдущем учебном курсе мы создали `MustInherit` `BaseMasterPage` класса, который определен этих открытых членов.

`~/Admin/AddProduct.aspx` И `~/Admin/Products.aspx` страницы предполагается, что их главной страницы является производным от `BaseMasterPage` класса. `AdminNested.master` Страницы, тем не менее, в настоящее время расширяет `System.Web.UI.MasterPage` класса. В результате при посещении `~/Admin/Products.aspx` `InvalidCastException` исключение с сообщением: «Не удалось привести объект типа "ASP.admin\_adminnested\_master" к типу «BaseMasterPage».»

Чтобы исправить это, необходимо иметь `AdminNested.master` расширить вспомогательного класса `BaseMasterPage`. Обновление объявления класса фонового кода вложенной главной страницы из:

[!code-vb[Main](nested-master-pages-vb/samples/sample14.vb)]

В:

[!code-vb[Main](nested-master-pages-vb/samples/sample15.vb)]

Мы оно не готово. Нам нужно переопределить элементы, отмеченные как `MustOverride`, а именно: `RefreshRecentProductsGrid` и `GridMessageText`. Эти элементы используются верхнего уровня главных страниц, чтобы обновить их пользовательские интерфейсы. (На самом деле, только `Site.master` эти методы используются главной страницей, несмотря на то, что оба верхнего уровня главных страниц реализации этих методов, поскольку оба расширить `BaseMasterPage`.)

Хотя нам нужно реализовать эти члены в `AdminNested.master`, все эти реализации нужно будет просто вызывать тот же элемент верхнего уровня главной страницы, используемые вложенной главной страницы. Например, в том случае, когда со страницей содержимого в разделе «Администрирование» вызывает вложенной главной страницы `RefreshRecentProductsGrid` метод, все вложенные главной страницы необходимо выполнить, в свою очередь, вызвать `Site.master` или `Alternate.master` `RefreshRecentProductsGrid` метод.

Чтобы добиться этого, начните с добавления следующих `@MasterType` директиву в начало `AdminNested.master`:

[!code-aspx[Main](nested-master-pages-vb/samples/sample16.aspx)]

Помните, что `@MasterType` директива добавляет свойство строго типизированный класс фонового кода, с именем `Master`. Затем Переопределите `RefreshRecentProductsGrid` и `GridMessageText` членов и просто делегировать вызов `Master`соответствующему метод:

[!code-vb[Main](nested-master-pages-vb/samples/sample17.vb)]

Этот код в месте можно посетить и используйте содержимого страницы в разделе «Администрирование». Рис. 12 показан `~/Admin/Products.aspx` страницы при просмотре в обозревателе. Как вы видите, страница содержит поле инструкции администрирования, который определен в вложенной главной страницы.

[![В верхней части каждой страницы указаний страниц содержимого в разделе «Администрирование»](nested-master-pages-vb/_static/image35.png)](nested-master-pages-vb/_static/image34.png)

**Рис. 12**: Страницы содержимого в инструкциях включают раздел администрирования в начало каждой странице ([Просмотр полноразмерного изображения](nested-master-pages-vb/_static/image36.png))

## <a name="step-7-using-the-appropriate-top-level-master-page-at-runtime"></a>Шаг 7. С помощью соответствующих главную страницу верхнего уровня во время выполнения

Несмотря на все страницы содержимого в разделе «Администрирование» полнофункциональный, они все используют одну главную страницу верхнего уровня и главную страницу, выбранный пользователем в `ChooseMasterPage.aspx`. Это связано с тем, что вложенные Главная страница имеет его `MasterPageFile` свойство статически присвоить `Site.master` в его `<%@ Master %>` директива.

Чтобы использовать главную страницу верхнего уровня выбирается конечным пользователем, нам нужно установить `AdminNested.master` `MasterPageFile` в соответствии с значением в `MyMasterPage` переменной сеанса. Так как мы задали страниц содержимого `MasterPageFile` свойств в `BasePage`, бывает, что мы бы установили для вложенной главной страницы `MasterPageFile` свойство в `BaseMasterPage` или в `AdminNested.master`элемента класса вспомогательного кода. Это не будет работать, однако, поскольку мы задали `MasterPageFile` свойство к концу PreInit рабочей области. Самое раннее время, мы может программным способом в жизненный цикл страницы из главной страницы является этапом Init (которое производится после завершения этапа PreInit).

Таким образом, нам нужно установить вложенной главной страницы `MasterPageFile` свойство из страниц содержимого. Единственное содержимое страниц, использующих `AdminNested.master` главной страницы являются производными от `AdminBasePage`. Таким образом можно поместить эту логику существует. На шаге 5 мы переопределили `SetMasterPageFile` метод, присваивающий объект страницы `MasterPageFile` свойства «~ / Admin/AdminNested.master». Обновление `SetMasterPageFile` также перевести на главной странице `MasterPageFile` свойства результата, хранимого в сеансе:

[!code-vb[Main](nested-master-pages-vb/samples/sample18.vb)]

`GetMasterPageFileFromSession` Метод, который мы добавили `BasePage` класс в предыдущем учебном курсе, возвращает путь к файлу соответствующей главной страницы, основанный на значение переменной сеанса.

Благодаря этому изменению на месте главной страницы выбора пользователя переносится в разделе «Администрирование». Рис. 13 показана та же страница, как на рис. 12, но после пользователь изменил свой выбор главной страницы для `Alternate.master`.

[![На странице администрирования вложенных используется верхнего уровня главной страницы, выбранный пользователем](nested-master-pages-vb/_static/image38.png)](nested-master-pages-vb/_static/image37.png)

**Рис. 13**: На странице администрирования Nested использует верхнего уровня Master страницы выбранный пользователем ([Просмотр полноразмерного изображения](nested-master-pages-vb/_static/image39.png))

## <a name="summary"></a>Сводка

Объем like как страниц можно привязать к главной странице, можно создавать вложенные главные страницы, если дочерняя главная страница привязки к родительскую главную страницу. Дочерняя главная страница может определять элементы управления содержимым для каждого из элементов управления ContentPlaceHolder его родительского элемента; его можно добавить собственные элементы управления ContentPlaceHolder (а также другой разметки) для этих элементов управления содержимым. Вложенные главные страницы являются довольно полезен в больших веб-приложений, в которых все страницы имеют всеобъемлющая внешнего вида и поведения, но отдельные части сайта требуются уникальные настройки.

Счастливого вам программирования!

### <a name="further-reading"></a>Дополнительные сведения

Дополнительные сведения по темам, обсуждавшимся в этом руководстве см. в следующих ресурсах:

- [Вложенные главные страницы ASP.NET](https://msdn.microsoft.com/library/x2b3ktt7.aspx)
- [Советы по VS 2005 проектирования и вложенные главные страницы](https://weblogs.asp.net/scottgu/archive/2005/11/11/430382.aspx)
- [VS 2008 вложенные Master страницы поддержки](https://weblogs.asp.net/scottgu/archive/2007/07/09/vs-2008-nested-master-page-support.aspx)

### <a name="about-the-author"></a>Об авторе

[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор из нескольких книг по ASP/ASP.NET и основатель веб-узла 4GuysFromRolla.com, работает с веб-технологиями Microsoft с 1998 года. Скотт — независимый консультант, преподаватель и автор. Его последняя книга — [ *Sams Teach самостоятельно ASP.NET 3.5 за 24 часа*](https://www.amazon.com/exec/obidos/ASIN/0672329972/4guysfromrollaco). Скоттом можно связаться по адресу [ mitchell@4GuysFromRolla.com ](mailto:mitchell@4GuysFromRolla.com) или через его блог по адресу [ http://ScottOnWriting.NET ](http://scottonwriting.net/).

### <a name="special-thanks-to"></a>Особая благодарность

В этой серии руководств пособий рецензировалась многими компетентными редакторами. Хотите поработать с моих последующих статей для MSDN? Если Да, напишите мне [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)

> [!div class="step-by-step"]
> [Назад](specifying-the-master-page-programmatically-vb.md)
