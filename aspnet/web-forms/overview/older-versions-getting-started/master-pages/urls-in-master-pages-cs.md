---
uid: web-forms/overview/older-versions-getting-started/master-pages/urls-in-master-pages-cs
title: URL-адреса на главных страницах (C#) | Документация Майкрософт
author: rick-anderson
description: Адреса, как URL-адреса на главной странице может нарушить работу из-за файл главной страницы, находящиеся в каталоге относительный, отличном от содержимого страницы. Рассматривает модификация базового адреса...
ms.author: riande
ms.date: 06/10/2008
ms.assetid: 48b58a18-5ea4-468c-b326-f35331b3e1e9
msc.legacyurl: /web-forms/overview/older-versions-getting-started/master-pages/urls-in-master-pages-cs
msc.type: authoredcontent
ms.openlocfilehash: a218dffb3d23ca95e9864fb7b272bc6a004386c4
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59421203"
---
# <a name="urls-in-master-pages-c"></a>URL-адреса на эталонных страницах (C#)

по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Скачать код](http://download.microsoft.com/download/e/e/f/eef369f5-743a-4a52-908f-b6532c4ce0a4/ASPNET_MasterPages_Tutorial_04_CS.zip) или [скачать PDF](http://download.microsoft.com/download/8/f/6/8f6349e4-6554-405a-bcd7-9b094ba5089a/ASPNET_MasterPages_Tutorial_04_CS.pdf)

> Адреса, как URL-адреса на главной странице может нарушить работу из-за файл главной страницы, находящиеся в каталоге относительный, отличном от содержимого страницы. Рассматривает модификация базового адреса URL-адреса с помощью ~ в декларативном синтаксисе и программным способом с помощью ResolveUrl и ResolveClientUrl. (Также Обратите внимание на


## <a name="introduction"></a>Вступление

Во всех примерах мы видели до сих страницах обнаружены в той же папке (корневую папку веб сайта). Но нет никаких причин, почему страницах должен быть в той же папке. Конечно, можно создать страниц содержимого во вложенных папках. Аналогичным образом, можно создать `~/MasterPages/` папку, куда поместить главной страницы веб-узла.

Одна потенциальная проблема с размещением страницах в разных папках включает в себя неработающих URL-адреса. Если главная страница содержит относительный URL-адреса гиперссылки, изображения или другие элементы, ссылки будут недопустимыми для страниц содержимого, которые находятся в разных папках. В этом руководстве мы рассмотрим источником этой проблемы, а также обходные пути.

## <a name="the-problem-with-relative-urls"></a>Проблема с относительные URL-адреса

URL-адрес веб-страницы, называется *относительный URL-адрес* Если расположение ресурса, он указывает задается относительно расположения веб-страницы в структуре папок веб сайта. Любой URL-адрес, которая не начинается с прямой косой черты (`/`) или протокол (например, `http://`) является относительным, так как она будет устранена с помощью браузера, в зависимости от расположения веб-страницы, содержащий URL-адрес.

Например, наш веб-сайт имеет `~/Images/` папку с файлом единого образа `PoweredByASPNET.gif`. Файл главной страницы `Site.master` имеет `<img>` элемент `footerContent` регионе, используя следующую разметку:


[!code-html[Main](urls-in-master-pages-cs/samples/sample1.html)]

`src` Значение в атрибута `<img>` элемент является относительным URL-адресом, так как он не начинается с `/` или `http://`. Короче говоря `src` значение атрибута указывает обозревателю папка `Images` во вложенную папку для файла с именем `PoweredByASPNET.gif`.

При посещении страницы содержимого, приведенная выше разметка передаются непосредственно в браузере. Отвлекитесь и посетите `About.aspx` и просмотрите исходный код HTML, отправляемых в браузер. Вы обнаружите, что точное единый макет на главной странице был отправлен в браузер.


[!code-html[Main](urls-in-master-pages-cs/samples/sample2.html)]

Если страница содержимого находится в корневой папке (как `About.aspx`) все работает правильно, так как отсутствует `Images` вложенной папке относительно корневой папки. Тем не менее вещи разбить, если страница содержимого в папку, отличную от главной страницы. Чтобы проиллюстрировать это, создайте вложенную папку с именем `Admin`. Добавьте страницу содержимого с именем `Default.aspx` для `Admin` папки, убедитесь, что привязка новой страницы, `Site.master` главной страницы.

> [!NOTE]
> В [ *указание названия, метатегов и других заголовков HTML на главной странице* ](specifying-the-title-meta-tags-and-other-html-headers-in-the-master-page-cs.md) руководстве мы создали пользовательскую страницу базовый класс с именем `BasePage` , автоматически задание заголовка страницы содержимого (если он не был явно назначен). Не забудьте у только что созданный страницы вспомогательного класса являются производными от `BasePage` таким образом, он может использовать эту функцию.


После создания этой страницы содержимого, в обозревателе решений должен выглядеть рис. 1.


![Новая папка и страницы ASP.NET были добавлены в проект](urls-in-master-pages-cs/_static/image1.png)

**Рис 01**: Новая папка и страницы ASP.NET были добавлены в проект


Затем обновите `Web.sitemap` файл, чтобы включить новый `<siteMapNode>` запись для этого занятия. Следующий код XML показан полный `Web.sitemap` разметка, которая теперь включает добавление третьей `<siteMapNode>` элемент.


[!code-xml[Main](urls-in-master-pages-cs/samples/sample3.xml)]

Вновь созданный `Default.aspx` страница должна содержать четыре содержимого элементов управления, соответствующих четырех элементов управления ContentPlaceHolder в `Site.master`. Добавьте в элемент управления содержимым, ссылающиеся на текст `MainContent` ContentPlaceHolder и перейдите на страницу через обозреватель. Как показано на рис. 2, не удается найти обозреватель `PoweredByASPNET.gif` файл изображения. Что здесь происходит?

`~/Admin/Default.aspx` Страницы содержимого отправляется же HTML-код `footerContent` регион, так как была `About.aspx` страницы:


[!code-html[Main](urls-in-master-pages-cs/samples/sample4.html)]

Так как `<img>` элемента `src` атрибута является относительным URL-адресом, браузер пытается найти `Images` папке относительно расположения папки веб-страницы. Другими словами, обозреватель ищет файл изображения `Admin/Images/PoweredByASPNET.gif`.


[![Не удается найти файл изображения PoweredByASPNET.gif](urls-in-master-pages-cs/_static/image3.png)](urls-in-master-pages-cs/_static/image2.png)

**Рис. 02**: `PoweredByASPNET.gif` Изображение не удается найти файл ([Просмотр полноразмерного изображения](urls-in-master-pages-cs/_static/image4.png))


### <a name="replacing-relative-urls-with-absolute-urls"></a>Заменив абсолютные URL-адреса относительные URL-адреса

Противоположностью относительный URL-адрес является *абсолютный URL-адрес*, равное одному, который начинается с косой черты (`/`) или протокол, такой как `http://`. Так как абсолютный URL-адрес задает расположение ресурса из известных фиксированной запятой, же абсолютный URL-адрес в любой веб-страницы, независимо от расположения веб-страницы в структуре папок веб сайта.

Чтобы исправить разорванного изображения, показанный на рис. 2, необходимо обновить `<img>` элемента `src` таким образом, чтобы он использует абсолютный URL-адрес вместо относительной дорожки. Чтобы определить правильный абсолютный URL-адрес, обратитесь на веб-страниц в веб-сайт и проверьте адресной строке. Как показано в адресной строке на рис. 2, полный путь к веб-приложения является `http://localhost:3908/ASPNET_MasterPages_Tutorial_04_CS/`. Таким образом, мы обновляем `<img>` элемента `src` атрибут ни с одной из следующих двух абсолютный URL-адреса:

- `/ASPNET_MasterPages_Tutorial_04_CS/Images/PoweredByASPNET.gif`
- `http://localhost:3908/ASPNET_MasterPages_Tutorial_04_CS/Images/PoweredByASPNET.gif`

Отвлекитесь и обновить `<img>` элемента `src` атрибут абсолютный URL-адрес, с помощью одной из форм, показанный выше, а затем перейдите `~/Admin/Default.aspx` страницы в обозревателе. Сейчас обозреватель будет правильно поиска и отображения `PoweredByASPNET.gif` файл образа (см. рис. 3).


[![Изображение PoweredByASPNET.gif является теперь отображается](urls-in-master-pages-cs/_static/image6.png)](urls-in-master-pages-cs/_static/image5.png)

**Рис 03**: `PoweredByASPNET.gif` — Изображения теперь отображаются ([Просмотр полноразмерного изображения](urls-in-master-pages-cs/_static/image7.png))


Жестко запрограммированного в абсолютный URL-адрес работает, жестко связывает HTML к серверу веб сайта и расположение папки, которая может измениться. С помощью абсолютный URL-адрес в формате `http://localhost:3908/...` значительно усложняло работу из-за предыдущий номер порта `localhost` выбирается автоматически при каждом запуске Visual Studio встроенного сервера разработки ASP.NET Web. Аналогичным образом `http://localhost` части допустим только в том случае, при локальном тестировании. После развертывания кода на рабочем сервере базовый URL-адрес будет изменить на другое, например `http://www.yourserver.com`. Абсолютный URL-адрес в форме `/ASPNET_MasterPages_Tutorial_04_CS/...` также страдает от же хрупкости, поскольку зачастую это путь к приложению отличается от разработки и рабочим серверами.

Хорошо то, что ASP.NET предоставляет метод для генерации допустимый относительный URL-адрес во время выполнения.

## <a name="usingandresolveclienturl"></a>С помощью`~`и`ResolveClientUrl`

Вместо не жестко задать абсолютный URL-адрес, ASP.NET позволяет разработчикам использовать тильда (`~`) на корень веб-приложения. Например, ранее в этом учебнике я использовал нотации `~/Admin/Default.aspx` в тексте для ссылки на `Default.aspx` странице в `Admin` папку. `~` Указывает, что `Admin` папка является вложенной корня веб-приложения.

`Control` Класса [ `ResolveClientUrl` метод](https://msdn.microsoft.com/library/system.web.ui.control.resolveclienturl.aspx) принимает URL-адрес и изменяет его на относительный URL-адрес для веб-страницы, на котором размещен элемент управления. Например, вызов `ResolveClientUrl("~/Images/PoweredByASPNET.gif")` из `About.aspx` возвращает `Images/PoweredByASPNET.gif`. Вызов его из `~/Admin/Default.aspx`, однако возвращает `../Images/PoweredByASPNET.gif`.

> [!NOTE]
> Поскольку все серверные элементы управления ASP.NET, являются производными от `Control` класс, все серверные элементы управления имеют доступ к `ResolveClientUrl` метод. Даже `Page` класс является производным от `Control` класса, это означает, что можно использовать этот метод напрямую из кода классов страницы ASP.NET.


### <a name="usingin-the-declarative-markup"></a>С помощью`~`в декларативную разметку

Несколько элементов управления веб-ASP.NET включают свойства, связанные с URL-адрес: у элемента управления HyperLink `NavigateUrl` свойство; в образе, элемент управления имеет `ImageUrl` свойство; и т. д. При подготовке к просмотру, эти элементы управления передавать значения свойств, связанных с URL-адрес для `ResolveClientUrl`. Следовательно Если эти свойства содержат `~` для указания корневого веб-приложения, URL-адрес будет изменен на допустимый относительный URL-адрес.

Имейте в виду, что только элементы управления сервера ASP.NET преобразования `~` в их свойства, связанные с URL-адрес. Если `~` отображается в статическую разметку HTML, такие как `<img src="~/Images/PoweredByASPNET.gif" />`, механизм ASP.NET отправляет `~` в браузер вместе с остальными HTML-содержимое. Обозреватель предполагает, что `~` является частью URL-адрес. Например, если обозреватель получает разметку `<img src="~/Images/PoweredByASPNET.gif" />` предполагается, что имеется вложенная папка `~` создать вложенную папку `Images` , содержащий файл изображения `PoweredByASPNET.gif`.

Для устранения разметки изображения в `Site.master`, замените существующий `<img>` элемента с помощью элемента управления ASP.NET образа. Задать изображение веб-элемента управления `ID` для `PoweredByImage`, ее `ImageUrl` свойства `~/Images/PoweredByASPNET.gif`и его `AlternateText` свойства «На базе технологий ASP.NET!»


[!code-aspx[Main](urls-in-master-pages-cs/samples/sample5.aspx)]

После внесения этого изменения на главную страницу, вернемся к `~/Admin/Default.aspx` странице еще раз. Это время `PoweredByASPNET.gif` файл изображения отобразится на странице (см. рис. 3). Если изображение веб-элемент управления отображал использует `ResolveClientUrl` метод для разрешения его `ImageUrl` значение свойства. В `~/Admin/Default.aspx` `ImageUrl` преобразуется в соответствующий относительный URL-адрес, как следующий фрагмент кода показывает исходный HTML:


[!code-html[Main](urls-in-master-pages-cs/samples/sample6.html)]

> [!NOTE]
> Помимо использования в URL-адрес веб-свойства элемента управления, `~` также может использоваться при вызове `Response.Redirect` и `Server.MapPath` методы, помимо прочего. Кроме того `ResolveClientUrl` метод может вызываться непосредственно из ASP.NET или декларативная разметка главной страницы, при необходимости; см. в разделе [Фриц Онион](https://www.pluralsight.com/blogs/fritz/)на запись в блоге [Using `ResolveClientUrl` в разметке](https://www.pluralsight.com/blogs/fritz/archive/2006/02/06/18596.aspx).


## <a name="fixing-the-master-pages-remaining-relative-urls"></a>Исправления главной страницы в оставшихся относительные URL-адреса

В дополнение к `<img>` элемент `footerContent` , Главная страница содержит один более относительный URL-адрес, требующий наше внимание, что мы исправили. `topContent` Область включает ссылку «Master страницы руководства и» указывающий `Default.aspx`.


[!code-html[Main](urls-in-master-pages-cs/samples/sample7.html)]

Так как этот URL-адрес является относительным, он будет отправлять пользователю `Default.aspx` страницы в папке просматриваемой страницы содержимого. Чтобы эта ссылка всегда указывать на `Default.aspx` в корневой папке, нужно заменить `<a>` элемент с гиперссылку веб-элемента управления, чтобы мы могли использовать `~` нотации.

Удалить `<a>` элемент разметки и добавьте элемент управления гиперссылки на его место. Задайте гиперссылки `ID` для `lnkHome`, ее `NavigateUrl` свойства `~/Default.aspx`и его `Text` значение «Master страницы руководства».


[!code-aspx[Main](urls-in-master-pages-cs/samples/sample8.aspx)]

Вот и все! На этом этапе все, что URL-адреса в нас на главной странице основаны должным образом, при отрисовке содержимого страницы, независимо от того, какие папки главную страницу и страницу содержимого, находятся в.

### <a name="automatic-url-resolution-in-theheadsection"></a>URL-адреса автоматического разрешения в`<head>`раздел

В [ *Создание сайта макета с помощью главных страниц* ](creating-a-site-wide-layout-using-master-pages-cs.md) руководстве, мы добавили `<link>` для `Styles.css` файл `<head>` региона:


[!code-aspx[Main](urls-in-master-pages-cs/samples/sample9.aspx)]

Хотя `<link>` элемента `href` атрибута является относительным, он автоматически преобразуется в правильный путь во время выполнения. Как уже говорилось в [ *указание названия, метатегов и других заголовков HTML на главной странице* ](specifying-the-title-meta-tags-and-other-html-headers-in-the-master-page-cs.md) руководстве `<head>` область является фактически серверного элемента управления, который включает его для изменения содержимое его внутренние элементы управления при его отрисовке.

Чтобы проверить это, вернемся к `~/Admin/Default.aspx` странице и просмотреть исходный код HTML, отправляемых в браузер. Как показано на приведенном ниже фрагменте кода, `<link>` элемента `href` атрибут был автоматически изменен соответствующий относительный URL-адрес, `../Styles.css`.


[!code-html[Main](urls-in-master-pages-cs/samples/sample10.html)]

## <a name="summary"></a>Сводка

Главные страницы очень часто включают ссылки, изображения и другие внешние ресурсы, которые должны быть указаны с помощью URL-адрес. Так как главной страницы и страницы содержимого может не существовать в той же папке, важно abstain использовать относительные URL-адреса. Хотя и существует возможность использовать жестко запрограммированные абсолютные URL-адреса, поэтому тесно выполнив связывает абсолютный URL-адрес веб-приложению. При изменении абсолютный URL-адрес — как часто происходит при перемещении или развертывание веб-приложения — вы обязательно вернитесь и обновите абсолютные URL-адреса.

Идеальный подход заключается в использовании тильда (`~`) чтобы указать корневой каталог приложения. Сопоставление элементов управления веб-ASP.NET, которые содержат свойства, связанные с URL-адрес `~` к корню приложения во время выполнения. На внутреннем уровне использования веб-элементы управления `Control` класса `ResolveClientUrl` метод для генерации допустимый относительный URL-адрес. Этот метод является открытыми и доступными из каждого серверного элемента управления (включая `Page` класс), поэтому можно использовать его программными средствами из классов кода, при необходимости.

Счастливого вам программирования!

### <a name="further-reading"></a>Дополнительные сведения

Дополнительные сведения по темам, обсуждавшимся в этом руководстве см. в следующих ресурсах:

- [Главные страницы в ASP.NET](http://www.odetocode.com/Articles/419.aspx)
- [Модификация базового адреса URL-адрес содержит на главной странице](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/masterpages/default.aspx#urls)
- [С помощью `ResolveClientUrl` в разметке](https://www.pluralsight.com/blogs/fritz/archive/2006/02/06/18596.aspx)

### <a name="about-the-author"></a>Об авторе

[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор из нескольких книг по ASP/ASP.NET и основатель веб-узла 4GuysFromRolla.com, работает с веб-технологиями Microsoft с 1998 года. Скотт — независимый консультант, преподаватель и автор. Его последняя книга — [ *Sams Teach самостоятельно ASP.NET 3.5 за 24 часа*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco). Скоттом можно связаться по адресу [ mitchell@4GuysFromRolla.com ](mailto:mitchell@4GuysFromRolla.com) или через его блог по адресу [ http://ScottOnWriting.NET ](http://scottonwriting.net/).

### <a name="special-thanks-to"></a>Особая благодарность

Хотите поработать с моих последующих статей для MSDN? Если Да, напишите мне [ mitchell@4GuysFromRolla.com ](mailto:mitchell@4GuysFromRolla.com).

> [!div class="step-by-step"]
> [Назад](specifying-the-title-meta-tags-and-other-html-headers-in-the-master-page-cs.md)
> [Вперед](control-id-naming-in-content-pages-cs.md)
