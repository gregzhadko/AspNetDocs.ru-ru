---
uid: web-forms/overview/older-versions-getting-started/master-pages/urls-in-master-pages-vb
title: URL-адреса на главных страницах (VB) | Документация Майкрософт
author: rick-anderson
description: Решает, как могут быть нарушены URL-адреса на главной странице из-за того, что файл главной страницы находится в другом относительном каталоге, чем на странице содержимого. Выполняется поиск в переуровне...
ms.author: riande
ms.date: 06/10/2008
ms.assetid: 43d1e83c-0092-4dcf-977c-e709c4dce7c3
msc.legacyurl: /web-forms/overview/older-versions-getting-started/master-pages/urls-in-master-pages-vb
msc.type: authoredcontent
ms.openlocfilehash: 01627988f68bb619969a5fe3cfaae68fe70b5d4f
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78441108"
---
# <a name="urls-in-master-pages-vb"></a>URL-адреса на эталонных страницах (VB)

по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Скачать код](https://download.microsoft.com/download/e/e/f/eef369f5-743a-4a52-908f-b6532c4ce0a4/ASPNET_MasterPages_Tutorial_04_VB.zip) или [скачать PDF](https://download.microsoft.com/download/8/f/6/8f6349e4-6554-405a-bcd7-9b094ba5089a/ASPNET_MasterPages_Tutorial_04_VB.pdf)

> Решает, как могут быть нарушены URL-адреса на главной странице из-за того, что файл главной страницы находится в другом относительном каталоге, чем на странице содержимого. Выполняет поиск перенаправленных URL-адресов через ~ в декларативном синтаксисе и программно с помощью Ресолвеурл и Ресолвеклиентурл. (Также взгляните на

## <a name="introduction"></a>Введение

Во всех примерах, которые мы видели до сих пор, страницы главного и содержимого находятся в той же папке (корневая папка веб-сайта). Но нет причин, по которым Главная страница и страницы содержимого должны находиться в одной папке. Конечно, можно создавать страницы содержимого во вложенных папках. Аналогичным образом вы можете создать папку `~/MasterPages/`, в которую будут размещены главные страницы сайта.

Одна из потенциальных проблем, связанная с размещением главных и страниц содержимого в разных папках, заключается в нарушении URL-адресов Если Главная страница содержит относительные URL-адреса в гиперссылках, изображениях или других элементах, ссылка будет недействительной для страниц содержимого, расположенных в другой папке. В этом учебнике рассматривается источник этой проблемы, а также способы их обхода.

## <a name="the-problem-with-relative-urls"></a>Проблема с относительными URL-адресами

Ссылка на веб-страницу считается *относительным URL-адресом* , если расположение ресурса, на который он указывает, определяется относительно расположения веб-страницы в структуре папок веб-сайта. Любой URL-адрес, не начинающийся с начальной косой черты (`/`) или протокола (например, `http://`), является относительным, так как он разрешается браузером на основе расположения веб-страницы, содержащей URL-адрес.

Например, наш веб-сайт имеет папку `~/Images/` с одним файлом изображения `PoweredByASPNET.gif`. Файл главной страницы `Site.master` содержит элемент `<img>` в области `footerContent` со следующей разметкой:

[!code-html[Main](urls-in-master-pages-vb/samples/sample1.html)]

Значение атрибута `src` в элементе `<img>` является относительным URL-адресом, так как не начинается с `/` или `http://`. Вкратце, значение атрибута `src` указывает обозревателю искать в подпапке `Images` файла с именем `PoweredByASPNET.gif`.

При посещении страницы содержимого приведенная выше разметка отправляется непосредственно в браузер. Уделите время посетить `About.aspx` и просмотреть исходный HTML-код, отправленный в браузер. Вы обнаружите, что та же разметка на главной странице была отправлена в браузер.

[!code-html[Main](urls-in-master-pages-vb/samples/sample2.html)]

Если страница содержимого находится в корневой папке (как и `About.aspx`), все работает должным образом, так как существует `Images` вложенная папка относительно корневой папки. Тем не менее, если страница содержимого находится в папке, отличной от папки главной страницы, она разбивается на страницы. Чтобы проиллюстрировать это, создайте вложенную папку с именем `Admin`. Затем добавьте страницу содержимого с именем `Default.aspx` в папку `Admin` и убедитесь, что новая страница привязывается к главной странице `Site.master`.

> [!NOTE]
> В разделе [*Указание заголовка, Meta-тегов и других заголовков HTML в*](specifying-the-title-meta-tags-and-other-html-headers-in-the-master-page-vb.md) учебнике по главной странице мы создали пользовательский класс базовой страницы с именем `BasePage`, который автоматически задает заголовок страницы содержимого (если он не был явно назначен). Не забудьте создать класс кода программной части созданной страницы от `BasePage`, чтобы он мог использовать эту функцию.

После создания этой страницы содержимого обозреватель решений должны выглядеть примерно так, как показано на рис. 1.

![В проект добавлены Новая папка и страница ASP.NET](urls-in-master-pages-vb/_static/image1.png)

**Рис. 01**. в проект добавлены Новая папка и страница ASP.NET

Затем обновите файл `Web.sitemap`, включив в него новую запись `<siteMapNode>` для этого занятия. В следующем коде XML показана полная разметка `Web.sitemap`, которая теперь включает в себя добавление третьего элемента `<siteMapNode>`.

[!code-xml[Main](urls-in-master-pages-vb/samples/sample3.xml)]

Только что созданная страница `Default.aspx` должна иметь четыре элемента управления содержимым, соответствующие четырем элементов управления ContentPlaceHolder в `Site.master`. Добавьте некоторый текст в элемент управления содержимым, ссылающийся на `MainContent` ContentPlaceHolder, а затем откройте страницу в браузере. Как показано на рис. 2, браузер не может найти файл изображения `PoweredByASPNET.gif`. В чем причина?

Страница содержимого `~/Admin/Default.aspx` отправляет тот же код HTML для `footerContent` региона, который был `About.aspx` страницей:

[!code-html[Main](urls-in-master-pages-vb/samples/sample4.html)]

Так как атрибут `src` элемента `<img>` является относительным URL-адресом, браузер пытается найти папку `Images` относительно расположения папки на странице. Иными словами, браузер ищет файл изображения `Admin/Images/PoweredByASPNET.gif`.

[![не удается найти файл изображения Повередбяспнет. gif](urls-in-master-pages-vb/_static/image3.png)](urls-in-master-pages-vb/_static/image2.png)

**Рис. 02**. не удается найти файл изображения `PoweredByASPNET.gif` ([щелкните, чтобы просмотреть изображение с полным размером](urls-in-master-pages-vb/_static/image4.png))

### <a name="replacing-relative-urls-with-absolute-urls"></a>Замена относительных URL-адресов абсолютными URL-адресами

Противоположностью относительного URL-адреса является *абсолютный URL-адрес*, который начинается с косой черты (`/`) или протокола, например `http://`. Поскольку абсолютный URL-адрес указывает расположение ресурса из известной фиксированной точки, тот же абсолютный URL-адрес действителен на любой веб-странице, независимо от расположения веб-страницы в структуре папок веб-сайта.

Чтобы исправить неработающий образ, показанный на рис. 2, необходимо обновить атрибут `src` элемента `<img>`, чтобы он использовал абсолютный URL-адрес вместо относительного. Чтобы определить правильный абсолютный URL-адрес, посетите одну из веб-страниц на веб-сайте и изучите адресную строку. Как показано в адресной строке на рис. 2, полный путь к веб-приложению `http://localhost:3908/ASPNET_MasterPages_Tutorial_04_VB/`. Поэтому можно обновить атрибут `src` элемента `<img>` до одного из следующих двух абсолютных URL-адресов:

- `/ASPNET_MasterPages_Tutorial_04_VB/Images/PoweredByASPNET.gif`
- `http://localhost:3908/ASPNET_MasterPages_Tutorial_04_VB/Images/PoweredByASPNET.gif`

Уделите время, чтобы обновить атрибут `src` элемента `<img>` до абсолютного URL-адреса, используя одну из приведенных выше форм, а затем посетить страницу `~/Admin/Default.aspx` в браузере. На этот раз браузер будет правильно находить и отображать файл изображения `PoweredByASPNET.gif` (см. рис. 3).

[![изображение Повередбяспнет. gif теперь отображается](urls-in-master-pages-vb/_static/image6.png)](urls-in-master-pages-vb/_static/image5.png)

**Рис. 03**. теперь отображается изображение `PoweredByASPNET.gif` ([щелкните, чтобы просмотреть изображение с полным размером](urls-in-master-pages-vb/_static/image7.png))

Хотя жестко программировать в абсолютном URL-адресе, он тесно прикрепляет ваш код HTML к серверу и расположению папки веб-сайта, что может измениться. Использование абсолютного URL-адреса формы `http://localhost:3908/...` нестабильным, поскольку номер порта, предшествующий localhost, выбирается автоматически при каждом запуске встроенного веб-сервера ASP.NET Development Visual Studio. Аналогичным образом `http://localhost` часть допустима только при локальном тестировании. После развертывания кода на рабочем сервере база URL-адреса изменится на что-то другое, например `http://www.yourserver.com`. Абсолютный URL-адрес в форме `/ASPNET_MasterPages_Tutorial_04_VB/...` также пострадает от того же хрупкости, так как часто этот путь к приложению отличается от сервера разработки и рабочих серверов.

Хорошая новость заключается в том, что ASP.NET предлагает метод для создания допустимого относительного URL-адреса во время выполнения.

## <a name="usingandresolveclienturl"></a>Использование`~`и`ResolveClientUrl`

Вместо того, чтобы жестко кодировать абсолютный URL-адрес, ASP.NET позволяет разработчикам страниц использовать тильду (`~`) для указания корневого каталога веб-приложения. Например, ранее в этом учебнике я использовал нотацию `~/Admin/Default.aspx` в тексте для ссылки на страницу `Default.aspx` в папке `Admin`. `~` указывает, что папка `Admin` является вложенной папкой корневого каталога веб-приложения.

[Метод`ResolveClientUrl`](https://msdn.microsoft.com/library/system.web.ui.control.resolveclienturl.aspx) `Control` класса принимает URL-адрес и изменяет его на относительный URL-адрес, соответствующий веб странице, на которой находится элемент управления. Например, вызов `ResolveClientUrl("~/Images/PoweredByASPNET.gif")` из `About.aspx` возвращает `Images/PoweredByASPNET.gif`. Однако вызов его из `~/Admin/Default.aspx`возвращает `../Images/PoweredByASPNET.gif`.

> [!NOTE]
> Поскольку все серверные элементы управления ASP.NET являются производными от класса `Control`, все серверные элементы управления имеют доступ к методу `ResolveClientUrl`. Даже класс `Page` является производным от класса `Control`, что позволяет использовать этот метод непосредственно из классов кода программной части страниц ASP.NET.

### <a name="usingin-the-declarative-markup"></a>Использование`~`в декларативной разметке

Некоторые веб-элементы управления ASP.NET включают свойства, связанные с URL-адресами: элемент управления HyperLink имеет свойство `NavigateUrl`; элемент управления "изображение" имеет свойство `ImageUrl`; и т. д. При подготовке к просмотру эти элементы управления передают значения свойств, связанные с URL-адресом, в `ResolveClientUrl`. Следовательно, если эти свойства содержат `~` для указания корневого каталога веб-приложения, URL-адрес будет изменен на допустимый относительный URL-адрес.

Помните, что `~` в свойствах, связанных с URL-адресами, преобразовывают только элементы управления сервера ASP.NET. Если `~` появляется в статической HTML-разметке, например `<img src="~/Images/PoweredByASPNET.gif" />`, обработчик ASP.NET отправляет `~` в браузер вместе с остальной частью содержимого HTML. В браузере предполагается, что `~` является частью URL-адреса. Например, если браузер получает разметку `<img src="~/Images/PoweredByASPNET.gif" />` предполагается, что есть вложенная папка с именем `~` с вложенной папкой `Images`, которая содержит файл изображения `PoweredByASPNET.gif`.

Чтобы исправить разметку изображения в `Site.master`, замените существующий элемент `<img>` веб-элементом управления Image ASP.NET. Задайте для `ID` веб-элемента управления Image значение `PoweredByImage`, его свойство `ImageUrl` `~/Images/PoweredByASPNET.gif`, а для свойства `AlternateText` — значение "на платформе ASP.NET!".

[!code-aspx[Main](urls-in-master-pages-vb/samples/sample5.aspx)]

После внесения этого изменения на главную страницу снова перейдите на страницу `~/Admin/Default.aspx`. На этот раз файл изображения `PoweredByASPNET.gif` отображается на странице (см. рис. 3). При подготовке к просмотру веб-элемента управления изображение использует метод `ResolveClientUrl` для разрешения `ImageUrl` значения свойства. В `~/Admin/Default.aspx` `ImageUrl` преобразуется в соответствующий относительный URL-адрес, как показано в следующем фрагменте кода HTML:

[!code-html[Main](urls-in-master-pages-vb/samples/sample6.html)]

> [!NOTE]
> Помимо использования в свойствах веб-элемента управления на основе URL-адреса, `~` можно также использовать при вызове методов `Response.Redirect` и `Server.MapPath`, помимо прочего. Кроме того, при необходимости метод `ResolveClientUrl` можно вызвать непосредственно из декларативной разметки ASP.NET или главной страницы. см. запись блога [Фриц кальки](https://www.pluralsight.com/blogs/fritz/) [с помощью `ResolveClientUrl` в разметке](https://www.pluralsight.com/blogs/fritz/archive/2006/02/06/18596.aspx).

## <a name="fixing-the-master-pages-remaining-relative-urls"></a>Исправление оставшихся относительных URL-адресов главной страницы

В дополнение к элементу `<img>` в `footerContent`, который мы только что устранили, Главная страница содержит еще один относительный URL-адрес, требующий нашего внимания. В `topContent` области содержатся ссылки «учебники по главным страницам», указывающие на `Default.aspx`.

[!code-html[Main](urls-in-master-pages-vb/samples/sample7.html)]

Так как этот URL-адрес является относительным, пользователь будет отправлен на страницу `Default.aspx` в папке страницы содержимого, которую он посещает. Чтобы эта ссылка всегда указывала на `Default.aspx` в корневой папке, необходимо заменить элемент `<a>` на веб-элемент управления HyperLink, чтобы можно было использовать нотацию `~`.

Удалите разметку элемента `<a>` и добавьте на ее место элемент управления HyperLink. Задайте для `ID` гиперссылки значение `lnkHome`, свойство `NavigateUrl` `~/Default.aspx`, а для свойства `Text` — "учебники по главным страницам".

[!code-aspx[Main](urls-in-master-pages-vb/samples/sample8.aspx)]

Вот и все! На этом этапе все URL-адреса на главной странице должным образом основаны на странице содержимого, независимо от того, в каких папках находится Главная страница и страница содержимого.

### <a name="automatic-url-resolution-in-theheadsection"></a>Автоматическое разрешение URL-адресов в разделе`<head>`

В учебнике [*Создание макета на уровне сайта с помощью главных страниц*](creating-a-site-wide-layout-using-master-pages-vb.md) мы добавили `<link>` в файл `Styles.css` в `<head>`ном регионе:

[!code-aspx[Main](urls-in-master-pages-vb/samples/sample9.aspx)]

Хотя атрибут `href` элемента `<link>` является относительным, он автоматически преобразуется в соответствующий путь во время выполнения. Как обсуждалось в разделе [*Указание заголовка, Meta-тегов и других заголовков HTML в руководстве по главной странице*](specifying-the-title-meta-tags-and-other-html-headers-in-the-master-page-vb.md) , `<head>` регион фактически является элементом управления на стороне сервера, что позволяет ему изменять содержимое его внутренних элементов управления при его подготовке к просмотру.

Чтобы проверить это, вернитесь на страницу `~/Admin/Default.aspx` и просмотрите исходный HTML-код, отправленный в браузер. Как показано в следующем фрагменте кода, `href` атрибут элемента `<link>` был автоматически изменен на соответствующий относительный URL-адрес `../Styles.css`.

[!code-html[Main](urls-in-master-pages-vb/samples/sample10.html)]

## <a name="summary"></a>Сводка

Главные страницы очень часто содержат ссылки, изображения и другие внешние ресурсы, которые необходимо указать с помощью URL-адреса. Так как эталонная страница и страницы содержимого могут отсутствовать в одной папке, важно абстаин с помощью относительных URL-адресов. Хотя можно использовать жестко закодированные абсолютные URL-адреса, это жестко прикрепляет абсолютный адрес URL к приложению. При изменении абсолютного URL-адреса, как это часто происходит при перемещении или развертывании веб-приложения, необходимо помнить о необходимости вернуться и обновить абсолютные URL-адреса.

Идеальным подходом является использование тильды (`~`) для указания корневого каталога приложения. ASP.NET веб-элементы управления, которые содержат свойства, связанные с URL-адресом, сопоставляют `~` с корнем приложения во время выполнения. На внутреннем уровне веб-элементы управления используют метод `ResolveClientUrl` класса `Control` для создания допустимого относительного URL-адреса. Этот метод является открытым и доступен из каждого серверного элемента управления (включая класс `Page`), поэтому его можно использовать программным способом из классов кода программной части, если это необходимо.

Поздравляем с программированием!

### <a name="further-reading"></a>Дополнительные материалы

Дополнительные сведения о разделах, обсуждаемых в этом руководстве, см. в следующих ресурсах:

- [Главные страницы в ASP.NET](http://www.odetocode.com/Articles/419.aspx)
- [Пересоздание URL-адресов на главной странице](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/masterpages/default.aspx#urls)
- [Использование `ResolveClientUrl` в разметке](https://www.pluralsight.com/blogs/fritz/archive/2006/02/06/18596.aspx)

### <a name="about-the-author"></a>Об авторе

[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор нескольких книг по ASP/ASP. NET и основатель 4GuysFromRolla.com, работал с веб-технологиями майкрософт с 1998. Скотт работает как независимый консультант, преподаватель и модуль записи. Его последняя книга — [*Sams обучать себя ASP.NET 3,5 за 24 часа*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco). Скотт можно получить по адресу [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com) или через свой блог по адресу [http://ScottOnWriting.NET](http://scottonwriting.net/).

### <a name="special-thanks-to"></a>Специальная благодарность

Хотите ознакомиться с моими будущими статьями MSDN? Если это так, расположите строку в [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com).

> [!div class="step-by-step"]
> [Назад](specifying-the-title-meta-tags-and-other-html-headers-in-the-master-page-vb.md)
> [Вперед](control-id-naming-in-content-pages-vb.md)
