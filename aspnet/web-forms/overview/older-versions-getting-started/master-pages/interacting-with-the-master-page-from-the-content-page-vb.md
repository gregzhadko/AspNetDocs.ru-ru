---
uid: web-forms/overview/older-versions-getting-started/master-pages/interacting-with-the-master-page-from-the-content-page-vb
title: Взаимодействие с главной страницей на странице содержимого (Visual Basic) | Документация Майкрософт
author: rick-anderson
description: Проверяет как вызывать методы, задайте свойства, т. д., из главной страницы из кода на странице содержимого.
ms.author: riande
ms.date: 07/11/2008
ms.assetid: 081fe010-ba0f-4e7d-b4ba-774840b601c2
msc.legacyurl: /web-forms/overview/older-versions-getting-started/master-pages/interacting-with-the-master-page-from-the-content-page-vb
msc.type: authoredcontent
ms.openlocfilehash: 1326d5453f205201af850a30c17f509645e15cb9
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59422204"
---
# <a name="interacting-with-the-master-page-from-the-content-page-vb"></a>Взаимодействие с эталонной страницей на странице содержимого (VB)

по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Скачать код](http://download.microsoft.com/download/1/8/4/184e24fa-fcc8-47fa-ac99-4b6a52d41e97/ASPNET_MasterPages_Tutorial_06_VB.zip) или [скачать PDF](http://download.microsoft.com/download/e/b/4/eb4abb10-c416-4ba4-9899-32577715b1bd/ASPNET_MasterPages_Tutorial_06_VB.pdf)

> Проверяет как вызывать методы, задайте свойства, т. д., из главной страницы из кода на странице содержимого.


## <a name="introduction"></a>Вступление

В ходе предыдущих пять учебных курсах мы рассматривали как создать главную страницу, определить области содержимого, привязать страниц ASP.NET к главной странице и содержимое конкретной страницы. Когда посетитель запрашивает определенной страницы содержимого, содержимого и главные страницы разметки совмещенного во время выполнения, приводит к отрисовку иерархии единой системы управления. Таким образом, мы уже видели, в который главной страницы и один из его страниц могут взаимодействовать: страницы содержимого штатные разметку для transfuse в элементы управления ContentPlaceHolder на главной странице.

То, что есть еще изучаемый является главной страницы и страницы содержимого взаимодействие программным способом. Кроме определения разметки для элементов управления ContentPlaceHolder на главной странице, страницу содержимого можно присваивать значения главной страницы общих свойств и вызова его открытых методов. Аналогичным образом Главная страница может взаимодействовать с его страниц. Несмотря на то реже, чем взаимодействие между их декларативной наценки программного взаимодействия между главной и содержимое страницы, существует множество сценариев, где требуются такие программного взаимодействия.

В этом руководстве мы рассмотрим, как страницы содержимого могут программно взаимодействовать с главной страницей по; в следующем учебном курсе мы рассмотрим, как главной страницы можно аналогичным образом взаимодействуют с его страниц.

## <a name="examples-of-programmatic-interaction-between-a-content-page-and-its-master-page"></a>Примеры программного взаимодействия между содержимым и его главной страницы

При определенном регионе страницы должен быть настроен по принципу страниц, мы используем элемент управления ContentPlaceHolder. Но как насчет ситуациях, где большинство страниц необходимо создавать определенные выходные данные, но большое количество страниц, потребуется настроить его, чтобы отобразить что-то другое? Пример такой функции, который мы рассмотрели в [ *несколько элементов управления ContentPlaceHolder и содержимое по умолчанию* ](multiple-contentplaceholders-and-default-content-vb.md) учебник, включает в себя отображение интерфейс входа на каждой странице. Хотя большинство страниц должны включать интерфейс входа, должно быть подавлено для небольшое число страниц, таких как: на страницу входа основной (`Login.aspx`); страница создания учетной записи и другие страницы, которые доступны только пользователям, прошедшим проверку. [ *Несколько элементов управления ContentPlaceHolder и содержимое по умолчанию* ](multiple-contentplaceholders-and-default-content-vb.md) учебнике мы рассмотрели определение содержимого по умолчанию для элемента ContentPlaceHolder на главной странице и затем как переопределить его в те страницы where содержимое по умолчанию было нежелательно.

Другой вариант — создать общее свойство или метод на главной странице, который указывает, следует ли отображать или скрывать интерфейс входа. Например, Главная страница может включать открытое свойство с именем `ShowLoginUI` , значение которого было использовано `Visible` свойство элемента управления Login на главной странице. Эти страницы содержимого, где следует ли подавлять пользовательский интерфейс входа может затем программно задать `ShowLoginUI` свойства `False`.

Возможно наиболее распространенным примером содержимого и взаимодействия с главной страницы происходит, когда данные отображаются в главной страницы необходимо обновлять после его задан какое-либо действие на странице содержимого. Рассмотрите возможность Главная страница, включающий GridView, отображающий пять наиболее недавно добавлена записей из таблицы базы данных, и что один из его страниц включает интерфейс для добавления новых записей в той же таблице.

При посещении пользователем страницы, чтобы добавить новую запись, она видит, что пять недавно добавленных записей, отображаемых на главной странице. После заполнения значения для столбцов новой записи, она отправляет форму. При условии, что у GridView на главной странице есть его `EnableViewState` свойству присвоено значение True (по умолчанию), его содержимое загружается из состояния представления и, следовательно, отображаются пять же записи, несмотря на то, что новая запись был только что добавлен в базу данных. Это может запутать пользователя.

> [!NOTE]
> Даже при отключении состояния представления элемента GridView, таким образом, чтобы он выполняет повторную привязку в источнике данных при каждой обратной передаче, он по-прежнему не отобразить только что добавленные запись так, как они привязываются к GridView ранее в жизненном цикле страницы, чем при добавлении новой записи базы данных ASE.


Чтобы исправить это, чтобы отображались только что добавленные записи на главной странице элемента GridView на обратную передачу, нам нужно указать GridView выполнять повторную привязку к источнику данных *после* новой записи был добавлен в базу данных. Это требует взаимодействия между содержимым и главные страницы, так как интерфейс для добавления новой записи (и соответствующих обработчиков событий) находятся в страницы содержимого, но GridView, который должен быть обновлен на главной странице.

Так как обновление экрана главной страницы из обработчика событий на странице содержимого является одним из наиболее распространенных потребностей для содержимого и взаимодействия с главной страницы, давайте выясним, в этом разделе более подробно. Загрузка в этом руководстве включает в себя базу данных Microsoft SQL Server 2005 Express Edition, с именем `NORTHWIND.MDF` на веб-сайте `App_Data` папки. Базы данных Northwind хранит продукта, сотрудников и сведения о продажах для вымышленной компании Northwind Traders.

Шаг 1 описан отображения пяти наиболее недавно добавлена продуктов в элементе управления GridView на главной странице. Шаг 2 создает страницу содержимого для добавления новых продуктов. Шаг 3 рассказывается, как создать общие свойства и методы на главной странице и шаг 4 показано, как программно взаимодействовать с этими свойствами и методами, на странице содержимого.

> [!NOTE]
> Этот учебник не изучения особенностей работы с данными в ASP.NET. Действия по настройке главной страницы для отображения данных и странице содержимого для вставки данных: полный, еще breezy. Более подробно рассмотрим отображение и вставка данных с помощью элементов управления SqlDataSource и GridView можно найти в источниках, в разделе «Дополнительные материалы» в конце этого руководства.


## <a name="step-1-displaying-the-five-most-recently-added-products-in-the-master-page"></a>Шаг 1. Отображение пяти недавно добавленных продуктов на главной странице

Откройте страницей Site.master и добавьте метку и элемент управления GridView для `leftContent` `<div>`. Очистите метки `Text` задайте его `EnableViewState` свойства `False`и его `ID` свойства `GridMessage`; присвоить свойству `ID` свойства `RecentProducts`. Затем из конструктора, разверните смарт-теге элемента GridView и выберите привязать его к новому источнику данных. Запустится мастер настройки источника данных. Так как база данных "Борей" в `App_Data` папки — это база данных Microsoft SQL Server, выберите для создания элемента управления SqlDataSource путем выбора (см. рис. 1); имя элемента управления SqlDataSource `RecentProductsDataSource`.


[![Привязки GridView к элементу управления SqlDataSource, с именем RecentProductsDataSource](interacting-with-the-master-page-from-the-content-page-vb/_static/image2.png)](interacting-with-the-master-page-from-the-content-page-vb/_static/image1.png)

**Рис 01**: Привязки GridView к элементу управления SqlDataSource присваивается имя `RecentProductsDataSource` ([Просмотр полноразмерного изображения](interacting-with-the-master-page-from-the-content-page-vb/_static/image3.png))


Следующим шагом является запрос для указания, что базы данных для подключения к. Выберите `NORTHWIND.MDF` файла из раскрывающегося списка базы данных и нажмите кнопку Далее. Так как это первый раз, мы использовали эту базу данных, мастер предложит сохранить строку подключения в `Web.config`. Его сохранение строки подключения, используя имя `NorthwindConnectionString`.


[![Подключение к базе данных "Борей"](interacting-with-the-master-page-from-the-content-page-vb/_static/image5.png)](interacting-with-the-master-page-from-the-content-page-vb/_static/image4.png)

**Рис. 02**: Подключение к базе данных "Борей" ([Просмотр полноразмерного изображения](interacting-with-the-master-page-from-the-content-page-vb/_static/image6.png))


Мастер настройки источника данных предоставляет два средства, по которым можно указать запрос, используемый для получения данных:

- Пользовательские инструкции SQL или хранимой процедуры или
- Выбрав таблицу или представление, а затем указав столбцы, возвращаемые

Поскольку нам требуется возвратить только пять наиболее недавно добавлены продуктов, нам нужно указать пользовательские инструкции SQL. Используйте следующую команду `SELECT` запроса:


[!code-sql[Main](interacting-with-the-master-page-from-the-content-page-vb/samples/sample1.sql)]

`TOP 5` Ключевое слово возвращает только первые пять записей из запроса. `Products` Первичного ключа таблицы `ProductID`, является `IDENTITY` столбец, который гарантирует, что каждого нового продукта, добавляемого в таблицу будет больше предыдущей записи. Таким образом, сортировка результатов по `ProductID` в порядке убывания возвращает продукты, начиная с наиболее недавно созданный из них.


[![Возвращает последний добавленный пяти продуктов](interacting-with-the-master-page-from-the-content-page-vb/_static/image8.png)](interacting-with-the-master-page-from-the-content-page-vb/_static/image7.png)

**Рис 03**: Возвращать пяти наиболее недавно добавлена продуктов ([Просмотр полноразмерного изображения](interacting-with-the-master-page-from-the-content-page-vb/_static/image9.png))


После завершения работы мастера Visual Studio создает два поля BoundField, кроме для GridView для отображения `ProductName` и `UnitPrice` полей, возвращаемых из базы данных. На этом этапе декларативная разметка главной страницы должен содержать разметку, аналогичную следующей:


[!code-aspx[Main](interacting-with-the-master-page-from-the-content-page-vb/samples/sample2.aspx)]

Как вы видите, разметка содержит: элемент управления Label Web (`GridMessage`); GridView `RecentProducts`с два поля BoundField, кроме; и элемента управления SqlDataSource, возвращающий пять наиболее недавно добавленные продукты.

С этим GridView создан и его элемента управления SqlDataSource настроен, посетите веб-сайта через браузер. Как показано на рис. 4, вы увидите, что в сетке в левом нижнем углу, перечислены пять наиболее недавно добавлена продуктов.


[![Элемент GridView отображает по пяти недавно добавленных продуктов](interacting-with-the-master-page-from-the-content-page-vb/_static/image11.png)](interacting-with-the-master-page-from-the-content-page-vb/_static/image10.png)

**Рис. 04**: Элемент GridView отображает по пяти наиболее недавно добавлена продуктов ([Просмотр полноразмерного изображения](interacting-with-the-master-page-from-the-content-page-vb/_static/image12.png))


> [!NOTE]
> Вы можете очистить внешний вид элемента управления GridView. Некоторые предложения, включают форматирование отображаемых `UnitPrice` как денежной единицы и с помощью фоновых цветов и шрифтов, чтобы улучшить внешний вид сетки.


## <a name="step-2-creating-a-content-page-to-add-new-products"></a>Шаг 2. Создание страницы содержимого для добавления новых продуктов

DAL следующей задачей является создание страницы содержимого, из которого пользователь может добавить нового продукта для `Products` таблицы. Добавьте новую страницу содержимого для `Admin` папку с именем `AddProduct.aspx`, не забыв привяжите его к `Site.master` главной страницы. Рис. 5 показан обозреватель решений после добавления этой страницы на веб-сайт.


[![Добавьте новую страницу ASP.NET в папку администрирования](interacting-with-the-master-page-from-the-content-page-vb/_static/image14.png)](interacting-with-the-master-page-from-the-content-page-vb/_static/image13.png)

**05 рис**: Добавьте новую страницу ASP.NET к `Admin` папку ([Просмотр полноразмерного изображения](interacting-with-the-master-page-from-the-content-page-vb/_static/image15.png))


Помните, что в [ *указание названия, метатегов и других заголовков HTML на главной странице* ](specifying-the-title-meta-tags-and-other-html-headers-in-the-master-page-vb.md) руководстве мы создали пользовательскую страницу базовый класс с именем `BasePage` , создавший заголовок страницы, если он был не задан явно. Перейдите к `AddProduct.aspx` фонового кода страницы класса, который будет наследовать `BasePage` (а не из `System.Web.UI.Page`).

Наконец, обновите `Web.sitemap` файл, чтобы включить запись для этого занятия. Добавьте следующую разметку под `<siteMapNode>` занятия проблемы именования идентификатор элемента управления:


[!code-xml[Main](interacting-with-the-master-page-from-the-content-page-vb/samples/sample3.xml)]

Как показано на рис. 6, добавление этого `<siteMapNode>` элемент отображается в списке занятий.

Вернитесь к `AddProduct.aspx`. В элементе управления содержимым для `MainContent` ContentPlaceHolder, добавьте элемент управления DetailsView и назовите его `NewProduct`. Привязка элемента управления DetailsView для нового элемента управления SqlDataSource с именем `NewProductDataSource`. Как с помощью элемента управления SqlDataSource на шаге 1, мастер настройки таким образом, чтобы он использует базы данных Northwind и требуется указать пользовательские инструкции SQL. Так как DetailsView будет использоваться для добавления элементов в базе данных, необходимо указать оба `SELECT` инструкции и `INSERT` инструкции. Используйте следующую команду `SELECT` запроса:


[!code-sql[Main](interacting-with-the-master-page-from-the-content-page-vb/samples/sample4.sql)]

Из вкладки «Вставка», добавьте следующий `INSERT` инструкции:


[!code-sql[Main](interacting-with-the-master-page-from-the-content-page-vb/samples/sample5.sql)]

После завершения работы мастера перейдите к DetailsView смарт-тег и установите флажок «Включить Вставка». Это поле добавляет CommandField к элементу управления DetailsView с его `ShowInsertButton` свойство присвоено значение True. Так как этот DetailsView будет использоваться исключительно для вставки данных, задайте DetailsView `DefaultMode` свойства `Insert`.

Вот и все! Давайте протестируем эту страницу. Посетите `AddProduct.aspx` через браузер, введите имя и цена (см. рис. 6).


[![Добавить новый продукт в базу данных](interacting-with-the-master-page-from-the-content-page-vb/_static/image17.png)](interacting-with-the-master-page-from-the-content-page-vb/_static/image16.png)

**Рис 06**: Добавить новый продукт в базу данных ([Просмотр полноразмерного изображения](interacting-with-the-master-page-from-the-content-page-vb/_static/image18.png))


После ввода в название и цену для нового продукта нажмите кнопки "Вставить". Это приводит к обратной передаче. При обратной передаче элемента управления SqlDataSource `INSERT` выполняется инструкция; его два параметра, заполняются значений, введенных пользователем, в элементе DetailsView, два элемента управления TextBox. К сожалению нет не визуальной обратной связи, который происходит вставка. Было бы неплохо иметь сообщение, подтверждающее, что запись новой было добавлено. Оставить этот в качестве упражнения для чтения. Кроме того, после добавления новой записи из элемента управления DetailsView GridView на главной странице по-прежнему отображается же пятью записями как перед; он не включает только что добавленные записи. Мы изучим способ исправить это при выполнении дальнейших действий.

> [!NOTE]
> Помимо добавления определенные виды визуальную обратную связь, вставка завершилась успешно, я призываю вас также обновить интерфейсу вставки DetailsView, включая проверку. В настоящее время не проверяется. Если пользователь вводит недопустимое значение для `UnitPrice` поля, такие как «слишком дорогим,» исключение будет создаваться при обратной передаче, когда система пытается преобразовать эту строку в десятичное число. Дополнительные сведения о настройке Вставка интерфейсом, см. [ *Настройка интерфейса изменения данных* руководстве](https://asp.net/learn/data-access/tutorial-20-vb.aspx) из моей [работа с серии руководств данных](../../data-access/index.md).


## <a name="step-3-creating-public-properties-and-methods-in-the-master-page"></a>Шаг 3. Создание общедоступного свойства и методы на главной странице

На шаге 1, мы добавили элемент управления Label Web `GridMessage` над элементом управления GridView на главной странице. Эта метка предназначается для при необходимости отображения сообщения. Например, после добавления новой записи для `Products` таблицы, мы хотим видеть сообщение: "*ProductName* был добавлен в базу данных.» Вместо того чтобы жестко текст для этой метки на главной странице нам необходимо быть настраиваемой страницей содержимого сообщения.

Так как элемент управления Label реализуется как защищенный член переменной в главную страницу, которую он недоступен напрямую из страниц содержимого. Чтобы работать с меткой в пределах главной страницы на странице содержимого (или, фактически, любой веб-элемента управления на главной странице), нам нужно Создайте общедоступное свойство на главной странице, который предоставляет веб-элемента управления или выступает в качестве учетной записи-посредника, по которому может быть одним из его свойств  получить доступ. Добавьте следующий синтаксис для главной страницы вспомогательного класса для предоставления метки `Text` свойство:


[!code-vb[Main](interacting-with-the-master-page-from-the-content-page-vb/samples/sample6.vb)]

При добавлении новой записи `Products` таблицы из страницы содержания `RecentProducts` GridView на главной странице должен выполнять повторную привязку к его базового источника данных. Чтобы заново привязать вызов GridView его `DataBind` метод. Так как GridView на главной странице программным способом не доступно на страницы содержимого, мы необходимо создать открытый метод в главной страницы, при вызове, выполняет повторную привязку данных к GridView. Добавьте следующий метод в класс фонового кода на главной странице:


[!code-vb[Main](interacting-with-the-master-page-from-the-content-page-vb/samples/sample7.vb)]

С помощью `GridMessageText` свойство и `RefreshRecentProductsGrid` метод в месте, все страницы содержимого можно программным образом устанавливать или считывать значение `GridMessage` метки `Text` свойство или привяжите данные к `RecentProducts` GridView. Шаг 4 рассматривается доступ к открытым свойствам и методам на главной странице из страницы содержания.

> [!NOTE]
> Не забудьте пометить свойства и методы, как на главной странице `Public`. Если вы не указывают явно эти свойства и методы, как `Public`, они не будут доступны на странице содержимого.


## <a name="step-4-calling-the-master-pages-public-members-from-a-content-page"></a>Шаг 4. Вызов открытые члены на главной странице из страницы содержания

Теперь, когда главная страница имеет необходимые общие свойства и методы, мы готовы вызывать эти свойства и методы из `AddProduct.aspx` содержимого страницы. В частности, нам нужно установить на главной странице `GridMessageText` свойство и вызвать его `RefreshRecentProductsGrid` метод после добавления нового продукта к базе данных. Все данные Web элементы управления ASP.NET порождения событий непосредственно перед и после выполнения различных задач, которые упрощают для разработчиков страниц некоторого действия программный до или после задачи. Например, когда конечный пользователь нажимает кнопки "Вставить" в элементе DetailsView, на обратную передачу DetailsView вызывает его `ItemInserting` событий до начала операций по вставке. Затем он вставляет запись в базу данных. После этого вызывает DetailsView его `ItemInserted` событий. Таким образом, чтобы работать с главной страницы, после добавления нового продукта, можно создать обработчик событий для элемента DetailsView `ItemInserted` событий.

Существует два способа, которые страницу содержимого может программно взаимодействовать с главной страницей по:

- С помощью `Page.Master` свойство, которое возвращает ссылку слабо типизированной главной страницы, или
- Укажите страницы главной страницы типа или путь к файлу с помощью `@MasterType` директив; это автоматически добавляет свойства со строгой типизацией на страницу с именем `Master`.

Давайте рассмотрим оба подхода.

### <a name="using-the-loosely-typedpagemasterproperty"></a>С помощью использования слабо типизированного`Page.Master`свойство

Все веб-страницы ASP.NET должен быть производным от `Page` класс, который находится в `System.Web.UI` пространства имен. `Page` Класс включает [ `Master` свойство](https://msdn.microsoft.com/library/system.web.ui.page.master.aspx) , возвращает ссылку на главную страницу. Если страница не является главной страницы `Master` возвращает `Nothing`.

`Master` Свойство возвращает объект типа [ `MasterPage` ](https://msdn.microsoft.com/library/system.web.ui.masterpage.aspx) (также расположены в `System.Web.UI` пространства имен) которого является базовым типом, от которого наследуют все главные страницы из. Таким образом, чтобы использовать открытые свойства или методы, определенные на главной странице наш веб-сайт, необходимо привести `MasterPage` объект, возвращенный из `Master` свойство к соответствующему типу. Так как мы назвали наш файл главной страницы `Site.master`, назывался вспомогательного класса `Site`. Таким образом, следующий пример кода преобразует `Page.Master` свойства к экземпляру `Site` класса.


[!code-vb[Main](interacting-with-the-master-page-from-the-content-page-vb/samples/sample8.vb)]

Теперь у нас приведено слабо типизированной `Page.Master` свойство типу узла мы можем ссылаться на свойства и методы, определенные для сайта. Как показано на рис. 7, открытое свойство `GridMessageText` отображается в раскрывающемся списке IntelliSense.


[![IntelliSense отображает открытые свойства и методы нашей главной страницы](interacting-with-the-master-page-from-the-content-page-vb/_static/image20.png)](interacting-with-the-master-page-from-the-content-page-vb/_static/image19.png)

**07 рис**: IntelliSense отображает открытые свойства и методы нашей главной страницы ([Просмотр полноразмерного изображения](interacting-with-the-master-page-from-the-content-page-vb/_static/image21.png))


> [!NOTE]
> Если ваш файл главной страницы `MasterPage.master` , а затем — имя класса фонового кода на главной странице `MasterPage`. Это может привести к неоднозначным кода при приведении типа `System.Web.UI.MasterPage` для вашей `MasterPage` класса. Иными словами необходимо полностью определить тип, к которому выполняется приведение, который может быть немного сложным, при использовании модели проекта веб-сайта. Я предлагаю было бы либо убедитесь, что при создании главной странице имя, что-то отличное от `MasterPage.master` или, более того, создайте строго типизированную ссылку на главную страницу.


### <a name="creating-a-strongly-typed-reference-with-themastertypedirective"></a>Создание строго типизированную ссылку с`@MasterType`директива

При ближайшем рассмотрении вы увидите, что вспомогательном классе страницы ASP.NET — это разделяемый класс (Примечание `Partial` ключевое слово в определении класса). Разделяемые классы были введены в C# и Visual Basic, построенной при помощи.NET Framework 2.0 и, по сути, разрешить для членов класса должна определяться по нескольким файлам. Файл кода класса - `AddProduct.aspx.vb`, например - содержит код, который мы разработчика страницы создания. Помимо наш код механизм ASP.NET автоматически создает отдельный файл класса с помощью свойства и обработчики событий, в который преобразования декларативную разметку в иерархию классов страницы.

Автоматическое создание кода, возникающее при каждом посещении страницы ASP.NET, дает реальную возможность некоторые довольно интересные и полезные возможности. В случае главных страниц, если мы скажем ядро ASP.NET, страницу содержимого, используемого главную страницу для он создает строго типизированный `Master` свойство для нас.

Используйте [ `@MasterType` директива](https://msdn.microsoft.com/library/ms228274.aspx) для информирования ядро ASP.NET типа страницы содержимого главной страницы. `@MasterType` Директива может принимать либо имя типа для главной страницы или его путь к файлу. Чтобы указать, что `AddProduct.aspx` странице использует `Site.master` как его Главная страница, добавьте следующую директиву в начало `AddProduct.aspx`:


[!code-aspx[Main](interacting-with-the-master-page-from-the-content-page-vb/samples/sample9.aspx)]

Эта директива предписывает механизм ASP.NET, чтобы добавить строго типизированную ссылку на главную страницу через свойство с именем `Master`. С помощью `@MasterType` директив на месте, мы можем вызвать `Site.master` главный открытые свойства и методы, которые напрямую с помощью страницы `Master` свойство без любой приведения.

> [!NOTE]
> Если опустить `@MasterType` директива, синтаксис `Page.Master` и `Master` возвращать то же самое: нестрого типизированного объекта для главной страницы. При включении `@MasterType` директива затем `Master` возвращает строго типизированную ссылку на указанный главную страницу. `Page.Master`, однако по-прежнему возвращает слабо типизированную ссылку. Более глубокое рассмотрение почему это происходит и как `Master` создается свойство при `@MasterType` директива включен, см. в разделе [к. Скотт Аллен](http://odetocode.com/blogs/scott/default.aspx)на запись в блоге [ `@MasterType` в ASP.NET 2.0](http://odetocode.com/Blogs/scott/archive/2005/07/16/1944.aspx).


### <a name="updating-the-master-page-after-adding-a-new-product"></a>Обновление главной страницы после добавления нового продукта

Теперь, когда мы знаем, как вызывать открытые свойства и методы из страницы содержания главной страницы, мы готовы обновить `AddProduct.aspx` странице, чтобы главная страница обновляется после добавления нового продукта. В начале шага 4 мы создали обработчик событий для элемента управления DetailsView `ItemInserting` событие, которое выполняется сразу после добавления нового продукта к базе данных. Добавьте следующий код к обработчику событий:


[!code-vb[Main](interacting-with-the-master-page-from-the-content-page-vb/samples/sample10.vb)]

Приведенный выше код используется обоих слабо типизированный `Page.Master` свойство и строго типизированный `Master` свойство. Обратите внимание, что `GridMessageText` свойство имеет значение "*ProductName* сетке...» Значения только что добавленные продукта доступны через `e.Values` коллекции; как вы видите, только что добавленные `ProductName` значение осуществляется через `e.Values("ProductName")`.

На рисунке 8 показана `AddProduct.aspx` страницу сразу же после - Скотта Soda - новый продукт был добавлен в базу данных. Обратите внимание, что имя только что добавленные продукта указан в главной страницы метки и что GridView был обновлен для включения и его цену продукта.


[![Метки и GridView на главной странице отображаются только что добавленные продукты](interacting-with-the-master-page-from-the-content-page-vb/_static/image23.png)](interacting-with-the-master-page-from-the-content-page-vb/_static/image22.png)

**Рис 08**: Метка и GridView на главной странице отображаются продукты Just-Added ([Просмотр полноразмерного изображения](interacting-with-the-master-page-from-the-content-page-vb/_static/image24.png))


## <a name="summary"></a>Сводка

В идеале главной страницы и его страниц полностью отделены друг от друга и уровень взаимодействия не требуется. Хотя главные страницы и страницы содержимого должны разрабатываться с этой целью в, существует ряд распространенных сценариев, в которых страницы содержимого должны взаимодействовать с главной страницей по. Одной из наиболее распространенных причин основано на обновление определенной части экрана главной страницы, на основе некоторые действия, который задан на странице содержимого.

Хорошей новостью является то, что относительно несложно, содержимого страницы программного взаимодействия с главной страницей по. Начните с создания открытые свойства или методы в главную страницу, инкапсулирующие функциональные возможности, который должен вызываться страницу содержимого. Затем на странице содержимого, доступ к главной страницы свойств и методов через слабо типизированные `Page.Master` свойства или используйте `@MasterType` директиву для создания строго типизированную ссылку на главную страницу.

В следующем учебном курсе мы рассмотрим, как заставить главной страницы программного взаимодействия с помощью одного из его страниц.

Счастливого вам программирования!

### <a name="further-reading"></a>Дополнительные сведения

Дополнительные сведения по темам, обсуждавшимся в этом руководстве см. в следующих ресурсах:

- [Просмотр и обновление данных в ASP.NET](http://aspnet.4guysfromrolla.com/articles/011106-1.aspx)
- [Главные страницы ASP.NET: Советы, приемы и ловушки](http://www.odetocode.com/articles/450.aspx)
- [`@MasterType` в ASP.NET 2.0](http://odetocode.com/Blogs/scott/archive/2005/07/16/1944.aspx)
- [Передача сведений об между содержимым и главные страницы](http://aspnet.4guysfromrolla.com/articles/013107-1.aspx)
- [Работа с данными в руководствах по ASP.NET](../../data-access/index.md)

### <a name="about-the-author"></a>Об авторе

[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор из нескольких книг по ASP/ASP.NET и основатель веб-узла 4GuysFromRolla.com, работает с веб-технологиями Microsoft с 1998 года. Скотт — независимый консультант, преподаватель и автор. Его последняя книга — [ *Sams Teach самостоятельно ASP.NET 3.5 за 24 часа*](https://www.amazon.com/exec/obidos/ASIN/0672329972/4guysfromrollaco). Скоттом можно связаться по адресу [ mitchell@4GuysFromRolla.com ](mailto:mitchell@4GuysFromRolla.com) или через его блог по адресу [ http://ScottOnWriting.NET ](http://scottonwriting.net/).

### <a name="special-thanks-to"></a>Особая благодарность

В этой серии руководств пособий рецензировалась многими компетентными редакторами. Основной рецензент этого учебного был Джонс (Zack Jones). Хотите поработать с моих последующих статей для MSDN? Если Да, напишите мне [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)

> [!div class="step-by-step"]
> [Назад](control-id-naming-in-content-pages-vb.md)
> [Вперед](interacting-with-the-content-page-from-the-master-page-vb.md)
