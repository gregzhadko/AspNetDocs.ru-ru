---
uid: web-forms/overview/older-versions-getting-started/master-pages/interacting-with-the-master-page-from-the-content-page-vb
title: Взаимодействие с главной страницей со страницы содержимого (VB) | Документация Майкрософт
author: rick-anderson
description: Рассматривается вызов методов, установка свойств и т. д. главной страницы из кода на странице содержимого.
ms.author: riande
ms.date: 07/11/2008
ms.assetid: 081fe010-ba0f-4e7d-b4ba-774840b601c2
msc.legacyurl: /web-forms/overview/older-versions-getting-started/master-pages/interacting-with-the-master-page-from-the-content-page-vb
msc.type: authoredcontent
ms.openlocfilehash: fe1f7b80b26ff25c1ce744e4f823e3fb35eea074
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78441198"
---
# <a name="interacting-with-the-master-page-from-the-content-page-vb"></a>Взаимодействие с эталонной страницей на странице содержимого (VB)

по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Скачать код](https://download.microsoft.com/download/1/8/4/184e24fa-fcc8-47fa-ac99-4b6a52d41e97/ASPNET_MasterPages_Tutorial_06_VB.zip) или [скачать PDF](https://download.microsoft.com/download/e/b/4/eb4abb10-c416-4ba4-9899-32577715b1bd/ASPNET_MasterPages_Tutorial_06_VB.pdf)

> Рассматривается вызов методов, установка свойств и т. д. главной страницы из кода на странице содержимого.

## <a name="introduction"></a>Введение

За прошедшее пять учебных курсов мы рассматривали создание главной страницы, определение областей содержимого, привязку страниц ASP.NET к главной странице и определение содержимого, относящегося к странице. Когда посетитель запрашивает определенную страницу содержимого, Разметка содержимого и главных страниц подписывается с помощью предохранителя во время выполнения, что приводит к отрисовке унифицированной иерархии элементов управления. Поэтому мы уже видели один из способов взаимодействия главной страницы и одной из страниц содержимого: на странице содержимого написано разметку для переворота в элементы управления ContentPlaceHolder главной страницы.

Мы еще не изучаем, как Главная страница и страница содержимого могут взаимодействовать программно. Помимо определения разметки для элементов управления ContentPlaceHolder главной страницы, страница содержимого также может назначать значения общедоступным свойствам главной страницы и вызывать ее открытые методы. Аналогичным образом Главная страница может взаимодействовать со страницами содержимого. Хотя программное взаимодействие между главной и страницей содержимого менее распространено, чем взаимодействие между их декларативными разметками, существует множество сценариев, в которых требуется такое программное взаимодействие.

В этом учебнике мы рассмотрим, как страница содержимого может программно взаимодействовать со своей главной страницей. в следующем руководстве мы рассмотрим, как Главная страница может взаимодействовать со страницами содержимого.

## <a name="examples-of-programmatic-interaction-between-a-content-page-and-its-master-page"></a>Примеры программного взаимодействия между страницей содержимого и ее главной страницей

Если определенный регион страницы необходимо настроить отдельно для каждой страницы, мы используем элемент управления ContentPlaceHolder. Но как насчет ситуаций, когда большинству страниц требуется выводить определенные выходные данные, но небольшое количество страниц необходимо настроить для отображения чего-то другого? Одним из примеров, которые мы рассматривали в руководстве по использованию [*нескольких элементов управления ContentPlaceHolder и содержимого по умолчанию*](multiple-contentplaceholders-and-default-content-vb.md) , является отображение интерфейса входа на каждой странице. Хотя большинство страниц должны включать интерфейс входа в систему, его следует подавлять для нескольких страниц, например: главной страницы входа (`Login.aspx`); Страница создания учетной записи; и другие страницы, доступные только пользователям, прошедшим проверку подлинности. В учебнике [*несколько элементов управления ContentPlaceHolder и содержимого по умолчанию*](multiple-contentplaceholders-and-default-content-vb.md) было показано, как определить содержимое по умолчанию для ContentPlaceHolder на главной странице, а затем переопределить его на страницах, где не требовалось содержимое по умолчанию.

Другой вариант — создать открытое свойство или метод на главной странице, который указывает, следует ли отображать или скрывать интерфейс входа. Например, на главной странице может содержаться открытое свойство с именем `ShowLoginUI`, значение которого было использовано для задания `Visible` свойства элемента управления Login на главной странице. Эти страницы содержимого, на которых должен быть подавлен пользовательский интерфейс входа, могут затем программно задать для свойства `ShowLoginUI` значение `False`.

Возможно, наиболее распространенный пример взаимодействия с содержимым и главной страницей происходит, когда данные, отображаемые на главной странице, необходимо обновить после выполнения некоторых действий на странице содержимого. Рассмотрим главную страницу, которая содержит GridView, в котором отображаются пять последних добавленных записей из определенной таблицы базы данных, а одна из ее страниц содержимого включает интерфейс для добавления новых записей в ту же таблицу.

Когда пользователь посещает страницу для добавления новой записи, он видит пять последних добавленных записей, отображаемых на главной странице. После заполнения значений для столбцов новой записи она отправляет форму. Предполагая, что элемент управления GridView на главной странице имеет свойство `EnableViewState`, для которого установлено значение true (значение по умолчанию), его содержимое перегружается из состояния представления и, следовательно, отображаются пять записей, даже если новая запись была только что добавлена в базу данных. Это может запутать пользователя.

> [!NOTE]
> Даже если вы отключаете состояние представления GridView для повторной привязки к базовому источнику данных при каждой обратной передаче, он по-прежнему не будет показывать только что добавленную запись, так как данные привязаны к GridView ранее в жизненном цикле страницы, чем при добавлении новой записи в датаб ASE.

Чтобы устранить эту проблему, чтобы только что добавленная запись отображалась в элементе управления GridView на главной странице при обратной передаче, необходимо указать GridView выполнить повторную привязку к своему источнику данных *после* добавления новой записи в базу данных. Для этого требуется взаимодействие между страницами содержимого и главных страниц, так как интерфейс для добавления новой записи (и ее обработчики событий) находится на странице содержимого, но элемент управления GridView, который необходимо обновить, находится на главной странице.

Так как обновление отображения главной страницы с помощью обработчика событий на странице содержимого является одной из наиболее распространенных потребностей при взаимодействии содержимого и главной страницы, давайте подробно рассмотрим этот раздел. Загружаемый файл для этого учебника включает базу данных Microsoft SQL Server 2005 Express Edition с именем `NORTHWIND.MDF` в папке `App_Data` веб-сайта. База данных Northwind хранит сведения о продуктах, сотрудниках и продажах для вымышленной компании Northwind Traders.

Шаг 1 демонстрирует отображение пяти последних добавленных продуктов в элементе управления GridView на главной странице. На шаге 2 создается страница содержимого для добавления новых продуктов. На шаге 3 рассматривается создание общедоступных свойств и методов на главной странице, а на шаге 4 показано, как программным способом взаимодействовать с этими свойствами и методами со страницы содержимого.

> [!NOTE]
> В этом учебнике не рассматриваются особенности работы с данными в ASP.NET. Действия по настройке главной страницы для вывода данных и страницы содержимого для вставки данных завершены, но Бризи. Более подробные сведения о отображении и вставке данных, а также об использовании элементов управления SqlDataSource и GridView см. в разделе Дополнительные материалы в конце этого руководства.

## <a name="step-1-displaying-the-five-most-recently-added-products-in-the-master-page"></a>Шаг 1. Отображение пяти последних добавленных продуктов на главной странице

Откройте главную страницу site. master и добавьте в `<div>``leftContent` элемент управления Label и GridView. Удалите свойство `Text` метки, присвойте свойству `EnableViewState` значение `False`, а свойству `ID` — значение `GridMessage`; Задайте для свойства `ID` GridView значение `RecentProducts`. Затем в конструкторе разверните смарт-тег GridView и выберите привязать его к новому источнику данных. Запустится мастер настройки источника данных. Поскольку база данных Northwind в папке `App_Data` является Microsoft SQL Server базой данных, выберите Создание SqlDataSource, выбрав (см. рис. 1); Присвойте `RecentProductsDataSource`у SqlDataSource имя.

[![привязать GridView к элементу управления SqlDataSource с именем Рецентпродуктсдатасаурце](interacting-with-the-master-page-from-the-content-page-vb/_static/image2.png)](interacting-with-the-master-page-from-the-content-page-vb/_static/image1.png)

**Рис. 01**. Привязка GridView к элементу управления SqlDataSource с именем `RecentProductsDataSource` ([щелкните, чтобы просмотреть изображение с полным размером](interacting-with-the-master-page-from-the-content-page-vb/_static/image3.png))

На следующем шаге мы предложим указать базу данных для подключения. Выберите файл базы данных `NORTHWIND.MDF` из раскрывающегося списка и нажмите кнопку Далее. Так как эта база данных используется впервые, мастер предложит сохранить строку подключения в `Web.config`. Сохраните строку подключения, используя имя `NorthwindConnectionString`.

[![подключиться к базе данных Northwind](interacting-with-the-master-page-from-the-content-page-vb/_static/image5.png)](interacting-with-the-master-page-from-the-content-page-vb/_static/image4.png)

**Рис. 02**. подключение к базе данных Northwind ([щелкните, чтобы просмотреть изображение с полным размером](interacting-with-the-master-page-from-the-content-page-vb/_static/image6.png))

Мастер настройки источников данных предоставляет два средства, с помощью которых можно указать запрос, используемый для получения данных:

- Указав пользовательскую инструкцию SQL или хранимую процедуру или
- Путем выбора таблицы или представления и указания возвращаемых столбцов

Поскольку нам нужно вернуть только пять последних добавленных продуктов, необходимо указать пользовательскую инструкцию SQL. Используйте следующий `SELECT` запрос:

[!code-sql[Main](interacting-with-the-master-page-from-the-content-page-vb/samples/sample1.sql)]

Ключевое слово `TOP 5` возвращает только первые пять записей из запроса. Первичный ключ таблицы `Products`, `ProductID`, является столбцом `IDENTITY`, что гарантирует, что каждый новый продукт, добавляемый в таблицу, будет иметь большее значение, чем предыдущая. Таким образом, сортировка результатов по `ProductID` в убывающем порядке возвращает продукты, начиная с последних созданных.

[![возвратить пять последних добавленных продуктов](interacting-with-the-master-page-from-the-content-page-vb/_static/image8.png)](interacting-with-the-master-page-from-the-content-page-vb/_static/image7.png)

**Рис. 03**. Возврат пяти последних добавленных продуктов ([щелкните, чтобы просмотреть изображение с полным размером](interacting-with-the-master-page-from-the-content-page-vb/_static/image9.png))

После завершения работы мастера Visual Studio создает две BoundFields для элемента GridView, чтобы отобразить `ProductName` и `UnitPrice` поля, возвращаемые из базы данных. На этом этапе декларативная разметка главной страницы должна содержать разметку, подобную следующей:

[!code-aspx[Main](interacting-with-the-master-page-from-the-content-page-vb/samples/sample2.aspx)]

Как видите, разметка содержит: Web Control Label (`GridMessage`); `RecentProducts`GridView с двумя BoundFields; и элемент управления SqlDataSource, который возвращает пять последних добавленных продуктов.

После создания этого GridView и настройки элемента управления SqlDataSource перейдите на веб-сайт через браузер. Как показано на рис. 4, вы увидите сетку в левом нижнем углу, в которой перечислены пять последних добавленных продуктов.

[![GridView отображает пять последних добавленных продуктов.](interacting-with-the-master-page-from-the-content-page-vb/_static/image11.png)](interacting-with-the-master-page-from-the-content-page-vb/_static/image10.png)

**Рис. 04**. Отображение пяти последних добавленных продуктов ([щелкните, чтобы просмотреть изображение с полным размером](interacting-with-the-master-page-from-the-content-page-vb/_static/image12.png))

> [!NOTE]
> Вы можете очистить внешний вид GridView. Некоторые рекомендации включают форматирование отображаемого `UnitPrice` значения в виде денежной единицы и использование цветов фона и шрифтов для улучшения внешнего вида сетки.

## <a name="step-2-creating-a-content-page-to-add-new-products"></a>Шаг 2. Создание страницы содержимого для добавления новых продуктов

Следующая задача — создать страницу содержимого, из которой пользователь может добавить новый продукт в `Products` таблицу. Добавьте новую страницу содержимого в папку `Admin` с именем `AddProduct.aspx`, чтобы привязать ее к главной странице `Site.master`. На рис. 5 показана обозреватель решений после добавления этой страницы на веб-сайт.

[![добавить новую страницу ASP.NET в папку Admin](interacting-with-the-master-page-from-the-content-page-vb/_static/image14.png)](interacting-with-the-master-page-from-the-content-page-vb/_static/image13.png)

**Рис. 05**. Добавление новой страницы ASP.NET в папку `Admin` ([щелкните, чтобы просмотреть изображение с полным размером](interacting-with-the-master-page-from-the-content-page-vb/_static/image15.png))

Помните, что в разделе [*Указание заголовка, Meta-тегов и других заголовков HTML в учебнике по главной странице*](specifying-the-title-meta-tags-and-other-html-headers-in-the-master-page-vb.md) мы создали пользовательский класс базовой страницы с именем `BasePage`, который создал заголовок страницы, если он не был явно задан. Перейдите к классу кода программной части `AddProduct.aspx` страницы и получите производный от `BasePage` (а не `System.Web.UI.Page`).

Наконец, обновите файл `Web.sitemap`, включив в него запись для этого занятия. Добавьте следующую разметку под `<siteMapNode>` для урока "проблемы именования ИДЕНТИФИКАТОРов элементов управления":

[!code-xml[Main](interacting-with-the-master-page-from-the-content-page-vb/samples/sample3.xml)]

Как показано на рис. 6, добавление этого элемента `<siteMapNode>` отражается в списке «уроки».

Вернитесь к `AddProduct.aspx`. В элементе управления содержимым для `MainContent` ContentPlaceHolder добавьте элемент управления DetailsView и присвойте ему имя `NewProduct`. Привяжите DetailsView к новому элементу управления SqlDataSource с именем `NewProductDataSource`. Как и в случае с SqlDataSource на шаге 1, Настройте мастер так, чтобы он использовал базу данных Northwind, и укажите пользовательскую инструкцию SQL. Поскольку элемент DetailsView будет использоваться для добавления элементов в базу данных, необходимо указать как инструкцию `SELECT`, так и инструкцию `INSERT`. Используйте следующий `SELECT` запрос:

[!code-sql[Main](interacting-with-the-master-page-from-the-content-page-vb/samples/sample4.sql)]

Затем на вкладке Вставка добавьте следующую инструкцию `INSERT`:

[!code-sql[Main](interacting-with-the-master-page-from-the-content-page-vb/samples/sample5.sql)]

После завершения работы мастера перейдите к смарт-тегу DetailsView и установите флажок "включить вставку". При этом в элемент DetailsView добавляется CommandField со свойством `ShowInsertButton`, установленным в значение true. Так как эта DetailsView будет использоваться исключительно для вставки данных, установите для свойства `DefaultMode` элемента DetailsView значение `Insert`.

Это все. Давайте протестируем эту страницу. Перейдите `AddProduct.aspx` через браузер, введите имя и цену (см. рис. 6).

[![добавить новый продукт в базу данных](interacting-with-the-master-page-from-the-content-page-vb/_static/image17.png)](interacting-with-the-master-page-from-the-content-page-vb/_static/image16.png)

**Рис. 6**. Добавление нового продукта в базу данных ([щелкните, чтобы просмотреть изображение с полным размером](interacting-with-the-master-page-from-the-content-page-vb/_static/image18.png))

После ввода имени и цены нового продукта нажмите кнопку Вставить. В результате форма передается обратной передаче. При обратной передаче выполняется инструкция `INSERT` элемента управления SqlDataSource. два параметра заполняются значениями, вводимых пользователем в двух элементах TextBox элемента управления DetailsView. К сожалению, нет визуальной обратной связи о том, что произошла Вставка. Было бы неплохо отображать сообщение, подтверждая Добавление новой записи. Я оставлю это в качестве упражнения для читателя. Кроме того, после добавления новой записи из элемента управления DetailsView в элементе управления GridView на главной странице по-прежнему отображаются те же пять записей, что и раньше. она не включает только что добавленную запись. Мы рассмотрим, как устранить эту проблему на следующих шагах.

> [!NOTE]
> Помимо добавления некоторой формы визуального отзыва о том, что вставка прошла успешно, я рекомендую также обновить интерфейс вставки DetailsView, чтобы включить проверку. В настоящее время проверка не выполняется. Если пользователь вводит недопустимое значение для поля `UnitPrice`, например "слишком дорого", при обратной передаче будет создано исключение, когда система попытается преобразовать эту строку в десятичный. Дополнительные сведения о настройке интерфейса вставки см. в руководстве по [ *настройке интерфейса изменения данных* ](https://asp.net/learn/data-access/tutorial-20-vb.aspx) из [статьи учебник по работе с данными](../../data-access/index.md).

## <a name="step-3-creating-public-properties-and-methods-in-the-master-page"></a>Шаг 3. Создание общедоступных свойств и методов на главной странице

На шаге 1 мы добавили веб-элемент управления Label с именем `GridMessage` над GridView на главной странице. Эта метка предназначена для необязательного вывода сообщения. Например, после добавления новой записи в таблицу `Products` может потребоваться отобразить сообщение с текстом "*ProductName* Добавлено в базу данных". Вместо того чтобы жестко кодировать текст для этой метки на главной странице, может потребоваться настроить сообщение на странице содержимого.

Поскольку элемент управления "метка" реализуется как защищенная переменная-член на главной странице, доступ к которой невозможен непосредственно из страниц содержимого. Для работы с меткой в главной странице со страницы содержимого (или для любого веб-элемента управления на главной странице) необходимо создать открытое свойство на главной странице, предоставляющее веб-элемент управления, или в качестве прокси, с помощью которого можно получить одно из его свойств.  обращения. Добавьте следующий синтаксис в класс кода программной части главной страницы, чтобы предоставить свойство `Text` Метки:

[!code-vb[Main](interacting-with-the-master-page-from-the-content-page-vb/samples/sample6.vb)]

При добавлении новой записи в таблицу `Products` из страницы содержимого `RecentProducts` GridView на главной странице необходимо повторно привязать к базовому источнику данных. Чтобы повторно привязать GridView, нужно вызвать его метод `DataBind`. Поскольку элемент управления GridView на главной странице не доступен для страниц содержимого программным способом, необходимо создать открытый метод на главной странице, который при вызове повторно привязывает данные к GridView. Добавьте следующий метод в класс кода программной части главной страницы:

[!code-vb[Main](interacting-with-the-master-page-from-the-content-page-vb/samples/sample7.vb)]

С помощью свойства `GridMessageText` и `RefreshRecentProductsGrid` метода любая страница содержимого может программно задавать или считывать значение свойства `Text` метки `GridMessage` или повторно привязывать данные к `RecentProducts` GridView. На шаге 4 рассматривается доступ к общим свойствам и методам главной страницы со страницы содержимого.

> [!NOTE]
> Не забудьте пометить свойства и методы главной страницы как `Public`. Если не указать явно эти свойства и методы как `Public`, они будут недоступны со страницы содержимого.

## <a name="step-4-calling-the-master-pages-public-members-from-a-content-page"></a>Шаг 4. вызов открытых членов главной страницы из страницы содержимого

Теперь, когда на главной странице имеются необходимые открытые свойства и методы, мы готовы к вызову этих свойств и методов со страницы содержимого `AddProduct.aspx`. В частности, необходимо задать свойство `GridMessageText` главной страницы и вызвать его метод `RefreshRecentProductsGrid` после добавления нового продукта в базу данных. Все веб-элементы управления данными ASP.NET срабатывают события непосредственно до и после выполнения различных задач, что упрощает разработчикам страниц выполнение некоторых программных действий до или после выполнения задачи. Например, когда пользователь нажимает кнопку вставки DetailsView, при обратной передаче DetailsView создает событие `ItemInserting` перед началом процесса вставки. Затем она вставляет запись в базу данных. После этого DetailsView создает событие `ItemInserted`. Поэтому, чтобы работать с главной страницей после добавления нового продукта, создайте обработчик событий для события `ItemInserted` DetailsView.

Страница содержимого может программно взаимодействовать с главной страницей двумя способами.

- С помощью свойства `Page.Master`, которое возвращает слабо типизированную ссылку на главную страницу или
- Укажите тип главной страницы страницы или путь к файлу с помощью директивы `@MasterType`; Это автоматически добавит строго типизированное свойство к странице с именем `Master`.

Давайте рассмотрим оба подхода.

### <a name="using-the-loosely-typedpagemasterproperty"></a>Использование слабо типизированного свойства`Page.Master`

Все веб-страницы ASP.NET должны быть производными от класса `Page`, который находится в пространстве имен `System.Web.UI`. Класс `Page` включает [свойство`Master`](https://msdn.microsoft.com/library/system.web.ui.page.master.aspx) , которое возвращает ссылку на главную страницу страницы. Если на странице нет главной страницы, `Master` возвращает `Nothing`.

Свойство `Master` возвращает объект типа [`MasterPage`](https://msdn.microsoft.com/library/system.web.ui.masterpage.aspx) (также расположенный в пространстве имен `System.Web.UI`), который является базовым типом, от которого наследуются все главные страницы. Таким образом, чтобы использовать общие свойства или методы, определенные на главной странице веб-сайта, необходимо привести `MasterPage`ный объект, возвращаемый свойством `Master`, к соответствующему типу. Так как мы назвали наш файл главной страницы `Site.master`, класс кода программной части имел имя `Site`. Таким образом, следующий код приводит свойство `Page.Master` к экземпляру класса `Site`.

[!code-vb[Main](interacting-with-the-master-page-from-the-content-page-vb/samples/sample8.vb)]

Теперь, после приведения слабо типизированного свойства `Page.Master` к типу сайта, мы можем ссылаться на свойства и методы, относящиеся к сайту. Как показано на рис. 7, свойство public `GridMessageText` отображается в раскрывающемся списке IntelliSense.

[![IntelliSense отображает общие свойства и методы главной страницы](interacting-with-the-master-page-from-the-content-page-vb/_static/image20.png)](interacting-with-the-master-page-from-the-content-page-vb/_static/image19.png)

**Рис. 07**. IntelliSense отображает общие свойства и методы главной страницы ([щелкните, чтобы просмотреть изображение с полным размером](interacting-with-the-master-page-from-the-content-page-vb/_static/image21.png))

> [!NOTE]
> Если вы назвали файл главной страницы `MasterPage.master` то имя класса кода программной части главной страницы будет `MasterPage`. Это может привести к неоднозначному коду при приведении типа `System.Web.UI.MasterPage` к классу `MasterPage`. Вкратце, необходимо полностью определить тип, к которому выполняется приведение, что может быть немного сложным при использовании модели проекта веб-сайта. Мне пришлось бы убедиться, что при создании главной страницы вы назначите ей имя, отличное от `MasterPage.master` или, еще лучше создать строго типизированную ссылку на главную страницу.

### <a name="creating-a-strongly-typed-reference-with-themastertypedirective"></a>Создание строго типизированной ссылки с помощью директивы`@MasterType`

Если увидеть, что класс кода программной части страницы ASP.NET является разделяемым классом (Обратите внимание на ключевое слово `Partial` в определении класса). Разделяемые классы появились в C# и Visual Basic with.NET Framework 2,0 и, в двух словах, позволяют определять члены класса в нескольких файлах. Пример файла класса кода программной части — `AddProduct.aspx.vb`, например, содержит код, который разработчик страницы создает. Помимо нашего кода, ядро ASP.NET автоматически создает отдельный файл класса со свойствами и обработчиками событий в, который преобразует декларативную разметку в иерархию классов страницы.

Автоматическое создание кода, возникающее при каждом посещении страницы ASP.NET, создает условия для некоторых довольно интересных и полезных возможностей. В случае с главными страницами, если мы говорим ASP.NET Engine, какая Главная страница используется нашей страницей содержимого, она создает строго типизированное свойство `Master` для нас.

Используйте [директиву`@MasterType`](https://msdn.microsoft.com/library/ms228274.aspx) , чтобы сообщить подсистеме ASP.NET типа главной страницы страницы содержимого. Директива `@MasterType` может принимать либо имя типа главной страницы, либо ее путь к файлу. Чтобы указать, что страница `AddProduct.aspx` использует `Site.master` в качестве главной страницы, добавьте следующую директиву в начало `AddProduct.aspx`:

[!code-aspx[Main](interacting-with-the-master-page-from-the-content-page-vb/samples/sample9.aspx)]

Эта директива указывает обработчику ASP.NET добавить строго типизированную ссылку на главную страницу через свойство с именем `Master`. С помощью директивы `@MasterType` можно вызвать открытые свойства и методы `Site.master` главной страницы напрямую через свойство `Master` без приведения.

> [!NOTE]
> Если опустить директиву `@MasterType`, синтаксис `Page.Master` и `Master` возвращают одно и то же действие: слабо типизированный объект на главную страницу страницы. Если включить директиву `@MasterType`, `Master` возвращает строго типизированную ссылку на указанную главную страницу. Однако `Page.Master`по-прежнему возвращает слабо типизированную ссылку. Более подробные сведения о том, почему это так, а также о том, как будет создаваться свойство `Master` при включении директивы `@MasterType`, см. в записи блога [K. Скотт аллен](http://odetocode.com/blogs/scott/default.aspx) [`@MasterType` в ASP.NET 2,0](http://odetocode.com/Blogs/scott/archive/2005/07/16/1944.aspx).

### <a name="updating-the-master-page-after-adding-a-new-product"></a>Обновление главной страницы после добавления нового продукта

Теперь, когда известно, как вызывать общие свойства и методы главной страницы из страницы содержимого, мы готовы обновить страницу `AddProduct.aspx`, чтобы обновление главной страницы было выполнено после добавления нового продукта. В начале шага 4 мы создали обработчик для события `ItemInserting` элемента управления DetailsView, которое выполняется сразу после добавления нового продукта в базу данных. Добавьте следующий код в этот обработчик событий:

[!code-vb[Main](interacting-with-the-master-page-from-the-content-page-vb/samples/sample10.vb)]

Приведенный выше код использует как слабо типизированное свойство `Page.Master`, так и свойство `Master` со строгой типизацией. Обратите внимание, что для свойства `GridMessageText` задано значение "*ProductName* Добавлено в Grid...". Значения только что добавленного продукта доступны через коллекцию `e.Values`; Как видите, доступ к только что добавленному `ProductName` значение осуществляется через `e.Values("ProductName")`.

На рис. 8 показана страница `AddProduct.aspx` сразу после добавления нового продукта Скотта Soda — в базу данных. Обратите внимание, что только что добавленное название продукта указано в метке главной страницы, а элемент управления GridView обновлен для включения продукта и его цены.

[![метку главной страницы и GridView показывать только что добавленный продукт](interacting-with-the-master-page-from-the-content-page-vb/_static/image23.png)](interacting-with-the-master-page-from-the-content-page-vb/_static/image22.png)

**Рис. 08**. метка главной страницы и GridView Показать только что добавленный продукт ([щелкните, чтобы просмотреть изображение с полным размером](interacting-with-the-master-page-from-the-content-page-vb/_static/image24.png))

## <a name="summary"></a>Сводка

В идеале Главная страница и ее страницы содержимого полностью отделены друг от друга и не нуждаются в каком-либо уровне взаимодействия. Хотя главные страницы и страницы содержимого должны быть спроектированы с учетом этой цели, существует ряд распространенных сценариев, в которых страница содержимого должна взаимодействовать с главной страницей. Одна из наиболее распространенных причин — обновление определенной части главной страницы на основе некоторых действий, которые производятся на странице содержимого.

Хорошая новость заключается в том, что страница содержимого по-своему относительно проста в программной взаимодействии со своей главной страницей. Начните с создания общих свойств или методов на главной странице, которые инкапсулируют функциональные возможности, которые должны вызываться страницей содержимого. Затем на странице содержимое получите доступ к свойствам и методам главной страницы через слабо типизированное свойство `Page.Master` или используйте директиву `@MasterType` для создания строго типизированной ссылки на главную страницу.

В следующем учебном курсе рассматривается, как настроить главную страницу программным способом для взаимодействия с одной из страниц содержимого.

Поздравляем с программированием!

### <a name="further-reading"></a>Дополнительные материалы

Дополнительные сведения о разделах, обсуждаемых в этом руководстве, см. в следующих ресурсах:

- [Доступ к данным и их обновление в ASP.NET](http://aspnet.4guysfromrolla.com/articles/011106-1.aspx)
- [ASP.NET главные страницы: советы, приемы и ловушки](http://www.odetocode.com/articles/450.aspx)
- [`@MasterType` в ASP.NET 2,0](http://odetocode.com/Blogs/scott/archive/2005/07/16/1944.aspx)
- [Передача данных между содержимым и главными страницами](http://aspnet.4guysfromrolla.com/articles/013107-1.aspx)
- [Работа с данными в учебниках по ASP.NET](../../data-access/index.md)

### <a name="about-the-author"></a>Об авторе

[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор нескольких книг по ASP/ASP. NET и основатель 4GuysFromRolla.com, работал с веб-технологиями майкрософт с 1998. Скотт работает как независимый консультант, преподаватель и модуль записи. Его последняя книга — [*Sams обучать себя ASP.NET 3,5 за 24 часа*](https://www.amazon.com/exec/obidos/ASIN/0672329972/4guysfromrollaco). Скотт можно получить по адресу [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com) или через свой блог по адресу [http://ScottOnWriting.NET](http://scottonwriting.net/).

### <a name="special-thanks-to"></a>Специальная благодарность

Эта серия руководств была рассмотрена многими полезными рецензентами. Специалистом по интересу для этого учебника был Зак Джонс. Хотите ознакомиться с моими будущими статьями MSDN? Если да, расположите строку в [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)

> [!div class="step-by-step"]
> [Назад](control-id-naming-in-content-pages-vb.md)
> [Вперед](interacting-with-the-content-page-from-the-master-page-vb.md)
