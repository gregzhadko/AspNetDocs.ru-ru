---
uid: web-forms/overview/older-versions-getting-started/tailspin-spyworks/tailspin-spyworks-part-5
title: Часть 5. Бизнес-логику | Документация Майкрософт
author: JoeStagner
description: В этой серии руководств описаны все действия, предпринимаемые для создайте пример приложения Tailspin Spyworks. Часть 5 добавляет некоторые бизнес-логики.
ms.author: riande
ms.date: 07/21/2010
ms.assetid: eaef475a-ca91-47ea-a4a7-d074005ed80c
msc.legacyurl: /web-forms/overview/older-versions-getting-started/tailspin-spyworks/tailspin-spyworks-part-5
msc.type: authoredcontent
ms.openlocfilehash: cf2cee3888228069e59e9e44ffc2bc56fbba10e3
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59415665"
---
# <a name="part-5-business-logic"></a>Часть 5. Бизнес-логика

по [(Joe Stagner)](https://github.com/JoeStagner)

> Tailspin Spyworks демонстрирует, как чрезвычайно прост процесс создания мощных и масштабируемых приложений для платформы .NET. Он демонстрирует способы использования новые возможности в ASP.NET 4 для создание Интернет-магазина, включая покупок, извлечения и администрирования.
> 
> В этой серии руководств описаны все действия, предпринимаемые для создайте пример приложения Tailspin Spyworks. Часть 5 добавляет некоторые бизнес-логики.


## <a id="_Toc260221671"></a>  Добавление некоторых бизнес-логики

Мы хотим опыт покупок были доступны при посещении веб-узла. Посетители смогут просматривать и добавлять товары в корзину покупок, даже если они не зарегистрированы или не вошел в систему. Когда они готовы для извлечения будет предоставляться возможность проверки подлинности, и если они не еще элементов они будут иметь возможность создать учетную запись.

Это означает, что нам потребуется реализовать логику для преобразования в корзину для покупок из анонимного состояния в состояние «Зарегистрированный пользователь».

Давайте создайте каталог с именем «Классы» а затем правой кнопкой мыши папку и создайте новый файл «Class» MyShoppingCart.cs

![](tailspin-spyworks-part-5/_static/image1.jpg)

![](tailspin-spyworks-part-5/_static/image1.png)

Как уже говорилось выше, мы улучшим класс, реализующий MyShoppingCart.aspx страницы, и мы сделаем это с помощью. Конструкция мощные «разделяемый класс» NET.

Созданный вызов для нашего файла MyShoppingCart.aspx.cf выглядит следующим образом.

[!code-csharp[Main](tailspin-spyworks-part-5/samples/sample1.cs)]

Обратите внимание на использование ключевого слова «partial».

Файл класса, который мы только что созданную выглядит следующим образом.

[!code-csharp[Main](tailspin-spyworks-part-5/samples/sample2.cs)]

Мы объединим наши реализации, добавив к этому файлу, а также ключевое слово partial.

Наш новый файл класса теперь выглядит следующим образом.

[!code-csharp[Main](tailspin-spyworks-part-5/samples/sample3.cs)]

Первый метод, который мы добавим к нашему классу способ «AddItem». Это метод, который в конечном счете будет вызываться при нажатии пользователем ссылки «Добавить к Art» на страницах список продуктов и сведения о продукте.

Добавьте следующее содержимое с помощью инструкций в верхней части страницы.

[!code-csharp[Main](tailspin-spyworks-part-5/samples/sample4.cs)]

И добавьте следующий метод к классу MyShoppingCart.

[!code-csharp[Main](tailspin-spyworks-part-5/samples/sample5.cs)]

Мы используем LINQ to Entities, чтобы увидеть, если элемент уже существует в корзине. Если таким образом, мы изменим порядок количество товара, в противном случае мы создадим новую запись для выбранного элемента

Для вызова этого метода мы реализуем страницу AddToCart.aspx, который не только этот метод класса, но затем отображается текущий Корзина = после добавления элемента.

Щелкните правой кнопкой мыши имя решения в обозревателе решений и добавьте и новую страницу с именем AddToCart.aspx, как было показано ранее.

Для отображения таких проблем низкой акций и т. д, промежуточных результатов в нашей реализации мы использовать эту страницу, страницы будет фактически не визуализации, но вместо вызывать логику «Добавить» и перенаправление.

Для этого мы добавим следующий код на страницу\_событие Load.

[!code-csharp[Main](tailspin-spyworks-part-5/samples/sample6.cs)]

Обратите внимание на то, что, получаемых продукта, чтобы добавить в корзину покупок из параметра строки запроса и вызова метода AddItem нашего класса.

При условии, что ошибки не обнаружены управление передается на страницу SHoppingCart.aspx, которая полностью мы реализуем рядом. Если следует ошибку, мы выдаем исключение.

В настоящее время мы еще не реализована глобальный обработчик ошибок, это исключение может уйти необработанным, наше приложение, но мы будет исправить это чуть позже.

Обратите внимание на использование инструкции (доступно через Debug.Fail() `using System.Diagnostics;)`

— Приложение выполняется в отладчике, этот метод отображает подробные сведения о состоянии приложений, а также сообщение об ошибке, мы указываем диалоговое окно.

При выполнении в рабочей среде Debug.Fail(), оператор игнорируется.

Можно заметить в коде выше вызов метода в именам класс корзину для покупок «GetShoppingCartId».

Добавьте код для реализации метода, как показано ниже.

Обратите внимание на то, что мы также добавили извлечения и обновления кнопки и метки, где мы можем отобразить корзины для покупок «итог».

[!code-csharp[Main](tailspin-spyworks-part-5/samples/sample7.cs)]

Теперь можно добавить элементы в нашей корзину для покупок, но мы не реализовали логику для отображения в корзину, после добавления продукта.

Таким образом на странице MyShoppingCart.aspx мы добавим элемент управления EntityDataSource и элемент управления GridVire следующим образом.

[!code-aspx[Main](tailspin-spyworks-part-5/samples/sample8.aspx)]

Вызовите форму в конструкторе, чтобы вы могли дважды нажмите кнопку Обновить корзину и создать обработчик событий click, который указан в объявлении в разметке.

Мы реализуем сведения позже, но это сообщите нам построения и запуска приложения без ошибок.

При запуске приложения и добавить элемент в корзину покупок появится следующее.

![](tailspin-spyworks-part-5/_static/image2.jpg)

Обратите внимание на то, что мы информирующим отображение сетки «default» путем реализации трех настраиваемых столбцов.

Во-первых, неизменяемое, «Привязанного» поле количества:

[!code-aspx[Main](tailspin-spyworks-part-5/samples/sample9.aspx)]

Далее приведен «вычисляемый» столбец, который отображает элемент строки общее (элемент затраты времени количества, порядка).

[!code-aspx[Main](tailspin-spyworks-part-5/samples/sample10.aspx)]

Наконец у нас есть настраиваемый столбец, содержащий элемент управления CheckBox, пользователь будет использовать для указания удаления элемента из корзины диаграммы.

[!code-aspx[Main](tailspin-spyworks-part-5/samples/sample11.aspx)]

![](tailspin-spyworks-part-5/_static/image3.jpg)

Как вы видите, порядок линия Total является пустым, так что давайте добавить логику для вычисления итог заказа.

Сначала мы реализуем метод «GetTotal», используемую для нашего класса MyShoppingCart.

В файле MyShoppingCart.cs добавьте следующий код.

[!code-csharp[Main](tailspin-spyworks-part-5/samples/sample12.cs)]

Затем на странице\_можно вызовем наш метод GetTotal, используемую обработчик события загрузки. В то же время мы добавим теста, пуста ли корзина для покупок и регулирует отображение соответствующим образом в том случае, если это.

Если корзина покупок пуста мы получаем это:

![](tailspin-spyworks-part-5/_static/image4.jpg)

И если это не так, мы видим, наши всего.

![](tailspin-spyworks-part-5/_static/image5.jpg)

Тем не менее эта страница еще не завершено.

Нам понадобится дополнительная логика повторного вычисления в корзину для покупок, удаляя элементы, помеченные для удаления и определите новые значения количества, как некоторые будет изменено в сетке пользователем.

Позволяет добавить метод «RemoveItem» наш класс покупательской корзины в MyShoppingCart.cs для обработки случая, когда пользователь отмечает элемент для удаления.

[!code-csharp[Main](tailspin-spyworks-part-5/samples/sample13.cs)]

Теперь давайте ad метод для обработки ситуации, когда пользователь изменяет просто качеству упорядочиваемых в GridView.

[!code-csharp[Main](tailspin-spyworks-part-5/samples/sample14.cs)]

Основные компоненты удаление и обновление на месте можно реализовать логику, которая обновляется в корзину в базе данных. (В MyShoppingCart.cs)

[!code-csharp[Main](tailspin-spyworks-part-5/samples/sample15.cs)]

Можно заметить, что этот метод ожидает два параметра. Один идентификатор Корзина для покупок и другой массив объектов, определяемых пользователем типа.

Таким образом, чтобы свести к минимуму зависимости логику от специфики интерфейс пользователя, мы определили структуру данных, который можно использовать для передачи элементам корзины покупок в наш код без нашего метода, не требуется непосредственно доступ к элемента управления GridView.

[!code-csharp[Main](tailspin-spyworks-part-5/samples/sample16.cs)]

В наш файл MyShoppingCart.aspx.cs можно использовать эту структуру в наш обработчик события Click кнопки обновления следующим образом. Обратите внимание, что помимо обновления в корзину мы обновим также общего количества покупок.

[!code-csharp[Main](tailspin-spyworks-part-5/samples/sample17.cs)]

Обратите внимание, с помощью особый интерес представляет эту строку кода:

[!code-javascript[Main](tailspin-spyworks-part-5/samples/sample18.js)]

GetValues() — это специальные вспомогательная функция, который мы реализуем в MyShoppingCart.aspx.cs, как показано ниже.

[!code-csharp[Main](tailspin-spyworks-part-5/samples/sample19.cs)]

Это предоставляет чистый способ доступа к значениям элементов привязки в наш элемент управления GridView. Так как наш элемент управления CheckBox «Удалить элемент» не привязан мы будем доступ к ней через метод FindControl().

На этом этапе разработки проекта мы готовимся реализовать процесс подсчета стоимости сначала.

Прежде чем таким образом, давайте используйте Visual Studio для создания базы данных членства и Добавление пользователя в хранилище данных членства.

> [!div class="step-by-step"]
> [Назад](tailspin-spyworks-part-4.md)
> [Вперед](tailspin-spyworks-part-6.md)
