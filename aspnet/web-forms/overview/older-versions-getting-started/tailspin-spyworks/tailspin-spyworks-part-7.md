---
uid: web-forms/overview/older-versions-getting-started/tailspin-spyworks/tailspin-spyworks-part-7
title: Часть 7. Добавление функций | Документация Майкрософт
author: JoeStagner
description: В этой серии руководств описаны все действия, предпринимаемые для создайте пример приложения Tailspin Spyworks. Часть 7 добавляет дополнительные функции, например росмотреть учетной записи...
ms.author: riande
ms.date: 07/21/2010
ms.assetid: 50223ee9-11b9-4cf3-bca2-e2f10bf471f3
msc.legacyurl: /web-forms/overview/older-versions-getting-started/tailspin-spyworks/tailspin-spyworks-part-7
msc.type: authoredcontent
ms.openlocfilehash: cada8d9aee649e4f2a5afc1ca2b46863ea458207
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/01/2019
ms.locfileid: "57056521"
---
<a name="part-7-adding-features"></a>Часть 7. Добавление возможностей
====================
по [(Joe Stagner)](https://github.com/JoeStagner)

> Tailspin Spyworks демонстрирует, как чрезвычайно прост процесс создания мощных и масштабируемых приложений для платформы .NET. Он демонстрирует способы использования новые возможности в ASP.NET 4 для создание Интернет-магазина, включая покупок, извлечения и администрирования.
> 
> В этой серии руководств описаны все действия, предпринимаемые для создайте пример приложения Tailspin Spyworks. Часть 7 добавляет дополнительные функции, такие как проверка учетной записи, обзоры продуктов и «популярных элементов» и «также приобретенных» пользовательские элементы управления.


## <a id="_Toc260221673"></a>  Добавление функций

Пользователи могут просматривать наш каталог, поместить элементы в его корзине и завершить процесс подсчета стоимости покупок, но существует ряд вспомогательных функций, что будет включено для улучшения наш сайт.

1. Проверка учетной записи (список заказов разместить и просмотреть подробные сведения.)
2. Добавьте в страницу содержимое определенного контекста.
3. Добавьте функцию, которая позволит пользователям просмотр продуктов в каталоге.
4. Создайте пользовательский элемент управления для отображения популярных элементов и место, которые управляют на первой странице.
5. Создание элемента управления пользователя «Также приобрели» и добавьте его к странице сведений о продукте.
6. Добавление контакта страницы.
7. Добавить о странице.
8. Глобальных ошибок

## <a id="_Toc260221674"></a>  Проверка учетной записи

В папке «Учетная запись» создайте две страницы ASPX, один именованный OrderList.aspx и другие именованные OrderDetails.aspx

OrderList.aspx будет использовать элементы управления GridView и EntityDataSoure так же, как у нас есть ранее.

[!code-aspx[Main](tailspin-spyworks-part-7/samples/sample1.aspx)]

EntityDataSoure Выбор записей из таблицы Orders, отфильтрованные по имени пользователя (см. в разделе WhereParameter) которого задается в переменной сеанса при журнале пользователя.

Обратите внимание, эти параметры в поле HyperlinkField элемента управления GridView:

[!code-xml[Main](tailspin-spyworks-part-7/samples/sample2.xml)]

Они указывают ссылки в представлении сведений о порядке для каждого продукта, указав в качестве параметра строки запроса к странице OrderDetails.aspx поле OrderID.

## <a id="_Toc260221675"></a>  OrderDetails.aspx

Мы будем использовать элемент управления EntityDataSource для доступа к заказы и FormView для отображения данных о заказах и другой EntityDataSource, с помощью элемента управления GridView для отображения строк элементов заказа.

[!code-aspx[Main](tailspin-spyworks-part-7/samples/sample3.aspx)]

В файле кода программной части (OrderDetails.aspx.cs) у нас есть два немного биты по обслуживанию.

Сначала необходимо убедиться, что OrderDetails всегда получает OrderId.

[!code-csharp[Main](tailspin-spyworks-part-7/samples/sample4.cs)]

Нам также нужно вычисления и отображения итоговая из элементов строк.

[!code-csharp[Main](tailspin-spyworks-part-7/samples/sample5.cs)]

## <a id="_Toc260221676"></a>  На домашней странице

Давайте добавим некоторые статического содержимого на страницу Default.aspx.

Сначала я создам папку «Содержимое» и в ней папку Images (и я включил изображение, используемое на домашней странице).

На место заполнителя нижней части страницы Default.aspx добавьте следующую разметку.

[!code-aspx[Main](tailspin-spyworks-part-7/samples/sample6.aspx)]

## <a id="_Toc260221677"></a>  Обзоры продуктов

Сначала мы добавим кнопку со ссылкой на форму, который можно использовать для ввода Обзор продукта.

[!code-aspx[Main](tailspin-spyworks-part-7/samples/sample7.aspx)]

![](tailspin-spyworks-part-7/_static/image1.jpg)

Обратите внимание на то, что мы передаем значение поля в строке запроса

Далее добавим страницу с именем ReviewAdd.aspx

Эта страница будет использовать ASP.NET AJAX Control Toolkit. Если вы еще не сделали, скачав его из [DevExpress](http://devexpress.com/act) и есть рекомендации по настройке в набор средств для работы с Visual Studio здесь [ https://www.asp.net/learn/ajax-videos/video-76.aspx ](../../../videos/ajax-control-toolkit/how-do-i-get-started-with-the-aspnet-ajax-control-toolkit.md).

В режиме конструктора перетащите элементы управления и проверяющие элементы управления из области элементов и создание формы, как показано ниже.

![](tailspin-spyworks-part-7/_static/image2.jpg)

Разметка будет выглядеть следующим образом.

[!code-aspx[Main](tailspin-spyworks-part-7/samples/sample8.aspx)]

Теперь, когда мы можем ввести имя проверки, позволяет отобразить отзывы пользователей на странице продукта.

Добавьте эту разметку страницы ProductDetails.aspx.

[!code-aspx[Main](tailspin-spyworks-part-7/samples/sample9.aspx)]

Под управлением Теперь приложение, последовательно выбрав пункты продукта показывает сведения о продукте, включая отзывы клиентов.

![](tailspin-spyworks-part-7/_static/image3.jpg)

## <a id="_Toc260221678"></a>  Популярных элементов управления (Создание пользовательских элементов управления)

Для увеличения продаж на веб-сайт мы добавим несколько возможностей «непристойные sell» популярные или связанных продуктов.

Первый из этих функций будет представлять собой список наиболее популярных продуктов в наш каталог продукции.

Мы создадим «Пользовательский элемент управления» для отображения наиболее продаваемых элементы на домашней странице приложения. Так как это будет элемент управления, мы используем его на любой странице, просто перетащив элемент управления в конструкторе Visual Studio на любой странице, нам хотелось.

В обозревателе решений Visual Studio щелкните правой кнопкой мыши имя решения и создайте новый каталог с именем «Элементов управления». Хотя нет необходимости сделать это, мы поможет сохранить наш проект, упорядоченные по Создание всех наших пользовательских элементов управления в каталоге «Элементов управления».

Элементы управления папку правой кнопкой мыши и выберите «Новый элемент»:

![](tailspin-spyworks-part-7/_static/image4.jpg)

Укажите имя для наших управления «PopularItems». Обратите внимание, что расширение файла для пользовательских элементов управления .ascx не .aspx.

Наши распространенных пользовательских элементов управления определяются следующим образом.

[!code-aspx[Main](tailspin-spyworks-part-7/samples/sample10.aspx)]

Здесь мы используем метод, который мы не использовали еще в этом приложении. Мы используем элемент управления repeater и вместо того чтобы использовать элемент управления источником данных мы привязываем элемент управления Repeater к результатам запроса LINQ to Entities.

В коде программной части наш элемент управления этого следующим образом.

[!code-csharp[Main](tailspin-spyworks-part-7/samples/sample11.cs)]

Обратите внимание, это важный этап в верхней части разметки наш элемент управления.

[!code-aspx[Main](tailspin-spyworks-part-7/samples/sample12.aspx)]

Так как не будет изменять самыми популярными материалами по принципу минуты мы можем добавить директиву болью для повышения производительности приложения. Эта директива вызовет код элементов управления для должны выполняться по истечении срока действия кэшированных выходных данных элемента управления. В противном случае будет использоваться кэшированная версия выходные данные элемента управления.

Теперь нам нужно всего лишь включить наш новый элемент управления в страницу Default.aspc.

Используйте перетаскивание для размещения экземпляра элемента управления в столбце откройте нашу форму по умолчанию.

![](tailspin-spyworks-part-7/_static/image5.jpg)

Теперь при выполнении приложения на домашней странице отображаются наиболее популярных элементов.

![](tailspin-spyworks-part-7/_static/image6.jpg)

## <a id="_Toc260221679"></a>  «Также приобрели» управления (элементы управления пользователя с параметрами)

Второй пользовательский элемент управления, который мы создадим займет непристойные продаж на следующий уровень, добавив специфичность контекста.

Логика для вычисления верхних элементов «Также приобрели» является нетривиальным.

Наш элемент управления «Также приобрели» будет выбора OrderDetails записей (ранее приобретенной) для текущего выбранного ProductID и захватите OrderIDs для каждого заказа уникальный, которую можно найти.

Затем мы выберем al продукты из всех этих заказов и суммы, количества приобретенных. Мы продукты сортируются по количество, сумма которых составляет и отобразить первые пять элементов.

Учитывая сложность этой логики, мы реализуем этот алгоритм как хранимую процедуру.

Ниже приведен код T-SQL для хранимой процедуры.

[!code-sql[Main](tailspin-spyworks-part-7/samples/sample13.sql)]

Обратите внимание, эта хранимая процедура (SelectPurchasedWithProducts) существовали в базе данных, когда мы включили в наше приложение, и при создании модели EDM, мы указали в дополнение к таблицы и представления, которые нам нужно модели EDM следует включить эту хранимую процедуру.

Для доступа к хранимую процедуру из модели EDM, нам нужно импортировать функцию.

Дважды щелкните на модели EDM в обозревателе решений, чтобы открыть его в конструкторе и откройте браузер моделей, а затем щелкните правой кнопкой мыши в конструкторе и выберите «Добавить импорт функции».

![](tailspin-spyworks-part-7/_static/image1.png)

Таким образом будет открыть это диалоговое окно.

![](tailspin-spyworks-part-7/_static/image2.png)

Заполните поля, как показано выше, выбрав «SelectPurchasedWithProducts» и используйте имя процедуры в качестве имени наших импортированной функции.

Нажмите кнопку «ОК».

Этого, мы просто могут программировать для хранимой процедуры, как мы может любой другой элемент в модели.

Таким образом в папке «Элементы управления» создайте новый пользовательский элемент управления с именем AlsoPurchased.ascx.

Разметка для этого элемента управления покажется очень PopularItems элемента управления.

[!code-aspx[Main](tailspin-spyworks-part-7/samples/sample14.aspx)]

Важное отличие состоит в том, не являются кэширования выходных данных, поскольку для отображения элемента будут отличаться по продукту.

Значение поля будет «свойство» к элементу управления.

[!code-csharp[Main](tailspin-spyworks-part-7/samples/sample15.cs)]

В обработчике события PreRender элемента управления мы eed для выполнения трех задач.

1. Убедитесь, что значение ProductID.
2. См. в статье, есть ли все продукты, которые были приобретены с текущей.
3. Выводить некоторые элементы, как определено в #2.

Обратите внимание на то, насколько это просто вызов хранимой процедуры через модель.

[!code-csharp[Main](tailspin-spyworks-part-7/samples/sample16.cs)]

Определив, существует «также приобретаются» мы просто связать элементу управления repeater к результатам, возвращаемым запросом.

[!code-csharp[Main](tailspin-spyworks-part-7/samples/sample17.cs)]

Если не все элементы «также приобрели» мы просто отобразим других популярных элементов из наших каталога.

[!code-csharp[Main](tailspin-spyworks-part-7/samples/sample18.cs)]

Чтобы просмотреть элементы «Также приобрели», откройте страницу ProductDetails.aspx и перетащите его AlsoPurchased из обозревателя решений, чтобы он отображался в данном положении в разметке.

[!code-aspx[Main](tailspin-spyworks-part-7/samples/sample19.aspx)]

Таким образом будет создать ссылку на элемент управления в верхней части страницы ProductDetails.

[!code-aspx[Main](tailspin-spyworks-part-7/samples/sample20.aspx)]

Так как пользовательский элемент управления AlsoPurchased требуется номер ProductId, мы определим свойство ProductID наш элемент управления, используя оператор Eval от текущего элемента модели данных страницы.

![](tailspin-spyworks-part-7/_static/image3.png)

Когда мы построить и запустить сейчас и просмотреть в продукт мы см. в разделе «Также приобрели» элементов.

![](tailspin-spyworks-part-7/_static/image7.jpg)

> [!div class="step-by-step"]
> [Назад](tailspin-spyworks-part-6.md)
> [Вперед](tailspin-spyworks-part-8.md)
