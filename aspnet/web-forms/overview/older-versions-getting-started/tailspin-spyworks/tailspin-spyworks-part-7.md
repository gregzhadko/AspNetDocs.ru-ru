---
uid: web-forms/overview/older-versions-getting-started/tailspin-spyworks/tailspin-spyworks-part-7
title: Часть 7. Добавление компонентов | Документация Майкрософт
author: JoeStagner
description: В этой серии руководств подробно описаны все шаги, предпринятые для создания примера приложения Tailspin Spyworks. В часть 7 добавлены дополнительные функции, такие как учетная запись ревие...
ms.author: riande
ms.date: 07/21/2010
ms.assetid: 50223ee9-11b9-4cf3-bca2-e2f10bf471f3
msc.legacyurl: /web-forms/overview/older-versions-getting-started/tailspin-spyworks/tailspin-spyworks-part-7
msc.type: authoredcontent
ms.openlocfilehash: ffd2b862c727db9572c272b7b21bcc33c822fffa
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78521568"
---
# <a name="part-7-adding-features"></a>Часть 7. Добавление функций

кем [Джо Stagner)](https://github.com/JoeStagner)

> В Tailspin Spyworks. демонстрируется, как чрезвычайно прост в создании мощных масштабируемых приложений для платформы .NET. Здесь показано, как использовать замечательные новые функции в ASP.NET 4 для создания Интернет-магазина, включая покупку, оформление и администрирование.
> 
> В этой серии руководств подробно описаны все шаги, предпринятые для создания примера приложения Tailspin Spyworks. В часть 7 добавлены дополнительные функции, такие как проверка учетной записи, проверка продукта, а также "Популярные элементы" и "купленные" пользовательские элементы управления.

## <a id="_Toc260221673"></a>Добавление компонентов

Хотя пользователи могут просматривать наш каталог, размещать товары в своей корзине для покупок и завершать процесс извлечения, существует ряд вспомогательных функций, которые мы будем улучшать для улучшения нашего сайта.

1. Проверка учетной записи (список размещенных заказов и Просмотр сведений).
2. Добавьте содержимое определенного контекста на переднюю страницу.
3. Добавьте функцию, чтобы позволить пользователям просматривать продукты в каталоге.
4. Создайте пользовательский элемент управления для показа популярных элементов и поместите этот элемент управления на переднюю страницу.
5. Создайте "также купленный" пользовательский элемент управления и добавьте его на страницу сведений о продукте.
6. Добавление страницы контактов.
7. Добавление страницы About.
8. Глобальная ошибка

## <a id="_Toc260221674"></a>Проверка учетной записи

В папке Account создайте две страницы ASPX с именем OrderList. aspx и другой с именем OrderDetails. aspx.

OrderList. aspx будет использовать элементы управления GridView и EntityDataSource почти так, как мы ранее.

[!code-aspx[Main](tailspin-spyworks-part-7/samples/sample1.aspx)]

EntityDataSource выбирает записи из таблицы Orders, отфильтрованные по имени пользователя (см. Вхерепараметер), которые задаются в переменной сеанса при входе пользователя в систему.

Обратите внимание также на эти параметры в HyperlinkField элемента управления GridView:

[!code-xml[Main](tailspin-spyworks-part-7/samples/sample2.xml)]

Они указывают ссылку на представление "сведения о заказе" для каждого продукта, указав поле OrderID в качестве параметра QueryString на странице OrderDetails. aspx.

## <a id="_Toc260221675"></a>OrderDetails. aspx

Мы будем использовать элемент управления EntityDataSource для доступа к заказам и FormView для вывода данных заказа и другого элемента управления EntityDataSource с элементом управления GridView для вывода всех элементов строк заказа.

[!code-aspx[Main](tailspin-spyworks-part-7/samples/sample3.aspx)]

В файле кода программной части (OrderDetails.aspx.cs) у нас есть два маленьких бита обслуживания.

Сначала необходимо убедиться, что OrderDetails всегда получает значение OrderId.

[!code-csharp[Main](tailspin-spyworks-part-7/samples/sample4.cs)]

Также необходимо вычислить и отобразить итоги заказа из элементов строки.

[!code-csharp[Main](tailspin-spyworks-part-7/samples/sample5.cs)]

## <a id="_Toc260221676"></a>Домашняя страница

Давайте добавим статическое содержимое на страницу Default. aspx.

Сначала я создам папку «Content» (содержимое), а в ней — папку Images (и в нее будет включен образ, который будет использоваться на домашней странице).

В нижний заполнитель страницы Default. aspx добавьте следующую разметку.

[!code-aspx[Main](tailspin-spyworks-part-7/samples/sample6.aspx)]

## <a id="_Toc260221677"></a>Обзоры продуктов

Сначала мы добавим кнопку со ссылкой на форму, которую можно использовать для ввода проверки продукта.

[!code-aspx[Main](tailspin-spyworks-part-7/samples/sample7.aspx)]

![](tailspin-spyworks-part-7/_static/image1.jpg)

Обратите внимание, что код ProductID передается в строку запроса.

Далее давайте добавим страницу с именем Ревиевадд. aspx.

На этой странице будет использоваться набор средств управления AJAX ASP.NET. Если вы еще не сделали этого, скачайте его из [Подписка DevExpress](http://devexpress.com/act) и получите рекомендации по настройке набора средств для использования с Visual Studio здесь [https://www.asp.net/learn/ajax-videos/video-76.aspx](../../../videos/ajax-control-toolkit/how-do-i-get-started-with-the-aspnet-ajax-control-toolkit.md).

В режиме конструктора перетащите элементы управления и средства проверки из панели элементов и создайте форму, подобную приведенной ниже.

![](tailspin-spyworks-part-7/_static/image2.jpg)

Разметка будет выглядеть примерно так.

[!code-aspx[Main](tailspin-spyworks-part-7/samples/sample8.aspx)]

Теперь, когда мы можем ввести рецензии, можно отобразить эти проверки на странице продукта.

Добавьте эту разметку на страницу Продуктдетаилс. aspx.

[!code-aspx[Main](tailspin-spyworks-part-7/samples/sample9.aspx)]

Запустив наше приложение сейчас и перейдя к продукту, вы увидите сведения о продукте, включая отзывы клиентов.

![](tailspin-spyworks-part-7/_static/image3.jpg)

## <a id="_Toc260221678"></a>Элемент управления популярными элементами (создание пользовательских элементов управления)

Чтобы увеличить объем продаж на веб-сайте, мы добавим несколько функций для «предполагающее определенную продать» популярных или связанных продуктов.

Первая из этих функций будет представлять собой список наиболее популярных продуктов в нашем каталоге продуктов.

Мы создадим «пользовательский элемент управления» для показа лучших элементов, которые будут продаваться на домашней странице нашего приложения. Так как это будет элемент управления, мы можем использовать его на любой странице, просто перетащив элемент управления в конструкторе Visual Studio на любую страницу, которая нам нравится.

В обозревателе решений Visual Studio щелкните правой кнопкой мыши имя решения и создайте новый каталог с именем Controls. Хотя это необязательно, мы сможем обеспечить упорядочение нашего проекта, создавая все пользовательские элементы управления в каталоге "Controls".

Щелкните правой кнопкой мыши папку Controls и выберите пункт "создать элемент":

![](tailspin-spyworks-part-7/_static/image4.jpg)

Укажите имя для элемента управления "Популаритемс". Обратите внимание, что расширение файла для пользовательских элементов управления — ASCX, а не aspx.

Пользовательский элемент управления популярными элементами будет определен следующим образом.

[!code-aspx[Main](tailspin-spyworks-part-7/samples/sample10.aspx)]

Здесь мы используем метод, который мы еще не использовали в этом приложении. Мы используем элемент управления Repeater и вместо использования элемента управления источниками данных привязка элемента управления Repeater к результатам запроса LINQ to Entities.

В коде программной части нашего элемента управления мы делаем это следующим образом.

[!code-csharp[Main](tailspin-spyworks-part-7/samples/sample11.cs)]

Обратите внимание также на эту важную строку в верхней части разметки элемента управления.

[!code-aspx[Main](tailspin-spyworks-part-7/samples/sample12.aspx)]

Так как самые популярные элементы не изменяются в течение минуты, мы можем добавить директиву Ачинг для повышения производительности нашего приложения. Эта директива приведет к тому, что код элементов управления будет выполняться только при истечении срока действия кэшированного вывода элемента управления. В противном случае будет использоваться кэшированная версия выходных данных элемента управления.

Теперь все, что нам нужно сделать, — это добавить наш новый элемент управления на странице Default. aspx.

Используйте перетаскивание, чтобы поместить экземпляр элемента управления в столбец Open формы по умолчанию.

![](tailspin-spyworks-part-7/_static/image5.jpg)

Теперь при запуске нашего приложения на домашней странице отображаются наиболее популярные элементы.

![](tailspin-spyworks-part-7/_static/image6.jpg)

## <a id="_Toc260221679"></a>"Также купленный" элемент управления (пользовательские элементы управления с параметрами)

Второй пользовательский элемент управления, который мы создадим, будет принимать предполагающее определенную на следующий уровень, добавляя для него особенности контекста.

Логика вычисления верхних и купленных элементов не является тривиальной.

Наш «купленный» элемент управления выберет записи OrderDetails (ранее приобретенные) для текущего выбранного ProductID и захватите элементы OrderID для каждого найденного уникального заказа.

Затем мы выберем пункт Al продуктов из всех заказов и вычислите количество приобретенных. Мы будем Сортировать продукты по этой сумме и отображать пять верхних элементов.

Учитывая сложность этой логики, мы будем реализовывать этот алгоритм как хранимую процедуру.

Процедура T-SQL для хранимой процедуры выглядит следующим образом.

[!code-sql[Main](tailspin-spyworks-part-7/samples/sample13.sql)]

Обратите внимание, что эта хранимая процедура (Селектпурчаседвиспродуктс) существовала в базе данных, когда мы включили ее в наше приложение, и когда мы создали EDM мы указали, что в дополнение к нужным таблицам и представлениям EDM должна содержать эту хранимую процедуру.

Чтобы получить доступ к хранимой процедуре из EDM необходимо импортировать функцию.

Дважды щелкните EDM в обозревателе решений, чтобы открыть его в конструкторе и открыть Обозреватель моделей, щелкните правой кнопкой мыши в конструкторе и выберите "добавить функцию импорта функции".

![](tailspin-spyworks-part-7/_static/image1.png)

Это приведет к открытию этого диалогового окна.

![](tailspin-spyworks-part-7/_static/image2.png)

Заполните поля, как показано выше, выбрав "Селектпурчаседвиспродуктс" и используя имя процедуры для имени импортированной функции.

Нажмите кнопку "ОК".

После этого мы можем просто программировать хранимую процедуру так же, как и любой другой элемент в модели.

Поэтому в папке Controls создайте новый пользовательский элемент управления с именем Алсопурчасед. ascx.

Разметка для этого элемента управления будет очень знакома с элементом управления Популаритемс.

[!code-aspx[Main](tailspin-spyworks-part-7/samples/sample14.aspx)]

Заметным различием является то, что не кэширование выходных данных, так как отображаемый элемент будет отличаться по сравнению с продуктом.

ProductId будет "свойством" для элемента управления.

[!code-csharp[Main](tailspin-spyworks-part-7/samples/sample15.cs)]

В обработчике событий PreRender элемента управления мы ИД три вещи.

1. Убедитесь, что установлен параметр ProductID.
2. Проверьте, есть ли продукты, приобретенные с текущим.
3. Выводить некоторые элементы, как определено в #2.

Обратите внимание, насколько просто вызывать хранимую процедуру через модель.

[!code-csharp[Main](tailspin-spyworks-part-7/samples/sample16.cs)]

После определения наличия "также приобретенных" можно просто привязать Repeater к результатам, возвращаемым запросом.

[!code-csharp[Main](tailspin-spyworks-part-7/samples/sample17.cs)]

Если не было ни одного купленного элемента, мы просто отображаем другие популярные товары из нашего каталога.

[!code-csharp[Main](tailspin-spyworks-part-7/samples/sample18.cs)]

Чтобы просмотреть "также купленные" элементы, откройте страницу Продуктдетаилс. aspx и перетащите элемент управления Алсопурчасед из обозревателя решений, чтобы он появился в этой позиции в разметке.

[!code-aspx[Main](tailspin-spyworks-part-7/samples/sample19.aspx)]

Это приведет к созданию ссылки на элемент управления в верхней части страницы Продуктдетаилс.

[!code-aspx[Main](tailspin-spyworks-part-7/samples/sample20.aspx)]

Так как пользовательский элемент управления Алсопурчасед требует номер ProductId, мы зададим свойство ProductID элемента управления, используя инструкцию eval для текущего элемента модели данных страницы.

![](tailspin-spyworks-part-7/_static/image3.png)

Когда мы выполним сборку и запуск, а также перейдя к продукту, вы увидите «купленные» элементы.

![](tailspin-spyworks-part-7/_static/image7.jpg)

> [!div class="step-by-step"]
> [Назад](tailspin-spyworks-part-6.md)
> [Вперед](tailspin-spyworks-part-8.md)
