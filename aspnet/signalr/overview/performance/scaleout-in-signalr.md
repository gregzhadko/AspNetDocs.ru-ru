---
uid: signalr/overview/performance/scaleout-in-signalr
title: Общие сведения о масштабировании в SignalR | Документация Майкрософт
author: bradygaster
description: Версии программного обеспечения, используемые в этом разделе, Visual Studio 2013 .NET 4,5 SignalR версии 2 в предыдущих версиях этого раздела для получения сведений о более ранних версиях...
ms.author: bradyg
ms.date: 06/10/2014
ms.assetid: 7e781fc1-1c1f-45a8-bc1d-338e96dbe9c9
msc.legacyurl: /signalr/overview/performance/scaleout-in-signalr
msc.type: authoredcontent
ms.openlocfilehash: 14dc22f99a43b566903c59fb23b7d419350f4a25
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78467784"
---
# <a name="introduction-to-scaleout-in-signalr"></a>Общие сведения о масштабировании в SignalR

по [Майк Уоссон](https://github.com/MikeWasson), [Патрик Флетчера](https://github.com/pfletcher)

[!INCLUDE [Consider ASP.NET Core SignalR](~/includes/signalr/signalr-version-disambiguation.md)]

> ## <a name="software-versions-used-in-this-topic"></a>Версии программного обеспечения, используемые в этом разделе
>
>
> - [Visual Studio 2013](https://my.visualstudio.com/Downloads?q=visual%20studio%202013)
> - .NET 4.5
> - SignalR версии 2
>
>
>
> ## <a name="previous-versions-of-this-topic"></a>Предыдущие версии этого раздела
>
> Сведения о более ранних версиях SignalR см. в статье о [старых версиях](../older-versions/index.md)SignalR.
>
> ## <a name="questions-and-comments"></a>Вопросы и комментарии
>
> Оставьте отзыв о том, как вы понравится вам в этом учебнике, и что можно улучшить в комментариях в нижней части страницы. Если у вас есть вопросы, не связанные непосредственно с этим руководством, их можно опубликовать на [форуме ASP.NET SignalR](https://forums.asp.net/1254.aspx/1?ASP+NET+SignalR) или [StackOverflow.com](http://stackoverflow.com/).

В целом, существует два способа масштабирования веб-приложения: *увеличение* и *масштабирование*.

- Увеличение масштаба означает использование более крупного сервера (или более крупной виртуальной машины) с большим объемом ОЗУ, ЦП и т. д.
- Масштабное развертывание означает добавление дополнительных серверов для работы с нагрузкой.

Проблема, связанная с масштабированием, заключается в том, что вы быстро достигли ограничения на размер компьютера. Кроме того, необходимо выполнить масштабирование. Однако при горизонтальном масштабировании клиенты могут перенаправляться на разные серверы. Клиент, подключенный к одному серверу, не будет принимать сообщения, отправленные с другого сервера.

![](scaleout-in-signalr/_static/image1.png)

Одним из решений является пересылка сообщений между серверами с помощью компонента, называемого *объединительной платой*. После включения объединительной платы каждый экземпляр приложения отправляет сообщения в объединительную плату, а Объединительная плата перенаправляет их в другие экземпляры приложения. (В электронике Объединительная плата — это группа параллельных соединителей. В аналоговом виде Объединительная плата SignalR соединяет несколько серверов.)

![](scaleout-in-signalr/_static/image2.png)

Сейчас SignalR предоставляет три объединительные платы:

- **Служебная шина Azure**. Служебная шина — это инфраструктура обмена сообщениями, позволяющая компонентам отсылать сообщения слабо взаимосвязанным образом.
- **Redis**. Redis — это хранилище "ключ — значение" в памяти. Redis поддерживает шаблон публикации/подписки ("Pub/resubscribe") для отправки сообщений.
- **SQL Server.** SQL Serverная Объединительная плата записывает сообщения в таблицы SQL. Объединительная плата использует Service Broker для эффективного обмена сообщениями. Однако он также работает, если Service Broker не включена.

При развертывании приложения в Azure рассмотрите возможность использования объединительной платы Redis с помощью [кэша Redis для Azure](https://azure.microsoft.com/services/cache/). При развертывании в своей ферме серверов учитывайте SQL Server или Redis.

В следующих разделах содержатся пошаговые учебники для каждой объединительной платы.

- [Масштабирование SignalR с помощью служебной шины Azure](scaleout-with-windows-azure-service-bus.md)
- [Масштабирование SignalR с помощью Redis](scaleout-with-redis.md)
- [Масштабирование SignalR с помощью SQL Server](scaleout-with-sql-server.md)

## <a name="implementation"></a>Реализация

В SignalR каждое сообщение отправляется через шину сообщений. Шина сообщений реализует интерфейс [имессажебус](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.messaging.imessagebus(v=vs.100).aspx) , который предоставляет абстракцию публикации и подписки. Объединительные платы работают, заменяя **имессажебус** по умолчанию на шину, предназначенную для этой объединительной платы. Например, в качестве шины сообщений для Redis используется [редисмессажебус](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.redis.redismessagebus(v=vs.100).aspx), а для отправки и получения сообщений используется механизм Redis [Pub/подкаталог](http://redis.io/topics/pubsub) .

Каждый экземпляр сервера подключается к объединительной плате через шину. При отправке сообщения он переходит на объединительную плату, а Объединительная плата отправляет его на каждый сервер. Когда сервер получает сообщение от объединительной платы, он помещает сообщение в свой локальный кэш. Затем сервер доставляет сообщения клиентам из своего локального кэша.

Для каждого клиентского соединения выполняется трассировка хода выполнения клиента при чтении потока сообщений с помощью курсора. (Курсор представляет позицию в потоке сообщений.) Если клиент отключает, а затем повторно подключается, он запрашивает у шины все сообщения, поступившие после значения курсора клиента. То же самое происходит, когда соединение использует [длительный опрос](../getting-started/introduction-to-signalr.md#transports). После завершения длительного запроса опроса клиент открывает новое соединение и запрашивает сообщения, поступившие после курсора.

Механизм курсора работает, даже если клиент направляется на другой сервер при повторном подключении. Задняя панель осведомлена обо всех серверах и не имеет значения, к какому серверу подключается клиент.

## <a name="limitations"></a>Ограничения

При использовании объединительной платы максимальная пропускная способность сообщения ниже, чем в случае, когда клиенты говорят непосредственно на одном узле сервера. Это обусловлено тем, что объединительная плата перенаправляет каждое сообщение на каждый узел, поэтому Объединительная плата может стать узким местом. Зависит ли это ограничение от приложения. Например, вот несколько типичных сценариев SignalR:

- [Широковещательная рассылка сервера](../getting-started/tutorial-server-broadcast-with-signalr.md) (например, биржевая тикер). в этом сценарии хорошо работает Объединительная плата, поскольку сервер управляет скоростью отправки сообщений.
- [Клиент-клиент](../getting-started/tutorial-getting-started-with-signalr.md) (например, чат). в этом сценарии Объединительная плата может стать узким местом, если количество сообщений масштабируется с учетом количества клиентов; то есть, если скорость передачи сообщений пропорционально увеличению числа клиентов, присоединяемых к нему.
- [Высокая частота](../getting-started/tutorial-high-frequency-realtime-with-signalr.md) (например, игры в реальном времени). в этом сценарии не рекомендуется использовать объединительную плату.

## <a name="enabling-tracing-for-signalr-scaleout"></a>Включение трассировки для масштабирования SignalR

Чтобы включить трассировку для объединительных плат, добавьте следующие разделы в файл Web. config в корневой элемент **конфигурации** :

[!code-html[Main](scaleout-in-signalr/samples/sample1.html)]
