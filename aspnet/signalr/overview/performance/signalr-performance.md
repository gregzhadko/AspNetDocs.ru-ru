---
uid: signalr/overview/performance/signalr-performance
title: Производительность сигнала (англ.) Документы Майкрософт
author: bradygaster
description: Производительность SignalR
ms.author: bradyg
ms.date: 06/10/2014
ms.assetid: 3751f5e7-59db-4be0-a290-50abc24e5c84
msc.legacyurl: /signalr/overview/performance/signalr-performance
msc.type: authoredcontent
ms.openlocfilehash: b8a44f4c924c94cdfff1ce7630539b45fe269bbf
ms.sourcegitcommit: ce28244209db8615bc9bdd576a2e2c88174d318d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2020
ms.locfileid: "80675721"
---
# <a name="signalr-performance"></a>Производительность SignalR

[Патрик Флетчер](https://github.com/pfletcher)

[!INCLUDE [Consider ASP.NET Core SignalR](~/includes/signalr/signalr-version-disambiguation.md)]

> В этой теме описывается, как проектировать, измерять и повышать производительность в приложении SignalR.
>
> ## <a name="software-versions-used-in-this-topic"></a>Версии программного обеспечения, используемые в этой теме
>
>
> - [Visual Studio 2013](https://my.visualstudio.com/Downloads?q=visual%20studio%202013)
> - .NET 4.5
> - Версия SignalR 2
>
>
>
> ## <a name="previous-versions-of-this-topic"></a>Предыдущие версии этой темы
>
> Для получения информации о более ранних версиях SignalR, см [SignalR Старые версии](../older-versions/index.md).
>
> ## <a name="questions-and-comments"></a>Вопросы и комментарии
>
> Пожалуйста, оставьте обратную связь о том, как вам понравился этот учебник и что мы могли бы улучшить в комментариях в нижней части страницы. Если у вас есть вопросы, которые не имеют прямого отношения к учебнику, вы можете разместить их на [форуме ASP.NET SignalR](https://forums.asp.net/1254.aspx/1?ASP+NET+SignalR) или [StackOverflow.com.](http://stackoverflow.com/)

Для недавней презентации по производительности И масштабирования SignalR см. [Масштабирование Web в режиме реального времени с помощью ASP.NET SignalR.](https://channel9.msdn.com/Events/Build/2013/3-502)

Этот раздел состоит из следующих подразделов.

- [Рекомендации по проектированию](#design)
- [Настройка сервера SignalR для производительности](#tuning)
- [Устранение проблем с производительностью](#troubleshooting)
- [Использование счетчиков производительности SignalR](#perfcounters)
- [Использование других счетчиков производительности](#othercounters)
- [Прочие ресурсы](#otherresources)

<a id="design"></a>

## <a name="design-considerations"></a>Рекомендации по проектированию

В этом разделе описаны шаблоны, которые могут быть реализованы при проектировании приложения SignalR, чтобы гарантировать, что производительность не будет затруднена генерацией ненужного сетевого трафика.

### <a name="throttling-message-frequency"></a>Частота заседок сообщений

Даже в приложении, которое отправляет сообщения на высокой частоте (например, игровое приложение в реальном времени), большинству приложений не нужно отправлять больше, чем несколько сообщений в секунду. Чтобы уменьшить объем трафика, генерируемого каждым клиентом, может быть реализован цикл сообщений, который выстраивает в очередь и отправляет сообщения не чаще, чем фиксированный тариф (т.е. до определенного количества сообщений будет отправляться каждую секунду, если в этот временной интервал для отправки будут отправляться сообщения). Для примера приложения, которое задушит сообщения до определенной скорости (как от клиента, так и от сервера), [см.](../getting-started/tutorial-high-frequency-realtime-with-signalr.md)

### <a name="reducing-message-size"></a>Уменьшение размера сообщения

Можно уменьшить размер сообщения SignalR, уменьшив размер сериализованных объектов. В коде сервера, если вы отправляете объект, содержащий свойства, которые не должны передаваться, `JsonIgnore` не допускайте сериализации этих свойств с помощью атрибута. Имена свойств также сохраняются в сообщении; имена свойств можно сократить с `JsonProperty` помощью атрибута. Следующий пример кода показывает, как исключить отправку свойства клиенту и как сократить имена свойств:

**код сервера .NET, демонстрируя атрибут JsonIgnore, исключая отправку данных клиенту, и атрибут JsonProperty для уменьшения размера сообщения**

[!code-csharp[Main](signalr-performance/samples/sample1.cs?highlight=5,7,10)]

Для того, чтобы сохранить читаемость/обслуживание в клиентском коде, сокращенное имя собственности может быть переветрено к именам, удобным для человека, после получения сообщения. Следующий пример кода демонстрирует один из возможных способов переошивания сокращенных имен на более `reMap` длинные, путем определения контракта на сообщение (отображение) и использования функции для применения контракта к оптимизированному классу сообщений:

**Код JavaScript на стороне клиента, который перенаговал сокращенные имена свойств для имен, читаемых человеком**

[!code-javascript[Main](signalr-performance/samples/sample2.js)]

Имена могут быть сокращены в сообщениях от клиента к серверу, а также, используя тот же метод.

Уменьшение памяти (т.е. объем памяти, используемой для сообщения) объекта сообщения также может повысить производительность. Например, если полный `int` диапазон не требуется, `short` или `byte` может быть использован вместо.

Поскольку сообщения хранятся в шине сообщений в памяти сервера, уменьшение размера сообщений может также решить проблемы с памятью сервера.

<a id="tuning"></a>

### <a name="tuning-your-signalr-server-for-performance"></a>Настройка сервера SignalR для производительности

Следующие настройки конфигурации могут быть использованы для настройки сервера для повышения производительности в приложении SignalR. Для получения общей информации о том, как повысить производительность в ASP.NET приложении, см [ASP.NET.](https://msdn.microsoft.com/library/ff647787.aspx)

**Настройки конфигурации SignalR**

- **DefaultMessageBufferSize**: По умолчанию SignalR сохраняет 1000 сообщений в памяти на один концентратор на подключение. При использовании больших сообщений это может привести к проблемам с памятью, которые могут быть устранены за счет уменьшения этого значения. Эта настройка может `Application_Start` быть установлена в обработчике `Configuration` событий в ASP.NET приложении или в методе запуска класса OWIN в саморазмещении приложения. Следующий пример показывает, как уменьшить это значение, чтобы уменьшить память след вашего приложения, чтобы уменьшить количество используемой памяти сервера:

    **код сервера .NET в Startup.cs для уменьшения размера буфера сообщения по умолчанию**

    [!code-csharp[Main](signalr-performance/samples/sample3.cs)]

**Настройки конфигурации IIS**

- **Одновременное количество запросов на одно приложение:** Увеличение числа одновременных запросов IIS увеличит ресурсы серверов, доступные для обслуживания запросов. Значение по умолчанию 5000; чтобы увеличить этот параметр, выполните следующие команды в повышенной оперативной версии:

    [!code-console[Main](signalr-performance/samples/sample4.cmd)]
- **ApplicationPool Очередь Длина**: Это максимальное количество запросов, которые http.sys очереди для пула приложений. Когда очередь заполнена, новые запросы получают 503 ответа «Недоступно ею» службы. Значение по умолчанию ― 1000.

    Сокращение длины очереди для рабочего процесса в пуле приложений, вмещающих приложение, позволит сохранить ресурсы памяти. Для получения дополнительной [информации см.](https://technet.microsoft.com/library/cc745955.aspx)

**ASP.NET настройки конфигурации**

Этот раздел включает параметры конфигурации, `aspnet.config` которые могут быть установлены в файле. Этот файл находится в одном из двух мест, в зависимости от платформы:

- `%windir%\Microsoft.NET\Framework\v4.0.30319\aspnet.config`
- `%windir%\Microsoft.NET\Framework64\v4.0.30319\aspnet.config`

ASP.NET настройки, которые могут улучшить производительность SignalR, включают в себя следующие:

- **Максимальные одновременные запросы на процессор**: Увеличение этого параметра может облегчить узкие места производительности. Чтобы увеличить этот параметр, добавьте `aspnet.config` следующую настройку конфигурации в файл:

    [!code-xml[Main](signalr-performance/samples/sample5.xml?highlight=4)]
- **Запрос Предела очереди**: Когда общее `maxConcurrentRequestsPerCPU` количество подключений превышает настройку, ASP.NET начнетрегулировать запросы с помощью очереди. Чтобы увеличить размер очереди, можно `requestQueueLimit` увеличить настройку. Для этого добавьте следующую настройку конфигурации `processModel` в `aspnet.config` `config/machine.config` узло (а не на):

    [!code-xml[Main](signalr-performance/samples/sample6.xml)]

<a id="troubleshooting"></a>

## <a name="troubleshooting-performance-issues"></a>Устранение проблем с производительностью

В этом разделе описаны способы поиска узких мест в приложении.

### <a name="verifying-that-websocket-is-being-used"></a>Проверка использования WebSocket

В то время как SignalR может использовать различные переносы для связи между клиентом и сервером, WebSocket предлагает значительное преимущество в производительности, и должен использоваться, если клиент и сервер поддерживают его. Чтобы определить, соответствует ли ваш клиент и сервер [Transports and Fallbacks](../getting-started/introduction-to-signalr.md#transports)требованиям WebSocket, см. Чтобы определить, какой транспорт используется в приложении, можно использовать инструменты разработчика браузера и изучить журналы, чтобы узнать, какой транспорт используется для подключения. Для получения информации об использовании инструментов разработки браузера в Internet Explorer и Chrome [см.](../getting-started/introduction-to-signalr.md#transports)

<a id="perfcounters"></a>

## <a name="using-signalr-performance-counters"></a>Использование счетчиков производительности SignalR

В этом разделе описывается, как включить и использовать `Microsoft.AspNet.SignalR.Utils` счетчики производительности SignalR, найденные в пакете.

### <a name="installing-signalrexe"></a>Установка сигнальщика.exe

Счетчики производительности могут быть добавлены на сервер с помощью утилиты под названием SignalR.exe. Чтобы установить эту утилиту, выполните следующие действия:

1. В Visual Studio выберите **Инструменты** > **NuGet менеджер** > пакета**управлять NuGet пакеты для решения**
2. Поиск **signalr.utils**и выберите Install.

    ![](signalr-performance/_static/image1.png)
3. Примите лицензионное соглашение об установке пакета.
4. SignalR.exe будет установлен `<project folder>/packages/Microsoft.AspNet.SignalR.Utils.<version>/tools`для .

### <a name="installing-performance-counters-with-signalrexe"></a>Установка счетчиков производительности с помощью SignalR.exe

Чтобы установить счетчики производительности SignalR, запустите SignalR.exe в повышенном командном запросе со следующим параметром:

[!code-console[Main](signalr-performance/samples/sample7.cmd)]

Чтобы удалить счетчики производительности SignalR, запустите SignalR.exe в повышенном запросе команды со следующим параметром:

[!code-console[Main](signalr-performance/samples/sample8.cmd)]

### <a name="signalr-performance-counters"></a>Счетчики производительности SignalR

Пакет утилит устанавливает следующие счетчики производительности. Счетчики "Всего" измеряют количество событий с момента перезапуска последнего пула приложений или сервера.

**Метрики подключения**

Следующие метрики измеряют события жизни соединения, которые происходят. Для получения дополнительной информации [см.](../guide-to-the-api/handling-connection-lifetime-events.md)

- **Подключение к соединениям**
- **Соединения повторно подключены**
- **Соединения отключены**
- **Соединения Ток**

**Метрики использования**

Следующие метрики измеряют трафик сообщений, генерируемый SignalR.

- **Сообщения о подключении, полученные всего**
- **Сообщения о подключении Отправлено Всего**
- **Полученные сообщения о подключении/Sec**
- **Сообщения о подключении Отправлено/Sec**

**Метрики шины сообщений**

Следующие метрики измеряют трафик через внутренний шину сообщений SignalR, очередь, в которой размещаются все входящие и исходящие сообщения SignalR. Сообщение **публикуется** при отправке или трансляции. **Абонентом** в этом контексте является подписка на шину сообщений; это должно равняться числу клиентов плюс самому серверу. **Распределенный работник** — это компонент, который отправляет данные на активные соединения; **Занят работник** является тот, который активно отправки сообщения.

- **Сообщения шины Сообщения Получено Всего**
- **Сообщения автобус сообщения получены / Sec**
- **Сообщения Автобус Сообщения Опубликовано Всего**
- **Сообщения автобус сообщения Опубликовано / Sec**
- **Сообщения Автобус Абоненты Текущий**
- **Сообщение Автобус Абоненты Всего**
- **Подписчики автобусов сообщений/Sec**
- **Сообщение Автобус Выделенные работники**
- **Сообщение Автобус Занятые рабочие**
- **Сообщение Автобус Темы Текущие**

**Метрики ошибок**

Следующие метрики измеряют ошибки, генерируемые трафиком сообщений SignalR. **Ошибки разрешения концентратора** возникают, когда не удается разрешить метод концентратора или концентратора. Ошибки **вызова концентратора** являются исключениями, брошенными при вызове метода концентратора. **Ошибки транспорта** являются ошибками соединения, брошенными во время запроса или ответа HTTP.

- **Ошибки: Всего**
- **Ошибки: Все/Сек**
- **Ошибки: Общее разрешение концентратора**
- **Ошибки: Разрешение концентратора/Sec**
- **Ошибки: Всего вызов концентратора**
- **Ошибки: Вызов концентратора/Sec**
- **Ошибки: Транспорт Всего**
- **Ошибки: Транспорт/Сек**

<a id="scaleout_metrics"></a>

**Показатели масштабирования**

Следующие метрики измеряют трафик и ошибки, генерируемые поставщиком масштабирования. **Поток** в этом контексте — это единица масштаба, используемая поставщиком масштабирования; это таблица, если используется S'L Server, Тема, если используется сервисный автобус, и подписка, если используется Redis. Каждый поток обеспечивает упорядоченные операции чтения и записи; один поток является потенциальным узким местом масштаба, поэтому количество потоков может быть увеличено, чтобы помочь уменьшить это узкое место. Если используется несколько потоков, SignalR будет автоматически распространять (осколок) сообщения через эти потоки таким образом, чтобы обеспечить в порядке сообщения, отправленные из любого данного соединения.

Настройка [Max'UeLength](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.messaging.scaleoutconfiguration.maxqueuelength(v=vs.118).aspx) контролирует длину очереди отправки масштаба, поддерживаемую SignalR. Установка его на значение больше 0 разместит все сообщения в очереди отправки для отправки по одному на настроенный задняя плоскость обмена сообщениями. Если размер очереди превышает настроенную длину, последующие вызовы для отправки немедленно сходят с отсутсвия с [Помощью InvalidOperationException](https://msdn.microsoft.com/library/system.invalidoperationexception(v=vs.118).aspx) до тех пор, пока количество сообщений в очереди не будет меньше, чем снова настройки. Очередь отключена по умолчанию, потому что реализованные backplanes обычно имеют свои собственные очереди или контроль потока на месте. В случае s'L Server объединение соединений эффективно ограничивает количество отправлений, проходящих в любой момент времени.

По умолчанию для Сервера и Редиса используется только один поток, пять потоков используются для Service Bus, а очереди отключены, но эти настройки можно изменить через конфигурацию на сервере S'L и Сервисном автобусе:

**Код сервера .NET для настройки количества таблиц и длины очереди для резервного самолета S'L Server**

[!code-csharp[Main](signalr-performance/samples/sample9.cs)]

**код сервера .NET для настройки количества тем и длины очереди для резервного самолета Service Bus**

[!code-csharp[Main](signalr-performance/samples/sample10.cs)]

**Буферный** поток — это поток, вошедчий в неисправное состояние; когда поток находится в неисправном состоянии, все сообщения, отправленные на заднее плоскость, немедленно не сбудутся до тех пор, пока поток больше не не будет развиться. **Длина очереди Отправки** — это количество сообщений, которые были отправлены, но еще не отправлены.

- **Полученные сообщения о перечне сообщения сообщения/sec**
- **Масштабирование потоков Всего**
- **Открытые масштабные потоки**
- **Масштабирование потоков буферизации**
- **Общее количество ошибок масштабирования**
- **Ошибки масштабирования/Sec**
- **Масштабирование Отправка Длина очереди**

Для получения дополнительной информации о том, что эти счетчики измерения, см [SignalR Масштабирование с Azure Service Bus](scaleout-with-windows-azure-service-bus.md).

<a id="othercounters"></a>

## <a name="using-other-performance-counters"></a>Использование других счетчиков производительности

Следующие счетчики производительности также могут быть полезны для мониторинга производительности приложения.

**Память**

- .NET CLR\\Память - байты во всех кучи (для w3wp)

**ASP.NET**

- ASP.NET - Запросы Текущий
- ASP.NET-Очередь
- ASP.NET -Отклонено

**Процессора**

- Информация об процессоре/Время процессора

**TCP/IP**

- TCPv6/Соединения Созданы
- TCPv4/Соединения Созданы

**Веб-сервис**

- Веб-служба (текущие подключения)
- Веб-служба-Максимальные соединения

**Потоки**

- .NET CLR Замки\\и темы - текущие логические темы
- .NET CLR замки\\и темы - текущих физических потоков

<a id="otherresources"></a>

## <a name="other-resources"></a>Другие ресурсы

Для получения дополнительной информации о мониторинге и настройке ASP.NET производительности см.

- [Общие сведения о производительности ASP.NET](https://msdn.microsoft.com/library/cc668225(v=vs.100).aspx)
- [ASP.NET использование нитей на IIS 7.5, IIS 7.0 и IIS 6.0](https://blogs.msdn.com/b/tmarq/archive/2007/07/21/asp-net-thread-usage-on-iis-7-0-and-6-0.aspx)
- [&lt;элемент&gt; applicationPool (веб-настройки)](https://msdn.microsoft.com/library/dd560842.aspx)
