---
uid: signalr/overview/performance/signalr-connection-density-testing-with-crank
title: Тестирование с помощью Crank плотности подключений SignalR | Документация Майкрософт
author: bradygaster
description: Тестирование плотности подключений SignalR с помощью Crank
ms.author: bradyg
ms.date: 02/22/2015
ms.assetid: 148d9ca7-1af1-44b6-a9fb-91e261b9b463
msc.legacyurl: /signalr/overview/performance/signalr-connection-density-testing-with-crank
msc.type: authoredcontent
ms.openlocfilehash: bb8a7da1080dc325c0479b337d114b8dcdf6e102
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/09/2019
ms.locfileid: "59390068"
---
# <a name="signalr-connection-density-testing-with-crank"></a><span data-ttu-id="7a036-103">Тестирование плотности подключений SignalR с помощью Crank</span><span class="sxs-lookup"><span data-stu-id="7a036-103">SignalR Connection Density Testing with Crank</span></span>

<span data-ttu-id="7a036-104">по [Tom FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="7a036-104">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

[!INCLUDE [Consider ASP.NET Core SignalR](~/includes/signalr/signalr-version-disambiguation.md)]

> <span data-ttu-id="7a036-105">В этой статье описывается, как использовать средство ручки для тестирования приложения с несколькими клиентами имитации.</span><span class="sxs-lookup"><span data-stu-id="7a036-105">This article describes how to use the Crank tool to test an application with multiple simulated clients.</span></span>


<span data-ttu-id="7a036-106">После запуска приложения в его среде размещения (либо Azure веб-роли, службы IIS, или размещение с помощью Owin) можно проверить ответ приложения на высокий уровень плотности подключений, используя средство ручки.</span><span class="sxs-lookup"><span data-stu-id="7a036-106">Once your application is running in its hosting environment (either an Azure web role, IIS, or self-hosted using Owin), you can test application's response to a high level of connection density using the Crank tool.</span></span> <span data-ttu-id="7a036-107">Среда размещения может быть сервер Internet Information Services (IIS), хостом Owin или веб-роли Azure.</span><span class="sxs-lookup"><span data-stu-id="7a036-107">The hosting environment can be an Internet Information Services (IIS) server, an Owin host, or an Azure web role.</span></span> <span data-ttu-id="7a036-108">(Примечание: Счетчики производительности недоступны на веб-приложениях службы приложений Azure, поэтому вы не сможете получить данные о производительности от плотности Проверка подключения.)</span><span class="sxs-lookup"><span data-stu-id="7a036-108">(Note: Performance counters are not available on Azure App Service Web Apps, so you will not be able to get performance data from a connection density test.)</span></span>

<span data-ttu-id="7a036-109">Плотность подключения ссылается на число одновременных TCP-подключений, которые можно установить на сервере.</span><span class="sxs-lookup"><span data-stu-id="7a036-109">Connection Density refers to the number of simultaneous TCP connections that can be established on a server.</span></span> <span data-ttu-id="7a036-110">Влечет за собой свой собственный издержки для каждого TCP-подключения и открыв большое количество неактивных соединений в конечном счете создаст узкое место в памяти.</span><span class="sxs-lookup"><span data-stu-id="7a036-110">Each TCP connection incurs its own overhead, and opening a large number of idle connections will eventually create a memory bottleneck.</span></span>

<span data-ttu-id="7a036-111">[SignalR codebase](https://github.com/signalr/signalr) включает нагрузочного тестирования утилиту **Crank**.</span><span class="sxs-lookup"><span data-stu-id="7a036-111">[The SignalR codebase](https://github.com/signalr/signalr) includes a load-testing tool called **Crank**.</span></span> <span data-ttu-id="7a036-112">Можно найти в последней версии Crank [ветви Dev](https://github.com/SignalR/signalr/tree/dev) на сайте GitHub.</span><span class="sxs-lookup"><span data-stu-id="7a036-112">The latest version of Crank can be found in [the Dev branch](https://github.com/SignalR/signalr/tree/dev) on GitHub.</span></span> <span data-ttu-id="7a036-113">Вы можете скачать ZIP-файла архива ветви Dev SignalR codebase [здесь](https://github.com/SignalR/SignalR/archive/dev.zip).</span><span class="sxs-lookup"><span data-stu-id="7a036-113">You can download a Zip archive of the Dev branch of the SignalR codebase [here](https://github.com/SignalR/SignalR/archive/dev.zip).</span></span>

<span data-ttu-id="7a036-114">Crank может использоваться для полностью насыщения памяти сервера, чтобы вычислить общее количество неактивных соединений, возможно на серверное оборудование.</span><span class="sxs-lookup"><span data-stu-id="7a036-114">Crank may be used to fully saturate the server's memory in order to calculate the total number of idle connections possible on the server hardware.</span></span> <span data-ttu-id="7a036-115">Кроме того вы может также использовать ручки для нагрузочного теста сервера под определенный объем нехватки памяти, увеличивать подключений, пока не будет достигнуто значение конкретного счетчика или пороговое значение памяти.</span><span class="sxs-lookup"><span data-stu-id="7a036-115">Alternatively, you may also use Crank to load test the server under a certain amount of memory pressure, by ramping up connections until a specific count or a specific memory threshold is reached.</span></span>

<span data-ttu-id="7a036-116">При тестировании, очень важно использовать удаленных клиентах, чтобы избежать любой конкуренция за ресурсы (т. е. TCP-подключения и память).</span><span class="sxs-lookup"><span data-stu-id="7a036-116">When testing, it is important to use remote client(s) to avoid any competition for resources (i.e., TCP connections and memory).</span></span> <span data-ttu-id="7a036-117">Мониторинг клиентов, чтобы убедиться, что они не превышают узкие места, которые могут помешать серверу достижения в полном объеме (памяти или ЦП).</span><span class="sxs-lookup"><span data-stu-id="7a036-117">Monitor the client(s) to ensure that they are not hitting any bottlenecks that may prevent the server from reaching its full capacity (memory or CPU).</span></span> <span data-ttu-id="7a036-118">Может потребоваться увеличить число клиентов для полной загрузки сервера.</span><span class="sxs-lookup"><span data-stu-id="7a036-118">You may need to increase the number of clients in order to fully load the server.</span></span>

### <a name="running-a-connection-density-test"></a><span data-ttu-id="7a036-119">Выполнение теста плотность подключения</span><span class="sxs-lookup"><span data-stu-id="7a036-119">Running a Connection Density Test</span></span>

<span data-ttu-id="7a036-120">В этом разделе описываются шаги, которые необходимы для запуска теста плотность подключения в приложении SignalR.</span><span class="sxs-lookup"><span data-stu-id="7a036-120">This section describes the steps needed to run a connection density test on a SignalR application.</span></span>

1. <span data-ttu-id="7a036-121">Загрузить и построить [codebase ветвь разработки SignalR](https://github.com/SignalR/SignalR/archive/dev.zip).</span><span class="sxs-lookup"><span data-stu-id="7a036-121">Download and build the [Dev branch of the SignalR codebase](https://github.com/SignalR/SignalR/archive/dev.zip).</span></span> <span data-ttu-id="7a036-122">В командной строке перейдите в раздел &lt;каталог проекта&gt;\src\Microsoft.AspNet.SignalR.Crank\bin\debug.</span><span class="sxs-lookup"><span data-stu-id="7a036-122">In a command prompt, navigate to &lt;project directory&gt;\src\Microsoft.AspNet.SignalR.Crank\bin\debug.</span></span>
2. <span data-ttu-id="7a036-123">Развернете приложение для его предполагаемой средой размещения.</span><span class="sxs-lookup"><span data-stu-id="7a036-123">Deploy your application to its intended hosting environment.</span></span> <span data-ttu-id="7a036-124">Запомните или запишите конечной точки, используемые приложением; Например, в приложение, созданное в [учебнике Приступая к работе](../getting-started/tutorial-getting-started-with-signalr.md), конечная точка имеет `http://<yourhost>:8080/signalr`.</span><span class="sxs-lookup"><span data-stu-id="7a036-124">Make a note of the endpoint that your application uses; for example, in the application created in the [Getting Started tutorial](../getting-started/tutorial-getting-started-with-signalr.md), the endpoint is `http://<yourhost>:8080/signalr`.</span></span>
3. <span data-ttu-id="7a036-125">Установка [счетчиков производительности SignalR](signalr-performance.md#perfcounters) на сервере.</span><span class="sxs-lookup"><span data-stu-id="7a036-125">Install [SignalR performance counters](signalr-performance.md#perfcounters) on the server.</span></span> <span data-ttu-id="7a036-126">Если приложение работает под управлением Azure, см. в разделе [с помощью счетчиков производительности SignalR в веб-роли Azure](using-signalr-performance-counters-in-an-azure-web-role.md).</span><span class="sxs-lookup"><span data-stu-id="7a036-126">If your application is running on Azure, see [Using SignalR Performance Counters in an Azure Web Role](using-signalr-performance-counters-in-an-azure-web-role.md).</span></span>

<span data-ttu-id="7a036-127">Как только вы загрузили и построение базы кода и установлены счетчики производительности на узле, средство командной строки Crank можно найти в `src\Microsoft.AspNet.SignalR.Crank\bin\Debug` папку.</span><span class="sxs-lookup"><span data-stu-id="7a036-127">Once you've downloaded and built the codebase, and installed performance counters on your host, the Crank command-line tool can be found in the `src\Microsoft.AspNet.SignalR.Crank\bin\Debug` folder.</span></span>

<span data-ttu-id="7a036-128">Доступные параметры для средства Crank:</span><span class="sxs-lookup"><span data-stu-id="7a036-128">Available options for the Crank tool include:</span></span>

- <span data-ttu-id="7a036-129">**/?**: Появится экран справки.</span><span class="sxs-lookup"><span data-stu-id="7a036-129">**/?**: Shows the help screen.</span></span> <span data-ttu-id="7a036-130">Доступные параметры отображаются также в том случае, если **URL-адрес** параметр пропущен.</span><span class="sxs-lookup"><span data-stu-id="7a036-130">The available options are also displayed if the **Url** parameter is omitted.</span></span>
- <span data-ttu-id="7a036-131">**/ URL-адрес**: URL-адрес для подключений SignalR.</span><span class="sxs-lookup"><span data-stu-id="7a036-131">**/Url**: The URL for SignalR connections.</span></span> <span data-ttu-id="7a036-132">Этот параметр обязателен.</span><span class="sxs-lookup"><span data-stu-id="7a036-132">This parameter is required.</span></span> <span data-ttu-id="7a036-133">Для приложения SignalR, использование сопоставления по умолчанию, путь будет завершен через «/ signalr».</span><span class="sxs-lookup"><span data-stu-id="7a036-133">For a SignalR application using the default mapping, the path will end in "/signalr".</span></span>
- <span data-ttu-id="7a036-134">**/ Транспорта**: Имя транспорта, используемого.</span><span class="sxs-lookup"><span data-stu-id="7a036-134">**/Transport**: The name of the transport used.</span></span> <span data-ttu-id="7a036-135">По умолчанию используется `auto`, который выберет наиболее протокола.</span><span class="sxs-lookup"><span data-stu-id="7a036-135">The default is `auto`, which will select the best available protocol.</span></span> <span data-ttu-id="7a036-136">Параметры включают `WebSockets`, `ServerSentEvents`, и `LongPolling` (`ForeverFrame` не подходит для ручки, так как клиент .NET, а не должен использоваться Internet Explorer).</span><span class="sxs-lookup"><span data-stu-id="7a036-136">Options include `WebSockets`, `ServerSentEvents`, and `LongPolling` (`ForeverFrame` is not an option for Crank, since the .NET client rather than Internet Explorer is used).</span></span> <span data-ttu-id="7a036-137">Дополнительные сведения о том, как SignalR выбирает транспортов, см. в разделе [транспорта и в случае ошибки](../getting-started/introduction-to-signalr.md#transports).</span><span class="sxs-lookup"><span data-stu-id="7a036-137">For more information on how SignalR selects transports, see [Transports and Fallbacks](../getting-started/introduction-to-signalr.md#transports).</span></span>
- <span data-ttu-id="7a036-138">**/ BatchSize**: Число клиентов, которые добавлены в каждом пакете.</span><span class="sxs-lookup"><span data-stu-id="7a036-138">**/BatchSize**: The number of clients added in each batch.</span></span> <span data-ttu-id="7a036-139">Значение по умолчанию — 50.</span><span class="sxs-lookup"><span data-stu-id="7a036-139">The default is 50.</span></span>
- <span data-ttu-id="7a036-140">**/ ConnectInterval**: Интервал в миллисекундах между добавлением соединения.</span><span class="sxs-lookup"><span data-stu-id="7a036-140">**/ConnectInterval**: The interval in milliseconds between adding connections.</span></span> <span data-ttu-id="7a036-141">Значение по умолчанию — 500.</span><span class="sxs-lookup"><span data-stu-id="7a036-141">The default is 500.</span></span>
- <span data-ttu-id="7a036-142">**/ Подключений**: Количество соединений, используемых для тестирования нагрузки приложения.</span><span class="sxs-lookup"><span data-stu-id="7a036-142">**/Connections**: The number of connections used to load-test the application.</span></span> <span data-ttu-id="7a036-143">Значение по умолчанию равно 100 000.</span><span class="sxs-lookup"><span data-stu-id="7a036-143">The default is 100,000.</span></span>
- <span data-ttu-id="7a036-144">**/ ConnectTimeout**: Время ожидания в секундах до прерывания тестового.</span><span class="sxs-lookup"><span data-stu-id="7a036-144">**/ConnectTimeout**: The timeout in seconds before aborting the test.</span></span> <span data-ttu-id="7a036-145">Значение по умолчанию — 300.</span><span class="sxs-lookup"><span data-stu-id="7a036-145">The default is 300.</span></span>
- <span data-ttu-id="7a036-146">**MinServerMBytes**: Минимальной серверной мегабайт для достижения.</span><span class="sxs-lookup"><span data-stu-id="7a036-146">**MinServerMBytes**: The minimum server megabytes to reach.</span></span> <span data-ttu-id="7a036-147">Значение по умолчанию — 500.</span><span class="sxs-lookup"><span data-stu-id="7a036-147">The default is 500.</span></span>
- <span data-ttu-id="7a036-148">**SendBytes**: Размер полезных данных, отправляемых на сервер, в байтах.</span><span class="sxs-lookup"><span data-stu-id="7a036-148">**SendBytes**: The size of the payload sent to the server in bytes.</span></span> <span data-ttu-id="7a036-149">Значение по умолчанию — 0.</span><span class="sxs-lookup"><span data-stu-id="7a036-149">The default is 0.</span></span>
- <span data-ttu-id="7a036-150">**SendInterval**: Задержка в миллисекундах между сообщениями на сервер.</span><span class="sxs-lookup"><span data-stu-id="7a036-150">**SendInterval**: The delay in milliseconds between messages to the server.</span></span> <span data-ttu-id="7a036-151">Значение по умолчанию — 500.</span><span class="sxs-lookup"><span data-stu-id="7a036-151">The default is 500.</span></span>
- <span data-ttu-id="7a036-152">**SendTimeout**: Время ожидания в миллисекундах для сообщений на сервер.</span><span class="sxs-lookup"><span data-stu-id="7a036-152">**SendTimeout**: The timeout in milliseconds for messages to the server.</span></span> <span data-ttu-id="7a036-153">Значение по умолчанию — 300.</span><span class="sxs-lookup"><span data-stu-id="7a036-153">The default is 300.</span></span>
- <span data-ttu-id="7a036-154">**ControllerUrl**: URL-адрес, где один клиент будет размещаться концентратор контроллера.</span><span class="sxs-lookup"><span data-stu-id="7a036-154">**ControllerUrl**: The Url where one client will host a controller hub.</span></span> <span data-ttu-id="7a036-155">Значение по умолчанию имеет значение null (нет контроллеров).</span><span class="sxs-lookup"><span data-stu-id="7a036-155">The default is null (no controller hub).</span></span> <span data-ttu-id="7a036-156">Контроллер концентратор запускается при запуске сеанса ручки; выполняется дальнейшая контакта между контроллеров и ручки.</span><span class="sxs-lookup"><span data-stu-id="7a036-156">The controller hub is started when the Crank session starts; no further contact between the controller hub and Crank is made.</span></span>
- <span data-ttu-id="7a036-157">**NumClients**: Число имитации клиентов для подключения к приложению.</span><span class="sxs-lookup"><span data-stu-id="7a036-157">**NumClients**: The number of simulated clients to connect to the application.</span></span> <span data-ttu-id="7a036-158">Значение по умолчанию — один.</span><span class="sxs-lookup"><span data-stu-id="7a036-158">The default is one.</span></span>
- <span data-ttu-id="7a036-159">**Файл журнала**: Имя файла для файла журнала для тестового запуска.</span><span class="sxs-lookup"><span data-stu-id="7a036-159">**Logfile**: The filename for the logfile for the test run.</span></span> <span data-ttu-id="7a036-160">Значение по умолчанию — `crank.csv`.</span><span class="sxs-lookup"><span data-stu-id="7a036-160">The default is `crank.csv`.</span></span>
- <span data-ttu-id="7a036-161">**SampleInterval**: Время в миллисекундах между значения выборки счетчиков производительности.</span><span class="sxs-lookup"><span data-stu-id="7a036-161">**SampleInterval**: The time in milliseconds between performance counter samples.</span></span> <span data-ttu-id="7a036-162">Значение по умолчанию — 1000.</span><span class="sxs-lookup"><span data-stu-id="7a036-162">The default is 1000.</span></span>
- <span data-ttu-id="7a036-163">**SignalRInstance**: Имя экземпляра для счетчиков производительности на сервере.</span><span class="sxs-lookup"><span data-stu-id="7a036-163">**SignalRInstance**: The instance name for the performance counters on the server.</span></span> <span data-ttu-id="7a036-164">Значение по умолчанию — использовать состояние подключения клиента.</span><span class="sxs-lookup"><span data-stu-id="7a036-164">The default is to use the client connection state.</span></span>

### <a name="example"></a><span data-ttu-id="7a036-165">Пример</span><span class="sxs-lookup"><span data-stu-id="7a036-165">Example</span></span>

<span data-ttu-id="7a036-166">Следующая команда проверит узла с именем `pfsignalr` в Azure, на котором размещается приложение через порт 8080 в центре, с именем «ControllerHub», с использованием 100 соединений.</span><span class="sxs-lookup"><span data-stu-id="7a036-166">The following command will test a site called `pfsignalr` on Azure that hosts an application on port 8080 with a hub named "ControllerHub", using 100 connections.</span></span>

`crank /Connections:100 /Url:http://pfsignalr.cloudapp.net:8080/signalr`
