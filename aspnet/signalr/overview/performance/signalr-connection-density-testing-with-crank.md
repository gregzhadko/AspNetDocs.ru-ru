---
uid: signalr/overview/performance/signalr-connection-density-testing-with-crank
title: Тестирование плотности подключений SignalR с помощью погромче | Документация Майкрософт
author: bradygaster
description: Тестирование плотности подключений SignalR с помощью Crank
ms.author: bradyg
ms.date: 02/22/2015
ms.assetid: 148d9ca7-1af1-44b6-a9fb-91e261b9b463
msc.legacyurl: /signalr/overview/performance/signalr-connection-density-testing-with-crank
msc.type: authoredcontent
ms.openlocfilehash: 901e039fbb81651ed18d560c99745b7e7f716e01
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78449874"
---
# <a name="signalr-connection-density-testing-with-crank"></a>Тестирование плотности подключений SignalR с помощью Crank

от [Tom фитзмаккен](https://github.com/tfitzmac)

[!INCLUDE [Consider ASP.NET Core SignalR](~/includes/signalr/signalr-version-disambiguation.md)]

> В этой статье описывается использование средства погромче для тестирования приложения с несколькими имитируемыми клиентами.

После запуска приложения в среде размещения (веб-роль Azure, IIS или локально размещенная с помощью Owin) можно проверить ответ приложения на высокий уровень плотности подключения с помощью средства погромче. Средой размещения может быть сервер службы IIS (IIS), узел Owin или веб-роль Azure. (Примечание. счетчики производительности недоступны в веб-приложениях службы приложений Azure, поэтому вы не сможете получать данные о производительности из теста плотности подключений.)

Плотность соединения означает количество одновременных TCP-подключений, которые могут быть установлены на сервере. Каждое TCP-подключение имеет собственные издержки, и открытие большого количества бездействующих соединений в конечном итоге приведет к появления узкого места в памяти.

[База кода SignalR](https://github.com/signalr/signalr) включает средство тестирования нагрузки, именуемое **погромче**. Последнюю версию погромче можно найти в [ветви dev](https://github.com/SignalR/signalr/tree/dev) на сайте GitHub. Вы можете скачать ZIP-архив ветви dev в [базе кода SignalR](https://github.com/SignalR/SignalR/archive/dev.zip).

Погромче может использоваться для полной насыщенности памяти сервера, чтобы вычислить общее число бездействующих подключений к серверному оборудованию. Кроме того, можно также использовать погромче для нагрузочного тестирования сервера с определенным объемом нехватки памяти путем увеличения числа подключений до достижения определенного количества или определенного порога памяти.

При тестировании важно использовать удаленные клиенты, чтобы избежать конкуренции за ресурсы (т. е. TCP-подключения и память). Отслеживайте клиентов, чтобы убедиться, что они не достигли узких мест, которые могут помешать серверу достичь полной емкости (памяти или ЦП). Чтобы полностью загрузить сервер, может потребоваться увеличить число клиентов.

### <a name="running-a-connection-density-test"></a>Выполнение теста плотности подключений

В этом разделе описаны шаги, необходимые для выполнения теста плотности подключений в приложении SignalR.

1. Скачайте и создайте [ветвь Dev базы кода SignalR](https://github.com/SignalR/SignalR/archive/dev.zip). В командной строке перейдите к &lt;каталог проекта&gt;\Срк\микрософт.АСПнет.сигналр.кранк\бин\дебуг.
2. Разверните приложение в предполагаемой среде размещения. Запишите конечную точку, которую использует ваше приложение. Например, в приложении, созданном в [Начало работы руководстве](../getting-started/tutorial-getting-started-with-signalr.md), конечная точка `http://<yourhost>:8080/signalr`.
3. Установите [счетчики производительности SignalR](signalr-performance.md#perfcounters) на сервере. Если приложение выполняется в Azure, см. статью [Использование счетчиков производительности SignalR в веб-роли Azure](using-signalr-performance-counters-in-an-azure-web-role.md).

После загрузки и сборки базы кода, а также установки счетчиков производительности на узле средство командной строки погромче можно найти в папке `src\Microsoft.AspNet.SignalR.Crank\bin\Debug`.

Доступные параметры для средства погромче:

- **/?** : Отображает экран справки. Доступные параметры также отображаются, если пропущен параметр **URL-адреса** .
- **/УРЛ**: URL-адрес для соединений SignalR. Этот параметр является обязательным. Для приложения SignalR, использующего сопоставление по умолчанию, путь заканчивается на "/SignalR".
- **/Транспорт**: имя используемого транспорта. Значение по умолчанию — `auto`, в результате чего выбирается лучший доступный протокол. К параметрам относятся `WebSockets`, `ServerSentEvents`и `LongPolling` (`ForeverFrame` не является параметром для погромче, так как используется клиент .NET, а не Internet Explorer). Дополнительные сведения о том, как SignalR выбирает транспорты, см. в разделе [транспорты и резервные](../getting-started/introduction-to-signalr.md#transports).
- **/BatchSize**: число клиентов, добавленных в каждом пакете. Число по умолчанию — 50.
- **/Коннектинтервал**: интервал в миллисекундах между добавлением соединений. Значение по умолчанию — 500.
- **/Коннектионс**: количество подключений, используемых для загрузки и тестирования приложения. Значение по умолчанию — 100 000.
- **/Коннекттимеаут**. время ожидания в секундах перед отменой теста. Значение по умолчанию — 300.
- **Минсервермбитес**: минимальный сервер, к которому необходимо получить доступ. Значение по умолчанию — 500.
- **Сендбитес**: размер полезных данных, отправляемых на сервер в байтах. Значение по умолчанию равно 0.
- **Сендинтервал**: задержка между сообщениями на сервере (в миллисекундах). Значение по умолчанию — 500.
- **SendTimeout**: время ожидания сообщений на сервере (в миллисекундах). Значение по умолчанию — 300.
- **Контроллерурл**: URL-адрес, по которому на одном клиенте будет размещен концентратор контроллера. Значение по умолчанию — NULL (нет концентратора контроллера). Концентратор контроллера запускается при запуске сеанса погромче. нет дополнительных контактов между концентратором контроллера и погромче.
- **Нумклиентс**: число имитируемых клиентов для подключения к приложению. Значение по умолчанию — One.
- **Файл_журнала**: имя файла журнала для тестового запуска. Значение по умолчанию — `crank.csv`.
- **SampleInterval**: время в миллисекундах между примерами счетчика производительности. Значение по умолчанию — 1000.
- **Сигналринстанце**: имя экземпляра для счетчиков производительности на сервере. По умолчанию используется состояние подключения клиента.

### <a name="example"></a>Пример

Следующая команда проверит сайт с именем `pfsignalr` в Azure, в котором размещено приложение на порту 8080 с концентратором с именем "Контроллерхуб" с использованием 100 подключений.

`crank /Connections:100 /Url:http://pfsignalr.cloudapp.net:8080/signalr`
