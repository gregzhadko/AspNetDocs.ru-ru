---
uid: signalr/overview/security/hub-authorization
title: Проверка подлинности и авторизация для концентраторов SignalR | Документация Майкрософт
author: bradygaster
description: В этом разделе описывается, как ограничить, какие пользователи или роли можно получить доступ к методам концентратора. В этом разделе версий программного обеспечения используется продуктом Visual Studio 2013 .NET 4.5 SignalR...
ms.author: bradyg
ms.date: 01/05/2015
ms.assetid: a610c796-c131-473c-baef-2e6c568cb2a2
msc.legacyurl: /signalr/overview/security/hub-authorization
msc.type: authoredcontent
ms.openlocfilehash: 5006af5e623da6958a6d59949c6f2cf776c77fc3
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2019
ms.locfileid: "65113641"
---
# <a name="authentication-and-authorization-for-signalr-hubs"></a>Проверка подлинности и авторизация для концентраторов SignalR

по [Флетчера Патрик](https://github.com/pfletcher), [Tom FitzMacken](https://github.com/tfitzmac)

[!INCLUDE [Consider ASP.NET Core SignalR](~/includes/signalr/signalr-version-disambiguation.md)]

> В этом разделе описывается, как ограничить, какие пользователи или роли можно получить доступ к методам концентратора.
>
> ## <a name="software-versions-used-in-this-topic"></a>Версии программного обеспечения, используемого в этом разделе
>
>
> - [Visual Studio 2013](https://my.visualstudio.com/Downloads?q=visual%20studio%202013)
> - .NET 4.5
> - SignalR версии 2
>
>
>
> ## <a name="previous-versions-of-this-topic"></a>Предыдущие версии этого раздела
>
> Сведения о более ранних версий SignalR, см. в разделе [более старых версий SignalR](../older-versions/index.md).
>
> ## <a name="questions-and-comments"></a>Вопросы и комментарии
>
> Оставьте свои отзывы на том, как вам понравилось, и этот учебник и что можно улучшить в комментариях в нижней части страницы. Если у вас есть вопросы, которые не имеют отношения к руководству, их можно разместить [форум по ASP.NET SignalR](https://forums.asp.net/1254.aspx/1?ASP+NET+SignalR) или [StackOverflow.com](http://stackoverflow.com/).

## <a name="overview"></a>Обзор

В этом разделе содержатся следующие подразделы.

- [Авторизовать атрибут](#authorizeattribute)
- [Требовать проверку подлинности для всех концентраторов](#requireauth)
- [Настраиваемой авторизации](#custom)
- [Передать сведения о проверке подлинности для клиентов](#passauth)
- [Параметры проверки подлинности для клиентов .NET](#authoptions)

    - [Файл cookie с помощью форм](#cookie)
    - [Проверка подлинности Windows](#windows)
    - [Заголовка соединения](#header)
    - [Сертификат](#certificate)

<a id="authorizeattribute"></a>

## <a name="authorize-attribute"></a>Авторизовать атрибут

SignalR обеспечивает [Authorize](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.authorizeattribute(v=vs.111).aspx) атрибут, чтобы указать, какие пользователи или роли имеют доступ к концентратору или метод. Этот атрибут находится в `Microsoft.AspNet.SignalR` пространства имен. Можно применить `Authorize` к концентратору или отдельные методы в концентраторе атрибут. При применении `Authorize` все методы в концентраторе применяется атрибут к классу концентратора, к указанной авторизации. В этом разделе приведены примеры различных типов требований к авторизации, которые можно применить. Без `Authorize` атрибут, подключенный клиент может получить доступ к любому открытому методу на концентраторе.

Если вы определили роль с именем «Admin» в веб-приложении, можно указать только пользователи в этой роли можно получить доступ к концентратору следующим кодом.

[!code-csharp[Main](hub-authorization/samples/sample1.cs)]

Или можно указать, что концентратор содержит один метод, который доступен всем пользователям, а второй метод, который доступен только пользователям, прошедшим проверку, как показано ниже.

[!code-csharp[Main](hub-authorization/samples/sample2.cs)]

Следующие примеры сценариев авторизации:

- `[Authorize]` — только прошедшие проверку пользователи
- `[Authorize(Roles = "Admin,Manager")]` — только прошедшим проверку подлинности пользователей в указанных ролей
- `[Authorize(Users = "user1,user2")]` — только прошедшим проверку подлинности пользователей с помощью указанных имен пользователя
- `[Authorize(RequireOutgoing=false)]` — только прошедшие проверку подлинности пользователи могут вызывать концентратора, но и вызовы с сервера клиентам не ограничены по авторизации, например, при только определенные пользователи могут отправлять сообщения, но все остальные могут принимать сообщения. Свойство RequireOutgoing может применяться только к весь центр, не для отдельных пользователей методов в концентраторе. Когда RequireOutgoing не присвоено значение false, только пользователи, соответствующие требованиям к авторизации называются с сервера.

<a id="requireauth"></a>

## <a name="require-authentication-for-all-hubs"></a>Требовать проверку подлинности для всех концентраторов

Можно потребовать проверку подлинности для всех концентраторам и методам концентраторов в приложении, вызвав [RequireAuthentication](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hubpipelineextensions.requireauthentication(v=vs.111).aspx) метод при запуске приложения. Этот метод можно использовать после нескольких концентраторов и хотите применить требования проверки подлинности для всех из них. С помощью этого метода невозможно указать требования к авторизации исходящих, пользователя или роли. Можно только указать, что доступ к методам концентратора является аутентифицированным пользователям. Тем не менее по-прежнему можно применить атрибут Authorize концентраторов или методы, чтобы указать дополнительные требования. Любое требование, указываемых в атрибут добавляется к основным требованием проверки подлинности.

В следующем примере файл запуска, который ограничивает все методы концентратора пользователям, прошедшим проверку.

[!code-csharp[Main](hub-authorization/samples/sample3.cs)]

При вызове метода `RequireAuthentication()` вызовет метод после обработки запрос SignalR, SignalR `InvalidOperationException` исключение. SignalR создает это исключение, так как не удается добавить модуль в конвейер концентратора после вызова конвейера. В предыдущем примере показан вызов `RequireAuthentication` метод в `Configuration` метод, который выполняется один раз до обработки первого запроса.

<a id="custom"></a>

## <a name="customized-authorization"></a>Настраиваемой авторизации

Если вам нужно настроить, как авторизация, можно создать класс, производный от `AuthorizeAttribute` и переопределить [UserAuthorized](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.authorizeattribute.userauthorized(v=vs.111).aspx) метод. Для каждого запроса SignalR вызывает этот метод, чтобы определить, авторизован ли пользователь для выполнения запроса. В переопределенном методе предоставляют необходимую логику для вашего сценария авторизации. В следующем примере показано, как для принудительного применения авторизации с помощью удостоверений на основе утверждений.

[!code-csharp[Main](hub-authorization/samples/sample4.cs)]

<a id="passauth"></a>

## <a name="pass-authentication-information-to-clients"></a>Передать сведения о проверке подлинности для клиентов

Может потребоваться использовать сведения о проверке подлинности в код, который выполняется на стороне клиента. Необходимые сведения, указываемые при вызове методов на стороне клиента. Например метод приложения чата можно передать как параметр имя пользователя как пользователь, отправляющий сообщение, как показано ниже.

[!code-csharp[Main](hub-authorization/samples/sample5.cs)]

Или можно создать объект для представления сведения для проверки подлинности и передать этот объект в качестве параметра, как показано ниже.

[!code-csharp[Main](hub-authorization/samples/sample6.cs)]

Никогда не следует передавать один клиентский идентификатор подключения для других клиентов, как пользователь-злоумышленник может использовать для имитации запроса от клиента.

<a id="authoptions"></a>

## <a name="authentication-options-for-net-clients"></a>Параметры проверки подлинности для клиентов .NET

При наличии клиент .NET, например, консольного приложения, которое взаимодействует с концентратором, ограниченную проверку подлинности пользователей, можно передать учетные данные проверки подлинности в файле cookie, заголовке соединение или сертификата. Примеры в этом разделе показано, как использовать эти различные методы для проверки подлинности пользователя. Они не являются полнофункциональные приложения SignalR. Дополнительные сведения о клиентах .NET с помощью SignalR см. в разделе [руководство по API концентраторов — клиент .NET](../guide-to-the-api/hubs-api-guide-net-client.md).

<a id="cookie"></a>

### <a name="cookie"></a>Куки-файл

Когда клиент .NET взаимодействует с к концентратору, который использует проверку подлинности форм ASP.NET, необходимо вручную задать файл cookie проверки подлинности для соединения. Добавьте файл cookie для `CookieContainer` свойство [HubConnection](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.client.hubs.hubconnection(v=vs.111).aspx) объекта. Следующий пример показывает консольное приложение, которое получает файл cookie проверки подлинности с веб-страниц и добавляет этот файл cookie подключения.

[!code-csharp[Main](hub-authorization/samples/sample7.cs)]

Консольное приложение отправляет учетные данные для <strong>www.contoso.com/RemoteLogin</strong> которого может ссылаться на пустую страницу, которая содержит следующие файлы кода.

[!code-csharp[Main](hub-authorization/samples/sample8.cs)]

<a id="windows"></a>

### <a name="windows-authentication"></a>Аутентификация Windows

При использовании проверки подлинности Windows, можно передать учетные данные текущего пользователя с помощью [DefaultCredentials](https://msdn.microsoft.com/library/system.net.credentialcache.defaultcredentials.aspx) свойство. Присвоено значение DefaultCredentials учетные данные для подключения.

[!code-csharp[Main](hub-authorization/samples/sample9.cs?highlight=6)]

<a id="header"></a>

### <a name="connection-header"></a>Заголовка соединения

Если приложение не использует файлы cookie, можно передать сведения о пользователе в заголовке соединение. Например можно передать маркер в заголовке соединение.

[!code-csharp[Main](hub-authorization/samples/sample10.cs?highlight=6)]

Затем в концентраторе, то следует проверить маркер пользователя.

<a id="certificate"></a>

### <a name="certificate"></a>Сертификат

Вы можете передать сертификат клиента для проверки пользователя. Добавьте сертификат при создании подключения. Следующий пример показывает только то, как добавить сертификат клиента для подключения; он не отображается полное консольное приложение. Она использует [X509Certificate](https://msdn.microsoft.com/library/system.security.cryptography.x509certificates.x509certificate.aspx) класс, который предоставляет несколько способов создания сертификата.

[!code-csharp[Main](hub-authorization/samples/sample11.cs?highlight=6)]
