---
uid: signalr/overview/getting-started/tutorial-high-frequency-realtime-with-signalr
title: Учебник. Создание приложения в режиме реального времени с высокой частотой с SignalR 2 | Документация Майкрософт
author: bradygaster
description: Этом руководстве показано, как создать веб-приложения, использующего ASP.NET SignalR для предоставления функции обмена сообщениями с высокой частотой.
ms.author: bradyg
ms.date: 01/22/2019
ms.assetid: 9f969dda-78ea-4329-b1e3-e51c02210a2b
msc.legacyurl: /signalr/overview/getting-started/tutorial-high-frequency-realtime-with-signalr
msc.type: authoredcontent
ms.topic: tutorial
ms.openlocfilehash: 44aaa2b0c059de310e963f642fa56c2f00a7e443
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/01/2019
ms.locfileid: "57025001"
---
# <a name="tutorial-create-high-frequency-real-time-app-with-signalr-2"></a>Учебник. Создание приложения в режиме реального времени с высокой частотой с SignalR 2

Этом руководстве показано, как создать веб-приложения, использующего ASP.NET SignalR 2 для предоставления функции обмена сообщениями с высокой частотой. В этом случае «обмена сообщениями высоких частот» означает, что сервер отправляет обновления по фиксированной ставке. Вы отправляете до 10 сообщений в секунду.

Созданное вами приложение отображает фигуры, пользователи смогут перетаскивать. Сервер обновляет положение фигуры на всех подключенных браузеров в соответствии с положение перетаскиваемого фигуры, с помощью синхронизированного обновления.

Основные понятия, представленных в этом руководстве имеют приложений в режиме реального времени играх и других приложений моделирования.

В этом учебнике рассмотрены следующие задачи.

> [!div class="checklist"]
> * Настройка проекта
> * Создание базового приложения
> * Сопоставить к концентратору, при запуске приложения
> * Добавление клиента
> * Запуск приложения
> * Добавить цикл клиента
> * Добавление сервера выполните циклический
> * Добавление анимации

[!INCLUDE [Consider ASP.NET Core SignalR](~/includes/signalr/signalr-version-disambiguation.md)]

## <a name="prerequisites"></a>Предварительные требования

* [Visual Studio 2017](https://visualstudio.microsoft.com/downloads/) с **ASP.NET и веб-разработка** рабочей нагрузки.

## <a name="set-up-the-project"></a>Настройка проекта

В этом разделе вы создадите проект в Visual Studio 2017.

В этом разделе показано, как использовать Visual Studio 2017 для создания пустой веб-приложения ASP.NET и добавление библиотек SignalR и jQuery.UI.

1. В Visual Studio создайте веб-приложения ASP.NET.

    ![Создание веб-](tutorial-high-frequency-realtime-with-signalr/_static/image1.png)

1. В **новый веб-приложение ASP.NET - MoveShapeDemo** окне оставьте **пустой** затем выберите **ОК**.

1. В **обозревателе решений**, щелкните правой кнопкой мыши проект и выберите **добавить** > **новый элемент**.

1. В **Добавление нового элемента — MoveShapeDemo**выберите **установленные** > **Visual C#**   >  **Web**  >  **SignalR** , а затем выберите **класс концентратора SignalR (v2)**.

1. Назовите класс *MoveShapeHub* и добавьте его в проект.

    На этом шаге создается *MoveShapeHub.cs* файл класса. Одновременно он добавляет набор файлов сценариев и ссылки на сборки, которые поддерживают SignalR в проект.

1. Выберите **средства** > **диспетчер пакетов NuGet** > **консоль диспетчера пакетов**.

1. В **консоль диспетчера пакетов**, выполните следующую команду:

    ```console
    Install-Package jQuery.UI.Combined
    ```

    Команда устанавливает библиотеки jQuery UI. Используется для анимации фигуры.

1. В **обозревателе решений**, разверните узел скриптов.

    ![Ссылки на библиотеку скрипта](tutorial-high-frequency-realtime-with-signalr/_static/image2.png)

    Библиотеки скрипта для jQuery, jQueryUI и SignalR, отображаются в проект.

## <a name="create-the-base-application"></a>Создание базового приложения

В этом разделе вы создадите приложение браузера. Приложение отправляет расположение фигуры на сервер во время каждого события перемещения мыши. Сервер осуществляет широковещательную передачу эти сведения для всех других подключенных клиентов в режиме реального времени. Вы узнаете об этом приложении в следующих разделах.

1. Откройте *MoveShapeHub.cs* файла.

1. Замените код в *MoveShapeHub.cs* файла следующим кодом:

    [!code-csharp[Main](tutorial-high-frequency-realtime-with-signalr/samples/sample1.cs)]

1. Сохраните файл.

`MoveShapeHub` Класс является реализацией концентратор SignalR. Как и в [начало работы с SignalR](tutorial-getting-started-with-signalr.md) руководстве концентратора есть метод, который клиенты вызывать напрямую. В этом случае клиент посылает объект с новой X и Y координаты фигуры на сервер. Эти координаты получить широковещательная рассылка для всех других подключенных клиентов. SignalR автоматически сериализует этого объекта с помощью JSON.

Приложение отправляет `ShapeModel` объект клиенту. Содержит члены для хранения позиции фигуры. Версия объекта на сервере также содержится элемент для отслеживания хранения данных какой клиент. Этот объект не позволяет отправлять данные клиента само на себя сервер. Использует этот член `JsonIgnore` атрибут, чтобы приложение из сериализации данных и отправкой обратно клиенту.

## <a name="map-to-the-hub-when-app-starts"></a>Сопоставить к концентратору, при запуске приложения

Затем можно настроить сопоставление концентратору при запуске приложения. В SignalR 2 Добавление класса запуска OWIN создает сопоставление.

1. В **обозревателе решений**, щелкните правой кнопкой мыши проект и выберите **добавить** > **новый элемент**.

1. В **Добавление нового элемента — MoveShapeDemo** выберите **установленные** > **Visual C#**   >  **Web** и затем Выберите **класс запуска OWIN**.

1. Назовите класс *запуска* и выберите **ОК**.

1. Замените код по умолчанию в *Startup.cs* файла следующим кодом:

    [!code-csharp[Main](tutorial-high-frequency-realtime-with-signalr/samples/sample2.cs)]

Вызовы класса запуска OWIN `MapSignalR` при выполнении приложения `Configuration` метод. Приложение добавляет класс запуска OWIN в обработке в режиме `OwinStartup` атрибут сборки.

## <a name="add-the-client"></a>Добавление клиента

Добавьте HTML-страницы для клиента.

1. В **обозревателе решений**, щелкните правой кнопкой мыши проект и выберите **добавить** > **HTML-страницу**.

1. Присвойте странице имя **по умолчанию** и выберите **ОК**.

1. В **обозревателе решений**, щелкните правой кнопкой мыши *Default.html* и выберите **задать в качестве начальной страницы**.

1. Замените код по умолчанию в *Default.html* файла следующим кодом:

    [!code-html[Main](tutorial-high-frequency-realtime-with-signalr/samples/sample3.html?highlight=14-16)]

1. В **обозревателе решений**, разверните **сценариев**.

    Библиотеки скрипта для jQuery и SignalR, отображаются в проект.

    > [!IMPORTANT]
    > Диспетчер пакетов устанавливается более поздняя версия скрипты SignalR.

1. Обновите ссылки на скрипты в блоке кода в соответствии с версии файлов скриптов в проекте.

Этот код HTML и JavaScript создает красный `div` вызывается `shape`. Он включает поведение перетаскивания фигуры, с помощью библиотеки jQuery и использует `drag` событий для отправки положение фигуры на сервер.

## <a name="run-the-app"></a>Запуск приложения

Приложение можно запустить для se'e его работы. При перетаскивании фигуры вокруг окна браузера фигуры слишком перемещает в других браузерах.

1. На панели инструментов, включите **отладки скриптов** и затем нажмите кнопку воспроизведения, чтобы запустить приложение в режиме отладки.

    ![Снимок экрана: Включение режим отладки и выбрав play пользователя.](tutorial-high-frequency-realtime-with-signalr/_static/image3.png)

    Откроется окно браузера с красным фигуры в правом верхнем углу.

1. Скопируйте URL-адрес страницы.

1. Откройте другой браузер и вставьте URL-адрес в адресной строке.

1. Перетащите фигуру в одном из окна браузера. Ниже приведен фигуры в другом окне браузера.

Хотя приложение функции, с помощью этого метода, не рекомендуемые модель программирования. Не ограничено верхней количеству начало отправленных сообщений. Таким образом клиенты и сервер получить перегружены сообщений и производительность снижается. Кроме того в приложении отображается анимированный значок несвязанном на стороне клиента. Эта анимация рывками происходит потому, что фигуры мгновенно перемещает каждым методом. Это лучше, если фигура плавно перемещается каждого нового расположения. Далее вы узнаете, как устранить эти проблемы.

## <a name="add-the-client-loop"></a>Добавить цикл клиента

Отправка расположение фигуры на каждое событие перемещения мыши создает ненужные объема сетевого трафика. Приложению необходимо регулировать сообщения от клиента.

Используйте javascript `setInterval` функции, чтобы настроить цикл, который отправляет на сервер по фиксированной ставке новые сведения о положении. Этот цикл представляет основные «цикла игры». Это многократно вызванной функции, которые можно применить все функциональные возможности игры.

1. Замените код клиента в *Default.html* файла следующим кодом:

    [!code-html[Main](tutorial-high-frequency-realtime-with-signalr/samples/sample4.html?highlight=14-16)]

    > [!IMPORTANT]
    > Необходимо заменить ссылки на скрипты еще раз. Они должны соответствовать версиям сценариев в проекте.

    Этот новый код добавляет `updateServerModel` функции. Он вызывается с фиксированной частотой. Функция отправляет на сервер данные положения всякий раз, когда `moved` флаг указывает, что новые данные позиции для отправки.

1. Нажмите кнопку воспроизведения, чтобы запустить приложение

1. Скопируйте URL-адрес страницы.

1. Откройте другой браузер и вставьте URL-адрес в адресной строке.

1. Перетащите фигуру в одном из окна браузера. Ниже приведен фигуры в другом окне браузера.

Так как приложение регулирует количество сообщений, отправляемых на сервер, анимация не будет отображаться как smooth был сначала.

## <a name="add-the-server-loop"></a>Добавление сервера выполните циклический

В текущем приложении сообщения, отправленные с сервера клиенту иду так часто, как их получения. Этот сетевой трафик представляется подобную проблему, как показано на стороне клиента.

Приложение может отправлять сообщения чаще, чем они требуются. Соединение может стать распространяются в результате. В этом разделе описывается, как для обновления сервера, чтобы добавить таймер, который регулирует скорость исходящих сообщений.

1. Замените содержимое файла `MoveShapeHub.cs` следующим кодом:

    [!code-csharp[Main](tutorial-high-frequency-realtime-with-signalr/samples/sample5.cs)]

1. Нажмите кнопку воспроизведения, чтобы запустить приложение.

1. Скопируйте URL-адрес страницы.

1. Откройте другой браузер и вставьте URL-адрес в адресной строке.

1. Перетащите фигуру в одном из окна браузера.

Этот код при развертывании клиента, чтобы добавить `Broadcaster` класса. Новый класс регулирует исходящих сообщений, с помощью `Timer` класс из .NET framework.

Рекомендуется узнать, что сам концентратор является временным. Оно создается каждый раз при необходимости. Поэтому приложение создает `Broadcaster` как единственный экземпляр. Используется отложенная инициализация отложить `Broadcaster`его создания, если она нужна. Гарантирующий, что приложение создает первый экземпляр концентратора полностью до запуска таймера.

Вызов клиентов `UpdateShape` функция затем перемещается за пределы центра `UpdateModel` метод. Больше не вызывается немедленно в том случае, когда приложение получает входящие сообщения. Вместо этого приложение отправляет сообщения на клиентах со скоростью 25 вызовов в секунду. Этот процесс управляется `_broadcastLoop` таймера изнутри `Broadcaster` класса.

Наконец, вместо вызова метода клиента от концентратора напрямую, `Broadcaster` классу необходимо получить ссылку на данный момент операционной `_hubContext` концентратора. Он возвращает ссылку на с `GlobalHost`.

## <a name="add-smooth-animation"></a>Добавление анимации

Оно будет почти все готово, но можно сделать один Дополнительные улучшения. Приложение перемещает фигуры на клиенте в ответ на сообщения сервера. Вместо задания позиции фигуры в новое расположение, заданным на сервере, используйте библиотеку JQuery UI `animate` функции. Он может перемещать фигуру плавно между его текущим и новым позиции.

1. Обновление клиента `updateShape` метод в *Default.html* файл, чтобы он выглядел выделенный код:

    [!code-html[Main](tutorial-high-frequency-realtime-with-signalr/samples/sample6.html?highlight=33-40)]

1. Нажмите кнопку воспроизведения, чтобы запустить приложение.

1. Скопируйте URL-адрес страницы.

1. Откройте другой браузер и вставьте URL-адрес в адресной строке.

1. Перетащите фигуру в одном из окна браузера.

Перемещение фигуры в другом окне появляется менее рывками. Приложение выполняет интерполяцию выкатиться за время, а не значение один раз на входящее сообщение.

Этот код перемещает фигуру из старой позиции в новую. Сервер предоставляет позицию фигуры в ходе анимации интервала. В этом случае это 100 миллисекунд. Приложение очищает любые предыдущие анимацию на фигуре перед началом новой анимации.

## <a name="get-the-code"></a>Получение кода

[Скачать завершенный проект](http://code.msdn.microsoft.com/SignalR-20-MoveShape-Demo-6285b83a)

## <a name="additional-resources"></a>Дополнительные ресурсы

Парадигма связи, вы узнали о полезен для разработки игр и других режимов моделирования, как [ShootR игры, созданные с помощью SignalR](https://shootr.azurewebsites.net/).

Дополнительные сведения о SignalR см. следующие ресурсы:

* [Проект SignalR](http://signalr.net)

* [SignalR GitHub и примерами](https://github.com/SignalR/SignalR)

* [Вики-сайте SignalR](https://github.com/SignalR/SignalR/wiki)

## <a name="next-steps"></a>Следующие шаги

В этом учебнике рассмотрены следующие задачи.

> [!div class="checklist"]
> * Настройка проекта
> * Создания базового приложения
> * Сопоставленные в центр, при запуске приложения
> * Добавлении клиента
> * Запускаю приложение
> * Добавить цикл клиента
> * Добавить сервер
> * Добавлена создавать плавную анимацию

Перейдите к следующей статье, чтобы научиться создавать веб-приложения, использующего ASP.NET SignalR 2 для предоставления широковещательных функциональные возможности сервера.
> [!div class="nextstepaction"]
> [SignalR 2 и широковещательная рассылка сервера](tutorial-server-broadcast-with-signalr.md)