---
uid: signalr/overview/getting-started/real-time-web-applications-with-signalr
title: Практическое лабораторное занятие. В режиме реального времени веб-приложений с помощью SignalR | Документация Майкрософт
author: bradygaster
description: В режиме реального времени веб-приложений имеют возможность отправлять содержимое подключенным клиентам оказывается, в режиме реального времени на стороне сервера. Для разработчиков ASP.NET, ASP...
ms.author: bradyg
ms.date: 07/16/2014
ms.assetid: ba07958c-42e1-4da0-81db-ba6925ed6db0
msc.legacyurl: /signalr/overview/getting-started/real-time-web-applications-with-signalr
msc.type: authoredcontent
ms.openlocfilehash: 3db54a134e8f842cab1d3471c69f5a8e2039d83d
ms.sourcegitcommit: 289e051cc8a90e8f7127e239fda73047bde4de12
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/25/2019
ms.locfileid: "58423615"
---
<a name="hands-on-lab-real-time-web-applications-with-signalr"></a><span data-ttu-id="a0cd9-104">Практическое лабораторное занятие. Веб-приложения в режиме реального времени с SignalR</span><span class="sxs-lookup"><span data-stu-id="a0cd9-104">Hands On Lab: Real-Time Web Applications with SignalR</span></span>
====================

<span data-ttu-id="a0cd9-105">по [Web Слышатся Team](https://twitter.com/webcamps)</span><span class="sxs-lookup"><span data-stu-id="a0cd9-105">by [Web Camps Team](https://twitter.com/webcamps)</span></span>

[!INCLUDE [Consider ASP.NET Core SignalR](~/includes/signalr/signalr-version-disambiguation.md)]

[<span data-ttu-id="a0cd9-106">Скачайте комплект учебных материалов по лагеря Web</span><span class="sxs-lookup"><span data-stu-id="a0cd9-106">Download Web Camps Training Kit</span></span>](https://aka.ms/webcamps-training-kit)

> <span data-ttu-id="a0cd9-107">В режиме реального времени веб-приложений имеют возможность отправлять содержимое подключенным клиентам оказывается, в режиме реального времени на стороне сервера.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-107">Real-time Web applications feature the ability to push server-side content to the connected clients as it happens, in real-time.</span></span> <span data-ttu-id="a0cd9-108">Для разработчиков ASP.NET **ASP.NET SignalR** — это библиотека, чтобы добавить функциональность в режиме реального времени веб-приложений.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-108">For ASP.NET developers, **ASP.NET SignalR** is a library to add real-time web functionality to their applications.</span></span> <span data-ttu-id="a0cd9-109">Он использует преимущества нескольких транспортов, автоматического выбора клиента и сервера лучше всего транспортировки лучше всего доступных транспорта.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-109">It takes advantage of several transports, automatically selecting the best available transport given the client and server's best available transport.</span></span> <span data-ttu-id="a0cd9-110">Он использует преимущества **WebSocket**, интерфейс API HTML5, двустороннего обмена данными между браузером и сервером.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-110">It takes advantage of **WebSocket**, an HTML5 API that enables bi-directional communication between the browser and server.</span></span>
> 
> <span data-ttu-id="a0cd9-111">**SignalR** также предоставляет простые, высокоуровневые API для этого сервера к клиенту RPC (вызывают функции JavaScript в браузерах клиентов из кода .NET на стороне сервера) в приложении ASP.NET, а также добавление полезные обработчики для управления подключениями как отключить или подключить события, группирования подключений и авторизации.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-111">**SignalR** also provides a simple, high-level API for doing server to client RPC (call JavaScript functions in your clients' browsers from server-side .NET code) in your ASP.NET application, as well as adding useful hooks for connection management, such as connect/disconnect events, grouping connections, and authorization.</span></span>
> 
> <span data-ttu-id="a0cd9-112">**SignalR** — это абстракция над некоторые транспорты, которые необходимы для выполнения работы в режиме реального времени между клиентом и сервером.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-112">**SignalR** is an abstraction over some of the transports that are required to do real-time work between client and server.</span></span> <span data-ttu-id="a0cd9-113">Объект **SignalR** подключения запускается как HTTP и затем повышается до **WebSocket** подключения, если он доступен.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-113">A **SignalR** connection starts as HTTP, and is then promoted to a **WebSocket** connection if available.</span></span> <span data-ttu-id="a0cd9-114">**WebSocket** является идеальным транспортом для **SignalR**, поскольку оно обеспечивает наиболее эффективное использование памяти сервера, имеет наименьшую задержку, а наиболее базовых функций (таких как полнодуплексную связь между клиентом и сервер), но у него также есть самым строгим требованиям: **WebSocket** требует, чтобы использовать сервер **Windows Server 2012** или **Windows 8**, вместе с **.NET Framework 4.5**.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-114">**WebSocket** is the ideal transport for **SignalR**, since it makes the most efficient use of server memory, has the lowest latency, and has the most underlying features (such as full duplex communication between client and server), but it also has the most stringent requirements: **WebSocket** requires the server to be using **Windows Server 2012** or **Windows 8**, along with **.NET Framework 4.5**.</span></span> <span data-ttu-id="a0cd9-115">Если эти требования не выполнены, **SignalR** будет пытаться использовать другие транспорты, чтобы сделать его подключений (таких как *Ajax, длинный опрос*).</span><span class="sxs-lookup"><span data-stu-id="a0cd9-115">If these requirements are not met, **SignalR** will attempt to use other transports to make its connections (like *Ajax long polling*).</span></span>
> 
> <span data-ttu-id="a0cd9-116">**SignalR** API содержит две модели для обмена данными между клиентами и серверами: **Постоянные подключения** и **концентраторов**.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-116">The **SignalR** API contains two models for communicating between clients and servers: **Persistent Connections** and **Hubs**.</span></span> <span data-ttu-id="a0cd9-117">Объект **подключения** представляет простой конечную точку для отправки одного получателя, группировать или широковещательной передачи сообщений.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-117">A **Connection** represents a simple endpoint for sending single-recipient, grouped, or broadcast messages.</span></span> <span data-ttu-id="a0cd9-118">Объект **концентратора** представляют собой более высокоуровневые конвейер, построенных на основе подключения API, который позволяет клиентом и сервером, для прямого вызова методов на друг с другом.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-118">A **Hub** is a more high-level pipeline built upon the Connection API that allows your client and server to call methods on each other directly.</span></span>
> 
> ![Архитектура SignalR](real-time-web-applications-with-signalr/_static/image1.png)
> 
> <span data-ttu-id="a0cd9-120">Все примеры кода и фрагменты кода включены в Web лагеря комплект обучающих материалов, доступных в [ https://aka.ms/webcamps-training-kit ](https://aka.ms/webcamps-training-kit).</span><span class="sxs-lookup"><span data-stu-id="a0cd9-120">All sample code and snippets are included in the Web Camps Training Kit, available at [https://aka.ms/webcamps-training-kit](https://aka.ms/webcamps-training-kit).</span></span>


<a id="Overview"></a>
## <a name="overview"></a><span data-ttu-id="a0cd9-121">Обзор</span><span class="sxs-lookup"><span data-stu-id="a0cd9-121">Overview</span></span>

<a id="Objectives"></a>
### <a name="objectives"></a><span data-ttu-id="a0cd9-122">Цели</span><span class="sxs-lookup"><span data-stu-id="a0cd9-122">Objectives</span></span>

<span data-ttu-id="a0cd9-123">В этой практической работу вы узнаете, как:</span><span class="sxs-lookup"><span data-stu-id="a0cd9-123">In this hands-on lab, you will learn how to:</span></span>

- <span data-ttu-id="a0cd9-124">Отправляйте уведомления с сервера на клиент с помощью SignalR.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-124">Send notifications from server to client using SignalR.</span></span>
- <span data-ttu-id="a0cd9-125">Горизонтальное масштабирование приложения SignalR с помощью **SQL Server**.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-125">Scale Out your SignalR application using **SQL Server**.</span></span>

<a id="Prerequisites"></a>
### <a name="prerequisites"></a><span data-ttu-id="a0cd9-126">Предварительные требования</span><span class="sxs-lookup"><span data-stu-id="a0cd9-126">Prerequisites</span></span>

<span data-ttu-id="a0cd9-127">Для завершения этой практической работу требуется следующее:</span><span class="sxs-lookup"><span data-stu-id="a0cd9-127">The following is required to complete this hands-on lab:</span></span>

- <span data-ttu-id="a0cd9-128">[Visual Studio Express 2013 для Web](https://www.microsoft.com/visualstudio/) или более поздней версии</span><span class="sxs-lookup"><span data-stu-id="a0cd9-128">[Visual Studio Express 2013 for Web](https://www.microsoft.com/visualstudio/) or greater</span></span>

<a id="Setup"></a>
### <a name="setup"></a><span data-ttu-id="a0cd9-129">Установка</span><span class="sxs-lookup"><span data-stu-id="a0cd9-129">Setup</span></span>

<span data-ttu-id="a0cd9-130">Для выполнения упражнений в этой практической работу, необходимо сначала настроить среду.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-130">In order to run the exercises in this hands-on lab, you will need to set up your environment first.</span></span>

1. <span data-ttu-id="a0cd9-131">Откройте окно проводника Windows и перейдите к лаборатории **источника** папки.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-131">Open a Windows Explorer window and browse to the lab's **Source** folder.</span></span>
2. <span data-ttu-id="a0cd9-132">Щелкните правой кнопкой мыши **Setup.cmd** и выберите **Запуск от имени администратора** для запуска процесса установки, будет настроить среду и установить фрагменты кода Visual Studio для этой лабораторной работы.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-132">Right-click **Setup.cmd** and select **Run as administrator** to launch the setup process that will configure your environment and install the Visual Studio code snippets for this lab.</span></span>
3. <span data-ttu-id="a0cd9-133">Если отображается диалоговое окно контроля учетных записей, подтвердите действие для продолжения.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-133">If the User Account Control dialog box is shown, confirm the action to proceed.</span></span>

> [!NOTE]
> <span data-ttu-id="a0cd9-134">Убедитесь, что все зависимости для этой лабораторной работы вы вернули перед запуском программы установки.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-134">Make sure you have checked all the dependencies for this lab before running the setup.</span></span>


<a id="CodeSnippets"></a>
### <a name="using-the-code-snippets"></a><span data-ttu-id="a0cd9-135">Фрагменты кода</span><span class="sxs-lookup"><span data-stu-id="a0cd9-135">Using the Code Snippets</span></span>

<span data-ttu-id="a0cd9-136">В этом документе лаборатории вам будет рекомендовано вставлять блоки кода.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-136">Throughout the lab document, you will be instructed to insert code blocks.</span></span> <span data-ttu-id="a0cd9-137">Для удобства основная часть кода предоставляется как фрагменты кода Visual Studio, к которому можно получить из в Visual Studio 2013, чтобы избежать необходимости добавлять ее вручную.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-137">For your convenience, most of this code is provided as Visual Studio Code Snippets, which you can access from within Visual Studio 2013 to avoid having to add it manually.</span></span>

> [!NOTE]
> <span data-ttu-id="a0cd9-138">Каждого упражнения сопровождается начальный решения, расположенный в **начать** папку упражнения, чему вы сможете каждого упражнения, независимо от других.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-138">Each exercise is accompanied by a starting solution located in the **Begin** folder of the exercise that allows you to follow each exercise independently of the others.</span></span> <span data-ttu-id="a0cd9-139">Имейте в виду, что фрагменты кода, которые добавляются во время атаки, отсутствуют эти стартовые решения и могут не работать, пока не будут выполнены упражнения.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-139">Please be aware that the code snippets that are added during an exercise are missing from these starting solutions and may not work until you have completed the exercise.</span></span> <span data-ttu-id="a0cd9-140">В исходном коде для упражнения, вы также найдете **окончания** папку, содержащую решение Visual Studio с кодом, полученный в результате выполнения действий, описанных в соответствующий упражнении.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-140">Inside the source code for an exercise, you will also find an **End** folder containing a Visual Studio solution with the code that results from completing the steps in the corresponding exercise.</span></span> <span data-ttu-id="a0cd9-141">Эти решения можно использовать в качестве руководства, если вам нужна дополнительная помощь, отвечая на это Практическое занятие.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-141">You can use these solutions as guidance if you need additional help as you work through this hands-on lab.</span></span>


* * *

<a id="Exercises"></a>
## <a name="exercises"></a><span data-ttu-id="a0cd9-142">Упражнения</span><span class="sxs-lookup"><span data-stu-id="a0cd9-142">Exercises</span></span>

<span data-ttu-id="a0cd9-143">Это Практическое занятие включает в себя следующие упражнения:</span><span class="sxs-lookup"><span data-stu-id="a0cd9-143">This hands-on lab includes the following exercises:</span></span>

1. [<span data-ttu-id="a0cd9-144">Работа с данными в режиме реального времени, с помощью SignalR</span><span class="sxs-lookup"><span data-stu-id="a0cd9-144">Working with Real-Time Data Using SignalR</span></span>](#Exercise1)
2. [<span data-ttu-id="a0cd9-145">Горизонтальное масштабирование с помощью SQL Server</span><span class="sxs-lookup"><span data-stu-id="a0cd9-145">Scaling Out Using SQL Server</span></span>](#Exercise2)

<span data-ttu-id="a0cd9-146">Предполагаемое время для выполнения этого лабораторного: **60 минут**</span><span class="sxs-lookup"><span data-stu-id="a0cd9-146">Estimated time to complete this lab: **60 minutes**</span></span>

> [!NOTE]
> <span data-ttu-id="a0cd9-147">При первом запуске Visual Studio, необходимо выбрать один из предварительно определенных коллекций параметров.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-147">When you first start Visual Studio, you must select one of the predefined settings collections.</span></span> <span data-ttu-id="a0cd9-148">Каждой коллекции предопределенных соответствует конкретному стилю разработки и определяет макетов окон, поведение редактора, фрагменты кода IntelliSense и параметры диалогового окна.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-148">Each predefined collection is designed to match a particular development style and determines window layouts, editor behavior, IntelliSense code snippets, and dialog box options.</span></span> <span data-ttu-id="a0cd9-149">В этом лабораторном занятии описаны действия, необходимые для выполнения данной задачи в Visual Studio при использовании **обычные параметры разработки** коллекции.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-149">The procedures in this lab describe the actions necessary to accomplish a given task in Visual Studio when using the **General Development Settings** collection.</span></span> <span data-ttu-id="a0cd9-150">При выборе другого набора параметров для среды разработки, возможно, различия в действиях, которые следует учитывать.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-150">If you choose a different settings collection for your development environment, there may be differences in the steps that you should take into account.</span></span>


<a id="Exercise1"></a>
### <a name="exercise-1-working-with-real-time-data-using-signalr"></a><span data-ttu-id="a0cd9-151">Упражнение 1. Работа с данными в режиме реального времени, с помощью SignalR</span><span class="sxs-lookup"><span data-stu-id="a0cd9-151">Exercise 1: Working with Real-Time Data Using SignalR</span></span>

<span data-ttu-id="a0cd9-152">Хотя чата часто используется в качестве примера, можно сделать всего гораздо больше с веб-функций, в режиме реального времени.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-152">While chat is often used as an example, you can do a whole lot more with real-time Web functionality.</span></span> <span data-ttu-id="a0cd9-153">Любое время, пользователь обновляет веб-страницы, чтобы просмотреть новые данные или реализует страницы Ajax, длинный опрос для получения новых данных, можно использовать SignalR.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-153">Any time a user refreshes a web page to see new data or the page implements Ajax long polling to retrieve new data, you can use SignalR.</span></span>

<span data-ttu-id="a0cd9-154">SignalR поддерживает **отправки данных с сервера** или **широковещательной рассылки** функциональные возможности; он автоматически выполняет управление подключениями.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-154">SignalR supports **server push** or **broadcasting** functionality; it handles connection management automatically.</span></span> <span data-ttu-id="a0cd9-155">В классических подключений HTTP для обмена данными между клиентом и сервером подключение будет восстановлено, для каждого запроса, но SignalR обеспечивает постоянное подключение между клиентом и сервером.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-155">In classic HTTP connections for client-server communication, connection is re-established for each request, but SignalR provides persistent connection between the client and server.</span></span> <span data-ttu-id="a0cd9-156">В SignalR, вызывает серверный код в клиентский код в браузере с помощью вызовов удаленных процедур (RPC) а не модели запрос ответ мы знаем, уже сегодня.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-156">In SignalR the server code calls out to a client code in the browser using Remote Procedure Calls (RPC), rather than the request-response model we know today.</span></span>

<span data-ttu-id="a0cd9-157">В этом упражнении вы настроите **Quiz Компьютерщик** приложения для использования SignalR для отображения панели мониторинга статистики с помощью обновленных метрик без необходимости обновления всей страницы.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-157">In this exercise, you will configure the **Geek Quiz** application to use SignalR to display the Statistics dashboard with the updated metrics without the need to refresh the entire page.</span></span>

<a id="Ex1Task1"></a>
#### <a name="task-1--exploring-the-geek-quiz-statistics-page"></a><span data-ttu-id="a0cd9-158">Задача 1 – изучение странице Компьютерщик головоломки статистики</span><span class="sxs-lookup"><span data-stu-id="a0cd9-158">Task 1 – Exploring the Geek Quiz Statistics Page</span></span>

<span data-ttu-id="a0cd9-159">В этой задаче будет проходить через приложения и убедитесь, как отображается на странице статистики и как можно улучшить способ сведения обновляется.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-159">In this task, you will go through the application and verify how the statistics page is shown and how you can improve the way the information is updated.</span></span>

1. <span data-ttu-id="a0cd9-160">Откройте **Visual Studio Express 2013 для Web** и откройте **GeekQuiz.sln** решение находится в **Source\Ex1 WorkingWithRealTimeData\Begin** папки.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-160">Open **Visual Studio Express 2013 for Web** and open the **GeekQuiz.sln** solution located in the **Source\Ex1-WorkingWithRealTimeData\Begin** folder.</span></span>
2. <span data-ttu-id="a0cd9-161">Нажмите клавишу **F5** для запуска решения.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-161">Press **F5** to run the solution.</span></span> <span data-ttu-id="a0cd9-162">**Вход** страница должна выглядеть в браузере.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-162">The **Log in** page should appear in the browser.</span></span>

    <span data-ttu-id="a0cd9-163">![При запуске решения](real-time-web-applications-with-signalr/_static/image2.png "при запуске решения")</span><span class="sxs-lookup"><span data-stu-id="a0cd9-163">![Running the solution](real-time-web-applications-with-signalr/_static/image2.png "Running the solution")</span></span>

    <span data-ttu-id="a0cd9-164">*При запуске решения*</span><span class="sxs-lookup"><span data-stu-id="a0cd9-164">*Running the solution*</span></span>
3. <span data-ttu-id="a0cd9-165">Нажмите кнопку **зарегистрировать** в правом верхнем углу страницы, чтобы создать нового пользователя в приложении.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-165">Click **Register** in the upper-right corner of the page to create a new user in the application.</span></span>

    <span data-ttu-id="a0cd9-166">![Зарегистрировать ссылку](real-time-web-applications-with-signalr/_static/image3.png "регистрационной ссылки")</span><span class="sxs-lookup"><span data-stu-id="a0cd9-166">![Register link](real-time-web-applications-with-signalr/_static/image3.png "Register link")</span></span>

    <span data-ttu-id="a0cd9-167">*Регистр связи*</span><span class="sxs-lookup"><span data-stu-id="a0cd9-167">*Register link*</span></span>
4. <span data-ttu-id="a0cd9-168">В **зарегистрировать** введите **имя пользователя** и **пароль**, а затем нажмите кнопку **зарегистрировать**.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-168">In the **Register** page, enter a **User name** and **Password**, and then click **Register**.</span></span>

    <span data-ttu-id="a0cd9-169">![Регистрация пользователя](real-time-web-applications-with-signalr/_static/image4.png "Регистрация пользователя")</span><span class="sxs-lookup"><span data-stu-id="a0cd9-169">![Registering a user](real-time-web-applications-with-signalr/_static/image4.png "Registering a user")</span></span>

    <span data-ttu-id="a0cd9-170">*Регистрация пользователя*</span><span class="sxs-lookup"><span data-stu-id="a0cd9-170">*Registering a user*</span></span>
5. <span data-ttu-id="a0cd9-171">Приложение регистрирует новую учетную запись, и пользователь прошел проверку подлинности и перенаправляется на домашнюю страницу, отображение на первый вопрос головоломки.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-171">The application registers the new account and the user is authenticated and redirected back to the home page showing the first quiz question.</span></span>
6. <span data-ttu-id="a0cd9-172">Откройте **статистики** странице в новом окне и поместить **Главная** страницы и **статистики** странице side-by-side.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-172">Open the **Statistics** page in a new window and put the **Home** page and **Statistics** page side-by-side.</span></span>

    <span data-ttu-id="a0cd9-173">![Windows Side-by-side](real-time-web-applications-with-signalr/_static/image5.png "рядом на стороне windows")</span><span class="sxs-lookup"><span data-stu-id="a0cd9-173">![Side-by-side windows](real-time-web-applications-with-signalr/_static/image5.png "Side by side windows")</span></span>

    <span data-ttu-id="a0cd9-174">*Windows Side-by-side*</span><span class="sxs-lookup"><span data-stu-id="a0cd9-174">*Side-by-side windows*</span></span>
7. <span data-ttu-id="a0cd9-175">В **Главная** странице, ответьте на вопрос, щелкнув один из вариантов.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-175">In the **Home** page, answer the question by clicking one of the options.</span></span>

    <span data-ttu-id="a0cd9-176">![Ответить на вопрос о](real-time-web-applications-with-signalr/_static/image6.png "ответить на вопрос")</span><span class="sxs-lookup"><span data-stu-id="a0cd9-176">![Answering a question](real-time-web-applications-with-signalr/_static/image6.png "Answering a question")</span></span>

    <span data-ttu-id="a0cd9-177">*Ответы на вопросы*</span><span class="sxs-lookup"><span data-stu-id="a0cd9-177">*Answering a question*</span></span>
8. <span data-ttu-id="a0cd9-178">Щелкните одну из кнопок и появится ответ.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-178">After clicking one of the buttons, the answer should appear.</span></span>

    <span data-ttu-id="a0cd9-179">![Ответ на вопрос правильный](real-time-web-applications-with-signalr/_static/image7.png "правильный вопрос")</span><span class="sxs-lookup"><span data-stu-id="a0cd9-179">![Question answered correct](real-time-web-applications-with-signalr/_static/image7.png "Question answered correct")</span></span>

    <span data-ttu-id="a0cd9-180">*Контрольные вопросы правильно*</span><span class="sxs-lookup"><span data-stu-id="a0cd9-180">*Question answered correctly*</span></span>
9. <span data-ttu-id="a0cd9-181">Обратите внимание на то, что информация, содержащаяся в странице Статистика устарела.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-181">Notice that the information provided in the Statistics page is outdated.</span></span> <span data-ttu-id="a0cd9-182">Обновите страницу, чтобы просмотреть обновленные результаты.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-182">Refresh the page in order to see the updated results.</span></span>

    <span data-ttu-id="a0cd9-183">![Страница статистики](real-time-web-applications-with-signalr/_static/image8.png "страница статистики")</span><span class="sxs-lookup"><span data-stu-id="a0cd9-183">![Statistics page](real-time-web-applications-with-signalr/_static/image8.png "Statistics page")</span></span>

    <span data-ttu-id="a0cd9-184">*Страница статистики*</span><span class="sxs-lookup"><span data-stu-id="a0cd9-184">*Statistics page*</span></span>
10. <span data-ttu-id="a0cd9-185">Вернитесь в Visual Studio и остановить отладку.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-185">Go back to Visual Studio and stop debugging.</span></span>

<a id="Ex1Task2"></a>
#### <a name="task-2--adding-signalr-to-geek-quiz-to-show-online-charts"></a><span data-ttu-id="a0cd9-186">Задача 2 – Добавление SignalR для Компьютерщик викторины, чтобы показать Online диаграммы</span><span class="sxs-lookup"><span data-stu-id="a0cd9-186">Task 2 – Adding SignalR to Geek Quiz to Show Online Charts</span></span>

<span data-ttu-id="a0cd9-187">В этой задаче будет добавить в решение SignalR и автоматически отправлять обновления клиентов, когда новый ответ отправляется на сервер.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-187">In this task, you will add SignalR to the solution and send updates to the clients automatically when a new answer is sent to the server.</span></span>

1. <span data-ttu-id="a0cd9-188">Из **средства** меню в Visual Studio, выберите пункт **диспетчер пакетов NuGet**, а затем нажмите кнопку **консоль диспетчера пакетов**.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-188">From the **Tools** menu in Visual Studio, select **NuGet Package Manager**, and then click **Package Manager Console**.</span></span>
2. <span data-ttu-id="a0cd9-189">В **консоль диспетчера пакетов** окно, выполните следующую команду:</span><span class="sxs-lookup"><span data-stu-id="a0cd9-189">In the **Package Manager Console** window, execute the following command:</span></span>

    [!code-powershell[Main](real-time-web-applications-with-signalr/samples/sample1.ps1)]

    <span data-ttu-id="a0cd9-190">![Установка пакета SignalR](real-time-web-applications-with-signalr/_static/image9.png "установки пакета SignalR")</span><span class="sxs-lookup"><span data-stu-id="a0cd9-190">![SignalR package installation](real-time-web-applications-with-signalr/_static/image9.png "SignalR package installation")</span></span>

    <span data-ttu-id="a0cd9-191">*Установка пакета SignalR*</span><span class="sxs-lookup"><span data-stu-id="a0cd9-191">*SignalR package installation*</span></span>

   > [!NOTE]
   > <span data-ttu-id="a0cd9-192">При установке **SignalR** NuGet пакеты версии 2.0.2 из нового приложения MVC 5, необходимо будет вручную обновить **OWIN** пакетов версию 2.0.1 (или более поздней версии) перед установкой SignalR.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-192">When installing **SignalR** NuGet packages version 2.0.2 from a brand new MVC 5 application, you will need to manually update **OWIN** packages to version 2.0.1 (or higher) before installing SignalR.</span></span> <span data-ttu-id="a0cd9-193">Чтобы сделать это, можно выполнить следующий сценарий в **консоль диспетчера пакетов**:</span><span class="sxs-lookup"><span data-stu-id="a0cd9-193">To do this, you can execute the following script in the **Package Manager Console**:</span></span>
   > 
   > [!code-powershell[Main](real-time-web-applications-with-signalr/samples/sample2.ps1)]
   > 
   > <span data-ttu-id="a0cd9-194">В одном из будущих выпусков SignalR OWIN зависимости будут обновляться автоматически.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-194">In a future release of SignalR, OWIN dependencies will be automatically updated.</span></span>
3. <span data-ttu-id="a0cd9-195">В **обозревателе решений**, разверните **сценарии** папку и обратите внимание, что, SignalR *js* файлы были добавлены в решение.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-195">In **Solution Explorer**, expand the **Scripts** folder and notice that the SignalR *js* files were added to the solution.</span></span>

    <span data-ttu-id="a0cd9-196">![Ссылается на SignalR JavaScript](real-time-web-applications-with-signalr/_static/image10.png "ссылается на SignalR JavaScript")</span><span class="sxs-lookup"><span data-stu-id="a0cd9-196">![SignalR JavaScript references](real-time-web-applications-with-signalr/_static/image10.png "SignalR JavaScript references")</span></span>

    <span data-ttu-id="a0cd9-197">*Ссылки на SignalR JavaScript*</span><span class="sxs-lookup"><span data-stu-id="a0cd9-197">*SignalR JavaScript references*</span></span>
4. <span data-ttu-id="a0cd9-198">В **обозревателе решений**, щелкните правой кнопкой мыши **GeekQuiz** проекта, выберите **добавить** | **новую папку**и назовите его  **Концентраторы**.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-198">In **Solution Explorer**, right-click the **GeekQuiz** project, select **Add** | **New Folder**, and name it **Hubs**.</span></span>
5. <span data-ttu-id="a0cd9-199">Щелкните правой кнопкой мыши **концентраторов** папку и выберите **Add | Новый элемент**.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-199">Right-click the **Hubs** folder and select **Add | New Item**.</span></span>

    <span data-ttu-id="a0cd9-200">![Добавить новый элемент](real-time-web-applications-with-signalr/_static/image11.png "добавить новый элемент")</span><span class="sxs-lookup"><span data-stu-id="a0cd9-200">![Add new item](real-time-web-applications-with-signalr/_static/image11.png "Add new item")</span></span>

    <span data-ttu-id="a0cd9-201">*Добавление нового элемента*</span><span class="sxs-lookup"><span data-stu-id="a0cd9-201">*Add new item*</span></span>
6. <span data-ttu-id="a0cd9-202">В **Добавление нового элемента** выберите **Visual C# | Web | SignalR** узел в левой области выберите **класс концентратора SignalR (v2)** в центральной области, назовите файл **StatisticsHub.cs** и нажмите кнопку **добавить**.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-202">In the **Add New Item** dialog box, select the **Visual C# | Web | SignalR** node in the left pane, select **SignalR Hub Class (v2)** from the center pane, name the file **StatisticsHub.cs** and click **Add**.</span></span>

    <span data-ttu-id="a0cd9-203">![Добавить новый элемент диалоговое окно](real-time-web-applications-with-signalr/_static/image12.png "добавить новый элемент диалоговое окно")</span><span class="sxs-lookup"><span data-stu-id="a0cd9-203">![Add new item dialog box](real-time-web-applications-with-signalr/_static/image12.png "Add new item dialog box")</span></span>

    <span data-ttu-id="a0cd9-204">*Добавить новый элемент-диалоговое окно*</span><span class="sxs-lookup"><span data-stu-id="a0cd9-204">*Add new item dialog box*</span></span>
7. <span data-ttu-id="a0cd9-205">Замените код в **StatisticsHub** класса следующим кодом.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-205">Replace the code in the **StatisticsHub** class with the following code.</span></span>

    <span data-ttu-id="a0cd9-206">(Code Snippet - *StatisticsHubClass RealTimeSignalR - сервера Ex1 -*)</span><span class="sxs-lookup"><span data-stu-id="a0cd9-206">(Code Snippet - *RealTimeSignalR - Ex1 - StatisticsHubClass*)</span></span>

    [!code-csharp[Main](real-time-web-applications-with-signalr/samples/sample3.cs)]
8. <span data-ttu-id="a0cd9-207">Откройте **Startup.cs** и добавьте следующую строку в конце **конфигурации** метод.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-207">Open **Startup.cs** and add the following line at the end of the **Configuration** method.</span></span>

    <span data-ttu-id="a0cd9-208">(Code Snippet - *MapSignalR RealTimeSignalR - сервера Ex1 -*)</span><span class="sxs-lookup"><span data-stu-id="a0cd9-208">(Code Snippet - *RealTimeSignalR - Ex1 - MapSignalR*)</span></span>

    [!code-csharp[Main](real-time-web-applications-with-signalr/samples/sample4.cs)]
9. <span data-ttu-id="a0cd9-209">Откройте **StatisticsService.cs** странице внутри **служб** папку и добавьте следующие директивы using.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-209">Open the **StatisticsService.cs** page inside the **Services** folder and add the following using directives.</span></span>

    <span data-ttu-id="a0cd9-210">(Code Snippet - *UsingDirectives RealTimeSignalR - сервера Ex1 -*)</span><span class="sxs-lookup"><span data-stu-id="a0cd9-210">(Code Snippet - *RealTimeSignalR - Ex1 - UsingDirectives*)</span></span>

    [!code-csharp[Main](real-time-web-applications-with-signalr/samples/sample5.cs)]
10. <span data-ttu-id="a0cd9-211">Чтобы уведомить подключенные клиенты из обновления, сначала нужно получить **контекст** объект для текущего соединения.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-211">To notify connected clients of updates, you first retrieve a **Context** object for the current connection.</span></span> <span data-ttu-id="a0cd9-212">**Концентратора** объект содержит методы для отправки сообщений для одного клиента или широкое вещание на всех подключенных клиентов.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-212">The **Hub** object contains methods to send messages to a single client or broadcast to all connected clients.</span></span> <span data-ttu-id="a0cd9-213">Добавьте следующий метод в **StatisticsService** класс рассылать статистических данных.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-213">Add the following method to the **StatisticsService** class to broadcast the statistics data.</span></span>

    <span data-ttu-id="a0cd9-214">(Code Snippet - *NotifyUpdatesMethod RealTimeSignalR - сервера Ex1 -*)</span><span class="sxs-lookup"><span data-stu-id="a0cd9-214">(Code Snippet - *RealTimeSignalR - Ex1 - NotifyUpdatesMethod*)</span></span>

    [!code-csharp[Main](real-time-web-applications-with-signalr/samples/sample6.cs)]

    > [!NOTE]
    > <span data-ttu-id="a0cd9-215">В приведенном выше коде используется имя произвольного метод для вызова функции на стороне клиента (т. е.: *updateStatistics*).</span><span class="sxs-lookup"><span data-stu-id="a0cd9-215">In the code above, you are using an arbitrary method name to call a function on the client (i.e.: *updateStatistics*).</span></span> <span data-ttu-id="a0cd9-216">Имя метода, указать интерпретируется как динамический объект, это означает, что нет IntelliSense или проверку во время компиляции.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-216">The method name that you specify is interpreted as a dynamic object, which means there is no IntelliSense or compile-time validation for it.</span></span> <span data-ttu-id="a0cd9-217">Выражение вычисляется во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-217">The expression is evaluated at run time.</span></span> <span data-ttu-id="a0cd9-218">При выполнении вызова метода, имя метода и значения параметров SignalR отправляет клиенту.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-218">When the method call executes, SignalR sends the method name and the parameter values to the client.</span></span> <span data-ttu-id="a0cd9-219">Если клиент имеет метод, который совпадает с именем, что вызывается метод и значения параметров, передаваемые ему.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-219">If the client has a method that matches the name, that method is called and the parameter values are passed to it.</span></span> <span data-ttu-id="a0cd9-220">Если отсутствует соответствующий метод находится на стороне клиента, ошибка не возникает.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-220">If no matching method is found on the client, no error is raised.</span></span> <span data-ttu-id="a0cd9-221">Дополнительные сведения см. [руководство по API концентраторов SignalR ASP.NET](../guide-to-the-api/hubs-api-guide-server.md).</span><span class="sxs-lookup"><span data-stu-id="a0cd9-221">For more information, refer to [ASP.NET SignalR Hubs API Guide](../guide-to-the-api/hubs-api-guide-server.md).</span></span>
11. <span data-ttu-id="a0cd9-222">Откройте **TriviaController.cs** странице внутри **контроллеров** папку и добавьте следующие директивы using.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-222">Open the **TriviaController.cs** page inside the **Controllers** folder and add the following using directives.</span></span>

    [!code-csharp[Main](real-time-web-applications-with-signalr/samples/sample7.cs)]
12. <span data-ttu-id="a0cd9-223">Добавьте следующий выделенный код, который **Post** метода действия.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-223">Add the following highlighted code to the **Post** action method.</span></span>

    <span data-ttu-id="a0cd9-224">(Code Snippet - *NotifyUpdatesCall RealTimeSignalR - сервера Ex1 -*)</span><span class="sxs-lookup"><span data-stu-id="a0cd9-224">(Code Snippet - *RealTimeSignalR - Ex1 - NotifyUpdatesCall*)</span></span>

    [!code-csharp[Main](real-time-web-applications-with-signalr/samples/sample8.cs)]
13. <span data-ttu-id="a0cd9-225">Откройте **Statistics.cshtml** странице внутри **представления | Главная** папки.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-225">Open the **Statistics.cshtml** page inside the **Views | Home** folder.</span></span> <span data-ttu-id="a0cd9-226">Найдите **сценариев** разделе и добавьте следующие ссылки на скрипты в начале раздела.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-226">Locate the **Scripts** section and add the following script references at the beginning of the section.</span></span>

    <span data-ttu-id="a0cd9-227">(Code Snippet - *SignalRScriptReferences RealTimeSignalR - сервера Ex1 -*)</span><span class="sxs-lookup"><span data-stu-id="a0cd9-227">(Code Snippet - *RealTimeSignalR - Ex1 - SignalRScriptReferences*)</span></span>

    [!code-cshtml[Main](real-time-web-applications-with-signalr/samples/sample9.cshtml)]

    > [!NOTE]
    > <span data-ttu-id="a0cd9-228">При добавлении SignalR и других библиотек сценариев в проект Visual Studio, диспетчер пакетов может установить версию файла скрипта SignalR, более свежие, чем версия, приведенные в этом разделе.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-228">When you add SignalR and other script libraries to your Visual Studio project, the Package Manager might install a version of the SignalR script file that is more recent than the version shown in this topic.</span></span> <span data-ttu-id="a0cd9-229">Убедитесь, что ссылку на сценарий в коде совпадает с версией библиотеки сценариев, которые установлены в вашем проекте.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-229">Make sure that the script reference in your code matches the version of the script library installed in your project.</span></span>
14. <span data-ttu-id="a0cd9-230">Добавьте выделенный ниже код для подключения клиента к концентратору SignalR и обновления статистических данных, при получении нового сообщения от концентратора.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-230">Add the following highlighted code to connect the client to the SignalR hub and update the statistics data when a new message is received from the hub.</span></span>

    <span data-ttu-id="a0cd9-231">(Code Snippet - *SignalRClientCode RealTimeSignalR - сервера Ex1 -*)</span><span class="sxs-lookup"><span data-stu-id="a0cd9-231">(Code Snippet - *RealTimeSignalR - Ex1 - SignalRClientCode*)</span></span>

    [!code-cshtml[Main](real-time-web-applications-with-signalr/samples/sample10.cshtml)]

    <span data-ttu-id="a0cd9-232">В этом коде создается прокси-сервера-концентратора и регистрации обработчика событий для прослушивания сообщений, отправленных сервером.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-232">In this code, you are creating a Hub Proxy and registering an event handler to listen for messages sent by the server.</span></span> <span data-ttu-id="a0cd9-233">В этом случае можно прослушивать сообщения, проходящие через *updateStatistics* метод.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-233">In this case, you listen for messages sent through the *updateStatistics* method.</span></span>

<a id="Ex1Task3"></a>
#### <a name="task-3--running-the-solution"></a><span data-ttu-id="a0cd9-234">Задача 3 – при запуске решения</span><span class="sxs-lookup"><span data-stu-id="a0cd9-234">Task 3 – Running the Solution</span></span>

<span data-ttu-id="a0cd9-235">В этой задаче будет выполняться решение, чтобы убедиться, что представление Статистика обновляется автоматически с помощью SignalR после ответа на свой вопрос.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-235">In this task, you will run the solution to verify that the statistics view is updated automatically using SignalR after answering a new question.</span></span>

1. <span data-ttu-id="a0cd9-236">Нажмите клавишу **F5** для запуска решения.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-236">Press **F5** to run the solution.</span></span>

    > [!NOTE]
    > <span data-ttu-id="a0cd9-237">Если еще не вошли в приложение, войдите с помощью пользователя, созданный в задаче 1.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-237">If not already logged in to the application, log in with the user you created in Task 1.</span></span>
2. <span data-ttu-id="a0cd9-238">Откройте **статистики** странице в новом окне и поместить **Главная** страницы и **статистики** странице side-by-side, как это делалось в задаче 1.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-238">Open the **Statistics** page in a new window and put the **Home** page and **Statistics** page side-by-side as you did in Task 1.</span></span>
3. <span data-ttu-id="a0cd9-239">В **Главная** странице, ответьте на вопрос, щелкнув один из вариантов.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-239">In the **Home** page, answer the question by clicking one of the options.</span></span>

    <span data-ttu-id="a0cd9-240">![Ответы на другой вопрос](real-time-web-applications-with-signalr/_static/image13.png "ответы на другой вопрос")</span><span class="sxs-lookup"><span data-stu-id="a0cd9-240">![Answering another question](real-time-web-applications-with-signalr/_static/image13.png "Answering another question")</span></span>

    <span data-ttu-id="a0cd9-241">*Ответы на другой вопрос*</span><span class="sxs-lookup"><span data-stu-id="a0cd9-241">*Answering another question*</span></span>
4. <span data-ttu-id="a0cd9-242">Щелкните одну из кнопок и появится ответ.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-242">After clicking one of the buttons, the answer should appear.</span></span> <span data-ttu-id="a0cd9-243">Обратите внимание на то, что статистические данные на странице обновляется автоматически после ответа на вопрос с обновленными данными без необходимости обновления всей страницы.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-243">Notice that the Statistics information on the page is updated automatically after answering the question with the updated information without the need to refresh the entire page.</span></span>

    <span data-ttu-id="a0cd9-244">![Обновление статистики страницы после ответов](real-time-web-applications-with-signalr/_static/image14.png "обновление статистики страницы после ответов")</span><span class="sxs-lookup"><span data-stu-id="a0cd9-244">![Statistics page refreshed after answer](real-time-web-applications-with-signalr/_static/image14.png "Statistics page refreshed after answer")</span></span>

    <span data-ttu-id="a0cd9-245">*Страница статистики обновлен после ответов*</span><span class="sxs-lookup"><span data-stu-id="a0cd9-245">*Statistics page refreshed after answer*</span></span>

<a id="Exercise2"></a>
### <a name="exercise-2-scaling-out-using-sql-server"></a><span data-ttu-id="a0cd9-246">Упражнение 2. Горизонтальное масштабирование с помощью SQL Server</span><span class="sxs-lookup"><span data-stu-id="a0cd9-246">Exercise 2: Scaling Out Using SQL Server</span></span>

<span data-ttu-id="a0cd9-247">При масштабировании веб-приложения, обычно можно между *масштабировании* и *масштабирование* параметры.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-247">When scaling a web application, you can generally choose between *scaling up* and *scaling out* options.</span></span> <span data-ttu-id="a0cd9-248">*Увеличение масштаба* на больший сервер с помощью дополнительных ресурсов (ЦП, ОЗУ и др.) при *горизонтальное масштабирование* означает добавление новых серверов для обработки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-248">*Scale up* means using a larger server, with more resources (CPU, RAM, etc.) while *scale out* means adding more servers to handle the load.</span></span> <span data-ttu-id="a0cd9-249">Проблема во втором типе аутентификации в том, что клиенты могут перенаправляться на разных серверах.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-249">The problem with the latter is that the clients can get routed to different servers.</span></span> <span data-ttu-id="a0cd9-250">Клиент, который подключен к одному серверу не будет получать сообщения, отправленные с другого сервера.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-250">A client that is connected to one server will not receive messages sent from another server.</span></span>

<span data-ttu-id="a0cd9-251">Эти проблемы можно решить с помощью компонент, называемый *объединительной платы*, для передачи сообщений между серверами.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-251">You can solve these issues by using a component called *backplane*, to forward messages between servers.</span></span> <span data-ttu-id="a0cd9-252">С задней панели, который включен каждый экземпляр приложения отправляет сообщения объединительной плате и задней панели перенаправляет их в другие экземпляры приложения.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-252">With a backplane enabled, each application instance sends messages to the backplane, and the backplane forwards them to the other application instances.</span></span>

<span data-ttu-id="a0cd9-253">В настоящее время существует три типа соединительных панелях для SignalR.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-253">There are currently three types of backplanes for SignalR:</span></span>

- <span data-ttu-id="a0cd9-254">**Windows Azure Service Bus**.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-254">**Windows Azure Service Bus**.</span></span> <span data-ttu-id="a0cd9-255">Служебная шина — это инфраструктура обмена сообщениями, которая позволяет компонентам для отправки сообщений в слабо связанных.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-255">Service Bus is a messaging infrastructure that allows components to send loosely coupled messages.</span></span>
- <span data-ttu-id="a0cd9-256">**SQL Server**.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-256">**SQL Server**.</span></span> <span data-ttu-id="a0cd9-257">На задней стороне SQL Server записывает сообщения в таблицы SQL.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-257">The SQL Server backplane writes messages to SQL tables.</span></span> <span data-ttu-id="a0cd9-258">Задняя панель с компонентом Service Broker для эффективного обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-258">The backplane uses Service Broker for efficient messaging.</span></span> <span data-ttu-id="a0cd9-259">Тем не менее она также работает, если не включен компонент Service Broker.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-259">However, it also works if Service Broker is not enabled.</span></span>
- <span data-ttu-id="a0cd9-260">**Redis**.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-260">**Redis**.</span></span> <span data-ttu-id="a0cd9-261">Redis — это хранилище ключ значение в памяти.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-261">Redis is an in-memory key-value store.</span></span> <span data-ttu-id="a0cd9-262">Redis поддерживает шаблона публикации/подписки («pub/sub») для отправки сообщений.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-262">Redis supports a publish/subscribe ("pub/sub") pattern for sending messages.</span></span>

<span data-ttu-id="a0cd9-263">Каждое сообщение отправляется через канал сообщений.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-263">Every message is sent through a message bus.</span></span> <span data-ttu-id="a0cd9-264">Реализует канал сообщений [IMessageBus](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.messaging.imessagebus(v=vs.100).aspx) интерфейс, который предоставляет абстракцию публикации/подписки.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-264">A message bus implements the [IMessageBus](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.messaging.imessagebus(v=vs.100).aspx) interface, which provides a publish/subscribe abstraction.</span></span> <span data-ttu-id="a0cd9-265">Соединительных панелях работы, заменив значение по умолчанию **IMessageBus** с шиной предназначен для этой задней панели.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-265">The backplanes work by replacing the default **IMessageBus** with a bus designed for that backplane.</span></span>

<span data-ttu-id="a0cd9-266">Каждый экземпляр сервера подключается к задней панели через шину.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-266">Each server instance connects to the backplane through the bus.</span></span> <span data-ttu-id="a0cd9-267">При отправке сообщения, она переходит к задней панели и задней панели отправляет его на каждом сервере.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-267">When a message is sent, it goes to the backplane, and the backplane sends it to every server.</span></span> <span data-ttu-id="a0cd9-268">Когда сервер получает сообщение от объединительной платы, она хранит сообщения в локальный кэш.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-268">When a server receives a message from the backplane, it stores the message in its local cache.</span></span> <span data-ttu-id="a0cd9-269">Затем сервер доставляет сообщения клиентам из своего локального кэша.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-269">The server then delivers messages to clients from its local cache.</span></span>

<span data-ttu-id="a0cd9-270">Дополнительные сведения о том, как работает объединительной панели SignalR, см. в этой [статье](../performance/scaleout-in-signalr.md).</span><span class="sxs-lookup"><span data-stu-id="a0cd9-270">For more information about how the SignalR backplane works, read this [article](../performance/scaleout-in-signalr.md).</span></span>

> [!NOTE]
> <span data-ttu-id="a0cd9-271">Существуют некоторые сценарии, в которых объединительной панели может стать узким местом.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-271">There are some scenarios where a backplane can become a bottleneck.</span></span> <span data-ttu-id="a0cd9-272">Ниже приведены некоторые типичные сценарии SignalR.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-272">Here are some typical SignalR scenarios:</span></span>
> 
> - <span data-ttu-id="a0cd9-273">[Рассылка сервера](tutorial-server-broadcast-with-signalr.md) (например, биржевые сводки): Соединительных панелях хорошо подходят для этого сценария, так как сервер определяет скорость, с которой отправляются сообщения.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-273">[Server broadcast](tutorial-server-broadcast-with-signalr.md) (e.g., stock ticker): Backplanes work well for this scenario, because the server controls the rate at which messages are sent.</span></span>
> - <span data-ttu-id="a0cd9-274">[Клиент клиент](tutorial-getting-started-with-signalr.md) (например, чат): В этом случае задней панели может быть узким местом, если количество сообщений, масштабируется с количеством клиентов; то есть если увеличивается число сообщений, присоединить пропорционально как можно большего числа клиентов.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-274">[Client-to-client](tutorial-getting-started-with-signalr.md) (e.g., chat): In this scenario, the backplane might be a bottleneck if the number of messages scales with the number of clients; that is, if the rate of messages grows proportionally as more clients join.</span></span>
> - <span data-ttu-id="a0cd9-275">[В реальном времени высокой частотой](tutorial-high-frequency-realtime-with-signalr.md) (например, в режиме реального времени игры): Задняя панель не рекомендуется для этого сценария.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-275">[High-frequency realtime](tutorial-high-frequency-realtime-with-signalr.md) (e.g., real-time games): A backplane is not recommended for this scenario.</span></span>


<span data-ttu-id="a0cd9-276">В этом упражнении вы воспользуетесь **SQL Server** распределяют сообщения между **Quiz Компьютерщик** приложения.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-276">In this exercise, you will use **SQL Server** to distribute messages across the **Geek Quiz** application.</span></span> <span data-ttu-id="a0cd9-277">Эти задачи будет выполняться на компьютере отдельный тест, чтобы узнать, как настроить конфигурацию, но чтобы получить полные результаты, вам понадобится для развертывания приложений SignalR на два или несколько серверов.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-277">You will run these tasks on a single test machine to learn how to set up the configuration, but in order to get the full effect, you will need to deploy the SignalR application to two or more servers.</span></span> <span data-ttu-id="a0cd9-278">Также необходимо установить SQL Server на одном из серверов или на отдельном выделенном сервере.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-278">You must also install SQL Server on one of the servers, or on a separate dedicated server.</span></span>

![Горизонтальное масштабирование с помощью схемы SQL Server](real-time-web-applications-with-signalr/_static/image15.png)

<a id="Ex2Task1"></a>
#### <a name="task-1---understanding-the-scenario"></a><span data-ttu-id="a0cd9-280">Задача 1 - основные сведения о сценарии</span><span class="sxs-lookup"><span data-stu-id="a0cd9-280">Task 1 - Understanding the Scenario</span></span>

<span data-ttu-id="a0cd9-281">В этой задаче будет выполняться два экземпляра **Quiz Компьютерщик** имитация IIS нескольких экземпляров на локальном компьютере.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-281">In this task, you will run 2 instances of **Geek Quiz** simulating multiple IIS instances on your local machine.</span></span> <span data-ttu-id="a0cd9-282">В этом случае при ответе на занимательные вопросы на одно приложение обновления не будут высылаться уведомления на странице статистики второго экземпляра.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-282">In this scenario, when answering trivia questions on one application, update won't be notified on the statistics page of the second instance.</span></span> <span data-ttu-id="a0cd9-283">Эмуляция похож на среду, где приложение развертывается на нескольких экземплярах и с помощью подсистемы балансировки нагрузки для взаимодействия с ними.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-283">This simulation resembles an environment where your application is deployed on multiple instances and using a load balancer to communicate with them.</span></span>

1. <span data-ttu-id="a0cd9-284">Откройте **Begin.sln** решение находится в **источника/Ex2-ScalingOutWithSQLServer/начало** папки.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-284">Open the **Begin.sln** solution located in the **Source/Ex2-ScalingOutWithSQLServer/Begin** folder.</span></span> <span data-ttu-id="a0cd9-285">После загрузки, обратите внимание на **обозревателя серверов** что решение содержит два проекта с идентичными структуры, но разные имена.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-285">Once loaded, you will notice on the **Server Explorer** that the solution has two projects with identical structures but different names.</span></span> <span data-ttu-id="a0cd9-286">Это будет имитировать выполнение двух экземпляров одного приложения на локальном компьютере.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-286">This will simulate running two instances of the same application on your local machine.</span></span>

    <span data-ttu-id="a0cd9-287">![Начать решение, имитируя 2 экземпляров головоломки Компьютерщик](real-time-web-applications-with-signalr/_static/image16.png "начать решение, имитируя 2 экземпляров Компьютерщик головоломки")</span><span class="sxs-lookup"><span data-stu-id="a0cd9-287">![Begin Solution Simulating 2 Instances of Geek Quiz](real-time-web-applications-with-signalr/_static/image16.png "Begin Solution Simulating 2 Instances of Geek Quiz")</span></span>

    <span data-ttu-id="a0cd9-288">*Начать решение, имитируя 2 экземпляров Компьютерщик головоломки*</span><span class="sxs-lookup"><span data-stu-id="a0cd9-288">*Begin Solution Simulating 2 Instances of Geek Quiz*</span></span>
2. <span data-ttu-id="a0cd9-289">Откройте страницы свойств решения, щелкнув правой кнопкой мыши узел решения **свойства**.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-289">Open the properties page of the solution by right-clicking the solution node and selecting **Properties**.</span></span> <span data-ttu-id="a0cd9-290">В разделе **запускаемым проектом**выберите **несколько запускаемых проектов** и измените **действие** значение для обоих проектов *запустить*.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-290">Under **Startup Project**, select **Multiple startup projects** and change the **Action** value for both projects to *Start*.</span></span>

    <span data-ttu-id="a0cd9-291">![Запуск нескольких проектов](real-time-web-applications-with-signalr/_static/image17.png "запуск нескольких проектов")</span><span class="sxs-lookup"><span data-stu-id="a0cd9-291">![Starting Multiple Projects](real-time-web-applications-with-signalr/_static/image17.png "Starting Multiple Projects")</span></span>

    <span data-ttu-id="a0cd9-292">*Запуск нескольких проектов*</span><span class="sxs-lookup"><span data-stu-id="a0cd9-292">*Starting Multiple Projects*</span></span>
3. <span data-ttu-id="a0cd9-293">Нажмите клавишу **F5** для запуска решения.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-293">Press **F5** to run the solution.</span></span> <span data-ttu-id="a0cd9-294">Приложение будет запущено два экземпляра **Quiz Компьютерщик** в разные порты, имитируя несколько экземпляров одного приложения.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-294">The application will launch two instances of **Geek Quiz** in different ports, simulating multiple instances of the same application.</span></span> <span data-ttu-id="a0cd9-295">Закрепляет один из обозревателей на слева, а другой — в правой части экрана.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-295">Pin one of the browsers on left and the other on the right of your screen.</span></span> <span data-ttu-id="a0cd9-296">Войдите с помощью учетных данных или регистрация нового пользователя.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-296">Log in with your credentials or register a new user.</span></span> <span data-ttu-id="a0cd9-297">После входа в систему, сохранить страницу Trivia в левой части и перейдите к **статистики** страницу в браузере в правой части.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-297">Once logged in, keep the Trivia page on the left and go to the **Statistics** page in the browser on the right.</span></span>

    ![Головоломка Компьютерщик рядом](real-time-web-applications-with-signalr/_static/image18.png)

    <span data-ttu-id="a0cd9-299">*Головоломка Компьютерщик рядом*</span><span class="sxs-lookup"><span data-stu-id="a0cd9-299">*Geek Quiz Side by Side*</span></span>

    ![Компьютерщик тест в разные порты](real-time-web-applications-with-signalr/_static/image19.png)

    <span data-ttu-id="a0cd9-301">*Компьютерщик тест в разные порты*</span><span class="sxs-lookup"><span data-stu-id="a0cd9-301">*Geek Quiz in Different Ports*</span></span>
4. <span data-ttu-id="a0cd9-302">Запустите ответы на вопросы в браузере слева, и можно будет заметить, что **статистики** страницу в браузере правой не обновляется.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-302">Start answering questions in the left browser and you will notice that the **Statistics** page in the right browser is not being updated.</span></span> <span data-ttu-id="a0cd9-303">Это обусловлено **SignalR** использует локальный кэш для распределения сообщений между клиентами и этот сценарий имитирует несколько экземпляров, поэтому кэш не может использоваться между ними.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-303">This is because **SignalR** uses a local cache to distribute messages across their clients and this scenario is simulating multiple instances, therefore the cache is not shared between them.</span></span> <span data-ttu-id="a0cd9-304">Можно убедиться, что **SignalR** работы за счет тестирования те же действия, но с помощью одного приложения.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-304">You can verify that **SignalR** is working by testing the same steps but using a single app.</span></span> <span data-ttu-id="a0cd9-305">В следующих задачах вы настроите объединительной панели для репликации сообщений между экземплярами.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-305">In the following tasks you will configure a backplane to replicate the messages across instances.</span></span>
5. <span data-ttu-id="a0cd9-306">Вернитесь в Visual Studio и остановить отладку.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-306">Go back to Visual Studio and stop debugging.</span></span>

<a id="Ex2Task2"></a>
#### <a name="task-2--creating-the-sql-server-backplane"></a><span data-ttu-id="a0cd9-307">Задача 2 – Создание на задней стороне SQL Server</span><span class="sxs-lookup"><span data-stu-id="a0cd9-307">Task 2 – Creating the SQL Server Backplane</span></span>

<span data-ttu-id="a0cd9-308">В этой задаче вы создадите базы данных, которая будет использоваться в качестве объединительной платы для **Quiz Компьютерщик** приложения.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-308">In this task, you will create a database that will serve as a backplane for the **Geek Quiz** application.</span></span> <span data-ttu-id="a0cd9-309">Вы воспользуетесь **обозреватель объектов SQL Server** для просмотра вашего сервера и инициализировать базу данных.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-309">You will use **SQL Server Object Explorer** to browse your server and initialize the database.</span></span> <span data-ttu-id="a0cd9-310">Кроме того, вы включите **компонента Service Broker**.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-310">Additionally, you will enable the **Service Broker**.</span></span>

1. <span data-ttu-id="a0cd9-311">В **Visual Studio**, откройте меню **представление** и выберите **обозреватель объектов SQL Server**.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-311">In **Visual Studio**, open menu **View** and select **SQL Server Object Explorer**.</span></span>
2. <span data-ttu-id="a0cd9-312">Подключитесь к экземпляру LocalDB, щелкнув правой кнопкой мыши **SQL Server** узла и выбрав **добавить SQL Server...**  параметр.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-312">Connect to your LocalDB instance by right-clicking the **SQL Server** node and selecting **Add SQL Server...** option.</span></span>

    <span data-ttu-id="a0cd9-313">![Добавление экземпляра SQL Server](real-time-web-applications-with-signalr/_static/image20.png "Добавление экземпляра SQL Server")</span><span class="sxs-lookup"><span data-stu-id="a0cd9-313">![Adding a SQL Server Instance](real-time-web-applications-with-signalr/_static/image20.png "Adding a SQL Server Instance")</span></span>

    <span data-ttu-id="a0cd9-314">*Добавление экземпляра SQL Server в обозревателе объектов SQL Server*</span><span class="sxs-lookup"><span data-stu-id="a0cd9-314">*Adding a SQL Server instance to SQL Server Object Explorer*</span></span>
3. <span data-ttu-id="a0cd9-315">Задайте **имя_сервера** для *(localdb) \v11.0* и оставить **проверки подлинности Windows** как свой режим проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-315">Set the **server name** to *(localdb)\v11.0* and leave **Windows Authentication** as your authentication mode.</span></span> <span data-ttu-id="a0cd9-316">Нажмите кнопку **Connect** для продолжения.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-316">Click **Connect** to continue.</span></span>

    <span data-ttu-id="a0cd9-317">![Подключение к LocalDB](real-time-web-applications-with-signalr/_static/image21.png "подключение к LocalDB")</span><span class="sxs-lookup"><span data-stu-id="a0cd9-317">![Connecting to LocalDB](real-time-web-applications-with-signalr/_static/image21.png "Connecting to LocalDB")</span></span>

    <span data-ttu-id="a0cd9-318">*Подключение к LocalDB*</span><span class="sxs-lookup"><span data-stu-id="a0cd9-318">*Connecting to LocalDB*</span></span>
4. <span data-ttu-id="a0cd9-319">Теперь, когда вы подключены к своему экземпляру LocalDB, необходимо будет создать базу данных, который будет представлять на задней стороне SQL Server для SignalR.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-319">Now that you are connected to your LocalDB instance, you will need to create a database that will represent the SQL Server backplane for SignalR.</span></span> <span data-ttu-id="a0cd9-320">Чтобы сделать это, щелкните правой кнопкой мыши **баз данных** узел и выберите **добавить новую базу данных**.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-320">To do this, right-click the **Databases** node and select **Add New Database**.</span></span>

    <span data-ttu-id="a0cd9-321">![Добавление новой базы данных](real-time-web-applications-with-signalr/_static/image22.png "Добавление новой базы данных")</span><span class="sxs-lookup"><span data-stu-id="a0cd9-321">![Adding a new database](real-time-web-applications-with-signalr/_static/image22.png "Adding a new database")</span></span>

    <span data-ttu-id="a0cd9-322">*Добавление новой базы данных*</span><span class="sxs-lookup"><span data-stu-id="a0cd9-322">*Adding a new database*</span></span>
5. <span data-ttu-id="a0cd9-323">Задайте имя базы данных *SignalR* и нажмите кнопку **ОК** для его создания.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-323">Set the database name to *SignalR* and click **OK** to create it.</span></span>

    <span data-ttu-id="a0cd9-324">![Создание базы данных SignalR](real-time-web-applications-with-signalr/_static/image23.png "Создание базы данных SignalR")</span><span class="sxs-lookup"><span data-stu-id="a0cd9-324">![Creating the SignalR database](real-time-web-applications-with-signalr/_static/image23.png "Creating the SignalR database")</span></span>

    <span data-ttu-id="a0cd9-325">*Создание базы данных SignalR*</span><span class="sxs-lookup"><span data-stu-id="a0cd9-325">*Creating the SignalR database*</span></span>

    > [!NOTE]
    > <span data-ttu-id="a0cd9-326">Можно выбрать любое имя для базы данных.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-326">You can choose any name for the database.</span></span>
6. <span data-ttu-id="a0cd9-327">Чтобы более эффективно получать обновления от объединительной платы, рекомендуется включить компонент Service Broker для базы данных.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-327">To receive updates more efficiently from the backplane, it is recommended to enable Service Broker for the database.</span></span> <span data-ttu-id="a0cd9-328">Компонент Service Broker обеспечивает встроенную поддержку для обмена сообщениями и очереди в SQL Server.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-328">Service Broker provides native support for messaging and queuing in SQL Server.</span></span> <span data-ttu-id="a0cd9-329">Задняя панель также работает без компонента Service Broker.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-329">The backplane also works without Service Broker.</span></span> <span data-ttu-id="a0cd9-330">Откройте новый запрос, щелкнув правой кнопкой мыши базу данных и выберите **новый запрос**.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-330">Open a new query by right-clicking the database and select **New Query**.</span></span>

    <span data-ttu-id="a0cd9-331">![Открытие нового запроса](real-time-web-applications-with-signalr/_static/image24.png "Открытие нового запроса")</span><span class="sxs-lookup"><span data-stu-id="a0cd9-331">![Opening a New Query](real-time-web-applications-with-signalr/_static/image24.png "Opening a New Query")</span></span>

    <span data-ttu-id="a0cd9-332">*Открытие нового запроса*</span><span class="sxs-lookup"><span data-stu-id="a0cd9-332">*Opening a New Query*</span></span>
7. <span data-ttu-id="a0cd9-333">Чтобы проверить, включен ли компонент Service Broker, запросите **—\_broker\_включена** столбца в **sys.databases** представления каталога.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-333">To check whether Service Broker is enabled, query the **is\_broker\_enabled** column in the **sys.databases** catalog view.</span></span> <span data-ttu-id="a0cd9-334">Выполните следующий скрипт в окне последних открытых запросов.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-334">Execute the following script in the recently opened query window.</span></span>

    [!code-sql[Main](real-time-web-applications-with-signalr/samples/sample11.sql)]

    <span data-ttu-id="a0cd9-335">![Запрос состояния брокера службы](real-time-web-applications-with-signalr/_static/image25.png "запросе состояния службы Broker")</span><span class="sxs-lookup"><span data-stu-id="a0cd9-335">![Querying the Service Broker Status](real-time-web-applications-with-signalr/_static/image25.png "Querying the Service Broker Status")</span></span>

    <span data-ttu-id="a0cd9-336">*Запрос состояния брокера служб*</span><span class="sxs-lookup"><span data-stu-id="a0cd9-336">*Querying the Service Broker Status*</span></span>
8. <span data-ttu-id="a0cd9-337">Если значение **—\_broker\_включена** столбец базы данных является &quot;0&quot;, используйте следующую команду, чтобы включить его.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-337">If the value of the **is\_broker\_enabled** column in your database is &quot;0&quot;, use the following command to enable it.</span></span> <span data-ttu-id="a0cd9-338">Замените **&lt;YOUR DATABASE&gt;** с именем, заданную при создании базы данных (например: SignalR).</span><span class="sxs-lookup"><span data-stu-id="a0cd9-338">Replace **&lt;YOUR-DATABASE&gt;** with the name you set when creating the database (e.g.: SignalR).</span></span>

    [!code-sql[Main](real-time-web-applications-with-signalr/samples/sample12.sql)]

    <span data-ttu-id="a0cd9-339">![Активация компонента Service Broker](real-time-web-applications-with-signalr/_static/image26.png "Активация компонента Service Broker")</span><span class="sxs-lookup"><span data-stu-id="a0cd9-339">![Enabling Service Broker](real-time-web-applications-with-signalr/_static/image26.png "Enabling Service Broker")</span></span>

    <span data-ttu-id="a0cd9-340">*Активация компонента Service Broker*</span><span class="sxs-lookup"><span data-stu-id="a0cd9-340">*Enabling Service Broker*</span></span>

    > [!NOTE]
    > <span data-ttu-id="a0cd9-341">Если этот запрос принимать участие во взаимоблокировке, убедитесь, что нет подключения к базе данных приложений.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-341">If this query appears to deadlock, make sure there are no applications connected to the DB.</span></span>

<a id="Ex2Task3"></a>
#### <a name="task-3--configuring-the-signalr-application"></a><span data-ttu-id="a0cd9-342">Задача 3 – Настройка приложения SignalR</span><span class="sxs-lookup"><span data-stu-id="a0cd9-342">Task 3 – Configuring the SignalR Application</span></span>

<span data-ttu-id="a0cd9-343">В этой задаче вы настроите **Quiz Компьютерщик** для подключения к задней панели SQL Server.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-343">In this task, you will configure **Geek Quiz** to connect to the SQL Server backplane.</span></span> <span data-ttu-id="a0cd9-344">Сначала добавим **SignalR.SqlServer** пакет NuGet и укажите соединение, созданное строка к базе данных объединительной платы.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-344">You will first add the **SignalR.SqlServer** NuGet package and set the connection string to your backplane database.</span></span>

1. <span data-ttu-id="a0cd9-345">Откройте **консоль диспетчера пакетов** из **средства** > **диспетчер пакетов NuGet**.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-345">Open the **Package Manager Console** from **Tools** > **NuGet Package Manager**.</span></span> <span data-ttu-id="a0cd9-346">Убедитесь, что **GeekQuiz** проект выбран в **проект по умолчанию** стрелку раскрывающегося списка.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-346">Make sure that **GeekQuiz** project is selected in the **Default project** drop-down list.</span></span> <span data-ttu-id="a0cd9-347">Введите следующую команду, чтобы установить **Microsoft.AspNet.SignalR.SqlServer** пакет NuGet.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-347">Type the following command to install the **Microsoft.AspNet.SignalR.SqlServer** NuGet package.</span></span>

    [!code-powershell[Main](real-time-web-applications-with-signalr/samples/sample13.ps1)]
2. <span data-ttu-id="a0cd9-348">Повторите предыдущий шаг но на этот раз для проекта **GeekQuiz2**.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-348">Repeat the previous step but this time for project **GeekQuiz2**.</span></span>
3. <span data-ttu-id="a0cd9-349">Чтобы настроить на задней стороне SQL Server, откройте **Startup.cs** файл **GeekQuiz** проекта и добавьте следующий код, чтобы **Настройка** метод.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-349">To configure the SQL Server backplane, open the **Startup.cs** file of the **GeekQuiz** project and add the following code to the **Configure** method.</span></span> <span data-ttu-id="a0cd9-350">Замените **&lt;YOUR DATABASE&gt;** именем вашей базы данных, которые использовались при создании на задней стороне SQL Server.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-350">Replace **&lt;YOUR-DATABASE&gt;** with your database name you used when creating the SQL Server backplane.</span></span> <span data-ttu-id="a0cd9-351">Повторите этот шаг для **GeekQuiz2** проекта.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-351">Repeat this step for the **GeekQuiz2** project.</span></span>

    <span data-ttu-id="a0cd9-352">(Code Snippet - *StartupConfiguration RealTimeSignalR - Ex2 -*)</span><span class="sxs-lookup"><span data-stu-id="a0cd9-352">(Code Snippet - *RealTimeSignalR - Ex2 - StartupConfiguration*)</span></span>

    [!code-csharp[Main](real-time-web-applications-with-signalr/samples/sample14.cs)]
4. <span data-ttu-id="a0cd9-353">Теперь, когда оба проекта настроены для использования на задней стороне SQL Server, нажмите клавишу **F5** запускать их одновременно.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-353">Now that both projects are configured to use the SQL Server backplane, press **F5** to run them simultaneously.</span></span>
5. <span data-ttu-id="a0cd9-354">Опять же **Visual Studio** приведет к запуску два экземпляра **Quiz Компьютерщик** в разные порты.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-354">Again, **Visual Studio** will launch two instances of **Geek Quiz** in different ports.</span></span> <span data-ttu-id="a0cd9-355">Закрепляет один из браузеров слева, а другой — в правой части экрана и войдите с помощью учетных данных.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-355">Pin one of the browsers on the left and the other on the right of your screen and log in with your credentials.</span></span> <span data-ttu-id="a0cd9-356">Сохранить страницу Trivia в левой части и перейдите к **статистики** pagein правой браузера.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-356">Keep the Trivia page on the left and go to **Statistics** pagein the right browser.</span></span>
6. <span data-ttu-id="a0cd9-357">Запуск, ответы на вопросы в браузере слева.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-357">Start answering questions in the left browser.</span></span> <span data-ttu-id="a0cd9-358">На этот раз **статистики** страница обновляется благодаря задней панели.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-358">This time, the **Statistics** page is updated thanks to the backplane.</span></span> <span data-ttu-id="a0cd9-359">Переключайтесь между приложениями (**статистики** теперь включен в левой части и **Trivia** правой стороны) и повторите тест, позволяющий проверить, что он работает для обоих экземпляров.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-359">Switch between applications (**Statistics** is now on the left, and **Trivia** is on the right) and repeat the test to validate that it is working for both instances.</span></span> <span data-ttu-id="a0cd9-360">Служит в качестве объединительной платы *общего кэша* сообщений для каждого подключенного сервера, а каждый сервер сохраняет сообщения в собственный локальный кэш для распространения на подключенных клиентов.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-360">The backplane serves as a *shared cache* of messages for each connected server, and each server will store the messages in their own local cache to distribute to connected clients.</span></span>
7. <span data-ttu-id="a0cd9-361">Вернитесь в Visual Studio и остановить отладку.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-361">Go back to Visual Studio and stop debugging.</span></span>
8. <span data-ttu-id="a0cd9-362">Задняя панель компонент SQL Server автоматически создает необходимые таблицы в указанной базе данных.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-362">The SQL Server backplane component automatically generates the necessary tables on the specified database.</span></span> <span data-ttu-id="a0cd9-363">В **обозреватель объектов SQL Server** панели, откройте базу данных, созданную для задней панели (например: SignalR) и разверните его таблиц.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-363">In the **SQL Server Object Explorer** panel, open the database you created for the backplane (e.g.: SignalR) and expand its tables.</span></span> <span data-ttu-id="a0cd9-364">Вы должны увидеть следующие таблицы:</span><span class="sxs-lookup"><span data-stu-id="a0cd9-364">You should see the following tables:</span></span>

    ![Задняя панель созданных таблиц](real-time-web-applications-with-signalr/_static/image27.png)

    <span data-ttu-id="a0cd9-366">*Задняя панель созданных таблиц*</span><span class="sxs-lookup"><span data-stu-id="a0cd9-366">*Backplane Generated Tables*</span></span>
9. <span data-ttu-id="a0cd9-367">Щелкните правой кнопкой мыши **SignalR.Messages\_0** таблицы и выберите **данные представления**.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-367">Right-click the **SignalR.Messages\_0** table and select **View Data**.</span></span>

    ![Просмотр таблицы сообщения объединительной панели SignalR](real-time-web-applications-with-signalr/_static/image28.png)

    <span data-ttu-id="a0cd9-369">*Просмотр таблицы сообщения объединительной панели SignalR*</span><span class="sxs-lookup"><span data-stu-id="a0cd9-369">*View SignalR Backplane Messages Table*</span></span>
10. <span data-ttu-id="a0cd9-370">Вы увидите различные сообщения, отправленные **концентратора** отвечая на занимательные вопросы.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-370">You can see the different messages sent to the **Hub** when answering the trivia questions.</span></span> <span data-ttu-id="a0cd9-371">Задняя панель распределяет эти сообщения в любой подключенный экземпляр.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-371">The backplane distributes these messages to any connected instance.</span></span>

    ![Таблица объединительной платы сообщений](real-time-web-applications-with-signalr/_static/image29.png)

    <span data-ttu-id="a0cd9-373">*Таблица объединительной платы сообщений*</span><span class="sxs-lookup"><span data-stu-id="a0cd9-373">*Backplane Messages Table*</span></span>

* * *

<a id="Summary"></a>
## <a name="summary"></a><span data-ttu-id="a0cd9-374">Сводка</span><span class="sxs-lookup"><span data-stu-id="a0cd9-374">Summary</span></span>

<span data-ttu-id="a0cd9-375">В этой практической работу вы узнали, как добавить **SignalR** свои приложения и отправки уведомления с сервера в подключенные клиенты, с помощью **концентраторов**.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-375">In this hands-on lab, you have learned how to add **SignalR** to your application and send notifications from the server to your connected clients using **Hubs**.</span></span> <span data-ttu-id="a0cd9-376">Кроме того, вы узнали, как развернуть приложение с помощью *объединительной платы* компонента, когда приложение развертывается в нескольких экземплярах служб IIS.</span><span class="sxs-lookup"><span data-stu-id="a0cd9-376">Additionally, you learned how to scale out your application by using a *backplane* component when your application is deployed in multiple IIS instances.</span></span>
