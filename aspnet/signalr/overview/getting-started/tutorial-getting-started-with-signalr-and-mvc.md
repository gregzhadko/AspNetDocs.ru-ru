---
uid: signalr/overview/getting-started/tutorial-getting-started-with-signalr-and-mvc
title: Учебник. Чат в реальном времени с SignalR 2 и MVC 5 | Документация Майкрософт
author: bradygaster
description: Этом руководстве показано, как использовать ASP.NET SignalR 2 для создания приложения разговора в режиме реального времени. SignalR добавьте в приложение MVC 5.
ms.author: bradyg
ms.date: 01/22/2019
ms.assetid: 80bfe5fb-bdfc-41fe-ac43-2132e5d69fac
msc.legacyurl: /signalr/overview/getting-started/tutorial-getting-started-with-signalr-and-mvc
msc.type: authoredcontent
ms.topic: tutorial
ms.openlocfilehash: 1b02aecc68a93dbd6373ca5304530e76c9d0b6b5
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/01/2019
ms.locfileid: "57065751"
---
# <a name="tutorial-real-time-chat-with-signalr-2-and-mvc-5"></a>Учебник. Чат в реальном времени с SignalR 2 и MVC 5

Этом руководстве показано, как использовать ASP.NET SignalR 2 для создания приложения разговора в режиме реального времени. Добавление SignalR в приложение MVC 5 и создание представления чата для отправки и отображения сообщений.

В этом учебнике рассмотрены следующие задачи.

> [!div class="checklist"]
> * Настройка проекта
> * Запуск образца
> * Изучите код

[!INCLUDE [Consider ASP.NET Core SignalR](~/includes/signalr/signalr-version-disambiguation.md)]

## <a name="prerequisites"></a>Предварительные требования

* [Visual Studio 2017](https://visualstudio.microsoft.com/downloads/) с **ASP.NET и веб-разработка** рабочей нагрузки.

## <a name="set-up-the-project"></a>Настройка проекта

В этом разделе показано, как использовать Visual Studio 2017 и SignalR 2 для создания пустого приложения ASP.NET MVC 5, добавить библиотеку SignalR и создание приложения чата.

1. В Visual Studio создайте приложение ASP.NET на C#, ориентированном на .NET Framework 4.5, назовите его SignalRChat и нажмите кнопку ОК.

    ![Создание веб-](tutorial-getting-started-with-signalr-and-mvc/_static/image1.png)

1. В **новый веб-приложение ASP.NET - SignalRMvcChat**выберите **MVC** , а затем выберите **изменить способ проверки подлинности**.

1. В **изменить способ проверки подлинности**выберите **без проверки подлинности** и нажмите кнопку **ОК**.

    ![Выберите без проверки подлинности](tutorial-getting-started-with-signalr-and-mvc/_static/image2.png)

1. В **новый веб-приложение ASP.NET - SignalRMvcChat**выберите **ОК**.

1. В **обозревателе решений**, щелкните правой кнопкой мыши проект и выберите **добавить** > **новый элемент**.

1. В **Добавление нового элемента — SignalRChat**выберите **установленные** > **Visual C#**   >  **Web**  >  **SignalR** , а затем выберите **класс концентратора SignalR (v2)**.

1. Назовите класс *ChatHub* и добавьте его в проект.

    На этом шаге создается *ChatHub.cs* файла и добавляет набор файлов сценариев и ссылки на сборки, которые поддерживают SignalR в проект.

1. Замените код в новом *ChatHub.cs* файл класса следующим кодом:

    [!code-csharp[Main](tutorial-getting-started-with-signalr-and-mvc/samples/sample1.cs)]

1. В **обозревателе решений**, щелкните правой кнопкой мыши проект и выберите **добавить** > **класс**.

1. Назовите новый класс *запуска* и добавьте его в проект.

1. Замените код в *Startup.cs* файл класса следующим кодом:

    [!code-csharp[Main](tutorial-getting-started-with-signalr-and-mvc/samples/sample2.cs)]

1. В **обозревателе решений**выберите **контроллеров** > **HomeController.cs**.

1. Добавьте следующий метод для *HomeController.cs*.

    [!code-csharp[Main](tutorial-getting-started-with-signalr-and-mvc/samples/sample3.cs)]

    Этот метод возвращает **Chat** представление, которое создается на более позднем этапе.

1. В **обозревателе решений**, щелкните правой кнопкой мыши **представления** > **Главная**и выберите **добавить**  >    **Представление**.

1. В **Добавление представления**, новому представлению имя **Chat** и выберите **добавить**.

1. Замените содержимое файла **Chat.cshtml** следующим кодом:

    [!code-cshtml[Main](tutorial-getting-started-with-signalr-and-mvc/samples/sample4.cshtml)]

1. В **обозревателе решений**, разверните **сценариев**.

    Библиотеки скрипта для jQuery и SignalR, отображаются в проект.

    > [!IMPORTANT]
    > Диспетчер пакетов может установить более позднюю версию сценариев SignalR.

1. Убедитесь, что ссылки на скрипты в блоке кода соответствуют версиям файлов сценариев в проекте.

    Ссылки на скрипты из исходного блока кода:

    ```cshtml
    <!--Script references. -->
    <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.1.0.min.js"></script>
    ```

1. Если они не совпадают, обновите *.cshtml* файла.

1. В строке меню выберите **файл** > **сохранить все**.

## <a name="run-the-sample"></a>Запуск образца

1. На панели инструментов, включите **отладки скриптов** и затем нажмите кнопку воспроизведения, чтобы запустить пример в режиме отладки.

    ![Введите имя пользователя](tutorial-getting-started-with-signalr-and-mvc/_static/image3.png)

1. Когда откроется браузер, введите имя для вашего удостоверения чата.

1. Скопируйте URL-адрес из браузера, откройте два других браузеров и вставьте URL-адреса в панели адрес.

1. В каждом браузере введите уникальное имя.

1. Теперь добавьте комментарий и выберите **отправки**. Повторите, в других браузерах. Комментарии отображаются в режиме реального времени.

    > [!NOTE]
    > Это приложение на простом чате не ведет контекста обсуждения на сервере. Концентратор осуществляет широковещательную передачу комментарии для всех текущих пользователей. Пользователи, беседа позже будет видеть сообщения добавлены с момента их присоединения к.

    См. в разделе, запуск приложения чата в трех различных браузерах. Когда Tom Ананд и Сьюзан отправляют сообщения, все браузеры обновление в режиме реального времени:

    ![Все три браузеры отображают же журнала разговора](tutorial-getting-started-with-signalr-and-mvc/_static/image4.png)

1. В **обозревателе решений**, проверять **документы скриптов** узел для запущенного приложения. Файл скрипта с именем *концентраторов* , библиотека SignalR создает во время выполнения. Этот файл управляет обменом данных между jQuery-сценарий и код на стороне сервера.

    ![автоматически созданное концентраторов сценария в узел документов скриптов](tutorial-getting-started-with-signalr-and-mvc/_static/image5.png)

## <a name="examine-the-code"></a>Изучите код

Приложение чата SignalR демонстрирует две основные задачи разработки SignalR. Оно показано, как создать концентратор. Сервер использует этот концентратор как объект основного координации. Концентратор использует библиотеку jQuery SignalR для отправки и получения сообщений.

### <a name="signalr-hubs-in-the-chathubcs"></a>Концентраторы SignalR в ChatHub.cs

В образце кода `ChatHub` класс является производным от `Microsoft.AspNet.SignalR.Hub` класса. Наследование от `Hub` класс является эффективным методом для построения приложения SignalR. Можно создавать открытые методы в классе концентратора и затем получить доступ к этих методов, вызывая их с помощью сценариев на веб-странице.

В коде чата, клиенты вызывают `ChatHub.Send` метод для отправки нового сообщения. Концентратор в свою очередь отправляет сообщение всем клиентам, вызвав `Clients.All.addNewMessageToPage`.

`Send` Метод демонстрирует несколько вещей понятия:

* Объявления открытых методов концентратора, таким образом, клиенты могут вызывать их.

* Используйте `Microsoft.AspNet.SignalR.Hub.Clients` динамических свойств для взаимодействия со всеми клиентами, подключенных к этому концентратору.

* Вызов функции на стороне клиента (например `addNewMessageToPage` функции) для обновления клиентов.

    [!code-csharp[Main](tutorial-getting-started-with-signalr-and-mvc/samples/sample5.cs)]

### <a name="signalr-and-jquery-chatcshtml"></a>SignalR и jQuery Chat.cshtml

*Chat.cshtml* файл представления в примере кода показано, как использовать библиотеку jQuery SignalR для взаимодействия с центром SignalR.  Код выполняет ряд важных задач. Она создает ссылку на автоматически созданные прокси-сервер для центра, объявляет функцию, сервер может обратиться для отправки содержимого клиентам, что он запускает подключение для отправки сообщений в концентратор.

[!code-javascript[Main](tutorial-getting-started-with-signalr-and-mvc/samples/sample6.js)]

> [!NOTE]
> В JavaScript ссылку на класс сервера и его членах находится в camelCase. Ссылки на код примера C# `ChatHub` класс в JavaScript в виде `chatHub`.

В этот блок кода как создать функцию обратного вызова в скрипте.

[!code-html[Main](tutorial-getting-started-with-signalr-and-mvc/samples/sample7.html)]

Класс концентратора на сервере вызывает эту функцию для отправки обновлений содержимого для каждого клиента. Дополнительного обращения к `htmlEncode` функция отображает способ HTML кодирования содержимое сообщения перед его отображением на странице. Это позволяет предотвратить внедрение скрипта.

Этот код открывает соединение с концентратором.

[!code-javascript[Main](tutorial-getting-started-with-signalr-and-mvc/samples/sample8.js)]

> [!NOTE]
> Такой подход гарантирует, что перед выполнением обработчика событий установить соединение.

Код запускает подключение, а затем передает его функции, чтобы обрабатывать событие щелчка на **отправки** кнопку на данной странице чата.

## <a name="get-the-code"></a>Получение кода

[Скачать завершенный проект](http://code.msdn.microsoft.com/Getting-Started-with-c366b2f3)

## <a name="additional-resources"></a>Дополнительные ресурсы

Дополнительные сведения о SignalR см. следующие ресурсы:

* [Проект SignalR](http://signalr.net)

* [SignalR GitHub и примерами](https://github.com/SignalR/SignalR)

* [Вики-сайте SignalR](https://github.com/SignalR/SignalR/wiki)

## <a name="next-steps"></a>Следующие шаги

В этом учебнике рассмотрены следующие задачи.

> [!div class="checklist"]
> * Настройка проекта
> * Запустили пример
> * Проверить код

Перейдите к следующей статье, чтобы научиться создавать веб-приложения, использующего ASP.NET SignalR 2 для предоставления функции обмена сообщениями с высокой частотой.
> [!div class="nextstepaction"]
> [Веб-приложения с высокой частотой обмена сообщениями](tutorial-high-frequency-realtime-with-signalr.md)