---
uid: signalr/overview/getting-started/tutorial-getting-started-with-signalr-and-mvc
title: Учебник. чат в режиме реального времени с SignalR 2 и MVC 5 | Документация Майкрософт
author: bradygaster
description: В этом руководстве показано, как использовать ASP.NET SignalR 2 для создания приложения разговора в режиме реального времени. Вы добавляете SignalR в приложение MVC 5.
ms.author: bradyg
ms.date: 01/22/2019
ms.assetid: 80bfe5fb-bdfc-41fe-ac43-2132e5d69fac
msc.legacyurl: /signalr/overview/getting-started/tutorial-getting-started-with-signalr-and-mvc
msc.type: authoredcontent
ms.topic: tutorial
ms.openlocfilehash: 5671e4f0123ca2b0cb5314336cf4411467feac70
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78431622"
---
# <a name="tutorial-real-time-chat-with-signalr-2-and-mvc-5"></a>Учебник. чат в режиме реального времени с SignalR 2 и MVC 5

В этом руководстве показано, как использовать ASP.NET SignalR 2 для создания приложения разговора в режиме реального времени. Вы добавляете SignalR в приложение MVC 5 и создаете представление чата для отправки и отображения сообщений.

Изучив это руководство, вы:

> [!div class="checklist"]
> * Настройка проекта
> * Запуск примера
> * Анализ кода

[!INCLUDE [Consider ASP.NET Core SignalR](~/includes/signalr/signalr-version-disambiguation.md)]

## <a name="prerequisites"></a>предварительные требования

* [Visual Studio 2017](https://visualstudio.microsoft.com/downloads/) с рабочей нагрузкой **ASP.NET и веб-разработка**.

## <a name="set-up-the-project"></a>Настройка проекта

В этом разделе показано, как использовать Visual Studio 2017 и SignalR 2 для создания пустого приложения ASP.NET MVC 5, добавления библиотеки SignalR и создания приложения для разговора.

1. В Visual Studio создайте приложение C# ASP.NET, которое предназначено для .NET Framework 4,5, назовите его сигналрчат и нажмите кнопку ОК.

    ![Создание веб-сайта](tutorial-getting-started-with-signalr-and-mvc/_static/image1.png)

1. В **новом ASP.NET веб-приложение — сигналрмвкчат**выберите **MVC** и щелкните **изменить проверку подлинности**.

1. В окне **Изменение проверки подлинности**выберите **без проверки подлинности** и нажмите кнопку **ОК**.

    ![Выберите без проверки подлинности](tutorial-getting-started-with-signalr-and-mvc/_static/image2.png)

1. В **новом ASP.NET веб-приложении — сигналрмвкчат**нажмите кнопку **ОК**.

1. В **Обозреватель решений**щелкните правой кнопкой мыши проект и выберите **Добавить** > **новый элемент**.

1. В окне **Добавить новый элемент — сигналрчат**выберите **установлено** > **Visual C#**  > **Web** > **SignalR** , а затем выберите **класс концентратора SignalR (v2)** .

1. Назовите класс *часуб* и добавьте его в проект.

    На этом шаге создается файл класса *ChatHub.CS* и добавляется набор файлов скриптов и ссылок на сборки, которые поддерживают SignalR в проекте.

1. Замените код в новом файле класса *ChatHub.CS* следующим кодом:

    [!code-csharp[Main](tutorial-getting-started-with-signalr-and-mvc/samples/sample1.cs)]

1. В **Обозреватель решений**щелкните правой кнопкой мыши проект и выберите **Добавить** > **класс**.

1. Присвойте новому классу имя *Startup* и добавьте его в проект.

1. Замените код в файле класса *Startup.CS* следующим кодом:

    [!code-csharp[Main](tutorial-getting-started-with-signalr-and-mvc/samples/sample2.cs)]

1. В **Обозреватель решений**выберите **контроллеры** > **HomeController.CS**.

1. Добавьте этот метод в *HomeController.CS*.

    [!code-csharp[Main](tutorial-getting-started-with-signalr-and-mvc/samples/sample3.cs)]

    Этот метод возвращает представление **чата** , которое вы создадите на следующем шаге.

1. В **Обозреватель решений**щелкните правой кнопкой мыши элемент **представления** > **Главная**и выберите **Добавить** >  **представление**.

1. В поле **Добавить представление**назовите новое представление **разговора** и нажмите кнопку **добавить**.

1. Замените содержимое файла **Chat. cshtml** следующим кодом:

    [!code-cshtml[Main](tutorial-getting-started-with-signalr-and-mvc/samples/sample4.cshtml)]

1. В **Обозреватель решений**разверните узел **сценарии**.

    Библиотеки скриптов для jQuery и SignalR отображаются в проекте.

    > [!IMPORTANT]
    > Диспетчер пакетов может установить более позднюю версию сценариев SignalR.

1. Убедитесь, что ссылки на скрипты в блоке кода соответствуют версиям файлов скриптов в проекте.

    Создать скрипт для ссылок из исходного блока кода:

    ```cshtml
    <!--Script references. -->
    <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.1.0.min.js"></script>
    ```

1. Если они не совпадают, обновите *CSHTML* .

1. В строке меню выберите **файл** > **сохранить все**.

## <a name="run-the-sample"></a>Запуск примера

1. На панели инструментов включите **отладку скриптов** , а затем нажмите кнопку Воспроизведение, чтобы запустить пример в режиме отладки.

    ![Введите имя пользователя](tutorial-getting-started-with-signalr-and-mvc/_static/image3.png)

1. Когда откроется браузер, введите имя для удостоверения разговора.

1. Скопируйте URL-адрес из браузера, откройте два других браузера и вставьте URL-адреса в адреса строки.

1. В каждом браузере введите уникальное имя.

1. Теперь добавьте комментарий и выберите **Отправить**. Повторите эти действия в других браузерах. Комментарии отображаются в режиме реального времени.

    > [!NOTE]
    > Это простое приложение разговора не поддерживает контекст обсуждения на сервере. Центр передает комментарии всем текущим пользователям. Пользователи, которые присоединяются к обсуждению позже, увидят сообщения, добавленные с момента присоединение.

    Узнайте, как работает приложение разговора в трех разных браузерах. При отправке сообщений Tom, Анандом и Ирина все браузеры обновляются в режиме реального времени:

    ![Все три браузера отображают один и тот же журнал разговора](tutorial-getting-started-with-signalr-and-mvc/_static/image4.png)

1. В **Обозреватель решений**просмотрите узел **документы скрипта** для работающего приложения. Существует файл скрипта *с именем* Hubs, формируемый библиотекой SignalR во время выполнения. Этот файл управляет обменом данными между скриптом jQuery и кодом на стороне сервера.

    ![автоматически сформированный скрипт концентраторов в узле "документы скриптов"](tutorial-getting-started-with-signalr-and-mvc/_static/image5.png)

## <a name="examine-the-code"></a>Изучение кода

Приложение разговора SignalR демонстрирует две основные задачи разработки SignalR. В нем показано, как создать центр. Сервер использует этот центр в качестве основного объекта координации. Концентратор использует библиотеку jQuery SignalR для отправки и получения сообщений.

### <a name="signalr-hubs-in-the-chathubcs"></a>Концентраторы SignalR в ChatHub.cs

В примере кода класс `ChatHub` является производным от класса `Microsoft.AspNet.SignalR.Hub`. Наследование от класса `Hub` является удобным способом создания приложения SignalR. Вы можете создавать открытые методы в классе Hub, а затем обращаться к этим методам, вызывая их из скриптов на веб-странице.

В коде разговора клиенты вызывают метод `ChatHub.Send` для отправки нового сообщения. Концентратор, в свою очередь, отправляет сообщение всем клиентам, вызывая `Clients.All.addNewMessageToPage`.

Метод `Send` демонстрирует несколько основных понятий:

* Объявите открытые методы в концентраторе, чтобы клиенты могли их вызывать.

* Используйте динамическое свойство `Microsoft.AspNet.SignalR.Hub.Clients` для взаимодействия со всеми клиентами, подключенными к этому концентратору.

* Вызовите функцию клиента (например, функцию `addNewMessageToPage`) для обновления клиентов.

    [!code-csharp[Main](tutorial-getting-started-with-signalr-and-mvc/samples/sample5.cs)]

### <a name="signalr-and-jquery-chatcshtml"></a>SignalR и jQuery Chat. cshtml

В файле представления *Chat. cshtml* в образце кода показано, как использовать библиотеку jQuery SignalR для взаимодействия с концентратором SignalR.  Код содержит множество важных задач. Он создает ссылку на автоматически сформированный прокси-сервер для концентратора, объявляет функцию, которую сервер может вызывать для отправки содержимого клиентам, и запускает подключение для отправки сообщений в концентратор.

[!code-javascript[Main](tutorial-getting-started-with-signalr-and-mvc/samples/sample6.js)]

> [!NOTE]
> В JavaScript ссылка на серверный класс и его члены находится в camelCase. Образец кода ссылается на класс C# `ChatHub` в JavaScript как `chatHub`.

В этом блоке кода вы создадите функцию обратного вызова в скрипте.

[!code-html[Main](tutorial-getting-started-with-signalr-and-mvc/samples/sample7.html)]

Класс концентратора на сервере вызывает эту функцию для отправки обновлений содержимого на каждый клиент. Необязательный вызов функции `htmlEncode` показывает способ кодирования содержимого сообщения в формате HTML перед его отображением на странице. Это способ предотвращения внедрения скриптов.

Этот код открывает подключение к концентратору.

[!code-javascript[Main](tutorial-getting-started-with-signalr-and-mvc/samples/sample8.js)]

> [!NOTE]
> Такой подход гарантирует установку соединения перед выполнением обработчика событий.

Код запускает соединение, а затем передает ему функцию для управления событием щелчка на кнопке **Send** на странице разговора.

## <a name="get-the-code"></a>Получение кода

[Скачать завершенный проект](https://code.msdn.microsoft.com/Getting-Started-with-c366b2f3)

## <a name="additional-resources"></a>Дополнительные ресурсы

Дополнительные сведения о SignalR см. в следующих ресурсах:

* [Проект SignalR](http://signalr.net)

* [GitHub и примеры SignalR](https://github.com/SignalR/SignalR)

* [Вики-сайт SignalR](https://github.com/SignalR/SignalR/wiki)

## <a name="next-steps"></a>Дальнейшие действия

Изучив это руководство, вы:

> [!div class="checklist"]
> * Настройка проекта
> * Запустили пример
> * Анализ кода

Перейдите к следующей статье, чтобы узнать, как создать веб-приложение, использующее ASP.NET SignalR 2 для обеспечения высокой функциональности обмена сообщениями.
> [!div class="nextstepaction"]
> [Веб-приложение с высокой частотой обмена сообщениями](tutorial-high-frequency-realtime-with-signalr.md)