---
uid: signalr/overview/deployment/tutorial-signalr-self-host
title: Учебник. Резидентное размещение SignalR | Документация Майкрософт
author: bradygaster
description: Этом руководстве показано, как создать локальную среду сервера SignalR 2 и способ подключения к нему с помощью клиента JavaScript. Версии программного обеспечения, используемые в этом руководстве V...
ms.author: bradyg
ms.date: 06/10/2014
ms.assetid: 400db427-27af-4f2f-abf0-5486d5e024b5
msc.legacyurl: /signalr/overview/deployment/tutorial-signalr-self-host
msc.type: authoredcontent
ms.openlocfilehash: 6a6359d59a4b715e13fe2bbcef57da6d6d6294b5
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/01/2019
ms.locfileid: "57039031"
---
<a name="tutorial-signalr-self-host"></a>Учебник. Резидентное размещение SignalR
====================
по [Патрик Флетчера](https://github.com/pfletcher)

[!INCLUDE [Consider ASP.NET Core SignalR](~/includes/signalr/signalr-version-disambiguation.md)]

[Скачать завершенный проект](http://code.msdn.microsoft.com/SignalR-Self-Host-Sample-6da0f383)

> Этом руководстве показано, как создать локальную среду сервера SignalR 2 и способ подключения к нему с помощью клиента JavaScript.
>
> ## <a name="software-versions-used-in-the-tutorial"></a>Версии программного обеспечения, используемые в этом руководстве
>
>
> - [Visual Studio 2013](https://my.visualstudio.com/Downloads?q=visual%20studio%202013)
> - .NET 4.5
> - SignalR версии 2
>
>
>
> ## <a name="using-visual-studio-2012-with-this-tutorial"></a>С помощью Visual Studio 2012 с помощью этого руководства
>
>
> Чтобы использовать Visual Studio 2012 с этим руководством, сделайте следующее:
>
> - Обновление вашей [диспетчера пакетов](http://docs.nuget.org/docs/start-here/installing-nuget) до последней версии.
> - Установка [установщик веб-платформы](https://www.microsoft.com/web/downloads/platform.aspx).
> - В установщик веб-платформы, найдите и установите **ASP.NET и Web Tools 2013.1 для Visual Studio 2012**. Это будет установки Visual Studio шаблоны для SignalR классов, таких как **центр**.
> - Некоторые шаблоны (такие как **класс запуска OWIN**) будут недоступны; для этого используйте файл класса.
>
>
> ## <a name="questions-and-comments"></a>Вопросы и комментарии
>
> Оставьте свои отзывы на том, как вам понравилось, и этот учебник и что можно улучшить в комментариях в нижней части страницы. Если у вас есть вопросы, которые не имеют отношения к руководству, их можно разместить [форум по ASP.NET SignalR](https://forums.asp.net/1254.aspx/1?ASP+NET+SignalR) или [StackOverflow.com](http://stackoverflow.com/).


## <a name="overview"></a>Обзор

SignalR сервера обычно размещается в приложении ASP.NET в IIS, но это также может быть резидентной (например, консольное приложение или служба Windows) с помощью библиотеки резидентного размещения. Эта библиотека, подобно всем SignalR 2, лежит OWIN ([Open Web Interface for .NET](http://owin.org)). OWIN определяет абстракции между веб-серверов .NET и веб-приложений. OWIN отделяет веб-приложения на сервер, который идеально OWIN для резидентного размещения веб-приложения в собственном процессе, за пределами служб IIS.

Причины не размещено в службах IIS:

- Средах, где IIS не доступны или желательно, например существующую ферму серверов без служб IIS.
- Необходимо избежать потери производительности в IIS.
- Функциональные возможности SignalR — добавить в существующий экземпляр приложения, которое выполняется в службе Windows, рабочей роли Azure или другой процесс.

Если это решение разработано как резидентного размещения для повышения производительности, рекомендуется также тестового приложения, размещенного в службах IIS, для определения преимуществ.

Этот учебник содержит следующие разделы:

- [Создание сервера](#server)
- [Доступ к серверу с помощью клиента JavaScript](#js)

<a id="server"></a>

## <a name="creating-the-server"></a>Создание сервера

В этом руководстве вы создадите сервер, который размещается в консольном приложении, но сервер может размещаться в любой из процесса, например службы Windows или рабочей роли Azure. Пример кода для размещения сервера SignalR в службе Windows, см. в разделе [Self-Hosting SignalR в службе Windows](https://code.msdn.microsoft.com/SignalR-self-hosted-in-6ff7e6c3).

1. Откройте Visual Studio 2013 с правами администратора. Выберите **файл**, **новый проект**. Выберите **Windows** под **Visual C#** узел в **шаблоны** области и выберите **консольное приложение** шаблона. Назовите новый проект «SignalRSelfHost» и нажмите кнопку **ОК**.

    ![](tutorial-signalr-self-host/_static/image1.png)
2. Откройте консоль диспетчера пакетов NuGet, выбрав **средства** > **диспетчер пакетов NuGet** > **консоль диспетчера пакетов**.
3. В консоли диспетчера пакетов введите следующую команду:

    [!code-powershell[Main](tutorial-signalr-self-host/samples/sample1.ps1)]

    Эта команда добавляет в проект библиотеки SignalR 2 Self-Host.
4. В консоли диспетчера пакетов введите следующую команду:

    [!code-powershell[Main](tutorial-signalr-self-host/samples/sample2.ps1)]

    Эта команда добавляет Microsoft.Owin.Cors библиотеки в проект. Эта библиотека будет использоваться для поддержки между доменами, который необходим для приложения, размещающие SignalR и веб-страницы клиента, в разных доменах. Так как будет размещаться сервер SignalR и веб-клиента на разных портах, это означает, что кросс доменные должна быть включена для обмена данными между этими компонентами.
5. Замените содержимое Program.cs кодом из этого примера.

    [!code-csharp[Main](tutorial-signalr-self-host/samples/sample3.cs)]

    Приведенный выше код включает в себя три класса:

    - **Программа**, в том числе **Main** метод, определение первичного пути выполнения. В этом методе веб-приложение типа **запуска** запускается на указанный URL-адрес (`http://localhost:8080`). Если для конечной точки требуется безопасности, можно реализовать SSL. См. практическое руководство по [ Настройка порта SSL-сертификат](https://msdn.microsoft.com/library/ms733791.aspx) Дополнительные сведения.
    - **Запуска**, класс, содержащий конфигурацию сервера SignalR (в этом руководстве используется единственная конфигурация, это вызов `UseCors`) и вызов `MapSignalR`, который создает маршруты для любых объектов концентратора в проекте.
    - **MyHub**, класс концентратора SignalR, приложение будет предоставлять клиентам. Этот класс содержит один метод, **отправки**, что клиенты будут вызывать для передачи сообщения для всех других подключенных клиентов.
6. Скомпилируйте и запустите приложение. Адрес, на котором выполняется сервер должно отображаться в окне консоли.

    ![](tutorial-signalr-self-host/_static/image2.png)
7. Если происходит сбой выполнения с исключением `System.Reflection.TargetInvocationException was unhandled`, вам потребуется перезапустить Visual Studio с правами администратора.
8. Остановите приложение, прежде чем переходить к следующему разделу.

<a id="js"></a>

## <a name="accessing-the-server-with-a-javascript-client"></a>Доступ к серверу с помощью клиента JavaScript

В этом разделе вы используете того же клиента JavaScript из [учебнике Приступая к работе](../getting-started/tutorial-getting-started-with-signalr.md). Сделаем только одно изменение в клиенте, что необходимо явно определить URL-адрес концентратора. С помощью резидентного приложения сервер может не обязательно будет по тому же адресу, как URL-адрес подключения (из-за обратных прокси-серверов и подсистемы балансировки нагрузки), поэтому URL-адреса должна быть определена явно.

1. В **обозревателе решений**, щелкните правой кнопкой мыши решение и выберите **добавить**, **новый проект**. Выберите **Web** узел и выберите **веб-приложение ASP.NET** шаблона. Присвойте проекту имя «JavascriptClient» и нажмите кнопку **ОК**.

    ![](tutorial-signalr-self-host/_static/image3.png)
2. Выберите **пустой** шаблона и оставьте остальные параметры не выбран. Выберите **Создание проекта**.

    ![](tutorial-signalr-self-host/_static/image4.png)
3. В консоли диспетчера пакетов, выберите проект «JavascriptClient» в **проект по умолчанию** раскрывающегося списка и выполните следующую команду:

    [!code-powershell[Main](tutorial-signalr-self-host/samples/sample4.ps1)]

    Эта команда устанавливает библиотеки SignalR и JQuery, которые вам потребуются в клиенте.
4. Щелкните правой кнопкой мыши проект и выберите **добавить**, **новый элемент**. Выберите **Web** узел и выберите HTML-страницу. Присвойте странице имя **Default.html**.

    ![](tutorial-signalr-self-host/_static/image5.png)
5. Замените содержимое новую HTML-страницу следующий код. Убедитесь, что здесь ссылки на скрипты соответствуют скрипты в папке Scripts проекта.

    [!code-html[Main](tutorial-signalr-self-host/samples/sample5.html?highlight=31-32)]

    Приведенный ниже (выделены в приведенном выше примере) является добавление, внесенные в клиенте, используемом в этом руководстве начало Stared (в дополнение к обновление кода до бета-версия 2 SignalR). Эта строка кода явным образом задает URL-адрес базового подключения для SignalR на сервере.

    [!code-javascript[Main](tutorial-signalr-self-host/samples/sample6.js)]
6. Щелкните правой кнопкой мыши решение и выберите **назначить запускаемые проекты...** . Выберите **несколько запускаемых проектов** кнопку-переключатель и задайте обоим проектам **действие** для **запустить**.

    ![](tutorial-signalr-self-host/_static/image6.png)
7. Щелкните правой кнопкой мыши на «Default.html» и выберите **задать в качестве начальной страницы**.
8. Запустите приложение. Сервер и страницы приведет к запуску. Может потребоваться перезагрузить веб-страницы (или выберите **Продолжить** в отладчике) при загрузке страницы, до запуска сервера.
9. В браузере введите имя пользователя при появлении запроса. Скопируйте URL-адрес страницы в другой вкладке браузера или в окне и укажите другое имя пользователя. Можно отправлять сообщения из одной области в другую, как в этом руководстве Приступая к работе.
