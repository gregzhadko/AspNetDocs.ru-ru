---
uid: signalr/overview/deployment/tutorial-signalr-self-host
title: Учебник. самостоятельный узел SignalR | Документация Майкрософт
author: bradygaster
description: В этом руководстве показано, как создать саморазмещенный сервер SignalR 2 и как подключиться к нему с помощью клиента JavaScript. Версии программного обеспечения, используемые в руководстве V...
ms.author: bradyg
ms.date: 06/10/2014
ms.assetid: 400db427-27af-4f2f-abf0-5486d5e024b5
msc.legacyurl: /signalr/overview/deployment/tutorial-signalr-self-host
msc.type: authoredcontent
ms.openlocfilehash: 41c8c3803923e76ef238a5c5937cbe7f81e6aa82
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/28/2019
ms.locfileid: "74578565"
---
# <a name="tutorial-signalr-self-host"></a>Учебник. самостоятельное размещение SignalR

по [Патрик Флетчера](https://github.com/pfletcher)

[!INCLUDE [Consider ASP.NET Core SignalR](~/includes/signalr/signalr-version-disambiguation.md)]

[Скачать завершенный проект](https://code.msdn.microsoft.com/SignalR-Self-Host-Sample-6da0f383)

> В этом руководстве показано, как создать саморазмещенный сервер SignalR 2 и как подключиться к нему с помощью клиента JavaScript.
>
> ## <a name="software-versions-used-in-the-tutorial"></a>Версии программного обеспечения, используемые в этом руководстве
>
>
> - [Visual Studio 2013](https://my.visualstudio.com/Downloads?q=visual%20studio%202013)
> - .NET 4.5
> - SignalR версии 2
>
>
>
> ## <a name="using-visual-studio-2012-with-this-tutorial"></a>Использование Visual Studio 2012 с этим руководством
>
>
> Чтобы использовать Visual Studio 2012 с этим руководством, выполните следующие действия.
>
> - Обновите [Диспетчер пакетов](http://docs.nuget.org/docs/start-here/installing-nuget) до последней версии.
> - Установите [установщик веб-платформы](https://www.microsoft.com/web/downloads/platform.aspx).
> - В установщике веб-платформы найдите и установите **ASP.NET and Web Tools 2013,1 для Visual Studio 2012**. При этом будут установлены шаблоны Visual Studio для классов SignalR, таких как **Hub**.
> - Некоторые шаблоны (например, **класс запуска OWIN**) будут недоступны. Вместо этого используйте файл класса.
>
>
> ## <a name="questions-and-comments"></a>Вопросы и комментарии
>
> Оставьте отзыв о том, как вы понравится вам в этом учебнике, и что можно улучшить в комментариях в нижней части страницы. Если у вас есть вопросы, не связанные непосредственно с этим руководством, их можно опубликовать на [форуме ASP.NET SignalR](https://forums.asp.net/1254.aspx/1?ASP+NET+SignalR) или [StackOverflow.com](http://stackoverflow.com/).

## <a name="overview"></a>Обзор

Сервер SignalR обычно размещается в приложении ASP.NET в службах IIS, но его также можно размещать в собственном расположении (например, в консольном приложении или службе Windows) с помощью библиотеки самообслуживания. Эта библиотека, как и весь SignalR 2, построена на OWIN ([открытый веб-интерфейс для .NET](http://owin.org)). OWIN определяет абстракцию между веб-серверами и веб-приложениями .NET. OWIN отделяет веб-приложение от сервера, что делает OWIN идеальным для самостоятельного размещения веб-приложения в собственном процессе вне служб IIS.

Причины отсутствия размещения в IIS включают:

- Среды, в которых IIS недоступен или нежелательно, например Существующая ферма серверов без служб IIS.
- Необходимо избегать издержек на производительность служб IIS.
- Функции SignalR необходимо добавить в существующее приложение, которое выполняется в службе Windows, рабочей роли Azure или другом процессе.

Если решение разрабатывается как самообслуживающее по соображениям производительности, рекомендуется также протестировать приложение, размещенное в службах IIS, чтобы определить преимущество в производительности.

Этот учебник содержит следующие подразделы:

- [Создание сервера](#server)
- [Доступ к серверу с помощью клиента JavaScript](#js)

<a id="server"></a>

## <a name="creating-the-server"></a>Создание сервера

В этом руководстве вы создадите сервер, размещенный в консольном приложении, но сервер может размещаться в любом процессе, например в службе Windows или рабочей роли Azure. Пример кода для размещения сервера SignalR в службе Windows см. [в разделе самостоятельное размещение SignalR в службе Windows](https://code.msdn.microsoft.com/SignalR-self-hosted-in-6ff7e6c3).

1. Откройте Visual Studio 2013 с правами администратора. Выберите **файл**, **создать проект**. Выберите **Windows** в узле **визуальный C#**  элемент в области **шаблоны** и выберите шаблон **консольное приложение** . Назовите новый проект "Сигналрселфхост" и нажмите кнопку **ОК**.

    ![](tutorial-signalr-self-host/_static/image1.png)
2. Откройте консоль диспетчера пакетов NuGet, выбрав **инструменты** > **диспетчер пакетов NuGet** > **консоль диспетчера пакетов**.
3. В консоли диспетчера пакетов введите следующую команду:

    [!code-powershell[Main](tutorial-signalr-self-host/samples/sample1.ps1)]

    Эта команда добавляет в проект библиотеки саморазмещения SignalR 2.
4. В консоли диспетчера пакетов введите следующую команду:

    [!code-powershell[Main](tutorial-signalr-self-host/samples/sample2.ps1)]

    Эта команда добавляет библиотеку Microsoft. Owin. CORS в проект. Эта библиотека будет использоваться для междоменной поддержки, которая необходима для приложений, которые размещают SignalR и клиент веб-страниц в разных доменах. Поскольку сервер SignalR и веб-клиент будут размещаться на разных портах, это означает, что для взаимодействия между этими компонентами должно быть включено междоменное взаимодействие.
5. Замените содержимое Program.cs кодом из этого примера.

    [!code-csharp[Main](tutorial-signalr-self-host/samples/sample3.cs)]

    Приведенный выше код включает три класса:

    - **Программа**, включая метод **Main** , определяющий основной путь выполнения. В этом методе веб-приложение типа **Startup** запускается по указанному URL-адресу (`http://localhost:8080`). Если для конечной точки требуется обеспечение безопасности, можно реализовать протокол SSL. Дополнительные сведения см. [в разделе как настроить порт с помощью SSL-сертификата](https://msdn.microsoft.com/library/ms733791.aspx) .
    - **Startup**, класс, содержащий конфигурацию сервера SignalR (единственная конфигурация, используемая этим руководством, — вызов `UseCors`) и вызов `MapSignalR`, который создает маршруты для всех объектов-концентраторов в проекте.
    - **Михуб**, класс концентратора SignalR, который приложение будет предоставлять клиентам. Этот класс содержит один метод **Send**, который клиенты будут вызывать для передачи сообщения на все остальные подключенные клиенты.
6. Скомпилируйте и запустите приложение. Адрес, который работает на сервере, должен отображаться в окне консоли.

    ![](tutorial-signalr-self-host/_static/image2.png)
7. В случае сбоя выполнения с исключением `System.Reflection.TargetInvocationException was unhandled`необходимо перезапустить Visual Studio с правами администратора.
8. Перед переходом к следующему разделу закройте приложение.

<a id="js"></a>

## <a name="accessing-the-server-with-a-javascript-client"></a>Доступ к серверу с помощью клиента JavaScript

В этом разделе вы будете использовать тот же клиент JavaScript из [учебника по начало работы](../getting-started/tutorial-getting-started-with-signalr.md). В клиенте будет внесено только одно изменение, которое заключается в явном определении URL-адреса концентратора. При использовании автономного приложения сервер может не быть на том же адресе, что и URL-адрес соединения (из-за обратных посредников и подсистем балансировки нагрузки), поэтому URL-адрес необходимо определить явным образом.

1. В **Обозреватель решений**щелкните решение правой кнопкой мыши и выберите **Добавить**, **создать проект**. Выберите **веб-** узел и выберите шаблон **веб-приложение ASP.NET** . Присвойте проекту имя "Жаваскриптклиент" и нажмите кнопку **ОК**.

    ![](tutorial-signalr-self-host/_static/image3.png)
2. Выберите **пустой** шаблон и оставьте невыбранными оставшиеся параметры. Выберите **создать проект**.

    ![](tutorial-signalr-self-host/_static/image4.png)
3. В консоли диспетчера пакетов выберите проект Жаваскриптклиент в раскрывающемся списке **проект по умолчанию** и выполните следующую команду:

    [!code-powershell[Main](tutorial-signalr-self-host/samples/sample4.ps1)]

    Эта команда устанавливает библиотеки SignalR и JQuery, которые понадобятся в клиенте.
4. Щелкните проект правой кнопкой мыши и выберите **Добавить**, **новый элемент**. Выберите **веб-** узел и выберите HTML-страница. Назовите страницу **Default. HTML**.

    ![](tutorial-signalr-self-host/_static/image5.png)
5. Замените содержимое новой HTML-страницы следующим кодом. Убедитесь, что ссылки на скрипты соответствуют скриптам в папке Scripts проекта.

    [!code-html[Main](tutorial-signalr-self-host/samples/sample5.html?highlight=31-32)]

    Следующий код (выделенный в приведенном выше примере кода) — это дополнение, которое вы внесли в клиент, который использовался в учебнике Приступая к работе (в дополнение к обновлению кода до бета-версии 2 SignalR). Эта строка кода явным образом задает базовый URL-адрес соединения для SignalR на сервере.

    [!code-javascript[Main](tutorial-signalr-self-host/samples/sample6.js)]
6. Щелкните решение правой кнопкой мыши и выберите команду **задать запускаемые проекты...** . Выберите переключатель **Несколько запускаемых проектов** и задайте для параметра **действие** оба проекта значение **запустить**.

    ![](tutorial-signalr-self-host/_static/image6.png)
7. Щелкните правой кнопкой мыши "Default. HTML" и выберите **задать в качестве начальной страницы**.
8. Запустите приложение. Сервер и страница будут запущены. Может потребоваться перезагрузить веб-страницу (или выбрать **продолжить** в отладчике), если страница загружается до запуска сервера.
9. В браузере при появлении запроса укажите имя пользователя. Скопируйте URL-адрес страницы на другую вкладку или окно браузера и укажите другое имя пользователя. Вы сможете отправить сообщения с одной панели браузера на другую, как описано в начало работы руководстве.
