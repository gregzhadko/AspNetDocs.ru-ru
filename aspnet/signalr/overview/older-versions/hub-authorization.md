---
uid: signalr/overview/older-versions/hub-authorization
title: Проверка подлинности и авторизация для концентраторов SignalR (SignalR 1.x) | Документация Майкрософт
author: bradygaster
description: В этом разделе описывается, как ограничить, какие пользователи или роли можно получить доступ к методам концентратора.
ms.author: bradyg
ms.date: 10/17/2013
ms.assetid: 3d2dfc0e-eac2-4076-a468-325d3d01cc7b
msc.legacyurl: /signalr/overview/older-versions/hub-authorization
msc.type: authoredcontent
ms.openlocfilehash: 7f4a76109111f19dc4381ad01e642afdabade336
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/01/2019
ms.locfileid: "57046231"
---
<a name="authentication-and-authorization-for-signalr-hubs-signalr-1x"></a>Проверка подлинности и авторизация для концентраторов SignalR (SignalR 1.x)
====================
по [Флетчера Патрик](https://github.com/pfletcher), [Tom FitzMacken](https://github.com/tfitzmac)

[!INCLUDE [Consider ASP.NET Core SignalR](~/includes/signalr/signalr-version-disambiguation.md)]

> В этом разделе описывается, как ограничить, какие пользователи или роли можно получить доступ к методам концентратора.


## <a name="overview"></a>Обзор

В этом разделе содержатся следующие подразделы.

- [Авторизовать атрибут](#authorizeattribute)
- [Требовать проверку подлинности для всех концентраторов](#requireauth)
- [Настраиваемой авторизации](#custom)
- [Передать сведения о проверке подлинности для клиентов](#passauth)
- [Параметры проверки подлинности для клиентов .NET](#authoptions)

    - [Файл cookie с помощью форм](#cookie)
    - [Проверка подлинности Windows](#windows)
    - [Заголовка соединения](#header)
    - [Сертификат](#certificate)

<a id="authorizeattribute"></a>

## <a name="authorize-attribute"></a>Авторизовать атрибут

SignalR обеспечивает [Authorize](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.authorizeattribute(v=vs.111).aspx) атрибут, чтобы указать, какие пользователи или роли имеют доступ к концентратору или метод. Этот атрибут находится в `Microsoft.AspNet.SignalR` пространства имен. Можно применить `Authorize` к концентратору или отдельные методы в концентраторе атрибут. При применении `Authorize` все методы в концентраторе применяется атрибут к классу концентратора, к указанной авторизации. Ниже приведены требования к проверке подлинности, которые можно применить различные типы. Без `Authorize` атрибута, все открытые методы концентратора доступны для клиентов, которые подключены к центру.

Если вы определили роль с именем «Admin» в веб-приложении, можно указать только пользователи в этой роли можно получить доступ к концентратору следующим кодом.

[!code-csharp[Main](hub-authorization/samples/sample1.cs)]

Или можно указать, что концентратор содержит один метод, который доступен всем пользователям, а второй метод, который доступен только пользователям, прошедшим проверку, как показано ниже.

[!code-csharp[Main](hub-authorization/samples/sample2.cs)]

Следующие примеры сценариев авторизации:

- `[Authorize]` — только прошедшие проверку пользователи
- `[Authorize(Roles = "Admin,Manager")]` — только прошедшим проверку подлинности пользователей в указанных ролей
- `[Authorize(Users = "user1,user2")]` — только прошедшим проверку подлинности пользователей с помощью указанных имен пользователя
- `[Authorize(RequireOutgoing=false)]` — только прошедшие проверку подлинности пользователи могут вызывать концентратора, но и вызовы с сервера клиентам не ограничены по авторизации, например, при только определенные пользователи могут отправлять сообщения, но все остальные могут принимать сообщения. Свойство RequireOutgoing может применяться только к весь центр, не для отдельных пользователей методов в концентраторе. Когда RequireOutgoing не присвоено значение false, только пользователи, соответствующие требованиям к авторизации называются с сервера.

<a id="requireauth"></a>

## <a name="require-authentication-for-all-hubs"></a>Требовать проверку подлинности для всех концентраторов

Можно потребовать проверку подлинности для всех концентраторам и методам концентраторов в приложении, вызвав [RequireAuthentication](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hubpipelineextensions.requireauthentication(v=vs.111).aspx) метод при запуске приложения. Этот метод можно использовать после нескольких концентраторов и хотите применить требования проверки подлинности для всех из них. С помощью этого метода невозможно указать исходящих авторизации, пользователя или роли. Можно только указать, что доступ к методам концентратора является аутентифицированным пользователям. Тем не менее по-прежнему можно применить атрибут Authorize концентраторов или методы, чтобы указать дополнительные требования. Любое требование, указываемые в атрибутах применяется в дополнение к основным требованием проверки подлинности.

В следующем примере файл Global.asax, ограничивающее все методы концентратора пользователям, прошедшим проверку.

[!code-csharp[Main](hub-authorization/samples/sample3.cs)]

При вызове метода `RequireAuthentication()` вызовет метод после обработки запрос SignalR, SignalR `InvalidOperationException` исключение. Это исключение возникает, так как не удается добавить модуль в конвейер концентратора после вызова конвейера. В предыдущем примере показан вызов `RequireAuthentication` метод в `Application_Start` метод, который выполняется один раз до обработки первого запроса.

<a id="custom"></a>

## <a name="customized-authorization"></a>Настраиваемой авторизации

Если вам нужно настроить, как авторизация, можно создать класс, производный от `AuthorizeAttribute` и переопределить [UserAuthorized](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.authorizeattribute.userauthorized(v=vs.111).aspx) метод. Этот метод вызывается для каждого запроса определить, авторизован ли пользователь для выполнения запроса. В переопределенном методе предоставляют необходимую логику для вашего сценария авторизации. В следующем примере показано, как для принудительного применения авторизации с помощью удостоверений на основе утверждений.

[!code-csharp[Main](hub-authorization/samples/sample4.cs)]

<a id="passauth"></a>

## <a name="pass-authentication-information-to-clients"></a>Передать сведения о проверке подлинности для клиентов

Может потребоваться использовать сведения о проверке подлинности в код, который выполняется на стороне клиента. Необходимые сведения, указываемые при вызове методов на стороне клиента. Например метод приложения чата можно передать как параметр имя пользователя как пользователь, отправляющий сообщение, как показано ниже.

[!code-csharp[Main](hub-authorization/samples/sample5.cs)]

Или можно создать объект для представления сведения для проверки подлинности и передать этот объект в качестве параметра, как показано ниже.

[!code-csharp[Main](hub-authorization/samples/sample6.cs)]

Никогда не следует передавать один клиентский идентификатор подключения для других клиентов, как пользователь-злоумышленник может использовать для имитации запроса от клиента.

<a id="authoptions"></a>

## <a name="authentication-options-for-net-clients"></a>Параметры проверки подлинности для клиентов .NET

При наличии клиент .NET, например, консольного приложения, которое взаимодействует с концентратором, ограниченную проверку подлинности пользователей, можно передать учетные данные проверки подлинности в файле cookie, заголовке соединение или сертификата. Примеры в этом разделе показано, как использовать эти различные методы для проверки подлинности пользователя. Они не являются полнофункциональные приложения SignalR. Дополнительные сведения о клиентах .NET с помощью SignalR см. в разделе [руководство по API концентраторов — клиент .NET](../guide-to-the-api/hubs-api-guide-net-client.md).

<a id="cookie"></a>

### <a name="cookie"></a>Куки-файл

Когда клиент .NET взаимодействует с к концентратору, который использует проверку подлинности форм ASP.NET, необходимо вручную задать файл cookie проверки подлинности для соединения. Добавьте файл cookie для `CookieContainer` свойство [HubConnection](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.client.hubs.hubconnection(v=vs.111).aspx) объекта. Следующий пример показывает консольное приложение, которое получает файл cookie проверки подлинности с веб-страниц и добавляет этот файл cookie подключения. URL-адрес `https://www.contoso.com/RemoteLogin` в примере указывает на веб-страницу, необходимо создать. Страница будет извлечь имя учтенного пользователя и пароль и попытка входа пользователя с учетными данными.

[!code-csharp[Main](hub-authorization/samples/sample7.cs)]

Консольное приложение отправляет учетные данные для www.contoso.com/RemoteLogin который может ссылаться на пустую страницу, которая содержит следующие файлы кода.

[!code-csharp[Main](hub-authorization/samples/sample8.cs)]

<a id="windows"></a>

### <a name="windows-authentication"></a>Аутентификация Windows

При использовании проверки подлинности Windows, можно передать учетные данные текущего пользователя с помощью [DefaultCredentials](https://msdn.microsoft.com/library/system.net.credentialcache.defaultcredentials.aspx) свойство. Присвоено значение DefaultCredentials учетные данные для подключения.

[!code-csharp[Main](hub-authorization/samples/sample9.cs?highlight=6)]

<a id="header"></a>

### <a name="connection-header"></a>Заголовка соединения

Если приложение не использует файлы cookie, можно передать сведения о пользователе в заголовке соединение. Например можно передать маркер в заголовке соединение.

[!code-csharp[Main](hub-authorization/samples/sample10.cs?highlight=6)]

Затем в концентраторе, то следует проверить маркер пользователя.

<a id="certificate"></a>

### <a name="certificate"></a>Сертификат

Вы можете передать сертификат клиента для проверки пользователя. Добавьте сертификат при создании подключения. Следующий пример показывает только то, как добавить сертификат клиента для подключения; он не отображается полное консольное приложение. Она использует [X509Certificate](https://msdn.microsoft.com/library/system.security.cryptography.x509certificates.x509certificate.aspx) класс, который предоставляет несколько способов создания сертификата.

[!code-csharp[Main](hub-authorization/samples/sample11.cs?highlight=6)]
