---
uid: signalr/overview/older-versions/troubleshooting
title: Устранение неполадок SignalR (SignalR 1. x) | Документация Майкрософт
author: bradygaster
description: В этой статье описаны распространенные проблемы при разработке приложений SignalR.
ms.author: bradyg
ms.date: 06/05/2013
ms.assetid: 347210ba-c452-4feb-886f-b51d89f58971
msc.legacyurl: /signalr/overview/older-versions/troubleshooting
msc.type: authoredcontent
ms.openlocfilehash: 3dbf091ac2daa4da477b405852bb4d1316584fcd
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78468102"
---
# <a name="signalr-troubleshooting-signalr-1x"></a>Устранение неполадок SignalR (SignalR 1.x)

по [Патрик Флетчера](https://github.com/pfletcher)

[!INCLUDE [Consider ASP.NET Core SignalR](~/includes/signalr/signalr-version-disambiguation.md)]

> В этом документе описаны распространенные проблемы, возникающие при устранении неполадок с SignalR.

Этот документ содержит следующие разделы.

- [Неудачный вызов методов между клиентом и сервером](#connection)
- [Другие проблемы с подключением](#other)
- [Ошибки компиляции и на стороне сервера](#server)
- [Проблемы Visual Studio](#vs)
- [Проблемы службы IIS](#iis)
- [Проблемы с Azure](#azure)

<a id="connection"></a>

## <a name="calling-methods-between-the-client-and-server-silently-fails"></a>Неудачный вызов методов между клиентом и сервером

В этом разделе описываются возможные причины сбоя вызова метода между клиентом и сервером без осмысленного сообщения об ошибке. В приложении SignalR сервер не имеет сведений о методах, реализуемых клиентом. Когда сервер вызывает клиентский метод, имя метода и данные параметра отправляются клиенту, а метод выполняется только в том случае, если он существует в формате, указанном сервером. Если на клиенте не найден соответствующий метод, ничего не происходит, и на сервере не выдается сообщение об ошибке.

Для дальнейшего изучения клиентских методов, которые не вызываются, можно включить ведение журнала перед вызовом метода Start в концентраторе, чтобы узнать, какие вызовы поступают от сервера. Сведения о включении ведения журнала в приложении JavaScript см. [в разделе Включение ведения журнала на стороне клиента (версия клиента JavaScript)](../guide-to-the-api/hubs-api-guide-javascript-client.md#logging). Сведения о включении ведения журнала в клиентском приложении .NET см. [в разделе Включение ведения журнала на стороне клиента (версия клиента .NET)](../guide-to-the-api/hubs-api-guide-net-client.md#logging).

### <a name="misspelled-method-incorrect-method-signature-or-incorrect-hub-name"></a>Неправильно написанный метод, неверная сигнатура метода или неправильное имя концентратора

Если имя или сигнатура вызываемого метода не полностью соответствует соответствующему методу на клиенте, вызов завершится ошибкой. Убедитесь, что имя метода, вызываемое сервером, совпадает с именем метода на клиенте. Кроме того, SignalR создает прокси-сервер концентратора с помощью методов в стиле Camel, как подходит для JavaScript, поэтому метод с именем `SendMessage` на сервере будет вызываться `sendMessage` в прокси клиента. Если вы используете атрибут `HubName` в коде на стороне сервера, убедитесь, что используемое имя соответствует имени, используемому для создания концентратора на клиенте. Если атрибут `HubName` не используется, убедитесь, что имя центра в клиенте JavaScript имеет стиль Camel, например Часуб вместо Часуб.

### <a name="duplicate-method-name-on-client"></a>Повторяющееся имя метода в клиенте

Убедитесь, что на клиенте отсутствует дублирующий метод, отличающийся только регистром. Если у клиентского приложения есть метод, именуемый `sendMessage`, убедитесь, что также не существует и метод, именуемый `SendMessage`.

### <a name="missing-json-parser-on-the-client"></a>Отсутствует средство синтаксического анализа JSON на клиенте

SignalR требует наличия средства синтаксического анализа JSON для сериализации вызовов между сервером и клиентом. Если у клиента нет встроенного средства синтаксического анализа JSON (например, Internet Explorer 7), необходимо включить его в приложение. Вы можете скачать средство синтаксического анализа JSON [здесь](http://nuget.org/packages/json2).

### <a name="mixing-hub-and-persistentconnection-syntax"></a>Сочетание синтаксиса HUB и Персистентконнектион

SignalR использует две модели взаимодействия: центры и Персистентконнектионс. Синтаксис вызова этих двух моделей взаимодействия отличается в коде клиента. Если вы добавили центр в код сервера, убедитесь, что весь клиентский код использует правильный синтаксис концентратора.

**Клиентский код JavaScript, создающий Персистентконнектион в клиенте JavaScript**

[!code-javascript[Main](troubleshooting/samples/sample1.js)]

**Клиентский код JavaScript, создающий прокси-сервер концентратора в клиенте JavaScript**

[!code-javascript[Main](troubleshooting/samples/sample2.js)]

**C#Серверный код, сопоставляющий маршрут с Персистентконнектион**

[!code-csharp[Main](troubleshooting/samples/sample3.cs)]

**C#Серверный код, который сопоставляет маршрут с концентратором или с несколькими концентраторами при наличии нескольких приложений**

[!code-csharp[Main](troubleshooting/samples/sample4.cs)]

### <a name="connection-started-before-subscriptions-are-added"></a>Подключение запущено до добавления подписок

Если подключение концентратора запущено до того, как методы, которые могут быть вызваны с сервера, добавляются к прокси-серверу, сообщения не будут приниматься. Следующий код JavaScript не запустит концентратор должным образом:

**Неверный код клиента JavaScript, который не позволит получать сообщения концентратора**

[!code-javascript[Main](troubleshooting/samples/sample5.js)]

Вместо этого добавьте подписки метода перед вызовом Start:

**Клиентский код JavaScript, который правильно добавляет подписки в центр**

[!code-javascript[Main](troubleshooting/samples/sample6.js)]

### <a name="missing-method-name-on-the-hub-proxy"></a>Отсутствует имя метода на прокси-сервере концентратора

Убедитесь, что метод, определенный на сервере, подписан на клиент. Несмотря на то, что сервер определяет метод, он по-прежнему должен быть добавлен к прокси клиента. Методы можно добавить в клиентский прокси следующими способами (Обратите внимание, что метод добавляется к `client` члену концентратора, а не концентратору напрямую):

**Клиентский код JavaScript, добавляющий методы к прокси-серверу концентратора**

[!code-javascript[Main](troubleshooting/samples/sample7.js)]

### <a name="hub-or-hub-methods-not-declared-as-public"></a>Методы концентратора или концентратора, не объявленные как открытые

Чтобы быть видимыми на клиенте, реализация и методы концентратора должны быть объявлены как `public`.

### <a name="accessing-hub-from-a-different-application"></a>Доступ к концентратору из другого приложения

Доступ к концентраторам SignalR можно получить только через приложения, которые реализуют клиентов SignalR. SignalR не может взаимодействовать с другими библиотеками связи (например, с веб-службами SOAP или WCF). Если для целевой платформы не доступен клиент SignalR, доступ к конечной точке сервера напрямую невозможен.

### <a name="manually-serializing-data"></a>Сериализация данных вручную

SignalR будет автоматически использовать JSON для сериализации параметров метода. нет необходимости делать это самостоятельно.

### <a name="remote-hub-method-not-executed-on-client-in-ondisconnected-function"></a>Удаленный метод концентратора не выполняется на клиенте в функции ondisconnectа

В этом весь замысел. При вызове `OnDisconnected` концентратор уже вошел в состояние `Disconnected`, что не позволяет вызывать другие методы концентратора.

**C#Серверный код, который правильно выполняет код в событии ondisconnectо**

[!code-csharp[Main](troubleshooting/samples/sample8.cs)]

### <a name="connection-limit-reached"></a>Достигнуто предельное число подключений

При использовании полной версии IIS в клиентской операционной системе, например Windows 7, ограничение на 10 подключений накладывается. При использовании клиентской ОС используйте IIS Express, чтобы избежать этого ограничения.

### <a name="cross-domain-connection-not-set-up-properly"></a>Подключение между доменами настроено неправильно

Если междоменное подключение (подключение, для которого URL-адрес SignalR находится не в том же домене, что и страница размещения), настроено неправильно, подключение может завершиться ошибкой без сообщения об ошибке. Сведения о том, как включить междоменное взаимодействие, см. в разделе [как установить междоменное подключение](../guide-to-the-api/hubs-api-guide-javascript-client.md#crossdomain).

### <a name="connection-using-ntlm-active-directory-not-working-in-net-client"></a>Подключение с использованием NTLM (Active Directory) не работает в клиенте .NET

Подключение в клиентском приложении .NET, использующем безопасность домена, может завершиться ошибкой, если подключение настроено неправильно. Чтобы использовать SignalR в доменной среде, установите свойство "Обязательное подключение" следующим образом:

**C#клиентский код, который реализует учетные данные подключения**

[!code-csharp[Main](troubleshooting/samples/sample9.cs)]

<a id="other"></a>

## <a name="other-connection-issues"></a>Другие проблемы с подключением

В этом разделе описываются причины и решения для конкретных симптомов или сообщений об ошибках, возникающих во время подключения.

### <a name="start-must-be-called-before-data-can-be-sent-error"></a>Ошибка "начало должно быть вызвано до отправки данных"

Эта ошибка обычно возникает, если код ссылается на объекты SignalR перед запуском подключения. Виреуп для обработчиков и аналогичных методов, которые будут вызывать методы, определенные на сервере, необходимо добавить после завершения соединения. Обратите внимание, что вызов `Start` является асинхронным, поэтому код после вызова может быть выполнен до завершения. Лучший способ добавления обработчиков после полного запуска соединения — поместить их в функцию обратного вызова, которая передается в качестве параметра в метод Start:

**Клиентский код JavaScript, который правильно добавляет обработчики событий, ссылающиеся на объекты SignalR**

[!code-javascript[Main](troubleshooting/samples/sample10.js?highlight=1)]

Эта ошибка также возникает, если соединение останавливается, пока на объекты SignalR все еще имеются ссылки.

### <a name="301-moved-permanently-or-302-moved-temporarily-error"></a>Ошибка "301 перемещено навсегда" или "302 временно перемещен"

Эта ошибка может возникать, если проект содержит папку с именем SignalR, которая повлияет на автоматически созданный прокси-сервер. Чтобы избежать этой ошибки, не используйте в приложении папку с именем `SignalR` или отключите автоматическое создание прокси-сервера. Для получения дополнительных сведений см. [созданный прокси-сервер и его назначение](../guide-to-the-api/hubs-api-guide-javascript-client.md#genproxy) .

### <a name="403-forbidden-error-in-net-or-silverlight-client"></a>Ошибка "403 запрещено" в клиенте .NET или Silverlight

Эта ошибка может возникать в междоменных средах, где междоменное взаимодействие не включено должным образом. Сведения о том, как включить междоменное взаимодействие, см. в разделе [как установить междоменное подключение](../guide-to-the-api/hubs-api-guide-javascript-client.md#crossdomain). Сведения о подключении между доменами в клиенте Silverlight см. в разделе [междоменное подключение от клиентов Silverlight](../guide-to-the-api/hubs-api-guide-net-client.md#slcrossdomain).

### <a name="404-not-found-error"></a>Ошибка "404 не найдено"

Существует несколько причин возникновения этой проблемы. Проверьте все следующие:

- **Ссылка на адрес прокси-сервера концентратора имеет неправильный формат:** Эта ошибка обычно возникает, если ссылка на созданный прокси-адрес концентратора имеет неправильный формат. Убедитесь, что ссылка на адрес концентратора выполнена правильно. Дополнительные сведения см. [в статье как ссылаться на динамически создаваемый прокси-сервер](../guide-to-the-api/hubs-api-guide-javascript-client.md#dynamicproxy) .
- **Добавление маршрутов в приложение перед добавлением маршрута концентратора:** Если приложение использует другие маршруты, убедитесь, что первый добавленный маршрут является вызовом `MapHubs`.

### <a name="500-internal-server-error"></a>"500 Внутренняя ошибка сервера"

Это общая ошибка, которая может иметь множество различных причин. Сведения об ошибке должны появиться в журнале событий сервера или можно найти с помощью отладки сервера. Подробные сведения об ошибке можно получить, включив подробные ошибки на сервере. Дополнительные сведения см. в разделе [как выполнять обработку ошибок в классе Hub](../guide-to-the-api/hubs-api-guide-server.md#handleErrors).

### <a name="typeerror-lthubtypegt-is-undefined-error"></a>"Типиррор: &lt;Хубтипе&gt; не определена"

Эта ошибка может возникнуть, если вызов `MapHubs` не выполняется должным образом. Дополнительные сведения см. [в статье как зарегистрировать маршрут SignalR и настроить параметры SignalR](../guide-to-the-api/hubs-api-guide-server.md#route) .

### <a name="jsonserializationexception-was-unhandled-by-user-code"></a>JsonSerializationException не обработано пользовательским кодом

Убедитесь, что параметры, отправляемые в методы, не содержат несериализуемые типы (например, дескрипторы файлов или подключения к базам данных). Если необходимо использовать элементы на серверном объекте, который не должен отправляться клиенту (для безопасности или по причине сериализации), используйте атрибут `JSONIgnore`.

### <a name="protocol-error-unknown-transport-error"></a>Ошибка "ошибка протокола: неизвестный транспорт"

Эта ошибка может возникать, если клиент не поддерживает транспорты, используемые SignalR. Сведения о том, какие браузеры можно использовать с SignalR, см. в разделе [транспорты и резервные](../getting-started/introduction-to-signalr.md#transports) варианты.

### <a name="javascript-hub-proxy-generation-has-been-disabled"></a>"Создание прокси-сервера для концентратора JavaScript отключено".

Эта ошибка возникает, если `DisableJavaScriptProxies` установлен, а также включает ссылку на динамически создаваемый прокси-сервер в `signalr/hubs`. Дополнительные сведения о создании прокси-сервера вручную см. [в разделе созданный прокси-сервер и его предназначение](../guide-to-the-api/hubs-api-guide-javascript-client.md#genproxy).

### <a name="the-connection-id-is-in-the-incorrect-format-or-the-user-identity-cannot-change-during-an-active-signalr-connection-error"></a>"Идентификатор подключения имеет неправильный формат" или "не удается изменить удостоверение пользователя во время активного подключения SignalR"

Эта ошибка может возникнуть, если используется проверка подлинности и клиент выходит из систему до остановки подключения. Решение заключается в том, чтобы отключить подключение SignalR перед регистрацией клиента.

### <a name="uncaught-error-signalr-jquery-not-found-please-ensure-jquery-is-referenced-before-the-signalrjs-file-error"></a>"Неперехваченная ошибка: не найдена программа SignalR: jQuery. Убедитесь, что указана jQuery перед файлом SignalR. js "ошибка".

Для запуска клиента SignalR JavaScript требуется jQuery. Убедитесь, что ссылка на jQuery правильна, что используемый путь допустим и ссылка на jQuery находится перед ссылкой на SignalR.

### <a name="uncaught-typeerror-cannot-read-property-ltpropertygt-of-undefined-error"></a>"Uncaughtные Типиррор: не удается прочитать свойство"&lt;свойства&gt;"для неопределенного" ошибки "

Эта ошибка возникает из-за отсутствия правильной ссылки jQuery или прокси концентраторов. Убедитесь, что ссылка на jQuery и прокси-сервер концентраторов правильна, что используемый путь допустим и ссылка на jQuery находится перед ссылкой на прокси-сервер концентраторов. Ссылка по умолчанию на прокси-сервер концентраторов должна выглядеть следующим образом:

**Код на стороне клиента HTML, который правильно ссылается на прокси-сервер концентраторов**

[!code-html[Main](troubleshooting/samples/sample11.html)]

### <a name="runtimebinderexception-was-unhandled-by-user-code-error"></a>Ошибка "RuntimeBinderException не обработана пользовательским кодом"

Эта ошибка может возникать, если используется неправильная перегрузка `Hub.On`. Если метод имеет возвращаемое значение, тип возвращаемого значения должен быть указан как параметр универсального типа:

**Метод, определенный на клиенте (без созданного прокси-сервера)**

[!code-html[Main](troubleshooting/samples/sample12.html?highlight=1)]

### <a name="connection-id-is-inconsistent-or-connection-breaks-between-page-loads"></a>Несогласованный идентификатор подключения или разрыв соединения между страницами

В этом весь замысел. Так как объект концентратора размещается в объекте Page, концентратор уничтожается при обновлении страницы. Многостраничное приложение должно поддерживать связь между пользователями и идентификаторами подключений, чтобы они были согласованы между загрузками страниц. Идентификаторы соединения могут храниться на сервере либо в объекте `ConcurrentDictionary`, либо в базе данных.

### <a name="value-cannot-be-null-error"></a>Ошибка "значение не может быть null"

Методы на стороне сервера с необязательными параметрами в настоящее время не поддерживаются; Если необязательный параметр пропущен, метод завершится ошибкой. Дополнительные сведения см. в разделе [необязательные параметры](https://github.com/SignalR/SignalR/issues/324).

### <a name="firefox-cant-establish-a-connection-to-the-server-at-ltaddressgt-error-in-firebug"></a>"Firefox не может установить соединение с сервером по адресу &lt;&gt;" ошибка в Firebug

Это сообщение об ошибке можно увидеть в Firebug, если согласование транспорта WebSocket завершается с ошибкой, а вместо этого используется другой транспорт. В этом весь замысел.

### <a name="the-remote-certificate-is-invalid-according-to-the-validation-procedure-error-in-net-client-application"></a>"Недопустимый удаленный сертификат согласно процедуре проверки" ошибка в клиентском приложении .NET

Если серверу требуются пользовательские сертификаты клиента, можно добавить сертификат x509 в соединение перед запросом. Добавьте сертификат в соединение с помощью `Connection.AddClientCertificate`.

### <a name="connection-drops-after-authentication-times-out"></a>Разрыв соединения после истечения времени ожидания проверки подлинности

В этом весь замысел. Учетные данные для проверки подлинности нельзя изменить, пока подключение активно. чтобы обновить учетные данные, соединение должно быть остановлено и перезапущено.

### <a name="onconnected-gets-called-twice-when-using-jquery-mobile"></a>Onconnectd вызывается дважды при использовании jQuery Mobile

Функция `initializePage` jQuery Mobile выполняет принудительное повторное выполнение сценариев на каждой странице, тем самым создавая второе соединение. Ниже приведены решения для этой проблемы.

- Включите ссылку на jQuery Mobile перед файлом JavaScript.
- Отключите функцию `initializePage`, установив `$.mobile.autoInitializePage = false`.
- Дождитесь завершения инициализации страницы, прежде чем запускать подключение.

### <a name="messages-are-delayed-in-silverlight-applications-using-server-sent-events"></a>Сообщения откладываются в приложениях Silverlight с помощью событий, отправленных сервером

Сообщения откладываются при использовании серверных событий, отправленных в Silverlight. Чтобы использовать вместо этого длительный опрос, используйте следующую команду при запуске подключения:

[!code-css[Main](troubleshooting/samples/sample13.css)]

### <a name="permission-denied-using-forever-frame-protocol"></a>"Отказ в разрешении" при использовании протокола бесконечного кадра

Это известная проблема, описанная [здесь](https://github.com/SignalR/SignalR/issues/1963). Этот симптом можно увидеть с помощью последней библиотеки JQuery; обходной путь заключается в том, чтобы понизить приложение до JQuery 1.8.2.

<a id="server"></a>

## <a name="compilation-and-server-side-errors"></a>Ошибки компиляции и на стороне сервера

 В следующем разделе содержатся возможные решения для ошибок компилятора и ошибки времени выполнения на стороне сервера. 

### <a name="reference-to-hub-instance-is-null"></a>Ссылка на экземпляр концентратора имеет значение null

Поскольку для каждого подключения создается экземпляр концентратора, нельзя самостоятельно создать экземпляр концентратора в коде. Сведения о вызове методов концентратора извне самого концентратора см. в разделе [как вызывать клиентские методы и управлять группами извне класса Hub](../guide-to-the-api/hubs-api-guide-server.md#callfromoutsidehub) для получения ссылки на контекст концентратора.

### <a name="httpcontextcurrentsession-is-null"></a>HTTPContext. Current. Session имеет значение null

В этом весь замысел. SignalR не поддерживает состояние сеанса ASP.NET, так как включение состояния сеанса приведет к нарушению дуплексного обмена сообщениями.

### <a name="no-suitable-method-to-override"></a>Нет подходящего метода переопределения

Эта ошибка может возникать, если вы используете код из более старой документации или из блогов. Убедитесь, что вы не ссылаетесь на имена методов, которые были изменены или устарели (например, `OnConnectedAsync`).

### <a name="hostcontextextensionswebsocketserverurl-is-null"></a>Хостконтекстекстенсионс. Вебсоккетсерверурл имеет значение null

В этом весь замысел. Этот член является устаревшим и не должен использоваться.

### <a name="a-route-named-signalrhubs-is-already-in-the-route-collection-error"></a>"Маршрут с именем SignalR. Hubs уже находится в коллекции маршрутов"

Эта ошибка будет отображаться, если приложение вызывает `MapHubs` дважды. Некоторые примеры приложений вызывают `MapHubs` непосредственно в глобальном файле приложения. другие делают вызов в классе-оболочке. Убедитесь, что приложение не выполняет никаких действий.

<a id="vs"></a>

## <a name="visual-studio-issues"></a>Проблемы Visual Studio

В этом разделе описываются проблемы, возникающие в Visual Studio.

### <a name="script-documents-node-does-not-appear-in-solution-explorer"></a>Узел "документы скриптов" не отображается в обозреватель решений

В некоторых наших руководствах вы научитесь переходить на узел «Script Documents» в обозреватель решений во время отладки. Этот узел создается отладчиком JavaScript и отображается только при отладке клиентов браузера в Internet Explorer. узел не отображается, если используются Chrome или Firefox. Отладчик JavaScript также не будет выполняться, если запущен другой клиентский отладчик, например отладчик Silverlight.

### <a name="signalr-does-not-work-on-visual-studio-2008-or-earlier"></a>SignalR не работает в Visual Studio 2008 или более ранней версии

В этом весь замысел. Для SignalR требуется .NET Framework 4 или более поздней версии. для этого необходимо разработать приложения SignalR в Visual Studio 2010 или более поздней версии.

<a id="iis"></a>

## <a name="iis-issues"></a>Проблемы IIS

В этом разделе содержатся проблемы с службы IIS.

### <a name="web-site-crashes-after-maphubs-call"></a>Сбой веб-сайта после вызова Мафубс

Эта проблема исправлена в последней версии SignalR. Убедитесь, что вы используете последнюю выпущенную версию SignalR, обновив установку с помощью NuGet.

<a id="azure"></a>

## <a name="azure-issues"></a>Проблемы с Azure

В этом разделе содержатся проблемы с Microsoft Azure.

### <a name="messages-are-not-received-through-the-azure-backplane-after-altering-topic-names"></a>Сообщения не поступают через объединительную плату Azure после изменения имен разделов

Разделы, используемые объединительной платой Azure, не предназначены для настройки пользователем.
